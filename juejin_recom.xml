<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[æ¯”MySQLå¿«800å€çš„æ•°æ®åº“ï¼šClickHouseçš„æ€§èƒ½ç§˜å¯†]]></title>    <link>https://juejin.cn/post/7604409112592449546</link>    <guid>https://juejin.cn/post/7604409112592449546</guid>    <pubDate>2026-02-09T07:26:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604409112592449546" data-draft-id="7604409112592433162" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ¯”MySQLå¿«800å€çš„æ•°æ®åº“ï¼šClickHouseçš„æ€§èƒ½ç§˜å¯†"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-09T07:26:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¥å¥‡å°æ±¤åœ†"/> <meta itemprop="url" content="https://juejin.cn/user/1151943919285431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ¯”MySQLå¿«800å€çš„æ•°æ®åº“ï¼šClickHouseçš„æ€§èƒ½ç§˜å¯†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943919285431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¥å¥‡å°æ±¤åœ†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T07:26:00.000Z" title="Mon Feb 09 2026 07:26:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»14åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<blockquote>
<p>å½“ä¼ ç»Ÿæ•°æ®åº“åœ¨å¤„ç†äº¿çº§æ•°æ®æŸ¥è¯¢æ—¶é™·å…¥æ€§èƒ½ç“¶é¢ˆï¼Œä¸€å®¶ä¿„ç½—æ–¯äº’è”ç½‘å·¨å¤´å´é»˜é»˜å¼€å‘å‡ºäº†ä¸€æ¬¾èƒ½æ¯”Verticaå¿«5å€ã€æ¯”MySQLå¿«800å€çš„åˆ†æå‹æ•°æ®åº“ã€‚</p>
</blockquote>
<p>â€œæ¯å¤©å¤„ç†è¶…è¿‡1000äº¿æ¡è®°å½•ï¼Œæ”¯æŒè¿‘400å°æœåŠ¡å™¨é›†ç¾¤ï¼Œå†å²æ€»è®°å½•è¶…è¿‡13ä¸‡äº¿æ¡ã€‚â€è¿™æ˜¯<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D267917811%26content_type%3DArticle%26match_order%3D1%26q%3DClickHouse%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=267917811&amp;content_type=Article&amp;match_order=1&amp;q=ClickHouse&amp;zhida_source=entity" ref="nofollow noopener noreferrer">ClickHouse</a>åœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D267917811%26content_type%3DArticle%26match_order%3D1%26q%3DYandex.Metrica%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=267917811&amp;content_type=Article&amp;match_order=1&amp;q=Yandex.Metrica&amp;zhida_source=entity" ref="nofollow noopener noreferrer">Yandex.Metrica</a>ä¸­çš„å®é™…åº”ç”¨è§„æ¨¡ã€‚</p>
<p>2016å¹´å¼€æºåï¼ŒClickHouseåœ¨å…¨çƒèŒƒå›´å†…è¿…é€Ÿè·å¾—äº†æŠ€æœ¯ç•Œçš„å…³æ³¨ã€‚å®ƒä¸ä»…è¢«æ¬§æ´²æ ¸å­ç ”ç©¶ä¸­å¿ƒç”¨äºä¿å­˜ç²’å­å¯¹æ’æœºäº§ç”Ÿçš„å¤§é‡å®éªŒæ•°æ®ï¼Œæ¯å¹´å¤„ç†PBçº§åˆ«çš„æ•°æ®å­˜å‚¨ï¼Œè¿˜åœ¨ä¸­å›½è¢«è…¾è®¯ã€æ–°æµªã€é˜¿é‡Œç­‰ä¼—å¤šäº’è”ç½‘å…¬å¸å¹¿æ³›åº”ç”¨äºå®æ—¶æ•°æ®åˆ†æåœºæ™¯ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b38d1d02be94c13b09f4b8bad233362~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771226760&amp;x-signature=%2Bzx%2FnP2Oji4ISqR1lBNjP4vfNnI%3D" alt="" loading="lazy"/></p>
<p>â€‹</p>
<p>â€</p>
<h2 data-id="heading-1">ä¸€ã€ç®€ä»‹</h2>
<p>ClickHouseæ˜¯ä¸€ä¸ª<strong>å¼€æºçš„åˆ—å¼æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDBMSï¼‰</strong> Â ï¼Œä¸“ä¸º<strong>è”æœºåˆ†æå¤„ç†ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D267917811%26content_type%3DArticle%26match_order%3D1%26q%3DOLAP%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=267917811&amp;content_type=Article&amp;match_order=1&amp;q=OLAP&amp;zhida_source=entity" ref="nofollow noopener noreferrer">OLAP</a>ï¼‰</strong> Â åœºæ™¯è€Œè®¾è®¡ã€‚å®ƒçš„åå­—æºè‡ªä¿„è¯­â€ClickHouseâ€ï¼ˆĞšĞ»Ğ¸ĞºĞ¥Ğ°ÑƒÑï¼‰ï¼Œå­—é¢æ„æ€å°±æ˜¯â€å¿«é€Ÿçš„æˆ¿å­â€ã€‚ClickHouseä½¿ç”¨æ ‡å‡†SQLä½œä¸ºæŸ¥è¯¢è¯­è¨€ï¼Œé€šè¿‡<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D267917811%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%2588%2597%25E5%25BC%258F%25E5%25AD%2598%25E5%2582%25A8%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=267917811&amp;content_type=Article&amp;match_order=1&amp;q=%E5%88%97%E5%BC%8F%E5%AD%98%E5%82%A8&amp;zhida_source=entity" ref="nofollow noopener noreferrer">åˆ—å¼å­˜å‚¨</a>ã€<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D267917811%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%2590%2591%25E9%2587%258F%25E5%258C%2596%25E6%2589%25A7%25E8%25A1%258C%25E5%25BC%2595%25E6%2593%258E%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=267917811&amp;content_type=Article&amp;match_order=1&amp;q=%E5%90%91%E9%87%8F%E5%8C%96%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E&amp;zhida_source=entity" ref="nofollow noopener noreferrer">å‘é‡åŒ–æ‰§è¡Œå¼•æ“</a>å’Œé«˜åº¦ä¼˜åŒ–çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D267917811%26content_type%3DArticle%26match_order%3D1%26q%3D%25E6%2595%25B0%25E6%258D%25AE%25E5%258E%258B%25E7%25BC%25A9%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=267917811&amp;content_type=Article&amp;match_order=1&amp;q=%E6%95%B0%E6%8D%AE%E5%8E%8B%E7%BC%A9&amp;zhida_source=entity" ref="nofollow noopener noreferrer">æ•°æ®å‹ç¼©</a>ï¼Œå®ç°äº†æ¯”ä¼ ç»Ÿè¡Œå¼æ•°æ®åº“å¿«æ•°ç™¾å€çš„æŸ¥è¯¢æ€§èƒ½ã€‚</p>
<p>ClickHouseå¹¶éä¼ ç»Ÿæ„ä¹‰ä¸Šçš„æ•°æ®ä»“åº“ï¼Œè€Œæ˜¯ä½œä¸ºæ•°æ®åˆ†æçš„â€æœ€åä¸€å…¬é‡Œâ€å¼•æ“ï¼Œéœ€è¦ä¸æ•°æ®å¯¼å…¥å·¥å…·ã€è°ƒåº¦ç³»ç»Ÿç­‰é…åˆä½¿ç”¨ï¼Œæ„å»ºå®Œæ•´çš„æ•°æ®åˆ†æå¹³å°ã€‚</p>
<p>â€</p>
<p>å®˜ç½‘ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Fclickhouse.com%2Fclickhouse" target="_blank" title="https://link.zhihu.com/?target=https%3A//clickhouse.com/clickhouse" ref="nofollow noopener noreferrer">clickhouse.com/clickhouse</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2fc5df41b5964ba2a8b522be25a38ae7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771226760&amp;x-signature=YulNZX5ZaQFvI7RtLnIi9Th75u8%3D" alt="" loading="lazy"/></p>
<p>â€‹</p>
<p>â€</p>
<p>â€</p>
<h2 data-id="heading-2">äºŒã€å‘å±•å†ç¨‹</h2>
<h2 data-id="heading-3">2.1 åˆ›å§‹äºº</h2>
<p>ClickHouseçš„çµé­‚äººç‰©æ˜¯<strong>Alexey Milovidov</strong>ï¼Œä¸€ä½é«˜æ€§èƒ½C++ã€åˆ†æåº”ç”¨å’ŒSQLæ•°æ®åº“æ–¹é¢çš„ä¸“å®¶ã€‚ä»–äº2008å¹´åŠ å…¥ä¿„ç½—æ–¯äº’è”ç½‘å…¬å¸Yandexï¼Œå¸¦é¢†å›¢é˜Ÿä»é›¶å¼€å§‹ç”¨C++æ‰“é€ äº†è¿™æ¬¾é©å‘½æ€§çš„æ•°æ®åº“ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2f850cd9a974b3b83c99ef43f752b4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771226760&amp;x-signature=%2Fyb%2F9NOCn6fp%2BNSNVYJsO2IGbzA%3D" alt="" loading="lazy"/></p>
<p>ä¸‰ä½åˆ›å§‹äººï¼šCEO Aaron Katzï¼›CTO Alexey Milovidovï¼›äº§å“ Yury Izrailevsky</p>
<p>â€‹</p>
<h2 data-id="heading-4">2.2 äº§ç”ŸèƒŒæ™¯</h2>
<p>ClickHouseçš„æ•…äº‹å§‹äºä¿„ç½—æ–¯çš„äº’è”ç½‘å…¬å¸Yandexã€‚2008å¹´ï¼ŒYandexæ¨å‡ºäº†ç½‘ç«™åˆ†ææœåŠ¡Yandex.Metricaï¼Œç±»ä¼¼äºè°·æ­ŒAnalytics(GA)æˆ–ç™¾åº¦ç»Ÿè®¡ã€‚</p>
<p>æœ€åˆï¼Œè¯¥ç³»ç»Ÿä½¿ç”¨MyISAMä½œä¸ºå­˜å‚¨å¼•æ“ï¼Œä½†éšç€æ•°æ®é‡çš„å¢é•¿ï¼Œè¿™ç§æ–¹æ¡ˆé€æ¸æš´éœ²å‡ºæ€§èƒ½ç“¶é¢ˆã€‚éšåï¼ŒYandexå¼€å‘äº†ç¬¬äºŒä»£è§£å†³æ–¹æ¡ˆMetrageï¼Œä»¥åŠç¬¬ä¸‰ä»£æ–¹æ¡ˆOLAPServerã€‚</p>
<p>ClickHouseæ˜¯<strong>Yandexçš„ç¬¬å››ä»£è§£å†³æ–¹æ¡ˆ</strong>ã€‚å®ƒç”±Alexey Milovidoväº2009å¹´å¼€å§‹å¼€å‘ï¼Œæœ€åˆæ˜¯ä¸ºäº†éªŒè¯ä»éèšåˆæ•°æ®ä¸­å®æ—¶ç”Ÿæˆåˆ†ææŠ¥å‘Šçš„å¯è¡Œæ€§ã€‚</p>
<p>ç»è¿‡ä¸‰å¹´çš„ç ”å‘ï¼ŒClickHouseäº2012å¹´é¦–æ¬¡æŠ•å…¥ç”Ÿäº§ç¯å¢ƒã€‚2016å¹´ï¼ŒYandexå†³å®šå°†å…¶å¼€æºå‘å¸ƒåˆ°GitHubã€‚</p>
<p>â€</p>
<h2 data-id="heading-5">2.3 ç‰ˆæœ¬æ¼”è¿›</h2>
<p><strong>2013å¹´</strong>ï¼šClickHouseè¯ç”ŸäºYandexå†…éƒ¨<br/>
<strong>2016å¹´</strong>ï¼š</p>
<ul>
<li>æ­£å¼å¼€æºå‘å¸ƒ1.1.xç³»åˆ—ï¼Œå¥ å®šåˆ—å¼å­˜å‚¨å¼•æ“åŸºç¡€</li>
<li>ç¬¬ä¸€ä¸ªç¨³å®šç‰ˆæœ¬1.0å‘å¸ƒ</li>
<li>æ”¯æŒåŸºç¡€<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D267917811%26content_type%3DArticle%26match_order%3D1%26q%3DMergeTree%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=267917811&amp;content_type=Article&amp;match_order=1&amp;q=MergeTree&amp;zhida_source=entity" ref="nofollow noopener noreferrer">MergeTree</a>å¼•æ“ã€åˆ†åŒºã€æ’åºå’Œç®€å•SQLæ¥å£</li>
</ul>
<p><strong>2018å¹´</strong>ï¼š</p>
<ul>
<li>å‘å¸ƒç¬¬ä¸€ä¸ªé•¿æœŸæ”¯æŒç‰ˆæœ¬2.0</li>
<li>ç‰ˆæœ¬å·é‡æ„ä¸º<code>Year.Major.Minor.patch</code>â€‹æ ¼å¼ï¼ˆå¦‚18.1.0ï¼‰</li>
<li>å¼•å…¥ReplicatedMergeTreeå¼•æ“å’Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D267917811%26content_type%3DArticle%26match_order%3D1%26q%3DDistributed%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=267917811&amp;content_type=Article&amp;match_order=1&amp;q=Distributed&amp;zhida_source=entity" ref="nofollow noopener noreferrer">Distributed</a>å¼•æ“ï¼Œå¢å¼ºåˆ†å¸ƒå¼èƒ½åŠ›</li>
</ul>
<p><strong>2020å¹´</strong>ï¼š</p>
<ul>
<li>å‘å¸ƒç¬¬ä¸€ä¸ªå•†ä¸šç‰ˆæœ¬3.0</li>
<li>ç‰ˆæœ¬20.xå¼€å§‹æ”¯æŒçª—å£å‡½æ•°å’Œèµ„æºéš”ç¦»</li>
</ul>
<p><strong>2022å¹´</strong>ï¼š</p>
<ul>
<li>å‘å¸ƒ22.8 LTSç‰ˆæœ¬</li>
<li>æ”¯æŒè½»é‡çº§DELETE/UPDATEæ“ä½œ</li>
<li>æ—¥æœŸç±»å‹æ‰©å±•è‡³1900-2299å¹´èŒƒå›´</li>
</ul>
<p><strong>2023-2025å¹´</strong>ï¼š</p>
<ul>
<li>æŒç»­ä¼˜åŒ–æŸ¥è¯¢ä¼˜åŒ–å™¨ã€å¹¶è¡Œå“ˆå¸Œè¿æ¥</li>
<li>2025å¹´æœ€æ–°ç‰ˆæœ¬25.2æ”¯æŒParquetå¸ƒéš†è¿‡æ»¤å™¨å’Œæ•°æ®åº“å¤‡ä»½å¼•æ“</li>
<li>2021å¹´9æœˆæˆç«‹ç‹¬ç«‹å…¬å¸ï¼Œä¸“æ³¨äº‘ç¯å¢ƒéƒ¨ç½²</li>
</ul>
<p>â€</p>
<p>â€</p>
<h2 data-id="heading-6">ä¸‰ã€æ ¸å¿ƒç‰¹ç‚¹åŠŸèƒ½</h2>
<h2 data-id="heading-7">1.Â <strong>æè‡´æŸ¥è¯¢æ€§èƒ½</strong></h2>
<ul>
<li>åˆ—å¼å­˜å‚¨+å‘é‡åŒ–æ‰§è¡Œå¼•æ“ï¼Œç§’çº§å¤„ç†æ•°åäº¿è¡Œæ•°æ®</li>
<li>é‡‡ç”¨MPPæ¶æ„ï¼Œå®ç°é›†ç¾¤èŠ‚ç‚¹ã€å¤šå‰¯æœ¬ã€å¤šæ ¸CPUä¸‰çº§å¹¶è¡Œ</li>
</ul>
<h2 data-id="heading-8">2.Â <strong>é«˜æ•ˆå­˜å‚¨ç®¡ç†</strong></h2>
<ul>
<li>æ•°æ®å‹ç¼©ç‡å¯è¾¾5-10å€ï¼Œå¤§å¹…å‡å°‘å­˜å‚¨æˆæœ¬</li>
<li>æ”¯æŒå¤šç§å‹ç¼©ç®—æ³•ï¼ˆLZ4ã€ZSTDç­‰ï¼‰</li>
</ul>
<h2 data-id="heading-9">3.Â <strong>çµæ´»æ•°æ®æ¨¡å‹</strong></h2>
<ul>
<li>æ”¯æŒå¤æ‚æ•°æ®ç±»å‹ï¼šArrayã€Tupleã€Nestedã€JSONç­‰</li>
<li>æä¾›20+ç§è¡¨å¼•æ“ï¼Œå…¶ä¸­MergeTreeç³»åˆ—ä¸ºæ ¸å¿ƒ</li>
</ul>
<h2 data-id="heading-10">4.Â <strong>å®æ—¶æ•°æ®å¤„ç†</strong></h2>
<ul>
<li>æ”¯æŒæ¯ç§’æ•°äº¿è¡Œçš„æ•°æ®å†™å…¥ååé‡</li>
<li>æ•°æ®å†™å…¥å³å¯æŸ¥ï¼Œé€‚åˆå®æ—¶åˆ†æåœºæ™¯</li>
</ul>
<h2 data-id="heading-11">5.Â <strong>åˆ†å¸ƒå¼æ‰©å±•èƒ½åŠ›</strong></h2>
<ul>
<li>åŸç”Ÿæ”¯æŒæ•°æ®åˆ†ç‰‡ï¼ˆShardingï¼‰å’Œå¤åˆ¶ï¼ˆReplicationï¼‰</li>
<li>é€šè¿‡<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D267917811%26content_type%3DArticle%26match_order%3D1%26q%3DZooKeeper%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=267917811&amp;content_type=Article&amp;match_order=1&amp;q=ZooKeeper&amp;zhida_source=entity" ref="nofollow noopener noreferrer">ZooKeeper</a>å®ç°åˆ†å¸ƒå¼åè°ƒ</li>
</ul>
<h2 data-id="heading-12">6.Â <strong>æ ‡å‡†SQLæ”¯æŒ</strong></h2>
<ul>
<li>æ”¯æŒæ ‡å‡†SQLè¯­æ³•ã€çª—å£å‡½æ•°ã€å­æŸ¥è¯¢</li>
<li>å†…ç½®æ•°ç™¾ä¸ªå®ç”¨å‡½æ•°</li>
</ul>
<h2 data-id="heading-13">7.Â <strong>é™åˆ¶ä¸ä¸è¶³</strong></h2>
<ul>
<li>ä¸æ”¯æŒå®Œæ•´ACIDäº‹åŠ¡</li>
<li>è¡Œçº§UPDATE/DELETEæ€§èƒ½è¾ƒå·®ï¼ˆè™½åœ¨æŒç»­æ”¹è¿›ï¼‰</li>
<li>ä¸é€‚åˆé«˜å¹¶å‘ç‚¹æŸ¥å’ŒOLTPåœºæ™¯</li>
</ul>
<p>â€</p>
<p><em>è¡¨ï¼šClickHouseä¸ä¼ ç»Ÿæ•°æ®åº“æ€§èƒ½å¯¹æ¯”</em></p>



































<table><thead><tr><th>æ•°æ®åº“ç±»å‹</th><th>1äº¿æ•°æ®é›†æŸ¥è¯¢æ—¶é—´</th><th>10äº¿æ•°æ®é›†æŸ¥è¯¢èƒ½åŠ›</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>ClickHouse</td><td>çº¦1ç§’</td><td>å®Œå…¨æ”¯æŒ</td><td>å®æ—¶åˆ†æã€å¤§æ•°æ®æŸ¥è¯¢</td></tr><tr><td>Vertica</td><td>çº¦5.42ç§’</td><td>å®Œå…¨æ”¯æŒ</td><td>å•†ä¸šåˆ†æ</td></tr><tr><td>Hive</td><td>279ç§’</td><td>æœ‰é™æ”¯æŒ</td><td>æ‰¹å¤„ç†åˆ†æ</td></tr><tr><td>MySQL</td><td>801ç§’</td><td>æ— æ³•å®Œæˆ</td><td>äº‹åŠ¡å¤„ç†</td></tr></tbody></table>
<p>â€</p>
<p>â€</p>
<h2 data-id="heading-14">å››ã€å„OLAPæ•°æ®åº“å¯¹æ¯”</h2>
<p>ä¸ClickHouseç±»ä¼¼çš„æ•°æ®ä¸»è¦æ˜¯<strong>åˆ†æå‹æ•°æ®åº“</strong>ï¼Œå®ƒä»¬ä¸“æ³¨äºæµ·é‡æ•°æ®çš„å¿«é€ŸæŸ¥è¯¢ä¸åˆ†æï¼ˆOLAPï¼‰ï¼Œä½†åœ¨æŠ€æœ¯è·¯çº¿å’Œåº”ç”¨åœºæ™¯ä¸Šå„æœ‰ä¾§é‡ã€‚</p>
<p>ä¸‹é¢çš„è¡¨æ ¼æ•´ç†äº†è¿™ç±»æ•°æ®åº“ä¸­çš„ä¸»è¦ä»£è¡¨åŠå…¶æ ¸å¿ƒç‰¹ç‚¹ï¼š</p>






















































<table><thead><tr><th>æ•°æ®åº“</th><th>ç±»å‹</th><th>å¼€æº/å•†ä¸š</th><th>æ ¸å¿ƒä¼˜åŠ¿</th><th>ä»£è¡¨ç”¨æˆ·</th></tr></thead><tbody><tr><td>ClickHouse</td><td>åˆ—å¼OLAP</td><td>âœ… å¼€æº</td><td>æè‡´æ€§èƒ½ï¼ˆäºšç§’çº§æŸ¥è¯¢ï¼‰ é«˜å‹ç¼©ç‡ï¼ˆ10:1+ï¼‰ å¼€æºç”Ÿæ€æ´»è·ƒ</td><td>Yandexã€Netflixã€è…¾è®¯ã€å°ç±³ã€æ»´æ»´</td></tr><tr><td>Apache Druid</td><td>åˆ—å¼OLAP</td><td>âœ… å¼€æº</td><td>å®æ—¶æ‘„å…¥ï¼ˆç§’çº§å»¶è¿Ÿï¼‰ é«˜å¹¶å‘æŸ¥è¯¢ï¼ˆ10k+ QPSï¼‰</td><td>Airbnbã€Uberã€Netflixã€LinkedIn</td></tr><tr><td>Apache Pinot</td><td>åˆ—å¼OLAP</td><td>âœ… å¼€æº</td><td>è¶…ä½å»¶è¿Ÿï¼ˆæ¯«ç§’çº§ï¼‰ è‡ªåŠ¨åˆ†åŒº</td><td>LinkedInã€Uberã€TikTok</td></tr><tr><td>Amazon Redshift</td><td>äº‘æ•°æ®ä»“åº“</td><td>âŒ å•†ä¸š</td><td>æ— ç¼AWSé›†æˆ è‡ªåŠ¨æ‰©å±•</td><td>AWSå…¨ç”Ÿæ€ç”¨æˆ·ï¼ˆNetflixã€Airbnbï¼‰</td></tr><tr><td>Snowflake</td><td>äº‘æ•°æ®ä»“åº“</td><td>âŒ å•†ä¸š</td><td>å¤šäº‘æ”¯æŒ å¼¹æ€§è®¡è´¹</td><td>Salesforceã€Adobeã€Spotify</td></tr><tr><td>Google BigQuery</td><td>äº‘æ•°æ®ä»“åº“</td><td>âŒ å•†ä¸š</td><td>æ— æœåŠ¡å™¨æ¶æ„ PBçº§åˆ†æ</td><td>Google Cloudç”¨æˆ·ï¼ˆSpotifyã€NASAï¼‰</td></tr></tbody></table>
<p>â€</p>
<h2 data-id="heading-15">1.Â <strong>åº”ç”¨å¹¿åº¦ï¼ˆè¡Œä¸šè¦†ç›–ï¼‰</strong></h2>
<ul>
<li><strong>ClickHouse</strong>ï¼šè¦†ç›–<strong>äº’è”ç½‘ã€ç”µå•†ã€é‡‘èã€ç‰©è”ç½‘</strong>ç­‰å…¨é¢†åŸŸï¼Œ<strong>å¼€æºç”¨æˆ·é‡è¶…10ä¸‡+</strong> Â ï¼ˆDB-Enginesæ•°æ®ï¼‰</li>
<li><strong>Snowflake</strong>ï¼šäº‘æ•°æ®ä»“åº“å¸‚åœºå æœ‰ç‡<strong>35%+</strong> Â ï¼ˆGartner 2023ï¼‰ï¼Œä½†<strong>å•†ä¸šé—­æºé™åˆ¶</strong>äº†æŠ€æœ¯æ·±åº¦æ¢ç´¢</li>
<li><strong>Apache Druid</strong>ï¼š<strong>å®æ—¶åˆ†æåœºæ™¯</strong>çš„é¦–é€‰ï¼ˆå¦‚å¹¿å‘Šç‚¹å‡»æµï¼‰ï¼Œä½†<strong>ç¤¾åŒºè§„æ¨¡å°äºClickHouse</strong></li>
<li><strong>Pinot</strong>ï¼šæ–°å…´ä½†<strong>ç”¨æˆ·é‡å¢é•¿å¿«</strong>ï¼ˆLinkedInã€Uberå·²ç”¨ï¼‰ï¼Œå°šæœªè¾¾åˆ°ClickHouseçš„æ™®åŠåº¦</li>
</ul>
<blockquote>
<p>âœ…Â <strong>ç»“è®º</strong>ï¼šClickHouseåœ¨<strong>å¼€æºç”Ÿæ€</strong>ä¸­åº”ç”¨æœ€å¹¿ï¼Œè¦†ç›–ä¼ä¸šç±»å‹æœ€å…¨ã€‚</p>
</blockquote>
<p>â€</p>
<h2 data-id="heading-16">2.Â <strong>æŠ€æœ¯å½±å“åŠ›ï¼ˆç¤¾åŒºæ´»è·ƒåº¦ï¼‰</strong></h2>
<ul>
<li><strong>ClickHouse GitHub</strong>ï¼šâ­ï¸ 19.8k stars | ğŸ“… 2023å¹´æ–°å¢1.2k starsï¼ˆ<strong>å¹´å¢é•¿22%</strong> Â ï¼‰</li>
<li><strong>Apache Druid</strong>ï¼šâ­ï¸ 8.3k stars | ğŸ“… 2023å¹´æ–°å¢0.7k stars</li>
<li><strong>Snowflake</strong>ï¼šå•†ä¸šäº§å“ï¼Œ<strong>æ— å…¬å¼€ç¤¾åŒºæ•°æ®</strong>ï¼Œä½†<strong>ä¼ä¸šçº§æœåŠ¡å®Œå–„</strong></li>
<li><strong>DB-Enginesæ’å</strong>ï¼ˆ2024ï¼‰ï¼š</li>
</ul>
<ol>
<li>ClickHouseï¼ˆOLAPç±»ç¬¬1ï¼‰</li>
<li>Snowflakeï¼ˆæ•°æ®ä»“åº“ç±»ç¬¬1ï¼‰</li>
<li>Apache Druidï¼ˆOLAPç±»ç¬¬3ï¼‰</li>
</ol>
<blockquote>
<p>âœ…Â <strong>ç»“è®º</strong>ï¼šClickHouseåœ¨<strong>å¼€æºæŠ€æœ¯ç¤¾åŒºå½±å“åŠ›</strong>ä¸Šç¨³å±…ç¬¬ä¸€ã€‚</p>
</blockquote>
<p>â€</p>
<h2 data-id="heading-17">3.Â <strong>æ€§èƒ½å®æµ‹å¯¹æ¯”ï¼ˆ100äº¿è¡Œæ•°æ®ï¼‰</strong></h2>



































<table><thead><tr><th>æ•°æ®åº“</th><th>æŸ¥è¯¢å»¶è¿Ÿï¼ˆavgï¼‰</th><th>å†…å­˜å ç”¨</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>ClickHouse</td><td>120ms</td><td>ä½</td><td>é€šç”¨åˆ†æã€å®æ—¶æŠ¥è¡¨</td></tr><tr><td>Apache Druid</td><td>210ms</td><td>ä¸­</td><td>å®æ—¶ç›‘æ§ã€äº‹ä»¶åˆ†æ</td></tr><tr><td>Snowflake</td><td>350ms</td><td>é«˜</td><td>å¤æ‚ETLã€å¤šäº‘åˆ†æ</td></tr><tr><td>Amazon Redshift</td><td>420ms</td><td>é«˜</td><td>ä¼ ç»Ÿæ•°æ®ä»“åº“è¿ç§»</td></tr></tbody></table>
<p>â€</p>
<h2 data-id="heading-18">ğŸ” å¦‚ä½•é€‰æ‹©é€‚åˆä½ çš„æ•°æ®åº“ï¼Ÿ</h2>
<p>æ²¡æœ‰â€œæœ€å¥½â€çš„æ•°æ®åº“ï¼Œåªæœ‰æœ€é€‚åˆä½ åœºæ™¯çš„ã€‚ä½ å¯ä»¥å‚è€ƒä»¥ä¸‹å‡ ç‚¹è¿›è¡Œé€‰æ‹©ï¼š</p>
<ul>
<li><strong>è¿½æ±‚æè‡´çš„æŸ¥è¯¢é€Ÿåº¦ï¼Œå¤„ç†å•è¡¨æˆ–å®½è¡¨ä¸ºä¸»</strong>ï¼š<strong>ClickHouse</strong>Â æ˜¯é¦–é€‰ã€‚</li>
<li><strong>éœ€è¦é«˜å¹¶å‘æŸ¥è¯¢ï¼ŒåŒæ—¶æœ‰è¾ƒå¤šå¤æ‚å…³è”åˆ†æ</strong>ï¼šå¯ä»¥è€ƒå¯ŸÂ <strong>Apache Doris</strong>Â æˆ–äº‘æ•°ä»“ã€‚</li>
<li><strong>éœ€è¦æŸ¥è¯¢å¤šä¸ªä¸åŒæ¥æºçš„æ•°æ®ï¼Œè¿›è¡Œäº¤äº’å¼æ¢ç´¢</strong>ï¼š<strong>Presto/Trino</strong>Â çš„è”é‚¦æŸ¥è¯¢èƒ½åŠ›å¾ˆé€‚åˆã€‚</li>
<li><strong>å¸Œæœ›å…è¿ç»´ã€å¿«é€Ÿå¯åŠ¨ï¼Œä¸”é¢„ç®—å……è¶³</strong>ï¼šç›´æ¥ä½¿ç”¨Â <strong>Snowflakeã€BigQuery</strong>Â ç­‰<strong>äº‘æ•°ä»“</strong>æœåŠ¡ã€‚</li>
<li><strong>æ¶‰åŠå¤æ‚çš„æ‰¹å¤„ç†ã€æµè®¡ç®—æˆ–æœºå™¨å­¦ä¹ ä»»åŠ¡</strong>ï¼š<strong>Apache Spark</strong>Â çš„ç”Ÿæ€æ›´ä¸ºå…¨é¢ã€‚</li>
</ul>
<p>â€</p>
<h2 data-id="heading-19">äº”ã€åº”ç”¨åœºæ™¯</h2>
<p>åŸºäºå…¶â€œé«˜æ€§èƒ½å®æ—¶åˆ†æâ€çš„æ ¸å¿ƒç‰¹æ€§ï¼ŒClickHouseå¹¿æ³›åº”ç”¨äºä»¥ä¸‹å…­å¤§é¢†åŸŸï¼Œæˆä¸ºä¼ä¸šæ•°æ®é©±åŠ¨å†³ç­–çš„æ ¸å¿ƒå·¥å…·ï¼š</p>
<h2 data-id="heading-20">5.1 æ—¥å¿—ä¸ç›‘æ§æ•°æ®åˆ†æ</h2>
<p>è¿™æ˜¯ClickHouseæœ€ç»å…¸çš„åº”ç”¨åœºæ™¯ä¹‹ä¸€ã€‚ä¼ä¸šå¯åˆ©ç”¨ClickHouseåˆ†ææœåŠ¡å™¨æ—¥å¿—ã€åº”ç”¨æ—¥å¿—ï¼ˆå¦‚Nginxè®¿é—®æ—¥å¿—ã€Tomcaté”™è¯¯æ—¥å¿—ï¼‰ï¼Œå¿«é€Ÿç»Ÿè®¡PV/UVã€é”™è¯¯ç‡ã€å“åº”æ—¶é—´åˆ†å¸ƒç­‰æ ¸å¿ƒæŒ‡æ ‡ï¼›åŒæ—¶å¯ç”¨äºä¸šåŠ¡ç›‘æ§ï¼Œå¦‚ç”µå•†å¤§ä¿ƒæœŸé—´çš„è®¢å•é‡ã€æ”¯ä»˜æˆåŠŸç‡ç›‘æ§ï¼Œå®æ—¶ç”ŸæˆGrafanaã€Supersetç­‰å¯è§†åŒ–ä»ªè¡¨ç›˜ï¼ŒåŠæ—¶å‘ç°å¼‚å¸¸å¹¶é¢„è­¦ã€‚</p>
<h2 data-id="heading-21">5.2 ç”¨æˆ·è¡Œä¸ºåˆ†æï¼ˆUBAï¼‰</h2>
<p>åœ¨äº’è”ç½‘ã€ç”µå•†ç­‰è¡Œä¸šï¼ŒClickHouseå¯ç”¨äºè¿½è¸ªç”¨æˆ·ç‚¹å‡»æµï¼ˆClick Streamï¼‰ï¼Œåˆ†æç”¨æˆ·è·¯å¾„ï¼ˆå¦‚ä»é¦–é¡µåˆ°ä¸‹å•çš„è½¬åŒ–æ¼æ–—ï¼‰ã€ç•™å­˜ç‡ã€å¤è´­ç‡ç­‰æ ¸å¿ƒæŒ‡æ ‡ï¼›ç»“åˆA/Bæµ‹è¯•ï¼Œå¯å¿«é€ŸéªŒè¯äº§å“æ”¹ç‰ˆã€è¥é”€ç­–ç•¥çš„æ•ˆæœï¼Œä¸ºäº§å“ä¼˜åŒ–æä¾›æ•°æ®æ”¯æ’‘ã€‚</p>
<h2 data-id="heading-22">5.3 å•†ä¸šæ™ºèƒ½ï¼ˆBIï¼‰ä¸æŠ¥è¡¨</h2>
<p>ClickHouseå¸¸ä½œä¸ºPower BIã€Tableauã€Quick BIç­‰BIå·¥å…·çš„æ ¸å¿ƒæ•°æ®æºï¼Œæ”¯æŒå®æ—¶æŠ¥è¡¨ç”Ÿæˆå’Œå³å¸­æŸ¥è¯¢ï¼ˆAd-Hoc Queryï¼‰ï¼Œå¸®åŠ©ä¸šåŠ¡äººå‘˜å¿«é€Ÿè·å–æ•°æ®æ´å¯Ÿï¼›åŒæ—¶å¯æ„å»ºä¼ä¸šçº§æ•°æ®ä»“åº“ï¼Œæ•´åˆé”€å”®ã€åº“å­˜ã€ç”¨æˆ·ç­‰å¤šä¸šåŠ¡çº¿æ•°æ®ï¼Œæ”¯æŒå¤šç»´OLAPåˆ†æï¼Œä¸ºç®¡ç†å±‚å†³ç­–æä¾›å…¨é¢çš„æ•°æ®æ”¯æ’‘ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d2a6450b9df4691a7b166aab0e10a34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771226760&amp;x-signature=PDFyxuLy%2FyRAy8K0ei8Ir4pcltc%3D" alt="" loading="lazy"/></p>
<p>â€‹</p>
<h2 data-id="heading-23">5.4 å¤§æ•°æ®å®æ—¶å¤„ç†</h2>
<p>ä¸Flinkã€Sparkç­‰æµå¤„ç†æ¡†æ¶é›†æˆï¼ŒClickHouseå¯ä½œä¸ºå®æ—¶æ•°æ®å¤„ç†çš„ç»ˆç«¯å­˜å‚¨å’Œåˆ†æèŠ‚ç‚¹ã€‚æµå¤„ç†æ¡†æ¶å®Œæˆæ•°æ®æ¸…æ´—ã€è½¬æ¢åï¼Œå°†æ•°æ®å®æ—¶å†™å…¥ClickHouseï¼Œæ”¯æ’‘å®æ—¶é£æ§ã€åŠ¨æ€å®šä»·ã€å®æ—¶æ¨èç­‰æ ¸å¿ƒä¸šåŠ¡åœºæ™¯ï¼Œå®ç°â€œæ•°æ®äº§ç”Ÿ-å¤„ç†-åˆ†æ-å†³ç­–â€çš„å…¨é“¾è·¯å®æ—¶åŒ–ã€‚</p>
<h2 data-id="heading-24">5.5 ç‰©è”ç½‘ï¼ˆIoTï¼‰æ•°æ®åˆ†æ</h2>
<p>ç‰©è”ç½‘è®¾å¤‡äº§ç”Ÿçš„æ—¶åºæ•°æ®ï¼ˆå¦‚æ¸©åº¦ã€æ¹¿åº¦ã€è®¾å¤‡çŠ¶æ€ï¼‰å…·æœ‰â€œæµ·é‡ã€å®æ—¶â€çš„ç‰¹ç‚¹ï¼ŒClickHouseå¯é«˜æ•ˆå­˜å‚¨å’Œåˆ†æè¿™äº›æ•°æ®ï¼Œç»Ÿè®¡è®¾å¤‡å¼‚å¸¸äº‹ä»¶ã€å¥åº·åº¦ã€èƒ½è€—è¶‹åŠ¿ç­‰æŒ‡æ ‡ï¼Œæ”¯æ’‘æ™ºèƒ½è®¾å¤‡è¿ç»´ã€èƒ½è€—ç®¡ç†ç­‰ä¸šåŠ¡åœºæ™¯ã€‚</p>
<h2 data-id="heading-25">5.6 æœºå™¨å­¦ä¹ ä¸ç”Ÿæˆå¼AIæ”¯æ’‘</h2>
<p>éšç€AIæŠ€æœ¯çš„å‘å±•ï¼ŒClickHouseä¹Ÿæˆä¸ºML&amp;GenAIåœºæ™¯çš„é‡è¦æ”¯æ’‘å·¥å…·ã€‚å…¶é«˜æ€§èƒ½çš„å‘é‡æœç´¢ã€å³æ—¶èšåˆèƒ½åŠ›å¯åŠ é€Ÿæ¨¡å‹è®­ç»ƒæ•°æ®çš„å¤„ç†ï¼›Anthropicåœ¨Claude 4çš„ç ”å‘å’Œéƒ¨ç½²ä¸­ï¼Œå°±å€ŸåŠ©ClickHouseå®ç°äº†é«˜æ•ˆçš„æ•°æ®å¤„ç†ï¼Œå¯è§å…¶åœ¨AIé¢†åŸŸçš„ä»·å€¼ã€‚</p>
<p>â€</p>
<p>â€</p>
<h2 data-id="heading-26">å…­ã€æ ¸å¿ƒæ¦‚å¿µæ¶æ„åŠåŸç†</h2>
<h2 data-id="heading-27">6.1 æ¶æ„</h2>
<h3 data-id="heading-28">1.Â <strong>åˆ—å¼å­˜å‚¨</strong></h3>
<p>æ•°æ®æŒ‰åˆ—ç‹¬ç«‹å­˜å‚¨ï¼ŒæŸ¥è¯¢æ—¶åªè¯»å–éœ€è¦çš„åˆ—ï¼Œå¤§å¹…å‡å°‘I/Oå¼€é”€ã€‚æ ¸å¿ƒå®ç°åŸºäº<code>IColumn</code>â€‹æ¥å£ï¼Œç¡®ä¿ç±»å‹å®‰å…¨å’Œå‘é‡åŒ–æ“ä½œã€‚</p>
<h3 data-id="heading-29">2.Â <strong>MergeTreeå¼•æ“</strong></h3>
<p>ClickHouseæœ€æ ¸å¿ƒçš„å­˜å‚¨å¼•æ“ï¼Œç‰¹ç‚¹åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>æ•°æ®åˆ†åŒº</strong>ï¼šæŒ‰æ—¶é—´æˆ–å…¶ä»–ç»´åº¦åˆ†åŒºï¼ˆPartitionï¼‰</li>
<li><strong>ç¨€ç–ç´¢å¼•</strong>ï¼šåªå­˜å‚¨éƒ¨åˆ†æ•°æ®ç´¢å¼•ï¼ŒèŠ‚çœç©ºé—´</li>
<li><strong>åå°åˆå¹¶</strong>ï¼šè‡ªåŠ¨åˆå¹¶å°æ•°æ®å—ï¼ˆPartsï¼‰ä¼˜åŒ–å­˜å‚¨</li>
<li><strong>æ’åºé”®</strong>ï¼šæ•°æ®æŒ‰ORDER BYå­—æ®µç‰©ç†æ’åºï¼ŒåŠ é€ŸæŸ¥è¯¢</li>
</ul>
<h3 data-id="heading-30">3.Â <strong>åˆ†å¸ƒå¼æ¶æ„</strong></h3>
<pre><code class="hljs language-markdown" lang="markdown">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Distributedè¡¨   â”‚
â”‚  (é€»è¾‘è§†å›¾)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
<span class="hljs-code">          â”‚
    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    â”‚  åˆ†ç‰‡1    â”‚  åˆ†ç‰‡2    â”‚  åˆ†ç‰‡3
    â”‚  å‰¯æœ¬1-1  â”‚  å‰¯æœ¬2-1  â”‚  å‰¯æœ¬3-1
    â”‚  å‰¯æœ¬1-2  â”‚  å‰¯æœ¬2-2  â”‚  å‰¯æœ¬3-2
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€
</span></code></pre>
<ul>
<li><strong>åˆ†ç‰‡</strong>ï¼šæ•°æ®æ°´å¹³æ‹†åˆ†</li>
<li><strong>å¤åˆ¶</strong>ï¼šé€šè¿‡ZooKeeperå®ç°å¤šå‰¯æœ¬åŒæ­¥</li>
</ul>
<h3 data-id="heading-31">4.Â <strong>ç‰©åŒ–è§†å›¾ï¼ˆMaterialized Viewï¼‰</strong></h3>
<p>é¢„è®¡ç®—å¹¶å­˜å‚¨å¤æ‚æŸ¥è¯¢ç»“æœï¼Œæ˜¾è‘—æå‡æŸ¥è¯¢æ€§èƒ½ã€‚</p>
<p>â€</p>
<h2 data-id="heading-32">6.2 å·¥ä½œåŸç†</h2>
<p>ClickHouseçš„æ¶æ„è®¾è®¡ä½“ç°äº†ç°ä»£åˆ†æå‹æ•°æ®åº“çš„ç²¾é«“ã€‚å…¶æ•´ä½“æ¶æ„å¯åˆ†ä¸ºä¸‰å±‚ï¼šæŸ¥è¯¢å¤„ç†å±‚ã€å­˜å‚¨å±‚ä»¥åŠé›†æˆå±‚ã€‚</p>
<p>æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªè®¿é—®å±‚ï¼Œé€šè¿‡ä¸åŒåè®®ç®¡ç†ç”¨æˆ·ä¼šè¯å¹¶ä¸åº”ç”¨ç¨‹åºé€šä¿¡ã€‚ç³»ç»Ÿè¿˜åŒ…å«ç”¨äºçº¿ç¨‹ã€ç¼“å­˜ã€åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ã€å¤‡ä»½ä»¥åŠæŒç»­ç›‘æ§çš„æ­£äº¤ç»„ä»¶ã€‚</p>
<p><strong>å­˜å‚¨å±‚</strong>æ˜¯ClickHouseæ¶æ„çš„æ ¸å¿ƒï¼Œä¸»è¦ç”±MergeTreeç³»åˆ—è¡¨å¼•æ“ç»„æˆã€‚è¿™äº›è¡¨å¼•æ“åŸºäºLSMæ ‘çš„æ€æƒ³ï¼Œå°†è¡¨æ‹†åˆ†ä¸ºæŒ‰æ°´å¹³æ–¹å‘åˆ’åˆ†ä¸”æœ‰åºçš„â€œpartsâ€ï¼Œè¿™äº›partsä¼šç”±åå°è¿›ç¨‹æŒç»­åˆå¹¶ã€‚</p>
<p>æ¯ä¸ªMergeTreeè¡¨åœ¨åˆå¹¶å…¶è¾“å…¥partsçš„è¡Œæ–¹å¼ä¸Šæœ‰æ‰€ä¸åŒï¼Œä¾‹å¦‚å¯ä»¥å¯¹è¡Œè¿›è¡Œèšåˆï¼Œæˆ–åœ¨è¿‡æœŸæ—¶è¿›è¡Œæ›¿æ¢ã€‚é™¤äº†MergeTreeç³»åˆ—ï¼Œè¿˜æœ‰ç”¨äºåŠ é€Ÿæˆ–åˆ†å¸ƒæŸ¥è¯¢æ‰§è¡Œçš„ä¸“ç”¨è¡¨å¼•æ“ï¼Œä»¥åŠç”¨äºä¸å¤–éƒ¨ç³»ç»Ÿè¿›è¡ŒåŒå‘æ•°æ®äº¤æ¢çš„è™šæ‹Ÿè¡¨å¼•æ“ã€‚</p>
<p><strong>åˆ†å¸ƒå¼èƒ½åŠ›</strong>æ˜¯ClickHouseçš„å¦ä¸€å¤§ç‰¹è‰²ã€‚å®ƒæ”¯æŒåœ¨å¤šä¸ªé›†ç¾¤èŠ‚ç‚¹ä¹‹é—´å¯¹è¡¨è¿›è¡Œåˆ†ç‰‡å’Œå¤åˆ¶ï¼Œä»¥å®ç°å¯æ‰©å±•æ€§å’Œé«˜å¯ç”¨æ€§ã€‚åˆ†ç‰‡çš„ä¸»è¦ç›®çš„æ˜¯å¤„ç†è¶…å‡ºå•ä¸ªèŠ‚ç‚¹å®¹é‡çš„æ•°æ®é›†ï¼Œæˆ–è€…å°†æŸå¼ è¡¨çš„è¯»å†™è´Ÿè½½åˆ†æ•£åˆ°å¤šä¸ªèŠ‚ç‚¹ä¸Šã€‚</p>
<p>ClickHouseå¯ä»¥åœ¨å¤šç§æ¨¡å¼ä¸‹è¿è¡Œï¼šæœ¬åœ°éƒ¨ç½²æ¨¡å¼ã€äº‘ç«¯æ¨¡å¼ã€ç‹¬ç«‹æ¨¡å¼æˆ–è¿›ç¨‹å†…æ¨¡å¼ã€‚è¿™ç§çµæ´»æ€§ä½¿å¾—å®ƒèƒ½å¤Ÿé€‚åº”ä¸åŒçš„éƒ¨ç½²ç¯å¢ƒå’Œåº”ç”¨éœ€æ±‚ã€‚</p>
<p>â€</p>
<p>â€</p>
<h2 data-id="heading-33">ä¸ƒã€ä¸‹è½½å®‰è£…</h2>
<h2 data-id="heading-34">ç³»ç»Ÿè¦æ±‚</h2>
<ul>
<li>Linuxï¼ˆæ¨èUbuntuã€CentOSï¼‰</li>
<li>4GBä»¥ä¸Šå†…å­˜</li>
<li>x86-64æˆ–ARM64æ¶æ„</li>
</ul>
<h2 data-id="heading-35">å®‰è£…æ–¹å¼ï¼ˆLinuxï¼‰</h2>
<p><strong>æ–¹å¼ä¸€ï¼šRPMåŒ…å®‰è£…</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ·»åŠ å®˜æ–¹ä»“åº“</span>
sudo yum install -y yum-utils
sudo yum-config-manager --add-repo https://packages.clickhouse.com/rpm/clickhouse.repo

<span class="hljs-comment"># å®‰è£…</span>
sudo yum install -y clickhouse-server clickhouse-client

<span class="hljs-comment"># å¯åŠ¨æœåŠ¡</span>
sudo systemctl start clickhouse-server
sudo systemctl <span class="hljs-built_in">enable</span> clickhouse-server
</code></pre>
<p><strong>æ–¹å¼äºŒï¼šDockeréƒ¨ç½²</strong>ï¼ˆæ¨èï¼‰</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ‹‰å–å®˜æ–¹é•œåƒ</span>
docker pull clickhouse/clickhouse-server

<span class="hljs-comment"># å¯åŠ¨å®¹å™¨</span>
docker run -d \
  --name clickhouse-server \
  -p 8123:8123 -p 9000:9000 \
  --<span class="hljs-built_in">ulimit</span> nofile=262144:262144 \
  clickhouse/clickhouse-server
</code></pre>
<p><strong>æ–¹å¼ä¸‰ï¼šTgzåŒ…æ‰‹åŠ¨å®‰è£…</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¸‹è½½</span>
curl -O https://packages.clickhouse.com/tgz/stable/clickhouse-common-static-24.3.2.23-amd64.tgz

<span class="hljs-comment"># è§£å‹å¹¶å®‰è£…</span>
tar -xzvf clickhouse-*.tgz
sudo ./clickhouse-*/install/doinst.sh
</code></pre>
<h2 data-id="heading-36">éªŒè¯å®‰è£…</h2>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># ä½¿ç”¨å®¢æˆ·ç«¯è¿æ¥</span>
clickhouse-client --password

<span class="hljs-meta"># æŸ¥çœ‹ç‰ˆæœ¬</span>
<span class="hljs-function">SELECT <span class="hljs-title">version</span>()</span>;
</code></pre>
<p>â€</p>
<p>â€</p>
<h2 data-id="heading-37">å…«ã€ä½¿ç”¨å®ä¾‹</h2>
<h2 data-id="heading-38">å®ä¾‹1ï¼šåˆ›å»ºæ•°æ®åº“å’Œè¡¨</h2>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åˆ›å»ºæ•°æ®åº“</span>
<span class="hljs-keyword">CREATE</span> DATABASE IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> analytics;

<span class="hljs-comment">-- åˆ›å»ºMergeTreeè¡¨</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> analytics.user_log (
    user_id UInt32,
    event_date <span class="hljs-type">Date</span>,
    action String,
    duration UInt32,
    region String
) ENGINE <span class="hljs-operator">=</span> MergeTree()
<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> toYYYYMM(event_date)
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> (event_date, user_id, action)
SETTINGS index_granularity <span class="hljs-operator">=</span> <span class="hljs-number">8192</span>;

<span class="hljs-comment">-- åˆ›å»ºåˆ†å¸ƒå¼è¡¨ï¼ˆé›†ç¾¤ç¯å¢ƒï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> analytics.user_log_all <span class="hljs-keyword">AS</span> user_log
ENGINE <span class="hljs-operator">=</span> Distributed(<span class="hljs-keyword">default</span>, analytics, user_log, rand());
</code></pre>
<p>â€</p>
<h2 data-id="heading-39">å®ä¾‹2ï¼šæ•°æ®å¯¼å…¥</h2>
<pre><code class="hljs language-sql" lang="sql"># ä»CSVæ–‡ä»¶å¯¼å…¥
clickhouse<span class="hljs-operator">-</span>client <span class="hljs-comment">--query="INSERT INTO analytics.user_log FORMAT CSVWithNames" &lt; user_log.csv</span>

# JSONæ ¼å¼æ’å…¥
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> analytics.user_log FORMAT JSONEachRow
{"user_id":<span class="hljs-number">1001</span>, "event_date":"2025-12-15", "action":"login", "duration":<span class="hljs-number">120</span>, "region":"BJ"}
{"user_id":<span class="hljs-number">1002</span>, "event_date":"2025-12-15", "action":"purchase", "duration":<span class="hljs-number">300</span>, "region":"SH"}

# æ‰¹é‡æ’å…¥ï¼ˆæ¨èï¼‰
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> analytics.user_log <span class="hljs-keyword">VALUES</span>
(<span class="hljs-number">1003</span>, <span class="hljs-string">'2025-12-15'</span>, <span class="hljs-string">'browse'</span>, <span class="hljs-number">60</span>, <span class="hljs-string">'GZ'</span>),
(<span class="hljs-number">1004</span>, <span class="hljs-string">'2025-12-15'</span>, <span class="hljs-string">'search'</span>, <span class="hljs-number">45</span>, <span class="hljs-string">'SZ'</span>),
(<span class="hljs-number">1005</span>, <span class="hljs-string">'2025-12-15'</span>, <span class="hljs-string">'login'</span>, <span class="hljs-number">100</span>, <span class="hljs-string">'BJ'</span>);
</code></pre>
<p>â€</p>
<h2 data-id="heading-40">å®ä¾‹3ï¼šåŸºæœ¬æŸ¥è¯¢</h2>
<pre><code class="hljs language-vbnet" lang="vbnet">-- æŸ¥è¯¢æœ€è¿‘<span class="hljs-number">7</span>å¤©æ´»è·ƒç”¨æˆ·
<span class="hljs-keyword">SELECT</span> 
    event_date,
    countDistinct(user_id) <span class="hljs-keyword">as</span> active_users
<span class="hljs-keyword">FROM</span> analytics.user_log
<span class="hljs-keyword">WHERE</span> event_date &gt;= today() - <span class="hljs-number">7</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> event_date
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> event_date;

-- åˆ†æç”¨æˆ·è¡Œä¸ºè·¯å¾„
<span class="hljs-keyword">SELECT</span> 
    action,
    count() <span class="hljs-keyword">as</span> action_count,
    avg(duration) <span class="hljs-keyword">as</span> avg_duration
<span class="hljs-keyword">FROM</span> analytics.user_log
<span class="hljs-keyword">WHERE</span> event_date = <span class="hljs-comment">'2025-12-15'</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> action
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> action_count DESC
LIMIT <span class="hljs-number">10</span>;

-- ä½¿ç”¨ç‰©åŒ–è§†å›¾åŠ é€ŸæŸ¥è¯¢
CREATE MATERIALIZED VIEW analytics.user_daily_stats
ENGINE = SummingMergeTree()
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> (event_date, region)
<span class="hljs-keyword">AS</span> <span class="hljs-keyword">SELECT</span>
    event_date,
    region,
    count() <span class="hljs-keyword">as</span> total_events,
    sum(duration) <span class="hljs-keyword">as</span> total_duration
<span class="hljs-keyword">FROM</span> analytics.user_log
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> event_date, region;

-- æŸ¥è¯¢ç‰©åŒ–è§†å›¾
<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> analytics.user_daily_stats
<span class="hljs-keyword">WHERE</span> event_date = <span class="hljs-comment">'2025-12-15';</span>
</code></pre>
<p>â€</p>
<h2 data-id="heading-41">å®ä¾‹4ï¼šJavaåº”ç”¨é›†æˆ</h2>
<pre><code class="hljs language-ini" lang="ini">// ä½¿ç”¨JDBCè¿æ¥æ± 
String <span class="hljs-attr">jdbcUrl</span> = <span class="hljs-string">"jdbc:clickhouse://localhost:8123/analytics"</span><span class="hljs-comment">;</span>
ClickHouseDataSource <span class="hljs-attr">dataSource</span> = new ClickHouseDataSource(jdbcUrl)<span class="hljs-comment">;</span>

// æ‰¹é‡æ’å…¥ä¼˜åŒ–
try (Connection <span class="hljs-attr">conn</span> = dataSource.getConnection()) {
    PreparedStatement <span class="hljs-attr">stmt</span> = conn.prepareStatement(
        "INSERT INTO user_log SELECT * FROM input('user_id UInt32, event_date Date, action String, duration UInt32, region String')"
    )<span class="hljs-comment">;</span>
  
    // è®¾ç½®æ‰¹é‡æ•°æ®
    stmt.setObject(1, new ClickHouseWriter() {
        @Override
        public void write(ClickHouseOutputStream stream) throws IOException {
            for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; 10000; i++) {</span>
                // å†™å…¥äºŒè¿›åˆ¶æ•°æ®ï¼ˆRowBinaryæ ¼å¼ï¼‰
                stream.writeInt32(i)<span class="hljs-comment">;</span>
                stream.writeDate(LocalDate.now())<span class="hljs-comment">;</span>
                stream.writeString("action" + i)<span class="hljs-comment">;</span>
                stream.writeInt32(100 + i % 1000)<span class="hljs-comment">;</span>
                stream.writeString("Region" + i % 10)<span class="hljs-comment">;</span>
            }
        }
    })<span class="hljs-comment">;</span>
  
    stmt.executeUpdate()<span class="hljs-comment">;</span>
}
</code></pre>
<p>â€</p>
<h2 data-id="heading-42">å®ä¾‹5ï¼šæ€§èƒ½åˆ†æ</h2>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æŸ¥çœ‹è¡¨å¤§å°å’Œå‹ç¼©ç‡</span>
<span class="hljs-keyword">SELECT</span> 
    <span class="hljs-keyword">table</span>,
    formatReadableSize(<span class="hljs-built_in">sum</span>(data_compressed_bytes)) <span class="hljs-keyword">AS</span> compressed,
    formatReadableSize(<span class="hljs-built_in">sum</span>(data_uncompressed_bytes)) <span class="hljs-keyword">AS</span> uncompressed,
    round(<span class="hljs-built_in">sum</span>(data_compressed_bytes) <span class="hljs-operator">/</span> <span class="hljs-built_in">sum</span>(data_uncompressed_bytes), <span class="hljs-number">2</span>) <span class="hljs-keyword">AS</span> ratio
<span class="hljs-keyword">FROM</span> system.columns
<span class="hljs-keyword">WHERE</span> database <span class="hljs-operator">=</span> <span class="hljs-string">'analytics'</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">table</span>;

<span class="hljs-comment">-- æŸ¥çœ‹æŸ¥è¯¢æ€§èƒ½</span>
<span class="hljs-keyword">SELECT</span> 
    query,
    query_duration_ms,
    read_rows,
    memory_usage
<span class="hljs-keyword">FROM</span> system.query_log
<span class="hljs-keyword">WHERE</span> event_time <span class="hljs-operator">&gt;=</span> now() <span class="hljs-operator">-</span> <span class="hljs-type">INTERVAL</span> <span class="hljs-number">1</span> <span class="hljs-keyword">HOUR</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> query_duration_ms <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">10</span>;
</code></pre>
<p>â€</p>
<h2 data-id="heading-43">ç»“æŸè¯­</h2>
<p>ClickHouseä½œä¸ºä¸€æ¬¾ä¸“ä¸ºOLAPè€Œç”Ÿçš„åˆ—å¼æ•°æ®åº“ï¼Œå‡­å€Ÿå…¶æè‡´çš„æ€§èƒ½å’Œçµæ´»çš„æ¶æ„ï¼Œå·²ç»æˆä¸ºæ•°æ®åˆ†æé¢†åŸŸçš„é‡è¦åŸºçŸ³ã€‚æ— è®ºæ˜¯å®æ—¶æŠ¥è¡¨ã€ç”¨æˆ·è¡Œä¸ºåˆ†æè¿˜æ˜¯æ—¥å¿—ç›‘æ§ï¼ŒClickHouseéƒ½èƒ½æä¾›äºšç§’çº§çš„æŸ¥è¯¢å“åº”ã€‚</p>
<p>å¦‚æœä½ æƒ³æ·±å…¥äº†è§£æ›´å¤šæ•°æ®åº“æŠ€æœ¯ã€å¤§æ•°æ®æ¶æ„å’Œæ€§èƒ½ä¼˜åŒ–çš„å®æˆ˜ç»éªŒï¼Œæ¬¢è¿å…³æ³¨æˆ‘ä»¬çš„å…¬ä¼—å·Â  <strong>"æŠ€æµ·æ‹¾è´"</strong> Â ï¼Œåœ¨é‚£é‡Œæˆ‘ä»¬å°†æŒç»­åˆ†äº«ï¼š</p>
<ul>
<li>ClickHouseç”Ÿäº§ç¯å¢ƒè°ƒä¼˜å®æˆ˜</li>
<li>åˆ†å¸ƒå¼æ•°æ®åº“æ¶æ„è®¾è®¡</li>
<li>å¤§æ•°æ®æŠ€æœ¯æ ˆæ·±åº¦è§£æ</li>
<li>ä¸€çº¿å¤§å‚æŠ€æœ¯å®è·µæ¡ˆä¾‹</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ¢ç´¢å…³äºSpec å’ŒSkills çš„ä¸€äº›å®æˆ˜è¿ç”¨-Kiroç¯‡]]></title>    <link>https://juejin.cn/post/7603958579181092864</link>    <guid>https://juejin.cn/post/7603958579181092864</guid>    <pubDate>2026-02-09T07:18:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603958579181092864" data-draft-id="7603958579181043712" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ¢ç´¢å…³äºSpec å’ŒSkills çš„ä¸€äº›å®æˆ˜è¿ç”¨-Kiroç¯‡"/> <meta itemprop="keywords" content="å‰ç«¯,ä»£ç è§„èŒƒ,AIGC"/> <meta itemprop="datePublished" content="2026-02-09T07:18:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç–æœˆæ™´ç©º"/> <meta itemprop="url" content="https://juejin.cn/user/4089838985022968"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ¢ç´¢å…³äºSpec å’ŒSkills çš„ä¸€äº›å®æˆ˜è¿ç”¨-Kiroç¯‡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4089838985022968/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç–æœˆæ™´ç©º
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T07:18:06.000Z" title="Mon Feb 09 2026 07:18:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»21åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>å‰ä¸¤å¤©åˆ·æ˜é‡‘ï¼Œçœ‹åˆ°ä¸€ç¯‡åä¸ºï¼š <a href="https://juejin.cn/post/7589466706377965604?searchId=202602040940541C1819DF56DC68AD34AE" target="_blank" title="https://juejin.cn/post/7589466706377965604?searchId=202602040940541C1819DF56DC68AD34AE">2025 Vibe Coding å…ƒå¹´ï¼šAI ç¼–ç¨‹çš„æŠ€æœ¯çªç ´å…¨æ™¯</a> çš„æ–‡ç« ï¼Œè¿™ç¯‡æ–‡ç« ä¸ä»…è¯¦ç»†å‰–æäº†è¿‘æ¥ç¼–ç¨‹é¢†åŸŸå¯èƒ½çš„å‘å±•è¶‹åŠ¿ï¼Œè¿˜æ„å¤–åœ°è®©æˆ‘æ¥è§¦åˆ°äº†ä¸¤ä¸ªæ–°çš„æ¦‚å¿µï¼š<code>Specï¼ˆè§„èŒƒï¼‰å’ŒSkillsï¼ˆæŠ€èƒ½ï¼‰</code>ã€‚åœ¨<code>AI</code>é£é€Ÿå‘å±•çš„ä»Šå¤©ï¼Œè¿™ä¸¤ä¸ªæ¦‚å¿µçš„å¼•å…¥æ˜¾å¾—å°¤ä¸ºé‡è¦ï¼Œå®ƒä»¬ä¸ä»…é¢„ç¤ºç€ç¼–ç¨‹è§„èŒƒçš„è¿›ä¸€æ­¥æ ‡å‡†åŒ–ï¼Œä¹Ÿä¸ºæŠ€èƒ½æå‡æä¾›äº†å…¨æ–°çš„è·¯å¾„ã€‚ä¸ºäº†è¿›ä¸€æ­¥ç†è§£è¿™ä¸¤ä¸ªæ¦‚å¿µçš„å®é™…åº”ç”¨ï¼Œæˆ‘åŠ¨æ‰‹è¿›è¡Œäº†å®è·µæ“ä½œï¼Œä¸‹é¢å°±æ˜¯æˆ‘å¯¹è¿™æ¬¡æ¢ç´¢çš„æ€»ç»“ä¸æ€è€ƒã€‚</p>
</blockquote>
<h2 data-id="heading-0">æˆ–è®¸æˆ‘ä»¬å¯ä»¥å®ç°ï¼šèµ‹èƒ½ <code>20%</code>çš„çš„é‡è¦ç¯èŠ‚ï¼Œæå‡æ•´ä½“ <code>80%</code>çš„æ•ˆèƒ½ï¼Ÿï¼Ÿï¼Ÿ</h2>
<h2 data-id="heading-1">ä¸€ã€ä½ åœ¨ç”¨ä»€ä¹ˆç¼–è¾‘å™¨ï¼Ÿ</h2>
<blockquote>
<p>æˆ‘çš„<code>AI</code>ç¼–è¾‘å™¨åœ¨ä»Šå¹´ä¸€å¹´å†…å°±æ¢äº†ä¸‰ä¸ªï¼Œæœ€å¼€å§‹æ˜¯<code>VScode</code>ï¼Œ ç„¶åæ˜¯ <code>Trae</code>ï¼Œç°åœ¨ä½¿ç”¨çš„æ˜¯<code>Kiro</code>ï¼Œè¿™ä¸€ä¸ªæœˆä½¿ç”¨ä¸‹æ¥ï¼Œè¿˜æ˜¯è›®é¡ºæ»‘çš„ï¼Œæ¨è ğŸ‘ã€‚</p>
</blockquote>
<p><img src="https://p9-juejin-sign.byteimg.com/tos-cn-i-k3u1fbpfcp/183be39e97f241f4a7a8861c66a770b2~tplv-k3u1fbpfcp-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546W5pyI5pm056m6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771226286&amp;x-signature=agBMNZtcAFcdlyEAbAL5mcndNUk%3D" alt="æœ€å¼€å§‹æ˜¯ç„¶.png" loading="lazy"/></p>
<p><strong>ä½œä¸º<code>claude</code>æ¨¡å‹çš„é‡‘ä¸»ï¼Œäºšé©¬é€Šçš„ <code>kiro</code>æ‹¥æœ‰<code>claude </code>çš„æœ€æ–°æ¨¡å‹:</strong></p>
<blockquote>
<p>æœ‰èµ„æ–™æ˜¾ç¤ºï¼šæˆªè‡³2026å¹´1æœˆï¼Œäºšé©¬é€Šå·²å‘<code>Anthropic</code>ï¼ˆå¼€å‘ <code>Claude</code> äººå·¥æ™ºèƒ½æ¨¡å‹çš„å…¬å¸ï¼‰ç´¯è®¡æŠ•èµ„<strong>80äº¿ç¾å…ƒ</strong>ï¼ˆ2023å¹´9æœˆé¦–æŠ•12.5äº¿ï¼Œ2024å¹´3æœˆè¿½åŠ 27.5äº¿ï¼Œ2024å¹´11æœˆå†æŠ•40äº¿ï¼‰</p>
</blockquote>
<p><img src="https://p9-juejin-sign.byteimg.com/tos-cn-i-k3u1fbpfcp/71d84c45fdbe42f9867148633e24add8~tplv-k3u1fbpfcp-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546W5pyI5pm056m6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771226286&amp;x-signature=tQldnN2jKJRssRCK4QqedOiFHJs%3D" alt="æˆªå±2026-02-04 16.49.07.png" loading="lazy"/></p>
<p>ä¸‹é¢çš„ç¤ºä¾‹éƒ½æ˜¯åŸºäºè¿™ä¸ª<code>Kiro ç¼–è¾‘å™¨</code>ï¼Œå½“ç„¶å…¶ä»–ç¼–è¾‘å™¨ä¹Ÿæœ‰ç±»ä¼¼çš„åŠŸèƒ½ï¼Œå°±éœ€è¦è‡ªè¡Œæ¢ç´¢äº†ï¼Œå·¥å…·æœ¬èº«å°±æ˜¯æœåŠ¡äºæˆ‘ä»¬çš„å·¥ä½œï¼Œä½¿ç”¨ä»€ä¹ˆå·¥å…·æ›´é¡ºæ‰‹å°±ç”¨å“ªä¸ªå–½ï¼</p>
<hr/>
<h2 data-id="heading-2">äºŒã€å…ˆæ¥äº†è§£å‡ ä¸ªå¸¸ç”¨çš„æ¦‚å¿µ</h2>
<h3 data-id="heading-3"><strong><code>Spec</code>å’Œ <code>Skills</code> çš„å…³ç³»</strong></h3>
<p><img src="https://p9-juejin-sign.byteimg.com/tos-cn-i-k3u1fbpfcp/d07731146022443cb822e20ce73489cf~tplv-k3u1fbpfcp-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546W5pyI5pm056m6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771226286&amp;x-signature=YUER3m%2By%2BgiievQRxPCytfmoAbA%3D" alt="ä½ç½®å›¾ç‰‡å·¦.png" loading="lazy"/></p>
<h3 data-id="heading-4">1. <code>Spec</code>â€Œæ ‡å‡†æ€§èƒ½è¯„ä¼°ç»„ç»‡ï¼Œè´Ÿè´£è§£é‡Šï¼š åšä»€ä¹ˆäº‹ï¼Ÿ</h3>
<p>â€Œ<strong>æ ¸å¿ƒç†å¿µâ€Œ</strong>ï¼šé‡‡ç”¨â€œå…ˆè®¡åˆ’ï¼Œåæ‰§è¡Œâ€çš„æµç¨‹ï¼Œè¦æ±‚AIåœ¨ç¼–å†™ä»£ç å‰ï¼Œå…ˆå°†ä»»åŠ¡ç†è§£ã€æŠ€æœ¯æ–¹æ¡ˆå’Œè¯¦ç»†æ‹†è§£å½¢æˆç»“æ„åŒ–æ–‡æ¡£ï¼ˆ<code>Docå’ŒTasks</code>ï¼‰ï¼Œç»äººå·¥ç¡®è®¤åå†ç”Ÿæˆä»£ç ã€‚ â€Œ</p>
<p><strong>ä¸»è¦ä½œç”¨â€Œ</strong>ï¼šå°†ä¼ ç»Ÿâ€œé»‘ç›’ç›´å‡ºâ€çš„ç¼–ç æ¨¡å¼å˜ä¸ºâ€œç™½ç›’åŒ–â€é˜¶æ®µæµç¨‹ï¼Œé€šè¿‡å¼•å…¥â€œéœ€ç¡®è®¤â€çš„ç¼“å†²é˜¶æ®µï¼Œå¤§å¹…å‡å°‘å› ç†è§£åå·®å¯¼è‡´çš„æ— æ•ˆå·¥ä½œå’Œè¿”å·¥ï¼Œæå‡ä»£ç ç”Ÿæˆçš„å‡†ç¡®æ€§ã€‚ â€Œ</p>
<p><strong>é€‚ç”¨åœºæ™¯â€Œ</strong>ï¼šé€‚ç”¨äºä»0åˆ°1çš„å¼€å‘ã€æŠ€æœ¯æ–¹æ¡ˆåŸå‹äº§å‡ºã€å›¢é˜Ÿå†…éƒ¨è·¨è§’è‰²ï¼ˆå¦‚äº§å“ã€å‰åç«¯ï¼‰æ²Ÿé€šåä½œç­‰åœºæ™¯ã€‚</p>
<p><strong><code>å°±åƒé¡¹ç›®éœ€æ±‚æ–‡æ¡£ã€ä»»åŠ¡æ¸…å•ï¼Œå¤§ç™½è¯è®²ï¼šå°±æ˜¯ä½ ç»™æˆ‘ä¸€ä¸ªæ–‡ä»¶ï¼Œå‘Šè¯‰æˆ‘è¿™ä¸ªé¡¹ç›®æ€ä¹ˆåš</code></strong></p>
<p><img src="https://p9-juejin-sign.byteimg.com/tos-cn-i-k3u1fbpfcp/6de447b9cdbd4827b825c32aeffa5aa1~tplv-k3u1fbpfcp-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546W5pyI5pm056m6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771226286&amp;x-signature=J6FmefurijxSZNadGi7nz%2FA7sak%3D" alt="20260205-105320.jpeg" loading="lazy"/></p>
<h3 data-id="heading-5">2. <code>Skills</code> ä¸­æ–‡è§£é‡Šâ€œæŠ€èƒ½â€ï¼Œå°±æ˜¯æ•™æˆ‘"æ€ä¹ˆåšäº‹"çš„è§„åˆ™æ‰‹å†Œã€‚</h3>
<blockquote>
<p>å°±åƒæˆ‘æ¯æ¬¡å’Œ<code>AI</code>å¯¹è¯æ—¶ï¼Œæ€»æœ‰ä¸€äº›ç‰¹å®šçš„è§„åˆ™å‰æï¼Œä¸åŒçš„è§„åˆ™å¯¹åº”ä¸åŒçš„<code>prompt</code>ï¼Œæ ¹æ®å…³é”®è¯æ¥è§¦å‘æˆ‘ä½¿ç”¨å“ªä¸ªå†…ç½®çš„<code>prompt</code>ï¼Œä¹Ÿå¯ä»¥è®¾ç½®æ¯æ¬¡å¯¹è¯éƒ½å¼•å…¥ï¼Œæ¯”å¦‚ä¸‹å›¾ï¼š</p>
</blockquote>
<p><img src="https://p9-juejin-sign.byteimg.com/tos-cn-i-k3u1fbpfcp/ee0e0a1a4a974f79a66d72b744518f10~tplv-k3u1fbpfcp-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546W5pyI5pm056m6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771226286&amp;x-signature=4UFnXd8xtHO2ENkNpcH4S048RUA%3D" alt="å°±åƒä½ æ•™ä¸€.png" loading="lazy"/></p>
<h3 data-id="heading-6">3. ä¸¤è€…çš„å…³ç³»</h3>
<p>ç±»æ¯” 1: åšèœ ğŸ³</p>
<p><img src="https://p9-juejin-sign.byteimg.com/tos-cn-i-k3u1fbpfcp/b347a6ae36fc4a09baab93667aee3eaa~tplv-k3u1fbpfcp-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546W5pyI5pm056m6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771226286&amp;x-signature=Q8PY5cHFvO7wRJ4ilG3xseckn6A%3D" alt="ç±»æ¯”çš„æ­¥éª¤.png" loading="lazy"/></p>
<blockquote>
<p>å…³ç³»ï¼šç”¨çƒ¹é¥ªæŠ€å·§ï¼ˆSkillsï¼‰æ¥å®Œæˆèœè°±ï¼ˆSpecï¼‰
ä¸€ä¸ªæŠ€å·§å¯ä»¥ç”¨åœ¨å¾ˆå¤šèœè°±ä¸Šï¼Œä¸€ä¸ªèœè°±éœ€è¦ç”¨åˆ°å¤šä¸ªæŠ€å·§</p>
</blockquote>
<p>ç±»æ¯” 2: ç›–æˆ¿å­ ğŸ—ï¸</p>
<p><img src="https://p9-juejin-sign.byteimg.com/tos-cn-i-k3u1fbpfcp/497306bf31574fe29c00fe52f7c95c3b~tplv-k3u1fbpfcp-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546W5pyI5pm056m6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771226286&amp;x-signature=kGOyfIb7iWYmQkiI%2B8A%2BDmgoJbg%3D" alt="ç±»æ¯”çš„æ­¥éª¤ (1).png" loading="lazy"/></p>
<blockquote>
<p>å…³ç³»ï¼š
æŒ‰ç…§æ–½å·¥è§„èŒƒï¼ˆ<code>Skills</code>ï¼‰æ¥å®ç°å»ºç­‘å›¾çº¸ï¼ˆ<code>Spec</code>ï¼‰
è§„èŒƒæ˜¯é€šç”¨çš„ï¼Œå¯ä»¥ç›–å¾ˆå¤šæˆ¿å­
å›¾çº¸æ˜¯å…·ä½“çš„ï¼Œåªé’ˆå¯¹è¿™ä¸€æ ‹æˆ¿å­</p>
</blockquote>
<hr/>
<h3 data-id="heading-7">4. å®é™…çš„å·¥ä½œæµç¨‹-ç†è®º</h3>
<p><strong>å‡è®¾åœºæ™¯ï¼šæˆ‘ä»¬è¦å¼€å‘å­—æ¯æ‹¼å†™æ¸¸æˆ</strong></p>
<p><strong>1. ä½ æœ‰ä¸€ä¸ª Specï¼ˆéœ€æ±‚æ–‡æ¡£ï¼‰ğŸ“‹ "åˆ›å»ºå­—æ¯æ‹¼å†™æ¸¸æˆ"</strong></p>
<ul>
<li>éœ€è¦æ¸¸æˆç»„ä»¶</li>
<li>éœ€è¦æ¸¸æˆæ¥å£</li>
<li>éœ€è¦çŠ¶æ€ç®¡ç†</li>
</ul>
<p><strong>2. æˆ‘ä½¿ç”¨ Skillsï¼ˆè§„åˆ™ï¼‰æ¥å®ç°</strong></p>
<p><strong>åˆ›å»ºç»„ä»¶æ—¶ â†’ åº”ç”¨ "React ç»„ä»¶ç”Ÿæˆ Skill"</strong></p>
<p>âœ… æŒ‰è§„èŒƒåˆ›å»ºæ–‡ä»¶ç»“æ„</p>
<p>âœ… æŒ‰æ¨¡æ¿ç”Ÿæˆä»£ç </p>
<p>âœ… éµå¾ªå‘½åè§„èŒƒ</p>
<p><strong>æ·»åŠ æ¥å£æ—¶ â†’ åº”ç”¨ "API æ¥å£ç”Ÿæˆ Skill"</strong></p>
<p>âœ… æ£€æŸ¥æ˜¯å¦é‡å¤</p>
<p>âœ… æ·»åŠ ç±»å‹å®šä¹‰</p>
<p>âœ… æ·»åŠ å®Œæ•´æ³¨é‡Š</p>
<p><strong>å®Œæˆå â†’ åº”ç”¨ "ä»£ç æ£€æŸ¥ Skill"</strong></p>
<p>âœ… æ£€æŸ¥é€»è¾‘é—®é¢˜</p>
<p>âœ… æ£€æŸ¥æ€§èƒ½é—®é¢˜</p>
<p>âœ… æ£€æŸ¥æ˜¯å¦æœ‰é‡å¤ä»£ç </p>
<p><strong>3. å®Œæˆ Specâœ… å­—æ¯æ‹¼å†™æ¸¸æˆå¼€å‘å®Œæˆ ğŸ“Š å¯¹æ¯”è¡¨æ ¼</strong></p>


















































<table><thead><tr><th>ç»´åº¦</th><th>Skillsï¼ˆæŠ€èƒ½ï¼‰</th><th>Specï¼ˆè§„æ ¼ï¼‰</th></tr></thead><tbody><tr><td>æ˜¯ä»€ä¹ˆ</td><td>åšäº‹çš„æ–¹æ³•</td><td>è¦åšçš„äº‹æƒ…</td></tr><tr><td>ä½œç”¨</td><td>æ•™æˆ‘æ€ä¹ˆåš</td><td>å‘Šè¯‰æˆ‘åšä»€ä¹ˆ</td></tr><tr><td>èŒƒå›´</td><td>é€šç”¨çš„</td><td>å…·ä½“çš„</td></tr><tr><td>æ—¶æ•ˆ</td><td>é•¿æœŸæœ‰æ•ˆ</td><td>ä¸€æ¬¡æ€§çš„</td></tr><tr><td>æ•°é‡</td><td>å°‘é‡ï¼ˆ3-10ä¸ªï¼‰</td><td>å¾ˆå¤šï¼ˆæ¯ä¸ªåŠŸèƒ½ä¸€ä¸ªï¼‰</td></tr><tr><td>ä½ç½®</td><td>.kiro/steering/</td><td>.kiro/specs/</td></tr><tr><td>ä¾‹å­</td><td>"ç»„ä»¶åˆ›å»ºè§„èŒƒ"</td><td>"åˆ›å»ºç™»å½•é¡µé¢"</td></tr><tr><td>å¤ç”¨</td><td>å¯ä»¥å¤ç”¨åˆ°å…¶ä»–é¡¹ç›®</td><td>åªé’ˆå¯¹å½“å‰åŠŸèƒ½</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-8">ä¸‰ã€ä¸‹é¢å°±è®©æˆ‘ä»¬ç”¨å®é™…çš„<code>AIç¼–è¾‘å™¨</code>æ¥è¯•è¯•ä¸Šé¢èƒ½åŠ›-å®è·µï¼š</h2>
<blockquote>
<p>åœ¨ä¸Šé¢æˆ‘ä»¬è®¨è®ºäº†ä»–ä»¬ä¹‹é—´çš„å…³ç³»ï¼Œå¹¶ä½¿ç”¨ç¤ºä¾‹å›¾çš„å½¢å¼å±•ç°å‡ºæ¥ï¼Œä¸‹é¢å°±æ˜¯å…·ä½“çš„å®è·µç¤ºä¾‹ã€‚</p>
</blockquote>
<p><strong>é¦–å…ˆæ˜¯-çœæµæœ€å°ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash">.kiro/steering/
  â”œâ”€â”€ react-component-generator.md  â† <span class="hljs-string">"æ€ä¹ˆåˆ›å»ºç»„ä»¶"</span>
  â”œâ”€â”€ api-service-generator.md      â† <span class="hljs-string">"æ€ä¹ˆæ·»åŠ æ¥å£"</span>
  â””â”€â”€ code-review.md                â† <span class="hljs-string">"æ€ä¹ˆæ£€æŸ¥ä»£ç "</span>
Spec çš„ä¾‹å­ï¼ˆå…·ä½“éœ€æ±‚ï¼‰
.kiro/specs/
  â””â”€â”€ letter-spelling-game/
      â””â”€â”€ requirements.md           â† <span class="hljs-string">"åšä¸€ä¸ªå­—æ¯æ‹¼å†™æ¸¸æˆ"</span>   
</code></pre>
<hr/>
<p><strong>æ¥ä¸‹æ¥æ˜¯ä½¿ç”¨<code>Kiro</code>çš„å…·ä½“æ“ä½œæ¼”ç¤ºæ­¥éª¤ï¼š</strong></p>
<h3 data-id="heading-9">1. å…ˆæ¥çœ‹ <code>Spec</code></h3>
<h4 data-id="heading-10">ï¼ˆ1ï¼‰å‘é€æŒ‡ä»¤å‰ï¼Œå…ˆé€‰æ‹©<code>Spec</code>æ¨¡å¼ï¼š</h4>
<p><img src="https://p9-juejin-sign.byteimg.com/tos-cn-i-k3u1fbpfcp/6ccda9283c624484ba82efe59fe2a05b~tplv-k3u1fbpfcp-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546W5pyI5pm056m6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771226286&amp;x-signature=lT54zS%2FRCF%2BaqEwmpB1PxUa32Do%3D" alt="æˆªå±2026-02-04 17.08.35.png" loading="lazy"/></p>
<h4 data-id="heading-11">ï¼ˆ2ï¼‰æå‡ºæˆ‘çš„éœ€æ±‚</h4>
<blockquote>
<p><code>prompt</code>: æˆ‘æƒ³åˆ›å»ºä¸€ä¸ªè¯¾å ‚äº’åŠ¨å°æ¸¸æˆï¼Œæ ¹æ®å­—æ¯æ‹¼å•è¯ï¼Œå¸®æˆ‘å®ç°ã€‚</p>
</blockquote>
<p><img src="https://p9-juejin-sign.byteimg.com/tos-cn-i-k3u1fbpfcp/093fd4f626ae43aeaa8fc7dfa0c953ad~tplv-k3u1fbpfcp-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546W5pyI5pm056m6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771226286&amp;x-signature=Z66pQWGULZrpB6jpCCiRGnnbOWo%3D" alt="æˆªå±2026-02-04 17.23.49.png" loading="lazy"/></p>
<h4 data-id="heading-12">ï¼ˆ3ï¼‰ç”Ÿæˆå…·ä½“çš„éœ€æ±‚æ–‡æ¡£</h4>
<blockquote>
<p>æäº¤æç¤ºè¯ï¼Œç”Ÿæˆå…·ä½“çš„éœ€æ±‚æ–‡æ¡£ï¼š</p>
</blockquote>
<p><img src="https://p9-juejin-sign.byteimg.com/tos-cn-i-k3u1fbpfcp/0510f6107e10460382ad7e38c50107a5~tplv-k3u1fbpfcp-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546W5pyI5pm056m6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771226286&amp;x-signature=tPdGPb2x4vTxEHCla55XlRFVICU%3D" alt="æˆªå±2026-02-04 17.25.58.png" loading="lazy"/></p>
<p><strong>ç”Ÿæˆå®Œæˆï¼š</strong></p>
<p><img src="https://p9-juejin-sign.byteimg.com/tos-cn-i-k3u1fbpfcp/5512c98331984e5fa779a4b8cc31c728~tplv-k3u1fbpfcp-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546W5pyI5pm056m6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771226286&amp;x-signature=wK37hojmP4%2F3TBzPNMt%2FmeO6dE0%3D" alt="æˆªå±2026-02-04 17.27.14.png" loading="lazy"/></p>
<p><strong>ä¸‹é¢çš„æ–‡æ¡£æˆ‘åªæˆªå–äº†å¤´éƒ¨å’Œå°¾éƒ¨çš„éƒ¨åˆ†ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±åŠ¨æ‰‹å°è¯•ä¸€ä¸‹ï¼š</strong></p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">éœ€æ±‚æ–‡æ¡£</span>
<span class="hljs-meta prompt_">
#</span><span class="bash"><span class="hljs-comment"># ç®€ä»‹</span></span>

è¯¾å ‚æ‹¼å†™æ¸¸æˆæ˜¯ä¸€ä¸ªæ•™è‚²ç±»äº’åŠ¨åº”ç”¨ï¼Œæ—¨åœ¨å¸®åŠ©å­¦ç”Ÿé€šè¿‡æ¸¸æˆåŒ–çš„æ–¹å¼å­¦ä¹ å’Œç»ƒä¹ è‹±è¯­å•è¯æ‹¼å†™ã€‚ç³»ç»Ÿä¼šæä¾›ä¸€ç»„æ‰“ä¹±é¡ºåºçš„å­—æ¯ï¼Œå­¦ç”Ÿéœ€è¦å°†è¿™äº›å­—æ¯é‡æ–°æ’åˆ—ç»„æˆæ­£ç¡®çš„å•è¯ã€‚
<span class="hljs-meta prompt_">
#</span><span class="bash"><span class="hljs-comment"># æœ¯è¯­è¡¨</span></span>

- **æ¸¸æˆç³»ç»Ÿï¼ˆGame_Systemï¼‰**: ç®¡ç†æ¸¸æˆæµç¨‹ã€é¢˜ç›®ç”Ÿæˆå’Œç­”æ¡ˆéªŒè¯çš„æ ¸å¿ƒç³»ç»Ÿ
- **é¢˜ç›®ï¼ˆQuestionï¼‰**: åŒ…å«ç›®æ ‡å•è¯å’Œæ‰“ä¹±å­—æ¯çš„æ¸¸æˆé—®é¢˜
- **å•è¯åº“ï¼ˆWord_Bankï¼‰**: å­˜å‚¨å¯ç”¨äºæ¸¸æˆçš„å•è¯é›†åˆ
- **å­¦ç”Ÿï¼ˆStudentï¼‰**: å‚ä¸æ¸¸æˆçš„ç”¨æˆ·
- **å›åˆï¼ˆRoundï¼‰**: ä¸€æ¬¡å®Œæ•´çš„ç­”é¢˜è¿‡ç¨‹ï¼Œä»æ˜¾ç¤ºé¢˜ç›®åˆ°æäº¤ç­”æ¡ˆ
- **å¾—åˆ†ç³»ç»Ÿï¼ˆScoring_Systemï¼‰**: è®¡ç®—å’Œè®°å½•å­¦ç”Ÿè¡¨ç°çš„ç³»ç»Ÿ
<span class="hljs-meta prompt_">
#</span><span class="bash"><span class="hljs-comment"># éœ€æ±‚</span></span>
<span class="hljs-meta prompt_">
#</span><span class="bash"><span class="hljs-comment">## éœ€æ±‚ 1ï¼šé¢˜ç›®ç”Ÿæˆ</span></span>

**ç”¨æˆ·æ•…äº‹ï¼š** ä½œä¸ºæ•™å¸ˆï¼Œæˆ‘å¸Œæœ›ç³»ç»Ÿèƒ½å¤Ÿè‡ªåŠ¨ç”Ÿæˆæ‹¼å†™é¢˜ç›®ï¼Œä»¥ä¾¿å­¦ç”Ÿè¿›è¡Œç»ƒä¹ ã€‚
<span class="hljs-meta prompt_">
#</span><span class="bash"><span class="hljs-comment">### éªŒæ”¶æ ‡å‡†</span></span>

1. å½“æ¸¸æˆå¼€å§‹æ—¶ï¼Œæ¸¸æˆç³»ç»Ÿåº”å½“ä»å•è¯åº“ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªå•è¯
2. å½“é€‰æ‹©å•è¯åï¼Œæ¸¸æˆç³»ç»Ÿåº”å½“å°†å•è¯çš„å­—æ¯æ‰“ä¹±é¡ºåº
3. å½“æ‰“ä¹±å­—æ¯æ—¶ï¼Œæ¸¸æˆç³»ç»Ÿåº”å½“ç¡®ä¿æ‰“ä¹±åçš„å­—æ¯é¡ºåºä¸åŸå•è¯ä¸åŒ
4. å½“ç”Ÿæˆé¢˜ç›®æ—¶ï¼Œæ¸¸æˆç³»ç»Ÿåº”å½“åŒæ—¶ä¿å­˜åŸå§‹å•è¯ä½œä¸ºæ­£ç¡®ç­”æ¡ˆ
<span class="hljs-meta prompt_">
#</span><span class="bash"><span class="hljs-comment">## éœ€æ±‚ 2ï¼šç­”æ¡ˆæäº¤ä¸éªŒè¯</span></span>

**ç”¨æˆ·æ•…äº‹ï¼š** ä½œä¸ºå­¦ç”Ÿï¼Œæˆ‘å¸Œæœ›èƒ½å¤Ÿæäº¤æˆ‘çš„ç­”æ¡ˆå¹¶ç«‹å³çŸ¥é“æ˜¯å¦æ­£ç¡®ï¼Œä»¥ä¾¿è·å¾—å³æ—¶åé¦ˆã€‚
<span class="hljs-meta prompt_">
#</span><span class="bash"><span class="hljs-comment">### éªŒæ”¶æ ‡å‡†</span></span>

1. å½“å­¦ç”Ÿè¾“å…¥ç­”æ¡ˆæ—¶ï¼Œæ¸¸æˆç³»ç»Ÿåº”å½“æ¥å—å­—æ¯è¾“å…¥
2. å½“å­¦ç”Ÿæäº¤ç­”æ¡ˆæ—¶ï¼Œæ¸¸æˆç³»ç»Ÿåº”å½“éªŒè¯ç­”æ¡ˆæ˜¯å¦ä¸æ­£ç¡®å•è¯å®Œå…¨åŒ¹é…
3. å¦‚æœç­”æ¡ˆæ­£ç¡®ï¼Œé‚£ä¹ˆæ¸¸æˆç³»ç»Ÿåº”å½“æ˜¾ç¤ºæˆåŠŸæç¤ºå¹¶å¢åŠ å¾—åˆ†
4. å¦‚æœç­”æ¡ˆé”™è¯¯ï¼Œé‚£ä¹ˆæ¸¸æˆç³»ç»Ÿåº”å½“æ˜¾ç¤ºé”™è¯¯æç¤ºå¹¶å…è®¸é‡è¯•
5. å½“éªŒè¯ç­”æ¡ˆæ—¶ï¼Œæ¸¸æˆç³»ç»Ÿåº”å½“å¿½ç•¥å¤§å°å†™å·®å¼‚
..................
..................
..................
<span class="hljs-meta prompt_">#</span><span class="bash"><span class="hljs-comment">## éœ€æ±‚ 12ï¼šå“åº”å¼è®¾è®¡</span></span>

**ç”¨æˆ·æ•…äº‹ï¼š** ä½œä¸ºæ•™å¸ˆï¼Œæˆ‘æƒ³è¦æ¸¸æˆåœ¨ä¸åŒè®¾å¤‡ä¸Šéƒ½èƒ½æ­£å¸¸æ˜¾ç¤ºï¼Œä»¥ä¾¿åœ¨å„ç§æ•™å­¦ç¯å¢ƒä¸­ä½¿ç”¨ã€‚
<span class="hljs-meta prompt_">
#</span><span class="bash"><span class="hljs-comment">### éªŒæ”¶æ ‡å‡†</span></span>

1. å½“æ¸¸æˆåœ¨å¤§å±å¹•æ˜¾ç¤ºæ—¶ï¼ˆ1920x1080æˆ–æ›´é«˜ï¼‰ï¼Œæ¸¸æˆç³»ç»Ÿåº”å½“ä¼˜åŒ–å¸ƒå±€ä»¥å……åˆ†åˆ©ç”¨å±å¹•ç©ºé—´
2. å½“æ¸¸æˆåœ¨å¹³æ¿è®¾å¤‡æ˜¾ç¤ºæ—¶ï¼Œæ¸¸æˆç³»ç»Ÿåº”å½“è°ƒæ•´å­—æ¯æŒ‰é’®å¤§å°å’Œé—´è·ä»¥é€‚åº”è§¦æ‘¸æ“ä½œ
3. å½“æ¸¸æˆåœ¨å°å±å¹•è®¾å¤‡æ˜¾ç¤ºæ—¶ï¼ˆæ‰‹æœºï¼‰ï¼Œæ¸¸æˆç³»ç»Ÿåº”å½“é‡‡ç”¨å‚ç›´å¸ƒå±€å¹¶è°ƒæ•´å­—ä½“å¤§å°
4. å½“å±å¹•æ–¹å‘æ”¹å˜æ—¶ï¼Œæ¸¸æˆç³»ç»Ÿåº”å½“åœ¨500æ¯«ç§’å†…é‡æ–°å¸ƒå±€ç•Œé¢å…ƒç´ 
5. å½“æ¸¸æˆç³»ç»Ÿæ£€æµ‹åˆ°è§¦æ‘¸è®¾å¤‡æ—¶ï¼Œæ¸¸æˆç³»ç»Ÿåº”å½“å¢å¤§å¯ç‚¹å‡»åŒºåŸŸè‡³å°‘44x44åƒç´ ä»¥ç¬¦åˆå¯è®¿é—®æ€§æ ‡å‡†

</code></pre>
<h4 data-id="heading-13">ï¼ˆ4ï¼‰æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œå¾®è°ƒ</h4>
<blockquote>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªå®Œæ•´çš„éœ€æ±‚æ–‡æ¡£ä»¥åŠå…·ä½“çš„ç”Ÿæˆè§„åˆ™å’ŒéªŒæ”¶æµç¨‹ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®è‡ªå·±çš„å…·ä½“éœ€æ±‚è¿›è¡Œè°ƒè¯•ï¼Œå‡è®¾ä½ è¿˜æœ‰å…¶ä»–çš„éœ€æ±‚ï¼Œä¹Ÿå¯ä»¥å†æ·»åŠ åˆ°æ–‡æ¡£ä¸­ï¼Œç›®çš„æ˜¯ä¸ºåç»­ç”Ÿæˆ<code>code</code> æä¾›ä¸€ä¸ªæ ‡å‡†å’Œä¾æ®ã€‚</p>
</blockquote>
<p>ç„¶åæˆ‘ä»¬å°±çœ‹åˆ°æœ‰ä¸€ä¸ªè¿™ä¸ª "Move to design phase" æ„æ€å°±æ˜¯è¿›å…¥è®¾è®¡é˜¶æ®µï¼š</p>
<p><img src="https://p9-juejin-sign.byteimg.com/tos-cn-i-k3u1fbpfcp/93cfba8b538e436da26f3b4bcdc7b2d9~tplv-k3u1fbpfcp-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546W5pyI5pm056m6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771226286&amp;x-signature=UVP4i9lF%2FxbYiLIVRoHfk6kA1EA%3D" alt="b8f72f95-4eae-43ec-831d-2ed632db2a78.png" loading="lazy"/></p>
<h4 data-id="heading-14">ï¼ˆ5ï¼‰<code>Move to design phase</code> è¿›å…¥è®¾è®¡é˜¶æ®µ</h4>
<p><strong>ç°åœ¨å®ƒå¸®æˆ‘ç”Ÿæˆäº†ä¸€ä¸ªé¡¹ç›®è®¾è®¡æ–‡æ¡£ï¼š</strong></p>
<p><img src="https://p9-juejin-sign.byteimg.com/tos-cn-i-k3u1fbpfcp/1d053aa8b7334868a5849d151ae9f763~tplv-k3u1fbpfcp-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546W5pyI5pm056m6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771226286&amp;x-signature=Q13mqYwqITTsAb4k%2FkzaUdUwha4%3D" alt="æˆªå±2026-02-04 17.38.11.png" loading="lazy"/></p>
<p><strong>è¯¦ç»†å†…å®¹å¦‚ä¸‹ï¼Œå½“ç„¶åœ¨æ­¤æ­¥éª¤ä½ ä¾ç„¶å¯ä»¥å¯¹æ–‡æ¡£è¿›è¡Œä¿®æ”¹ï¼š</strong></p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment"># è®¾è®¡æ–‡æ¡£</span>

![æˆªå±<span class="hljs-number">2026</span>-<span class="hljs-number">02</span>-<span class="hljs-number">04</span> <span class="hljs-number">17.43</span>.<span class="hljs-number">01</span>.png](https:<span class="hljs-comment">//p9-juejin-sign.byteimg.com/tos-cn-i-k3u1fbpfcp/cc90dcbae9db4d05aaaad4bae399b9cf~tplv-k3u1fbpfcp-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546W5pyI5pm056m6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771226286&amp;x-signature=9oE41Kqh%2BOwq0P%2BVKa5jwkpZ1dU%3D)</span>
<span class="hljs-comment">## æ¦‚è¿°</span>

è¯¾å ‚æ‹¼å†™æ¸¸æˆæ˜¯ä¸€ä¸ªåŸºäº Web çš„äº’åŠ¨æ•™è‚²åº”ç”¨ï¼Œé‡‡ç”¨å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„ã€‚ç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬ï¼šéšæœºç”Ÿæˆæ‹¼å†™é¢˜ç›®ã€éªŒè¯å­¦ç”Ÿç­”æ¡ˆã€ç®¡ç†å•è¯åº“ã€è·Ÿè¸ªå­¦ä¹ è¿›åº¦ã€‚è®¾è®¡å¼ºè°ƒç®€æ´æ€§ã€å¯æ‰©å±•æ€§å’Œæ•™è‚²æ•ˆæœã€‚

<span class="hljs-comment">## æ¶æ„</span>

ç³»ç»Ÿé‡‡ç”¨ä¸‰å±‚æ¶æ„ï¼š

<span class="hljs-number">1</span>. **è¡¨ç¤ºå±‚ï¼ˆPresentation Layerï¼‰**: è´Ÿè´£ç”¨æˆ·ç•Œé¢æ¸²æŸ“å’Œç”¨æˆ·äº¤äº’
<span class="hljs-number">2</span>. **ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆBusiness Logic Layerï¼‰**: å¤„ç†æ¸¸æˆé€»è¾‘ã€ç­”æ¡ˆéªŒè¯ã€å¾—åˆ†è®¡ç®—
<span class="hljs-number">3</span>. **æ•°æ®è®¿é—®å±‚ï¼ˆData Access Layerï¼‰**: ç®¡ç†å•è¯åº“å’Œç”¨æˆ·æ•°æ®çš„æŒä¹…åŒ–

<span class="hljs-comment">### æ¶æ„å›¾</span>


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      è¡¨ç¤ºå±‚ (UI Components)          â”‚
â”‚  - æ¸¸æˆç•Œé¢                          â”‚
â”‚  - å•è¯åº“ç®¡ç†ç•Œé¢                     â”‚
â”‚  - å¾—åˆ†æ˜¾ç¤º                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ä¸šåŠ¡é€»è¾‘å±‚ (Game Engine)        â”‚
â”‚  - QuestionGenerator                â”‚
â”‚  - AnswerValidator                  â”‚
â”‚  - ScoringSystem                    â”‚
â”‚  - HintProvider                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      æ•°æ®è®¿é—®å±‚ (Data Layer)         â”‚
â”‚  - WordBankRepository               â”‚
â”‚  - ScoreRepository                  â”‚
â”‚  - LocalStorage / Database          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


<span class="hljs-comment">## ç»„ä»¶å’Œæ¥å£</span>

<span class="hljs-comment">### 1. QuestionGeneratorï¼ˆé¢˜ç›®ç”Ÿæˆå™¨ï¼‰</span>

è´Ÿè´£ä»å•è¯åº“ä¸­é€‰æ‹©å•è¯å¹¶ç”Ÿæˆæ‰“ä¹±å­—æ¯çš„é¢˜ç›®ã€‚

**æ¥å£ï¼š**

```typescript
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">QuestionGenerator</span> </span>{
  <span class="hljs-comment">// æ ¹æ®éš¾åº¦çº§åˆ«ç”Ÿæˆæ–°é¢˜ç›®</span>
  <span class="hljs-title function_ invoke__">generateQuestion</span>(<span class="hljs-attr">difficulty</span>: DifficultyLevel): Question

  <span class="hljs-comment">// éªŒè¯ç”Ÿæˆçš„é¢˜ç›®æ˜¯å¦æœ‰æ•ˆ</span>
  <span class="hljs-title function_ invoke__">validateQuestion</span>(<span class="hljs-attr">question</span>: Question): <span class="hljs-keyword">boolean</span>
}


**æ ¸å¿ƒæ–¹æ³•ï¼š**

- `<span class="hljs-title function_ invoke__">selectWord</span>(<span class="hljs-attr">difficulty</span>: DifficultyLevel): <span class="hljs-keyword">string</span>` - æ ¹æ®éš¾åº¦ä»å•è¯åº“éšæœºé€‰æ‹©å•è¯
- `<span class="hljs-title function_ invoke__">shuffleLetters</span>(<span class="hljs-attr">word</span>: <span class="hljs-keyword">string</span>): <span class="hljs-keyword">string</span>` - æ‰“ä¹±å•è¯å­—æ¯é¡ºåº
- `<span class="hljs-title function_ invoke__">ensureDifferent</span>(<span class="hljs-attr">original</span>: <span class="hljs-keyword">string</span>, <span class="hljs-attr">shuffled</span>: <span class="hljs-keyword">string</span>): <span class="hljs-keyword">string</span>` - ç¡®ä¿æ‰“ä¹±åä¸åŸå•è¯ä¸åŒ

<span class="hljs-comment">### 2. AnswerValidatorï¼ˆç­”æ¡ˆéªŒè¯å™¨ï¼‰</span>

éªŒè¯å­¦ç”Ÿæäº¤çš„ç­”æ¡ˆæ˜¯å¦æ­£ç¡®ã€‚

**æ¥å£ï¼š**

```typescript
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">AnswerValidator</span> </span>{
  <span class="hljs-comment">// éªŒè¯ç­”æ¡ˆæ˜¯å¦æ­£ç¡®ï¼ˆå¿½ç•¥å¤§å°å†™ï¼‰</span>
  <span class="hljs-title function_ invoke__">validate</span>(<span class="hljs-attr">userAnswer</span>: <span class="hljs-keyword">string</span>, <span class="hljs-attr">correctAnswer</span>: <span class="hljs-keyword">string</span>): <span class="hljs-keyword">boolean</span>

  <span class="hljs-comment">// éªŒè¯è¾“å…¥æ˜¯å¦åªåŒ…å«å­—æ¯</span>
  <span class="hljs-title function_ invoke__">validateInput</span>(<span class="hljs-attr">input</span>: <span class="hljs-keyword">string</span>): <span class="hljs-keyword">boolean</span>
}
 

**æ ¸å¿ƒæ–¹æ³•ï¼š**

- `<span class="hljs-title function_ invoke__">normalize</span>(<span class="hljs-attr">text</span>: <span class="hljs-keyword">string</span>): <span class="hljs-keyword">string</span>` - æ ‡å‡†åŒ–æ–‡æœ¬ï¼ˆè½¬å°å†™ã€å»ç©ºæ ¼ï¼‰
- `<span class="hljs-title function_ invoke__">isAlphabetic</span>(<span class="hljs-attr">text</span>: <span class="hljs-keyword">string</span>): <span class="hljs-keyword">boolean</span>` - æ£€æŸ¥æ˜¯å¦åªåŒ…å«å­—æ¯

<span class="hljs-comment">### 3. ScoringSystemï¼ˆå¾—åˆ†ç³»ç»Ÿï¼‰</span>

è®¡ç®—å’Œç®¡ç†å­¦ç”Ÿå¾—åˆ†ã€‚

**æ¥å£ï¼š**

```typescript
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ScoringSystem</span> </span>{
  <span class="hljs-comment">// è®¡ç®—ç­”é¢˜å¾—åˆ†</span>
  <span class="hljs-title function_ invoke__">calculateScore</span>(<span class="hljs-attr">isCorrect</span>: <span class="hljs-keyword">boolean</span>, <span class="hljs-attr">hintsUsed</span>: number, <span class="hljs-attr">timeSpent</span>: number): number

  <span class="hljs-comment">// æ›´æ–°æ€»åˆ†</span>
  <span class="hljs-title function_ invoke__">updateTotalScore</span>(<span class="hljs-attr">score</span>: number): <span class="hljs-keyword">void</span>

  <span class="hljs-comment">// è·å–å½“å‰ç»Ÿè®¡ä¿¡æ¯</span>
  <span class="hljs-title function_ invoke__">getStatistics</span>(): GameStatistics
}
 

**å¾—åˆ†è§„åˆ™ï¼š**

- åŸºç¡€åˆ†ï¼šæ­£ç¡®ç­”æ¡ˆ <span class="hljs-number">10</span> åˆ†
- æç¤ºæƒ©ç½šï¼šæ¯ä½¿ç”¨ä¸€æ¬¡æç¤ºå‡ <span class="hljs-number">2</span> åˆ†
- æ—¶é—´å¥–åŠ±ï¼šå¿«é€Ÿç­”é¢˜ï¼ˆ&lt; <span class="hljs-number">10</span> ç§’ï¼‰é¢å¤– +<span class="hljs-number">3</span> åˆ†
- æœ€ä½åˆ†ï¼šæ¯é¢˜æœ€ä½ <span class="hljs-number">1</span> åˆ†

..........
</code></pre>
<h4 data-id="heading-15">ï¼ˆ6ï¼‰ç”Ÿæˆæµ‹è¯•ä»»åŠ¡åˆ—è¡¨</h4>
<p><img src="https://p9-juejin-sign.byteimg.com/tos-cn-i-k3u1fbpfcp/9e56275a20814a20ab262993cb66c1f5~tplv-k3u1fbpfcp-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546W5pyI5pm056m6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771226286&amp;x-signature=0e4WBogd3e0ist2e6jLmcTYO8vw%3D" alt="æˆªå±2026-02-04 17.44.28.png" loading="lazy"/></p>
<p>ç°åœ¨æœ‰ä¸¤ä¸ªé€‰é¡¹ï¼Œä¸€ä¸ªæ˜¯ä¿æŒå¯é€‰ä»»åŠ¡ï¼ˆæ›´å¿«çš„<code>MVP</code>ï¼‰ï¼Œæˆ‘é€‰æ‹©çš„æ˜¯ï¼š "å°†æ‰€æœ‰ä»»åŠ¡è®¾ä¸ºå¿…é¡»"</p>
<h4 data-id="heading-16">ï¼ˆ7ï¼‰ä»»åŠ¡å®Œæˆ</h4>
<blockquote>
<p>æ­¤æ—¶æˆ‘ä»¬éœ€è¦çš„éœ€æ±‚æ–‡æ¡£ï¼Œè®¾è®¡æ–‡æ¡£å’Œæµ‹è¯•æ–‡æ¡£éƒ½å·²ç»å…¨äº†ï¼Œé‡Œé¢å‘Šè¯‰æˆ‘ä»¬æ¥ä¸‹æ¥é¡¹ç›®å…·ä½“ç»†èŠ‚æ˜¯å•¥ï¼Œé‚£ä¹ˆåé¢æˆ‘ä»¬å°±å¯ä»¥æ‹¿ç€è¿™äº›æ–‡æ¡£å–‚ç»™æˆ‘ä»¬çš„é¡¹ç›®ï¼Œè®©ä»–å»è®¾è®¡é¡µé¢äº†ï½</p>
</blockquote>
<p><img src="https://p9-juejin-sign.byteimg.com/tos-cn-i-k3u1fbpfcp/399653342a314905876b6642ac522848~tplv-k3u1fbpfcp-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546W5pyI5pm056m6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771226286&amp;x-signature=V3M1Nb2y7h2n2ZGXv9HMVSR3dsc%3D" alt="æˆªå±2026-02-04 17.48.56.png" loading="lazy"/></p>
<hr/>
<p><strong>æ€»ç»“ï¼š</strong></p>
<p>ä»¥ä¸Šå°±æ˜¯<code>Spec</code>çš„æ•´ä¸ªæµç¨‹ï¼Œä»¥æˆ‘çš„ä½¿ç”¨æ„Ÿå—æ¥çœ‹ï¼Œè¿™ä¸ª<code>Spec</code>æ¯”è¾ƒé€‚ç”¨äºä»å¤´å¼€å§‹çš„æ–°é¡¹ç›®ï¼Œæˆ–è€…æ˜¯ä»å¤´å¼€å§‹ä¸€ä¸ªå®Œæ•´çš„æ–°éœ€æ±‚ï¼Œå¦‚æœä½ æ˜¯åªæ˜¯ä¿®ä¿®è¡¥è¡¥ï¼Œè¿˜æ˜¯å»ºè®®ä½¿ç”¨<code>Vibe</code>æ¨¡å¼ï¼Œæ›´è½»ä¾¿ï¼Œæ›´ç®€æ´ã€‚</p>
<hr/>
<h3 data-id="heading-17">2. æ¥ä¸‹æ¥æ˜¯<code>Skills</code></h3>
<h4 data-id="heading-18">ï¼ˆ1ï¼‰æ‰‹åŠ¨åˆ›å»ºå®šåˆ¶åŒ–äºè‡ªå·±é¡¹ç›®çš„<code>skill</code></h4>
<blockquote>
<p>æˆ‘è®©<code>Kiro</code>å¸®æˆ‘ç”Ÿæˆä¸€ä¸ªå…³äºæ¥å£<code>API</code>æ¥å…¥çš„ç¼–å†™è§„èŒƒ</p>
</blockquote>
<p><img src="https://p9-juejin-sign.byteimg.com/tos-cn-i-k3u1fbpfcp/8d90c7d817844ec6ae77599ceb3d7c36~tplv-k3u1fbpfcp-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546W5pyI5pm056m6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771226286&amp;x-signature=V5cwBDr2Uv3QB4d8jklW%2Bvi5dss%3D" alt="æˆªå±2026-02-06 15.24.26.png" loading="lazy"/></p>
<p><img src="https://p9-juejin-sign.byteimg.com/tos-cn-i-k3u1fbpfcp/546f35b534944a3ea10057270e792e43~tplv-k3u1fbpfcp-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546W5pyI5pm056m6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771226286&amp;x-signature=pcNe%2FqQw7ZEpPFW%2BVv%2BxGLBSj6M%3D" alt="æˆªå±2026-02-06 15.24.46.png" loading="lazy"/></p>
<p><strong>è¿™å°±æ˜¯æ ¹æ®æˆ‘å½“å‰é¡¹ç›®å…¨é¢æ‰«æåï¼Œæ ¹æ®ä»¥åçš„è§„åˆ™ç”Ÿæˆçš„ä¸€ä¸ªæ¥å¶ç¼–å†™è§„èŒƒ</strong></p>
<p><img src="https://p9-juejin-sign.byteimg.com/tos-cn-i-k3u1fbpfcp/297b68f7fa73462a9b2edd5a3763a0c3~tplv-k3u1fbpfcp-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546W5pyI5pm056m6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771226286&amp;x-signature=u2w6faX%2Fp5EEArwZr44lmChsHmA%3D" alt="æˆªå±2026-02-06 15.27.45.png" loading="lazy"/></p>
<p><strong>å¦‚æœä½ æœ‰è‡ªå·±çš„è§„åˆ™ï¼Œå¯ä»¥æ·»åŠ æ–°çš„è§„åˆ™åˆ°è¿™ä¸ªæ–‡æ¡£ä¸­ï¼š</strong></p>
<blockquote>
<p>å¦‚ä¸‹ï¼Œæˆ‘éœ€è¦æ·»åŠ å…³äºé‡å¤æ¥å£çš„æ£€æŸ¥</p>
</blockquote>
<p><img src="https://p9-juejin-sign.byteimg.com/tos-cn-i-k3u1fbpfcp/f99f44fd47f945f2ad8280edf27103fa~tplv-k3u1fbpfcp-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546W5pyI5pm056m6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771226286&amp;x-signature=sZGCFA8PqvJuOQmNFxM6cbVkGNY%3D" alt="æˆªå±2026-02-06 15.35.56.png" loading="lazy"/></p>
<p><strong>æ›´æ–°åçš„ç»“æœï¼š</strong></p>
<p><img src="https://p9-juejin-sign.byteimg.com/tos-cn-i-k3u1fbpfcp/610d56de0cfc454f8127ff603163ab41~tplv-k3u1fbpfcp-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546W5pyI5pm056m6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771226286&amp;x-signature=zxJK5LOiY7mk%2BqZDx%2FODAN1o%2FTo%3D" alt="æˆªå±2026-02-06 15.36.58.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-19">å‘èµ·æ€è€ƒï¼Ÿï¼Ÿï¼Ÿ</h2>
<p>é™¤äº†æ·»åŠ <code>AIæ¥å£è§„èŒƒæ–‡æ¡£</code>ï¼Œæˆ‘ä»¬æƒ³æƒ³å¹³å¸¸è‡ªå·±å“ªæ–¹é¢çš„å·¥ä½œæ¯”è¾ƒè€—è´¹æ—¶é—´ï¼Œå¹¶ä¸”å¤§éƒ¨åˆ†æ˜¯æœ‰ä¸€å®šè§„åˆ™ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡<code>skill</code>çš„æ–¹å¼ï¼Œä¸€æ¬¡æ€§è®©<code>AI</code>äº†è§£æˆ‘ä»¬çš„å¤æ‚çš„è¯‰æ±‚ï¼Œæ¯”å¦‚ï¼šâ€œä»£ç ä¼˜åŒ–â€ã€â€œåˆ›å»ºæ–°ç»„ä»¶â€ â€œåŸå‹è¿˜åŸâ€ éƒ½å¯ä»¥æ˜¯ä¸€å¥—å®Œæ•´çš„è§„åˆ™ï¼Œä¸”ä¹Ÿå¯ä»¥éšç€ä½¿ç”¨æ¥å®Œå–„ä½ çš„è§„åˆ™ï¼Œæ¸è¿›æ˜ç»†ï¼Œè®©ä»–æˆä¸ºä¸€ä¸ªä½ é è°±çš„å·¥ä½œä¼™ä¼´ã€‚</p>
<h3 data-id="heading-20">é™¤äº†å¯ä»¥è‡ªå·±åˆ›å»ºï¼Œç°åœ¨å¸‚åœºä¸Šä¹Ÿæœ‰å¾ˆå¤šå¼€æºçš„<code>Skills</code>ï¼Œå¯ä»¥ä¾›å¤§å®¶é€‰æ‹©ï¼š</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fai.codefather.cn%2Fskills" target="_blank" title="https://ai.codefather.cn/skills" ref="nofollow noopener noreferrer">é±¼çš®å¤§ä½¬çš„AIå¯¼èˆªç½‘ç«™çš„æ¨è Skills</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FW7-olJj_QQdyYix1XP7ZeQ" target="_blank" title="https://mp.weixin.qq.com/s/W7-olJj_QQdyYix1XP7ZeQ" ref="nofollow noopener noreferrer">è¿™ 6 ä¸ªè¶…ç¥çš„ SKillsï¼Œåœ¨ GitHub ä¸Šæ€ç–¯äº†</a></p>
<p>é™¤äº†å·¥ä½œéœ€è¦ï¼Œä¾‹å¦‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªç”Ÿæˆæ—…æ¸¸æ”»ç•¥ï¼Œæˆ‘çš„è¦æ±‚å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs">æˆ‘æƒ³ç”Ÿæˆä¸€ä¸ªæ—…æ¸¸æ”»ç•¥çš„skillï¼Œæ ¹æ®æˆ‘çš„è¾“å…¥åŸå¸‚ï¼Œæ¨èè¯¥åŸå¸‚æˆ–è€…è¿™ä¸ªåŸå¸‚å‘¨è¾¹çš„5ä¸ªæ™¯ç‚¹ï¼Œæ™¯ç‚¹å¯ä»¥æ˜¯ï¼š å¤å»ºç­‘ã€ åšç‰©é¦†ã€ éç‰©è´¨æ–‡åŒ–é—äº§ ã€é—å€ ã€ è‘—åçš„4Aæ™¯ç‚¹ æˆ–è€…æ˜¯ è€è¡— ã€ æ°‘ä¿—ã€æ¼”å‡ºã€å¤§å‹æ–‡è‰ºå›­åŒºï¼ˆä¾‹å¦‚ï¼šå´æ¡¥æ‚æŠ€å¤§ä¸–ç•Œï¼‰ã€å¤§å‹çš„æƒ…æ™¯å‰§æ¼”å‡º ä»¥åŠå’Œäººæ–‡ç›¸å…³çš„ç­‰ ï¼Œ ç»™å‡ºæ™¯ç‚¹é™„è¿‘çš„åä½é›†å›¢çš„é…’åº—å‚è€ƒï¼Œç»™3ä¸ªï¼Œç»™å‡ºæ™¯ç‚¹å’Œæ™¯ç‚¹ä¹‹é—´çš„è·ç¦»ï¼Œå•ä½kmï¼Œ  æˆ‘é»˜è®¤æ˜¯ä»åŒ—äº¬è‡ªé©¾å‡ºå‘ï¼Œå¦‚æœè¡Œç¨‹è¿‡è¿œï¼ˆè¶…è¿‡600km) ,æé†’æˆ‘æ˜¯å¦è¦æ›´æ¢äº¤é€šå·¥å…·ï¼Œå¦‚æœç­›é€‰å‡ºçš„æ™¯ç‚¹ï¼Œåœ¨å½“å‰çš„æ—¶é—´å­£èŠ‚ä¸æ˜¯æœ€å¥½çš„å­£èŠ‚ï¼Œæˆ–è€…å¯èƒ½ä¸å¼€æ”¾ï¼Œä¹Ÿè¯·æç¤ºæˆ‘æ˜¯å¦æ›´æ¢æ™¯ç‚¹ï¼Œæˆ–è€…æ›´æ¢åŸå¸‚ï¼Œ
</code></pre>
<p>ç”Ÿæˆåï¼Œæˆ‘å¯ä»¥æ ¹æ®è‡ªå·±çš„æƒ³æ³•ï¼Œå†è¿›è¡Œä¿®æ”¹ï¼š</p>
<pre><code class="hljs">å¸®æˆ‘æ›´æ–°è¿™ä¸ªskill ï¼Œå¦‚æœæˆ‘æå‡ºå» æŸä¸ªåŸå¸‚æ—…æ¸¸ï¼Œè¯·æé—®æˆ‘æ—…æ¸¸çš„å¤©æ•°ï¼Œä»¥åŠæ¯å¤©æ¨èä¸€æ¬¾è¯¥åŸå¸‚çš„è‘—åå°åƒï¼Œæˆ–è€… è¿™ä¸ªåŸå¸‚çš„ä¸»æ‰“çš„å°åƒï¼Œæˆ‘åˆšåˆšæ·»åŠ äº†ä¸€äº›å¸¸ä½çš„é…’åº—ï¼Œå¸®æˆ‘ä¸€èµ·æ›´æ–°
</code></pre>
<p>ä¸‹é¢æ˜¯æˆ‘ç”Ÿæˆçš„<code>skill</code>çš„<code>.md</code>æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">inclusion:</span> <span class="hljs-string">manual</span>
<span class="hljs-meta">---
</span>
<span class="hljs-comment"># ğŸ—ºï¸ äººæ–‡æ—…æ¸¸æ”»ç•¥ç”Ÿæˆå™¨</span>

<span class="hljs-string">**è§¦å‘æ¡ä»¶ï¼šæç¤ºè¯åŒ…å«"æ—…æ¸¸"ã€"æ”»ç•¥"ã€"æ™¯ç‚¹"ã€"å‡ºè¡Œ"ã€"è‡ªé©¾"ç­‰å…³é”®è¯ï¼Œæˆ–ç›´æ¥è¾“å…¥åŸå¸‚åç§°**</span>

<span class="hljs-comment">## åŸºæœ¬è®¾å®š</span>

<span class="hljs-bullet">-</span> <span class="hljs-string">å‡ºå‘åœ°ï¼šåŒ—äº¬ï¼ˆé»˜è®¤è‡ªé©¾ï¼‰</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">å½“å‰æ—¥æœŸï¼šæ ¹æ®å®é™…æ—¥æœŸåˆ¤æ–­å­£èŠ‚</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">æ—…æ¸¸å¤©æ•°ï¼š**éœ€å…ˆè¯¢é—®ç”¨æˆ·**</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">æ™¯ç‚¹æ•°é‡ï¼šæ ¹æ®å¤©æ•°åŠ¨æ€è°ƒæ•´ï¼ˆæ¯å¤©1-2ä¸ªæ™¯ç‚¹ï¼‰</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">é…’åº—å“ç‰Œï¼šåä½é›†å›¢æ——ä¸‹ï¼ˆå…¨å­£ã€æ±‰åº­ã€æ¡”å­ã€æ°´æ™¶ã€CitiGOã€æ¼«å¿ƒã€èŠ±é—´å ‚ã€æµ·å‹ã€ç¦§ç¥ç­‰ï¼‰</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">æ¯ä¸ªæ™¯ç‚¹æ¨è3ä¸ªé™„è¿‘åä½é…’åº—</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">æ¯æ—¥å°åƒï¼šæ¯å¤©æ¨è1æ¬¾å½“åœ°è‘—åå°åƒæˆ–ä¸»æ‰“ç¾é£Ÿ</span>

<span class="hljs-comment">## æ™¯ç‚¹ç­›é€‰èŒƒå›´</span>

<span class="hljs-string">ä¼˜å…ˆæ¨èä»¥ä¸‹ç±»å‹çš„äººæ–‡æ™¯ç‚¹ï¼ˆéè‡ªç„¶é£å…‰ç±»ï¼‰ï¼š</span>

<span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-string">**å¤å»ºç­‘**ï¼šå¤åŸã€å¤é•‡ã€å¯ºåº™ã€ç¥ å ‚ã€åŸæ¥¼ã€å¤å¡”ç­‰</span>
<span class="hljs-number">2</span><span class="hljs-string">.</span> <span class="hljs-string">**åšç‰©é¦†**ï¼šçœçº§/å¸‚çº§åšç‰©é¦†ã€ä¸“é¢˜åšç‰©é¦†ã€çºªå¿µé¦†ç­‰</span>
<span class="hljs-number">3</span><span class="hljs-string">.</span> <span class="hljs-string">**éç‰©è´¨æ–‡åŒ–é—äº§**ï¼šä¼ ç»ŸæŠ€è‰ºä½“éªŒåœ°ã€éé—å±•ç¤ºé¦†ç­‰</span>
<span class="hljs-number">4</span><span class="hljs-string">.</span> <span class="hljs-string">**å†å²é—å€**ï¼šå¤æˆ˜åœºã€å¤éƒ½é—å€ã€è€ƒå¤é—å€å…¬å›­ç­‰</span>
<span class="hljs-number">5</span><span class="hljs-string">.</span> <span class="hljs-string">**4A/5Aæ™¯åŒº**ï¼šä»¥äººæ–‡ç±»ä¸ºä¸»çš„é«˜ç­‰çº§æ™¯åŒº</span>
<span class="hljs-number">6</span><span class="hljs-string">.</span> <span class="hljs-string">**è€è¡—/å¤è¡—**ï¼šå†å²æ–‡åŒ–è¡—åŒºã€ä¼ ç»Ÿå•†ä¸šè¡—ç­‰</span>
<span class="hljs-number">7</span><span class="hljs-string">.</span> <span class="hljs-string">**æ°‘ä¿—ä½“éªŒ**ï¼šæ°‘ä¿—æ‘ã€ä¼ ç»Ÿé›†å¸‚ã€åœ°æ–¹ç‰¹è‰²æ´»åŠ¨ç­‰</span>
<span class="hljs-number">8</span><span class="hljs-string">.</span> <span class="hljs-string">**æ¼”å‡º/å‰§åœº**ï¼šå¤§å‹æƒ…æ™¯å‰§æ¼”å‡ºã€å®æ™¯æ¼”å‡ºï¼ˆå¦‚ã€Šåˆè§å¹³é¥ã€‹ã€Šå°è±¡ç³»åˆ—ã€‹ï¼‰</span>
<span class="hljs-number">9</span><span class="hljs-string">.</span> <span class="hljs-string">**å¤§å‹æ–‡è‰ºå›­åŒº**ï¼šå´æ¡¥æ‚æŠ€å¤§ä¸–ç•Œã€æ¨ªåº—å½±è§†åŸç­‰ä¸»é¢˜æ–‡åŒ–å›­åŒº</span>
<span class="hljs-number">10</span><span class="hljs-string">.</span> <span class="hljs-string">**å…¶ä»–äººæ–‡æ™¯ç‚¹**ï¼šåäººæ•…å±…ã€é©å‘½çºªå¿µåœ°ã€å®—æ•™æ–‡åŒ–åœºæ‰€ç­‰</span>

<span class="hljs-comment">## è¾“å‡ºæ ¼å¼</span>

<span class="hljs-string">```markdown</span>
<span class="hljs-comment"># ğŸ—ºï¸ [åŸå¸‚å] äººæ–‡æ—…æ¸¸æ”»ç•¥</span>

<span class="hljs-string">ğŸ“</span> <span class="hljs-string">å‡ºå‘åœ°ï¼šåŒ—äº¬</span>
<span class="hljs-string">ğŸš—</span> <span class="hljs-string">äº¤é€šæ–¹å¼ï¼šè‡ªé©¾ï¼ˆæˆ–å»ºè®®æ›´æ¢çš„äº¤é€šæ–¹å¼ï¼‰</span>
<span class="hljs-string">ğŸ“…</span> <span class="hljs-string">å‡ºè¡Œæ—¥æœŸï¼š[å½“å‰æ—¥æœŸ]</span>
<span class="hljs-string">ğŸŒ¤ï¸</span> <span class="hljs-string">å½“åœ°å­£èŠ‚/å¤©æ°”æç¤ºï¼š[å­£èŠ‚ä¿¡æ¯]</span>

<span class="hljs-meta">---
</span>
<span class="hljs-comment">## âš ï¸ å‡ºè¡Œæé†’ï¼ˆå¦‚æœ‰ï¼‰</span>

<span class="hljs-string">&gt;</span> [<span class="hljs-string">è·ç¦»è¶…è¿‡600kmçš„æé†’</span>]
<span class="hljs-string">&gt;</span> [<span class="hljs-string">å­£èŠ‚/å¼€æ”¾æ—¶é—´æé†’</span>]

<span class="hljs-meta">---
</span>
<span class="hljs-comment">## ğŸ“‹ æ™¯ç‚¹æ€»è§ˆ</span>

<span class="hljs-string">|</span> <span class="hljs-string">åºå·</span> <span class="hljs-string">|</span> <span class="hljs-string">æ™¯ç‚¹åç§°</span> <span class="hljs-string">|</span> <span class="hljs-string">ç±»å‹</span> <span class="hljs-string">|</span> <span class="hljs-string">è·åŒ—äº¬(km)</span> <span class="hljs-string">|</span> <span class="hljs-string">æ™¯ç‚¹é—´è·(km)</span> <span class="hljs-string">|</span>
<span class="hljs-string">|------|---------|------|-----------|-------------|</span>
<span class="hljs-string">|</span> <span class="hljs-number">1</span> <span class="hljs-string">|</span> <span class="hljs-string">xxx</span> <span class="hljs-string">|</span> <span class="hljs-string">xxx</span> <span class="hljs-string">|</span> <span class="hljs-string">xxx</span> <span class="hljs-string">|</span> <span class="hljs-bullet">-</span> <span class="hljs-string">|</span>
<span class="hljs-string">|</span> <span class="hljs-number">2</span> <span class="hljs-string">|</span> <span class="hljs-string">xxx</span> <span class="hljs-string">|</span> <span class="hljs-string">xxx</span> <span class="hljs-string">|</span> <span class="hljs-string">xxx</span> <span class="hljs-string">|</span> <span class="hljs-string">è·æ™¯ç‚¹1:</span> <span class="hljs-string">xx</span> <span class="hljs-string">|</span>
<span class="hljs-string">|</span> <span class="hljs-number">3</span> <span class="hljs-string">|</span> <span class="hljs-string">xxx</span> <span class="hljs-string">|</span> <span class="hljs-string">xxx</span> <span class="hljs-string">|</span> <span class="hljs-string">xxx</span> <span class="hljs-string">|</span> <span class="hljs-string">è·æ™¯ç‚¹2:</span> <span class="hljs-string">xx</span> <span class="hljs-string">|</span>
<span class="hljs-string">|</span> <span class="hljs-number">4</span> <span class="hljs-string">|</span> <span class="hljs-string">xxx</span> <span class="hljs-string">|</span> <span class="hljs-string">xxx</span> <span class="hljs-string">|</span> <span class="hljs-string">xxx</span> <span class="hljs-string">|</span> <span class="hljs-string">è·æ™¯ç‚¹3:</span> <span class="hljs-string">xx</span> <span class="hljs-string">|</span>
<span class="hljs-string">|</span> <span class="hljs-number">5</span> <span class="hljs-string">|</span> <span class="hljs-string">xxx</span> <span class="hljs-string">|</span> <span class="hljs-string">xxx</span> <span class="hljs-string">|</span> <span class="hljs-string">xxx</span> <span class="hljs-string">|</span> <span class="hljs-string">è·æ™¯ç‚¹4:</span> <span class="hljs-string">xx</span> <span class="hljs-string">|</span>

<span class="hljs-meta">---
</span>
<span class="hljs-comment">## ğŸ›ï¸ æ™¯ç‚¹è¯¦æƒ…</span>

<span class="hljs-comment">### 1. [æ™¯ç‚¹åç§°]</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">**ç±»å‹**ï¼šå¤å»ºç­‘</span> <span class="hljs-string">/</span> <span class="hljs-string">åšç‰©é¦†</span> <span class="hljs-string">/</span> <span class="hljs-string">éé—</span> <span class="hljs-string">/</span> <span class="hljs-string">é—å€</span> <span class="hljs-string">/</span> <span class="hljs-string">4Aæ™¯åŒº</span> <span class="hljs-string">/</span> <span class="hljs-string">è€è¡—</span> <span class="hljs-string">/</span> <span class="hljs-string">æ°‘ä¿—</span> <span class="hljs-string">/</span> <span class="hljs-string">æ¼”å‡º</span> <span class="hljs-string">/</span> <span class="hljs-string">æ–‡è‰ºå›­åŒº</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">**åœ°å€**ï¼šxxx</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">**é—¨ç¥¨**ï¼šxxxå…ƒï¼ˆæˆ–å…è´¹ï¼‰</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">**å¼€æ”¾æ—¶é—´**ï¼šxx:xx</span> <span class="hljs-bullet">-</span> <span class="hljs-string">xx:xx</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">**æ¨èæ¸¸è§ˆæ—¶é•¿**ï¼šxå°æ—¶</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">**äº®ç‚¹**ï¼šä¸€å¥è¯æè¿°æ ¸å¿ƒçœ‹ç‚¹</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">**å­£èŠ‚æç¤º**ï¼šâš ï¸ï¼ˆå¦‚å½“å‰å­£èŠ‚ä¸é€‚å®œæˆ–å¯èƒ½ä¸å¼€æ”¾ï¼Œç»™å‡ºæç¤ºï¼‰</span>

<span class="hljs-string">**ğŸ¨</span> <span class="hljs-string">é™„è¿‘åä½é…’åº—æ¨èï¼š**</span>

<span class="hljs-string">|</span> <span class="hljs-string">é…’åº—åç§°</span> <span class="hljs-string">|</span> <span class="hljs-string">å“ç‰Œ</span> <span class="hljs-string">|</span> <span class="hljs-string">è·æ™¯ç‚¹(km)</span> <span class="hljs-string">|</span> <span class="hljs-string">å‚è€ƒä»·æ ¼</span> <span class="hljs-string">|</span>
<span class="hljs-string">|---------|------|-----------|---------|</span>
<span class="hljs-string">|</span> <span class="hljs-string">xxx</span> <span class="hljs-string">|</span> <span class="hljs-string">å…¨å­£/æ±‰åº­/æ¡”å­ç­‰</span> <span class="hljs-string">|</span> <span class="hljs-string">x.x</span> <span class="hljs-string">|</span> <span class="hljs-string">Â¥xxx/æ™š</span> <span class="hljs-string">|</span>
<span class="hljs-string">|</span> <span class="hljs-string">xxx</span> <span class="hljs-string">|</span> <span class="hljs-string">xxx</span> <span class="hljs-string">|</span> <span class="hljs-string">x.x</span> <span class="hljs-string">|</span> <span class="hljs-string">Â¥xxx/æ™š</span> <span class="hljs-string">|</span>
<span class="hljs-string">|</span> <span class="hljs-string">xxx</span> <span class="hljs-string">|</span> <span class="hljs-string">xxx</span> <span class="hljs-string">|</span> <span class="hljs-string">x.x</span> <span class="hljs-string">|</span> <span class="hljs-string">Â¥xxx/æ™š</span> <span class="hljs-string">|</span>

<span class="hljs-meta">---
</span>
<span class="hljs-string">ï¼ˆæ™¯ç‚¹2-5</span> <span class="hljs-string">åŒä¸Šæ ¼å¼ï¼‰</span>

<span class="hljs-meta">---
</span>
<span class="hljs-comment">## ğŸ›£ï¸ æ¨èè¡Œç¨‹è·¯çº¿</span>

<span class="hljs-string">**Day</span> <span class="hljs-number">1</span><span class="hljs-string">**ï¼šåŒ—äº¬å‡ºå‘</span> <span class="hljs-string">â†’</span> <span class="hljs-string">æ™¯ç‚¹1</span> <span class="hljs-string">â†’</span> <span class="hljs-string">æ™¯ç‚¹2</span>
<span class="hljs-string">ğŸ¨</span> <span class="hljs-string">ä½å®¿ï¼šxxxé…’åº—ï¼ˆå“ç‰Œ</span> <span class="hljs-string">|</span> <span class="hljs-string">Â¥xxx/æ™šï¼‰</span>
<span class="hljs-string">ğŸœ</span> <span class="hljs-string">ä»Šæ—¥å°åƒï¼š**[å°åƒåç§°]**</span> <span class="hljs-string">â€”</span> [<span class="hljs-string">ä¸€å¥è¯ä»‹ç»ï¼Œå¦‚"è¥¿å®‰å›æ°‘è¡—å¿…åƒï¼Œçš®è–„é¦…å¤§æ±¤æ±é²œ"</span>] <span class="hljs-string">|</span> <span class="hljs-string">ğŸ“</span> <span class="hljs-string">æ¨èåº—é“ºï¼š[åº—å]</span>

<span class="hljs-string">**Day</span> <span class="hljs-number">2</span><span class="hljs-string">**ï¼šæ™¯ç‚¹3</span> <span class="hljs-string">â†’</span> <span class="hljs-string">æ™¯ç‚¹4</span>
<span class="hljs-string">ğŸ¨</span> <span class="hljs-string">ä½å®¿ï¼šxxxé…’åº—ï¼ˆå“ç‰Œ</span> <span class="hljs-string">|</span> <span class="hljs-string">Â¥xxx/æ™šï¼‰</span>
<span class="hljs-string">ğŸœ</span> <span class="hljs-string">ä»Šæ—¥å°åƒï¼š**[å°åƒåç§°]**</span> <span class="hljs-string">â€”</span> [<span class="hljs-string">ä¸€å¥è¯ä»‹ç»</span>] <span class="hljs-string">|</span> <span class="hljs-string">ğŸ“</span> <span class="hljs-string">æ¨èåº—é“ºï¼š[åº—å]</span>

<span class="hljs-string">**Day</span> <span class="hljs-number">3</span><span class="hljs-string">**ï¼šæ™¯ç‚¹5</span> <span class="hljs-string">â†’</span> <span class="hljs-string">è¿”ç¨‹</span>
<span class="hljs-string">ğŸœ</span> <span class="hljs-string">ä»Šæ—¥å°åƒï¼š**[å°åƒåç§°]**</span> <span class="hljs-string">â€”</span> [<span class="hljs-string">ä¸€å¥è¯ä»‹ç»</span>] <span class="hljs-string">|</span> <span class="hljs-string">ğŸ“</span> <span class="hljs-string">æ¨èåº—é“ºï¼š[åº—å]</span>
<span class="hljs-string">...........</span>

</code></pre>
<p><strong>ç°åœ¨æˆ‘ä»¬æ¥å°è¯•ä¸€ä¸‹è¿™ä¸ªæ—…æ¸¸çš„<code>skill</code></strong>:</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e58e0dfb434d4157b100b37dd1f25256~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1263&amp;h=782&amp;s=181580&amp;e=png&amp;b=1d1d1d" alt="æˆªå±2026-02-09 14.53.33.png" loading="lazy"/></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f99dc5cedf91470b98c5d50f2fe388f1~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1237&amp;h=816&amp;s=175369&amp;e=png&amp;b=1d1d1d" alt="æˆªå±2026-02-09 14.53.45.png" loading="lazy"/></p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ede0d30cf59e486da799339f6089e0c6~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1246&amp;h=723&amp;s=237287&amp;e=png&amp;b=1e1e1e" alt="æˆªå±2026-02-09 14.53.57.png" loading="lazy"/></p>
<p>ç¡®å®è·Ÿæˆ‘è‡ªå·±æœç´¢çš„å·®ä¸å¤šï¼Œé™¤äº†æ¸…çœŸå¯ºå’Œçºªæ™“å²šæ–‡åŒ–å›­æˆ‘æ²¡æœ‰è®¡åˆ’åœ¨å†…ï¼Œå…¶ä»–å‡ ä¸ªè¿˜æ˜¯å€¼å¾—ä¸€å»çš„ï¼å†…å®¹ç¡®å®åŒ…å«äº†æˆ‘éœ€è¦çš„å…·ä½“çš„æ™¯ç‚¹ä¿¡æ¯ï¼Œé…’åº—ä¿¡æ¯ï¼Œç¾é£Ÿæ¨èä»¥åŠæ™¯ç‚¹å’Œæ™¯ç‚¹çš„ç›¸å·®å…¬é‡Œç­‰æ–¹é¢ï¼Œè¿˜ç®—ç¬¦åˆæˆ‘çš„è¦æ±‚ï¼Œåé¢å¯ä»¥å†æ ¹æ®è‡ªå·±çš„å–œå¥½è°ƒæ•´å³å¯ï¼ŒåŸºæœ¬ä¸Šæ˜¯ç›´æ¥å¯ç”¨çš„çŠ¶æ€ã€‚</p>
<hr/>
<p><strong>å›å½’ä¸»é¢˜ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹åœ¨å·¥ä½œä¸­æ€ä¹ˆé…ç½®ï¼Ÿ</strong></p>
<h3 data-id="heading-21">ä½ æƒ³è®©è¿™ä¸ª<code>skill</code>åœ¨ä»€ä¹ˆæ—¶å€™åŠ è½½ï¼Ÿ</h3>
<p><strong>1. å§‹ç»ˆåŠ è½½ï¼ˆé»˜è®¤ï¼Œæ¯æ¬¡å¯¹è¯è‡ªåŠ¨åŠ è½½ï¼Œä¸éœ€è¦å…³é”®è¯ï¼‰</strong></p>
<pre><code class="hljs language-yaml" lang="yaml">  <span class="hljs-attr">inclusion:</span> <span class="hljs-string">always</span>
</code></pre>
<p><strong>ä»€ä¹ˆæ—¶å€™ç”Ÿæ•ˆï¼Ÿ</strong></p>
<ul>
<li>ä½ åœ¨èŠå¤©æ¡†é‡Œé—® <code>AI</code> ä»»ä½•é—®é¢˜</li>
<li>ä½ è®© <code>AI</code> å¸®ä½ å†™ä»£ç ã€æ”¹ä»£ç </li>
<li>ä½ è®© <code>AI</code> è§£é‡ŠæŸæ®µä»£ç </li>
<li>Hook è§¦å‘å <code>AI</code> å¼€å§‹å·¥ä½œï¼ˆå› ä¸º <code>Hook</code> æœ¬è´¨ä¹Ÿæ˜¯ä¸€æ¬¡å¯¹è¯ï¼‰</li>
<li>ä½ ç”¨ <code>Spec</code> è®© <code>AI</code> å¸®ä½ åšåŠŸèƒ½è®¾è®¡å’Œå®ç°</li>
</ul>
<blockquote>
<p>æ¢å¥è¯è¯´ï¼Œä»»ä½•ä½ å’Œ <code>AI</code> ä¹‹é—´çš„äº¤äº’ï¼Œ<code>AI</code> éƒ½ä¼šå¸¦ç€è¿™äº›è§„åˆ™ã€‚å®ƒä¸æ˜¯ä¸€ä¸ªæ£€æŸ¥åŠ¨ä½œï¼Œè€Œæ˜¯ <code>AI</code> çš„"å¸¸è¯†å¤§è„‘ğŸ§ "ã€‚</p>
</blockquote>
<hr/>
<p><strong>2. åŒ¹é…æ–‡ä»¶æ—¶åŠ è½½</strong></p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">inclusion:</span> fileMatch
<span class="hljs-symbol">fileMatchPattern:</span> <span class="hljs-string">"src/services/**/*.ts"</span>
</code></pre>
<p><strong>ä»€ä¹ˆæ—¶å€™ç”Ÿæ•ˆï¼Ÿ</strong></p>
<blockquote>
<p>åªæœ‰å½“å¯¹è¯ä¸­æ¶‰åŠåˆ°åŒ¹é…çš„æ–‡ä»¶æ—¶ï¼ŒAI æ‰èƒ½çœ‹åˆ°ã€‚æ¯”å¦‚ä½ å¯ä»¥è®¾ç½®åªæœ‰è¯»å– services/**/*.ts æ–‡ä»¶æ—¶æ‰æ³¨å…¥ xxxxx è§„åˆ™</p>
</blockquote>
<hr/>
<p><strong>3. æ‰‹åŠ¨å¼•ç”¨æ—¶åŠ è½½ï¼ˆèŠå¤©ä¸­ç”¨ # å¼•ç”¨ï¼‰</strong></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">inclusion: manual</span>
</code></pre>
<p><strong>ä»€ä¹ˆæ—¶å€™ç”Ÿæ•ˆ?</strong></p>
<blockquote>
<p>ä½ åœ¨èŠå¤©æ¡†é‡Œç”¨ # æ‰‹åŠ¨å¼•ç”¨æ—¶æ‰æ³¨å…¥</p>
</blockquote>
<hr/>
<h3 data-id="heading-22">é‚£ä¹ˆæ­¤æ—¶åˆæœ‰ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœæˆ‘æ˜¯è‡ªå·±æ‰‹åŠ¨ä¿®æ”¹çš„<code>bug</code>ï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨<code>AI</code>ï¼Œä½†æˆ‘åˆæƒ³è®©ä»–å¸®æˆ‘æ£€æŸ¥ä¸€ä¸‹ï¼Œæˆ‘æ­¤æ—¶è¦æ€ä¹ˆåŠï¼Ÿ</h3>
<p>æç¤ºè¯å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-css" lang="css">è¯·å¸®æˆ‘<span class="hljs-selector-tag">code</span>-review å½“å‰ä»£ç  
</code></pre>
<p>æˆ–è€…ä»¥ä¸‹å‡ ç§éƒ½å¯ä»¥ï¼š</p>
<pre><code class="hljs">å¸®æˆ‘æ£€æŸ¥ä»£ç  /  å¸®æˆ‘å®¡æŸ¥ä»£ç   /  å¸®æˆ‘ä¼˜åŒ–ä»£ç 
</code></pre>
<p>è¿™æ ·<code>AI</code>ä¼šçœ‹ä½ å½“å‰æ¿€æ´»çš„ç¼–è¾‘å™¨æ–‡ä»¶ï¼ˆå°±æ˜¯ä½ æ­£åœ¨çœ‹çš„é‚£ä¸ª <code>tab</code>ï¼‰ï¼Œç„¶åç»“åˆ <code>steering</code> è§„åˆ™æ¥å®¡æŸ¥ã€‚å®ƒæ£€æŸ¥çš„æ˜¯é‚£ä¸€ä¸ªæ–‡ä»¶çš„å…¨éƒ¨å†…å®¹ï¼Œ</p>
<h3 data-id="heading-23">é‚£ä¹ˆå¦‚æœä½ åªæƒ³è®©ä»–æ£€æŸ¥æŸä¸ªæ–¹æ³•æˆ–è€…æŸä¸ªéƒ¨åˆ†ï¼Œ</h3>
<p>æç¤ºè¯è¿™æ ·è¯´ï¼š</p>
<pre><code class="hljs language-css" lang="css">å¸®æˆ‘ <span class="hljs-selector-tag">code</span>-review è¿™ä¸ªæ–‡ä»¶çš„ onMounted éƒ¨åˆ†
</code></pre>
<hr/>
<h3 data-id="heading-24">é‚£ä¹ˆæˆ‘æƒ³è®©ä»–å¸®æˆ‘ç²¾ç¡®åªæ£€æŸ¥æœ¬æ¬¡æ”¹åŠ¨çš„éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯<code>git</code>æ”¹åŠ¨çš„æ‰€æœ‰æ–‡ä»¶ï¼Œ<strong><code>ä¸”åªæ£€æŸ¥æ”¹åŠ¨çš„éƒ¨åˆ†çš„ä¸Šä¸‹æ–‡</code></strong>ï¼Œï¼ˆè™½ç„¶é—®é¢˜æ¯”è¾ƒè‹›åˆ»ï¼Œä½†æ˜¯æœ‰çœŸå®ä½¿ç”¨åœºæ™¯çš„ï¼Œå“ˆå“ˆå“ˆå“ˆğŸ˜‚ ï¼‰ï¼Œé‚£ä¹ˆæç¤ºè¯å¯ä»¥è¿™æ ·è¯´ï¼š</h3>
<pre><code class="hljs language-css" lang="css">å¸®æˆ‘ <span class="hljs-selector-tag">code</span>-reviewï¼Œç”¨ git diff æŸ¥çœ‹æœ¬æ¬¡æ”¹åŠ¨ï¼Œåªæ£€æŸ¥æˆ‘ä¿®æ”¹çš„éƒ¨åˆ†å’Œä¸Šä¸‹æ–‡ï¼Œä¸è¦åŠ¨æ²¡æ”¹çš„ä»£ç ï¼Œæœ‰é—®é¢˜ç›´æ¥ä¿®

</code></pre>
<p><strong>ç°åœ¨è¿™æ ·å†™æç¤ºè¯å¥½é•¿ï¼Œæ¯æ¬¡éƒ½è¦å†™è¿™ä¹ˆé•¿å¥½éº»çƒ¦ï¼Œé‚£ä¹ˆæˆ‘èƒ½ç‚¹ä¸ªæŒ‰é’®ï¼Œå°±å®ç°è¿™ä¸ªèƒ½åŠ›ä¸ï¼Ÿ</strong></p>
<pre><code class="hljs">ç»“è®ºæ˜¯ï¼š å½“ç„¶å¯ä»¥
</code></pre>
<p><strong>ä¸‹é¢å¼•å…¥ä¸€ä¸ªæ–°ä¸œè¥¿ï¼š<code>Hooks</code></strong></p>
<h2 data-id="heading-25">å››ã€ ä»€ä¹ˆæ˜¯<code>Hooks</code> ?</h2>
<blockquote>
<p><code>Kiro</code> çš„ <code>Hooks</code> æ˜¯ä¸€ç§è‡ªåŠ¨åŒ–æœºåˆ¶ â€” å½“<code>IDE</code> é‡Œå‘ç”Ÿç‰¹å®šäº‹ä»¶æ—¶ï¼Œè‡ªåŠ¨è§¦å‘ <code>AI</code> æ‰§è¡ŒæŸä¸ªåŠ¨ä½œã€‚ä½ å¯ä»¥æŠŠå®ƒç†è§£ä¸º"<strong><code>äº‹ä»¶ç›‘å¬å™¨</code></strong>"ã€‚</p>
</blockquote>
<h3 data-id="heading-26">1. å·¥ä½œåŸç†</h3>
<p>ä¸€ä¸ª <code>Hook</code> ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li>
<p><code>when</code>ï¼ˆè§¦å‘æ¡ä»¶ï¼‰ï¼šä»€ä¹ˆæ—¶å€™è§¦å‘ï¼Ÿæ¯”å¦‚ä½ ä¿å­˜äº†ä¸€ä¸ªæ–‡ä»¶ã€åˆ›å»ºäº†æ–°æ–‡ä»¶ã€æäº¤äº†æ¶ˆæ¯ç­‰</p>
</li>
<li>
<p><code>then</code>ï¼ˆæ‰§è¡ŒåŠ¨ä½œï¼‰ï¼šè§¦å‘ååšä»€ä¹ˆï¼Ÿæ¯”å¦‚è®© <code>AI</code> å¸®ä½ æ£€æŸ¥ä»£ç ã€æˆ–è€…è·‘ä¸€ä¸ªå‘½ä»¤</p>
</li>
</ul>
<h3 data-id="heading-27">2. æ”¯æŒçš„è§¦å‘äº‹ä»¶</h3>
<ol>
<li><code>fileEdited</code> â€” ä½ ä¿å­˜æ–‡ä»¶æ—¶è§¦å‘</li>
<li><code>fileCreated</code> â€” ä½ åˆ›å»ºæ–°æ–‡ä»¶æ—¶è§¦å‘</li>
<li><code>fileDeleted</code> â€” ä½ åˆ é™¤æ–‡ä»¶æ—¶è§¦å‘</li>
<li><code>promptSubmit</code> â€” ä½ åœ¨èŠå¤©æ¡†å‘æ¶ˆæ¯æ—¶è§¦å‘</li>
<li><code>agentStop</code> â€” <code>AI</code> æ‰§è¡Œå®Œä»»åŠ¡åè§¦å‘</li>
<li><code>userTriggered</code> â€” ä½ æ‰‹åŠ¨ç‚¹å‡»æŒ‰é’®è§¦å‘</li>
</ol>
<h3 data-id="heading-28">3. <code>hook</code>è§„åˆ™æ–‡ä»¶çš„ä½ç½®ï¼š</h3>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f1e65e395d734906a8cf539a74ab65ee~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1168&amp;h=742&amp;s=148173&amp;e=png&amp;b=212121" alt="efcfcd69-e9e6-4732-a502-7b42d9a3c761.png" loading="lazy"/></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"enabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"hookçš„åå­—"</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// å®ƒçš„åå­—</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"æè¿°"</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// è¿™é‡Œæ˜¯ä½ å¯¹äºå½“å‰hook çš„è§„åˆ™æè¿°</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"when"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"userTriggered"</span> <span class="hljs-comment">// è§¦å‘æ—¶æœºï¼šæ‰‹åŠ¨è§¦å‘</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"then"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"askAgent"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ä½ å¯ä»¥è‡ªå·±å†™ä½ çš„è§„åˆ™"</span>  <span class="hljs-comment">// è¿™é‡Œæ˜¯ä½ è§¦å‘å®ƒçš„è§„åˆ™ï¼Œæ¯”å¦‚ä½ è®©è®©ä»–æŒ‰ç…§ä»€ä¹ˆè§„åˆ™åšä»€ä¹ˆ</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>ä¸¾ä¸ªä¾‹å­</strong>ğŸŒ°ï¼š</p>
<blockquote>
<p>æ¯”å¦‚ä½ æƒ³å®ç°"æ¯æ¬¡ä¿å­˜ <code>.vue</code> æˆ– <code>.ts</code> æ–‡ä»¶æ—¶ï¼Œ<code>AI</code> è‡ªåŠ¨æŒ‰ç…§ä½ çš„ <code>code-review-checklist</code> æ£€æŸ¥ä»£ç å¹¶ä¿®å¤é—®é¢˜"ï¼Œ<code>Hook</code> é•¿è¿™æ ·ï¼š</p>
</blockquote>
<pre><code class="hljs language-json" lang="json"> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ä»£ç å®¡æŸ¥"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ä¿å­˜æ–‡ä»¶æ—¶è‡ªåŠ¨æŒ‰ç…§å®¡æŸ¥è§„èŒƒæ£€æŸ¥ä»£ç é—®é¢˜å¹¶ä¿®å¤"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"when"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"fileEdited"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"patterns"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"**/*.vue"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"**/*.ts"</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"then"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"askAgent"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"æ£€æŸ¥åˆšåˆšç¼–è¾‘çš„æ–‡ä»¶ï¼ŒæŒ‰ç…§ code-review-checklist ä¸­çš„è§„èŒƒï¼Œé‡ç‚¹æ£€æŸ¥ï¼š1. å®šæ—¶å™¨æ˜¯å¦åœ¨ onUnmounted ä¸­æ¸…é™¤ 2. å¼‚æ­¥è¯·æ±‚æ˜¯å¦æœ‰ try-catch 3. æ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼é£é™© 4. æ˜¯å¦æœ‰é˜²é‡å¤æäº¤æœºåˆ¶ã€‚å¦‚æœå‘ç°é—®é¢˜ï¼Œç›´æ¥ä¿®å¤ã€‚"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
 
</code></pre>
<h3 data-id="heading-29">4. å¦‚ä½•è§¦å‘ï¼š</h3>
<blockquote>
<p>è¿™ä¸ª <code>Hook</code> çš„æ•ˆæœå°±æ˜¯ï¼šä½ æ¯æ¬¡ä¿å­˜ <code>.vue</code> æˆ– <code>.ts</code> æ–‡ä»¶ï¼Œ<code>AI</code> ä¼šè‡ªåŠ¨è¯»å–ä½ æ”¹çš„æ–‡ä»¶ï¼ŒæŒ‰ç…§ä½ é¡¹ç›®é‡Œå·²æœ‰çš„å®¡æŸ¥è§„èŒƒæ£€æŸ¥ï¼Œå‘ç°é—®é¢˜å°±å¸®ä½ ä¿®ã€‚</p>
</blockquote>
<hr/>
<p><strong>å†ä¸¾ä¸ªä¾‹å­æ¥<code>callback</code>ä¸Šé¢çš„é—®é¢˜</strong>ğŸŒ°ï¼š</p>
<blockquote>
<p>æˆ‘æƒ³è¦çœŸæ­£å†™å®Œä¸€ä¸ªåŠŸèƒ½åï¼Œåœ¨æäº¤<code>git</code>ä»“åº“å‰å†æ£€æŸ¥ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢çš„é—®é¢˜ï¼šæˆ‘ä»¬æƒ³åœ¨å®Œæˆäº†ä¸€æ®µå·¥ä½œåï¼Œè¿›è¡Œé˜¶æ®µæ€§çš„æ£€æŸ¥ï¼Œä¸”ä¸è¦å…¨æ–‡æ£€æŸ¥ï¼Œåªé’ˆå¯¹ä¿®æ”¹éƒ¨åˆ†çš„ä¸Šä¸‹æ–‡ï¼Œä¸”å®ç°åªæ˜¯ç‚¹ç‚¹æŒ‰é’®å°±èƒ½æ£€æŸ¥ã€‚</p>
</blockquote>
<p><strong>é…ç½®è§„åˆ™å¦‚ä¸‹ï¼š</strong></p>
<pre><code class="hljs language-swift" lang="swift">{
  <span class="hljs-string">"enabled"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"ä»£ç å®¡æŸ¥ä¸ä¿®å¤"</span>,
  <span class="hljs-string">"description"</span>: <span class="hljs-string">"æ‰‹åŠ¨è§¦å‘ï¼ŒæŒ‰ç…§ code-review-checklist è§„èŒƒæ£€æŸ¥å½“å‰æ‰“å¼€çš„æ–‡ä»¶ï¼Œå‘ç°é—®é¢˜ç›´æ¥ä¿®å¤"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1"</span>,
  <span class="hljs-string">"when"</span>: {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"userTriggered"</span>
  },
  <span class="hljs-string">"then"</span>: {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"askAgent"</span>,
    <span class="hljs-string">"prompt"</span>: <span class="hljs-string">"æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>1. è¿è¡Œ `git diff` è·å–æœ¬æ¬¡æ‰€æœ‰æœªæäº¤çš„æ”¹åŠ¨<span class="hljs-subst">\n</span>2. åªå…³æ³¨æˆ‘ä¿®æ”¹çš„ä»£ç åŠå…¶ä¸Šä¸‹æ–‡ï¼ˆä¿®æ”¹è¡Œçš„å‰åç›¸å…³é€»è¾‘ï¼‰ï¼Œä¸è¦å®¡æŸ¥æ–‡ä»¶ä¸­æœªæ”¹åŠ¨çš„éƒ¨åˆ†<span class="hljs-subst">\n</span>3. å¯¹æ¯ä¸ªæ”¹åŠ¨ï¼ŒæŒ‰ç…§ code-review-checklist.md è§„èŒƒæ£€æŸ¥ï¼š<span class="hljs-subst">\n</span>   - æ–°å¢çš„ setInterval/setTimeout æ˜¯å¦æœ‰å¯¹åº”çš„æ¸…é™¤<span class="hljs-subst">\n</span>   - æ–°å¢çš„å¼‚æ­¥è¯·æ±‚æ˜¯å¦æœ‰ try-catch å’Œ loading çŠ¶æ€ç®¡ç†<span class="hljs-subst">\n</span>   - æ–°å¢çš„ watch æ˜¯å¦æœ‰é˜²é‡å¤æœºåˆ¶<span class="hljs-subst">\n</span>   - ä¿®æ”¹éƒ¨åˆ†æ˜¯å¦å­˜åœ¨ç©ºå€¼é£é™©ï¼ˆç¼ºå°‘å¯é€‰é“¾ã€æ•°ç»„åˆ¤ç©ºç­‰ï¼‰<span class="hljs-subst">\n</span>   - æ–°å¢çš„æŒ‰é’®äº‹ä»¶æ˜¯å¦æœ‰é˜²é‡å¤æäº¤<span class="hljs-subst">\n</span>   - ä¿®æ”¹éƒ¨åˆ†çš„çŠ¶æ€ç®¡ç†æ˜¯å¦ä¸€è‡´<span class="hljs-subst">\n</span>4. åªæŠ¥å‘Šå’Œä¿®å¤æ”¹åŠ¨éƒ¨åˆ†å¼•å…¥çš„é—®é¢˜ï¼Œå·²æœ‰ä»£ç å³ä½¿ä¸å®Œç¾ä¹Ÿä¸è¦åŠ¨<span class="hljs-subst">\n</span>5. ä¿®å¤åç®€è¦è¯´æ˜ï¼šæ”¹äº†å“ªä¸ªæ–‡ä»¶çš„å“ªéƒ¨åˆ†ã€é—®é¢˜æ˜¯ä»€ä¹ˆã€æ€ä¹ˆä¿®çš„"</span>
  }
}

</code></pre>
<p><strong>ç›¸æ¯”ä¸Šé¢çš„è‡ªåŠ¨è§„åˆ™ï¼Œè¿™ä¸ªæ‰‹åŠ¨çš„<code>hook</code>å¦‚ä½•è§¦å‘ï¼Ÿï¼š</strong></p>
<blockquote>
<p>åœ¨<code>Kiro</code>ç¼–è¾‘å™¨çš„æœ€å·¦ä¾§æ‰¾åˆ°è¿™ä¸ªæ–¹æ¡†ä¸­çš„å›¾æ ‡ï¼Œç‚¹å‡»åæ‰¾åˆ°ä½ çš„<code>Hooks</code> åˆ—è¡¨ï¼Œåœ¨åˆ—è¡¨é‡Œæ‰¾åˆ°ä½ æƒ³è¦æ‰§è¡Œçš„ <code>hook</code> ï¼Œç‚¹å‡»å³ä¾§çš„æ‰§è¡ŒæŒ‰é’®å³å¯è§£æ”¾åŒæ‰‹ï¼</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ebbc51968f6e4964b20ba57270e34159~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=991&amp;h=776&amp;s=130016&amp;e=png&amp;b=222222" alt="3c5e7380-9ba1-4ee3-8dc0-32941b4d61a5.png" loading="lazy"/></p>
<p><strong>è§¦å‘åå®ƒä¼šå˜æˆä¸€ä¸ªæ‰§è¡Œä¸­çš„çŠ¶æ€ï¼š</strong></p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/19388b85cb8a42579165dc8e77100b0d~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=571&amp;h=396&amp;s=30603&amp;e=png&amp;b=262628" alt="18e2ee33-b198-4b87-aae1-b05ebf020da3.png" loading="lazy"/></p>
<p><strong>æ‰§è¡Œç»“æŸï¼š</strong></p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/207f1b6e67c1445fa164fca2e054143b~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=693&amp;h=430&amp;s=100668&amp;e=png&amp;b=212121" alt="368d2360-e2de-4964-a9cc-39804281a553.png" loading="lazy"/></p>
<p><strong>å°ç»“ï¼š</strong></p>
<blockquote>
<p>ç°åœ¨æ˜¯ä¸æ˜¯æœ‰ç§è§£æ”¾åŒæ‰‹çš„å¿«æ„Ÿï¼ŸğŸ˜‚ æˆ‘ä»¬ç”¨<code>Skills</code> å’Œ <code>Hook</code> è”åŠ¨ï¼Œå®ç°<code>AI</code>å†™ä»£ç è‡ªåŠ¨æ£€æŸ¥æ˜¯å¦ç¬¦åˆæˆ‘ä»¬çš„è§„èŒƒï¼Œåœ¨æäº¤ä»£ç å‰æ£€æŸ¥å½“å‰çš„ä¿®æ”¹æ˜¯å¦ä¼šå¯¹åŸé€»è¾‘é€ æˆä¼¤å®³ï¼Œå¤§å¤§å‡å°‘äº†<code>bug</code>çš„äº§å‡ºã€‚</p>
</blockquote>
<hr/>
<p><strong>å…³äº<code>AI</code>ä½ æœ‰å“ªäº›å¥½ç”¨çš„å·¥å…·ä¹Ÿæ¬¢è¿è¯„è®ºåŒºç•™è¨€ï¼Œä¸€èµ·æ¥æ¢ç´¢ï¼</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥ç†è§£æ»‘å—éªŒè¯ç ï¼šé‚£äº›ä½ ä¸çŸ¥é“çš„é˜²ç ´è§£æœºåˆ¶]]></title>    <link>https://juejin.cn/post/7604093823959072787</link>    <guid>https://juejin.cn/post/7604093823959072787</guid>    <pubDate>2026-02-09T07:28:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604093823959072787" data-draft-id="7604175912481488902" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥ç†è§£æ»‘å—éªŒè¯ç ï¼šé‚£äº›ä½ ä¸çŸ¥é“çš„é˜²ç ´è§£æœºåˆ¶"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,Canvas"/> <meta itemprop="datePublished" content="2026-02-09T07:28:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="iDaoæŠ€æœ¯é­”æ–¹"/> <meta itemprop="url" content="https://juejin.cn/user/166781496080782"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥ç†è§£æ»‘å—éªŒè¯ç ï¼šé‚£äº›ä½ ä¸çŸ¥é“çš„é˜²ç ´è§£æœºåˆ¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/166781496080782/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    iDaoæŠ€æœ¯é­”æ–¹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T07:28:28.000Z" title="Mon Feb 09 2026 07:28:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>ä½ æ˜¯å¦é‡åˆ°è¿‡è¿™æ ·çš„å°´å°¬ï¼šæ˜æ˜è‡ªå·±æ˜¯ä¸ªçœŸäººï¼Œå´è¢«éªŒè¯ç æŠ˜ç£¨å¾—æ€€ç–‘äººç”Ÿï¼Ÿæ®ç»Ÿè®¡ï¼Œä¼ ç»Ÿå›¾æ–‡éªŒè¯ç çš„ç”¨æˆ·æ”¾å¼ƒç‡é«˜è¾¾40%ã€‚ä½†ä½ çŸ¥é“å—ï¼Ÿæ»‘å—éªŒè¯ç èƒŒåè—ç€ä¸€å¥—ç²¾å¯†çš„é˜²ç ´è§£æœºåˆ¶ï¼Œå®ƒå°±åƒæ˜¯ä¸€ä½ç»éªŒä¸°å¯Œçš„å®‰æ£€å‘˜ï¼Œåœ¨æ¯«ç§’ä¹‹é—´é€šè¿‡ä½ çš„"å¾®è¡¨æƒ…"åˆ¤æ–­ä½ æ˜¯ä¸æ˜¯çœŸäººã€‚</p>
</blockquote>
<h2 data-id="heading-0">ğŸ“‹ ç›®å½•</h2>
<ul>
<li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%BB%91%E5%9D%97%E9%AA%8C%E8%AF%81%E7%A0%81%E8%83%BD%E5%8F%96%E4%BB%A3%E4%BC%A0%E7%BB%9F%E9%AA%8C%E8%AF%81%E7%A0%81" title="#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%BB%91%E5%9D%97%E9%AA%8C%E8%AF%81%E7%A0%81%E8%83%BD%E5%8F%96%E4%BB%A3%E4%BC%A0%E7%BB%9F%E9%AA%8C%E8%AF%81%E7%A0%81">ä¸ºä»€ä¹ˆæ»‘å—éªŒè¯ç èƒ½å–ä»£ä¼ ç»ŸéªŒè¯ç ï¼Ÿ</a></li>
<li><a href="#%E7%AC%AC%E4%B8%80%E9%81%93%E9%98%B2%E7%BA%BF%E4%BD%8D%E7%BD%AE%E9%AA%8C%E8%AF%81" title="#%E7%AC%AC%E4%B8%80%E9%81%93%E9%98%B2%E7%BA%BF%E4%BD%8D%E7%BD%AE%E9%AA%8C%E8%AF%81">ç¬¬ä¸€é“é˜²çº¿ï¼šä½ç½®éªŒè¯</a></li>
<li><a href="#%E7%AC%AC%E4%BA%8C%E9%81%93%E9%98%B2%E7%BA%BF%E8%BD%A8%E8%BF%B9%E9%9D%9E%E7%BA%BF%E6%80%A7%E6%A3%80%E6%B5%8B" title="#%E7%AC%AC%E4%BA%8C%E9%81%93%E9%98%B2%E7%BA%BF%E8%BD%A8%E8%BF%B9%E9%9D%9E%E7%BA%BF%E6%80%A7%E6%A3%80%E6%B5%8B">ç¬¬äºŒé“é˜²çº¿ï¼šè½¨è¿¹éçº¿æ€§æ£€æµ‹</a></li>
<li><a href="#%E7%AC%AC%E4%B8%89%E9%81%93%E9%98%B2%E7%BA%BF%E9%80%9F%E5%BA%A6%E5%8F%98%E5%8C%96%E5%88%86%E6%9E%90" title="#%E7%AC%AC%E4%B8%89%E9%81%93%E9%98%B2%E7%BA%BF%E9%80%9F%E5%BA%A6%E5%8F%98%E5%8C%96%E5%88%86%E6%9E%90">ç¬¬ä¸‰é“é˜²çº¿ï¼šé€Ÿåº¦å˜åŒ–åˆ†æ</a></li>
<li><a href="#%E7%AC%AC%E5%9B%9B%E9%81%93%E9%98%B2%E7%BA%BF%E5%8A%A0%E9%80%9F%E5%BA%A6%E6%A8%A1%E5%BC%8F%E8%AF%86%E5%88%AB" title="#%E7%AC%AC%E5%9B%9B%E9%81%93%E9%98%B2%E7%BA%BF%E5%8A%A0%E9%80%9F%E5%BA%A6%E6%A8%A1%E5%BC%8F%E8%AF%86%E5%88%AB">ç¬¬å››é“é˜²çº¿ï¼šåŠ é€Ÿåº¦æ¨¡å¼è¯†åˆ«</a></li>
<li><a href="#%E7%AC%AC%E4%BA%94%E9%81%93%E9%98%B2%E7%BA%BF%E6%97%B6%E9%97%B4%E7%AA%97%E5%8F%A3%E6%8E%A7%E5%88%B6" title="#%E7%AC%AC%E4%BA%94%E9%81%93%E9%98%B2%E7%BA%BF%E6%97%B6%E9%97%B4%E7%AA%97%E5%8F%A3%E6%8E%A7%E5%88%B6">ç¬¬äº”é“é˜²çº¿ï¼šæ—¶é—´çª—å£æ§åˆ¶</a></li>
<li><a href="#%E5%AE%9E%E6%88%98%E6%BC%94%E7%A4%BA%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88" title="#%E5%AE%9E%E6%88%98%E6%BC%94%E7%A4%BA%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88">å®æˆ˜æ¼”ç¤ºï¼šä¼ä¸šçº§å®ç°æ–¹æ¡ˆ</a></li>
<li><a href="#%E7%BB%95%E8%BF%87%E4%B8%8E%E5%8F%8D%E5%88%B6%E6%94%BB%E9%98%B2%E5%AE%9E%E6%88%98" title="#%E7%BB%95%E8%BF%87%E4%B8%8E%E5%8F%8D%E5%88%B6%E6%94%BB%E9%98%B2%E5%AE%9E%E6%88%98">ç»•è¿‡ä¸ååˆ¶ï¼šæ”»é˜²å®æˆ˜</a></li>
<li><a href="#%E8%BF%9B%E9%98%B6%E6%80%9D%E8%80%83%E5%AF%B9%E6%8A%97captcha%E5%86%9C%E5%9C%BA" title="#%E8%BF%9B%E9%98%B6%E6%80%9D%E8%80%83%E5%AF%B9%E6%8A%97captcha%E5%86%9C%E5%9C%BA">è¿›é˜¶æ€è€ƒï¼šå¯¹æŠ—CAPTCHAå†œåœº</a></li>
<li><a href="#%E6%80%BB%E7%BB%93" title="#%E6%80%BB%E7%BB%93">æ€»ç»“</a></li>
</ul>
<h2 data-id="heading-1">ä¸ºä»€ä¹ˆæ»‘å—éªŒè¯ç èƒ½å–ä»£ä¼ ç»ŸéªŒè¯ç ï¼Ÿ</h2>
<p>è¿˜è®°å¾—é‚£ä¸ªè¢«æŠ˜ç£¨åˆ°æ€€ç–‘äººç”Ÿçš„æ—¶åˆ»å—ï¼Ÿæ‰­æ›²çš„å­—æ¯ã€æ¨¡ç³Šçš„å›¾åƒã€"è¯·ç‚¹å‡»æ‰€æœ‰åŒ…å«çº¢ç»¿ç¯çš„å›¾ç‰‡"â€¦â€¦ä¼ ç»ŸéªŒè¯ç å°±åƒæ˜¯ä¸€ä¸ªæ•…æ„åˆéš¾ä½ çš„é—¨å«ï¼Œè€Œæ»‘å—éªŒè¯ç åˆ™æ›´åƒæ˜¯ä¸€ä½è§‚å¯Ÿå…¥å¾®çš„å¿ƒç†å­¦å®¶ã€‚</p>
<p>æ ¹æ® Journal of Information Security and Applications 2024 å¹´çš„ç ”ç©¶æ•°æ®æ˜¾ç¤ºï¼Œæ»‘å—éªŒè¯ç çš„ç”¨æˆ·å®Œæˆç‡æ¯”ä¼ ç»ŸéªŒè¯ç é«˜å‡º35%ï¼Œè€Œç ´è§£éš¾åº¦å´æå‡äº†2.3å€ã€‚è¿™ç§"åŒèµ¢"æ˜¯æ€ä¹ˆåšåˆ°çš„ï¼Ÿ</p>
<h3 data-id="heading-2">æ»‘å—éªŒè¯ç çš„æ¼”è¿›å²</h3>
<pre><code class="hljs">ç¬¬ä¸€ä»£ï¼šçº¯ä½ç½®éªŒè¯ï¼ˆ2012-2015ï¼‰
   â””â”€ åªéªŒè¯æ»‘å—æœ€ç»ˆä½ç½®æ˜¯å¦æ­£ç¡®
   â””â”€ å¼±ç‚¹ï¼šå®¹æ˜“è¢«è„šæœ¬ç›´æ¥è®¾ç½®ä½ç½®

ç¬¬äºŒä»£ï¼šæ—¶é—´çª—å£éªŒè¯ï¼ˆ2015-2018ï¼‰
   â””â”€ å¢åŠ å®Œæˆæ—¶é—´æ£€æµ‹
   â””â”€ å¼±ç‚¹ï¼šå¯ä»¥é€šè¿‡å»¶æ—¶æ¨¡æ‹Ÿ

ç¬¬ä¸‰ä»£ï¼šè½¨è¿¹åˆ†æï¼ˆ2018-2021ï¼‰
   â””â”€ åˆ†ææ‹–åŠ¨è¿‡ç¨‹ä¸­çš„è½¨è¿¹ç‚¹
   â””â”€ å¼±ç‚¹ï¼šè½¨è¿¹å¯è¢«å½•åˆ¶é‡æ”¾

ç¬¬å››ä»£ï¼šè¡Œä¸ºæŒ‡çº¹ï¼ˆ2021-è‡³ä»Šï¼‰
   â””â”€ å¤šç»´åº¦è¡Œä¸ºç‰¹å¾åˆ†æ
   â””â”€ æœºå™¨å­¦ä¹ è¾…åŠ©åˆ¤æ–­
   â””â”€ å½“å‰ä¸»æµæ–¹æ¡ˆ
</code></pre>
<p>ç°åœ¨çš„æ»‘å—éªŒè¯ç æ—©å·²ä¸æ˜¯ç®€å•çš„"æ‹–åŠ¨åˆ°ä½"é‚£ä¹ˆç®€å•ã€‚å®ƒèƒŒåè¿è¡Œç€ä¸€å¥—å¤æ‚çš„è¡Œä¸ºåˆ†æç³»ç»Ÿï¼Œå°±åƒæ˜¯ä½ å»é¢è¯•æ—¶ï¼ŒHRä¸ä»…çœ‹ä½ çš„ç®€å†ï¼Œè¿˜ä¼šè§‚å¯Ÿä½ çš„è‚¢ä½“è¯­è¨€ã€è¯­é€Ÿå˜åŒ–ã€ç”šè‡³å¾®è¡¨æƒ…ã€‚</p>
<h2 data-id="heading-3">ç¬¬ä¸€é“é˜²çº¿ï¼šä½ç½®éªŒè¯</h2>
<p>è¿™æ˜¯æœ€åŸºç¡€çš„ä¸€å±‚é˜²æŠ¤ï¼Œå°±åƒæ˜¯ä½ å»å…¬å¸é¢è¯•éœ€è¦åˆ°è¾¾æ­£ç¡®çš„æ¥¼å±‚ä¸€æ ·ã€‚çœ‹ä¼¼ç®€å•ï¼Œä½†è¿™é‡Œé¢ä¹Ÿæœ‰é—¨é“ã€‚</p>
<h3 data-id="heading-4">åŸç†è¯´æ˜</h3>
<p>æœåŠ¡å™¨ç”ŸæˆéªŒè¯ç æ—¶ï¼Œä¼šéšæœºäº§ç”Ÿä¸€ä¸ªç›®æ ‡ä½ç½®åæ ‡ <code>(targetX, targetY)</code>ï¼Œå¹¶å­˜å‚¨åœ¨æœåŠ¡ç«¯ï¼ˆé€šå¸¸é…åˆRedisè®¾ç½®è¿‡æœŸæ—¶é—´ï¼‰ã€‚å‰ç«¯éœ€è¦å°†æ»‘å—æ‹–åŠ¨åˆ°è¿™ä¸ªä½ç½®é™„è¿‘ï¼ˆå…è®¸ä¸€å®šçš„è¯¯å·®èŒƒå›´ï¼‰ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æœåŠ¡ç«¯ç”ŸæˆéªŒè¯ç ç¤ºä¾‹ï¼ˆNode.jsï¼‰</span>
<span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">'crypto'</span>);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">generateCaptcha</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// ç”Ÿæˆéšæœºç›®æ ‡ä½ç½®ï¼ˆå‡è®¾æ»‘æ§½å®½åº¦ä¸º300pxï¼‰</span>
  <span class="hljs-keyword">const</span> targetX = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">250</span>) + <span class="hljs-number">20</span>; <span class="hljs-comment">// 20-270ä¹‹é—´</span>
  
  <span class="hljs-comment">// ç”Ÿæˆå”¯ä¸€token</span>
  <span class="hljs-keyword">const</span> token = crypto.<span class="hljs-title function_">randomBytes</span>(<span class="hljs-number">16</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-string">'hex'</span>);
  
  <span class="hljs-comment">// å­˜å‚¨åˆ°Redisï¼Œè®¾ç½®5åˆ†é’Ÿè¿‡æœŸ</span>
  <span class="hljs-keyword">await</span> redis.<span class="hljs-title function_">setex</span>(<span class="hljs-string">`captcha:<span class="hljs-subst">${token}</span>`</span>, <span class="hljs-number">300</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
    targetX,
    <span class="hljs-attr">createdAt</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
  }));
  
  <span class="hljs-keyword">return</span> { token, targetX };
}
</code></pre>
<h3 data-id="heading-5">å…³é”®ç»†èŠ‚</h3>
<p><strong>è¯¯å·®å®¹å¿åº¦</strong>ï¼šé€šå¸¸å…è®¸ Â±5px çš„è¯¯å·®èŒƒå›´ã€‚å¤ªå°ä¼šå¯¼è‡´ç”¨æˆ·ä½“éªŒå·®ï¼Œå¤ªå¤§ä¼šé™ä½å®‰å…¨æ€§ã€‚</p>
<p><strong>åæ ‡åŠ å¯†</strong>ï¼šå‰ç«¯ä¸åº”ç›´æ¥çŸ¥é“ç›®æ ‡ä½ç½®ã€‚æ­£ç¡®çš„åšæ³•æ˜¯è®©åç«¯è¿”å›ä¸€ä¸ªåŠ å¯†çš„ç›®æ ‡ä½ç½®ï¼Œæˆ–è€…ä½¿ç”¨å›¾ç‰‡èƒŒæ™¯ä¸Šçš„ç¼ºå£ä½ç½®ä½œä¸ºå‚ç…§ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// é”™è¯¯åšæ³• âŒ</span>
<span class="hljs-keyword">const</span> targetX = <span class="hljs-number">156</span>; <span class="hljs-comment">// å‰ç«¯ç¡¬ç¼–ç æˆ–ä»æ¥å£æ˜æ–‡è·å–</span>

<span class="hljs-comment">// æ­£ç¡®åšæ³• âœ…</span>
<span class="hljs-comment">// åç«¯è¿”å›ä¸€å¼ å¸¦æœ‰ç¼ºå£çš„èƒŒæ™¯å›¾</span>
<span class="hljs-comment">// ç¼ºå£ä½ç½®å°±æ˜¯ç›®æ ‡ä½ç½®ï¼Œå‰ç«¯ä¸éœ€è¦çŸ¥é“å…·ä½“æ•°å€¼</span>
<span class="hljs-comment">// éªŒè¯æ—¶åç«¯å¯¹æ¯”å‰ç«¯æäº¤çš„åæ ‡ä¸ç¼ºå£ä½ç½®</span>
</code></pre>
<h2 data-id="heading-6">ç¬¬äºŒé“é˜²çº¿ï¼šè½¨è¿¹éçº¿æ€§æ£€æµ‹</h2>
<p>è¿™æ˜¯æ»‘å—éªŒè¯ç æœ€ç²¾å¦™çš„åœ°æ–¹ã€‚å°±åƒäººçš„ç¬”è¿¹ä¸€æ ·ï¼Œæ¯ä¸ªäººçš„æ‹–åŠ¨è½¨è¿¹éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œè€Œæœºå™¨äººçš„"ç¬”è¿¹"å¾€å¾€è¿‡äºå·¥æ•´ã€‚</p>
<h3 data-id="heading-7">ä»€ä¹ˆæ˜¯éçº¿æ€§è½¨è¿¹ï¼Ÿ</h3>
<p>äººç±»æ‹–åŠ¨æ»‘å—æ—¶ï¼Œè½¨è¿¹æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">å¼€å§‹ â”€â”€â”€â”€â•²    â•±â”€â”€â”€â”€â•²      â•±â”€â”€â”€â”€ ç»“æŸ
<span class="hljs-code">            â•²  â•±      â•²    â•±
             â•²â•±        â•²â”€â”€â•±
</span></code></pre>
<p>è€Œæœºå™¨äººçš„"å®Œç¾"è½¨è¿¹æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="hljs">å¼€å§‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ç»“æŸ
</code></pre>
<h3 data-id="heading-8">å®ç°åŸç†</h3>
<p>æˆ‘ä»¬éœ€è¦é‡‡é›†æ‹–åŠ¨è¿‡ç¨‹ä¸­çš„è½¨è¿¹ç‚¹ï¼Œç„¶ååˆ†æè¿™äº›ç‚¹çš„åˆ†å¸ƒç‰¹å¾ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å‰ç«¯è½¨è¿¹é‡‡é›†</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TrajectoryCollector</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">trajectory</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">startTime</span> = <span class="hljs-literal">null</span>;
  }

  <span class="hljs-title function_">start</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">startTime</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">trajectory</span> = [];
  }

  <span class="hljs-title function_">record</span>(<span class="hljs-params">x, y</span>) {
    <span class="hljs-keyword">const</span> timestamp = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - <span class="hljs-variable language_">this</span>.<span class="hljs-property">startTime</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">trajectory</span>.<span class="hljs-title function_">push</span>({ x, y, <span class="hljs-attr">t</span>: timestamp });
  }

  <span class="hljs-title function_">getTrajectory</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">trajectory</span>;
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> collector = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TrajectoryCollector</span>();

slider.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mousedown'</span>, <span class="hljs-function">() =&gt;</span> {
  collector.<span class="hljs-title function_">start</span>();
});

slider.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mousemove'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (isDragging) {
    collector.<span class="hljs-title function_">record</span>(e.<span class="hljs-property">clientX</span>, e.<span class="hljs-property">clientY</span>);
  }
});
</code></pre>
<h3 data-id="heading-9">éçº¿æ€§æ£€æµ‹ç®—æ³•</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æœåŠ¡ç«¯è½¨è¿¹åˆ†æï¼ˆNode.jsï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">analyzeTrajectory</span>(<span class="hljs-params">trajectory</span>) {
  <span class="hljs-comment">// 1. è®¡ç®—ç›¸é‚»ç‚¹çš„åå·®</span>
  <span class="hljs-keyword">const</span> deviations = [];
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; trajectory.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">const</span> prev = trajectory[i - <span class="hljs-number">1</span>];
    <span class="hljs-keyword">const</span> curr = trajectory[i];
    
    <span class="hljs-comment">// è®¡ç®—è§’åº¦åå·®</span>
    <span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">1</span>) {
      <span class="hljs-keyword">const</span> prev2 = trajectory[i - <span class="hljs-number">2</span>];
      <span class="hljs-keyword">const</span> angle1 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">atan2</span>(prev.<span class="hljs-property">y</span> - prev2.<span class="hljs-property">y</span>, prev.<span class="hljs-property">x</span> - prev2.<span class="hljs-property">x</span>);
      <span class="hljs-keyword">const</span> angle2 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">atan2</span>(curr.<span class="hljs-property">y</span> - prev.<span class="hljs-property">y</span>, curr.<span class="hljs-property">x</span> - prev.<span class="hljs-property">x</span>);
      <span class="hljs-keyword">const</span> deviation = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(angle2 - angle1);
      deviations.<span class="hljs-title function_">push</span>(deviation);
    }
  }

  <span class="hljs-comment">// 2. ç»Ÿè®¡åå·®ç‰¹å¾</span>
  <span class="hljs-keyword">const</span> avgDeviation = deviations.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>) / deviations.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">const</span> maxDeviation = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(...deviations);
  
  <span class="hljs-comment">// 3. åˆ¤æ–­æ˜¯å¦ä¸ºçº¿æ€§</span>
  <span class="hljs-comment">// äººç±»æ‹–åŠ¨é€šå¸¸ä¼šæœ‰æ˜æ˜¾çš„æ–¹å‘å˜åŒ–ï¼ˆæ‰‹æŠ–ã€è°ƒæ•´ç­‰ï¼‰</span>
  <span class="hljs-comment">// æœºå™¨äººé€šå¸¸æ˜¯ç›´çº¿æˆ–å¹³æ»‘æ›²çº¿</span>
  <span class="hljs-keyword">const</span> isLinear = avgDeviation &lt; <span class="hljs-number">0.1</span> &amp;&amp; maxDeviation &lt; <span class="hljs-number">0.3</span>;
  
  <span class="hljs-keyword">return</span> {
    isLinear,
    <span class="hljs-attr">score</span>: isLinear ? <span class="hljs-number">0</span> : <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-number">100</span>, avgDeviation * <span class="hljs-number">100</span>),
    <span class="hljs-attr">details</span>: { avgDeviation, maxDeviation, <span class="hljs-attr">pointCount</span>: trajectory.<span class="hljs-property">length</span> }
  };
}
</code></pre>
<h3 data-id="heading-10">ä¸ºä»€ä¹ˆè¿™å¾ˆæœ‰æ•ˆï¼Ÿ</h3>
<p>æ ¹æ® "The robustness of behavior-verification-based slider CAPTCHAs"ï¼ˆJournal of Information Security and Applications, 2024ï¼‰çš„ç ”ç©¶ï¼Œç®€å•çš„è‡ªåŠ¨åŒ–è„šæœ¬å¾ˆéš¾æ¨¡æ‹Ÿå‡ºçœŸå®çš„éçº¿æ€§è½¨è¿¹ã€‚å³ä½¿ä½¿ç”¨è´å¡å°”æ›²çº¿æ¨¡æ‹Ÿï¼Œä¹Ÿä¼šåœ¨æŸäº›ç‰¹å¾ä¸Šéœ²å‡ºé©¬è„šã€‚</p>
<h2 data-id="heading-11">ç¬¬ä¸‰é“é˜²çº¿ï¼šé€Ÿåº¦å˜åŒ–åˆ†æ</h2>
<p>äººç±»æ‹–åŠ¨æ»‘å—çš„é€Ÿåº¦ä¸æ˜¯æ’å®šçš„ï¼Œå°±åƒä½ å¼€è½¦ä¸€æ ·ï¼šå¯åŠ¨æ—¶æ…¢ã€ä¸­é€”åŠ é€Ÿã€å¿«åˆ°ä½æ—¶å‡é€Ÿã€‚è€Œæœºå™¨äººå¾€å¾€ä¼šä»¥æ’å®šé€Ÿåº¦"è¡Œé©¶"ã€‚</p>
<h3 data-id="heading-12">é€Ÿåº¦æ›²çº¿ç‰¹å¾</h3>
<pre><code class="hljs">é€Ÿåº¦
 â”‚
 â”‚       â•±â•²
 â”‚      â•±  â•²
 â”‚     â•±    â•²
 â”‚    â•±      â•²
 â”‚   â•±        â•²
 â”‚  â•±          â•²___
 â”‚ â•±                â•²
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æ—¶é—´
  æ…¢â†’å¿«â†’æ…¢â†’è°ƒæ•´â†’å®Œæˆ
</code></pre>
<h3 data-id="heading-13">é€Ÿåº¦åˆ†æç®—æ³•</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">analyzeSpeed</span>(<span class="hljs-params">trajectory</span>) {
  <span class="hljs-keyword">const</span> speeds = [];
  
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; trajectory.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">const</span> prev = trajectory[i - <span class="hljs-number">1</span>];
    <span class="hljs-keyword">const</span> curr = trajectory[i];
    
    <span class="hljs-keyword">const</span> distance = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(
      <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(curr.<span class="hljs-property">x</span> - prev.<span class="hljs-property">x</span>, <span class="hljs-number">2</span>) + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(curr.<span class="hljs-property">y</span> - prev.<span class="hljs-property">y</span>, <span class="hljs-number">2</span>)
    );
    <span class="hljs-keyword">const</span> timeDiff = curr.<span class="hljs-property">t</span> - prev.<span class="hljs-property">t</span>;
    
    <span class="hljs-keyword">if</span> (timeDiff &gt; <span class="hljs-number">0</span>) {
      speeds.<span class="hljs-title function_">push</span>(distance / timeDiff);
    }
  }

  <span class="hljs-comment">// åˆ†æé€Ÿåº¦å˜åŒ–ç‰¹å¾</span>
  <span class="hljs-keyword">const</span> avgSpeed = speeds.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>) / speeds.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">const</span> variance = speeds.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, speed</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> sum + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(speed - avgSpeed, <span class="hljs-number">2</span>);
  }, <span class="hljs-number">0</span>) / speeds.<span class="hljs-property">length</span>;
  
  <span class="hljs-comment">// é€Ÿåº¦å˜åŒ–æ–¹å·®è¿‡å°è¯´æ˜æ˜¯åŒ€é€Ÿè¿åŠ¨ï¼ˆæœºå™¨äººç‰¹å¾ï¼‰</span>
  <span class="hljs-keyword">const</span> isConstantSpeed = variance &lt; <span class="hljs-number">0.5</span>;
  
  <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æœ‰æ˜æ˜¾çš„åŠ é€Ÿ-å‡é€Ÿè¿‡ç¨‹</span>
  <span class="hljs-keyword">let</span> hasAccelDecel = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">if</span> (speeds.<span class="hljs-property">length</span> &gt; <span class="hljs-number">10</span>) {
    <span class="hljs-keyword">const</span> firstHalf = speeds.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(speeds.<span class="hljs-property">length</span> / <span class="hljs-number">2</span>));
    <span class="hljs-keyword">const</span> secondHalf = speeds.<span class="hljs-title function_">slice</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(speeds.<span class="hljs-property">length</span> / <span class="hljs-number">2</span>));
    
    <span class="hljs-keyword">const</span> avgFirst = firstHalf.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>) / firstHalf.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">const</span> avgSecond = secondHalf.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>) / secondHalf.<span class="hljs-property">length</span>;
    
    <span class="hljs-comment">// å‰åŠæ®µå’ŒååŠæ®µæœ‰æ˜æ˜¾å·®å¼‚ï¼ˆåŠ é€Ÿåå‡é€Ÿï¼‰</span>
    hasAccelDecel = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(avgFirst - avgSecond) &gt; avgSpeed * <span class="hljs-number">0.3</span>;
  }

  <span class="hljs-keyword">return</span> {
    isConstantSpeed,
    hasAccelDecel,
    <span class="hljs-attr">score</span>: (!isConstantSpeed &amp;&amp; hasAccelDecel) ? <span class="hljs-number">100</span> : <span class="hljs-number">50</span>,
    <span class="hljs-attr">details</span>: { avgSpeed, variance, <span class="hljs-attr">speeds</span>: speeds.<span class="hljs-property">length</span> }
  };
}
</code></pre>
<h3 data-id="heading-14">å®æˆ˜æŠ€å·§</h3>
<p><strong>é€Ÿåº¦é˜ˆå€¼è®¾ç½®</strong>ï¼š</p>
<ul>
<li>è¿‡å¿«ï¼ˆ&lt; 100msï¼‰ï¼šå¯èƒ½æ˜¯è„šæœ¬ç›´æ¥è®¾ç½®ä½ç½®</li>
<li>è¿‡æ…¢ï¼ˆ&gt; 10sï¼‰ï¼šå¯èƒ½æ˜¯äººå·¥æ‰“ç æˆ–ä½è´¨é‡è„šæœ¬</li>
<li>æ¨èå®Œæˆæ—¶é—´ï¼š500ms - 3000ms</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç»¼åˆæ—¶é—´æ£€æŸ¥</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">checkTimeWindow</span>(<span class="hljs-params">trajectory</span>) {
  <span class="hljs-keyword">const</span> totalTime = trajectory[trajectory.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>].<span class="hljs-property">t</span>;
  
  <span class="hljs-keyword">if</span> (totalTime &lt; <span class="hljs-number">100</span>) {
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">valid</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">reason</span>: <span class="hljs-string">'Too fast - likely automated'</span> };
  }
  <span class="hljs-keyword">if</span> (totalTime &gt; <span class="hljs-number">10000</span>) {
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">valid</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">reason</span>: <span class="hljs-string">'Too slow - possible manual farm'</span> };
  }
  
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">valid</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">duration</span>: totalTime };
}
</code></pre>
<h2 data-id="heading-15">ç¬¬å››é“é˜²çº¿ï¼šåŠ é€Ÿåº¦æ¨¡å¼è¯†åˆ«</h2>
<p>åŠ é€Ÿåº¦æ˜¯æ¯”é€Ÿåº¦æ›´æ·±ä¸€å±‚çš„ç‰¹å¾ã€‚äººç±»æ‰‹çš„è‚Œè‚‰ååº”æ˜¯æœ‰ç‰©ç†æƒ¯æ€§çš„ï¼Œè€Œç¨‹åºç”Ÿæˆçš„è¿åŠ¨å¾€å¾€å¿½ç•¥è¿™ä¸€ç‚¹ã€‚</p>
<h3 data-id="heading-16">åŠ é€Ÿåº¦æ›²çº¿ç‰¹å¾</h3>
<p>äººç±»çš„åŠ é€Ÿåº¦æ›²çº¿åº”è¯¥ç¬¦åˆç‰©ç†è§„å¾‹ï¼š</p>
<ul>
<li>å¯åŠ¨æ—¶éœ€è¦å…‹æœé™æ‘©æ“¦åŠ›ï¼ˆåŠ é€Ÿåº¦å¤§ï¼‰</li>
<li>åŒ€é€Ÿé˜¶æ®µåŠ é€Ÿåº¦æ¥è¿‘0</li>
<li>åˆ¶åŠ¨æ—¶åŠ é€Ÿåº¦ä¸ºè´Ÿå€¼</li>
<li>æ•´ä¸ªè¿‡ç¨‹æœ‰è½»å¾®çš„æŠ–åŠ¨ï¼ˆè‚Œè‚‰éœ‡é¢¤ï¼‰</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">analyzeAcceleration</span>(<span class="hljs-params">trajectory</span>) {
  <span class="hljs-keyword">const</span> accelerations = [];
  
  <span class="hljs-comment">// å…ˆè®¡ç®—é€Ÿåº¦</span>
  <span class="hljs-keyword">const</span> speeds = [];
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; trajectory.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">const</span> prev = trajectory[i - <span class="hljs-number">1</span>];
    <span class="hljs-keyword">const</span> curr = trajectory[i];
    <span class="hljs-keyword">const</span> distance = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(
      <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(curr.<span class="hljs-property">x</span> - prev.<span class="hljs-property">x</span>, <span class="hljs-number">2</span>) + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(curr.<span class="hljs-property">y</span> - prev.<span class="hljs-property">y</span>, <span class="hljs-number">2</span>)
    );
    <span class="hljs-keyword">const</span> timeDiff = curr.<span class="hljs-property">t</span> - prev.<span class="hljs-property">t</span>;
    <span class="hljs-keyword">if</span> (timeDiff &gt; <span class="hljs-number">0</span>) {
      speeds.<span class="hljs-title function_">push</span>({
        <span class="hljs-attr">speed</span>: distance / timeDiff,
        <span class="hljs-attr">time</span>: curr.<span class="hljs-property">t</span>
      });
    }
  }

  <span class="hljs-comment">// è®¡ç®—åŠ é€Ÿåº¦ï¼ˆé€Ÿåº¦çš„å˜åŒ–ç‡ï¼‰</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; speeds.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">const</span> speedDiff = speeds[i].<span class="hljs-property">speed</span> - speeds[i - <span class="hljs-number">1</span>].<span class="hljs-property">speed</span>;
    <span class="hljs-keyword">const</span> timeDiff = speeds[i].<span class="hljs-property">time</span> - speeds[i - <span class="hljs-number">1</span>].<span class="hljs-property">time</span>;
    <span class="hljs-keyword">if</span> (timeDiff &gt; <span class="hljs-number">0</span>) {
      accelerations.<span class="hljs-title function_">push</span>(speedDiff / timeDiff);
    }
  }

  <span class="hljs-comment">// åˆ†æåŠ é€Ÿåº¦ç‰¹å¾</span>
  <span class="hljs-keyword">const</span> positiveAccel = accelerations.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">a</span> =&gt;</span> a &gt; <span class="hljs-number">0</span>).<span class="hljs-property">length</span>;
  <span class="hljs-keyword">const</span> negativeAccel = accelerations.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">a</span> =&gt;</span> a &lt; <span class="hljs-number">0</span>).<span class="hljs-property">length</span>;
  <span class="hljs-keyword">const</span> nearZeroAccel = accelerations.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">a</span> =&gt;</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(a) &lt; <span class="hljs-number">0.1</span>).<span class="hljs-property">length</span>;
  
  <span class="hljs-comment">// åˆç†çš„åŠ é€Ÿåº¦åˆ†å¸ƒåº”è¯¥æ˜¯ï¼šå…ˆæ­£ï¼ˆåŠ é€Ÿï¼‰ã€åæ¥è¿‘0ï¼ˆåŒ€é€Ÿï¼‰ã€æœ€åè´Ÿï¼ˆå‡é€Ÿï¼‰</span>
  <span class="hljs-keyword">const</span> total = accelerations.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">const</span> firstThird = accelerations.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(total / <span class="hljs-number">3</span>));
  <span class="hljs-keyword">const</span> lastThird = accelerations.<span class="hljs-title function_">slice</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(total * <span class="hljs-number">2</span> / <span class="hljs-number">3</span>));
  
  <span class="hljs-keyword">const</span> avgFirst = firstThird.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>) / firstThird.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">const</span> avgLast = lastThird.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>) / lastThird.<span class="hljs-property">length</span>;
  
  <span class="hljs-comment">// æ­£å¸¸æƒ…å†µï¼šå‰åŠæ®µåŠ é€Ÿåº¦ä¸ºæ­£ï¼ŒååŠæ®µä¸ºè´Ÿ</span>
  <span class="hljs-keyword">const</span> hasNaturalPattern = avgFirst &gt; <span class="hljs-number">0.05</span> &amp;&amp; avgLast &lt; -<span class="hljs-number">0.05</span>;

  <span class="hljs-keyword">return</span> {
    hasNaturalPattern,
    <span class="hljs-attr">score</span>: hasNaturalPattern ? <span class="hljs-number">100</span> : <span class="hljs-number">30</span>,
    <span class="hljs-attr">details</span>: {
      <span class="hljs-attr">positiveRatio</span>: positiveAccel / total,
      <span class="hljs-attr">negativeRatio</span>: negativeAccel / total,
      <span class="hljs-attr">avgFirstPhase</span>: avgFirst,
      <span class="hljs-attr">avgLastPhase</span>: avgLast
    }
  };
}
</code></pre>
<h2 data-id="heading-17">ç¬¬äº”é“é˜²çº¿ï¼šæ—¶é—´çª—å£æ§åˆ¶</h2>
<p>è¿™å°±åƒæ˜¯æˆ‘ä»¬ç»™éªŒè¯è¿‡ç¨‹è®¾ç½®äº†ä¸€ä¸ª"æœ‰æ•ˆæœŸ"ã€‚éªŒè¯ç tokenç”Ÿæˆåï¼Œå¦‚æœåœ¨æçŸ­æ—¶é—´å†…å°±æäº¤éªŒè¯ï¼Œæˆ–è€…æ‹–äº†å¾ˆä¹…æ‰æäº¤ï¼Œéƒ½å¯èƒ½æ˜¯å¼‚å¸¸è¡Œä¸ºã€‚</p>
<h3 data-id="heading-18">æ—¶é—´çª—å£ç­–ç•¥</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æœåŠ¡ç«¯æ—¶é—´çª—å£éªŒè¯</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">verifyTimeWindow</span>(<span class="hljs-params">token, clientTimestamp</span>) {
  <span class="hljs-keyword">const</span> captchaData = <span class="hljs-keyword">await</span> redis.<span class="hljs-title function_">get</span>(<span class="hljs-string">`captcha:<span class="hljs-subst">${token}</span>`</span>);
  <span class="hljs-keyword">if</span> (!captchaData) {
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">valid</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">reason</span>: <span class="hljs-string">'Token expired or invalid'</span> };
  }

  <span class="hljs-keyword">const</span> data = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(captchaData);
  <span class="hljs-keyword">const</span> serverTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
  <span class="hljs-keyword">const</span> createdAt = data.<span class="hljs-property">createdAt</span>;
  
  <span class="hljs-comment">// æ£€æŸ¥tokenæ˜¯å¦åœ¨æœ‰æ•ˆæœŸå†…ï¼ˆ5åˆ†é’Ÿï¼‰</span>
  <span class="hljs-keyword">if</span> (serverTime - createdAt &gt; <span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>) {
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">valid</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">reason</span>: <span class="hljs-string">'Token expired'</span> };
  }

  <span class="hljs-comment">// æ£€æŸ¥å®¢æˆ·ç«¯æäº¤æ—¶é—´æ˜¯å¦åˆç†ï¼ˆé˜²é‡æ”¾æ”»å‡»ï¼‰</span>
  <span class="hljs-keyword">const</span> timeOnClient = clientTimestamp - createdAt;
  <span class="hljs-keyword">if</span> (timeOnClient &lt; <span class="hljs-number">200</span>) { <span class="hljs-comment">// å°äº200msï¼Œå¤ªå¿«äº†</span>
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">valid</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">reason</span>: <span class="hljs-string">'Suspiciously fast completion'</span> };
  }
  <span class="hljs-keyword">if</span> (timeOnClient &gt; <span class="hljs-number">4</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>) { <span class="hljs-comment">// è¶…è¿‡4åˆ†é’Ÿ</span>
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">valid</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">reason</span>: <span class="hljs-string">'Suspiciously slow completion'</span> };
  }

  <span class="hljs-keyword">return</span> { <span class="hljs-attr">valid</span>: <span class="hljs-literal">true</span> };
}
</code></pre>
<h2 data-id="heading-19">å®æˆ˜æ¼”ç¤ºï¼šä¼ä¸šçº§å®ç°æ–¹æ¡ˆ</h2>
<p>è¯´äº†é‚£ä¹ˆå¤šç†è®ºï¼Œç°åœ¨æ¥ä¸Šç¡¬èœã€‚è¿™æ˜¯ä¸€ä¸ªåŸºäº <strong>Node.js + Redis</strong> çš„ä¼ä¸šçº§æ»‘å—éªŒè¯ç å®ç°æ–¹æ¡ˆï¼Œå‚è€ƒäº† GitHub ä¸Šçƒ­é—¨çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fkartikmehta8%2Fcaptcha" target="_blank" title="https://github.com/kartikmehta8/captcha" ref="nofollow noopener noreferrer">kartikmehta8/captcha</a> é¡¹ç›®æ¶æ„ã€‚</p>
<h3 data-id="heading-20">æŠ€æœ¯æ ˆ</h3>
<ul>
<li><strong>Node.js &gt;= 16</strong>: æœåŠ¡ç«¯è¿è¡Œç¯å¢ƒ</li>
<li><strong>Express</strong>: Webæ¡†æ¶</li>
<li><strong>Redis &gt;= 6</strong>: çŠ¶æ€å­˜å‚¨å’Œé™æµ</li>
<li><strong>Canvas</strong>: å›¾ç‰‡ç”Ÿæˆ</li>
<li><strong>Joi</strong>: å‚æ•°æ ¡éªŒ</li>
</ul>
<h3 data-id="heading-21">é¡¹ç›®ç»“æ„</h3>
<pre><code class="hljs language-bash" lang="bash">captcha-service/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ index.js          <span class="hljs-comment"># é…ç½®æ–‡ä»¶</span>
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â””â”€â”€ captcha.js        <span class="hljs-comment"># éªŒè¯ç æ§åˆ¶å™¨</span>
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ captcha.js        <span class="hljs-comment"># æ ¸å¿ƒæœåŠ¡é€»è¾‘</span>
â”‚   â”‚   â””â”€â”€ validator.js      <span class="hljs-comment"># è¡Œä¸ºåˆ†æå™¨</span>
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ image.js          <span class="hljs-comment"># å›¾ç‰‡ç”Ÿæˆå·¥å…·</span>
â”‚   â”‚   â””â”€â”€ crypto.js         <span class="hljs-comment"># åŠ å¯†å·¥å…·</span>
â”‚   â””â”€â”€ app.js                <span class="hljs-comment"># åº”ç”¨å…¥å£</span>
â”œâ”€â”€ package.json
â””â”€â”€ README.md
</code></pre>
<h3 data-id="heading-22">æ ¸å¿ƒä»£ç å®ç°</h3>
<h4 data-id="heading-23">1. éªŒè¯ç ç”ŸæˆæœåŠ¡</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/services/captcha.js</span>
<span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">'crypto'</span>);
<span class="hljs-keyword">const</span> { createCanvas } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'canvas'</span>);
<span class="hljs-keyword">const</span> redis = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../config/redis'</span>);

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CaptchaService</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">width</span> = <span class="hljs-number">300</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">height</span> = <span class="hljs-number">150</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderWidth</span> = <span class="hljs-number">50</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderHeight</span> = <span class="hljs-number">50</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tolerance</span> = <span class="hljs-number">5</span>; <span class="hljs-comment">// è¯¯å·®å®¹å¿åº¦ Â±5px</span>
  }

  <span class="hljs-comment">// ç”ŸæˆéªŒè¯ç </span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">generate</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> token = crypto.<span class="hljs-title function_">randomBytes</span>(<span class="hljs-number">16</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-string">'hex'</span>);
    
    <span class="hljs-comment">// éšæœºç”Ÿæˆæ»‘å—ç›®æ ‡ä½ç½®ï¼ˆç•™å‡ºè¾¹è·ï¼‰</span>
    <span class="hljs-keyword">const</span> targetX = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * (<span class="hljs-variable language_">this</span>.<span class="hljs-property">width</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderWidth</span> - <span class="hljs-number">40</span>)) + <span class="hljs-number">20</span>;
    <span class="hljs-keyword">const</span> targetY = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * (<span class="hljs-variable language_">this</span>.<span class="hljs-property">height</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderHeight</span> - <span class="hljs-number">40</span>)) + <span class="hljs-number">20</span>;

    <span class="hljs-comment">// ç”ŸæˆèƒŒæ™¯å›¾å’Œæ»‘å—å›¾</span>
    <span class="hljs-keyword">const</span> { bgImage, sliderImage } = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">generateImages</span>(targetX, targetY);

    <span class="hljs-comment">// å­˜å‚¨éªŒè¯ç æ•°æ®åˆ°Redisï¼ˆ5åˆ†é’Ÿè¿‡æœŸï¼‰</span>
    <span class="hljs-keyword">const</span> captchaData = {
      targetX,
      targetY,
      <span class="hljs-attr">createdAt</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
      <span class="hljs-attr">attempts</span>: <span class="hljs-number">0</span>
    };
    <span class="hljs-keyword">await</span> redis.<span class="hljs-title function_">setex</span>(<span class="hljs-string">`captcha:<span class="hljs-subst">${token}</span>`</span>, <span class="hljs-number">300</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(captchaData));

    <span class="hljs-keyword">return</span> {
      token,
      <span class="hljs-attr">bgImage</span>: bgImage.<span class="hljs-title function_">toString</span>(<span class="hljs-string">'base64'</span>),
      <span class="hljs-attr">sliderImage</span>: sliderImage.<span class="hljs-title function_">toString</span>(<span class="hljs-string">'base64'</span>),
      <span class="hljs-attr">sliderWidth</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderWidth</span>,
      <span class="hljs-attr">sliderHeight</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderHeight</span>
    };
  }

  <span class="hljs-comment">// ç”Ÿæˆå›¾ç‰‡</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">generateImages</span>(<span class="hljs-params">targetX, targetY</span>) {
    <span class="hljs-keyword">const</span> canvas = <span class="hljs-title function_">createCanvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">width</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">height</span>);
    <span class="hljs-keyword">const</span> ctx = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">'2d'</span>);

    <span class="hljs-comment">// ç»˜åˆ¶èƒŒæ™¯ï¼ˆéšæœºå™ªç‚¹ + å¹²æ‰°çº¿ï¼‰</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">drawBackground</span>(ctx);

    <span class="hljs-comment">// åˆ›å»ºæ»‘å—å½¢çŠ¶ï¼ˆåœ†å½¢ç¼ºå£ï¼‰</span>
    <span class="hljs-keyword">const</span> sliderCanvas = <span class="hljs-title function_">createCanvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderWidth</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">height</span>);
    <span class="hljs-keyword">const</span> sliderCtx = sliderCanvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">'2d'</span>);

    <span class="hljs-comment">// ç»˜åˆ¶æ»‘å—æ§½</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">drawSliderSlot</span>(ctx, targetX, targetY);

    <span class="hljs-comment">// æå–æ»‘å—åŒºåŸŸ</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">extractSlider</span>(sliderCtx, ctx, targetX, targetY);

    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">bgImage</span>: canvas.<span class="hljs-title function_">toBuffer</span>(<span class="hljs-string">'image/png'</span>),
      <span class="hljs-attr">sliderImage</span>: sliderCanvas.<span class="hljs-title function_">toBuffer</span>(<span class="hljs-string">'image/png'</span>)
    };
  }

  <span class="hljs-title function_">drawBackground</span>(<span class="hljs-params">ctx</span>) {
    <span class="hljs-comment">// å¡«å……èƒŒæ™¯è‰²</span>
    ctx.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">'#f0f0f0'</span>;
    ctx.<span class="hljs-title function_">fillRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">width</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">height</span>);

    <span class="hljs-comment">// æ·»åŠ å™ªç‚¹</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {
      ctx.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">`rgba(<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">255</span>}</span>, <span class="hljs-subst">${<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">255</span>}</span>, <span class="hljs-subst">${<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">255</span>}</span>, 0.3)`</span>;
      ctx.<span class="hljs-title function_">fillRect</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-variable language_">this</span>.<span class="hljs-property">width</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-variable language_">this</span>.<span class="hljs-property">height</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>);
    }

    <span class="hljs-comment">// æ·»åŠ å¹²æ‰°çº¿</span>
    ctx.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">'rgba(100, 100, 100, 0.2)'</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
      ctx.<span class="hljs-title function_">beginPath</span>();
      ctx.<span class="hljs-title function_">moveTo</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-variable language_">this</span>.<span class="hljs-property">width</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-variable language_">this</span>.<span class="hljs-property">height</span>);
      ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-variable language_">this</span>.<span class="hljs-property">width</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-variable language_">this</span>.<span class="hljs-property">height</span>);
      ctx.<span class="hljs-title function_">stroke</span>();
    }
  }

  <span class="hljs-title function_">drawSliderSlot</span>(<span class="hljs-params">ctx, x, y</span>) {
    ctx.<span class="hljs-property">globalCompositeOperation</span> = <span class="hljs-string">'destination-out'</span>;
    ctx.<span class="hljs-title function_">beginPath</span>();
    ctx.<span class="hljs-title function_">arc</span>(x + <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderWidth</span> / <span class="hljs-number">2</span>, y + <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderHeight</span> / <span class="hljs-number">2</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderWidth</span> / <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>);
    ctx.<span class="hljs-title function_">fill</span>();
    ctx.<span class="hljs-property">globalCompositeOperation</span> = <span class="hljs-string">'source-over'</span>;

    <span class="hljs-comment">// æ·»åŠ é«˜äº®è¾¹æ¡†</span>
    ctx.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">'rgba(255, 255, 255, 0.8)'</span>;
    ctx.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">2</span>;
    ctx.<span class="hljs-title function_">beginPath</span>();
    ctx.<span class="hljs-title function_">arc</span>(x + <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderWidth</span> / <span class="hljs-number">2</span>, y + <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderHeight</span> / <span class="hljs-number">2</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderWidth</span> / <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>);
    ctx.<span class="hljs-title function_">stroke</span>();
  }

  <span class="hljs-title function_">extractSlider</span>(<span class="hljs-params">sliderCtx, bgCtx, x, y</span>) {
    <span class="hljs-comment">// ä»èƒŒæ™¯ä¸­æå–æ»‘å—åŒºåŸŸ</span>
    <span class="hljs-keyword">const</span> imageData = bgCtx.<span class="hljs-title function_">getImageData</span>(x, <span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderWidth</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">height</span>);
    sliderCtx.<span class="hljs-title function_">putImageData</span>(imageData, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
  }
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CaptchaService</span>();
</code></pre>
<h4 data-id="heading-24">2. è¡Œä¸ºåˆ†æéªŒè¯å™¨</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/services/validator.js</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BehaviorValidator</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// å„ç»´åº¦æƒé‡é…ç½®</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">weights</span> = {
      <span class="hljs-attr">trajectory</span>: <span class="hljs-number">0.3</span>,    <span class="hljs-comment">// è½¨è¿¹éçº¿æ€§</span>
      <span class="hljs-attr">speed</span>: <span class="hljs-number">0.25</span>,        <span class="hljs-comment">// é€Ÿåº¦å˜åŒ–</span>
      <span class="hljs-attr">acceleration</span>: <span class="hljs-number">0.25</span>, <span class="hljs-comment">// åŠ é€Ÿåº¦æ¨¡å¼</span>
      <span class="hljs-attr">timeWindow</span>: <span class="hljs-number">0.2</span>     <span class="hljs-comment">// æ—¶é—´çª—å£</span>
    };

    <span class="hljs-comment">// é˜ˆå€¼é…ç½®</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">thresholds</span> = {
      <span class="hljs-attr">minTrajectoryPoints</span>: <span class="hljs-number">10</span>,    <span class="hljs-comment">// æœ€å°‘è½¨è¿¹ç‚¹æ•°</span>
      <span class="hljs-attr">maxLinearDeviation</span>: <span class="hljs-number">0.15</span>,   <span class="hljs-comment">// æœ€å¤§çº¿æ€§åå·®</span>
      <span class="hljs-attr">minSpeedVariance</span>: <span class="hljs-number">0.5</span>,      <span class="hljs-comment">// æœ€å°é€Ÿåº¦æ–¹å·®</span>
      <span class="hljs-attr">minCompletionTime</span>: <span class="hljs-number">200</span>,     <span class="hljs-comment">// æœ€å°å®Œæˆæ—¶é—´ï¼ˆmsï¼‰</span>
      <span class="hljs-attr">maxCompletionTime</span>: <span class="hljs-number">10000</span>    <span class="hljs-comment">// æœ€å¤§å®Œæˆæ—¶é—´ï¼ˆmsï¼‰</span>
    };
  }

  <span class="hljs-comment">// ç»¼åˆéªŒè¯</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">validate</span>(<span class="hljs-params">trajectory, finalX, finalY, captchaData, clientTimestamp</span>) {
    <span class="hljs-keyword">const</span> results = {
      <span class="hljs-attr">position</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">validatePosition</span>(finalX, finalY, captchaData),
      <span class="hljs-attr">trajectory</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">validateTrajectory</span>(trajectory),
      <span class="hljs-attr">speed</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">validateSpeed</span>(trajectory),
      <span class="hljs-attr">acceleration</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">validateAcceleration</span>(trajectory),
      <span class="hljs-attr">timeWindow</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">validateTimeWindow</span>(captchaData.<span class="hljs-property">createdAt</span>, clientTimestamp, trajectory)
    };

    <span class="hljs-comment">// è®¡ç®—ç»¼åˆå¾—åˆ†</span>
    <span class="hljs-keyword">const</span> totalScore = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">weights</span>).<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, key</span>) =&gt;</span> {
      <span class="hljs-keyword">return</span> sum + (results[key].<span class="hljs-property">score</span> * <span class="hljs-variable language_">this</span>.<span class="hljs-property">weights</span>[key]);
    }, <span class="hljs-number">0</span>);

    <span class="hljs-comment">// ä½ç½®éªŒè¯å¿…é¡»é€šè¿‡</span>
    <span class="hljs-keyword">const</span> isValid = results.<span class="hljs-property">position</span>.<span class="hljs-property">valid</span> &amp;&amp; totalScore &gt;= <span class="hljs-number">70</span>;

    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">valid</span>: isValid,
      <span class="hljs-attr">score</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(totalScore),
      <span class="hljs-attr">details</span>: results
    };
  }

  <span class="hljs-comment">// ä½ç½®éªŒè¯</span>
  <span class="hljs-title function_">validatePosition</span>(<span class="hljs-params">x, y, captchaData</span>) {
    <span class="hljs-keyword">const</span> xDiff = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(x - captchaData.<span class="hljs-property">targetX</span>);
    <span class="hljs-keyword">const</span> yDiff = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(y - captchaData.<span class="hljs-property">targetY</span>);
    <span class="hljs-keyword">const</span> tolerance = <span class="hljs-number">5</span>;

    <span class="hljs-keyword">const</span> valid = xDiff &lt;= tolerance &amp;&amp; yDiff &lt;= tolerance;

    <span class="hljs-keyword">return</span> {
      valid,
      <span class="hljs-attr">score</span>: valid ? <span class="hljs-number">100</span> : <span class="hljs-number">0</span>,
      <span class="hljs-attr">details</span>: { xDiff, yDiff, <span class="hljs-attr">targetX</span>: captchaData.<span class="hljs-property">targetX</span>, <span class="hljs-attr">targetY</span>: captchaData.<span class="hljs-property">targetY</span> }
    };
  }

  <span class="hljs-comment">// è½¨è¿¹éªŒè¯</span>
  <span class="hljs-title function_">validateTrajectory</span>(<span class="hljs-params">trajectory</span>) {
    <span class="hljs-keyword">if</span> (trajectory.<span class="hljs-property">length</span> &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">thresholds</span>.<span class="hljs-property">minTrajectoryPoints</span>) {
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">valid</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">score</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">reason</span>: <span class="hljs-string">`Too few trajectory points: <span class="hljs-subst">${trajectory.length}</span>`</span>
      };
    }

    <span class="hljs-comment">// è®¡ç®—è½¨è¿¹éçº¿æ€§åº¦</span>
    <span class="hljs-keyword">const</span> deviations = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">2</span>; i &lt; trajectory.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-keyword">const</span> p1 = trajectory[i - <span class="hljs-number">2</span>];
      <span class="hljs-keyword">const</span> p2 = trajectory[i - <span class="hljs-number">1</span>];
      <span class="hljs-keyword">const</span> p3 = trajectory[i];

      <span class="hljs-keyword">const</span> angle1 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">atan2</span>(p2.<span class="hljs-property">y</span> - p1.<span class="hljs-property">y</span>, p2.<span class="hljs-property">x</span> - p1.<span class="hljs-property">x</span>);
      <span class="hljs-keyword">const</span> angle2 = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">atan2</span>(p3.<span class="hljs-property">y</span> - p2.<span class="hljs-property">y</span>, p3.<span class="hljs-property">x</span> - p2.<span class="hljs-property">x</span>);
      <span class="hljs-keyword">const</span> deviation = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(angle2 - angle1);
      deviations.<span class="hljs-title function_">push</span>(deviation);
    }

    <span class="hljs-keyword">const</span> avgDeviation = deviations.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>) / deviations.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">const</span> isLinear = avgDeviation &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">thresholds</span>.<span class="hljs-property">maxLinearDeviation</span>;

    <span class="hljs-comment">// éçº¿æ€§åº¦è¶Šé«˜ï¼Œå¾—åˆ†è¶Šé«˜ï¼ˆäººç±»ç‰¹å¾ï¼‰</span>
    <span class="hljs-keyword">const</span> score = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-number">100</span>, avgDeviation * <span class="hljs-number">200</span>);

    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">valid</span>: !isLinear,
      score,
      <span class="hljs-attr">details</span>: { avgDeviation, <span class="hljs-attr">pointCount</span>: trajectory.<span class="hljs-property">length</span>, isLinear }
    };
  }

  <span class="hljs-comment">// é€Ÿåº¦éªŒè¯</span>
  <span class="hljs-title function_">validateSpeed</span>(<span class="hljs-params">trajectory</span>) {
    <span class="hljs-keyword">const</span> speeds = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; trajectory.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-keyword">const</span> prev = trajectory[i - <span class="hljs-number">1</span>];
      <span class="hljs-keyword">const</span> curr = trajectory[i];
      <span class="hljs-keyword">const</span> distance = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(
        <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(curr.<span class="hljs-property">x</span> - prev.<span class="hljs-property">x</span>, <span class="hljs-number">2</span>) + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(curr.<span class="hljs-property">y</span> - prev.<span class="hljs-property">y</span>, <span class="hljs-number">2</span>)
      );
      <span class="hljs-keyword">const</span> timeDiff = curr.<span class="hljs-property">t</span> - prev.<span class="hljs-property">t</span>;
      <span class="hljs-keyword">if</span> (timeDiff &gt; <span class="hljs-number">0</span>) {
        speeds.<span class="hljs-title function_">push</span>(distance / timeDiff);
      }
    }

    <span class="hljs-keyword">if</span> (speeds.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">valid</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">score</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">reason</span>: <span class="hljs-string">'No speed data'</span> };
    }

    <span class="hljs-keyword">const</span> avgSpeed = speeds.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>) / speeds.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">const</span> variance = speeds.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, speed</span>) =&gt;</span> {
      <span class="hljs-keyword">return</span> sum + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(speed - avgSpeed, <span class="hljs-number">2</span>);
    }, <span class="hljs-number">0</span>) / speeds.<span class="hljs-property">length</span>;

    <span class="hljs-keyword">const</span> isConstantSpeed = variance &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">thresholds</span>.<span class="hljs-property">minSpeedVariance</span>;

    <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æœ‰åŠ é€Ÿ-å‡é€Ÿè¿‡ç¨‹</span>
    <span class="hljs-keyword">let</span> hasAccelDecel = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">if</span> (speeds.<span class="hljs-property">length</span> &gt; <span class="hljs-number">10</span>) {
      <span class="hljs-keyword">const</span> mid = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(speeds.<span class="hljs-property">length</span> / <span class="hljs-number">2</span>);
      <span class="hljs-keyword">const</span> firstHalf = speeds.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, mid);
      <span class="hljs-keyword">const</span> secondHalf = speeds.<span class="hljs-title function_">slice</span>(mid);
      <span class="hljs-keyword">const</span> avgFirst = firstHalf.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>) / firstHalf.<span class="hljs-property">length</span>;
      <span class="hljs-keyword">const</span> avgSecond = secondHalf.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>) / secondHalf.<span class="hljs-property">length</span>;
      hasAccelDecel = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(avgFirst - avgSecond) &gt; avgSpeed * <span class="hljs-number">0.2</span>;
    }

    <span class="hljs-keyword">const</span> score = (!isConstantSpeed &amp;&amp; hasAccelDecel) ? <span class="hljs-number">100</span> : 
                  (!isConstantSpeed || hasAccelDecel) ? <span class="hljs-number">70</span> : <span class="hljs-number">30</span>;

    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">valid</span>: !isConstantSpeed,
      score,
      <span class="hljs-attr">details</span>: { variance, hasAccelDecel, avgSpeed, isConstantSpeed }
    };
  }

  <span class="hljs-comment">// åŠ é€Ÿåº¦éªŒè¯</span>
  <span class="hljs-title function_">validateAcceleration</span>(<span class="hljs-params">trajectory</span>) {
    <span class="hljs-keyword">const</span> speeds = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; trajectory.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-keyword">const</span> prev = trajectory[i - <span class="hljs-number">1</span>];
      <span class="hljs-keyword">const</span> curr = trajectory[i];
      <span class="hljs-keyword">const</span> distance = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(
        <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(curr.<span class="hljs-property">x</span> - prev.<span class="hljs-property">x</span>, <span class="hljs-number">2</span>) + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(curr.<span class="hljs-property">y</span> - prev.<span class="hljs-property">y</span>, <span class="hljs-number">2</span>)
      );
      <span class="hljs-keyword">const</span> timeDiff = curr.<span class="hljs-property">t</span> - prev.<span class="hljs-property">t</span>;
      <span class="hljs-keyword">if</span> (timeDiff &gt; <span class="hljs-number">0</span>) {
        speeds.<span class="hljs-title function_">push</span>({ <span class="hljs-attr">speed</span>: distance / timeDiff, <span class="hljs-attr">time</span>: curr.<span class="hljs-property">t</span> });
      }
    }

    <span class="hljs-keyword">if</span> (speeds.<span class="hljs-property">length</span> &lt; <span class="hljs-number">2</span>) {
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">valid</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">score</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">reason</span>: <span class="hljs-string">'Insufficient data'</span> };
    }

    <span class="hljs-keyword">const</span> accelerations = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; speeds.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-keyword">const</span> speedDiff = speeds[i].<span class="hljs-property">speed</span> - speeds[i - <span class="hljs-number">1</span>].<span class="hljs-property">speed</span>;
      <span class="hljs-keyword">const</span> timeDiff = speeds[i].<span class="hljs-property">time</span> - speeds[i - <span class="hljs-number">1</span>].<span class="hljs-property">time</span>;
      <span class="hljs-keyword">if</span> (timeDiff &gt; <span class="hljs-number">0</span>) {
        accelerations.<span class="hljs-title function_">push</span>(speedDiff / timeDiff);
      }
    }

    <span class="hljs-keyword">if</span> (accelerations.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">valid</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">score</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">reason</span>: <span class="hljs-string">'No acceleration data'</span> };
    }

    <span class="hljs-comment">// åˆ†æåŠ é€Ÿåº¦æ¨¡å¼</span>
    <span class="hljs-keyword">const</span> total = accelerations.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">const</span> firstThird = accelerations.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(total / <span class="hljs-number">3</span>));
    <span class="hljs-keyword">const</span> lastThird = accelerations.<span class="hljs-title function_">slice</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(total * <span class="hljs-number">2</span> / <span class="hljs-number">3</span>));

    <span class="hljs-keyword">const</span> avgFirst = firstThird.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>) / firstThird.<span class="hljs-property">length</span> || <span class="hljs-number">0</span>;
    <span class="hljs-keyword">const</span> avgLast = lastThird.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>) / lastThird.<span class="hljs-property">length</span> || <span class="hljs-number">0</span>;

    <span class="hljs-comment">// æ­£å¸¸æ¨¡å¼ï¼šå‰åŠæ®µåŠ é€Ÿï¼ˆæ­£åŠ é€Ÿåº¦ï¼‰ï¼ŒååŠæ®µå‡é€Ÿï¼ˆè´ŸåŠ é€Ÿåº¦ï¼‰</span>
    <span class="hljs-keyword">const</span> hasNaturalPattern = avgFirst &gt; <span class="hljs-number">0.03</span> &amp;&amp; avgLast &lt; -<span class="hljs-number">0.03</span>;

    <span class="hljs-keyword">const</span> score = hasNaturalPattern ? <span class="hljs-number">100</span> : 
                  (avgFirst &gt; <span class="hljs-number">0</span> || avgLast &lt; <span class="hljs-number">0</span>) ? <span class="hljs-number">60</span> : <span class="hljs-number">20</span>;

    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">valid</span>: hasNaturalPattern,
      score,
      <span class="hljs-attr">details</span>: { avgFirst, avgLast, hasNaturalPattern }
    };
  }

  <span class="hljs-comment">// æ—¶é—´çª—å£éªŒè¯</span>
  <span class="hljs-title function_">validateTimeWindow</span>(<span class="hljs-params">createdAt, clientTimestamp, trajectory</span>) {
    <span class="hljs-keyword">const</span> serverTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
    
    <span class="hljs-comment">// æ£€æŸ¥Redisä¸­çš„tokenæ˜¯å¦åœ¨æœ‰æ•ˆæœŸ</span>
    <span class="hljs-keyword">if</span> (serverTime - createdAt &gt; <span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>) {
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">valid</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">score</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">reason</span>: <span class="hljs-string">'Token expired'</span> };
    }

    <span class="hljs-comment">// æ£€æŸ¥å®¢æˆ·ç«¯å£°ç§°çš„å®Œæˆæ—¶é—´</span>
    <span class="hljs-keyword">const</span> claimedDuration = clientTimestamp - createdAt;
    <span class="hljs-keyword">if</span> (claimedDuration &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">thresholds</span>.<span class="hljs-property">minCompletionTime</span>) {
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">valid</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">score</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">reason</span>: <span class="hljs-string">'Suspiciously fast'</span> };
    }
    <span class="hljs-keyword">if</span> (claimedDuration &gt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">thresholds</span>.<span class="hljs-property">maxCompletionTime</span>) {
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">valid</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">score</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">reason</span>: <span class="hljs-string">'Suspiciously slow'</span> };
    }

    <span class="hljs-comment">// éªŒè¯è½¨è¿¹æ—¶é—´å’Œå£°ç§°æ—¶é—´æ˜¯å¦ä¸€è‡´ï¼ˆé˜²ç¯¡æ”¹ï¼‰</span>
    <span class="hljs-keyword">if</span> (trajectory.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">const</span> trajectoryDuration = trajectory[trajectory.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>].<span class="hljs-property">t</span>;
      <span class="hljs-keyword">const</span> timeDiff = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(trajectoryDuration - claimedDuration);
      <span class="hljs-keyword">if</span> (timeDiff &gt; <span class="hljs-number">1000</span>) { <span class="hljs-comment">// ç›¸å·®è¶…è¿‡1ç§’ï¼Œå¯èƒ½é€ å‡</span>
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">valid</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">score</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">reason</span>: <span class="hljs-string">'Time mismatch'</span> };
      }
    }

    <span class="hljs-keyword">return</span> { <span class="hljs-attr">valid</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">score</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">details</span>: { <span class="hljs-attr">duration</span>: claimedDuration } };
  }
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BehaviorValidator</span>();
</code></pre>
<h4 data-id="heading-25">3. Expressæ§åˆ¶å™¨</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/controllers/captcha.js</span>
<span class="hljs-keyword">const</span> captchaService = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../services/captcha'</span>);
<span class="hljs-keyword">const</span> behaviorValidator = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../services/validator'</span>);
<span class="hljs-keyword">const</span> redis = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../config/redis'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Joi</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'joi'</span>);

<span class="hljs-keyword">const</span> verifySchema = <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">object</span>({
  <span class="hljs-attr">token</span>: <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">string</span>().required(),
  <span class="hljs-attr">x</span>: <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">number</span>().required(),
  <span class="hljs-attr">y</span>: <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">number</span>().required(),
  <span class="hljs-attr">trajectory</span>: <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">array</span>().<span class="hljs-title function_">items</span>(
    <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">object</span>({
      <span class="hljs-attr">x</span>: <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">number</span>().required(),
      <span class="hljs-attr">y</span>: <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">number</span>().required(),
      <span class="hljs-attr">t</span>: <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">number</span>().required()
    })
  ).required(),
  <span class="hljs-attr">clientTimestamp</span>: <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">number</span>().required()
});

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CaptchaController</span> {
  <span class="hljs-comment">// è·å–éªŒè¯ç </span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getCaptcha</span>(<span class="hljs-params">req, res</span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// é™æµæ£€æŸ¥ï¼ˆå¯é€‰ï¼‰</span>
      <span class="hljs-keyword">const</span> clientIp = req.<span class="hljs-property">ip</span>;
      <span class="hljs-keyword">const</span> rateKey = <span class="hljs-string">`rate:<span class="hljs-subst">${clientIp}</span>`</span>;
      <span class="hljs-keyword">const</span> requestCount = <span class="hljs-keyword">await</span> redis.<span class="hljs-title function_">incr</span>(rateKey);
      <span class="hljs-keyword">if</span> (requestCount === <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">await</span> redis.<span class="hljs-title function_">expire</span>(rateKey, <span class="hljs-number">60</span>); <span class="hljs-comment">// 1åˆ†é’Ÿè¿‡æœŸ</span>
      }
      <span class="hljs-keyword">if</span> (requestCount &gt; <span class="hljs-number">10</span>) {
        <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">429</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'Too many requests'</span> });
      }

      <span class="hljs-keyword">const</span> captcha = <span class="hljs-keyword">await</span> captchaService.<span class="hljs-title function_">generate</span>();
      res.<span class="hljs-title function_">json</span>(captcha);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Generate captcha error:'</span>, error);
      res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'Failed to generate captcha'</span> });
    }
  }

  <span class="hljs-comment">// éªŒè¯éªŒè¯ç </span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">verifyCaptcha</span>(<span class="hljs-params">req, res</span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// å‚æ•°æ ¡éªŒ</span>
      <span class="hljs-keyword">const</span> { error, value } = verifySchema.<span class="hljs-title function_">validate</span>(req.<span class="hljs-property">body</span>);
      <span class="hljs-keyword">if</span> (error) {
        <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: error.<span class="hljs-property">details</span>[<span class="hljs-number">0</span>].<span class="hljs-property">message</span> });
      }

      <span class="hljs-keyword">const</span> { token, x, y, trajectory, clientTimestamp } = value;

      <span class="hljs-comment">// è·å–å­˜å‚¨çš„éªŒè¯ç æ•°æ®</span>
      <span class="hljs-keyword">const</span> captchaDataStr = <span class="hljs-keyword">await</span> redis.<span class="hljs-title function_">get</span>(<span class="hljs-string">`captcha:<span class="hljs-subst">${token}</span>`</span>);
      <span class="hljs-keyword">if</span> (!captchaDataStr) {
        <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>({ 
          <span class="hljs-attr">valid</span>: <span class="hljs-literal">false</span>, 
          <span class="hljs-attr">error</span>: <span class="hljs-string">'Captcha expired or invalid'</span> 
        });
      }

      <span class="hljs-keyword">const</span> captchaData = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(captchaDataStr);

      <span class="hljs-comment">// æ£€æŸ¥å°è¯•æ¬¡æ•°</span>
      captchaData.<span class="hljs-property">attempts</span> = (captchaData.<span class="hljs-property">attempts</span> || <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>;
      <span class="hljs-keyword">if</span> (captchaData.<span class="hljs-property">attempts</span> &gt; <span class="hljs-number">3</span>) {
        <span class="hljs-keyword">await</span> redis.<span class="hljs-title function_">del</span>(<span class="hljs-string">`captcha:<span class="hljs-subst">${token}</span>`</span>);
        <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>({ 
          <span class="hljs-attr">valid</span>: <span class="hljs-literal">false</span>, 
          <span class="hljs-attr">error</span>: <span class="hljs-string">'Too many attempts'</span> 
        });
      }
      <span class="hljs-keyword">await</span> redis.<span class="hljs-title function_">setex</span>(<span class="hljs-string">`captcha:<span class="hljs-subst">${token}</span>`</span>, <span class="hljs-number">300</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(captchaData));

      <span class="hljs-comment">// æ‰§è¡Œç»¼åˆéªŒè¯</span>
      <span class="hljs-keyword">const</span> validationResult = <span class="hljs-keyword">await</span> behaviorValidator.<span class="hljs-title function_">validate</span>(
        trajectory, x, y, captchaData, clientTimestamp
      );

      <span class="hljs-keyword">if</span> (validationResult.<span class="hljs-property">valid</span>) {
        <span class="hljs-comment">// éªŒè¯é€šè¿‡ï¼Œåˆ é™¤tokenå¹¶é¢å‘è®¿é—®token</span>
        <span class="hljs-keyword">await</span> redis.<span class="hljs-title function_">del</span>(<span class="hljs-string">`captcha:<span class="hljs-subst">${token}</span>`</span>);
        
        <span class="hljs-comment">// ç”Ÿæˆä¸´æ—¶è®¿é—®tokenï¼ˆç”¨äºåç»­ä¸šåŠ¡è¯·æ±‚ï¼‰</span>
        <span class="hljs-keyword">const</span> accessToken = <span class="hljs-built_in">require</span>(<span class="hljs-string">'crypto'</span>).<span class="hljs-title function_">randomBytes</span>(<span class="hljs-number">32</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-string">'hex'</span>);
        <span class="hljs-keyword">await</span> redis.<span class="hljs-title function_">setex</span>(<span class="hljs-string">`access:<span class="hljs-subst">${accessToken}</span>`</span>, <span class="hljs-number">600</span>, <span class="hljs-string">'verified'</span>);

        res.<span class="hljs-title function_">json</span>({
          <span class="hljs-attr">valid</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">score</span>: validationResult.<span class="hljs-property">score</span>,
          accessToken
        });
      } <span class="hljs-keyword">else</span> {
        res.<span class="hljs-title function_">json</span>({
          <span class="hljs-attr">valid</span>: <span class="hljs-literal">false</span>,
          <span class="hljs-attr">score</span>: validationResult.<span class="hljs-property">score</span>,
          <span class="hljs-attr">reason</span>: validationResult.<span class="hljs-property">details</span>,
          <span class="hljs-attr">remainingAttempts</span>: <span class="hljs-number">3</span> - captchaData.<span class="hljs-property">attempts</span>
        });
      }
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Verify captcha error:'</span>, error);
      res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'Verification failed'</span> });
    }
  }
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CaptchaController</span>();
</code></pre>
<h4 data-id="heading-26">4. å‰ç«¯é›†æˆç¤ºä¾‹</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>æ»‘å—éªŒè¯ç æ¼”ç¤º<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-class">.captcha-container</span> {
            <span class="hljs-attribute">position</span>: relative;
            <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">50px</span> auto;
            user-select: none;
        }
        <span class="hljs-selector-class">.captcha-bg</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">150px</span>;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
        }
        <span class="hljs-selector-class">.slider-track</span> {
            <span class="hljs-attribute">position</span>: relative;
            <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">40px</span>;
            <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">10px</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#e0e0e0</span>;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">20px</span>;
        }
        <span class="hljs-selector-class">.slider-btn</span> {
            <span class="hljs-attribute">position</span>: absolute;
            <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">width</span>: <span class="hljs-number">40px</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">40px</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff</span>;
            <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
            <span class="hljs-attribute">cursor</span>: pointer;
            <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">4px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.1</span>);
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">align-items</span>: center;
            <span class="hljs-attribute">justify-content</span>: center;
        }
        <span class="hljs-selector-class">.slider-btn</span><span class="hljs-selector-pseudo">::before</span> {
            <span class="hljs-attribute">content</span>: <span class="hljs-string">'â†’'</span>;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">18px</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#666</span>;
        }
        <span class="hljs-selector-class">.slider-text</span> {
            <span class="hljs-attribute">position</span>: absolute;
            <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>;
            <span class="hljs-attribute">top</span>: <span class="hljs-number">50%</span>;
            <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate</span>(-<span class="hljs-number">50%</span>, -<span class="hljs-number">50%</span>);
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#999</span>;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
        }
        <span class="hljs-selector-class">.success</span> {
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#52c41a</span> <span class="hljs-meta">!important</span>;
            <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#52c41a</span> <span class="hljs-meta">!important</span>;
        }
        <span class="hljs-selector-class">.success</span><span class="hljs-selector-pseudo">::before</span> {
            <span class="hljs-attribute">content</span>: <span class="hljs-string">'âœ“'</span>;
            <span class="hljs-attribute">color</span>: white;
        }
        <span class="hljs-selector-class">.failed</span> {
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#ff4d4f</span> <span class="hljs-meta">!important</span>;
            <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#ff4d4f</span> <span class="hljs-meta">!important</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"captcha-container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"bgImage"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"captcha-bg"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"éªŒè¯ç èƒŒæ™¯"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"slider-track"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"sliderBtn"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"slider-btn"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"slider-text"</span>&gt;</span>æ‹–åŠ¨æ»‘å—å®ŒæˆéªŒè¯<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">class</span> <span class="hljs-title class_">SliderCaptcha</span> {
            <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">token</span> = <span class="hljs-literal">null</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">trajectory</span> = [];
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">startTime</span> = <span class="hljs-literal">null</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">isDragging</span> = <span class="hljs-literal">false</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderBtn</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'sliderBtn'</span>);
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">bgImage</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'bgImage'</span>);
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">trackWidth</span> = <span class="hljs-number">260</span>; <span class="hljs-comment">// å¯æ‹–åŠ¨èŒƒå›´</span>
                
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>();
            }

            <span class="hljs-keyword">async</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
                <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadCaptcha</span>();
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">bindEvents</span>();
            }

            <span class="hljs-keyword">async</span> <span class="hljs-title function_">loadCaptcha</span>(<span class="hljs-params"/>) {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/captcha'</span>);
                    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
                    
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">token</span> = data.<span class="hljs-property">token</span>;
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">bgImage</span>.<span class="hljs-property">src</span> = <span class="hljs-string">`data:image/png;base64,<span class="hljs-subst">${data.bgImage}</span>`</span>;
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderData</span> = data;
                } <span class="hljs-keyword">catch</span> (error) {
                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to load captcha:'</span>, error);
                }
            }

            <span class="hljs-title function_">bindEvents</span>(<span class="hljs-params"/>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderBtn</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mousedown'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onDragStart</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mousemove'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onDragMove</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mouseup'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onDragEnd</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));

                <span class="hljs-comment">// ç§»åŠ¨ç«¯è§¦æ‘¸äº‹ä»¶</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderBtn</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'touchstart'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onDragStart</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'touchmove'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onDragMove</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'touchend'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onDragEnd</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
            }

            <span class="hljs-title function_">onDragStart</span>(<span class="hljs-params">e</span>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">isDragging</span> = <span class="hljs-literal">true</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">startTime</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">trajectory</span> = [];
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">startX</span> = e.<span class="hljs-property">type</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'touch'</span>) ? e.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientX</span> : e.<span class="hljs-property">clientX</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderStartLeft</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderBtn</span>.<span class="hljs-property">offsetLeft</span>;
            }

            <span class="hljs-title function_">onDragMove</span>(<span class="hljs-params">e</span>) {
                <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">isDragging</span>) <span class="hljs-keyword">return</span>;

                <span class="hljs-keyword">const</span> clientX = e.<span class="hljs-property">type</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'touch'</span>) ? e.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">clientX</span> : e.<span class="hljs-property">clientX</span>;
                <span class="hljs-keyword">const</span> deltaX = clientX - <span class="hljs-variable language_">this</span>.<span class="hljs-property">startX</span>;
                <span class="hljs-keyword">let</span> newLeft = <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderStartLeft</span> + deltaX;

                <span class="hljs-comment">// é™åˆ¶èŒƒå›´</span>
                newLeft = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(newLeft, <span class="hljs-variable language_">this</span>.<span class="hljs-property">trackWidth</span>));
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderBtn</span>.<span class="hljs-property">style</span>.<span class="hljs-property">left</span> = newLeft + <span class="hljs-string">'px'</span>;

                <span class="hljs-comment">// è®°å½•è½¨è¿¹ç‚¹</span>
                <span class="hljs-keyword">const</span> timestamp = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - <span class="hljs-variable language_">this</span>.<span class="hljs-property">startTime</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">trajectory</span>.<span class="hljs-title function_">push</span>({
                    <span class="hljs-attr">x</span>: newLeft,
                    <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// ç®€åŒ–å¤„ç†ï¼Œå‡è®¾Yä¸å˜</span>
                    <span class="hljs-attr">t</span>: timestamp
                });
            }

            <span class="hljs-keyword">async</span> <span class="hljs-title function_">onDragEnd</span>(<span class="hljs-params">e</span>) {
                <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">isDragging</span>) <span class="hljs-keyword">return</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">isDragging</span> = <span class="hljs-literal">false</span>;

                <span class="hljs-keyword">const</span> finalX = <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderBtn</span>.<span class="hljs-property">offsetLeft</span>;
                <span class="hljs-keyword">const</span> finalY = <span class="hljs-number">0</span>;

                <span class="hljs-keyword">try</span> {
                    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/captcha/verify'</span>, {
                        <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
                        <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> },
                        <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
                            <span class="hljs-attr">token</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">token</span>,
                            <span class="hljs-attr">x</span>: finalX,
                            <span class="hljs-attr">y</span>: finalY,
                            <span class="hljs-attr">trajectory</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">trajectory</span>,
                            <span class="hljs-attr">clientTimestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
                        })
                    });

                    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
                    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleResult</span>(result);
                } <span class="hljs-keyword">catch</span> (error) {
                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Verification failed:'</span>, error);
                    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">reset</span>();
                }
            }

            <span class="hljs-title function_">handleResult</span>(<span class="hljs-params">result</span>) {
                <span class="hljs-keyword">if</span> (result.<span class="hljs-property">valid</span>) {
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderBtn</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'success'</span>);
                    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.slider-text'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-string">'éªŒè¯æˆåŠŸ'</span>;
                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'éªŒè¯é€šè¿‡ï¼Œå¾—åˆ†:'</span>, result.<span class="hljs-property">score</span>);
                    
                    <span class="hljs-comment">// å¯ä»¥åœ¨è¿™é‡Œè§¦å‘åç»­ä¸šåŠ¡é€»è¾‘</span>
                    <span class="hljs-keyword">if</span> (result.<span class="hljs-property">accessToken</span>) {
                        <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'captchaToken'</span>, result.<span class="hljs-property">accessToken</span>);
                    }
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderBtn</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'failed'</span>);
                    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.slider-text'</span>).<span class="hljs-property">textContent</span> = 
                        <span class="hljs-string">`éªŒè¯å¤±è´¥ï¼Œè¿˜å‰©<span class="hljs-subst">${result.remainingAttempts || <span class="hljs-number">0</span>}</span>æ¬¡æœºä¼š`</span>;
                    
                    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
                        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">reset</span>();
                    }, <span class="hljs-number">1500</span>);
                }
            }

            <span class="hljs-title function_">reset</span>(<span class="hljs-params"/>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderBtn</span>.<span class="hljs-property">style</span>.<span class="hljs-property">left</span> = <span class="hljs-string">'0px'</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">sliderBtn</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'success'</span>, <span class="hljs-string">'failed'</span>);
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.slider-text'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-string">'æ‹–åŠ¨æ»‘å—å®ŒæˆéªŒè¯'</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadCaptcha</span>(); <span class="hljs-comment">// é‡æ–°åŠ è½½éªŒè¯ç </span>
            }
        }

        <span class="hljs-comment">// åˆå§‹åŒ–</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">SliderCaptcha</span>();
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-27">éƒ¨ç½²è¿è¡Œ</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. å®‰è£…ä¾èµ–</span>
npm install express redis canvas joi

<span class="hljs-comment"># 2. å¯åŠ¨Redis</span>
redis-server

<span class="hljs-comment"># 3. å¯åŠ¨æœåŠ¡</span>
node src/app.js

<span class="hljs-comment"># 4. è®¿é—®æµ‹è¯•</span>
open http://localhost:3000
</code></pre>
<h2 data-id="heading-28">ç»•è¿‡ä¸ååˆ¶ï¼šæ”»é˜²å®æˆ˜</h2>
<p>è¯´äº†é‚£ä¹ˆå¤šé˜²å¾¡ï¼Œæˆ‘ä»¬ä¹Ÿæ¥çœ‹çœ‹æ”»å‡»è€…æ˜¯æ€ä¹ˆæƒ³çš„ã€‚çŸ¥å·±çŸ¥å½¼ï¼Œæ‰èƒ½ç™¾æˆ˜ä¸æ®†ã€‚</p>
<h3 data-id="heading-29">å¸¸è§çš„ç»•è¿‡æ–¹æ¡ˆ</h3>
<h4 data-id="heading-30">1. Puppeteerè‡ªåŠ¨åŒ–ç ´è§£</h4>
<p>è¿™æ˜¯æœ€åŸºç¡€çš„è‡ªåŠ¨åŒ–æ–¹æ¡ˆï¼Œä½¿ç”¨æ— å¤´æµè§ˆå™¨æ¨¡æ‹Ÿäººç±»æ“ä½œã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ”»å‡»è€…è§†è§’ï¼ˆä»…ç”¨äºäº†è§£é˜²å¾¡ç­–ç•¥ï¼‰</span>
<span class="hljs-keyword">const</span> puppeteer = <span class="hljs-built_in">require</span>(<span class="hljs-string">'puppeteer'</span>);

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">crackCaptcha</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> browser = <span class="hljs-keyword">await</span> puppeteer.<span class="hljs-title function_">launch</span>();
  <span class="hljs-keyword">const</span> page = <span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">newPage</span>();
  
  <span class="hljs-keyword">await</span> page.<span class="hljs-title function_">goto</span>(<span class="hljs-string">'http://target.com'</span>);
  
  <span class="hljs-comment">// è·å–æ»‘å—å…ƒç´ </span>
  <span class="hljs-keyword">const</span> slider = <span class="hljs-keyword">await</span> page.$(<span class="hljs-string">'.slider-btn'</span>);
  <span class="hljs-keyword">const</span> sliderBox = <span class="hljs-keyword">await</span> slider.<span class="hljs-title function_">boundingBox</span>();
  
  <span class="hljs-comment">// æ¨¡æ‹Ÿäººç±»æ‹–åŠ¨ï¼ˆè´å¡å°”æ›²çº¿ï¼‰</span>
  <span class="hljs-keyword">await</span> page.<span class="hljs-property">mouse</span>.<span class="hljs-title function_">move</span>(sliderBox.<span class="hljs-property">x</span> + sliderBox.<span class="hljs-property">width</span> / <span class="hljs-number">2</span>, sliderBox.<span class="hljs-property">y</span> + sliderBox.<span class="hljs-property">height</span> / <span class="hljs-number">2</span>);
  <span class="hljs-keyword">await</span> page.<span class="hljs-property">mouse</span>.<span class="hljs-title function_">down</span>();
  
  <span class="hljs-comment">// ä½¿ç”¨è´å¡å°”æ›²çº¿æ¨¡æ‹Ÿéçº¿æ€§è½¨è¿¹</span>
  <span class="hljs-keyword">const</span> targetX = sliderBox.<span class="hljs-property">x</span> + <span class="hljs-number">150</span>; <span class="hljs-comment">// å‡è®¾ç›®æ ‡ä½ç½®</span>
  <span class="hljs-keyword">const</span> steps = <span class="hljs-number">50</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= steps; i++) {
    <span class="hljs-keyword">const</span> t = i / steps;
    <span class="hljs-comment">// è´å¡å°”æ›²çº¿å…¬å¼</span>
    <span class="hljs-keyword">const</span> x = sliderBox.<span class="hljs-property">x</span> + (targetX - sliderBox.<span class="hljs-property">x</span>) * (<span class="hljs-number">3</span> * t * t - <span class="hljs-number">2</span> * t * t * t);
    <span class="hljs-keyword">const</span> y = sliderBox.<span class="hljs-property">y</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(t * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>) * <span class="hljs-number">10</span>; <span class="hljs-comment">// æ·»åŠ Yè½´æ‰°åŠ¨</span>
    <span class="hljs-keyword">await</span> page.<span class="hljs-property">mouse</span>.<span class="hljs-title function_">move</span>(x, y);
    <span class="hljs-keyword">await</span> page.<span class="hljs-title function_">waitForTimeout</span>(<span class="hljs-number">10</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">20</span>); <span class="hljs-comment">// éšæœºå»¶è¿Ÿ</span>
  }
  
  <span class="hljs-keyword">await</span> page.<span class="hljs-property">mouse</span>.<span class="hljs-title function_">up</span>();
}
</code></pre>
<p><strong>é˜²å¾¡ç­–ç•¥</strong>ï¼š</p>
<ul>
<li>æ£€æµ‹ <code>navigator.webdriver</code> å±æ€§</li>
<li>åˆ†æè½¨è¿¹çš„éšæœºæ€§ï¼ˆè´å¡å°”æ›²çº¿è¿‡äºå¹³æ»‘ï¼‰</li>
<li>æ£€æŸ¥é¼ æ ‡äº‹ä»¶çš„çœŸå®æ€§</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å‰ç«¯æ£€æµ‹Puppeteer</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">detectAutomation</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> indicators = [
    navigator.<span class="hljs-property">webdriver</span>,
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">callPhantom</span>,
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">_phantom</span>,
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">Buffer</span>,
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">emit</span>
  ];
  
  <span class="hljs-keyword">if</span> (indicators.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> i)) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ£€æµ‹åˆ°è‡ªåŠ¨åŒ–å·¥å…·'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
</code></pre>
<h4 data-id="heading-31">2. AIè§†è§‰ç ´è§£</h4>
<p>ä½¿ç”¨è®¡ç®—æœºè§†è§‰æŠ€æœ¯è¯†åˆ«ç¼ºå£ä½ç½®ï¼Œç„¶åç›´æ¥æ‹–åŠ¨åˆ°ä½ã€‚</p>
<p><strong>é˜²å¾¡ç­–ç•¥</strong>ï¼š</p>
<ul>
<li>éšæœºç¼ºå£å½¢çŠ¶ï¼ˆä¸åªæ˜¯åœ†å½¢ï¼‰</li>
<li>å¹²æ‰°èƒŒæ™¯å›¾æ¡ˆ</li>
<li>åŠ¨æ€ç”Ÿæˆçš„ç¼ºå£è¾¹ç¼˜</li>
</ul>
<h4 data-id="heading-32">3. CAPTCHAå†œåœºï¼ˆäººå·¥æ‰“ç ï¼‰</h4>
<p>è¿™æ˜¯æœ€éš¾é˜²å¾¡çš„æ”»å‡»æ–¹å¼ã€‚æ”»å‡»è€…é›‡ä½£çœŸäººæ‰‹åŠ¨å®ŒæˆéªŒè¯ç ï¼Œç„¶åå‡ºå”®éªŒè¯tokenã€‚</p>
<pre><code class="hljs language-markdown" lang="markdown">CAPTCHAå†œåœºæµç¨‹:
<span class="hljs-bullet">1.</span> æ”»å‡»è€…ä»å†œåœºè´­ä¹°éªŒè¯token
<span class="hljs-bullet">2.</span> å†œåœºå·¥äººç™»å½•ç³»ç»Ÿï¼Œæ‰‹åŠ¨å®ŒæˆéªŒè¯
<span class="hljs-bullet">3.</span> tokenè¢«è½¬å–ç»™æ”»å‡»è€…ä½¿ç”¨
</code></pre>
<p><strong>é˜²å¾¡ç­–ç•¥</strong>ï¼š</p>
<ul>
<li>è½¨è¿¹ç›¸ä¼¼åº¦åˆ†æï¼ˆåŒä¸€å·¥äººçš„è½¨è¿¹æ¨¡å¼ç›¸ä¼¼ï¼‰</li>
<li>è®¾å¤‡æŒ‡çº¹ç»‘å®šï¼ˆtokenåªèƒ½åœ¨ä¸€å°è®¾å¤‡ä½¿ç”¨ï¼‰</li>
<li>åœ°ç†ä½ç½®åˆ†æï¼ˆæ£€æµ‹å¼‚å¸¸ç™»å½•åœ°ç‚¹ï¼‰</li>
<li>è¡Œä¸ºå…³è”åˆ†æï¼ˆçŸ­æ—¶é—´å¤§é‡ç›¸ä¼¼è½¨è¿¹ï¼‰</li>
</ul>
<h2 data-id="heading-33">è¿›é˜¶æ€è€ƒï¼šå¯¹æŠ—CAPTCHAå†œåœº</h2>
<p>æ ¹æ® 2025 å¹´ Multimedia Systems çš„ç ”ç©¶ "CAPTCHA farm detection and user authentication via mouse-trajectory similarity measurement"ï¼Œå¯ä»¥é€šè¿‡è½¨è¿¹ç›¸ä¼¼åº¦æ¥è¯†åˆ«åŒä¸€æ“ä½œè€…çš„å¤šæ¬¡æ“ä½œã€‚</p>
<h3 data-id="heading-34">è½¨è¿¹ç›¸ä¼¼åº¦ç®—æ³•</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è½¨è¿¹ç›¸ä¼¼åº¦è®¡ç®—ï¼ˆDTWç®—æ³•ç®€åŒ–ç‰ˆï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">calculateTrajectorySimilarity</span>(<span class="hljs-params">traj1, traj2</span>) {
  <span class="hljs-comment">// 1. å½’ä¸€åŒ–è½¨è¿¹</span>
  <span class="hljs-keyword">const</span> normalized1 = <span class="hljs-title function_">normalizeTrajectory</span>(traj1);
  <span class="hljs-keyword">const</span> normalized2 = <span class="hljs-title function_">normalizeTrajectory</span>(traj2);

  <span class="hljs-comment">// 2. è®¡ç®—DTWè·ç¦»</span>
  <span class="hljs-keyword">const</span> dtwDistance = <span class="hljs-title function_">dynamicTimeWarping</span>(normalized1, normalized2);

  <span class="hljs-comment">// 3. è½¬æ¢ä¸ºç›¸ä¼¼åº¦å¾—åˆ†</span>
  <span class="hljs-keyword">const</span> similarity = <span class="hljs-number">1</span> / (<span class="hljs-number">1</span> + dtwDistance);

  <span class="hljs-keyword">return</span> similarity;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">normalizeTrajectory</span>(<span class="hljs-params">trajectory</span>) {
  <span class="hljs-comment">// å½’ä¸€åŒ–åˆ°0-1èŒƒå›´</span>
  <span class="hljs-keyword">const</span> xs = trajectory.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> p.<span class="hljs-property">x</span>);
  <span class="hljs-keyword">const</span> ys = trajectory.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> p.<span class="hljs-property">y</span>);
  
  <span class="hljs-keyword">const</span> minX = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(...xs);
  <span class="hljs-keyword">const</span> maxX = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(...xs);
  <span class="hljs-keyword">const</span> minY = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(...ys);
  <span class="hljs-keyword">const</span> maxY = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(...ys);

  <span class="hljs-keyword">return</span> trajectory.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> ({
    <span class="hljs-attr">x</span>: (p.<span class="hljs-property">x</span> - minX) / (maxX - minX),
    <span class="hljs-attr">y</span>: (p.<span class="hljs-property">y</span> - minY) / (maxY - minY),
    <span class="hljs-attr">t</span>: p.<span class="hljs-property">t</span> / trajectory[trajectory.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>].<span class="hljs-property">t</span>
  }));
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">dynamicTimeWarping</span>(<span class="hljs-params">seq1, seq2</span>) {
  <span class="hljs-keyword">const</span> n = seq1.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">const</span> m = seq2.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">const</span> dtw = <span class="hljs-title class_">Array</span>(n + <span class="hljs-number">1</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-literal">null</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Array</span>(m + <span class="hljs-number">1</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-title class_">Infinity</span>));
  dtw[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">1</span>; j &lt;= m; j++) {
      <span class="hljs-keyword">const</span> cost = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(
        <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(seq1[i - <span class="hljs-number">1</span>].<span class="hljs-property">x</span> - seq2[j - <span class="hljs-number">1</span>].<span class="hljs-property">x</span>, <span class="hljs-number">2</span>) +
        <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(seq1[i - <span class="hljs-number">1</span>].<span class="hljs-property">y</span> - seq2[j - <span class="hljs-number">1</span>].<span class="hljs-property">y</span>, <span class="hljs-number">2</span>)
      );
      dtw[i][j] = cost + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(dtw[i - <span class="hljs-number">1</span>][j], dtw[i][j - <span class="hljs-number">1</span>], dtw[i - <span class="hljs-number">1</span>][j - <span class="hljs-number">1</span>]);
    }
  }

  <span class="hljs-keyword">return</span> dtw[n][m];
}
</code></pre>
<h3 data-id="heading-35">ä¼ä¸šçº§é˜²å¾¡ä½“ç³»</h3>
<pre><code class="hljs">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ä¼ä¸šçº§éªŒè¯ç é˜²å¾¡ä½“ç³»                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬ä¸€å±‚: åŸºç¡€éªŒè¯                                        â”‚
â”‚  â”œâ”€ ä½ç½®éªŒè¯                                            â”‚
â”‚  â”œâ”€ æ—¶é—´çª—å£æ§åˆ¶                                         â”‚
â”‚  â””â”€ å°è¯•æ¬¡æ•°é™åˆ¶                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬äºŒå±‚: è¡Œä¸ºåˆ†æ                                        â”‚
â”‚  â”œâ”€ è½¨è¿¹éçº¿æ€§æ£€æµ‹                                       â”‚
â”‚  â”œâ”€ é€Ÿåº¦å˜åŒ–åˆ†æ                                         â”‚
â”‚  â””â”€ åŠ é€Ÿåº¦æ¨¡å¼è¯†åˆ«                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬ä¸‰å±‚: æ™ºèƒ½é£æ§                                        â”‚
â”‚  â”œâ”€ è®¾å¤‡æŒ‡çº¹è¯†åˆ«                                         â”‚
â”‚  â”œâ”€ è½¨è¿¹ç›¸ä¼¼åº¦èšç±»                                       â”‚
â”‚  â””â”€ å¼‚å¸¸è¡Œä¸ºæ¨¡å¼è¯†åˆ«                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬å››å±‚: ä¸šåŠ¡è”åŠ¨                                        â”‚
â”‚  â”œâ”€ é£é™©è¯„åˆ†ç³»ç»Ÿ                                         â”‚
â”‚  â”œâ”€ åŠ¨æ€éš¾åº¦è°ƒæ•´                                         â”‚
â”‚  â””â”€ äºŒæ¬¡éªŒè¯è§¦å‘                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h2 data-id="heading-36">æ€»ç»“</h2>
<p>æ»‘å—éªŒè¯ç å°±åƒæ˜¯ä¸€åœºæ²¡æœ‰ç¡çƒŸçš„æˆ˜äº‰ã€‚ä½ ä»¥ä¸ºåªæ˜¯ç®€å•åœ°"æ‹–åŠ¨ä¸€ä¸‹"ï¼Œå®é™…ä¸ŠèƒŒåæ˜¯å·¥ç¨‹å¸ˆä»¬ç²¾å¿ƒè®¾è®¡çš„äº”é“é˜²çº¿åœ¨é»˜é»˜å·¥ä½œï¼š</p>
<h3 data-id="heading-37">ğŸ“ æ ¸å¿ƒè¦ç‚¹å›é¡¾</h3>
<ol>
<li>
<p><strong>ä½ç½®éªŒè¯</strong>ï¼šæœ€åŸºç¡€çš„åæ ‡æ ¡éªŒï¼Œä½†è¦æ³¨æ„åŠ å¯†ä¼ è¾“å’Œè¯¯å·®å®¹å¿åº¦</p>
</li>
<li>
<p><strong>è½¨è¿¹éçº¿æ€§æ£€æµ‹</strong>ï¼šäººç±»çš„"æ‰‹æŠ–"åè€Œæˆäº†å®‰å…¨ç‰¹å¾ï¼Œæœºå™¨è¿‡äºå®Œç¾çš„ç›´çº¿è¿åŠ¨ä¼šè¢«è¯†ç ´</p>
</li>
<li>
<p><strong>é€Ÿåº¦å˜åŒ–åˆ†æ</strong>ï¼šäººç±»æœ‰åŠ é€Ÿ-å‡é€Ÿè¿‡ç¨‹ï¼Œæœºå™¨äººå¾€å¾€æ˜¯åŒ€é€Ÿè¿åŠ¨</p>
</li>
<li>
<p><strong>åŠ é€Ÿåº¦æ¨¡å¼è¯†åˆ«</strong>ï¼šç¬¦åˆç‰©ç†è§„å¾‹çš„åŠ é€Ÿåº¦æ›²çº¿æ‰æ˜¯çœŸæ­£çš„"äººç±»ç­¾å"</p>
</li>
<li>
<p><strong>æ—¶é—´çª—å£æ§åˆ¶</strong>ï¼šå¤ªå¿«äº†æ˜¯è„šæœ¬ï¼Œå¤ªæ…¢äº†å¯èƒ½æ˜¯äººå·¥æ‰“ç ï¼Œ500ms-3sæ˜¯"é»„é‡‘æ—¶é—´"</p>
</li>
</ol>
<h3 data-id="heading-38">ğŸ’¡ å®æˆ˜ç»éªŒ</h3>
<ul>
<li><strong>ä¸è¦åªä¾èµ–ä¸€å±‚é˜²æŠ¤</strong>ï¼šå•ä¸€æ£€æµ‹å¾ˆå®¹æ˜“è¢«ç»•è¿‡ï¼Œå¤šå±‚æ£€æµ‹å åŠ æ‰èƒ½æœ‰æ•ˆé˜²å¾¡</li>
<li><strong>ç”¨æˆ·ä½“éªŒä¸å®‰å…¨æ€§çš„å¹³è¡¡</strong>ï¼šé˜ˆå€¼è®¾ç½®å¤ªä¸¥ä¼šè¯¯ä¼¤çœŸå®ç”¨æˆ·ï¼Œå¤ªæ¾åˆ™å¤±å»é˜²æŠ¤æ„ä¹‰</li>
<li><strong>æŒç»­å¯¹æŠ—</strong>ï¼šæ”»å‡»è€…åœ¨è¿›æ­¥ï¼Œé˜²å¾¡ç­–ç•¥ä¹Ÿè¦ä¸æ–­æ›´æ–°</li>
<li><strong>æ—¥å¿—ä¸ç›‘æ§</strong>ï¼šè®°å½•æ¯æ¬¡éªŒè¯çš„è¯¦ç»†æ•°æ®ï¼Œç”¨äºåç»­åˆ†æå’Œæ¨¡å‹ä¼˜åŒ–</li>
</ul>
<h3 data-id="heading-39">ğŸ”® æœªæ¥è¶‹åŠ¿</h3>
<ul>
<li><strong>æœºå™¨å­¦ä¹ èåˆ</strong>ï¼šç”¨AIå¯¹æŠ—AIï¼Œé€šè¿‡è¡Œä¸ºæ¨¡å¼è®­ç»ƒè¯†åˆ«æ¨¡å‹</li>
<li><strong>å¤šæ¨¡æ€éªŒè¯</strong>ï¼šç»“åˆç‚¹å‡»ã€æ»‘åŠ¨ã€é”®ç›˜æ“ä½œç­‰å¤šç»´åº¦è¡Œä¸º</li>
<li><strong>æ— æ„ŸéªŒè¯</strong>ï¼šåœ¨ç”¨æˆ·æ— æ„ŸçŸ¥çš„æƒ…å†µä¸‹å®ŒæˆéªŒè¯ï¼ˆå¦‚Googleçš„reCAPTCHA v3ï¼‰</li>
<li><strong>éšç§ä¿æŠ¤</strong>ï¼šå‡å°‘å¯¹ç”¨æˆ·è¡Œä¸ºçš„ä¾µå…¥å¼é‡‡é›†ï¼Œä¿æŠ¤ç”¨æˆ·éšç§</li>
</ul>
<p>æ»‘å—éªŒè¯ç çœ‹ä¼¼ç®€å•ï¼Œå®åˆ™æ·±è—ä¸éœ²ã€‚ä¸‹æ¬¡å½“ä½ é¡ºæ»‘åœ°å®Œæˆä¸€ä¸ªæ»‘å—éªŒè¯æ—¶ï¼Œä¸å¦¨æƒ³ä¸€æƒ³ï¼šè¿™ä¸€ç§’é’Ÿï¼Œæœ‰å¤šå°‘ä»£ç åœ¨ä¸ºä½ ä¿é©¾æŠ¤èˆªï¼Œåˆæœ‰å¤šå°‘æ”»å‡»è€…æ­£åœ¨ä¸ºçªç ´è¿™é“é˜²çº¿è€Œç»å°½è„‘æ±ã€‚</p>
<p>æŠ€æœ¯çš„æ”»é˜²ï¼Œæ°¸æ— æ­¢å¢ƒã€‚ä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘ä»¬è¦åšçš„ï¼Œå°±æ˜¯åœ¨ä¾¿åˆ©æ€§å’Œå®‰å…¨æ€§ä¹‹é—´æ‰¾åˆ°æœ€ä½³å¹³è¡¡ç‚¹ã€‚</p>
<hr/>
<p><strong>å‚è€ƒé“¾æ¥</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fadrsch%2Fslider-captcha" target="_blank" title="https://github.com/adrsch/slider-captcha" ref="nofollow noopener noreferrer">adrsch/slider-captcha</a> - React + Expresså®ç° - éªŒè¯çŠ¶æ€: âœ…</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fkartikmehta8%2Fcaptcha" target="_blank" title="https://github.com/kartikmehta8/captcha" ref="nofollow noopener noreferrer">kartikmehta8/captcha</a> - Node.js + Rediså®Œæ•´æ–¹æ¡ˆ - éªŒè¯çŠ¶æ€: âœ…</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Famakarov.dev%2Fcreate-slider-or-puzzle-captcha-service-with-node-js-4c25207f7264" target="_blank" title="https://amakarov.dev/create-slider-or-puzzle-captcha-service-with-node-js-4c25207f7264" ref="nofollow noopener noreferrer">Create Slider Captcha with Node.js</a> - MediumæŠ€æœ¯æ–‡ç«  - éªŒè¯çŠ¶æ€: âœ…</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æˆ‘å†™äº†ä¸ª Claude Code Skillï¼Œå†ä¹Ÿä¸ç”¨æ‰‹åŠ¨åˆ‡å›¾ä¼  COS äº†]]></title>    <link>https://juejin.cn/post/7604507125856829467</link>    <guid>https://juejin.cn/post/7604507125856829467</guid>    <pubDate>2026-02-09T07:31:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604507125856829467" data-draft-id="7604345576176631846" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æˆ‘å†™äº†ä¸ª Claude Code Skillï¼Œå†ä¹Ÿä¸ç”¨æ‰‹åŠ¨åˆ‡å›¾ä¼  COS äº†"/> <meta itemprop="keywords" content="Agent,Claude,å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-09T07:31:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="jerrywus"/> <meta itemprop="url" content="https://juejin.cn/user/2823201591402990"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æˆ‘å†™äº†ä¸ª Claude Code Skillï¼Œå†ä¹Ÿä¸ç”¨æ‰‹åŠ¨åˆ‡å›¾ä¼  COS äº†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2823201591402990/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    jerrywus
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T07:31:20.000Z" title="Mon Feb 09 2026 07:31:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>åˆ‡å›¾ã€å‹ç¼©ã€ä¼  COSã€å¤åˆ¶é“¾æ¥ã€ç²˜å›ä»£ç ã€‚ä¸€ä¸ªé¡µé¢ 5 å¼ å›¾å°±è¦é‡å¤ 5 éã€‚æˆ‘å—å¤Ÿäº†ï¼Œå†™äº†ä¸ª Skill æŠŠè¿™æ´»å„¿äº¤ç»™ AIã€‚</p>
</blockquote>
<h2 data-id="heading-0">èµ·å› ï¼šæ¯å¤©åœ¨ Figma å’Œ COS æ§åˆ¶å°ä¹‹é—´åå¤æ¨ªè·³</h2>
<p>æˆ‘åšå°ç¨‹åºå¼€å‘ï¼Œæ—¥å¸¸è·Ÿè®¾è®¡å¸ˆå¯¹æ¥ã€‚æ¯æ¬¡æ‹¿åˆ° Figma è®¾è®¡ç¨¿ï¼Œå†™ä»£ç ä¹‹å‰å¾—å…ˆå¤„ç†å›¾ç‰‡ï¼š</p>
<ol>
<li>Figma é‡Œä¸€å¼ å¼ åˆ‡å›¾å¯¼å‡º</li>
<li>æ‰“å¼€ TinyPNG ç½‘ç«™ï¼ŒæŠŠ PNG æ‹–è¿›å»å‹ç¼©</li>
<li>ç™»å½•è…¾è®¯äº‘ COS æ§åˆ¶å°ï¼Œä¸Šä¼ </li>
<li>å¤åˆ¶ CDN é“¾æ¥ï¼Œç²˜åˆ°ä»£ç é‡Œ</li>
<li>ä¸‹ä¸€å¼ ï¼Œé‡å¤</li>
</ol>
<p>ä¸€ä¸ªé¡µé¢ 5 å¼ å›¾ï¼Œè¿™å¥—æ“ä½œå°±è¦èµ° 5 éã€‚è¯´å®è¯ï¼Œè¿™æ´»å„¿è°å¹²è°çƒ¦ã€‚</p>
<p>åæ¥æˆ‘å‘ç° Claude Code æœ‰ä¸ª Skill æœºåˆ¶ï¼Œå¯ä»¥æ•™å®ƒæ‰§è¡Œè‡ªå®šä¹‰æµç¨‹ã€‚èŠ±äº†2å°æ—¶æŠ˜è…¾å‡ºæ¥ä¸€ä¸ª <code>image-auto-upload</code> Skillï¼Œç°åœ¨å›¾ç‰‡è¿™å—åŸºæœ¬ä¸ç”¨æˆ‘æ“å¿ƒäº†ã€‚</p>
<h2 data-id="heading-1">æ•ˆæœç›´æ¥çœ‹ä¸‹é¢çš„å›¾ç‰‡</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cac5b5ba7ad64125bdea9a126ef2c70a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgamVycnl3dXM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771227079&amp;x-signature=FBSY4DJmyk3BcPPpj8D0031lsU8%3D" alt="image.png" loading="lazy"/></p>
<p>æˆªå›¾é‡Œèƒ½çœ‹åˆ°æ•´ä¸ªé“¾è·¯ï¼š</p>
<ol>
<li>å·¦ä¸Šè§’æ˜¯ Figma è®¾è®¡ç¨¿</li>
<li>å·¦ä¾§ç»ˆç«¯é‡Œ Claude Code åœ¨è‡ªåŠ¨è¯†åˆ«å›¾ç‰‡ç´ æ</li>
<li>ä¸­é—´æ˜¯tinypngå‹ç¼© + ä¸Šä¼  COS çš„è¿‡ç¨‹</li>
<li>å³ä¸Šè§’ COS æ§åˆ¶å°é‡Œæ–‡ä»¶å·²ç»ä¸Šä¼ æˆæˆåŠŸ</li>
<li>å³ä¸‹è§’æ˜¯å°ç¨‹åºé‡Œçš„æœ€ç»ˆæ•ˆæœ</li>
</ol>
<p>æˆ‘å°±è¾“å…¥äº†ä¸€å¥"æ ¹æ® Figma è®¾è®¡ç¨¿å®ç°è¿™ä¸ªé¡µé¢ï¼ˆè‡ªè¡Œåˆ‡å›¾ä¸Šä¼ æ›¿æ¢ï¼‰"ï¼Œå®ƒè‡ªå·±å…¨åŠäº†ã€‚</p>
<h2 data-id="heading-2">Skill æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿</h2>
<p>ç®€å•è¯´ï¼ŒSkill å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ”¾åœ¨ <code>.claude/skills/</code> ä¸‹é¢ï¼Œé‡Œé¢å‘Šè¯‰ Claude æ€ä¹ˆå®ŒæˆæŸä¸ªç‰¹å®šä»»åŠ¡ã€‚</p>
<p>Claude Code æœ¬èº«èƒ½è¯»ä»£ç ã€å†™ä»£ç ã€è·‘å‘½ä»¤ï¼Œä½†å®ƒä¸çŸ¥é“ä½ ä»¬é¡¹ç›®çš„å›¾ç‰‡è¦ä¼ åˆ°å“ªä¸ª COS Bucketï¼Œä¸çŸ¥é“ PNG è¦å…ˆå‹ç¼©ï¼Œä¸çŸ¥é“ä¸Šä¼ è·¯å¾„çš„å‰ç¼€è§„åˆ™ã€‚è¿™äº›"é¡¹ç›®ç§è´§"ï¼Œä½ å¾—è‡ªå·±æ•™å®ƒã€‚Skill å°±æ˜¯å¹²è¿™ä¸ªçš„ã€‚</p>
<p>ç›®å½•ç»“æ„é•¿è¿™æ ·ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">.claude/skills/image-auto-upload/
â”œâ”€â”€ SKILL.md              <span class="hljs-comment"># ç»™ Claude çœ‹çš„æ“ä½œæ‰‹å†Œ</span>
â”œâ”€â”€ README.md             <span class="hljs-comment"># ç»™äººçœ‹çš„ä½¿ç”¨æ–‡æ¡£</span>
â”œâ”€â”€ resources/            <span class="hljs-comment"># æ”¾å¾…ä¸Šä¼ çš„å›¾ç‰‡</span>
â”‚   â””â”€â”€ README.md
â””â”€â”€ scripts/              <span class="hljs-comment"># æ‰§è¡Œè„šæœ¬</span>
    â”œâ”€â”€ upload_images.cjs  <span class="hljs-comment"># Node.js ä¸Šä¼ è„šæœ¬</span>
    â””â”€â”€ compress_png.py    <span class="hljs-comment"># Python å‹ç¼©è„šæœ¬</span>
</code></pre>
<p>æœ€æ ¸å¿ƒçš„æ˜¯ <code>SKILL.md</code>ã€‚Claude è¯»è¿™ä¸ªæ–‡ä»¶æ¥ç†è§£ï¼šä»€ä¹ˆæ—¶å€™è¯¥ç”¨è¿™ä¸ªæŠ€èƒ½ã€å…·ä½“æ€ä¹ˆæ“ä½œã€è°ƒä»€ä¹ˆè„šæœ¬ã€ç»“æœæ€ä¹ˆå±•ç¤ºã€‚</p>
<h2 data-id="heading-3">SKILL.md æ€ä¹ˆå†™</h2>
<p>è¿™ä¸ªæ–‡ä»¶å†™å¾—å¥½ä¸å¥½ï¼Œç›´æ¥å†³å®š Claude èƒ½ä¸èƒ½æ­£ç¡®å¹²æ´»ã€‚æˆ‘æ‹†å¼€è®²è®²ã€‚</p>
<h3 data-id="heading-4">è§¦å‘åœºæ™¯</h3>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">## è§¦å‘åœºæ™¯</span>

<span class="hljs-section">### åœºæ™¯ 1ï¼šFigma è®¾è®¡ç¨¿å®ç°</span>
å½“æ ¹æ® Figma è®¾è®¡ç¨¿å®ç°é¡µé¢æ—¶ï¼Œå¦‚æœè®¾è®¡ç¨¿ä¸­åŒ…å«å›¾ç‰‡ç´ æï¼š
<span class="hljs-bullet">1.</span> åˆ—å‡ºå¯ä¸Šä¼ çš„å›¾ç‰‡ç´ æï¼ˆå›¾ç‰‡åç§°ã€ç±»å‹ã€ç”¨é€”ï¼‰
<span class="hljs-bullet">2.</span> ç­‰å¾…ç”¨æˆ·ç¡®è®¤éœ€è¦ä¸Šä¼ å“ªäº›å›¾ç‰‡
<span class="hljs-bullet">3.</span> æ‰§è¡Œä¸Šä¼ å¹¶è¿”å› CDN URL

<span class="hljs-section">### åœºæ™¯ 2ï¼šç›´æ¥ä¸Šä¼ </span>
å½“ç”¨æˆ·ç›´æ¥å‘ŠçŸ¥éœ€è¦ä¸Šä¼ çš„å›¾ç‰‡æˆ–å›¾ç‰‡æ–‡ä»¶å¤¹æ—¶ï¼Œç›´æ¥æ‰§è¡Œä¸Šä¼ æµç¨‹ã€‚
</code></pre>
<p>ä¸¤ç§è§¦å‘æ–¹å¼ã€‚ä¸€ç§æ˜¯å®ç° Figma è®¾è®¡ç¨¿æ—¶ Claude è‡ªå·±å‘ç°æœ‰å›¾ç‰‡ï¼Œä¼šå…ˆé—®ä½ è¦ä¸è¦ä¸Šä¼ ï¼›å¦ä¸€ç§æ˜¯ä½ ç›´æ¥è¯´"ä¸Šä¼ å›¾ç‰‡"ï¼Œå®ƒç«‹åˆ»æ‰§è¡Œã€‚</p>
<p>æˆ‘ä¸€å¼€å§‹åªå†™äº†ç¬¬äºŒç§ï¼Œåæ¥å‘ç°é…åˆ Figma Agent ç”¨çš„æ—¶å€™ï¼ŒClaude ä¸çŸ¥é“è¯¥ä¸»åŠ¨å¤„ç†å›¾ç‰‡ï¼Œè¿˜å¾—æˆ‘æ‰‹åŠ¨æé†’ã€‚åŠ ä¸Šç¬¬ä¸€ç§ä¹‹åå°±é¡ºç•…äº†ã€‚</p>
<h3 data-id="heading-5">å¤„ç†æµç¨‹</h3>
<pre><code class="hljs language-objectivec" lang="objectivec">å°†å›¾ç‰‡æ”¾å…¥ resources/ æ–‡ä»¶å¤¹
      â”‚
      â–¼
  æ˜¯å›¾ç‰‡æ–‡ä»¶ï¼Ÿ(png/jpg/jpeg/webp/gif/svg)
      â”‚
  â”Œâ”€â”€â”€â”´â”€â”€â”€â”
 <span class="hljs-literal">YES</span>     <span class="hljs-literal">NO</span> â†’ è·³è¿‡
  â”‚
  â–¼
  æ˜¯ PNG æ ¼å¼ï¼Ÿ
  â”Œâ”€â”€â”€â”´â”€â”€â”€â”
 <span class="hljs-literal">YES</span>     <span class="hljs-literal">NO</span>
  â”‚       â”‚
  â–¼       â”‚
è‡ªåŠ¨å‹ç¼©   â”‚
  â”‚       â”‚
  â””â”€â”€â”€â”¬â”€â”€â”€â”˜
      â”‚
      â–¼
 ä¸Šä¼ åˆ° Tencent COS
      â”‚
      â–¼
  è¿”å› CDN URL
      â”‚
      â–¼
 è‡ªåŠ¨æ¸…ç†æºæ–‡ä»¶
</code></pre>
<p>å‡ ä¸ªè®¾è®¡ä¸Šçš„è€ƒè™‘ï¼š</p>
<ul>
<li>PNG å…ˆè¿‡ TinyPNG API å‹ç¼©å†ä¼ ï¼ŒJPG/WebP ç›´æ¥ä¼ ã€‚PNG å‹ç¼©ç‡ä¸€èˆ¬åœ¨ 60%-80%ï¼Œçœçš„æµé‡è¿˜æ˜¯æŒºå¯è§‚çš„</li>
<li><code>.DS_Store</code> ä¹‹ç±»çš„æ‚æ–‡ä»¶è‡ªåŠ¨è·³è¿‡ï¼Œä¸ç”¨æ‰‹åŠ¨æ¸…ç†</li>
<li>ä¼ å®Œè‡ªåŠ¨åˆ æºæ–‡ä»¶ã€‚ä¸€å¼€å§‹æˆ‘æ²¡åŠ è¿™ä¸ªï¼Œresources ç›®å½•è¶Šæ¥è¶Šå¤§ï¼Œåæ¥åŠ äº†è‡ªåŠ¨æ¸…ç†</li>
</ul>
<h3 data-id="heading-6">è¾“å‡ºæ ¼å¼</h3>
<pre><code class="hljs language-markdown" lang="markdown">| å›¾ç‰‡åç§° | CDN URL |
|----------|---------|
| icon.png | https://xxx.cos.ap-nanjing.myqcloud.com/applet/icon.png |
| bg.jpg   | https://xxx.cos.ap-nanjing.myqcloud.com/applet/bg.jpg |
</code></pre>
<p>ä¸Šä¼ å®Œç”¨è¡¨æ ¼å±•ç¤ºç»“æœï¼Œæ–¹ä¾¿ç›´æ¥å¤åˆ¶ URLã€‚</p>
<h2 data-id="heading-7">ä¸¤ä¸ªè„šæœ¬ï¼Œä¸€ä¸ªå‹ç¼©ä¸€ä¸ªä¼ </h2>
<p>æ•´ä¸ª Skill é ä¸¤ä¸ªè„šæœ¬å¹²æ´»ã€‚</p>
<h3 data-id="heading-8">PNG å‹ç¼©ï¼ˆcompress_png.pyï¼‰</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> tinify

<span class="hljs-keyword">def</span> <span class="hljs-title function_">compress_image</span>(<span class="hljs-params">input_path, output_path=<span class="hljs-literal">None</span></span>):
    tinify.key = TINYPNG_API_KEY  <span class="hljs-comment"># ä» .env.skills è¯»å–</span>

    input_size = input_file.stat().st_size
    source = tinify.from_file(<span class="hljs-built_in">str</span>(input_file))
    source.to_file(<span class="hljs-built_in">str</span>(output_path))  <span class="hljs-comment"># å‹ç¼©åè¦†ç›–åŸæ–‡ä»¶</span>
    output_size = output_path.stat().st_size

    compression_ratio = <span class="hljs-built_in">round</span>((<span class="hljs-number">1</span> - output_size / input_size) * <span class="hljs-number">100</span>, <span class="hljs-number">2</span>)
    <span class="hljs-keyword">return</span> { <span class="hljs-string">"compression_ratio"</span>: compression_ratio }
</code></pre>
<p>é€»è¾‘å¾ˆç›´ç™½ï¼šè¯»æ–‡ä»¶ã€è°ƒ TinyPNG APIã€å†™å›å»è¦†ç›–åŸæ–‡ä»¶ã€‚TinyPNG å…è´¹é¢åº¦æ¯æœˆ 500 æ¬¡ï¼Œä¸ªäººé¡¹ç›®å®Œå…¨å¤Ÿç”¨ã€‚</p>
<h3 data-id="heading-9">COS ä¸Šä¼ ï¼ˆupload_images.cjsï¼‰</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">COS</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cos-nodejs-sdk-v5'</span>);

<span class="hljs-comment">// ä¸Šä¼ å•ä¸ªæ–‡ä»¶ï¼ˆåˆ†ç‰‡ä¸Šä¼ ï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">uploadFile</span>(<span class="hljs-params">filePath, key</span>) {
  <span class="hljs-comment">// 1. åˆå§‹åŒ–åˆ†ç‰‡ä¸Šä¼ </span>
  cos.<span class="hljs-title function_">multipartInit</span>({ <span class="hljs-title class_">Bucket</span>, <span class="hljs-title class_">Region</span>, <span class="hljs-title class_">Key</span> }, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {
    <span class="hljs-comment">// 2. ä¸Šä¼ åˆ†ç‰‡</span>
    cos.<span class="hljs-title function_">multipartUpload</span>({ ... <span class="hljs-title class_">Body</span>: fs.<span class="hljs-title function_">createReadStream</span>(filePath) }, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// 3. å®Œæˆä¸Šä¼ </span>
      cos.<span class="hljs-title function_">multipartComplete</span>({ ... });
    });
  });
}

<span class="hljs-comment">// ä¸Šä¼ æ•´ä¸ªæ–‡ä»¶å¤¹ï¼ˆé€’å½’å­ç›®å½•ï¼‰</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">uploadFolder</span>(<span class="hljs-params">folderPath, prefix</span>) {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> file <span class="hljs-keyword">of</span> files) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isImageFile</span>(file)) <span class="hljs-keyword">continue</span>;  <span class="hljs-comment">// è·³è¿‡éå›¾ç‰‡</span>
    <span class="hljs-title function_">compressPng</span>(file);                  <span class="hljs-comment">// PNG å…ˆå‹ç¼©</span>
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">uploadFile</span>(file, key);        <span class="hljs-comment">// ä¼ åˆ° COS</span>
    fs.<span class="hljs-title function_">unlinkSync</span>(file);               <span class="hljs-comment">// åˆ æºæ–‡ä»¶</span>
  }
}
</code></pre>
<p>ç”¨äº† COS SDK çš„åˆ†ç‰‡ä¸Šä¼ ï¼Œæ”¯æŒé€’å½’å­ç›®å½•ã€‚ä¸Šä¼ æˆåŠŸåˆ æºæ–‡ä»¶ï¼Œå¤±è´¥çš„ç•™ç€æ–¹ä¾¿é‡è¯•ã€‚</p>
<h3 data-id="heading-10">å¯†é’¥æ”¾å“ª</h3>
<p>COS å¯†é’¥å’Œ TinyPNG API Key æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•çš„ <code>.env.skills</code> é‡Œï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># .env.skillsï¼ˆè®°å¾—åŠ  .gitignoreï¼‰</span>
COS_BUCKET=your-bucket-name
COS_REGION=ap-nanjing
COS_UPLOAD_PREFIX=applet
TINYPNG_API_KEY=your-tinypng-api-key
</code></pre>
<p>è¿™ä¸ªæ–‡ä»¶ä¸è¿› Gitï¼Œå¯†é’¥ä¸ä¼šæ³„éœ²ã€‚</p>
<h2 data-id="heading-11">å®é™…ç”¨èµ·æ¥æ˜¯ä»€ä¹ˆæ„Ÿè§‰</h2>
<h3 data-id="heading-12">é…åˆ Figma ç”¨ï¼ˆæˆ‘æœ€å¸¸ç”¨çš„æ–¹å¼ï¼‰</h3>
<p>æˆ‘é¡¹ç›®é‡Œè¿˜æœ‰ä¸ª <code>figma-designer</code> Agentï¼Œé…ç½®é‡Œå†™äº†ä¸€æ¡ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">é‡åˆ°å›¾ç‰‡ï¼Œå…ˆè‡ªåŠ¨åˆ‡åˆ°æœ¬åœ°ï¼Œç„¶åè°ƒç”¨ skills è¿›è¡Œå‹ç¼©ä¸Šä¼  COSï¼Œç„¶åæ›¿æ¢ä»£ç 
</code></pre>
<p>æ‰€ä»¥æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>
<ol>
<li>æˆ‘åœ¨ Figma é‡Œé€‰ä¸­è¦å®ç°çš„é¡µé¢</li>
<li>åœ¨ Claude Code é‡Œè¯´"æ ¹æ® Figma è®¾è®¡ç¨¿å®ç°è¿™ä¸ªé¡µé¢"</li>
<li>Claude é€šè¿‡ Figma MCP è¯»è®¾è®¡ç¨¿ï¼Œè¯†åˆ«å‡ºå›¾ç‰‡ç´ æ</li>
<li>è‡ªåŠ¨å¯¼å‡ºå›¾ç‰‡ â†’ å‹ç¼© PNG â†’ ä¼  COS â†’ æ‹¿åˆ° CDN URL</li>
<li>ç”¨ URL æ›¿æ¢ä»£ç é‡Œçš„å›¾ç‰‡å¼•ç”¨ï¼Œç”Ÿæˆ Vue ç»„ä»¶</li>
</ol>
<p>æˆ‘åªç®¡æœ€åçœ‹ä¸€çœ¼ä»£ç å¯¹ä¸å¯¹ã€‚ä¸­é—´å›¾ç‰‡é‚£ä¸€å †äº‹ï¼Œå®Œå…¨ä¸ç”¨ç®¡ã€‚</p>
<p>è¯´å®è¯ç¬¬ä¸€æ¬¡è·‘é€šçš„æ—¶å€™è¿˜æŒºæ„å¤–çš„ï¼Œæ²¡æƒ³åˆ°å‡ ä¸ªå·¥å…·ä¸²èµ·æ¥èƒ½è¿™ä¹ˆé¡ºã€‚</p>
<h3 data-id="heading-13">æ‰‹åŠ¨ä¼ å‡ å¼ å›¾</h3>
<p>æœ‰æ—¶å€™è®¾è®¡å¸ˆå•ç‹¬ä¸¢å‡ å¼ å›¾è¿‡æ¥ï¼Œä¸èµ° Figma æµç¨‹ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">æˆ‘ï¼šå¸®æˆ‘ä¸Šä¼  resources é‡Œçš„å›¾ç‰‡

Claudeï¼šå‘ç° resources ç›®å½•ä¸‹æœ‰ <span class="hljs-number">3</span> å¼ å›¾ç‰‡ï¼š
- banner<span class="hljs-selector-class">.png</span> (PNGï¼Œå°†è‡ªåŠ¨å‹ç¼©)
- <span class="hljs-attribute">icon</span>-success<span class="hljs-selector-class">.png</span> (PNGï¼Œå°†è‡ªåŠ¨å‹ç¼©)
- photo<span class="hljs-selector-class">.jpg</span> (JPGï¼Œç›´æ¥ä¸Šä¼ )

æ­£åœ¨å¤„ç†...

<span class="hljs-selector-attr">[banner.png]</span> æ­£åœ¨å‹ç¼© PNG... å‹ç¼©å®Œæˆ (<span class="hljs-number">72%</span> reduction)
<span class="hljs-selector-attr">[banner.png]</span> ä¸Šä¼ å®Œæˆ
<span class="hljs-selector-attr">[icon-success.png]</span> æ­£åœ¨å‹ç¼© PNG... å‹ç¼©å®Œæˆ (<span class="hljs-number">65%</span> reduction)
<span class="hljs-selector-attr">[icon-success.png]</span> ä¸Šä¼ å®Œæˆ
<span class="hljs-selector-attr">[photo.jpg]</span> ä¸Šä¼ å®Œæˆ

========== ä¸Šä¼ å®Œæˆ ==========
æˆåŠŸ: <span class="hljs-number">3</span> ä¸ªæ–‡ä»¶
å¤±è´¥: <span class="hljs-number">0</span> ä¸ªæ–‡ä»¶

| å›¾ç‰‡åç§° | CDN URL |
|----------|---------|
| banner.png | https://xxx.cos.../applet/banner.png |
| icon-success.png | https://xxx.cos.../applet/icon-success.png |
| photo.jpg | https://xxx.cos.../applet/photo.jpg |

æºæ–‡ä»¶å·²è‡ªåŠ¨æ¸…ç†ã€‚
</code></pre>
<h3 data-id="heading-14">æ‰¹é‡ä¼ ä¸€æ•´å¥—å›¾</h3>
<p>æ¯”å¦‚ä¸€æ¬¡æ€§ä¼ ä¸€å¥—å›¾æ ‡ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">resources/
â”œâ”€â”€ icons/
â”‚   â”œâ”€â”€ home.png
â”‚   â”œâ”€â”€ cart.png
â”‚   â””â”€â”€ user.png
â””â”€â”€ backgrounds/
    â”œâ”€â”€ login-bg.jpg
    â””â”€â”€ main-bg.jpg
</code></pre>
<p>ä¸Šä¼ åç›®å½•ç»“æ„åŸæ ·ä¿ç•™ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">applet/icons/home.png
applet/icons/cart.png
applet/icons/user.png
applet/backgrounds/login-bg.jpg
applet/backgrounds/main-bg.jpg
</code></pre>
<p>è¿™ä¸ªæˆ‘è¸©è¿‡å‘ã€‚ä¸€å¼€å§‹ä¸Šä¼ è„šæœ¬ä¸æ”¯æŒå­ç›®å½•ï¼Œæ‰€æœ‰æ–‡ä»¶éƒ½å¹³é“ºåˆ°æ ¹è·¯å¾„ä¸‹ï¼Œæ–‡ä»¶åä¸€å†²çªå°±è¦†ç›–äº†ã€‚åæ¥åŠ äº†é€’å½’ç›®å½•æ”¯æŒæ‰è§£å†³ã€‚</p>
<h2 data-id="heading-15">æƒ³è‡ªå·±æä¸€ä¸ªï¼Ÿç…§ç€æ¥</h2>
<h3 data-id="heading-16">1. å»ºç›®å½•</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> -p .claude/skills/image-auto-upload/{scripts,resources}
</code></pre>
<h3 data-id="heading-17">2. è£…ä¾èµ–</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># PNG å‹ç¼©</span>
pip install tinify

<span class="hljs-comment"># COS ä¸Šä¼ </span>
npm install cos-nodejs-sdk-v5
</code></pre>
<h3 data-id="heading-18">3. é…ç¯å¢ƒå˜é‡</h3>
<p>é¡¹ç›®æ ¹ç›®å½•å»º <code>.env.skills</code>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">COS_BUCKET=your-bucket-name
COS_REGION=ap-nanjing
COS_UPLOAD_PREFIX=your-prefix
TINYPNG_API_KEY=your-tinypng-api-key
</code></pre>
<p>TinyPNG API Key å» <a href="https://link.juejin.cn?target=https%3A%2F%2Ftinypng.com%2Fdevelopers" target="_blank" title="https://tinypng.com/developers" ref="nofollow noopener noreferrer">tinypng.com/developers</a> ç”³è¯·ï¼Œå…è´¹çš„ï¼Œæ¯æœˆ 500 æ¬¡é¢åº¦ã€‚</p>
<h3 data-id="heading-19">4. å†™ SKILL.md</h3>
<p>è¿™æ­¥æœ€èŠ±æ—¶é—´ï¼Œä¹Ÿæœ€å€¼å¾—èŠ±æ—¶é—´ã€‚å‡ ä¸ªç»éªŒï¼š</p>
<ol>
<li>è§¦å‘åœºæ™¯å†™æ¸…æ¥šï¼Œä¸ç„¶ Claude ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™è¯¥ç”¨</li>
<li>æµç¨‹ç”¨æµç¨‹å›¾æˆ–æ­¥éª¤åˆ—è¡¨ï¼Œåˆ«å†™å¤§æ®µæ–‡å­—</li>
<li>å‘½ä»¤ç»™å®Œæ•´çš„ï¼Œèƒ½ç›´æ¥å¤åˆ¶æ‰§è¡Œçš„é‚£ç§</li>
<li>å®šä¹‰å¥½è¾“å‡ºæ ¼å¼ï¼Œä¸ç„¶æ¯æ¬¡è¿”å›çš„ç»“æœæ ¼å¼éƒ½ä¸ä¸€æ ·</li>
</ol>
<p>æˆ‘ç¬¬ä¸€ç‰ˆ SKILL.md å†™å¾—å¤ªç®€ç•¥ï¼ŒClaude ç»å¸¸æ¼æ­¥éª¤ã€‚åæ¥è¡¥äº†æµç¨‹å›¾å’Œå…·ä½“å‘½ä»¤ï¼Œå°±ç¨³å®šå¤šäº†ã€‚</p>
<h3 data-id="heading-20">5. åŠ  .gitignore</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">".env.skills"</span> &gt;&gt; .gitignore
<span class="hljs-built_in">echo</span> <span class="hljs-string">".claude/skills/image-auto-upload/resources/*"</span> &gt;&gt; .gitignore
<span class="hljs-built_in">echo</span> <span class="hljs-string">"!.claude/skills/image-auto-upload/resources/README.md"</span> &gt;&gt; .gitignore
</code></pre>
<h2 data-id="heading-21">åˆ°åº•çœäº†å¤šå°‘äº‹</h2>
<p>åˆ—ä¸ªå¯¹æ¯”å§ï¼š</p>








































<table><thead><tr><th>æ“ä½œ</th><th>æ‰‹åŠ¨</th><th>ç”¨ Skill</th></tr></thead><tbody><tr><td>åˆ‡å›¾å¯¼å‡º</td><td>ä¸€å¼ å¼ ä» Figma å¯¼å‡º</td><td>è‡ªåŠ¨è¯†åˆ«å¯¼å‡º</td></tr><tr><td>PNG å‹ç¼©</td><td>å¼€ TinyPNG ç½‘ç«™æ‹–æ‹½</td><td>è‡ªåŠ¨è°ƒ API</td></tr><tr><td>ä¸Šä¼  COS</td><td>ç™»æ§åˆ¶å°æ‰‹åŠ¨ä¼ </td><td>è„šæœ¬è‡ªåŠ¨ä¼ </td></tr><tr><td>å¤åˆ¶é“¾æ¥</td><td>ä¸€ä¸ªä¸ªå¤åˆ¶ URL</td><td>è¡¨æ ¼ç›´æ¥ç»™</td></tr><tr><td>æ›¿æ¢ä»£ç </td><td>æ‰‹åŠ¨ç²˜è´´</td><td>è‡ªåŠ¨æ›¿æ¢</td></tr><tr><td>5 å¼ å›¾è€—æ—¶</td><td>å¤§æ¦‚ 10 åˆ†é’Ÿ</td><td>30 ç§’å·¦å³</td></tr></tbody></table>
<p>ä»£ç é‡ä¹Ÿä¸å¤§ï¼ŒPython è„šæœ¬ 136 è¡Œï¼ŒNode.js è„šæœ¬ 290 è¡Œã€‚å†™ SKILL.md åè€ŒèŠ±çš„æ—¶é—´æ›´å¤šï¼Œå› ä¸ºè¦åå¤è°ƒè¯• Claude çš„ç†è§£æ˜¯å¦å‡†ç¡®ã€‚</p>
<p>è¯´åˆ°åº•ï¼ŒSkill å°±æ˜¯æŠŠä½ è„‘å­é‡Œ"è¿™ä¸ªé¡¹ç›®å›¾ç‰‡è¯¥æ€ä¹ˆå¤„ç†"çš„ç»éªŒï¼Œå†™æˆ Claude èƒ½çœ‹æ‡‚çš„æ–‡æ¡£ã€‚æ•™ä¸€æ¬¡ï¼Œåé¢å°±ä¸ç”¨å†æ“å¿ƒäº†ã€‚</p>
<p>å¦‚æœä½ é¡¹ç›®é‡Œä¹Ÿæœ‰ç±»ä¼¼çš„é‡å¤æ“ä½œï¼Œå¯ä»¥è¯•è¯•å†™ä¸ª Skillã€‚ä¸ä¸€å®šæ˜¯å›¾ç‰‡ä¸Šä¼ ï¼Œä»»ä½•æœ‰å›ºå®šæµç¨‹çš„äº‹æƒ…éƒ½è¡Œã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring æºç åˆ†æ å•ä¾‹ Bean çš„åˆ›å»ºè¿‡ç¨‹]]></title>    <link>https://juejin.cn/post/7604315965875060770</link>    <guid>https://juejin.cn/post/7604315965875060770</guid>    <pubDate>2026-02-09T07:48:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604315965875060770" data-draft-id="7600326947505897524" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring æºç åˆ†æ  å•ä¾‹ Bean çš„åˆ›å»ºè¿‡ç¨‹"/> <meta itemprop="keywords" content="Spring Boot,Spring,åç«¯"/> <meta itemprop="datePublished" content="2026-02-09T07:48:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æš®è‰²å¦–å¨†ä¸¶"/> <meta itemprop="url" content="https://juejin.cn/user/4292946760307655"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring æºç åˆ†æ  å•ä¾‹ Bean çš„åˆ›å»ºè¿‡ç¨‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4292946760307655/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æš®è‰²å¦–å¨†ä¸¶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T07:48:19.000Z" title="Mon Feb 09 2026 07:48:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»14åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>ä¸Šç¯‡æ–‡ç« æˆ‘ä»¬è®²è¿°äº† <code>BeanFactoryPostProcessor</code> çš„ä½œç”¨ï¼Œè¿™ç¯‡æ–‡ç« æˆ‘ä»¬æ¥å­¦ä¹ å•ä¾‹ <code>Bean</code> çš„åˆ›å»ºè¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­æ¶‰åŠäº† <code>BeanPostProcessor ã€Awareã€ InitializingBean</code> ç­‰é‡è¦çš„æ¥å£ï¼Œæ˜¯ç”Ÿå‘½å‘¨æœŸçš„æ ¸å¿ƒç‚¹ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬åç»­è‡ªå®šä¹‰æ‰©å±•éœ€è¦ç†Ÿæ‚‰çš„æ ¸å¿ƒæ¥å£ã€‚</p>
<p>æœ¬ç¯‡æ–‡ç« ä½¿ç”¨çš„ <code>SpringBoot</code> ç‰ˆæœ¬æ˜¯ <code>3.4.1</code> ï¼Œå¯¹åº” <code>Spring</code> ç‰ˆæœ¬ <code>6.2.1</code>ã€‚</p>
<h2 data-id="heading-1">SpringBoot &amp; Spring æ¶æ„å›¾ç¤ºæ¦‚è§ˆ</h2>
<p>è¿™é‡Œæˆ‘ä»¥ <code>SpringBoot</code> æºç å…¥å£ä¸ºèµ·ç‚¹ï¼Œç”»äº†ä¸€ä¸ªç›¸å…³çš„æµç¨‹å›¾ï¼ŒåŒ…å«äº† <code>SpringBootã€Spring äº‹åŠ¡ã€Spring AOPã€Spring äº‹ä»¶ã€BeanFactoryPostProcessorã€BeanPostProcessor</code> ç­‰æ‰€æœ‰ <code>Spring</code> çŸ¥è¯†ï¼Œä»¥åŠç›¸å…³æ¨¡å—ä¹‹é—´çš„äº¤äº’è”ç³»ï¼Œåç»­ä¹Ÿä¼šæŒç»­æ›´æ–°æ­¤å›¾ï¼ˆå› ä¸ºæˆ‘è‡ªå·±è¿˜æ²¡æœ‰å­¦å®Œï¼‰ï¼Œæˆ‘è¯•äº†ä¸‹ä½œè€…ä¾§è¿™è¾¹æ›´æ–°åï¼Œåˆ†äº«çš„åä½œé“¾æ¥ä¹Ÿä¼šå®æ—¶å˜æ›´ï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰å¸®åŠ©</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.processon.com%2Fv%2F696465e679c29354e9e50f69" target="_blank" title="https://www.processon.com/v/696465e679c29354e9e50f69" ref="nofollow noopener noreferrer">SpringBoot &amp; Spring æ¶æ„å›¾ æŒç»­æ›´æ–°</a> å¯¹äºå³å°†éœ€è¦é¢è¯•çš„åŒå­¦åº”è¯¥ä¼šæ¯”è¾ƒæœ‰å¸®åŠ©ï¼</p>
<h2 data-id="heading-2">Bean çš„åˆ›å»ºè¿‡ç¨‹&amp;ç”Ÿå‘½å‘¨æœŸå›¾ç¤º</h2>
<p><code>Bean</code> çš„ç”Ÿå‘½å‘¨æœŸä»ä¸Šå¾€ä¸‹ï¼Œå¦‚å›¾</p>
<div align="center"> <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a9653fac67c4af28e1173a7b6fe69d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pqu6Imy5aaW5aiG5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771228098&amp;x-signature=NBVxPCwpsqX%2FdxKoiFuI1wFfVhE%3D" alt="å›¾ç‰‡æè¿°" width="800" loading="lazy"/> </div>

<p>å…¶å®å¾ˆå¤šäººå¯èƒ½çœ‹ç€ç½‘ä¸Šçš„æ•™ç¨‹ï¼Œå„ç§è¯´ <code>Bean</code> çš„ç”Ÿå‘½å‘¨æœŸï¼Œä»€ä¹ˆå›è°ƒå‡½æ•°ï¼Œä»€ä¹ˆåç½®å¤„ç†ï¼Œç¬¬ä¸€æ¬¡æ¥è§¦å¯èƒ½ä¼šçœ‹ç€æœ‰ç‚¹æ‡µé€¼ï¼Œè‡ªå·±éƒ½ä¸çŸ¥é“è‡ªå·±åœ¨å¹²ä»€ä¹ˆï¼Œä¹Ÿä¸çŸ¥é“è¿™æ ·åšçš„æ„ä¹‰ã€‚</p>
<p><strong>å…¶å®å¾ˆç®€å•ï¼Œ å°±æ˜¯ä¸€ä¸ª Bean ä»åˆ›å»ºåˆ°å®Œæˆçš„è¿‡ç¨‹ä¸­ä¼šè°ƒç”¨ä¸€æ‰¹å›ºå®šçš„æ–¹æ³•ï¼Œè¿™æ‰¹å›ºå®šçš„æ–¹æ³•å­˜åœ¨äºä¸åŒçš„æ¥å£ä¸­ï¼Œè¿™æ˜¯ä¸ºäº†ä»£ç ç›´è§‚ï¼Œå’Œåˆ†å±‚è®¾è®¡ï¼Œè€Œæˆ‘ä»¬ç†Ÿæ‚‰äº†è¿™ä¸ªè¿‡ç¨‹ä¸­å„ç§æ¥å£çš„ä½œç”¨å’Œè°ƒç”¨é¡ºåºï¼Œå°±å¯ä»¥åœ¨æ—¥å¸¸ä½¿ç”¨ Spring æ¡†æ¶æ—¶ï¼Œæ ¹æ®ä¸šåŠ¡éœ€æ±‚åšå‡ºå„ç§å„æ ·çš„è‡ªå®šä¹‰æ‰©å±•ã€‚</strong></p>
<p>ä¸‹é¢æˆ‘ä»¬ä¸€ä¸€è¯´æ˜è¿™äº›æ¥å£çš„ä½œç”¨ã€‚</p>
<h2 data-id="heading-3">BeanPostProcessor é¡¶å±‚æ¥å£</h2>
<p>é¡¶å±‚åç½®å¤„ç†å™¨æ¥å£ï¼ŒæŸ¥è¯¢æ¥å£çš„æ³¨é‡Šï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªå›è°ƒæ–¹æ³•ã€‚æä¾›ä¸¤ä¸ªæ–¹æ³•è®©å­ç±»æ‰©å±•ï¼Œä½œç”¨æ—¶æœºæ˜¯åœ¨ <code>Bean</code> åˆ›å»ºè¿‡ç¨‹ä¸­è¢«è°ƒç”¨</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * Bean åˆå§‹åŒ–å‰è°ƒç”¨
 */</span>
<span class="hljs-keyword">default</span> Object <span class="hljs-title function_">postProcessBeforeInitialization</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException {
    <span class="hljs-keyword">return</span> bean;
}

<span class="hljs-comment">/**
 * Bean åˆå§‹åŒ–åè°ƒç”¨
 */</span>
<span class="hljs-keyword">default</span> Object <span class="hljs-title function_">postProcessAfterInitialization</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException {
    <span class="hljs-keyword">return</span> bean;
}
</code></pre>
<p>ä¸Šä¸€æ®µç”Ÿå‘½å‘¨æœŸå›¾ä¸­æ ‡é¢œè‰²çš„æ­¥éª¤ï¼Œå…¨éƒ½æ˜¯å®ƒæˆ–è€…å®ƒçš„æ‰©å±•æ¥å£ã€‚</p>
<h2 data-id="heading-4">BeanPostProcessor å’Œ BeanFactoryPostProcessor</h2>
<p>è¿™ä¸¤ä¸ªå¤„ç†å™¨åå­—å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯ä½œç”¨å¤§ä¸ç›¸åŒï¼Œä¸‹å›¾åˆ—å‡ºäº†å®ƒä»¬çš„åŒºåˆ«</p>


















































<table><thead><tr><th>æ¥å£</th><th>BeanFactoryPostProcessor</th><th>BeanPostProcessor</th></tr></thead><tbody><tr><td><strong>ä½œç”¨é˜¶æ®µ</strong></td><td>Bean å®šä¹‰åŠ è½½é˜¶æ®µï¼ŒBean å®ä¾‹åŒ–å‰</td><td>Bean å®ä¾‹åŒ–åï¼Œåˆå§‹åŒ–å‰å</td></tr><tr><td><strong>å¤„ç†ç›®æ ‡</strong></td><td>BeanDefinitionï¼ˆBean çš„å…ƒæ•°æ®ï¼‰</td><td>Bean å®ä¾‹å¯¹è±¡</td></tr><tr><td><strong>æ¥å£æ–¹æ³•</strong></td><td><code>postProcessBeanFactory()</code> <br/> <code>...å­æ¥å£</code></td><td><code>postProcessBeforeInitialization()</code><br/><code>postProcessAfterInitialization()</code><br/> <code>...å­æ¥å£</code></td></tr><tr><td><strong>ä¸»è¦åŠŸèƒ½</strong></td><td>ä¿®æ”¹ã€æ·»åŠ ã€åˆ é™¤ BeanDefinition</td><td>ä¿®æ”¹ã€åŒ…è£…ã€ä»£ç† Bean å®ä¾‹</td></tr><tr><td><strong>æ‰§è¡Œæ—¶æœº</strong></td><td>Spring å®¹å™¨å¯åŠ¨æ—©æœŸ</td><td>æ¯ä¸ª Bean çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œåˆå§‹åŒ–å‰å</td></tr><tr><td><strong>æ‰§è¡Œæ¬¡æ•°</strong></td><td>æ•´ä¸ªå®¹å™¨å¯åŠ¨è¿‡ç¨‹æ‰§è¡Œä¸€æ¬¡</td><td>æ¯ä¸ª Bean å®ä¾‹åŒ–åéƒ½ä¼šæ‰§è¡Œä¸¤æ¬¡ï¼ˆå‰åå„ä¸€æ¬¡ï¼Œä¸åŒ…æ‹¬æ‰©å±•æ¥å£ï¼‰</td></tr><tr><td><strong>è®¿é—®æƒé™</strong></td><td>å¯è®¿é—®æ‰€æœ‰ BeanDefinitionï¼Œå¯ä¿®æ”¹å®¹å™¨é…ç½®</td><td>åªèƒ½è®¿é—®å½“å‰å¤„ç†çš„ Bean å®ä¾‹ï¼Œä¸èƒ½ä¿®æ”¹å®¹å™¨é…ç½®</td></tr><tr><td><strong>å¸¸è§å®ç°</strong></td><td>ConfigurationClassPostProcessorï¼ˆå¤„ç†é…ç½®ç±»ï¼‰</td><td>AutowiredAnnotationBeanPostProcessorï¼ˆå¤„ç†@Autowired æ³¨å…¥ï¼‰<br/></td></tr></tbody></table>
<h2 data-id="heading-5">MergedBeanDefinitionPostProcessor</h2>
<p>å’Œ <code>BeanFactoryPostProcessor</code> çš„æ‰©å±•æ¥å£ <code>BeanDefinitionRegistryPostProcessor</code> ç±»ä¼¼ï¼Œ<code>MergedBeanDefinitionPostProcessor</code> æ˜¯ <code>BeanPostProcessor</code> çš„å­æ¥å£ï¼Œåœ¨ <code>BeanPostProcessor</code> çš„ä¸¤ä¸ªæ–¹æ³•æ‰§è¡Œå‰ï¼Œåœ¨ <code>Bean</code> å®šä¹‰åˆå¹¶åï¼Œä¼šæ‰§è¡Œ <code>MergedBeanDefinitionPostProcessor.postProcessMergedBeanDefinition()</code></p>
<blockquote>
<p><code>Spring</code> ä¼šæ ¹æ® <code>BeanDefinition</code> åˆ›å»º <code>Bean</code>ï¼Œä½†æ˜¯æœ€ç»ˆ <code>BeanDefinition</code> å¿…é¡»è¢«è½¬æˆ <code>RootBeanDefinition</code> ï¼Œ<code>Bean</code> åˆå¹¶çš„è¿‡ç¨‹å°±æ˜¯æŠŠä¸åŒç±»å‹çš„ <code>BeanDefinition</code> è½¬æˆ <code>RootBeanDefinition</code>ï¼Œä»¥åŠåˆå¹¶ä¸€äº›çˆ¶ç±»å±æ€§å’Œæ–¹æ³•ç­‰ï¼Œå¾—åˆ°ä¸€ä¸ªæœ€ç»ˆçš„ <code>BeanDefinition</code>ã€‚</p>
</blockquote>
<p>å…¸å‹çš„å®ç°æ˜¯ <code>AutowiredAnnotationBeanPostProcessor</code>ï¼Œ åœ¨é‡å†™çš„ <code>postProcessMergedBeanDefinition()</code> æ–¹æ³•ä¸­ç¼“å­˜äº†å½“å‰ <code>Bean</code> æ‰€éœ€è¦æ³¨å…¥çš„å…¶ä»– <code>Bean</code> çš„ç›¸å…³ä¿¡æ¯ã€‚ä¾‹å¦‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EventListenerTestService1</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ApplicationEventPublisher publisher;
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> CashRepayApplyMapper cashRepayApplyMapper;
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> EventListenerTestService2 listenerTestService2;
}
</code></pre>
<p>é‚£ä¹ˆåœ¨åˆ›å»º <code>EventListenerTestService1</code> çš„ <code>Bean</code> å¯¹è±¡çš„è¿‡ç¨‹ä¸­ï¼Œå°±ä¼šè°ƒç”¨ <code>postProcessMergedBeanDefinition()</code> æ–¹æ³•ï¼Œç¼“å­˜è¿™ä¸‰ä¸ªæ ‡æ³¨äº† <code>@Autowired</code> çš„ç±»ç›¸å…³ä¿¡æ¯ï¼Œåé¢è¿›è¡Œä¾èµ–æ³¨å…¥çš„æ—¶å€™ä¼šç›´æ¥ä»ç¼“å­˜å–ç±»ä¿¡æ¯ï¼Œç„¶åè¿›è¡Œåˆ›å»ºè¿™ä¸‰ä¸ªæˆå‘˜å˜é‡çš„ <code>Bean</code> å®ä¾‹</p>
<h2 data-id="heading-6">InstantiationAwareBeanPostProcessor</h2>
<p>å®ƒä¹Ÿæ˜¯ <code>BeanPostProcessor</code> çš„å­æ¥å£ï¼Œæ‰©å±•äº†ä¸€ä¸ª <code>postProcessProperties()</code>ï¼Œç»å…¸çš„å®ç°ä¹Ÿæ˜¯ <code>AutowiredAnnotationBeanPostProcessor</code> åœ¨è¿™é‡Œè·å– <code>postProcessMergedBeanDefinition()</code> æ–¹æ³•ä¸­ç¼“å­˜çš„æ³¨å…¥ä¿¡æ¯ï¼Œè¿›è¡Œå®é™…ä¾èµ–æ³¨å…¥ï¼Œè¿™ä¸€æ­¥å®Œæˆä¹‹åï¼Œå½“å‰ <code>EventListenerTestService1</code> çš„ä¸‰ä¸ªæˆå‘˜å˜é‡éƒ½åˆ›å»ºäº†å¯¹åº”çš„ <code>Bean</code> å¯¹è±¡</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> PropertyValues <span class="hljs-title function_">postProcessProperties</span><span class="hljs-params">(PropertyValues pvs, Object bean, String beanName)</span> {
    <span class="hljs-type">InjectionMetadata</span> <span class="hljs-variable">metadata</span> <span class="hljs-operator">=</span> findAutowiringMetadata(beanName, bean.getClass(), pvs);
    <span class="hljs-keyword">try</span> {
       <span class="hljs-comment">//æ³¨å…¥ @Autowired æˆå‘˜</span>
       metadata.inject(bean, beanName, pvs);
    }
    <span class="hljs-comment">//......</span>
    <span class="hljs-keyword">return</span> pvs;
}
</code></pre>
<p>åœ¨ <code>metadata.inject(bean, beanName, pvs)</code> è¿™ä¸€æ­¥ä¼šå…ˆä» <code>ApplicationContext</code> ä¸­å¯»æ‰¾å·²å­˜åœ¨çš„ç¬¦åˆçš„ <code>Bean</code>ï¼Œå¦‚æœæ‰¾ä¸åˆ°ä¼šèµ°åˆ›å»º <code>Bean</code> çš„æµç¨‹ï¼Œè¿™æ˜¯ä¸€ä¸ªé€’å½’ï¼Œå¦‚æœéœ€è¦åˆ›å»ºçš„ <code>Bean</code> å†…éƒ¨ä¹Ÿæœ‰ä¾èµ–ï¼Œä¼šç»§ç»­é€’å½’åˆ›å»ºã€‚å‚è€ƒ</p>
<ul>
<li><code>AbstractAutowireCapableBeanFactory#populateBean</code></li>
<li><code>â†“</code></li>
<li><code>AutowiredAnnotationBeanPostProcessor#postProcessProperties</code></li>
<li><code>â†“</code></li>
<li><code>DefaultListableBeanFactory#doResolveDependency</code></li>
<li><code>â†“</code></li>
<li><code>AbstractBeanFactory#getBean</code> å¼€å§‹é€’å½’</li>
</ul>
<h2 data-id="heading-7">SmartInstantiationAwareBeanPostProcessor</h2>
<p>å®ƒæ˜¯ <code>InstantiationAwareBeanPostProcessor</code> çš„æ‰©å±•æ¥å£ï¼ŒæŸ¥çœ‹è¿™ä¸ªç±»çš„æ³¨é‡Šï¼Œå‘Šè¯‰æˆ‘ä»¬è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ‰©å±•ï¼Œé€šå¸¸æ¥è¯´åªç”¨äºæ¡†æ¶å†…éƒ¨ï¼Œå¦‚æœæˆ‘ä»¬ä¸šåŠ¡éœ€è¦æ‰©å±•åº”è¯¥ç›´æ¥å®ç° <code>BeanPostProcessor</code> ã€‚å®ƒæ–°å¢äº†å‡ ä¸ªæ‰©å±•æ–¹æ³•ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SmartInstantiationAwareBeanPostProcessor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InstantiationAwareBeanPostProcessor</span> {
    <span class="hljs-comment">/**
     * è·å–æ—©æœŸå¼•ç”¨ï¼ˆä¸‰çº§ç¼“å­˜ã€ä»£ç†çš„å®ç°ï¼‰
     */</span>
    <span class="hljs-keyword">default</span> Object <span class="hljs-title function_">getEarlyBeanReference</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException {
       <span class="hljs-keyword">return</span> bean;
    }
</code></pre>
<p><code>AbstractAutoProxyCreator</code> æ˜¯å®ƒçš„ç»å…¸å®ç°ï¼Œ<code>getEarlyBeanReference()</code> å°±æ˜¯ä¸ºäº†è§£å†³å¾ªç¯ä¾èµ–è¿‡ç¨‹ä¸­ï¼Œè¢«ä¾èµ–çš„ <code>Bean</code> éœ€è¦ä»£ç†ã€‚æœ€å¸¸è§çš„æƒ…å†µæ˜¯æˆ‘ä»¬çš„ <code>Bean</code> æœ‰äº‹åŠ¡ï¼Œ<code>Spring</code> äº‹åŠ¡æ˜¯éœ€è¦é€šè¿‡ä»£ç†æ¥å®ç°çš„ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//org.springframework.aop.framework.autoproxy.AbstractAutoProxyCreator#getEarlyBeanReference</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getEarlyBeanReference</span><span class="hljs-params">(Object bean, String beanName)</span> {
    <span class="hljs-type">Object</span> <span class="hljs-variable">cacheKey</span> <span class="hljs-operator">=</span> getCacheKey(bean.getClass(), beanName);
    <span class="hljs-built_in">this</span>.earlyBeanReferences.put(cacheKey, bean);
    <span class="hljs-keyword">return</span> wrapIfNecessary(bean, beanName, cacheKey);
}
</code></pre>
<h2 data-id="heading-8">Aware</h2>
<p><code>Aware</code> æ˜¯ä¸€ä¸ªé‡è¦é€šçŸ¥æ¥å£ï¼Œç¿»è¯‘ä¸­æ–‡ä¸º <code>æ„è¯†åˆ°</code>ï¼ŒæŸ¥çœ‹æ³¨é‡Šè¯´å®ƒæ˜¯ä¸€ä¸ªé¡¶å±‚æ ‡è®°æ¥å£ï¼Œè¡¨ç¤º <code>Bean</code> å¯ä»¥é€šè¿‡å›è°ƒæ–¹å¼è¢« <code>Spring</code> å®¹å™¨é€šçŸ¥æŸä¸ªå¯¹è±¡ã€‚å®é™…çš„æ–¹æ³•ç­¾åç”±å„ä¸ªå­æ¥å£å†³å®šï¼Œä½†é€šå¸¸åº”åªå®šä¹‰ä¸€ä¸ªå•ä¸ªå…¥å‚çš„ <code>void</code> æ–¹æ³•ã€‚ä¾‹å¦‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApplicationContextAware</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Aware</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setApplicationContext</span><span class="hljs-params">(ApplicationContext applicationContext)</span> <span class="hljs-keyword">throws</span> BeansException;
}
</code></pre>
<p>å®ƒçš„ä½œç”¨æ˜¯ç»™æˆ‘ä»¬çš„ <code>Bean</code> è®¾ç½®ä¸€äº›æ¡†æ¶å†…éƒ¨å¯¹è±¡ï¼Œé˜²æ­¢æˆ‘ä»¬æ‰©å±•çš„æ¥å£éœ€è¦è¿™äº›å¯¹è±¡ï¼Œä¾‹å¦‚</p>
<ul>
<li>å½“å‰ä¸Šä¸‹æ–‡ <code>ApplicationContext</code></li>
<li>å½“å‰ <code>BeanFactory</code></li>
<li>å½“å‰ <code>Bean</code> çš„åå­—</li>
<li>å½“å‰ç¯å¢ƒå¯¹è±¡ <code>Environment</code></li>
<li>å½“å‰äº‹ä»¶å‘å¸ƒå™¨ <code>ApplicationEventPublisher</code></li>
<li>ç­‰ç­‰</li>
</ul>
<p>å‚è€ƒå…¸å‹çš„å®ç° <code>ApplicationContextAwareã€EnvironmentAware</code>ï¼Œè®©æˆ‘ä»¬çš„ <code>Bean</code> å®ç° <code>EnvironmentAware</code> ï¼Œå°±å¯ä»¥åœ¨æˆ‘ä»¬ <code>Bean</code> è¿™ä¸ªç±»ä¸­è·å–åˆ° <code>Environment</code> å¯¹è±¡ä½¿ç”¨</p>
<h2 data-id="heading-9">BeanPostProcessor#postProcessBeforeInitialization</h2>
<p><code>Bean</code> åˆå§‹åŒ–è¿‡ç¨‹å‰æ‰§è¡Œï¼Œ<code>Aware</code> è°ƒç”¨ä¹‹åæ‰§è¡Œ ã€‚ä¸€ä¸ªå…¸å‹çš„å®ç°æ˜¯ <code>ApplicationContextAwareProcessor</code>ï¼Œç”±äºä¸Šä¸€æ­¥è°ƒç”¨<code>invokeAwareMethods</code>ï¼Œåªåˆ¤æ–­äº†ä¸‰ç§ç±»å‹</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">invokeAwareMethods</span><span class="hljs-params">(String beanName, Object bean)</span> {
    <span class="hljs-keyword">if</span> (bean <span class="hljs-keyword">instanceof</span> Aware) {
       <span class="hljs-keyword">if</span> (bean <span class="hljs-keyword">instanceof</span> BeanNameAware beanNameAware) {
          beanNameAware.setBeanName(beanName);
       }
       <span class="hljs-keyword">if</span> (bean <span class="hljs-keyword">instanceof</span> BeanClassLoaderAware beanClassLoaderAware) {
          <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">bcl</span> <span class="hljs-operator">=</span> getBeanClassLoader();
          <span class="hljs-keyword">if</span> (bcl != <span class="hljs-literal">null</span>) {
             beanClassLoaderAware.setBeanClassLoader(bcl);
          }
       }
       <span class="hljs-keyword">if</span> (bean <span class="hljs-keyword">instanceof</span> BeanFactoryAware beanFactoryAware) {
          beanFactoryAware.setBeanFactory(AbstractAutowireCapableBeanFactory.<span class="hljs-built_in">this</span>);
       }
    }
</code></pre>
<p>æ‰€ä»¥å¯¹äºæ‰©å±•çš„ <code>EnvironmentAwareã€ApplicationContextAwareã€ApplicationEventPublisherAware</code> ç­‰è¿™äº›å†…ç½®æ‰©å±•çš„é€šçŸ¥æ¥å£éœ€è¦é¢å¤–ç‰¹æ®Šå¤„ç†ï¼Œå› æ­¤ <code>Spring</code> æ¡†æ¶æŠŠè¿™ä¸ªå·¥ä½œæ”¾åˆ°äº†<code>ApplicationContextAwareProcessor#postProcessBeforeInitialization()</code> ä¸­</p>
<h3 data-id="heading-10">Aware æ¥å£åˆ†å¼€å¤„ç†çš„åŸå› </h3>
<p>å¦‚æœä»”ç»†æ€è€ƒä½ å¯èƒ½ä¼šç–‘æƒ‘ï¼Œæ—¢ç„¶ <code>Bean</code> åˆ›å»ºè¿‡ç¨‹ä¸­ä¼šè°ƒç”¨ <code>invokeAwareMethods()</code>ï¼Œé‚£ä¸ºä»€ä¹ˆä¸æŠŠ<code>EnvironmentAwareã€ApplicationContextAwareã€ApplicationEventPublisherAware</code> è¿™äº›é€šçŸ¥æ¥å£ä¹Ÿæ”¾åˆ°è¿™ä¸ªæ–¹æ³•é‡Œè®¾ç½®å¯¹åº”çš„å€¼ï¼Œè€Œæ˜¯è¦å†å¼„ä¸€ä¸ª <code>ApplicationContextAwareProcessor</code> æ¥å®ç°å‘¢ï¼Ÿæ˜¯å¦å¤šæ­¤ä¸€ä¸¾ï¼ŸæŸ¥çœ‹ <code>ApplicationContextAwareProcessor#postProcessBeforeInitialization()</code> æºç </p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-meta">@Nullable</span>
<span class="hljs-keyword">public</span> Object <span class="hljs-title function_">postProcessBeforeInitialization</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException {
    <span class="hljs-keyword">if</span> (bean <span class="hljs-keyword">instanceof</span> Aware) {
       invokeAwareInterfaces(bean);
    }
    <span class="hljs-keyword">return</span> bean;
}

<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">invokeAwareInterfaces</span><span class="hljs-params">(Object bean)</span> {
    <span class="hljs-keyword">if</span> (bean <span class="hljs-keyword">instanceof</span> EnvironmentAware environmentAware) {
       environmentAware.setEnvironment(<span class="hljs-built_in">this</span>.applicationContext.getEnvironment());
    }
    <span class="hljs-keyword">if</span> (bean <span class="hljs-keyword">instanceof</span> EmbeddedValueResolverAware embeddedValueResolverAware) {
       embeddedValueResolverAware.setEmbeddedValueResolver(<span class="hljs-built_in">this</span>.embeddedValueResolver);
    }
    <span class="hljs-keyword">if</span> (bean <span class="hljs-keyword">instanceof</span> ResourceLoaderAware resourceLoaderAware) {
       resourceLoaderAware.setResourceLoader(<span class="hljs-built_in">this</span>.applicationContext);
    }
    <span class="hljs-keyword">if</span> (bean <span class="hljs-keyword">instanceof</span> ApplicationEventPublisherAware applicationEventPublisherAware) {
       applicationEventPublisherAware.setApplicationEventPublisher(<span class="hljs-built_in">this</span>.applicationContext);
    }
    <span class="hljs-keyword">if</span> (bean <span class="hljs-keyword">instanceof</span> MessageSourceAware messageSourceAware) {
       messageSourceAware.setMessageSource(<span class="hljs-built_in">this</span>.applicationContext);
    }
    <span class="hljs-keyword">if</span> (bean <span class="hljs-keyword">instanceof</span> ApplicationStartupAware applicationStartupAware) {
       applicationStartupAware.setApplicationStartup(<span class="hljs-built_in">this</span>.applicationContext.getApplicationStartup());
    }
    <span class="hljs-keyword">if</span> (bean <span class="hljs-keyword">instanceof</span> ApplicationContextAware applicationContextAware) {
       applicationContextAware.setApplicationContext(<span class="hljs-built_in">this</span>.applicationContext);
    }
}
</code></pre>
<p><strong>å¯ä»¥çœ‹åˆ°è¿™æ˜¯å› ä¸º <code>EnvironmentAware</code> ç­‰æ¥å£éœ€è¦è®¾ç½®çš„æˆå‘˜å˜é‡éƒ½æ˜¯ <code>ApplicationContext</code> å†…éƒ¨çš„å¯¹è±¡ï¼Œè€Œ <code>DefaultListableBeanFactory</code> ä»è®¾è®¡ä¸Šæ¥è¯´æ˜¯ä¸è¯¥æŒæœ‰ <code>ApplicationContext</code> çš„å¼•ç”¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ <code>DefaultListableBeanFactory</code> æ‹¿ä¸åˆ°è¿™äº›å¯¹è±¡ï¼Œæ˜¯ <code>ApplicationContext</code> å®¹å™¨æŒæœ‰ <code>DefaultListableBeanFactory</code> çš„å¼•ç”¨ã€‚è€Œ <code>DefaultListableBeanFactory</code> æ²¡æœ‰è¿™äº›å¯¹è±¡ï¼Œæ‰€ä»¥æ— æ³•åœ¨ <code>invokeAwareMethods()</code> è®¾ç½®</strong></p>
<h2 data-id="heading-11">InitializingBean</h2>
<p>è¿™æ˜¯ä¸€ä¸ª <code>Bean</code> çš„åˆå§‹åŒ–æ¥å£ï¼Œåœ¨ <code>BeanPostProcessor#postProcessBeforeInitialization</code> ä¹‹åè°ƒç”¨ï¼Œä»æ–¹æ³•åå¯ä»¥çœ‹å‡ºï¼Œæ­¤æ—¶å±æ€§å·²ç»å…¨éƒ¨è®¾ç½®å®Œæ¯•ã€‚æˆ‘ä»¬å¯ä»¥å®ç° <code>InitializingBean</code> åœ¨ <code>afterPropertiesSet()</code> ä¸­åšä¸€äº›è‡ªå®šä¹‰é€»è¾‘</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">InitializingBean</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterPropertiesSet</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception;
}
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼Œè¿™é‡ŒæŒ‡çš„å±æ€§æ˜¯è¢« <code>Spring</code> å®¹å™¨ç®¡ç†çš„å±æ€§ï¼Œä¸åŒ…æ‹¬æˆ‘ä»¬è‡ªå®šä¹‰çš„å±æ€§ï¼Œä¾‹å¦‚ä½¿ç”¨ <code>@Autowiredã€@Value</code> æ ‡æ³¨çš„å±æ€§ï¼Œæˆ–è€…å®ç° <code>Aware</code> æ¥å£ä¹‹å <code>setApplicationContext</code> ç­‰æ–¹æ³•ä¸­çš„å±æ€§ã€‚</p>
<p>è¿™äº›è¢« <code>Spring</code> å®¹å™¨ç®¡ç†çš„å±æ€§èµ‹å€¼å®Œæ¯•åä¼šè°ƒç”¨è¿™ä¸ª <code>afterPropertiesSet()</code> æ–¹æ³•</p>
</blockquote>
<h2 data-id="heading-12">è°ƒç”¨ @Bean(initMethod = "xxx")</h2>
<p><code>afterPropertiesSet()</code> è°ƒç”¨ä¹‹åï¼Œä¼šç´§æ¥ç€è°ƒç”¨è‡ªå®šä¹‰çš„ <code>init</code> æ–¹æ³•ã€‚</p>
<h2 data-id="heading-13">SmartInitializingSingleton</h2>
<p>è¿™ä¸ªæ¥å£çš„ä½œç”¨æ˜¯å½“æ‰€æœ‰å•ä¾‹ <code>Bean</code> è¢«åˆ›å»ºå®Œæˆä¹‹åï¼Œè°ƒç”¨å…¶æ–¹æ³•</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SmartInitializingSingleton</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterSingletonsInstantiated</span><span class="hljs-params">()</span>;
}
</code></pre>
<p>ä¸€ä¸ªå…¸å‹çš„å®ç°å°±æ˜¯ <code>EventListenerMethodProcessor</code>ï¼Œå½“æ‰€æœ‰å•ä¾‹ <code>Bean</code> åˆ›å»ºå®Œæˆä¹‹åï¼Œ<code>EventListenerMethodProcessor.afterSingletonsInstantiated()</code> ä¼šéå†æ‰€æœ‰åˆ›å»ºå®Œæˆçš„ <code>Bean</code>ï¼ŒæŸ¥æ‰¾è¢«  <code>@EventListenerã€@TransactionalEventListener</code> æ³¨è§£çš„ï¼Œæ ¹æ®ä¸åŒçš„ <code>EventListenerFactory</code> åˆ›å»ºä¸åŒçš„ <code>ApplicationListener</code> å®ç°ï¼Œæ·»åŠ åˆ°å½“å‰ <code>ApplicationContext</code> ä¸­ã€‚è¿™å°±æ˜¯ <code>Spring</code> äº‹ä»¶çš„åŸºæœ¬åŸç†ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testPublish1</span><span class="hljs-params">()</span>{
    publisher.publishEvent(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TestEvent</span>(<span class="hljs-built_in">this</span>,<span class="hljs-number">1L</span>));
}

<span class="hljs-meta">@EventListener</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">listenerTestPublish1</span><span class="hljs-params">(TestEvent event)</span>{
    log.info(<span class="hljs-string">"listenerTestPublish1 TestEvent:{}"</span>,event);
}
</code></pre>
<p>å½“æ‰§è¡Œ <code>publisher.publishEvent()</code> æ—¶ï¼Œå°±ä¼šå» <code>ApplicationContext</code> å†…éƒ¨æå‰å­˜å‚¨çš„ç›‘å¬å™¨åˆ—è¡¨ä¸­å¯»æ‰¾ç¬¦åˆçš„ç›‘å¬å™¨ï¼Œç„¶åæ‰§è¡Œã€‚å¯èƒ½ä¼šå­˜åœ¨å¤šä¸ªï¼Œè¿™ç›¸å½“äºå¹¿æ’­æœ¬åœ°æ¶ˆæ¯ã€‚å¯åŒæ­¥æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥å¼‚æ­¥æ‰§è¡Œï¼Œç”šè‡³è¿˜èƒ½æ¡ä»¶æ‰§è¡Œï¼Œç»‘å®šäº‹åŠ¡æ‰§è¡Œï¼Œåé¢ä¼šè¯¦ç»†å‰–æ <code>Spring</code> äº‹ä»¶çš„åŸç†</p>
<p><strong><code>SmartInitializingSingleton</code> æ˜¯åœ¨æ‰€æœ‰å•ä¾‹ Bean åˆ›å»ºå®Œæˆä¹‹åæ‰§è¡Œï¼Œæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç”Ÿå‘½å‘¨æœŸæ¥å£</strong></p>
<h2 data-id="heading-14">è®©äººè´¹è§£çš„ä¸‰çº§ç¼“å­˜</h2>
<p>å…¶å®æ ‡é¢˜æƒ³è¡¨è¾¾çš„å¹¶ä¸æ˜¯ä¸‰çº§ç¼“å­˜å¾ˆå¤æ‚ï¼Œå€’æ˜¯æˆ‘ä¸æ˜ç™½è¿™ä¸œè¥¿ä¸ºä»€ä¹ˆèƒ½ä¸€åº¦æˆä¸ºé«˜é¢‘é¢è¯•é¢˜ï¼Œä¸‹é¢è¿™æ®µæ˜¯è¿™ä¸‰ä¸ªç¼“å­˜é›†åˆ</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸€çº§ç¼“å­˜ï¼ˆBean å®¹å™¨ï¼‰ï¼šå­˜æ”¾å®Œå…¨åˆå§‹åŒ–å¥½çš„å•ä¾‹ Beanï¼ˆæˆå“ï¼‰  </span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, Object&gt; singletonObjects = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;(<span class="hljs-number">256</span>);  

<span class="hljs-comment">// äºŒçº§ç¼“å­˜ï¼šå­˜æ”¾æ—©æœŸçš„ Beanï¼ˆå·²å®ä¾‹åŒ–æœªåˆå§‹åŒ–çš„åŠæˆå“ï¼‰ï¼Œè§£å†³å¾ªç¯ä¾èµ–  </span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, Object&gt; earlySingletonObjects = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;(<span class="hljs-number">16</span>);  

<span class="hljs-comment">// ä¸‰çº§ç¼“å­˜ï¼šå­˜æ”¾å•ä¾‹å·¥å‚ï¼Œç”¨äºåˆ›å»ºæ—©æœŸå¼•ç”¨ï¼ˆå¯èƒ½ç”Ÿæˆä»£ç†å¯¹è±¡ï¼‰  </span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(<span class="hljs-number">16</span>);
</code></pre>
<p>å…¶å®å°±æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„åˆ›å»ºè¿‡ç¨‹ï¼Œå‡è®¾ç°åœ¨æˆ‘ä»¬å¾ªç¯ä¾èµ–çš„ä¸¤ä¸ª <code>Bean</code> éƒ½éœ€è¦è¢«ä»£ç†</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff64cfc41a284610abe45d946bf8e786~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pqu6Imy5aaW5aiG5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771228098&amp;x-signature=gFW8mYZXPaEocBkYFYjD2Xyfyu0%3D" alt="image.png" loading="lazy"/></p>
<p><code>A</code> ä¸ <code>B</code> å¾ªç¯ä¾èµ–çš„åœºæ™¯ï¼Œå…ˆå®ä¾‹åŒ– <code>A</code>ï¼Œç„¶ååˆ›å»º <code>A</code> çš„å®Œæ•´ <code>Bean</code>ï¼Œç»“æœå‘ç° <code>A</code> ä¾èµ– <code>B</code>ï¼Œç„¶åç«‹å³å»åˆ›å»º <code>B</code> çš„å®Œæ•´ <code>Bean</code>ï¼Œå‘ç°éœ€è¦ <code>A</code>ï¼Œä½†æ˜¯ <code>A</code> çš„å®ä¾‹å·²ç»æœ‰äº†ï¼Œåªæ˜¯ <code>A</code> è¿˜ä¸æ˜¯å®Œæ•´çš„ <code>Bean</code>ï¼Œä½†æ˜¯è¿™å®Œå…¨ä¸å½±å“ï¼Œåªè¦ <code>A</code> çš„å®ä¾‹æœ‰äº†ï¼Œ<code>B</code> å°±å¯ä»¥æŒæœ‰ <code>A</code> çš„å¼•ç”¨ï¼Œè‡³äºå®ƒä»€ä¹ˆæ—¶å€™å˜æˆå®Œæ•´çš„ <code>Bean</code>ï¼Œ<code>B</code> æ˜¯ä¸å…³å¿ƒçš„ï¼Œå› ä¸º <code>B</code> å·²ç»æŒæœ‰ <code>A</code> çš„å¼•ç”¨ï¼Œ<code>A</code> å˜æˆå®Œæ•´ <code>Bean</code> çš„è¿‡ç¨‹åªæ˜¯ <code>A</code> å¯¹è±¡çš„å†…å­˜å†…å®¹å‘ç”Ÿå˜åŒ–ï¼Œå†…å­˜åœ°å€ä¸ä¼šå˜ã€‚</p>
<pre><code class="hljs language-markdown" lang="markdown">AService åˆ›å»ºå¼€å§‹
  â†’ å®ä¾‹åŒ–åŸå§‹å¯¹è±¡
  â†’ æ—©æœŸå¼•ç”¨å·¥å‚æ”¾å…¥ä¸‰çº§ç¼“å­˜
  â†’ éœ€è¦æ³¨å…¥ BService
  â†’ åˆ›å»º BService
<span class="hljs-code">    â†’ å®ä¾‹åŒ– BService åŸå§‹å¯¹è±¡
    â†’ æ—©æœŸå¼•ç”¨å·¥å‚æ”¾å…¥ä¸‰çº§ç¼“å­˜
    â†’ éœ€è¦æ³¨å…¥ AService
    â†’ ä»ä¸‰çº§ç¼“å­˜è·å– AService
    â†’ åˆ›å»º AService æ—©æœŸä»£ç†ï¼ˆç¬¬ä¸€æ¬¡ä»£ç†ç”Ÿæˆï¼‰
    â†’ æ³¨å…¥åˆ° BService
    â†’ BService åˆå§‹åŒ–å®Œæˆ
    â†’ åˆ›å»º BService æœ€ç»ˆä»£ç†ï¼ˆç¬¬äºŒæ¬¡ä»£ç†ç”Ÿæˆï¼‰
    â†’ BService å®Œæˆ
  â†’ BService ä»£ç†æ³¨å…¥åˆ° AService
  â†’ AService åˆå§‹åŒ–å®Œæˆ
  â†’ ä½¿ç”¨æ—©æœŸä»£ç†ä½œä¸ºæœ€ç»ˆä»£ç†
  â†’ AService å®Œæˆ
</span></code></pre>
<p>æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ª <code>A â†’ B â†’ A</code> çš„é—®é¢˜ï¼Œæˆ‘ä¸æ˜ç™½ä¸ºä»€ä¹ˆèƒ½æˆä¸ºé«˜é¢‘é¢è¯•é¢˜ï¼Œè¿™ä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆé«˜éš¾åº¦æŠ€æœ¯å«é‡ï¼Œä»ä¸‰çº§ç¼“å­˜è·å– <code>Bean</code> æºç å¦‚ä¸‹</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> Object <span class="hljs-title function_">getSingleton</span><span class="hljs-params">(String beanName, <span class="hljs-type">boolean</span> allowEarlyReference)</span> {
    <span class="hljs-comment">// ä»ä¸€çº§ç¼“å­˜è·å–</span>
    <span class="hljs-type">Object</span> <span class="hljs-variable">singletonObject</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.singletonObjects.get(beanName);
    <span class="hljs-keyword">if</span> (singletonObject == <span class="hljs-literal">null</span> &amp;&amp; isSingletonCurrentlyInCreation(beanName)) {
       <span class="hljs-comment">//ä¸€çº§ç¼“å­˜æ²¡æœ‰ï¼Œå†ä»äºŒçº§ç¼“å­˜è·å–</span>
       singletonObject = <span class="hljs-built_in">this</span>.earlySingletonObjects.get(beanName);
       <span class="hljs-keyword">if</span> (singletonObject == <span class="hljs-literal">null</span> &amp;&amp; allowEarlyReference) {
          <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.singletonLock.tryLock()) {
             <span class="hljs-comment">// Avoid early singleton inference outside of original creation thread.</span>
             <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
          }
          <span class="hljs-keyword">try</span> {
             <span class="hljs-comment">// åŠ é”å†æ¬¡åˆ¤æ–­ä¸€çº§ç¼“å­˜</span>
             singletonObject = <span class="hljs-built_in">this</span>.singletonObjects.get(beanName);
             <span class="hljs-keyword">if</span> (singletonObject == <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">//å†åˆ¤æ–­äºŒçº§ç¼“å­˜</span>
                singletonObject = <span class="hljs-built_in">this</span>.earlySingletonObjects.get(beanName);
                <span class="hljs-keyword">if</span> (singletonObject == <span class="hljs-literal">null</span>) {
                   <span class="hljs-comment">//ä»ä¸‰çº§ç¼“å­˜è·å–</span>
                   ObjectFactory&lt;?&gt; singletonFactory = <span class="hljs-built_in">this</span>.singletonFactories.get(beanName);
                   <span class="hljs-keyword">if</span> (singletonFactory != <span class="hljs-literal">null</span>) {
                      singletonObject = singletonFactory.getObject();
                      <span class="hljs-comment">// ä¸‰çº§ç¼“å­˜è·å–åˆ°å°±æ”¾å…¥äºŒçº§ç¼“å­˜</span>
                      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.singletonFactories.remove(beanName) != <span class="hljs-literal">null</span>) {
                         <span class="hljs-built_in">this</span>.earlySingletonObjects.put(beanName, singletonObject);
                      }
                      <span class="hljs-keyword">else</span> {
                         singletonObject = <span class="hljs-built_in">this</span>.singletonObjects.get(beanName);
                      }
                   }
                }
             }
          }
          <span class="hljs-keyword">finally</span> {
             <span class="hljs-built_in">this</span>.singletonLock.unlock();
          }
       }
    }
    <span class="hljs-keyword">return</span> singletonObject;
}
</code></pre>
<h3 data-id="heading-15">çœŸçš„éœ€è¦ç¬¬ä¸‰çº§ç¼“å­˜å—</h3>
<p>æˆ‘ä»¬æ€è€ƒè¿™ä¸ªåœºæ™¯ï¼Œæ˜¯å¦ä¸€å®šéœ€è¦ä¸‰çº§ç¼“å­˜ï¼Œå¦‚æœæ¢æˆäºŒçº§ç¼“å­˜æ˜¯å¦å¯ä»¥ï¼Ÿå…¶å®å¦‚æœæ‰€æœ‰çš„ <code>Bean</code> éƒ½ä¸éœ€è¦ä»£ç†çš„è¯ï¼Œå®Œå…¨å¯ä»¥ã€‚ç¬¬ä¸‰çº§çš„ç¼“å­˜å°±æ˜¯ä¸ºäº†è§£å†³ä¾èµ–çš„ <code>Bean</code> éœ€è¦è¢«ä»£ç†å­˜åœ¨çš„ï¼Œå¦‚æœå…è®¸å¾ªç¯ä¾èµ–ï¼Œåœ¨åˆ›å»º <code>Bean</code> çš„è¿‡ç¨‹ä¸­</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">boolean</span> <span class="hljs-variable">earlySingletonExposure</span> <span class="hljs-operator">=</span> (mbd.isSingleton() &amp;&amp; <span class="hljs-built_in">this</span>.allowCircularReferences &amp;&amp;
       isSingletonCurrentlyInCreation(beanName));
<span class="hljs-keyword">if</span> (earlySingletonExposure) {
    addSingletonFactory(beanName, () -&gt; getEarlyBeanReference(beanName, mbd, bean));
}
</code></pre>
<p>ä¼šå‘ç¬¬ä¸‰çº§ç¼“å­˜ä¸­å­˜æ”¾ä¸€ä¸ªå·¥å‚æ–¹æ³•ï¼Œç”¨æ¥è·å– <code>Bean</code> çš„å¼•ç”¨ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>singletonFactories</code> ç¬¬ä¸‰çº§ç¼“å­˜çš„ <code>value</code> æ˜¯ä¸€ä¸ª <code>ObjectFactory&lt;?&gt;</code> ã€‚</p>
<p>æ‰€è°“ç¬¬ä¸‰çº§ç¼“å­˜å°±æ˜¯åœ¨å†…å­˜é‡Œæ‰¾ä¸ªåœ°æ–¹å…ˆå­˜ç€è¿™ä¸ªå·¥å‚å›è°ƒæ–¹æ³•ï¼Œç­‰åˆ›å»ºå½“å‰ <code>A</code> æ‰€ä¾èµ–çš„ <code>B</code> æ—¶ï¼Œå‘ç° <code>B</code> éœ€è¦ <code>A</code>ï¼Œé‚£ä¹ˆå°±ä»è¿™é‡Œæ¥è·å– <code>A</code> çš„çœŸå®å¼•ç”¨ï¼Œå› ä¸º <code>A</code> å®ä¾‹çš„å¼•ç”¨å·²ç»å­˜åœ¨äº†ï¼Œå¦‚æœä¸éœ€è¦ä»£ç†é‚£ä¹ˆæˆ‘ä»¬ç›´æ¥è·å–è¿™ä¸ª <code>A</code> çš„å®ä¾‹å¼•ç”¨å³å¯ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸ºäº†é˜²æ­¢ <code>A</code> æ˜¯ä¸€ä¸ªæœ‰äº‹åŠ¡çš„ <code>Bean</code>ï¼Œé˜²æ­¢å®ƒéœ€è¦è¢«ä»£ç†ï¼Œæ‰€ä»¥ä»è¿™ä¸ªå·¥å‚è·å–çœŸå®å¼•ç”¨ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> Object <span class="hljs-title function_">getEarlyBeanReference</span><span class="hljs-params">(String beanName, RootBeanDefinition mbd, Object bean)</span> {
    <span class="hljs-type">Object</span> <span class="hljs-variable">exposedObject</span> <span class="hljs-operator">=</span> bean;
    <span class="hljs-keyword">if</span> (!mbd.isSynthetic() &amp;&amp; hasInstantiationAwareBeanPostProcessors()) {
       <span class="hljs-keyword">for</span> (SmartInstantiationAwareBeanPostProcessor bp : getBeanPostProcessorCache().smartInstantiationAware) {
          exposedObject = bp.getEarlyBeanReference(exposedObject, beanName);
       }
    }
    <span class="hljs-keyword">return</span> exposedObject;
}
</code></pre>
<p><code>AbstractAutoProxyCreator#getEarlyBeanReference()</code> ä¼šè¿”å›è¢«ä»£ç†åï¼ˆå¦‚æœéœ€è¦ï¼‰çš„å¯¹è±¡å¼•ç”¨</p>
<h3 data-id="heading-16">å›å¤´å†çœ‹ä¸‰çº§ç¼“å­˜</h3>
<p>å…¶å®æŠ›å¼€ <code>singletonObjects</code> å…ˆä¸è°ˆï¼Œå› ä¸ºå®ƒæ˜¯ <code>Bean</code> å®¹å™¨ï¼Œåªæœ‰ä¸¤ä¸ªç¼“å­˜çš„ <code>ConcurrentHashMap</code>ï¼Œ<code>singletonFactories</code> æ˜¯å­˜æ”¾æ—©æœŸå¼•ç”¨çš„è·å–å·¥å‚ï¼Œå› ä¸ºæˆ‘ä»¬ä¸ç¡®å®šæ˜¯å¦ä¼šå‘ç”Ÿå¾ªç¯ä¾èµ–ï¼Œä»¥å¤‡ä¸æ—¶ä¹‹éœ€ã€‚è€Œ <code>earlySingletonObjects</code> å°±æ˜¯å­˜æ”¾è°ƒç”¨æ—©æœŸå¼•ç”¨å·¥å‚åè·å–çš„å¼•ç”¨ï¼Œå¦‚æœéœ€è¦è¢«ä»£ç†ï¼Œå­˜å‚¨çš„å°±æ˜¯ä»£ç†å¯¹è±¡ï¼Œå¦‚æœä¸éœ€è¦è¢«ä»£ç†ï¼Œå­˜å‚¨çš„å°±æ˜¯åŸå§‹å¯¹è±¡ã€‚</p>
<p>å› ä¸ºå·¥å‚æ‰§è¡Œåè¿”å›çš„æ˜¯æœ€ç»ˆçœŸå®ä»£ç†å¯¹è±¡ï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸ªåœ°æ–¹å­˜å‚¨å®ƒï¼Œæ‰€ä»¥äºŒçº§ç¼“å­˜ <code>earlySingletonObjects</code> æ˜¯å¿…è¦çš„</p>
<p><strong>è¯´ç™½äº†å°±æ˜¯æˆ‘éœ€è¦æ‰¾ä¸ªåœ°æ–¹ä¸´æ—¶å­˜æ”¾ä¸€ä¸‹è¿™ä¸¤ä¸ªæ“ä½œå¾—åˆ°çš„ç»“æœï¼Œè‡³äºä½ å­˜åœ¨å“ªæ— æ‰€è°“ï¼Œæ‰€è°“çš„ä¸‰çº§ç¼“å­˜ä¸è¿‡æ˜¯è¿™äº›é¢è¯•å®˜è‡ªå·±å‡­ç©ºå®šä¹‰å‡ºæ¥çš„æ¦‚å¿µç½¢äº†</strong>ã€‚</p>
<h2 data-id="heading-17">è‡ªå®šä¹‰æ‰©å±•ä¿®æ”¹ä¸€ä¸ª Bean çš„æ–¹å¼</h2>
<p>ç°åœ¨æˆ‘ä»¬æ¥æ€è€ƒå‡å¦‚æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰æ‰©å±•ï¼Œä¿®æ”¹ä¸€ä¸ª <code>Spring Bean</code> æœ‰å“ªäº›æ–¹å¼</p>
<h3 data-id="heading-18">ä¿®æ”¹ BeanDefiniton</h3>
<p>å› ä¸º <code>Bean</code> çš„åˆ›å»ºæ˜¯æ ¹æ® <code>BeanDefinition</code> å†³å®šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ <code>BeanFactoryPostProcessor</code> ï¼Œæ ¹æ® <code>beanDefinitionNames</code> è·å–æŒ‡å®šçš„ <code>BeanDefinition</code> å¯¹å…¶å±æ€§è¿›è¡Œä¿®æ”¹</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> BeanFactoryPostProcessor <span class="hljs-title function_">myBeanFactoryPostProcessor</span><span class="hljs-params">()</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanFactoryPostProcessor</span>() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessBeanFactory</span><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="hljs-keyword">throws</span> BeansException {
            <span class="hljs-type">BeanDefinition</span> <span class="hljs-variable">testBean</span> <span class="hljs-operator">=</span> beanFactory.getBeanDefinition(<span class="hljs-string">"testBean"</span>);
            testBean.setAttribute(<span class="hljs-string">"name"</span>, <span class="hljs-string">"test"</span>);<span class="hljs-comment">//ä¿®æ”¹æŒ‡å®šå±æ€§</span>
        }
    };
}
</code></pre>
<h3 data-id="heading-19">è‡ªå®šä¹‰ BeanPostProcessor</h3>
<p>å› ä¸ºæ‰€æœ‰ <code>Bean</code> åˆ›å»ºéƒ½ä¼šæ‰§è¡Œ <code>BeanPostProcessor</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ª <code>BeanPostProcessor</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> BeanPostProcessor <span class="hljs-title function_">myBeanPostProcessor</span><span class="hljs-params">()</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanPostProcessor</span>() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">postProcessAfterInitialization</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException {
            <span class="hljs-keyword">if</span>(beanName.equals(<span class="hljs-string">"testBean"</span>)){
                <span class="hljs-comment">//å…ˆå¼ºè½¬ bean</span>
                <span class="hljs-comment">//ç„¶åè®¾ç½®å±æ€§</span>
            }
            <span class="hljs-keyword">return</span> BeanPostProcessor.<span class="hljs-built_in">super</span>.postProcessAfterInitialization(bean, beanName);
        }
    };
}
</code></pre>
<p>åˆ¤æ–­å½“æ‰§è¡Œåˆ°æˆ‘ä»¬ç›®æ ‡ <code>Bean</code> çš„æ—¶å€™å¯¹å…¶ä¿®æ”¹</p>
<h3 data-id="heading-20">å®šä¹‰ Customizers</h3>
<p>å¾ˆå¤š <code>SpringBoot</code> è‡ªåŠ¨é…ç½®çš„ <code>Bean</code> ä¸ºäº†æ–¹ä¾¿éƒ½ç»™å¼€å‘è€…é¢„ç•™äº†å®¢æˆ·å®šåˆ¶åŒ–å™¨ï¼Œä¾‹å¦‚äº‹åŠ¡ç®¡ç†å™¨çš„è‡ªåŠ¨é…ç½®</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span>
<span class="hljs-meta">@ConditionalOnSingleCandidate(DataSource.class)</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JdbcTransactionManagerConfiguration</span> {

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@ConditionalOnMissingBean(TransactionManager.class)</span>
    DataSourceTransactionManager <span class="hljs-title function_">transactionManager</span><span class="hljs-params">(Environment environment, DataSource dataSource,
          ObjectProvider&lt;TransactionManagerCustomizers&gt; transactionManagerCustomizers)</span> {
       <span class="hljs-type">DataSourceTransactionManager</span> <span class="hljs-variable">transactionManager</span> <span class="hljs-operator">=</span> createTransactionManager(environment, dataSource);
       <span class="hljs-comment">//åº”ç”¨ TransactionManagerCustomizers åŒ…è£… Bean é›†åˆ</span>
       transactionManagerCustomizers.ifAvailable((customizers) -&gt; customizers.customize(transactionManager));
       <span class="hljs-keyword">return</span> transactionManager;
    }

    <span class="hljs-comment">//åˆ›å»º jdbc äº‹åŠ¡ç®¡ç†å™¨</span>
    <span class="hljs-keyword">private</span> DataSourceTransactionManager <span class="hljs-title function_">createTransactionManager</span><span class="hljs-params">(Environment environment, DataSource dataSource)</span> {
       <span class="hljs-keyword">return</span> environment.getProperty(<span class="hljs-string">"spring.dao.exceptiontranslation.enabled"</span>, Boolean.class, Boolean.TRUE)
             ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">JdbcTransactionManager</span>(dataSource) : <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataSourceTransactionManager</span>(dataSource);
    }

}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@ConditionalOnClass(PlatformTransactionManager.class)</span>
<span class="hljs-meta">@AutoConfiguration(before = TransactionAutoConfiguration.class)</span>
<span class="hljs-meta">@EnableConfigurationProperties(TransactionProperties.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TransactionManagerCustomizationAutoConfiguration</span> {

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@ConditionalOnMissingBean</span>
    TransactionManagerCustomizers <span class="hljs-title function_">platformTransactionManagerCustomizers</span><span class="hljs-params">(
          ObjectProvider&lt;TransactionManagerCustomizer&lt;?&gt;&gt; customizers)</span> {
          <span class="hljs-comment">//åº”ç”¨ TransactionManagerCustomizer é›†åˆ Bean</span>
       <span class="hljs-keyword">return</span> TransactionManagerCustomizers.of(customizers.orderedStream().toList());
    }

    <span class="hljs-meta">@Bean</span>
    ExecutionListenersTransactionManagerCustomizer <span class="hljs-title function_">transactionExecutionListeners</span><span class="hljs-params">(
          ObjectProvider&lt;TransactionExecutionListener&gt; listeners)</span> {
          <span class="hljs-comment">//åº”ç”¨ TransactionExecutionListener é›†åˆ Bean</span>
       <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExecutionListenersTransactionManagerCustomizer</span>(listeners.orderedStream().toList());
    }

}
</code></pre>
<p>é‚£æˆ‘ä»¬åªè¦å®šä¹‰ä¸€ä¸ªæˆ–è€…å¤šä¸ª <code>TransactionExecutionListener</code> äº¤ç»™ <code>Spring</code> ç®¡ç†å°±ä¼šè‡ªåŠ¨é…åº”ç”¨åˆ°å½“å‰æ•°æ®æºçš„äº‹åŠ¡ç®¡ç†å™¨ä¸Šï¼Œç›‘å¬äº‹åŠ¡çš„æ‰§è¡Œé˜¶æ®µ</p>
<h3 data-id="heading-21">@Bean æ›¿æ¢</h3>
<p><code>SpringBoot</code> ä¸­è‡ªåŠ¨é…ç½®ç±»çš„ <code>@Bean</code> å£°æ˜éƒ½åŠ äº†æ¡ä»¶æ³¨è§£å½“ä¸å­˜åœ¨è¿™ä¸ª <code>Bean</code> çš„æ—¶å€™æ‰ä¼šç”Ÿæ•ˆï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæºç ä¸­çš„å£°æ˜æ‹·è´è¿‡æ¥ä¿®æ”¹å…¶ä¸­ä¸€äº›éƒ¨åˆ†ï¼Œä¾‹å¦‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-comment">//@ConditionalOnMissingBean å»æ‰è¿™ä¸ª</span>
<span class="hljs-keyword">public</span> SqlSessionTemplate <span class="hljs-title function_">sqlSessionTemplate</span><span class="hljs-params">(SqlSessionFactory sqlSessionFactory)</span> {
    <span class="hljs-comment">//...ä¿®æ”¹è‡ªå®šä¹‰é€»è¾‘</span>
    <span class="hljs-type">ExecutorType</span> <span class="hljs-variable">executorType</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.properties.getExecutorType();
    <span class="hljs-keyword">if</span> (executorType != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionTemplate</span>(sqlSessionFactory, executorType);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionTemplate</span>(sqlSessionFactory);
    }
}
</code></pre>
<h2 data-id="heading-22">ç»“è¯­</h2>
<p>é™æ€æ–‡æœ¬çš„æ–¹å¼å§‹ç»ˆæ— æ³•å½¢è±¡çš„è§£æè¯¦ç»†çš„ä»£ç æ‰§è¡Œè¿‡ç¨‹ï¼Œè¿™é‡Œåªèƒ½æä¾›ä¸€äº›å…³é”®ä»£ç ï¼Œè¦æ·±å…¥ç†è§£è¿˜éœ€è¦æˆ‘ä»¬è‡ªå·±å¤šè¯»æºç ï¼Œå¤šå®è·µã€‚</p>
<h3 data-id="heading-23">å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè®°å¾—ç‚¹èµåŠ å…³æ³¨ï¼ä½ çš„æ”¯æŒå°±æ˜¯æˆ‘ç»§ç»­åˆ›ä½œçš„åŠ¨åŠ›ï¼</h3></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åŒåº“ååŒï¼Œå„å–æ‰€é•¿ï¼š.NET Core ä¸­ PostgreSQL ä¸ SQLite çš„ä¼˜é›…èåˆå®æˆ˜]]></title>    <link>https://juejin.cn/post/7603771025856479283</link>    <guid>https://juejin.cn/post/7603771025856479283</guid>    <pubDate>2026-02-08T06:12:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603771025856479283" data-draft-id="7603651855236792329" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åŒåº“ååŒï¼Œå„å–æ‰€é•¿ï¼š.NET Core ä¸­ PostgreSQL ä¸ SQLite çš„ä¼˜é›…èåˆå®æˆ˜"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-08T06:12:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤§é»„è¯„æµ‹"/> <meta itemprop="url" content="https://juejin.cn/user/714024404135696"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åŒåº“ååŒï¼Œå„å–æ‰€é•¿ï¼š.NET Core ä¸­ PostgreSQL ä¸ SQLite çš„ä¼˜é›…èåˆå®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/714024404135696/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤§é»„è¯„æµ‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T06:12:53.000Z" title="Sun Feb 08 2026 06:12:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ç°ä»£åº”ç”¨å¼€å‘ä¸­ï¼Œå•ä¸€æ•°æ®åº“æ¶æ„å¾€å¾€éš¾ä»¥æ»¡è¶³æ‰€æœ‰åœºæ™¯éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½å¸Œæœ›ï¼š</p>
<ul>
<li><strong>ä¸»ä¸šåŠ¡æ•°æ®</strong>å­˜å…¥åŠŸèƒ½å¼ºå¤§ã€æ”¯æŒé«˜å¹¶å‘çš„ <strong>PostgreSQL</strong>ï¼›</li>
<li><strong>æœ¬åœ°ç¼“å­˜ã€è¾¹ç¼˜è®¡ç®—æˆ–åµŒå…¥å¼æ—¥å¿—</strong>ä½¿ç”¨è½»é‡ã€é›¶é…ç½®çš„ <strong>SQLite</strong>ã€‚</li>
</ul>
<p>è¿™ç§â€œæ··åˆæŒä¹…åŒ–â€ï¼ˆPolyglot Persistenceï¼‰ç­–ç•¥æ­£å˜å¾—è¶Šæ¥è¶Šæ™®éã€‚è€Œ .NET Core å‡­å€Ÿå…¶å¼ºå¤§çš„ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰ä½“ç³»å’Œ Entity Framework Coreï¼ˆEF Coreï¼‰çš„å¤šä¸Šä¸‹æ–‡æ”¯æŒï¼Œä¸ºåŒæ•°æ®åº“æ¶æ„æä¾›äº†ä¼˜é›…çš„å®ç°è·¯å¾„ã€‚</p>
<p>æœ¬æ–‡å°†æ‰‹æŠŠæ‰‹å¸¦ä½ æ„å»ºä¸€ä¸ªåŒæ—¶ä½¿ç”¨ <strong>PostgreSQLï¼ˆä¸»åº“ï¼‰</strong> å’Œ <strong>SQLiteï¼ˆè¾…åŠ©åº“ï¼‰</strong> çš„ .NET Core åº”ç”¨ï¼Œå¹¶åˆ†äº«ç”Ÿäº§çº§çš„æœ€ä½³å®è·µã€‚</p>
<hr/>
<h3 data-id="heading-0">ä¸€ã€ä¸ºä»€ä¹ˆé€‰æ‹© PostgreSQL + SQLiteï¼Ÿ</h3>






























<table><thead><tr><th>åœºæ™¯</th><th>PostgreSQL</th><th>SQLite</th></tr></thead><tbody><tr><td><strong>æ•°æ®è§„æ¨¡</strong></td><td>TB çº§ï¼Œå¤šç”¨æˆ·å¹¶å‘</td><td>GB çº§ï¼Œå•æœº/è¾¹ç¼˜</td></tr><tr><td><strong>éƒ¨ç½²å¤æ‚åº¦</strong></td><td>éœ€ç‹¬ç«‹æœåŠ¡</td><td>é›¶é…ç½®ï¼Œæ–‡ä»¶å³æ•°æ®åº“</td></tr><tr><td><strong>äº‹åŠ¡ä¸ä¸€è‡´æ€§</strong></td><td>å®Œæ•´ ACIDï¼Œæ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡</td><td>å•æ–‡ä»¶ ACIDï¼Œä¸æ”¯æŒå¹¶å‘å†™</td></tr><tr><td><strong>å…¸å‹ç”¨é€”</strong></td><td>ç”¨æˆ·è´¦æˆ·ã€è®¢å•ã€æ ¸å¿ƒä¸šåŠ¡</td><td>æœ¬åœ°ç¼“å­˜ã€è®¾å¤‡æ—¥å¿—ã€ä¸´æ—¶ä»»åŠ¡é˜Ÿåˆ—</td></tr></tbody></table>
<blockquote>
<p>âœ… ç»„åˆä¼˜åŠ¿ï¼š<br/>
ä¸»ä¸šåŠ¡å¼ºä¸€è‡´ + è¾¹ç¼˜æ•°æ®è½»é‡åŒ– = æ¶æ„å¼¹æ€§ä¸æ€§èƒ½å…¼é¡¾</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">äºŒã€é¡¹ç›®ç»“æ„è®¾è®¡</h3>
<p>æˆ‘ä»¬å°†åˆ›å»ºä¸¤ä¸ªç‹¬ç«‹çš„ <code>DbContext</code>ï¼Œåˆ†åˆ«å¯¹åº”ä¸åŒæ•°æ®åº“ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">MyApp/
â”œâ”€â”€ Data/
â”‚   â”œâ”€â”€ MainDbContext.cs        <span class="hljs-comment">// PostgreSQL</span>
â”‚   â””â”€â”€ LocalDbContext.cs       <span class="hljs-comment">// SQLite</span>
â”œâ”€â”€ Models/
â”‚   â”œâ”€â”€ User.cs                 <span class="hljs-comment">// å­˜äº PostgreSQL</span>
â”‚   â””â”€â”€ DeviceLog.cs            <span class="hljs-comment">// å­˜äº SQLite</span>
â”œâ”€â”€ Services/
â”‚   â”œâ”€â”€ UserService.cs
â”‚   â””â”€â”€ LogService.cs
â””â”€â”€ Program.cs
</code></pre>
<hr/>
<h3 data-id="heading-2">ä¸‰ã€Step-by-Step å®ç°</h3>
<h4 data-id="heading-3">1. å®‰è£…å¿…è¦ NuGet åŒ…</h4>
<pre><code class="hljs language-csharp" lang="csharp">dotnet <span class="hljs-keyword">add</span> package Npgsql.EntityFrameworkCore.PostgreSQL
dotnet <span class="hljs-keyword">add</span> package Microsoft.EntityFrameworkCore.Sqlite
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼šä¸è¦æ··ç”¨åŒä¸€ä¸ª DbContext æ³¨å†Œå¤šä¸ªæä¾›ç¨‹åºï¼</p>
</blockquote>
<h4 data-id="heading-4">2. å®šä¹‰æ¨¡å‹ï¼ˆModelsï¼‰</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// Models/User.cs</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">User</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Id { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-literal">default</span>!;
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Email { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-literal">default</span>!;
}

<span class="hljs-comment">// Models/DeviceLog.cs</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DeviceLog</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">long</span> Id { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> DateTime Timestamp { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Message { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-literal">default</span>!;
}
</code></pre>
<h4 data-id="heading-5">3. åˆ›å»ºä¸¤ä¸ª DbContext</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// Data/MainDbContext.cs</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainDbContext</span> : DbContext
{
    <span class="hljs-keyword">public</span> DbSet&lt;User&gt; Users { get; set; }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MainDbContext</span><span class="hljs-params">(DbContextOptions&lt;MainDbContext&gt; options)</span> : base(options) {</span> }

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-type">void</span> <span class="hljs-title">OnModelCreating</span><span class="hljs-params">(ModelBuilder modelBuilder)</span>
    </span>{
        modelBuilder.<span class="hljs-built_in">Entity</span>&lt;User&gt;().<span class="hljs-built_in">ToTable</span>(<span class="hljs-string">"users"</span>);
    }
}

<span class="hljs-comment">// Data/LocalDbContext.cs</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LocalDbContext</span> : DbContext
{
    <span class="hljs-keyword">public</span> DbSet&lt;DeviceLog&gt; DeviceLogs { get; set; }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">LocalDbContext</span><span class="hljs-params">(DbContextOptions&lt;LocalDbContext&gt; options)</span> : base(options) {</span> }

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-type">void</span> <span class="hljs-title">OnConfiguring</span><span class="hljs-params">(DbContextOptionsBuilder optionsBuilder)</span>
    </span>{
        <span class="hljs-comment">// å¯é€‰ï¼šè‹¥æœªé€šè¿‡ DI æ³¨å…¥è¿æ¥å­—ç¬¦ä¸²</span>
        <span class="hljs-comment">// optionsBuilder.UseSqlite("Data Source=device_logs.db");</span>
    }

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-type">void</span> <span class="hljs-title">OnModelCreating</span><span class="hljs-params">(ModelBuilder modelBuilder)</span>
    </span>{
        modelBuilder.<span class="hljs-built_in">Entity</span>&lt;DeviceLog&gt;().<span class="hljs-built_in">ToTable</span>(<span class="hljs-string">"device_logs"</span>);
    }
}
</code></pre>
<h4 data-id="heading-6">4. åœ¨ Program.cs ä¸­æ³¨å†ŒåŒä¸Šä¸‹æ–‡</h4>
<pre><code class="hljs language-ini" lang="ini">var <span class="hljs-attr">builder</span> = WebApplication.CreateBuilder(args)<span class="hljs-comment">;</span>

// æ³¨å†Œ PostgreSQL ä¸Šä¸‹æ–‡
builder.Services.AddDbContext&lt;MainDbContext&gt;(<span class="hljs-attr">options</span> =&gt;
    options.UseNpgsql(builder.Configuration.GetConnectionString("Postgres")))<span class="hljs-comment">;</span>

// æ³¨å†Œ SQLite ä¸Šä¸‹æ–‡
builder.Services.AddDbContext&lt;LocalDbContext&gt;(<span class="hljs-attr">options</span> =&gt;
    options.UseSqlite(builder.Configuration.GetConnectionString("Sqlite")))<span class="hljs-comment">;</span>

// è‡ªåŠ¨åˆ›å»ºæ•°æ®åº“ï¼ˆä»…å¼€å‘ç¯å¢ƒå»ºè®®ï¼‰
using var <span class="hljs-attr">scope</span> = builder.Services.BuildServiceProvider().CreateScope()<span class="hljs-comment">;</span>
scope.ServiceProvider.GetRequiredService&lt;MainDbContext&gt;().Database.EnsureCreated()<span class="hljs-comment">;</span>
scope.ServiceProvider.GetRequiredService&lt;LocalDbContext&gt;().Database.EnsureCreated()<span class="hljs-comment">;</span>
</code></pre>
<p><code>appsettings.json</code> é…ç½®ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"ConnectionStrings"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"Postgres"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Host=localhost;Database=myapp;Username=postgres;Password=secret"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"Sqlite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Data Source=device_logs.db"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-7">5. ç¼–å†™æœåŠ¡å±‚ï¼ŒæŒ‰éœ€æ³¨å…¥</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// Services/UserService.cs</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> MainDbContext _db;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">UserService</span>(<span class="hljs-params">MainDbContext db</span>)</span> =&gt; _db = db;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;User&gt; <span class="hljs-title">CreateUser</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> name, <span class="hljs-built_in">string</span> email</span>)</span>
    {
        <span class="hljs-keyword">var</span> user = <span class="hljs-keyword">new</span> User { Name = name, Email = email };
        _db.Users.Add(user);
        <span class="hljs-keyword">await</span> _db.SaveChangesAsync();
        <span class="hljs-keyword">return</span> user;
    }
}

<span class="hljs-comment">// Services/LogService.cs</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">LogService</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> LocalDbContext _localDb;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">LogService</span>(<span class="hljs-params">LocalDbContext localDb</span>)</span> =&gt; _localDb = localDb;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">LogMessage</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> msg</span>)</span>
    {
        _localDb.DeviceLogs.Add(<span class="hljs-keyword">new</span> DeviceLog
        {
            Timestamp = DateTime.UtcNow,
            Message = msg
        });
        <span class="hljs-keyword">await</span> _localDb.SaveChangesAsync();
    }
}
</code></pre>
<p>æ§åˆ¶å™¨ä¸­ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-dart" lang="dart">app.MapPost(<span class="hljs-string">"/user"</span>, <span class="hljs-keyword">async</span> (UserService userService, HttpRequest req) =&gt;
{
    <span class="hljs-keyword">var</span> user = <span class="hljs-keyword">await</span> userService.CreateUser(<span class="hljs-string">"Alice"</span>, <span class="hljs-string">"alice@example.com"</span>);
    <span class="hljs-keyword">return</span> Results.Ok(user);
});

app.MapPost(<span class="hljs-string">"/log"</span>, <span class="hljs-keyword">async</span> (LogService logService, [FromBody] string msg) =&gt;
{
    <span class="hljs-keyword">await</span> logService.LogMessage(msg);
    <span class="hljs-keyword">return</span> Results.Ok();
});
</code></pre>
<hr/>
<h3 data-id="heading-8">å››ã€æœ€ä½³å®è·µä¸é¿å‘æŒ‡å—</h3>
<h4 data-id="heading-9">âœ… 1. <strong>ä¸¥æ ¼åˆ†ç¦»å…³æ³¨ç‚¹</strong></h4>
<ul>
<li>ä¸è¦åœ¨åŒä¸€ä¸ªä¸šåŠ¡æ–¹æ³•ä¸­åŒæ—¶æ“ä½œä¸¤ä¸ª DbContextï¼ˆé™¤éå¿…è¦ï¼‰ï¼›</li>
<li>è‹¥éœ€è·¨åº“äº‹åŠ¡ï¼Œè€ƒè™‘æœ€ç»ˆä¸€è‡´æ€§ï¼ˆå¦‚é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—è¡¥å¿ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-10">âœ… 2. <strong>è¿æ¥å­—ç¬¦ä¸²å®‰å…¨</strong></h4>
<ul>
<li>PostgreSQL å¯†ç å‹¿ç¡¬ç¼–ç ï¼Œä½¿ç”¨ Secret Manager æˆ– Azure Key Vaultï¼›</li>
<li>SQLite è·¯å¾„å»ºè®®ä½¿ç”¨ <code>Path.Combine(Directory.GetCurrentDirectory(), "data", "logs.db")</code> ç¡®ä¿å¯ç§»æ¤æ€§ã€‚</li>
</ul>
<h4 data-id="heading-11">âœ… 3. <strong>è¿ç§»ï¼ˆMigrationsï¼‰ç®¡ç†</strong></h4>
<ul>
<li>
<p>ä¸ºæ¯ä¸ª DbContext å•ç‹¬å¯ç”¨è¿ç§»ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">dotnet ef migrations <span class="hljs-keyword">add</span> InitialMain -c MainDbContext -o Migrations/Postgres
dotnet ef migrations <span class="hljs-keyword">add</span> InitialLocal -c LocalDbContext -o Migrations/Sqlite
</code></pre>
</li>
<li>
<p>ç”Ÿäº§ç¯å¢ƒå»ºè®®æ‰‹åŠ¨å®¡æ ¸ SQL è„šæœ¬ã€‚</p>
</li>
</ul>
<h4 data-id="heading-12">âœ… 4. <strong>æ€§èƒ½ä¸èµ„æº</strong></h4>
<ul>
<li>SQLite é»˜è®¤ä¸æ”¯æŒé«˜å¹¶å‘å†™å…¥ï¼Œé¿å…åœ¨ Web API çƒ­ç‚¹è·¯å¾„é¢‘ç¹å†™æ—¥å¿—ï¼›</li>
<li>å¯æ­é… <code>Microsoft.Data.Sqlite</code> çš„ WAL æ¨¡å¼æå‡å¹¶å‘è¯»æ€§èƒ½ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-13">äº”ã€é€‚ç”¨åœºæ™¯æ¨è</h3>
<ul>
<li>ğŸ“± <strong>IoT è¾¹ç¼˜è®¾å¤‡ + äº‘ä¸­å¿ƒ</strong>ï¼šè®¾å¤‡ç”¨ SQLite è®°å½•æœ¬åœ°çŠ¶æ€ï¼Œå®šæœŸåŒæ­¥åˆ°äº‘ç«¯ PostgreSQLï¼›</li>
<li>ğŸ–¥ï¸ <strong>æ¡Œé¢åº”ç”¨</strong>ï¼šé…ç½®ã€ç¼“å­˜ç”¨ SQLiteï¼Œç”¨æˆ·æ•°æ®åŒæ­¥åˆ° PostgreSQLï¼›</li>
<li>ğŸ§ª <strong>æµ‹è¯•éš”ç¦»</strong>ï¼šé›†æˆæµ‹è¯•æ—¶ç”¨ SQLite æ›¿ä»£ PostgreSQLï¼ŒåŠ é€Ÿæ‰§è¡Œã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-14">ç»“è¯­</h3>
<p>åœ¨ .NET Core ä¸­èåˆ PostgreSQL ä¸ SQLiteï¼Œå¹¶éâ€œç‚«æŠ€â€ï¼Œè€Œæ˜¯å¯¹<strong>åœºæ™¯é€‚é…æ€§</strong>çš„ç†æ€§é€‰æ‹©ã€‚é€šè¿‡æ¸…æ™°çš„æ¶æ„åˆ†å±‚ã€ç‹¬ç«‹çš„ DbContext è®¾è®¡å’Œåˆç†çš„æœåŠ¡æ³¨å…¥ï¼Œæˆ‘ä»¬æ—¢èƒ½äº«å— PostgreSQL çš„ä¼ä¸šçº§èƒ½åŠ›ï¼Œåˆèƒ½åˆ©ç”¨ SQLite çš„æè‡´è½»é‡ã€‚</p>
<p>åŒåº“ååŒï¼Œä¸æ˜¯å¦¥åï¼Œè€Œæ˜¯æ™ºæ…§â€”â€”è®©æ¯ä¸€ä»½æ•°æ®ï¼Œéƒ½è½åœ¨æœ€é€‚åˆå®ƒçš„åœŸå£¤ä¸Šã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[vue3ä½¿ç”¨jsxè¯­æ³•è¯¦è§£]]></title>    <link>https://juejin.cn/post/7603651855236481033</link>    <guid>https://juejin.cn/post/7603651855236481033</guid>    <pubDate>2026-02-08T03:38:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603651855236481033" data-draft-id="7603627478021488650" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="vue3ä½¿ç”¨jsxè¯­æ³•è¯¦è§£"/> <meta itemprop="keywords" content="Vue.js,å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-08T03:38:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ˜Ÿå…‰ä¸é—®èµ¶è·¯äºº"/> <meta itemprop="url" content="https://juejin.cn/user/950397121075304"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            vue3ä½¿ç”¨jsxè¯­æ³•è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/950397121075304/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ˜Ÿå…‰ä¸é—®èµ¶è·¯äºº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T03:38:05.000Z" title="Sun Feb 08 2026 03:38:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è™½ç„¶æœ€æ—©æ˜¯ç”± React å¼•å…¥ï¼Œä½†å®é™…ä¸Š JSX è¯­æ³•å¹¶æ²¡æœ‰å®šä¹‰è¿è¡Œæ—¶è¯­ä¹‰ï¼Œå¹¶ä¸”èƒ½è¢«ç¼–è¯‘æˆå„ç§ä¸åŒçš„è¾“å‡ºå½¢å¼ã€‚å¦‚æœä½ ä¹‹å‰ä½¿ç”¨è¿‡ JSX è¯­æ³•ï¼Œé‚£ä¹ˆè¯·æ³¨æ„Â <strong>Vue çš„ JSX è½¬æ¢æ–¹å¼ä¸ React ä¸­ JSX çš„è½¬æ¢æ–¹å¼ä¸åŒ</strong>ï¼Œå› æ­¤ä½ ä¸èƒ½åœ¨ Vue åº”ç”¨ä¸­ä½¿ç”¨ React çš„ JSX è½¬æ¢ã€‚ä¸ React JSX è¯­æ³•çš„ä¸€äº›æ˜æ˜¾åŒºåˆ«åŒ…æ‹¬ï¼š</p>
<ul>
<li>å¯ä»¥ä½¿ç”¨ HTML attributes æ¯”å¦‚Â <code>class</code>Â å’ŒÂ <code>for</code>Â ä½œä¸º props - ä¸éœ€è¦ä½¿ç”¨Â <code>className</code>Â æˆ–Â <code>htmlFor</code>ã€‚</li>
<li>ä¼ é€’å­å…ƒç´ ç»™ç»„ä»¶ (æ¯”å¦‚ slots) çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.vuejs.org%2Fguide%2Fextras%2Frender-function.html%23passing-slots" target="_blank" title="https://cn.vuejs.org/guide/extras/render-function.html#passing-slots" ref="nofollow noopener noreferrer">æ–¹å¼ä¸åŒ</a>ã€‚</li>
</ul>
<h2 data-id="heading-0">æ·»åŠ çš„é…ç½®</h2>
<h3 data-id="heading-1">1ï¸âƒ£ tsconfig</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"jsx"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"preserve"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"jsxImportSource"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vue"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-2">2ï¸âƒ£ vite.config.ts</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span>
<span class="hljs-keyword">import</span> vueJsx <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue-jsx'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">vue</span>(), <span class="hljs-title function_">vueJsx</span>()]
}
</code></pre>
<h2 data-id="heading-3">ä»£ç æ¼”ç¤º</h2>
<p>åœ¨ <strong>vueæ–‡ä»¶</strong> ä¸­</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"tsx"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { computed, defineComponent, ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> count = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)

<span class="hljs-comment">// 1. å®šä¹‰ä¸€ä¸ª JSX ç‰‡æ®µæˆ–å°ç»„ä»¶</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">RenderHeader</span> = (<span class="hljs-params"/>) =&gt; (
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">header</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>è¿™æ˜¯ JSX æ¸²æŸ“çš„æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>å½“å‰è®¡æ•°: {count.value}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span></span>
)

<span class="hljs-comment">// 2. è¿™æ˜¯ä¸€ä¸ªè¿”å› VNode çš„è®¡ç®—å±æ€§ã€‚æ­é… component ä½¿ç”¨</span>
<span class="hljs-keyword">const</span> renderContent = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> count.<span class="hljs-property">value</span> &gt; <span class="hljs-number">5</span> ? (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>å·²è¾¾åˆ°ä¸Šé™<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span>
  ) : (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> count.value++}&gt;å¢åŠ <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  )
})

<span class="hljs-comment">// 3. æ™®é€šç»„ä»¶, setupè¿”å›ä¸€ä¸ªæ¸²æŸ“å‡½æ•°</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Bbb</span> = <span class="hljs-title function_">defineComponent</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'Bbb'</span>,
  <span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>11111<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  },
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">RenderHeader</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">:is</span>=<span class="hljs-string">"renderContent"</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Bbb</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼š<code>lang</code>çš„å€¼æ˜¯ tsx</p>
</blockquote>
<p>åœ¨ <strong>tsxæ–‡ä»¶</strong> ä¸­</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// å‡½æ•°å¼ç»„ä»¶</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> () =&gt; {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">{styles.name}</span>&gt;</span>hello world<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">Aaa</span> = <span class="hljs-title function_">defineComponent</span>({
  <span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> t = <span class="hljs-title function_">ref</span>(<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>())
    <span class="hljs-comment">// è¿”å›æ¸²æŸ“å‡½æ•°</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>aaa {t.value}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  },
})
</code></pre>
<h2 data-id="heading-4"><strong>æ ·å¼æ–¹æ¡ˆé€‰å‹</strong></h2>
<p>ä½¿ç”¨ JSX/TSXï¼Œ<strong>CSS Modules</strong> æˆ– <strong>Tailwind CSS</strong> æ˜¯æ›´å¥½çš„æ­æ¡£ã€‚Scoped CSS æ˜¯ä¸“ä¸º Template è®¾è®¡çš„ã€‚</p>
<p>åœ¨ vueæ–‡ä»¶ ä¸­ï¼Œä½¿ç”¨ CSS Modules</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">module</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.header</span> {
  <span class="hljs-attribute">color</span>: blue;
}

<span class="hljs-selector-class">.content</span> {
  <span class="hljs-attribute">color</span>: green;
}

<span class="hljs-selector-class">.bbb</span> {
  <span class="hljs-attribute">color</span>: red;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h2 data-id="heading-5">eslint</h2>
<p>è¦åœ¨ vueæ–‡ä»¶ ä¸­ä½¿ç”¨tsxï¼Œåº”æ·»åŠ  <code>configureVueProject</code> çš„é…ç½®</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">configureVueProject</span>({ <span class="hljs-attr">scriptLangs</span>: [<span class="hljs-string">'ts'</span>, <span class="hljs-string">'tsx'</span>] })

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfigWithVueTs</span>(
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'app/files-to-lint'</span>,
    <span class="hljs-attr">files</span>: [<span class="hljs-string">'**/*.{ts,mts,tsx,vue}'</span>],
  },

  <span class="hljs-title function_">globalIgnores</span>([<span class="hljs-string">'**/dist/**'</span>, <span class="hljs-string">'**/dist-ssr/**'</span>, <span class="hljs-string">'**/coverage/**'</span>]),

  pluginVue.<span class="hljs-property">configs</span>[<span class="hljs-string">'flat/essential'</span>],
  vueTsConfigs.<span class="hljs-property">recommended</span>,
  skipFormatting,
)
</code></pre>
<h2 data-id="heading-6">å‚è€ƒ</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.vuejs.org%2Fguide%2Fextras%2Frender-function.html%23jsx-tsx" target="_blank" title="https://cn.vuejs.org/guide/extras/render-function.html#jsx-tsx" ref="nofollow noopener noreferrer">cn.vuejs.org/guide/extraâ€¦</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2F%40vue%2Feslint-config-typescript" target="_blank" title="https://www.npmjs.com/package/@vue/eslint-config-typescript" ref="nofollow noopener noreferrer">www.npmjs.com/package/@vuâ€¦</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‘Šåˆ«æ‰‹å†™HTTPè¯·æ±‚ï¼Spring Feign è°ƒç”¨åŸç†æ·±åº¦æ‹†è§£ï¼šä»æºç åˆ°å®æˆ˜ï¼Œä¸€ç¯‡ææ‡‚]]></title>    <link>https://juejin.cn/post/7604345576176828454</link>    <guid>https://juejin.cn/post/7604345576176828454</guid>    <pubDate>2026-02-09T07:48:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604345576176828454" data-draft-id="7604471065859932211" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‘Šåˆ«æ‰‹å†™HTTPè¯·æ±‚ï¼Spring Feign è°ƒç”¨åŸç†æ·±åº¦æ‹†è§£ï¼šä»æºç åˆ°å®æˆ˜ï¼Œä¸€ç¯‡ææ‡‚"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-09T07:48:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¥å¥‡å°æ±¤åœ†"/> <meta itemprop="url" content="https://juejin.cn/user/1151943919285431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‘Šåˆ«æ‰‹å†™HTTPè¯·æ±‚ï¼Spring Feign è°ƒç”¨åŸç†æ·±åº¦æ‹†è§£ï¼šä»æºç åˆ°å®æˆ˜ï¼Œä¸€ç¯‡ææ‡‚
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943919285431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¥å¥‡å°æ±¤åœ†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T07:48:26.000Z" title="Mon Feb 09 2026 07:48:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»38åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>ä¸€ã€å¼•è¨€ï¼šå¾®æœåŠ¡è¿œç¨‹è°ƒç”¨çš„ â€œç—›ç‚¹â€ ä¸ Feign çš„ â€œæ•‘èµâ€</strong></h2>
<h3 data-id="heading-1"><strong>1.1 å¾®æœåŠ¡è¿œç¨‹è°ƒç”¨çš„å¸¸è§å›°å¢ƒ</strong></h3>
<p>åœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D269436125%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%25BE%25AE%25E6%259C%258D%25E5%258A%25A1%25E6%259E%25B6%25E6%259E%2584%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=269436125&amp;content_type=Article&amp;match_order=1&amp;q=%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84&amp;zhida_source=entity" ref="nofollow noopener noreferrer">å¾®æœåŠ¡æ¶æ„</a>ç››è¡Œçš„å½“ä¸‹ï¼ŒæœåŠ¡é—´çš„è¿œç¨‹è°ƒç”¨æˆä¸ºäº†æ¶æ„è®¾è®¡ä¸­æ— æ³•å›é¿çš„å…³é”®ç¯èŠ‚ã€‚å°±å¥½æ¯”ä¸€ä¸ªå¤§å‹å·¥å‚ï¼Œå„ä¸ªè½¦é—´ï¼ˆå¾®æœåŠ¡ï¼‰è´Ÿè´£ä¸åŒçš„ç”Ÿäº§ç¯èŠ‚ï¼Œä½†å®ƒä»¬ä¹‹é—´éœ€è¦é¢‘ç¹ä¼ é€’åŸææ–™ã€åŠæˆå“å’Œç”Ÿäº§æŒ‡ä»¤ï¼Œè¿™å°±ä¾èµ–äºé«˜æ•ˆçš„è¿œç¨‹è°ƒç”¨æœºåˆ¶ã€‚åœ¨ Spring é¡¹ç›®ä¸­ï¼Œæ—©æœŸå¸¸ç”¨çš„è¿œç¨‹è°ƒç”¨å·¥å…· RestTemplateï¼Œè™½ç„¶èƒ½å®ŒæˆåŸºæœ¬çš„ HTTP è¯·æ±‚æ“ä½œï¼Œå´å­˜åœ¨è¯¸å¤šå¼Šç«¯ã€‚</p>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œæ¯æ¬¡å‘èµ·è¿œç¨‹è°ƒç”¨ï¼Œéƒ½å¾—åƒæ‰‹å·¥æ­å»ºç§¯æœ¨ä¸€æ ·æ‰‹åŠ¨æ‹¼æ¥ URLã€‚å¦‚æœæœåŠ¡åœ°å€å˜æ›´ï¼Œæˆ–è€…å‚æ•°æœ‰è°ƒæ•´ï¼Œé‚£æ‹¼æ¥çš„ä»£ç å°±å¾—è·Ÿç€ä¿®æ”¹ï¼Œç¨æœ‰ä¸æ…å°±å¯èƒ½å‡ºé”™ã€‚è€Œä¸”ï¼Œå¯¹äºå‚æ•°çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œä¹Ÿéœ€è¦å¼€å‘è€…æ‰‹åŠ¨å¤„ç†ï¼Œè¿™å°±åƒæ˜¯åœ¨æ¯æ¬¡è¿è¾“è´§ç‰©å‰ï¼Œéƒ½å¾—äº²è‡ªæ‰“åŒ…å’Œæ‹†åŒ…ï¼Œé‡å¤ä¸”ç¹çã€‚æ¯”å¦‚ï¼Œå½“ä½ éœ€è¦ä¼ é€’ä¸€ä¸ªå¤æ‚çš„ Java å¯¹è±¡ä½œä¸ºè¯·æ±‚å‚æ•°æ—¶ï¼Œä½ å¾—æ‰‹åŠ¨å°†å…¶è½¬æ¢ä¸º JSON æˆ– XML æ ¼å¼ï¼Œåœ¨æ¥æ”¶å“åº”æ—¶ï¼Œåˆå¾—æ‰‹åŠ¨å°†è¿”å›çš„ JSON æˆ– XML è§£ææˆ Java å¯¹è±¡ã€‚</p>
<p>éšç€å¾®æœåŠ¡æ•°é‡çš„å¢åŠ ï¼Œä»£ç ä¸­å……æ–¥ç€å¤§é‡ç±»ä¼¼çš„è¿œç¨‹è°ƒç”¨ä»£ç ï¼Œä¸ä»…å†—ä½™åº¦é«˜ï¼Œå¯è¯»æ€§ä¹Ÿæå·®ã€‚è¿™å°±å¥½æ¯”å·¥å‚é‡Œçš„å„ä¸ªè½¦é—´ä¹‹é—´çš„æ²Ÿé€šæ–¹å¼æ‚ä¹±æ— ç« ï¼Œå¯¼è‡´ç»´æŠ¤æˆæœ¬æ€¥å‰§ä¸Šå‡ã€‚å½“ä¸€ä¸ªå¾®æœåŠ¡éœ€è¦è°ƒç”¨å¤šä¸ªå…¶ä»–å¾®æœåŠ¡æ—¶ï¼Œæˆ–è€…å¤šä¸ªå¾®æœåŠ¡ä¹‹é—´å­˜åœ¨å¤æ‚çš„ç›¸äº’è°ƒç”¨å…³ç³»æ—¶ï¼Œä»£ç çš„ç»´æŠ¤éš¾åº¦å°±ä¼šå‘ˆæŒ‡æ•°çº§å¢é•¿ï¼Œç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ï¼Œä¿®æ”¹ä¸€å¤„è°ƒç”¨å¯èƒ½ä¼šå½±å“åˆ°æ•´ä¸ªç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚</p>
<h3 data-id="heading-2"><strong>1.2 Feignï¼šå£°æ˜å¼è¿œç¨‹è°ƒç”¨çš„ â€œåˆ©å™¨â€</strong></h3>
<p>Feignï¼Œä½œä¸ºÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D269436125%26content_type%3DArticle%26match_order%3D1%26q%3DSpring%2BCloud%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=269436125&amp;content_type=Article&amp;match_order=1&amp;q=Spring+Cloud&amp;zhida_source=entity" ref="nofollow noopener noreferrer">Spring Cloud</a>Â ç”Ÿæ€ä¸­ä¸€æ¬¾å¼ºå¤§çš„å£°æ˜å¼ HTTP å®¢æˆ·ç«¯ï¼Œå°±åƒæ˜¯ç»™å¾®æœåŠ¡é—´çš„è¿œç¨‹è°ƒç”¨è£…ä¸Šäº†æ™ºèƒ½å¯¼èˆªç³»ç»Ÿï¼Œå®Œç¾åœ°è§£å†³äº†ä¸Šè¿°å›°å¢ƒã€‚å®ƒçš„æ ¸å¿ƒä¼˜åŠ¿åœ¨äºï¼Œé€šè¿‡ â€œæ¥å£ + æ³¨è§£â€ çš„æ–¹å¼ï¼Œè®©è¿œç¨‹è°ƒç”¨å˜å¾—åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ç›´è§‚å’Œç®€å•ã€‚</p>
<p>ä»¥ä¸€ä¸ªç”µå•†ç³»ç»Ÿä¸ºä¾‹ï¼Œè®¢å•æœåŠ¡éœ€è¦è°ƒç”¨ç”¨æˆ·æœåŠ¡è·å–ç”¨æˆ·ä¿¡æ¯ã€‚ä½¿ç”¨ Feignï¼Œæˆ‘ä»¬åªéœ€å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œåœ¨æ¥å£æ–¹æ³•ä¸Šæ·»åŠ ç›¸åº”çš„æ³¨è§£ï¼Œå¦‚@FeignClientæŒ‡å®šè¦è°ƒç”¨çš„æœåŠ¡åï¼Œ@RequestMappingç­‰æ³¨è§£å®šä¹‰è¯·æ±‚è·¯å¾„å’Œå‚æ•°ï¼Œå°±å¯ä»¥è½»æ¾å®ç°è¿œç¨‹è°ƒç”¨ã€‚å¯¹æ¯” RestTemplateï¼ŒFeign æ— éœ€æ‰‹åŠ¨æ‹¼æ¥ URL å’Œå¤„ç†å‚æ•°åºåˆ—åŒ– / ååºåˆ—åŒ–ï¼Œä»£ç é‡å¤§å¹…å‡å°‘ï¼Œå¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§æ˜¾è‘—æå‡ã€‚è¿™å°±å¥½æ¯”è½¦é—´ä¹‹é—´çš„æ²Ÿé€šä¸å†éœ€è¦ç¹ççš„äººå·¥ä¼ é€’ä¿¡æ¯ï¼Œè€Œæ˜¯é€šè¿‡ä¸€å¥—æ ‡å‡†åŒ–çš„æ™ºèƒ½é€šä¿¡ç³»ç»Ÿï¼Œç›´æ¥å‘é€å’Œæ¥æ”¶æ¸…æ™°æ˜ç¡®çš„æŒ‡ä»¤ã€‚</p>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢ç©¶ Feign çš„åº•å±‚åŸç†ï¼Œæ­å¼€å®ƒæ˜¯å¦‚ä½•å®ç°å¦‚æ­¤ç®€æ´é«˜æ•ˆçš„è¿œç¨‹è°ƒç”¨ï¼›é€šè¿‡å®æˆ˜æ“ä½œï¼Œè®©å¤§å®¶äº²èº«ä½“éªŒ Feign åœ¨é¡¹ç›®ä¸­çš„åº”ç”¨ï¼›è¿˜ä¼šæ¢è®¨ Feign çš„é«˜çº§ç‰¹æ€§ï¼Œå¦‚è´Ÿè½½å‡è¡¡ã€ç†”æ–­é™çº§ç­‰ï¼Œå¸®åŠ©å¤§å®¶å…¨é¢æŒæ¡è¿™ä¸€å¼ºå¤§å·¥å…·ï¼Œåœ¨ Spring é¡¹ç›®å¼€å‘ä¸­å¦‚è™æ·»ç¿¼ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/86e119a06ccc461db63391639f5e5067~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771228108&amp;x-signature=hPs2%2F6iP%2FCbOPy8vEPpust2ByAo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3"><strong>äºŒã€æ ¸å¿ƒåŸç†æ­ç§˜ï¼šFeign å¦‚ä½• â€œåŒ–æ¥å£ä¸º HTTP è¯·æ±‚â€ï¼Ÿ</strong></h2>
<h3 data-id="heading-4"><strong>2.1 çµé­‚æœºåˆ¶ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D269436125%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%258A%25A8%25E6%2580%2581%25E4%25BB%25A3%25E7%2590%2586%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=269436125&amp;content_type=Article&amp;match_order=1&amp;q=%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86&amp;zhida_source=entity" ref="nofollow noopener noreferrer">åŠ¨æ€ä»£ç†</a>æ˜¯ Feign çš„ â€œæ ¸å¿ƒå¼•æ“â€</strong></h3>
<p>Feign çš„æ ¸å¿ƒå®ç°ä¾èµ–äº JDK åŠ¨æ€ä»£ç†ï¼Œè¿™ä¸€æœºåˆ¶å°±åƒæ˜¯éšè—åœ¨å¹•åçš„ â€œè¶…çº§å¤§è„‘â€ï¼ŒæŒæ§ç€ Feign ä»æ¥å£å®šä¹‰åˆ° HTTP è¯·æ±‚çš„ç¥å¥‡è½¬åŒ–è¿‡ç¨‹ã€‚</p>
<p>å½“æˆ‘ä»¬åœ¨ Spring é¡¹ç›®ä¸­å¯åŠ¨åº”ç”¨æ—¶ï¼Œ@EnableFeignClientsæ³¨è§£å°±å¦‚åŒå¹å“äº†é›†åˆçš„å·è§’ï¼Œè§¦å‘ Spring å¯¹æŒ‡å®šåŒ…è·¯å¾„ä¸‹æ‰€æœ‰æ ‡æ³¨äº†@FeignClientæ³¨è§£çš„æ¥å£è¿›è¡Œæ‰«æã€‚åœ¨æ‰«æè¿‡ç¨‹ä¸­ï¼ŒSpring ä¼šä¸ºæ¯ä¸€ä¸ªè¿™æ ·çš„æ¥å£ç²¾å¿ƒç”Ÿæˆä¸€ä¸ªä»£ç†ç±»ï¼Œè¿™ä¸ªä»£ç†ç±»å¯ä¸æ˜¯æ™®é€šçš„ç±»ï¼Œå®ƒæ˜¯ç”±FeignInvocationHandleré©±åŠ¨çš„ç‰¹æ®Šå­˜åœ¨ã€‚</p>
<p>ä»¥ä¸€ä¸ªç®€å•çš„ç”µå•†è®¢å•æœåŠ¡è°ƒç”¨ç”¨æˆ·æœåŠ¡è·å–ç”¨æˆ·åœ°å€çš„åœºæ™¯ä¸ºä¾‹ã€‚æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªUserServiceFeignClientæ¥å£ï¼Œå¹¶ä½¿ç”¨@FeignClient(name = "user-service")æ³¨è§£æ ‡è®°å®ƒï¼ŒæŒ‡å®šè¦è°ƒç”¨çš„æ˜¯åä¸ºuser-serviceçš„å¾®æœåŠ¡ã€‚å½“é¡¹ç›®å¯åŠ¨åï¼ŒSpring ä¼šæ‰«æåˆ°è¿™ä¸ªæ¥å£ï¼Œå¹¶ç”Ÿæˆç›¸åº”çš„ä»£ç†ç±»ã€‚</p>
<p>å½“è®¢å•æœåŠ¡ä¸­çš„ä»£ç è°ƒç”¨UserServiceFeignClientæ¥å£çš„æŸä¸ªæ–¹æ³•ï¼Œæ¯”å¦‚getUserAddress(Long userId)æ—¶ï¼Œå®é™…ä¸Šè°ƒç”¨çš„æ˜¯ä»£ç†ç±»ä¸­çš„æ–¹æ³•ã€‚ä»£ç†ç±»ä¸­çš„FeignInvocationHandlerä¼šè¿…é€Ÿæ¥ç®¡è¿™ä¸ªè¯·æ±‚ï¼Œå°±åƒæ¥åˆ°ä»»åŠ¡çš„ç‰¹ç§å…µä¸€æ ·é«˜æ•ˆè¡ŒåŠ¨ã€‚å®ƒä¼šæ ¹æ®æ¥å£æ–¹æ³•ä¸Šçš„æ³¨è§£ï¼ˆå¦‚@GetMappingã€@PathVariableç­‰ï¼‰ä»¥åŠæ–¹æ³•å‚æ•°ï¼Œç²¾å¿ƒæ„å»ºå‡ºä¸€ä¸ªåŒ…å«å®Œæ•´ HTTP è¯·æ±‚ä¿¡æ¯çš„RequestTemplateï¼Œè¿™ä¸ªæ¨¡æ¿å°±åƒæ˜¯ä¸€ä»½è¯¦ç»†çš„ä½œæˆ˜è®¡åˆ’ï¼ŒåŒ…å«äº†è¯·æ±‚çš„ URLã€æ–¹æ³•ï¼ˆGETã€POST ç­‰ï¼‰ã€è¯·æ±‚å¤´ã€è¯·æ±‚ä½“ç­‰å…³é”®ä¿¡æ¯ã€‚</p>
<p>æ¥ç€ï¼ŒFeignInvocationHandlerä¼šæ ¹æ®è¿™ä¸ªRequestTemplateç”ŸæˆçœŸæ­£çš„ HTTP è¯·æ±‚ï¼Œå¹¶é€šè¿‡ Feign çš„Clientç»„ä»¶ï¼ˆåé¢ä¼šè¯¦ç»†ä»‹ç»ï¼‰å°†è¯·æ±‚å‘é€åˆ°ç›®æ ‡æœåŠ¡ï¼ˆuser-serviceï¼‰ã€‚è¿™ä¸€ç³»åˆ—æ“ä½œéƒ½åœ¨åŠ¨æ€ä»£ç†çš„æœºåˆ¶ä¸‹è‡ªåŠ¨å®Œæˆï¼Œå¯¹å¼€å‘è€…æ¥è¯´æ˜¯é€æ˜çš„ï¼Œå¼€å‘è€…åªéœ€è¦å…³æ³¨æ¥å£çš„å®šä¹‰å’Œä¸šåŠ¡é€»è¾‘ï¼Œæ— éœ€æ“å¿ƒåº•å±‚çš„ HTTP è¯·æ±‚ç»†èŠ‚ï¼Œå¤§å¤§æé«˜äº†å¼€å‘æ•ˆç‡å’Œä»£ç çš„å¯è¯»æ€§ã€‚</p>
<h3 data-id="heading-5"><strong>2.2 äº”å¤§æ ¸å¿ƒç»„ä»¶ï¼šFeign çš„ â€œäº”è„å…­è…‘â€</strong></h3>
<p>Feign ä¹‹æ‰€ä»¥èƒ½å®ç°å¦‚æ­¤å¼ºå¤§è€Œç®€æ´çš„è¿œç¨‹è°ƒç”¨åŠŸèƒ½ï¼Œç¦»ä¸å¼€å®ƒå†…éƒ¨çš„äº”å¤§æ ¸å¿ƒç»„ä»¶ï¼Œå®ƒä»¬å„å¸å…¶èŒï¼Œç´§å¯†åä½œï¼Œå°±åƒäººä½“çš„äº”è„å…­è…‘ä¸€æ ·ï¼Œå…±åŒç»´æŒç€ Feign çš„æ­£å¸¸è¿è½¬ã€‚</p>
<h3 data-id="heading-6"><strong>2.2.1 Encoder &amp;Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D269436125%26content_type%3DArticle%26match_order%3D1%26q%3DDecoder%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=269436125&amp;content_type=Article&amp;match_order=1&amp;q=Decoder&amp;zhida_source=entity" ref="nofollow noopener noreferrer">Decoder</a>ï¼šå‚æ•°ä¸å“åº”çš„ â€œç¿»è¯‘å®˜â€</strong></h3>
<p>åœ¨ Feign çš„è¿œç¨‹è°ƒç”¨è¿‡ç¨‹ä¸­ï¼ŒEncoderå’ŒDecoderå°±åƒæ˜¯ä¸€å¯¹é»˜å¥‘çš„ â€œç¿»è¯‘å®˜â€ï¼Œè´Ÿè´£è§£å†³ Java å¯¹è±¡ä¸ HTTP è¯·æ±‚ / å“åº”ä¹‹é—´çš„æ•°æ®æ ¼å¼è½¬æ¢é—®é¢˜ã€‚</p>
<p>Encoderçš„èŒè´£æ˜¯å°† Java æ–¹æ³•ä¸­çš„å‚æ•°ï¼ˆå¯èƒ½æ˜¯å„ç§å¤æ‚çš„ Java å¯¹è±¡ï¼‰ç¼–ç æˆ HTTP è¯·æ±‚ä½“èƒ½å¤Ÿæ¥å—çš„æ ¼å¼ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒFeign ä½¿ç”¨SpringEncoderï¼Œå¹¶ç»“åˆ Jackson åº“æ¥å®ç° JSON æ ¼å¼çš„åºåˆ—åŒ–ã€‚ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ª Feign æ¥å£æ–¹æ³•ï¼Œä¼ é€’ä¸€ä¸ªåŒ…å«ç”¨æˆ·ä¿¡æ¯çš„Userå¯¹è±¡ä½œä¸ºå‚æ•°æ—¶ï¼ŒEncoderä¼šå°†è¿™ä¸ªUserå¯¹è±¡è½¬æ¢æˆ JSON å­—ç¬¦ä¸²ï¼Œç„¶åæ”¾å…¥ HTTP è¯·æ±‚ä½“ä¸­å‘é€ç»™æœåŠ¡ç«¯ã€‚</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@FeignClient</span>(name = <span class="hljs-string">"user-service"</span>)
public interface UserFeignClient {
    <span class="hljs-variable">@PostMapping</span>(<span class="hljs-string">"/user/save"</span>)
    void <span class="hljs-built_in">saveUser</span>(<span class="hljs-variable">@RequestBody</span> User user);
}
</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“è°ƒç”¨saveUseræ–¹æ³•æ—¶ï¼ŒEncoderä¼šè‡ªåŠ¨å°†Userå¯¹è±¡åºåˆ—åŒ–ä¸º JSON æ ¼å¼ï¼Œå¡«å……åˆ° HTTP è¯·æ±‚çš„bodyéƒ¨åˆ†ã€‚</p>
<p>Decoderåˆ™æ­£å¥½ç›¸åï¼Œå®ƒè´Ÿè´£å°†æœåŠ¡ç«¯è¿”å›çš„ HTTP å“åº”ä½“ååºåˆ—åŒ–ä¸º Java å¯¹è±¡ã€‚åŒæ ·é»˜è®¤ä½¿ç”¨ Jackson åº“ï¼Œå°† JSON æ ¼å¼çš„å“åº”æ•°æ®è½¬æ¢ä¸ºå¯¹åº”çš„ Java å¯¹è±¡ã€‚æ¯”å¦‚ï¼ŒæœåŠ¡ç«¯è¿”å›ä¸€ä¸ªåŒ…å«ç”¨æˆ·åˆ—è¡¨çš„ JSON æ•°æ®ï¼ŒDecoderä¼šå°†å…¶è§£ææˆListå¯¹è±¡ï¼Œæ–¹ä¾¿è°ƒç”¨æ–¹åœ¨ Java ä»£ç ä¸­è¿›è¡Œåç»­å¤„ç†ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@FeignClient(name = <span class="hljs-string">"user-service"</span>)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserFeignClient</span> {
    <span class="hljs-meta">@GetMapping(<span class="hljs-string">"/user/list"</span>)</span>
    List&lt;User&gt; getUserList();
}
</code></pre>
<p>è°ƒç”¨getUserListæ–¹æ³•åï¼ŒDecoderä¼šå°†æœåŠ¡ç«¯è¿”å›çš„ JSON æ•°æ®ååºåˆ—åŒ–ä¸ºListå¯¹è±¡è¿”å›ç»™è°ƒç”¨è€…ã€‚é€šè¿‡Encoderå’ŒDecoderçš„é…åˆï¼ŒFeign å®ç°äº†å‚æ•°å’Œå“åº”åœ¨ Java ä¸–ç•Œä¸ HTTP ä¸–ç•Œä¹‹é—´çš„æ— ç¼è½¬æ¢ï¼Œè®©å¼€å‘è€…æ— éœ€æ‰‹åŠ¨å¤„ç†ç¹ççš„æ•°æ®æ ¼å¼è½¬æ¢å·¥ä½œã€‚</p>
<h3 data-id="heading-7"><strong>2.2.2 Clientï¼šHTTP è¯·æ±‚çš„ â€œæ‰§è¡Œè€…â€</strong></h3>
<p>Clientç»„ä»¶æ˜¯ Feign ä¸­çœŸæ­£è´Ÿè´£å‘é€ HTTP è¯·æ±‚çš„ â€œæ‰§è¡Œè€…â€ï¼Œå®ƒå°±åƒæ˜¯ä¸€ä½å‹‡æ•¢çš„ä¿¡ä½¿ï¼Œå¸¦ç€ Feign æ„å»ºå¥½çš„ HTTP è¯·æ±‚ï¼Œç©¿è¶Šç½‘ç»œï¼Œå°†è¯·æ±‚é€è¾¾ç›®æ ‡æœåŠ¡ï¼Œå¹¶å¸¦å›å“åº”ã€‚</p>
<p>Feign é»˜è®¤ä½¿ç”¨ JDK è‡ªå¸¦çš„HttpURLConnectionä½œä¸ºåº•å±‚çš„ HTTP å®¢æˆ·ç«¯ï¼Œå®ƒæ˜¯ Java æ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†ï¼Œæ— éœ€é¢å¤–å¼•å…¥ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œå…·æœ‰ä¸€å®šçš„é€šç”¨æ€§å’Œç¨³å®šæ€§ï¼Œé€‚åˆä¸€äº›å¯¹ä¾èµ–ç®€æ´æ€§è¦æ±‚è¾ƒé«˜çš„è½»é‡çº§åº”ç”¨åœºæ™¯ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€äº›å°å‹çš„ Spring Boot é¡¹ç›®ä¸­ï¼Œä½¿ç”¨é»˜è®¤çš„HttpURLConnectionä½œä¸ºClientï¼Œå¯ä»¥å¿«é€Ÿæ­å»ºèµ· Feign çš„è¿œç¨‹è°ƒç”¨åŠŸèƒ½ï¼Œä¸”ä¸ä¼šå¢åŠ è¿‡å¤šçš„é¡¹ç›®å¤æ‚æ€§ã€‚</p>
<p>ç„¶è€Œï¼Œåœ¨é«˜å¹¶å‘ã€å¯¹æ€§èƒ½è¦æ±‚è‹›åˆ»çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒHttpURLConnectionçš„ä¸€äº›å±€é™æ€§å°±å¯èƒ½ä¼šæš´éœ²å‡ºæ¥ï¼Œæ¯”å¦‚å®ƒä¸æ”¯æŒè¿æ¥æ± ï¼Œåœ¨å¤§é‡è¯·æ±‚çš„æƒ…å†µä¸‹ï¼Œé¢‘ç¹åˆ›å»ºå’Œé”€æ¯è¿æ¥ä¼šæ¶ˆè€—å¤§é‡çš„ç³»ç»Ÿèµ„æºï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚ä¸ºäº†æ»¡è¶³è¿™äº›é«˜æ€§èƒ½åœºæ™¯çš„éœ€æ±‚ï¼ŒSpring Cloud å¯¹ Feign è¿›è¡Œäº†æ‰©å±•ï¼Œæ”¯æŒé›†æˆApache HttpClientå’ŒOkHttpè¿™ä¸¤æ¬¾ä¼˜ç§€çš„ HTTP å®¢æˆ·ç«¯ã€‚</p>
<p>Apache HttpClientæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ã€æˆç†Ÿç¨³å®šçš„ HTTP å®¢æˆ·ç«¯åº“ï¼Œå®ƒæä¾›äº†ä¸°å¯Œçš„é…ç½®é€‰é¡¹ï¼Œæ¯”å¦‚å¯ä»¥çµæ´»é…ç½®è¿æ¥æ± ã€çº¿ç¨‹æ± ç®¡ç†ï¼Œè¿˜èƒ½ç²¾ç»†æ§åˆ¶è¶…æ—¶ã€é‡è¯•ç­‰ç­–ç•¥ã€‚åœ¨ä¼ä¸šçº§åº”ç”¨ä¸­ï¼Œå°¤å…¶æ˜¯å¯¹è¿æ¥ç®¡ç†å’Œèµ„æºå¤ç”¨æœ‰è¾ƒé«˜è¦æ±‚çš„åœºæ™¯ä¸‹ï¼ŒApache HttpClientèƒ½å¤Ÿå……åˆ†å‘æŒ¥å…¶ä¼˜åŠ¿ï¼Œæé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªå¤§å‹ç”µå•†ç³»ç»Ÿä¸­ï¼Œè®¢å•æœåŠ¡éœ€è¦é¢‘ç¹è°ƒç”¨åº“å­˜æœåŠ¡å’Œæ”¯ä»˜æœåŠ¡ï¼Œä½¿ç”¨Apache HttpClientä½œä¸º Feign çš„Clientï¼Œé€šè¿‡åˆç†é…ç½®è¿æ¥æ± ï¼Œå¯ä»¥å¤§å¤§å‡å°‘è¿æ¥å»ºç«‹çš„å¼€é”€ï¼Œæé«˜è¯·æ±‚å¤„ç†é€Ÿåº¦ã€‚</p>
<p>OkHttpåˆ™ä»¥å…¶è½»é‡çº§ã€é«˜æ€§èƒ½è€Œå¤‡å—é’çï¼Œå®ƒæ”¯æŒ HTTP/2 åè®®ï¼Œèƒ½å¤Ÿæ˜¾è‘—æå‡æ•°æ®ä¼ è¾“æ•ˆç‡ï¼Œå¹¶ä¸”è‡ªå¸¦è¿æ¥æ± å’Œè¯·æ±‚ç¼“å­˜åŠŸèƒ½ï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–äº†æ€§èƒ½ã€‚åœ¨è¿½æ±‚æè‡´æ€§èƒ½çš„ç°ä»£å¾®æœåŠ¡æ¶æ„ä¸­ï¼ŒOkHttpæ˜¯ä¸€ä¸ªéå¸¸ä¸é”™çš„é€‰æ‹©ã€‚æ¯”å¦‚ï¼Œåœ¨ä¸€äº›å¯¹å“åº”é€Ÿåº¦è¦æ±‚æé«˜çš„ç§»åŠ¨åº”ç”¨åç«¯æœåŠ¡ä¸­ï¼Œä½¿ç”¨OkHttpä½œä¸º Feign çš„Clientï¼Œå¯ä»¥æœ‰æ•ˆå‡å°‘ç”¨æˆ·ç­‰å¾…æ—¶é—´ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚</p>
<p>è¦åœ¨ Feign ä¸­åˆ‡æ¢Clientå®ç°éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨é¡¹ç›®çš„pom.xmlæ–‡ä»¶ä¸­æ·»åŠ ç›¸åº”çš„ä¾èµ–å³å¯ã€‚å¦‚æœè¦åˆ‡æ¢åˆ°Apache HttpClientï¼Œæ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>httpclient<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>å¦‚æœè¦åˆ‡æ¢åˆ°OkHttpï¼Œæ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.github.openfeign<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>feign-okhttp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®é¡¹ç›®çš„å®é™…éœ€æ±‚ï¼Œçµæ´»é€‰æ‹©æœ€é€‚åˆçš„ HTTP å®¢æˆ·ç«¯ï¼Œè®© Feign åœ¨ä¸åŒçš„åœºæ™¯ä¸‹éƒ½èƒ½å‘æŒ¥å‡ºæœ€ä½³æ€§èƒ½ã€‚</p>
<h3 data-id="heading-8"><strong>2.2.3 Contractï¼šæ³¨è§£çš„ â€œè§£æå™¨â€</strong></h3>
<p>Contractåœ¨ Feign ä¸­æ‰®æ¼”ç€æ³¨è§£ â€œè§£æå™¨â€ çš„é‡è¦è§’è‰²ï¼Œå®ƒè´Ÿè´£å°† Feign æ¥å£ä¸Šçš„æ³¨è§£ç¿»è¯‘æˆ HTTP è¯·æ±‚æ‰€éœ€çš„å…ƒæ•°æ®ï¼Œå°±åƒæ˜¯ä¸€ä½ä¸“ä¸šçš„ç¿»è¯‘ï¼Œå°†é«˜çº§è¯­è¨€ç¿»è¯‘æˆæœºå™¨èƒ½ç†è§£çš„æŒ‡ä»¤ã€‚</p>
<p>åœ¨åŸç”Ÿçš„ Feign ä¸­ï¼Œå®ƒåªæ”¯æŒè‡ªèº«å®šä¹‰çš„ä¸€å¥—æ³¨è§£ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šé™åˆ¶äº†å…¶é€šç”¨æ€§å’Œå¼€å‘è€…çš„ä½¿ç”¨ä¹ æƒ¯ã€‚è€Œ Spring Cloud å¯¹ Feign çš„Contractè¿›è¡Œäº†å·§å¦™æ‰©å±•ï¼Œä½¿å…¶èƒ½å¤Ÿå…¼å®¹ Spring MVC çš„æ³¨è§£ï¼Œå¦‚@RequestMappingã€@GetMappingã€@PostMappingã€@PathVariableã€@RequestParamç­‰ã€‚è¿™ä¸€æ‰©å±•æ„ä¹‰é‡å¤§ï¼Œå®ƒå¤§å¤§é™ä½äº†å¼€å‘è€…çš„å­¦ä¹ æˆæœ¬ï¼Œå› ä¸ºå¯¹äºç†Ÿæ‚‰ Spring MVC å¼€å‘çš„å¼€å‘è€…æ¥è¯´ï¼Œæ— éœ€é‡æ–°å­¦ä¹ ä¸€å¥—å…¨æ–°çš„æ³¨è§£ä½“ç³»ï¼Œå°±å¯ä»¥ç›´æ¥åœ¨ Feign æ¥å£ä¸­ä½¿ç”¨ä»–ä»¬ç†Ÿæ‚‰çš„ Spring MVC æ³¨è§£ï¼Œå®ç° â€œæ³¨è§£å¤ç”¨â€ã€‚</p>
<p>ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªåŸºäº Spring Cloud çš„å¾®æœåŠ¡é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åƒè¿™æ ·å®šä¹‰ä¸€ä¸ª Feign æ¥å£ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@FeignClient</span>(name = <span class="hljs-string">"product-service"</span>)
public interface ProductFeignClient {
    <span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">"/product/{id}"</span>)
    Product <span class="hljs-built_in">getProductById</span>(<span class="hljs-variable">@PathVariable</span>(<span class="hljs-string">"id"</span>) Long id);

    <span class="hljs-variable">@PostMapping</span>(<span class="hljs-string">"/product"</span>)
    Product <span class="hljs-built_in">saveProduct</span>(<span class="hljs-variable">@RequestBody</span> Product product);
}
</code></pre>
<p>åœ¨è¿™ä¸ªæ¥å£ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†@GetMappingå’Œ@PostMappingç­‰ Spring MVC æ³¨è§£æ¥å®šä¹‰ HTTP è¯·æ±‚çš„æ–¹æ³•å’Œè·¯å¾„ï¼Œ@PathVariableå’Œ@RequestBodyæ³¨è§£æ¥å¤„ç†è¯·æ±‚å‚æ•°ã€‚Contractä¼šè§£æè¿™äº›æ³¨è§£ï¼Œç”Ÿæˆå¯¹åº”çš„ HTTP è¯·æ±‚å…ƒæ•°æ®ï¼ŒåŒ…æ‹¬è¯·æ±‚çš„ URLã€HTTP æ–¹æ³•ã€å‚æ•°ç­‰ä¿¡æ¯ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨ Spring MVC æ³¨è§£çš„å¼ºå¤§åŠŸèƒ½ï¼Œæ›´åŠ çµæ´»ã€æ–¹ä¾¿åœ°å®šä¹‰ Feign çš„è¿œç¨‹è°ƒç”¨æ¥å£ï¼Œæé«˜å¼€å‘æ•ˆç‡å’Œä»£ç çš„å¯è¯»æ€§ã€‚</p>
<h3 data-id="heading-9"><strong>2.2.4 LoadBalancerï¼šè´Ÿè½½å‡è¡¡çš„ â€œè°ƒåº¦å‘˜â€</strong></h3>
<p>åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œä¸€ä¸ªæœåŠ¡é€šå¸¸ä¼šæœ‰å¤šä¸ªå®ä¾‹åŒæ—¶è¿è¡Œï¼Œä»¥æé«˜ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œæ€§èƒ½ã€‚LoadBalancerç»„ä»¶åœ¨ Feign ä¸­å°±æ‰®æ¼”ç€è´Ÿè½½å‡è¡¡ â€œè°ƒåº¦å‘˜â€ çš„è§’è‰²ï¼Œå®ƒç»“åˆÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D269436125%26content_type%3DArticle%26match_order%3D1%26q%3DEureka%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=269436125&amp;content_type=Article&amp;match_order=1&amp;q=Eureka&amp;zhida_source=entity" ref="nofollow noopener noreferrer">Eureka</a>ã€Nacos ç­‰æœåŠ¡æ³¨å†Œä¸­å¿ƒæä¾›çš„æœåŠ¡å®ä¾‹åˆ—è¡¨ï¼Œå®ç°å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼Œç¡®ä¿è¯·æ±‚èƒ½å¤Ÿå‡åŒ€åœ°åˆ†å‘åˆ°å„ä¸ªæœåŠ¡å®ä¾‹ä¸Šã€‚</p>
<p>Feign é»˜è®¤é›†æˆäº†Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D269436125%26content_type%3DArticle%26match_order%3D1%26q%3DRibbon%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=269436125&amp;content_type=Article&amp;match_order=1&amp;q=Ribbon&amp;zhida_source=entity" ref="nofollow noopener noreferrer">Ribbon</a>Â æˆ– Spring Cloud LoadBalancer ä½œä¸ºè´Ÿè½½å‡è¡¡å™¨ã€‚ä»¥ Ribbon ä¸ºä¾‹ï¼Œå½“ Feign å‘èµ·ä¸€ä¸ªè¿œç¨‹è°ƒç”¨æ—¶ï¼ŒRibbon ä¼šä»æœåŠ¡æ³¨å†Œä¸­å¿ƒè·å–ç›®æ ‡æœåŠ¡çš„æ‰€æœ‰å®ä¾‹åˆ—è¡¨ï¼Œç„¶åæ ¹æ®é¢„è®¾çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ˆå¦‚è½®è¯¢ã€éšæœºã€æƒé‡ç­‰ï¼‰ï¼Œä»è¿™äº›å®ä¾‹ä¸­é€‰æ‹©ä¸€ä¸ªæœ€ä¼˜çš„å®ä¾‹æ¥å‘é€ HTTP è¯·æ±‚ã€‚</p>
<p>æ¯”å¦‚ï¼Œåœ¨ä¸€ä¸ªç”µå•†ç³»ç»Ÿä¸­ï¼Œå•†å“æœåŠ¡å¯èƒ½éƒ¨ç½²äº†å¤šä¸ªå®ä¾‹ï¼Œå½“è®¢å•æœåŠ¡éœ€è¦è°ƒç”¨å•†å“æœåŠ¡è·å–å•†å“è¯¦æƒ…æ—¶ï¼ŒFeign ä¼šé€šè¿‡ Ribbon ä»å•†å“æœåŠ¡çš„å®ä¾‹åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªå®ä¾‹å‘é€è¯·æ±‚ã€‚å¦‚æœé‡‡ç”¨è½®è¯¢ç­–ç•¥ï¼ŒRibbon ä¼šæŒ‰ç…§é¡ºåºä¾æ¬¡é€‰æ‹©æ¯ä¸ªå®ä¾‹ï¼Œä¿è¯æ¯ä¸ªå®ä¾‹éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚ï¼›å¦‚æœé‡‡ç”¨éšæœºç­–ç•¥ï¼ŒRibbon ä¼šéšæœºé€‰æ‹©ä¸€ä¸ªå®ä¾‹ï¼Œå¢åŠ äº†è¯·æ±‚åˆ†é…çš„éšæœºæ€§ï¼›å¦‚æœé‡‡ç”¨æƒé‡ç­–ç•¥ï¼ŒRibbon ä¼šæ ¹æ®æ¯ä¸ªå®ä¾‹çš„æ€§èƒ½ã€è´Ÿè½½ç­‰å› ç´ åˆ†é…ä¸åŒçš„æƒé‡ï¼Œæ€§èƒ½å¥½ã€è´Ÿè½½ä½çš„å®ä¾‹ä¼šè¢«æ›´å¤šåœ°é€‰ä¸­ï¼Œä»è€Œå®ç°æ›´åˆç†çš„è´Ÿè½½å‡è¡¡ã€‚</p>
<p>é€šè¿‡è¿™ç§å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡æœºåˆ¶ï¼ŒFeign èƒ½å¤Ÿæœ‰æ•ˆé¿å…æŸä¸ªæœåŠ¡å®ä¾‹å› è´Ÿè½½è¿‡é«˜è€Œå¯¼è‡´æ€§èƒ½ä¸‹é™æˆ–å´©æºƒï¼Œæé«˜äº†æ•´ä¸ªå¾®æœåŠ¡æ¶æ„çš„å¯ç”¨æ€§å’Œç¨³å®šæ€§ã€‚åŒæ—¶ï¼Œç»“åˆæœåŠ¡æ³¨å†Œä¸­å¿ƒçš„åŠ¨æ€å‘ç°åŠŸèƒ½ï¼Œå½“æœ‰æ–°çš„æœåŠ¡å®ä¾‹ä¸Šçº¿æˆ–ä¸‹çº¿æ—¶ï¼ŒRibbon èƒ½å¤ŸåŠæ—¶æ›´æ–°å®ä¾‹åˆ—è¡¨ï¼Œä¿è¯è´Ÿè½½å‡è¡¡çš„å‡†ç¡®æ€§å’Œæœ‰æ•ˆæ€§ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7765e0a77ff84834af2b948dfca44f5a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771228108&amp;x-signature=GBgXZZz0wKzqUSY8NrWaDVTIVCs%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10"><strong>2.3 å®Œæ•´è°ƒç”¨æµç¨‹ï¼šä»æ¥å£è°ƒç”¨åˆ°å“åº”è¿”å›çš„ â€œå…¨é“¾è·¯â€</strong></h3>
<p>äº†è§£äº† Feign çš„æ ¸å¿ƒåŸç†å’Œäº”å¤§æ ¸å¿ƒç»„ä»¶åï¼Œæˆ‘ä»¬æ¥æ¢³ç†ä¸€ä¸‹ Feign è°ƒç”¨çš„å®Œæ•´æµç¨‹ï¼Œçœ‹çœ‹è¿™äº›ç»„ä»¶æ˜¯å¦‚ä½•ååŒå·¥ä½œï¼Œå®ç°ä»æ¥å£è°ƒç”¨åˆ°å“åº”è¿”å›çš„ç¥å¥‡ä¹‹æ—…çš„ã€‚</p>
<p><strong>1. æ¥å£æ–¹æ³•è°ƒç”¨</strong>ï¼šåœ¨è°ƒç”¨æ–¹çš„ä»£ç ä¸­ï¼Œé€šè¿‡@Autowiredæ³¨å…¥ Feign æ¥å£ï¼Œå¹¶è°ƒç”¨å…¶æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> UserFeignClient userFeignClient;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getUserInfo</span><span class="hljs-params">()</span> {
    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userFeignClient.getUserById(<span class="hljs-number">1L</span>);
    <span class="hljs-comment">// å¤„ç†ç”¨æˆ·ä¿¡æ¯</span>
}
</code></pre>
<p><strong>2. ä»£ç†ç±»æ‹¦æˆªè¯·æ±‚</strong>ï¼šç”±äºæ³¨å…¥çš„ Feign æ¥å£æ˜¯ä¸€ä¸ªåŠ¨æ€ä»£ç†å¯¹è±¡ï¼Œè°ƒç”¨æ–¹æ³•æ—¶ï¼Œä»£ç†ç±»ï¼ˆç”±FeignInvocationHandleré©±åŠ¨ï¼‰ä¼šæ‹¦æˆªè¿™ä¸ªè¯·æ±‚ã€‚</p>
<p><strong>3. Contract è§£ææ³¨è§£ç”Ÿæˆè¯·æ±‚æ¨¡æ¿</strong>ï¼šContractç»„ä»¶å¼€å§‹å·¥ä½œï¼Œå®ƒè§£æ Feign æ¥å£æ–¹æ³•ä¸Šçš„æ³¨è§£ï¼ˆå¦‚@FeignClientã€@GetMappingã€@PathVariableç­‰ï¼‰ï¼Œæå–æœåŠ¡åã€è¯·æ±‚ URLã€HTTP æ–¹æ³•ç­‰å…ƒæ•°æ®ï¼Œç”Ÿæˆä¸€ä¸ªRequestTemplateï¼Œè¿™ä¸ªæ¨¡æ¿åŒ…å«äº† HTTP è¯·æ±‚çš„åŸºæœ¬æ¡†æ¶ã€‚</p>
<p><strong>4. Encoder åºåˆ—åŒ–å‚æ•°</strong>ï¼šå¦‚æœæ¥å£æ–¹æ³•æœ‰å‚æ•°ï¼ŒEncoderä¼šå°†è¿™äº›å‚æ•°åºåˆ—åŒ–ä¸º HTTP è¯·æ±‚ä½“èƒ½å¤Ÿæ¥å—çš„æ ¼å¼ï¼Œé€šå¸¸æ˜¯ JSON æ ¼å¼ã€‚ä¾‹å¦‚ï¼Œå°†ä¸€ä¸ªUserå¯¹è±¡åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²ï¼Œå¡«å……åˆ°RequestTemplateçš„è¯·æ±‚ä½“ä¸­ã€‚</p>
<p><strong>5. LoadBalancer é€‰æ‹©æœåŠ¡å®ä¾‹</strong>ï¼šLoadBalanceræ ¹æ®æœåŠ¡æ³¨å†Œä¸­å¿ƒæä¾›çš„æœåŠ¡å®ä¾‹åˆ—è¡¨ï¼Œç»“åˆè´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œä»å¤šä¸ªæœåŠ¡å®ä¾‹ä¸­é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„å®ä¾‹ã€‚æ¯”å¦‚ï¼Œä½¿ç”¨ Ribbon çš„è½®è¯¢ç­–ç•¥é€‰æ‹©ä¸€ä¸ªuser-serviceçš„å®ä¾‹ã€‚</p>
<p><strong>6. Client å‘é€ HTTP è¯·æ±‚</strong>ï¼šClientç»„ä»¶ï¼ˆå¦‚é»˜è®¤çš„HttpURLConnectionæˆ–é…ç½®çš„OkHttpã€Apache HttpClientï¼‰æ ¹æ®RequestTemplateç”Ÿæˆçš„è¯·æ±‚ä¿¡æ¯ï¼Œå‘é€‰æ‹©çš„æœåŠ¡å®ä¾‹å‘é€ HTTP è¯·æ±‚ã€‚</p>
<p><strong>7. æœåŠ¡ç«¯å¤„ç†å¹¶è¿”å›å“åº”</strong>ï¼šç›®æ ‡æœåŠ¡å®ä¾‹æ¥æ”¶åˆ°è¯·æ±‚åï¼Œè¿›è¡Œä¸šåŠ¡å¤„ç†ï¼Œç„¶åè¿”å› HTTP å“åº”ã€‚</p>
<p><strong>8. Decoder ååºåˆ—åŒ–å“åº”</strong>ï¼šDecoderå°†æœåŠ¡ç«¯è¿”å›çš„ HTTP å“åº”ä½“ååºåˆ—åŒ–ä¸º Java å¯¹è±¡ï¼Œæ¯”å¦‚å°† JSON æ ¼å¼çš„å“åº”æ•°æ®è½¬æ¢ä¸ºUserå¯¹è±¡ã€‚</p>
<p><strong>9. ç»“æœè¿”å›ç»™è°ƒç”¨æ–¹</strong>ï¼šæœ€åï¼Œååºåˆ—åŒ–åçš„ç»“æœé€šè¿‡ä»£ç†ç±»è¿”å›ç»™è°ƒç”¨æ–¹çš„ä»£ç ï¼Œè°ƒç”¨æ–¹å°±å¯ä»¥è·å–åˆ°è¿œç¨‹æœåŠ¡è°ƒç”¨çš„ç»“æœï¼Œå¹¶è¿›è¡Œåç»­å¤„ç†ã€‚</p>
<p>é€šè¿‡è¿™ä¸€å®Œæ•´çš„è°ƒç”¨æµç¨‹ï¼ŒFeign å®ç°äº†å°†æœ¬åœ°æ¥å£æ–¹æ³•è°ƒç”¨è½¬åŒ–ä¸ºè¿œç¨‹ HTTP è¯·æ±‚çš„è¿‡ç¨‹ï¼Œå„ä¸ªç»„ä»¶ä¹‹é—´ç´§å¯†é…åˆï¼ŒååŒå·¥ä½œï¼Œä¸ºå¼€å‘è€…æä¾›äº†ä¸€ç§ç®€æ´ã€é«˜æ•ˆçš„å¾®æœåŠ¡è¿œç¨‹è°ƒç”¨è§£å†³æ–¹æ¡ˆã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de03c76abd2b4ff0bc4a6148969d9f42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771228108&amp;x-signature=nXOq53G1nVczx1l%2Fni4yQKAJThg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-11"><strong>ä¸‰ã€å®æˆ˜æ•™ç¨‹ï¼šä»é›¶æ­å»º Feign è¿œç¨‹è°ƒç”¨ï¼ˆé™„ä»£ç ç¤ºä¾‹ï¼‰</strong></h2>
<h3 data-id="heading-12"><strong>3.1 ç¯å¢ƒå‡†å¤‡ï¼šæœåŠ¡æ³¨å†Œä¸­å¿ƒ + æœåŠ¡æä¾›è€… + æ¶ˆè´¹è€…</strong></h3>
<p>åœ¨å¼€å§‹ä½¿ç”¨ Feign è¿›è¡Œè¿œç¨‹è°ƒç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ­å»ºä¸€ä¸ªåŸºç¡€çš„å¾®æœåŠ¡ç¯å¢ƒï¼Œè¿™ä¸ªç¯å¢ƒå°±åƒæ˜¯ä¸€ä¸ªæ­å»ºå¥½çš„èˆå°ï¼Œä¸º Feign çš„ç²¾å½©è¡¨æ¼”åšå¥½å‡†å¤‡ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ Eurekaï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨ Nacos ç­‰å…¶ä»–æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼‰ä½œä¸ºæœåŠ¡æ³¨å†Œä¸å‘ç°çš„ç»„ä»¶ï¼Œåˆ›å»ºä¸€ä¸ªæœåŠ¡æä¾›è€…å’Œä¸€ä¸ªæœåŠ¡æ¶ˆè´¹è€…ï¼Œé€šè¿‡ Feign å®ç°æ¶ˆè´¹è€…å¯¹æä¾›è€…çš„è¿œç¨‹è°ƒç”¨ã€‚</p>
<p>é¦–å…ˆï¼Œå¯åŠ¨ Eureka æœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚åœ¨pom.xmlæ–‡ä»¶ä¸­æ·»åŠ  Eureka Server çš„ä¾èµ–ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>ç„¶ååœ¨ Spring Boot ä¸»ç±»ä¸Šæ·»åŠ @EnableEurekaServeræ³¨è§£ï¼Œå¼€å¯ Eureka Server åŠŸèƒ½ã€‚é…ç½®application.ymlæ–‡ä»¶ï¼Œè®¾ç½®æœåŠ¡ç«¯å£ã€æœåŠ¡åä»¥åŠæ³¨å†Œä¸­å¿ƒåœ°å€ç­‰ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8761</span>

<span class="hljs-attr">eureka:</span>
  <span class="hljs-attr">instance:</span>
    <span class="hljs-attr">hostname:</span> <span class="hljs-string">localhost</span>
  <span class="hljs-attr">client:</span>
    <span class="hljs-attr">register-with-eureka:</span> <span class="hljs-literal">false</span>
    <span class="hljs-attr">fetch-registry:</span> <span class="hljs-literal">false</span>
    <span class="hljs-attr">service-url:</span>
      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://${eureka.instance.hostname}:${server.port}/eureka/</span>
</code></pre>
<p>å¯åŠ¨ Eureka Server åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®<a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttp%253A%2F%2Flocalhost%253A8761%2F" target="_blank" title="https://link.zhihu.com/?target=http%3A//localhost%3A8761/" ref="nofollow noopener noreferrer">http://localhost:8761/</a>ï¼Œçœ‹åˆ° Eureka çš„ç®¡ç†ç•Œé¢ï¼Œè¿™è¡¨æ˜æœåŠ¡æ³¨å†Œä¸­å¿ƒå·²ç»å‡†å¤‡å°±ç»ªã€‚</p>
<p>æ¥ç€ï¼Œåˆ›å»ºæœåŠ¡æä¾›è€… ServiceAã€‚åœ¨pom.xmlæ–‡ä»¶ä¸­æ·»åŠ  Eureka Client å’Œ Spring Web çš„ä¾èµ–ï¼Œç”¨äºæ³¨å†ŒæœåŠ¡åˆ° Eureka å’Œæä¾› HTTP æ¥å£ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>åœ¨ Spring Boot ä¸»ç±»ä¸Šæ·»åŠ @EnableEurekaClientæ³¨è§£ï¼Œè¡¨æ˜è¿™æ˜¯ä¸€ä¸ª Eureka å®¢æˆ·ç«¯ï¼Œä¼šå°†è‡ªèº«æ³¨å†Œåˆ° Eureka Server ä¸Šã€‚åˆ›å»ºä¸€ä¸ª Controllerï¼Œæä¾›ä¸€ä¸ªç®€å•çš„æ¥å£ï¼Œæ¯”å¦‚è·å–ç”¨æˆ·ä¿¡æ¯çš„æ¥å£/user/{id}ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.PathVariable;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RestController;

<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {

    <span class="hljs-meta">@GetMapping(<span class="hljs-string">"/user/{id}"</span>)</span>
    <span class="hljs-keyword">public</span> User getUserById(<span class="hljs-meta">@PathVariable</span> <span class="hljs-built_in">Long</span> id) {
        <span class="hljs-comment">// è¿™é‡Œå¯ä»¥ä»æ•°æ®åº“æˆ–å…¶ä»–æ•°æ®æºè·å–ç”¨æˆ·ä¿¡æ¯</span>
        User user = new User();
        user.setId(id);
        user.setName(<span class="hljs-string">"å¼ ä¸‰"</span>);
        user.setAge(<span class="hljs-number">20</span>);
        <span class="hljs-keyword">return</span> user;
    }
}
</code></pre>
<p>å…¶ä¸­Userç±»æ˜¯ä¸€ä¸ªç®€å•çš„ Java Beanï¼ŒåŒ…å«idã€nameã€ageç­‰å±æ€§åŠå¯¹åº”çš„ Getter å’Œ Setter æ–¹æ³•ã€‚</p>
<p>æœ€åï¼Œåˆ›å»ºæœåŠ¡æ¶ˆè´¹è€… ServiceBã€‚åœ¨pom.xmlæ–‡ä»¶ä¸­é™¤äº†æ·»åŠ  Eureka Client å’Œ Spring Web çš„ä¾èµ–å¤–ï¼Œè¿˜éœ€è¦æ·»åŠ  Feign çš„ä¾èµ–ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>è‡³æ­¤ï¼ŒåŸºç¡€çš„å¾®æœåŠ¡ç¯å¢ƒæ­å»ºå®Œæˆï¼ŒæœåŠ¡æ³¨å†Œä¸­å¿ƒ Eureka å·²ç»å¯åŠ¨ï¼ŒæœåŠ¡æä¾›è€… ServiceA å‡†å¤‡å¥½æä¾›æ¥å£ï¼ŒæœåŠ¡æ¶ˆè´¹è€… ServiceB å¼•å…¥äº† Feign ä¾èµ–ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥ä½¿ç”¨ Feign å®ç°è¿œç¨‹è°ƒç”¨äº†ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76477d6cefc248279cee449a7e4a7019~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771228108&amp;x-signature=Q%2BoqLZvu4MGhIBnLnxdoXAaaxO0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-13"><strong>3.2 ä¸‰æ­¥å®ç° Feign è°ƒç”¨ï¼šæ³¨è§£ + æ¥å£ + ä¸šåŠ¡è°ƒç”¨</strong></h3>
<p>åœ¨å®Œæˆç¯å¢ƒå‡†å¤‡åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹ä½¿ç”¨ Feign å®ç°è¿œç¨‹è°ƒç”¨äº†ã€‚æ•´ä¸ªè¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä¸‰æ­¥ï¼Œé€šè¿‡æ·»åŠ  Feign ä¾èµ–å¹¶å¯ç”¨æ³¨è§£ã€ç¼–å†™ Feign å®¢æˆ·ç«¯æ¥å£ä»¥åŠåœ¨ä¸šåŠ¡å±‚æ³¨å…¥å¹¶è°ƒç”¨è¿™ä¸‰ä¸ªå…³é”®æ­¥éª¤ï¼Œå°±èƒ½è½»æ¾å®ç° â€œæœ¬åœ°æ–¹æ³•å¼â€ çš„è¿œç¨‹è°ƒç”¨ã€‚</p>
<h3 data-id="heading-14"><strong>3.2.1 æ­¥éª¤ 1ï¼šæ·»åŠ  Feign ä¾èµ–å¹¶å¯ç”¨æ³¨è§£</strong></h3>
<p>åœ¨ ServiceB çš„pom.xmlæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å·²ç»æ·»åŠ äº†spring-cloud-starter-openfeignä¾èµ–ï¼Œè¿™æ˜¯ä½¿ç”¨ Feign çš„åŸºç¡€ã€‚è¿™ä¸ªä¾èµ–å°±åƒæ˜¯ç»™ ServiceB è£…ä¸Šäº†ä¸€æŠŠ â€œç¥å¥‡é’¥åŒ™â€ï¼Œè®©å®ƒå…·å¤‡äº†ä½¿ç”¨ Feign çš„èƒ½åŠ›ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œåœ¨ ServiceB çš„ Spring Boot ä¸»ç±»ä¸Šæ·»åŠ @EnableFeignClientsæ³¨è§£ï¼Œè¿™ä¸ªæ³¨è§£çš„ä½œç”¨è‡³å…³é‡è¦ï¼Œå®ƒå°±åƒæ˜¯ä¸€ä¸ª â€œå¼€å…³â€ï¼Œå¼€å¯äº† Spring å¯¹ Feign å®¢æˆ·ç«¯çš„æ‰«æåŠŸèƒ½ã€‚å½“ Spring å®¹å™¨å¯åŠ¨æ—¶ï¼Œä¼šæ‰«ææ‰€æœ‰æ ‡æ³¨äº†@FeignClientæ³¨è§£çš„æ¥å£ï¼ˆè¿™æ˜¯ä¸‹ä¸€æ­¥è¦åšçš„ï¼‰ï¼Œå¹¶ä¸ºè¿™äº›æ¥å£ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œè¿™äº›ä»£ç†å¯¹è±¡å°†è´Ÿè´£å®é™…çš„è¿œç¨‹è°ƒç”¨æ“ä½œã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">SpringApplication</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">autoconfigure</span>.<span class="hljs-property">SpringBootApplication</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">cloud</span>.<span class="hljs-property">openfeign</span>.<span class="hljs-property">EnableFeignClients</span>;

<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@EnableFeignClients</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceBApplication</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        <span class="hljs-title class_">SpringApplication</span>.<span class="hljs-title function_">run</span>(<span class="hljs-title class_">ServiceBApplication</span>.<span class="hljs-property">class</span>, args);
    }
}
</code></pre>
<p>é€šè¿‡è¿™ä¸€æ­¥ï¼ŒServiceB å·²ç»åšå¥½äº†ä½¿ç”¨ Feign çš„å‰æœŸå‡†å¤‡ï¼Œä¸ºåç»­çš„è¿œç¨‹è°ƒç”¨æ¥å£å®šä¹‰å’Œå®ç°å¥ å®šäº†åŸºç¡€ã€‚</p>
<h3 data-id="heading-15"><strong>3.2.2 æ­¥éª¤ 2ï¼šç¼–å†™ Feign å®¢æˆ·ç«¯æ¥å£</strong></h3>
<p>åœ¨ ServiceB ä¸­åˆ›å»ºä¸€ä¸ª Feign å®¢æˆ·ç«¯æ¥å£ï¼Œè¿™ä¸ªæ¥å£å°†å®šä¹‰æˆ‘ä»¬å¦‚ä½•ä¸ ServiceA è¿›è¡Œäº¤äº’ã€‚ä»¥è°ƒç”¨ ServiceA çš„/user/{id}æ¥å£è·å–ç”¨æˆ·ä¿¡æ¯ä¸ºä¾‹ï¼Œåˆ›å»ºUserFeignClientæ¥å£ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> org.springframework.cloud.openfeign.FeignClient;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.PathVariable;

<span class="hljs-meta">@FeignClient(name = <span class="hljs-string">"serviceA"</span>)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserFeignClient</span> {
    <span class="hljs-meta">@GetMapping(<span class="hljs-string">"/user/{id}"</span>)</span>
    User getUserById(<span class="hljs-meta">@PathVariable</span> <span class="hljs-built_in">Long</span> id);
}
</code></pre>
<p>åœ¨è¿™ä¸ªæ¥å£ä¸­ï¼Œ@FeignClient(name = "serviceA")æ³¨è§£æŒ‡å®šäº†è¦è°ƒç”¨çš„æœåŠ¡åæ˜¯serviceAï¼Œè¿™ä¸ªæœåŠ¡åå¿…é¡»ä¸ ServiceA åœ¨ Eureka ä¸­æ³¨å†Œçš„æœåŠ¡åä¸€è‡´ï¼Œè¿™æ · Feign æ‰èƒ½å‡†ç¡®åœ°æ‰¾åˆ°ç›®æ ‡æœåŠ¡ã€‚getUserByIdæ–¹æ³•ä¸Šçš„@GetMapping("/user/{id}")æ³¨è§£ä¸ ServiceA ä¸­UserControllerçš„getUserByIdæ–¹æ³•çš„æ³¨è§£ä¿æŒä¸€è‡´ï¼Œå®šä¹‰äº†è¯·æ±‚çš„è·¯å¾„å’Œæ–¹æ³•ã€‚@PathVariable Long idè¡¨ç¤ºæ–¹æ³•çš„å‚æ•°ï¼Œä¼šä½œä¸ºè·¯å¾„å˜é‡ä¼ é€’åˆ°è¯·æ±‚ä¸­ã€‚</p>
<p>é€šè¿‡è¿™ä¸ªæ¥å£çš„å®šä¹‰ï¼Œæˆ‘ä»¬æ¸…æ™°åœ°æè¿°äº†å¯¹ ServiceA çš„è¿œç¨‹è°ƒç”¨éœ€æ±‚ï¼Œå°±åƒæ˜¯åˆ¶å®šäº†ä¸€ä»½è¯¦ç»†çš„ â€œä½œæˆ˜è®¡åˆ’â€ï¼Œå‘Šè¯‰ Feign è¦è°ƒç”¨å“ªä¸ªæœåŠ¡çš„å“ªä¸ªæ¥å£ï¼Œä»¥åŠä¼ é€’ä»€ä¹ˆå‚æ•°ã€‚</p>
<h3 data-id="heading-16"><strong>3.2.3 æ­¥éª¤ 3ï¼šä¸šåŠ¡å±‚æ³¨å…¥å¹¶è°ƒç”¨</strong></h3>
<p>åœ¨ ServiceB çš„ä¸šåŠ¡å±‚ï¼ˆä¾‹å¦‚OrderServiceç±»ï¼‰ä¸­ï¼Œé€šè¿‡@Autowiredæ³¨è§£æ³¨å…¥UserFeignClientæ¥å£ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">import org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.beans</span><span class="hljs-selector-class">.factory</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Autowired</span>;
import org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.stereotype</span><span class="hljs-selector-class">.Service</span>;

<span class="hljs-keyword">@Service</span>
public class OrderService {

    <span class="hljs-keyword">@Autowired</span>
    private UserFeignClient userFeignClient;

    public <span class="hljs-attribute">Order</span> <span class="hljs-built_in">createOrder</span>(Long userId) {
        <span class="hljs-comment">// é€šè¿‡Feignè°ƒç”¨ServiceAè·å–ç”¨æˆ·ä¿¡æ¯</span>
        User user = userFeignClient<span class="hljs-selector-class">.getUserById</span>(userId);
        
        <span class="hljs-comment">// æ¨¡æ‹Ÿåˆ›å»ºè®¢å•é€»è¾‘</span>
        <span class="hljs-attribute">Order</span> <span class="hljs-attribute">order</span> = new <span class="hljs-attribute">Order</span>();
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setUserId</span>(userId);
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setUserName</span>(user.getName());
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setOrderStatus</span>("å·²åˆ›å»º");
        
        return <span class="hljs-attribute">order</span>;
    }
}
</code></pre>
<p>åœ¨createOrderæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥è°ƒç”¨userFeignClient.getUserById(userId)æ–¹æ³•ï¼Œå°±åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ç®€å•ã€‚Feign ä¼šåœ¨èƒŒåè‡ªåŠ¨æ ¹æ®æˆ‘ä»¬å®šä¹‰çš„æ¥å£å’Œæ³¨è§£ï¼Œç”Ÿæˆ HTTP è¯·æ±‚å¹¶å‘é€åˆ° ServiceAï¼Œè·å–ç”¨æˆ·ä¿¡æ¯åè¿”å›ç»™userå˜é‡ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªç”¨æˆ·ä¿¡æ¯è¿›è¡Œåç»­çš„ä¸šåŠ¡æ“ä½œï¼Œæ¯”å¦‚åˆ›å»ºè®¢å•ï¼Œå¹¶å°†ç”¨æˆ·ç›¸å…³ä¿¡æ¯å¡«å……åˆ°è®¢å•å¯¹è±¡ä¸­ã€‚</p>
<p>æœ€åï¼Œåœ¨ Controller å±‚ä¸­æš´éœ²æ¥å£ï¼Œè®©å¤–éƒ¨å¯ä»¥è®¿é—®è¿™ä¸ªä¸šåŠ¡æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> org.springframework.beans.factory.<span class="hljs-keyword">annotation</span>.Autowired;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.PathVariable;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RestController;

<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderService orderService;

    <span class="hljs-meta">@GetMapping(<span class="hljs-string">"/order/{userId}"</span>)</span>
    <span class="hljs-keyword">public</span> Order createOrder(<span class="hljs-meta">@PathVariable</span> <span class="hljs-built_in">Long</span> userId) {
        <span class="hljs-keyword">return</span> orderService.createOrder(userId);
    }
}
</code></pre>
<p>é€šè¿‡è¿™ä¸‰æ­¥ï¼Œæˆ‘ä»¬æˆåŠŸåœ°åœ¨ ServiceB ä¸­ä½¿ç”¨ Feign å®ç°äº†å¯¹ ServiceA çš„è¿œç¨‹è°ƒç”¨ï¼Œä»æ¥å£å®šä¹‰åˆ°ä¸šåŠ¡å±‚è°ƒç”¨ï¼Œæ•´ä¸ªè¿‡ç¨‹ç®€æ´æ˜äº†ï¼Œå……åˆ†ä½“ç°äº† Feign çš„å¼ºå¤§å’Œä¾¿æ·ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa4d9c0d5a8d4369b51f182f972c4ef5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771228108&amp;x-signature=IThMP%2B3mltTZi8mnKedxZNZWRZU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-17"><strong>3.3 æµ‹è¯•éªŒè¯ï¼šå¯åŠ¨æœåŠ¡å¹¶éªŒè¯è°ƒç”¨æ•ˆæœ</strong></h3>
<p>åœ¨å®Œæˆä¸Šè¿°ä»£ç ç¼–å†™åï¼Œæˆ‘ä»¬éœ€è¦å¯åŠ¨å„ä¸ªæœåŠ¡å¹¶è¿›è¡Œæµ‹è¯•ï¼Œä»¥éªŒè¯ Feign è°ƒç”¨æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚</p>
<p>é¦–å…ˆï¼ŒæŒ‰ç…§ â€œæ³¨å†Œä¸­å¿ƒâ†’ServiceAâ†’ServiceBâ€ çš„é¡ºåºå¯åŠ¨æœåŠ¡ã€‚å…ˆå¯åŠ¨ Eureka Serverï¼Œç¡®ä¿æœåŠ¡æ³¨å†Œä¸­å¿ƒæ­£å¸¸è¿è¡Œï¼›ç„¶åå¯åŠ¨ ServiceAï¼Œå°†å…¶æ³¨å†Œåˆ° Eureka Server ä¸Šï¼›æœ€åå¯åŠ¨ ServiceBï¼ŒServiceB ä¼šä» Eureka Server è·å– ServiceA çš„åœ°å€ä¿¡æ¯ï¼Œå¹¶å‡†å¤‡å¥½é€šè¿‡ Feign è¿›è¡Œè¿œç¨‹è°ƒç”¨ã€‚</p>
<p>å¯åŠ¨å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æµè§ˆå™¨æˆ– Postman ç­‰å·¥å…·è®¿é—® ServiceB çš„è®¢å•æ¥å£ï¼Œä¾‹å¦‚è®¿é—®<a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttp%253A%2F%2Flocalhost%2F" target="_blank" title="https://link.zhihu.com/?target=http%3A//localhost/" ref="nofollow noopener noreferrer">http://localhost:</a>æœåŠ¡Bç«¯å£/order/1ï¼ˆå‡è®¾ ServiceB çš„ç«¯å£ä¸º 8082ï¼Œ1æ˜¯ç”¨æˆ· IDï¼‰ã€‚å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œæˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿçœ‹åˆ°è¿”å›çš„è®¢å•ä¿¡æ¯ï¼Œå…¶ä¸­åŒ…å«ä» ServiceA è·å–çš„ç”¨æˆ·ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"userId"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"userName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å¼ ä¸‰"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"orderStatus"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å·²åˆ›å»º"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>è¿™è¡¨æ˜ ServiceB æˆåŠŸåœ°é€šè¿‡ Feign è°ƒç”¨äº† ServiceA çš„/user/{id}æ¥å£ï¼Œå¹¶è·å–åˆ°äº†ç”¨æˆ·ä¿¡æ¯ï¼Œç„¶åå°†å…¶ç”¨äºåˆ›å»ºè®¢å•å¹¶è¿”å›ç»“æœã€‚</p>
<p>ä¸ºäº†è¿›ä¸€æ­¥éªŒè¯ Feign çš„è´Ÿè½½å‡è¡¡æ•ˆæœï¼Œæˆ‘ä»¬å¯ä»¥å¤šå¯åŠ¨ä¸€ä¸ª ServiceA å®ä¾‹ï¼Œæ¯”å¦‚å°† ServiceA çš„ç«¯å£æ”¹ä¸º 8083ï¼Œé‡æ–°æ‰“åŒ…å¹¶å¯åŠ¨ã€‚æ­¤æ—¶ï¼ŒEureka Server ä¸­ä¼šæ³¨å†Œä¸¤ä¸ª ServiceA çš„å®ä¾‹ã€‚å†æ¬¡è®¿é—® ServiceB çš„è®¢å•æ¥å£ï¼Œå¤šæ¬¡åˆ·æ–°åä¼šå‘ç°ï¼Œè¯·æ±‚ä¼šè½®æµå‘é€åˆ°ä¸¤ä¸ª ServiceA å®ä¾‹ä¸Šï¼Œè¿™å°±æ˜¯ Feign ç»“åˆ Ribbon å®ç°çš„å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œå®ƒç¡®ä¿äº†è¯·æ±‚èƒ½å¤Ÿå‡åŒ€åœ°åˆ†é…åˆ°å„ä¸ªæœåŠ¡å®ä¾‹ä¸Šï¼Œæé«˜äº†ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œæ€§èƒ½ã€‚é€šè¿‡è¿™æ ·çš„æµ‹è¯•éªŒè¯ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®è®¤ Feign åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­å·²ç»æˆåŠŸåœ°å®ç°äº†è¿œç¨‹è°ƒç”¨å’Œè´Ÿè½½å‡è¡¡åŠŸèƒ½ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f3fd8da78a34fc491c39fd5212c4c94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771228108&amp;x-signature=VF51sXHiOv4CchrjQyLm7d8Pj0s%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-18"><strong>å››ã€é«˜çº§ç‰¹æ€§ï¼šè§£é” Feign çš„ â€œéšè—ç©æ³•â€</strong></h2>
<h3 data-id="heading-19"><strong>4.1 è‡ªå®šä¹‰é…ç½®ï¼šè¶…æ—¶ã€æ—¥å¿—å…¨æŒæ§</strong></h3>
<p>åœ¨å®é™…çš„ Spring é¡¹ç›®å¼€å‘ä¸­ï¼ŒFeign çš„é»˜è®¤é…ç½®å¾€å¾€æ— æ³•æ»¡è¶³å¤æ‚å¤šå˜çš„ä¸šåŠ¡éœ€æ±‚ã€‚è¿™æ—¶å€™ï¼ŒFeign å¼ºå¤§çš„è‡ªå®šä¹‰é…ç½®åŠŸèƒ½å°±æ´¾ä¸Šç”¨åœºäº†ï¼Œå®ƒå…è®¸æˆ‘ä»¬æ ¹æ®å…·ä½“åœºæ™¯ï¼Œçµæ´»è°ƒæ•´è¶…æ—¶æ—¶é—´å’Œæ—¥å¿—çº§åˆ«ï¼Œè®© Feign çš„è¿è¡Œæ›´åŠ è´´åˆé¡¹ç›®å®é™…æƒ…å†µã€‚</p>
<h3 data-id="heading-20"><strong>4.1.1 è¶…æ—¶é…ç½®ï¼šè§£å†³é»˜è®¤è¶…æ—¶è¿‡çŸ­çš„é—®é¢˜</strong></h3>
<p>Feign é»˜è®¤çš„è¿æ¥è¶…æ—¶æ—¶é—´ä¸º 1 ç§’ï¼Œè¯»å–è¶…æ—¶æ—¶é—´ä¸º 10 ç§’ã€‚åœ¨ç½‘ç»œç¯å¢ƒè‰¯å¥½ã€æœåŠ¡å“åº”è¿…é€Ÿçš„ç†æƒ³æƒ…å†µä¸‹ï¼Œè¿™äº›é»˜è®¤å€¼æˆ–è®¸èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚ä½†åœ¨ç°å®çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå°¤å…¶æ˜¯æ¶‰åŠåˆ°é«˜å»¶è¿Ÿç½‘ç»œã€å¤æ‚ä¸šåŠ¡é€»è¾‘å¯¼è‡´çš„æœåŠ¡å“åº”ç¼“æ…¢ç­‰åœºæ™¯æ—¶ï¼Œè¿™äº›é»˜è®¤çš„è¶…æ—¶æ—¶é—´å°±æ˜¾å¾—æ‰è¥Ÿè§è‚˜äº†ã€‚</p>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ çš„åº”ç”¨ç¨‹åºéœ€è¦è°ƒç”¨ä¸€ä¸ªä½äºè¿œç¨‹æ•°æ®ä¸­å¿ƒçš„å¾®æœåŠ¡ï¼Œç”±äºç½‘ç»œè·ç¦»è¾ƒè¿œï¼Œå­˜åœ¨ä¸€å®šçš„å»¶è¿Ÿã€‚æˆ–è€…ï¼Œè¢«è°ƒç”¨çš„å¾®æœåŠ¡éœ€è¦å¤„ç†å¤§é‡çš„æ•°æ®è®¡ç®—ï¼Œå“åº”æ—¶é—´è¾ƒé•¿ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼ŒFeign çš„é»˜è®¤è¶…æ—¶æ—¶é—´å¾ˆå¯èƒ½å¯¼è‡´è°ƒç”¨åœ¨æœåŠ¡è¿˜æœªå“åº”ä¹‹å‰å°±è§¦å‘è¶…æ—¶å¼‚å¸¸ï¼Œä½¿å¾—ä¸šåŠ¡æ— æ³•æ­£å¸¸è¿›è¡Œã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æ¥è°ƒæ•´ Feign çš„è¶…æ—¶æ—¶é—´ã€‚åœ¨application.ymlæ–‡ä»¶ä¸­ï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">feign:</span>
  <span class="hljs-attr">client:</span>
    <span class="hljs-attr">config:</span>
      <span class="hljs-attr">default:</span>
        <span class="hljs-attr">connectTimeout:</span> <span class="hljs-number">5000</span> <span class="hljs-comment"># è¿æ¥è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º5000æ¯«ç§’</span>
        <span class="hljs-attr">readTimeout:</span> <span class="hljs-number">5000</span>    <span class="hljs-comment"># è¯»å–è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º5000æ¯«ç§’</span>
</code></pre>
<p>åœ¨ä¸Šè¿°é…ç½®ä¸­ï¼Œfeign.client.config.defaultè¡¨ç¤ºè¿™æ˜¯é’ˆå¯¹æ‰€æœ‰ Feign å®¢æˆ·ç«¯çš„å…¨å±€é»˜è®¤é…ç½®ã€‚connectTimeoutè®¾ç½®äº†å»ºç«‹ TCP è¿æ¥çš„æœ€å¤§ç­‰å¾…æ—¶é—´ä¸º 5000 æ¯«ç§’ï¼ŒreadTimeoutè®¾ç½®äº†ä»è¿æ¥ä¸­è¯»å–æ•°æ®çš„æœ€é•¿ç­‰å¾…æ—¶é—´ä¸º 5000 æ¯«ç§’ã€‚é€šè¿‡è¿™æ ·çš„é…ç½®ï¼ŒFeign åœ¨å‘èµ·è¿œç¨‹è°ƒç”¨æ—¶ï¼Œä¼šæœ‰æ›´å……è¶³çš„æ—¶é—´æ¥å»ºç«‹è¿æ¥å’Œè¯»å–å“åº”æ•°æ®ï¼Œä»è€Œé¿å…å› è¶…æ—¶å¯¼è‡´çš„è°ƒç”¨å¤±è´¥ï¼Œæé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚</p>
<h3 data-id="heading-21"><strong>4.1.2 æ—¥å¿—é…ç½®ï¼šè°ƒè¯• HTTP è¯·æ±‚çš„ â€œåˆ©å™¨â€</strong></h3>
<p>åœ¨å¼€å‘å’Œè°ƒè¯•é˜¶æ®µï¼Œäº†è§£ Feign å®é™…å‘é€å’Œæ¥æ”¶çš„ HTTP è¯·æ±‚åŠå“åº”å†…å®¹æ˜¯éå¸¸é‡è¦çš„ï¼Œè¿™æœ‰åŠ©äºæˆ‘ä»¬å¿«é€Ÿå®šä½å’Œè§£å†³é—®é¢˜ã€‚Feign æä¾›äº†çµæ´»çš„æ—¥å¿—é…ç½®åŠŸèƒ½ï¼Œè®©æˆ‘ä»¬å¯ä»¥è½»æ¾æŒæ§æ—¥å¿—çš„è¾“å‡ºçº§åˆ«å’Œå†…å®¹ã€‚</p>
<p>é¦–å…ˆï¼Œåœ¨application.ymlæ–‡ä»¶ä¸­è®¾ç½® Feign å®¢æˆ·ç«¯æ¥å£æ‰€åœ¨åŒ…çš„æ—¥å¿—çº§åˆ«ä¸ºDEBUGï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">logging:</span>
  <span class="hljs-attr">level:</span>
    <span class="hljs-attr">com.example.feignclientpackage:</span> <span class="hljs-string">DEBUG</span> <span class="hljs-comment"># å°†Feignå®¢æˆ·ç«¯æ¥å£æ‰€åœ¨åŒ…çš„æ—¥å¿—çº§åˆ«è®¾ç½®ä¸ºDEBUG</span>
</code></pre>
<p>é€šè¿‡è¿™ä¸€æ­¥é…ç½®ï¼ŒFeign ä¼šè¾“å‡ºæ›´è¯¦ç»†çš„æ—¥å¿—ä¿¡æ¯ï¼Œä½†æ­¤æ—¶æ—¥å¿—å†…å®¹è¿˜ä¸å¤Ÿå®Œæ•´ã€‚ä¸ºäº†è®© Feign è¾“å‡ºå®Œæ•´çš„è¯·æ±‚å¤´ã€è¯·æ±‚ä½“ã€å“åº”å¤´å’Œå“åº”ä½“ä¿¡æ¯ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨é…ç½®ç±»ä¸­è¿›è¡Œè¿›ä¸€æ­¥è®¾ç½®ã€‚åˆ›å»ºä¸€ä¸ªé…ç½®ç±»ï¼Œä¾‹å¦‚FeignConfig.javaï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> feign.Logger;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Configuration;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FeignConfig</span> {
    <span class="hljs-meta">@Bean</span>
    Logger.Level feignLoggerLevel() {
        <span class="hljs-keyword">return</span> Logger.Level.FULL; <span class="hljs-comment">// è®¾ç½®Feignæ—¥å¿—çº§åˆ«ä¸ºFULL</span>
    }
}
</code></pre>
<p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼ŒLogger.Level.FULLè¡¨ç¤ºè¾“å‡ºå®Œæ•´çš„æ—¥å¿—ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¯·æ±‚å’Œå“åº”çš„å¤´ä¿¡æ¯ã€æ­£æ–‡å’Œå…ƒæ•°æ®ã€‚è¿™æ ·ï¼Œå½“æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­è¿›è¡Œ Feign è°ƒç”¨æ—¶ï¼Œå°±å¯ä»¥åœ¨æ—¥å¿—ä¸­æ¸…æ™°åœ°çœ‹åˆ°å®Œæ•´çš„ HTTP è¯·æ±‚å’Œå“åº”è¿‡ç¨‹ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[UserFeignClient#getUser]</span> ---&gt; GET http://user-service/user/<span class="hljs-number">1</span> HTTP/<span class="hljs-number">1.1</span>
Authorization: Bearer xxxxx
Content-Type: application/json
Accept: application/json

{
    "param1": <span class="hljs-string">"value1"</span>,
    <span class="hljs-string">"param2"</span>: <span class="hljs-string">"value2"</span>
}
---&gt; END HTTP (<span class="hljs-number">45</span>-byte <span class="hljs-selector-tag">body</span>)

<span class="hljs-selector-attr">[UserFeignClient#getUser]</span> &lt;--- HTTP/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span> OK (<span class="hljs-number">345ms</span>)
<span class="hljs-attribute">Content</span>-Type: application/json
Content-Length: <span class="hljs-number">65</span>

{
    "id": <span class="hljs-number">1</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"å¼ ä¸‰"</span>,
    <span class="hljs-string">"age"</span>: <span class="hljs-number">20</span>
}
&lt;--- END HTTP (<span class="hljs-number">65</span>-byte <span class="hljs-selector-tag">body</span>)
</code></pre>
<p>é€šè¿‡è¿™äº›è¯¦ç»†çš„æ—¥å¿—ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°æ£€æŸ¥è¯·æ±‚å‚æ•°æ˜¯å¦æ­£ç¡®ã€å“åº”å†…å®¹æ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œä»è€Œå¿«é€Ÿæ’æŸ¥å’Œè§£å†³ Feign è°ƒç”¨è¿‡ç¨‹ä¸­å‡ºç°çš„é—®é¢˜ï¼Œæé«˜å¼€å‘å’Œè°ƒè¯•æ•ˆç‡ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1ee122bea854b88a908fc33f6e50e39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771228108&amp;x-signature=H1jyuXJtasNbM23zJHNe80P4x2E%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-22"><strong>4.2 Header ä¼ é€’ï¼šå®ç° Token ç­‰è‡ªå®šä¹‰å¤´ä¿¡æ¯</strong></h3>
<p>åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼ŒæœåŠ¡é—´çš„é€šä¿¡å¾€å¾€éœ€è¦æºå¸¦ä¸€äº›è‡ªå®šä¹‰çš„ Header ä¿¡æ¯ï¼Œæ¯”å¦‚ç”¨äºèº«ä»½éªŒè¯çš„ Tokenã€ç”¨äºé“¾è·¯è¿½è¸ªçš„ TraceId ç­‰ã€‚Feign æä¾›äº†çµæ´»çš„æœºåˆ¶æ¥å®ç° Header çš„ä¼ é€’ï¼Œç¡®ä¿è¿™äº›å…³é”®ä¿¡æ¯èƒ½å¤Ÿåœ¨æœåŠ¡é—´å‡†ç¡®æ— è¯¯åœ°æµè½¬ã€‚</p>
<p>ä»¥å¸¸è§çš„å¾®æœåŠ¡é‰´æƒåœºæ™¯ä¸ºä¾‹ï¼Œå½“ç”¨æˆ·åœ¨å‰ç«¯ç™»å½•æˆåŠŸåï¼Œç³»ç»Ÿä¼šç”Ÿæˆä¸€ä¸ª Tokenï¼Œè¿™ä¸ª Token ä¼šåœ¨åç»­çš„è¯·æ±‚ä¸­ä½œä¸ºèº«ä»½å‡­è¯ï¼Œç”¨äºéªŒè¯ç”¨æˆ·çš„æƒé™ã€‚åœ¨æœåŠ¡é—´è°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™ä¸ª Token ä»ä¸€ä¸ªæœåŠ¡ä¼ é€’åˆ°å¦ä¸€ä¸ªæœåŠ¡ï¼Œä»¥ç¡®ä¿æ¯ä¸ªæœåŠ¡éƒ½èƒ½è¯†åˆ«ç”¨æˆ·èº«ä»½å¹¶è¿›è¡Œç›¸åº”çš„æƒé™æ§åˆ¶ã€‚</p>
<p>ä¸ºäº†å®ç°è¿™ä¸€åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ç°RequestInterceptoræ¥å£æ¥åŠ¨æ€æ·»åŠ  Header ä¿¡æ¯ã€‚é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªå®ç°ç±»ï¼Œä¾‹å¦‚FeignAuthInterceptor.javaï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> feign.RequestInterceptor;
<span class="hljs-keyword">import</span> feign.RequestTemplate;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;
<span class="hljs-keyword">import</span> org.springframework.web.context.request.RequestContextHolder;
<span class="hljs-keyword">import</span> org.springframework.web.context.request.ServletRequestAttributes;

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FeignAuthInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RequestInterceptor</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">apply</span><span class="hljs-params">(RequestTemplate template)</span> {
        <span class="hljs-type">ServletRequestAttributes</span> <span class="hljs-variable">attributes</span> <span class="hljs-operator">=</span> (ServletRequestAttributes) RequestContextHolder.currentRequestAttributes();
        <span class="hljs-keyword">if</span> (attributes != <span class="hljs-literal">null</span>) {
            <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> attributes.getRequest().getHeader(<span class="hljs-string">"Authorization"</span>);
            <span class="hljs-keyword">if</span> (token != <span class="hljs-literal">null</span>) {
                template.header(<span class="hljs-string">"Authorization"</span>, token);
            }
        }
    }
}
</code></pre>
<p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼ŒFeignAuthInterceptorå®ç°äº†RequestInterceptoræ¥å£çš„applyæ–¹æ³•ã€‚åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆé€šè¿‡RequestContextHolderè·å–å½“å‰çš„è¯·æ±‚å±æ€§ï¼Œç„¶åä»è¯·æ±‚å¤´ä¸­è·å–Authorizationå­—æ®µï¼ˆå³ Tokenï¼‰ã€‚å¦‚æœ Token å­˜åœ¨ï¼Œå°±å°†å…¶æ·»åŠ åˆ° Feign è¯·æ±‚çš„å¤´ä¿¡æ¯ä¸­ã€‚è¿™æ ·ï¼Œå½“ Feign å‘èµ·è¿œç¨‹è°ƒç”¨æ—¶ï¼Œå°±ä¼šæºå¸¦è¿™ä¸ª Tokenï¼Œå®ç°äº†æœåŠ¡é—´é‰´æƒå‡­è¯çš„ä¼ é€’ã€‚</p>
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬ä¸ä»…å¯ä»¥ä¼ é€’ Tokenï¼Œè¿˜å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚ä¼ é€’å…¶ä»–è‡ªå®šä¹‰çš„ Header ä¿¡æ¯ï¼Œæ¯”å¦‚ç”¨æˆ·è¯­è¨€ç¯å¢ƒã€ç°åº¦æ ‡è¯†ç­‰ï¼Œæ»¡è¶³å„ç§å¤æ‚çš„ä¸šåŠ¡åœºæ™¯éœ€æ±‚ï¼Œç¡®ä¿å¾®æœåŠ¡æ¶æ„ä¸­å„ä¸ªæœåŠ¡ä¹‹é—´çš„é€šä¿¡å®‰å…¨å’Œé¡ºç•…ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8dd28cbd593f45b98d0cd73f714105c7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771228108&amp;x-signature=EBy9bjLN7Oc%2F%2Fkbzn858e%2FdkuJ0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-23"><strong>4.3 ç†”æ–­é™çº§ï¼šæœåŠ¡å®¹é”™çš„ â€œä¿éšœâ€</strong></h3>
<p>åœ¨å¤æ‚çš„å¾®æœåŠ¡æ¶æ„ä¸­ï¼ŒæœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»é”™ç»¼å¤æ‚ï¼Œä»»ä½•ä¸€ä¸ªæœåŠ¡å‡ºç°æ•…éšœéƒ½å¯èƒ½å¼•å‘è¿é”ååº”ï¼Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿçš„å´©æºƒï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ â€œæœåŠ¡é›ªå´©â€ æ•ˆåº”ã€‚ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼ŒFeign ç»“åˆ Hystrix æˆ– Sentinel ç­‰ç»„ä»¶ï¼Œæä¾›äº†å¼ºå¤§çš„ç†”æ–­é™çº§åŠŸèƒ½ï¼Œä¸ºæœåŠ¡çš„ç¨³å®šæ€§å’Œå¯é æ€§ä¿é©¾æŠ¤èˆªã€‚</p>
<p>ä»¥ Hystrix ä¸ºä¾‹ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ Feign è°ƒç”¨å…¶ä»–æœåŠ¡æ—¶ï¼Œå¦‚æœè¢«è°ƒç”¨çš„æœåŠ¡ï¼ˆæ¯”å¦‚ ServiceAï¼‰å› ä¸ºç½‘ç»œæ•…éšœã€èµ„æºè€—å°½ç­‰åŸå› æ— æ³•æ­£å¸¸å“åº”ï¼ŒFeign ä¼šåœ¨ä¸€å®šæ—¶é—´å†…å°è¯•é‡è¯•ã€‚ä½†å¦‚æœé‡è¯•å¤šæ¬¡åä»ç„¶å¤±è´¥ï¼ŒHystrix å°±ä¼šè§¦å‘ç†”æ–­æœºåˆ¶ï¼Œå°±åƒç”µè·¯ä¸­çš„ä¿é™©ä¸ä¸€æ ·ï¼Œåˆ‡æ–­å¯¹ ServiceA çš„è°ƒç”¨ï¼Œé¿å…å› ä¸æ–­å°è¯•è°ƒç”¨ä¸å¯ç”¨çš„æœåŠ¡è€Œæ¶ˆè€—å¤§é‡çš„ç³»ç»Ÿèµ„æºã€‚</p>
<p>åŒæ—¶ï¼ŒFeign é€šè¿‡@FeignClientæ³¨è§£çš„fallbackå±æ€§æŒ‡å®šé™çº§ç±»ã€‚è¿™ä¸ªé™çº§ç±»éœ€è¦å®ç° Feign æ¥å£ï¼Œå½“ç†”æ–­å‘ç”Ÿæ—¶ï¼ŒFeign ä¼šè°ƒç”¨é™çº§ç±»ä¸­çš„æ–¹æ³•ï¼Œæ‰§è¡Œå…œåº•é€»è¾‘ï¼Œè¿”å›ä¸€ä¸ªé¢„è®¾çš„é»˜è®¤å€¼æˆ–è€…æç¤ºä¿¡æ¯ï¼Œè€Œä¸æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œä»è€Œä¿è¯è°ƒç”¨æ–¹çš„ä¸šåŠ¡èƒ½å¤Ÿç»§ç»­è¿›è¡Œã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªUserServiceFeignClientæ¥å£ï¼Œç”¨äºè°ƒç”¨ç”¨æˆ·æœåŠ¡è·å–ç”¨æˆ·ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> org.springframework.cloud.openfeign.FeignClient;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.PathVariable;

<span class="hljs-meta">@FeignClient(name = <span class="hljs-string">"user-service"</span>, fallback = UserServiceFallback.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserServiceFeignClient</span> {
    <span class="hljs-meta">@GetMapping(<span class="hljs-string">"/user/{id}"</span>)</span>
    User getUserById(<span class="hljs-meta">@PathVariable</span> <span class="hljs-built_in">Long</span> id);
}
</code></pre>
<p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ@FeignClientæ³¨è§£çš„fallbackå±æ€§æŒ‡å®šäº†é™çº§ç±»ä¸ºUserServiceFallbackã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å®ç°è¿™ä¸ªé™çº§ç±»ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceFallback</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserServiceFeignClient</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUserById</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-comment">// è¿™é‡Œç¼–å†™å…œåº•é€»è¾‘ï¼Œæ¯”å¦‚è¿”å›ä¸€ä¸ªé»˜è®¤ç”¨æˆ·ä¿¡æ¯</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">defaultUser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
        defaultUser.setId(-<span class="hljs-number">1L</span>);
        defaultUser.setName(<span class="hljs-string">"é»˜è®¤ç”¨æˆ·"</span>);
        defaultUser.setAge(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">return</span> defaultUser;
    }
}
</code></pre>
<p>åœ¨UserServiceFallbackç±»ä¸­ï¼Œå®ç°äº†UserServiceFeignClientæ¥å£çš„getUserByIdæ–¹æ³•ã€‚å½“ç”¨æˆ·æœåŠ¡ä¸å¯ç”¨æ—¶ï¼ŒFeign ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªé»˜è®¤çš„ç”¨æˆ·ä¿¡æ¯ï¼Œé¿å…å› è°ƒç”¨å¤±è´¥è€Œå¯¼è‡´æ•´ä¸ªä¸šåŠ¡æµç¨‹ä¸­æ–­ã€‚</p>
<p>é€šè¿‡è¿™ç§ç†”æ–­é™çº§æœºåˆ¶ï¼ŒFeign èƒ½å¤Ÿæœ‰æ•ˆåœ°æé«˜ç³»ç»Ÿçš„å®¹é”™èƒ½åŠ›ï¼Œåœ¨é¢å¯¹å„ç§å¼‚å¸¸æƒ…å†µæ—¶ï¼Œä¾ç„¶èƒ½å¤Ÿä¿è¯éƒ¨åˆ†ä¸šåŠ¡çš„æ­£å¸¸è¿è¡Œï¼Œæå‡äº†ç³»ç»Ÿçš„æ•´ä½“ç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44981e14a3324b57a62afa255670677f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771228108&amp;x-signature=NTkkhN0yAfEDbeZUEcBK4574Rb0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-24"><strong>4.4 ç‰¹æ®Šåœºæ™¯ï¼šFeign å®ç°æ–‡ä»¶ä¸Šä¼ </strong></h3>
<p>åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œé™¤äº†å¸¸è§çš„æ•°æ®äº¤äº’ï¼Œæ–‡ä»¶ä¸Šä¼ ä¹Ÿæ˜¯ä¸€ä¸ªå¸¸è§çš„ä¸šåŠ¡éœ€æ±‚ã€‚ç„¶è€Œï¼ŒFeign é»˜è®¤å¹¶ä¸ç›´æ¥æ”¯æŒæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬é€šè¿‡ä¸€äº›é¢å¤–çš„é…ç½®å’Œä»£ç å®ç°æ¥æ»¡è¶³è¿™ä¸€ç‰¹æ®Šåœºæ™¯ã€‚</p>
<p>ä¸ºäº†è®© Feign èƒ½å¤Ÿæ”¯æŒæ–‡ä»¶ä¸Šä¼ ï¼Œé¦–å…ˆéœ€è¦å¼•å…¥feign-formä¾èµ–ï¼Œè¿™ä¸ªä¾èµ–æä¾›äº†å¯¹å¤šéƒ¨åˆ†è¡¨å•æ•°æ®çš„æ”¯æŒï¼Œæ˜¯å®ç°æ–‡ä»¶ä¸Šä¼ çš„å…³é”®ã€‚åœ¨pom.xmlæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä¾èµ–ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.github.openfeign.form<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>feign-form<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.8.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.github.openfeign.form<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>feign-form-spring<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.8.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>å¼•å…¥ä¾èµ–åï¼Œè¿˜éœ€è¦é…ç½®ä¸€ä¸ªè‡ªå®šä¹‰çš„ç¼–ç å™¨SpringFormEncoderï¼Œç”¨äºå¤„ç†æ–‡ä»¶ä¸Šä¼ æ—¶çš„è¡¨å•æ•°æ®ç¼–ç ã€‚åˆ›å»ºä¸€ä¸ªé…ç½®ç±»ï¼Œä¾‹å¦‚FeignMultipartConfig.javaï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> feign.codec.Encoder;
<span class="hljs-keyword">import</span> feign.form.spring.SpringFormEncoder;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hljs-keyword">import</span> org.springframework.http.converter.HttpMessageConverter;
<span class="hljs-keyword">import</span> org.springframework.http.converter.json.MappingJackson2HttpMessageConverter;
<span class="hljs-keyword">import</span> org.springframework.web.client.RestTemplate;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FeignMultipartConfig</span> {
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Encoder <span class="hljs-title function_">feignFormEncoder</span><span class="hljs-params">()</span> {
        List&lt;HttpMessageConverter&lt;?&gt;&gt; messageConverters = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        messageConverters.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MappingJackson2HttpMessageConverter</span>());
        <span class="hljs-type">RestTemplate</span> <span class="hljs-variable">restTemplate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplate</span>(messageConverters);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpringFormEncoder</span>(restTemplate.getMessageConverters());
    }
}
</code></pre>
<p>åœ¨ä¸Šè¿°é…ç½®ç±»ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªfeignFormEncoderæ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªSpringFormEncoderå®ä¾‹ã€‚è¿™ä¸ªç¼–ç å™¨ç»“åˆäº† Spring çš„æ¶ˆæ¯è½¬æ¢å™¨ï¼Œèƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç†æ–‡ä»¶ä¸Šä¼ æ—¶çš„è¡¨å•æ•°æ®ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥ç¼–å†™ Feign æ¥å£æ–¹æ³•æ¥å®ç°æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½äº†ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„æ¥å£ï¼Œæ¥æ”¶MultipartFileç±»å‹çš„æ–‡ä»¶å‚æ•°ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> feign.Headers;
<span class="hljs-keyword">import</span> org.springframework.cloud.openfeign.FeignClient;
<span class="hljs-keyword">import</span> org.springframework.http.MediaType;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.PostMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RequestPart;
<span class="hljs-keyword">import</span> org.springframework.web.multipart.MultipartFile;

<span class="hljs-meta">@FeignClient(name = <span class="hljs-string">"file-service"</span>, configuration = FeignMultipartConfig.class)</span>
<span class="hljs-meta">@Headers(<span class="hljs-string">"Content-Type: multipart/form-data"</span>)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">FileUploadFeignClient</span> {
    <span class="hljs-meta">@PostMapping(value = <span class="hljs-string">"/upload"</span>, consumes = MediaType.MULTIPART_FORM_DATA_VALUE)</span>
    String uploadFile(<span class="hljs-meta">@RequestPart(<span class="hljs-string">"file"</span>)</span> MultipartFile file);
}
</code></pre>
<p>åœ¨è¿™ä¸ªFileUploadFeignClientæ¥å£ä¸­ï¼Œ@FeignClientæ³¨è§£æŒ‡å®šäº†è¦è°ƒç”¨çš„æœåŠ¡åï¼Œå¹¶é€šè¿‡configurationå±æ€§å¼•ç”¨äº†æˆ‘ä»¬å‰é¢åˆ›å»ºçš„é…ç½®ç±»FeignMultipartConfigã€‚@Headersæ³¨è§£è®¾ç½®äº†è¯·æ±‚çš„ Content-Type ä¸ºmultipart/form-dataï¼Œè¿™æ˜¯æ–‡ä»¶ä¸Šä¼ æ—¶å¸¸ç”¨çš„å†…å®¹ç±»å‹ã€‚@PostMappingæ³¨è§£å®šä¹‰äº†è¯·æ±‚çš„è·¯å¾„å’Œæ–¹æ³•ï¼Œ@RequestPartæ³¨è§£ç”¨äºç»‘å®šæ–‡ä»¶å‚æ•°ã€‚</p>
<p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæˆ‘ä»¬æˆåŠŸåœ°åœ¨ Feign ä¸­å®ç°äº†æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œæ»¡è¶³äº†å¾®æœåŠ¡æ¶æ„ä¸­æ–‡ä»¶ä¼ è¾“çš„ç‰¹æ®Šä¸šåŠ¡éœ€æ±‚ï¼Œä½¿å¾— Feign èƒ½å¤Ÿåœ¨æ›´å¹¿æ³›çš„åœºæ™¯ä¸­å‘æŒ¥ä½œç”¨ ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44396871ffe649bab253710d15fd262f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771228108&amp;x-signature=1BKAB%2Ftgy1fcn1hCUJgQHi%2F%2Fp%2BI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-25"><strong>äº”ã€é¿å‘æŒ‡å—ï¼šè¿™äº› â€œå‘â€ ä½ è‚¯å®šè¸©è¿‡</strong></h2>
<h3 data-id="heading-26"><strong>5.1 @PathVariable å¿…é¡»æŒ‡å®š value å±æ€§</strong></h3>
<p>åœ¨ä½¿ç”¨ Feign è¿›è¡Œè¿œç¨‹è°ƒç”¨æ—¶ï¼Œ@PathVariableæ³¨è§£çš„ä½¿ç”¨è§„åˆ™ä¸ Spring MVC å­˜åœ¨ä¸€å®šå·®å¼‚ï¼Œè¿™ä¹Ÿæ˜¯è®¸å¤šå¼€å‘è€…å®¹æ˜“è¸©å‘çš„åœ°æ–¹ã€‚åœ¨ Spring MVC ä¸­ï¼Œå½“ä½¿ç”¨@PathVariableæ³¨è§£æ—¶ï¼Œå¦‚æœè·¯å¾„å˜é‡åä¸æ–¹æ³•å‚æ•°åä¸€è‡´ï¼Œæ˜¯å¯ä»¥çœç•¥valueå±æ€§çš„ï¼Œæ¡†æ¶èƒ½å¤Ÿè‡ªåŠ¨è¿›è¡Œå‚æ•°ç»‘å®šã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">"/user/{id}"</span>)
public User <span class="hljs-built_in">getUserById</span>(<span class="hljs-variable">@PathVariable</span> Long id) {
    <span class="hljs-comment">// ä¸šåŠ¡é€»è¾‘</span>
}
</code></pre>
<p>ç„¶è€Œï¼Œåœ¨ Feign ä¸­ï¼Œæƒ…å†µå´æœ‰æ‰€ä¸åŒã€‚Feign è¦æ±‚åœ¨ä½¿ç”¨@PathVariableæ³¨è§£æ—¶ï¼Œå¿…é¡»æ˜¾å¼æŒ‡å®švalueå±æ€§ï¼Œå³ä½¿è·¯å¾„å˜é‡åä¸æ–¹æ³•å‚æ•°åç›¸åŒä¹Ÿä¸èƒ½çœç•¥ã€‚å¦åˆ™ï¼Œåœ¨è¿è¡Œæ—¶ä¼šæŠ›å‡ºå‚æ•°ç»‘å®šå¼‚å¸¸ï¼Œå¯¼è‡´è¿œç¨‹è°ƒç”¨å¤±è´¥ã€‚æ¯”å¦‚ï¼Œä¸‹é¢è¿™æ ·çš„ä»£ç åœ¨ Feign ä¸­æ˜¯é”™è¯¯çš„ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@FeignClient</span>(name = <span class="hljs-string">"user-service"</span>)
public interface UserFeignClient {
    <span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">"/user/{id}"</span>)
    User <span class="hljs-built_in">getUserById</span>(<span class="hljs-variable">@PathVariable</span> Long id); <span class="hljs-comment">// é”™è¯¯ï¼ŒæœªæŒ‡å®švalueå±æ€§</span>
}
</code></pre>
<p>æ­£ç¡®çš„å†™æ³•åº”è¯¥æ˜¯ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@FeignClient</span>(name = <span class="hljs-string">"user-service"</span>)
public interface UserFeignClient {
    <span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">"/user/{id}"</span>)
    User <span class="hljs-built_in">getUserById</span>(<span class="hljs-variable">@PathVariable</span>(<span class="hljs-string">"id"</span>) Long id); <span class="hljs-comment">// æ­£ç¡®ï¼ŒæŒ‡å®švalueå±æ€§ä¸º"id"</span>
}
</code></pre>
<p>è¿™ä¸€å·®å¼‚çš„åŸå› åœ¨äº Feign çš„è®¾è®¡æœºåˆ¶ï¼Œå®ƒå¯¹æ³¨è§£çš„è§£ææ›´ä¸ºä¸¥æ ¼ï¼Œéœ€è¦æ˜ç¡®çš„å…ƒæ•°æ®æ¥ç”Ÿæˆå‡†ç¡®çš„ HTTP è¯·æ±‚ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨ Feign æ—¶ï¼Œå¼€å‘è€…åŠ¡å¿…ç‰¢è®°@PathVariableæ³¨è§£å¿…é¡»æŒ‡å®švalueå±æ€§è¿™ä¸€è§„åˆ™ï¼Œé¿å…å› æ³¨è§£ä½¿ç”¨ä¸å½“è€Œå¼•å‘çš„é—®é¢˜ï¼Œç¡®ä¿è¿œç¨‹è°ƒç”¨çš„é¡ºåˆ©è¿›è¡Œã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49e1ef1855794aa39ce74a8632031ee5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771228108&amp;x-signature=opIOuB6lF8aEq3TdSKN%2FSjsijTY%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-27"><strong>5.2 Header ä¼ é€’çš„ â€œéšå½¢å‘â€ï¼šä¸Šä¸‹æ–‡ä¸¢å¤±</strong></h3>
<p>åœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸‹ä½¿ç”¨ Feign è¿›è¡Œè¿œç¨‹è°ƒç”¨æ—¶ï¼ŒHeader ä¼ é€’å¯èƒ½ä¼šå‡ºç°æ„æƒ³ä¸åˆ°çš„é—®é¢˜ï¼Œå…¶ä¸­æœ€å¸¸è§çš„å°±æ˜¯ä¸Šä¸‹æ–‡ä¸¢å¤±ï¼Œå¯¼è‡´ Header æ— æ³•æ­£ç¡®ä¼ é€’ã€‚åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡RequestInterceptorè½»æ¾åœ°å°†å½“å‰è¯·æ±‚çš„ Header ä¿¡æ¯æ·»åŠ åˆ° Feign è¯·æ±‚ä¸­ï¼Œå®ç° Header çš„ä¼ é€’ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> feign.RequestInterceptor;
<span class="hljs-keyword">import</span> feign.RequestTemplate;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;
<span class="hljs-keyword">import</span> org.springframework.web.context.request.RequestContextHolder;
<span class="hljs-keyword">import</span> org.springframework.web.context.request.ServletRequestAttributes;

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FeignAuthInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RequestInterceptor</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">apply</span><span class="hljs-params">(RequestTemplate template)</span> {
        <span class="hljs-type">ServletRequestAttributes</span> <span class="hljs-variable">attributes</span> <span class="hljs-operator">=</span> (ServletRequestAttributes) RequestContextHolder.currentRequestAttributes();
        <span class="hljs-keyword">if</span> (attributes != <span class="hljs-literal">null</span>) {
            <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> attributes.getRequest().getHeader(<span class="hljs-string">"Authorization"</span>);
            <span class="hljs-keyword">if</span> (token != <span class="hljs-literal">null</span>) {
                template.header(<span class="hljs-string">"Authorization"</span>, token);
            }
        }
    }
}
</code></pre>
<p>ç„¶è€Œï¼Œå½“æ¶‰åŠåˆ°å¤šçº¿ç¨‹æ—¶ï¼Œæƒ…å†µå°±å˜å¾—å¤æ‚èµ·æ¥ã€‚åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ä¸Šä¸‹æ–‡ï¼ŒSpring çš„RequestContextHolderæ˜¯åŸºäºThreadLocalå®ç°çš„ï¼Œè¿™æ„å‘³ç€å­çº¿ç¨‹æ— æ³•è‡ªåŠ¨ç»§æ‰¿ä¸»çº¿ç¨‹çš„ThreadLocalä¸­çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ä¸­ä½¿ç”¨ Feign è°ƒç”¨å…¶ä»–æœåŠ¡ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">scheduling</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Async</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">stereotype</span>.<span class="hljs-property">Service</span>;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {

    <span class="hljs-meta">@Async</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">asyncTask</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// è¿™é‡Œè°ƒç”¨Feignå®¢æˆ·ç«¯</span>
        userFeignClient.<span class="hljs-title function_">getUserById</span>(1L);
    }
}
</code></pre>
<p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼ŒasyncTaskæ–¹æ³•æ˜¯ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ï¼Œå½“å®ƒåœ¨æ–°çš„çº¿ç¨‹ä¸­æ‰§è¡Œ Feign è°ƒç”¨æ—¶ï¼Œç”±äºæ–°çº¿ç¨‹æ— æ³•è·å–ä¸»çº¿ç¨‹çš„ThreadLocalä¸­çš„Authorizationå¤´ä¿¡æ¯ï¼Œå¯¼è‡´FeignAuthInterceptoræ— æ³•æ­£ç¡®è·å–å¹¶æ·»åŠ  Headerï¼Œä»è€Œä½¿è¿œç¨‹è°ƒç”¨ç¼ºå°‘å¿…è¦çš„èº«ä»½éªŒè¯ä¿¡æ¯ï¼Œæœ€ç»ˆå¯èƒ½å¯¼è‡´è°ƒç”¨å¤±è´¥ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨TransmittableThreadLocalæ¥æ›¿ä»£åŸç”Ÿçš„ThreadLocalã€‚TransmittableThreadLocalèƒ½å¤Ÿåœ¨å­çº¿ç¨‹ä¸­ä¼ é€’çˆ¶çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œç¡®ä¿ Header ä¿¡æ¯ä¸ä¼šä¸¢å¤±ã€‚é¦–å…ˆï¼Œå¼•å…¥transmittable-thread-localä¾èµ–ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>transmittable-thread-local<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.12.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>ç„¶åï¼Œä¿®æ”¹FeignAuthInterceptorï¼Œä½¿ç”¨TransmittableThreadLocalæ¥ä¼ é€’ä¸Šä¸‹æ–‡ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> com.<span class="hljs-property">alibaba</span>.<span class="hljs-property">ttl</span>.<span class="hljs-property">TransmittableThreadLocal</span>;
<span class="hljs-keyword">import</span> feign.<span class="hljs-property">RequestInterceptor</span>;
<span class="hljs-keyword">import</span> feign.<span class="hljs-property">RequestTemplate</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">stereotype</span>.<span class="hljs-property">Component</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">web</span>.<span class="hljs-property">context</span>.<span class="hljs-property">request</span>.<span class="hljs-property">RequestContextHolder</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">web</span>.<span class="hljs-property">context</span>.<span class="hljs-property">request</span>.<span class="hljs-property">ServletRequestAttributes</span>;

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FeignAuthInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RequestInterceptor</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-title class_">TransmittableThreadLocal</span>&lt;<span class="hljs-title class_">String</span>&gt; tokenThreadLocal = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransmittableThreadLocal</span>&lt;&gt;();

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">apply</span>(<span class="hljs-params">RequestTemplate template</span>) {
        <span class="hljs-title class_">String</span> token = tokenThreadLocal.<span class="hljs-title function_">get</span>();
        <span class="hljs-keyword">if</span> (token != <span class="hljs-literal">null</span>) {
            template.<span class="hljs-title function_">header</span>(<span class="hljs-string">"Authorization"</span>, token);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setToken</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> token</span>) {
        tokenThreadLocal.<span class="hljs-title function_">set</span>(token);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">removeToken</span>(<span class="hljs-params"/>) {
        tokenThreadLocal.<span class="hljs-title function_">remove</span>();
    }
}
</code></pre>
<p>åœ¨è°ƒç”¨å¼‚æ­¥æ–¹æ³•å‰ï¼Œå°†Authorizationå¤´ä¿¡æ¯è®¾ç½®åˆ°TransmittableThreadLocalä¸­ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">import org.springframework.web.context.request.RequestContextHolder<span class="hljs-comment">;</span>
import org.springframework.web.context.request.ServletRequestAttributes<span class="hljs-comment">;</span>

public class MainService {

    public void mainMethod() {
        ServletRequestAttributes <span class="hljs-attr">attributes</span> = (ServletRequestAttributes) RequestContextHolder.currentRequestAttributes()<span class="hljs-comment">;</span>
        if (attributes != null) {
            String <span class="hljs-attr">token</span> = attributes.getRequest().getHeader(<span class="hljs-string">"Authorization"</span>)<span class="hljs-comment">;</span>
            FeignAuthInterceptor.setToken(token)<span class="hljs-comment">;</span>
        }
        userService.asyncTask()<span class="hljs-comment">;</span>
        FeignAuthInterceptor.removeToken()<span class="hljs-comment">;</span>
    }
}
</code></pre>
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå³ä½¿åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œä¹Ÿèƒ½ç¡®ä¿ Feign è°ƒç”¨æ—¶ Header ä¿¡æ¯çš„æ­£ç¡®ä¼ é€’ï¼Œé¿å…å› ä¸Šä¸‹æ–‡ä¸¢å¤±è€Œå¯¼è‡´çš„è°ƒç”¨å¤±è´¥é—®é¢˜ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/759a19ddf5ec43888bf84fab7cd95e45~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771228108&amp;x-signature=cruW4askrHr%2FsyfS6ZfKnYBYAoA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-28"><strong>5.3 æœåŠ¡åå¤§å°å†™é—®é¢˜ï¼šæ³¨å†Œä¸­å¿ƒçš„ â€œä¸¥æ ¼åŒ¹é…â€</strong></h3>
<p>åœ¨ä½¿ç”¨ Feign è¿›è¡ŒæœåŠ¡è°ƒç”¨æ—¶ï¼Œ@FeignClientæ³¨è§£çš„nameå±æ€§æŒ‡å®šçš„æœåŠ¡åå¿…é¡»ä¸æœåŠ¡æ³¨å†Œä¸­å¿ƒä¸­æ³¨å†Œçš„æœåŠ¡åå®Œå…¨ä¸€è‡´ï¼ŒåŒ…æ‹¬å¤§å°å†™ã€‚è¿™ä¸€ç‚¹åœ¨å®é™…é¡¹ç›®ä¸­å®¹æ˜“è¢«å¿½è§†ï¼Œä»è€Œå¯¼è‡´ Feign æ— æ³•æ‰¾åˆ°å¯¹åº”çš„æœåŠ¡å®ä¾‹ï¼Œå¼•å‘è°ƒç”¨å¤±è´¥çš„é”™è¯¯ã€‚</p>
<p>ä»¥ Eureka æœåŠ¡æ³¨å†Œä¸­å¿ƒä¸ºä¾‹ï¼Œå‡è®¾æˆ‘ä»¬åœ¨ Eureka ä¸­æ³¨å†Œäº†ä¸€ä¸ªåä¸ºUser-Serviceçš„æœåŠ¡ï¼ŒæœåŠ¡åé‡‡ç”¨äº†å¤§å†™å­—æ¯å’Œä¸­åˆ’çº¿çš„ç»„åˆã€‚æ­¤æ—¶ï¼Œå¦‚æœåœ¨ Feign å®¢æˆ·ç«¯ä¸­ä½¿ç”¨@FeignClient(name = "user-service")ï¼ˆæ³¨æ„è¿™é‡Œçš„æœåŠ¡åå…¨éƒ¨å°å†™ï¼‰æ¥è°ƒç”¨è¯¥æœåŠ¡ï¼ŒFeign å°†æ— æ³•åœ¨ Eureka ä¸­æ‰¾åˆ°åŒ¹é…çš„æœåŠ¡å®ä¾‹ï¼Œå› ä¸º Eureka å¯¹æœåŠ¡åçš„åŒ¹é…æ˜¯å¤§å°å†™æ•æ„Ÿçš„ã€‚</p>
<p>æ­£ç¡®çš„åšæ³•æ˜¯ç¡®ä¿@FeignClientæ³¨è§£ä¸­çš„nameå±æ€§ä¸æœåŠ¡æ³¨å†Œä¸­å¿ƒä¸­çš„æœåŠ¡åå®Œå…¨ä¸€è‡´ï¼Œå³@FeignClient(name = "User-Service")ã€‚è¿™æ ·ï¼ŒFeign æ‰èƒ½å‡†ç¡®åœ°ä»æœåŠ¡æ³¨å†Œä¸­å¿ƒè·å–åˆ°æœåŠ¡å®ä¾‹çš„åœ°å€ä¿¡æ¯ï¼Œå¹¶è¿›è¡Œåç»­çš„è¿œç¨‹è°ƒç”¨ã€‚</p>
<p>åœ¨å›¢é˜Ÿå¼€å‘ä¸­ï¼Œä¸ºäº†é¿å…å› æœåŠ¡åå¤§å°å†™é—®é¢˜å¯¼è‡´çš„è°ƒç”¨å¤±è´¥ï¼Œå»ºè®®åˆ¶å®šç»Ÿä¸€çš„æœåŠ¡å‘½åè§„èŒƒï¼Œä¾‹å¦‚å…¨éƒ¨é‡‡ç”¨å°å†™å­—æ¯åŠ ä¸‹åˆ’çº¿çš„æ–¹å¼ï¼ˆå¦‚user_serviceï¼‰ï¼Œæˆ–è€…å…¨éƒ¨é‡‡ç”¨å¤§å†™å­—æ¯åŠ ä¸­åˆ’çº¿çš„æ–¹å¼ï¼ˆå¦‚USER-SERVICEï¼‰ã€‚åŒæ—¶ï¼Œåœ¨æ³¨å†ŒæœåŠ¡å’Œå®šä¹‰ Feign å®¢æˆ·ç«¯æ—¶ï¼Œä¸¥æ ¼æŒ‰ç…§è§„èŒƒè¿›è¡Œå‘½åï¼Œä»¥å‡å°‘å› å‘½åä¸ä¸€è‡´è€Œå¸¦æ¥çš„æ½œåœ¨é—®é¢˜ï¼Œæé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f440c44bee534f838966d52680a5a7d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771228108&amp;x-signature=8qviWQCrPIk%2BQv%2FK7BmZChCBnuc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-29"><strong>å…­ã€æ€»ç»“ä¸å±•æœ›ï¼šFeign åœ¨å¾®æœåŠ¡æ¶æ„ä¸­çš„ä»·å€¼</strong></h2>
<p>åœ¨å½“ä»Šå¤æ‚å¤šå˜çš„å¾®æœåŠ¡æ¶æ„é¢†åŸŸï¼ŒFeign å‡­å€Ÿå…¶ç‹¬ç‰¹çš„ä¼˜åŠ¿ï¼Œå·²ç„¶æˆä¸º Spring é¡¹ç›®ä¸­ä¸å¯æˆ–ç¼ºçš„å…³é”®ç»„ä»¶ï¼Œå‘æŒ¥ç€ä¸¾è¶³è½»é‡çš„ä½œç”¨ã€‚</p>
<p>å›é¡¾ Feign çš„æ ¸å¿ƒä»·å€¼ï¼Œé¦–å½“å…¶å†²çš„ä¾¿æ˜¯å…¶ç®€æ´ç›´è§‚çš„å£°æ˜å¼è°ƒç”¨æ–¹å¼ã€‚é€šè¿‡ â€œæ¥å£ + æ³¨è§£â€ è¿™ä¸€åˆ›æ–°æ¨¡å¼ï¼ŒFeign å°†åŸæœ¬ç¹çå¤æ‚çš„è¿œç¨‹è°ƒç”¨è¿‡ç¨‹è¿›è¡Œäº†é«˜åº¦æŠ½è±¡ä¸ç®€åŒ–ï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿä»¥è°ƒç”¨æœ¬åœ°æ–¹æ³•çš„æ€ç»´å’Œæ–¹å¼æ¥å¤„ç†è¿œç¨‹æœåŠ¡é—´çš„é€šä¿¡ã€‚è¿™ä¸ä»…å¤§å¹…é™ä½äº†å¼€å‘çš„éš¾åº¦å’Œå·¥ä½œé‡ï¼Œå‡å°‘äº†å› æ‰‹åŠ¨å¤„ç† HTTP è¯·æ±‚ç»†èŠ‚è€Œå¯èƒ½å¼•å‘çš„é”™è¯¯ï¼Œè¿˜æ˜¾è‘—æå‡äº†ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚å°±å¦‚åŒåœ¨ä¸€ä¸ªåºå¤§çš„å»ºç­‘é¡¹ç›®ä¸­ï¼ŒFeign ä¸ºå¼€å‘è€…æä¾›äº†ä¸€å¥—æ ‡å‡†åŒ–ã€æ¨¡å—åŒ–çš„æ„å»ºå·¥å…·ï¼Œä½¿å¾—å„ä¸ªå¾®æœåŠ¡ä¹‹é—´çš„äº¤äº’å˜å¾—æ›´åŠ é¡ºç•…ã€é«˜æ•ˆã€‚</p>
<p>æ— ç¼é›†æˆ Spring ç”Ÿæ€ç³»ç»Ÿï¼Œæ˜¯ Feign çš„åˆä¸€çªå‡ºä¼˜åŠ¿ã€‚å®ƒä¸ Spring Bootã€Spring Cloud ç­‰ç»„ä»¶ç´§å¯†ç»“åˆï¼Œç›¸å¾—ç›Šå½°ï¼Œå……åˆ†åˆ©ç”¨äº† Spring æ¡†æ¶å¼ºå¤§çš„ä¾èµ–æ³¨å…¥ã€é…ç½®ç®¡ç†ç­‰åŠŸèƒ½ï¼Œå®ç°äº†ä¸ç°æœ‰ Spring é¡¹ç›®çš„æ·±åº¦èåˆã€‚è¿™ç§æ·±åº¦é›†æˆä¸ä»…å‡å°‘äº†æŠ€æœ¯é€‰å‹å’Œæ¶æ„æ­å»ºçš„æˆæœ¬ï¼Œè¿˜ä¸ºå¼€å‘è€…æä¾›äº†ç»Ÿä¸€çš„å¼€å‘ä½“éªŒå’Œç¼–ç¨‹æ¨¡å‹ï¼Œä½¿å¾—åŸºäº Spring çš„å¾®æœåŠ¡å¼€å‘æ›´åŠ ä¾¿æ·ã€é«˜æ•ˆã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªåŸºäº Spring Cloud çš„ç”µå•†ç³»ç»Ÿä¸­ï¼ŒFeign å¯ä»¥è½»æ¾åœ°ä¸ Eurekaã€Nacos ç­‰æœåŠ¡æ³¨å†Œä¸­å¿ƒé…åˆï¼Œå®ç°æœåŠ¡çš„è‡ªåŠ¨å‘ç°ä¸è°ƒç”¨ï¼Œä¸ Ribbonã€Spring Cloud LoadBalancer ç­‰è´Ÿè½½å‡è¡¡ç»„ä»¶ååŒå·¥ä½œï¼Œç¡®ä¿è¯·æ±‚èƒ½å¤Ÿå‡åŒ€åœ°åˆ†å‘åˆ°å„ä¸ªæœåŠ¡å®ä¾‹ä¸Šï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½å’Œå¯ç”¨æ€§ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e8ba02295b449819b6164bf42565457~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771228108&amp;x-signature=IqgR7C6XjMz26%2Be4wCPmHEWbOYc%3D" alt="" loading="lazy"/></p>
<p>æ­¤å¤–ï¼ŒFeign åœ¨è´Ÿè½½å‡è¡¡å’Œç†”æ–­é™çº§æ–¹é¢çš„å‡ºè‰²è¡¨ç°ï¼Œä¸ºæ„å»ºé«˜å¯ç”¨ã€é«˜æ€§èƒ½çš„å¾®æœåŠ¡æ¶æ„æä¾›äº†åšå®çš„ä¿éšœã€‚ç»“åˆ Ribbon æˆ– Spring Cloud LoadBalancer ç­‰è´Ÿè½½å‡è¡¡ç»„ä»¶ï¼ŒFeign èƒ½å¤Ÿæ ¹æ®é¢„è®¾çš„ç­–ç•¥ï¼Œå°†è¯·æ±‚æ™ºèƒ½åœ°åˆ†å‘åˆ°å¤šä¸ªæœåŠ¡å®ä¾‹ä¸Šï¼Œæœ‰æ•ˆé¿å…äº†å•ä¸ªæœåŠ¡å®ä¾‹å› è´Ÿè½½è¿‡é«˜è€Œå¯¼è‡´çš„æ€§èƒ½ç“¶é¢ˆå’Œæ•…éšœã€‚åŒæ—¶ï¼Œé€šè¿‡ä¸ Hystrixã€Sentinel ç­‰ç†”æ–­é™çº§ç»„ä»¶çš„é›†æˆï¼ŒFeign èƒ½å¤Ÿåœ¨æœåŠ¡å‡ºç°æ•…éšœæˆ–ä¸å¯ç”¨æ—¶ï¼ŒåŠæ—¶è§¦å‘ç†”æ–­æœºåˆ¶ï¼Œå¿«é€Ÿè¿”å›é™çº§ç»“æœï¼Œé¿å…äº†å› æœåŠ¡æ•…éšœè€Œå¼•å‘çš„è¿é”ååº”å’ŒæœåŠ¡é›ªå´©æ•ˆåº”ï¼Œç¡®ä¿äº†ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚</p>
<p>å±•æœ›æœªæ¥ï¼Œéšç€å¾®æœåŠ¡æ¶æ„çš„ä¸æ–­å‘å±•å’Œæ¼”è¿›ï¼ŒFeign æœ‰æœ›ä¸æ›´å¤šæ–°å…´çš„æŠ€æœ¯å’Œç»„ä»¶å®ç°æ·±åº¦èåˆä¸ååŒåˆ›æ–°ã€‚ä¾‹å¦‚ï¼Œä¸ Spring Cloud Gateway è¿™ä¸€æ–°ä¸€ä»£çš„ç½‘å…³ç»„ä»¶ç›¸ç»“åˆï¼ŒFeign å¯ä»¥åœ¨ç½‘å…³å±‚é¢å®ç°æ›´åŠ çµæ´»ã€é«˜æ•ˆçš„æœåŠ¡è·¯ç”±å’Œè½¬å‘ã€‚Spring Cloud Gateway æä¾›äº†ä¸°å¯Œçš„è·¯ç”±è§„åˆ™å’Œè¿‡æ»¤å™¨åŠŸèƒ½ï¼Œèƒ½å¤Ÿå¯¹è¯·æ±‚è¿›è¡Œæ›´ç»†ç²’åº¦çš„æ§åˆ¶å’Œå¤„ç†ï¼Œè€Œ Feign åˆ™ä¸“æ³¨äºæœåŠ¡é—´çš„é€šä¿¡ï¼Œä¸¤è€…ç»“åˆå¯ä»¥å®ç°ä»ç½‘å…³åˆ°å¾®æœåŠ¡çš„å…¨é“¾è·¯ä¼˜åŒ–ï¼Œè¿›ä¸€æ­¥æå‡ç³»ç»Ÿçš„æ€§èƒ½å’Œå®‰å…¨æ€§ã€‚åœ¨ä¸€ä¸ªå¤§å‹çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒSpring Cloud Gateway å¯ä»¥æ ¹æ®è¯·æ±‚çš„è·¯å¾„ã€å‚æ•°ç­‰ä¿¡æ¯ï¼Œå°†è¯·æ±‚ç²¾å‡†åœ°è·¯ç”±åˆ°å¯¹åº”çš„å¾®æœåŠ¡ï¼Œç„¶åç”± Feign å®Œæˆå¾®æœåŠ¡ä¹‹é—´çš„è°ƒç”¨ï¼ŒåŒæ—¶åˆ©ç”¨ Feign çš„è´Ÿè½½å‡è¡¡å’Œç†”æ–­é™çº§åŠŸèƒ½ï¼Œç¡®ä¿æ•´ä¸ªè°ƒç”¨è¿‡ç¨‹çš„ç¨³å®šå’Œé«˜æ•ˆã€‚</p>
<p>æ­¤å¤–ï¼ŒFeign ä¸ Sentinel ç­‰æµé‡æ§åˆ¶ç»„ä»¶çš„ååŒä½¿ç”¨ä¹Ÿå°†æˆä¸ºæœªæ¥çš„å‘å±•è¶‹åŠ¿ã€‚Sentinel ä½œä¸ºä¸€æ¬¾å¼ºå¤§çš„æµé‡æ§åˆ¶å’Œç†”æ–­é™çº§æ¡†æ¶ï¼Œèƒ½å¤Ÿå¯¹æœåŠ¡çš„æµé‡è¿›è¡Œå®æ—¶ç›‘æ§å’Œç²¾å‡†æ§åˆ¶ï¼Œä¸ Feign é›†æˆåï¼Œå¯ä»¥å®ç°å¯¹ Feign è°ƒç”¨çš„å…¨æ–¹ä½ä¿æŠ¤ã€‚åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼ŒSentinel å¯ä»¥æ ¹æ®é¢„è®¾çš„æµé‡è§„åˆ™ï¼Œå¯¹ Feign çš„è°ƒç”¨è¿›è¡Œé™æµã€é™çº§ç­‰æ“ä½œï¼Œç¡®ä¿æœåŠ¡åœ¨é¢å¯¹çªå‘æµé‡æ—¶èƒ½å¤Ÿä¿æŒç¨³å®šè¿è¡Œï¼Œé¿å…å› æµé‡è¿‡å¤§è€Œå¯¼è‡´çš„ç³»ç»Ÿå´©æºƒã€‚åŒæ—¶ï¼ŒSentinel è¿˜æä¾›äº†ä¸°å¯Œçš„ç›‘æ§å’ŒæŠ¥è­¦åŠŸèƒ½ï¼Œèƒ½å¤ŸåŠæ—¶å‘ç°å’Œå¤„ç†æœåŠ¡è°ƒç”¨è¿‡ç¨‹ä¸­å‡ºç°çš„å¼‚å¸¸æƒ…å†µï¼Œä¸ºç³»ç»Ÿçš„ç¨³å®šè¿è¡Œæä¾›äº†æœ‰åŠ›çš„æ”¯æŒã€‚</p>
<p>Feign ä½œä¸º Spring é¡¹ç›®ä¸­å¾®æœåŠ¡è¿œç¨‹è°ƒç”¨çš„åˆ©å™¨ï¼Œå‡­å€Ÿå…¶æ ¸å¿ƒä»·å€¼å’Œå¼ºå¤§åŠŸèƒ½ï¼Œå·²ç»åœ¨ä¼—å¤šé¡¹ç›®ä¸­å¾—åˆ°äº†å¹¿æ³›çš„åº”ç”¨å’ŒéªŒè¯ã€‚åœ¨æœªæ¥ï¼Œéšç€ä¸æ›´å¤šå…ˆè¿›æŠ€æœ¯å’Œç»„ä»¶çš„èåˆä¸åˆ›æ–°ï¼ŒFeign å°†ç»§ç»­å‘æŒ¥é‡è¦ä½œç”¨ï¼ŒåŠ©åŠ›å¼€å‘è€…æ„å»ºæ›´åŠ é«˜æ•ˆã€ç¨³å®šã€å¯é çš„å¾®æœåŠ¡æ¶æ„ï¼Œä¸ºä¼ä¸šçš„æ•°å­—åŒ–è½¬å‹å’Œåˆ›æ–°å‘å±•æä¾›åšå®çš„æŠ€æœ¯æ”¯æ’‘ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1039b4b1a2e943fab23789222dfdbb57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771228108&amp;x-signature=zsTrJM4rpdJoLIT9sx%2BOokBZBUA%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MCP (Model Context Protocol) æŠ€æœ¯ç†è§£ - ç¬¬ä¸€ç¯‡]]></title>    <link>https://juejin.cn/post/7604037348607082534</link>    <guid>https://juejin.cn/post/7604037348607082534</guid>    <pubDate>2026-02-08T10:07:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604037348607082534" data-draft-id="7593171168259571721" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MCP (Model Context Protocol) æŠ€æœ¯ç†è§£ - ç¬¬ä¸€ç¯‡"/> <meta itemprop="keywords" content="åç«¯,AIGC,MCP"/> <meta itemprop="datePublished" content="2026-02-08T10:07:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æƒ³ç”¨offeræ‰“ç‰Œ"/> <meta itemprop="url" content="https://juejin.cn/user/578781641968972"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MCP (Model Context Protocol) æŠ€æœ¯ç†è§£ - ç¬¬ä¸€ç¯‡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/578781641968972/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æƒ³ç”¨offeræ‰“ç‰Œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T10:07:19.000Z" title="Sun Feb 08 2026 10:07:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.8;font-weight:400;font-size:16px;word-spacing:2px;letter-spacing:2px;overflow-x:hidden;color:#3e3e3e;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:1.2em;border-bottom:2px solid #ef7060;word-spacing:0!important;letter-spacing:0!important;font-size:inherit;line-height:inherit;display:block;font-weight:400;background:#ef7060;color:#fff;padding:10px;border-top-right-radius:3px;border-top-left-radius:3px;margin-right:3px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="monokai">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#272822;color:#ddd}.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-strong,.hljs-tag{color:#f92672}.hljs-code{color:#66d9ef}.hljs-class .hljs-title{color:#fff}.hljs-attribute,.hljs-link,.hljs-regexp,.hljs-symbol{color:#bf79db}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-emphasis,.hljs-section,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-string,.hljs-subst,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:#a6e22e}.hljs-comment,.hljs-deletion,.hljs-meta,.hljs-quote{color:#75715e}.hljs-doctag,.hljs-keyword,.hljs-literal,.hljs-section,.hljs-selector-id,.hljs-selector-tag,.hljs-title,.hljs-type{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<p>æˆ‘ä¸€ç›´ä¸ºç½‘ä¸Šæ²¡æœ‰å¾ˆå¥½ä¸”é€šä¿—æ˜“æ‡‚çš„MCPæŠ€æœ¯æ–‡æ¡£è€Œçƒ¦æ¼ï¼Œæ‰€ä»¥æˆ‘é€šè¿‡è®°å½•è‡ªå·±æŸ¥é˜…å®˜æ–¹æ–‡æ¡£æ¥å†™ä¸€ä»½é€šä¿—æ˜“æ‡‚çš„MCPæŠ€æœ¯æ–‡æ¡£ï¼Œä»æ¶æ„åˆ°å®æˆ˜ï¼Œæ—¢æœ‰æŠ€æœ¯æ·±åº¦ï¼Œåˆèƒ½è®©å°ç™½ä¸€å¬å°±æ‡‚ã€‚è¿™å¯¹æˆ‘æ˜¯ä¸€ç§æŒ‘æˆ˜ï¼Œå¦‚æœç¬”è¯¯å¯ä»¥åœ¨è¯„è®ºåŒºæŒ‡å‡ºï¼Œè°¢è°¢ï¼</p>
<h2 data-id="heading-1">MCPæ˜¯ä»€ä¹ˆ</h2>
<p>Model Context Protocol (MCP) æ˜¯ Anthropic äº 2024 å¹´ 11 æœˆå‘å¸ƒçš„<strong>å¼€æ”¾æ ‡å‡†åè®®</strong>,æ—¨åœ¨ä¸º LLM åº”ç”¨æä¾›ç»Ÿä¸€çš„æ–¹å¼æ¥è¿æ¥å¤–éƒ¨æ•°æ®æºå’Œå·¥å…·ã€‚å®ƒè¢«ç§°ä¸º"AI çš„ type-cæ¥å£"ã€‚</p>
<p>ä½†æ˜¯æˆ‘è§‰å¾—å¦‚æœå°±å°†å®ƒæ¯”å–»æˆtype-cæ¥å£ï¼Œæˆ‘è§‰å¾—å¤ªè‰ç‡ã€‚</p>
<p>æˆ‘ä»¬å…ˆæ ‡å‡ºé‡ç‚¹ï¼Œ<strong>MCPå®ƒæ˜¯ä¸€ç§åè®®ï¼Œä¸€ç§æ ‡å‡†ï¼</strong> MCPæ˜¯ä¸€ç§åè®®ï¼ŒMCPæ˜¯ä¸€ç§åè®®ï¼ŒMCPæ˜¯ä¸€ç§åè®®ï¼Œé‡è¦çš„äº‹æƒ…è¯´ä¸‰éã€‚</p>
<p>é‚£ä¹ˆå®ƒåˆ°åº•æ˜¯å¹²äº†ä»€ä¹ˆï¼Ÿè¿™é‡Œç›´æ¥é€šä¿—æ˜“æ‡‚æ¥è¯´å§ï¼Œ<strong>å‡å¦‚è¯´LLMæ˜¯å¤§è„‘ï¼Œé‚£ä¹ˆLLMå¯ä»¥é€šè¿‡MCPåè®®é•¿å‡ºæ‰‹è„š</strong>ï¼Œå¯ä»¥åšåˆ°è®¿é—®èµ„æºï¼Œè°ƒç”¨å·¥å…·ï¼Œé¢„åˆ¶æ¨¡æ¿çš„äº‹æƒ…ç­‰ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Ÿåœ¨å¤æ—©æ—¶æœŸï¼Œä¹Ÿå°±æ˜¯Chat-GPTæ¨ªç©ºå‡ºä¸–çš„æ—¶å€™ï¼Œä»–ä¹Ÿå°±æ˜¯ä¸€ä¸ªç®€å•çš„chatbotï¼Œé ç€ä»¥å¾€çš„çŸ¥è¯†åº“å›ç­”é—®é¢˜ï¼Œè€Œä¸èƒ½å®æ—¶å»è®¿é—®webä¸Šçš„èµ„æºå’Œä½ è‡ªå·±çš„çŸ¥è¯†åº“ï¼Œä¹Ÿä¸èƒ½å»å¸®ä½ å‘é‚®ä»¶ï¼Œè®¢èˆªç­ç­‰ç­‰ã€‚æœ‰äº†MCPï¼Œæˆ‘ä»¬å°±æœ‰äº†ä¸€ç§æ ‡å‡†å»åšè¿™äº›äº‹ã€‚æˆ‘ä»¬åªè¦å»å®ç°äº†æ ‡å‡†MCPçš„æ¥å£ï¼Œæ•°æ®å‘é€å’Œæ¥æ”¶éƒ½æ˜¯è§£æç›¸åŒæ ¼å¼çš„æ•°æ®ï¼Œé‚£ä¹ˆæŒ‰ç…§ç†è®ºæ¥è¯´ï¼Œæˆ‘ä»¬å°±èƒ½è®©AIåº”ç”¨å¸®æˆ‘ä»¬åšä»»ä½•äº‹æƒ…(å½“å‰ä¸è®¨è®ºç‰©ç†ä¸–ç•Œçš„åŠ³åŠ¨)ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7de8c446fe4c4e9f8572ca5b9ca4a1c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oOz55Sob2ZmZXLmiZPniYw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771150068&amp;x-signature=FS2HAhCeUY3J0dcLOin0YMVC5Z8%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">MCPåˆ°åº•è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h2>
<p>æˆ‘ä»¬ä¸Šé¢è®¨è®ºäº†MCPèƒ½å¸®æˆ‘ä»¬å®ç°çš„äº‹æƒ…ï¼Œé‚£ä¹ˆMCPå®ƒæœ¬è´¨ä¸Šåˆ°åº•è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿéš¾é“æˆ‘ä»¬ä»¥å‰æ²¡æœ‰MCPå°±æ— æ³•æŸ¥çœ‹webä¸Šé¢çš„èµ„æºæˆ–è€…çŸ¥è¯†åº“å—ï¼Ÿè®©æˆ‘ä»¬ä¸‹é¢ä¸€èµ·è®¨è®ºä¸€ä¸‹ã€‚</p>
<p>ä¼ ç»Ÿä¸Šï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯å¯ä»¥å®ç°MCPçš„åŠŸèƒ½ï¼Œä½†æ˜¯è¿™æ ·æœ‰ä¸ªé—®é¢˜ï¼Œæ¯ä¸ªä¼ä¸šæ‰€åˆ›é€ å‡ºæ¥çš„è½¯ä»¶æˆ–è€…è¯´åº”ç”¨ç¨‹åºï¼Œå®ƒéƒ½ä¸æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£æ¥è¿›è¡Œtool callingçš„ï¼Œéƒ½æ˜¯<strong>è‡ªæˆä¸€æ´¾</strong>ã€‚è¿™æ ·å°±ä¼šå¯¼è‡´é›†æˆéå¸¸ç¹æ‚ã€‚</p>
<p>ä¸Šä»£ç æ¥è§£é‡Šä¸€ä¸‹è¿™ç§ç°è±¡ï¼Ÿ</p>
<p><strong>ä¼ ç»Ÿæ–¹å¼çš„ç—›ç‚¹:</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ¯ä¸ªé›†æˆéƒ½éœ€è¦è‡ªå®šä¹‰ä»£ç </span>
<span class="hljs-keyword">if</span> service == <span class="hljs-string">"github"</span>:
    github_client = GitHubClient(token)
    data = github_client.get_issues()
<span class="hljs-keyword">elif</span> service == <span class="hljs-string">"slack"</span>:
    slack_client = SlackClient(token)
    data = slack_client.get_messages()
<span class="hljs-keyword">elif</span> service == <span class="hljs-string">"database"</span>:
    db_client = DatabaseClient(connection_string)
    data = db_client.query(<span class="hljs-string">"SELECT * FROM users"</span>)
<span class="hljs-comment"># ... æ¯ä¸ªæœåŠ¡éƒ½ä¸åŒ</span>
</code></pre>
<p><strong>ä½¿ç”¨MCPç»Ÿä¸€äº†ä¹‹åï¼š</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç»Ÿä¸€æ¥å£,æ ‡å‡†åŒ–åè®®</span>
mcp_client = McpClient()

<span class="hljs-comment"># æ‰€æœ‰æœåŠ¡ä½¿ç”¨ç›¸åŒçš„åè®®</span>
resources = mcp_client.list_resources()  <span class="hljs-comment"># è·å–å¯ç”¨èµ„æº</span>
tools = mcp_client.list_tools()          <span class="hljs-comment"># è·å–å¯ç”¨å·¥å…·</span>
result = mcp_client.call_tool(<span class="hljs-string">"search"</span>, args)  <span class="hljs-comment"># è°ƒç”¨å·¥å…·</span>
</code></pre>
<p><strong>è¿™é‡Œæˆ‘ä»¬å¼ºè°ƒä¸€ä¸‹MCPçš„ä¸‰å¤§æ ¸å¿ƒèƒ½åŠ›å§</strong>ï¼Œåˆ†åˆ«æ˜¯<strong>è®¿é—®èµ„æºï¼Œè°ƒç”¨å·¥å…·ï¼Œé¢„åˆ¶æ¨¡æ¿</strong>ï¼Œä¸‹é¢çš„è¡¨æ ¼è§£é‡Šäº†å®ƒå„è‡ªçš„ç‰¹ç‚¹ä¸ä½œç”¨</p>





























<table><thead><tr><th>èƒ½åŠ›</th><th>è¯´æ˜</th><th>æ§åˆ¶æ–¹</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><strong>Resources</strong></td><td>åªè¯»æ•°æ®æº</td><td>Application</td><td>æ–‡ä»¶å†…å®¹ã€æ•°æ®åº“è®°å½•ã€API å“åº”</td></tr><tr><td><strong>Tools</strong></td><td>å¯æ‰§è¡Œå‡½æ•°</td><td>Model</td><td>æœç´¢èˆªç­ã€å‘é€æ¶ˆæ¯ã€åˆ›å»ºæ—¥å†äº‹ä»¶</td></tr><tr><td><strong>Prompts</strong></td><td>é¢„åˆ¶æ¨¡æ¿</td><td>User</td><td>è®¡åˆ’æ—…è¡Œã€æ€»ç»“ä¼šè®®ã€èµ·è‰é‚®ä»¶</td></tr></tbody></table>
<p>ç†è§£ä¸‰å¤§èƒ½åŠ›æ˜¯éå¸¸é‡è¦çš„ï¼Œå…³ä¹MCPçš„å¼€å‘èƒ½åŠ›ã€‚</p>
<h2 data-id="heading-3">MCPçš„æ¶æ„</h2>
<p>ç°åœ¨æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹MCPçš„æ¶æ„æ˜¯æ€ä¹ˆæ ·çš„ã€‚</p>
<p>MCP é‡‡ç”¨å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„ï¼Œå…¶ä¸­ MCP ä¸»æœºï¼ˆä¾‹å¦‚Claude Codeæˆ–Claude Desktopç­‰ AI åº”ç”¨ï¼‰ä¸ä¸€ä¸ªæˆ–å¤šä¸ª MCP æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚MCP ä¸»æœºé€šè¿‡ä¸ºæ¯ä¸ª MCP æœåŠ¡å™¨åˆ›å»ºä¸€ä¸ª MCP å®¢æˆ·ç«¯æ¥å®ç°è¿™ä¸€ç‚¹ã€‚æ¯ä¸ª MCP å®¢æˆ·ç«¯ä¸å…¶å¯¹åº”çš„ MCP æœåŠ¡å™¨ä¿æŒä¸“ç”¨è¿æ¥ã€‚ä½¿ç”¨ STDIO ä¼ è¾“çš„æœ¬åœ° MCP æœåŠ¡å™¨é€šå¸¸æœåŠ¡äºå•ä¸ª MCP å®¢æˆ·ç«¯ï¼Œè€Œä½¿ç”¨ Streamable HTTP ä¼ è¾“çš„è¿œç¨‹ MCP æœåŠ¡å™¨é€šå¸¸æœåŠ¡äºå¤šä¸ª MCP å®¢æˆ·ç«¯ã€‚MCPæ¶æ„çš„å…³é”®å‚ä¸è€…åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>MCP ä¸»æœº</strong>ï¼šç”¨äºåè°ƒå’Œç®¡ç†ä¸€ä¸ªæˆ–å¤šä¸ª MCP å®¢æˆ·ç«¯çš„ AI åº”ç”¨ç¨‹åº</li>
<li><strong>MCP å®¢æˆ·ç«¯</strong>ï¼šä¸€ä¸ªç»´æŠ¤ä¸ MCP æœåŠ¡å™¨è¿æ¥å¹¶ä» MCP æœåŠ¡å™¨è·å–ä¸Šä¸‹æ–‡ä»¥ä¾› MCP ä¸»æœºä½¿ç”¨çš„ç»„ä»¶ã€‚</li>
<li><strong>MCP æœåŠ¡å™¨</strong>ï¼šä¸€ä¸ªä¸º MCP å®¢æˆ·ç«¯æä¾›ä¸Šä¸‹æ–‡ä¿¡æ¯çš„ç¨‹åº</li>
</ul>
<p>è¿™é‡Œå¼•ç”¨å®˜æ–¹æ–‡æ¡£çš„ä¾‹å­ï¼š</p>
<p><strong>ä¾‹å¦‚</strong>ï¼šVisual Studio Code å……å½“ MCP ä¸»æœºã€‚å½“ Visual Studio Code ä¸ MCP æœåŠ¡å™¨ï¼ˆä¾‹å¦‚Sentry MCP æœåŠ¡å™¨ï¼‰å»ºç«‹è¿æ¥æ—¶ï¼ŒVisual Studio Code è¿è¡Œæ—¶ä¼šå®ä¾‹åŒ–ä¸€ä¸ª MCP å®¢æˆ·ç«¯å¯¹è±¡æ¥ç»´æŠ¤ä¸ Sentry MCP æœåŠ¡å™¨çš„è¿æ¥ã€‚éšåï¼Œå½“ Visual Studio Code è¿æ¥åˆ°å¦ä¸€ä¸ª MCP æœåŠ¡å™¨ï¼ˆä¾‹å¦‚æœ¬åœ°æ–‡ä»¶ç³»ç»ŸæœåŠ¡å™¨ï¼‰æ—¶ï¼ŒVisual Studio Code è¿è¡Œæ—¶ä¼šå®ä¾‹åŒ–å¦ä¸€ä¸ª MCP å®¢æˆ·ç«¯å¯¹è±¡æ¥ç»´æŠ¤æ­¤è¿æ¥ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1175bce98b984503942606e4f14729ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oOz55Sob2ZmZXLmiZPniYw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771150068&amp;x-signature=TzpnLzD1wWltwmNdRfZ0IFUK5J0%3D" alt="image.png" loading="lazy"/></p>
<p>è¯·æ³¨æ„ï¼Œ<strong>MCP æœåŠ¡å™¨</strong>æŒ‡çš„æ˜¯æä¾›ä¸Šä¸‹æ–‡æ•°æ®çš„ç¨‹åºï¼Œæ— è®ºå…¶è¿è¡Œä½ç½®å¦‚ä½•ã€‚MCP æœåŠ¡å™¨å¯ä»¥æœ¬åœ°è¿è¡Œï¼Œä¹Ÿå¯ä»¥è¿œç¨‹è¿è¡Œã€‚ä¾‹å¦‚ï¼Œå½“ Claude Desktop å¯åŠ¨æ–‡ä»¶ç³»ç»ŸæœåŠ¡å™¨æ—¶ï¼Œç”±äºå®ƒä½¿ç”¨ STDIO ä¼ è¾“ï¼Œå› æ­¤æœåŠ¡å™¨è¿è¡Œåœ¨åŒä¸€å°æœºå™¨ä¸Šã€‚è¿™é€šå¸¸è¢«ç§°ä¸ºâ€œæœ¬åœ°â€MCP æœåŠ¡å™¨ã€‚å®˜æ–¹çš„Â Sentry MCP æœåŠ¡å™¨è¿è¡Œåœ¨ Sentry å¹³å°ä¸Šï¼Œå¹¶ä½¿ç”¨ Streamable HTTP ä¼ è¾“ã€‚è¿™é€šå¸¸è¢«ç§°ä¸ºâ€œè¿œç¨‹â€MCP æœåŠ¡å™¨ã€‚</p>
<h2 data-id="heading-4">å°ç»“</h2>
<p>ç¬¬ä¸€ç¯‡æˆ‘ä»¬å°±å…ˆè§£æMCPçš„æ¦‚å¿µï¼Œè§£å†³çš„é—®é¢˜ï¼Œè¿˜æœ‰æ¶æ„ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­è§£æé€šä¿¡åè®®å’Œæ•°æ®æ ¼å¼ç­‰ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å…³æ³¨æ­¤æ ç›®</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[shadcn/uiï¼Œç»™ä½ ä¸€ä¸ªçœŸæ­£å¯æ§çš„UIç»„ä»¶åº“]]></title>    <link>https://juejin.cn/post/7604093823959285779</link>    <guid>https://juejin.cn/post/7604093823959285779</guid>    <pubDate>2026-02-09T07:49:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604093823959285779" data-draft-id="7604433863725203510" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="shadcn/uiï¼Œç»™ä½ ä¸€ä¸ªçœŸæ­£å¯æ§çš„UIç»„ä»¶åº“"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-09T07:49:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜_June"/> <meta itemprop="url" content="https://juejin.cn/user/395479916219517"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            shadcn/uiï¼Œç»™ä½ ä¸€ä¸ªçœŸæ­£å¯æ§çš„UIç»„ä»¶åº“
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/395479916219517/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜_June
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T07:49:45.000Z" title="Mon Feb 09 2026 07:49:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>å½“â€œä»£ç æ‰€æœ‰æƒâ€æˆä¸ºä¸€ç§å¥¢ä¾ˆï¼Œshadcn/ui å´æŠŠæ¯ä¸€è¡Œç»„ä»¶æºç éƒ½äº¤åˆ°ä½ æ‰‹ä¸­ã€‚</p>
</blockquote>
<p>ä½ æœ‰æ²¡æœ‰é‡åˆ°è¿‡è¿™ç§æƒ…å†µï¼šè®¾è®¡å¸ˆæ‹¿ç€ç•Œé¢ç¨¿è¯´ï¼šâ€œè¿™ä¸ªæŒ‰é’®ï¼Œåœ†è§’å†å¤§ç‚¹ï¼Œé˜´å½±å†æŸ”å’Œç‚¹ã€‚â€ä½ ç‚¹å¤´ç­”åº”ï¼Œå›å¤´é¢å¯¹ä»£ç ï¼Œå´è¦ç¿»æ–‡æ¡£ã€æŸ¥æ–¹æ¡ˆã€å°å¿ƒç¿¼ç¿¼åœ°å†™è¦†ç›–æ ·å¼ï¼Œåªä¸ºæ”¹ä¸€ä¸ªæŒ‰é’®çš„å¤–è§‚ã€‚</p>
<p>ç›´åˆ° <strong>shadcn/ui</strong> å‡ºç°ï¼Œè¿™ä¸€åˆ‡å˜äº†ã€‚è¿™ä¸ªä¸ç”¨ <code>npm install</code>ï¼Œå´è®©æ— æ•° React å¼€å‘è€…ç€è¿·çš„é¡¹ç›®ï¼Œæ­£åœ¨ç”¨å…¨æ–°çš„æ–¹å¼å®šä¹‰æˆ‘ä»¬å†™ç•Œé¢çš„ä½“éªŒã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€ç‹¬ç‰¹å“²å­¦ï¼šæŠŠæºç äº¤ç»™ä½ ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªâ€œé»‘ç®±â€</h2>
<p><strong>ä¼ ç»ŸUIåº“</strong>ï¼ˆå¦‚Ant Designã€MUIï¼‰çš„è¿ä½œæ–¹å¼åƒä¸€ä¸ªâ€œé»‘ç®±â€ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä½ å®‰è£…çš„æ˜¯ä¸€ä¸ªå‹ç¼©çš„åŒ…</span>
npm install @mui/material

<span class="hljs-comment">// ä½¿ç”¨å®ƒï¼Œä½†æ— æ³•è½»æ˜“ä¿®æ”¹å®ƒ</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Button</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@mui/material'</span>;
</code></pre>
<p><strong>shadcn/ui</strong> åˆ™é‡‡ç”¨äº†ä¸€ç§é©å‘½æ€§çš„æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¸æ˜¯å®‰è£…åŒ…ï¼Œè€Œæ˜¯å¤åˆ¶æºç </span>
npx shadcn-ui@latest add button

<span class="hljs-comment"># ç»“æœï¼šå®Œæ•´çš„button.tsxæ–‡ä»¶å‡ºç°åœ¨ä½ çš„é¡¹ç›®ä¸­</span>
<span class="hljs-comment"># src/components/ui/button.tsx</span>
</code></pre>
<p><strong>è¿™ç§å·®å¼‚æ„å‘³ç€ä»€ä¹ˆï¼Ÿ</strong> å½“ç»„ä»¶ä»£ç å°±åœ¨ä½ çš„<code>components/ui</code>ç›®å½•ä¸‹æ—¶ï¼Œä½ å¯ä»¥ï¼š</p>
<ul>
<li><strong>ç›´æ¥ä¿®æ”¹ä»»ä½•æ ·å¼ç»†èŠ‚</strong></li>
<li><strong>è°ƒæ•´ç»„ä»¶çš„å†…éƒ¨é€»è¾‘</strong></li>
<li><strong>æŸ¥çœ‹å®Œæ•´çš„å®ç°ï¼Œæ²¡æœ‰éšè—çš„â€œé­”æ³•â€</strong></li>
<li><strong>æ‹¥æœ‰100%çš„ä»£ç æ‰€æœ‰æƒ</strong></li>
</ul>
<h2 data-id="heading-1">äºŒã€æ ¸å¿ƒä¼˜åŠ¿ï¼šä¸ºä»€ä¹ˆå¼€å‘è€…çˆ±ä¸é‡Šæ‰‹ï¼Ÿ</h2>
<h3 data-id="heading-2">1. æè‡´çš„å®šåˆ¶è‡ªç”±</h3>
<p>æƒ³è±¡ä¸€ä¸‹ï¼šäº§å“ç»ç†è¦æ±‚æŠŠæŒ‰é’®çš„æ‚¬åœæ•ˆæœæ”¹æˆæ¸å˜è‰²ã€‚ä¼ ç»Ÿæ–¹å¼å¯èƒ½éœ€è¦æŸ¥æ‰¾ä¸»é¢˜è¦†ç›–æ–‡æ¡£ã€ç¼–å†™è‡ªå®šä¹‰CSSã€æ‹…å¿ƒæ ·å¼å†²çªã€‚è€Œ<strong>ä½¿ç”¨shadcn/uiï¼Œä½ åªéœ€è¦ï¼š</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ç›´æ¥æ‰“å¼€ button.tsx ä¿®æ”¹</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Button</span> = <span class="hljs-title class_">React</span>.<span class="hljs-property">forwardRef</span>&lt;<span class="hljs-title class_">HTMLButtonElement</span>, <span class="hljs-title class_">ButtonProps</span>&gt;(
  <span class="hljs-function">(<span class="hljs-params">{ className, variant = <span class="hljs-string">"default"</span>, size = <span class="hljs-string">"default"</span>, ...props }, ref</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span>
        <span class="hljs-attr">className</span>=<span class="hljs-string">{cn(</span>
          <span class="hljs-attr">buttonVariants</span>({ <span class="hljs-attr">variant</span>, <span class="hljs-attr">size</span>, <span class="hljs-attr">className</span> }),
          // <span class="hljs-attr">ç›´æ¥åœ¨è¿™é‡Œæ·»åŠ ä½ çš„æ¸å˜æ•ˆæœ</span>
          "<span class="hljs-attr">hover:bg-gradient-to-r</span> <span class="hljs-attr">hover:from-blue-500</span> <span class="hljs-attr">hover:to-purple-600</span>"
        )}
        <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref}</span>
        {<span class="hljs-attr">...props</span>}
      /&gt;</span></span>
    )
  }
)
</code></pre>
<h3 data-id="heading-3">2. AIç¼–ç¨‹çš„æœ€ä½³æ­æ¡£</h3>
<p>åœ¨AIç¼–ç åŠ©æ‰‹æ™®åŠçš„ä»Šå¤©ï¼Œshadcn/uiçš„è®¾è®¡ç†å¿µæ˜¾å¾—å°¤ä¸ºå‰ç»ï¼š</p>
<ul>
<li><strong>ä¼ ç»Ÿç»„ä»¶åº“çš„é—®é¢˜</strong>ï¼šAIæ— æ³•â€œçœ‹åˆ°â€<code>node_modules</code>ä¸­çš„ç»„ä»¶å®ç°ï¼Œåªèƒ½åŸºäºæœ‰é™çš„æ–‡æ¡£ç»™å‡ºå»ºè®®ã€‚</li>
<li><strong>shadcn/uiçš„ä¼˜åŠ¿</strong>ï¼šAIå¯ä»¥<strong>ç›´æ¥é˜…è¯»ã€ç†è§£å’Œä¿®æ”¹</strong>ä½ é¡¹ç›®ä¸­çš„ç»„ä»¶æºç ã€‚ä½ å¯ä»¥ç›´æ¥è¯´ï¼šâ€œå¸®æˆ‘æŠŠè¿™ä¸ªå¯¹è¯æ¡†çš„åŠ¨ç”»æ—¶é—´ä»300msæ”¹ä¸º200msâ€ï¼ŒAIä¼šç²¾å‡†åœ°æ‰¾åˆ°å¹¶ä¿®æ”¹å¯¹åº”çš„ä»£ç è¡Œã€‚</li>
</ul>
<h3 data-id="heading-4">3. æŒ‰éœ€å¼•å…¥ï¼Œæè‡´è½»é‡</h3>
<p>ä¼ ç»ŸUIåº“å¸¸å¸¸æœ‰â€œå…¨é‡å¼•å…¥â€çš„é—®é¢˜ï¼Œå³ä½¿ä½ åªç”¨äº†ä¸€ä¸ªæŒ‰é’®ï¼Œä¹Ÿå¯èƒ½æ‰“åŒ…è¿›æ•´ä¸ªåº“çš„åŸºç¡€æ ·å¼ã€‚</p>
<p><strong>shadcn/uiçš„è§£å†³æ–¹æ¡ˆ</strong>ï¼šåªæ·»åŠ ä½ çœŸæ­£éœ€è¦çš„ç»„ä»¶ã€‚æ¯ä¸ªç»„ä»¶éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œæ²¡æœ‰éšè—çš„ä¾èµ–ã€‚</p>

























<table><thead><tr><th align="left">ç»„ä»¶</th><th align="left">æ–‡ä»¶å¤§å°</th><th align="left">ä¾èµ–å…³ç³»</th></tr></thead><tbody><tr><td align="left">Button</td><td align="left">~5KB</td><td align="left">é›¶è¿è¡Œæ—¶ä¾èµ–</td></tr><tr><td align="left">Dialog</td><td align="left">~8KB</td><td align="left">ä»…ä¾èµ–Radix UI</td></tr><tr><td align="left">Data Table</td><td align="left">~15KB</td><td align="left">ä¾èµ–TanStack Table</td></tr></tbody></table>
<h2 data-id="heading-5">ä¸‰ã€æŠ€æœ¯æ¶æ„ï¼šç°ä»£å‰ç«¯æŠ€æœ¯æ ˆçš„é›†å¤§æˆè€…</h2>
<ul>
<li><strong>åŸºäº Radix UI çš„æ— éšœç¢åŸºç¡€</strong>ï¼šæ‰€æœ‰äº¤äº’ç»„ä»¶ï¼ˆå¦‚å¯¹è¯æ¡†ã€ä¸‹æ‹‰èœå•ï¼‰éƒ½åŸºäº Radix UI æ„å»ºï¼Œæä¾›å¼€ç®±å³ç”¨çš„é”®ç›˜å¯¼èˆªã€å®Œæ•´çš„å±å¹•é˜…è¯»å™¨å…¼å®¹æ€§ï¼Œå¹¶éµå¾ªWAI-ARIAæ ‡å‡†ã€‚</li>
<li><strong>æ·±åº¦é›†æˆ Tailwind CSS</strong>ï¼šæ ·å¼ç³»ç»Ÿå®Œå…¨åŸºäºTailwind CSSï¼Œä¿è¯äº†è®¾è®¡çš„ä¸€è‡´æ€§ã€å¯ç»´æŠ¤æ€§ï¼Œå¹¶æå‡äº†å¼€å‘æ•ˆç‡ã€‚</li>
<li><strong>TypeScript ä¼˜å…ˆ</strong>ï¼šæ‰€æœ‰ç»„ä»¶éƒ½ä½¿ç”¨TypeScriptç¼–å†™ï¼Œæä¾›å®Œæ•´çš„ç±»å‹å®‰å…¨ã€æ™ºèƒ½çš„IDEè‡ªåŠ¨è¡¥å…¨å’Œè‡ªæ–‡æ¡£åŒ–çš„Propsæ¥å£ã€‚</li>
</ul>
<h2 data-id="heading-6">å››ã€å®æˆ˜æŒ‡å—ï¼šäº”åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹</h2>
<h3 data-id="heading-7">ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºé¡¹ç›®</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨Next.jsï¼ˆæ¨èï¼‰</span>
npx create-next-app@latest my-app --typescript --tailwind --app
<span class="hljs-built_in">cd</span> my-app
</code></pre>
<h3 data-id="heading-8">ç¬¬äºŒæ­¥ï¼šåˆå§‹åŒ– shadcn/ui</h3>
<pre><code class="hljs language-bash" lang="bash">npx shadcn-ui@latest init
</code></pre>
<p>CLIä¼šå¼•å¯¼ä½ å®Œæˆé…ç½®ï¼šé€‰æ‹©æ ·å¼ç³»ç»Ÿã€é…ç½®ä¸»é¢˜é¢œè‰²ã€è®¾ç½®ç»„ä»¶ç›®å½•ä½ç½®ã€‚</p>
<h3 data-id="heading-9">ç¬¬ä¸‰æ­¥ï¼šæ·»åŠ ä½ çš„ç¬¬ä¸€ä¸ªç»„ä»¶</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ·»åŠ ä¸€ä¸ªæŒ‰é’®</span>
npx shadcn-ui@latest add button
<span class="hljs-comment"># æ·»åŠ ä¸€ä¸ªå¡ç‰‡</span>
npx shadcn-ui@latest add card
<span class="hljs-comment"># æ·»åŠ ä¸€ä¸ªå¯¹è¯æ¡†</span>
npx shadcn-ui@latest add dialog
</code></pre>
<h3 data-id="heading-10">ç¬¬å››æ­¥ï¼šç«‹å³ä½¿ç”¨</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// åœ¨app/page.tsxä¸­</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Button</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/components/ui/button"</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"p-8"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">"default"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"lg"</span>&gt;</span>
        è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ä¸ªshadcn/uiæŒ‰é’®
      <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<h2 data-id="heading-11">äº”ã€è€ƒè™‘ä¸æƒè¡¡ï¼šå®ƒé€‚åˆä½ çš„é¡¹ç›®å—ï¼Ÿ</h2>
<h3 data-id="heading-12">é€‚åˆçš„åœºæ™¯ï¼š</h3>
<ul>
<li>éœ€è¦<strong>é«˜åº¦å®šåˆ¶UI</strong>çš„å“ç‰Œåº”ç”¨</li>
<li><strong>é•¿æœŸç»´æŠ¤</strong>çš„å¤§å‹é¡¹ç›®</li>
<li>å¯¹<strong>æ— éšœç¢è®¿é—®</strong>æœ‰è¦æ±‚çš„äº§å“</li>
<li>ä½¿ç”¨<strong>AIç¼–ç¨‹åŠ©æ‰‹</strong>çš„å¼€å‘å›¢é˜Ÿ</li>
<li>è¿½æ±‚<strong>æè‡´æ€§èƒ½</strong>å’ŒåŒ…ä½“ç§¯ä¼˜åŒ–çš„åº”ç”¨</li>
</ul>
<h3 data-id="heading-13">éœ€è¦è€ƒè™‘çš„ç‚¹ï¼š</h3>
<ul>
<li><strong>æ›´æ–°ç»´æŠ¤</strong>ï¼šå½“å®˜æ–¹å‘å¸ƒæ›´æ–°æ—¶ï¼Œä½ éœ€è¦æ‰‹åŠ¨åˆå¹¶åˆ°é¡¹ç›®ä¸­</li>
<li><strong>è®¾è®¡è´£ä»»</strong>ï¼šæ›´å¤šçš„è‡ªç”±ä¹Ÿæ„å‘³ç€æ›´å¤šçš„è®¾è®¡å†³ç­–</li>
<li><strong>å›¢é˜Ÿå­¦ä¹ </strong>ï¼šéœ€è¦ç†Ÿæ‚‰TypeScriptå’ŒTailwind CSS</li>
</ul>
<h3 data-id="heading-14">ä¸ä¼ ç»ŸUIåº“çš„å¯¹æ¯”ï¼š</h3>



































<table><thead><tr><th align="left">ç‰¹æ€§</th><th align="left">ä¼ ç»ŸUIåº“ (å¦‚MUI)</th><th align="left">shadcn/ui</th></tr></thead><tbody><tr><td align="left"><strong>ä»£ç æ‰€æœ‰æƒ</strong></td><td align="left">ä½¿ç”¨æ–¹ï¼Œä¸å¯ä¿®æ”¹æºç </td><td align="left">å®Œå…¨æ‹¥æœ‰ï¼Œå¯ä»»æ„ä¿®æ”¹</td></tr><tr><td align="left"><strong>å®šåˆ¶æ–¹å¼</strong></td><td align="left">é€šè¿‡ä¸»é¢˜é…ç½®å’ŒCSSè¦†ç›–</td><td align="left">ç›´æ¥ä¿®æ”¹ç»„ä»¶æºç </td></tr><tr><td align="left"><strong>åŒ…å¤§å°</strong></td><td align="left">é€šå¸¸è¾ƒå¤§ï¼ˆå³ä½¿æŒ‰éœ€å¯¼å…¥ï¼‰</td><td align="left">åªåŒ…å«å®é™…ä½¿ç”¨çš„ç»„ä»¶</td></tr><tr><td align="left"><strong>å­¦ä¹ æ›²çº¿</strong></td><td align="left">å­¦ä¹ åº“ç‰¹å®šçš„APIå’Œä¸»é¢˜ç³»ç»Ÿ</td><td align="left">å­¦ä¹ å®é™…çš„React/Tailwindä»£ç </td></tr><tr><td align="left"><strong>AIå‹å¥½åº¦</strong></td><td align="left">è¾ƒå·®ï¼ˆAIçœ‹ä¸åˆ°å®ç°ï¼‰</td><td align="left">æä½³ï¼ˆAIå¯ç›´æ¥æ“ä½œæºç ï¼‰</td></tr></tbody></table>
<h2 data-id="heading-15">ä¸ƒã€ç¤¾åŒºç”Ÿæ€ï¼šä¸åªæ˜¯React</h2>
<p>è™½ç„¶æœ€å‡ºåçš„æ˜¯Reactç‰ˆæœ¬ï¼Œä½†shadcn/uiçš„ç†å¿µå·²ç»æ‰©å±•åˆ°å…¶ä»–æ¡†æ¶ã€‚ç¤¾åŒºç»´æŠ¤äº†  Vue 3ç‰ˆæœ¬ (shadcn-vue)ï¼Œæä¾›ç›¸ä¼¼çš„å¼€å‘ä½“éªŒã€‚åŒæ—¶ï¼Œç¤¾åŒºä¹Ÿè´¡çŒ®äº†å¤šç§å¼€ç®±å³ç”¨çš„æ¨¡æ¿ï¼Œå¦‚ä»ªè¡¨ç›˜æ¨¡æ¿ã€ç™»å½•/æ³¨å†Œé¡µé¢ã€ç”µå•†ç»„ä»¶ç­‰ã€‚</p>
<hr/>
<h2 data-id="heading-16">å†™åœ¨æœ€å</h2>
<p>shadcn/ui çš„å‡ºç°ï¼Œå›åº”äº†å‰ç«¯å¼€å‘ä¸­ä¸€ä¸ªé•¿æœŸè¢«å¿½è§†çš„éœ€æ±‚ï¼š<strong>å¼€å‘è€…å¯¹UIç»„ä»¶çš„å®Œå…¨æ§åˆ¶æƒ</strong>ã€‚å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªå·¥å…·é›†åˆï¼Œæ›´æ˜¯ä¸€ç§å¼€å‘å“²å­¦çš„ä½“ç°â€”â€”ç›¸ä¿¡å¼€å‘è€…æœ‰èƒ½åŠ›ã€ä¹Ÿåº”è¯¥æœ‰æƒåˆ©ç›´æ¥æ§åˆ¶ä»–ä»¬æ‰€ä½¿ç”¨çš„æ¯ä¸€ä¸ªç»„ä»¶ã€‚</p>
<p>æ¯•ç«Ÿï¼Œåœ¨è¿™ä¸ªå¼ºè°ƒâ€œå¼€å‘è€…ä½“éªŒâ€çš„æ—¶ä»£ï¼Œè¿˜æœ‰ä»€ä¹ˆæ¯”â€œè¿™ä»£ç å®Œå…¨å±äºæˆ‘â€æ›´å¥½çš„ä½“éªŒå‘¢ï¼Ÿ</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯éƒ½èƒ½çœ‹æ‡‚çš„Rustå…¥é—¨æ•™ç¨‹ï¼ˆä¸‰ï¼‰â€”â€”æ§åˆ¶æµè¯­å¥]]></title>    <link>https://juejin.cn/post/7604301929120759817</link>    <guid>https://juejin.cn/post/7604301929120759817</guid>    <pubDate>2026-02-09T07:53:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604301929120759817" data-draft-id="7603160727717216307" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯éƒ½èƒ½çœ‹æ‡‚çš„Rustå…¥é—¨æ•™ç¨‹ï¼ˆä¸‰ï¼‰â€”â€”æ§åˆ¶æµè¯­å¥"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,Rust"/> <meta itemprop="datePublished" content="2026-02-09T07:53:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¸ƒåˆ—ç‘Ÿå†œçš„æ˜Ÿç©º"/> <meta itemprop="url" content="https://juejin.cn/user/976022056218471"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯éƒ½èƒ½çœ‹æ‡‚çš„Rustå…¥é—¨æ•™ç¨‹ï¼ˆä¸‰ï¼‰â€”â€”æ§åˆ¶æµè¯­å¥
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/976022056218471/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¸ƒåˆ—ç‘Ÿå†œçš„æ˜Ÿç©º
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T07:53:39.000Z" title="Mon Feb 09 2026 07:53:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ¬èŠ‚å­¦ä¹ Rustä¸­çš„æ§åˆ¶æµè¯­å¥ï¼Œä¹Ÿå°±æ˜¯å¾ªç¯/æ¡ä»¶/æ¨¡å¼åŒ¹é…ã€‚</p>
<p>Rustä¸­æ²¡æœ‰jsæˆ–javaä¸­çš„forå¾ªç¯ï¼Œæ²¡æœ‰ä¸‰ç›®è¡¨è¾¾å¼ï¼Œä¹Ÿæ²¡æœ‰switch-caseï¼Œtry-catchè¯­å¥ï¼Œè¿™ä¸€ç‚¹å¯èƒ½æ˜¯åˆšå†™Rustæœ€ä¸ä¹ æƒ¯çš„åœ°æ–¹ã€‚</p>
<h2 data-id="heading-0">if</h2>
<h3 data-id="heading-1">åŸºæœ¬ç”¨æ³•</h3>
<p>å’Œjsæˆ–javaç±»ä¼¼ï¼Œ<strong>ä½†æ˜¯æ¡ä»¶åˆ¤æ–­ä¸ç”¨åŠ æ‹¬å·</strong>â€”â€”åœ¨Rustä¸­æ‹¬å·æ˜¯å•å…ƒç±»å‹ï¼Œç”¨åœ¨ç‰¹æ®Šåœ°æ–¹ï¼Œå› æ­¤å¾ˆå¤šjsä¸­éœ€è¦åŠ æ‹¬å·çš„åœ°æ–¹ï¼ŒRustä¸­éƒ½ä¸ç”¨ã€‚</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">number</span> = <span class="hljs-number">7</span>;
<span class="hljs-keyword">if</span> number &lt; <span class="hljs-number">0</span> {
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"è´Ÿæ•°"</span>);
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> number == <span class="hljs-number">0</span> {
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"é›¶"</span>);
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> number &lt; <span class="hljs-number">10</span> {
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"ä¸€ä½æ­£æ•°"</span>);
} <span class="hljs-keyword">else</span> {
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"ä¸¤ä½æ•°æˆ–æ›´å¤§"</span>);
}
</code></pre>
<h3 data-id="heading-2">let if</h3>
<p><strong>åœ¨Rustä¸­ï¼Œè¯­å¥ï¼ˆStatementï¼‰æ˜¯æ‰§è¡Œä¸€äº›æ“ä½œä½†ä¸è¿”å›å€¼çš„æŒ‡ä»¤ï¼Œè€Œè¡¨è¾¾å¼ï¼ˆExpressionï¼‰è®¡ç®—å¹¶è¿”å›ä¸€ä¸ªå€¼ã€‚Rustä¸­å¤§éƒ¨åˆ†æ§åˆ¶æµç»“æ„éƒ½æ˜¯è¡¨è¾¾å¼ï¼Œå¯ä»¥è¿”å›å€¼ã€‚</strong> è¿™ä½¿å¾—ä»£ç æ›´ç®€æ´ï¼Œè¡¨è¾¾èƒ½åŠ›æ›´å¼ºã€‚åŒæ—¶ï¼ŒRustçš„æ¨¡å¼åŒ¹é…éå¸¸å¼ºå¤§ï¼Œå¯ä»¥å¤„ç†å„ç§å¤æ‚çš„æ•°æ®ç»“æ„ã€‚</p>
<p>è¿™é‡Œå¯ä½¿ç”¨<code>let</code>ç›´æ¥è·å–ifè¡¨è¾¾å¼çš„è¿”å›ç»“æœ</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// å¯ä»¥ä½¿ç”¨å—è¡¨è¾¾å¼</span>
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">description</span> = <span class="hljs-keyword">if</span> score &gt;= <span class="hljs-number">60</span> {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">message</span> = <span class="hljs-built_in">format!</span>(<span class="hljs-string">"åŠæ ¼ï¼Œåˆ†æ•°æ˜¯ {}"</span>, score);
    message <span class="hljs-comment">// è¿”å›å­—ç¬¦ä¸²</span>
} <span class="hljs-keyword">else</span> {
    <span class="hljs-string">"ä¸åŠæ ¼"</span>.<span class="hljs-title function_ invoke__">to_string</span>()
};
<span class="hljs-built_in">println!</span>(<span class="hljs-string">"{}"</span>, description);
</code></pre>
<h2 data-id="heading-3">å¾ªç¯</h2>
<p>Rustä¸­çš„å¾ªç¯è¯­å¥æœ‰ä¸‰ç§ï¼šloop,whileå’Œfor</p>
<h3 data-id="heading-4">loop-æ— é™å¾ªç¯</h3>
<p>loopæ˜¯æ— é™å¾ªç¯ï¼Œç”¨breakè·³å‡ºã€‚</p>
<h4 data-id="heading-5">åŸºæœ¬ç”¨æ³•</h4>
<pre><code class="hljs language-rust" lang="rust">    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">count</span> = <span class="hljs-number">0</span>;

        <span class="hljs-comment">// æ— é™å¾ªç¯</span>
        <span class="hljs-keyword">loop</span> {
            count += <span class="hljs-number">1</span>;
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"å¾ªç¯æ¬¡æ•°: {}"</span>, count);
            <span class="hljs-comment">// è·³è¿‡æŸäº›è¿­ä»£</span>
            <span class="hljs-keyword">if</span> count % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> {
                <span class="hljs-keyword">continue</span>; <span class="hljs-comment">// è·³è¿‡å¶æ•°</span>
            }
            <span class="hljs-keyword">if</span> count &gt;= <span class="hljs-number">5</span> {
                <span class="hljs-keyword">break</span>; <span class="hljs-comment">// é€€å‡ºå¾ªç¯</span>
            }
        }
   

</code></pre>
<h4 data-id="heading-6">let loop</h4>
<pre><code class="hljs language-rust" lang="rust"> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">result</span> = <span class="hljs-keyword">loop</span> {
    count += <span class="hljs-number">1</span>;

    <span class="hljs-keyword">if</span> count == <span class="hljs-number">10</span> {
        <span class="hljs-keyword">break</span> count * <span class="hljs-number">2</span>; <span class="hljs-comment">// å¾ªç¯å¯ä»¥è¿”å›å€¼</span>
    }
};
<span class="hljs-built_in">println!</span>(<span class="hljs-string">"ç»“æœæ˜¯: {}"</span>, result); <span class="hljs-comment">// 20</span>
</code></pre>
<h4 data-id="heading-7">åµŒå¥—å¾ªç¯å’Œæ ‡ç­¾</h4>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// åµŒå¥—å¾ªç¯å’Œæ ‡ç­¾</span>
<span class="hljs-symbol">'outer</span>: <span class="hljs-keyword">loop</span> {
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"è¿›å…¥å¤–å±‚å¾ªç¯"</span>);
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">inner_count</span> = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">loop</span> {
        <span class="hljs-built_in">println!</span>(<span class="hljs-string">"å†…å±‚å¾ªç¯: {}"</span>, inner_count);
        inner_count += <span class="hljs-number">1</span>;

        <span class="hljs-keyword">if</span> inner_count &gt;= <span class="hljs-number">3</span> {
            <span class="hljs-keyword">break</span>; <span class="hljs-comment">// åªé€€å‡ºå†…å±‚å¾ªç¯</span>
        }

        <span class="hljs-keyword">if</span> inner_count == <span class="hljs-number">2</span> {
            <span class="hljs-keyword">break</span> <span class="hljs-symbol">'outer</span>; <span class="hljs-comment">// é€€å‡ºå¸¦æ ‡ç­¾çš„å¤–å±‚å¾ªç¯</span>
        }
    }

    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"è¿™è¡Œä¸ä¼šæ‰§è¡Œ"</span>);
}
</code></pre>
<h3 data-id="heading-8">while-æ¡ä»¶å¾ªç¯</h3>
<p>whileç±»ä¼¼jsä¸­çš„while-doè¯­å¥ï¼Œä¸è¿‡æ›´ç®€å•ã€‚</p>
<pre><code class="hljs language-rust" lang="rust"> <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">number</span> = <span class="hljs-number">3</span>;

<span class="hljs-comment">// åŸºæœ¬ while å¾ªç¯</span>
<span class="hljs-keyword">while</span> number != <span class="hljs-number">0</span> {
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"å€’è®¡æ—¶: {}"</span>, number);
    number -= <span class="hljs-number">1</span>; 
}
<span class="hljs-built_in">println!</span>(<span class="hljs-string">"å‘å°„!"</span>);
</code></pre>
<h3 data-id="heading-9">forå¾ªç¯</h3>
<p><strong>Rustä¸­æ²¡æœ‰ç±»ä¼¼i++çš„è¯­æ³•ï¼Œæ— æ³•ä½¿ç”¨Cé£æ ¼çš„ä¸‰è¡¨è¾¾å¼forå¾ªç¯</strong>ã€‚Rustä¸­çš„forå¾ªç¯ç±»ä¼¼jsä¸­çš„<code>for in</code></p>
<h4 data-id="heading-10">1. éå†Range</h4>
<pre><code class="hljs language-rust" lang="rust">    <span class="hljs-comment">// 1. éå†èŒƒå›´ (Range)</span>
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"èŒƒå›´ 0..5:"</span>);
    <span class="hljs-keyword">for</span> <span class="hljs-variable">i</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>..<span class="hljs-number">5</span> {  <span class="hljs-comment">// ä¸åŒ…å«5: 0,1,2,3,4</span>
        <span class="hljs-built_in">print!</span>(<span class="hljs-string">"{} "</span>, i);
    }
    <span class="hljs-built_in">println!</span>();
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"èŒƒå›´ 0..=5:"</span>);
    <span class="hljs-keyword">for</span> <span class="hljs-variable">i</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>..=<span class="hljs-number">5</span> {  <span class="hljs-comment">// åŒ…å«5: 0,1,2,3,4,5</span>
        <span class="hljs-built_in">print!</span>(<span class="hljs-string">"{} "</span>, i);
    }
    <span class="hljs-built_in">println!</span>();
</code></pre>
<h4 data-id="heading-11">2. éå†æ•°ç»„</h4>
<pre><code class="hljs language-rust" lang="rust">    <span class="hljs-comment">// 2. éå†æ•°ç»„</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">numbers</span> = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"\néå†æ•°ç»„:"</span>);
    <span class="hljs-keyword">for</span> <span class="hljs-variable">number</span> <span class="hljs-keyword">in</span> numbers {
        <span class="hljs-built_in">print!</span>(<span class="hljs-string">"{} "</span>, number);
    }
    <span class="hljs-built_in">println!</span>();
    
    <span class="hljs-comment">// éå†æ•°ç»„å¸¦ç´¢å¼•</span>
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"\néå†æ•°ç»„å¸¦ç´¢å¼•:"</span>);
    <span class="hljs-title function_ invoke__">for</span> (index, &amp;value) <span class="hljs-keyword">in</span> numbers.<span class="hljs-title function_ invoke__">iter</span>().<span class="hljs-title function_ invoke__">enumerate</span>() {
        <span class="hljs-built_in">println!</span>(<span class="hljs-string">"numbers[{}] = {}"</span>, index, value);
    }
</code></pre>
<h4 data-id="heading-12">3. éå†å‘é‡</h4>
<pre><code class="hljs language-rust" lang="rust">    <span class="hljs-comment">// 3. éå†å‘é‡ (Vec)</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">vec</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-string">"è‹¹æœ"</span>, <span class="hljs-string">"é¦™è•‰"</span>, <span class="hljs-string">"æ©™å­"</span>];
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"\néå†å‘é‡:"</span>);
    <span class="hljs-keyword">for</span> <span class="hljs-variable">fruit</span> <span class="hljs-keyword">in</span> &amp;vec {
        <span class="hljs-built_in">print!</span>(<span class="hljs-string">"{} "</span>, fruit);
    }
    <span class="hljs-built_in">println!</span>();
</code></pre>
<h4 data-id="heading-13">4. éå†å­—ç¬¦ä¸²</h4>
<pre><code class="hljs language-rust" lang="rust">    <span class="hljs-comment">// 4. éå†å­—ç¬¦ä¸²å­—ç¬¦</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">text</span> = <span class="hljs-string">"Rust"</span>;
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"\néå†å­—ç¬¦ä¸²å­—ç¬¦:"</span>);
    <span class="hljs-keyword">for</span> <span class="hljs-variable">ch</span> <span class="hljs-keyword">in</span> text.<span class="hljs-title function_ invoke__">chars</span>() {
        <span class="hljs-built_in">print!</span>(<span class="hljs-string">"{} "</span>, ch);
    }
    <span class="hljs-built_in">println!</span>();
    <span class="hljs-comment">// éå†å­—ç¬¦ä¸²å­—èŠ‚</span>
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"\néå†å­—ç¬¦ä¸²å­—èŠ‚:"</span>);
    <span class="hljs-keyword">for</span> <span class="hljs-variable">byte</span> <span class="hljs-keyword">in</span> text.<span class="hljs-title function_ invoke__">bytes</span>() {
        <span class="hljs-built_in">print!</span>(<span class="hljs-string">"{} "</span>, byte);
    }
    <span class="hljs-built_in">println!</span>();
    
</code></pre>
<h4 data-id="heading-14">5. åå‘éå†</h4>
<pre><code class="hljs language-rust" lang="rust">    <span class="hljs-comment">// 7. åå‘éå†</span>
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"\nåå‘éå†:"</span>);
    <span class="hljs-keyword">for</span> <span class="hljs-variable">i</span> <span class="hljs-keyword">in</span> (<span class="hljs-number">0</span>..<span class="hljs-number">5</span>).<span class="hljs-title function_ invoke__">rev</span>() {
        <span class="hljs-built_in">print!</span>(<span class="hljs-string">"{} "</span>, i);  <span class="hljs-comment">// 4, 3, 2, 1, 0</span>
    }
    <span class="hljs-built_in">println!</span>();
</code></pre>
<h4 data-id="heading-15">6. å¸¦æ­¥é•¿éå†</h4>
<pre><code class="hljs language-rust" lang="rust">    <span class="hljs-comment">// 6. å¸¦æ­¥é•¿çš„éå†</span>
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"\nå¸¦æ­¥é•¿çš„éå†:"</span>);
    <span class="hljs-keyword">for</span> <span class="hljs-variable">i</span> <span class="hljs-keyword">in</span> (<span class="hljs-number">0</span>..=<span class="hljs-number">10</span>).<span class="hljs-title function_ invoke__">step_by</span>(<span class="hljs-number">2</span>) {
        <span class="hljs-built_in">print!</span>(<span class="hljs-string">"{} "</span>, i);  <span class="hljs-comment">// 0, 2, 4, 6, 8, 10</span>
    }
    <span class="hljs-built_in">println!</span>();
</code></pre>
<h2 data-id="heading-16">æ¨¡å¼åŒ¹é…(match)</h2>
<p>matchç›¸å½“äºswitch-case</p>
<h3 data-id="heading-17">åŸºæœ¬ç”¨æ³•</h3>
<pre><code class="hljs language-rust" lang="rust">    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">number</span> = <span class="hljs-number">42</span>;
    
    <span class="hljs-comment">// åŸºæœ¬ matchï¼Œç±»ä¼¼ switch</span>
    <span class="hljs-keyword">match</span> number {
        <span class="hljs-number">1</span> =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"ä¸€"</span>),
        <span class="hljs-number">2</span> | <span class="hljs-number">3</span> | <span class="hljs-number">5</span> | <span class="hljs-number">7</span> | <span class="hljs-number">11</span> =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"å°äº12çš„è´¨æ•°"</span>),
        <span class="hljs-number">13</span>..=<span class="hljs-number">19</span> =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"åå‡ å²"</span>),
        <span class="hljs-number">20</span>..=<span class="hljs-number">39</span> =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"äºŒåå¤šåˆ°ä¸‰åå¤š"</span>),
        <span class="hljs-number">40</span>..=<span class="hljs-number">49</span> =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"å››åå¤šå²"</span>),
        _ =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"å…¶ä»–æ•°å­—"</span>),  <span class="hljs-comment">// é»˜è®¤æƒ…å†µ</span>
    }
    
    <span class="hljs-comment">// match æ˜¯è¡¨è¾¾å¼ï¼Œå¯ä»¥è¿”å›å€¼</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">description</span> = <span class="hljs-keyword">match</span> number {
        <span class="hljs-number">0</span> =&gt; <span class="hljs-string">"é›¶"</span>,
        <span class="hljs-number">1</span> =&gt; <span class="hljs-string">"ä¸€"</span>,
        <span class="hljs-number">2</span> =&gt; <span class="hljs-string">"äºŒ"</span>,
        _ =&gt; <span class="hljs-string">"å…¶ä»–"</span>,
    };
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"æè¿°: {}"</span>, description);
    
    <span class="hljs-comment">// åŒ¹é…å¸ƒå°”å€¼</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">flag</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">status</span> = <span class="hljs-keyword">match</span> flag {
        <span class="hljs-literal">true</span> =&gt; <span class="hljs-string">"å¼€å¯"</span>,
        <span class="hljs-literal">false</span> =&gt; <span class="hljs-string">"å…³é—­"</span>,
    };
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"çŠ¶æ€: {}"</span>, status);
</code></pre>
<h3 data-id="heading-18">å¤æ‚æ¨¡å¼åŒ¹é…</h3>
<p>matchå¯ä»¥åŒ¹é…å…ƒç»„ï¼Œæšä¸¾ï¼ŒOptionï¼ŒResultå’Œç»“æ„ä½“</p>
<pre><code class="hljs language-rust" lang="rust">    <span class="hljs-comment">// 1. åŒ¹é…å…ƒç»„</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">point</span> = (<span class="hljs-number">2</span>, <span class="hljs-number">3</span>);
    
    <span class="hljs-keyword">match</span> point {
        (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>) =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"åŸç‚¹"</span>),
        (<span class="hljs-number">0</span>, y) =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"åœ¨Yè½´ä¸Šï¼Œy = {}"</span>, y),
        (x, <span class="hljs-number">0</span>) =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"åœ¨Xè½´ä¸Šï¼Œx = {}"</span>, x),
        (x, y) =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"ç‚¹ ({}, {})"</span>, x, y),
    }
    
    <span class="hljs-comment">// 2. åŒ¹é…æšä¸¾</span>
    <span class="hljs-keyword">enum</span> <span class="hljs-title class_">Direction</span> {
        Up,
        Down,
        Left,
        Right,
    }
    
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">dir</span> = Direction::Right;
    
    <span class="hljs-keyword">match</span> dir {
        Direction::Up =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"å‘ä¸Š"</span>),
        Direction::Down =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"å‘ä¸‹"</span>),
        Direction::Left =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"å‘å·¦"</span>),
        Direction::Right =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"å‘å³"</span>),
    }
    
    <span class="hljs-comment">// 3. å¸¦æ•°æ®çš„æšä¸¾</span>
    <span class="hljs-keyword">enum</span> <span class="hljs-title class_">Shape</span> {
        <span class="hljs-title function_ invoke__">Circle</span>(<span class="hljs-type">f64</span>),        <span class="hljs-comment">// åŠå¾„</span>
        <span class="hljs-title function_ invoke__">Rectangle</span>(<span class="hljs-type">f64</span>, <span class="hljs-type">f64</span>), <span class="hljs-comment">// å®½, é«˜</span>
        <span class="hljs-title function_ invoke__">Square</span>(<span class="hljs-type">f64</span>),        <span class="hljs-comment">// è¾¹é•¿</span>
    }
    
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">shape</span> = Shape::<span class="hljs-title function_ invoke__">Rectangle</span>(<span class="hljs-number">3.0</span>, <span class="hljs-number">4.0</span>);
    
    <span class="hljs-keyword">match</span> shape {
        Shape::<span class="hljs-title function_ invoke__">Circle</span>(radius) =&gt; {
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"åœ†å½¢ï¼ŒåŠå¾„: {:.2}"</span>, radius);
        }
        Shape::<span class="hljs-title function_ invoke__">Rectangle</span>(width, height) =&gt; {
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"çŸ©å½¢ï¼Œå®½: {:.2}, é«˜: {:.2}"</span>, width, height);
        }
        Shape::<span class="hljs-title function_ invoke__">Square</span>(side) =&gt; {
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"æ­£æ–¹å½¢ï¼Œè¾¹é•¿: {:.2}"</span>, side);
        }
    }
    
    <span class="hljs-comment">// 4. åŒ¹é… Option</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">maybe_value</span>: <span class="hljs-type">Option</span>&lt;<span class="hljs-type">i32</span>&gt; = <span class="hljs-title function_ invoke__">Some</span>(<span class="hljs-number">42</span>);
    
    <span class="hljs-keyword">match</span> maybe_value {
        <span class="hljs-title function_ invoke__">Some</span>(x) =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"æœ‰å€¼: {}"</span>, x),
        <span class="hljs-literal">None</span> =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"æ²¡æœ‰å€¼"</span>),
    }
    
    <span class="hljs-comment">// 5. åŒ¹é… Result</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">result</span>: <span class="hljs-type">Result</span>&lt;<span class="hljs-type">i32</span>, &amp;<span class="hljs-type">str</span>&gt; = <span class="hljs-title function_ invoke__">Ok</span>(<span class="hljs-number">42</span>);
    
    <span class="hljs-keyword">match</span> result {
        <span class="hljs-title function_ invoke__">Ok</span>(value) =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"æˆåŠŸ: {}"</span>, value),
        <span class="hljs-title function_ invoke__">Err</span>(error) =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"é”™è¯¯: {}"</span>, error),
    }
    <span class="hljs-comment">// 5. åŒ¹é…ç»“æ„ä½“</span>
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Point</span> {
        x: <span class="hljs-type">i32</span>,
        y: <span class="hljs-type">i32</span>,
    }
    
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">point</span> = Point { x: <span class="hljs-number">0</span>, y: <span class="hljs-number">7</span> };
    
    <span class="hljs-keyword">match</span> point {
        Point { x: <span class="hljs-number">0</span>, y: <span class="hljs-number">0</span> } =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"åŸç‚¹"</span>),
        Point { x, y: <span class="hljs-number">0</span> } =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"åœ¨Xè½´ä¸Šï¼Œx = {}"</span>, x),
        Point { x: <span class="hljs-number">0</span>, y } =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"åœ¨Yè½´ä¸Šï¼Œy = {}"</span>, y),
        Point { x, y } =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"ç‚¹({}, {})"</span>, x, y),
    }
</code></pre>
<h4 data-id="heading-19">@ç»‘å®š</h4>
<p>Rustä¸­çš„@ç»‘å®šï¼ˆä¹Ÿç§°ä¸ºç»‘å®šæ¨¡å¼ï¼‰å…è®¸åœ¨æ¨¡å¼åŒ¹é…çš„åŒæ—¶ï¼Œå°†åŒ¹é…çš„å€¼ç»‘å®šåˆ°ä¸€ä¸ªå˜é‡ä¸Šã€‚è¿™åœ¨éœ€è¦å¯¹åŒ¹é…çš„å€¼è¿›è¡Œè¿›ä¸€æ­¥æ“ä½œæ—¶éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨åµŒå¥—æ¨¡å¼ä¸­ã€‚</p>
<pre><code class="hljs language-rust" lang="rust">    <span class="hljs-comment">//  @ ç»‘å®š </span>
    <span class="hljs-keyword">enum</span> <span class="hljs-title class_">Message</span> {
        Hello { id: <span class="hljs-type">i32</span> },
    }
    
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">msg</span> = Message::Hello { id: <span class="hljs-number">5</span> };
    
    <span class="hljs-keyword">match</span> msg {
        Message::Hello { id: id_variable @ <span class="hljs-number">3</span>..=<span class="hljs-number">7</span> } =&gt; {
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"æ‰¾åˆ°èŒƒå›´å†…çš„id: {}"</span>, id_variable);
        }
        Message::Hello { id: <span class="hljs-number">10</span>..=<span class="hljs-number">12</span> } =&gt; {
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"æ‰¾åˆ°å¦ä¸€ä¸ªèŒƒå›´å†…çš„id"</span>);
        }
        Message::Hello { id } =&gt; {
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"æ‰¾åˆ°å…¶ä»–id: {}"</span>, id);
        }
    }
</code></pre>
<h4 data-id="heading-20">å¼•ç”³ï¼šOptionå’ŒResult</h4>
<p>Â <code>Option&lt;T&gt;</code>Â å’ŒÂ <code>Result&lt;T, E&gt;</code>æ˜¯ Rust ä¸­ç”¨äºå¤„ç†å¯èƒ½ç¼ºå¤±çš„å€¼å’Œå¯èƒ½å¤±è´¥çš„æ“ä½œçš„æ ¸å¿ƒç±»å‹ã€‚å®ƒä»¬æ˜¯ Rust å®‰å…¨ç¼–ç¨‹å“²å­¦çš„åŸºçŸ³ï¼Œå¼ºåˆ¶åœ¨ç¼–è¯‘æ—¶å¤„ç†æ‰€æœ‰å¯èƒ½çš„é”™è¯¯æƒ…å†µã€‚</p>
<p>Rustä¸­æ²¡æœ‰<code>undefined</code>ç±»å‹ï¼Œä¹Ÿæ²¡æœ‰<code>try-catch</code>è¯­å¥ï¼Œè€Œç”¨Optionå’ŒResultå¤„ç†è¿™ä¸¤è€…ã€‚</p>
<h5 data-id="heading-21">Optionçš„åŸºæœ¬ç”¨æ³•</h5>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// åœ¨Rustä¸­ï¼Œä½¿ç”¨Option&lt;T&gt;æ¥è¡¨ç¤ºä¸€ä¸ªå€¼å¯èƒ½å­˜åœ¨æˆ–å¯èƒ½ç¼ºå¤±</span>
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">some_value</span>: <span class="hljs-type">Option</span>&lt;<span class="hljs-type">i32</span>&gt; = <span class="hljs-title function_ invoke__">Some</span>(<span class="hljs-number">5</span>);
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">no_value</span>: <span class="hljs-type">Option</span>&lt;<span class="hljs-type">i32</span>&gt; = <span class="hljs-literal">None</span>;

<span class="hljs-comment">// å‡½æ•°å¯èƒ½è¿”å›None</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">find_item</span>(id: <span class="hljs-type">u32</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;<span class="hljs-type">String</span>&gt; {
   <span class="hljs-keyword">if</span> id == <span class="hljs-number">1</span> {
       <span class="hljs-title function_ invoke__">Some</span>(<span class="hljs-string">"Item found"</span>.<span class="hljs-title function_ invoke__">to_string</span>())
   } <span class="hljs-keyword">else</span> {
       <span class="hljs-literal">None</span>  <span class="hljs-comment">// ç›¸å½“äºJavaScriptä¸­çš„undefined</span>
   }
}
</code></pre>
<h5 data-id="heading-22">Resultçš„åŸºæœ¬ç”¨æ³•</h5>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// å‡½æ•°è¿”å›Resultè¡¨ç¤ºå¯èƒ½å¤±è´¥</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">open_file</span>(path: &amp;<span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;File, std::io::Error&gt; {
    <span class="hljs-keyword">match</span> File::<span class="hljs-title function_ invoke__">open</span>(path) {
        <span class="hljs-title function_ invoke__">Ok</span>(file) =&gt; <span class="hljs-title function_ invoke__">Ok</span>(file),
        <span class="hljs-title function_ invoke__">Err</span>(e) =&gt; <span class="hljs-title function_ invoke__">Err</span>(e),  <span class="hljs-comment">// è¿”å›é”™è¯¯è€Œä¸æ˜¯æŠ›å‡ºå¼‚å¸¸</span>
    }
}

<span class="hljs-comment">// ä½¿ç”¨matchå¤„ç†Result</span>
<span class="hljs-keyword">match</span> <span class="hljs-title function_ invoke__">open_file</span>(<span class="hljs-string">"test.txt"</span>) {
    <span class="hljs-title function_ invoke__">Ok</span>(file) =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"æ–‡ä»¶æ‰“å¼€æˆåŠŸ"</span>),
    <span class="hljs-title function_ invoke__">Err</span>(e) =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"æ‰“å¼€æ–‡ä»¶å¤±è´¥: {}"</span>, e),
}
</code></pre>
<h5 data-id="heading-23">Rustä¸­çš„<code>?</code>æ“ä½œç¬¦</h5>
<p><code>?</code>æ“ä½œç¬¦åœ¨Rustä¸­ç”¨äºé”™è¯¯ä¼ æ’­ï¼Œå®ƒç®€åŒ–äº†Resultå’ŒOptionç±»å‹çš„å¤„ç†ï¼Œä½¿ä»£ç æ›´ç®€æ´ã€‚å…¶åŸºæœ¬ä½œç”¨æ˜¯å¯¹Resultæˆ–Optionå€¼è¿›è¡Œåˆ¤æ–­ï¼šå¦‚æœæ˜¯Ok/Someï¼Œå°±è§£åŒ…å–å‡ºå†…éƒ¨å€¼ç»§ç»­æ‰§è¡Œï¼›å¦‚æœæ˜¯Err/Noneï¼Œåˆ™æå‰è¿”å›è¯¥é”™è¯¯æˆ–Noneã€‚</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">example</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;<span class="hljs-type">i32</span>, <span class="hljs-type">String</span>&gt; {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">x</span>: <span class="hljs-type">Result</span>&lt;<span class="hljs-type">i32</span>, <span class="hljs-type">String</span>&gt; = <span class="hljs-title function_ invoke__">Ok</span>(<span class="hljs-number">5</span>);
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">y</span> = x?;  <span class="hljs-comment">// å¦‚æœ x æ˜¯ Ok(5)ï¼Œåˆ™ y = 5</span>
                 <span class="hljs-comment">// å¦‚æœ x æ˜¯ Err(e)ï¼Œåˆ™ç«‹å³è¿”å› Err(e)</span>
    <span class="hljs-title function_ invoke__">Ok</span>(y * <span class="hljs-number">2</span>)
}
</code></pre>
<h3 data-id="heading-24">if letå’Œwhile let</h3>
<p><code>if let</code>Â æ˜¯ä¸€ç§æ›´ç®€æ´çš„æ–¹å¼ï¼Œç”¨äºå¤„ç†åªåŒ¹é…ä¸€ä¸ªæ¨¡å¼çš„å€¼è€Œå¿½ç•¥å…¶ä»–æ¨¡å¼çš„æƒ…å†µã€‚<code>while let</code>Â å…è®¸åªè¦æ¨¡å¼åŒ¹é…å°±ä¸€ç›´è¿›è¡Œå¾ªç¯ã€‚</p>
<pre><code class="hljs language-scss" lang="scss"> <span class="hljs-comment">// ä½¿ç”¨ if let</span>
let some_value = <span class="hljs-built_in">Some</span>(<span class="hljs-number">42</span>);
if let <span class="hljs-built_in">Some</span>(x) = some_value {
    println!("å€¼æ˜¯: {}", x);
}

<span class="hljs-comment">// æ¡ä»¶å¾ªç¯åŒ¹é…</span>
while let <span class="hljs-built_in">Some</span>(item) = iter<span class="hljs-selector-class">.next</span>() {
    <span class="hljs-comment">// ...</span>
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vueå®ç°å¤§å±è·å–å½“å‰æ‰€å¤„åŸå¸‚åŠå½“åœ°å¤©æ°”(çº¯å…è´¹)]]></title>    <link>https://juejin.cn/post/7603656494905475078</link>    <guid>https://juejin.cn/post/7603656494905475078</guid>    <pubDate>2026-02-08T01:49:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603656494905475078" data-draft-id="7603656494905458694" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vueå®ç°å¤§å±è·å–å½“å‰æ‰€å¤„åŸå¸‚åŠå½“åœ°å¤©æ°”(çº¯å…è´¹)"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-08T01:49:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æå‰‘ä¸€"/> <meta itemprop="url" content="https://juejin.cn/user/4147782344247918"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vueå®ç°å¤§å±è·å–å½“å‰æ‰€å¤„åŸå¸‚åŠå½“åœ°å¤©æ°”(çº¯å…è´¹)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4147782344247918/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æå‰‘ä¸€
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T01:49:04.000Z" title="Sun Feb 08 2026 01:49:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä¹‹å‰åšè¿‡çš„å¤§å±é¡¹ç›®ä¸€èˆ¬æ˜¯åœ¨å†…ç½‘ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œæ‰€ä»¥ä¸€èˆ¬é¡¶éƒ¨ä¸ç‰µæ‰¯å±•ç¤ºåŸå¸‚å’Œå¤©æ°”ã€‚ä½†æ˜¯è¿™æ¬¡åšçš„æ˜¯æ”¾åœ¨å¤–ç½‘çš„ï¼Œæ‰€ä»¥ç®€å•å®ç°ä¸€ä¸‹å±•ç¤ºåŸå¸‚åç§°å’Œå½“å‰å®æ—¶å¤©æ°”ä¿¡æ¯ã€‚</p>
<h2 data-id="heading-0">è·å–å½“å‰æ‰€å¤„ä½ç½®</h2>
<p>è·å–å½“å‰å®šä½å¯ä»¥é€šè¿‡æµè§ˆå™¨åŸç”Ÿçš„<code>Geolocation API</code>è·å–ç»çº¬åº¦ä¿¡æ¯ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getLocation</span>(<span class="hljs-params"/>) {
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
		<span class="hljs-keyword">if</span> (navigator.<span class="hljs-property">geolocation</span>) {
			navigator.<span class="hljs-property">geolocation</span>.<span class="hljs-title function_">getCurrentPosition</span>(
				<span class="hljs-function">(<span class="hljs-params">position</span>) =&gt;</span> {
					<span class="hljs-keyword">const</span> lat = position.<span class="hljs-property">coords</span>.<span class="hljs-property">latitude</span>;
					<span class="hljs-keyword">const</span> lon = position.<span class="hljs-property">coords</span>.<span class="hljs-property">longitude</span>;
					<span class="hljs-title function_">resolve</span>({lat, lon});
					<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å½“å‰ä½ç½®:'</span>, lat, lon);
				},
				<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
					<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'æ— æ³•è·å–ä½ç½®:'</span>, error.<span class="hljs-property">message</span>);
					<span class="hljs-title function_">reject</span>(error);
				}
			);
		}
	})
}
</code></pre>
<p>éœ€è¦æ³¨æ„ï¼Œ<code>Geolocation API</code>æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥è¿™é‡Œç”¨ <code>Promise</code> è¿›è¡Œäº†ç®€å•çš„å°è£…ã€‚å¦å¤–è¿™é‡Œåªèƒ½è·å–åˆ°ç»çº¬åº¦ï¼Œæ— æ³•è·å–åˆ°æ‰€åœ¨åŸå¸‚åç§°ï¼Œéœ€è¦é€šè¿‡é€†åœ°ç†ç¼–ç çš„æ–¹å¼å®ç°ã€‚</p>
<h2 data-id="heading-1">é€†åœ°ç†ç¼–ç </h2>
<p>ç›®å‰å›½å†…ä¸»è¦æ˜¯<strong>å¾¡ä¸‰å®¶</strong>æä¾›<strong>é€†åœ°ç†ç¼–ç </strong>çš„æœåŠ¡ï¼Œä½†æ˜¯éƒ½éœ€è¦è¿›è¡Œä»˜è´¹ï¼Œä¸è¿‡å”¯ä¸€å¯ä»¥åº†å¹¸çš„æ˜¯å„å®¶éƒ½æœ‰<strong>å…è´¹é¢åº¦</strong>ã€‚</p>
<p>å¦‚æœä½ çš„å¤§å±éƒ¨ç½²åœ¨å¤–ç½‘ï¼Œå›½å¤–çš„<strong>Nominatim</strong>æ˜¯å®Œå…¨å…è´¹çš„ï¼Œå’±ä»¬è¿™è¾¹ç›®å‰æ˜¯æ— æ³•è®¿é—®çš„ã€‚å®˜ç½‘åœ°å€ä¹Ÿæ”¾ä¸€ä¸ª<a href="https://link.juejin.cn?target=https%3A%2F%2Fnominatim.openstreetmap.org" target="_blank" title="https://nominatim.openstreetmap.org" ref="nofollow noopener noreferrer">nominatim.openstreetmap.org</a>ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¥è…¾è®¯çš„é€†åœ°ç†ç¼–ç æœåŠ¡ä¸ºä¾‹å­ç®€å•å†™ä¸€ä¸‹ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getCityName</span>(<span class="hljs-params">lat, lon</span>) {
	<span class="hljs-keyword">const</span> sig = <span class="hljs-title class_">CryptoJs</span>.<span class="hljs-title class_">MD5</span>(<span class="hljs-string">`/ws/geocoder/v1/?key=<span class="hljs-subst">${ä½ çš„key}</span>&amp;location=<span class="hljs-subst">${lat}</span>,<span class="hljs-subst">${lon}</span><span class="hljs-subst">${ä½ çš„ç­¾å}</span>`</span>).<span class="hljs-title function_">toString</span>();
	<span class="hljs-keyword">const</span> {result} = <span class="hljs-keyword">await</span> request.<span class="hljs-title function_">get</span>(<span class="hljs-string">`/tencent/ws/geocoder/v1/?key=<span class="hljs-subst">${ä½ çš„key}</span>&amp;location=<span class="hljs-subst">${lat}</span>,<span class="hljs-subst">${lon}</span>&amp;sig=<span class="hljs-subst">${sig}</span>`</span>);
	<span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${result.address_component.city}</span>-<span class="hljs-subst">${result.address_component.district}</span>`</span>
}
</code></pre>
<p>è¿™é‡Œéœ€è¦ä»£ç†ä¸€ä¸‹ï¼Œæˆ‘è¿™é‡Œçš„ä»£ç†å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-string">'/tencent'</span>: {
    <span class="hljs-attr">target</span>: <span class="hljs-string">'https://apis.map.qq.com'</span>,
    <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">rewrite</span>: <span class="hljs-function">(<span class="hljs-params">path</span>) =&gt;</span> path.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^\/tencent/</span>, <span class="hljs-string">''</span>)
},
</code></pre>
<h2 data-id="heading-2">è·å–å¤©æ°”</h2>
<p>å¤©æ°”ä¿¡æ¯ç›®å‰å’±ä»¬è¿™è¾¹æœ‰å’Œé£å¤©æ°”ï¼Œæä¾›äº†ä¸€å®šçš„å…è´¹é¢åº¦ã€‚</p>
<p>ä½†æ˜¯æˆ‘åœ¨ç½‘ä¸Šæ‰¾åˆ°ä¸€ä¸ªå¤–é¢çš„ï¼Œä½†æ˜¯å’±ä»¬è¿™è¾¹èƒ½è®¿é—®åˆ°çš„<strong>Open-Meteo</strong>ï¼Œå®˜æ–¹åœ°å€ä¹Ÿæ”¾ä¸€ä¸‹<a href="https://link.juejin.cn?target=https%3A%2F%2Fopen-meteo.com" target="_blank" title="https://open-meteo.com" ref="nofollow noopener noreferrer">open-meteo.com</a>ã€‚</p>
<p>ç‰¹ç‚¹å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ— éœ€æ³¨å†Œã€æ—  API Keyã€æ— è°ƒç”¨é™åˆ¶</li>
<li>æ”¯æŒå…¨çƒç»çº¬åº¦å®æ—¶å¤©æ°” + æœªæ¥7å¤©é¢„æŠ¥</li>
<li>æ•°æ®æ¥æºï¼šæ¬§æ´²ä¸­æœŸå¤©æ°”é¢„æŠ¥ä¸­å¿ƒï¼ˆECMWFï¼‰ç­‰æƒå¨æœºæ„</li>
</ul>
<p>å”¯ä¸€ä¸å¥½çš„ä¸€ç‚¹åœ¨äºè¿”å›çš„éƒ½æ˜¯è‹±æ–‡æ•°æ®ï¼Œéœ€è¦è®¤ä¸ºçš„è½¬æˆä¸­æ–‡ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// éƒ¨åˆ†å¤©æ°”ä¸­è‹±æ–‡æ˜ å°„</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">WEATHER_CODE_MAP</span> = {
	<span class="hljs-number">0</span>: { <span class="hljs-attr">en</span>: <span class="hljs-string">'Clear sky'</span>, <span class="hljs-attr">zh</span>: <span class="hljs-string">'æ™´'</span> },
	<span class="hljs-number">1</span>: { <span class="hljs-attr">en</span>: <span class="hljs-string">'Mainly clear'</span>, <span class="hljs-attr">zh</span>: <span class="hljs-string">'æ™´è½¬å¤šäº‘'</span> },
	<span class="hljs-number">2</span>: { <span class="hljs-attr">en</span>: <span class="hljs-string">'Partly cloudy'</span>, <span class="hljs-attr">zh</span>: <span class="hljs-string">'å¤šäº‘'</span> },
	<span class="hljs-number">3</span>: { <span class="hljs-attr">en</span>: <span class="hljs-string">'Overcast'</span>, <span class="hljs-attr">zh</span>: <span class="hljs-string">'é˜´'</span> },
	<span class="hljs-number">45</span>: { <span class="hljs-attr">en</span>: <span class="hljs-string">'Fog'</span>, <span class="hljs-attr">zh</span>: <span class="hljs-string">'é›¾'</span> },
	<span class="hljs-number">48</span>: { <span class="hljs-attr">en</span>: <span class="hljs-string">'Depositing rime fog'</span>, <span class="hljs-attr">zh</span>: <span class="hljs-string">'å†»é›¾'</span> },
	<span class="hljs-number">51</span>: { <span class="hljs-attr">en</span>: <span class="hljs-string">'Drizzle: Light'</span>, <span class="hljs-attr">zh</span>: <span class="hljs-string">'å°é›¨'</span> },
	<span class="hljs-number">53</span>: { <span class="hljs-attr">en</span>: <span class="hljs-string">'Drizzle: Moderate'</span>, <span class="hljs-attr">zh</span>: <span class="hljs-string">'ä¸­é›¨'</span> },
	<span class="hljs-number">55</span>: { <span class="hljs-attr">en</span>: <span class="hljs-string">'Drizzle: Dense'</span>, <span class="hljs-attr">zh</span>: <span class="hljs-string">'å¤§é›¨'</span> },
	<span class="hljs-number">61</span>: { <span class="hljs-attr">en</span>: <span class="hljs-string">'Rain: Slight'</span>, <span class="hljs-attr">zh</span>: <span class="hljs-string">'å°é›¨'</span> },
	<span class="hljs-number">63</span>: { <span class="hljs-attr">en</span>: <span class="hljs-string">'Rain: Moderate'</span>, <span class="hljs-attr">zh</span>: <span class="hljs-string">'ä¸­é›¨'</span> },
	<span class="hljs-number">65</span>: { <span class="hljs-attr">en</span>: <span class="hljs-string">'Rain: Heavy'</span>, <span class="hljs-attr">zh</span>: <span class="hljs-string">'å¤§é›¨'</span> },
	<span class="hljs-number">71</span>: { <span class="hljs-attr">en</span>: <span class="hljs-string">'Snow fall: Slight'</span>, <span class="hljs-attr">zh</span>: <span class="hljs-string">'å°é›ª'</span> },
	<span class="hljs-number">73</span>: { <span class="hljs-attr">en</span>: <span class="hljs-string">'Snow fall: Moderate'</span>, <span class="hljs-attr">zh</span>: <span class="hljs-string">'ä¸­é›ª'</span> },
	<span class="hljs-number">75</span>: { <span class="hljs-attr">en</span>: <span class="hljs-string">'Snow fall: Heavy'</span>, <span class="hljs-attr">zh</span>: <span class="hljs-string">'å¤§é›ª'</span> },
	<span class="hljs-number">95</span>: { <span class="hljs-attr">en</span>: <span class="hljs-string">'Thunderstorm'</span>, <span class="hljs-attr">zh</span>: <span class="hljs-string">'é›·é˜µé›¨'</span> },
	<span class="hljs-number">96</span>: { <span class="hljs-attr">en</span>: <span class="hljs-string">'Thunderstorm with slight hail'</span>, <span class="hljs-attr">zh</span>: <span class="hljs-string">'é›·é˜µé›¨ä¼´å°å†°é›¹'</span> },
	<span class="hljs-number">99</span>: { <span class="hljs-attr">en</span>: <span class="hljs-string">'Thunderstorm with heavy hail'</span>, <span class="hljs-attr">zh</span>: <span class="hljs-string">'é›·é˜µé›¨ä¼´å¤§å†°é›¹'</span> }
};
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// è·å–å¤©æ°”</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getWeather</span>(<span class="hljs-params">lat, lon</span>) {
	<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> request.<span class="hljs-title function_">get</span>(<span class="hljs-string">`https://api.open-meteo.com/v1/forecast?latitude=<span class="hljs-subst">${lat}</span>&amp;longitude=<span class="hljs-subst">${lon}</span>&amp;current_weather=true`</span>);
	<span class="hljs-keyword">const</span> code = result.<span class="hljs-property">current_weather</span>.<span class="hljs-property">weathercode</span>;
	<span class="hljs-keyword">return</span> <span class="hljs-variable constant_">WEATHER_CODE_MAP</span>[code] || {<span class="hljs-attr">en</span>: <span class="hljs-string">'Unknown'</span>, <span class="hljs-attr">zh</span>: <span class="hljs-string">'æœªçŸ¥'</span>};
}
</code></pre>
<p>è¿™ä¸ªæ˜¯ä¸éœ€è¦ä»£ç†çš„ï¼Œå› ä¸º<strong>Open-Meteo</strong>æœ¬èº«æ”¯æŒ<code>CORS</code>ã€‚</p>
<h2 data-id="heading-3">æ€»ç»“</h2>
<p>è·å–ç»çº¬åº¦å’ŒåŸå¸‚ä¿¡æ¯ï¼Œä»¥åŠå¤©æ°”ä¿¡æ¯åœ¨æŠ€æœ¯ä¸Šæ²¡ä»€ä¹ˆéš¾åº¦ã€‚</p>
<p>ä¸»è¦çš„é—®é¢˜ç‚¹åœ¨äºå¾ˆå¤šä¸œè¥¿éƒ½æ˜¯ä»˜è´¹çš„ï¼Œè‡ªå·±ç©ç©è¿˜å¥½ï¼Œä½†è¦æ˜¯çœŸçš„ä¸Šçº¿æ­£å¼ç¯å¢ƒä¸€å®šè¦<strong>é˜²å¤‡</strong>è¢«åˆ«äººæ¶æ„åˆ·çˆ†ã€‚</p>
<p>ä¹‹å‰æˆ‘è¿˜è§è¿‡ä¸€ä¸ªå¤§å±ä¸Šå®æ—¶å±•ç¤ºå¤©æ°”çŠ¶å†µï¼Œå«æ˜Ÿåœ°å›¾ä¸Šå‰é¢æœ‰ä¸€å±‚è’™ç‰ˆå±•ç¤ºã€‚å¦‚æœæ˜¯ä¸‹é›¨çš„è¯æœ‰é›¨æ»´æ‰“åœ¨å±å¹•ä¸Šçš„æ„Ÿè§‰ï¼Œæ•ˆæœéå¸¸ä¸é”™ï¼Œå›å¤´å®ç°å®Œåˆ†äº«ç»™å¤§å®¶ã€‚</p>
<p>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·<strong>æå‰‘ä¸€</strong>ï¼Œåˆ†äº«æ›´å¤šçš„å¹²è´§ï¼Œç•…èŠåœˆå†…å…«å¦ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä½¿ç”¨ Go + Gin + Fx æ„å»ºå·¥ç¨‹åŒ–åç«¯æœåŠ¡æ¨¡æ¿ï¼ˆgin-app å®è·µï¼‰]]></title>    <link>https://juejin.cn/post/7603946518372466726</link>    <guid>https://juejin.cn/post/7603946518372466726</guid>    <pubDate>2026-02-08T10:34:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603946518372466726" data-draft-id="7603688142005190665" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä½¿ç”¨ Go + Gin + Fx æ„å»ºå·¥ç¨‹åŒ–åç«¯æœåŠ¡æ¨¡æ¿ï¼ˆgin-app å®è·µï¼‰"/> <meta itemprop="keywords" content="åç«¯,Go,å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-08T10:34:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ¢¦æƒ³å¾ˆå¤§å¾ˆå¤§"/> <meta itemprop="url" content="https://juejin.cn/user/1248673297886535"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä½¿ç”¨ Go + Gin + Fx æ„å»ºå·¥ç¨‹åŒ–åç«¯æœåŠ¡æ¨¡æ¿ï¼ˆgin-app å®è·µï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1248673297886535/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ¢¦æƒ³å¾ˆå¤§å¾ˆå¤§
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T10:34:07.000Z" title="Sun Feb 08 2026 10:34:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>é¡¹ç›®åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F1111mp%2Fgin-app" target="_blank" title="https://github.com/1111mp/gin-app" ref="nofollow noopener noreferrer">github.com/1111mp/gin-â€¦</a></p>
</blockquote>
<hr/>
<h2 data-id="heading-0">ä¸€ã€å†™åœ¨å‰é¢ï¼šè¿™æ˜¯ä¸€æ¬¡çœŸå®çš„å·¥ç¨‹æ¢ç´¢ç»å†</h2>
<p>è¿™ç¯‡æ–‡ç« å¹¶ä¸æ˜¯ä¸€ç¯‡â€œæ¶æ„è®¾è®¡è¯´æ˜æ–‡æ¡£â€ï¼Œè€Œæ›´åƒæ˜¯ä¸€æ¬¡<strong>ä¸ªäººå·¥ç¨‹æ¢ç´¢çš„è®°å½•</strong>ã€‚</p>
<p>æˆ‘åœ¨ä½¿ç”¨ Node.js å†™åç«¯æœåŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œä¸€ç›´å¾ˆå–œæ¬¢ <strong>NestJS</strong> é‚£ç§å·¥ç¨‹åŒ–çš„ä»£ç ç»„ç»‡æ–¹å¼ï¼š</p>
<ul>
<li>æ¨¡å—åŒ–ç»“æ„æ¸…æ™°</li>
<li>é¡¹ç›®å±‚æ¬¡åˆ†æ˜</li>
<li>ä¾èµ–å…³ç³»æ˜ç¡®</li>
<li>å·¥ç¨‹è§„èŒƒå¤©ç„¶ç»Ÿä¸€</li>
</ul>
<p>å½“é¡¹ç›®è§„æ¨¡å˜å¤§æ—¶ï¼Œè¿™ç§ç»“æ„éå¸¸â€œç¨³â€ï¼Œä¸å®¹æ˜“ä¹±ã€‚</p>
<p>åæ¥åœ¨è½¬å‘ Go åšåç«¯é¡¹ç›®æ—¶ï¼Œæˆ‘å‘ç° Go ç”Ÿæ€å¹¶æ²¡æœ‰ç±»ä¼¼ NestJS è¿™ç§â€œå¼€ç®±å³ç”¨â€çš„å·¥ç¨‹å‹æ¡†æ¶ã€‚æ›´å¤šæ˜¯ï¼š</p>
<ul>
<li>Gin / Echo / Fiber è§£å†³ Web</li>
<li>å„ç§åº“ç»„åˆæ—¥å¿—ã€é…ç½®ã€æ•°æ®åº“ã€é‰´æƒ</li>
<li>æ¶æ„è‡ªç”±ï¼Œä½†ç¼ºå°‘ç»Ÿä¸€èŒƒå¼</li>
</ul>
<p>ä¸€å¼€å§‹æˆ‘ä¹Ÿå°è¯•è¿‡å¾ˆå¤šç»„åˆæ–¹å¼ï¼Œè¯´å®è¯ï¼š<strong>é¡¹ç›®è§„æ¨¡å°çš„æ—¶å€™æ²¡é—®é¢˜ï¼Œä¸€æ—¦é¡¹ç›®å¼€å§‹å¤æ‚ï¼Œç»“æ„å¾ˆå®¹æ˜“å¤±æ§</strong>ï¼š</p>
<ul>
<li>ç›®å½•å¼€å§‹å˜ä¹±</li>
<li>æ¨¡å—è¾¹ç•Œå¼€å§‹æ¨¡ç³Š</li>
<li>ä¾èµ–å¼€å§‹äº’ç›¸å¼•ç”¨</li>
<li>æµ‹è¯•è¶Šæ¥è¶Šéš¾å†™</li>
<li>æ–°äººè¶Šæ¥è¶Šéš¾ä¸Šæ‰‹</li>
</ul>
<p>äºæ˜¯æˆ‘å¼€å§‹æœ‰æ„è¯†åœ°å»æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼š</p>
<blockquote>
<p>Go é‡Œèƒ½ä¸èƒ½ä¹Ÿåšä¸€å¥—â€œå·¥ç¨‹çº§ç»“æ„æ¨¡æ¿â€ï¼Ÿ<br/>
ä¸è¿½æ±‚æ¡†æ¶èƒ½åŠ›ï¼Œè€Œæ˜¯è§£å†³å·¥ç¨‹ç»„ç»‡é—®é¢˜ã€‚</p>
</blockquote>
<p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¹Ÿå‚è€ƒè¿‡ä¸€äº›ä¼˜ç§€é¡¹ç›®ï¼Œæ¯”å¦‚ï¼š<br/>
ğŸ‘‰ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fevrone%2Fgo-clean-template" target="_blank" title="https://github.com/evrone/go-clean-template" ref="nofollow noopener noreferrer">github.com/evrone/go-câ€¦</a></p>
<p>å®ƒåœ¨åˆ†å±‚æ€æƒ³å’Œä¾èµ–æ–¹å‘æ§åˆ¶ä¸Šç»™äº†æˆ‘å¾ˆå¤šå¯å‘ï¼Œä½†æ•´ä½“æ›´åç†è®ºå‹æ¶æ„è®¾è®¡ï¼Œå¹¶ä¸æ˜¯æˆ‘æƒ³è¦çš„é‚£ç§â€œå·¥ç¨‹æ¨¡æ¿å‹ç»“æ„â€ã€‚</p>
<p>åæ¥é€æ­¥å°è¯•å°† <strong>Gin + Uber Fx</strong> ç»„åˆåœ¨ä¸€èµ·ï¼Œä¸€è¾¹å†™é¡¹ç›®ï¼Œä¸€è¾¹è°ƒæ•´ç»“æ„ï¼Œæ…¢æ…¢å½¢æˆäº†ä¸€å¥—ç›¸å¯¹ç¨³å®šçš„å·¥ç¨‹ç»„ç»‡æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ç°åœ¨çš„ï¼š</p>
<blockquote>
<p><strong>gin-app</strong><br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F1111mp%2Fgin-app" target="_blank" title="https://github.com/1111mp/gin-app" ref="nofollow noopener noreferrer">github.com/1111mp/gin-â€¦</a></p>
</blockquote>
<p>å®ƒä¸æ˜¯ä¸€ä¸ªæ¡†æ¶é¡¹ç›®ï¼Œæ›´åƒæ˜¯ï¼š</p>
<blockquote>
<p>æˆ‘åœ¨çœŸå®é¡¹ç›®ä¸­ä¸€æ­¥æ­¥è¯•å‡ºæ¥çš„ä¸€å¥— Go å·¥ç¨‹æ¨¡æ¿ç»“æ„</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">äºŒã€æˆ‘æƒ³è§£å†³çš„ï¼Œå…¶å®ä¸æ˜¯â€œæŠ€æœ¯é—®é¢˜â€</h2>
<p>è¯´å®è¯ï¼Œè¿™ä¸ªé¡¹ç›®ä¸€å¼€å§‹å¹¶ä¸æ˜¯ä¸ºäº†è¿½æ±‚æŠ€æœ¯å¤æ‚åº¦ï¼Œè€Œæ˜¯ä¸ºäº†è§£å†³å‡ ä¸ªå¾ˆç°å®çš„é—®é¢˜ï¼š</p>
<ul>
<li>é¡¹ç›®ä¸€å¤§ï¼Œç»“æ„å°±ä¹±</li>
<li>äººä¸€å¤šï¼Œé£æ ¼å°±ä¹±</li>
<li>æ¨¡å—å¤šäº†ä¹‹åï¼Œä¾èµ–å°±å¼€å§‹ä¹±</li>
<li>æ²¡æœ‰ç»Ÿä¸€ç»“æ„è§„èŒƒï¼Œé‡æ„æˆæœ¬æé«˜</li>
</ul>
<p>æ‰€ä»¥ <code>gin-app</code> çš„æ ¸å¿ƒç›®æ ‡å…¶å®å¾ˆç®€å•ï¼š</p>
<blockquote>
<p>è®© Go é¡¹ç›®åœ¨è§„æ¨¡å¢é•¿æ—¶ï¼Œä¾ç„¶èƒ½ä¿æŒç»“æ„æ¸…æ™°</p>
</blockquote>
<p>è€Œä¸æ˜¯ï¼š</p>
<blockquote>
<p>å†™ä»£ç æ›´ç‚«ã€æŠ€æœ¯æ›´å¤æ‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€ä¸ºä»€ä¹ˆé€‰æ‹© Gin + Fx</h2>
<h3 data-id="heading-3">Gin</h3>
<p>è¿™ä¸ªæ²¡ä»€ä¹ˆèŠ±å“¨ç†ç”±ï¼šæˆç†Ÿã€ç¨³å®šã€ç”Ÿæ€å¥½ï¼Œç”¨èµ·æ¥é¡ºæ‰‹ã€‚</p>
<h3 data-id="heading-4">Fx</h3>
<p>Fx ä¸€å¼€å§‹æˆ‘ä¹Ÿåªæ˜¯å½“ä½œ DI å·¥å…·åœ¨ç”¨ï¼Œä½†çœŸæ­£ç”¨åˆ°å·¥ç¨‹é‡Œä¹‹åå‘ç°ï¼š</p>
<p>å®ƒæ›´åƒæ˜¯ä¸€ä¸ª<strong>é¡¹ç›®å¯åŠ¨è°ƒåº¦å™¨</strong>ï¼š</p>
<ul>
<li>ç»Ÿä¸€ç®¡ç†ç»„ä»¶åˆå§‹åŒ–</li>
<li>ç»Ÿä¸€ç®¡ç†å¯åŠ¨æµç¨‹</li>
<li>ç»Ÿä¸€ç®¡ç†ç”Ÿå‘½å‘¨æœŸ</li>
<li>è‡ªåŠ¨å¤„ç†ä¾èµ–é¡ºåº</li>
</ul>
<p>æ…¢æ…¢å‘ç°ï¼Œå®ƒæ›´é€‚åˆåšâ€œå·¥ç¨‹ç»“æ„å·¥å…·â€ï¼Œè€Œä¸åªæ˜¯â€œä¾èµ–æ³¨å…¥å·¥å…·â€ã€‚</p>
<hr/>
<h2 data-id="heading-5">å››ã€ç°åœ¨çš„å·¥ç¨‹ç»“æ„</h2>
<p>ç›®å‰é¡¹ç›®ç»“æ„æ˜¯è¿™æ ·ç»„ç»‡çš„ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">cmd/
  app/                 <span class="hljs-meta"># åº”ç”¨å¯åŠ¨å…¥å£</span>
<span class="hljs-keyword">internal</span>/
  config/              <span class="hljs-meta"># é…ç½®ç®¡ç†</span>
  modules/             <span class="hljs-meta"># ä¸šåŠ¡æ¨¡å—ï¼ˆuserã€postã€auth ç­‰ï¼‰</span>
  router/              <span class="hljs-meta"># è·¯ç”±å±‚</span>
  middleware/          <span class="hljs-meta"># HTTP ä¸­é—´ä»¶ï¼ˆé‰´æƒã€æ—¥å¿—ã€è·¨åŸŸç­‰ï¼‰</span>
  dto/                 <span class="hljs-meta"># æ•°æ®ä¼ è¾“å¯¹è±¡ï¼ˆè¯·æ±‚/å“åº”æ¨¡å‹ï¼‰</span>
pkg/
  logger/              <span class="hljs-meta"># æ—¥å¿—æ¨¡å—</span>
  postgres/            <span class="hljs-meta"># PostgreSQL å®¢æˆ·ç«¯</span>
  redis/               <span class="hljs-meta"># Redis å®¢æˆ·ç«¯</span>
  jwt/                 <span class="hljs-meta"># JWT å·¥å…·åº“</span>
  oauth2/              <span class="hljs-meta"># OAuth2ï¼ˆGitHub / Google ç™»å½•ï¼‰</span>
ent/
  schema/              <span class="hljs-meta"># Ent ORM æ¨¡å‹å®šä¹‰</span>
  migrate/             <span class="hljs-meta"># æ•°æ®åº“è¿ç§»æ–‡ä»¶</span>
docs/                  <span class="hljs-meta"># Swagger æ–‡æ¡£</span>
</code></pre>
<p>æˆ‘ç°åœ¨çš„æ ¸å¿ƒä¹ æƒ¯æ˜¯ï¼š</p>
<ul>
<li>æŒ‰<strong>ä¸šåŠ¡åŸŸæ‹†æ¨¡å—</strong>ï¼Œè€Œä¸æ˜¯æŒ‰æŠ€æœ¯æ‹†å±‚</li>
<li>router åªåšè·¯ç”±ç»‘å®š</li>
<li>modules åªåšä¸šåŠ¡é€»è¾‘</li>
<li>middleware ç‹¬ç«‹</li>
<li>dto å•ç‹¬ç®¡ç†è¾“å…¥è¾“å‡ºæ¨¡å‹</li>
<li>pkg æ”¾é€šç”¨åŸºç¡€è®¾æ–½èƒ½åŠ›</li>
</ul>
<p>æ¨¡å—ç»“æ„ä¿æŒç±»ä¼¼ NestJS çš„é£æ ¼ï¼š</p>
<pre><code class="hljs language-go" lang="go">modules/user
  user.controller.<span class="hljs-keyword">go</span>
  user.service.<span class="hljs-keyword">go</span>
  user.repository.<span class="hljs-keyword">go</span>
  user.module.<span class="hljs-keyword">go</span>
</code></pre>
<p>è¿™ç§ç»“æ„çš„å¥½å¤„å¾ˆç›´æ¥ï¼š</p>
<blockquote>
<p>æ‰¾åŠŸèƒ½ = æ‰¾æ¨¡å—ï¼Œä¸æ˜¯ç¿»ç›®å½•</p>
</blockquote>
<blockquote>
<p><code>user.controller.go</code> è¿™æ ·çš„æ–‡ä»¶å‘½åæ–¹å¼åº”è¯¥æ˜¯ä¸ç¬¦åˆ Go çš„å¼€å‘è§„èŒƒçš„ï¼Œä½†æ˜¯ç›®å‰å¥½åƒä¹Ÿæ²¡é‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Œæ‰€ä»¥...ğŸ˜Š</p>
</blockquote>
<hr/>
<h2 data-id="heading-6">äº”ã€Fx åœ¨å·¥ç¨‹é‡Œçš„çœŸå®ä½œç”¨</h2>
<p>ç°åœ¨åœ¨è¿™ä¸ªé¡¹ç›®é‡Œï¼ŒFx æ›´åƒæ˜¯ï¼š</p>
<blockquote>
<p>ä¸€ä¸ªâ€œå·¥ç¨‹å¯åŠ¨è°ƒåº¦å™¨â€</p>
</blockquote>
<p>å®ƒå¸®æˆ‘è§£å†³çš„æ˜¯ï¼š</p>
<ul>
<li>è°å…ˆåˆå§‹åŒ–</li>
<li>è°ä¾èµ–è°</li>
<li>è°ä»€ä¹ˆæ—¶å€™å¯åŠ¨</li>
<li>è°ä»€ä¹ˆæ—¶å€™å…³é—­</li>
</ul>
<p>è€Œä¸æ˜¯â€œæˆ‘æ€ä¹ˆ new ä¸€ä¸ªå¯¹è±¡â€ã€‚</p>
<p>åœ¨ <code>gin-app</code> é‡Œï¼ŒFx çš„ä½¿ç”¨æ–¹å¼ä¹Ÿæ¯”è¾ƒåå·¥ç¨‹åŒ–ï¼Œè€Œä¸æ˜¯é›¶æ•£æ³¨å…¥ã€‚</p>
<h3 data-id="heading-7">1. å¯åŠ¨å…¥å£ç»Ÿä¸€è°ƒåº¦</h3>
<p>æ•´ä¸ªç³»ç»Ÿçš„å¯åŠ¨å…¥å£é›†ä¸­åœ¨ <code>internal/app/app.go</code> çš„ <code>Run()</code> æ–¹æ³•ä¸­ï¼Œè¿™é‡Œä¸æ˜¯ç®€å•åœ° <code>main()</code> + ä¸€å †åˆå§‹åŒ–å‡½æ•°è°ƒç”¨ï¼Œè€Œæ˜¯é€šè¿‡ <code>fx.New()</code> ä½œä¸º<strong>ç³»ç»Ÿæ€»è°ƒåº¦ä¸­å¿ƒ</strong>ï¼š</p>
<pre><code class="hljs language-go" lang="go">fx.New(
  fx.Supply(...),
  fx.Provide(
      NewLogger,
      NewPostgresDB,
      NewRedis,
      NewOauth2Client,
      ...
  ),
  modules.APIModule,
  fx.Invoke(startHTTPServer),
).Run()
</code></pre>
<p>è¿™é‡Œçš„ç»“æ„éå¸¸æ¸…æ™°ï¼š</p>
<h4 data-id="heading-8">ï¼ˆ1ï¼‰<code>fx.Supply</code> â€”â€” å¤–éƒ¨é…ç½®æ³¨å…¥</h4>
<pre><code class="hljs language-go" lang="go">fx.Supply(
  fx.Annotate(cfg, fx.As(<span class="hljs-built_in">new</span>(config.ConfigInterface))),
)
</code></pre>
<p>é…ç½®å¯¹è±¡ä½œä¸ºâ€œå¤–éƒ¨è¾“å…¥â€è¿›å…¥ç³»ç»Ÿå®¹å™¨ï¼Œè€Œä¸æ˜¯åœ¨å†…éƒ¨åˆ°å¤„è¯»å–é…ç½®æ–‡ä»¶ã€‚</p>
<h4 data-id="heading-9">ï¼ˆ2ï¼‰<code>fx.Provide</code> â€”â€” åŸºç¡€è®¾æ–½ç»Ÿä¸€æ³¨å†Œ</h4>
<p>åŒ…æ‹¬ï¼š</p>
<ul>
<li>Logger</li>
<li>Postgres</li>
<li>Redis</li>
<li>JWT</li>
<li>OAuth2ï¼ˆGithub / Googleï¼‰</li>
<li>Gin Router</li>
<li>API Router</li>
<li>OpenAPI Router</li>
<li>HTTP Server</li>
</ul>
<p>å…¨éƒ¨é›†ä¸­æ³¨å†Œåœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œå½¢æˆï¼š</p>
<blockquote>
<p>åŸºç¡€è®¾æ–½å±‚ç»Ÿä¸€åˆå§‹åŒ–ä¸­å¿ƒ</p>
</blockquote>
<p>ä¾‹å¦‚æ•°æ®åº“æ³¨å†Œï¼š</p>
<pre><code class="hljs language-go" lang="go">fx.Annotate(
  <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(cfg config.ConfigInterface, logger logger.Interface)</span></span> (*postgres.Postgres, <span class="hljs-type">error</span>) {
    pg, err := postgres.New(...)
    ...
    <span class="hljs-keyword">return</span> pg, <span class="hljs-literal">nil</span>
  },
  fx.OnStop(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(logger logger.Interface, pg *postgres.Postgres)</span></span> <span class="hljs-type">error</span> {
    pg.Close()
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
  }),
)
</code></pre>
<p>åŒæ—¶æŠŠ<strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ä¹Ÿç»‘å®šåœ¨æ³¨å†Œé˜¶æ®µå®Œæˆã€‚</p>
<h4 data-id="heading-10">ï¼ˆ3ï¼‰<code>modules.APIModule</code> â€”â€” ä¸šåŠ¡ç³»ç»Ÿæ•´ä½“æŒ‚è½½</h4>
<pre><code class="hljs">modules.APIModule,
</code></pre>
<p>ä¸šåŠ¡æ¨¡å—ä¸æ˜¯æ•£è½æ³¨å†Œï¼Œè€Œæ˜¯ä½œä¸ºä¸€ä¸ªå®Œæ•´æ¨¡å—æ ‘æŒ‚è½½è¿›ç³»ç»Ÿå®¹å™¨ã€‚</p>
<h4 data-id="heading-11">ï¼ˆ4ï¼‰<code>fx.Invoke(startHTTPServer)</code> â€”â€” å¯åŠ¨è¡Œä¸ºå£°æ˜</h4>
<pre><code class="hljs language-go" lang="go">fx.Invoke(startHTTPServer)
</code></pre>
<p>ç³»ç»Ÿâ€œå¯åŠ¨åšä»€ä¹ˆäº‹â€é€šè¿‡å£°æ˜å¼ç»‘å®šï¼š</p>
<ul>
<li>ä¸åœ¨ <code>main</code> é‡Œå†™å¯åŠ¨é€»è¾‘</li>
<li>ä¸åœ¨æ„é€ å‡½æ•°é‡Œå¯åŠ¨æœåŠ¡</li>
<li>ä¸é  init() éšå¼è¡Œä¸º</li>
</ul>
<p>è€Œæ˜¯é€šè¿‡ <code>Invoke</code> æ˜¾å¼å£°æ˜ç³»ç»Ÿå¯åŠ¨åŠ¨ä½œã€‚</p>
<p>é…åˆ <code>Lifecycle</code>ï¼š</p>
<pre><code class="hljs language-php" lang="php">lc.<span class="hljs-title function_ invoke__">Append</span>(fx.Hook{
  <span class="hljs-attr">OnStart</span>: ...
  <span class="hljs-attr">OnStop</span>:  ...
})
</code></pre>
<p>å½¢æˆå®Œæ•´çš„ï¼š</p>
<blockquote>
<p>æ„å»ºæœŸï¼ˆProvideï¼‰ â†’ è£…é…æœŸï¼ˆModuleï¼‰ â†’ å¯åŠ¨æœŸï¼ˆInvokeï¼‰ â†’ ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆLifecycleï¼‰</p>
</blockquote>
<p>è¿™ä½¿æ•´ä¸ªç³»ç»Ÿä»â€œè¿‡ç¨‹å¼å¯åŠ¨â€å˜æˆäº†<strong>å£°æ˜å¼å¯åŠ¨æ¨¡å‹</strong>ã€‚</p>
<p>ä¸æ˜¯â€œæˆ‘åœ¨ main é‡Œæ‰‹åŠ¨æ§åˆ¶é¡ºåºâ€ï¼Œè€Œæ˜¯ï¼š</p>
<blockquote>
<p>ç³»ç»Ÿç»“æ„å†³å®šå¯åŠ¨é¡ºåº</p>
</blockquote>
<blockquote>
<p>ä¾èµ–å…³ç³»å†³å®šåˆå§‹åŒ–é¡ºåº</p>
</blockquote>
<p>Fx åœ¨è¿™é‡Œæ›´åƒæ˜¯ä¸€ä¸ªï¼š<strong>å·¥ç¨‹å¯åŠ¨è°ƒåº¦æ¡†æ¶</strong>ï¼Œè€Œä¸ä»…æ˜¯ä¾èµ–æ³¨å…¥å·¥å…·ã€‚</p>
<h3 data-id="heading-12">2. æ¨¡å—åŒ–æ³¨å†Œæ–¹å¼ï¼ˆä¸šåŠ¡æ¨¡å—å³è·¯ç”±å•å…ƒï¼‰</h3>
<p>åœ¨è¿™ä¸ªé¡¹ç›®é‡Œï¼Œ<strong>æ¨¡å—ä¸ä»…æ˜¯ä¸šåŠ¡å•å…ƒï¼ŒåŒæ—¶ä¹Ÿæ˜¯è·¯ç”±æ³¨å†Œå•å…ƒ</strong>ã€‚</p>
<p>æ¯ä¸ªä¸šåŠ¡æ¨¡å—éƒ½æœ‰è‡ªå·±çš„ <code>module.go</code>ï¼Œä¸ä»…è´Ÿè´£ä¾èµ–æ³¨å†Œï¼Œä¹Ÿè´Ÿè´£è·¯ç”±æŒ‚è½½ï¼Œä¾‹å¦‚ <code>user.module.go</code>ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> Module = fx.Module(
  <span class="hljs-string">"user"</span>,

  fx.Provide(
    <span class="hljs-comment">// user repository</span>
    fx.Annotate(
      NewUserRepository,
      fx.As(<span class="hljs-built_in">new</span>(UserRepository)),
    ),
    <span class="hljs-comment">// user service</span>
    fx.Annotate(
      NewUserService,
      fx.As(<span class="hljs-built_in">new</span>(UserService)),
    ),
    <span class="hljs-comment">// user controller</span>
    NewUserController,
  ),

  <span class="hljs-comment">// register router</span>
  fx.Invoke(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(
    router api_router.APIRouterParams,
    userController *UserController,
  )</span></span> {
    <span class="hljs-comment">// public routers</span>
    {
      userGroup := router.Public.Group(<span class="hljs-string">"/users"</span>)
      userGroup.POST(<span class="hljs-string">""</span>, userController.CreateOne)
    }

    <span class="hljs-comment">// private routers</span>
    {
      userGroup := router.Private.Group(<span class="hljs-string">"/users"</span>)
      userGroup.GET(<span class="hljs-string">":id"</span>, userController.GetById)
    }
  }),
)
</code></pre>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„è®¾è®¡ç‚¹ï¼š</p>
<blockquote>
<p><strong>è·¯ç”±æ³¨å†Œè·Ÿç€ä¸šåŠ¡æ¨¡å—èµ°ï¼Œè€Œä¸æ˜¯é›†ä¸­åœ¨ router ç›®å½•ç»Ÿä¸€ç®¡ç†ã€‚</strong></p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼š</p>
<ul>
<li>ä¸€ä¸ªæ¨¡å— = ä¸€ç»„ä¸šåŠ¡èƒ½åŠ›</li>
<li>ä¸€ä¸ªæ¨¡å— = ä¸€ç»„è·¯ç”±å®šä¹‰</li>
<li>ä¸€ä¸ªæ¨¡å— = ä¸€ç»„ Controller + Service + Repository</li>
</ul>
<p>æ¨¡å—æœ¬èº«å°±æ˜¯ä¸€ä¸ª<strong>å®Œæ•´ä¸šåŠ¡é—­ç¯å•å…ƒ</strong>ã€‚</p>
<p>è¿™æ ·å¸¦æ¥çš„æ•ˆæœéå¸¸ç›´è§‚ï¼š</p>
<ul>
<li>æ–°å¢åŠŸèƒ½ = æ–°å¢æ¨¡å—</li>
<li>åˆ é™¤åŠŸèƒ½ = åˆ é™¤æ¨¡å—</li>
<li>æŸ¥åŠŸèƒ½ = æŸ¥æ¨¡å—</li>
</ul>
<p>è€Œä¸æ˜¯åœ¨ <code>router.go</code> é‡Œç¿»å‡ åä¸ªè·¯ç”±å®šä¹‰æ–‡ä»¶ã€‚</p>
<p>ä»å·¥ç¨‹ä½“éªŒä¸Šæ¥è¯´ï¼Œè¿™ç§æ–¹å¼éå¸¸æ¥è¿‘ NestJS çš„ Module + Controller ç»„ç»‡æ¨¡å¼ï¼Œåªä¸è¿‡æ˜¯ç”¨ Fx çš„ Module æœºåˆ¶å®ç°ã€‚</p>
<hr/>
<h3 data-id="heading-13">3. è·¯ç”±ç³»ç»Ÿçš„åˆå§‹åŒ–è§£è€¦è®¾è®¡</h3>
<p><code>internal/router</code> ç›®å½•åªè´Ÿè´£ä¸€ä»¶äº‹ï¼š<strong>Gin æœ¬èº«çš„åˆå§‹åŒ–ä¸ä¸­é—´ä»¶è£…é…</strong>ï¼Œä¸å…³å¿ƒä»»ä½•ä¸šåŠ¡è·¯ç”±ã€‚</p>
<h4 data-id="heading-14">Gin åˆå§‹åŒ–ï¼ˆç³»ç»Ÿå±‚ï¼‰</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewRouter</span><span class="hljs-params">(
  cfg config.ConfigInterface,
  logger logger.Interface,
)</span></span> *gin.Engine {
  app := gin.Default()

  <span class="hljs-comment">// middlewares</span>
  app.Use(requestid.New())
  app.Use(cors.New(...))
  app.Use(ginzap.GinzapWithConfig(...))
  app.Use(ginzap.RecoveryWithZap(...))
  app.Use(timeout.Timeout(...))
  app.Use(middleware.ErrorHandler(logger))

  <span class="hljs-comment">// Swagger</span>
  <span class="hljs-keyword">if</span> cfg.Swagger().Enabled {
    app.GET(<span class="hljs-string">"/swagger/*any"</span>, ginSwagger.WrapHandler(swaggerfiles.Handler))
  }

  <span class="hljs-keyword">return</span> app
}
</code></pre>
<p>è¿™ä¸€å±‚åªåšç³»ç»Ÿçº§èƒ½åŠ›ï¼š</p>
<ul>
<li>ä¸­é—´ä»¶è£…é…</li>
<li>æ—¥å¿—ç³»ç»Ÿ</li>
<li>è·¨åŸŸ</li>
<li>è¶…æ—¶æ§åˆ¶</li>
<li>Swagger</li>
</ul>
<p>å®Œå…¨ä¸å‡ºç°ä»»ä½•ä¸šåŠ¡è·¯ç”±ã€‚</p>
<h4 data-id="heading-15">API Router æŠ½è±¡å±‚</h4>
<p>é€šè¿‡ Fx æ„é€  API Routerï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> APIRouter <span class="hljs-keyword">struct</span> {
  fx.Out

  Public  *gin.RouterGroup <span class="hljs-string">`name:"api:public"`</span>
  Private *gin.RouterGroup <span class="hljs-string">`name:"api:private"`</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewAPIRouter</span><span class="hljs-params">(
  cfg config.ConfigInterface,
  jwt jwt.JWTManagerInterface,
  app *gin.Engine,
)</span></span> APIRouter {
  public := app.Group(<span class="hljs-string">"/api/v1"</span>)
  private := public.Group(<span class="hljs-string">"/"</span>)

  private.Use(middleware.APIAuthHandler(jwt, cfg.HTTP().CookieName))

  <span class="hljs-keyword">return</span> APIRouter{
    Public:  public,
    Private: private,
  }
}
</code></pre>
<p>é€šè¿‡ <code>fx.Out</code> + <code>name tag</code>ï¼š</p>
<ul>
<li>ç³»ç»Ÿçº§ Router è´Ÿè´£åˆ†ç»„</li>
<li>æ¨¡å—çº§ Router åªæ¶ˆè´¹åˆ†ç»„</li>
</ul>
<p>ä¸šåŠ¡æ¨¡å—åªå…³å¿ƒï¼š</p>
<pre><code class="hljs language-go" lang="go">router.Public
router.Private
</code></pre>
<p>è€Œä¸å…³å¿ƒï¼š</p>
<ul>
<li>Gin Engine ä»å“ªé‡Œæ¥</li>
<li>ä¸­é—´ä»¶æ€ä¹ˆè£…</li>
<li>JWT é‰´æƒæ€ä¹ˆæŒ‚</li>
</ul>
<p>å½¢æˆæ¸…æ™°åˆ†å±‚ï¼š</p>
<blockquote>
<p>ç³»ç»Ÿå±‚ï¼šRouter åˆå§‹åŒ– + ä¸­é—´ä»¶ + åˆ†ç»„ç­–ç•¥<br/>
æ¨¡å—å±‚ï¼šæ¶ˆè´¹ RouterGroupï¼Œæ³¨å†Œä¸šåŠ¡è·¯ç”±</p>
</blockquote>
<p>è¿™è®©æ•´ä¸ªç³»ç»Ÿçš„è·¯ç”±ç»„ç»‡æ–¹å¼å˜æˆï¼š</p>
<blockquote>
<p>ç³»ç»Ÿæä¾›â€œè·¯ç”±èƒ½åŠ›â€<br/>
æ¨¡å—å£°æ˜â€œè·¯ç”±è¡Œä¸ºâ€</p>
</blockquote>
<p>è€Œä¸æ˜¯ä¼ ç»Ÿçš„ï¼š</p>
<blockquote>
<p>ä¸€ä¸ª router ç›®å½•ç®¡ç†å…¨ä¸–ç•Œè·¯ç”±</p>
</blockquote>
<p>æ¯ä¸ªä¸šåŠ¡æ¨¡å—éƒ½æœ‰è‡ªå·±çš„ <code>module.go</code>ï¼Œç±»ä¼¼ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> Module = fx.Module(
  <span class="hljs-string">"user"</span>,
  fx.Provide(
    NewUserService,
    NewUserRepository,
    NewUserController,
  ),
)
</code></pre>
<p>æ¨¡å—åªå…³å¿ƒï¼š</p>
<ul>
<li>è‡ªå·±æä¾›ä»€ä¹ˆèƒ½åŠ›</li>
<li>è‡ªå·±ä¾èµ–ä»€ä¹ˆèƒ½åŠ›</li>
</ul>
<p>ä¸å…³å¿ƒï¼š</p>
<ul>
<li>è°æ¥è°ƒç”¨æˆ‘</li>
<li>è°å…ˆå¯åŠ¨ç³»ç»Ÿ</li>
</ul>
<h3 data-id="heading-16">3. è·¯ç”±æ³¨å†Œè§£è€¦</h3>
<p>è·¯ç”±å±‚é€šè¿‡ <code>fx.Invoke</code> ç»Ÿä¸€æ³¨å†Œï¼š</p>
<pre><code class="hljs language-go" lang="go">fx.Invoke(RegisterRouter)
</code></pre>
<p>Router å±‚åªä¾èµ– Controllerï¼Œä¸åå‘ä¾èµ–ä¸šåŠ¡æ¨¡å—å®ç°ï¼Œå½¢æˆæ¸…æ™°ä¾èµ–æ–¹å‘ã€‚</p>
<h3 data-id="heading-17">4. ç”Ÿå‘½å‘¨æœŸç»Ÿä¸€ç®¡ç†</h3>
<p>é€šè¿‡ Fx çš„ <code>Lifecycle</code> æœºåˆ¶ç»Ÿä¸€ç®¡ç†æœåŠ¡ç”Ÿå‘½å‘¨æœŸï¼š</p>
<pre><code class="hljs language-go" lang="go">lc.Append(fx.Hook{
  OnStart: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context)</span></span> <span class="hljs-type">error</span> {
    <span class="hljs-keyword">return</span> server.Start()
  },
  OnStop: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context)</span></span> <span class="hljs-type">error</span> {
    <span class="hljs-keyword">return</span> server.Stop()
  },
})
</code></pre>
<p>è¿™è®©ï¼š</p>
<ul>
<li>æœåŠ¡å¯åŠ¨é¡ºåºå¯æ§</li>
<li>èµ„æºåˆå§‹åŒ–æœ‰åº</li>
<li>æ”¯æŒä¼˜é›…å…³é—­</li>
<li>ç³»ç»ŸçŠ¶æ€ç»Ÿä¸€ç®¡ç†</li>
</ul>
<p>åœ¨å®é™…ä½¿ç”¨ä¸­ï¼ŒFx å¸¦æ¥çš„æœ€å¤§ä»·å€¼ä¸æ˜¯â€œçœå‡ è¡Œä»£ç â€ï¼Œè€Œæ˜¯ï¼š</p>
<blockquote>
<p>æŠŠç³»ç»Ÿç»“æ„ä»â€œæ‰‹åŠ¨ç»„ç»‡â€å˜æˆâ€œå£°æ˜å¼ç»„ç»‡â€</p>
</blockquote>
<p>ç³»ç»Ÿä»â€œäººè„‘è°ƒåº¦â€å˜æˆâ€œç³»ç»Ÿè°ƒåº¦â€ã€‚</p>
<hr/>
<h2 data-id="heading-18">å…­ã€æ¨¡å—åŒ–çš„çœŸå®ä½“éªŒ</h2>
<p>æ¨¡å—åŒ–ä¹‹åï¼Œä¸€ä¸ªå¾ˆç›´è§‚çš„æ„Ÿå—æ˜¯ï¼š</p>
<ul>
<li>æ¨¡å—è¾¹ç•Œæ¸…æ™°</li>
<li>æ”¹ä»£ç ä¸å®¹æ˜“è¯¯ä¼¤å…¶ä»–æ¨¡å—</li>
<li>é‡æ„æ›´å®‰å…¨</li>
<li>ä¾èµ–å…³ç³»æ›´æ¸…æ¥š</li>
</ul>
<p>æ¨¡å—ä¸å†æ˜¯â€œæ–‡ä»¶åˆ†ç±»â€ï¼Œè€Œæ˜¯<strong>ä¸šåŠ¡å•å…ƒ</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-19">ä¸ƒã€è¿™å¥—ç»“æ„å¸¦æ¥çš„çœŸå®å˜åŒ–</h2>
<p>ç”¨è¿™å¥—ç»“æ„å†™é¡¹ç›®ä¹‹åï¼Œæœ€å¤§çš„å˜åŒ–ä¸æ˜¯â€œå†™å¾—æ›´å¿«â€ï¼Œè€Œæ˜¯ï¼š</p>
<ul>
<li>é¡¹ç›®ç»“æ„æ›´ç¨³</li>
<li>ç»´æŠ¤å‹åŠ›æ›´å°</li>
<li>é‡æ„æˆæœ¬æ›´ä½</li>
<li>æ–°äººæ›´å®¹æ˜“ç†è§£é¡¹ç›®</li>
<li>å¿ƒç†è´Ÿæ‹…æ›´å°ï¼ˆç¬‘ï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-20">å…«ã€å†™åœ¨æœ€å</h2>
<p><code>gin-app</code> å¯¹æˆ‘æ¥è¯´ï¼Œä¸æ˜¯ä¸€ä¸ªâ€œä½œå“â€ï¼Œè€Œæ›´åƒæ˜¯ï¼š</p>
<blockquote>
<p>ä¸€å¥—åœ¨çœŸå®é¡¹ç›®ä¸­ä¸æ–­è¯•é”™ã€è°ƒæ•´ã€æ¼”åŒ–å‡ºæ¥çš„å·¥ç¨‹ç»“æ„</p>
</blockquote>
<p>å®ƒä¸æ˜¯æ ‡å‡†ç­”æ¡ˆï¼Œä¹Ÿä¸æ˜¯æœ€ä½³å®è·µï¼Œåªæ˜¯ä¸€ä¸ªï¼š</p>
<blockquote>
<p>å½“å‰é˜¶æ®µè®©æˆ‘ç”¨èµ·æ¥æœ€èˆ’æœçš„ä¸€ç§ Go å·¥ç¨‹ç»„ç»‡æ–¹å¼</p>
</blockquote>
<p>å¦‚æœä½ ä¹Ÿåœ¨åš Go é¡¹ç›®å·¥ç¨‹åŒ–ï¼Œå¯èƒ½ä½ ä¹Ÿä¼šé‡åˆ°ç±»ä¼¼çš„é—®é¢˜ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« åªæ˜¯ä¸€æ¬¡ä¸ªäººå®è·µåˆ†äº«ï¼Œå¸Œæœ›èƒ½æä¾›ä¸€äº›æ€è·¯å‚è€ƒï¼Œè€Œä¸æ˜¯èŒƒå¼æ ‡å‡†ã€‚</p>
<hr/>
<h2 data-id="heading-21">é¡¹ç›®åœ°å€</h2>
<p>GitHubï¼š<br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F1111mp%2Fgin-app" target="_blank" title="https://github.com/1111mp/gin-app" ref="nofollow noopener noreferrer">github.com/1111mp/gin-â€¦</a></p>
<hr/>
<blockquote>
<p>å¦‚æœä½ ä¹Ÿåœ¨åš Go å·¥ç¨‹åŒ–æ¢ç´¢ï¼Œæ¬¢è¿äº¤æµå®è·µç»éªŒ ğŸ™Œ</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[çº¿ç¨‹æ± ç”¨å®Œä¸Shutdownï¼ŒCPUå’Œå†…å­˜éƒ½å¿«å“­äº†]]></title>    <link>https://juejin.cn/post/7603771025856593971</link>    <guid>https://juejin.cn/post/7603771025856593971</guid>    <pubDate>2026-02-08T06:52:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603771025856593971" data-draft-id="7603687444052115494" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="çº¿ç¨‹æ± ç”¨å®Œä¸Shutdownï¼ŒCPUå’Œå†…å­˜éƒ½å¿«å“­äº†"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-08T06:52:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Javaç¼–ç¨‹çˆ±å¥½è€…"/> <meta itemprop="url" content="https://juejin.cn/user/819554264300154"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            çº¿ç¨‹æ± ç”¨å®Œä¸Shutdownï¼ŒCPUå’Œå†…å­˜éƒ½å¿«å“­äº†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/819554264300154/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Javaç¼–ç¨‹çˆ±å¥½è€…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T06:52:28.000Z" title="Sun Feb 08 2026 06:52:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>å‰è¨€</strong></h2>
<p>å¤§å®¶å¹³å¸¸ä½¿ç”¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3DSpringBoot%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=SpringBoot&amp;zhida_source=entity" ref="nofollow noopener noreferrer">SpringBoot</a>è¿›è¡ŒWebé¡¹ç›®å¼€å‘ï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3D%25E7%25BA%25BF%25E7%25A8%258B%25E6%25B1%25A0%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=%E7%BA%BF%E7%A8%8B%E6%B1%A0&amp;zhida_source=entity" ref="nofollow noopener noreferrer">çº¿ç¨‹æ± </a>ä¼šè¢«é…ç½®æˆä¸ºå…¨å±€å¯å¤ç”¨çš„å·¥å…·ï¼Œç”Ÿå‘½å‘¨æœŸéšæœåŠ¡å¯åŠ¨å¼€å§‹ï¼Œåˆ°æœåŠ¡åœæ­¢å³ç»“æŸã€‚è¿™ç§â€œ<strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3D%25E7%25BA%25BF%25E7%25A8%258B%25E6%25B1%25A0%25E6%2589%2598%25E7%25AE%25A1%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=%E7%BA%BF%E7%A8%8B%E6%B1%A0%E6%89%98%E7%AE%A1&amp;zhida_source=entity" ref="nofollow noopener noreferrer">çº¿ç¨‹æ± æ‰˜ç®¡</a></strong>â€æ¨¡å¼ï¼Œè®©å¤šå°‘å…„å¼Ÿäº§ç”Ÿç¾ä¸½çš„é”™è§‰ ï¼šâ€œåŸæ¥çº¿ç¨‹æ± ä¼šè‡ªå·±ç®¡ç†è‡ªå·±å•Šï¼â€</p>
<p>ä½†æ˜¯ï¼Œå½“éœ€æ±‚ç»ç†å¯¹ä½ éœ²å‡ºç¥ç§˜çš„å¾®ç¬‘ï¼šâ€œè¿™ä¸ªæ‰¹é‡å¯¼å‡ºéœ€æ±‚ï¼Œä»Šæ™šå°±è¦...â€ã€‚ä½ ä¸å¾—ä¸æ’¸èµ·è¢–å­ï¼Œå†™ä¸‹äº†ç½ªæ¶çš„ä»£ç åˆ›å»ºä¸´æ—¶çº¿ç¨‹æ± ï¼Œè¿™æ—¶å…„å¼Ÿä»¬ï¼Œå¦‚æœå¯¹çº¿ç¨‹æ± ä½¿ç”¨ä¸å½“ï¼Œå¾ˆå®¹æ˜“ç»™æœåŠ¡åŸ‹ä¸‹éšæ‚£ ã€‚</p>
<h2 data-id="heading-1"><strong>1 é—®é¢˜åˆç°</strong></h2>
<h3 data-id="heading-2"><strong>1.1 ç¤ºä¾‹ä»£ç </strong></h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/806758f53acb433f8ab961a2b8bb0b9b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=OtgSIADCBnLAOodNWffoPlxGgcg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3"><strong>1.2 é—®é¢˜æè¿°</strong></h3>
<p><strong>é¢è¯•å®˜ï¼š</strong> ä¸è€ƒè™‘ä»»åŠ¡å†…éƒ¨çš„å¤æ‚åº¦ï¼Œè¿™ä¸ªçº¿ç¨‹æ± çš„ä½¿ç”¨ä¼šæœ‰é—®é¢˜å—ï¼Ÿ</p>
<p><strong>èœé¸Ÿï¼š</strong> æ–¹æ³•æ‰§è¡Œå®Œå¼¹æ ˆåï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%25B1%2580%25E9%2583%25A8%25E5%258F%2598%25E9%2587%258F%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F&amp;zhida_source=entity" ref="nofollow noopener noreferrer">å±€éƒ¨å˜é‡</a>ï¼Œéƒ½ä¼šè¢«GCå›æ”¶ï¼Œè°å†™çš„ä»£ç ï¼Œç¨³å¾—å¾ˆå•Šï¼</p>
<p><strong>è€é¸Ÿï¼š</strong> ï¼ˆä¸€å£å’–å•¡å–·å±å¹•ä¸Šï¼‰è€å¼Ÿï¼Œä½ çº¿ç¨‹æ± ç”¨å®Œä¸ç”¨shutdownå‘€ï¼Ÿ</p>
<p>===========</p>
<p><strong>å†é—®ï¼šåæ­£ä»»åŠ¡æ‰§è¡Œå®Œï¼Œå†…å­˜éƒ½ä¼šè¢«GCå›æ”¶ï¼Œéå¾—Shutdownä¸€ä¸‹ä¸å¤šä½™å—ï¼Ÿ</strong></p>
<p><strong>èœé¸Ÿï¼š</strong> ......</p>
<p><strong>è€é¸Ÿï¼š</strong> ï¼ˆé‚ªé­…ä¸€ç¬‘ï¼‰å€’ä¹Ÿä¸æ˜¯å¿…é¡»Shutdownï¼Œä½†æ˜¯ä¸å»ºè®®çŠ¯é™©å°è¯•ï¼Œè¯·çœ‹VCRæ¼”ç¤ºï¼ˆä»£ç æ¼”ç¤ºï¼‰</p>
<h2 data-id="heading-4"><strong>2 èµ°è¿›ç§‘å­¦å®éªŒç°åœºï¼ˆéªŒè¯)</strong></h2>
<blockquote>
<p><strong>è¯´æ˜</strong>ï¼šæœ¬æ–‡è®¨è®ºçš„çº¿ç¨‹æ± å¯¹è±¡åŠç›¸å…³æºç ï¼Œéƒ½å›´ç»•å¸¸ç”¨çš„java.util.concurrent.ThreadPoolExecutorç±»å±•å¼€ï¼Œä¸‹æ–‡ä¸å†é¢å¤–è¯´æ˜</p>
</blockquote>
<h3 data-id="heading-5"><strong>2.2 è£…å¤‡è¯´æ˜ï¼ˆä»£ç ï¼‰</strong></h3>
<p>âš ï¸Â <strong>è­¦ å‘Š</strong> ï¼šç´§æ¥ç€å°†å‡ºç°å¤§é‡æºç è§£æï¼Œå¯èƒ½å¼•èµ·è½»å¾®ä¸é€‚ã€‚</p>
<blockquote>
<p><strong>è¯´æ˜</strong>ï¼šä»¥ä¸‹ä»£ç éƒ½æ˜¯åœ¨ä¸€ä¸ªç±»ä¸­ï¼Œqueueã€phantomRefè¿™ä¸¤ä¸ªå¯¹è±¡æ˜¯ä½œä¸ºå…¨å±€å¯¹è±¡ï¼Œä¸“é—¨æ•æ‰é‚£ä¸ª"è‚‰èº«å·²æ­»ä½†é˜´é­‚ä¸æ•£"çš„çº¿ç¨‹æ± å¯¹è±¡ã€‚</p>
</blockquote>
<p><strong>2.2.1 å¹½çµæ¢æµ‹ä»ªï¼ˆåˆ¤æ–­çº¿ç¨‹æ± å¯¹è±¡æ˜¯å¦è¢«å›æ”¶)</strong></p>
<p>å› ä¸ºéªŒè¯çš„ä»£ç æ˜¯åœ¨ä¸€ä¸ªæˆç†Ÿçš„SpringBooté¡¹ç›®ä¸­è·‘çš„ï¼Œçº¿ç¨‹æ± å¯¹è±¡å¤ªå¤šäº†ï¼Œä»å†…å­˜åˆ†æå·¥å…·ä¸Šç›‘æµ‹è¿™å•ä¸ªçº¿ç¨‹æ± å¯¹è±¡æ˜¯å¦è¢«GCå›æ”¶ä¸å¤Ÿç›´è§‚ï¼Œè¿™é‡Œå€ŸåŠ©<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3D%25E8%2599%259A%25E5%25BC%2595%25E7%2594%25A8%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=%E8%99%9A%E5%BC%95%E7%94%A8&amp;zhida_source=entity" ref="nofollow noopener noreferrer">è™šå¼•ç”¨</a>æ¥åˆ¤æ–­çº¿ç¨‹æ± å¯¹è±¡æ˜¯å¦è¢«å›æ”¶ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f97518c695f425baa555668a97daca8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=gnj34fOpOeQMhG8KSl92zgN09I4%3D" alt="" loading="lazy"/></p>
<p><strong>2.2.2 å®éªŒ1ï¼šcore 0ï¼Œmax 100 ä»»åŠ¡å®Œæˆåï¼Œä¸è¿›è¡Œshutdown</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30f051d9361745848f80f80d62757217~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=dMDy%2BfzFkIAe7dHFz5K6NlfVsqw%3D" alt="" loading="lazy"/></p>
<p><strong>2.2.3 å®éªŒ2ï¼šcore 0ï¼Œmax 100 ä»»åŠ¡å®Œæˆåï¼Œè¿›è¡Œshutdown</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e649d955b88c4675a8c8bd8cf6664a22~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=R7YMvsK7ewcdISdDfl53zgmR7tk%3D" alt="" loading="lazy"/></p>
<p><strong>2.2.4 å®éªŒ3ï¼šcore 100ï¼Œmax 100 ä»»åŠ¡å®Œæˆåï¼Œä¸è¿›è¡Œshutdown</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cffac05c8a2412db8144327b6a211fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=5OTUMfaWOiIyOUzxsybVHiIq3R8%3D" alt="" loading="lazy"/></p>
<p><strong>2.2.5 å®éªŒ4ï¼šcore 100ï¼Œmax 100 ä»»åŠ¡å®Œæˆåï¼Œè¿›è¡Œshutdown</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d47b3a408210415d99446b513115148c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=OUlvqmV4Jf4HhebQKmGhDkbgUWw%3D" alt="" loading="lazy"/></p>
<p><strong>2.2.6 ä»»åŠ¡æ‰§è¡Œä»£ç ç¤ºä¾‹</strong></p>
<p><strong>è§£é‡Šè¯´æ˜ï¼š</strong></p>
<p>ä»»åŠ¡æ•°é‡æ˜¯110ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä¿è¯æœ‰è¶³å¤Ÿå¤šçš„ä»»åŠ¡è®©çº¿ç¨‹æ± æ‰€æœ‰çº¿ç¨‹èƒ½å¤Ÿæ‰“æ»¡ï¼›ä»»åŠ¡é‡Œé¢è¦sleep 500msï¼Œä¹Ÿæ˜¯åŒæ ·çš„é“ç†</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1925b9232ba541f5bd7893a55ef6c6cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=bkyaOViCgHvth0dlCtgBz5wKAes%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6"><strong>2.3 å®éªŒæ‰§è¡Œç»“æœ</strong></h3>
<p><strong>2.3.1 å®éªŒæ‰§è¡Œæ­¥éª¤</strong></p>
<p>é¡¹ç›®å¯åŠ¨åï¼Œä¾æ¬¡æ‰§è¡Œä¸Šè¿°4ä¸ªå®éªŒã€‚éœ€è¦æ³¨æ„çš„æ˜¯æ—¶é—´é—´éš”è¦ä¿è¯å‰ä¸€ä¸ªå®éªŒçš„ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œï¼Œæœ€å¥½å†ç•™ä¸€äº›ç©ºæŒ¡ï¼Œè¿™æ ·ç›‘æ§æ›´æ¸…æ™°</p>
<p>æ¯ä¸ªå®éªŒæ‰§è¡Œå®Œåï¼Œåˆ†åˆ«æ‰§è¡Œä¸€æ¬¡2.2.1 åˆ¤æ–­çº¿ç¨‹æ± å¯¹è±¡æ˜¯å¦å›æ”¶</p>
<p><strong>2.3.2 ç»“æœåˆ†æ</strong></p>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3DJVM%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=JVM&amp;zhida_source=entity" ref="nofollow noopener noreferrer">JVM</a>åˆå§‹çŠ¶æ€</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9e895c3c92b4940aa3974e72e78c8bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=zVLitQZhDfgE0%2B4Ca67RSMYTxAs%3D" alt="" loading="lazy"/></p>
<p>1.Â <strong>å®éªŒ1æ‰§è¡Œç›‘æ§</strong></p>
<p>core 0ï¼Œmax 100 ä»»åŠ¡å®Œæˆåï¼Œä¸è¿›è¡Œshutdown</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3e22d687ea14a07a6290204a10f79b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=59xOR3kyDR2654pQfDP8pIBVato%3D" alt="" loading="lazy"/></p>
<p>2.Â <strong>å®éªŒ2æ‰§è¡Œç›‘æ§</strong></p>
<p>core 0ï¼Œmax 100 ä»»åŠ¡å®Œæˆåï¼Œè¿›è¡Œshutdown</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ab80c0e84b849c1a2e1f638bf5774cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=sHtcQ7AxzY7XE2bjpBrcBhkQyck%3D" alt="" loading="lazy"/></p>
<p>3.Â <strong>å®éªŒ3æ‰§è¡Œç›‘æ§</strong></p>
<p>core 100ï¼Œmax 100 ä»»åŠ¡å®Œæˆåï¼Œä¸è¿›è¡Œshutdown</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a077c5114484eaabb501e0c6b643d2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=mjclYoEvREyRAYkg0AP%2FVSnETCc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e04985847703446488554e0594f42b7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=UpPpi%2FGiXxv2Z%2B1vQGs%2BYKEcYPo%3D" alt="" loading="lazy"/></p>
<p>4.Â <strong>å®éªŒ4æ‰§è¡Œç›‘æ§</strong></p>
<p>core 100ï¼Œmax 100 ä»»åŠ¡å®Œæˆåï¼Œè¿›è¡Œshutdown</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1efdeab66fd74b0ca1a5bcfa439c1618~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=T1Kv%2F6vTF2BppYHQ6u%2FMnBfrsDg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7"><strong>3 åŸå› è§£å‰–å®¤</strong></h2>
<p><strong>æ¥ä¸‹æ¥éƒ½æ˜¯å¯¹å®éªŒ3çš„å¼‚å¸¸ç°è±¡è¿›è¡Œçš„åˆ†æ</strong></p>
<h3 data-id="heading-8"><strong>3.1 shutdownçš„äº”æ­¥æ‹†è§£æ³•</strong></h3>
<p>é¦–å…ˆçœ‹ä¸‹ThreadPoolExecutor#shutdownæ–¹æ³•</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a785cda4800b48069a7dd793a0780e74~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=z0AhwGEexSUCqel2IYFOlS%2BQmrk%3D" alt="" loading="lazy"/></p>
<p>æˆªå›¾ä¸­ï¼Œå¯ä»¥çœ‹åˆ°shutdownæ–¹æ³•é‡Œé¢ï¼Œä¸»è¦åšäº†5ä¸ªåŠ¨ä½œï¼š</p>
<ol>
<li>
<p>æ ¹æ®æ–¹æ³•åç§°å¯ä»¥çœ‹å‡ºæ˜¯ä¸€ä¸ªæ£€æŸ¥åŠ¨ä½œï¼Œè¿™é‡Œä¸ç”¨ç»†çœ‹</p>
</li>
<li>
<p>æŠŠçº¿ç¨‹æ± çŠ¶æ€ç½®ä¸ºSHUTDOWNçŠ¶æ€<strong>é‡è¦</strong></p>
</li>
<li>
<p>æ ¹æ®æ–¹æ³•åç§°å¯ä»¥çœ‹å‡ºæ˜¯å°†çº¿ç¨‹æ± ä¸­çš„ç©ºé—²çº¿ç¨‹è¿›è¡Œä¸­æ–­Â <strong>é‡è¦</strong></p>
</li>
<li>
<p>æ ¹æ®æ³¨é‡Šæ¥çœ‹ï¼Œæ˜¯ç»™ç‰¹å®šåœºæ™¯å¯¹è±¡ä½¿ç”¨ï¼Œè¿™é‡Œä¸ç”¨ç»†çœ‹</p>
</li>
<li>
<p>å°è¯•ç»ˆæ­¢çº¿ç¨‹æ± ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3D%25E4%25B8%25AD%25E6%2596%25AD%25E7%25BA%25BF%25E7%25A8%258B%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=%E4%B8%AD%E6%96%AD%E7%BA%BF%E7%A8%8B&amp;zhida_source=entity" ref="nofollow noopener noreferrer">ä¸­æ–­çº¿ç¨‹</a>ã€å…³é—­çº¿ç¨‹æ± ï¼‰</p>
</li>
</ol>
<p>æ¯ä¸€æ­¥çš„ç»†èŠ‚å¤„ç†ï¼Œè¿™é‡Œå°±ä¸å¸¦å¤§å®¶çœ‹äº†ï¼Œæœ‰å…´è¶£å¯ä»¥ç‚¹å¼€æºç ä¸€æ­¥æ­¥ç ”ç©¶ä¸‹ã€‚<strong>æ€»ç»“ä¸‹æ¥å°±æ˜¯ï¼Œçº¿ç¨‹æ± æ‰§è¡Œshutdownæ–¹æ³•åï¼š</strong></p>
<ol>
<li>çº¿ç¨‹æ± å¯¹è±¡ç½®ä¸ºSHUTDOWNçŠ¶æ€â€”â€”<strong>æŒ‚ä¸Šâ€œæš‚åœè¥ä¸šâ€ç‰Œå­</strong></li>
<li>å°†çº¿ç¨‹æ± ä¸­ç©ºé—²çº¿ç¨‹ç½®ä¸ºä¸­æ–­çŠ¶æ€ï¼Œæœ€ç»ˆä»çº¿ç¨‹æ± ä¸­å‰”é™¤(ä¼šè¢«GCå›æ”¶)â€”â€”<strong>ç»™é—²é€›çš„çº¿ç¨‹å‘ã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3D%25E8%25A7%25A3%25E8%2581%2598%25E9%2580%259A%25E7%259F%25A5%25E4%25B9%25A6%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=%E8%A7%A3%E8%81%98%E9%80%9A%E7%9F%A5%E4%B9%A6&amp;zhida_source=entity" ref="nofollow noopener noreferrer">è§£è˜é€šçŸ¥ä¹¦</a>ã€‹</strong></li>
<li>çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¯¹è±¡ä¼šç½®ä¸ºä¸­æ–­çŠ¶æ€ï¼Œæœ€ç»ˆterminated</li>
</ol>
<h3 data-id="heading-9"><strong>3.2 ä¸ºä»€ä¹ˆçº¿ç¨‹æ± ä¸è¿›è¡Œshutdownï¼Œåœ¨æ–¹æ³•å¼¹æ ˆåä¸ä¼šç«‹å³è¢«GCå›æ”¶ï¼Ÿ</strong></h3>
<p>é¦–å…ˆæˆ‘ä»¬æ¢³ç†ä¸€ä¸‹å½“å‰æ‰§è¡Œå®éªŒçš„çº¿ç¨‹æ–¹æ³•æ ˆã€çº¿ç¨‹æ± ã€çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä¹‹é—´çš„å¼•ç”¨å…³ç³»å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d695e9bf18f541aca26f75fb664d4160~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=IdG%2Fic3WXaYgjLk8rLjURYdfolo%3D" alt="" loading="lazy"/></p>
<p>å®éªŒ3ä¸­ï¼Œå½“ä¸»æ–¹æ³•æ‰§è¡Œå®Œå¼¹æ ˆåï¼ŒçŸ­æ—¶é—´å†…ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¯¹è±¡ä»å¤„äº<strong>ç©ºé—²/æ´»è·ƒçŠ¶æ€</strong>ã€‚ä½†æ˜¯çº¿ç¨‹æ± å¯¹è±¡å·²ç»ä¸è¢«ä¸»çº¿ç¨‹å¯¹è±¡ä¸­çš„æ–¹æ³•æ ˆæŒæœ‰ï¼Œä¹Ÿå°±æ˜¯<strong>å›¾ä¸­å…³ç³»1æ–­å¼€</strong>ï¼ŒæŒ‰ç…§JVMçš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%259E%2583%25E5%259C%25BE%25E5%259B%259E%25E6%2594%25B6%25E6%259C%25BA%25E5%2588%25B6%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6&amp;zhida_source=entity" ref="nofollow noopener noreferrer">åƒåœ¾å›æ”¶æœºåˆ¶</a>ï¼Œè¿™æ—¶ï¼ŒThreadPoolExecutorå¯¹è±¡å·²ç»ä¸è¢«GCRootå¼•ç”¨ï¼Œæ˜¯è¦è¢«GCå›æ”¶çš„ï¼Œä½†æ˜¯ä»2.3.2ä¸­çš„å®éªŒ3æ‰§è¡Œç›‘æ§æ¥çœ‹ï¼ŒThreadPoolExecutorå¯¹è±¡å¹¶æ²¡æœ‰è¢«GCå›æ”¶ã€‚</p>
<p><strong>ç–‘é—®ï¼šéš¾é“è¿˜æœ‰ä»€ä¹ˆå¯¹è±¡æŒæœ‰è¿™ä¸ªçº¿ç¨‹æ± å¯¹è±¡çš„å¼•ç”¨ï¼Ÿ</strong></p>
<p>é¦–å…ˆï¼Œç”±äºJVMçš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3D%25E8%25BF%2590%25E8%25A1%258C%25E6%259C%25BA%25E5%2588%25B6%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6&amp;zhida_source=entity" ref="nofollow noopener noreferrer">è¿è¡Œæœºåˆ¶</a>ï¼Œæ¯ä¸€ä¸ªjavaçº¿ç¨‹éƒ½å…³è”ä¸€ä¸ª<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3DOS%25E7%25BA%25BF%25E7%25A8%258B%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=OS%E7%BA%BF%E7%A8%8B&amp;zhida_source=entity" ref="nofollow noopener noreferrer">OSçº¿ç¨‹</a>ï¼Œçº¿ç¨‹å¯¹è±¡åœ¨terminatedä¹‹å‰(çº¿ç¨‹ä»»åŠ¡æ‰§è¡Œå®Œä¹‹å‰)ï¼Œéƒ½ä¸ä¼šè¢«GCå›æ”¶ã€‚</p>
<p>ä¸Šé¢çš„å¼•ç”¨å…³ç³»å®é™…ä¸Šåº”è¯¥æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼Œçº¿ç¨‹æ± ä¸­çš„æ¯ä¸ªçº¿ç¨‹å¯¹è±¡éƒ½æœ‰è‡ªå·±çš„æ‰§è¡Œæ–¹æ³•æ ˆå¯¹è±¡</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9bbb8eab3f5493e96cc2f66c55d7ebf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=8bi1EYjEZoIm%2BLLwF8fa10bKzzc%3D" alt="" loading="lazy"/></p>
<p>æ ¹æ®2.3.2ä¸­çš„å‡ ä¸ªæ‰§è¡Œç»“æœç›‘æ§ï¼Œå°±èƒ½çœ‹å‡ºï¼Œçº¿ç¨‹æ± å¯¹è±¡çš„å›æ”¶ä¸çº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹æ˜¯å¦è¢«å…¨éƒ¨å›æ”¶æ˜¯æœ‰å…³ç³»çš„ï¼Œæ‰€ä»¥å…ˆé¢„æµ‹çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¯¹è±¡æ˜¯æŒæœ‰çº¿ç¨‹æ± å¯¹è±¡çš„å¼•ç”¨çš„ï¼Œç„¶ååŸºäºè¿™ä¸ªé¢„æµ‹ï¼Œå»æºç ä¸­æ‰¾ç†è®ºæ”¯æ’‘ã€‚</p>
<p><strong>é¢„æµ‹å­˜åœ¨é»„è‰²ç®­å¤´ä¾èµ–å…³ç³»ï¼Œå¦‚ä¸‹å›¾ï¼š</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34a8a758153d48679cf97849ab26af8f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=t804CVJMgGvj1PZTAyFSr5TV7FY%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10"><strong>3.3 çº¿ç¨‹å¯¹è±¡ä¸ºä½•ä¼šæŒæœ‰çº¿ç¨‹æ± å¯¹è±¡çš„å¼•ç”¨ï¼Ÿ</strong></h3>
<p>å…¶å®ï¼Œä¸Šé¢çš„å¼•ç”¨å…³ç³»å›¾ä¸­ï¼Œæ‰€æœ‰çš„æ­£å‘ä¾èµ–å…³ç³»æˆ‘ä»¬ä¸éš¾ç†è§£ã€‚éœ€è¦éªŒè¯çš„æ˜¯åå‘çš„ä¾èµ–å…³ç³»r 2.xå’Œr 3.xï¼Œè¿™äº›åå‘çš„ä¾èµ–å…³ç³»éƒ½æ˜¯ä»€ä¹ˆæ—¶å€™å»ºç«‹çš„ï¼Ÿå¯ä»¥ä»ä¸‹é¢å‡ ä¸ªé—®é¢˜å…¥æ‰‹å»æ’æŸ¥ï¼š</p>
<ol>
<li>çº¿ç¨‹æ± (ThreadPoolExecutor)ç±»ç»“æ„ä¸­æ˜¯å¦æœ‰ç›¸å…³å¯¹è±¡çš„å±æ€§å­—æ®µï¼Ÿ</li>
<li>çº¿ç¨‹æ± å¯¹è±¡ä¸­<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3DWorker%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=Worker&amp;zhida_source=entity" ref="nofollow noopener noreferrer">Worker</a>é›†åˆä¸­Workerå¯¹è±¡åˆ›å»ºæ—¶æœºï¼Ÿ</li>
<li>Workerå¯¹è±¡åˆ›å»ºæ—¶æ˜¯å¦‚ä½•å»ºç«‹ç›¸åº”çš„ä¾èµ–å…³ç³»çš„ï¼Ÿ</li>
</ol>
<p>ä»çº¿ç¨‹æ± æäº¤ä»»åŠ¡å¼€å§‹ï¼Œä»æºç ä¸­å¯ä»¥çœ‹åˆ°workerç±»ç»“æ„ä¸­æœ¬èº«å®šä¹‰æœ‰Threadå˜é‡å±æ€§ï¼Œåœ¨Workerå¯¹è±¡åˆ›å»ºæ—¶ï¼Œå°±ä¸ºThreadå±æ€§æ˜¾å¼èµ‹å€¼ï¼š</p>
<p><strong>Workerç±»å®šä¹‰å¦‚ä¸‹ï¼š</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99b021a6362a4febb662dd802655d71e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=EsbpifZlzr9gdBOhfy4OuZHl5XM%3D" alt="" loading="lazy"/></p>
<p><strong>Workerå¯¹è±¡åˆ›å»ºæ—¶æœºå¦‚ä¸‹ï¼š</strong></p>
<p>ä»CompletableFutureå·¥å…·ä»»åŠ¡æ‰§è¡Œæ–¹æ³•ä¸­ä¸€æ­¥æ­¥è¿›å…¥æºç ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹å…³ç³»</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ac031ed60b9495a8d87bfdc92f2c5d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=PFF77Y7Yy8iC6NPQLPBcw8aLXE4%3D" alt="" loading="lazy"/></p>
<p>ä¸Šé¢ä¸¤æ®µæºç æˆªå›¾ä¸­ï¼ŒéªŒè¯äº†<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3D%25E4%25BE%259D%25E8%25B5%2596%25E5%2585%25B3%25E7%25B3%25BB%25E5%259B%25BE%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB%E5%9B%BE&amp;zhida_source=entity" ref="nofollow noopener noreferrer">ä¾èµ–å…³ç³»å›¾</a>ä¸­<strong>2.xï¼Œ3.x</strong>ä¸<strong>r 3.x</strong>çš„ä¾èµ–å…³ç³»ï¼Œè¿˜å‰©ä¸‹<strong>r 2.x</strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D8%26q%3D%25E4%25BE%259D%25E8%25B5%2596%25E5%2585%25B3%25E7%25B3%25BB%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=8&amp;q=%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB&amp;zhida_source=entity" ref="nofollow noopener noreferrer">ä¾èµ–å…³ç³»</a>æ²¡æœ‰å¾—åˆ°éªŒè¯ã€‚</p>
<p>é¦–å…ˆï¼Œä»Workerç±»ç»“æ„ä¸Šï¼Œæ²¡æœ‰æ‰¾åˆ°Workerç±»ä¸­æœ‰å®šä¹‰å¯¹ThreadPoolExecutorç±»çš„æ˜¾å¼å¼•ç”¨ï¼Œå¹¶ä¸”ä»2.3.2çš„å®éªŒæ‰§è¡Œç»“æœå›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå³ä½¿å¤šæ¬¡è§¦å‘GCï¼Œä¾æ—§æ²¡æœ‰å°†ThreadPoolExecutorå¯¹è±¡å›æ”¶æ‰ï¼Œæ‰€ä»¥ï¼Œ<strong>Worker-&gt;ThreadPoolExecutorè‚¯å®šæ˜¯ä¸€ç§<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%25BC%25BA%25E5%25BC%2595%25E7%2594%25A8%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=%E5%BC%BA%E5%BC%95%E7%94%A8&amp;zhida_source=entity" ref="nofollow noopener noreferrer">å¼ºå¼•ç”¨</a></strong>(4ç§å¼•ç”¨å…³ç³»ï¼šå¼ºå¼•ç”¨ã€<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3D%25E8%25BD%25AF%25E5%25BC%2595%25E7%2594%25A8%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=%E8%BD%AF%E5%BC%95%E7%94%A8&amp;zhida_source=entity" ref="nofollow noopener noreferrer">è½¯å¼•ç”¨</a>ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨)ã€‚</p>
<p>é‚£ä¹ˆï¼Œå“ªäº›è¡Œä¸ºä¼šè®©å¯¹è±¡ä¹‹é—´å»ºç«‹å¼ºå¼•ç”¨å…³ç³»å‘¢ï¼Ÿæˆ‘ä»¬å…ˆé—®ä¸‹AIåŠ©æ‰‹ï¼Œè®©å®ƒç½—åˆ—å‡ºä¼šå»ºç«‹å¼•ç”¨å…³ç³»çš„ä»£ç è¡Œä¸ºã€‚æ€»ç»“å½’çº³å¦‚ä¸‹ï¼š</p>
<ol>
<li>å¯¹è±¡ä¸­çš„å±æ€§å­—æ®µæ˜¾å¼èµ‹å€¼å¼•ç”¨</li>
<li>æ•°ç»„ã€é›†åˆå¯¹è±¡ä¸­æ·»åŠ å…¶ä»–å¯¹è±¡çš„å¼•ç”¨</li>
<li>å­ç±»é€šè¿‡é¢å‘å¯¹è±¡çš„ç»§æ‰¿å¤šæ€ç‰¹æ€§å¼•ç”¨çˆ¶ç±»ä¸­çš„å±æ€§å­—æ®µ</li>
<li>è¿˜æœ‰ä¸€ç§å¹³å¸¸å…³æ³¨è¾ƒå°‘çš„ï¼Œç›¸å¯¹éšå¼çš„å¼•ç”¨å…³ç³»â€”â€”å†…éƒ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3D%25E7%25B1%25BB%25E5%25AF%25B9%25E8%25B1%25A1%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=%E7%B1%BB%E5%AF%B9%E8%B1%A1&amp;zhida_source=entity" ref="nofollow noopener noreferrer">ç±»å¯¹è±¡</a>å¼•ç”¨å¤–éƒ¨ç±»å¯¹è±¡</li>
</ol>
<p>ä»Workerçš„ç±»ç»“æ„æ¥çœ‹ï¼Œæ˜¯æ²¡æœ‰æ˜¾ç¤ºçš„å¯¹ThreadPoolExecutorçš„å±æ€§å¼•ç”¨çš„ï¼Œä¹Ÿæ²¡æœ‰ç›¸å…³çš„æ•°æ®ã€é›†åˆï¼Œ<strong>æ‰€ä»¥1,2ä¸æˆç«‹</strong>ã€‚Workerå¯¹è±¡ä¸ThreadPoolExecutorä¹Ÿæ²¡æœ‰ç›´æ¥æˆ–è€…é—´æ¥çš„ç»§æ‰¿/å®ç°å…³ç³»ï¼Œ<strong>æ‰€ä»¥3ä¹Ÿä¸æˆç«‹ã€‚</strong></p>
<p>æœ€åå†çœ‹Workerç±»å®šä¹‰ï¼Œç¡®å®æ˜¯åœ¨ThreadPoolExecutorç±»çš„å†…éƒ¨(å†…éƒ¨ç±»å¯¹è±¡æŒæœ‰å¤–éƒ¨ç±»å¯¹è±¡çš„éªŒè¯å¾ˆç®€å•ï¼Œä¸åœ¨è¿™é‡Œèµ˜è¿°)ã€‚è¿™æ ·Worker-&gt;ThreadPoolExecutorçš„å¼•ç”¨å…³ç³»å°±èƒ½è¯´å¾—é€šäº†ã€‚è‡³æ­¤ï¼Œ<strong>å¼•ç”¨ä¾èµ–å…³ç³»å›¾ä¸­é¢„æµ‹çš„r 2.xå’Œr 3.xå…³ç³»éƒ½æˆç«‹äº†ã€‚</strong></p>
<h3 data-id="heading-11"><strong>3.4 åŸå› é€»è¾‘æ¢³ç†</strong></h3>
<p>å†æ¬¡æŠŠä¾èµ–å…³ç³»å›¾è´´å‡ºæ¥ï¼Œä¸€èµ·å†æ¢³ç†ä¸€ä¸‹</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a9850d8c7974bec9dee423b57870d4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=sbm8cYeSHSVSpfkNYIvETGToQgM%3D" alt="" loading="lazy"/></p>
<ol>
<li>å½“å‰æ–¹æ³•main-Threadæ‰§è¡Œå®Œï¼Œmain-Threadçš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D4%26q%3D%25E6%2596%25B9%25E6%25B3%2595%25E6%25A0%2588%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=4&amp;q=%E6%96%B9%E6%B3%95%E6%A0%88&amp;zhida_source=entity" ref="nofollow noopener noreferrer">æ–¹æ³•æ ˆ</a>éƒ½å¼¹æ ˆ</li>
<li>ä¾èµ–å…³ç³»<strong>1</strong>æ–­å¼€ï¼Œçº¿ç¨‹æ± ä¸å†è¢«æ´»è·ƒçº¿ç¨‹å¼•ç”¨ï¼Œä¸ä¼šå†æœ‰ä»»åŠ¡è¿›æ¥</li>
<li>å½“çº¿ç¨‹æ± ä»»åŠ¡éƒ½å®Œæˆï¼Œæ­¤æ—¶çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹éƒ½å¤„äºä¼‘çœ (wait)çŠ¶æ€ï¼Œç­‰å¾…ä»»åŠ¡é˜Ÿåˆ—ä¸­ä»»åŠ¡è¿›æ¥</li>
<li>ç”±äºçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹éƒ½å¤„äºå­˜æ´»çŠ¶æ€ï¼Œä¸ä¼šè¢«å›æ”¶</li>
<li>å­˜åœ¨<strong>çº¿ç¨‹æ± çº¿ç¨‹_n</strong> <strong>-&gt; worker_n -&gt; çº¿ç¨‹æ± </strong>çš„é€†å‘å¼•ç”¨å…³ç³»</li>
<li>æ‰€ä»¥å¯¼è‡´å®éªŒ3ä¸­çš„ç°è±¡â€”â€”çº¿ç¨‹æ± å’Œçº¿ç¨‹æ± ä¸­çº¿ç¨‹æ— æ³•è¢«GCå›æ”¶</li>
</ol>
<h2 data-id="heading-12"><strong>4 çº¿ç¨‹æ± æœªshutdownçš„å½±å“</strong></h2>
<p>è¿™é‡Œå†æŠŠå®éªŒ3ä¼šå¯¼è‡´ç³»ç»Ÿçš„å‡ºç°çš„é—®é¢˜æ€»ç»“ä¸€ä¸‹ã€‚é€šè¿‡2.3.2ä¸­çš„å®éªŒ3ç›‘æ§å›¾ä»¥åŠæºç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œçº¿ç¨‹æ± ä½¿ç”¨å®Œï¼ŒæœªåŠæ—¶è¿›è¡Œshutdownï¼Œå°±æœ€å·®çš„æƒ…å†µæ¥è¯´ï¼Œä¼šå¯¼è‡´çš„é—®é¢˜ï¼š</p>
<ol>
<li>
<p>çº¿ç¨‹æ± å¯¹è±¡æ— æ³•è¢«GCå›æ”¶â€”â€”<strong>å†…å­˜æ³„éœ²</strong></p>
</li>
<li>
<p>çº¿ç¨‹å¯¹è±¡æ— æ³•è¢«GCå›æ”¶â€”â€”<strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270085144%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%2586%2585%25E5%25AD%2598%25E6%25B3%2584%25E6%25BC%258F%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270085144&amp;content_type=Article&amp;match_order=1&amp;q=%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F&amp;zhida_source=entity" ref="nofollow noopener noreferrer">å†…å­˜æ³„æ¼</a></strong></p>
</li>
<li>
<p>ä»çº¿ç¨‹è·å–ä»»åŠ¡çš„æºç æ¥çœ‹ï¼Œå³ä½¿ä»»åŠ¡é˜Ÿåˆ—ä¸­æ˜¯ç©ºçš„ï¼Œåªè¦çº¿ç¨‹æ± çŠ¶æ€ä»å¤„äº<strong>Running</strong>ï¼Œçº¿ç¨‹ä¼šå®šæ—¶ä»waitçŠ¶æ€è‹é†’ï¼Œé‡æ–°è·å–ä»»åŠ¡â€”â€”<strong>å ç”¨CPUæ‰§è¡Œåˆ†ç‰‡</strong></p>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/295892aeb97a4c2fa7e3e8cf42023cc2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771138351&amp;x-signature=K1Nt2f65n29D%2F73Nk7ea5MFKDEI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-13"><strong>è¡€æ³ªæ•™è®­æ€»ç»“</strong></h2>
<ol>
<li><strong>çº¿ç¨‹æ± ç”¨å®Œä¸€å®šè¦å…»æˆshutdownçš„ä¹ æƒ¯ï¼š</strong> å› ä¸ºæœ‰çš„æ²¡å…³å¥½ï¼ŒçœŸçš„ä¼šæ¼æ°´(å†…å­˜æ³„éœ²)</li>
<li><strong>çº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹å‘½åï¼Œä¸€å®šè¦æœ‰ä¸šåŠ¡ç›¸å…³æ ‡è¯†ï¼š</strong> å»ºè®®é‡‡ç”¨â€œä¸šåŠ¡åœºæ™¯+çº¿ç¨‹è®¡æ•°â€æ³•ï¼š"<strong>è®¢å•å¯¼å‡º-xx"ã€"é‚®ä»¶å‘é€-xx"</strong> ï¼Œå‡ºé—®é¢˜æ—¶ç§’é”å«Œç–‘äººï¼š"å°±æ˜¯è®¢å•å¯¼å‡ºçº¿ç¨‹åœ¨æ‘¸é±¼ï¼"</li>
<li><strong>å†…éƒ¨ç±»ä½¿ç”¨è¦è°¨æ…ï¼š</strong> è°ˆæ‹çˆ±å¯ä»¥ï¼Œç©å¤±è¸ªä¸è¡Œï¼Œåˆ«è®©äººå®¶ï¼ˆGCï¼‰æ‰¾ä¸åˆ°ä½ ï¼</li>
</ol>
<h2 data-id="heading-14"><strong>æ–‡æœ«å½©è›‹</strong></h2>
<p>ä»¥åï¼Œä½ åœ¨ä»£ç é‡Œçœ‹åˆ°éšæ‰‹åˆ›å»ºçš„çº¿ç¨‹æ± ï¼Œæœ€ç»ˆæ²¡æœ‰.shutdown()ï¼Œè¯·åƒçœ‹åˆ°æœ‰äººä¸Šå•æ‰€ä¸å†²æ°´ä¸€æ ·ï¼Œå¤§å–Šï¼šâ€œåŒï¼å­¦ï¼ä½ ï¼çº¿ç¨‹æ± ï¼å¿˜ï¼å…³ï¼äº†ï¼â€</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è™šæ‹Ÿåˆ—è¡¨ï¼šæ”¯æŒâ€œå‘ä¸ŠåŠ è½½â€çš„å†å²æ¶ˆæ¯ï¼ˆVue 3 & React åŒç‰ˆæœ¬ï¼‰]]></title>    <link>https://juejin.cn/post/7603946518372515878</link>    <guid>https://juejin.cn/post/7603946518372515878</guid>    <pubDate>2026-02-08T11:00:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603946518372515878" data-draft-id="7603946518372450342" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è™šæ‹Ÿåˆ—è¡¨ï¼šæ”¯æŒâ€œå‘ä¸ŠåŠ è½½â€çš„å†å²æ¶ˆæ¯ï¼ˆVue 3 &amp; React åŒç‰ˆæœ¬ï¼‰"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•,JavaScript"/> <meta itemprop="datePublished" content="2026-02-08T11:00:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‘ç°ä¸€åªå¤§å‘†ç“œ"/> <meta itemprop="url" content="https://juejin.cn/user/180747382561607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è™šæ‹Ÿåˆ—è¡¨ï¼šæ”¯æŒâ€œå‘ä¸ŠåŠ è½½â€çš„å†å²æ¶ˆæ¯ï¼ˆVue 3 &amp; React åŒç‰ˆæœ¬ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180747382561607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‘ç°ä¸€åªå¤§å‘†ç“œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T11:00:11.000Z" title="Sun Feb 08 2026 11:00:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">å‰è¨€</h3>
<p>åœ¨AIèŠå¤©äº§å“ä¸­ï¼Œå‘ä¸Šæ»šåŠ¨åŠ è½½å†å²æ¶ˆæ¯æ˜¯ä¸€ä¸ªç»å…¸åœºæ™¯ã€‚å¦‚æœç›´æ¥æ¸²æŸ“ä¸‡çº§èŠå¤©è®°å½•ï¼Œé¡µé¢å¿…å¡æ— ç–‘ã€‚è€Œä½¿ç”¨è™šæ‹Ÿåˆ—è¡¨æ—¶ï¼Œ<strong>å‘ä¸Šæ’å…¥æ•°æ®å¯¼è‡´çš„ä½ç½®åç§»</strong>æ˜¯æœ€å¤§çš„æŠ€æœ¯ç—›ç‚¹ã€‚æœ¬æ–‡å°†åˆ†äº«å¦‚ä½•å®ç°ä¸€ä¸ªæ”¯æŒâ€œæ»šåŠ¨ä½ç½®é”å®šâ€å’Œâ€œåŠ¨æ€é«˜åº¦è¡¥å¿â€çš„è™šæ‹Ÿåˆ—è¡¨æ–¹æ¡ˆã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97bb245233ce41d89a9de7e4c60bd87e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771153211&amp;x-signature=%2Bkaio29XJ8HeFLo6mXLCcFZ%2FA0Y%3D" alt="reactè™šæ‹Ÿåˆ—è¡¨å‘ä¸ŠåŠ è½½.gif" loading="lazy"/></p>
<h2 data-id="heading-1">ä¸€ã€ æ ¸å¿ƒå›°éš¾ç‚¹ï¼šä¸ºä»€ä¹ˆå‘ä¸ŠåŠ è½½è¿™ä¹ˆéš¾ï¼Ÿ</h2>
<ol>
<li><strong>æ»šåŠ¨ä½ç½®ä¸¢å¤±</strong>ï¼šå½“ä½ å‘æ•°ç»„å¤´éƒ¨æ’å…¥ 5 æ¡æ–°æ¶ˆæ¯æ—¶ï¼Œæ€»é«˜åº¦ä¼šå¢åŠ ã€‚å¦‚æœä¸å¤„ç†ï¼Œæµè§ˆå™¨ä¼šåœç•™åœ¨åŸæ¥çš„ <code>scrollTop</code>ï¼Œå¯¼è‡´ç”¨æˆ·çœ‹åˆ°çš„å†…å®¹è¢«â€œé¡¶èµ°â€ã€‚</li>
<li><strong>åŠ¨æ€é«˜åº¦è®¡ç®—</strong>ï¼šèŠå¤©å†…å®¹ï¼ˆå›¾ç‰‡ã€é•¿æ–‡æœ¬ï¼‰é«˜åº¦ä¸ä¸€ï¼Œå¿…é¡»åœ¨ DOM æ¸²æŸ“åé€šè¿‡ <code>ResizeObserver</code> å®æ—¶ä¿®æ­£ã€‚</li>
<li><strong>ç´¢å¼•åç§»</strong>ï¼šæ’å…¥æ•°æ®åï¼ŒåŸæ¥çš„ç´¢å¼•å…¨éƒ¨å¤±æ•ˆï¼Œå¿…é¡»ä¾èµ–â€œç´¯è®¡é«˜åº¦æ•°ç»„â€å’ŒäºŒåˆ†æŸ¥æ‰¾é‡æ–°å®šä½ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-2">äºŒã€ å®ç°æ€è·¯</h2>
<h4 data-id="heading-3">1ã€ç¬¬ä¸€æ­¥ï¼šæ­ä¸ªâ€œæˆå°å­â€ï¼ˆåŸºç¡€ç»“æ„ï¼‰</h4>
<p>æˆ‘ä»¬è¦æ­ä¸€ä¸ªä¸‰å±‚åµŒå¥—çš„æˆå°ï¼Œæ¯ä¸€å±‚éƒ½æœ‰å®ƒçš„â€œä½¿å‘½â€ï¼š</p>
<ol>
<li><strong>å¤–å±‚å¤§ç®¡å®¶</strong>ï¼šå›ºå®šå¥½é«˜åº¦ï¼Œåˆ«è®©åˆ—è¡¨æŠŠé¡µé¢æ’‘åäº†ã€‚</li>
<li><strong>â€œè™šèƒ–â€å ä½å±‚</strong>ï¼šè¿™æ˜¯ä¸ªç©ºç›’å­ï¼Œé«˜åº¦è®¾ä¸º <code>totalHeight</code>ã€‚å®ƒçš„å”¯ä¸€ä½œç”¨æ˜¯<strong>æ¬ºéª—æµè§ˆå™¨</strong>ï¼Œè®©æ»šåŠ¨æ¡ä»¥ä¸ºè¿™é‡Œæœ‰æˆåƒä¸Šä¸‡æ¡æ•°æ®ï¼Œä»è€Œäº§ç”ŸçœŸå®çš„æ»šåŠ¨æ„Ÿã€‚</li>
<li><strong>èˆå°ä¸­å¿ƒï¼ˆå¯è§†åŒºï¼‰</strong> ï¼šç»å¯¹å®šä½ã€‚å®ƒä¼šåƒç”µæ¢¯ä¸€æ ·ï¼Œè·Ÿç€ä½ çš„æ»šåŠ¨è·ç¦»é€šè¿‡ <code>translateY</code> çµæ´»ä½ç§»ï¼Œæ°¸è¿œä¿è¯è‡ªå·±å‡ºç°åœ¨è§‚ä¼—è§†çº¿å†…ã€‚</li>
</ol>
<h4 data-id="heading-4">2ã€ç¬¬äºŒæ­¥ï¼šå‡†å¤‡æ ¸å¿ƒæ•°æ®</h4>
<p>ä¸ºäº†è®©â€œæˆâ€ä¸æ¼”ç ¸ï¼Œæˆ‘ä»¬éœ€è¦æŒæ¡è¿™äº›æƒ…æŠ¥ï¼š</p>
<ul>
<li><strong>é¢„åˆ¤å€¼</strong>ï¼š<code>MIN_ITEM_HEIGHT</code>ï¼ˆå“ªæ€•ä¸çŸ¥é“å¤šé«˜ï¼Œä¹Ÿå¾—æœ‰ä¸ªä¿åº•å€¼ï¼‰å’Œ <code>BUFFER_SIZE</code>ï¼ˆå¤šæ¸²æŸ“å‡ è¡Œï¼Œåˆ«è®©ç”¨æˆ·ä¸€æ»‘å°±çœ‹åˆ°ç™½å±ï¼‰ã€‚</li>
<li><strong>é›·è¾¾ç«™</strong>ï¼š<code>LOAD_THRESHOLD</code>ï¼ˆè·ç¦»é¡¶éƒ¨è¿˜æœ‰å¤šè¿œæ—¶ï¼Œèµ¶ç´§å»åå°æ¬æ•‘å…µ/åŠ è½½æ•°æ®ï¼‰ã€‚</li>
<li><strong>è®°è´¦æœ¬</strong>ï¼šç”¨ä¸€ä¸ª <code>Map</code> è®°å½•æ¯ä¸ªæ¶ˆæ¯çš„çœŸå®é«˜åº¦ï¼Œå†æ•´ä¸€ä¸ª <code>cumulativeHeights</code>ï¼ˆç´¯è®¡é«˜åº¦æ•°ç»„ï¼‰ï¼Œè®°å½•æ¯ä¸€æ¡æ¶ˆæ¯è·ç¦»é¡¶éƒ¨çš„è·ç¦»ã€‚</li>
</ul>
<h4 data-id="heading-5">3ã€ç¬¬ä¸‰æ­¥ï¼šç´¢å¼•è®¡ç®—</h4>
<ul>
<li><strong>æ‰¾èµ·ç‚¹</strong>ï¼šç”¨<strong>äºŒåˆ†æŸ¥æ‰¾</strong>åœ¨â€œè®°è´¦æœ¬â€é‡Œæœä¸€ä¸‹ï¼Œçœ‹ç°åœ¨çš„æ»šåŠ¨ä½ç½®å¯¹åº”å“ªä¸€è¡Œçš„åœ°ç›˜ã€‚</li>
<li><strong>å®šç»ˆç‚¹</strong>ï¼šèµ·ç‚¹åŠ ä¸Šä½ èƒ½çœ‹åˆ°çš„è¡Œæ•°ï¼Œå†ç®—ä¸Šâ€œç¼“å†²åŒºâ€çš„å‡ ä½ï¼Œå°±æ˜¯è¿™ä¸€å¹•çš„ç»“æŸã€‚</li>
<li><strong>å®šä½ç½®</strong>ï¼šç®—å‡ºèµ·ç‚¹é¡¹å¯¹åº”çš„ç´¯è®¡é«˜åº¦ï¼ŒæŠŠèˆå°ä¸€æ¨ï¼ˆ<code>offsetY</code>ï¼‰ï¼Œæå®šï¼</li>
</ul>
<h4 data-id="heading-6">4ã€ç¬¬å››æ­¥ï¼šæ—¶é—´å›æº¯ï¼ˆå‘ä¸ŠåŠ è½½çš„æ ¸å¿ƒï¼æ ¸å¿ƒï¼ï¼‰</h4>
<p>è¿™æ˜¯å®ç°å‘ä¸ŠåŠ è½½æœ€éš¾çš„åœ°æ–¹ï¼šå¾€å¼€å¤´å¡äº†æ–°èƒ¶ç‰‡ï¼Œæ€ä¹ˆä¿è¯è§‚ä¼—çœ‹åˆ°çš„ç”»é¢ä¸è·³åŠ¨ï¼Ÿ</p>
<ol>
<li><strong>åšæ ‡è®°</strong>ï¼šè§¦å‘åŠ è½½å‰ï¼Œå…ˆæ­»æ­»è®°ä½ç°åœ¨çš„ <code>scrollHeight</code>ï¼ˆæ€»é«˜ï¼‰å’Œ <code>scrollTop</code>ï¼ˆè¿›åº¦ï¼‰ã€‚</li>
<li><strong>å¡æ•°æ®</strong>ï¼šæŠŠæ–°æ¶ˆæ¯â€œç °â€åœ°ä¸€ä¸‹æ’åˆ° <code>listData</code> çš„æœ€å‰é¢ã€‚</li>
<li><strong>ç¥æ“ä½œï¼ˆé«˜åº¦è¡¥å¿ï¼‰</strong> ï¼šæ•°æ®å¡è¿›å»åï¼Œæ€»é«˜åº¦è‚¯å®šå˜äº†ã€‚è¿™æ—¶å€™èµ¶ç´§ç®—ä¸€ä¸‹ï¼š<code>æ–°é«˜åº¦ - æ—§é«˜åº¦ = å¢åŠ çš„é«˜åº¦</code>ã€‚</li>
<li><strong>ç¬é—´å¹³ç§»</strong>ï¼šæŠŠæ»šåŠ¨æ¡ä½ç½®å¼ºåˆ¶ä¿®æ”¹ä¸º <code>æ—§è¿›åº¦ + å¢åŠ çš„é«˜åº¦</code>ã€‚è¿™å¥—åŠ¨ä½œè¦åœ¨æµè§ˆå™¨åˆ·æ–°å‰å®Œæˆï¼Œç”¨æˆ·åªä¼šè§‰å¾—åŠ è½½äº†æ–°å†…å®¹ï¼Œä½†çœ¼å‰çš„ç”»é¢çº¹ä¸ä¸åŠ¨ã€‚</li>
</ol>
<h4 data-id="heading-7">5ã€ç¬¬äº”æ­¥ï¼šå®æ—¶ç›‘æ§ï¼ˆé«˜åº¦çº æ­£ï¼‰</h4>
<p>ä¸‡ä¸€æŸæ¡æ¶ˆæ¯é‡Œçªç„¶è¹¦å‡ºä¸€å¼ å¤§å›¾ï¼Œé«˜åº¦å˜äº†æ€ä¹ˆåŠï¼Ÿ</p>
<ul>
<li><strong>æ´¾å‡ºä¾¦å¯Ÿå…µ</strong>ï¼šå­ç»„ä»¶è‡ªå¸¦ <code>ResizeObserver</code>ï¼Œä¸€æ—¦å‘ç°è‡ªå·±é•¿é«˜äº†ï¼Œç«‹é©¬æŠ¥å‘Šç»™çˆ¶ç»„ä»¶ã€‚</li>
<li><strong>ç²¾å‡†æ‰“å‡»</strong>ï¼šçˆ¶ç»„ä»¶æ”¶åˆ°æŠ¥å‘Šï¼Œæ›´æ–°è´¦æœ¬ã€‚å¦‚æœè¿™ä¸ªå˜é«˜çš„é¡¹åœ¨è§‚ä¼—è§†çº¿<strong>ä¸Šæ–¹</strong>ï¼Œè¿˜å¾—æ‰‹åŠ¨æŠŠæ»šåŠ¨æ¡å†æ¨ä¸€æ¨ï¼Œé˜²æ­¢å†…å®¹åœ¨çœ¼çš®å­åº•ä¸‹â€œä¹±è·³â€ã€‚</li>
</ul>
<h4 data-id="heading-8">6ã€ç»ˆç« ï¼šå¼€å¹•ä»ªå¼ï¼ˆåˆå§‹åŒ–ï¼‰</h4>
<ol>
<li><strong>ä¸€æ»šåˆ°åº•</strong>ï¼šèŠå¤©å®¤å˜›ï¼Œè¿›åœºè‚¯å®šå¾—çœ‹æœ€ä¸‹é¢ï¼ˆæœ€æ–°æ¶ˆæ¯ï¼‰ã€‚</li>
<li><strong>åŒé‡ä¿é™©</strong>ï¼šè°ƒç”¨ <code>scrollToBottom</code> æ—¶ï¼Œå…ˆç”¨ <code>requestAnimationFrame</code> è¯·æµè§ˆå™¨é…åˆï¼Œå†åŠ ä¸ª <code>setTimeout</code> å…œåº•ï¼Œç¡®ä¿æ— è®ºç½‘ç»œå¤šæ…¢ï¼Œéƒ½èƒ½å‡†ç¡®é™è½åœ¨åˆ—è¡¨åº•éƒ¨ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-9">ä¸‰ã€ Vue 3 + TailwindCSS å®ç°</h2>
<h3 data-id="heading-10">1.  è™šæ‹Ÿåˆ—è¡¨ç»„ä»¶ï¼š</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div
    class="min-h-screen bg-gradient-to-br from-indigo-600 to-purple-600 py-10 px-5"
  &gt;
    &lt;div
      class="bg-white mt-10 rounded-xl border shadow-lg relative"
      ref="containerRef"
    &gt;
      &lt;div
        ref="virtualListRef"
        class="h-full overflow-auto relative overflow-anchor-none"
        @scroll="handleScroll"
      &gt;
        &lt;!-- é¡¶éƒ¨åŠ è½½æç¤º --&gt;
        &lt;div
          v-if="isLoading"
          class="sticky top-0 z-10 py-2 flex justify-center items-center text-sm text-gray-500"
        &gt;
          &lt;div class="flex items-center space-x-2"&gt;
            &lt;span&gt;æ­£åœ¨åŠ è½½...&lt;/span&gt;
          &lt;/div&gt;
        &lt;/div&gt;

        &lt;div :style="{ height: `${totalHeight}px` }"&gt;&lt;/div&gt;
        &lt;div
          class="absolute top-0 left-0 right-0"
          :style="{ transform: `translateY(${offsetY}px)` }"
        &gt;
          &lt;VirtualListItem
            v-for="item in visibleList"
            :key="item.id"
            :item="item"
            @update-height="handleItemHeightUpdate"
          /&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { ref, onMounted, computed, nextTick, watch } from 'vue';
import VirtualListItem from './listItem.vue';

const MIN_ITEM_HEIGHT = 80; //é¢„è®¾è™šæ‹Ÿåˆ—è¡¨é¡¹æœ€å°é«˜åº¦
const BUFFER_SIZE = 5; // ç¼“å†²åŒºå¤§å°ï¼Œç”¨äºé¢„åŠ è½½é¡¹
const LOAD_THRESHOLD = 50; // åŠ è½½æ¶ˆæ¯è§¦å‘è·ç¦»

const virtualListRef = ref&lt;HTMLDivElement | null&gt;(null); // è™šæ‹Ÿåˆ—è¡¨å®¹å™¨å¼•ç”¨
const listData = ref&lt;any[]&gt;([]); // åˆ—è¡¨æ•°æ®
const itemHeights = ref&lt;Map&lt;number, number&gt;&gt;(new Map()); // åˆ—è¡¨é¡¹é«˜åº¦æ•°ç»„ï¼šå­˜å‚¨æ¯ä¸ªé¡¹çš„é«˜åº¦
const scrollTop = ref(0); // æ»šåŠ¨ä½ç½®ï¼šå½“å‰æ»šåŠ¨çš„å‚ç›´åç§»é‡
const isLoading = ref(false); // æ˜¯å¦æ­£åœ¨åŠ è½½æ›´å¤šæ•°æ®
const isInitialized = ref(false); // æ˜¯å¦å·²åˆå§‹åŒ–ï¼šç”¨äºåˆ¤æ–­æ˜¯å¦å·²åŠ è½½åˆå§‹æ•°æ®
const hasMore = ref(true); // æ˜¯å¦æœ‰æ›´å¤šæ•°æ®å¯åŠ è½½
const containerRef = ref&lt;HTMLDivElement | null&gt;(null);

let minId = 10000; // æ¨¡æ‹Ÿç”Ÿæˆæ¶ˆæ¯ID

// è®¡ç®—ç´¯è®¡é«˜åº¦æ•°ç»„,å¯¹åº”äº†æ¯ä¸ªå…ƒç´ åœ¨åˆ—è¡¨ä¸­çš„å‚ç›´ä½ç½®
const cumulativeHeights = computed(() =&gt; {
  const heights: number[] = [0];
  let currentSum = 0;
  for (const item of listData.value) {
    const h = itemHeights.value.get(item.id) || MIN_ITEM_HEIGHT;
    currentSum += h;
    heights.push(currentSum);
  }
  return heights;
});

// åˆ—è¡¨æ€»é«˜åº¦ï¼šåˆ—è¡¨æ‰€æœ‰é¡¹çš„ç´¯è®¡é«˜åº¦
const totalHeight = computed(() =&gt; {
  const len = cumulativeHeights.value.length;
  return len &gt; 0 ? cumulativeHeights.value[len - 1] : 0;
});

// èµ·å§‹ç´¢å¼•
const startIndex = computed(() =&gt; {
  let low = 0,
    high = cumulativeHeights.value.length - 1;
  // æ ¸å¿ƒï¼šæ ¹æ®äºŒåˆ†æŸ¥æ‰¾æ³•å‡ºå¯è§†åŒºå†…ç¬¬ä¸€ä¸ªå¯è§é¡¹çš„ç´¢å¼•!!!!!
  while (low &lt;= high) {
    const mid = Math.floor((low + high) / 2);
    if (cumulativeHeights.value[mid] &lt; scrollTop.value) {
      low = mid + 1;
    } else {
      high = mid - 1;
    }
  }
  return Math.max(0, low - 1 - BUFFER_SIZE);
});

// ç»“æŸç´¢å¼•
const endIndex = computed(() =&gt; {
  if (!virtualListRef.value) return 10;
  const t = scrollTop.value + virtualListRef.value.clientHeight; // å¯è§†åŒºåº•éƒ¨åœ¨åˆ—è¡¨ä¸­çš„å‚ç›´ä½ç½®`
  let low = 0,
    high = cumulativeHeights.value.length - 1;
  // æ ¸å¿ƒï¼šæ ¹æ®äºŒåˆ†æŸ¥æ‰¾æ³•å‡ºå¯è§†åŒºå†…æœ€åä¸€ä¸ªå¯è§é¡¹çš„ç´¢å¼•!!!!!
  while (low &lt;= high) {
    const mid = Math.floor((low + high) / 2);
    if (cumulativeHeights.value[mid] &lt; t) {
      low = mid + 1;
    } else {
      high = mid - 1;
    }
  }
  return Math.min(listData.value.length, low + BUFFER_SIZE);
});

// å¯è§åˆ—è¡¨é¡¹ï¼šæ ¹æ®èµ·å§‹ç´¢å¼•å’Œç»“æŸç´¢å¼•æˆªå–åˆ—è¡¨æ•°æ®
const visibleList = computed(() =&gt; {
  return listData.value.slice(startIndex.value, endIndex.value);
});

// åç§»é‡ï¼šæ ¹æ®èµ·å§‹ç´¢å¼•è®¡ç®—åˆ—è¡¨é¡¹çš„å‚ç›´åç§»é‡
const offsetY = computed(() =&gt; {
  if (startIndex.value === 0) return 0;
  return cumulativeHeights.value[startIndex.value];
});

// mockçœŸå®æ•°æ®
const generateData = (count: number) =&gt; {
  const arr = [];
  for (let i = 0; i &lt; count; i++) {
    minId--;
    arr.push({
      id: minId,
      content: `å†å²æ¶ˆæ¯ ${minId}`,
      timestamp: new Date().toLocaleTimeString(),
    });
  }
  return arr;
};

// åˆå§‹åŒ–æ•°æ®
const initData = async () =&gt; {
  const initialData = await new Promise&lt;any[]&gt;(
    (resolve) =&gt; setTimeout(() =&gt; resolve(generateData(20)), 100) // æ¨¡æ‹Ÿå¼‚æ­¥æ•°æ®åŠ è½½ï¼Œåˆå§‹åŠ è½½æ—¶åŠ è½½20æ¡æ•°æ®é˜²æ­¢æ•°æ®é‡è¿‡å°‘æ’‘ä¸èµ·å®¹å™¨
  );
  listData.value = initialData.reverse();
  await nextTick(); // ç­‰å¾…listDataæ¸²æŸ“åˆ°DOMä¸­
  await nextTick(); // å†æ¬¡ç­‰å¾…å­ç»„ä»¶å®Œå…¨æ¸²æŸ“å¹¶è®¡ç®—å¥½å®é™…é«˜åº¦

  isInitialized.value = true;
  scrollToBottom(); // æ»šåŠ¨åˆ°åº•éƒ¨æ˜¾ç¤ºæœ€æ–°æ¶ˆæ¯
};

// æ»šåŠ¨åˆ°åº•
const scrollToBottom = () =&gt; {
  if (!virtualListRef.value) return;
  const scroll = () =&gt; {
    nextTick(() =&gt; {
      if (virtualListRef.value) {
        const scrollHeight = virtualListRef.value.scrollHeight;
        const clientHeight = virtualListRef.value.clientHeight;
        virtualListRef.value.scrollTop = scrollHeight - clientHeight;
        scrollTop.value = virtualListRef.value.scrollTop;
      }
    });
  };

  // åŒé‡ä¿éšœï¼šå…ˆä½¿ç”¨requestAnimationFrameç­‰å¾…æµè§ˆå™¨å®Œæˆä¸€æ¬¡é‡ç»˜ï¼Œæ­¤æ—¶ scrollHeight å’Œ clientHeight å·²æ­£ç¡®è®¡ç®—ï¼Œ
  // å†ç”¨setTimeoutå…œåº•ç¡®ä¿å³ä½¿ requestAnimationFrame å¤±æ•ˆä¹Ÿèƒ½æ‰§è¡Œ
  requestAnimationFrame(() =&gt; {
    scroll();
    // å…œåº•æ–¹æ¡ˆï¼Œç¡®ä¿æ»šåŠ¨æ‰§è¡Œ
    setTimeout(() =&gt; {
      scroll();
    }, 100);
  });
};

// ç›‘å¬totalHeightå˜åŒ–ï¼Œåˆå§‹åŒ–æ—¶ç¡®ä¿æ»šåŠ¨åˆ°åº•éƒ¨
watch(
  totalHeight,
  (newVal, oldVal) =&gt; {
    if (isInitialized.value &amp;&amp; oldVal === 0 &amp;&amp; newVal &gt; 0) {
      scrollToBottom();
    }
  },
  { immediate: true }
);

// åŠ è½½æ–°æ¶ˆæ¯
const loadNewMessages = async () =&gt; {
  if (isLoading.value || !hasMore.value || !isInitialized.value) return;
  isLoading.value = true;
  try {
    await new Promise((resolve) =&gt; setTimeout(resolve, 1000));    // æ¨¡æ‹Ÿ1ç§’å»¶è¿Ÿ
    const newData = generateData(5); // æ¯æ¬¡åŠ è½½5æ¡æ–°æ¶ˆæ¯
    const currentScrollHeight = virtualListRef.value?.scrollHeight || 0;    // è®°å½•å½“å‰æ»šåŠ¨çŠ¶æ€ï¼Œä¸ºæœªåŠ è½½å‰æ•´ä¸ªåˆ—è¡¨çš„é«˜åº¦ï¼ˆå«ä¸å¯è§ï¼‰ï¼ï¼ï¼
    const currentScrollTop = scrollTop.value;
    listData.value = [...newData, ...listData.value];    // åœ¨é¡¶éƒ¨æ·»åŠ æ–°æ•°æ®
    await nextTick();    // ç­‰å¾…DOMæ›´æ–°
    // ä¿æŒæ»šåŠ¨ä½ç½®ï¼Œè®©ç”¨æˆ·åœç•™åœ¨åŸæ¥çš„åœ°æ–¹
    if (virtualListRef.value) {
      const newScrollHeight = virtualListRef.value.scrollHeight;
      const heightAdded = newScrollHeight - currentScrollHeight;
      virtualListRef.value.scrollTop = currentScrollTop + heightAdded;
      scrollTop.value = virtualListRef.value.scrollTop;
    }
    // æ¨¡æ‹Ÿæ²¡æœ‰æ›´å¤šæ•°æ®çš„æƒ…å†µ
    if (minId &lt;= 9000) {
      hasMore.value = false;
    }
  } catch (error) {
    console.error('åŠ è½½æ¶ˆæ¯å¤±è´¥:', error);
  } finally {
    isLoading.value = false;
  }
};

// å¤„ç†é¡¹ç›®é«˜åº¦æ›´æ–°
const handleItemHeightUpdate = (id: number, realHeight: number) =&gt; {
  const oldHeight = itemHeights.value.get(id) || MIN_ITEM_HEIGHT;
  const diff = realHeight - oldHeight;
  if (Math.abs(diff) &lt; 1) return;

  itemHeights.value.set(id, realHeight);
  // å¦‚æœé¡¹ç›®åœ¨å¯è§†åŒºåŸŸä¸Šæ–¹ï¼Œè°ƒæ•´æ»šåŠ¨ä½ç½®
  const index = listData.value.findIndex((item) =&gt; item.id === id);
  if (index &lt; 0) return;

  const itemTop = cumulativeHeights.value[index];
  const viewportTop = scrollTop.value;

  if (itemTop &lt; viewportTop &amp;&amp; virtualListRef.value) {
    virtualListRef.value.scrollTop += diff;
    scrollTop.value = virtualListRef.value.scrollTop;
  }
};

// å¤„ç†æ»šåŠ¨äº‹ä»¶
const handleScroll = (e: Event) =&gt; {
  const target = e.target as HTMLDivElement;
  scrollTop.value = target.scrollTop;

  // å½“æ»šåŠ¨åˆ°è·ç¦»é¡¶éƒ¨LOAD_THRESHOLDåƒç´ æ—¶ï¼ŒåŠ è½½æ›´å¤šæ¶ˆæ¯
  if (
    scrollTop.value &lt;= LOAD_THRESHOLD &amp;&amp;
    !isLoading.value &amp;&amp;
    hasMore.value &amp;&amp;
    isInitialized.value
  ) {
    loadNewMessages();
  }
};


// åˆå§‹åŒ–
onMounted(() =&gt; {
  // è®¡ç®—å®¹å™¨é«˜åº¦ï¼šè§†å£é«˜åº¦å‡å»ä¸Šä¸‹è¾¹è·å’Œæ ‡é¢˜åŒºåŸŸ
  if (containerRef.value) {
    const computedHeight = window.innerHeight - 200; // ç­‰ä»·äº calc(100vh - 200px)
    containerRef.value.style.height = `${Math.max(200, computedHeight)}px`; // é˜²æ­¢è´Ÿæ•°æˆ–å¤ªå°
  }
  // ç¡®ä¿DOMå®Œå…¨æŒ‚è½½åå†åˆå§‹åŒ–æ•°æ®
  nextTick(() =&gt; {
    initData();
  });
});
&lt;/script&gt;

&lt;style scoped&gt;
.overflow-anchor-none {
  overflow-anchor: none;
}
&lt;/style&gt;

</code></pre>
<h3 data-id="heading-11">2. å­ç»„ä»¶ï¼š</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div
    ref="itemRef"
    class="py-2 px-4 border-b border-gray-200"
    :class="{
      'bg-pink-200': item.id % 2 !== 0,
      'bg-green-200': item.id % 2 === 0,
    }"
    :style="{ height: item.id % 2 === 0 ? '150px' : '100px' }"
  &gt;
    {{ item.content }}
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { ref, onMounted, onUpdated, onUnmounted, watch, nextTick } from 'vue';

// å®šä¹‰propsï¼šæ¥æ”¶çˆ¶ç»„ä»¶ä¼ é€’çš„itemæ•°æ®
const props = defineProps&lt;{
  item: {
    id: number;
    content: string;
  };
}&gt;();

// å®šä¹‰emitï¼šå‘çˆ¶ç»„ä»¶ä¼ é€’é«˜åº¦æ›´æ–°äº‹ä»¶
const emit = defineEmits&lt;{
  (e: 'update-height', id: number, height: number): void;
}&gt;();

const itemRef = ref&lt;HTMLDivElement | null&gt;(null);
let resizeObserver: ResizeObserver | null = null;

// è®¡ç®—å¹¶å‘é€å½“å‰ç»„ä»¶çš„é«˜åº¦
const sendItemHeight = () =&gt; {
  if (!itemRef.value) return;
  const realHeight = itemRef.value.offsetHeight;
  emit('update-height', props.item.id, realHeight);
};

// ç›‘å¬ç»„ä»¶æŒ‚è½½ï¼šé¦–æ¬¡å‘é€é«˜åº¦ + ç›‘å¬é«˜åº¦å˜åŒ–
onMounted(() =&gt; {
  // é¦–æ¬¡æ¸²æŸ“å®Œæˆåå‘é€é«˜åº¦
  nextTick(() =&gt; {
    sendItemHeight();
  });

  // ç›‘å¬å…ƒç´ é«˜åº¦å˜åŒ–ï¼ˆé€‚é…åŠ¨æ€å†…å®¹å¯¼è‡´çš„é«˜åº¦å˜åŒ–ï¼‰
  if (window.ResizeObserver) {
    resizeObserver = new ResizeObserver(() =&gt; {
      sendItemHeight();
    });
    if (itemRef.value) {
      resizeObserver.observe(itemRef.value);
    }
  }
});

// ç»„ä»¶æ›´æ–°åé‡æ–°å‘é€é«˜åº¦ï¼ˆæ¯”å¦‚å†…å®¹å˜åŒ–ï¼‰
onUpdated(() =&gt; {
  nextTick(() =&gt; {
    sendItemHeight();
  });
});

// ç»„ä»¶å¸è½½ï¼šæ¸…ç†ç›‘å¬
onUnmounted(() =&gt; {
  if (resizeObserver) {
    resizeObserver.disconnect();
    resizeObserver = null;
  }
});

// ç›‘å¬itemå˜åŒ–ï¼šå¦‚æœitemæ›¿æ¢ï¼Œé‡æ–°è®¡ç®—é«˜åº¦
watch(
  () =&gt; props.item.id,
  () =&gt; {
    nextTick(() =&gt; {
      sendItemHeight();
    });
  }
);
&lt;/script&gt;

</code></pre>
<h3 data-id="heading-12">3. æ•ˆæœå›¾ï¼š</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e215fba6c3644a5fb642682382953bb7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771153211&amp;x-signature=OzJ2Deey2TPyP%2FPxvP0KN1S5pj8%3D" alt="vueè™šæ‹Ÿåˆ—è¡¨å‘ä¸ŠåŠ è½½.gif" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-13">å››ã€ React + TailwindCSSå®ç°</h2>
<p>åœ¨Reactä¸­æˆ‘ä»¬éœ€è¦åˆ©ç”¨ <code>useMemo</code> ä¼˜åŒ–ç´¢å¼•è®¡ç®—ï¼Œå¹¶åˆ©ç”¨ <code>useLayoutEffect</code> å¤„ç†æ»šåŠ¨ä½ç½®ï¼Œé¿å…è§†è§‰é—ªçƒã€‚</p>
<h3 data-id="heading-14">1.  è™šæ‹Ÿåˆ—è¡¨ç»„ä»¶ï¼š</h3>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, {
  useState,
  useRef,
  useEffect,
  useMemo,
  useCallback,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">VirtualListItem</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./VirtualListItem'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">MIN_ITEM_HEIGHT</span> = <span class="hljs-number">80</span>; <span class="hljs-comment">// æ¯ä¸ªåˆ—è¡¨é¡¹çš„æœ€å°é«˜åº¦</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">BUFFER_SIZE</span> = <span class="hljs-number">5</span>; <span class="hljs-comment">// ç¼“å†²åŒºå¤§å°ï¼Œç”¨äºé¢„åŠ è½½</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">LOAD_THRESHOLD</span> = <span class="hljs-number">30</span>; <span class="hljs-comment">// è§¦å‘åŠ è½½çš„pxå€¼</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">NEW_DATA_COUNT</span> = <span class="hljs-number">5</span>; <span class="hljs-comment">// æ¯æ¬¡åŠ è½½çš„æ–°æ•°æ®æ•°é‡</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PRE_LOAD_OFFSET</span> = <span class="hljs-number">100</span>; <span class="hljs-comment">// é¢„åŠ è½½åç§»é‡ï¼Œç”¨äºæå‰åŠ è½½éƒ¨åˆ†æ•°æ®</span>

<span class="hljs-comment">// åˆ—è¡¨é¡¹ç±»å‹å®šä¹‰</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ListItem</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// åˆ—è¡¨é¡¹çš„å”¯ä¸€æ ‡è¯†ç¬¦</span>
  <span class="hljs-attr">content</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// åˆ—è¡¨é¡¹çš„å†…å®¹</span>
  <span class="hljs-attr">timestamp</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// åˆ—è¡¨é¡¹çš„æ—¶é—´æˆ³</span>
}

<span class="hljs-keyword">const</span> <span class="hljs-title class_">VirtualList</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span> = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> virtualListRef = useRef&lt;<span class="hljs-title class_">HTMLDivElement</span>&gt;(<span class="hljs-literal">null</span>); <span class="hljs-comment">// è™šæ‹Ÿåˆ—è¡¨å®¹å™¨å¼•ç”¨</span>
  <span class="hljs-keyword">const</span> containerRef = useRef&lt;<span class="hljs-title class_">HTMLDivElement</span>&gt;(<span class="hljs-literal">null</span>); <span class="hljs-comment">// åˆ—è¡¨å®¹å™¨å¼•ç”¨</span>
  <span class="hljs-keyword">const</span> loadTimerRef = useRef&lt;<span class="hljs-title class_">ReturnType</span>&lt;<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">setTimeout</span>&gt; | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>); <span class="hljs-comment">// åŠ è½½å®šæ—¶å™¨å¼•ç”¨</span>
  <span class="hljs-keyword">const</span> initScrollAttemptsRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// åˆå§‹åŒ–æ»šåŠ¨å°è¯•æ¬¡æ•°å¼•ç”¨ï¼Œæœ€å¤š10æ¬¡</span>
  <span class="hljs-keyword">const</span> [listData, setListData] = useState&lt;<span class="hljs-title class_">ListItem</span>[]&gt;([]); <span class="hljs-comment">// åˆ—è¡¨æ•°æ®çŠ¶æ€ï¼Œåˆå§‹ä¸ºç©ºæ•°ç»„</span>
  <span class="hljs-keyword">const</span> [itemHeights, setItemHeights] = useState&lt;<span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>&gt;&gt;(
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()
  ); <span class="hljs-comment">// åˆ—è¡¨é¡¹é«˜åº¦æ˜ å°„Map</span>
  <span class="hljs-keyword">const</span> [scrollTop, setScrollTop] = useState&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">0</span>); <span class="hljs-comment">// æ»šåŠ¨ä½ç½®çŠ¶æ€ï¼Œåˆå§‹ä¸º0</span>
  <span class="hljs-keyword">const</span> [isLoading, setIsLoading] = useState&lt;<span class="hljs-built_in">boolean</span>&gt;(<span class="hljs-literal">false</span>); <span class="hljs-comment">// åŠ è½½çŠ¶æ€ï¼Œåˆå§‹ä¸ºfalse</span>
  <span class="hljs-keyword">const</span> [isInitialized, setIsInitialized] = useState&lt;<span class="hljs-built_in">boolean</span>&gt;(<span class="hljs-literal">false</span>); <span class="hljs-comment">// åˆå§‹åŒ–çŠ¶æ€ï¼Œåˆå§‹ä¸ºfalse</span>
  <span class="hljs-keyword">const</span> [hasMore, setHasMore] = useState&lt;<span class="hljs-built_in">boolean</span>&gt;(<span class="hljs-literal">true</span>); <span class="hljs-comment">// æ˜¯å¦è¿˜æœ‰æ›´å¤šæ•°æ®çŠ¶æ€ï¼Œåˆå§‹ä¸ºtrue</span>

  <span class="hljs-keyword">const</span> minIdRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-number">10000</span>); <span class="hljs-comment">// æœ€å°IDå¼•ç”¨ï¼Œåˆå§‹ä¸º10000</span>
  <span class="hljs-keyword">const</span> isLoadingRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">false</span>); <span class="hljs-comment">// æ­£åœ¨åŠ è½½çŠ¶æ€</span>
  <span class="hljs-keyword">const</span> hasMoreRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">true</span>); <span class="hljs-comment">// æ˜¯å¦è¿˜æœ‰æ›´å¤šæ•°æ®</span>
  <span class="hljs-keyword">const</span> isFirstInitRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">true</span>); <span class="hljs-comment">// æ˜¯å¦ç¬¬ä¸€æ¬¡åˆå§‹åŒ–</span>
  <span class="hljs-keyword">const</span> scrollStateRef = useRef&lt;{
    <span class="hljs-attr">isManualScroll</span>: <span class="hljs-built_in">boolean</span>;
    <span class="hljs-attr">lastScrollTop</span>: <span class="hljs-built_in">number</span>;
  }&gt;({
    <span class="hljs-attr">isManualScroll</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">lastScrollTop</span>: <span class="hljs-number">0</span>,
  }); <span class="hljs-comment">// æ»šåŠ¨çŠ¶æ€å¼•ç”¨</span>

  <span class="hljs-comment">// åŒæ­¥ ref å’Œ state</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    isLoadingRef.<span class="hljs-property">current</span> = isLoading;
    hasMoreRef.<span class="hljs-property">current</span> = hasMore;
  }, [isLoading, hasMore]);

  <span class="hljs-comment">// è®¡ç®—ç´¯è®¡é«˜åº¦</span>
  <span class="hljs-keyword">const</span> cumulativeHeights = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">heights</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">0</span>];
    <span class="hljs-keyword">let</span> currentSum = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> item <span class="hljs-keyword">of</span> listData) {
      <span class="hljs-keyword">const</span> h = itemHeights.<span class="hljs-title function_">get</span>(item.<span class="hljs-property">id</span>) || <span class="hljs-variable constant_">MIN_ITEM_HEIGHT</span>;
      currentSum += h;
      heights.<span class="hljs-title function_">push</span>(currentSum);
    }
    <span class="hljs-keyword">return</span> heights;
  }, [listData, itemHeights]);

  <span class="hljs-comment">// åˆ—è¡¨æ€»é«˜åº¦</span>
  <span class="hljs-keyword">const</span> totalHeight = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> cumulativeHeights[cumulativeHeights.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>] || <span class="hljs-number">0</span>;
  }, [cumulativeHeights]);

  <span class="hljs-comment">// èµ·å§‹ç´¢å¼•</span>
  <span class="hljs-keyword">const</span> startIndex = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (!virtualListRef.<span class="hljs-property">current</span> || listData.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">let</span> low = <span class="hljs-number">0</span>,
      high = cumulativeHeights.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>;
    <span class="hljs-keyword">while</span> (low &lt;= high) {
      <span class="hljs-keyword">const</span> mid = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((low + high) / <span class="hljs-number">2</span>);
      <span class="hljs-keyword">if</span> (cumulativeHeights[mid] &lt; scrollTop) {
        low = mid + <span class="hljs-number">1</span>;
      } <span class="hljs-keyword">else</span> {
        high = mid - <span class="hljs-number">1</span>;
      }
    }

    <span class="hljs-keyword">const</span> baseIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, low - <span class="hljs-number">1</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, baseIndex - <span class="hljs-variable constant_">BUFFER_SIZE</span>);
  }, [cumulativeHeights, scrollTop, listData.<span class="hljs-property">length</span>]);

  <span class="hljs-comment">// ç»“æŸç´¢å¼•</span>
  <span class="hljs-keyword">const</span> endIndex = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (!virtualListRef.<span class="hljs-property">current</span> || listData.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-variable constant_">BUFFER_SIZE</span> * <span class="hljs-number">2</span>;
    <span class="hljs-keyword">const</span> clientHeight = virtualListRef.<span class="hljs-property">current</span>.<span class="hljs-property">clientHeight</span>;
    <span class="hljs-keyword">const</span> t = scrollTop + clientHeight + <span class="hljs-variable constant_">PRE_LOAD_OFFSET</span>;
    <span class="hljs-keyword">let</span> low = <span class="hljs-number">0</span>,
      high = cumulativeHeights.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>;
    <span class="hljs-keyword">while</span> (low &lt;= high) {
      <span class="hljs-keyword">const</span> mid = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((low + high) / <span class="hljs-number">2</span>);
      <span class="hljs-keyword">if</span> (cumulativeHeights[mid] &lt; t) {
        low = mid + <span class="hljs-number">1</span>;
      } <span class="hljs-keyword">else</span> {
        high = mid - <span class="hljs-number">1</span>;
      }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(listData.<span class="hljs-property">length</span>, low + <span class="hljs-variable constant_">BUFFER_SIZE</span>);
  }, [cumulativeHeights, scrollTop, listData.<span class="hljs-property">length</span>]);

  <span class="hljs-comment">// å¯è§åˆ—è¡¨é¡¹</span>
  <span class="hljs-keyword">const</span> visibleList = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> listData.<span class="hljs-title function_">slice</span>(startIndex, endIndex);
  }, [listData, startIndex, endIndex]);

  <span class="hljs-comment">// åç§»é‡</span>
  <span class="hljs-keyword">const</span> offsetY = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> startIndex === <span class="hljs-number">0</span> ? <span class="hljs-number">0</span> : cumulativeHeights[startIndex];
  }, [cumulativeHeights, startIndex]);

  <span class="hljs-comment">// ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®</span>
  <span class="hljs-keyword">const</span> generateData = <span class="hljs-title function_">useCallback</span>(
    <span class="hljs-function">(<span class="hljs-params">count: <span class="hljs-built_in">number</span>, isInitialLoad: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span></span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> <span class="hljs-attr">arr</span>: <span class="hljs-title class_">ListItem</span>[] = [];
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; count; i++) {
        minIdRef.<span class="hljs-property">current</span>--;
        arr.<span class="hljs-title function_">push</span>({
          <span class="hljs-attr">id</span>: minIdRef.<span class="hljs-property">current</span>,
          <span class="hljs-attr">content</span>: <span class="hljs-string">`å†å²æ¶ˆæ¯ <span class="hljs-subst">${minIdRef.current}</span>`</span>,
          <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toLocaleTimeString</span>(),
        });
      }
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç”Ÿæˆæ•°æ®:'</span>, arr);
      <span class="hljs-keyword">if</span> (!isInitialLoad) {
        arr.<span class="hljs-title function_">reverse</span>();
      }
      <span class="hljs-keyword">return</span> arr;
    },
    []
  );

  <span class="hljs-comment">// æ»šåŠ¨åˆ°åº•éƒ¨</span>
  <span class="hljs-keyword">const</span> scrollToBottom = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (!virtualListRef.<span class="hljs-property">current</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">const</span> scrollEl = virtualListRef.<span class="hljs-property">current</span>;

    <span class="hljs-comment">// ä½¿ç”¨å¤šæ¬¡å°è¯•ï¼Œç›´åˆ°æˆåŠŸæ»šåŠ¨åˆ°åº•éƒ¨</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">attemptScroll</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">const</span> scrollHeight = scrollEl.<span class="hljs-property">scrollHeight</span>;
        <span class="hljs-keyword">const</span> clientHeight = scrollEl.<span class="hljs-property">clientHeight</span>;

        <span class="hljs-keyword">if</span> (scrollHeight &gt; clientHeight) {
          <span class="hljs-keyword">const</span> targetScrollTop = scrollHeight - clientHeight;
          <span class="hljs-keyword">const</span> currentScrollTop = scrollEl.<span class="hljs-property">scrollTop</span>;

          <span class="hljs-comment">// å¦‚æœè¿˜æ²¡åˆ°åº•éƒ¨ï¼Œç»§ç»­æ»šåŠ¨</span>
          <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(currentScrollTop - targetScrollTop) &gt; <span class="hljs-number">1</span>) {
            scrollEl.<span class="hljs-property">scrollTop</span> = targetScrollTop;
            <span class="hljs-title function_">setScrollTop</span>(targetScrollTop);

            <span class="hljs-comment">// å¢åŠ å°è¯•æ¬¡æ•°</span>
            initScrollAttemptsRef.<span class="hljs-property">current</span>++;

            <span class="hljs-comment">// æœ€å¤šå°è¯•10æ¬¡ï¼Œæ¯æ¬¡é—´éš”50ms</span>
            <span class="hljs-keyword">if</span> (initScrollAttemptsRef.<span class="hljs-property">current</span> &lt; <span class="hljs-number">10</span>) {
              <span class="hljs-built_in">setTimeout</span>(attemptScroll, <span class="hljs-number">50</span>);
            } <span class="hljs-keyword">else</span> {
              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'åˆå§‹åŒ–æ»šåŠ¨åˆ°åº•éƒ¨å®Œæˆ'</span>);
              isFirstInitRef.<span class="hljs-property">current</span> = <span class="hljs-literal">false</span>;
            }
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å·²ç»æ»šåŠ¨åˆ°åº•éƒ¨'</span>);
            isFirstInitRef.<span class="hljs-property">current</span> = <span class="hljs-literal">false</span>;
          }
        } <span class="hljs-keyword">else</span> {
          isFirstInitRef.<span class="hljs-property">current</span> = <span class="hljs-literal">false</span>; <span class="hljs-comment">// å†…å®¹é«˜åº¦å°äºå®¹å™¨é«˜åº¦ï¼Œä¸éœ€è¦æ»šåŠ¨</span>
        }
      });
    };

    <span class="hljs-comment">// é‡ç½®å°è¯•æ¬¡æ•°å¹¶å¼€å§‹æ»šåŠ¨</span>
    initScrollAttemptsRef.<span class="hljs-property">current</span> = <span class="hljs-number">0</span>;
    <span class="hljs-title function_">attemptScroll</span>();
  }, []);

  <span class="hljs-comment">// åˆå§‹åŒ–æ•°æ®</span>
  <span class="hljs-keyword">const</span> initData = <span class="hljs-title function_">useCallback</span>(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> initialData = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">ListItem</span>[]&gt;(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span>
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-title function_">generateData</span>(<span class="hljs-number">20</span>, <span class="hljs-literal">true</span>)), <span class="hljs-number">100</span>)
      );
      <span class="hljs-title function_">setListData</span>(initialData);
      <span class="hljs-title function_">setIsInitialized</span>(<span class="hljs-literal">true</span>);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'åˆå§‹åŒ–æ•°æ®å¤±è´¥:'</span>, error);
    }
  }, [generateData]);

  <span class="hljs-comment">// æ ¸å¿ƒï¼šåŠ è½½æ–°æ¶ˆæ¯</span>
  <span class="hljs-keyword">const</span> loadNewMessages = <span class="hljs-title function_">useCallback</span>(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">if</span> (isLoadingRef.<span class="hljs-property">current</span> || !hasMoreRef.<span class="hljs-property">current</span> || !isInitialized) <span class="hljs-keyword">return</span>;

    isLoadingRef.<span class="hljs-property">current</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">true</span>);

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">1000</span>));
      <span class="hljs-keyword">const</span> newData = <span class="hljs-title function_">generateData</span>(<span class="hljs-variable constant_">NEW_DATA_COUNT</span>, <span class="hljs-literal">false</span>);

      <span class="hljs-keyword">const</span> scrollEl = virtualListRef.<span class="hljs-property">current</span>;
      <span class="hljs-keyword">if</span> (!scrollEl) <span class="hljs-keyword">return</span>;

      <span class="hljs-comment">// 1. è®°å½•åŠ è½½å‰çš„æ»šåŠ¨ä½ç½®</span>
      <span class="hljs-keyword">const</span> beforeScrollTop = scrollEl.<span class="hljs-property">scrollTop</span>;
      <span class="hljs-keyword">const</span> beforeScrollHeight = scrollEl.<span class="hljs-property">scrollHeight</span>;

      <span class="hljs-comment">// 2. æ›´æ–°æ•°æ®</span>
      <span class="hljs-title function_">setListData</span>(<span class="hljs-function">(<span class="hljs-params">prev</span>) =&gt;</span> [...newData, ...prev]);

      <span class="hljs-comment">// 3. ç­‰å¾…DOMæ›´æ–°åè°ƒæ•´æ»šåŠ¨ä½ç½®</span>
      <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">if</span> (scrollEl) {
          <span class="hljs-keyword">const</span> afterScrollHeight = scrollEl.<span class="hljs-property">scrollHeight</span>;
          <span class="hljs-keyword">const</span> heightAdded = afterScrollHeight - beforeScrollHeight;

          <span class="hljs-comment">// å…³é”®ä¿®å¤ï¼šæ£€æŸ¥å½“å‰æ˜¯å¦ä»åœ¨é¡¶éƒ¨é™„è¿‘</span>
          <span class="hljs-keyword">const</span> isStillNearTop = scrollEl.<span class="hljs-property">scrollTop</span> &lt;= <span class="hljs-variable constant_">LOAD_THRESHOLD</span> + <span class="hljs-number">50</span>;

          <span class="hljs-comment">// åªæœ‰å½“ç”¨æˆ·æ²¡æœ‰æ‰‹åŠ¨æ»šåŠ¨ä¸”ä»åœ¨é¡¶éƒ¨æ—¶æ‰è°ƒæ•´</span>
          <span class="hljs-keyword">if</span> (!scrollStateRef.<span class="hljs-property">current</span>.<span class="hljs-property">isManualScroll</span> &amp;&amp; isStillNearTop) {
            scrollEl.<span class="hljs-property">scrollTop</span> = beforeScrollTop + heightAdded;
            <span class="hljs-title function_">setScrollTop</span>(scrollEl.<span class="hljs-property">scrollTop</span>);
          }
        }
      });

      <span class="hljs-comment">// æ¨¡æ‹Ÿæ²¡æœ‰æ›´å¤šæ•°æ®</span>
      <span class="hljs-keyword">if</span> (minIdRef.<span class="hljs-property">current</span> &lt;= <span class="hljs-number">9000</span>) {
        hasMoreRef.<span class="hljs-property">current</span> = <span class="hljs-literal">false</span>;
        <span class="hljs-title function_">setHasMore</span>(<span class="hljs-literal">false</span>);
      }
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'åŠ è½½æ¶ˆæ¯å¤±è´¥:'</span>, error);
    } <span class="hljs-keyword">finally</span> {
      isLoadingRef.<span class="hljs-property">current</span> = <span class="hljs-literal">false</span>;
      <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">false</span>);
    }
  }, [generateData, isInitialized]);

  <span class="hljs-comment">// å¤„ç†åˆ—è¡¨é¡¹é«˜åº¦æ›´æ–°</span>
  <span class="hljs-keyword">const</span> handleItemHeightUpdate = <span class="hljs-title function_">useCallback</span>(
    <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">number</span>, realHeight: <span class="hljs-built_in">number</span></span>) =&gt;</span> {
      <span class="hljs-title function_">setItemHeights</span>(<span class="hljs-function">(<span class="hljs-params">prev</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> newHeights = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(prev);
        <span class="hljs-keyword">const</span> oldHeight = newHeights.<span class="hljs-title function_">get</span>(id) || <span class="hljs-variable constant_">MIN_ITEM_HEIGHT</span>;
        <span class="hljs-keyword">const</span> diff = realHeight - oldHeight;

        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(diff) &lt; <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> prev;

        newHeights.<span class="hljs-title function_">set</span>(id, realHeight);

        <span class="hljs-comment">// è‡ªåŠ¨è°ƒæ•´æ»šåŠ¨ä½ç½®</span>
        <span class="hljs-keyword">if</span> (
          virtualListRef.<span class="hljs-property">current</span> &amp;&amp;
          !isFirstInitRef.<span class="hljs-property">current</span> &amp;&amp;
          !scrollStateRef.<span class="hljs-property">current</span>.<span class="hljs-property">isManualScroll</span>
        ) {
          <span class="hljs-keyword">const</span> scrollEl = virtualListRef.<span class="hljs-property">current</span>;
          <span class="hljs-keyword">const</span> index = listData.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> item.<span class="hljs-property">id</span> === id);

          <span class="hljs-keyword">if</span> (index &gt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">const</span> itemTop = cumulativeHeights[index];
            <span class="hljs-keyword">const</span> viewportTop = scrollEl.<span class="hljs-property">scrollTop</span>;

            <span class="hljs-comment">// ä»…å½“å…ƒç´ åœ¨è§†å£ä¸Šæ–¹æ—¶è°ƒæ•´</span>
            <span class="hljs-keyword">if</span> (itemTop &lt; viewportTop) {
              scrollEl.<span class="hljs-property">scrollTop</span> += diff;
              <span class="hljs-title function_">setScrollTop</span>(scrollEl.<span class="hljs-property">scrollTop</span>);
            }
          }
        }

        <span class="hljs-keyword">return</span> newHeights;
      });
    },
    [listData, cumulativeHeights]
  );

  <span class="hljs-comment">// å¤„ç†æ»šåŠ¨äº‹ä»¶</span>
  <span class="hljs-keyword">const</span> handleScroll = <span class="hljs-title function_">useCallback</span>(
    <span class="hljs-function">(<span class="hljs-params">e: React.UIEvent&lt;HTMLDivElement&gt;</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> target = e.<span class="hljs-property">target</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLDivElement</span>;
      <span class="hljs-keyword">const</span> currentScrollTop = target.<span class="hljs-property">scrollTop</span>;
      <span class="hljs-title function_">setScrollTop</span>(currentScrollTop);

      <span class="hljs-comment">// æ ‡è®°æ‰‹åŠ¨æ»šåŠ¨</span>
      scrollStateRef.<span class="hljs-property">current</span> = {
        <span class="hljs-attr">isManualScroll</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">lastScrollTop</span>: currentScrollTop,
      };

      <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦éœ€è¦åŠ è½½</span>
      <span class="hljs-keyword">const</span> shouldLoad = currentScrollTop &lt;= <span class="hljs-variable constant_">LOAD_THRESHOLD</span>;

      <span class="hljs-keyword">if</span> (
        shouldLoad &amp;&amp;
        !isLoadingRef.<span class="hljs-property">current</span> &amp;&amp;
        hasMoreRef.<span class="hljs-property">current</span> &amp;&amp;
        isInitialized
      ) {
        <span class="hljs-comment">// æ¸…é™¤ä¹‹å‰çš„é˜²æŠ–è®¡æ—¶å™¨</span>
        <span class="hljs-keyword">if</span> (loadTimerRef.<span class="hljs-property">current</span>) {
          <span class="hljs-built_in">clearTimeout</span>(loadTimerRef.<span class="hljs-property">current</span>);
        }

        <span class="hljs-comment">// é˜²æŠ–å¤„ç†</span>
        loadTimerRef.<span class="hljs-property">current</span> = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-keyword">if</span> (target.<span class="hljs-property">scrollTop</span> &lt;= <span class="hljs-variable constant_">LOAD_THRESHOLD</span> &amp;&amp; !isLoadingRef.<span class="hljs-property">current</span>) {
            <span class="hljs-title function_">loadNewMessages</span>();
          }
        }, <span class="hljs-number">100</span>);
      }
    },
    [isInitialized, loadNewMessages]
  );

  <span class="hljs-comment">// åˆå§‹åŒ–</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç»„ä»¶æŒ‚è½½ï¼Œå¼€å§‹åˆå§‹åŒ–'</span>);

    <span class="hljs-comment">// è®¾ç½®å®¹å™¨é«˜åº¦</span>
    <span class="hljs-keyword">if</span> (containerRef.<span class="hljs-property">current</span>) {
      <span class="hljs-keyword">const</span> computedHeight = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> - <span class="hljs-number">200</span>;
      containerRef.<span class="hljs-property">current</span>.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.max(<span class="hljs-number">200</span>, computedHeight)}</span>px`</span>;
    }

    <span class="hljs-title function_">initData</span>();

    <span class="hljs-comment">// æ¸…ç†å‡½æ•°</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç»„ä»¶å¸è½½ï¼Œæ¸…ç†å®šæ—¶å™¨'</span>);
      <span class="hljs-keyword">if</span> (loadTimerRef.<span class="hljs-property">current</span>) {
        <span class="hljs-built_in">clearTimeout</span>(loadTimerRef.<span class="hljs-property">current</span>);
      }
    };
  }, [initData]);

  <span class="hljs-comment">// ç›‘å¬æ€»é«˜åº¦å˜åŒ–ï¼Œåœ¨æ•°æ®å®Œå…¨æ¸²æŸ“åæ»šåŠ¨åˆ°åº•éƒ¨</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (isInitialized &amp;&amp; totalHeight &gt; <span class="hljs-number">0</span> &amp;&amp; isFirstInitRef.<span class="hljs-property">current</span>) {
      <span class="hljs-comment">// å»¶è¿Ÿä¸€æ®µæ—¶é—´ç¡®ä¿DOMå®Œå…¨æ¸²æŸ“</span>
      <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">scrollToBottom</span>();
      }, <span class="hljs-number">300</span>); <span class="hljs-comment">// å¢åŠ å»¶è¿Ÿæ—¶é—´ï¼Œç¡®ä¿æ‰€æœ‰åˆ—è¡¨é¡¹éƒ½å·²æ¸²æŸ“å¹¶æµ‹é‡é«˜åº¦</span>

      <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearTimeout</span>(timer);
    }
  }, [isInitialized, totalHeight, scrollToBottom]);

  <span class="hljs-comment">// ç›‘å¬åˆ—è¡¨æ•°æ®å˜åŒ–ï¼Œç¡®ä¿åœ¨é«˜åº¦æµ‹é‡åæ»šåŠ¨</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (listData.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> &amp;&amp; isInitialized &amp;&amp; isFirstInitRef.<span class="hljs-property">current</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'åˆ—è¡¨æ•°æ®æ›´æ–°ï¼Œå½“å‰æ•°æ®é‡:'</span>, listData.<span class="hljs-property">length</span>);

      <span class="hljs-comment">// å†ç»™ä¸€äº›æ—¶é—´è®©æ‰€æœ‰åˆ—è¡¨é¡¹å®Œæˆé«˜åº¦æµ‹é‡</span>
      <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">if</span> (isFirstInitRef.<span class="hljs-property">current</span>) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'é«˜åº¦æµ‹é‡åå°è¯•æ»šåŠ¨'</span>);
          <span class="hljs-title function_">scrollToBottom</span>();
        }
      }, <span class="hljs-number">500</span>);

      <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearTimeout</span>(timer);
    }
  }, [listData.<span class="hljs-property">length</span>, isInitialized, scrollToBottom]);

  <span class="hljs-comment">// é‡ç½®æ‰‹åŠ¨æ»šåŠ¨æ ‡è®°</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      scrollStateRef.<span class="hljs-property">current</span>.<span class="hljs-property">isManualScroll</span> = <span class="hljs-literal">false</span>;
    }, <span class="hljs-number">500</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearTimeout</span>(timer);
  }, [scrollTop]);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"h-full bg-gradient-to-br from-indigo-600 to-purple-600 py-10 px-5"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
        <span class="hljs-attr">ref</span>=<span class="hljs-string">{containerRef}</span>
        <span class="hljs-attr">className</span>=<span class="hljs-string">"bg-white mt-10 rounded-xl border shadow-lg relative"</span>
      &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
          <span class="hljs-attr">ref</span>=<span class="hljs-string">{virtualListRef}</span>
          <span class="hljs-attr">className</span>=<span class="hljs-string">"h-full overflow-auto relative"</span>
          <span class="hljs-attr">onScroll</span>=<span class="hljs-string">{handleScroll}</span>
          <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
            <span class="hljs-attr">overflowAnchor:</span> '<span class="hljs-attr">none</span>',
            <span class="hljs-attr">overscrollBehavior:</span> '<span class="hljs-attr">contain</span>',
            <span class="hljs-attr">scrollBehavior:</span> '<span class="hljs-attr">auto</span>',
          }}
        &gt;</span>
          {/* åŠ è½½æç¤ºï¼ˆç»å¯¹å®šä½ï¼Œä¸å½±å“å¸ƒå±€ï¼‰ */}
          {isLoading &amp;&amp; (
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"absolute top-0 left-0 right-0 z-10 py-2 flex justify-center items-center text-sm text-gray-500 "</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex items-center space-x-2"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>æ­£åœ¨åŠ è½½å†å²æ¶ˆæ¯...<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          )}

          {/* åˆ—è¡¨å ä½å®¹å™¨ */}
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
            <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
              <span class="hljs-attr">height:</span> `${<span class="hljs-attr">totalHeight</span>}<span class="hljs-attr">px</span>`,
              <span class="hljs-attr">pointerEvents:</span> '<span class="hljs-attr">none</span>',
              <span class="hljs-attr">opacity:</span> <span class="hljs-attr">0</span>,
            }}
          &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

          {/* å¯è§†åŒºåŸŸå†…å®¹ */}
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
            <span class="hljs-attr">className</span>=<span class="hljs-string">"absolute top-0 left-0 right-0"</span>
            <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
              <span class="hljs-attr">transform:</span> `<span class="hljs-attr">translateY</span>(${<span class="hljs-attr">offsetY</span>}<span class="hljs-attr">px</span>)`,
              <span class="hljs-attr">width:</span> '<span class="hljs-attr">100</span>%',
            }}
          &gt;</span>
            {visibleList.length === 0 ? (
              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"py-4 text-center text-gray-400"</span>&gt;</span>
                {listData.length === 0
                  ? 'æ­£åœ¨åˆå§‹åŒ–...'
                  : 'åŠ è½½æ›´å¤šå†å²æ¶ˆæ¯...'}
              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            ) : (
              visibleList.map((item) =&gt; (
                <span class="hljs-tag">&lt;<span class="hljs-name">VirtualListItem</span>
                  <span class="hljs-attr">key</span>=<span class="hljs-string">{item.id}</span>
                  <span class="hljs-attr">item</span>=<span class="hljs-string">{item}</span>
                  <span class="hljs-attr">onUpdateHeight</span>=<span class="hljs-string">{handleItemHeightUpdate}</span>
                /&gt;</span>
              ))
            )}
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

          {/* æ²¡æœ‰æ›´å¤šæ•°æ®çš„æç¤º */}
          {!hasMore &amp;&amp; (
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"absolute bottom-0 left-0 right-0 py-2 text-center text-sm text-gray-400 bg-white border-t"</span>&gt;</span>
              æ²¡æœ‰æ›´å¤šå†å²æ¶ˆæ¯äº†
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          )}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">VirtualList</span>;

</code></pre>
<h3 data-id="heading-15">2. å­ç»„ä»¶ï¼š</h3>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, {
  useEffect,
  useRef,
  forwardRef,
  useImperativeHandle,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ListItemProps</span> {
  <span class="hljs-attr">item</span>: {
    <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">content</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">timestamp</span>: <span class="hljs-built_in">string</span>;
  };
  <span class="hljs-attr">onUpdateHeight</span>: <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">number</span>, height: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
}

<span class="hljs-keyword">const</span> <span class="hljs-title class_">VirtualListItem</span> = forwardRef&lt;<span class="hljs-title class_">HTMLDivElement</span>, <span class="hljs-title class_">ListItemProps</span>&gt;(
  <span class="hljs-function">(<span class="hljs-params">{ item, onUpdateHeight }, ref</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> itemRef = useRef&lt;<span class="hljs-title class_">HTMLDivElement</span>&gt;(<span class="hljs-literal">null</span>);
    <span class="hljs-keyword">const</span> resizeObserverRef = useRef&lt;<span class="hljs-title class_">ResizeObserver</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);

    <span class="hljs-title function_">useImperativeHandle</span>(ref, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (itemRef.<span class="hljs-property">current</span>) {
        <span class="hljs-keyword">return</span> itemRef.<span class="hljs-property">current</span>;
      }
      <span class="hljs-comment">// æä¾›ä¸€ä¸ªå®‰å…¨çš„é»˜è®¤å€¼</span>
      <span class="hljs-keyword">const</span> emptyDiv = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
      <span class="hljs-keyword">return</span> emptyDiv;
    });

    <span class="hljs-comment">// ä½¿ç”¨ ResizeObserver ç›‘å¬å°ºå¯¸å˜åŒ–</span>
    <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> <span class="hljs-title function_">updateHeight</span> = (<span class="hljs-params"/>) =&gt; {
        <span class="hljs-keyword">if</span> (itemRef.<span class="hljs-property">current</span>) {
          <span class="hljs-keyword">const</span> height = itemRef.<span class="hljs-property">current</span>.<span class="hljs-property">offsetHeight</span>;
          <span class="hljs-title function_">onUpdateHeight</span>(item.<span class="hljs-property">id</span>, height);
        }
      };

      <span class="hljs-comment">// ç«‹å³æ‰§è¡Œä¸€æ¬¡åˆå§‹æµ‹é‡</span>
      <span class="hljs-title function_">updateHeight</span>();

      <span class="hljs-keyword">if</span> (!resizeObserverRef.<span class="hljs-property">current</span>) {
        resizeObserverRef.<span class="hljs-property">current</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResizeObserver</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-comment">// é˜²æŠ–å¤„ç†ï¼Œé¿å…é¢‘ç¹è§¦å‘</span>
          <span class="hljs-keyword">if</span> (itemRef.<span class="hljs-property">current</span>) {
            <span class="hljs-title function_">requestAnimationFrame</span>(updateHeight);
          }
        });
      }

      <span class="hljs-keyword">if</span> (itemRef.<span class="hljs-property">current</span> &amp;&amp; resizeObserverRef.<span class="hljs-property">current</span>) {
        resizeObserverRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">observe</span>(itemRef.<span class="hljs-property">current</span>);
      }

      <span class="hljs-comment">// é¢å¤–çš„åˆå§‹å»¶è¿Ÿæµ‹é‡ï¼Œç¡®ä¿æ ·å¼å·²åº”ç”¨</span>
      <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">updateHeight</span>();
      }, <span class="hljs-number">10</span>);

      <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">if</span> (resizeObserverRef.<span class="hljs-property">current</span> &amp;&amp; itemRef.<span class="hljs-property">current</span>) {
          resizeObserverRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">unobserve</span>(itemRef.<span class="hljs-property">current</span>);
        }
        <span class="hljs-built_in">clearTimeout</span>(timer);
      };
    }, [item.<span class="hljs-property">id</span>, onUpdateHeight]);

    <span class="hljs-comment">// æ¨¡æ‹Ÿä¸åŒçš„å†…å®¹é«˜åº¦</span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">itemStyle</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">CSSProperties</span> = {
      <span class="hljs-attr">height</span>: item.<span class="hljs-property">id</span> % <span class="hljs-number">2</span> === <span class="hljs-number">0</span> ? <span class="hljs-string">'150px'</span> : <span class="hljs-string">'100px'</span>,
    };

    <span class="hljs-keyword">const</span> itemClass = <span class="hljs-string">`<span class="hljs-subst">${item.id % <span class="hljs-number">2</span> !== <span class="hljs-number">0</span> ? <span class="hljs-string">'bg-pink-200'</span> : <span class="hljs-string">'bg-green-200'</span>}</span>`</span>;

    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{itemRef}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{itemClass}</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{itemStyle}</span>&gt;</span>
        {item.id}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
  }
);

<span class="hljs-title class_">VirtualListItem</span>.<span class="hljs-property">displayName</span> = <span class="hljs-string">'VirtualListItem'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">VirtualListItem</span>;

</code></pre>
<h3 data-id="heading-16">3. æ•ˆæœå›¾ï¼š</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fefe968eb5944d8ebbe117392accb166~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771153211&amp;x-signature=wa5927FGRiU2sQbFSSoCw9Y0hIo%3D" alt="reactè™šæ‹Ÿåˆ—è¡¨å‘ä¸ŠåŠ è½½.gif" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-17">äº”ã€ æ³¨æ„äº‹é¡¹</h2>
<ul>
<li>
<p><strong>æµè§ˆå™¨å¹²æ‰°</strong>ï¼šå¿…é¡»è®¾ç½® <code>overflow-anchor: none</code>ã€‚ç°ä»£æµè§ˆå™¨å°è¯•è‡ªåŠ¨è°ƒæ•´æ»šåŠ¨ä½ç½®ï¼Œè¿™ä¼šä¸æˆ‘ä»¬çš„æ‰‹åŠ¨è¡¥å¿å†²çªã€‚</p>
</li>
<li>
<p><strong>ç´¢å¼•è¾¹ç•Œæ£€æŸ¥</strong>ï¼šå¯¹åˆ‡ç‰‡ç´¢å¼•æ‰§è¡Œ <code>Math.max(0, ...)</code> ä¸ <code>Math.min(total, ...)</code> çš„åŒºé—´æ”¶æ•›ï¼Œé˜²æ­¢å›  <code>startIndex</code> æˆ– <code>endIndex</code> è¶Šç•Œå¯¼è‡´çš„æ¸²æŸ“å¼‚å¸¸ã€‚</p>
</li>
<li>
<p><strong>åˆå§‹åŒ–æ—¶æœº</strong>ï¼šé¦–æ¬¡åŠ è½½æ•°æ®åï¼Œåº”è°ƒç”¨ <code>scrollToBottom()</code>ã€‚ä¸ºäº†ç¡®ä¿æ¸²æŸ“å®Œæˆï¼Œå»ºè®®é‡‡ç”¨ <code>requestAnimationFrame</code> + <code>setTimeout</code> çš„åŒé‡ä¿é™©ã€‚</p>
</li>
<li>
<p><strong>æ— æ„ŸåŠ è½½ç­–ç•¥</strong>ï¼šæ‰§è¡Œå¤´éƒ¨æ•°æ®æ’å…¥å‰ï¼Œéœ€å¿«ç…§è®°å½•å½“å‰çš„ <code>scrollHeight</code>ã€‚æ•°æ®æ¨é€è‡³æ¸²æŸ“å¼•æ“åï¼Œé€šè¿‡ <code>newScrollHeight - oldScrollHeight</code> ç®—å¾— <strong>ç©ºé—´å¢é‡</strong>ï¼Œå¹¶å°†å…¶ç´¯åŠ è‡³å½“å‰æ»šåŠ¨åç§»é‡ä¸Šã€‚è¯¥è¡¥å¿é€»è¾‘éœ€åœ¨æ¸²æŸ“åˆ·æ–°å‰å®Œæˆï¼Œä»¥å®ç°â€œæ— æ„ŸåŠ è½½â€</p>
</li>
<li>
<p><strong>æ€§èƒ½ç“¶é¢ˆ</strong>ï¼šéšç€ <code>listData</code> å¢åŠ åˆ°æ•°ä¸‡æ¡ï¼Œ<code>cumulativeHeights</code> çš„è®¡ç®—å¯èƒ½å˜æ…¢ã€‚æ­¤æ—¶å¯è€ƒè™‘<strong>åˆ†æ®µè®¡ç®—</strong>ç»´æŠ¤é«˜åº¦ã€‚</p>
</li>
</ul>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring æºç åˆ†æ BeanFactoryPostProcessor]]></title>    <link>https://juejin.cn/post/7603771025856528435</link>    <guid>https://juejin.cn/post/7603771025856528435</guid>    <pubDate>2026-02-08T06:21:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603771025856528435" data-draft-id="7599852579067133967" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring æºç åˆ†æ BeanFactoryPostProcessor"/> <meta itemprop="keywords" content="Spring,Spring Boot,æºç "/> <meta itemprop="datePublished" content="2026-02-08T06:21:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æš®è‰²å¦–å¨†ä¸¶"/> <meta itemprop="url" content="https://juejin.cn/user/4292946760307655"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring æºç åˆ†æ BeanFactoryPostProcessor
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4292946760307655/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æš®è‰²å¦–å¨†ä¸¶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T06:21:32.000Z" title="Sun Feb 08 2026 06:21:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»16åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>ä¸Šä¸€ç¯‡è®²è¿°äº† <code>SpringBoot</code> å¯åŠ¨æµç¨‹å’Œç›¸å…³æºç åˆ†æï¼Œå…¶ä¸­ä¸€ä¸ªé‡è¦çš„åˆ·æ–°æ–¹æ³•  <code>AbstractApplicationContext#refresh()</code> æ˜¯å±äº <code>Spring</code> çš„å†…å®¹ï¼Œä¹Ÿæ˜¯ <code>Spring</code> æ¡†æ¶çš„æ ¸å¿ƒæ–¹æ³•ï¼Œææ‡‚äº†è¿™ä¸ªæ–¹æ³•ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥è¯´å°±å®Œå…¨ææ‡‚äº† <code>Spring</code></p>
<p>æƒ³äº†å¾ˆä¹…ä¸çŸ¥é“å¯¹äºè¿™æ ·ä¸€ä¸ªå¤æ‚çš„æ¡†æ¶ï¼Œä»ä½•å¼€å§‹è®²èµ·ï¼Œé‚£ä¹ˆå°±æŒ‰ç…§ <code>AbstractApplicationContext#refresh()</code> çš„å†…éƒ¨ä»£ç é¡ºåºæ¥å§ï¼Œå…ˆå­¦ä¹  <code>BeanFactoryPostProcessor</code>ã€‚</p>
<p>æœ¬ç¯‡æ–‡ç« ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯ <code>SpringBoot 3.4.1 ã€ Spring 6.2.1</code>ã€‚</p>
<h2 data-id="heading-1">SpringBoot &amp; Spring æ¶æ„å›¾ç¤ºæ¦‚è§ˆ</h2>
<p>è¿™é‡Œæˆ‘ä»¥ <code>SpringBoot</code> æºç å…¥å£ä¸ºèµ·ç‚¹ï¼Œç”»äº†ä¸€ä¸ªç›¸å…³çš„æµç¨‹å›¾ï¼ŒåŒ…å«äº† <code>SpringBootã€Spring äº‹åŠ¡ã€Spring AOPã€Spring äº‹ä»¶ã€BeanFactoryPostProcessorã€BeanPostProcessor</code> ç­‰æ‰€æœ‰ <code>Spring</code> çŸ¥è¯†ï¼Œä»¥åŠç›¸å…³æ¨¡å—ä¹‹é—´çš„äº¤äº’è”ç³»ï¼Œåç»­ä¹Ÿä¼šæŒç»­æ›´æ–°æ­¤å›¾ï¼ˆå› ä¸ºæˆ‘è‡ªå·±è¿˜æ²¡æœ‰å­¦å®Œï¼‰ï¼Œæˆ‘è¯•äº†ä¸‹ä½œè€…ä¾§è¿™è¾¹æ›´æ–°åï¼Œåˆ†äº«çš„åä½œé“¾æ¥ä¹Ÿä¼šå®æ—¶å˜æ›´ï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰å¸®åŠ©</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.processon.com%2Fv%2F696465e679c29354e9e50f69" target="_blank" title="https://www.processon.com/v/696465e679c29354e9e50f69" ref="nofollow noopener noreferrer">SpringBoot &amp; Spring æ¶æ„å›¾ æŒç»­æ›´æ–°</a> å¯¹äºå³å°†éœ€è¦é¢è¯•çš„åŒå­¦åº”è¯¥ä¼šæ¯”è¾ƒæœ‰å¸®åŠ©ï¼</p>
<h2 data-id="heading-2">å‰ç½®çŸ¥è¯† IoC å®¹å™¨</h2>
<p><code>IoC</code> å…¨ç§° <code>Inversion of Control</code>ï¼Œå«åšæ§åˆ¶åè½¬ï¼Œå®ƒæ˜¯ä¸€ç§è®¾è®¡åŸåˆ™ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯å°†å¯¹è±¡åˆ›å»ºã€ä¾èµ–ç®¡ç†å’Œç”Ÿå‘½å‘¨æœŸæ§åˆ¶çš„æƒåŠ›ä»åº”ç”¨ç¨‹åºä»£ç  <strong>åè½¬</strong> ç»™å®¹å™¨ï¼ˆæ¡†æ¶ï¼‰ã€‚</p>
<p>åŸæœ¬æˆ‘ä»¬éœ€è¦è°ƒç”¨æŸä¸ªä¸šåŠ¡æ–¹æ³•ï¼Œéœ€è¦è‡ªå·±å®ä¾‹åŒ–å¯¹è±¡ï¼Œç„¶åè°ƒç”¨è¯¥å¯¹è±¡æŸä¸ªæ–¹æ³•ï¼Œä½¿ç”¨ <code>Spring</code> ä¹‹åï¼Œæˆ‘ä»¬æŠŠè¯¥å¯¹è±¡äº¤ç»™ <code>Spring</code> ç®¡ç†ï¼Œ<code>Spring</code> æ¡†æ¶å¸®æˆ‘ä»¬åˆ›å»ºå¯¹è±¡ï¼Œæˆ‘ä»¬åªéœ€è¦æ‹¿ <code>Spring</code> åˆ›å»ºå¥½çš„å¯¹è±¡å³å¯ã€‚è€Œæˆ‘ä»¬äº¤ç»™ <code>Spring</code> ç®¡ç†çš„å¯¹è±¡é€šå¸¸å°±å«åš <code>Bean</code>ã€‚</p>
<p><code>IoC</code> å®¹å™¨å°±æ˜¯é€šå¸¸æˆ‘ä»¬å¸¸è¯´çš„ <code>Spring ä¸Šä¸‹æ–‡</code>ï¼Œ<code>ApplicationContext</code> çš„å®ç°ç±»ï¼Œå¯¹äº <code>SpringBoot</code> æ¥è¯´ï¼Œå…¶æ‰©å±•çš„å®ç°ç±»æ˜¯ <code>AnnotationConfigServletWebServerApplicationContext</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
   <span class="hljs-type">ConfigurableApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> SpringApplication.run(SpringAiDemoApplication.class, args);
}
</code></pre>
<p><code>SpringBoot</code> ä¸»ç±»çš„ <code>run</code> æ–¹æ³•ï¼Œå…¶è¿”å›å€¼å°±æ˜¯ä¸€ä¸ª <code>IoC</code> å®¹å™¨ï¼Œ<code>ApplicationContext</code> çš„å­æ¥å£</p>
<h2 data-id="heading-3">å‰ç½®çŸ¥è¯† BeanDefinition å’Œ Bean</h2>
<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ç›¸ä¿¡å¤§å®¶éƒ½æ˜¯å·²ç»ç†Ÿæ‚‰ <code>Spring</code> æ¡†æ¶çš„æ—¥å¸¸ç”¨æ³•ï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªå‰ç½®çŸ¥è¯†å‚¨å¤‡ï¼Œåœ¨ <code>Spring</code> å®¹å™¨ä¸­ï¼Œ<code>Bean</code> çš„åˆ›å»ºéƒ½æ˜¯ç”± <code>BeanDefinition</code> å†³å®šçš„ï¼Œ <code>BeanDefinition</code> æè¿°äº†è¿™ä¸ª <code>Bean</code> çš„æ‰€æœ‰ä¿¡æ¯</p>
<ul>
<li><code>Bean</code> çš„ç±»å‹</li>
<li><code>Bean</code> çš„åå­—</li>
<li>å•ä¾‹è¿˜æ˜¯å¤šä¾‹</li>
<li>æ˜¯å¦å»¶è¿ŸåŠ è½½</li>
<li>æ˜¯å¦å…è®¸è‡ªåŠ¨è£…é…</li>
<li>ç­‰ç­‰</li>
</ul>
<p>æ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨ <code>@Configurationã€@Beanã€@Component</code> æ³¨è§£ä¸€ä¸ª <code>Bean</code>ã€‚åˆ·æ–°æ–¹æ³•ä¸­ï¼Œå…ˆè§£æè¿™äº›æ³¨è§£å¾—åˆ°äº† <code>BeanDefinition</code> ä¿¡æ¯ï¼Œå½“æ‰€æœ‰é…ç½®ç›¸å…³çš„æ³¨è§£è¢«è§£æå®Œï¼Œå¾—åˆ°ä¸€ä¸ª</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, BeanDefinition&gt; beanDefinitionMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;(<span class="hljs-number">256</span>);
<span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> List&lt;String&gt; beanDefinitionNames = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(<span class="hljs-number">256</span>);
</code></pre>
<p>ç„¶å <code>Spring</code> éå†è¿™ä¸ª <code>beanDefinitionNames</code> å»åˆ›å»º <code>Bean</code>ã€‚</p>
<blockquote>
<p>å› ä¸º HashMap æ˜¯æ— åºçš„ï¼Œåˆ›å»º Bean éœ€è¦æ ¹æ®é¡ºåºåˆ›å»ºï¼Œæ‰€ä»¥éœ€è¦è¿™ä¸ª beanDefinitionNames</p>
</blockquote>
<h2 data-id="heading-4">BeanFactoryPostProcessor çš„ä½œç”¨</h2>
<p>å­¦ä¹ æºç ï¼Œæœ€æœ‰æ•ˆçš„æ–¹å¼ä¹‹ä¸€å°±æ˜¯çœ‹æ³¨é‡Šï¼Œ</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * Factory hook that allows for custom modification of an application context's
 * bean definitions, adapting the bean property values of the context's underlying
 * bean factory.
 * ......
 */</span>
<span class="hljs-meta">@FunctionalInterface</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">BeanFactoryPostProcessor</span> {

    <span class="hljs-comment">/**
     * Modify the application context's internal bean factory after its standard
     * initialization. All bean definitions will have been loaded, but no beans
     * will have been instantiated yet. This allows for overriding or adding
     * properties even to eager-initializing beans.
     * <span class="hljs-doctag">@param</span> beanFactory the bean factory used by the application context
     * <span class="hljs-doctag">@throws</span> org.springframework.beans.BeansException in case of errors
     */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessBeanFactory</span><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="hljs-keyword">throws</span> BeansException;

}
</code></pre>
<p>æ³¨é‡Šè¯´æ˜è¿™ä¸ªç±»çš„ä½œç”¨ç›¸å½“äºä¸€ä¸ªå·¥å‚å›è°ƒå‡½æ•°ï¼ˆé€šå¸¸æˆ‘ä»¬å«å®ƒ <code>Bean å·¥å‚åç½®å¤„ç†å™¨</code>ï¼‰ï¼Œå¯ä»¥è°ƒæ•´ä¸Šä¸‹æ–‡çš„åº•å±‚<code>Bean</code> å·¥å‚çš„ <code>Bean</code> å±æ€§å€¼ã€‚ä¹Ÿå°±æ˜¯åœ¨ <code>Bean</code> åˆ›å»ºå‰ï¼Œ<code>BeanDefinition</code> å·²é»˜è®¤åŠ è½½åï¼Œä¿®æ”¹æŸäº› <code>BeanDefinition</code> ã€‚å› ä¸º <code>Bean</code> çš„åˆ›å»ºæ˜¯ç”± <code>BeanDefinition</code> å†³å®šçš„ï¼Œæ‰€ä»¥ä¿®æ”¹ <code>BeanDefinition</code>ï¼Œä¹Ÿå°±ç›¸å½“äºä¿®æ”¹å³å°†è¦åˆ›å»ºçš„ <code>Bean</code></p>
<h2 data-id="heading-5">å†…ç½®çš„ BeanFactoryPostProcessor</h2>
<p>åœ¨ä¸Šä¸€ç¯‡ <code>SpringBoot</code> æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æåˆ°åœ¨åˆ›å»º <code>Spring</code> ä¸Šä¸‹æ–‡çš„æ—¶å€™ï¼Œ<code>AnnotationConfigServletWebServerApplicationContext</code> çš„æ„é€ æ–¹æ³•ä¸­ï¼Œä¼šæ³¨å†Œä¸€äº›å†…ç½®çš„ <code>BeanFactoryPostProcessor</code>ã€‚æºç </p>
<pre><code class="hljs language-java" lang="java">org.springframework.context.annotation.AnnotationConfigUtils#registerAnnotationConfigProcessors()
</code></pre>
<p>å†…ç½®ä¼šæ³¨å†Œä»¥ä¸‹åç½®å¤„ç†å™¨</p>
<pre><code class="hljs language-java" lang="java">ConfigurationClassPostProcessor  å¤„ç†æ‰€æœ‰é…ç½®æ³¨è§£ <span class="hljs-meta">@Componentscan</span>ã€<span class="hljs-meta">@Import</span>ã€<span class="hljs-meta">@Bean</span>ã€<span class="hljs-meta">@Component</span> ç­‰
AutowiredAnnotationBeanPostProcessor  å¤„ç† <span class="hljs-meta">@Autowired</span>
CommonAnnotationBeanPostProcessor     å¤„ç† <span class="hljs-meta">@PostConstruct</span>ã€<span class="hljs-meta">@Resource</span> ç­‰
PersistenceAnnotationBeanPostProcessor(å¦‚æœç”¨äº† JPA)
EventListenerMethodProcessor    å¤„ç† <span class="hljs-meta">@EventListener</span>
DefaultEventListenerFactory  ï¼ˆä¸æ˜¯åç½®å¤„ç†å™¨ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆæ”¾åœ¨è¿™ä¸ªæ–¹æ³•é‡Œï¼‰
</code></pre>
<p>è¿™é‡Œåªæœ‰ <code>ConfigurationClassPostProcessor</code> å’Œ <code>EventListenerMethodProcessor</code> æ˜¯å·¥å‚åç½®å¤„ç†å™¨ <code>BeanFactoryPostProcessor</code>ï¼Œå…¶ä»–éƒ½æ˜¯ Bean çš„åç½®å¤„ç†å™¨ <code>BeanPostProcessor</code>ï¼Œä¸‹ä¸€ç¯‡æ–‡ç« ä¼šä»‹ç»ã€‚åœ¨ä»‹ç» <code>ConfigurationClassPostProcessor</code> å’Œ <code>EventListenerMethodProcessor</code> çš„ä½œç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå­¦ä¹ ä¸€ä¸ª <code>BeanFactoryPostProcessor</code> çš„æ‰©å±•æ¥å£ <code>BeanDefinitionRegistryPostProcessor</code>ã€‚</p>
<h2 data-id="heading-6">BeanDefinitionRegistryPostProcessor</h2>
<p>è¿˜æ˜¯è€è§„çŸ©ï¼Œå­¦ä¹ ä¸€ä¸ªç±»ä¹‹å‰å…ˆçœ‹æ³¨é‡Š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * Extension to the standard {<span class="hljs-doctag">@link</span> BeanFactoryPostProcessor} SPI, allowing for
 * the registration of further bean definitions &lt;i&gt;before&lt;/i&gt; regular
 * BeanFactoryPostProcessor detection kicks in. In particular,
 * BeanDefinitionRegistryPostProcessor may register further bean definitions
 * which in turn define BeanFactoryPostProcessor instances.

 * <span class="hljs-doctag">@see</span> org.springframework.context.annotation.ConfigurationClassPostProcessor
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">BeanDefinitionRegistryPostProcessor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BeanFactoryPostProcessor</span> {

    <span class="hljs-comment">/**
     * Modify the application context's internal bean definition registry after its
     * standard initialization. All regular bean definitions will have been loaded,
     * but no beans will have been instantiated yet. This allows for adding further
     * bean definitions before the next post-processing phase kicks in.
     * <span class="hljs-doctag">@param</span> registry the bean definition registry used by the application context
     * <span class="hljs-doctag">@throws</span> org.springframework.beans.BeansException in case of errors
     */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessBeanDefinitionRegistry</span><span class="hljs-params">(BeanDefinitionRegistry registry)</span> <span class="hljs-keyword">throws</span> BeansException;
}
</code></pre>
<p>æ³¨é‡Šè¯´ <code>BeanDefinitionRegistryPostProcessor</code> æ˜¯ <code>BeanFactoryPostProcessor</code> çš„ä¸€ä¸ªæ‰©å±•æ¥å£ã€‚å®¹å™¨åˆ·æ–°è¿‡ç¨‹ä¸­ <code>postProcessBeanDefinitionRegistry()</code> åœ¨ <code>postProcessBeanFactory()</code> ä¹‹å‰æ‰§è¡Œï¼Œä»–ä»¬çš„åŒºåˆ«å’Œä½œç”¨å¦‚ä¸‹</p>
<h3 data-id="heading-7">å’Œ BeanFactoryPostProcessor çš„åŒºåˆ«å¯¹æ¯”</h3>
<p>è¿™é‡Œç”¨ä¸€ä¸ªè¡¨æ ¼æ¥å¯¹æ¯” <code>BeanDefinitionRegistryPostProcessor</code> å’Œ <code>BeanFactoryPostProcessor</code> çš„æ–¹æ³•</p>



































<table><thead><tr><th>ç»´åº¦</th><th>postProcessBeanDefinitionRegistry</th><th>postProcessBeanFactory</th></tr></thead><tbody><tr><td><strong>æ‰§è¡Œæ—¶æœº</strong></td><td><strong>æ›´æ—©</strong>ï¼Œåœ¨æ‰€æœ‰ BeanFactoryPostProcessor ä¹‹å‰</td><td><strong>ç¨æ™š</strong>ï¼Œåœ¨æ‰€æœ‰ postProcessBeanDefinitionRegistry ä¹‹å</td></tr><tr><td><strong>å‚æ•°ç±»å‹</strong></td><td><code>BeanDefinitionRegistry</code></td><td><code>ConfigurableListableBeanFactory</code></td></tr><tr><td><strong>ä¸»è¦ç”¨é€”</strong></td><td><strong>æ³¨å†Œã€ä¿®æ”¹ã€ç§»é™¤</strong> BeanDefinition</td><td><strong>ä¿®æ”¹</strong> å·²æ³¨å†Œçš„ BeanDefinitionï¼Œä¸èƒ½æ³¨å†Œå’Œç§»é™¤</td></tr><tr><td><strong>èƒ½åŠ›èŒƒå›´</strong></td><td><strong>æ³¨å†Œæ–° Bean</strong> çš„èƒ½åŠ›æ›´å¼º</td><td><strong>ä¿®æ”¹ç°æœ‰ Bean</strong> çš„å±æ€§</td></tr><tr><td><strong>æ‰§è¡Œé¡ºåº</strong></td><td>ç¬¬ä¸€é˜¶æ®µ</td><td>ç¬¬äºŒé˜¶æ®µ</td></tr></tbody></table>
<p>ä¹Ÿå°±æ˜¯è¯´ä»–ä»¬ä¸¤éƒ½æ˜¯å¯¹ <code>BeanDefinition</code> åšæ“ä½œçš„ï¼Œåªä¸è¿‡æ—¶æœºä¸åŒ</p>
<h2 data-id="heading-8">å¸¸è§çš„ BeanFactoryPostProcessor</h2>
<p><code>SpringBoot</code> é¡¹ç›®ä¸­æœ‰ä¸€äº›å†…ç½®çš„å·¥å‚åç½®å¤„ç†å™¨</p>
<ul>
<li><code>ConfigurationClassPostProcessor</code>  è§£æé…ç½®ç±»ï¼Œè·å– <code>BeanDefiniton</code></li>
<li><code>EventListenerMethodProcessor</code>     åˆå§‹åŒ–äº‹ä»¶å·¥å‚ï¼Œä¸ºäº†åç»­åˆ›å»ºäº‹ä»¶ç›‘å¬å™¨</li>
<li><code>PropertySourcesPlaceholderConfigurer</code> å¤„ç†é…ç½®ç±»æˆå‘˜å˜é‡çš„å€¼æœ‰å±æ€§å ä½ç¬¦ï¼Œæ¯”å¦‚æœ‰äº› <code>Bean</code> çš„æŸä¸ªå±æ€§å€¼æ˜¯ <code>${mybatis-plus.lazy-initialization}</code> è¿™ç§è¡¨è¾¾å¼ï¼Œå°±æ˜¯é€šè¿‡è¿™ä¸ªåç½®å¤„ç†å™¨æ¥è§£æèµ‹å€¼</li>
<li><code>MapperScannerConfigurer</code> å¦‚æœä½¿ç”¨äº† <code>mybatis</code> ï¼Œæ‰«æ <code>@Mapper</code> æ³¨è§£çš„ç±»ï¼Œæ·»åŠ åˆ° <code>Spring</code> å®¹å™¨</li>
<li><code>CachingMetadataReaderFactoryPostProcessor</code>  ç¼“å­˜ <code>ResourceLoader</code> å·²åŠ è½½çš„é…ç½®ç±»ï¼Œä¸è¦é‡å¤åŠ è½½</li>
</ul>
<p>ä¸‹é¢æˆ‘ä»¬è¯¦ç»†ä»‹ç»å…¶ä¸­å‡ ä¸ªé‡è¦çš„å·¥å‚åç½®å¤„ç†å™¨çš„ä½œç”¨ã€‚</p>
<h2 data-id="heading-9">BeanFactoryPostProcessor çš„æ‰§è¡Œ</h2>
<p>å·¥å‚åç½®å¤„ç†å™¨çš„æ‰§è¡Œæ–¹æ³•æ˜¯é€šè¿‡ä¸€ä¸ªå§”æ‰˜ç±» <code>PostProcessorRegistrationDelegate</code> å®ç°çš„</p>
<pre><code class="hljs language-java" lang="java">PostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(beanFactory, getBeanFactoryPostProcessors());
</code></pre>
<p>è¿™ä¸ªæ–¹æ³•éå¸¸æœ‰æ„æ€ï¼Œä½œè€…åœ¨è¿™é‡Œç»™å‡ºäº†ä¸€å¤§æ®µçš„æ³¨é‡Šï¼Œå‘Šè¯‰è¯»è€…ä¸è¦å†å» <code>Github</code> æ <code>issue</code> äº†ï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•çš„ä»£ç çœ‹èµ·æ¥å¾ˆä¹±ã€æœ‰å¾ˆå¤šé‡å¤ä»£ç ï¼Œå¾ˆå¤šè¯»è€…æäº† <code>issue</code> è¡¨æ˜è¿™ä¸ªæ–¹æ³•éœ€è¦ä¼˜åŒ–ï¼Œä½†æ˜¯ä½œè€…ä¸€ä¸€æ‹’ç»ï¼Œå›åº”è¯´è¿™ç§å®ç°æ˜¯å¿…è¦çš„ï¼Œä¸€å®šè¦ç¡®ä¿å·¥å‚åç½®å¤„ç†å™¨çš„æ‰§è¡Œé¡ºåºã€‚æœ‰å…´è¶£å¯ä»¥æŸ¥é˜…ä¸Šè¿°æ–¹æ³•çš„æºç </p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a1cf98563ec41d08e400d64fcb53590~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pqu6Imy5aaW5aiG5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771136492&amp;x-signature=ork6UczAeDRGazI37V22JO8O63Y%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™é‡Œä½œè€…å°† <code>BeanDefinitionRegistryPostProcessor</code> å’Œ <code>BeanFactoryPostProcessor</code> åˆ†å¼€ï¼Œå¹¶ä¸”å°†å®ƒä»¬åˆ†åˆ«æŒ‰ç…§é¡ºåºæ’åºæ”¾åˆ°ä¸åŒåˆ—è¡¨ä¸­ä¾æ¬¡æ‰§è¡Œã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼Œè¿™ä¸ªé˜¶æ®µè¿˜æ²¡æœ‰åˆ›å»º <code>Bean</code> ï¼Œæ‰€ä»¥è¦æ‰§è¡Œçš„ <code>BeanFactoryPostProcessor</code> ï¼Œéƒ½æ˜¯é€šè¿‡ä» <code>BeanFactory</code> é‡Œé¢çš„ <code>beanDefinitonNames</code> é›†åˆæ‹¿åˆ°çš„ï¼Œä½¿ç”¨ <code>beanFactory.getBeanNamesForType()</code> æ–¹æ³•</p>
</blockquote>
<h2 data-id="heading-10">é…ç½®ç±»åŠ è½½åŸç† ï¼ˆéå¸¸éå¸¸é‡è¦ï¼‰ConfigurationClassPostProcessor</h2>
<p>è¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„ <code>BeanFactoryPostProcessor</code>ï¼Œ<code>Spring</code> é¡¹ç›®å¯åŠ¨åŠ è½½é…ç½®ç±»å‡ ä¹å…¨éƒ½æ˜¯å®ƒå®ç°çš„ï¼Œé™¤äº†æˆ‘ä»¬è‡ªå·±å£°æ˜çš„ <code>Serviceã€Controller</code>ã€‚ é…ç½®ç±»æœ¬èº«ä¹Ÿæ˜¯ <code>Spring Bean</code>ã€‚</p>
<p>å…¶å®æˆ‘ä»¬æŸ¥çœ‹æºç ä¼šå‘ç° <code>@Serviceã€@Controllerã€@Configuration</code> æœ¬èº«å°±æ˜¯ä¸€ä¸ª <code>@Component</code>ã€‚æŸ¥çœ‹ <code>@Component</code> çš„æ³¨é‡Š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">/**
 * Indicates that the annotated <span class="hljs-keyword">class</span> <span class="hljs-built_in">is</span> a &lt;em&gt;component&lt;/em&gt;.
 *
 * &lt;p&gt;Such classes are considered <span class="hljs-keyword">as</span> candidates <span class="hljs-keyword">for</span> <span class="hljs-keyword">auto</span>-detection
 * <span class="hljs-keyword">when</span> <span class="hljs-keyword">using</span> annotation-based configuration <span class="hljs-built_in">and</span> classpath scanning.
 */
</code></pre>
<p>è¢«è¿™ä¸ªæ³¨è§£æ ‡æ³¨çš„ç±»éƒ½ä¼šè¢«è§†ä¸ºä¸€ä¸ªç»„ä»¶ï¼Œåœ¨è¢«æ‰«æçš„æ—¶å€™ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªé…ç½®ç±»</p>
<h3 data-id="heading-11">ä»£ç è§£è¯»</h3>
<p><code>ConfigurationClassPostProcessor</code> æ˜¯ä¸€ä¸ª <code>BeanDefinitionRegistryPostProcessor</code> ã€‚æˆ‘ä»¬æŸ¥çœ‹æºç æ–¹æ³•çš„è°ƒç”¨è¿‡ç¨‹ <code>postProcessBeanDefinitionRegistry â†’ processConfigBeanDefinitions â†’ ConfigurationClassParser#parse â†’ ConfigurationClassParser#processConfigurationClass â†’ ConfigurationClassParser#doProcessConfigurationClass(arg1,arg2) â†’ doProcessConfigurationClass(arg1,arg2,arg3)</code></p>
<p>å…ˆçœ‹ <code>parse()</code> æ–¹æ³•</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">parse</span><span class="hljs-params">(Set&lt;BeanDefinitionHolder&gt; configCandidates)</span> {
    <span class="hljs-keyword">for</span> (BeanDefinitionHolder holder : configCandidates) {
       <span class="hljs-type">BeanDefinition</span> <span class="hljs-variable">bd</span> <span class="hljs-operator">=</span> holder.getBeanDefinition();
       <span class="hljs-keyword">try</span> {
          <span class="hljs-keyword">if</span> (bd <span class="hljs-keyword">instanceof</span> AnnotatedBeanDefinition annotatedBeanDef) {
             parse(annotatedBeanDef, holder.getBeanName());
          }
          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (bd <span class="hljs-keyword">instanceof</span> AbstractBeanDefinition abstractBeanDef &amp;&amp; abstractBeanDef.hasBeanClass()) {
             parse(abstractBeanDef.getBeanClass(), holder.getBeanName());
          }
          <span class="hljs-keyword">else</span> {
             parse(bd.getBeanClassName(), holder.getBeanName());
          }
       }
       <span class="hljs-keyword">catch</span> (BeanDefinitionStoreException ex) {
          <span class="hljs-keyword">throw</span> ex;
       }
       <span class="hljs-keyword">catch</span> (Throwable ex) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanDefinitionStoreException</span>(
                <span class="hljs-string">"Failed to parse configuration class ["</span> + bd.getBeanClassName() + <span class="hljs-string">"]"</span>, ex);
       }
    }

    <span class="hljs-built_in">this</span>.deferredImportSelectorHandler.process();
}
</code></pre>
<p>æˆ‘ä»¬ä¼ å…¥çš„å…¥å‚å°±æ˜¯ <code>SpringBoot</code> ä¸»ç±»çš„ <code>BeanDefinition</code>ï¼Œè¿™ä¸ªæ–¹æ³•æ ¹æ® <code>BeanDefinition</code> å®é™…çš„ç±»å‹èµ°ä¸åŒçš„é‡è½½æ–¹æ³•ï¼Œ<code>SpringBoot</code> é¡¹ç›®ä¸»ç±»çš„å®šä¹‰ç±»å‹æ˜¯ <code>AnnotatedBeanDefinition</code> ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ <code>doProcessConfigurationClass(arg1,arg2)</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processConfigurationClass</span><span class="hljs-params">(ConfigurationClass configClass, Predicate&lt;String&gt; filter)</span> {
     <span class="hljs-comment">//......</span>
    <span class="hljs-comment">// å¾ªç¯å¤„ç†é…ç½®ç±»ï¼Œè¿”å›çš„ sourceClass æ˜¯çˆ¶ç±»ï¼Œåªè¦ä¸ä¸ºç©ºå°±ä¸€ç›´å‘ä¸Šæ‰¾çˆ¶ç±»å¾ªç¯å¤„ç†</span>
    <span class="hljs-type">SourceClass</span> <span class="hljs-variable">sourceClass</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">try</span> {
       sourceClass = asSourceClass(configClass, filter);
       <span class="hljs-keyword">do</span> {
          sourceClass = doProcessConfigurationClass(configClass, sourceClass, filter);
       }
       <span class="hljs-keyword">while</span> (sourceClass != <span class="hljs-literal">null</span>);
    }
    <span class="hljs-keyword">catch</span> (IOException ex) {
    <span class="hljs-comment">//...</span>
    }

    <span class="hljs-built_in">this</span>.configurationClasses.put(configClass, configClass);
}
</code></pre>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªå¾ªç¯ï¼Œè§£æä¼ å…¥çš„é…ç½®ç±»ï¼Œè¿”å›è¯¥é…ç½®ç±»çš„çˆ¶ç±»ï¼Œå¦‚æœè¯¥é…ç½®ç±»çš„çˆ¶ç±»ä¸ä¸ºç©ºï¼Œå°±ä¸€ç›´è§£æã€‚
æ¥ä¸‹æ¥å†…éƒ¨æœ€ç›´è§‚çš„è§£æé…ç½®ç±»çš„æ–¹æ³• <code>doProcessConfigurationClass(arg1,arg2,arg3)</code> ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> SourceClass <span class="hljs-title function_">doProcessConfigurationClass</span><span class="hljs-params">(ConfigurationClass configClass, SourceClass sourceClass, Predicate&lt;String&gt; filter)</span> {
    <span class="hljs-keyword">if</span> (configClass.getMetadata().isAnnotated(Component.class.getName())) {
       <span class="hljs-comment">// è§£æå†…éƒ¨ç±»ã€‚æ¯”å¦‚ä¸€ä¸ªåŠ äº† @Configuration çš„é…ç½®ç±»ï¼Œæœ‰ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ä¹ŸåŠ äº† @Configuration</span>
       processMemberClasses(configClass, sourceClass, filter);
    }

    <span class="hljs-comment">// è§£æ @PropertySource æ³¨è§£</span>
    <span class="hljs-keyword">for</span> (AnnotationAttributes propertySource : AnnotationConfigUtils.attributesForRepeatable(
          sourceClass.getMetadata(), org.springframework.context.annotation.PropertySource.class,
          PropertySources.class, <span class="hljs-literal">true</span>)) {
       <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.propertySourceRegistry != <span class="hljs-literal">null</span>) {
          <span class="hljs-built_in">this</span>.propertySourceRegistry.processPropertySource(propertySource);
       }
    }

    <span class="hljs-comment">// è§£æ @ComponentScans æ³¨è§£</span>
    Set&lt;AnnotationAttributes&gt; componentScans = AnnotationConfigUtils.attributesForRepeatable(sourceClass.getMetadata(),ComponentScan.class, ComponentScans.class, MergedAnnotation::isDirectlyPresent);

    <span class="hljs-keyword">if</span> (componentScans.isEmpty()) {
       componentScans = AnnotationConfigUtils.attributesForRepeatable(sourceClass.getMetadata(), ComponentScan.class, ComponentScans.class, MergedAnnotation::isMetaPresent);
    }

    <span class="hljs-keyword">if</span> (!componentScans.isEmpty()) {
       List&lt;Condition&gt; registerBeanConditions = collectRegisterBeanConditions(configClass);
       <span class="hljs-keyword">for</span> (AnnotationAttributes componentScan : componentScans) {
          <span class="hljs-comment">// è§£æ @ComponentScan æ³¨è§£(æ³¨æ„è¿™é‡Œç›´æ¥å‘ Spring å®¹å™¨æ³¨å†Œäº† BeanDefiniton)</span>
          <span class="hljs-comment">//å…¶ä»–æ³¨è§£è§£æéƒ½æ˜¯å…ˆå°è£…æˆä¸€ä¸ª ConfigurationClass å¯¹è±¡ï¼Œåç»­ç»Ÿä¸€æ³¨å†Œ BeanDefinition</span>
          Set&lt;BeanDefinitionHolder&gt; scannedBeanDefinitions = <span class="hljs-built_in">this</span>.componentScanParser.parse(componentScan, sourceClass.getMetadata().getClassName());
          <span class="hljs-comment">// æ£€æŸ¥ @ComponentScan æ‰«æåˆ°çš„é…ç½®ç±»æ˜¯å¦è¿˜æœ‰å…¶ä»–é…ç½®æ³¨è§£ï¼Œä¾‹å¦‚ @Importï¼Œé€’å½’è§£æ</span>
          <span class="hljs-keyword">for</span> (BeanDefinitionHolder holder : scannedBeanDefinitions) {
             <span class="hljs-type">BeanDefinition</span> <span class="hljs-variable">bdCand</span> <span class="hljs-operator">=</span> holder.getBeanDefinition().getOriginatingBeanDefinition();
             <span class="hljs-keyword">if</span> (bdCand == <span class="hljs-literal">null</span>) {
                bdCand = holder.getBeanDefinition();
             }
             <span class="hljs-keyword">if</span> (ConfigurationClassUtils.checkConfigurationClassCandidate(bdCand, <span class="hljs-built_in">this</span>.metadataReaderFactory)) {
                parse(bdCand.getBeanClassName(), holder.getBeanName());
             }
          }
       }
    }

    <span class="hljs-comment">// è§£æ @Import æ³¨è§£ï¼ˆSpringBoot è‡ªåŠ¨é…ç½®ç±»çš„æ ¸å¿ƒå®ç°ï¼‰</span>
    processImports(configClass, sourceClass, getImports(sourceClass), filter, <span class="hljs-literal">true</span>);

    <span class="hljs-comment">//è§£æ @ImportResource æ³¨è§£</span>
    <span class="hljs-type">AnnotationAttributes</span> <span class="hljs-variable">importResource</span> <span class="hljs-operator">=</span> AnnotationConfigUtils.attributesFor(sourceClass.getMetadata(), ImportResource.class);
    <span class="hljs-keyword">if</span> (importResource != <span class="hljs-literal">null</span>) {
       String[] resources = importResource.getStringArray(<span class="hljs-string">"locations"</span>);
       Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BeanDefinitionReader</span>&gt; readerClass = importResource.getClass(<span class="hljs-string">"reader"</span>);
       <span class="hljs-keyword">for</span> (String resource : resources) {
          <span class="hljs-type">String</span> <span class="hljs-variable">resolvedResource</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.environment.resolveRequiredPlaceholders(resource);
          configClass.addImportedResource(resolvedResource, readerClass);
       }
    }

    <span class="hljs-comment">// è§£æ @Bean æ³¨è§£</span>
    Set&lt;MethodMetadata&gt; beanMethods = retrieveBeanMethodMetadata(sourceClass);
    <span class="hljs-keyword">for</span> (MethodMetadata methodMetadata : beanMethods) {
       <span class="hljs-keyword">if</span> (methodMetadata.isAnnotated(<span class="hljs-string">"kotlin.jvm.JvmStatic"</span>) &amp;&amp; !methodMetadata.isStatic()) {
          <span class="hljs-keyword">continue</span>;
       }
       configClass.addBeanMethod(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanMethod</span>(methodMetadata, configClass));
    }

    <span class="hljs-comment">// è§£æå½“å‰ç±»å®ç°çš„æ¥å£é‡Œé¢åŠ äº† @Bean çš„ default æ–¹æ³•</span>
    processInterfaces(configClass, sourceClass);

    <span class="hljs-comment">// è§£æçˆ¶ç±»</span>
    <span class="hljs-keyword">if</span> (sourceClass.getMetadata().hasSuperClass()) {
       <span class="hljs-type">String</span> <span class="hljs-variable">superclass</span> <span class="hljs-operator">=</span> sourceClass.getMetadata().getSuperClassName();
       <span class="hljs-keyword">if</span> (superclass != <span class="hljs-literal">null</span> &amp;&amp; !superclass.startsWith(<span class="hljs-string">"java"</span>)) {
          <span class="hljs-type">boolean</span> <span class="hljs-variable">superclassKnown</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.knownSuperclasses.containsKey(superclass);
          <span class="hljs-built_in">this</span>.knownSuperclasses.add(superclass, configClass);
          <span class="hljs-keyword">if</span> (!superclassKnown) {
             <span class="hljs-comment">// Superclass found, return its annotation metadata and recurse</span>
             <span class="hljs-keyword">return</span> sourceClass.getSuperClass();
          }
       }
    }
    <span class="hljs-comment">// No superclass -&gt; processing is complete</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥ç»§ç»­é˜…è¯» <code>processMemberClasses()ã€processImports()</code> ç­‰æ¯ä¸€ä¸ªå…·ä½“è§£ææ³¨è§£çš„æ–¹æ³•ï¼Œä¼šå‘ç°
è¿™ä¸ªè§£ææ–¹æ³•çš„è°ƒç”¨æ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ã€‚å…ˆæ ¹æ®ä¸€ä¸ªä¸»é…ç½®ç±»ï¼Œåœ¨ <code>SpringBoot</code> ä¸­å°±æ˜¯åº”ç”¨å¯åŠ¨ä¸»ç±»ã€‚ç”±äº <code>@SpringBootApplication</code> å†…éƒ¨ç»„åˆäº† <code>@Configuration</code> ï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œ<code>SpringBoot</code> ä¼šä»¥ä¸»ç±»ä¸ºå…¥å£ï¼Œä»å®ƒå¼€å§‹æ‰«æï¼Œç„¶åç”±äº <code>SpringBootApplication</code> å†…éƒ¨ç»„åˆäº† <code>@ComponentScan</code> æ³¨è§£ï¼Œæ‰€ä»¥ä¼šè§£æä¸»ç±»æ‰€åœ¨çš„åŒ…ä¸‹çš„æ‰€æœ‰é…ç½®ç±»ã€‚ç„¶åç”±äºå®ƒå†…éƒ¨åˆç»„åˆäº† <code>SpringBootApplication â†’ @EnableAutoConfiguration â†’ @Import(AutoConfigurationImportSelector.class)</code>ï¼Œæ‰€ä»¥ä¼šè§£æ <code>AutoConfigurationImportSelector</code> è·å–çš„æ‰€æœ‰é…ç½®ç±»ã€‚è¿™ä¹Ÿæ˜¯ <code>SpringBoot</code> è‡ªåŠ¨é…ç½®çš„æ ¸å¿ƒå®ç°åŸç†</p>
<h3 data-id="heading-12">SpringBoot è‡ªåŠ¨é…ç½®çš„æ ¸å¿ƒåŸç†</h3>
<p>åœ¨ <code>SpringBoot</code> æ–‡ç« ä¸­æˆ‘ä»¬è¯´è¿‡ï¼Œè¿™ä¸ª <code>AutoConfigurationImportSelector</code> æ˜¯ <code>SpringBoot</code> è‡ªåŠ¨é…ç½®çš„æ ¸å¿ƒã€‚ä»ä¸Šé¢çš„è§£ææ–¹æ³• <code>doProcessConfigurationClass(arg1,arg2,arg3)</code> æˆ‘ä»¬çŸ¥é“å®ƒä¼šè§£æ <code>@Import</code> æ³¨è§£ï¼Œç„¶åæˆ‘ä»¬çœ‹  <code>processImports()</code> çš„æºç </p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">for</span> (SourceClass candidate : importCandidates) {
    <span class="hljs-keyword">if</span> (candidate.isAssignable(ImportSelector.class)) {
       <span class="hljs-comment">// å¤„ç† ImportSelector çš„é€»è¾‘</span>
       Class&lt;?&gt; candidateClass = candidate.loadClass();
       <span class="hljs-type">ImportSelector</span> <span class="hljs-variable">selector</span> <span class="hljs-operator">=</span> ParserStrategyUtils.instantiateClass(candidateClass, ImportSelector.class,<span class="hljs-built_in">this</span>.environment, <span class="hljs-built_in">this</span>.resourceLoader, <span class="hljs-built_in">this</span>.registry);
       Predicate&lt;String&gt; selectorFilter = selector.getExclusionFilter();
       <span class="hljs-keyword">if</span> (selectorFilter != <span class="hljs-literal">null</span>) {
          filter = filter.or(selectorFilter);
       }
       <span class="hljs-keyword">if</span> (selector <span class="hljs-keyword">instanceof</span> DeferredImportSelector deferredImportSelector) {
          <span class="hljs-built_in">this</span>.deferredImportSelectorHandler.handle(configClass, deferredImportSelector);
       }
       <span class="hljs-keyword">else</span> {
          String[] importClassNames = selector.selectImports(currentSourceClass.getMetadata());
          Collection&lt;SourceClass&gt; importSourceClasses = asSourceClasses(importClassNames, filter);
          processImports(configClass, currentSourceClass, importSourceClasses, filter, <span class="hljs-literal">false</span>);
       }
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (candidate.isAssignable(ImportBeanDefinitionRegistrar.class)) {
       <span class="hljs-comment">// å¤„ç† ImportBeanDefinitionRegistrar çš„é€»è¾‘</span>
       Class&lt;?&gt; candidateClass = candidate.loadClass();
       <span class="hljs-type">ImportBeanDefinitionRegistrar</span> <span class="hljs-variable">registrar</span> <span class="hljs-operator">=</span>
             ParserStrategyUtils.instantiateClass(candidateClass, ImportBeanDefinitionRegistrar.class,
                   <span class="hljs-built_in">this</span>.environment, <span class="hljs-built_in">this</span>.resourceLoader, <span class="hljs-built_in">this</span>.registry);
       configClass.addImportBeanDefinitionRegistrar(registrar, currentSourceClass.getMetadata());
    }
    <span class="hljs-keyword">else</span> {
       <span class="hljs-comment">// å¤„ç†æ™®é€šé…ç½®ç±»çš„é€»è¾‘</span>
       <span class="hljs-built_in">this</span>.importStack.registerImport(
             currentSourceClass.getMetadata(), candidate.getMetadata().getClassName());
       processConfigurationClass(candidate.asConfigClass(configClass), filter);
    }
}

</code></pre>
<p>è¿™é‡Œå¯¹äº <code>@Import</code> æœ‰ä¸‰ç§å¤„ç†é€»è¾‘ï¼Œç›¸å½“äºä¸€ä¸ªç­–ç•¥æ¨¡å¼çš„ä½“ç°</p>
<ul>
<li><code>@Import(XxxImportSelector.class)</code> æ‰§è¡Œ <code>selectImports</code> è·å–å¯¼å…¥çš„é…ç½®ç±»</li>
<li><code>@Import(XxxImportBeanDefinitionRegistrar.class)</code> æ‰§è¡Œ <code>registerBeanDefinitions</code> æ³¨å†Œ <code>BeanDefinition</code></li>
<li><code>@Import(XxxConfiguration.class)</code> æ™®é€šé…ç½®ç±»ï¼Œç›´æ¥è§£æ</li>
</ul>
<p>å¯¹äº <code>@Import</code> æ³¨è§£ä¸­çš„ä¸åŒç±»å‹å€¼ï¼Œä¼šè¿›è¡Œä¸åŒçš„å¤„ç†é€»è¾‘ï¼Œä½†æœ€ç»ˆéƒ½æ˜¯è§£æé…ç½®ç±»ï¼Œæ— éæ˜¯å¯¼å…¥çš„æ–¹å¼ä¸åŒï¼Œå…·ä½“æˆ‘ä»¬å¯ä»¥çœ‹å¯¹åº”æ¥å£çš„æ–¹æ³•è¯´æ˜ã€‚</p>
<blockquote>
<p>æ³¨æ„å¯¹äº <code>ImportSelector</code> æœ‰ä¸¤ç§å¤„ç†æ–¹å¼ï¼Œå®ƒæœ‰ä¸€ä¸ªå­æ¥å£ <code>DeferredImportSelector</code>ï¼Œå»¶è¿Ÿå¯¼å…¥å™¨ï¼Œå¦‚æœå¯¼å…¥çš„æ˜¯æ­¤ç±»å‹ï¼Œé‚£ä¹ˆä¼šæ‰§è¡Œå…¶å†…éƒ¨ç±» <code>DeferredImportSelector.Group#process</code></p>
</blockquote>
<p>æˆ‘ä»¬æŸ¥çœ‹ <code>AutoConfigurationImportSelector.AutoConfigurationGroup#process()</code> æ–¹æ³•çš„æºç ï¼Œçœ‹å®ƒæ˜¯æ€ä¹ˆè·å–åˆ°è‡ªåŠ¨é…ç½®ç±»çš„</p>
<blockquote>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªç‚¹è¦æ³¨æ„ï¼Œå¯¹äº <code>SpringBoot</code> çš„ <code>AutoConfigurationImportSelector</code> æ˜¯ä¸€ä¸ªå»¶è¿Ÿå¯¼å…¥å™¨ï¼Œè·å–å¯¼å…¥çš„é…ç½®ç±»åˆ—è¡¨ä¸æ˜¯ç›´æ¥è°ƒç”¨ <code>AutoConfigurationImportSelector.selectImports()</code> è€Œæ˜¯è°ƒç”¨å†…éƒ¨ç±» <code>AutoConfigurationGroup.process()</code> å’Œ <code>AutoConfigurationGroup.selectImports()</code></p>
</blockquote>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> AutoConfigurationEntry <span class="hljs-title function_">getAutoConfigurationEntry</span><span class="hljs-params">(AnnotationMetadata annotationMetadata)</span> {
    <span class="hljs-keyword">if</span> (!isEnabled(annotationMetadata)) {
       <span class="hljs-keyword">return</span> EMPTY_ENTRY;
    }
    <span class="hljs-type">AnnotationAttributes</span> <span class="hljs-variable">attributes</span> <span class="hljs-operator">=</span> getAttributes(annotationMetadata);
    <span class="hljs-comment">//æ‰«æ imports æ–‡ä»¶è·å–è‡ªåŠ¨é…ç½®ç±»åˆ—è¡¨</span>
    List&lt;String&gt; configurations = getCandidateConfigurations(annotationMetadata, attributes);
    configurations = removeDuplicates(configurations);
    Set&lt;String&gt; exclusions = getExclusions(annotationMetadata, attributes);
    checkExcludedClasses(configurations, exclusions);
    configurations.removeAll(exclusions);
    configurations = getConfigurationClassFilter().filter(configurations);
    fireAutoConfigurationImportEvents(configurations, exclusions);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AutoConfigurationEntry</span>(configurations, exclusions);
}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> List&lt;String&gt; <span class="hljs-title function_">getCandidateConfigurations</span><span class="hljs-params">(AnnotationMetadata metadata, AnnotationAttributes attributes)</span> {
    <span class="hljs-type">ImportCandidates</span> <span class="hljs-variable">importCandidates</span> <span class="hljs-operator">=</span> ImportCandidates.load(<span class="hljs-built_in">this</span>.autoConfigurationAnnotation,getBeanClassLoader());
    List&lt;String&gt; configurations = importCandidates.getCandidates();
    <span class="hljs-keyword">return</span> configurations;
}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ImportCandidates <span class="hljs-title function_">load</span><span class="hljs-params">(Class&lt;?&gt; annotation, ClassLoader classLoader)</span> {
    Assert.notNull(annotation, <span class="hljs-string">"'annotation' must not be null"</span>);
    <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">classLoaderToUse</span> <span class="hljs-operator">=</span> decideClassloader(classLoader);
    <span class="hljs-type">String</span> <span class="hljs-variable">location</span> <span class="hljs-operator">=</span> String.format(LOCATION, annotation.getName());
    Enumeration&lt;URL&gt; urls = findUrlsInClasspath(classLoaderToUse, location);
    List&lt;String&gt; importCandidates = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    <span class="hljs-keyword">while</span> (urls.hasMoreElements()) {
       <span class="hljs-type">URL</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> urls.nextElement();
       importCandidates.addAll(readCandidateConfigurations(url));
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImportCandidates</span>(importCandidates);
}
</code></pre>
<p>å¥½äº†ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ª <code>LOCATION</code> å¸¸é‡ï¼Œæˆ‘ä»¬çœ‹ä»–çš„å€¼æ˜¯å†™æ­»çš„</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">private</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> LOCATION = <span class="hljs-string">"META-INF/spring/%s.imports"</span>;
</code></pre>
<p>è¿™é‡Œä¼ å…¥çš„æ³¨è§£å°±æ˜¯ <code>@AutoConfiguration</code> çš„å…¨ç±»åï¼Œ<code>org.springframework.boot.autoconfigure.AutoConfiguration</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">AutoConfigurationImportSelector</span><span class="hljs-params">()</span> {
    <span class="hljs-built_in">this</span>(<span class="hljs-literal">null</span>);
}

AutoConfigurationImportSelector(Class&lt;?&gt; autoConfigurationAnnotation) {
    <span class="hljs-built_in">this</span>.autoConfigurationAnnotation = (autoConfigurationAnnotation != <span class="hljs-literal">null</span>) ? autoConfigurationAnnotation : AutoConfiguration.class;
}
</code></pre>
<p>æ›¿æ¢æ‰ <code>LOCATION</code> çš„å ä½ç¬¦ä¹‹åï¼Œæˆ‘ä»¬å¾—åˆ°å®Œæ•´çš„è·¯å¾„åœ°å€</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">LOCATION</span> = META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports
</code></pre>
<p>ç„¶åæˆ‘ä»¬å†å»çœ‹ <code>MyBatisPlusã€Redisã€RabbitMQ</code> çš„ <code>starter</code>ï¼Œæˆ‘ä»¬éƒ½ä¼šçœ‹åˆ°è¿™ä¸ªè·¯å¾„ä¸‹æœ‰è¿™æ ·çš„æ–‡ä»¶</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/743446472e194f77a2b07685fdd92278~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pqu6Imy5aaW5aiG5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771136492&amp;x-signature=i%2FFo8ac4Z2jWPqbxtx6n97AHm0k%3D" alt="ä¼ä¸šå¾®ä¿¡æˆªå›¾_f001c7fb-e86a-46f5-8db5-500d33a15b4d.png" loading="lazy"/></p>
<p>è¿™ä¸‹æç„¶å¤§æ‚Ÿäº†å§ï¼Œé‚£ç°åœ¨è®©ä½ è‡ªå·±å®šä¹‰ä¸€ä¸ª <code>springboot-starter</code>ï¼Œè¿˜è§‰å¾—å›°éš¾å—ï¼Ÿ</p>
<blockquote>
<p>æ³¨æ„ SpringBoot 3.0 ä»¥å‰è¯»å–çš„æ˜¯ <code>spring.factories</code> ï¼Œä¹‹åæ”¹æˆäº† <code>imports</code> æ–‡ä»¶</p>
</blockquote>
<h3 data-id="heading-13">é…ç½®ç±»åŠ è½½è¿‡ç¨‹æµç¨‹å›¾</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af334198f2224545bbb4bd88a440f229~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pqu6Imy5aaW5aiG5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771136492&amp;x-signature=hAKvfLugez6cJuIsQkPgh7s9spw%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-14">é…ç½®ç±»é€’å½’è§£ææµç¨‹å›¾</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dcb0df7b91fd43148db39daca9f50afa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pqu6Imy5aaW5aiG5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771136492&amp;x-signature=tsaF%2Bl2%2FufFSkkmXY8fqX4lVprE%3D" alt="ä¼ä¸šå¾®ä¿¡æˆªå›¾_41c7f5f9-d4c4-4bc1-83c1-76eaac5eb168.png" loading="lazy"/></p>
<p>ä¸‹é¢çš„æ ‘å½¢ç»“æ„å¯èƒ½æœ‰åŠ©äºè¿›ä¸€æ­¥ç†è§£è¿™ä¸ªæµç¨‹</p>
<pre><code class="hljs language-ruby" lang="ruby">/**
 * <span class="hljs-title class_">Spring</span> é…ç½®ç±»æ‰«æè§£æçš„é€’å½’æµç¨‹
 * 
 * ç¤ºä¾‹é…ç½®ç»“æ„ï¼š
 * â””â”€â”€ <span class="hljs-title class_">SpringBootApplication</span> (<span class="hljs-variable">@Configuration</span>)  [<span class="hljs-title class_">Level</span> <span class="hljs-number">0</span>]
  *    â”œâ”€â”€ <span class="hljs-variable">@ComponentScan</span>(<span class="hljs-string">"com.example"</span>)  [<span class="hljs-title class_">Level</span> <span class="hljs-number">1</span>]
 *     â”‚   â””â”€â”€ com.example.<span class="hljs-title class_">UserController</span> (<span class="hljs-variable">@Controller</span>)  [<span class="hljs-title class_">Level</span> <span class="hljs-number">2</span>]
 *     â”‚       â””â”€â”€ <span class="hljs-variable">@Configuration</span> [<span class="hljs-title class_">Level</span> <span class="hljs-number">3</span>]
 *     â””â”€â”€ <span class="hljs-variable">@Bean</span>(appBean)  [<span class="hljs-title class_">Level</span> <span class="hljs-number">1</span>]
 *     â”œâ”€â”€ <span class="hljs-variable">@Import</span>(<span class="hljs-title class_">AutoConfigurationImportSelector</span>.<span class="hljs-keyword">class</span>)  [<span class="hljs-title class_">Level</span> <span class="hljs-number">1</span>]
 *     â”‚   â”œâ”€â”€ <span class="hljs-variable">@Configuration</span>
 *     â”‚   â”œâ”€â”€ <span class="hljs-variable">@Import</span>(<span class="hljs-title class_">DataSourceConfig</span>.<span class="hljs-keyword">class</span>)  [<span class="hljs-title class_">Level</span> <span class="hljs-number">2</span>]
 *     â”‚   â”‚   â”œâ”€â”€ <span class="hljs-variable">@Configuration</span>
 *     â”‚   â”‚   â”œâ”€â”€ <span class="hljs-variable">@Import</span>(<span class="hljs-title class_">RedisConfig</span>.<span class="hljs-keyword">class</span>)  [<span class="hljs-title class_">Level</span> <span class="hljs-number">3</span>]
 *     â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="hljs-variable">@Configuration</span>
 *     â”‚   â”‚   â”‚   â””â”€â”€ <span class="hljs-variable">@Import</span>(<span class="hljs-title class_">CacheConfig</span>.<span class="hljs-keyword">class</span>)  [<span class="hljs-title class_">Level</span> <span class="hljs-number">4</span>]
 *     â”‚   â”‚   â”‚       â”œâ”€â”€ <span class="hljs-variable">@Configuration</span>
 *     â”‚   â”‚   â”‚       â””â”€â”€ <span class="hljs-variable">@ComponentScan</span>(<span class="hljs-string">"com.cache"</span>)
 *     â”‚   â”‚   â””â”€â”€ <span class="hljs-variable">@Bean</span>(dataSource)
 *     â”‚   â””â”€â”€ <span class="hljs-variable">@Bean</span>(service)
 *<span class="hljs-regexp">/
</span></code></pre>
<p>åªè¦å½“å‰æ­£åœ¨æ‰«æå¤„ç†çš„é…ç½®ç±»é‡Œé¢è¿˜æœ‰å…¶ä»–é…ç½®æ³¨è§£ï¼Œå°±ä¸€ç›´é€’å½’æ‰«æè§£æï¼Œç›´åˆ°è§£æå®Œæ¯•ä¸ºæ­¢ã€‚</p>
<h3 data-id="heading-15">ç‰¹æ®Šçš„ @ComponentScan</h3>
<p>ä»”ç»†è§‚å¯Ÿæºç ä¼šå‘ç° <code>@ComponentScan</code> æ³¨è§£çš„æ‰«æè¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨ <code>ComponentScanAnnotationParser</code> è§£æä¹‹åç›´æ¥å‘ <code>Spring</code> å®¹å™¨æ³¨å†Œäº† <code>BeanDefinition</code> ã€‚è€Œå…¶ä»–æ³¨è§£çš„æ‰«æï¼Œä¾‹å¦‚ <code>@Configurationã€@Beanã€@Import</code> éƒ½æ˜¯å°†éœ€è¦å¤„ç†çš„é…ç½®ç±»ä¿¡æ¯å­˜å‚¨åˆ° <code>ConfigurationClassParser</code> çš„æˆå‘˜å˜é‡ä¸­ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//@ComponentScan è§£æå™¨</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ComponentScanAnnotationParser componentScanParser;
<span class="hljs-comment">//é…ç½®ç±»é›†åˆ</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;ConfigurationClass, ConfigurationClass&gt; configurationClasses = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;&gt;();

<span class="hljs-comment">//å»¶è¿Ÿå¯¼å…¥å™¨å¤„ç†å™¨</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">DeferredImportSelectorHandler</span> <span class="hljs-variable">deferredImportSelectorHandler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeferredImportSelectorHandler</span>();
</code></pre>
<p>æ­¤æ—¶è¿˜æ²¡æœ‰æ³¨å†Œå®ƒä»¬çš„ <code>BeanDefinition</code></p>
<h3 data-id="heading-16">åˆ†ç±»æ„å»º BeanDefinition</h3>
<p>ä¸Šä¸€æ®µæˆ‘ä»¬è¯´äº†ï¼Œå‰é¢çš„æ­¥éª¤è§£æå®Œä¹‹åï¼Œåªæ˜¯æŠŠæ¯ä¸€ä¸ªé…ç½®ç±»ä¿¡æ¯å­˜å‚¨èµ·æ¥ï¼ŒæŠ½è±¡æˆä¸€ä¸ª <code>Map&lt;ConfigurationClass, ConfigurationClass&gt; configurationClasses</code>ï¼Œæ­¤æ—¶è¿˜æ²¡æœ‰å‘ <code>Spring</code> å®¹å™¨ä¸­æ³¨å†Œæˆ <code>BeanDefiniton</code>ã€‚æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹æºç ï¼Œè¿™ä¸ªç±»é‡Œé¢æœ‰ä¸€äº›æˆå‘˜å˜é‡</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigurationClass</span> {
    <span class="hljs-comment">//bean åç§°</span>
    <span class="hljs-keyword">private</span> String beanName;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Set&lt;ConfigurationClass&gt; importedBy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashSet</span>&lt;&gt;(<span class="hljs-number">1</span>);

    <span class="hljs-comment">//@Bean æ–¹æ³•é›†åˆ</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Set&lt;BeanMethod&gt; beanMethods = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashSet</span>&lt;&gt;();
    <span class="hljs-comment">//@ImportResource é›†åˆ</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BeanDefinitionReader</span>&gt;&gt; importedResources = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;&gt;();
    <span class="hljs-comment">//ImportBeanDefinitionRegistrar é›†åˆ</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;ImportBeanDefinitionRegistrar, AnnotationMetadata&gt; importBeanDefinitionRegistrars =  <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;&gt;();
}
</code></pre>
<p>å½“æ‰€æœ‰é…ç½®ç±»è§£æå®Œæˆä¹‹åï¼Œå¾—åˆ°ä¸€ä¸ªå…¨é‡é›†åˆ <code>Map&lt;ConfigurationClass, ConfigurationClass&gt;</code> ï¼Œç„¶ååœ¨
<code>ConfigurationClassPostProcessor#processConfigBeanDefinitions()</code> ä¸­è°ƒç”¨ <code>ConfigurationClassBeanDefinitionReader.loadBeanDefinitions()</code> è¿™ä¸€æ­¥æ‰§è¡Œå®Œæ¯•åï¼Œæ•´ä¸ªåº”ç”¨æ‰€æœ‰çš„é…ç½®éƒ½æ„å»º <code>BeanDefinition</code> åŠ è½½å®Œæ¯•</p>
<h2 data-id="heading-17">EventListenerMethodProcessor</h2>
<p>å®ƒæ˜¯ä¸€ä¸ªè§£æäº‹ä»¶ç›‘å¬çš„åç½®å¤„ç†å™¨</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessBeanFactory</span><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span> {
    <span class="hljs-built_in">this</span>.beanFactory = beanFactory;
    <span class="hljs-built_in">this</span>.originalEvaluationContext.setBeanResolver(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanFactoryResolver</span>(<span class="hljs-built_in">this</span>.beanFactory));

    Map&lt;String, EventListenerFactory&gt; beans = beanFactory.getBeansOfType(EventListenerFactory.class, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);
    List&lt;EventListenerFactory&gt; factories = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(beans.values());
    AnnotationAwareOrderComparator.sort(factories);
    <span class="hljs-built_in">this</span>.eventListenerFactories = factories;
}
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªåç½®å¤„ç†æ–¹æ³•ä¸­ï¼Œä¸»è¦æ˜¯å¯¹ <code>eventListenerFactories</code> èµ‹å€¼ï¼Œç„¶ååç»­ç­‰æ‰€æœ‰å•ä¾‹ <code>Bean</code> å®ä¾‹åŒ–å®Œæˆåï¼Œä¼šè°ƒç”¨å®ƒçš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³• <code>EventListenerMethodProcessor#afterSingletonsInstantiated()</code>ï¼Œä¼šç”¨è¿™ä¸ªå·¥å‚åˆ›å»ºäº‹ä»¶ç›‘å¬å™¨ï¼Œæ·»åŠ åˆ° <code>ApplicationContext</code> ä¸­ï¼Œ<code>Spring äº‹ä»¶æœºåˆ¶</code> å°±æ˜¯æŠŠæ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨æ·»åŠ åˆ° <code>ApplicationContext</code> çš„ <code>applicationListeners</code> å­—æ®µä¸­ï¼Œè°ƒç”¨ <code>ApplicationEventPublisher#publishEvent(ApplicationEvent)</code> çš„æ—¶å€™ä»è¿™é‡Œæ‰¾åˆ°ç¬¦åˆçš„ç›‘å¬å™¨æ‰¹é‡æ‰§è¡Œï¼Œç›¸å½“äºå¹¿æ’­ä¸€ä¸ªæ¶ˆæ¯ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//org.springframework.context.event.SimpleApplicationEventMulticaster#multicastEvent(org.springframework.context.ApplicationEvent, org.springframework.core.ResolvableType)</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">multicastEvent</span><span class="hljs-params">(ApplicationEvent event, <span class="hljs-meta">@Nullable</span> ResolvableType eventType)</span> {
    <span class="hljs-type">ResolvableType</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> (eventType != <span class="hljs-literal">null</span> ? eventType : ResolvableType.forInstance(event));
    <span class="hljs-type">Executor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> getTaskExecutor();
    <span class="hljs-keyword">for</span> (ApplicationListener&lt;?&gt; listener : getApplicationListeners(event, type)) {
       <span class="hljs-keyword">if</span> (executor != <span class="hljs-literal">null</span> &amp;&amp; listener.supportsAsyncExecution()) {
          <span class="hljs-keyword">try</span> {
          <span class="hljs-comment">//å¼‚æ­¥äº‹ä»¶</span>
             executor.execute(() -&gt; invokeListener(listener, event));
          }
          <span class="hljs-keyword">catch</span> (RejectedExecutionException ex) {
             <span class="hljs-comment">// Probably on shutdown -&gt; invoke listener locally instead</span>
             invokeListener(listener, event);
          }
       }
       <span class="hljs-keyword">else</span> {
          invokeListener(listener, event);
       }
    }
}
</code></pre>
<h2 data-id="heading-18">MapperScannerConfigurer</h2>
<p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨ <code>Mybatis</code> æ¡†æ¶çš„è¯ï¼Œå°±ä¼šæœ‰è¿™ä¸ªå·¥å‚åç½®å¤„ç†å™¨</p>
<h3 data-id="heading-19">æ³¨å†Œæ¥æº</h3>
<p>ä¸Šé¢æˆ‘ä»¬çŸ¥é“ <code>SpringBoot</code> å¯åŠ¨åä¼šå…ˆæ‰§è¡Œ <code>ConfigurationClassPostProcessor</code> åŠ è½½è‡ªåŠ¨é…ç½®ç±»ï¼Œäºæ˜¯åŠ è½½åˆ°äº† <code>MybatisPlusAutoConfiguration</code>ï¼Œå®ƒæœ‰ä¸€ä¸ªé™æ€å†…éƒ¨ç±»</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@org</span>.springframework.context.annotation.Configuration(proxyBeanMethods = <span class="hljs-literal">false</span>)
<span class="hljs-meta">@Import(AutoConfiguredMapperScannerRegistrar.class)</span>
<span class="hljs-meta">@ConditionalOnMissingBean({MapperFactoryBean.class, MapperScannerConfigurer.class})</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MapperScannerRegistrarNotFoundConfiguration</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InitializingBean</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterPropertiesSet</span><span class="hljs-params">()</span> {
        logger.debug(<span class="hljs-string">"Not found configuration for registering mapper bean using @MapperScan, MapperFactoryBean and MapperScannerConfigurer."</span>);
    }
}
</code></pre>
<p>è¿™é‡Œ <code>@Import</code> å¯¼å…¥äº† <code>AutoConfiguredMapperScannerRegistrar</code> ç±»ï¼Œå†æŸ¥çœ‹<code>AutoConfiguredMapperScannerRegistrar#registerBeanDefinitions</code> æ³¨å†Œæ–¹æ³•ä¸­æ³¨å†Œäº† <code>MapperScannerConfigurer</code> çš„ <code>BeanDefiniton</code> ã€‚</p>
<h3 data-id="heading-20">ä½œç”¨</h3>
<p>æˆ‘ä»¬æŸ¥çœ‹ <code>MapperScannerConfigurer#postProcessBeanDefinitionRegistry</code>ï¼Œæºç å¾ˆç®€å•</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessBeanDefinitionRegistry</span><span class="hljs-params">(BeanDefinitionRegistry registry)</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.processPropertyPlaceHolders) {
   <span class="hljs-comment">//è§£æå±æ€§å€¼ä¸­çš„å ä½ç¬¦</span>
    processPropertyPlaceHolders();
  }
  
  <span class="hljs-comment">//å®ä¾‹åŒ– `ClassPathBeanDefinitionScanner` çš„å®ç°ç±»æ‰«æç±»è·¯å¾„ä¸‹çš„ @Mapper æ³¨è§£</span>
  <span class="hljs-type">ClassPathMapperScanner</span> <span class="hljs-variable">scanner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathMapperScanner</span>(registry);
  scanner.setAddToConfig(<span class="hljs-built_in">this</span>.addToConfig);
  scanner.setAnnotationClass(<span class="hljs-built_in">this</span>.annotationClass);
  scanner.setMarkerInterface(<span class="hljs-built_in">this</span>.markerInterface);
  scanner.setSqlSessionFactory(<span class="hljs-built_in">this</span>.sqlSessionFactory);
  scanner.setSqlSessionTemplate(<span class="hljs-built_in">this</span>.sqlSessionTemplate);
  scanner.setSqlSessionFactoryBeanName(<span class="hljs-built_in">this</span>.sqlSessionFactoryBeanName);
  scanner.setSqlSessionTemplateBeanName(<span class="hljs-built_in">this</span>.sqlSessionTemplateBeanName);
  scanner.setResourceLoader(<span class="hljs-built_in">this</span>.applicationContext);
  scanner.setBeanNameGenerator(<span class="hljs-built_in">this</span>.nameGenerator);
  scanner.setMapperFactoryBeanClass(<span class="hljs-built_in">this</span>.mapperFactoryBeanClass);
  <span class="hljs-keyword">if</span> (StringUtils.hasText(lazyInitialization)) {
    scanner.setLazyInitialization(Boolean.valueOf(lazyInitialization));
  }
  <span class="hljs-keyword">if</span> (StringUtils.hasText(defaultScope)) {
    scanner.setDefaultScope(defaultScope);
  }
  scanner.registerFilters();
  scanner.scan(
      StringUtils.tokenizeToStringArray(<span class="hljs-built_in">this</span>.basePackage, ConfigurableApplicationContext.CONFIG_LOCATION_DELIMITERS));
}
</code></pre>
<p>å°±æ˜¯æŠŠç±»è·¯å¾„ä¸‹çš„ <code>@Mapper</code> æ³¨è§£çš„ç±»æ‰«æå‡ºæ¥æ³¨å†Œä¸º <code>BeanDefiniton</code> ã€‚</p>
<h3 data-id="heading-21">è‡ªæˆ‘æ‰©å±•</h3>
<p>å‚è€ƒ <code>MapperScannerConfigurer</code> å‡è®¾æˆ‘ä»¬åç»­éœ€è¦è‡ªå·±åˆ¶ä½œä¸€ä¸ªç»„ä»¶ï¼Œè¯»å– <code>@Xxx</code> æ ‡æ³¨çš„ç±»æ³¨å†Œä¸º <code>BeanDefiniton</code> äº¤ç»™ <code>Spring</code> ï¼Œæ˜¯ä¸æ˜¯å°±å¾ˆç®€å•äº†~</p>
<h2 data-id="heading-22">CachingMetadataReaderFactoryPostProcessor</h2>
<p>è¿™ä¸ªç±»æ˜¯ <code>SpringBoot</code> æä¾›çš„ä¸€ä¸ªé‡è¦çš„ç¼“å­˜å…ƒä¿¡æ¯çš„å·¥å‚åç½®å¤„ç†å™¨ï¼Œå®ƒæ˜¯é€šè¿‡ <code>ApplicationContextInitializer</code> æ·»åŠ åˆ° <code>ApplicationContext</code> ä¸­çš„</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SharedMetadataReaderFactoryContextInitializer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ApplicationContextInitializer</span>&lt;ConfigurableApplicationContext&gt;, Ordered, BeanRegistrationExcludeFilter {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">BEAN_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"org.springframework.boot.autoconfigure.internalCachingMetadataReaderFactory"</span>;
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initialize</span><span class="hljs-params">(ConfigurableApplicationContext applicationContext)</span> {
       <span class="hljs-keyword">if</span> (AotDetector.useGeneratedArtifacts()) {
          <span class="hljs-keyword">return</span>;
       }
       <span class="hljs-type">BeanFactoryPostProcessor</span> <span class="hljs-variable">postProcessor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CachingMetadataReaderFactoryPostProcessor</span>(applicationContext);
       applicationContext.addBeanFactoryPostProcessor(postProcessor);
    }
}
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ <code>CachingMetadataReaderFactoryPostProcessor#postProcessBeanDefinitionRegistry</code> åç½®å¤„ç†æ–¹æ³•æºç ï¼Œ</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessBeanDefinitionRegistry</span><span class="hljs-params">(BeanDefinitionRegistry registry)</span> <span class="hljs-keyword">throws</span> BeansException {
    register(registry);
    configureConfigurationClassPostProcessor(registry);
}
</code></pre>
<p>å…ˆæ³¨å†Œäº†ä¸€ä¸ª <code>SharedMetadataReaderFactoryBean</code> çš„ <code>BeanDefiniton</code> ï¼Œå®é™…ä¸Šæœ€åå°±æ˜¯å‘å®¹å™¨ä¸­æ³¨å…¥ <code>ConcurrentReferenceCachingMetadataReaderFactory</code>ï¼Œç„¶åç¬¬äºŒè¡Œä»£ç å¾ˆå…³é”®ï¼Œç»™ <code>ConfigurationClassPostProcessor</code> è¿™ä¸ªå·¥å‚åç½®å¤„ç†å™¨çš„å±æ€§ <code>metadataReaderFactory</code> èµ‹å€¼ä¸ºåˆšåˆšåˆ›å»ºçš„ <code>ConcurrentReferenceCachingMetadataReaderFactory</code></p>
<p>æˆ‘ä»¬å†å»çœ‹åŸç”Ÿçš„ <code>ConfigurationClassPostProcessor.metadataReaderFactory</code> é»˜è®¤å€¼</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-type">MetadataReaderFactory</span> <span class="hljs-variable">metadataReaderFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CachingMetadataReaderFactory</span>();
</code></pre>
<p>åœ¨åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯ä¸æ˜¯é…ç½®ç±»çš„æ—¶å€™ä¼šç”¨åˆ°å®ƒï¼Œé»˜è®¤çš„å®ç°æ˜¯æ¯æ¬¡éƒ½ä¼šç”¨èµ„æºåŠ è½½å™¨è¯»å–ä¸€éè¿™ä¸ªç±»ï¼Œ</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> MetadataReader <span class="hljs-title function_">getMetadataReader</span><span class="hljs-params">(String className)</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-keyword">try</span> {
       <span class="hljs-type">String</span> <span class="hljs-variable">resourcePath</span> <span class="hljs-operator">=</span> ResourceLoader.CLASSPATH_URL_PREFIX + ClassUtils.convertClassNameToResourcePath(className) + ClassUtils.CLASS_FILE_SUFFIX;
       <span class="hljs-comment">//é‡æ–°è¯»å–æ–‡ä»¶</span>
       <span class="hljs-type">Resource</span> <span class="hljs-variable">resource</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.resourceLoader.getResource(resourcePath);
       <span class="hljs-keyword">return</span> getMetadataReader(resource);
    }
}
</code></pre>
<p>è€Œ <code>ConcurrentReferenceCachingMetadataReaderFactory</code> çš„å®ç°æ˜¯ï¼Œç¬¬ä¸€æ¬¡è¯»å–ä¹‹åæ”¾å…¥ç¼“å­˜ï¼Œåç»­æ¯æ¬¡è·å–ä¼šå…ˆä»ç¼“å­˜ä¸­æŸ¥è¯¢</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> MetadataReader <span class="hljs-title function_">getMetadataReader</span><span class="hljs-params">(String className)</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-comment">//è¯»å–ç¼“å­˜</span>
    <span class="hljs-type">MetadataReader</span> <span class="hljs-variable">metadataReader</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.classNameCache.get(className);
    <span class="hljs-keyword">if</span> (metadataReader == <span class="hljs-literal">null</span>) {
       metadataReader = <span class="hljs-built_in">super</span>.getMetadataReader(className);
       <span class="hljs-built_in">this</span>.classNameCache.put(className, metadataReader);
    }
    <span class="hljs-keyword">return</span> metadataReader;
}
</code></pre>
<p>å®ƒçš„ä½œç”¨å°±æ˜¯æé«˜ç¨‹åºæ€§èƒ½ï¼Œé¿å…é‡å¤è¯»å–ç±»çš„å…ƒæ•°æ®ä¿¡æ¯</p>
<h2 data-id="heading-23">BeanFactoryPostProcessor ä¸ BeanPostProcessor å¯¹æ¯”</h2>
<p>è¿™ä¸¤ä¸ªåå­—å¾ˆåƒï¼Œè¿™é‡Œåˆ—å‡ºå®ƒä»¬çš„åŒºåˆ«ï¼Œä¸‹ä¸€ç¯‡æ–‡ç« ä¼šè¯¦ç»†ä»‹ç» <code>BeanPostProcessor</code></p>


















































<table><thead><tr><th align="left">å¯¹æ¯”ç»´åº¦</th><th align="left">BeanFactoryPostProcessor</th><th align="left">BeanPostProcessor</th></tr></thead><tbody><tr><td align="left"><strong>å¤„ç†æ—¶æœº</strong></td><td align="left">Bean å®šä¹‰åŠ è½½ä¹‹åï¼ŒBean å®ä¾‹åŒ–ä¹‹å‰</td><td align="left">Bean å®ä¾‹åŒ–ä¹‹åï¼Œåˆå§‹åŒ–å›è°ƒå‰å</td></tr><tr><td align="left"><strong>ä½œç”¨å¯¹è±¡</strong></td><td align="left">Bean çš„å®šä¹‰å…ƒæ•°æ®ï¼ˆBeanDefinitionï¼‰</td><td align="left">Bean å®ä¾‹å¯¹è±¡</td></tr><tr><td align="left"><strong>ä¸»è¦åŠŸèƒ½</strong></td><td align="left">ä¿®æ”¹ã€æ³¨å†Œæˆ–ç§»é™¤ BeanDefinition</td><td align="left">ä¿®æ”¹æˆ–åŒ…è£… Bean å®ä¾‹</td></tr><tr><td align="left"><strong>æ‰§è¡Œé˜¶æ®µ</strong></td><td align="left"><code>postProcessBeanFactory()</code></td><td align="left"><code>postProcessBeforeInitialization()</code><br/><code>postProcessAfterInitialization()</code></td></tr><tr><td align="left"><strong>è§¦å‘æ¬¡æ•°</strong></td><td align="left">æ¯ä¸ªå®¹å™¨<strong>ä»…æ‰§è¡Œä¸€æ¬¡</strong></td><td align="left">å¯¹<strong>æ¯ä¸ª Bean å®ä¾‹</strong>éƒ½ä¼šæ‰§è¡Œ</td></tr><tr><td align="left"><strong>Spring æ ¸å¿ƒé˜¶æ®µ</strong></td><td align="left">BeanFactory å‡†å¤‡é˜¶æ®µ</td><td align="left">Bean ç”Ÿå‘½å‘¨æœŸé˜¶æ®µ</td></tr><tr><td align="left"><strong>å…¸å‹åº”ç”¨åœºæ™¯</strong></td><td align="left">1. ä¿®æ”¹ Bean çš„å±æ€§å€¼ï¼ˆå ä½ç¬¦è§£æï¼‰<br/>2. åŠ¨æ€æ³¨å†Œ BeanDefinition<br/>3. æ ¹æ®æ¡ä»¶ç§»é™¤ Bean</td><td align="left">1. ä»£ç†å¢å¼ºï¼ˆAOPï¼‰<br/>2. å±æ€§æ³¨å…¥åçš„å¤„ç†<br/>3. è‡ªå®šä¹‰åˆå§‹åŒ–é€»è¾‘</td></tr><tr><td align="left"><strong>å®ç°ç¤ºä¾‹</strong></td><td align="left"><code>PropertySourcesPlaceholderConfigurer</code><br/><code>ConfigurationClassPostProcessor</code></td><td align="left"><code>AutowiredAnnotationBeanPostProcessor</code><br/><code>CommonAnnotationBeanPostProcessor</code></td></tr></tbody></table>
<h2 data-id="heading-24">ç»“è¯­</h2>
<p>ç¯‡å¹…åŸå› ï¼Œè¿™é‡Œæ— æ³•åˆ—å‡ºæ‰€æœ‰çš„å·¥å‚åç½®å¤„ç†å™¨çš„å…·ä½“ä½œç”¨å’Œå®ç°ï¼Œä¸è¿‡ <code>SpringBoot</code> å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œ<code>Spring</code> å®¹å™¨åˆ·æ–°è¿‡ç¨‹ä¸­è°ƒç”¨çš„ <code>BeanFactoryPostProcessor</code> ç›¸å¯¹äº <code>BeanPostProcessor</code> è¦å°‘çš„å¤šï¼Œä½†æ˜¯ä¸¤è€…éƒ½å¾ˆé‡è¦ï¼Œæœ‰å…´è¶£å¯ä»¥é€ä¸€æŸ¥çœ‹æºç ã€‚</p>
<h3 data-id="heading-25">å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè®°å¾—ç‚¹èµåŠ å…³æ³¨ï¼ä½ çš„æ”¯æŒå°±æ˜¯æˆ‘ç»§ç»­åˆ›ä½œçš„åŠ¨åŠ›ï¼</h3></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥Vue 3å“åº”å¼ç³»ç»Ÿï¼šä¸ºä»€ä¹ˆåµŒå¥—å¯¹è±¡ä¿®æ”¹åç•Œé¢ä¸æ›´æ–°ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7603771025855283251</link>    <guid>https://juejin.cn/post/7603771025855283251</guid>    <pubDate>2026-02-07T17:20:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603771025855283251" data-draft-id="7603651855236104201" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥Vue 3å“åº”å¼ç³»ç»Ÿï¼šä¸ºä»€ä¹ˆåµŒå¥—å¯¹è±¡ä¿®æ”¹åç•Œé¢ä¸æ›´æ–°ï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2026-02-07T17:20:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="iDaoæŠ€æœ¯é­”æ–¹"/> <meta itemprop="url" content="https://juejin.cn/user/166781496080782"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥Vue 3å“åº”å¼ç³»ç»Ÿï¼šä¸ºä»€ä¹ˆåµŒå¥—å¯¹è±¡ä¿®æ”¹åç•Œé¢ä¸æ›´æ–°ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/166781496080782/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    iDaoæŠ€æœ¯é­”æ–¹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T17:20:39.000Z" title="Sat Feb 07 2026 17:20:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>ä¸€å¥è¯ç®€ä»‹</strong>ï¼šVue 3ç”¨Proxyé‡æ„äº†å“åº”å¼ç³»ç»Ÿï¼Œä½†åµŒå¥—å¯¹è±¡çš„"æ·±å±‚å“åº”"èƒŒåè—ç€5ä¸ªè‡´å‘½é™·é˜±ã€‚æœ¬æ–‡ä»æºç çº§å‰–æå“åº”æ€§ä¸¢å¤±çš„æ ¹æœ¬åŸå› ï¼Œå¹¶æä¾›5ç§å®æˆ˜è§£å†³æ–¹æ¡ˆã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">ğŸ“‹ ç›®å½•</h2>
<ul>
<li><a href="#1-%E8%83%8C%E6%99%AF%E4%B8%80%E4%B8%AA%E8%AE%A9%E4%BA%BA%E5%B4%A9%E6%BA%83%E7%9A%84bug" title="#1-%E8%83%8C%E6%99%AF%E4%B8%80%E4%B8%AA%E8%AE%A9%E4%BA%BA%E5%B4%A9%E6%BA%83%E7%9A%84bug">1. èƒŒæ™¯ï¼šä¸€ä¸ªè®©äººå´©æºƒçš„Bug</a></li>
<li><a href="#2-%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86proxy%E7%9A%84%E4%BB%A3%E7%90%86%E9%99%B7%E9%98%B1" title="#2-%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86proxy%E7%9A%84%E4%BB%A3%E7%90%86%E9%99%B7%E9%98%B1">2. æ ¸å¿ƒåŸç†ï¼šProxyçš„"ä»£ç†é™·é˜±"</a></li>
<li><a href="#3-5%E7%A7%8D%E5%B8%B8%E8%A7%81%E9%99%B7%E9%98%B1%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" title="#3-5%E7%A7%8D%E5%B8%B8%E8%A7%81%E9%99%B7%E9%98%B1%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">3. 5ç§å¸¸è§é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ</a></li>
<li><a href="#4-%E6%B7%B1%E6%8B%B7%E8%B4%9D%E7%9A%84%E5%9D%91%E4%BD%A0%E4%BB%A5%E4%B8%BA%E7%9A%84%E5%AE%89%E5%85%A8%E5%85%B6%E5%AE%9E%E6%98%AF%E5%99%A9%E6%A2%A6" title="#4-%E6%B7%B1%E6%8B%B7%E8%B4%9D%E7%9A%84%E5%9D%91%E4%BD%A0%E4%BB%A5%E4%B8%BA%E7%9A%84%E5%AE%89%E5%85%A8%E5%85%B6%E5%AE%9E%E6%98%AF%E5%99%A9%E6%A2%A6">4. æ·±æ‹·è´çš„å‘ï¼šä½ ä»¥ä¸ºçš„å®‰å…¨å…¶å®æ˜¯å™©æ¢¦</a></li>
<li><a href="#5-%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B%E8%A1%A8%E6%A0%BC%E5%B5%8C%E5%A5%97%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0" title="#5-%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B%E8%A1%A8%E6%A0%BC%E5%B5%8C%E5%A5%97%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0">5. å®æˆ˜æ¡ˆä¾‹ï¼šè¡¨æ ¼åµŒå¥—æ•°æ®æ›´æ–°</a></li>
<li><a href="#6-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%A4%A7%E8%A7%84%E6%A8%A1%E6%95%B0%E6%8D%AE%E4%B8%8B%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5" title="#6-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%A4%A7%E8%A7%84%E6%A8%A1%E6%95%B0%E6%8D%AE%E4%B8%8B%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">6. æ€§èƒ½ä¼˜åŒ–ï¼šå¤§è§„æ¨¡æ•°æ®ä¸‹çš„æœ€ä½³å®è·µ</a></li>
<li><a href="#7-%E6%80%BB%E7%BB%93%E4%B8%8E%E9%81%BF%E5%9D%91%E6%B8%85%E5%8D%95" title="#7-%E6%80%BB%E7%BB%93%E4%B8%8E%E9%81%BF%E5%9D%91%E6%B8%85%E5%8D%95">7. æ€»ç»“ä¸é¿å‘æ¸…å•</a></li>
</ul>
<hr/>
<h2 data-id="heading-1">1. èƒŒæ™¯ï¼šä¸€ä¸ªè®©äººå´©æºƒçš„Bug</h2>
<h3 data-id="heading-2">1.1 ç°åœºé‡ç°</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { reactive } from 'vue'

const state = reactive({
  user: {
    name: 'å¼ ä¸‰',
    address: {
      city: 'åŒ—äº¬',
      district: 'æœé˜³åŒº'
    }
  }
})

// âŒ è¿™ä¸ªæ“ä½œä¸ä¼šè§¦å‘ç•Œé¢æ›´æ–°ï¼
const updateDistrict = () =&gt; {
  state.user.address.district = 'æµ·æ·€åŒº'
  console.log('å·²ä¿®æ”¹ä¸º:', state.user.address.district) // æ˜¾ç¤º"æµ·æ·€åŒº"
  // ä½†ç•Œé¢ä¸Šè¿˜æ˜¯æ˜¾ç¤º"æœé˜³åŒº"ï¼
}
&lt;/script&gt;

&lt;template&gt;
  &lt;div&gt;
    &lt;p&gt;å½“å‰åŒºåŸŸ: {{ state.user.address.district }}&lt;/p&gt;
    &lt;button @click="updateDistrict"&gt;ä¿®æ”¹åŒºåŸŸ&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p><strong>æ˜¯ä¸æ˜¯å¾ˆåƒä½ æ˜¨å¤©é‡åˆ°çš„Bugï¼Ÿ</strong></p>
<p>æ§åˆ¶å°æ˜¾ç¤ºæ•°æ®å·²ç»å˜äº†ï¼Œä½†ç•Œé¢çº¹ä¸ä¸åŠ¨ã€‚ä½ å¼€å§‹æ€€ç–‘äººç”Ÿï¼š</p>
<ul>
<li>"æˆ‘æ˜æ˜ç”¨äº†<code>reactive</code>ï¼Œå®ƒä¸æ˜¯æ·±å±‚çš„å—ï¼Ÿ"</li>
<li>"éš¾é“Vue 3çš„å“åº”å¼åäº†ï¼Ÿ"</li>
<li>"æ˜¯ä¸æ˜¯éœ€è¦æ‰‹åŠ¨è°ƒç”¨ä»€ä¹ˆæ–¹æ³•ï¼Ÿ"</li>
</ul>
<h3 data-id="heading-3">1.2 ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ</h3>
<p>Vue 3çš„å“åº”å¼ç³»ç»ŸåŸºäºES6çš„<code>Proxy</code>ï¼Œå®ƒç¡®å®æä¾›äº†"æ·±å±‚å“åº”"çš„èƒ½åŠ›ã€‚ä½†é—®é¢˜å‡ºåœ¨<strong>JavaScriptçš„å¯¹è±¡å¼•ç”¨æœºåˆ¶</strong>å’Œ<strong>Vueçš„ä¾èµ–æ”¶é›†æ—¶æœº</strong>ä¸Šã€‚</p>
<p>è®©æˆ‘ä»¬ä»æºç å±‚é¢ä¸€æ¢ç©¶ç«Ÿã€‚</p>
<hr/>
<h2 data-id="heading-4">2. æ ¸å¿ƒåŸç†ï¼šProxyçš„"ä»£ç†é™·é˜±"</h2>
<h3 data-id="heading-5">2.1 Vue 3å“åº”å¼ç³»ç»Ÿæ¶æ„</h3>
<pre><code class="hljs language-css" lang="css">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Vue <span class="hljs-number">3</span> å“åº”å¼ç³»ç»Ÿ                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åŸå§‹å¯¹è±¡ â”€â”€â–º Proxyä»£ç† â”€â”€â–º ä¾èµ–æ”¶é›†(track) â”€â”€â–º è§¦å‘æ›´æ–°(trigger)  â”‚
â”‚     â”‚           â”‚              â”‚               â”‚        â”‚
â”‚     â”‚           â”‚              â–¼               â–¼        â”‚
â”‚     â”‚           â”‚         WeakMapå­˜å‚¨      æ‰§è¡Œeffect    â”‚
â”‚     â”‚           â”‚     {target: {key: Set&lt;effect&gt;}}      â”‚
â”‚     â–¼           â–¼                                       â”‚
â”‚  {<span class="hljs-selector-tag">a</span>: <span class="hljs-number">1</span>}    Proxy{<span class="hljs-selector-tag">a</span>: <span class="hljs-number">1</span>}                                  â”‚
â”‚              get() â”€â”€trackâ”€â”€â”                           â”‚
â”‚              set() â”€â”€triggerâ”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-6">2.2 æ ¸å¿ƒæºç è§£æ</h3>
<p>Vue 3çš„<code>reactive</code>å‡½æ•°ç®€åŒ–å®ç°ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ç®€åŒ–ç‰ˆæºç ï¼ˆåŸºäºvuejs/coreï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reactive</span>(<span class="hljs-params">obj</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(obj, {
    <span class="hljs-title function_">get</span>(<span class="hljs-params">target, key</span>) {
      <span class="hljs-comment">// 1. æ”¶é›†ä¾èµ–ï¼šè°åœ¨ç”¨è¿™ä¸ªå±æ€§</span>
      <span class="hljs-title function_">track</span>(target, key)
      <span class="hljs-keyword">const</span> result = target[key]
      <span class="hljs-comment">// 2. é€’å½’ä»£ç†ï¼šè®©åµŒå¥—å¯¹è±¡ä¹Ÿå˜æˆå“åº”å¼</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isObject</span>(result)) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">reactive</span>(result)
      }
      <span class="hljs-keyword">return</span> result
    },
    <span class="hljs-title function_">set</span>(<span class="hljs-params">target, key, value</span>) {
      <span class="hljs-keyword">const</span> oldValue = target[key]
      target[key] = value
      <span class="hljs-comment">// 3. è§¦å‘æ›´æ–°ï¼šé€šçŸ¥æ‰€æœ‰ä¾èµ–è¿™ä¸ªå±æ€§çš„effect</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">hasChanged</span>(value, oldValue)) {
        <span class="hljs-title function_">trigger</span>(target, key)
      }
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
    }
  })
}
</code></pre>
<h3 data-id="heading-7">2.3 ä¾èµ–æ”¶é›†çš„"æ‡’æƒ°æ€§"</h3>
<p><strong>å…³é”®é—®é¢˜</strong>ï¼šVueçš„ä¾èµ–æ”¶é›†æ˜¯"æŒ‰éœ€"çš„ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">user</span>: {
    <span class="hljs-attr">address</span>: {
      <span class="hljs-attr">district</span>: <span class="hljs-string">'æœé˜³åŒº'</span>
    }
  }
})

<span class="hljs-comment">// åœºæ™¯1ï¼šæ¨¡æ¿ä¸­åªè®¿é—®äº† state.user</span>
<span class="hljs-comment">// æ”¶é›†çš„ä¾èµ–ï¼šstate â”€â”€â–º user</span>
<span class="hljs-comment">// å½“ä¿®æ”¹ state.user.address.district æ—¶ï¼š</span>
<span class="hljs-comment">// - ä¿®æ”¹çš„æ˜¯ address å¯¹è±¡ï¼Œä¸æ˜¯ user å¯¹è±¡</span>
<span class="hljs-comment">// - æ²¡æœ‰è§¦å‘ user çš„ setter</span>
<span class="hljs-comment">// - ç•Œé¢ä¸æ›´æ–°ï¼</span>

<span class="hljs-comment">// åœºæ™¯2ï¼šæ¨¡æ¿ä¸­è®¿é—®äº† state.user.address.district</span>
<span class="hljs-comment">// æ”¶é›†çš„ä¾èµ–ï¼šstate â”€â”€â–º user â”€â”€â–º address â”€â”€â–º district</span>
<span class="hljs-comment">// è¿™æ—¶ä¿®æ”¹ district æ‰ä¼šè§¦å‘æ›´æ–°</span>
</code></pre>
<h3 data-id="heading-8">2.4 å†…å­˜ç»“æ„å›¾è§£</h3>
<pre><code class="hljs language-javascript" lang="javascript">åˆå§‹çŠ¶æ€ï¼ˆæœªè®¿é—®æ·±å±‚å±æ€§ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  targetMap (<span class="hljs-title class_">WeakMap</span>)                â”‚
â”‚  â”œâ”€ <span class="hljs-attr">state</span>: depsMap                  â”‚
â”‚  â”‚   â””â”€ <span class="hljs-string">"user"</span>: <span class="hljs-title class_">Set</span>[<span class="hljs-title class_">ComponentEffect</span>]â”‚
â”‚  â”‚   <span class="hljs-comment">// æ³¨æ„ï¼šæ²¡æœ‰"address"å’Œ"district"çš„ä¾èµ–ï¼  â”‚</span>
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è®¿é—®æ·±å±‚å±æ€§åï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  targetMap (<span class="hljs-title class_">WeakMap</span>)                            â”‚
â”‚  â”œâ”€ <span class="hljs-attr">state</span>: depsMap                              â”‚
â”‚  â”‚   â”œâ”€ <span class="hljs-string">"user"</span>: <span class="hljs-title class_">Set</span>[<span class="hljs-title class_">ComponentEffect</span>]            â”‚
â”‚  â”œâ”€ state.<span class="hljs-property">user</span>: depsMap (<span class="hljs-title class_">Proxy</span>)                 â”‚
â”‚  â”‚   â”œâ”€ <span class="hljs-string">"address"</span>: <span class="hljs-title class_">Set</span>[<span class="hljs-title class_">ComponentEffect</span>]         â”‚
â”‚  â”œâ”€ state.<span class="hljs-property">user</span>.<span class="hljs-property">address</span>: depsMap (<span class="hljs-title class_">Proxy</span>)         â”‚
â”‚  â”‚   â”œâ”€ <span class="hljs-string">"district"</span>: <span class="hljs-title class_">Set</span>[<span class="hljs-title class_">ComponentEffect</span>]        â”‚
â”‚  â”‚   <span class="hljs-comment">// ç°åœ¨ä¿®æ”¹ district ä¼šè§¦å‘æ›´æ–°äº†ï¼        â”‚</span>
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h2 data-id="heading-9">3. 5ç§å¸¸è§é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ</h2>
<h3 data-id="heading-10">é™·é˜±1ï¼šç›´æ¥æ›¿æ¢åµŒå¥—å¯¹è±¡å±æ€§</h3>
<p><strong>âŒ é”™è¯¯ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { reactive } from 'vue'

const state = reactive({
  form: {
    name: '',
    items: [
      { id: 1, value: 'A' },
      { id: 2, value: 'B' }
    ]
  }
})

// ç›´æ¥ä¿®æ”¹æ•°ç»„ä¸­çš„å¯¹è±¡å±æ€§ - ä¸è§¦å‘æ›´æ–°ï¼
const updateItem = () =&gt; {
  state.form.items[0].value = 'C'  // âŒ ç•Œé¢å¯èƒ½ä¸æ›´æ–°
}
&lt;/script&gt;
</code></pre>
<p><strong>âœ… è§£å†³æ–¹æ¡ˆ1ï¼šä½¿ç”¨<code>Vue.set</code>é£æ ¼çš„èµ‹å€¼</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ–¹æ³•Aï¼šä½¿ç”¨ splice è§¦å‘æ•°ç»„æ›´æ–°</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">updateItem</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> newItems = [...state.<span class="hljs-property">form</span>.<span class="hljs-property">items</span>]
  newItems[<span class="hljs-number">0</span>] = { ...newItems[<span class="hljs-number">0</span>], <span class="hljs-attr">value</span>: <span class="hljs-string">'C'</span> }
  state.<span class="hljs-property">form</span>.<span class="hljs-property">items</span> = newItems  <span class="hljs-comment">// âœ… è§¦å‘æ›´æ–°</span>
}

<span class="hljs-comment">// æ–¹æ³•Bï¼šä½¿ç”¨ Vue æä¾›çš„å·¥å…·å‡½æ•°</span>
<span class="hljs-keyword">import</span> { set } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">updateItem</span> = (<span class="hljs-params"/>) =&gt; {
  state.<span class="hljs-property">form</span>.<span class="hljs-property">items</span>[<span class="hljs-number">0</span>].<span class="hljs-property">value</span> = <span class="hljs-string">'C'</span>
  <span class="hljs-comment">// å¼ºåˆ¶è§¦å‘æ›´æ–°</span>
  state.<span class="hljs-property">form</span>.<span class="hljs-property">items</span> = [...state.<span class="hljs-property">form</span>.<span class="hljs-property">items</span>]
}
</code></pre>
<p><strong>âœ… è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨<code>ref</code>è€Œé<code>reactive</code></strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> form = <span class="hljs-title function_">ref</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">items</span>: [{ <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'A'</span> }]
})

<span class="hljs-keyword">const</span> <span class="hljs-title function_">updateItem</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// é€šè¿‡ .value è®¿é—®ï¼Œç¡®ä¿è§¦å‘å“åº”</span>
  form.<span class="hljs-property">value</span>.<span class="hljs-property">items</span>[<span class="hljs-number">0</span>].<span class="hljs-property">value</span> = <span class="hljs-string">'C'</span>
  <span class="hljs-comment">// éœ€è¦æ•´ä½“èµ‹å€¼æ‰ä¼šè§¦å‘</span>
  form.<span class="hljs-property">value</span>.<span class="hljs-property">items</span> = [...form.<span class="hljs-property">value</span>.<span class="hljs-property">items</span>]
}
</code></pre>
<h3 data-id="heading-11">é™·é˜±2ï¼šè§£æ„èµ‹å€¼ä¸¢å¤±å“åº”æ€§</h3>
<p><strong>âŒ é”™è¯¯ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">user</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'å¼ ä¸‰'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> }
})

<span class="hljs-comment">// è§£æ„ä¼šå¤±å»å“åº”æ€§ï¼</span>
<span class="hljs-keyword">const</span> { user } = state
<span class="hljs-comment">// user åªæ˜¯ä¸€ä¸ªæ™®é€šå¯¹è±¡å¼•ç”¨ï¼Œä¸å†æ˜¯ Proxy</span>

<span class="hljs-comment">// ä¿®æ”¹ user ä¸ä¼šè§¦å‘ç•Œé¢æ›´æ–°</span>
user.<span class="hljs-property">name</span> = <span class="hljs-string">'æå››'</span>  <span class="hljs-comment">// âŒ ç•Œé¢ä¸æ›´æ–°</span>
</code></pre>
<p><strong>âœ… è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ–¹æ³•1ï¼šå§‹ç»ˆé€šè¿‡åŸå§‹å¯¹è±¡è®¿é—®</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">updateName</span> = (<span class="hljs-params"/>) =&gt; {
  state.<span class="hljs-property">user</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'æå››'</span>  <span class="hljs-comment">// âœ… ä¼šè§¦å‘æ›´æ–°</span>
}

<span class="hljs-comment">// æ–¹æ³•2ï¼šä½¿ç”¨ toRefs ä¿æŒå“åº”æ€§</span>
<span class="hljs-keyword">import</span> { reactive, toRefs } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">user</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'å¼ ä¸‰'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> }
})

<span class="hljs-comment">// toRefs ä¼šå°†å¯¹è±¡çš„æ¯ä¸ªå±æ€§è½¬æ¢ä¸º ref</span>
<span class="hljs-keyword">const</span> { user } = <span class="hljs-title function_">toRefs</span>(state)
<span class="hljs-comment">// ç°åœ¨ user.value æ˜¯å“åº”å¼çš„</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">updateName</span> = (<span class="hljs-params"/>) =&gt; {
  user.<span class="hljs-property">value</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'æå››'</span>  <span class="hljs-comment">// âœ… ä¼šè§¦å‘æ›´æ–°</span>
}

<span class="hljs-comment">// æ–¹æ³•3ï¼šåœ¨ setup ä¸­ç›´æ¥ä½¿ç”¨è§£æ„ï¼ˆä»…é™&lt;script setup&gt;ï¼‰</span>
&lt;script setup&gt;
<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">user</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'å¼ ä¸‰'</span> } })
<span class="hljs-comment">// ç›´æ¥ä½¿ç”¨ï¼Œä¸è¦è§£æ„</span>
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-12">é™·é˜±3ï¼šæ•°ç»„ç´¢å¼•ä¿®æ”¹ä¸è§¦å‘æ›´æ–°</h3>
<p><strong>âŒ é”™è¯¯ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> list = <span class="hljs-title function_">reactive</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])

<span class="hljs-comment">// ç›´æ¥é€šè¿‡ç´¢å¼•ä¿®æ”¹</span>
list[<span class="hljs-number">0</span>] = <span class="hljs-number">100</span>  <span class="hljs-comment">// âŒ å¯èƒ½ä¸ä¼šè§¦å‘æ›´æ–°ï¼ˆåœ¨æŸäº›è¾¹ç•Œæƒ…å†µä¸‹ï¼‰</span>
</code></pre>
<p><strong>âœ… è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ–¹æ³•1ï¼šä½¿ç”¨ splice</span>
list.<span class="hljs-title function_">splice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">100</span>)  <span class="hljs-comment">// âœ… è§¦å‘æ›´æ–°</span>

<span class="hljs-comment">// æ–¹æ³•2ï¼šé‡æ–°èµ‹å€¼æ•´ä¸ªæ•°ç»„</span>
list[<span class="hljs-number">0</span>] = <span class="hljs-number">100</span>
list.<span class="hljs-property">length</span> = list.<span class="hljs-property">length</span>  <span class="hljs-comment">// å¼ºåˆ¶è§¦å‘ï¼ˆhackæ–¹å¼ï¼Œä¸æ¨èï¼‰</span>

<span class="hljs-comment">// æ–¹æ³•3ï¼šä½¿ç”¨ ref æ›¿ä»£</span>
<span class="hljs-keyword">const</span> list = <span class="hljs-title function_">ref</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])
list.<span class="hljs-property">value</span>[<span class="hljs-number">0</span>] = <span class="hljs-number">100</span>  <span class="hljs-comment">// âœ… æ€»æ˜¯è§¦å‘æ›´æ–°</span>
</code></pre>
<h3 data-id="heading-13">é™·é˜±4ï¼šObjectæ–°å¢å±æ€§ä¸å“åº”</h3>
<p><strong>âŒ é”™è¯¯ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">user</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'å¼ ä¸‰'</span> }
})

<span class="hljs-comment">// æ·»åŠ æ–°å±æ€§</span>
state.<span class="hljs-property">user</span>.<span class="hljs-property">age</span> = <span class="hljs-number">25</span>  <span class="hljs-comment">// âŒ ä¸ä¼šè§¦å‘æ›´æ–°ï¼ˆå³ä½¿è®¿é—®è¿‡userï¼‰</span>
</code></pre>
<p><strong>âœ… è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ–¹æ³•1ï¼šä½¿ç”¨ Object.assign</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(state.<span class="hljs-property">user</span>, { <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> })  <span class="hljs-comment">// âœ… è§¦å‘æ›´æ–°</span>

<span class="hljs-comment">// æ–¹æ³•2ï¼šé¢„å…ˆå£°æ˜æ‰€æœ‰å¯èƒ½ç”¨åˆ°çš„å±æ€§</span>
<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">user</span>: { 
    <span class="hljs-attr">name</span>: <span class="hljs-string">'å¼ ä¸‰'</span>,
    <span class="hljs-attr">age</span>: <span class="hljs-literal">undefined</span>  <span class="hljs-comment">// é¢„å…ˆå£°æ˜</span>
  }
})
state.<span class="hljs-property">user</span>.<span class="hljs-property">age</span> = <span class="hljs-number">25</span>  <span class="hljs-comment">// âœ… ç°åœ¨ä¼šè§¦å‘æ›´æ–°</span>

<span class="hljs-comment">// æ–¹æ³•3ï¼šä½¿ç”¨ ref</span>
<span class="hljs-keyword">const</span> user = <span class="hljs-title function_">ref</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'å¼ ä¸‰'</span> })
user.<span class="hljs-property">value</span> = { ...user.<span class="hljs-property">value</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> }  <span class="hljs-comment">// âœ… è§¦å‘æ›´æ–°</span>
</code></pre>
<h3 data-id="heading-14">é™·é˜±5ï¼šæ·±å±‚åµŒå¥—å¯¹è±¡çš„æ€§èƒ½é™·é˜±</h3>
<p><strong>âŒ é—®é¢˜åœºæ™¯ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> bigData = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-comment">// 1000æ¡æ•°æ®ï¼Œæ¯æ¡éƒ½æœ‰æ·±å±‚åµŒå¥—</span>
  <span class="hljs-attr">list</span>: <span class="hljs-title class_">Array</span>(<span class="hljs-number">1000</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-literal">null</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> ({
    <span class="hljs-attr">id</span>: i,
    <span class="hljs-attr">info</span>: {
      <span class="hljs-attr">detail</span>: {
        <span class="hljs-attr">deep</span>: { <span class="hljs-attr">value</span>: i }
      }
    }
  }))
})
<span class="hljs-comment">// æ¯æ¬¡è®¿é—®éƒ½ä¼šé€’å½’åˆ›å»º Proxyï¼Œæ€§èƒ½çˆ†ç‚¸ï¼</span>
</code></pre>
<p><strong>âœ… è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { shallowRef, triggerRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// ä½¿ç”¨ shallowRefï¼Œåªæœ‰ .value æ˜¯å“åº”å¼çš„ï¼Œå†…éƒ¨ä¸åšæ·±ä»£ç†</span>
<span class="hljs-keyword">const</span> bigData = <span class="hljs-title function_">shallowRef</span>({
  <span class="hljs-attr">list</span>: <span class="hljs-title class_">Array</span>(<span class="hljs-number">1000</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-literal">null</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> ({
    <span class="hljs-attr">id</span>: i,
    <span class="hljs-attr">info</span>: { <span class="hljs-attr">detail</span>: { <span class="hljs-attr">deep</span>: { <span class="hljs-attr">value</span>: i } } }
  }))
})

<span class="hljs-comment">// ä¿®æ”¹æ·±å±‚æ•°æ®</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">updateDeep</span> = (<span class="hljs-params"/>) =&gt; {
  bigData.<span class="hljs-property">value</span>.<span class="hljs-property">list</span>[<span class="hljs-number">0</span>].<span class="hljs-property">info</span>.<span class="hljs-property">detail</span>.<span class="hljs-property">deep</span>.<span class="hljs-property">value</span> = <span class="hljs-number">999</span>
  <span class="hljs-comment">// æ‰‹åŠ¨è§¦å‘æ›´æ–°</span>
  <span class="hljs-title function_">triggerRef</span>(bigData)  <span class="hljs-comment">// âœ… å¼ºåˆ¶åˆ·æ–°ç•Œé¢</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-15">4. æ·±æ‹·è´çš„å‘ï¼šä½ ä»¥ä¸ºçš„å®‰å…¨å…¶å®æ˜¯å™©æ¢¦</h2>
<h3 data-id="heading-16">4.1 æ·±æ‹·è´ä¸ºä»€ä¹ˆä¼šç ´åå“åº”æ€§ï¼Ÿ</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> cloneDeep <span class="hljs-keyword">from</span> <span class="hljs-string">'lodash/cloneDeep'</span>

<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">user</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'å¼ ä¸‰'</span>, <span class="hljs-attr">items</span>: [{ <span class="hljs-attr">id</span>: <span class="hljs-number">1</span> }] }
})

<span class="hljs-comment">// âŒ è‡´å‘½é”™è¯¯ï¼šæ·±æ‹·è´åä¸¢å¤±äº†æ‰€æœ‰å“åº”æ€§ï¼</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">saveData</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> dataToSave = <span class="hljs-title function_">cloneDeep</span>(state.<span class="hljs-property">user</span>)
  <span class="hljs-comment">// dataToSave æ˜¯ä¸€ä¸ªçº¯å¯¹è±¡ï¼Œæ²¡æœ‰ä»»ä½• Proxy åŒ…è£…</span>
  <span class="hljs-comment">// å¦‚æœä½ æŠŠå®ƒèµ‹å› stateï¼Œå“åº”æ€§å°±å½»åº•æ–­äº†</span>
  state.<span class="hljs-property">user</span> = dataToSave  <span class="hljs-comment">// âŒ ç°åœ¨ state.user ä¸å†æ˜¯å“åº”å¼ä»£ç†ï¼</span>
}
</code></pre>
<h3 data-id="heading-17">4.2 æ­£ç¡®çš„æ·±æ‹·è´å§¿åŠ¿</h3>
<p><strong>åœºæ™¯1ï¼šéœ€è¦æäº¤åˆ°åç«¯çš„æ•°æ®</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { toRaw } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">saveData</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// ä½¿ç”¨ toRaw è·å–åŸå§‹å¯¹è±¡ï¼ˆä¸ä¼šé€’å½’è§£åŒ…ï¼Œæ€§èƒ½æ›´å¥½ï¼‰</span>
  <span class="hljs-keyword">const</span> rawData = <span class="hljs-title function_">toRaw</span>(state.<span class="hljs-property">user</span>)
  <span class="hljs-comment">// å‘é€ç»™åç«¯</span>
  <span class="hljs-keyword">await</span> api.<span class="hljs-title function_">saveUser</span>(rawData)
}
</code></pre>
<p><strong>åœºæ™¯2ï¼šéœ€è¦å¤åˆ¶æ•°æ®åŒæ—¶ä¿æŒå“åº”æ€§</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">duplicateUser</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// æ–¹æ³•1ï¼šé€ä¸ªå±æ€§å¤åˆ¶ï¼Œä¿æŒå“åº”æ€§</span>
  <span class="hljs-keyword">const</span> newUser = <span class="hljs-title function_">reactive</span>({
    <span class="hljs-attr">name</span>: state.<span class="hljs-property">user</span>.<span class="hljs-property">name</span>,
    <span class="hljs-attr">items</span>: state.<span class="hljs-property">user</span>.<span class="hljs-property">items</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({ ...item }))
  })
  
  <span class="hljs-comment">// æ–¹æ³•2ï¼šä½¿ç”¨ JSON è§£æï¼ˆæ³¨æ„ï¼šä¼šä¸¢å¤±å‡½æ•°ã€Dateç­‰ç‰¹æ®Šç±»å‹ï¼‰</span>
  <span class="hljs-keyword">const</span> newUser2 = <span class="hljs-title function_">reactive</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(state.<span class="hljs-property">user</span>)))
}
</code></pre>
<p><strong>åœºæ™¯3ï¼šä½¿ç”¨ Immer è¿›è¡Œä¸å¯å˜æ›´æ–°</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { produce } <span class="hljs-keyword">from</span> <span class="hljs-string">'immer'</span>
<span class="hljs-keyword">import</span> { shallowRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">shallowRef</span>({
  <span class="hljs-attr">user</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'å¼ ä¸‰'</span>, <span class="hljs-attr">items</span>: [{ <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'A'</span> }] }
})

<span class="hljs-keyword">const</span> <span class="hljs-title function_">updateItem</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// Immer ä¼šåˆ›å»ºæ–°çš„ä¸å¯å˜å¯¹è±¡</span>
  state.<span class="hljs-property">value</span> = <span class="hljs-title function_">produce</span>(state.<span class="hljs-property">value</span>, <span class="hljs-function"><span class="hljs-params">draft</span> =&gt;</span> {
    draft.<span class="hljs-property">user</span>.<span class="hljs-property">items</span>[<span class="hljs-number">0</span>].<span class="hljs-property">value</span> = <span class="hljs-string">'B'</span>
  })
  <span class="hljs-comment">// shallowRef æ£€æµ‹åˆ° .value å˜åŒ–ï¼Œè§¦å‘æ›´æ–° âœ…</span>
}
</code></pre>
<h3 data-id="heading-18">4.3 æ·±æ‹·è´ vs æµ…æ‹·è´é€ŸæŸ¥è¡¨</h3>









































<table><thead><tr><th>æ–¹æ³•</th><th>æ˜¯å¦ç ´åå“åº”æ€§</th><th>æ€§èƒ½</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><code>JSON.parse(JSON.stringify())</code></td><td>âœ… æ˜¯</td><td>ä¸­</td><td>ç®€å•å¯¹è±¡ï¼Œæ— å¾ªç¯å¼•ç”¨</td></tr><tr><td><code>lodash.cloneDeep</code></td><td>âœ… æ˜¯</td><td>ä½</td><td>å¤æ‚å¯¹è±¡ï¼Œéœ€è¦å®Œæ•´å¤åˆ¶</td></tr><tr><td><code>toRaw()</code></td><td>âŒ å¦ï¼ˆåªè¯»ï¼‰</td><td>é«˜</td><td>æäº¤æ•°æ®åˆ°åç«¯</td></tr><tr><td><code>{...obj}</code></td><td>âŒ å¦ï¼ˆæµ…æ‹·è´ï¼‰</td><td>é«˜</td><td>åªéœ€å¤åˆ¶ä¸€å±‚</td></tr><tr><td><code>structuredClone()</code></td><td>âœ… æ˜¯</td><td>ä¸­</td><td>ç°ä»£æµè§ˆå™¨ï¼Œæ”¯æŒæ›´å¤šç±»å‹</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-19">5. å®æˆ˜æ¡ˆä¾‹ï¼šè¡¨æ ¼åµŒå¥—æ•°æ®æ›´æ–°</h2>
<h3 data-id="heading-20">5.1 éœ€æ±‚æè¿°</h3>
<p>å®ç°ä¸€ä¸ªå¯ç¼–è¾‘è¡¨æ ¼ï¼Œæ”¯æŒï¼š</p>
<ol>
<li>å¤šè¡Œæ•°æ®å±•ç¤º</li>
<li>æ¯è¡Œå¯ä»¥å±•å¼€æ˜¾ç¤ºå­è¡¨æ ¼</li>
<li>å­è¡¨æ ¼æ•°æ®å¯ç¼–è¾‘</li>
<li>ç¼–è¾‘åå®æ—¶æ›´æ–°</li>
</ol>
<h3 data-id="heading-21">5.2 å®Œæ•´ä»£ç å®ç°</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { reactive, ref, nextTick } from 'vue'

// è¡¨æ ¼æ•°æ®ç»“æ„
const tableData = reactive({
  rows: [
    {
      id: 1,
      name: 'äº§å“A',
      expanded: false,
      children: [
        { id: '1-1', sku: 'SKU001', stock: 100 },
        { id: '1-2', sku: 'SKU002', stock: 200 }
      ]
    },
    {
      id: 2,
      name: 'äº§å“B',
      expanded: false,
      children: [
        { id: '2-1', sku: 'SKU003', stock: 150 }
      ]
    }
  ]
})

// âœ… æ­£ç¡®çš„æ›´æ–°æ–¹æ³•ï¼šå±•å¼€/æ”¶èµ·
const toggleExpand = (row) =&gt; {
  // ç›´æ¥ä¿®æ”¹ä¼šè§¦å‘æ›´æ–°
  row.expanded = !row.expanded
}

// âœ… æ­£ç¡®çš„æ›´æ–°æ–¹æ³•ï¼šä¿®æ”¹åº“å­˜
const updateStock = (row, childIndex, newStock) =&gt; {
  // æ–¹æ³•1ï¼šç›´æ¥ä¿®æ”¹åµŒå¥—å±æ€§ï¼ˆå¦‚æœæ¨¡æ¿ä¸­è®¿é—®è¿‡è¿™ä¸ªè·¯å¾„ï¼‰
  row.children[childIndex].stock = newStock
  
  // æ–¹æ³•2ï¼šå¦‚æœä¸ç¡®å®šæ˜¯å¦è®¿é—®è¿‡ï¼Œå¼ºåˆ¶åˆ·æ–°
  // row.children = [...row.children]
}

// âœ… æ­£ç¡®çš„æ›´æ–°æ–¹æ³•ï¼šæ·»åŠ å­é¡¹
const addChild = (row) =&gt; {
  const newChild = {
    id: `${row.id}-${row.children.length + 1}`,
    sku: `SKU00${Date.now()}`,
    stock: 0
  }
  // ä½¿ç”¨ push ä¼šè§¦å‘æ›´æ–°
  row.children.push(newChild)
  
  // ç¡®ä¿å±•å¼€ä»¥æ˜¾ç¤ºæ–°æ·»åŠ çš„è¡Œ
  row.expanded = true
}

// âŒ é”™è¯¯ç¤ºä¾‹ï¼šç›´æ¥æ›¿æ¢æ•´ä¸ª children æ•°ç»„å¯èƒ½ä¸¢å¤±å“åº”æ€§
const wrongUpdate = (row) =&gt; {
  // å¦‚æœ row.children æ˜¯ä»å¤–éƒ¨ä¼ å…¥çš„éå“åº”å¼æ•°æ®
  row.children = row.children.map(child =&gt; ({ ...child }))  // âš ï¸ å±é™©ï¼
}

// âœ… å®‰å…¨ç¤ºä¾‹ï¼šæ‰¹é‡æ›´æ–°
const batchUpdate = async (row) =&gt; {
  // æ‰¹é‡ä¿®æ”¹å‰å…ˆå†»ç»“æ›´æ–°
  const originalChildren = JSON.parse(JSON.stringify(row.children))
  
  // ä¿®æ”¹æ•°æ®
  originalChildren.forEach(child =&gt; {
    child.stock += 10
  })
  
  // ä¸€æ¬¡æ€§èµ‹å€¼ï¼Œè§¦å‘å•æ¬¡æ›´æ–°
  row.children = originalChildren
  
  // ç­‰å¾… DOM æ›´æ–°
  await nextTick()
  console.log('æ‰¹é‡æ›´æ–°å®Œæˆ')
}
&lt;/script&gt;

&lt;template&gt;
  &lt;div class="table-container"&gt;
    &lt;table&gt;
      &lt;thead&gt;
        &lt;tr&gt;
          &lt;th&gt;å±•å¼€&lt;/th&gt;
          &lt;th&gt;ID&lt;/th&gt;
          &lt;th&gt;åç§°&lt;/th&gt;
          &lt;th&gt;æ“ä½œ&lt;/th&gt;
        &lt;/tr&gt;
      &lt;/thead&gt;
      &lt;tbody&gt;
        &lt;template v-for="row in tableData.rows" :key="row.id"&gt;
          &lt;!-- ä¸»è¡Œ --&gt;
          &lt;tr class="main-row"&gt;
            &lt;td&gt;
              &lt;button @click="toggleExpand(row)"&gt;
                {{ row.expanded ? 'â–¼' : 'â–¶' }}
              &lt;/button&gt;
            &lt;/td&gt;
            &lt;td&gt;{{ row.id }}&lt;/td&gt;
            &lt;td&gt;{{ row.name }}&lt;/td&gt;
            &lt;td&gt;
              &lt;button @click="addChild(row)"&gt;æ·»åŠ å­é¡¹&lt;/button&gt;
              &lt;button @click="batchUpdate(row)"&gt;æ‰¹é‡+10&lt;/button&gt;
            &lt;/td&gt;
          &lt;/tr&gt;
          
          &lt;!-- å­è¡¨æ ¼ --&gt;
          &lt;tr v-if="row.expanded" class="child-row"&gt;
            &lt;td colspan="4"&gt;
              &lt;table class="child-table"&gt;
                &lt;thead&gt;
                  &lt;tr&gt;
                    &lt;th&gt;SKU&lt;/th&gt;
                    &lt;th&gt;åº“å­˜&lt;/th&gt;
                  &lt;/tr&gt;
                &lt;/thead&gt;
                &lt;tbody&gt;
                  &lt;tr v-for="(child, index) in row.children" :key="child.id"&gt;
                    &lt;td&gt;{{ child.sku }}&lt;/td&gt;
                    &lt;td&gt;
                      &lt;input 
                        type="number" 
                        v-model="child.stock"
                        @change="updateStock(row, index, child.stock)"
                      /&gt;
                    &lt;/td&gt;
                  &lt;/tr&gt;
                &lt;/tbody&gt;
              &lt;/table&gt;
            &lt;/td&gt;
          &lt;/tr&gt;
        &lt;/template&gt;
      &lt;/tbody&gt;
    &lt;/table&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;style scoped&gt;
.table-container {
  padding: 20px;
}
table {
  width: 100%;
  border-collapse: collapse;
}
th, td {
  border: 1px solid #ddd;
  padding: 8px;
  text-align: left;
}
.main-row {
  background: #f5f5f5;
}
.child-row {
  background: #fff;
}
.child-table {
  margin: 10px;
  width: calc(100% - 20px);
}
input {
  width: 80px;
  padding: 4px;
}
&lt;/style&gt;
</code></pre>
<h3 data-id="heading-22">5.3 å…³é”®ç‚¹æ€»ç»“</h3>
<ol>
<li><strong>æ¨¡æ¿è®¿é—®è·¯å¾„å¾ˆé‡è¦</strong>ï¼šç¡®ä¿æ¨¡æ¿ä¸­è®¿é—®äº†ä½ è¦ä¿®æ”¹çš„å®Œæ•´è·¯å¾„</li>
<li><strong>æ•°ç»„æ–¹æ³•ä¼˜å…ˆä½¿ç”¨</strong>ï¼š<code>push</code>ã€<code>splice</code> ç­‰æ–¹æ³•ä¼šè§¦å‘æ›´æ–°</li>
<li><strong>æ‰¹é‡æ›´æ–°ä¼˜åŒ–</strong>ï¼šå¤šæ¬¡ä¿®æ”¹åä¸€æ¬¡æ€§èµ‹å€¼ï¼Œå‡å°‘é‡æ¸²æŸ“æ¬¡æ•°</li>
<li><strong>nextTick çš„æ—¶æœº</strong>ï¼šéœ€è¦åœ¨ DOM æ›´æ–°åæ‰§è¡Œæ“ä½œæ—¶è®°å¾—ä½¿ç”¨</li>
</ol>
<hr/>
<h2 data-id="heading-23">6. æ€§èƒ½ä¼˜åŒ–ï¼šå¤§è§„æ¨¡æ•°æ®ä¸‹çš„æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-24">6.1 è™šæ‹Ÿæ»šåŠ¨ + shallowRef</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { shallowRef, ref, computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// è¶…å¤§æ•°æ®åˆ—è¡¨ï¼ˆ10ä¸‡æ¡ï¼‰</span>
<span class="hljs-keyword">const</span> hugeList = <span class="hljs-title function_">shallowRef</span>([
  <span class="hljs-comment">// å‡è®¾è¿™é‡Œæœ‰10ä¸‡æ¡åµŒå¥—æ•°æ®</span>
])

<span class="hljs-comment">// åªæ˜¾ç¤ºå¯è§†åŒºåŸŸçš„æ•°æ®</span>
<span class="hljs-keyword">const</span> visibleData = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> start = scrollTop.<span class="hljs-property">value</span> <span class="hljs-comment">// å½“å‰æ»šåŠ¨ä½ç½®</span>
  <span class="hljs-keyword">const</span> end = start + visibleCount.<span class="hljs-property">value</span> <span class="hljs-comment">// å¯è§†æ•°é‡</span>
  <span class="hljs-keyword">return</span> hugeList.<span class="hljs-property">value</span>.<span class="hljs-title function_">slice</span>(start, end)
})

<span class="hljs-comment">// ä¿®æ”¹æ•°æ®æ—¶æ‰‹åŠ¨è§¦å‘</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">updateItem</span> = (<span class="hljs-params">index, newData</span>) =&gt; {
  hugeList.<span class="hljs-property">value</span>[index] = newData
  <span class="hljs-title function_">triggerRef</span>(hugeList) <span class="hljs-comment">// æ‰‹åŠ¨è§¦å‘æ›´æ–°</span>
}
</code></pre>
<h3 data-id="heading-25">6.2 åˆ†é¡µåŠ è½½ä¸å±€éƒ¨å“åº”</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { reactive, ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-comment">// åªæœ‰å½“å‰é¡µçš„æ•°æ®æ˜¯å“åº”å¼çš„</span>
  <span class="hljs-attr">currentPageData</span>: [],
  <span class="hljs-comment">// æ€»æ•°æ®åªå­˜åŸå§‹æ•°æ®ï¼Œä¸åšå“åº”å¼å¤„ç†</span>
  <span class="hljs-attr">allData</span>: []
})

<span class="hljs-comment">// åˆ‡æ¢é¡µé¢æ—¶æ›´æ–°å“åº”å¼æ•°æ®</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">changePage</span> = (<span class="hljs-params">page</span>) =&gt; {
  <span class="hljs-keyword">const</span> start = (page - <span class="hljs-number">1</span>) * pageSize
  <span class="hljs-keyword">const</span> end = start + pageSize
  <span class="hljs-comment">// åªè®©å½“å‰é¡µæ•°æ®æˆä¸ºå“åº”å¼</span>
  state.<span class="hljs-property">currentPageData</span> = state.<span class="hljs-property">allData</span>.<span class="hljs-title function_">slice</span>(start, end)
}
</code></pre>
<h3 data-id="heading-26">6.3 ä½¿ç”¨ Map/Set æ›¿ä»£å¯¹è±¡æ•°ç»„</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// âŒ ä½æ•ˆï¼šå¤§æ•°ç»„æŸ¥æ‰¾</span>
<span class="hljs-keyword">const</span> list = <span class="hljs-title function_">reactive</span>([
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">data</span>: {} },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">data</span>: {} },
  <span class="hljs-comment">// ... 10000æ¡</span>
])
<span class="hljs-comment">// æŸ¥æ‰¾éœ€è¦ O(n)</span>
<span class="hljs-keyword">const</span> item = list.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> i.<span class="hljs-property">id</span> === targetId)

<span class="hljs-comment">// âœ… é«˜æ•ˆï¼šä½¿ç”¨ Map</span>
<span class="hljs-keyword">const</span> dataMap = <span class="hljs-title function_">reactive</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>())
dataMap.<span class="hljs-title function_">set</span>(<span class="hljs-number">1</span>, { <span class="hljs-attr">data</span>: {} })
dataMap.<span class="hljs-title function_">set</span>(<span class="hljs-number">2</span>, { <span class="hljs-attr">data</span>: {} })
<span class="hljs-comment">// æŸ¥æ‰¾åªéœ€ O(1)</span>
<span class="hljs-keyword">const</span> item = dataMap.<span class="hljs-title function_">get</span>(targetId)
</code></pre>
<hr/>
<h2 data-id="heading-27">7. æ€»ç»“ä¸é¿å‘æ¸…å•</h2>
<h3 data-id="heading-28">7.1 æ ¸å¿ƒè¦ç‚¹å›é¡¾</h3>
<pre><code class="hljs">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Vue 3 åµŒå¥—æ•°æ®æ›´æ–°é¿å‘æŒ‡å—                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. è®¿é—®è·¯å¾„åŸåˆ™                                            â”‚
â”‚     â””â”€â”€ æ¨¡æ¿ä¸­å¿…é¡»è®¿é—®åˆ°ä½ è¦ä¿®æ”¹çš„æœ€æ·±å±‚å±æ€§                   â”‚
â”‚                                                             â”‚
â”‚  2. èµ‹å€¼è§¦å‘åŸåˆ™                                            â”‚
â”‚     â””â”€â”€ ç›´æ¥ä¿®æ”¹å¯¹è±¡å±æ€§å¯èƒ½ä¸è§¦å‘ï¼Œè€ƒè™‘æ•´ä½“æ›¿æ¢              â”‚
â”‚                                                             â”‚
â”‚  3. è§£æ„å±é™©                                                â”‚
â”‚     â””â”€â”€ è§£æ„ reactive å¯¹è±¡ä¼šå¤±å»å“åº”æ€§ï¼Œä½¿ç”¨ toRefs          â”‚
â”‚                                                             â”‚
â”‚  4. æ·±æ‹·è´é™·é˜±                                              â”‚
â”‚     â””â”€â”€ cloneDeep ä¼šç ´åå“åº”æ€§ï¼Œä½¿ç”¨ toRaw æˆ–æµ…æ‹·è´          â”‚
â”‚                                                             â”‚
â”‚  5. æ€§èƒ½ä¼˜åŒ–                                                â”‚
â”‚     â””â”€â”€ å¤§æ•°æ®ç”¨ shallowRef + triggerRef æ‰‹åŠ¨æ§åˆ¶            â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-29">7.2 å¿«é€Ÿå†³ç­–æµç¨‹å›¾</h3>
<pre><code class="hljs language-scss" lang="scss">é‡åˆ°åµŒå¥—æ•°æ®ä¸æ›´æ–°ï¼Ÿ
    â”‚
    â”œâ”€ æ˜¯å¦åœ¨æ¨¡æ¿ä¸­è®¿é—®äº†å®Œæ•´è·¯å¾„ï¼Ÿ
    â”‚   â”œâ”€ å¦ â†’ è¡¥å……è®¿é—®è·¯å¾„ï¼š{{ obj<span class="hljs-selector-class">.level1</span><span class="hljs-selector-class">.level2</span> }}
    â”‚   â””â”€ æ˜¯ â†’ ç»§ç»­
    â”‚
    â”œâ”€ æ˜¯å¦ä½¿ç”¨äº†æ·±æ‹·è´(cloneDeep)ï¼Ÿ
    â”‚   â”œâ”€ æ˜¯ â†’ æ¢æˆ <span class="hljs-built_in">toRaw</span>() æˆ–æµ…æ‹·è´
    â”‚   â””â”€ å¦ â†’ ç»§ç»­
    â”‚
    â”œâ”€ æ˜¯å¦è§£æ„äº† reactive å¯¹è±¡ï¼Ÿ
    â”‚   â”œâ”€ æ˜¯ â†’ ä½¿ç”¨ <span class="hljs-built_in">toRefs</span>() æˆ–é¿å…è§£æ„
    â”‚   â””â”€ å¦ â†’ ç»§ç»­
    â”‚
    â”œâ”€ æ•°æ®é‡æ˜¯å¦å¾ˆå¤§(&gt;<span class="hljs-number">1000</span>æ¡)ï¼Ÿ
    â”‚   â”œâ”€ æ˜¯ â†’ ä½¿ç”¨ shallowRef + triggerRef
    â”‚   â””â”€ å¦ â†’ ç»§ç»­
    â”‚
    â””â”€ å°è¯•å¼ºåˆ¶åˆ·æ–°ï¼š
        â”œâ”€ æ•°ç»„ï¼šarr = <span class="hljs-selector-attr">[...arr]</span>
        â”œâ”€ å¯¹è±¡ï¼šobj = { ..<span class="hljs-selector-class">.obj</span> }
        â””â”€ æˆ–ä½¿ç”¨ <span class="hljs-built_in">nextTick</span>() å»¶è¿Ÿæ›´æ–°
</code></pre>
<h3 data-id="heading-30">7.3 æ¨èå·¥å…·å‡½æ•°</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// utils/reactiveHelper.js</span>

<span class="hljs-keyword">import</span> { reactive, toRaw, isProxy } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">/**
 * å®‰å…¨åœ°æ›´æ–°åµŒå¥—å¯¹è±¡å±æ€§
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">safeUpdate</span>(<span class="hljs-params">obj, path, value</span>) {
  <span class="hljs-keyword">const</span> keys = path.<span class="hljs-title function_">split</span>(<span class="hljs-string">'.'</span>)
  <span class="hljs-keyword">let</span> current = obj
  
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; keys.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i++) {
    current = current[keys[i]]
  }
  
  current[keys[keys.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>]] = value
  
  <span class="hljs-comment">// å¦‚æœæ˜¯ reactive å¯¹è±¡ï¼Œè§¦å‘æ›´æ–°</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isProxy</span>(obj)) {
    <span class="hljs-comment">// å¼ºåˆ¶åˆ·æ–°ï¼ˆhack æ–¹å¼ï¼Œæ…ç”¨ï¼‰</span>
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(obj, obj)
  }
}

<span class="hljs-comment">/**
 * æ·±åº¦å…‹éš†ä½†ä¿æŒå“åº”æ€§ï¼ˆé€‚ç”¨äºç®€å•å¯¹è±¡ï¼‰
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">cloneReactive</span>(<span class="hljs-params">obj</span>) {
  <span class="hljs-keyword">const</span> raw = <span class="hljs-title function_">toRaw</span>(obj)
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">reactive</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(raw)))
}

<span class="hljs-comment">/**
 * æ‰¹é‡æ›´æ–°æ•°ç»„ï¼ˆå‡å°‘é‡æ¸²æŸ“ï¼‰
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">batchUpdateArray</span>(<span class="hljs-params">arr, updates</span>) {
  <span class="hljs-comment">// updates: [{ index: 0, value: newValue }, ...]</span>
  <span class="hljs-keyword">const</span> newArr = [...arr]
  updates.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">{ index, value }</span>) =&gt;</span> {
    newArr[index] = value
  })
  <span class="hljs-keyword">return</span> newArr
}
</code></pre>
<h3 data-id="heading-31">7.4 æœ€åçš„è¯</h3>
<p>Vue 3çš„å“åº”å¼ç³»ç»ŸåŸºäºProxyç¡®å®æ˜¯å·¨å¤§çš„è¿›æ­¥ï¼Œä½†å®ƒä¸æ˜¯é“¶å¼¹ã€‚ç†è§£<strong>ä¾èµ–æ”¶é›†çš„æƒ°æ€§</strong>å’Œ<strong>Proxyçš„ä»£ç†è¾¹ç•Œ</strong>ï¼Œæ˜¯é¿å…åµŒå¥—æ•°æ®æ›´æ–°é—®é¢˜çš„å…³é”®ã€‚</p>
<p>è®°ä½ï¼š<strong>å“åº”å¼ä¸æ˜¯é­”æ³•ï¼Œæ˜¯ç²¾ç¡®è¿½è¸ª</strong>ã€‚å½“ä½ æ˜ç™½Vueåœ¨ä»€ä¹ˆæ—¶æœºã€è¿½è¸ªå“ªäº›ä¾èµ–ï¼Œä½ å°±èƒ½æ¸¸åˆƒæœ‰ä½™åœ°å¤„ç†ä»»ä½•å¤æ‚çš„æ•°æ®ç»“æ„ã€‚</p>
<hr/>
<h2 data-id="heading-32">å‚è€ƒé“¾æ¥</h2>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2Fguide%2Fextras%2Freactivity-in-depth.html" target="_blank" title="https://vuejs.org/guide/extras/reactivity-in-depth.html" ref="nofollow noopener noreferrer">Vue 3 å“åº”å¼åŸç†å®˜æ–¹æ–‡æ¡£</a> - éªŒè¯çŠ¶æ€: âœ…</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2Fapi%2Freactivity-advanced.html" target="_blank" title="https://vuejs.org/api/reactivity-advanced.html" ref="nofollow noopener noreferrer">Vue 3 Reactivity API é«˜çº§ç”¨æ³•</a> - éªŒè¯çŠ¶æ€: âœ…</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvuejs%2Fcore%2Fissues%2F1387" target="_blank" title="https://github.com/vuejs/core/issues/1387" ref="nofollow noopener noreferrer">GitHub Issue #1387 - åµŒå¥—å±æ€§æ›´æ–°é—®é¢˜</a> - éªŒè¯çŠ¶æ€: âœ…</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FProxy" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy" ref="nofollow noopener noreferrer">Proxy MDN æ–‡æ¡£</a> - éªŒè¯çŠ¶æ€: âœ…</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fimmerjs.github.io%2Fimmer%2F" target="_blank" title="https://immerjs.github.io/immer/" ref="nofollow noopener noreferrer">Immer ä¸å¯å˜æ•°æ®æ›´æ–°åº“</a> - éªŒè¯çŠ¶æ€: âœ…</li>
</ol>
<p><em>å¦‚æœæœ¬æ–‡å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµæ”¶è—ï¼ä½ åœ¨ä½¿ç”¨ Vue 3 å“åº”å¼æ—¶è¿˜é‡åˆ°è¿‡å“ªäº›å‘ï¼Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ã€‚</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[@tdesign/uniapp å›¾æ ‡ç˜¦èº«]]></title>    <link>https://juejin.cn/post/7604037348607377446</link>    <guid>https://juejin.cn/post/7604037348607377446</guid>    <pubDate>2026-02-08T12:35:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604037348607377446" data-draft-id="7604037348607361062" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="@tdesign/uniapp å›¾æ ‡ç˜¦èº«"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-08T12:35:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Novlan1"/> <meta itemprop="url" content="https://juejin.cn/user/1987523605435432"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            @tdesign/uniapp å›¾æ ‡ç˜¦èº«
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1987523605435432/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Novlan1
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T12:35:53.000Z" title="Sun Feb 08 2026 12:35:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    65
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. èƒŒæ™¯</h2>
<p>éšç€ <a href="https://link.juejin.cn?target=https%3A%2F%2Ftdesign.tencent.com%2Ficons%2F" target="_blank" title="https://tdesign.tencent.com/icons/" ref="nofollow noopener noreferrer">tdesign-icons</a> å›¾æ ‡çš„ä¸æ–­ä¸°å¯Œï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencent%2Ftdesign-miniprogram%2Fblob%2Fdevelop%2Fpackages%2Funiapp-components%2Fcommon%2Fstyle%2Ficons.less" target="_blank" title="https://github.com/Tencent/tdesign-miniprogram/blob/develop/packages/uniapp-components/common/style/icons.less" ref="nofollow noopener noreferrer">@tdesign/uniapp</a> åŒ…çš„å›¾æ ‡æ–‡ä»¶å¤§å°ä¹Ÿä¸æ–­å˜å¤§ã€‚ä½†æ˜¯æ™®é€šä¸šåŠ¡ä¸€èˆ¬å¹¶ä¸éœ€è¦åŒæ—¶ä½¿ç”¨è¿™ä¹ˆå¤šå›¾æ ‡ï¼Œå¹¶ä¸”å°ç¨‹åºç­‰åœºæ™¯å›¾æ ‡åªèƒ½ä½¿ç”¨ <code>iconfont</code> ç­‰ï¼Œä¸æ”¯æŒåŠ¨æ€åŠ è½½ï¼Œæ‰€ä»¥éœ€è¦ä¸€ç§æ–¹å¼å‡åŒ…ã€ç˜¦èº«ã€‚</p>
<h2 data-id="heading-1">2. è§£å†³æ–¹æ¡ˆ</h2>
<p>ä¸åŒäºåŸç”Ÿå°ç¨‹åºï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Ftdesign.tencent.com%2Funiapp%2Foverview" target="_blank" title="https://tdesign.tencent.com/uniapp/overview" ref="nofollow noopener noreferrer">@tdesign/uniapp</a> åœ¨ä¸Šä¼ å‰æœ‰æ„å»ºä¸€æ­¥ï¼Œå¯ä»¥åˆ©ç”¨æ’ä»¶æ¥å‡åŒ…ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2F%40novlan%2Fpostcss-plugin-remove-selector%3FactiveTab%3Dreadme" target="_blank" title="https://www.npmjs.com/package/@novlan/postcss-plugin-remove-selector?activeTab=readme" ref="nofollow noopener noreferrer">postcss-plugin-remove-selector</a> æ¥åœ¨æ„å»ºæ—¶è¿›è¡Œæ— ç”¨å›¾æ ‡çš„åˆ å‡ã€‚</p>
<p>ç‚¹æ­¤æŸ¥çœ‹<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2F%40novlan%2Fpostcss-plugin-remove-selector%3FactiveTab%3Dreadme" target="_blank" title="https://www.npmjs.com/package/@novlan/postcss-plugin-remove-selector?activeTab=readme" ref="nofollow noopener noreferrer">æ–‡æ¡£</a>ã€‚</p>
<h2 data-id="heading-2">3. å¦‚ä½•ä½¿ç”¨</h2>
<p>å®‰è£…</p>
<pre><code class="hljs language-bash" lang="bash">pnpm add @novlan/postcss-plugin-remove-selector -D
</code></pre>
<h3 data-id="heading-3">3.1. ç®€åŒ–æ¨¡å¼ï¼ˆæ¨èï¼‰</h3>
<p>é€šè¿‡ <code>mode</code> æŒ‡å®šé¢„è®¾ï¼Œåªéœ€å…³æ³¨ <code>used</code>/<code>unused</code>ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½® <code>file</code> å’Œ <code>selectorPattern</code>ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;
<span class="hljs-keyword">import</span> { postcssPluginRemoveSelector } <span class="hljs-keyword">from</span> <span class="hljs-string">'@novlan/postcss-plugin-remove-selector'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">css</span>: {
    <span class="hljs-attr">postcss</span>: {
      <span class="hljs-attr">plugins</span>: [
        <span class="hljs-title function_">postcssPluginRemoveSelector</span>({
          <span class="hljs-attr">mode</span>: <span class="hljs-string">'tdesign'</span>,
          <span class="hljs-attr">used</span>: [<span class="hljs-string">'home'</span>, <span class="hljs-string">'chat'</span>, <span class="hljs-string">'user'</span>, <span class="hljs-string">'add'</span>, <span class="hljs-string">'search'</span>, <span class="hljs-string">'close'</span>],
        }),
      ],
    },
  },
});
</code></pre>
<p>ä½¿ç”¨ <code>customUsed</code> / <code>customUnused</code> å¯åœ¨é¢„è®¾åŸºç¡€ä¸Šå¢é‡è¿½åŠ ï¼Œä¸ä¼šè¦†ç›–é¢„è®¾ä¸­å·²æœ‰çš„åˆ—è¡¨ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title function_">postcssPluginRemoveSelector</span>({
  <span class="hljs-attr">mode</span>: <span class="hljs-string">'tdesign'</span>,
  <span class="hljs-comment">// åœ¨ tdesign é¢„è®¾é»˜è®¤çš„ used åˆ—è¡¨ä¸Šï¼Œé¢å¤–è¿½åŠ  'star' å’Œ 'heart'</span>
  <span class="hljs-attr">customUsed</span>: [<span class="hljs-string">'star'</span>, <span class="hljs-string">'heart'</span>],
  <span class="hljs-comment">// ä»ç»“æœä¸­é¢å¤–ç§»é™¤ 'loading'</span>
  <span class="hljs-attr">customUnused</span>: [<span class="hljs-string">'loading'</span>],
})
</code></pre>
<h3 data-id="heading-4">3.2. æ ‡å‡†æ¨¡å¼</h3>
<p>é€šè¿‡ <code>list</code> æ•°ç»„ä¼ å…¥å®Œæ•´é…ç½®ï¼Œé€‚ç”¨äºéœ€è¦åŒ¹é…å¤šä¸ªæ–‡ä»¶çš„å¤æ‚åœºæ™¯ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;
<span class="hljs-keyword">import</span> { postcssPluginRemoveSelector } <span class="hljs-keyword">from</span> <span class="hljs-string">'@novlan/postcss-plugin-remove-selector'</span>;
<span class="hljs-keyword">import</span> {
  <span class="hljs-variable constant_">TDESIGN_ICON_REMOVE_SELECTOR</span>
} <span class="hljs-keyword">from</span> <span class="hljs-string">'@novlan/postcss-plugin-remove-selector/lib/tdesign-uniapp-icon'</span>;


<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">css</span>: {
    <span class="hljs-attr">postcss</span>: {
      <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">postcssPluginRemoveSelector</span>(<span class="hljs-variable constant_">TDESIGN_ICON_REMOVE_SELECTOR</span>)],
    },
  },
});
</code></pre>
<h2 data-id="heading-5">4. ç±»å‹</h2>
<p>æ’ä»¶æ”¯æŒä¸¤ç§é…ç½®æ–¹å¼ï¼Œä¼ å…¥ <code>SimpleOptions</code>ï¼ˆç®€åŒ–æ¨¡å¼ï¼‰æˆ– <code>Options</code>ï¼ˆæ ‡å‡†æ¨¡å¼ï¼‰å‡å¯ã€‚</p>
<h3 data-id="heading-6">4.1. SimpleOptionsï¼ˆç®€åŒ–æ¨¡å¼ï¼‰</h3>



























































<table><thead><tr><th>å±æ€§</th><th>ç±»å‹</th><th>æ˜¯å¦å¿…å¡«</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>mode</code></td><td><code>'tdesign'</code></td><td>å¦</td><td>é¢„è®¾æ¨¡å¼ï¼Œè®¾ç½®åè‡ªåŠ¨ä½¿ç”¨å¯¹åº”çš„ <code>file</code> å’Œ <code>selectorPattern</code> é»˜è®¤å€¼</td></tr><tr><td><code>file</code></td><td><code>RegExp | string</code></td><td>å¦</td><td>æ–‡ä»¶åŒ¹é…è§„åˆ™ã€‚ä½¿ç”¨ <code>mode</code> æ—¶å¯çœç•¥</td></tr><tr><td><code>used</code></td><td><code>string[]</code></td><td>å¦</td><td>æ­£åœ¨ä½¿ç”¨çš„å›¾æ ‡åç§°åˆ—è¡¨ï¼Œè¿™äº›å›¾æ ‡ä¼šè¢«ä¿ç•™</td></tr><tr><td><code>unused</code></td><td><code>string[]</code></td><td>å¦</td><td>æœªä½¿ç”¨çš„å›¾æ ‡åç§°åˆ—è¡¨ï¼Œè¿™äº›å›¾æ ‡ä¼šè¢«ç§»é™¤</td></tr><tr><td><code>customUsed</code></td><td><code>string[]</code></td><td>å¦</td><td>å¢é‡è¿½åŠ åˆ° <code>used</code> åˆ—è¡¨ï¼ˆä¸è¦†ç›–é¢„è®¾æˆ–å·²æœ‰çš„ <code>used</code>ï¼‰</td></tr><tr><td><code>customUnused</code></td><td><code>string[]</code></td><td>å¦</td><td>å¢é‡è¿½åŠ åˆ° <code>unused</code> åˆ—è¡¨ï¼ˆä¸è¦†ç›–é¢„è®¾æˆ–å·²æœ‰çš„ <code>unused</code>ï¼‰</td></tr><tr><td><code>selectorPattern</code></td><td><code>RegExp</code></td><td>å¦</td><td>é€‰æ‹©å™¨åŒ¹é…æ¨¡å¼ã€‚ä½¿ç”¨ <code>mode</code> æ—¶å¯çœç•¥</td></tr><tr><td><code>debug</code></td><td><code>boolean</code></td><td>å¦</td><td>æ˜¯å¦å¼€å¯è°ƒè¯•æ¨¡å¼</td></tr></tbody></table>
<blockquote>
<p><code>mode</code> å’Œ <code>file</code> è‡³å°‘éœ€è¦æŒ‡å®šä¸€ä¸ªã€‚å½“ <code>mode</code> å’Œ <code>file</code>/<code>selectorPattern</code> åŒæ—¶æŒ‡å®šæ—¶ï¼Œ<code>file</code>/<code>selectorPattern</code> ä¼˜å…ˆã€‚</p>
</blockquote>
<h3 data-id="heading-7">4.2. Optionsï¼ˆæ ‡å‡†æ¨¡å¼ï¼‰</h3>























<table><thead><tr><th>å±æ€§</th><th>ç±»å‹</th><th>æ˜¯å¦å¿…å¡«</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>list</code></td><td><code>FileConfig[]</code></td><td>æ˜¯</td><td>é…ç½®åˆ—è¡¨</td></tr><tr><td><code>debug</code></td><td><code>boolean</code></td><td>å¦</td><td>æ˜¯å¦å¼€å¯è°ƒè¯•æ¨¡å¼</td></tr></tbody></table>
<h3 data-id="heading-8">4.3. FileConfig</h3>















































<table><thead><tr><th>å±æ€§</th><th>ç±»å‹</th><th>æ˜¯å¦å¿…å¡«</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>file</code></td><td><code>RegExp | string</code></td><td>æ˜¯</td><td>æ–‡ä»¶åŒ¹é…è§„åˆ™ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–æ­£åˆ™è¡¨è¾¾å¼</td></tr><tr><td><code>used</code></td><td><code>string[]</code></td><td>å¦</td><td>æ­£åœ¨ä½¿ç”¨çš„å›¾æ ‡åç§°åˆ—è¡¨ï¼Œè¿™äº›å›¾æ ‡ä¼šè¢«ä¿ç•™</td></tr><tr><td><code>unused</code></td><td><code>string[]</code></td><td>å¦</td><td>æœªä½¿ç”¨çš„å›¾æ ‡åç§°åˆ—è¡¨ï¼Œè¿™äº›å›¾æ ‡ä¼šè¢«ç§»é™¤</td></tr><tr><td><code>customUsed</code></td><td><code>string[]</code></td><td>å¦</td><td>å¢é‡è¿½åŠ åˆ° <code>used</code> åˆ—è¡¨ï¼ˆä¸è¦†ç›–å·²æœ‰çš„ <code>used</code>ï¼‰</td></tr><tr><td><code>customUnused</code></td><td><code>string[]</code></td><td>å¦</td><td>å¢é‡è¿½åŠ åˆ° <code>unused</code> åˆ—è¡¨ï¼ˆä¸è¦†ç›–å·²æœ‰çš„ <code>unused</code>ï¼‰</td></tr><tr><td><code>selectorPattern</code></td><td><code>RegExp</code></td><td>å¦</td><td>é€‰æ‹©å™¨åŒ¹é…æ¨¡å¼ï¼Œåªå¤„ç†åŒ¹é…è¯¥æ¨¡å¼çš„é€‰æ‹©å™¨</td></tr></tbody></table>
<h3 data-id="heading-9">4.4. å†…ç½®é¢„è®¾</h3>

















<table><thead><tr><th>mode</th><th>è¯´æ˜</th><th>é»˜è®¤ file</th><th>é»˜è®¤ selectorPattern</th></tr></thead><tbody><tr><td><code>tdesign</code></td><td>TDesign UniApp å›¾æ ‡å‡åŒ…</td><td><code>/[@/]tdesign[/]uniapp[/]dist[/]icon[/]icon\.[css|vue]/</code></td><td><code>/^\.t-icon-[\w-]+:before$/</code></td></tr></tbody></table>
<h2 data-id="heading-10">5. æ–‡æ¡£</h2>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2F%40novlan%2Fpostcss-plugin-remove-selector%3FactiveTab%3Dreadme" target="_blank" title="https://www.npmjs.com/package/@novlan/postcss-plugin-remove-selector?activeTab=readme" ref="nofollow noopener noreferrer">æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnovlan1.github.io%2Fplugins%2Fchangelog%2Fpostcss-plugin-remove-selector.html" target="_blank" title="https://novlan1.github.io/plugins/changelog/postcss-plugin-remove-selector.html" ref="nofollow noopener noreferrer">æ›´æ–°æ—¥å¿—</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTDesignOteam%2Ftdesign-uniapp-starter" target="_blank" title="https://github.com/TDesignOteam/tdesign-uniapp-starter" ref="nofollow noopener noreferrer">ç¤ºä¾‹é¡¹ç›®</a></li>
</ol>
<h2 data-id="heading-11">6. æ•ˆæœ</h2>
<p>ä»¥ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTDesignOteam%2Ftdesign-uniapp-starter" target="_blank" title="https://github.com/TDesignOteam/tdesign-uniapp-starter" ref="nofollow noopener noreferrer">tdesign-uniapp-starter</a> ä¸ºä¾‹ï¼Œä½¿ç”¨æ­¤æ’ä»¶ï¼Œå¯ä½¿å°ç¨‹åºå¤§å°å‡å°‘<code>138KB</code>ï¼Œçº¦<code>95.8%</code>ã€‚</p>
<p>ä½¿ç”¨å‰ï¼š</p>
<img src="https://cdn.uwayfly.com/article/2026/2/own_mike_4w2yXDz3tMcaJ2nx.png" width="900" alt="è½¬å­˜å¤±è´¥ï¼Œå»ºè®®ç›´æ¥ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶" loading="lazy"/>
<p>ä½¿ç”¨åï¼š</p>
<img src="https://cdn.uwayfly.com/article/2026/2/own_mike_dsdB5TmAaedmkPr5.png" width="900" alt="è½¬å­˜å¤±è´¥ï¼Œå»ºè®®ç›´æ¥ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶" loading="lazy"/>
<h2 data-id="heading-12">7. FAQ</h2>
<ol>
<li>å¦‚ä½•å¿«é€Ÿæ‹¿åˆ°ä¸šåŠ¡ä¸­ä½¿ç”¨çš„å›¾æ ‡åˆ—è¡¨</li>
</ol>
<p>å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤è·å–ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">grep -rho <span class="hljs-string">'icon="[^"]*"\|left-icon="[^"]*"\|name="[^"]*"'</span> src --include=<span class="hljs-string">"*.vue"</span> | <span class="hljs-built_in">sort</span> | <span class="hljs-built_in">uniq</span>
</code></pre>
<p>ä¸è¿‡è¿™ä¸ªå¯èƒ½ä¼šæ¼æ‰ä¸€äº›åŠ¨æ€å›¾æ ‡ï¼Œéœ€è¦æ‰‹åŠ¨æ£€æŸ¥ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Unsafeé­”æ³•ç±»æ·±åº¦è§£æï¼šJavaåº•å±‚æ“ä½œçš„ç»ˆææŒ‡å—]]></title>    <link>https://juejin.cn/post/7603688142004699145</link>    <guid>https://juejin.cn/post/7603688142004699145</guid>    <pubDate>2026-02-08T06:33:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603688142004699145" data-draft-id="7603721514203283465" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Unsafeé­”æ³•ç±»æ·±åº¦è§£æï¼šJavaåº•å±‚æ“ä½œçš„ç»ˆææŒ‡å—"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-08T06:33:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¥å¥‡å°æ±¤åœ†"/> <meta itemprop="url" content="https://juejin.cn/user/1151943919285431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Unsafeé­”æ³•ç±»æ·±åº¦è§£æï¼šJavaåº•å±‚æ“ä½œçš„ç»ˆææŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943919285431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¥å¥‡å°æ±¤åœ†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T06:33:22.000Z" title="Sun Feb 08 2026 06:33:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»23åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä»‹ç»</h2>
<p>Unsafeæ˜¯ä½äºsun.miscåŒ…ä¸‹çš„ä¸€ä¸ªç±»ï¼Œä¸»è¦æä¾›ä¸€äº›ç”¨äºæ‰§è¡Œä½çº§åˆ«ã€ä¸å®‰å…¨æ“ä½œçš„æ–¹æ³•ï¼Œå¦‚ç›´æ¥è®¿é—®ç³»ç»Ÿå†…å­˜èµ„æºã€è‡ªä¸»ç®¡ç†å†…å­˜èµ„æºç­‰ï¼Œè¿™äº›æ–¹æ³•åœ¨æå‡Javaè¿è¡Œæ•ˆç‡ã€å¢å¼ºJavaè¯­è¨€åº•å±‚èµ„æºæ“ä½œèƒ½åŠ›æ–¹é¢èµ·åˆ°äº†å¾ˆå¤§çš„ä½œç”¨ã€‚ä½†ç”±äºUnsafeç±»ä½¿Javaè¯­è¨€æ‹¥æœ‰äº†ç±»ä¼¼Cè¯­è¨€æŒ‡é’ˆä¸€æ ·æ“ä½œå†…å­˜ç©ºé—´çš„èƒ½åŠ›ï¼Œè¿™æ— ç–‘ä¹Ÿå¢åŠ äº†ç¨‹åºå‘ç”Ÿç›¸å…³æŒ‡é’ˆé—®é¢˜çš„é£é™©ã€‚åœ¨ç¨‹åºä¸­è¿‡åº¦ã€ä¸æ­£ç¡®ä½¿ç”¨Unsafeç±»ä¼šä½¿å¾—ç¨‹åºå‡ºé”™çš„æ¦‚ç‡å˜å¤§ï¼Œä½¿å¾—Javaè¿™ç§å®‰å…¨çš„è¯­è¨€å˜å¾—ä¸å†â€œå®‰å…¨â€ï¼Œå› æ­¤å¯¹Unsafeçš„ä½¿ç”¨ä¸€å®šè¦æ…é‡ã€‚</p>
<p>è¿™ä¸ªç±»å°½ç®¡é‡Œé¢çš„æ–¹æ³•éƒ½æ˜¯ public çš„ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰åŠæ³•ä½¿ç”¨å®ƒä»¬ï¼ŒJDK API æ–‡æ¡£ä¹Ÿæ²¡æœ‰æä¾›ä»»ä½•å…³äºè¿™ä¸ªç±»çš„æ–¹æ³•çš„è§£é‡Šã€‚æ€»è€Œè¨€ä¹‹ï¼Œå¯¹äº Unsafe ç±»çš„ä½¿ç”¨éƒ½æ˜¯å—é™åˆ¶çš„ï¼Œåªæœ‰æˆä¿¡çš„ä»£ç æ‰èƒ½è·å¾—è¯¥ç±»çš„å®ä¾‹ï¼Œå½“ç„¶ JDK åº“é‡Œé¢çš„ç±»æ˜¯å¯ä»¥éšæ„ä½¿ç”¨çš„ã€‚</p>
<p>å…ˆæ¥çœ‹ä¸‹è¿™å¼ å›¾ï¼Œå¯¹UnSafeç±»æ€»ä½“åŠŸèƒ½ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fseven97-blog.oss-cn-hangzhou.aliyuncs.com%2Fimgs%2F202404251040445.jpg" target="_blank" title="https://seven97-blog.oss-cn-hangzhou.aliyuncs.com/imgs/202404251040445.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af56ce01300f4528b2404ef5e07612fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771137203&amp;x-signature=FbCKApmBIzjz3cacmsUy8EKKseY%3D" alt="" loading="lazy"/></a></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒUnsafeæä¾›çš„APIå¤§è‡´å¯åˆ†ä¸ºå†…å­˜æ“ä½œã€CASã€Classç›¸å…³ã€å¯¹è±¡æ“ä½œã€çº¿ç¨‹è°ƒåº¦ã€ç³»ç»Ÿä¿¡æ¯è·å–ã€å†…å­˜å±éšœã€æ•°ç»„æ“ä½œç­‰å‡ ç±»ï¼Œä¸‹é¢å°†å¯¹å…¶ç›¸å…³æ–¹æ³•å’Œåº”ç”¨åœºæ™¯è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚</p>
<h2 data-id="heading-1">å†…å­˜æ“ä½œ</h2>
<h3 data-id="heading-2">ä»‹ç»</h3>
<p>å¦‚æœä½ æ˜¯ä¸€ä¸ªå†™è¿‡ C æˆ–è€… C++ çš„ç¨‹åºå‘˜ï¼Œä¸€å®šå¯¹å†…å­˜æ“ä½œä¸ä¼šé™Œç”Ÿï¼Œè€Œåœ¨ Java ä¸­æ˜¯ä¸å…è®¸ç›´æ¥å¯¹å†…å­˜è¿›è¡Œæ“ä½œçš„ï¼Œå¯¹è±¡å†…å­˜çš„åˆ†é…å’Œå›æ”¶éƒ½æ˜¯ç”± JVM è‡ªå·±å®ç°çš„ã€‚ä½†æ˜¯åœ¨Â <code>Unsafe</code>Â ä¸­ï¼Œæä¾›çš„ä¸‹åˆ—æ¥å£å¯ä»¥ç›´æ¥è¿›è¡Œå†…å­˜æ“ä½œï¼š</p>
<p>java</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//åˆ†é…æ–°çš„æœ¬åœ°ç©ºé—´</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-type">long</span> <span class="hljs-title function_">allocateMemory</span><span class="hljs-params">(<span class="hljs-type">long</span> bytes)</span>;
<span class="hljs-comment">//é‡æ–°è°ƒæ•´å†…å­˜ç©ºé—´çš„å¤§å°</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-type">long</span> <span class="hljs-title function_">reallocateMemory</span><span class="hljs-params">(<span class="hljs-type">long</span> address, <span class="hljs-type">long</span> bytes)</span>;
<span class="hljs-comment">//å°†å†…å­˜è®¾ç½®ä¸ºæŒ‡å®šå€¼</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMemory</span><span class="hljs-params">(Object o, <span class="hljs-type">long</span> offset, <span class="hljs-type">long</span> bytes, <span class="hljs-type">byte</span> value)</span>;
<span class="hljs-comment">//å†…å­˜æ‹·è´</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">copyMemory</span><span class="hljs-params">(Object srcBase, <span class="hljs-type">long</span> srcOffset,Object destBase, <span class="hljs-type">long</span> destOffset,<span class="hljs-type">long</span> bytes)</span>;
<span class="hljs-comment">//æ¸…é™¤å†…å­˜</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">freeMemory</span><span class="hljs-params">(<span class="hljs-type">long</span> address)</span>;
</code></pre>
<p>ä½¿ç”¨ä¸‹é¢çš„ä»£ç è¿›è¡Œæµ‹è¯•ï¼š</p>
<p>java</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">memoryTest</span>()</span> {
    <span class="hljs-built_in">int</span> size = <span class="hljs-number">4</span>;
    <span class="hljs-built_in">long</span> addr = <span class="hljs-keyword">unsafe</span>.allocateMemory(size);
    <span class="hljs-built_in">long</span> addr3 = <span class="hljs-keyword">unsafe</span>.reallocateMemory(addr, size * <span class="hljs-number">2</span>);
    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"addr: "</span>+addr);
    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"addr3: "</span>+addr3);
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">unsafe</span>.setMemory(<span class="hljs-literal">null</span>,addr ,size,(<span class="hljs-built_in">byte</span>)<span class="hljs-number">1</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) {
            <span class="hljs-keyword">unsafe</span>.copyMemory(<span class="hljs-literal">null</span>,addr,<span class="hljs-literal">null</span>,addr3+size*i,<span class="hljs-number">4</span>);
        }
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-keyword">unsafe</span>.getInt(addr));
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-keyword">unsafe</span>.getLong(addr3));
    }<span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">unsafe</span>.freeMemory(addr);
        <span class="hljs-keyword">unsafe</span>.freeMemory(addr3);
    }
}
</code></pre>
<p>å…ˆçœ‹ç»“æœè¾“å‡ºï¼š</p>
<p>plain</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">addr: 2433733895744</span>
<span class="hljs-section">addr3: 2433733894944</span>
16843009
72340172838076673
</code></pre>
<p>åˆ†æä¸€ä¸‹è¿è¡Œç»“æœï¼Œé¦–å…ˆä½¿ç”¨<code>allocateMemory</code>æ–¹æ³•ç”³è¯· 4 å­—èŠ‚é•¿åº¦çš„å†…å­˜ç©ºé—´ï¼Œè°ƒç”¨<code>setMemory</code>æ–¹æ³•å‘æ¯ä¸ªå­—èŠ‚å†™å…¥å†…å®¹ä¸º<code>byte</code>ç±»å‹çš„ 1ï¼Œå½“ä½¿ç”¨ Unsafe è°ƒç”¨<code>getInt</code>æ–¹æ³•æ—¶ï¼Œå› ä¸ºä¸€ä¸ª<code>int</code>å‹å˜é‡å  4 ä¸ªå­—èŠ‚ï¼Œä¼šä¸€æ¬¡æ€§è¯»å– 4 ä¸ªå­—èŠ‚ï¼Œç»„æˆä¸€ä¸ª<code>int</code>çš„å€¼ï¼Œå¯¹åº”çš„åè¿›åˆ¶ç»“æœä¸º 16843009ã€‚</p>
<p>ä½ å¯ä»¥é€šè¿‡ä¸‹å›¾ç†è§£è¿™ä¸ªè¿‡ç¨‹ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fseven97-blog.oss-cn-hangzhou.aliyuncs.com%2Fimgs%2F202406202130396.png" target="_blank" title="https://seven97-blog.oss-cn-hangzhou.aliyuncs.com/imgs/202406202130396.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60e61edb820240908dfef29cdca85ae7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771137203&amp;x-signature=McQsQTlSzXk3eVY8DvAFFeWA0zo%3D" alt="" loading="lazy"/></a></p>
<p>åœ¨ä»£ç ä¸­è°ƒç”¨<code>reallocateMemory</code>æ–¹æ³•é‡æ–°åˆ†é…äº†ä¸€å— 8 å­—èŠ‚é•¿åº¦çš„å†…å­˜ç©ºé—´ï¼Œé€šè¿‡æ¯”è¾ƒ<code>addr</code>å’Œ<code>addr3</code>å¯ä»¥çœ‹åˆ°å’Œä¹‹å‰ç”³è¯·çš„å†…å­˜åœ°å€æ˜¯ä¸åŒçš„ã€‚åœ¨ä»£ç ä¸­çš„ç¬¬äºŒä¸ª for å¾ªç¯é‡Œï¼Œè°ƒç”¨<code>copyMemory</code>æ–¹æ³•è¿›è¡Œäº†ä¸¤æ¬¡å†…å­˜çš„æ‹·è´ï¼Œæ¯æ¬¡æ‹·è´å†…å­˜åœ°å€<code>addr</code>å¼€å§‹çš„ 4 ä¸ªå­—èŠ‚ï¼Œåˆ†åˆ«æ‹·è´åˆ°ä»¥<code>addr3</code>å’Œ<code>addr3+4</code>å¼€å§‹çš„å†…å­˜ç©ºé—´ä¸Šï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fseven97-blog.oss-cn-hangzhou.aliyuncs.com%2Fimgs%2F202406202130404.png" target="_blank" title="https://seven97-blog.oss-cn-hangzhou.aliyuncs.com/imgs/202406202130404.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf0021cd157244e8bc4857c7ee307703~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771137203&amp;x-signature=cIfVZVovO11KHNXFn8iyfbYKmbU%3D" alt="" loading="lazy"/></a></p>
<p>æ‹·è´å®Œæˆåï¼Œä½¿ç”¨<code>getLong</code>æ–¹æ³•ä¸€æ¬¡æ€§è¯»å– 8 ä¸ªå­—èŠ‚ï¼Œå¾—åˆ°<code>long</code>ç±»å‹çš„å€¼ä¸º 72340172838076673ã€‚</p>
<p>éœ€è¦æ³¨æ„ï¼Œé€šè¿‡è¿™ç§æ–¹å¼åˆ†é…çš„å†…å­˜å±äº å †å¤–å†…å­˜ ï¼Œæ˜¯æ— æ³•è¿›è¡Œåƒåœ¾å›æ”¶çš„ï¼Œéœ€è¦æˆ‘ä»¬æŠŠè¿™äº›å†…å­˜å½“åšä¸€ç§èµ„æºå»æ‰‹åŠ¨è°ƒç”¨<code>freeMemory</code>æ–¹æ³•è¿›è¡Œé‡Šæ”¾ï¼Œå¦åˆ™ä¼šäº§ç”Ÿå†…å­˜æ³„æ¼ã€‚é€šç”¨çš„æ“ä½œå†…å­˜æ–¹å¼æ˜¯åœ¨<code>try</code>ä¸­æ‰§è¡Œå¯¹å†…å­˜çš„æ“ä½œï¼Œæœ€ç»ˆåœ¨<code>finally</code>å—ä¸­è¿›è¡Œå†…å­˜çš„é‡Šæ”¾ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å †å¤–å†…å­˜ï¼Ÿ</strong></p>
<ul>
<li>å¯¹åƒåœ¾å›æ”¶åœé¡¿çš„æ”¹å–„ã€‚ç”±äºå †å¤–å†…å­˜æ˜¯ç›´æ¥å—æ“ä½œç³»ç»Ÿç®¡ç†è€Œä¸æ˜¯ JVMï¼Œæ‰€ä»¥å½“æˆ‘ä»¬ä½¿ç”¨å †å¤–å†…å­˜æ—¶ï¼Œå³å¯ä¿æŒè¾ƒå°çš„å †å†…å†…å­˜è§„æ¨¡ã€‚ä»è€Œåœ¨ GC æ—¶å‡å°‘å›æ”¶åœé¡¿å¯¹äºåº”ç”¨çš„å½±å“ã€‚</li>
<li>æå‡ç¨‹åº I/O æ“ä½œçš„æ€§èƒ½ã€‚é€šå¸¸åœ¨ I/O é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œä¼šå­˜åœ¨å †å†…å†…å­˜åˆ°å †å¤–å†…å­˜çš„æ•°æ®æ‹·è´æ“ä½œï¼Œå¯¹äºéœ€è¦é¢‘ç¹è¿›è¡Œå†…å­˜é—´æ•°æ®æ‹·è´ä¸”ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„æš‚å­˜æ•°æ®ï¼Œéƒ½å»ºè®®å­˜å‚¨åˆ°å †å¤–å†…å­˜ã€‚</li>
</ul>
<h3 data-id="heading-3">å…¸å‹åº”ç”¨</h3>
<p><code>DirectByteBuffer</code>Â æ˜¯ Java ç”¨äºå®ç°å †å¤–å†…å­˜çš„ä¸€ä¸ªé‡è¦ç±»ï¼Œé€šå¸¸ç”¨åœ¨é€šä¿¡è¿‡ç¨‹ä¸­åšç¼“å†²æ± ï¼Œå¦‚åœ¨ Nettyã€MINA ç­‰ NIO æ¡†æ¶ä¸­åº”ç”¨å¹¿æ³›ã€‚<code>DirectByteBuffer</code>Â å¯¹äºå †å¤–å†…å­˜çš„åˆ›å»ºã€ä½¿ç”¨ã€é”€æ¯ç­‰é€»è¾‘å‡ç”± Unsafe æä¾›çš„å †å¤–å†…å­˜ API æ¥å®ç°ã€‚</p>
<p>ä¸‹å›¾ä¸ºÂ <code>DirectByteBuffer</code>Â æ„é€ å‡½æ•°ï¼Œåˆ›å»ºÂ <code>DirectByteBuffer</code>Â çš„æ—¶å€™ï¼Œé€šè¿‡Â <code>Unsafe.allocateMemory</code>Â åˆ†é…å†…å­˜ã€<code>Unsafe.setMemory</code>Â è¿›è¡Œå†…å­˜åˆå§‹åŒ–ï¼Œè€Œåæ„å»ºÂ <code>Cleaner</code>Â å¯¹è±¡ç”¨äºè·Ÿè¸ªÂ <code>DirectByteBuffer</code>Â å¯¹è±¡çš„åƒåœ¾å›æ”¶ï¼Œä»¥å®ç°å½“Â <code>DirectByteBuffer</code>Â è¢«åƒåœ¾å›æ”¶æ—¶ï¼Œåˆ†é…çš„å †å¤–å†…å­˜ä¸€èµ·è¢«é‡Šæ”¾ã€‚</p>
<p>java</p>
<pre><code class="hljs language-ini" lang="ini">DirectByteBuffer(int cap) {                   // package-private

    super(-1, 0, cap, cap)<span class="hljs-comment">;</span>
    boolean <span class="hljs-attr">pa</span> = VM.isDirectMemoryPageAligned()<span class="hljs-comment">;</span>
    int <span class="hljs-attr">ps</span> = Bits.pageSize()<span class="hljs-comment">;</span>
    long <span class="hljs-attr">size</span> = Math.max(<span class="hljs-number">1</span>L, (long)cap + (pa ? ps : <span class="hljs-number">0</span>))<span class="hljs-comment">;</span>
    Bits.reserveMemory(size, cap)<span class="hljs-comment">;</span>

    long <span class="hljs-attr">base</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
    try {
        // åˆ†é…å†…å­˜å¹¶è¿”å›åŸºåœ°å€
        <span class="hljs-attr">base</span> = unsafe.allocateMemory(size)<span class="hljs-comment">;</span>
    } catch (OutOfMemoryError x) {
        Bits.unreserveMemory(size, cap)<span class="hljs-comment">;</span>
        throw x<span class="hljs-comment">;</span>
    }
    // å†…å­˜åˆå§‹åŒ–
    unsafe.setMemory(base, size, (byte) 0)<span class="hljs-comment">;</span>
    if (pa &amp;&amp; (base % ps != 0)) {
        // Round up to page boundary
        <span class="hljs-attr">address</span> = base + ps - (base &amp; (ps - <span class="hljs-number">1</span>))<span class="hljs-comment">;</span>
    } else {
        <span class="hljs-attr">address</span> = base<span class="hljs-comment">;</span>
    }
    // è·Ÿè¸ª DirectByteBuffer å¯¹è±¡çš„åƒåœ¾å›æ”¶ï¼Œä»¥å®ç°å †å¤–å†…å­˜é‡Šæ”¾
    <span class="hljs-attr">cleaner</span> = Cleaner.create(this, new Deallocator(base, size, cap))<span class="hljs-comment">;</span>
    <span class="hljs-attr">att</span> = null<span class="hljs-comment">;</span>
}
</code></pre>
<h2 data-id="heading-4">å†…å­˜å±éšœ</h2>
<h3 data-id="heading-5">ä»‹ç»</h3>
<p>åœ¨ä»‹ç»å†…å­˜å±éšœå‰ï¼Œéœ€è¦çŸ¥é“ç¼–è¯‘å™¨å’Œ CPU ä¼šåœ¨ä¿è¯ç¨‹åºè¾“å‡ºç»“æœä¸€è‡´çš„æƒ…å†µä¸‹ï¼Œä¼šå¯¹ä»£ç è¿›è¡Œé‡æ’åºï¼Œä»æŒ‡ä»¤ä¼˜åŒ–è§’åº¦æå‡æ€§èƒ½ã€‚è€ŒæŒ‡ä»¤é‡æ’åºå¯èƒ½ä¼šå¸¦æ¥ä¸€ä¸ªä¸å¥½çš„ç»“æœï¼Œå¯¼è‡´ CPU çš„é«˜é€Ÿç¼“å­˜å’Œå†…å­˜ä¸­æ•°æ®çš„ä¸ä¸€è‡´ï¼Œè€Œå†…å­˜å±éšœï¼ˆ<code>Memory Barrier</code>ï¼‰å°±æ˜¯é€šè¿‡é˜»æ­¢å±éšœä¸¤è¾¹çš„æŒ‡ä»¤é‡æ’åºä»è€Œé¿å…ç¼–è¯‘å™¨å’Œç¡¬ä»¶çš„ä¸æ­£ç¡®ä¼˜åŒ–æƒ…å†µã€‚</p>
<p>åœ¨ç¡¬ä»¶å±‚é¢ä¸Šï¼Œå†…å­˜å±éšœæ˜¯ CPU ä¸ºäº†é˜²æ­¢ä»£ç è¿›è¡Œé‡æ’åºè€Œæä¾›çš„æŒ‡ä»¤ï¼Œä¸åŒçš„ç¡¬ä»¶å¹³å°ä¸Šå®ç°å†…å­˜å±éšœçš„æ–¹æ³•å¯èƒ½å¹¶ä¸ç›¸åŒã€‚åœ¨ Java8 ä¸­ï¼Œå¼•å…¥äº† 3 ä¸ªå†…å­˜å±éšœçš„å‡½æ•°ï¼Œå®ƒå±è”½äº†æ“ä½œç³»ç»Ÿåº•å±‚çš„å·®å¼‚ï¼Œå…è®¸åœ¨ä»£ç ä¸­å®šä¹‰ã€å¹¶ç»Ÿä¸€ç”± JVM æ¥ç”Ÿæˆå†…å­˜å±éšœæŒ‡ä»¤ï¼Œæ¥å®ç°å†…å­˜å±éšœçš„åŠŸèƒ½ã€‚</p>
<p><code>Unsafe</code>Â ä¸­æä¾›äº†ä¸‹é¢ä¸‰ä¸ªå†…å­˜å±éšœç›¸å…³æ–¹æ³•ï¼š</p>
<p>java</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">//å†…å­˜å±éšœï¼Œç¦æ­¢loadæ“ä½œé‡æ’åºã€‚å±éšœå‰çš„loadæ“ä½œä¸èƒ½è¢«é‡æ’åºåˆ°å±éšœåï¼Œå±éšœåçš„loadæ“ä½œä¸èƒ½è¢«é‡æ’åºåˆ°å±éšœå‰</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> native <span class="hljs-keyword">void</span> <span class="hljs-title">loadFence</span>()</span>;
<span class="hljs-comment">//å†…å­˜å±éšœï¼Œç¦æ­¢storeæ“ä½œé‡æ’åºã€‚å±éšœå‰çš„storeæ“ä½œä¸èƒ½è¢«é‡æ’åºåˆ°å±éšœåï¼Œå±éšœåçš„storeæ“ä½œä¸èƒ½è¢«é‡æ’åºåˆ°å±éšœå‰</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> native <span class="hljs-keyword">void</span> <span class="hljs-title">storeFence</span>()</span>;
<span class="hljs-comment">//å†…å­˜å±éšœï¼Œç¦æ­¢loadã€storeæ“ä½œé‡æ’åº</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> native <span class="hljs-keyword">void</span> <span class="hljs-title">fullFence</span>()</span>;
</code></pre>
<p>å†…å­˜å±éšœå¯ä»¥çœ‹åšå¯¹å†…å­˜éšæœºè®¿é—®çš„æ“ä½œä¸­çš„ä¸€ä¸ªåŒæ­¥ç‚¹ï¼Œä½¿å¾—æ­¤ç‚¹ä¹‹å‰çš„æ‰€æœ‰è¯»å†™æ“ä½œéƒ½æ‰§è¡Œåæ‰å¯ä»¥å¼€å§‹æ‰§è¡Œæ­¤ç‚¹ä¹‹åçš„æ“ä½œã€‚ä»¥<code>loadFence</code>æ–¹æ³•ä¸ºä¾‹ï¼Œå®ƒä¼šç¦æ­¢è¯»æ“ä½œé‡æ’åºï¼Œä¿è¯åœ¨è¿™ä¸ªå±éšœä¹‹å‰çš„æ‰€æœ‰è¯»æ“ä½œéƒ½å·²ç»å®Œæˆï¼Œå¹¶ä¸”å°†ç¼“å­˜æ•°æ®è®¾ä¸ºæ— æ•ˆï¼Œé‡æ–°ä»ä¸»å­˜ä¸­è¿›è¡ŒåŠ è½½ã€‚</p>
<p>çœ‹åˆ°è¿™ä¼°è®¡å¾ˆå¤šå°ä¼™ä¼´ä»¬ä¼šæƒ³åˆ°<code>volatile</code>å…³é”®å­—äº†ï¼Œå¦‚æœåœ¨å­—æ®µä¸Šæ·»åŠ äº†<code>volatile</code>å…³é”®å­—ï¼Œå°±èƒ½å¤Ÿå®ç°å­—æ®µåœ¨å¤šçº¿ç¨‹ä¸‹çš„å¯è§æ€§ã€‚åŸºäºè¯»å†…å­˜å±éšœï¼Œæˆ‘ä»¬ä¹Ÿèƒ½å®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚ä¸‹é¢å®šä¹‰ä¸€ä¸ªçº¿ç¨‹æ–¹æ³•ï¼Œåœ¨çº¿ç¨‹ä¸­å»ä¿®æ”¹<code>flag</code>æ ‡å¿—ä½ï¼Œæ³¨æ„è¿™é‡Œçš„<code>flag</code>æ˜¯æ²¡æœ‰è¢«<code>volatile</code>ä¿®é¥°çš„ï¼š</p>
<p>java</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Getter</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ChangeThread</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span>{
    <span class="hljs-comment">/**volatile**/</span> <span class="hljs-built_in">boolean</span> flag=<span class="hljs-literal">false</span>;
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-title class_">Thread</span>.<span class="hljs-title function_">sleep</span>(<span class="hljs-number">3000</span>);
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">InterruptedException</span> e) {
            e.<span class="hljs-title function_">printStackTrace</span>();
        }
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"subThread change flag to:"</span> + flag);
        flag = <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<p>åœ¨ä¸»çº¿ç¨‹çš„<code>while</code>å¾ªç¯ä¸­ï¼ŒåŠ å…¥å†…å­˜å±éšœï¼Œæµ‹è¯•æ˜¯å¦èƒ½å¤Ÿæ„ŸçŸ¥åˆ°<code>flag</code>çš„ä¿®æ”¹å˜åŒ–ï¼š</p>
<p>java</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span>{
    ChangeThread changeThread = <span class="hljs-keyword">new</span> ChangeThread();
    <span class="hljs-keyword">new</span> Thread(changeThread).start();
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        boolean flag = changeThread.isFlag();
        <span class="hljs-keyword">unsafe</span>.loadFence(); <span class="hljs-comment">//åŠ å…¥è¯»å†…å­˜å±éšœ</span>
        <span class="hljs-keyword">if</span> (flag){
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"detected flag changed"</span>);
            <span class="hljs-keyword">break</span>;
        }
    }
    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"main thread end"</span>);
}
</code></pre>
<p>è¿è¡Œç»“æœï¼š</p>
<p>plain</p>
<pre><code class="hljs language-arduino" lang="arduino">subThread change flag to:<span class="hljs-literal">false</span>
detected flag changed
main thread end
</code></pre>
<p>è€Œå¦‚æœåˆ æ‰ä¸Šé¢ä»£ç ä¸­çš„<code>loadFence</code>æ–¹æ³•ï¼Œé‚£ä¹ˆä¸»çº¿ç¨‹å°†æ— æ³•æ„ŸçŸ¥åˆ°<code>flag</code>å‘ç”Ÿçš„å˜åŒ–ï¼Œä¼šä¸€ç›´åœ¨<code>while</code>ä¸­å¾ªç¯ã€‚å¯ä»¥ç”¨å›¾æ¥è¡¨ç¤ºä¸Šé¢çš„è¿‡ç¨‹ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fp0-xtjj-private.juejin.cn%2Ftos-cn-i-73owjymdk6%2Ff320a294eacd4789a072b1f71e541406~tplv-73owjymdk6-jj-mark-v1%3A0%3A0%3A0%3A0%3A5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG%3Aq75.awebp%3Fpolicy%3DeyJ2bSI6MywidWlkIjoiMTE1MTk0MzkxOTI4NTQzMSJ9%26rk3s%3De9ecf3d6%26x-orig-authkey%3Df32326d3454f2ac7e96d3d06cdbb035152127018%26x-orig-expires%3D1770618790%26x-orig-sign%3DdYNDmbPY7ht9OLvDS82flYbnOis%253D" target="_blank" title="https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/f320a294eacd4789a072b1f71e541406~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMTE1MTk0MzkxOTI4NTQzMSJ9&amp;rk3s=e9ecf3d6&amp;x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&amp;x-orig-expires=1770618790&amp;x-orig-sign=dYNDmbPY7ht9OLvDS82flYbnOis%3D" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fba0241f9bb84ff29959034d18ae368e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771137203&amp;x-signature=nxiCNFJoxs6yyGp8MgE%2FB66dFiA%3D" alt="" loading="lazy"/></a></p>
<p>äº†è§£ Java å†…å­˜æ¨¡å‹ï¼ˆ<code>JMM</code>ï¼‰çš„å°ä¼™ä¼´ä»¬åº”è¯¥æ¸…æ¥šï¼Œè¿è¡Œä¸­çš„çº¿ç¨‹ä¸æ˜¯ç›´æ¥è¯»å–ä¸»å†…å­˜ä¸­çš„å˜é‡çš„ï¼Œåªèƒ½æ“ä½œè‡ªå·±å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œç„¶ååŒæ­¥åˆ°ä¸»å†…å­˜ä¸­ï¼Œå¹¶ä¸”çº¿ç¨‹çš„å·¥ä½œå†…å­˜æ˜¯ä¸èƒ½å…±äº«çš„ã€‚ä¸Šé¢çš„å›¾ä¸­çš„æµç¨‹å°±æ˜¯å­çº¿ç¨‹å€ŸåŠ©äºä¸»å†…å­˜ï¼Œå°†ä¿®æ”¹åçš„ç»“æœåŒæ­¥ç»™äº†ä¸»çº¿ç¨‹ï¼Œè¿›è€Œä¿®æ”¹ä¸»çº¿ç¨‹ä¸­çš„å·¥ä½œç©ºé—´ï¼Œè·³å‡ºå¾ªç¯ã€‚</p>
<h3 data-id="heading-6">å…¸å‹åº”ç”¨</h3>
<p>åœ¨ Java 8 ä¸­å¼•å…¥äº†ä¸€ç§é”çš„æ–°æœºåˆ¶â€”â€”<code>StampedLock</code>ï¼Œå®ƒå¯ä»¥çœ‹æˆæ˜¯è¯»å†™é”çš„ä¸€ä¸ªæ”¹è¿›ç‰ˆæœ¬ã€‚<code>StampedLock</code>Â æä¾›äº†ä¸€ç§ä¹è§‚è¯»é”çš„å®ç°ï¼Œè¿™ç§ä¹è§‚è¯»é”ç±»ä¼¼äºæ— é”çš„æ“ä½œï¼Œå®Œå…¨ä¸ä¼šé˜»å¡å†™çº¿ç¨‹è·å–å†™é”ï¼Œä»è€Œç¼“è§£è¯»å¤šå†™å°‘æ—¶å†™çº¿ç¨‹â€œé¥¥é¥¿â€ç°è±¡ã€‚ç”±äºÂ <code>StampedLock</code>Â æä¾›çš„ä¹è§‚è¯»é”ä¸é˜»å¡å†™çº¿ç¨‹è·å–è¯»é”ï¼Œå½“çº¿ç¨‹å…±äº«å˜é‡ä»ä¸»å†…å­˜ load åˆ°çº¿ç¨‹å·¥ä½œå†…å­˜æ—¶ï¼Œä¼šå­˜åœ¨æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ<code>StampedLock</code>Â çš„Â <code>validate</code>Â æ–¹æ³•ä¼šé€šè¿‡Â <code>Unsafe</code>Â çš„Â <code>loadFence</code>Â æ–¹æ³•åŠ å…¥ä¸€ä¸ªÂ <code>load</code>Â å†…å­˜å±éšœã€‚</p>
<p>java</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title">validate</span><span class="hljs-params">(<span class="hljs-type">long</span> stamp)</span> </span>{
   U.<span class="hljs-built_in">loadFence</span>();
   <span class="hljs-keyword">return</span> (stamp &amp; SBITS) == (state &amp; SBITS);
}
</code></pre>
<h2 data-id="heading-7">å¯¹è±¡æ“ä½œ</h2>
<h3 data-id="heading-8">ä»‹ç»</h3>
<p><strong>ä¾‹å­</strong></p>
<p>java</p>
<pre><code class="hljs language-csharp" lang="csharp">import sun.misc.Unsafe;
import java.lang.reflect.Field;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> <span class="hljs-keyword">value</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>) throws Exception</span>{
        Unsafe <span class="hljs-keyword">unsafe</span> = reflectGetUnsafe();
        assert <span class="hljs-keyword">unsafe</span> != <span class="hljs-literal">null</span>;
        <span class="hljs-built_in">long</span> offset = <span class="hljs-keyword">unsafe</span>.objectFieldOffset(Main.<span class="hljs-keyword">class</span>.getDeclaredField(<span class="hljs-string">"value"</span>));
        Main main = <span class="hljs-keyword">new</span> Main();
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"value before putInt: "</span> + main.<span class="hljs-keyword">value</span>);
        <span class="hljs-keyword">unsafe</span>.putInt(main, offset, <span class="hljs-number">42</span>);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"value after putInt: "</span> + main.<span class="hljs-keyword">value</span>);
  System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"value after putInt: "</span> + <span class="hljs-keyword">unsafe</span>.getInt(main, offset));
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Unsafe <span class="hljs-title">reflectGetUnsafe</span>()</span> {
        <span class="hljs-keyword">try</span> {
            Field field = Unsafe.<span class="hljs-keyword">class</span>.getDeclaredField(<span class="hljs-string">"theUnsafe"</span>);
            field.setAccessible(<span class="hljs-literal">true</span>);
            <span class="hljs-keyword">return</span> (Unsafe) field.<span class="hljs-keyword">get</span>(<span class="hljs-literal">null</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
    }

}
</code></pre>
<p>è¾“å‡ºç»“æœï¼š</p>
<p>plain</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">value before putInt:</span> <span class="hljs-number">0</span>
<span class="hljs-attr">value after putInt:</span> <span class="hljs-number">42</span>
<span class="hljs-attr">value after putInt:</span> <span class="hljs-number">42</span>
</code></pre>
<p><strong>å¯¹è±¡å±æ€§</strong></p>
<p>å¯¹è±¡æˆå‘˜å±æ€§çš„å†…å­˜åç§»é‡è·å–ï¼Œä»¥åŠå­—æ®µå±æ€§å€¼çš„ä¿®æ”¹ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­æˆ‘ä»¬å·²ç»æµ‹è¯•è¿‡äº†ã€‚é™¤äº†å‰é¢çš„<code>putInt</code>ã€<code>getInt</code>æ–¹æ³•å¤–ï¼ŒUnsafe æä¾›äº†å…¨éƒ¨ 8 ç§åŸºç¡€æ•°æ®ç±»å‹ä»¥åŠ<code>Object</code>çš„<code>put</code>å’Œ<code>get</code>æ–¹æ³•ï¼Œå¹¶ä¸”æ‰€æœ‰çš„<code>put</code>æ–¹æ³•éƒ½å¯ä»¥è¶Šè¿‡è®¿é—®æƒé™ï¼Œç›´æ¥ä¿®æ”¹å†…å­˜ä¸­çš„æ•°æ®ã€‚é˜…è¯» openJDK æºç ä¸­çš„æ³¨é‡Šå‘ç°ï¼ŒåŸºç¡€æ•°æ®ç±»å‹å’Œ<code>Object</code>çš„è¯»å†™ç¨æœ‰ä¸åŒï¼ŒåŸºç¡€æ•°æ®ç±»å‹æ˜¯ç›´æ¥æ“ä½œçš„å±æ€§å€¼ï¼ˆ<code>value</code>ï¼‰ï¼Œè€Œ<code>Object</code>çš„æ“ä½œåˆ™æ˜¯åŸºäºå¼•ç”¨å€¼ï¼ˆ<code>reference value</code>ï¼‰ã€‚ä¸‹é¢æ˜¯<code>Object</code>çš„è¯»å†™æ–¹æ³•ï¼š</p>
<p>java</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//åœ¨å¯¹è±¡çš„æŒ‡å®šåç§»åœ°å€è·å–ä¸€ä¸ªå¯¹è±¡å¼•ç”¨</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> Object <span class="hljs-title function_">getObject</span><span class="hljs-params">(Object o, <span class="hljs-type">long</span> offset)</span>;
<span class="hljs-comment">//åœ¨å¯¹è±¡æŒ‡å®šåç§»åœ°å€å†™å…¥ä¸€ä¸ªå¯¹è±¡å¼•ç”¨</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">putObject</span><span class="hljs-params">(Object o, <span class="hljs-type">long</span> offset, Object x)</span>;
</code></pre>
<p>é™¤äº†å¯¹è±¡å±æ€§çš„æ™®é€šè¯»å†™å¤–ï¼Œ<code>Unsafe</code>Â è¿˜æä¾›äº†Â <strong>volatile è¯»å†™</strong>å’Œ<strong>æœ‰åºå†™å…¥</strong>æ–¹æ³•ã€‚<code>volatile</code>è¯»å†™æ–¹æ³•çš„è¦†ç›–èŒƒå›´ä¸æ™®é€šè¯»å†™ç›¸åŒï¼ŒåŒ…å«äº†å…¨éƒ¨åŸºç¡€æ•°æ®ç±»å‹å’Œ<code>Object</code>ç±»å‹ï¼Œä»¥<code>int</code>ç±»å‹ä¸ºä¾‹ï¼š</p>
<p>java</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//åœ¨å¯¹è±¡çš„æŒ‡å®šåç§»åœ°å€å¤„è¯»å–ä¸€ä¸ªintå€¼ï¼Œæ”¯æŒvolatile loadè¯­ä¹‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getIntVolatile</span><span class="hljs-params">(Object o, <span class="hljs-type">long</span> offset)</span>;
<span class="hljs-comment">//åœ¨å¯¹è±¡æŒ‡å®šåç§»åœ°å€å¤„å†™å…¥ä¸€ä¸ªintï¼Œæ”¯æŒvolatile storeè¯­ä¹‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">putIntVolatile</span><span class="hljs-params">(Object o, <span class="hljs-type">long</span> offset, <span class="hljs-type">int</span> x)</span>;
</code></pre>
<p>ç›¸å¯¹äºæ™®é€šè¯»å†™æ¥è¯´ï¼Œ<code>volatile</code>è¯»å†™å…·æœ‰æ›´é«˜çš„æˆæœ¬ï¼Œå› ä¸ºå®ƒéœ€è¦ä¿è¯å¯è§æ€§å’Œæœ‰åºæ€§ã€‚åœ¨æ‰§è¡Œ<code>get</code>æ“ä½œæ—¶ï¼Œä¼šå¼ºåˆ¶ä»ä¸»å­˜ä¸­è·å–å±æ€§å€¼ï¼Œåœ¨ä½¿ç”¨<code>put</code>æ–¹æ³•è®¾ç½®å±æ€§å€¼æ—¶ï¼Œä¼šå¼ºåˆ¶å°†å€¼æ›´æ–°åˆ°ä¸»å­˜ä¸­ï¼Œä»è€Œä¿è¯è¿™äº›å˜æ›´å¯¹å…¶ä»–çº¿ç¨‹æ˜¯å¯è§çš„ã€‚</p>
<p>æœ‰åºå†™å…¥çš„æ–¹æ³•æœ‰ä»¥ä¸‹ä¸‰ä¸ªï¼š</p>
<p>java</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">putOrderedObject</span><span class="hljs-params">(Object o, <span class="hljs-type">long</span> offset, Object x)</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">putOrderedInt</span><span class="hljs-params">(Object o, <span class="hljs-type">long</span> offset, <span class="hljs-type">int</span> x)</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">putOrderedLong</span><span class="hljs-params">(Object o, <span class="hljs-type">long</span> offset, <span class="hljs-type">long</span> x)</span>;
</code></pre>
<p>æœ‰åºå†™å…¥çš„æˆæœ¬ç›¸å¯¹<code>volatile</code>è¾ƒä½ï¼Œå› ä¸ºå®ƒåªä¿è¯å†™å…¥æ—¶çš„æœ‰åºæ€§ï¼Œè€Œä¸ä¿è¯å¯è§æ€§ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªçº¿ç¨‹å†™å…¥çš„å€¼ä¸èƒ½ä¿è¯å…¶ä»–çº¿ç¨‹ç«‹å³å¯è§ã€‚ä¸ºäº†è§£å†³è¿™é‡Œçš„å·®å¼‚æ€§ï¼Œéœ€è¦å¯¹å†…å­˜å±éšœçš„çŸ¥è¯†ç‚¹å†è¿›ä¸€æ­¥è¿›è¡Œè¡¥å……ï¼Œé¦–å…ˆéœ€è¦äº†è§£ä¸¤ä¸ªæŒ‡ä»¤çš„æ¦‚å¿µï¼š</p>
<ul>
<li><code>Load</code>ï¼šå°†ä¸»å†…å­˜ä¸­çš„æ•°æ®æ‹·è´åˆ°å¤„ç†å™¨çš„ç¼“å­˜ä¸­</li>
<li><code>Store</code>ï¼šå°†å¤„ç†å™¨ç¼“å­˜çš„æ•°æ®åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­</li>
</ul>
<p>é¡ºåºå†™å…¥ä¸<code>volatile</code>å†™å…¥çš„å·®åˆ«åœ¨äºï¼Œåœ¨é¡ºåºå†™æ—¶åŠ å…¥çš„å†…å­˜å±éšœç±»å‹ä¸º<code>StoreStore</code>ç±»å‹ï¼Œè€Œåœ¨<code>volatile</code>å†™å…¥æ—¶åŠ å…¥çš„å†…å­˜å±éšœæ˜¯<code>StoreLoad</code>ç±»å‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fseven97-blog.oss-cn-hangzhou.aliyuncs.com%2Fimgs%2F202406202130467.png" target="_blank" title="https://seven97-blog.oss-cn-hangzhou.aliyuncs.com/imgs/202406202130467.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ffdc3b0cb1944029747a07cca8f7381~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771137203&amp;x-signature=pAvU2CZVAAqKxOeTX9A%2FCZ5aJB8%3D" alt="" loading="lazy"/></a></p>
<p>åœ¨æœ‰åºå†™å…¥æ–¹æ³•ä¸­ï¼Œä½¿ç”¨çš„æ˜¯<code>StoreStore</code>å±éšœï¼Œè¯¥å±éšœç¡®ä¿<code>Store1</code>ç«‹åˆ»åˆ·æ–°æ•°æ®åˆ°å†…å­˜ï¼Œè¿™ä¸€æ“ä½œå…ˆäº<code>Store2</code>ä»¥åŠåç»­çš„å­˜å‚¨æŒ‡ä»¤æ“ä½œã€‚è€Œåœ¨<code>volatile</code>å†™å…¥ä¸­ï¼Œä½¿ç”¨çš„æ˜¯<code>StoreLoad</code>å±éšœï¼Œè¯¥å±éšœç¡®ä¿<code>Store1</code>ç«‹åˆ»åˆ·æ–°æ•°æ®åˆ°å†…å­˜ï¼Œè¿™ä¸€æ“ä½œå…ˆäº<code>Load2</code>åŠåç»­çš„è£…è½½æŒ‡ä»¤ï¼Œå¹¶ä¸”ï¼Œ<code>StoreLoad</code>å±éšœä¼šä½¿è¯¥å±éšœä¹‹å‰çš„æ‰€æœ‰å†…å­˜è®¿é—®æŒ‡ä»¤ï¼ŒåŒ…æ‹¬å­˜å‚¨æŒ‡ä»¤å’Œè®¿é—®æŒ‡ä»¤å…¨éƒ¨å®Œæˆä¹‹åï¼Œæ‰æ‰§è¡Œè¯¥å±éšœä¹‹åçš„å†…å­˜è®¿é—®æŒ‡ä»¤ã€‚</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œåœ¨ä¸Šé¢çš„ä¸‰ç±»å†™å…¥æ–¹æ³•ä¸­ï¼Œåœ¨å†™å…¥æ•ˆç‡æ–¹é¢ï¼ŒæŒ‰ç…§<code>put</code>ã€<code>putOrder</code>ã€<code>putVolatile</code>çš„é¡ºåºæ•ˆç‡é€æ¸é™ä½ã€‚</p>
<p><strong>å¯¹è±¡å®ä¾‹åŒ–</strong></p>
<p>ä½¿ç”¨Â <code>Unsafe</code>Â çš„Â <code>allocateInstance</code>Â æ–¹æ³•ï¼Œå…è®¸æˆ‘ä»¬ä½¿ç”¨éå¸¸è§„çš„æ–¹å¼è¿›è¡Œå¯¹è±¡çš„å®ä¾‹åŒ–ï¼Œé¦–å…ˆå®šä¹‰ä¸€ä¸ªå®ä½“ç±»ï¼Œå¹¶ä¸”åœ¨æ„é€ å‡½æ•°ä¸­å¯¹å…¶æˆå‘˜å˜é‡è¿›è¡Œèµ‹å€¼æ“ä½œï¼š</p>
<p>java</p>
<pre><code class="hljs language-csharp" lang="csharp">@Data
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">A</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> b;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">A</span>()</span>{
        <span class="hljs-keyword">this</span>.b =<span class="hljs-number">1</span>;
    }
}
</code></pre>
<p>åˆ†åˆ«åŸºäºæ„é€ å‡½æ•°ã€åå°„ä»¥åŠÂ <code>Unsafe</code>Â æ–¹æ³•çš„ä¸åŒæ–¹å¼åˆ›å»ºå¯¹è±¡è¿›è¡Œæ¯”è¾ƒï¼š</p>
<p>java</p>
<pre><code class="hljs language-ini" lang="ini">public void objTest() throws Exception{
    A <span class="hljs-attr">a1</span>=new A()<span class="hljs-comment">;</span>
    System.out.println(a1.getB())<span class="hljs-comment">;</span>
    A <span class="hljs-attr">a2</span> = A.class.newInstance()<span class="hljs-comment">;</span>
    System.out.println(a2.getB())<span class="hljs-comment">;</span>
    A <span class="hljs-attr">a3</span>= (A) unsafe.allocateInstance(A.class)<span class="hljs-comment">;</span>
    System.out.println(a3.getB())<span class="hljs-comment">;</span>
}
</code></pre>
<p>æ‰“å°ç»“æœåˆ†åˆ«ä¸º 1ã€1ã€0ï¼Œè¯´æ˜é€šè¿‡<code>allocateInstance</code>æ–¹æ³•åˆ›å»ºå¯¹è±¡è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè°ƒç”¨ç±»çš„æ„é€ æ–¹æ³•ã€‚ä½¿ç”¨è¿™ç§æ–¹å¼åˆ›å»ºå¯¹è±¡æ—¶ï¼Œåªç”¨åˆ°äº†<code>Class</code>å¯¹è±¡ï¼Œæ‰€ä»¥è¯´å¦‚æœæƒ³è¦è·³è¿‡å¯¹è±¡çš„åˆå§‹åŒ–é˜¶æ®µæˆ–è€…è·³è¿‡æ„é€ å™¨çš„å®‰å…¨æ£€æŸ¥ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¦‚æœå°† A ç±»çš„æ„é€ å‡½æ•°æ”¹ä¸º<code>private</code>ç±»å‹ï¼Œå°†æ— æ³•é€šè¿‡æ„é€ å‡½æ•°å’Œåå°„åˆ›å»ºå¯¹è±¡ï¼ˆå¯ä»¥é€šè¿‡æ„é€ å‡½æ•°å¯¹è±¡ setAccessible ååˆ›å»ºå¯¹è±¡ï¼‰ï¼Œä½†<code>allocateInstance</code>æ–¹æ³•ä»ç„¶æœ‰æ•ˆã€‚</p>
<h3 data-id="heading-9">å…¸å‹åº”ç”¨</h3>
<ul>
<li><strong>å¸¸è§„å¯¹è±¡å®ä¾‹åŒ–æ–¹å¼</strong>ï¼šæˆ‘ä»¬é€šå¸¸æ‰€ç”¨åˆ°çš„åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ï¼Œä»æœ¬è´¨ä¸Šæ¥è®²ï¼Œéƒ½æ˜¯é€šè¿‡ new æœºåˆ¶æ¥å®ç°å¯¹è±¡çš„åˆ›å»ºã€‚ä½†æ˜¯ï¼Œnew æœºåˆ¶æœ‰ä¸ªç‰¹ç‚¹å°±æ˜¯å½“ç±»åªæä¾›æœ‰å‚çš„æ„é€ å‡½æ•°ä¸”æ— æ˜¾ç¤ºå£°æ˜æ— å‚æ„é€ å‡½æ•°æ—¶ï¼Œåˆ™å¿…é¡»ä½¿ç”¨æœ‰å‚æ„é€ å‡½æ•°è¿›è¡Œå¯¹è±¡æ„é€ ï¼Œè€Œä½¿ç”¨æœ‰å‚æ„é€ å‡½æ•°æ—¶ï¼Œå¿…é¡»ä¼ é€’ç›¸åº”ä¸ªæ•°çš„å‚æ•°æ‰èƒ½å®Œæˆå¯¹è±¡å®ä¾‹åŒ–ã€‚</li>
<li><strong>éå¸¸è§„çš„å®ä¾‹åŒ–æ–¹å¼</strong>ï¼šè€Œ Unsafe ä¸­æä¾› allocateInstance æ–¹æ³•ï¼Œä»…é€šè¿‡ Class å¯¹è±¡å°±å¯ä»¥åˆ›å»ºæ­¤ç±»çš„å®ä¾‹å¯¹è±¡ï¼Œè€Œä¸”ä¸éœ€è¦è°ƒç”¨å…¶æ„é€ å‡½æ•°ã€åˆå§‹åŒ–ä»£ç ã€JVM å®‰å…¨æ£€æŸ¥ç­‰ã€‚å®ƒæŠ‘åˆ¶ä¿®é¥°ç¬¦æ£€æµ‹ï¼Œä¹Ÿå°±æ˜¯å³ä½¿æ„é€ å™¨æ˜¯ private ä¿®é¥°çš„ä¹Ÿèƒ½é€šè¿‡æ­¤æ–¹æ³•å®ä¾‹åŒ–ï¼Œåªéœ€æç±»å¯¹è±¡å³å¯åˆ›å»ºç›¸åº”çš„å¯¹è±¡ã€‚ç”±äºè¿™ç§ç‰¹æ€§ï¼ŒallocateInstance åœ¨ java.lang.invokeã€Objenesisï¼ˆæä¾›ç»•è¿‡ç±»æ„é€ å™¨çš„å¯¹è±¡ç”Ÿæˆæ–¹å¼ï¼‰ã€Gsonï¼ˆååºåˆ—åŒ–æ—¶ç”¨åˆ°ï¼‰ä¸­éƒ½æœ‰ç›¸åº”çš„åº”ç”¨ã€‚</li>
</ul>
<h2 data-id="heading-10">æ•°ç»„æ“ä½œ</h2>
<h3 data-id="heading-11">ä»‹ç»</h3>
<p><code>arrayBaseOffset</code>Â ä¸Â <code>arrayIndexScale</code>Â è¿™ä¸¤ä¸ªæ–¹æ³•é…åˆèµ·æ¥ä½¿ç”¨ï¼Œå³å¯å®šä½æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ åœ¨å†…å­˜ä¸­çš„ä½ç½®ã€‚</p>
<p>java</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//è¿”å›æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ çš„åç§»åœ°å€</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-type">int</span> <span class="hljs-title function_">arrayBaseOffset</span><span class="hljs-params">(Class&lt;?&gt; arrayClass)</span>;
<span class="hljs-comment">//è¿”å›æ•°ç»„ä¸­ä¸€ä¸ªå…ƒç´ å ç”¨çš„å¤§å°</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-type">int</span> <span class="hljs-title function_">arrayIndexScale</span><span class="hljs-params">(Class&lt;?&gt; arrayClass)</span>;
</code></pre>
<h3 data-id="heading-12">å…¸å‹åº”ç”¨</h3>
<p>è¿™ä¸¤ä¸ªä¸æ•°æ®æ“ä½œç›¸å…³çš„æ–¹æ³•ï¼Œåœ¨Â <code>java.util.concurrent.atomic</code>Â åŒ…ä¸‹çš„Â <code>AtomicIntegerArray</code>ï¼ˆå¯ä»¥å®ç°å¯¹Â <code>Integer</code>Â æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ çš„åŸå­æ€§æ“ä½œï¼‰ä¸­æœ‰å…¸å‹çš„åº”ç”¨ï¼Œå¦‚ä¸‹å›¾Â <code>AtomicIntegerArray</code>Â æºç æ‰€ç¤ºï¼Œé€šè¿‡Â <code>Unsafe</code>Â çš„Â <code>arrayBaseOffset</code>ã€<code>arrayIndexScale</code>Â åˆ†åˆ«è·å–æ•°ç»„é¦–å…ƒç´ çš„åç§»åœ°å€Â <code>base</code>Â åŠå•ä¸ªå…ƒç´ å¤§å°å› å­Â <code>scale</code>Â ã€‚åç»­ç›¸å…³åŸå­æ€§æ“ä½œï¼Œå‡ä¾èµ–äºè¿™ä¸¤ä¸ªå€¼è¿›è¡Œæ•°ç»„ä¸­å…ƒç´ çš„å®šä½ï¼Œå¦‚ä¸‹å›¾äºŒæ‰€ç¤ºçš„Â <code>getAndAdd</code>Â æ–¹æ³•å³é€šè¿‡Â <code>checkedByteOffset</code>Â æ–¹æ³•è·å–æŸæ•°ç»„å…ƒç´ çš„åç§»åœ°å€ï¼Œè€Œåé€šè¿‡ CAS å®ç°åŸå­æ€§æ“ä½œã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fseven97-blog.oss-cn-hangzhou.aliyuncs.com%2Fimgs%2F202406202130522.png" target="_blank" title="https://seven97-blog.oss-cn-hangzhou.aliyuncs.com/imgs/202406202130522.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e11d8699d0e348dab3f81b341301441c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771137203&amp;x-signature=wEVeqZomJ856PftogdC%2FATMiFJw%3D" alt="" loading="lazy"/></a></p>
<h2 data-id="heading-13">CAS æ“ä½œ</h2>
<h3 data-id="heading-14">ä»‹ç»</h3>
<p>è¿™éƒ¨åˆ†ä¸»è¦ä¸º CAS ç›¸å…³æ“ä½œçš„æ–¹æ³•ã€‚</p>
<p>java</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
  *  CAS
  * <span class="hljs-doctag">@param</span> o         åŒ…å«è¦ä¿®æ”¹fieldçš„å¯¹è±¡
  * <span class="hljs-doctag">@param</span> offset    å¯¹è±¡ä¸­æŸfieldçš„åç§»é‡
  * <span class="hljs-doctag">@param</span> expected  æœŸæœ›å€¼
  * <span class="hljs-doctag">@param</span> update    æ›´æ–°å€¼
  * <span class="hljs-doctag">@return</span>          true | false
  */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">native</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">compareAndSwapObject</span><span class="hljs-params">(Object o, <span class="hljs-type">long</span> offset,  Object expected, Object update)</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">native</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">compareAndSwapInt</span><span class="hljs-params">(Object o, <span class="hljs-type">long</span> offset, <span class="hljs-type">int</span> expected,<span class="hljs-type">int</span> update)</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">native</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">compareAndSwapLong</span><span class="hljs-params">(Object o, <span class="hljs-type">long</span> offset, <span class="hljs-type">long</span> expected, <span class="hljs-type">long</span> update)</span>;
</code></pre>
<p><strong>ä»€ä¹ˆæ˜¯ CAS?</strong> Â CAS å³æ¯”è¾ƒå¹¶æ›¿æ¢ï¼ˆCompare And Swap)ï¼Œæ˜¯å®ç°å¹¶å‘ç®—æ³•æ—¶å¸¸ç”¨åˆ°çš„ä¸€ç§æŠ€æœ¯ã€‚CAS æ“ä½œåŒ…å«ä¸‰ä¸ªæ“ä½œæ•°â€”â€”å†…å­˜ä½ç½®ã€é¢„æœŸåŸå€¼åŠæ–°å€¼ã€‚æ‰§è¡Œ CAS æ“ä½œçš„æ—¶å€™ï¼Œå°†å†…å­˜ä½ç½®çš„å€¼ä¸é¢„æœŸåŸå€¼æ¯”è¾ƒï¼Œå¦‚æœç›¸åŒ¹é…ï¼Œé‚£ä¹ˆå¤„ç†å™¨ä¼šè‡ªåŠ¨å°†è¯¥ä½ç½®å€¼æ›´æ–°ä¸ºæ–°å€¼ï¼Œå¦åˆ™ï¼Œå¤„ç†å™¨ä¸åšä»»ä½•æ“ä½œã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒCAS æ˜¯ä¸€æ¡ CPU çš„åŸå­æŒ‡ä»¤ï¼ˆcmpxchg æŒ‡ä»¤ï¼‰ï¼Œä¸ä¼šé€ æˆæ‰€è°“çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼Œ<code>Unsafe</code>Â æä¾›çš„ CAS æ–¹æ³•ï¼ˆå¦‚Â <code>compareAndSwapXXX</code>ï¼‰åº•å±‚å®ç°å³ä¸º CPU æŒ‡ä»¤Â <code>cmpxchg</code>Â ã€‚</p>
<h3 data-id="heading-15">å…¸å‹åº”ç”¨</h3>
<p>åœ¨ JUC åŒ…çš„å¹¶å‘å·¥å…·ç±»ä¸­å¤§é‡åœ°ä½¿ç”¨äº† CAS æ“ä½œï¼Œåƒåœ¨å‰é¢ä»‹ç»<code>synchronized</code>å’Œ<code>AQS</code>çš„æ–‡ç« ä¸­ä¹Ÿå¤šæ¬¡æåˆ°äº† CASï¼Œå…¶ä½œä¸ºä¹è§‚é”åœ¨å¹¶å‘å·¥å…·ç±»ä¸­å¹¿æ³›å‘æŒ¥äº†ä½œç”¨ã€‚åœ¨Â <code>Unsafe</code>Â ç±»ä¸­ï¼Œæä¾›äº†<code>compareAndSwapObject</code>ã€<code>compareAndSwapInt</code>ã€<code>compareAndSwapLong</code>æ–¹æ³•æ¥å®ç°çš„å¯¹<code>Object</code>ã€<code>int</code>ã€<code>long</code>ç±»å‹çš„ CAS æ“ä½œã€‚ä»¥<code>compareAndSwapInt</code>æ–¹æ³•ä¸ºä¾‹ï¼š</p>
<p>java</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">native</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">compareAndSwapInt</span><span class="hljs-params">(Object o, <span class="hljs-type">long</span> offset,<span class="hljs-type">int</span> expected,<span class="hljs-type">int</span> x)</span>;
</code></pre>
<p>å‚æ•°ä¸­<code>o</code>ä¸ºéœ€è¦æ›´æ–°çš„å¯¹è±¡ï¼Œ<code>offset</code>æ˜¯å¯¹è±¡<code>o</code>ä¸­æ•´å½¢å­—æ®µçš„åç§»é‡ï¼Œå¦‚æœè¿™ä¸ªå­—æ®µçš„å€¼ä¸<code>expected</code>ç›¸åŒï¼Œåˆ™å°†å­—æ®µçš„å€¼è®¾ä¸º<code>x</code>è¿™ä¸ªæ–°å€¼ï¼Œå¹¶ä¸”æ­¤æ›´æ–°æ˜¯ä¸å¯è¢«ä¸­æ–­çš„ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªåŸå­æ“ä½œã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨<code>compareAndSwapInt</code>çš„ä¾‹å­ï¼š</p>
<p>java</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-built_in">int</span> a;
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span>{
    CasTest casTest=<span class="hljs-keyword">new</span> CasTest();
    <span class="hljs-keyword">new</span> Thread(()-&gt;{
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">5</span>; i++) {
            casTest.increment(i);
            System.<span class="hljs-keyword">out</span>.print(casTest.a+<span class="hljs-string">" "</span>);
        }
    }).start();
    <span class="hljs-keyword">new</span> Thread(()-&gt;{
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">5</span> ; i &lt;<span class="hljs-number">10</span> ; i++) {
            casTest.increment(i);
            System.<span class="hljs-keyword">out</span>.print(casTest.a+<span class="hljs-string">" "</span>);
        }
    }).start();
}

<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">increment</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> x</span>)</span>{
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>){
        <span class="hljs-keyword">try</span> {
            <span class="hljs-built_in">long</span> fieldOffset = <span class="hljs-keyword">unsafe</span>.objectFieldOffset(CasTest.<span class="hljs-keyword">class</span>.getDeclaredField(<span class="hljs-string">"a"</span>));
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">unsafe</span>.compareAndSwapInt(<span class="hljs-keyword">this</span>,fieldOffset,x<span class="hljs-number">-1</span>,x))
                <span class="hljs-keyword">break</span>;
        } <span class="hljs-keyword">catch</span> (NoSuchFieldException e) {
            e.printStackTrace();
        }
    }
}
</code></pre>
<p>è¿è¡Œä»£ç ä¼šä¾æ¬¡è¾“å‡ºï¼š</p>
<p>plain</p>
<pre><code class="hljs">1 2 3 4 5 6 7 8 9
</code></pre>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ä¸¤ä¸ªçº¿ç¨‹å»ä¿®æ”¹<code>int</code>å‹å±æ€§<code>a</code>çš„å€¼ï¼Œå¹¶ä¸”åªæœ‰åœ¨<code>a</code>çš„å€¼ç­‰äºä¼ å…¥çš„å‚æ•°<code>x</code>å‡ä¸€æ—¶ï¼Œæ‰ä¼šå°†<code>a</code>çš„å€¼å˜ä¸º<code>x</code>ï¼Œä¹Ÿå°±æ˜¯å®ç°å¯¹<code>a</code>çš„åŠ ä¸€çš„æ“ä½œã€‚æµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fseven97-blog.oss-cn-hangzhou.aliyuncs.com%2Fimgs%2F202406202130526.png" target="_blank" title="https://seven97-blog.oss-cn-hangzhou.aliyuncs.com/imgs/202406202130526.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab7b1c68423246038926ec5227e9cd9b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771137203&amp;x-signature=TUIiFd06QpGQRv2GUC%2FZGTUgK1M%3D" alt="" loading="lazy"/></a></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è°ƒç”¨<code>compareAndSwapInt</code>æ–¹æ³•åï¼Œä¼šç›´æ¥è¿”å›<code>true</code>æˆ–<code>false</code>çš„ä¿®æ”¹ç»“æœï¼Œå› æ­¤éœ€è¦æˆ‘ä»¬åœ¨ä»£ç ä¸­æ‰‹åŠ¨æ·»åŠ è‡ªæ—‹çš„é€»è¾‘ã€‚åœ¨<code>AtomicInteger</code>ç±»çš„è®¾è®¡ä¸­ï¼Œä¹Ÿæ˜¯é‡‡ç”¨äº†å°†<code>compareAndSwapInt</code>çš„ç»“æœä½œä¸ºå¾ªç¯æ¡ä»¶ï¼Œç›´è‡³ä¿®æ”¹æˆåŠŸæ‰é€€å‡ºæ­»å¾ªç¯çš„æ–¹å¼æ¥å®ç°çš„åŸå­æ€§çš„è‡ªå¢æ“ä½œã€‚</p>
<h2 data-id="heading-16">çº¿ç¨‹è°ƒåº¦</h2>
<h3 data-id="heading-17">ä»‹ç»</h3>
<p><code>Unsafe</code>Â ç±»ä¸­æä¾›äº†<code>park</code>ã€<code>unpark</code>ã€<code>monitorEnter</code>ã€<code>monitorExit</code>ã€<code>tryMonitorEnter</code>æ–¹æ³•è¿›è¡Œçº¿ç¨‹è°ƒåº¦ã€‚</p>
<p>java</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//å–æ¶ˆé˜»å¡çº¿ç¨‹</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unpark</span><span class="hljs-params">(Object thread)</span>;
<span class="hljs-comment">//é˜»å¡çº¿ç¨‹</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">park</span><span class="hljs-params">(<span class="hljs-type">boolean</span> isAbsolute, <span class="hljs-type">long</span> time)</span>;
<span class="hljs-comment">//è·å¾—å¯¹è±¡é”ï¼ˆå¯é‡å…¥é”ï¼‰</span>
<span class="hljs-meta">@Deprecated</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">monitorEnter</span><span class="hljs-params">(Object o)</span>;
<span class="hljs-comment">//é‡Šæ”¾å¯¹è±¡é”</span>
<span class="hljs-meta">@Deprecated</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">monitorExit</span><span class="hljs-params">(Object o)</span>;
<span class="hljs-comment">//å°è¯•è·å–å¯¹è±¡é”</span>
<span class="hljs-meta">@Deprecated</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryMonitorEnter</span><span class="hljs-params">(Object o)</span>;
</code></pre>
<p>æ–¹æ³•Â <code>park</code>ã€<code>unpark</code>Â å³å¯å®ç°çº¿ç¨‹çš„æŒ‚èµ·ä¸æ¢å¤ï¼Œå°†ä¸€ä¸ªçº¿ç¨‹è¿›è¡ŒæŒ‚èµ·æ˜¯é€šè¿‡Â <code>park</code>Â æ–¹æ³•å®ç°çš„ï¼Œè°ƒç”¨Â <code>park</code>Â æ–¹æ³•åï¼Œçº¿ç¨‹å°†ä¸€ç›´é˜»å¡ç›´åˆ°è¶…æ—¶æˆ–è€…ä¸­æ–­ç­‰æ¡ä»¶å‡ºç°ï¼›<code>unpark</code>Â å¯ä»¥ç»ˆæ­¢ä¸€ä¸ªæŒ‚èµ·çš„çº¿ç¨‹ï¼Œä½¿å…¶æ¢å¤æ­£å¸¸ã€‚</p>
<p>æ­¤å¤–ï¼Œ<code>Unsafe</code>Â æºç ä¸­<code>monitor</code>ç›¸å…³çš„ä¸‰ä¸ªæ–¹æ³•å·²ç»è¢«æ ‡è®°ä¸º<code>deprecated</code>ï¼Œä¸å»ºè®®è¢«ä½¿ç”¨ï¼š</p>
<p>java</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//è·å¾—å¯¹è±¡é”</span>
<span class="hljs-meta">@Deprecated</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">monitorEnter</span><span class="hljs-params">(Object var1)</span>;
<span class="hljs-comment">//é‡Šæ”¾å¯¹è±¡é”</span>
<span class="hljs-meta">@Deprecated</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">monitorExit</span><span class="hljs-params">(Object var1)</span>;
<span class="hljs-comment">//å°è¯•è·å¾—å¯¹è±¡é”</span>
<span class="hljs-meta">@Deprecated</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryMonitorEnter</span><span class="hljs-params">(Object var1)</span>;
</code></pre>
<p><code>monitorEnter</code>æ–¹æ³•ç”¨äºè·å¾—å¯¹è±¡é”ï¼Œ<code>monitorExit</code>ç”¨äºé‡Šæ”¾å¯¹è±¡é”ï¼Œå¦‚æœå¯¹ä¸€ä¸ªæ²¡æœ‰è¢«<code>monitorEnter</code>åŠ é”çš„å¯¹è±¡æ‰§è¡Œæ­¤æ–¹æ³•ï¼Œä¼šæŠ›å‡º<code>IllegalMonitorStateException</code>å¼‚å¸¸ã€‚<code>tryMonitorEnter</code>æ–¹æ³•å°è¯•è·å–å¯¹è±¡é”ï¼Œå¦‚æœæˆåŠŸåˆ™è¿”å›<code>true</code>ï¼Œåä¹‹è¿”å›<code>false</code>ã€‚</p>
<h3 data-id="heading-18">å…¸å‹åº”ç”¨</h3>
<p>Java é”å’ŒåŒæ­¥å™¨æ¡†æ¶çš„æ ¸å¿ƒç±»Â <code>AbstractQueuedSynchronizer</code>Â (AQS)ï¼Œå°±æ˜¯é€šè¿‡è°ƒç”¨<code>LockSupport.park()</code>å’Œ<code>LockSupport.unpark()</code>å®ç°çº¿ç¨‹çš„é˜»å¡å’Œå”¤é†’çš„ï¼Œè€ŒÂ <code>LockSupport</code>Â çš„Â <code>park</code>ã€<code>unpark</code>Â æ–¹æ³•å®é™…æ˜¯è°ƒç”¨Â <code>Unsafe</code>Â çš„Â <code>park</code>ã€<code>unpark</code>Â æ–¹å¼å®ç°çš„ã€‚</p>
<p>java</p>
<pre><code class="hljs language-scss" lang="scss">public static void <span class="hljs-built_in">park</span>(Object blocker) {
    Thread t = Thread<span class="hljs-selector-class">.currentThread</span>();
    <span class="hljs-built_in">setBlocker</span>(t, blocker);
    UNSAFE<span class="hljs-selector-class">.park</span>(false, <span class="hljs-number">0</span>L);
    <span class="hljs-built_in">setBlocker</span>(t, null);
}
public static void <span class="hljs-built_in">unpark</span>(Thread thread) {
    if (thread != null)
        UNSAFE<span class="hljs-selector-class">.unpark</span>(thread);
}
</code></pre>
<p><code>LockSupport</code>Â çš„<code>park</code>æ–¹æ³•è°ƒç”¨äº†Â <code>Unsafe</code>Â çš„<code>park</code>æ–¹æ³•æ¥é˜»å¡å½“å‰çº¿ç¨‹ï¼Œæ­¤æ–¹æ³•å°†çº¿ç¨‹é˜»å¡åå°±ä¸ä¼šç»§ç»­å¾€åæ‰§è¡Œï¼Œç›´åˆ°æœ‰å…¶ä»–çº¿ç¨‹è°ƒç”¨<code>unpark</code>æ–¹æ³•å”¤é†’å½“å‰çº¿ç¨‹ã€‚ä¸‹é¢çš„ä¾‹å­å¯¹Â <code>Unsafe</code>Â çš„è¿™ä¸¤ä¸ªæ–¹æ³•è¿›è¡Œæµ‹è¯•ï¼š</p>
<p>java</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> {
    Thread mainThread = Thread.currentThread();
    <span class="hljs-keyword">new</span> Thread(()-&gt;{
        <span class="hljs-keyword">try</span> {
            TimeUnit.SECONDS.sleep(<span class="hljs-number">5</span>);
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"subThread try to unpark mainThread"</span>);
            <span class="hljs-keyword">unsafe</span>.unpark(mainThread);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
    }).start();

    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"park main mainThread"</span>);
    <span class="hljs-keyword">unsafe</span>.park(<span class="hljs-literal">false</span>,<span class="hljs-number">0L</span>);
    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"unpark mainThread success"</span>);
}
</code></pre>
<p>ç¨‹åºè¾“å‡ºä¸ºï¼š</p>
<p>plain</p>
<pre><code class="hljs language-css" lang="css">park <span class="hljs-selector-tag">main</span> mainThread
subThread try <span class="hljs-selector-tag">to</span> unpark mainThread
unpark mainThread success
</code></pre>
<p>ç¨‹åºè¿è¡Œçš„æµç¨‹ä¹Ÿæ¯”è¾ƒå®¹æ˜“çœ‹æ‡‚ï¼Œå­çº¿ç¨‹å¼€å§‹è¿è¡Œåå…ˆè¿›è¡Œç¡çœ ï¼Œç¡®ä¿ä¸»çº¿ç¨‹èƒ½å¤Ÿè°ƒç”¨<code>park</code>æ–¹æ³•é˜»å¡è‡ªå·±ï¼Œå­çº¿ç¨‹åœ¨ç¡çœ  5 ç§’åï¼Œè°ƒç”¨<code>unpark</code>æ–¹æ³•å”¤é†’ä¸»çº¿ç¨‹ï¼Œä½¿ä¸»çº¿ç¨‹èƒ½ç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚æ•´ä¸ªæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fseven97-blog.oss-cn-hangzhou.aliyuncs.com%2Fimgs%2F202406202130484.png" target="_blank" title="https://seven97-blog.oss-cn-hangzhou.aliyuncs.com/imgs/202406202130484.png" ref="nofollow noopener noreferrer"><img src="https://seven97-blog.oss-cn-hangzhou.aliyuncs.com/imgs/202406202130484.png" alt="" loading="lazy"/></a></p>
<h2 data-id="heading-19">Class æ“ä½œ</h2>
<h3 data-id="heading-20">ä»‹ç»</h3>
<p><code>Unsafe</code>Â å¯¹<code>Class</code>çš„ç›¸å…³æ“ä½œä¸»è¦åŒ…æ‹¬ç±»åŠ è½½å’Œé™æ€å˜é‡çš„æ“ä½œæ–¹æ³•ã€‚</p>
<p><strong>é™æ€å±æ€§è¯»å–ç›¸å…³çš„æ–¹æ³•</strong></p>
<p>java</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//è·å–é™æ€å±æ€§çš„åç§»é‡</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-type">long</span> <span class="hljs-title function_">staticFieldOffset</span><span class="hljs-params">(Field f)</span>;
<span class="hljs-comment">//è·å–é™æ€å±æ€§çš„å¯¹è±¡æŒ‡é’ˆ</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> Object <span class="hljs-title function_">staticFieldBase</span><span class="hljs-params">(Field f)</span>;
<span class="hljs-comment">//åˆ¤æ–­ç±»æ˜¯å¦éœ€è¦åˆå§‹åŒ–ï¼ˆç”¨äºè·å–ç±»çš„é™æ€å±æ€§å‰è¿›è¡Œæ£€æµ‹ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">shouldBeInitialized</span><span class="hljs-params">(Class&lt;?&gt; c)</span>;
</code></pre>
<p>åˆ›å»ºä¸€ä¸ªåŒ…å«é™æ€å±æ€§çš„ç±»ï¼Œè¿›è¡Œæµ‹è¯•ï¼š</p>
<p>java</p>
<pre><code class="hljs language-csharp" lang="csharp">@Data
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">User</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String name=<span class="hljs-string">"Hydra"</span>;
    <span class="hljs-built_in">int</span> age;
}
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">staticTest</span>() throws Exception</span> {
    User user=<span class="hljs-keyword">new</span> User();
    <span class="hljs-comment">// ä¹Ÿå¯ä»¥ç”¨ä¸‹é¢çš„è¯­å¥è§¦å‘ç±»åˆå§‹åŒ–</span>
    <span class="hljs-comment">// 1.</span>
    <span class="hljs-comment">// unsafe.ensureClassInitialized(User.class);</span>
    <span class="hljs-comment">// 2.</span>
    <span class="hljs-comment">// System.out.println(User.name);</span>
    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-keyword">unsafe</span>.shouldBeInitialized(User.<span class="hljs-keyword">class</span>));
    Field sexField = User.<span class="hljs-keyword">class</span>.getDeclaredField(<span class="hljs-string">"name"</span>);
    <span class="hljs-built_in">long</span> fieldOffset = <span class="hljs-keyword">unsafe</span>.staticFieldOffset(sexField);
    Object fieldBase = <span class="hljs-keyword">unsafe</span>.staticFieldBase(sexField);
    Object <span class="hljs-built_in">object</span> = <span class="hljs-keyword">unsafe</span>.getObject(fieldBase, fieldOffset);
    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-built_in">object</span>);
}
</code></pre>
<p>è¿è¡Œç»“æœï¼š</p>
<p>plain</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-literal">false</span>
Hydra
</code></pre>
<p>åœ¨Â <code>Unsafe</code>Â çš„å¯¹è±¡æ“ä½œä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†é€šè¿‡<code>objectFieldOffset</code>æ–¹æ³•è·å–å¯¹è±¡å±æ€§åç§»é‡å¹¶åŸºäºå®ƒå¯¹å˜é‡çš„å€¼è¿›è¡Œå­˜å–ï¼Œä½†æ˜¯å®ƒä¸é€‚ç”¨äºç±»ä¸­çš„é™æ€å±æ€§ï¼Œè¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨<code>staticFieldOffset</code>æ–¹æ³•ã€‚åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œåªæœ‰åœ¨è·å–<code>Field</code>å¯¹è±¡çš„è¿‡ç¨‹ä¸­ä¾èµ–åˆ°äº†<code>Class</code>ï¼Œè€Œè·å–é™æ€å˜é‡çš„å±æ€§æ—¶ä¸å†ä¾èµ–äº<code>Class</code>ã€‚</p>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­é¦–å…ˆåˆ›å»ºä¸€ä¸ª<code>User</code>å¯¹è±¡ï¼Œè¿™æ˜¯å› ä¸ºå¦‚æœä¸€ä¸ªç±»æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œé‚£ä¹ˆå®ƒçš„é™æ€å±æ€§ä¹Ÿä¸ä¼šè¢«åˆå§‹åŒ–ï¼Œæœ€åè·å–çš„å­—æ®µå±æ€§å°†æ˜¯<code>null</code>ã€‚æ‰€ä»¥åœ¨è·å–é™æ€å±æ€§å‰ï¼Œéœ€è¦è°ƒç”¨<code>shouldBeInitialized</code>æ–¹æ³•ï¼Œåˆ¤æ–­åœ¨è·å–å‰æ˜¯å¦éœ€è¦åˆå§‹åŒ–è¿™ä¸ªç±»ã€‚å¦‚æœåˆ é™¤åˆ›å»º User å¯¹è±¡çš„è¯­å¥ï¼Œè¿è¡Œç»“æœä¼šå˜ä¸ºï¼š</p>
<p>plain</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-literal">true</span>
<span class="hljs-literal">null</span>
</code></pre>
<p><strong>ä½¿ç”¨<code>defineClass</code>æ–¹æ³•å…è®¸ç¨‹åºåœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°åˆ›å»ºä¸€ä¸ªç±»</strong></p>
<p>java</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-keyword">public</span> native Class&lt;?&gt; <span class="hljs-title">defineClass</span><span class="hljs-params">(<span class="hljs-type">String</span> name, <span class="hljs-type">byte</span>[] b, <span class="hljs-type">int</span> off, <span class="hljs-type">int</span> len, ClassLoader loader,ProtectionDomain protectionDomain)</span></span>;
</code></pre>
<p>åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥åªä¼ å…¥å­—èŠ‚æ•°ç»„ã€èµ·å§‹å­—èŠ‚çš„ä¸‹æ ‡ä»¥åŠè¯»å–çš„å­—èŠ‚é•¿åº¦ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œç±»åŠ è½½å™¨ï¼ˆ<code>ClassLoader</code>ï¼‰å’Œä¿æŠ¤åŸŸï¼ˆ<code>ProtectionDomain</code>ï¼‰æ¥æºäºè°ƒç”¨æ­¤æ–¹æ³•çš„å®ä¾‹ã€‚ä¸‹é¢çš„ä¾‹å­ä¸­å®ç°äº†åç¼–è¯‘ç”Ÿæˆåçš„ class æ–‡ä»¶çš„åŠŸèƒ½ï¼š</p>
<p>java</p>
<pre><code class="hljs language-ini" lang="ini">private static void defineTest() {
    String <span class="hljs-attr">fileName</span>=<span class="hljs-string">"F:\workspace\unsafe-test\target\classes\com\cn\model\User.class"</span><span class="hljs-comment">;</span>
    File <span class="hljs-attr">file</span> = new File(fileName)<span class="hljs-comment">;</span>
    try(FileInputStream <span class="hljs-attr">fis</span> = new FileInputStream(file)) {
        byte<span class="hljs-section">[]</span> <span class="hljs-attr">content</span>=new byte[(int)file.length()]<span class="hljs-comment">;</span>
        fis.read(content)<span class="hljs-comment">;</span>
        Class <span class="hljs-attr">clazz</span> = unsafe.defineClass(null, content, <span class="hljs-number">0</span>, content.length, null, null)<span class="hljs-comment">;</span>
        Object <span class="hljs-attr">o</span> = clazz.newInstance()<span class="hljs-comment">;</span>
        Object <span class="hljs-attr">age</span> = clazz.getMethod(<span class="hljs-string">"getAge"</span>).invoke(o, null)<span class="hljs-comment">;</span>
        System.out.println(age)<span class="hljs-comment">;</span>
    } catch (Exception e) {
        e.printStackTrace()<span class="hljs-comment">;</span>
    }
}
</code></pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œé¦–å…ˆè¯»å–äº†ä¸€ä¸ª<code>class</code>æ–‡ä»¶å¹¶é€šè¿‡æ–‡ä»¶æµå°†å®ƒè½¬åŒ–ä¸ºå­—èŠ‚æ•°ç»„ï¼Œä¹‹åä½¿ç”¨<code>defineClass</code>æ–¹æ³•åŠ¨æ€çš„åˆ›å»ºäº†ä¸€ä¸ªç±»ï¼Œå¹¶åœ¨åç»­å®Œæˆäº†å®ƒçš„å®ä¾‹åŒ–å·¥ä½œï¼Œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¹¶ä¸”é€šè¿‡è¿™ç§æ–¹å¼åˆ›å»ºçš„ç±»ï¼Œä¼šè·³è¿‡ JVM çš„æ‰€æœ‰å®‰å…¨æ£€æŸ¥ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Foss.javaguide.cn%2Fgithub%2Fjavaguide%2Fjava%2Fbasis%2Funsafe%2Fimage-20220717145000710.png" target="_blank" title="https://oss.javaguide.cn/github/javaguide/java/basis/unsafe/image-20220717145000710.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/943b180e413f45d38624174ed73a4ebc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771137203&amp;x-signature=hsOaP0KsEp%2FGFeTEkmNIllfaG34%3D" alt="" loading="lazy"/></a></p>
<p>é™¤äº†<code>defineClass</code>æ–¹æ³•å¤–ï¼ŒUnsafe è¿˜æä¾›äº†ä¸€ä¸ª<code>defineAnonymousClass</code>æ–¹æ³•ï¼š</p>
<p>java</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">public</span> native <span class="hljs-keyword">Class</span>&lt;?&gt; defineAnonymousClass(<span class="hljs-keyword">Class</span>&lt;?&gt; hostClass, <span class="hljs-type">byte</span>[] data, <span class="hljs-type">Object</span>[] cpPatches);
</code></pre>
<p>ä½¿ç”¨è¯¥æ–¹æ³•å¯ä»¥ç”¨æ¥åŠ¨æ€çš„åˆ›å»ºä¸€ä¸ªåŒ¿åç±»ï¼Œåœ¨<code>Lambda</code>è¡¨è¾¾å¼ä¸­å°±æ˜¯ä½¿ç”¨ ASM åŠ¨æ€ç”Ÿæˆå­—èŠ‚ç ï¼Œç„¶ååˆ©ç”¨è¯¥æ–¹æ³•å®šä¹‰å®ç°ç›¸åº”çš„å‡½æ•°å¼æ¥å£çš„åŒ¿åç±»ã€‚åœ¨ JDK 15 å‘å¸ƒçš„æ–°ç‰¹æ€§ä¸­ï¼Œåœ¨éšè—ç±»ï¼ˆ<code>Hidden classes</code>ï¼‰ä¸€æ¡ä¸­ï¼ŒæŒ‡å‡ºå°†åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¼ƒç”¨Â <code>Unsafe</code>Â çš„<code>defineAnonymousClass</code>æ–¹æ³•ã€‚</p>
<h3 data-id="heading-21">å…¸å‹åº”ç”¨</h3>
<p>Lambda è¡¨è¾¾å¼å®ç°éœ€è¦ä¾èµ–Â <code>Unsafe</code>Â çš„Â <code>defineAnonymousClass</code>Â æ–¹æ³•å®šä¹‰å®ç°ç›¸åº”çš„å‡½æ•°å¼æ¥å£çš„åŒ¿åç±»ã€‚</p>
<h2 data-id="heading-22">ç³»ç»Ÿä¿¡æ¯</h2>
<h3 data-id="heading-23">ä»‹ç»</h3>
<p>è¿™éƒ¨åˆ†åŒ…å«ä¸¤ä¸ªè·å–ç³»ç»Ÿç›¸å…³ä¿¡æ¯çš„æ–¹æ³•ã€‚</p>
<p>java</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">//è¿”å›ç³»ç»ŸæŒ‡é’ˆçš„å¤§å°ã€‚è¿”å›å€¼ä¸º4ï¼ˆ32ä½ç³»ç»Ÿï¼‰æˆ– 8ï¼ˆ64ä½ç³»ç»Ÿï¼‰ã€‚</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> native <span class="hljs-built_in">int</span> <span class="hljs-title">addressSize</span>()</span>;
<span class="hljs-comment">//å†…å­˜é¡µçš„å¤§å°ï¼Œæ­¤å€¼ä¸º2çš„å¹‚æ¬¡æ–¹ã€‚</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> native <span class="hljs-built_in">int</span> <span class="hljs-title">pageSize</span>()</span>;
</code></pre>
<h3 data-id="heading-24">å…¸å‹åº”ç”¨</h3>
<p>è¿™ä¸¤ä¸ªæ–¹æ³•çš„åº”ç”¨åœºæ™¯æ¯”è¾ƒå°‘ï¼Œåœ¨<code>java.nio.Bits</code>ç±»ä¸­ï¼Œåœ¨ä½¿ç”¨<code>pageCount</code>è®¡ç®—æ‰€éœ€çš„å†…å­˜é¡µçš„æ•°é‡æ—¶ï¼Œè°ƒç”¨äº†<code>pageSize</code>æ–¹æ³•è·å–å†…å­˜é¡µçš„å¤§å°ã€‚å¦å¤–ï¼Œåœ¨ä½¿ç”¨<code>copySwapMemory</code>æ–¹æ³•æ‹·è´å†…å­˜æ—¶ï¼Œè°ƒç”¨äº†<code>addressSize</code>æ–¹æ³•ï¼Œæ£€æµ‹ 32 ä½ç³»ç»Ÿçš„æƒ…å†µã€‚</p>
<h2 data-id="heading-25">Unsafeåº•å±‚</h2>
<p>å†çœ‹çœ‹Unsafeçš„compareAndSwap æ–¹æ³•æ¥å®ç°CASæ“ä½œï¼Œå®ƒæ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œå®ç°ä½äºunsafe.cppä¸­ã€‚</p>
<p>java</p>
<pre><code class="hljs language-ini" lang="ini">UNSAFE_ENTRY(jboolean, Unsafe_CompareAndSwapInt(JNIEnv *env, jobject unsafe, jobject obj, jlong offset, jint e, jint x))
  UnsafeWrapper("Unsafe_CompareAndSwapInt")<span class="hljs-comment">;</span>
  oop <span class="hljs-attr">p</span> = JNIHandles::resolve(obj)<span class="hljs-comment">;</span>
  jint* <span class="hljs-attr">addr</span> = (jint *) index_oop_from_field_<span class="hljs-literal">off</span>set_long(p, <span class="hljs-literal">off</span>set)<span class="hljs-comment">;</span>
  return (jint)(Atomic::cmpxchg(x, addr, e)) == e<span class="hljs-comment">;</span>
UNSAFE_END
</code></pre>
<p>å¯ä»¥çœ‹åˆ°å®ƒé€šè¿‡ Atomic::cmpxchg æ¥å®ç°æ¯”è¾ƒå’Œæ›¿æ¢æ“ä½œã€‚å…¶ä¸­å‚æ•°xæ˜¯å³å°†æ›´æ–°çš„å€¼ï¼Œå‚æ•°eæ˜¯åŸå†…å­˜çš„å€¼ã€‚</p>
<p>å¦‚æœæ˜¯Linuxçš„x86ï¼ŒAtomic::cmpxchgæ–¹æ³•çš„å®ç°å¦‚ä¸‹ï¼š</p>
<p>java</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-keyword">inline</span> jint <span class="hljs-title">Atomic::cmpxchg</span> <span class="hljs-params">(jint exchange_value, <span class="hljs-keyword">volatile</span> jint* dest, jint compare_value)</span> </span>{
  <span class="hljs-type">int</span> mp = os::<span class="hljs-built_in">is_MP</span>();
  <span class="hljs-function">__asm__ <span class="hljs-title">volatile</span> <span class="hljs-params">(LOCK_IF_MP(%<span class="hljs-number">4</span>) <span class="hljs-string">"cmpxchgl %1,(%3)"</span>
                    : <span class="hljs-string">"=a"</span> (exchange_value)
                    : <span class="hljs-string">"r"</span> (exchange_value), <span class="hljs-string">"a"</span> (compare_value), <span class="hljs-string">"r"</span> (dest), <span class="hljs-string">"r"</span> (mp)
                    : <span class="hljs-string">"cc"</span>, <span class="hljs-string">"memory"</span>)</span></span>;
  <span class="hljs-keyword">return</span> exchange_value;
}
</code></pre>
<p>è€Œwindowsçš„x86çš„å®ç°å¦‚ä¸‹ï¼š</p>
<p>java</p>
<pre><code class="hljs language-scss" lang="scss">inline jint Atomic::cmpxchg (jint exchange_value, volatile jint* dest, jint compare_value) {
    int mp = os::<span class="hljs-built_in">isMP</span>(); <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦æ˜¯å¤šå¤„ç†å™¨</span>
    _asm {
        mov edx, dest
        mov ecx, exchange_value
        mov eax, compare_value
        <span class="hljs-built_in">LOCK_IF_MP</span>(mp)
        cmpxchg dword ptr <span class="hljs-selector-attr">[edx]</span>, ecx
    }
}

<span class="hljs-comment">// Adding a lock prefix to an instruction on MP machine</span>
<span class="hljs-comment">// VC++ doesn't like the lock prefix to be on a single line</span>
<span class="hljs-comment">// so we can't insert a label after the lock prefix.</span>
<span class="hljs-comment">// By emitting a lock prefix, we can define a label after it.</span>
<span class="hljs-selector-id">#define</span> <span class="hljs-built_in">LOCK_IF_MP</span>(mp) __asm cmp mp, <span class="hljs-number">0</span>  \
                       __asm je L0      \
                       __asm _emit <span class="hljs-number">0</span>xF0 \
                       __asm L0:
</code></pre>
<p>å¦‚æœæ˜¯å¤šå¤„ç†å™¨ï¼Œä¸ºcmpxchgæŒ‡ä»¤æ·»åŠ lockå‰ç¼€ã€‚åä¹‹ï¼Œå°±çœç•¥lockå‰ç¼€(å•å¤„ç†å™¨ä¼šä¸éœ€è¦lockå‰ç¼€æä¾›çš„å†…å­˜å±éšœæ•ˆæœ)ã€‚è¿™é‡Œçš„lockå‰ç¼€å°±æ˜¯ä½¿ç”¨äº†å¤„ç†å™¨çš„æ€»çº¿é”(æœ€æ–°çš„å¤„ç†å™¨éƒ½ä½¿ç”¨ç¼“å­˜é”ä»£æ›¿æ€»çº¿é”æ¥æé«˜æ€§èƒ½)ã€‚</p>
<blockquote>
<p>cmpxchg(void* ptr, int old, int new)ï¼Œå¦‚æœptrå’Œoldçš„å€¼ä¸€æ ·ï¼Œåˆ™æŠŠnewå†™åˆ°ptrå†…å­˜ï¼Œå¦åˆ™è¿”å›ptrçš„å€¼ï¼Œæ•´ä¸ªæ“ä½œæ˜¯åŸå­çš„ã€‚åœ¨Intelå¹³å°ä¸‹ï¼Œä¼šç”¨lock cmpxchgæ¥å®ç°ï¼Œä½¿ç”¨lockè§¦å‘ç¼“å­˜é”ï¼Œè¿™æ ·å¦ä¸€ä¸ªçº¿ç¨‹æƒ³è®¿é—®ptrçš„å†…å­˜ï¼Œå°±ä¼šè¢«blockä½ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸€æ¬¾æ‚„ç„¶å´›èµ·çš„å›½äº§è§„åˆ™å¼•æ“ï¼Œè®©ä¸šåŠ¡ç¼–æ’æ•ˆç‡æå‡ 10 å€ï¼]]></title>    <link>https://juejin.cn/post/7604080364354600987</link>    <guid>https://juejin.cn/post/7604080364354600987</guid>    <pubDate>2026-02-09T06:09:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604080364354600987" data-draft-id="7604301929120382985" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸€æ¬¾æ‚„ç„¶å´›èµ·çš„å›½äº§è§„åˆ™å¼•æ“ï¼Œè®©ä¸šåŠ¡ç¼–æ’æ•ˆç‡æå‡ 10 å€ï¼"/> <meta itemprop="keywords" content="Java,Spring Boot"/> <meta itemprop="datePublished" content="2026-02-09T06:09:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JavaGuide"/> <meta itemprop="url" content="https://juejin.cn/user/166781497383294"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸€æ¬¾æ‚„ç„¶å´›èµ·çš„å›½äº§è§„åˆ™å¼•æ“ï¼Œè®©ä¸šåŠ¡ç¼–æ’æ•ˆç‡æå‡ 10 å€ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/166781497383294/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JavaGuide
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T06:09:44.000Z" title="Mon Feb 09 2026 06:09:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ Guideã€‚ä»Šå¤©æ¥æ¨èä¸€æ¬¾éå¸¸ä¼˜ç§€çš„å›½äº§è§„åˆ™å¼•æ“ï¼Œè¯´ä¸å®šä½ æ›¾ç»å°±ç”¨è¿‡ã€‚ä¸‹é¢æ˜¯æ­£æ–‡ã€‚</p>
<p>ä½ æœ‰æ²¡æœ‰æ¥è¿‡é‚£ç§ç¥–ä¼ ä»£ç ï¼Ÿä¸€ä¸ªå‡ åƒè¡Œçš„ <code>if-else</code> å ¡å’ï¼Œæ”¹ä¸€è¡Œé€»è¾‘ï¼Œè¦æµ‹åŠå¤©ã€‚æ›´ç³Ÿçš„æ˜¯ï¼Œä¸šåŠ¡æ–¹ä»Šå¤©è¯´è¦"å…ˆ A å B"ï¼Œæ˜å¤©åˆæ”¹æˆ"A å’Œ B å¹¶è¡Œï¼Œç­‰ C å®Œæˆå†æ¥ D"ï¼Œæ¯æ¬¡æ”¹æµç¨‹éƒ½è¦é‡æ„ä»£ç ã€‚</p>
<p><strong>LiteFlow æ˜¯ä¸€ä¸ªå›½äº§è§„åˆ™å¼•æ“</strong>ï¼Œä¸“é—¨è§£å†³"ä¸šåŠ¡é€»è¾‘è€¦åˆ"é—®é¢˜ã€‚å®ƒæŠŠç€‘å¸ƒæµå¼çš„ä»£ç æ‹†æˆä¸€ä¸ªä¸ªç‹¬ç«‹ç»„ä»¶ï¼Œç”¨ä¸€å¥— DSL è¯­æ³•é‡æ–°ç¼–æ’ï¼Œæ”¹æµç¨‹å°±åƒæ­ç§¯æœ¨ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ef173b23a724ad297b703da3ec6b202~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771222187&amp;x-signature=vEscLemN4GSNfsY1xAISRjx0Euo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h2>
<p>ä¼ ç»Ÿå¤æ‚ä¸šåŠ¡ç³»ç»Ÿçš„ç—›ç‚¹ï¼š</p>
<ul>
<li><strong>æ”¹ä¸€å¤„åŠ¨å…¨èº«</strong>ï¼šä»£ç é‡Œåˆ°å¤„æ˜¯ç¡¬ç¼–ç çš„æµç¨‹åˆ¤æ–­ï¼Œæ”¹ä¸ªé¡ºåºè¦æ”¹å¥½å‡ ä¸ªåœ°æ–¹ã€‚</li>
<li><strong>éš¾ä»¥çƒ­å˜æ›´</strong>ï¼šä¸šåŠ¡æµç¨‹è°ƒæ•´éœ€è¦é‡æ–°å‘ç‰ˆï¼Œæ²¡æ³•å®æ—¶ç”Ÿæ•ˆã€‚</li>
<li><strong>ç»„ä»¶å¤ç”¨éš¾</strong>ï¼šæ¯ä¸ªä¸šåŠ¡åœºæ™¯éƒ½å†™ä¸€å¥—é€»è¾‘ï¼ŒåŒæ ·çš„ä»£ç åœ¨åˆ°å¤„å¤åˆ¶ã€‚</li>
</ul>
<p>LiteFlow çš„æ ¸å¿ƒæ€è·¯æ˜¯ <strong>"å·¥ä½œå°æ¨¡å¼"</strong> ï¼šæƒ³è±¡ä¸€ä¸ªå·¥å‚æµæ°´çº¿ï¼Œn ä¸ªå·¥äººå›´ç€å·¥ä½œå°ï¼Œæ¯ä¸ªäººåªè´Ÿè´£è‡ªå·±é‚£é“å·¥åºï¼Œå®Œæˆå°±æŠŠåŠæˆå“æ”¾å›å·¥ä½œå°ï¼Œä¸‹ä¸€ä¸ªäººæ¥ç€åšã€‚å·¥äººä¹‹é—´ä¸éœ€è¦æ²Ÿé€šï¼Œåªéœ€è¦å…³å¿ƒè‡ªå·±æ‰‹å¤´çš„æ´»å’Œå·¥ä½œå°ä¸Šçš„èµ„æºã€‚</p>
<p>æ˜ å°„åˆ°ä»£ç ä¸–ç•Œï¼šå·¥äººå°±æ˜¯ç»„ä»¶ï¼Œå·¥ä½œå°å°±æ˜¯ä¸Šä¸‹æ–‡ï¼Œå·¥åºé¡ºåºå°±æ˜¯è§„åˆ™é…ç½®ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a68ab8c79454bc284dec06b79439956~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771222187&amp;x-signature=cdKrAvhjHaYekXH6YHFL5TB4LVY%3D" alt="" loading="lazy"/></p>
<p>ä¸‹å›¾æ˜¯ LiteFlow å®˜æ–¹æ–‡æ¡£å¯¹æ ¸å¿ƒèƒ½åŠ›ï¼ˆç»„ä»¶ç¼–æ’ã€å®æ—¶çƒ­æ›´æ›¿å’Œå¤ç”¨ï¼‰çš„å›¾è§£ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a68cc6d34084c6d927a0dab513405cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771222187&amp;x-signature=%2FHEjGMqo%2BhCzTgvA8DacCDqUm6w%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">LiteFlow æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d95a50ab2c0d4e9b989185c6bef547da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771222187&amp;x-signature=StZzMVoCn2cs8JR8DkER8nzKh%2BU%3D" alt="" loading="lazy"/></p>
<p>LiteFlow æ˜¯ä¸€æ¬¾<strong>å›½äº§å¼€æºçš„è½»é‡çº§è§„åˆ™å¼•æ“æ¡†æ¶</strong>ï¼Œä¸“æ³¨è§£å†³å¤æ‚ä¸šåŠ¡é€»è¾‘çš„è§£è€¦ä¸ç¼–æ’é—®é¢˜ï¼Œæ”¯æŒ Spring Boot 2.x/3.xï¼Œæœ€ä½ JDK 8 å³å¯è¿è¡Œã€‚</p>
<p><strong>æ ¸å¿ƒåŠŸèƒ½</strong>ï¼š</p>
<ul>
<li><strong>ç»„ä»¶åŒ–æ‹†åˆ†</strong>ï¼šæŠŠé•¿é“¾æ¡çš„ä¸šåŠ¡é€»è¾‘æ‹†æˆç‹¬ç«‹ç»„ä»¶ï¼Œæ¯ä¸ªç»„ä»¶åªåšä¸€ä»¶äº‹ã€‚</li>
<li><strong>è§„åˆ™é©±åŠ¨ç¼–æ’</strong>ï¼šç”¨ç®€æ´çš„ EL è¡¨è¾¾å¼å®šä¹‰ç»„ä»¶æ‰§è¡Œé¡ºåºï¼Œæ”¯æŒä¸²è¡Œã€å¹¶è¡Œã€æ¡ä»¶ã€å¾ªç¯ç­‰å¤æ‚é€»è¾‘ã€‚</li>
<li><strong>è„šæœ¬ç»„ä»¶æ”¯æŒ</strong>ï¼šæ”¯æŒ Javaã€JavaScriptã€Groovyã€QLExpressã€Pythonã€Luaã€Aviator ç­‰å¤šç§è„šæœ¬è¯­è¨€ï¼ŒJava è„šæœ¬ç¼–è¯‘é€Ÿåº¦åœ¨ v2.15.3 ç‰ˆæœ¬åæå‡äº† <strong>200 å€</strong>ï¼ˆ2000 ä¸ªè„šæœ¬ä» 30 ç§’é™åˆ° 150 æ¯«ç§’ï¼‰ã€‚</li>
<li><strong>çƒ­éƒ¨ç½²èƒ½åŠ›</strong>ï¼šè§„åˆ™å’Œè„šæœ¬å¯ä»¥å­˜æ”¾åœ¨æ•°æ®åº“ã€æ³¨å†Œä¸­å¿ƒï¼ˆNacosã€Etcdã€Zookeeperï¼‰ï¼Œä¿®æ”¹åå®æ—¶ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯ã€‚</li>
<li><strong>å¯è§†åŒ–ç¼–æ’</strong>ï¼šæ”¯æŒ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fliupeiqiang%2FLiteFlowX" title="https://gitee.com/liupeiqiang/LiteFlowX" target="_blank" ref="nofollow noopener noreferrer">LiteFlowX</a> å¯è§†åŒ–ç¼–æ’ç•Œé¢ï¼Œæ‹–æ‹½å°±èƒ½è®¾è®¡æµç¨‹ã€‚</li>
<li><strong>è‡ªå¸¦ç®€å•ç›‘æ§</strong>ï¼šæ¡†æ¶å†…è‡ªå¸¦ä¸€ä¸ªå‘½ä»¤è¡Œçš„ç›‘æ§ï¼Œèƒ½å¤ŸçŸ¥é“æ¯ä¸ªç»„ä»¶çš„è¿è¡Œè€—æ—¶æ’è¡Œã€‚</li>
</ul>
<p>LiteFlow çš„æ ¸å¿ƒæ˜¯<strong>åŸºäº EL è¡¨è¾¾å¼çš„è§„åˆ™è§£æå¼•æ“</strong>ï¼Œåœ¨ v2.15.2 ç‰ˆæœ¬ä¸­ï¼Œåº•å±‚è§„åˆ™å¼•æ“ä» QLExpress 3 å…¨é¢å‡çº§åˆ° QLExpress 4ï¼Œå¸¦æ¥æ€§èƒ½æå‡ï¼š</p>























<table><thead><tr><th>æµ‹è¯•æŒ‡æ ‡</th><th>QL3 ç‰ˆæœ¬</th><th>QL4 ç‰ˆæœ¬</th><th>æå‡å¹…åº¦</th></tr></thead><tbody><tr><td>ç¼–è¯‘é˜¶æ®µ TPS</td><td>2,739 ops</td><td>3,636 ops</td><td><strong>æå‡ 32%</strong></td></tr><tr><td>ä¸Šä¸‹æ–‡å‚æ•°æ³¨å…¥</td><td>55,826 ops</td><td>222,625 ops</td><td><strong>æå‡ 300%</strong></td></tr></tbody></table>
<p>æ•°æ®æ¥æºï¼šLiteFlow å®˜æ–¹å‹æµ‹æŠ¥å‘Šï¼Œé‡‡ç”¨ benchmark æ¡†æ¶ï¼Œ2 æ¬¡é¢„çƒ­ã€3 æ¬¡æ‰§è¡Œå–å¹³å‡å€¼ã€‚</p>
<p><strong>QLExpress</strong> æ˜¯ç”±é˜¿é‡Œå·´å·´å¼€æºçš„è½»é‡çº§åŠ¨æ€è„šæœ¬å¼•æ“ï¼Œç›®æ ‡æ˜¯å°†ä¸šåŠ¡é€»è¾‘ä»ç¹é‡çš„ Java ä»£ç ä¸­è§£è€¦ï¼Œå˜æˆå¯ä»¥åŠ¨æ€æ‰§è¡Œçš„è„šæœ¬ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7293b321b8048f69f3293717c4de2e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771222187&amp;x-signature=yNkB%2FOgWf%2FAePXdxP6%2B62JTwmro%3D" alt="" loading="lazy"/></p>
<p>LiteFlow åœ¨ä»Šå¹´çš„ Gitee å¹´åº¦å¼€æºé¡¹ç›®è¯„é€‰ä¸­è·å¾—äº†åŸºç¡€è½¯ä»¶èµ›é“ç¬¬äºŒåçš„æˆç»©ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eca7ec93d363462ea260f6af4eb9c876~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771222187&amp;x-signature=XqP7LY3va%2FfHZkBTWYmaSfsPmEw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">å¿«é€Ÿä¸Šæ‰‹</h2>
<h3 data-id="heading-3">å®‰è£…</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.yomahub<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>liteflow-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.15.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>LiteFlow æ”¯æŒ JDK 8 ~ JDK 25 å…¨ç‰ˆæœ¬ï¼Œä½†å¦‚æœä½ ç”¨ JDK 9+ï¼Œå»ºè®®ç›´æ¥ä¸Š v2.15.0+ ç‰ˆæœ¬ï¼Œæ— éœ€é¢å¤–é…ç½® JVM å‚æ•°ã€‚</p>
<h3 data-id="heading-4">é…ç½®è§„åˆ™æ–‡ä»¶</h3>
<p>åœ¨ <code>application.properties</code> é‡ŒæŒ‡å®šè§„åˆ™æ–‡ä»¶ä½ç½®ï¼š</p>
<pre><code class="hljs language-properties" lang="properties">liteflow.rule-source=config/flow.el.xml
</code></pre>
<p>ç„¶ååœ¨ <code>resources/config/flow.el.xml</code> å®šä¹‰è§„åˆ™ <code>THEN(validateOrder, WHEN(checkStock, calcPrice), riskCheck, saveOrder);</code>ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">flow</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">chain</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"orderChain"</span>&gt;</span>
        THEN(
            validateOrder,
            WHEN(checkStock, calcPrice),
            riskCheck,
            saveOrder
        );
    <span class="hljs-tag">&lt;/<span class="hljs-name">chain</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">flow</span>&gt;</span>
</code></pre>
<p>è¿™æ®µè¡¨è¾¾å¼å®šä¹‰äº†æ‰§è¡Œçš„æ‹“æ‰‘ç»“æ„ï¼š</p>
<ul>
<li><strong>THEN</strong>ï¼šä¸²è¡Œæ‰§è¡Œï¼Œå¿…é¡»å…ˆæ‰§è¡Œå®Œå‰é¢çš„èŠ‚ç‚¹ï¼Œæ‰èƒ½è¿›å…¥ä¸‹ä¸€ä¸ªã€‚</li>
<li><strong>WHEN</strong>ï¼šå¹¶è¡Œæ‰§è¡Œï¼Œåœ¨æ­¤ä¾‹ä¸­ï¼Œ<code>checkStock</code>ï¼ˆæ£€æŸ¥åº“å­˜ï¼‰å’Œ <code>calcPrice</code>ï¼ˆè®¡ç®—ä»·æ ¼ï¼‰ä¼šåŒæ—¶å¼€å¯å¼‚æ­¥çº¿ç¨‹æ‰§è¡Œï¼Œæå‡æ¥å£å“åº”é€Ÿåº¦ã€‚</li>
</ul>
<p>è§„åˆ™å«ä¹‰ï¼šå…ˆæ ¡éªŒè®¢å• â†’ ç„¶åå¹¶è¡ŒæŸ¥åº“å­˜å’Œç®—ä»·æ ¼ â†’ å†åšé£é™©æ£€æŸ¥ â†’ æœ€åä¿å­˜è®¢å•ã€‚</p>
<h3 data-id="heading-5">å®šä¹‰ç»„ä»¶</h3>
<p>é€šè¿‡å®ç° <code>NodeComponent</code>å®šä¹‰ç»„ä»¶ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@LiteflowComponent("validateOrder")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ValidateOrderCmp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">NodeComponent</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ä»ä¸Šä¸‹æ–‡è·å–è®¢å•æ•°æ®</span>
        <span class="hljs-type">OrderContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getContextBean(OrderContext.class);
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> context.getOrder();

        <span class="hljs-comment">// æ ¡éªŒé€»è¾‘</span>
        <span class="hljs-keyword">if</span> (order.getAmount() &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"è®¢å•é‡‘é¢å¿…é¡»å¤§äº0"</span>);
        }

        <span class="hljs-comment">// æŠŠç»“æœæ”¾å›ä¸Šä¸‹æ–‡ï¼Œä¾›åç»­ç»„ä»¶ä½¿ç”¨</span>
        context.setValid(<span class="hljs-literal">true</span>);
    }
}
</code></pre>
<ul>
<li><strong><code>@LiteflowComponent</code></strong> ï¼šå¤åˆæ³¨è§£ï¼Œå°†ç±»å£°æ˜ä¸º Spring çš„ Beanï¼Œå¹¶ç»™ç»„ä»¶èµ·ä¸€ä¸ª IDï¼ˆvalidateOrderï¼‰ï¼Œè¿™ä¸ª ID å¿…é¡»ä¸ XML æ–‡ä»¶ä¸­çš„åç§°å¯¹åº”ã€‚</li>
<li><strong><code>getContextBean</code></strong> ï¼šLiteFlow å¤„ç†æ•°æ®çš„ç²¾é«“ï¼Œæµç¨‹ä¸­çš„æ‰€æœ‰ç»„ä»¶å…±äº«ä¸€ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œé¿å…åœ¨æ–¹æ³•é—´ä¼ é€’å¤§é‡å‚æ•°ï¼Œå®ç°é€»è¾‘è§£è€¦ã€‚</li>
</ul>
<p>LiteFlow åœ¨ v2.8.0 åæ”¯æŒå¤šä¸Šä¸‹æ–‡ï¼Œåœ¨æ‰§è¡Œçš„æ—¶å€™åŒæ—¶åˆå§‹åŒ–ä½ ä¼ å…¥çš„å¤šä¸ªä¸Šä¸‹æ–‡ã€‚åœ¨ç»„ä»¶é‡Œä¹Ÿå¯ä»¥æ ¹æ® class ç±»å‹å¾ˆæ–¹ä¾¿çš„æ‹¿åˆ°ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¼ å…¥</span>
<span class="hljs-type">LiteflowResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> flowExecutor.execute2Resp(<span class="hljs-string">"chain1"</span>, æµç¨‹åˆå§‹å‚æ•°, OrderContext.class, UserContext.class, SignContext.class);

<span class="hljs-comment">// è·å–</span>
<span class="hljs-type">OrderContext</span> <span class="hljs-variable">orderContext</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getContextBean(OrderContext.class);
<span class="hljs-type">UserContext</span> <span class="hljs-variable">userContext</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getContextBean(UserContext.class);
<span class="hljs-type">SignContext</span> <span class="hljs-variable">signContext</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getContextBean(SignContext.class);
</code></pre>
<p>åŒç†å®šä¹‰å…¶ä»–ç»„ä»¶ï¼ˆ<code>checkStock</code>ã€<code>calcPrice</code>ã€<code>riskCheck</code>ã€<code>saveOrder</code>ï¼‰ã€‚</p>
<h3 data-id="heading-6">æ‰§è¡Œæµç¨‹</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {

    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> FlowExecutor flowExecutor;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-type">LiteflowResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> flowExecutor.execute2Resp(
            <span class="hljs-string">"orderChain"</span>,
            order,              <span class="hljs-comment">// å°†æ•°æ®ä½œä¸ºåˆå§‹å‚æ•°</span>
            OrderContext.class  <span class="hljs-comment">// è®© LiteFlow è‡ªåŠ¨å®ä¾‹åŒ–ä¸Šä¸‹æ–‡</span>
        );
    }
}
</code></pre>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fjavaguide.cn%2Fzhuanlan%2Finterview-guide.html" target="_blank" title="https://javaguide.cn/zhuanlan/interview-guide.html" ref="nofollow noopener noreferrer">ã€ŠSpringAI æ™ºèƒ½é¢è¯•å¹³å°+RAG çŸ¥è¯†åº“ã€‹</a>é…å¥—å®æˆ˜é¡¹ç›®æ•™ç¨‹æ­£åœ¨æ›´æ–°ï¼Œæ¶‰åŠåˆ° Prompt Engineeringã€å¤§æ¨¡å‹é›†æˆã€RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ã€é«˜æ€§èƒ½å¯¹è±¡å­˜å‚¨ä¸å‘é‡æ•°æ®åº“ã€‚åç»­çš„è¯ï¼Œè¿˜ä¼šåŒæ­¥ä¸Š Agent é¡¹ç›®ã€‚</p>
<p>å†…å®¹éå¸¸å…¨é¢ï¼Œéå¸¸é€‚åˆæƒ³è¦å®æˆ˜ AI é¡¹ç›®æˆ–è€…å‡†å¤‡ AI å¤§æ¨¡å‹åº”ç”¨å¼€å‘å²—ä½é¢è¯•çš„æœ‹å‹ï¼Œæ¥ä¸€å¼ åˆšå†™å®Œçš„<strong>3.4w å­—+35 é“é¢˜ç›®</strong>çš„ RAG é¢è¯•é¢˜æ€»ç»“ï¼Œå¤§å®¶æ„Ÿå—ä¸€ä¸‹ï¼ˆç‚¹æ­¤é“¾æ¥äº†è§£ï¼š <a href="https://link.juejin.cn?target=https%3A%2F%2Fjavaguide.cn%2Fabout-the-author%2Fzhishixingqiu-two-years.html" target="_blank" title="https://javaguide.cn/about-the-author/zhishixingqiu-two-years.html" ref="nofollow noopener noreferrer">æ˜Ÿçƒ</a>ï¼‰ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e1222e759194be5a62fa2078bcab908~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771222187&amp;x-signature=Pyy8QrUZR%2Bxt1bioeTghADwj5%2FQ%3D" alt="RAG é¢è¯•é¢˜" loading="lazy"/></p>
<h2 data-id="heading-7">ä½¿ç”¨åœºæ™¯</h2>
<h3 data-id="heading-8">åœºæ™¯ä¸€ï¼šç”µå•†ä»·æ ¼å¼•æ“</h3>
<p>ç”µå•†çš„ä»·æ ¼è®¡ç®—é€šå¸¸æ¶‰åŠå¤šä¸ªç»´åº¦ï¼šåŸä»·ã€ä¼šå‘˜æŠ˜æ‰£ã€ä¼˜æƒ åˆ¸ã€æ»¡å‡æ´»åŠ¨ã€åº—é“ºä¼˜æƒ ç­‰ã€‚ç”¨ LiteFlow å¯ä»¥æŠŠæ¯ä¸ªè®¡ç®—å› å­æ‹†æˆç‹¬ç«‹ç»„ä»¶ï¼Œç”¨è§„åˆ™çµæ´»ç»„åˆã€‚</p>
<p><strong>è§„åˆ™ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">chain</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"priceChain"</span>&gt;</span>
    THEN(
        getBasePrice,
        WHEN(
            memberDiscount,
            couponDiscount,
            activityDiscount
        ),
        finalPrice,
        savePrice
    );
<span class="hljs-tag">&lt;/<span class="hljs-name">chain</span>&gt;</span>
</code></pre>
<p>å¥½å¤„æ˜¯ï¼šæ–°å¢ä¸€ç§ä¼˜æƒ ç±»å‹ï¼Œåªéœ€è¦åŠ ä¸€ä¸ªç»„ä»¶ï¼Œç„¶ååœ¨è§„åˆ™é‡Œé…ä¸Šä½ç½®ï¼Œä¸ç”¨æ”¹ç°æœ‰ä»£ç ã€‚</p>
<h3 data-id="heading-9">åœºæ™¯äºŒï¼šå¤æ‚å®¡æ‰¹æµç¨‹</h3>
<p>LiteFlow ä¸åš"åŸºäºè§’è‰²çš„å®¡æ‰¹æµè½¬"ï¼ˆé‚£æ˜¯ Flowableã€Flowlong è¿™ç±»å·¥ä½œæµå¼•æ“çš„äº‹ï¼‰ï¼Œä½†å®ƒé€‚åˆå¤„ç†<strong>å®¡æ‰¹ç¯èŠ‚é‡Œçš„ä¸šåŠ¡é€»è¾‘</strong>ã€‚</p>
<p>æ¯”å¦‚ä¸€ä¸ªé‡‡è´­å®¡æ‰¹ï¼Œéœ€è¦ï¼š</p>
<ol>
<li>æ ¡éªŒé‡‡è´­é‡‘é¢æ˜¯å¦è¶…é¢„ç®—</li>
<li>å¹¶è¡ŒæŸ¥è¯¢ä¾›åº”å•†åº“å­˜å’Œä»·æ ¼</li>
<li>æ ¹æ®é‡‘é¢èµ°ä¸åŒçš„é£æ§è§„åˆ™</li>
<li>ç”Ÿæˆé‡‡è´­å•</li>
</ol>
<p>è¿™äº›é€»è¾‘ç”¨ LiteFlow ç¼–æ’ï¼Œæ¯”å†™åœ¨ Service é‡Œè¦æ¸…æ™°ã€‚</p>
<h3 data-id="heading-10">åœºæ™¯ä¸‰ï¼šæ•°æ®æ¸…æ´— ETL</h3>
<p>æ•°æ®å¤„ç†åœºæ™¯é‡Œï¼Œç»å¸¸æœ‰å¤šä¸ªæ¸…æ´—æ­¥éª¤ï¼šå»é‡ã€æ ¼å¼è½¬æ¢ã€æ•°æ®è¡¥å…¨ã€è´¨é‡æ£€æŸ¥ã€‚ç”¨ LiteFlow å¯ä»¥æŠŠè¿™äº›æ­¥éª¤ç»„ä»¶åŒ–ï¼Œæ ¹æ®ä¸åŒæ•°æ®æºé…ç½®ä¸åŒè§„åˆ™ã€‚</p>
<h3 data-id="heading-11">åœºæ™¯å››ï¼šå®æ—¶é£æ§å†³ç­–</h3>
<p>é£æ§è§„åˆ™å˜åŒ–é¢‘ç¹ï¼Œç”¨è„šæœ¬ç»„ä»¶ + è§„åˆ™çƒ­éƒ¨ç½²ï¼Œå¯ä»¥åœ¨ä¸åœæœºçš„æƒ…å†µä¸‹è°ƒæ•´è§„åˆ™ã€‚æ¯”å¦‚ï¼š"æœ€è¿‘æ¬ºè¯ˆå¤šäº†ï¼ŒæŠŠæŸç±»äº¤æ˜“çš„é˜ˆå€¼ä» 1000 é™åˆ° 500"ï¼Œæ”¹ä¸€ä¸‹è„šæœ¬é…ç½®å°±è¡Œã€‚</p>
<h2 data-id="heading-12">EL è§„åˆ™è¯­æ³•</h2>
<p>LiteFlow çš„ EL è¯­æ³•æ˜¯å…¶æ ¸å¿ƒç«äº‰åŠ›ï¼Œååˆ†é’Ÿå°±èƒ½ä¸Šæ‰‹ï¼Œä½†èƒ½ç¼–æ’å‡ºéå¸¸å¤æ‚çš„æµç¨‹ã€‚</p>
<h3 data-id="heading-13">åŸºæœ¬è¯­æ³•</h3>
<p><strong>ä¸²è¡Œï¼ˆTHEN/SERï¼‰</strong>ï¼šæŒ‰é¡ºåºæ‰§è¡Œ</p>
<pre><code class="hljs language-xml" lang="xml">THEN(a, b, c, d)
<span class="hljs-comment">&lt;!-- æˆ–è€…ç”¨è¯­ä¹‰æ›´æ˜ç¡®çš„ SER --&gt;</span>
SER(a, b, c, d)
</code></pre>
<p><strong>å¹¶è¡Œï¼ˆWHEN/PARï¼‰</strong>ï¼šåŒæ—¶æ‰§è¡Œ</p>
<pre><code class="hljs language-xml" lang="xml">WHEN(a, b, c)
<span class="hljs-comment">&lt;!-- æˆ–è€…ç”¨ PAR --&gt;</span>
PAR(a, b, c)
</code></pre>
<p><strong>åµŒå¥—ç»„åˆ</strong>ï¼š</p>
<pre><code class="hljs language-xml" lang="xml">THEN(
    a,
    WHEN(b, THEN(c, d)),
    e
)
</code></pre>
<p>è§„åˆ™å«ä¹‰ï¼šå…ˆæ‰§è¡Œ a â†’ ç„¶åå¹¶è¡Œæ‰§è¡Œ b å’Œ"å…ˆ c å d" â†’ æœ€åæ‰§è¡Œ eã€‚</p>
<h3 data-id="heading-14">é«˜çº§ç‰¹æ€§</h3>
<p><strong>å¿½ç•¥é”™è¯¯ï¼ˆignoreErrorï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-xml" lang="xml">THEN(
    a,
    WHEN(b, c, d).ignoreError(true),
    e
)
</code></pre>
<p>å³ä½¿ bã€cã€d ä¸­æœ‰ç»„ä»¶æŠ¥é”™ï¼Œe ä»ä¼šæ‰§è¡Œã€‚</p>
<p><strong>ä»»ä¸€å®Œæˆåˆ™ç»§ç»­ï¼ˆanyï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-xml" lang="xml">THEN(
    a,
    WHEN(b, c, d).any(true),
    e
)
</code></pre>
<p>bã€cã€d ä¸­ä»»ä½•ä¸€ä¸ªå…ˆå®Œæˆï¼Œå°±å¿½ç•¥å…¶ä»–ç»§ç»­å¾€ä¸‹èµ°ã€‚</p>
<p><strong>æŒ‡å®šå¿…é¡»ç­‰å¾…çš„èŠ‚ç‚¹ï¼ˆmustï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-xml" lang="xml">WHEN(b, c, d).must(b, c)
</code></pre>
<p>bã€c å¿…é¡»ç­‰æ‰§è¡Œå®Œï¼Œd å¦‚æœè¿˜æ²¡å®Œå°±å¿½ç•¥ã€‚</p>
<p><strong>æŒ‰æ¯”ä¾‹å®Œæˆï¼ˆpercentageï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-xml" lang="xml">WHEN(a, b, c, d, e).percentage(0.6)
</code></pre>
<p>5 ä¸ªç»„ä»¶é‡Œéšæœºæ‰§è¡Œ 3 ä¸ªï¼ˆ5 Ã— 0.6 = 3ï¼‰ï¼Œå®Œæˆå°±ç»§ç»­ã€‚</p>
<h2 data-id="heading-15">ä¸é€‚åˆä»€ä¹ˆåœºæ™¯ï¼Ÿ</h2>
<ul>
<li><strong>å®¡æ‰¹æµè½¬</strong>ï¼šLiteFlow åªåšåŸºäºé€»è¾‘çš„æµè½¬ï¼Œä¸åšåŸºäºè§’è‰²ä»»åŠ¡çš„æµè½¬ã€‚å¦‚æœè¦å®ç°"A å®¡æ‰¹å®Œä¼ ç»™ Bï¼ŒB å®¡æ‰¹å®Œä¼ ç»™ C"è¿™ç±»åœºæ™¯ï¼Œåº”è¯¥ç”¨ Flowable æˆ– Flowlongã€‚</li>
<li><strong>ç®€å•ä¸šåŠ¡</strong>ï¼šå¦‚æœä¸€ä¸ªæµç¨‹åªæœ‰ 2-3 ä¸ªæ­¥éª¤ï¼Œä¸”åŸºæœ¬ä¸ä¼šå˜ï¼Œä¸Šè§„åˆ™å¼•æ“å¯èƒ½æœ‰ç‚¹æ€é¸¡ç”¨ç‰›åˆ€ã€‚</li>
<li><strong>è¶…å¤§è§„æ¨¡å¹¶è¡Œè®¡ç®—</strong>ï¼šå¦‚æœå¹¶è¡Œç»„ä»¶è¾¾åˆ°æˆç™¾ä¸Šåƒä¸ªï¼Œä¸”æ¶‰åŠæå…¶å¤æ‚çš„çº¿ç¨‹è°ƒåº¦ï¼ŒLiteFlow è™½ç„¶èƒ½åšï¼Œä½†å®ƒæ›´åå‘ä¸šåŠ¡æµç¨‹ç¼–æ’ï¼Œè€Œéå¤§æ•°æ®åˆ†å¸ƒå¼è®¡ç®—å¼•æ“ï¼ˆå¦‚ Spark/Flinkï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-16">ä¸å…¶ä»–æ–¹æ¡ˆå¯¹æ¯”</h2>





















































<table><thead><tr><th>å¯¹æ¯”ç»´åº¦</th><th>LiteFlow</th><th>è‡ªå·±å†™ if-else</th><th>Flowable/Flowlong</th></tr></thead><tbody><tr><td><strong>å­¦ä¹ æ›²çº¿</strong></td><td>ä½ï¼ˆEL è¯­æ³•ç®€å•ï¼‰</td><td>æœ€ä½ï¼ˆåŸç”Ÿ Javaï¼‰</td><td>ä¸­ï¼ˆéœ€ç†è§£ BPMNï¼‰</td></tr><tr><td><strong>æµç¨‹çµæ´»æ€§</strong></td><td>é«˜ï¼ˆè§„åˆ™é©±åŠ¨ï¼‰</td><td>ä½ï¼ˆç¡¬ç¼–ç ï¼‰</td><td>ä¸­ï¼ˆéœ€é‡æ–°éƒ¨ç½²ï¼‰</td></tr><tr><td><strong>çƒ­éƒ¨ç½²</strong></td><td>âœ… æ”¯æŒ</td><td>âŒ éœ€è¦å‘ç‰ˆ</td><td>âœ… æ”¯æŒ</td></tr><tr><td><strong>è„šæœ¬æ”¯æŒ</strong></td><td>âœ… å¤šç§è¯­è¨€</td><td>âŒ æ— </td><td>âš ï¸ æœ‰é™æ”¯æŒ</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>å¤æ‚ä¸šåŠ¡é€»è¾‘ç¼–æ’</td><td>ç®€å•æµç¨‹</td><td>å®¡æ‰¹æµè½¬</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>é«˜ï¼ˆ8.6 ä¸‡+ TPSï¼‰</td><td>å–å†³äºå®ç°</td><td>ä¸­ï¼ˆæœ‰çŠ¶æ€æœºå¼€é”€ï¼‰</td></tr><tr><td><strong>å›½äº§æ”¯æŒ</strong></td><td>âœ… å›½äº§</td><td>N/A</td><td>âš ï¸ Flowlong å›½äº§</td></tr></tbody></table>
<h2 data-id="heading-17">æ€»ç»“</h2>
<p>LiteFlow æŠŠå¤æ‚ä¸šåŠ¡é€»è¾‘ä»"é¢æ¡ä»£ç "å˜æˆäº†"æ­ç§¯æœ¨"ï¼Œæ”¹æµç¨‹ä¸å†åŠ¨å…¨èº«ï¼Œå°¤å…¶é€‚åˆé‚£äº›<strong>ä¸šåŠ¡è§„åˆ™é¢‘ç¹å˜åŒ–ã€æ­¥éª¤å¤šä¸”æœ‰å¹¶è¡Œéœ€æ±‚</strong>çš„ç³»ç»Ÿã€‚</p>
<p><strong>è„šæœ¬ç»„ä»¶æ€§èƒ½</strong>ï¼šv2.15.3 ç‰ˆæœ¬æŠŠ Java è„šæœ¬ç¼–è¯‘é€Ÿåº¦æå‡äº† <strong>200 å€</strong>ï¼Œä¸»è¦æ˜¯å› ä¸ºè¯¥ç‰ˆæœ¬å¯¹ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fnoear%2Fliquor" title="https://gitee.com/noear/liquor" target="_blank" ref="nofollow noopener noreferrer">Liquor</a> æ‰¹é‡ç¼–è¯‘ç‰¹æ€§çš„æ”¯æŒã€‚Liquor æ˜¯ä¸€æ¬¾æºè‡ª Arthas æ ¸å¿ƒã€æ”¯æŒ "jar in jar" ä¸”è½»é‡çš„ Java åŠ¨æ€ç¼–è¯‘ä¸è„šæœ¬å·¥å…·ï¼Œèƒ½è®©å¼€å‘è€…åœ¨è¿è¡Œæ—¶ä»¥æ¥è¿‘åŸç”Ÿçš„æ€§èƒ½çµæ´»æ‰§è¡Œ Java ä»£ç ã€‚</p>
<p><strong>é€‚åˆäººç¾¤</strong>ï¼š</p>
<ul>
<li>é¥±å— <code>if-else</code> åµŒå¥—å›°æ‰°çš„åç«¯å¼€å‘è€…</li>
<li>éœ€è¦é¢‘ç¹è°ƒæ•´ä¸šåŠ¡æµç¨‹çš„ç³»ç»Ÿï¼ˆç”µå•†ã€é‡‘èã€é£æ§ï¼‰</li>
<li>æƒ³æŠŠä¸šåŠ¡é€»è¾‘ä»ä»£ç é‡Œå‰¥ç¦»å‡ºæ¥çš„æ¶æ„å¸ˆ</li>
</ul>
<p><strong>ä½¿ç”¨å»ºè®®</strong>ï¼š</p>
<ul>
<li>å…ˆä»ä¸€ä¸ªç®€å•çš„æµç¨‹å¼€å§‹ï¼Œåˆ«ä¸€ä¸Šæ¥å°±ææœ€å¤æ‚çš„</li>
<li>ç»„ä»¶æ‹†åˆ†è¦åˆç†ï¼šæ¯ä¸ªç»„ä»¶åªåšä¸€ä»¶äº‹ï¼Œåšå¥½ä¸€ä»¶äº‹</li>
<li>è§„åˆ™æ–‡ä»¶è®°å¾—åšç‰ˆæœ¬ç®¡ç†ï¼Œå‡ºäº†é—®é¢˜å¥½å›æ»š</li>
<li>å¦‚æœç”¨è„šæœ¬ç»„ä»¶ï¼Œå»ºè®®ç”¨ Java è„šæœ¬ï¼ˆ<code>liteflow-script-javax-pro</code>ï¼‰ï¼Œæ€§èƒ½æœ€å¥½</li>
</ul>
<p>Gitee åœ°å€ï¼š<strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fdromara%2FliteFlow" target="_blank" title="https://gitee.com/dromara/liteFlow" ref="nofollow noopener noreferrer">gitee.com/dromara/litâ€¦</a></strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»é›¶å¼€å§‹å­¦Flinkï¼šFlink SQL çª—å£(Window)æ“ä½œè¯¦è§£]]></title>    <link>https://juejin.cn/post/7604155045236064291</link>    <guid>https://juejin.cn/post/7604155045236064291</guid>    <pubDate>2026-02-09T05:59:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604155045236064291" data-draft-id="7603959423129387008" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»é›¶å¼€å§‹å­¦Flinkï¼šFlink SQL çª—å£(Window)æ“ä½œè¯¦è§£"/> <meta itemprop="keywords" content="å¤§æ•°æ®,Flink,SQL"/> <meta itemprop="datePublished" content="2026-02-09T05:59:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä»£ç åŒ å¿ƒ"/> <meta itemprop="url" content="https://juejin.cn/user/1697301684826952"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»é›¶å¼€å§‹å­¦Flinkï¼šFlink SQL çª—å£(Window)æ“ä½œè¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1697301684826952/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä»£ç åŒ å¿ƒ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T05:59:27.000Z" title="Mon Feb 09 2026 05:59:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ä¸Šä¸€ç¯‡ <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fz9glZrPCsheBk7bxlmZnUg" target="_blank" title="https://mp.weixin.qq.com/s/z9glZrPCsheBk7bxlmZnUg" ref="nofollow noopener noreferrer">Flink SQL æç®€å…¥é—¨</a> ä¸­ï¼Œæˆ‘ä»¬ä½“éªŒäº† Flink SQL çš„åŸºç¡€ç”¨æ³•ã€‚ä½†åœ¨æµå¤„ç†ä¸­ï¼Œæœ€æ ¸å¿ƒã€æœ€è¿·äººï¼ˆä¹Ÿæœ€è®©äººå¤´ç§ƒï¼‰çš„æ¦‚å¿µè«è¿‡äº<strong>æ—¶é—´</strong>å’Œ<strong>çª—å£ï¼ˆWindowï¼‰</strong>ã€‚</p>
<p>ä½ å¯èƒ½ç»å¸¸å¬åˆ°è¿™æ ·çš„ä¸šåŠ¡éœ€æ±‚ï¼š</p>
<ul>
<li>â€œæ¯ 5 åˆ†é’Ÿç»Ÿè®¡ä¸€æ¬¡è®¢å•æ€»é‡â€</li>
<li>â€œå®æ—¶ç»Ÿè®¡è¿‡å» 1 å°æ—¶å†…çš„çƒ­é—¨å•†å“ï¼Œæ¯ 10 ç§’æ›´æ–°ä¸€æ¬¡â€</li>
<li>â€œæ¯å¤© 0 ç‚¹åˆ°å½“å‰æ—¶åˆ»çš„ç´¯è®¡ PVâ€</li>
</ul>
<p>è¿™äº›éœ€æ±‚éƒ½ç¦»ä¸å¼€<strong>çª—å£</strong>ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥æ·±å…¥ Flink SQL çš„çª—å£æœºåˆ¶ï¼Œçœ‹çœ‹å®ƒæ˜¯å¦‚ä½•é©¯æœæ— é™æ•°æ®æµçš„ã€‚</p>
<h2 data-id="heading-0">ä»€ä¹ˆæ˜¯çª—å£ (Window)ï¼Ÿ</h2>
<p>æµæ•°æ®ï¼ˆStreamï¼‰æ˜¯æ— é™çš„ï¼Œåƒæ°´æµä¸€æ ·æºæºä¸æ–­ã€‚æˆ‘ä»¬æ— æ³•è®¡ç®—â€œæ— é™æµâ€çš„æ€»å’Œï¼ˆå› ä¸ºæ°¸è¿œç®—ä¸å®Œï¼‰ã€‚ä¸ºäº†è®¡ç®—ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ— é™çš„æµâ€œåˆ‡â€æˆæœ‰é™çš„å—ï¼Œè¿™ä¸ªâ€œåˆ‡â€çš„æ“ä½œå°±æ˜¯<strong>å¼€çª—ï¼ˆWindowingï¼‰</strong>ã€‚</p>
<p>åœ¨ Flink SQL ä¸­ï¼Œçª—å£ä¸»è¦ç”¨äºå°†æ—¶é—´åºåˆ—ä¸Šçš„æ•°æ®åˆ†æ¡¶ï¼Œç„¶ååœ¨æ¡¶å†…è¿›è¡Œèšåˆè®¡ç®—ï¼ˆå¦‚ <code>SUM</code>, <code>COUNT</code>, <code>AVG</code>ï¼‰ã€‚</p>
<h2 data-id="heading-1">æ–°ä¸€ä»£æ ‡å‡†ï¼šWindow TVF</h2>
<p>åœ¨ Flink 1.13 ä¹‹å‰ï¼Œæˆ‘ä»¬ä¸»è¦ä½¿ç”¨ <code>GROUP WINDOW</code>ï¼ˆå¦‚ <code>TUMBLE(rowtime, ...)</code> åœ¨ GROUP BY å­å¥ä¸­ï¼‰ã€‚ä½†ä» Flink 1.13 å¼€å§‹ï¼Œå®˜æ–¹æ¨èä½¿ç”¨ <strong>Window TVF (Table-Valued Functions)</strong>ã€‚</p>
<p>Window TVF ç¬¦åˆ SQL 2016 æ ‡å‡†ï¼Œè¯­æ³•æ›´è‡ªç„¶ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ï¼ˆæ”¯æŒ TopNã€å»é‡ç­‰å¤æ‚æ“ä½œï¼‰ã€‚æœ¬æ–‡å°†ä»¥ <strong>Window TVF</strong> ä¸ºä¸»è¿›è¡Œè®²è§£ã€‚</p>
<p>æ ¸å¿ƒè¯­æ³•ç»“æ„é€šå¸¸å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> window_start, window_end, <span class="hljs-built_in">SUM</span>(price)
<span class="hljs-keyword">FROM</span> <span class="hljs-keyword">TABLE</span>(
    <span class="hljs-comment">-- çª—å£å‡½æ•°</span>
    TUMBLE(<span class="hljs-keyword">TABLE</span> my_table, DESCRIPTOR(ts), <span class="hljs-type">INTERVAL</span> <span class="hljs-string">'5'</span> <span class="hljs-keyword">MINUTE</span>)
)
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> window_start, window_end;
</code></pre>
<h2 data-id="heading-2">ä¸‰å¤§æ ¸å¿ƒçª—å£ç±»å‹</h2>
<h3 data-id="heading-3">1. æ»šåŠ¨çª—å£ (Tumble Window)</h3>
<p><strong>ç‰¹ç‚¹</strong>ï¼šçª—å£å¤§å°å›ºå®šï¼Œçª—å£ä¹‹é—´<strong>ä¸é‡å </strong>ï¼Œé¦–å°¾ç›¸æ¥ã€‚
<strong>åœºæ™¯</strong>ï¼šæ¯éš” 5 åˆ†é’Ÿç»Ÿè®¡ä¸€æ¬¡ã€‚</p>
<p><img src="https://pic-1258258471.cos.ap-nanjing.myqcloud.com/img/tumbling-windows.png" alt="Tumble Window" loading="lazy"/></p>
<p><strong>è¯­æ³•</strong>ï¼š
<code>TUMBLE(TABLE data, DESCRIPTOR(time_col), INTERVAL '10' MINUTE)</code></p>
<h3 data-id="heading-4">2. æ»‘åŠ¨çª—å£ (Hop Window)</h3>
<p><strong>ç‰¹ç‚¹</strong>ï¼šçª—å£å¤§å°å›ºå®šï¼Œä½†çª—å£ä¹‹é—´<strong>å¯ä»¥é‡å </strong>ã€‚å®ƒæœ‰ä¸¤ä¸ªå‚æ•°ï¼š</p>
<ol>
<li><strong>Window Size (çª—å£å¤§å°)</strong>ï¼šç»Ÿè®¡å¤šé•¿æ—¶é—´çš„æ•°æ®ï¼ˆå¦‚â€œè¿‡å» 1 å°æ—¶â€ï¼‰ã€‚</li>
<li><strong>Window Slide (æ»‘åŠ¨æ­¥é•¿)</strong>ï¼šå¤šä¹…æ›´æ–°ä¸€æ¬¡ç»“æœï¼ˆå¦‚â€œæ¯ 5 åˆ†é’Ÿâ€ï¼‰ã€‚</li>
</ol>
<p><strong>åœºæ™¯</strong>ï¼šæ¯ 5 åˆ†é’Ÿï¼Œç»Ÿè®¡è¿‡å» 1 å°æ—¶çš„ PVã€‚</p>
<p><img src="https://pic-1258258471.cos.ap-nanjing.myqcloud.com/img/sliding-windows.png" alt="Hop Window" loading="lazy"/></p>
<p><strong>è¯­æ³•</strong>ï¼š
<code>HOP(TABLE data, DESCRIPTOR(time_col), INTERVAL '5' MINUTE, INTERVAL '1' HOUR)</code>
<em>æ³¨æ„ï¼šå‚æ•°é¡ºåºæ˜¯å…ˆ Slide (æ­¥é•¿)ï¼Œå Size (å¤§å°)ã€‚</em></p>
<h3 data-id="heading-5">3. ç´¯ç§¯çª—å£ (Cumulate Window)</h3>
<p><strong>ç‰¹ç‚¹</strong>ï¼šè¿™æ˜¯ Flink ç‰¹æœ‰çš„çª—å£ï¼Œç”¨äºè§£å†³â€œæ¯å¤© 0 ç‚¹è‡³ä»Šçš„ç´¯è®¡å€¼â€è¿™ç±»éœ€æ±‚ã€‚å®ƒä¼šæŒ‰æ­¥é•¿è¾“å‡ºä¸€ä¸ªä¸ªä¸æ–­å˜å¤§çš„çª—å£ï¼Œç›´åˆ°è¾¾åˆ°æœ€å¤§çª—å£å¤§å°ã€‚</p>
<p><strong>åœºæ™¯</strong>ï¼šæ¯å¤©çš„å®æ—¶ç´¯è®¡é”€å”®é¢ï¼ˆæ¯ 10 åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡çœ‹åˆ°å½“å¤©çš„ç´¯è®¡å€¼ï¼‰ã€‚</p>
<p><img src="https://pic-1258258471.cos.ap-nanjing.myqcloud.com/img/cumulating-windows.png" alt="Cumulate Window" loading="lazy"/></p>
<p><strong>è¯­æ³•</strong>ï¼š
<code>CUMULATE(TABLE data, DESCRIPTOR(time_col), INTERVAL '10' MINUTE, INTERVAL '1' DAY)</code></p>
<hr/>
<h2 data-id="heading-6">å®æˆ˜ï¼šå¤„ç†â€œè¿‡å» 5 åˆ†é’Ÿçš„è®¢å•æ€»é¢â€</h2>
<p>è®©æˆ‘ä»¬å›åˆ°å¼€å¤´çš„ç»å…¸éœ€æ±‚ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè®¢å•æµ <code>orders</code>ã€‚</p>
<h3 data-id="heading-7">0. å‡†å¤‡æ•°æ®ç¯å¢ƒ</h3>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯åŠ¨ SQL Client</p>
<pre><code class="hljs language-bash" lang="bash">./bin/sql-client.sh
</code></pre>
<p>åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿçš„è®¢å•æºè¡¨ï¼ˆä½¿ç”¨ DataGen è¿æ¥å™¨ï¼‰ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> orders (
    order_id <span class="hljs-type">INT</span>,
    price <span class="hljs-keyword">DOUBLE</span>,
    order_time <span class="hljs-type">TIMESTAMP</span>(<span class="hljs-number">3</span>),
    <span class="hljs-comment">-- å®šä¹‰æ°´ä½çº¿ï¼ŒåŸºäº order_timeï¼Œå»¶è¿Ÿ 0 ç§’</span>
    WATERMARK <span class="hljs-keyword">FOR</span> order_time <span class="hljs-keyword">AS</span> order_time <span class="hljs-operator">-</span> <span class="hljs-type">INTERVAL</span> <span class="hljs-string">'0'</span> <span class="hljs-keyword">SECOND</span>
) <span class="hljs-keyword">WITH</span> (
    <span class="hljs-string">'connector'</span> <span class="hljs-operator">=</span> <span class="hljs-string">'datagen'</span>,
    <span class="hljs-string">'rows-per-second'</span> <span class="hljs-operator">=</span> <span class="hljs-string">'1'</span>,
    <span class="hljs-string">'fields.price.min'</span> <span class="hljs-operator">=</span> <span class="hljs-string">'10'</span>,
    <span class="hljs-string">'fields.price.max'</span> <span class="hljs-operator">=</span> <span class="hljs-string">'100'</span>
);
</code></pre>
<h3 data-id="heading-8">éœ€æ±‚ä¸€ï¼šæ¯ 5 åˆ†é’Ÿï¼Œç»Ÿè®¡è¯¥ 5 åˆ†é’Ÿå†…çš„è®¢å•æ€»é¢</h3>
<p>è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„<strong>æ»šåŠ¨çª—å£ (Tumble)</strong>ã€‚æ¯”å¦‚ 12:00-12:05 ä¸€ä¸ªç»“æœï¼Œ12:05-12:10 ä¸€ä¸ªç»“æœã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> 
    window_start, 
    window_end, 
    <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">as</span> total_orders, 
    <span class="hljs-built_in">SUM</span>(price) <span class="hljs-keyword">as</span> total_amount
<span class="hljs-keyword">FROM</span> <span class="hljs-keyword">TABLE</span>(
    TUMBLE(<span class="hljs-keyword">TABLE</span> orders, DESCRIPTOR(order_time), <span class="hljs-type">INTERVAL</span> <span class="hljs-string">'5'</span> <span class="hljs-keyword">MINUTE</span>)
)
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> window_start, window_end;
</code></pre>
<p><strong>è¿è¡Œç»“æœç¤ºä¾‹</strong>ï¼š
<img src="https://pic-1258258471.cos.ap-nanjing.myqcloud.com/img/20260209105540374.png" alt="5åˆ†é’Ÿå†…è®¢å•æ€»é¢" loading="lazy"/></p>
<h3 data-id="heading-9">éœ€æ±‚äºŒï¼šå®æ—¶ç»Ÿè®¡â€œè¿‡å» 5 åˆ†é’Ÿâ€çš„è®¢å•æ€»é¢ï¼Œæ¯ 1 åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡</h3>
<p>è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„<strong>æ»‘åŠ¨çª—å£ (Hop)</strong>ã€‚</p>
<ul>
<li>çª—å£å¤§å°ï¼š5 åˆ†é’Ÿ</li>
<li>æ»‘åŠ¨æ­¥é•¿ï¼š1 åˆ†é’Ÿ</li>
</ul>
<p>è¿™æ ·ï¼Œ12:00 è¾“å‡º [11:55, 12:00] çš„æ•°æ®ï¼›12:01 è¾“å‡º [11:56, 12:01] çš„æ•°æ®ã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> 
    window_start, 
    window_end, 
    <span class="hljs-built_in">SUM</span>(price) <span class="hljs-keyword">as</span> total_amount
<span class="hljs-keyword">FROM</span> <span class="hljs-keyword">TABLE</span>(
    HOP(<span class="hljs-keyword">TABLE</span> orders, DESCRIPTOR(order_time), <span class="hljs-type">INTERVAL</span> <span class="hljs-string">'1'</span> <span class="hljs-keyword">MINUTE</span>, <span class="hljs-type">INTERVAL</span> <span class="hljs-string">'5'</span> <span class="hljs-keyword">MINUTE</span>)
)
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> window_start, window_end;
</code></pre>
<p><strong>è¿è¡Œç»“æœç¤ºä¾‹</strong>ï¼š
<img src="https://pic-1258258471.cos.ap-nanjing.myqcloud.com/img/20260209105946469.png" alt="è¿‡å»5åˆ†é’Ÿè®¢å•æ€»é¢" loading="lazy"/></p>
<p><strong>æ³¨æ„</strong>ï¼š
<code>HOP</code> å‡½æ•°çš„å‚æ•°ä¸­ï¼Œ<strong>ç¬¬ä¸€ä¸ªæ—¶é—´æ˜¯æ»‘åŠ¨æ­¥é•¿ (Slide)</strong>ï¼Œ<strong>ç¬¬äºŒä¸ªæ—¶é—´æ˜¯çª—å£å¤§å° (Size)</strong>ã€‚åƒä¸‡åˆ«æåäº†ï¼
<code>INTERVAL '1' MINUTE</code> = Slide (æ›´æ–°é¢‘ç‡)
<code>INTERVAL '5' MINUTE</code> = Size (ç»Ÿè®¡èŒƒå›´)</p>
<h2 data-id="heading-10">æ€»ç»“</h2>
<p>Flink SQL çš„ Window TVF æå¤§åœ°ç®€åŒ–äº†çª—å£èšåˆçš„å†™æ³•ã€‚</p>
<ul>
<li><strong>TUMBLE</strong>: è§„è§„çŸ©çŸ©ï¼Œäº’ä¸å¹²æ‰°ï¼ˆåˆ†æ‰¹ç»Ÿè®¡ï¼‰ã€‚</li>
<li><strong>HOP</strong>: è—•æ–­ä¸è¿ï¼Œé¢‘ç¹æ›´æ–°ï¼ˆç§»åŠ¨å¹³å‡/æœ€è¿‘ N åˆ†é’Ÿï¼‰ã€‚</li>
<li><strong>CUMULATE</strong>: èšæ²™æˆå¡”ï¼Œè¶Šç§¯è¶Šå¤šï¼ˆæ—¥æŠ¥/å¤§å±ç´¯è®¡ï¼‰ã€‚</li>
</ul>
<p>æŒæ¡äº†è¿™ä¸‰ç§çª—å£ï¼Œä½ å°±èƒ½è¦†ç›– 90% çš„å®æ—¶ç»Ÿè®¡éœ€æ±‚äº†ã€‚</p>
<p>ä¸‹ä¸€ç¯‡ï¼Œæˆ‘ä»¬å°†æŒ‘æˆ˜æ›´å¤æ‚çš„åœºæ™¯ï¼š<strong>åŒæµ JOIN</strong>ï¼Œçœ‹çœ‹å½“â€œè®¢å•æµâ€é‡åˆ°â€œç”¨æˆ·æµâ€ï¼ŒFlink è¯¥å¦‚ä½•å¤„ç†ï¼Ÿ</p>
<hr/>
<p><a href="https://link.juejin.cn?target=http%3A%2F%2Fblog.daimajiangxin.com.cn" target="_blank" title="http://blog.daimajiangxin.com.cn" ref="nofollow noopener noreferrer">åŸæ–‡æ¥è‡ª</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åœ¨çº¿æ¥æ”¶å›½å¤–éªŒè¯ç çš„è™šæ‹Ÿå·ç æœåŠ¡å¹³å°ï¼Œæ”¯æŒAPIäºŒæ¬¡å¼€å‘~]]></title>    <link>https://juejin.cn/post/7604084016510894121</link>    <guid>https://juejin.cn/post/7604084016510894121</guid>    <pubDate>2026-02-09T06:17:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604084016510894121" data-draft-id="7600602502633488425" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åœ¨çº¿æ¥æ”¶å›½å¤–éªŒè¯ç çš„è™šæ‹Ÿå·ç æœåŠ¡å¹³å°ï¼Œæ”¯æŒAPIäºŒæ¬¡å¼€å‘~"/> <meta itemprop="keywords" content="ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2026-02-09T06:17:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€å¿µæ‚è®°"/> <meta itemprop="url" content="https://juejin.cn/user/3386151546131533"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åœ¨çº¿æ¥æ”¶å›½å¤–éªŒè¯ç çš„è™šæ‹Ÿå·ç æœåŠ¡å¹³å°ï¼Œæ”¯æŒAPIäºŒæ¬¡å¼€å‘~
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3386151546131533/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€å¿µæ‚è®°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T06:17:35.000Z" title="Mon Feb 09 2026 06:17:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å‰å‡ å¤©ç”±äºSMS-Activeå¹³å°è¦åœæœäº†ï¼Œåˆ†äº«äº†ä¸€ä¸‹å¦‚ä½•å°†å‰©ä½™çš„ä½™é¢è½¬ç§»åˆ°æ–°çš„å¹³å°ã€‚</p>
<p>ä»Šå¤©åˆ†äº«çš„å°±æ˜¯æ–°çš„å¹³å°çš„ç®€å•ä½¿ç”¨~</p>
<h2 data-id="heading-0">HeroSMSæ˜¯ä»€ä¹ˆ</h2>
<p>HeroSMSæ˜¯ä¸€ä¸ªå¯ä»¥åœ¨çº¿æ¥æ”¶å›½å¤–æ‰‹æœºéªŒè¯ç çš„å¹³å°ï¼ŒåŒæ—¶æ”¯æŒä½¿ç”¨å¹³å°æä¾›çš„APIè¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œæ­å»ºä¸€ä¸ªç±»ä¼¼å¹³å°æˆ–è€…åˆ©ç”¨æä¾›çš„æœåŠ¡åšåŠŸèƒ½æ‰©å±•ã€‚</p>
<p>å¯ä»¥è¯´HeroSMSçš„å‰èº«å°±æ˜¯SMS-Activeå¹³å°ï¼Œæ¯•ç«Ÿå®˜æ–¹çš„ä»‹ç»å°±æ˜¯ï¼š</p>
<p><strong>æˆ‘ä»¬åŸºäºå¸‚åœºé¢†å¯¼è€… SMS-Activate çš„å¹³å°è¿›è¡Œå‡çº§ä¼˜åŒ–ã€‚éªŒè¯ç å³æ—¶é€è¾¾ï¼Œæ•°æ®ä¼ è¾“å…¨ç¨‹åŠ å¯†ä¿æŠ¤ï¼›</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b62b693339ba45908f0190c9712469bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5b-15p2C6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771222655&amp;x-signature=hqSf%2B3eoNvBhYzPRTosweji7DG4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">HeroSMSçš„ç‰¹ç‚¹</h2>
<ul>
<li>æ”¯æŒå…¨çƒè¶…è¿‡180ä¸ªå›½å®¶çš„éªŒè¯ç æ¥æ”¶æœåŠ¡</li>
<li>æ¯æ—¥å¯æä¾›è¶…è¿‡50ä¸‡ä¸ªå·ç ä¾›ä½¿ç”¨</li>
<li>æä¾›å…¨é¢çš„APIæœåŠ¡ï¼Œæ”¯æŒäºŒæ¬¡å¼€å‘</li>
<li>æ”¯æŒè¶…è¿‡700ä¸ªå¸¸ç”¨ç«™ç‚¹æˆ–è€…åº”ç”¨ç¨‹åºçš„éªŒè¯ç æ¥æ”¶æœåŠ¡</li>
<li>æ”¯æŒåŠ å¯†è´§å¸ç›´æ¥å……å€¼</li>
<li>æŒ‰ç­‰çº§æ”¶è´¹ï¼Œç­‰çº§è¶Šé«˜è´¹ç”¨è¶Šä½ï¼Œé€‚åˆå¤§é‡éœ€æ±‚ç”¨æˆ·</li>
<li>æ”¯æŒæ‹‰æ–°èµšé’±</li>
<li>......</li>
</ul>
<h2 data-id="heading-2">HeroSMSçš„é€‚ç”¨åœºæ™¯</h2>
<ul>
<li>æ— æµ·å¤–SIMå¡ï¼Œæ³¨å†Œæµ·å¤–ç½‘ç«™å’Œåº”ç”¨è´¦æˆ·</li>
<li>ä¸´æ—¶æ¥æ”¶éªŒè¯ç ï¼Œä¸æƒ³æš´éœ²çœŸå®æ‰‹æœºå·</li>
<li>è§„é¿éšç§æ³„éœ²</li>
<li>æ‰¹é‡æ³¨å†Œå¹³å°è´¦æˆ·</li>
<li>æ³¨å†Œæµ‹è¯•è´¦æˆ·</li>
<li>é’ˆå¯¹å¹³å°æ‹‰æ–°è·å–å¥–åŠ±</li>
<li>äºŒæ¬¡å¼€å‘éªŒè¯ç æ¥æ”¶æœåŠ¡</li>
<li>......</li>
</ul>
<h2 data-id="heading-3">HeroSMSæ³¨å†Œ&amp;ç™»å½•</h2>
<p>è¿™ä¸€æ­¥å…¶å®å°±æ˜¯å‚»ç“œå¼æ“ä½œå°±è¡Œäº†ï¼Œç‚¹å‡»å³ä¸Šè§’çš„ç™»å½•æŒ‰é’®ï¼Œæœ‰è´¦æˆ·è¾“å…¥è´¦æˆ·å¯†ç ï¼ŒçœŸäººéªŒè¯åç™»å½•å³å¯ï¼Œæ²¡æœ‰è´¦æˆ·å°±ç‚¹å‡»ä¸‹æ–¹æ³¨å†Œæ–‡å­—æŒ‰é’®è·³è½¬æ³¨å†Œï¼Œè´¦å·æ³¨å†Œåç™»å½•å³å¯ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eba4336308b248999fb86a89174f2b59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5b-15p2C6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771222655&amp;x-signature=nZDOyYusMTGm4jjy%2BDymcl153hc%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf949d52306d4cad85d2ceab40fdcbbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5b-15p2C6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771222655&amp;x-signature=1nB8w8rKOLTRCd0cYhA%2FIcWQNKw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">æ¥æ”¶çŸ­ä¿¡</h2>
<p>ç‚¹å‡»ä¸»é¡µâ€œ<strong>æ¥æ”¶çŸ­ä¿¡</strong>â€æŒ‰é’®ï¼Œè¿›å…¥é¡µé¢é€‰æ‹©ä½ è¦æ”¶å–çŸ­ä¿¡çš„ç›®æ ‡å¹³å°å’Œå›½å®¶åœ°åŒºçš„å·ç ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d299030c91d446c196d3c1f87b44f954~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5b-15p2C6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771222655&amp;x-signature=av%2BwJIlFPZJBbjZJOY6nkmU%2Ff0I%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3472267ebc0344559915002d9a41465f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5b-15p2C6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771222655&amp;x-signature=wzIs1DJv33bbI7RpeIRyc6qhaTU%3D" alt="" loading="lazy"/></p>
<p>ç‚¹å‡»æ•°é‡å³ä¾§çš„å›¾æ ‡å³å¯å®Œæˆé€‰æ‹©ï¼Œé€‰æ‹©åå¦‚æœè¦å–æ¶ˆå¯ä»¥åœ¨2åˆ†é’Ÿåå–æ¶ˆé€‰æ‹©çš„å·ç ã€‚è€Œæ¯æ¬¡é€‰æ‹©çš„å·ç æ¥æ”¶çš„æœ‰æ•ˆæœŸæ˜¯20åˆ†é’Ÿï¼Œæ‰€ä»¥éœ€è¦ä½ åœ¨20åˆ†é’Ÿå†…ï¼Œä½¿ç”¨ç›®æ ‡å¹³å°å‘ç›®æ ‡å·ç å‘é€éªŒè¯ç æ‰è¡Œã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5fa6a6ada8964f1b96d23dba183f273d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5b-15p2C6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771222655&amp;x-signature=sio0MmuxjBq23yx5AvQcYAuLJM8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">ä½¿ç”¨API</h2>
<p>HeroSMSæ”¯æŒä½¿ç”¨APIè¿›è¡ŒäºŒå¼€ï¼Œä½¿ç”¨æ–¹å¼ç‚¹å‡»é¦–é¡µçš„â€œ<strong>è·å–APIå¯†é’¥</strong>â€ï¼Œè¿›å…¥APIç§˜é’¥è·å–é¡µé¢è·å–åç»­APIä½¿ç”¨æ—¶éœ€è¦ç”¨åˆ°çš„å¯†é’¥ä¿¡æ¯ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49a4d7faddd145baabb6f4f3f1b1014c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5b-15p2C6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771222655&amp;x-signature=8Pc5jjlpobmd8DcDMKa8LUN8X38%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba957a6e447a432ca1c5ef47afa3539a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5b-15p2C6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771222655&amp;x-signature=fN3OgYxIbr4QS1Ib%2FvQnsCOGOrk%3D" alt="" loading="lazy"/></p>
<p>ç‚¹å‡»â€œ<strong>ç”ŸæˆAPIå¯†é’¥</strong>â€æŒ‰é’®ï¼Œå¹³å°ä¼šå°†å¯†é’¥è·å–é“¾æ¥é€šè¿‡é‚®ä»¶å‘é€åˆ°ä½ è´¦æˆ·ç»‘å®šçš„é‚®ç®±ä¸­ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab3b1da4e6f84b29b5abad61ae7cd02a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5b-15p2C6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771222655&amp;x-signature=z5Js6Ovx0lHJAc1HU%2BASDfJYfno%3D" alt="" loading="lazy"/></p>
<p>ç‚¹å‡»é‚®ä»¶ä¸­çš„â€œè·å–APIå¯†é’¥â€æŒ‰é’®å°±å¯ä»¥æŸ¥çœ‹åˆ°ä½ çš„å¯†é’¥ä¿¡æ¯äº†ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3dea3da0e4514f63a4e91513251752d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5b-15p2C6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771222655&amp;x-signature=nENFW22G1txFba1DKKIgN4oXTko%3D" alt="" loading="lazy"/></p>
<p>HeroSMSæä¾›äº†è¾ƒä¸ºå®Œå–„çš„APIæ¥å£ä¾›ä½¿ç”¨ï¼Œç‚¹å‡»ä¸»é¡µçš„â€œ<strong>API</strong>â€é€‰é¡¹å³å¯è¿›å…¥APIä¿¡æ¯é¡µé¢äº†ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce418bbd6a684dfeb08c91920259ea68~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5b-15p2C6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771222655&amp;x-signature=FZIERhksTqAsbw2z4%2FUrXnnVGgA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">è´¦æˆ·å……å€¼</h2>
<p>ç™»å½•åç‚¹å‡»å³ä¸Šè§’çš„å……å€¼æŒ‰é’®å°±å¯ä»¥è¿›å…¥å……å€¼æµç¨‹ï¼Œæ”¯æŒæ”¯ä»˜å®å¾®ä¿¡å“Ÿ~</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29706e32efc1493e85557aacabe56803~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5b-15p2C6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771222655&amp;x-signature=IwmaEW8Te%2FS1CBxvHV32fnCehaQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">æœ€å</h2>
<p>ç¨³å®šå¥½ç”¨çš„éªŒè¯ç æ”¶å–å¹³å°ä¸å¤šäº†ï¼Œä¸è®ºæ˜¯å‰èº«çš„SMS-Activeè¿˜æ˜¯ç°åœ¨çš„HeroSMSï¼Œä¸ªäººè®¤ä¸ºéƒ½è¿˜æ˜¯æ¯”è¾ƒç¨³å®šå¥½ç”¨çš„å¹³å°ï¼Œå¦‚æœä½ æœ‰éœ€è¦å¯ä»¥è¯•è¯•~</p>
<h2 data-id="heading-8">æ›´å¤šç²¾å½©å†…å®¹</h2>
<p><a href="https://juejin.cn/post/7597311768730533888" target="_blank" title="https://juejin.cn/post/7597311768730533888">ç™½å«–ç¦åˆ©æ¥äº†ï¼Œå…è´¹è™šæ‹Ÿä¸»æœºæœåŠ¡å™¨é¢†å–è¯¦ç»†æ•™ç¨‹å®ƒåˆæ¥äº†</a></p>
<p><a href="https://juejin.cn/post/7595472747455905807" target="_blank" title="https://juejin.cn/post/7595472747455905807">å®æµ‹æœ‰æ•ˆï¼æ‰‹æŠŠæ‰‹æ•™ä½ å…è´¹é¢†ä¸€å°æœåŠ¡å™¨ï¼Œç¨‹åºå‘˜/åšä¸»å¿…å¤‡</a></p>
<p><a href="https://juejin.cn/post/7459816593230397494" target="_blank" title="https://juejin.cn/post/7459816593230397494">æ—§Androidæ‰‹æœºæ”¹ä¸ªäººæœåŠ¡å™¨ï¼Œä¸éœ€è¦root</a></p>
<p><a href="https://juejin.cn/post/7467043353399672883" target="_blank" title="https://juejin.cn/post/7467043353399672883">æ—§Androidæ‰‹æœºæ”¹ä¸ªäººæœåŠ¡å™¨ï¼Œä¸éœ€è¦rootï¼ˆ2ï¼‰â€”â€”å†…ç½‘ç©¿é€</a></p>
<p><a href="https://juejin.cn/post/7472305493501247503" target="_blank" title="https://juejin.cn/post/7472305493501247503">æ‰‹æœºç§’å˜æ— çº¿ç§»åŠ¨ç¡¬ç›˜ï¼Œç”¨Sambaè½»æ¾å®ç°é«˜é€Ÿæ–‡ä»¶å…±äº«ã€è¿œç¨‹ç¼–è¾‘ï¼</a></p>
<p><a href="https://juejin.cn/post/7480797795785949184" target="_blank" title="https://juejin.cn/post/7480797795785949184">Windowså¯†ç å¿˜è®°äº†å’‹åŠï¼Ÿ1åˆ†é’Ÿå¿«é€Ÿç ´è§£å’Œä¿®æ”¹æŒ‡å—æ¥äº†</a></p>
<p><a href="https://juejin.cn/post/7540184817918476329" target="_blank" title="https://juejin.cn/post/7540184817918476329">ã€å…è´¹å¯å•†ç”¨ç³»åˆ—ã€‘1å°æ—¶å¿«é€Ÿå®Œæˆä¸“å±äºä½ çš„ç½‘ç«™&amp;å°ç¨‹åº&amp;APP&amp;åå°ç®¡ç†ç³»ç»Ÿæ­å»ºï¼Œä½ å€¼å¾—æ‹¥æœ‰~</a></p>
<p><a href="https://juejin.cn/post/7555464418449768475" target="_blank" title="https://juejin.cn/post/7555464418449768475">ã€å®Œå…¨å…è´¹ã€‘è¶…çº§çˆ½çš„å…è´¹å¼€æºæ‰‹æœºç”µè„‘æŠ•å±æ§åˆ¶ç¥å™¨æ¨èï¼ˆ3ï¼‰</a></p>
<p><a href="https://juejin.cn/post/7563209548392316954" target="_blank" title="https://juejin.cn/post/7563209548392316954">ã€å…è´¹ä½¿ç”¨ã€‘å¸¸ç”¨å‡ æ¬¾è¿œç¨‹æ§åˆ¶å·¥å…·æ±‡æ€»å¯¹æ¯”ï¼Œæ€»æœ‰ä¸€æ¬¾é€‚åˆä½ ~</a></p>
<p><a href="https://juejin.cn/post/7563976534441082914" target="_blank" title="https://juejin.cn/post/7563976534441082914">å°ç™½ä¹Ÿä¼šçš„æ—§æ‰‹æœºä¸€é”®å®‰è£…Widnowsç³»ç»Ÿï¼Œè®©ä½ çš„æ‰‹æœºé‡è·æ–°ç”Ÿ</a></p>
<p><a href="https://juejin.cn/post/7571829822339924019" target="_blank" title="https://juejin.cn/post/7571829822339924019">ã€å®Œå…¨å…è´¹ã€‘ä¸ç”¨æœåŠ¡å™¨ã€ä¸ä¹°åŸŸåï¼å…è´¹æ­å»ºä¸“å±ç½‘ç«™ï¼Œæ–°æ‰‹ä¹Ÿèƒ½ 10 åˆ†é’Ÿæå®š</a></p>
<p><a href="https://juejin.cn/post/7587342664077475855" target="_blank" title="https://juejin.cn/post/7587342664077475855">ã€å®æˆ˜ç³»åˆ—ã€‘ä¸€ç¯‡æ–‡ç« æ•™ä½ å¦‚ä½•å¿«é€Ÿä½¿ç”¨LineageOSç¼–è¯‘ä½ æƒ³è¦çš„Androidç‰ˆæœ¬ç³»ç»Ÿï¼ˆé™„æ¨¡æ‹Ÿå™¨é•œåƒç¼–è¯‘ã€å¯åŠ¨ã€ç§»æ¤å®ä¾‹ï¼‰</a></p>
<p><a href="https://juejin.cn/post/7588022226738905138" target="_blank" title="https://juejin.cn/post/7588022226738905138">ã€å®æˆ˜ç³»åˆ—ã€‘å¿«é€Ÿä½¿ç”¨LineageOSè‡ªå®šä¹‰ä½ çš„æ‰‹æœºç³»ç»Ÿï¼ˆé™„å°ç±³6å›ºä»¶ç¼–è¯‘æ­¥éª¤ï¼‰</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯æ€§èƒ½æ€æ‰‹ç«Ÿç„¶ä¸æ˜¯JS?å›¾ç‰‡ä¼˜åŒ–æ‰æ˜¯ç»å¤§å¤šæ•°äººå¿½ç•¥çš„"é™æœ¬å¢æ•ˆ"æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7604045354070638626</link>    <guid>https://juejin.cn/post/7604045354070638626</guid>    <pubDate>2026-02-09T06:03:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604045354070638626" data-draft-id="7603959423129419776" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯æ€§èƒ½æ€æ‰‹ç«Ÿç„¶ä¸æ˜¯JS?å›¾ç‰‡ä¼˜åŒ–æ‰æ˜¯ç»å¤§å¤šæ•°äººå¿½ç•¥çš„&quot;é™æœ¬å¢æ•ˆ&quot;æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-09T06:03:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·3905133219288"/> <meta itemprop="url" content="https://juejin.cn/user/3609051079121550"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯æ€§èƒ½æ€æ‰‹ç«Ÿç„¶ä¸æ˜¯JS?å›¾ç‰‡ä¼˜åŒ–æ‰æ˜¯ç»å¤§å¤šæ•°äººå¿½ç•¥çš„"é™æœ¬å¢æ•ˆ"æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3609051079121550/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·3905133219288
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T06:03:58.000Z" title="Mon Feb 09 2026 06:03:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    34
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å’±ä»¬å…ˆèŠä¸ªæ‰å¿ƒçš„äº‹å®:</p>
<p>ä½ èŠ±ä¸‰å‘¨æ—¶é—´æŠŠ Webpack é…ç½®è°ƒåˆ°æè‡´,Code Splitting æ‹†å¾—æ¯”é¥ºå­é¦…è¿˜ç»†,Tree Shaking æ‘‡å¾—æ¯”ç­›å­è¿˜å‹¤,ç»“æœé¦–å±åŠ è½½æ—¶é—´ä» 3.2 ç§’é™åˆ°äº† 2.9 ç§’ã€‚ä½ æ­£å‡†å¤‡åº†ç¥çš„æ—¶å€™,äº§å“ç»ç†ç»™é¦–å± Banner æ¢äº†ä¸€å¼ "è¶…æ¸…å¤§å›¾",ä¸€ä¸‹å­åˆå›åˆ°äº† 4.1 ç§’ã€‚</p>
<p>è¿™ä¸æ˜¯æ®µå­,è¿™æ˜¯å­—èŠ‚ã€é˜¿é‡Œã€è…¾è®¯çš„å‰ç«¯å¤©å¤©é‡åˆ°çš„çœŸå®åœºæ™¯ã€‚</p>
<p><strong>å›¾ç‰‡æ‰æ˜¯ç°ä»£ Web åº”ç”¨é‡Œæœ€é‡çš„èµ„æº,æ²¡æœ‰ä¹‹ä¸€ã€‚</strong></p>
<p>ä½†ç»å¤§å¤šæ•°å‰ç«¯å·¥ç¨‹å¸ˆå¯¹å›¾ç‰‡ä¼˜åŒ–çš„è®¤çŸ¥è¿˜åœç•™åœ¨"ç”¨ WebP"ã€"å¼€å¯ CDN å‹ç¼©"è¿™ç§è¡¨å±‚æ“ä½œã€‚çœŸæ­£èƒ½æŠŠå›¾ç‰‡ä¼˜åŒ–åšåˆ°æè‡´çš„,å¾€å¾€æ˜¯é‚£äº›ç†è§£æµè§ˆå™¨æ¸²æŸ“æœºåˆ¶ã€æ‡‚ç½‘ç»œåè®®ã€ä¼šå†™ JavaScript è¿è¡Œæ—¶ä¼˜åŒ–çš„"æ‚å®¶"ã€‚
ä»Šå¤©è¿™ç¯‡æ–‡ç« ,å’±ä»¬å°±ä»Â <strong>JavaScript çš„è§†è§’</strong>æ¥é‡æ–°å®¡è§†å›¾ç‰‡ä¼˜åŒ–,ç”¨ä»£ç æŠŠé‚£äº›æ¨¡ç³Šçš„"æœ€ä½³å®è·µ"å˜æˆå¯è½åœ°çš„å·¥ç¨‹æ–¹æ¡ˆã€‚</p>
<h2 data-id="heading-0">ç¬¬ä¸€å±‚:æ‡’åŠ è½½ä¸æ˜¯è®¾ä¸ª loading="lazy" å°±å®Œäº‹äº†</h2>
<h3 data-id="heading-1">åŸç”Ÿæ‡’åŠ è½½çš„å±€é™æ€§</h3>
<p>å¾ˆå¤šäººä»¥ä¸ºå›¾ç‰‡æ‡’åŠ è½½å°±æ˜¯è¿™æ ·:</p>
<pre><code class="hljs language-ini" lang="ini">&lt;imgÂ <span class="hljs-attr">src</span>=<span class="hljs-string">"photo.jpg"</span>Â loading=<span class="hljs-string">"lazy"</span>&gt;
</code></pre>
<p>æµè§ˆå™¨ç¡®å®ä¼šå¸®ä½ å»¶è¿ŸåŠ è½½,ä½†è¿™ä¸ªç­–ç•¥<strong>å®Œå…¨ä¸å—ä½ æ§åˆ¶</strong>ã€‚æµè§ˆå™¨å†³å®šä»€ä¹ˆæ—¶å€™åŠ è½½,ä½ åªèƒ½æ¥å—ã€‚</p>
<p>çœŸæ­£çš„æ‡’åŠ è½½ç­–ç•¥åº”è¯¥æ˜¯:<strong>åœ¨å›¾ç‰‡è¿›å…¥è§†å£å‰ 200-500px å°±å¼€å§‹é¢„åŠ è½½</strong>,è¿™æ ·ç”¨æˆ·æ»šåŠ¨åˆ°ä½ç½®æ—¶å›¾ç‰‡å·²ç»å‡†å¤‡å¥½äº†,æ—¢èŠ‚çœäº†å¸¦å®½åˆä¿è¯äº†ä½“éªŒã€‚</p>
<h3 data-id="heading-2">JavaScript æ¥ç®¡æ§åˆ¶æƒ</h3>
<p>è¿™æ—¶å€™ JavaScript çš„Â <code>IntersectionObserver</code>Â API å°±æ´¾ä¸Šç”¨åœºäº†:</p>
<pre><code class="hljs language-ini" lang="ini">// åˆ›å»ºä¸€ä¸ªè§‚å¯Ÿå™¨,æå‰ 200px å¼€å§‹åŠ è½½
constÂ <span class="hljs-attr">lazyObserver</span> =Â newÂ IntersectionObserver(
(entries) =&gt;Â {
Â  Â  entries.forEach(<span class="hljs-attr">entry</span>Â =&gt;Â {
Â  Â  Â Â ifÂ (!entry.isIntersecting)Â return<span class="hljs-comment">;</span>
Â  Â  Â Â 
Â  Â  Â Â constÂ <span class="hljs-attr">img</span> = entry.target<span class="hljs-comment">;</span>
Â  Â  Â Â constÂ <span class="hljs-attr">realSrc</span> = img.dataset.src<span class="hljs-comment">;</span>
Â  Â  Â Â 
Â  Â  Â Â // å¼€å§‹åŠ è½½çœŸå®å›¾ç‰‡
Â  Â  Â  <span class="hljs-attr">img.src</span> = realSrc<span class="hljs-comment">;</span>
Â  Â  Â Â 
Â  Â  Â Â // åŠ è½½å®Œæˆååœæ­¢è§‚å¯Ÿ
Â  Â  Â  <span class="hljs-attr">img.onload</span> =Â ()Â =&gt;Â {
Â  Â  Â  Â  img.classList.add('loaded')<span class="hljs-comment">;</span>
Â  Â  Â  Â  lazyObserver.unobserve(img)<span class="hljs-comment">;</span>
Â  Â  Â  }<span class="hljs-comment">;</span>
Â  Â  })<span class="hljs-comment">;</span>
Â  },
Â  {
Â  Â Â // å…³é”®å‚æ•°:æå‰ 200px è§¦å‘
Â  Â Â rootMargin:Â '200px 0px'
Â  }
)<span class="hljs-comment">;</span>

// æ‰¹é‡è§‚å¯Ÿæ‰€æœ‰å¾…åŠ è½½å›¾ç‰‡
document.querySelectorAll('img<span class="hljs-section">[data-src]</span>').forEach(<span class="hljs-attr">img</span>Â =&gt;Â {
Â  lazyObserver.observe(img)<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
</code></pre>
<p><strong>å·¥ä½œæµç¨‹å›¾:</strong></p>
<pre><code class="hljs language-css" lang="css">ç”¨æˆ·æ»šåŠ¨é¡µé¢
Â  Â  Â â†“
å›¾ç‰‡è·ç¦»è§†å£è¿˜æœ‰ <span class="hljs-number">200px</span>
Â  Â  Â â†“
IntersectionObserver è§¦å‘å›è°ƒ
Â  Â  Â â†“
JavaScript å°† data-<span class="hljs-attribute">src</span> èµ‹å€¼ç»™ <span class="hljs-attribute">src</span>
Â  Â  Â â†“
æµè§ˆå™¨å¼€å§‹ä¸‹è½½å›¾ç‰‡
Â  Â  Â â†“
ç”¨æˆ·æ»šåŠ¨åˆ°å›¾ç‰‡ä½ç½®æ—¶
Â  Â  Â â†“
å›¾ç‰‡å·²ç»åŠ è½½å®Œæˆ âœ…
</code></pre>
<p>è¿™ç§æ–¹å¼åœ¨ç”µå•†ç½‘ç«™çš„å•†å“åˆ—è¡¨é¡µç‰¹åˆ«æœ‰æ•ˆã€‚ä»¥æŸå¤´éƒ¨ç”µå•†å¹³å°ä¸ºä¾‹,ä»–ä»¬çš„å•†å“å›¾åœ¨åˆ—è¡¨ä¸­ä½¿ç”¨ 1px å ä½ç¬¦,æ»šåŠ¨åˆ°è·ç¦»è§†å£ 300px æ—¶æ‰å¼€å§‹åŠ è½½çœŸå›¾,<strong>é¦–å±å›¾ç‰‡è¯·æ±‚æ•°ä» 50 å¼ é™åˆ° 12 å¼ </strong>,é¦–å±æ¸²æŸ“æ—¶é—´ç›´æ¥ç åŠã€‚</p>
<h3 data-id="heading-3">é™çº§ç­–ç•¥</h3>
<p>ä½†é—®é¢˜æ¥äº†:è€æµè§ˆå™¨ä¸æ”¯æŒ IntersectionObserver æ€ä¹ˆåŠ?</p>
<p>ç­”æ¡ˆæ˜¯æ¸è¿›å¢å¼º:</p>
<pre><code class="hljs language-ini" lang="ini">// æ£€æµ‹ API æ”¯æŒæƒ…å†µ
ifÂ ('IntersectionObserver'Â inÂ window) {
Â Â // ä½¿ç”¨é«˜çº§ç­–ç•¥
Â  lazyObserver.observe(img)<span class="hljs-comment">;</span>
}Â elseÂ {
Â Â // é™çº§åˆ°åŸç”Ÿæ‡’åŠ è½½
Â  <span class="hljs-attr">img.loading</span> =Â <span class="hljs-string">'lazy'</span><span class="hljs-comment">;</span>
Â  <span class="hljs-attr">img.src</span> = img.dataset.src<span class="hljs-comment">;</span>
}
</code></pre>
<h2 data-id="heading-4">ç¬¬äºŒå±‚:æ ¹æ®è®¾å¤‡å’Œç½‘ç»œåŠ¨æ€é€‰æ‹©å›¾ç‰‡</h2>
<h3 data-id="heading-5">å±å¹•åˆ†è¾¨ç‡ä¸ç­‰äºå›¾ç‰‡å°ºå¯¸</h3>
<p>å¾ˆå¤šäººä»¥ä¸ºå“åº”å¼å›¾ç‰‡å°±æ˜¯å†™å‡ ä¸ªÂ <code>srcset</code>:</p>
<pre><code class="hljs language-ini" lang="ini">&lt;imgÂ <span class="hljs-attr">srcset</span>=<span class="hljs-string">"small.jpg 480w, medium.jpg 800w, large.jpg 1200w"</span>&gt;
</code></pre>
<p>ä½†è¿™åªè€ƒè™‘äº†å±å¹•å®½åº¦,æ²¡è€ƒè™‘ DPR(è®¾å¤‡åƒç´ æ¯”)ã€‚iPhone 14 Pro çš„å±å¹•å®½åº¦æ˜¯ 393px,ä½† DPR æ˜¯ 3,å®é™…éœ€è¦çš„å›¾ç‰‡å®½åº¦æ˜¯Â <strong>393 Ã— 3 = 1179px</strong>ã€‚</p>
<p>ç”¨ JavaScript åŠ¨æ€è®¡ç®—æ‰æ˜¯æ­£è§£:</p>
<pre><code class="hljs language-ini" lang="ini">functionÂ calculateOptimalImageWidth()Â {
// è·å–è®¾å¤‡åƒç´ æ¯”,é»˜è®¤ä¸º 1
constÂ <span class="hljs-attr">dpr</span> =Â window.devicePixelRatio ||Â <span class="hljs-number">1</span><span class="hljs-comment">;</span>

// è·å–è§†å£å®½åº¦,é™åˆ¶æœ€å¤§å€¼é¿å…è¿‡å¤§
constÂ <span class="hljs-attr">viewportWidth</span> =Â Math.min(window.innerWidth,Â <span class="hljs-number">1920</span>)<span class="hljs-comment">;</span>

// è®¡ç®—å®é™…éœ€è¦çš„ç‰©ç†åƒç´ å®½åº¦
constÂ <span class="hljs-attr">physicalWidth</span> =Â Math.ceil(viewportWidth * dpr)<span class="hljs-comment">;</span>

returnÂ physicalWidth<span class="hljs-comment">;</span>
}

// ä½¿ç”¨ç¤ºä¾‹
constÂ <span class="hljs-attr">heroImage</span> =Â document.querySelector(<span class="hljs-string">'.hero-banner'</span>)<span class="hljs-comment">;</span>
constÂ <span class="hljs-attr">optimalWidth</span> = calculateOptimalImageWidth()<span class="hljs-comment">;</span>

// å‘ CDN è¯·æ±‚å¯¹åº”å°ºå¯¸çš„å›¾ç‰‡
<span class="hljs-attr">heroImage.src</span> =Â `https://cdn.example.com/hero.jpg?w=<span class="hljs-variable">${optimalWidth}</span>`<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-6">Network Information API:æ ¹æ®ç½‘ç»œé™çº§</h3>
<p>ç°åœ¨è¿›é˜¶ä¸€æ­¥:<strong>æ ¹æ®ç”¨æˆ·çš„ç½‘ç»œçŠ¶å†µåŠ¨æ€è°ƒæ•´å›¾ç‰‡è´¨é‡</strong>ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span>Â <span class="hljs-title function_">getImageQuality</span>(<span class="hljs-params"/>)Â {
<span class="hljs-comment">// æ£€æµ‹ Network Information API æ”¯æŒ</span>
<span class="hljs-keyword">const</span>Â connection = navigator.<span class="hljs-property">connection</span> ||Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â navigator.<span class="hljs-property">mozConnection</span> ||Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â navigator.<span class="hljs-property">webkitConnection</span>;

<span class="hljs-keyword">if</span>Â (!connection)Â return80;Â <span class="hljs-comment">// é»˜è®¤è´¨é‡</span>

<span class="hljs-comment">// ç”¨æˆ·å¼€å¯äº†æµé‡èŠ‚çœæ¨¡å¼</span>
<span class="hljs-keyword">if</span>Â (connection.<span class="hljs-property">saveData</span>) {
Â  Â Â <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç”¨æˆ·å¼€å¯çœæµæ¨¡å¼,é™ä½å›¾ç‰‡è´¨é‡'</span>);
Â  Â Â return40;
Â  }

<span class="hljs-comment">// æ ¹æ®ç½‘ç»œç±»å‹è°ƒæ•´è´¨é‡</span>
<span class="hljs-keyword">const</span>Â effectiveType = connection.<span class="hljs-property">effectiveType</span>;

<span class="hljs-keyword">const</span>Â qualityMap = {
Â  Â Â <span class="hljs-string">'slow-2g'</span>:Â <span class="hljs-number">30</span>,
Â  Â Â <span class="hljs-string">'2g'</span>:Â <span class="hljs-number">30</span>,
Â  Â Â <span class="hljs-string">'3g'</span>:Â <span class="hljs-number">60</span>,
Â  Â Â <span class="hljs-string">'4g'</span>:Â <span class="hljs-number">80</span>,
Â  Â Â <span class="hljs-string">'5g'</span>:Â <span class="hljs-number">90</span>
Â  };

<span class="hljs-keyword">return</span>Â qualityMap[effectiveType] ||Â <span class="hljs-number">80</span>;
}

<span class="hljs-comment">// å®Œæ•´çš„å›¾ç‰‡åŠ è½½ç­–ç•¥</span>
<span class="hljs-keyword">function</span>Â <span class="hljs-title function_">loadSmartImage</span>(<span class="hljs-params">imageElement</span>)Â {
<span class="hljs-keyword">const</span>Â width = <span class="hljs-title function_">calculateOptimalImageWidth</span>();
<span class="hljs-keyword">const</span>Â quality = <span class="hljs-title function_">getImageQuality</span>();

<span class="hljs-keyword">const</span>Â imageUrl =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title function_">URL</span>(imageElement.<span class="hljs-property">dataset</span>.<span class="hljs-property">src</span>);
Â  imageUrl.<span class="hljs-property">searchParams</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">'w'</span>, width);
Â  imageUrl.<span class="hljs-property">searchParams</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">'q'</span>, quality);

Â  imageElement.<span class="hljs-property">src</span> = imageUrl.<span class="hljs-title function_">toString</span>();

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`åŠ è½½å›¾ç‰‡: å®½åº¦=<span class="hljs-subst">${width}</span>px, è´¨é‡=<span class="hljs-subst">${quality}</span>`</span>);
}
</code></pre>
<p><strong>çœŸå®åœºæ™¯:</strong></p>
<p>æŸçŸ­è§†é¢‘ App çš„ç§»åŠ¨ç«¯ Web ç‰ˆ,ç”¨æˆ·åœ¨åœ°é“é‡Œç”¨ 4G æµè§ˆæ—¶,å›¾ç‰‡è´¨é‡é»˜è®¤ 80%;ä¸€è¿›éš§é“åˆ‡åˆ° 3G,ç«‹åˆ»é™åˆ° 60%;ç”¨æˆ·ä¸»åŠ¨å¼€å¯çœæµæ¨¡å¼,ç›´æ¥é™åˆ° 40%ã€‚è¿™å¥—ç­–ç•¥è®©ä»–ä»¬çš„<strong>å›¾ç‰‡æµé‡æ¶ˆè€—é™ä½äº† 35%</strong> ,ç”¨æˆ·æŠ•è¯‰"è´¹æµé‡"çš„å·¥å•å‡å°‘äº†ä¸€åŠã€‚</p>
<h2 data-id="heading-7">ç¬¬ä¸‰å±‚:è§£ç ä¼˜å…ˆçº§,åˆ«è®©å›¾ç‰‡é˜»å¡æ¸²æŸ“</h2>
<h3 data-id="heading-8">å›¾ç‰‡è§£ç æ˜¯æ€§èƒ½æ€æ‰‹</h3>
<p>å¾ˆå¤šäººä¸çŸ¥é“çš„å†·çŸ¥è¯†:<strong>æµè§ˆå™¨ä¸‹è½½å›¾ç‰‡å’Œè§£ç å›¾ç‰‡æ˜¯ä¸¤å›äº‹</strong>ã€‚</p>
<p>ä¸€å¼  500KB çš„ JPEG,ä¸‹è½½å¯èƒ½åªè¦ 200ms,ä½†è§£ç å¯èƒ½è¦ 800msã€‚å¦‚æœä½ åœ¨é¦–å±åŒæ—¶åŠ è½½ 10 å¼ å¤§å›¾,è§£ç ä¼š<strong>å®Œå…¨é˜»å¡ä¸»çº¿ç¨‹</strong>,å¯¼è‡´é¡µé¢å¡é¡¿ã€‚</p>
<h3 data-id="heading-9">å¼‚æ­¥è§£ç æ•‘å‘½</h3>
<p>JavaScript æä¾›äº†Â <code>decoding</code>Â å±æ€§æ¥æ§åˆ¶è§£ç ç­–ç•¥:</p>
<pre><code class="hljs language-ini" lang="ini">// é¦–å±å…³é”®å›¾ç‰‡:åŒæ­¥è§£ç ,ä¼˜å…ˆæ˜¾ç¤º
constÂ <span class="hljs-attr">heroImage</span> =Â document.querySelector(<span class="hljs-string">'.hero'</span>)<span class="hljs-comment">;</span>
<span class="hljs-attr">heroImage.decoding</span> =Â <span class="hljs-string">'sync'</span><span class="hljs-comment">; Â  Â Â // ç«‹å³è§£ç </span>
<span class="hljs-attr">heroImage.fetchPriority</span> =Â <span class="hljs-string">'high'</span><span class="hljs-comment">;Â // é«˜ä¼˜å…ˆçº§ä¸‹è½½</span>

// éå…³é”®å›¾ç‰‡:å¼‚æ­¥è§£ç ,ä¸é˜»å¡æ¸²æŸ“
constÂ <span class="hljs-attr">thumbnails</span> =Â document.querySelectorAll(<span class="hljs-string">'.thumbnail'</span>)<span class="hljs-comment">;</span>
thumbnails.forEach(<span class="hljs-attr">img</span>Â =&gt;Â {
Â  <span class="hljs-attr">img.decoding</span> =Â <span class="hljs-string">'async'</span><span class="hljs-comment">; Â  Â  Â  Â Â // å¼‚æ­¥è§£ç </span>
Â  <span class="hljs-attr">img.fetchPriority</span> =Â <span class="hljs-string">'low'</span><span class="hljs-comment">; Â  Â  Â // ä½ä¼˜å…ˆçº§</span>
})<span class="hljs-comment">;</span>
</code></pre>
<p><strong>è§£ç ç­–ç•¥å¯¹æ¯”:</strong></p>
<pre><code class="hljs language-dart" lang="dart">åŒæ­¥è§£ç  (<span class="hljs-keyword">sync</span>):
ä¸‹è½½å›¾ç‰‡ â†’ é˜»å¡ä¸»çº¿ç¨‹ â†’ è§£ç å®Œæˆ â†’ æ¸²æŸ“é¡µé¢
Â  Â  â†“
ä¸»çº¿ç¨‹è¢«å ç”¨,é¡µé¢å¡é¡¿ âŒ

å¼‚æ­¥è§£ç  (<span class="hljs-keyword">async</span>):
ä¸‹è½½å›¾ç‰‡ â†’ ä¸é˜»å¡ â†’ åå°è§£ç  â†’ è§£ç å®Œæˆåæ¸²æŸ“
Â  Â  â†“
ä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œ,é¡µé¢æµç•… âœ…
</code></pre>
<h3 data-id="heading-10">é¢„åŠ è½½å›¾ç‰‡è·å–å°ºå¯¸</h3>
<p>è¿˜æœ‰ä¸€ä¸ªé«˜çº§æŠ€å·§:<strong>åœ¨æ’å…¥ DOM å‰é¢„åŠ è½½å›¾ç‰‡,æå‰è·å–å®½é«˜æ¯”,é¿å… CLS(ç´¯ç§¯å¸ƒå±€åç§»)</strong>ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">asyncÂ functionÂ preloadImageWithDimensions(src)Â {
returnnewPromise((resolve, reject) =&gt;Â {
Â  Â Â constÂ <span class="hljs-attr">img</span> =Â newÂ Image()<span class="hljs-comment">;</span>
Â  Â Â 
Â  Â  <span class="hljs-attr">img.onload</span> =Â ()Â =&gt;Â {
Â  Â  Â  resolve({
Â  Â  Â  Â Â element: img,
Â  Â  Â  Â Â width: img.naturalWidth,
Â  Â  Â  Â Â height: img.naturalHeight,
Â  Â  Â  Â Â aspectRatio: img.naturalWidth / img.naturalHeight
Â  Â  Â  })<span class="hljs-comment">;</span>
Â  Â  }<span class="hljs-comment">;</span>
Â  Â Â 
Â  Â  <span class="hljs-attr">img.onerror</span> = reject<span class="hljs-comment">;</span>
Â  Â  <span class="hljs-attr">img.src</span> = src<span class="hljs-comment">;</span>
Â  })<span class="hljs-comment">;</span>
}

// ä½¿ç”¨ç¤ºä¾‹
constÂ <span class="hljs-attr">imageData</span> =Â awaitÂ preloadImageWithDimensions(<span class="hljs-string">'/photo.jpg'</span>)<span class="hljs-comment">;</span>

// æå‰è®¾ç½®å®½é«˜æ¯”,é¿å…å¸ƒå±€åç§»
constÂ <span class="hljs-attr">container</span> =Â document.querySelector(<span class="hljs-string">'.image-container'</span>)<span class="hljs-comment">;</span>
<span class="hljs-attr">container.style.aspectRatio</span> = imageData.aspectRatio<span class="hljs-comment">;</span>

// å›¾ç‰‡å·²ç»åŠ è½½å®Œæˆ,ç›´æ¥æ’å…¥
container.appendChild(imageData.element)<span class="hljs-comment">;</span>
</code></pre>
<p>è¿™æ‹›åœ¨åŠ¨æ€ç”Ÿæˆå†…å®¹çš„åœºæ™¯ç‰¹åˆ«æœ‰ç”¨,æ¯”å¦‚ç”¨æˆ·ä¸Šä¼ å¤´åƒã€ç”Ÿæˆåˆ†äº«æµ·æŠ¥ç­‰,å¯ä»¥å®Œå…¨é¿å…"å›¾ç‰‡åŠ è½½åé¡µé¢çªç„¶è·³åŠ¨"çš„é—®é¢˜ã€‚</p>
<h2 data-id="heading-11">ç¬¬å››å±‚:å®¢æˆ·ç«¯å‹ç¼©,ä¸Šä¼ å‰å°±ä¼˜åŒ–</h2>
<h3 data-id="heading-12">ä¸ºä»€ä¹ˆè¦åœ¨å‰ç«¯å‹ç¼©å›¾ç‰‡?</h3>
<p>ä¼ ç»Ÿæ€è·¯æ˜¯:ç”¨æˆ·ä¸Šä¼  â†’ æœåŠ¡ç«¯å‹ç¼© â†’ å­˜å‚¨åˆ° CDNã€‚</p>
<p>ä½†è¿™æœ‰å‡ ä¸ªé—®é¢˜:</p>
<ol>
<li><strong>ç”¨æˆ·ä¸Šä¼  10MB åŸå›¾,æµé‡æµªè´¹</strong></li>
<li><strong>æœåŠ¡ç«¯è¦å¤„ç†å¤§é‡å‹ç¼©ä»»åŠ¡,CPU æˆæœ¬é«˜</strong></li>
<li><strong>ç”¨æˆ·è¦ç­‰æœåŠ¡ç«¯å¤„ç†å®Œæ‰èƒ½çœ‹åˆ°é¢„è§ˆ</strong></li>
</ol>
<p>æ›´å¥½çš„æ–¹æ¡ˆæ˜¯:<strong>å‰ç«¯ç›´æ¥å‹ç¼©,ä¸Šä¼ å‹ç¼©åçš„å›¾ç‰‡</strong>ã€‚</p>
<h3 data-id="heading-13">Canvas API + OffscreenCanvas</h3>
<p>JavaScript çš„ Canvas API å¯ä»¥å®ç°å®¢æˆ·ç«¯å‹ç¼©:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span>Â <span class="hljs-keyword">function</span>Â <span class="hljs-title function_">compressImageOnClient</span>(<span class="hljs-params">file, maxWidth =Â <span class="hljs-number">1920</span></span>)Â {
<span class="hljs-comment">// ä½¿ç”¨ createImageBitmap è¯»å–æ–‡ä»¶</span>
<span class="hljs-keyword">const</span>Â bitmap =Â <span class="hljs-keyword">await</span>Â <span class="hljs-title function_">createImageBitmap</span>(file);

<span class="hljs-comment">// è®¡ç®—ç¼©æ”¾æ¯”ä¾‹</span>
<span class="hljs-keyword">const</span>Â scale =Â <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-number">1</span>, maxWidth / bitmap.<span class="hljs-property">width</span>);
<span class="hljs-keyword">const</span>Â newWidth =Â <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(bitmap.<span class="hljs-property">width</span> * scale);
<span class="hljs-keyword">const</span>Â newHeight =Â <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(bitmap.<span class="hljs-property">height</span> * scale);

<span class="hljs-comment">// ä½¿ç”¨ OffscreenCanvas å¤„ç†,ä¸é˜»å¡ä¸»çº¿ç¨‹</span>
<span class="hljs-keyword">const</span>Â canvas =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">OffscreenCanvas</span>(newWidth, newHeight);
<span class="hljs-keyword">const</span>Â ctx = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">'2d'</span>);

<span class="hljs-comment">// ç»˜åˆ¶ç¼©æ”¾åçš„å›¾ç‰‡</span>
Â  ctx.<span class="hljs-title function_">drawImage</span>(bitmap,Â <span class="hljs-number">0</span>,Â <span class="hljs-number">0</span>, newWidth, newHeight);

<span class="hljs-comment">// è½¬æ¢ä¸º WebP æ ¼å¼,è´¨é‡ 0.8</span>
<span class="hljs-keyword">const</span>Â blob =Â <span class="hljs-keyword">await</span>Â canvas.<span class="hljs-title function_">convertToBlob</span>({
Â  Â Â <span class="hljs-attr">type</span>:Â <span class="hljs-string">'image/webp'</span>,
Â  Â Â <span class="hljs-attr">quality</span>:Â <span class="hljs-number">0.8</span>
Â  });

<span class="hljs-keyword">return</span>Â blob;
}

<span class="hljs-comment">// ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡æ—¶è§¦å‘</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#upload'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'change'</span>,Â <span class="hljs-keyword">async</span>Â (e) =&gt; {
<span class="hljs-keyword">const</span>Â file = e.<span class="hljs-property">target</span>.<span class="hljs-property">files</span>[<span class="hljs-number">0</span>];

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`åŸå§‹æ–‡ä»¶:Â <span class="hljs-subst">${(file.sizeÂ / <span class="hljs-number">1024</span> /Â <span class="hljs-number">1024</span>).toFixed(<span class="hljs-number">2</span>)}</span>Â MB`</span>);

<span class="hljs-comment">// å‰ç«¯å‹ç¼©</span>
<span class="hljs-keyword">const</span>Â compressed =Â <span class="hljs-keyword">await</span>Â <span class="hljs-title function_">compressImageOnClient</span>(file,Â <span class="hljs-number">1920</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`å‹ç¼©å:Â <span class="hljs-subst">${(compressed.sizeÂ / <span class="hljs-number">1024</span> /Â <span class="hljs-number">1024</span>).toFixed(<span class="hljs-number">2</span>)}</span>Â MB`</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`å‹ç¼©ç‡:Â <span class="hljs-subst">${((<span class="hljs-number">1</span>Â - compressed.sizeÂ / file.size) * <span class="hljs-number">100</span>).toFixed(<span class="hljs-number">1</span>)}</span>%`</span>);
Â Â 
Â  <span class="hljs-comment">// ä¸Šä¼ å‹ç¼©åçš„å›¾ç‰‡</span>
Â  <span class="hljs-title function_">uploadToServer</span>(compressed);
});
</code></pre>
<p><strong>å®æµ‹æ•°æ®(iPhone æ‹æ‘„çš„ç…§ç‰‡):</strong></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">åŸå§‹æ–‡ä»¶: 8.3 MB (4032 Ã— 3024, JPEG)</span>
Â  Â  Â â†“
å‰ç«¯å‹ç¼© (1920px, WebP, quality=0.8)
Â  Â  Â â†“
<span class="hljs-section">å‹ç¼©å: 0.6 MB</span>
<span class="hljs-section">å‹ç¼©ç‡: 92.8% âœ…</span>
</code></pre>
<h3 data-id="heading-14">Web Worker ä¼˜åŒ–</h3>
<p>å¦‚æœè¦å¤„ç†å¤šå¼ å›¾ç‰‡,å¯ä»¥ç”¨ Web Worker é¿å…é˜»å¡ä¸»çº¿ç¨‹:</p>
<pre><code class="hljs language-ini" lang="ini">// imageCompressor.worker.js
self.addEventListener('message',Â asyncÂ (e) =&gt; {
constÂ { file, maxWidth } = e.data<span class="hljs-comment">;</span>

constÂ <span class="hljs-attr">bitmap</span> =Â awaitÂ createImageBitmap(file)<span class="hljs-comment">;</span>
constÂ <span class="hljs-attr">scale</span> =Â Math.min(<span class="hljs-number">1</span>, maxWidth / bitmap.width)<span class="hljs-comment">;</span>

constÂ <span class="hljs-attr">canvas</span> =Â newÂ <span class="hljs-literal">Off</span>screenCanvas(
Â  Â Â Math.floor(bitmap.width * scale),
Â  Â Â Math.floor(bitmap.height * scale)
Â  )<span class="hljs-comment">;</span>

constÂ <span class="hljs-attr">ctx</span> = canvas.getContext(<span class="hljs-string">'2d'</span>)<span class="hljs-comment">;</span>
Â  ctx.drawImage(bitmap,Â 0,Â 0, canvas.width, canvas.height)<span class="hljs-comment">;</span>

constÂ <span class="hljs-attr">blob</span> =Â awaitÂ canvas.convertToBlob({
Â  Â Â type:Â 'image/webp',
Â  Â Â quality:Â 0.8
Â  })<span class="hljs-comment">;</span>

// å‘é€å›ä¸»çº¿ç¨‹
Â  self.postMessage({ blob,Â originalSize: file.size })<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>

// ä¸»çº¿ç¨‹ä½¿ç”¨
constÂ <span class="hljs-attr">worker</span> =Â newÂ Worker(<span class="hljs-string">'imageCompressor.worker.js'</span>)<span class="hljs-comment">;</span>

worker.postMessage({Â file: uploadedFile,Â maxWidth:Â 1920Â })<span class="hljs-comment">;</span>

<span class="hljs-attr">worker.onmessage</span> =Â (e) =&gt;Â {
constÂ { blob, originalSize } = e.data<span class="hljs-comment">;</span>
constÂ <span class="hljs-attr">ratio</span> = ((<span class="hljs-number">1</span>Â - blob.size / originalSize) *Â <span class="hljs-number">100</span>).toFixed(<span class="hljs-number">1</span>)<span class="hljs-comment">;</span>
console.log(`å‹ç¼©å®Œæˆ,èŠ‚çœÂ ${ratio}% æµé‡`)<span class="hljs-comment">;</span>

Â  uploadToServer(blob)<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>
</code></pre>
<p>æŸç¤¾äº¤å¹³å°ç”¨äº†è¿™å¥—æ–¹æ¡ˆå,<strong>ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡çš„æµé‡æˆæœ¬é™ä½äº† 87%</strong> ,æœåŠ¡ç«¯ CPU ä½¿ç”¨ç‡é™ä½äº† 60%ã€‚</p>
<h2 data-id="heading-15">ç¬¬äº”å±‚:Cache API è®©å›¾ç‰‡çœŸæ­£"åªåŠ è½½ä¸€æ¬¡"</h2>
<h3 data-id="heading-16">HTTP ç¼“å­˜çš„å±€é™</h3>
<p>æµè§ˆå™¨çš„ HTTP ç¼“å­˜å¾ˆå¥½,ä½†æœ‰ä¸ªé—®é¢˜:<strong>ç¼“å­˜ç­–ç•¥å®Œå…¨ç”±æœåŠ¡ç«¯æ§åˆ¶</strong>,è€Œä¸”åœ¨éšç§æ¨¡å¼ä¸‹ä¼šå¤±æ•ˆã€‚</p>
<p>æ›´æ¿€è¿›çš„æ–¹æ¡ˆæ˜¯ç”¨Â <strong>Cache API</strong>Â æ‰‹åŠ¨ç®¡ç†å›¾ç‰‡ç¼“å­˜:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span>Â <span class="hljs-variable constant_">IMAGE_CACHE_NAME</span> =Â <span class="hljs-string">'image-cache-v1'</span>;

<span class="hljs-comment">// ç¼“å­˜å›¾ç‰‡</span>
<span class="hljs-keyword">async</span><span class="hljs-keyword">function</span>Â <span class="hljs-title function_">cacheImage</span>(<span class="hljs-params">url</span>)Â {
<span class="hljs-keyword">const</span>Â cache =Â <span class="hljs-keyword">await</span>Â caches.<span class="hljs-title function_">open</span>(<span class="hljs-variable constant_">IMAGE_CACHE_NAME</span>);

<span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦å·²ç¼“å­˜</span>
<span class="hljs-keyword">const</span>Â cached =Â <span class="hljs-keyword">await</span>Â cache.<span class="hljs-title function_">match</span>(url);
<span class="hljs-keyword">if</span>Â (cached) {
Â  Â Â <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`å‘½ä¸­ç¼“å­˜:Â <span class="hljs-subst">${url}</span>`</span>);
Â  Â Â <span class="hljs-keyword">return</span>Â cached;
Â  }

<span class="hljs-comment">// æœªç¼“å­˜,ç«‹å³ä¸‹è½½</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ä¸‹è½½å¹¶ç¼“å­˜:Â <span class="hljs-subst">${url}</span>`</span>);
<span class="hljs-keyword">const</span>Â response =Â <span class="hljs-keyword">await</span>Â <span class="hljs-title function_">fetch</span>(url);

<span class="hljs-comment">// åªç¼“å­˜æˆåŠŸçš„å“åº”</span>
<span class="hljs-keyword">if</span>Â (response.<span class="hljs-property">ok</span>) {
Â  Â Â <span class="hljs-keyword">await</span>Â cache.<span class="hljs-title function_">put</span>(url, response.<span class="hljs-title function_">clone</span>());
Â  }

<span class="hljs-keyword">return</span>Â response;
}

<span class="hljs-comment">// åŠ è½½å›¾ç‰‡æ—¶ä½¿ç”¨ç¼“å­˜</span>
<span class="hljs-keyword">async</span><span class="hljs-keyword">function</span>Â <span class="hljs-title function_">loadImageWithCache</span>(<span class="hljs-params">imgElement</span>)Â {
<span class="hljs-keyword">const</span>Â url = imgElement.<span class="hljs-property">dataset</span>.<span class="hljs-property">src</span>;

<span class="hljs-keyword">const</span>Â response =Â <span class="hljs-keyword">await</span>Â <span class="hljs-title function_">cacheImage</span>(url);
<span class="hljs-keyword">const</span>Â blob =Â <span class="hljs-keyword">await</span>Â response.<span class="hljs-title function_">blob</span>();

<span class="hljs-comment">// åˆ›å»º Object URL æ˜¾ç¤ºå›¾ç‰‡</span>
Â  imgElement.<span class="hljs-property">src</span> = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob);
}
</code></pre>
<h3 data-id="heading-17">ç¼“å­˜æ¸…ç†ç­–ç•¥</h3>
<p>Cache API ä¸ä¼šè‡ªåŠ¨æ¸…ç†,éœ€è¦æ‰‹åŠ¨æ§åˆ¶ç¼“å­˜å¤§å°:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span>Â <span class="hljs-keyword">function</span>Â <span class="hljs-title function_">cleanOldCache</span>(<span class="hljs-params">maxSize =Â <span class="hljs-number">50</span>Â *Â <span class="hljs-number">1024</span>Â *Â <span class="hljs-number">1024</span></span>)Â {Â <span class="hljs-comment">// 50MB</span>
<span class="hljs-keyword">const</span>Â cache =Â <span class="hljs-keyword">await</span>Â caches.<span class="hljs-title function_">open</span>(<span class="hljs-variable constant_">IMAGE_CACHE_NAME</span>);
<span class="hljs-keyword">const</span>Â requests =Â <span class="hljs-keyword">await</span>Â cache.<span class="hljs-title function_">keys</span>();

<span class="hljs-keyword">let</span>Â totalSize =Â <span class="hljs-number">0</span>;
<span class="hljs-keyword">const</span>Â items = [];

<span class="hljs-comment">// ç»Ÿè®¡æ¯ä¸ªç¼“å­˜é¡¹çš„å¤§å°å’Œæ—¶é—´</span>
<span class="hljs-keyword">for</span>Â (<span class="hljs-keyword">const</span>Â requestÂ <span class="hljs-keyword">of</span>Â requests) {
Â  Â Â <span class="hljs-keyword">const</span>Â response =Â <span class="hljs-keyword">await</span>Â cache.<span class="hljs-title function_">match</span>(request);
Â  Â Â <span class="hljs-keyword">const</span>Â blob =Â <span class="hljs-keyword">await</span>Â response.<span class="hljs-title function_">blob</span>();
Â  Â Â 
Â  Â  items.<span class="hljs-title function_">push</span>({
Â  Â  Â  request,
Â  Â  Â Â <span class="hljs-attr">size</span>: blob.<span class="hljs-property">size</span>,
Â  Â  Â Â <span class="hljs-attr">url</span>: request.<span class="hljs-property">url</span>
Â  Â  });
Â  Â Â 
Â  Â  totalSize += blob.<span class="hljs-property">size</span>;
Â  }

<span class="hljs-comment">// è¶…å‡ºé™åˆ¶,åˆ é™¤æœ€æ—©çš„ç¼“å­˜</span>
<span class="hljs-keyword">if</span>Â (totalSize &gt; maxSize) {
Â  Â Â <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ç¼“å­˜è¶…é™:Â <span class="hljs-subst">${(totalSizeÂ / <span class="hljs-number">1024</span> /Â <span class="hljs-number">1024</span>).toFixed(<span class="hljs-number">2</span>)}</span>Â MB`</span>);
Â  Â Â 
Â  Â Â <span class="hljs-comment">// æŒ‰æ—¶é—´æ’åº,åˆ é™¤æ—§çš„</span>
Â  Â  items.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span>Â a.<span class="hljs-property">url</span>.<span class="hljs-title function_">localeCompare</span>(b.<span class="hljs-property">url</span>));
Â  Â Â 
Â  Â Â <span class="hljs-keyword">let</span>Â cleaned =Â <span class="hljs-number">0</span>;
Â  Â Â <span class="hljs-keyword">for</span>Â (<span class="hljs-keyword">const</span>Â itemÂ <span class="hljs-keyword">of</span>Â items) {
Â  Â  Â Â <span class="hljs-keyword">if</span>Â (totalSize - cleaned &lt; maxSize)Â <span class="hljs-keyword">break</span>;
Â  Â  Â Â 
Â  Â  Â Â <span class="hljs-keyword">await</span>Â cache.<span class="hljs-title function_">delete</span>(item.<span class="hljs-property">request</span>);
Â  Â  Â  cleaned += item.<span class="hljs-property">size</span>;
Â  Â  Â Â <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`åˆ é™¤ç¼“å­˜:Â <span class="hljs-subst">${item.url}</span>`</span>);
Â  Â  }
Â  }
}

<span class="hljs-comment">// å®šæœŸæ¸…ç†</span>
<span class="hljs-built_in">setInterval</span>(cleanOldCache,Â <span class="hljs-number">5</span>Â *Â <span class="hljs-number">60</span>Â *Â <span class="hljs-number">1000</span>);Â <span class="hljs-comment">// æ¯ 5 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡</span>
</code></pre>
<p><strong>çœŸå®æ•ˆæœ:</strong></p>
<p>æŸæ–°é—» App çš„ PWA ç‰ˆæœ¬,ä½¿ç”¨ Cache API å:</p>
<ul>
<li>äºŒæ¬¡è®¿é—®å›¾ç‰‡åŠ è½½æ—¶é—´ä»Â <strong>800ms é™åˆ° 50ms</strong></li>
<li>ç¦»çº¿çŠ¶æ€ä¸‹ä¾ç„¶èƒ½æµè§ˆå·²è®¿é—®è¿‡çš„å›¾ç‰‡</li>
<li>ç”¨æˆ·æµé‡æ¶ˆè€—é™ä½Â <strong>70%</strong></li>
</ul>
<h2 data-id="heading-18">å®Œæ•´çš„å›¾ç‰‡ä¼˜åŒ–å·¥ä½œæµ</h2>
<p>æŠŠä¸Šé¢çš„æŠ€æœ¯ç»„åˆèµ·æ¥,å°±æ˜¯ä¸€å¥—å®Œæ•´çš„å›¾ç‰‡ä¼˜åŒ–ç³»ç»Ÿ:</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> ç”¨æˆ·æ»šåŠ¨é¡µé¢
Â  Â  â†“
<span class="hljs-bullet">2.</span> IntersectionObserver è§¦å‘(æå‰ 200px)
Â  Â  â†“
<span class="hljs-bullet">3.</span> JavaScript æ£€æµ‹ç½‘ç»œçŠ¶å†µ(Network Info API)
Â  Â  â†“
<span class="hljs-bullet">4.</span> è®¡ç®—æœ€ä¼˜å°ºå¯¸å’Œè´¨é‡(DPR + ç½‘ç»œç±»å‹)
Â  Â  â†“
<span class="hljs-bullet">5.</span> æ£€æŸ¥ Cache API æ˜¯å¦æœ‰ç¼“å­˜
Â  Â  â†“
<span class="hljs-bullet">6.</span> å¦‚æœæœ‰ç¼“å­˜ â†’ ç›´æ¥ä½¿ç”¨
Â  Â å¦‚æœæ— ç¼“å­˜ â†’ å‘ CDN è¯·æ±‚
Â  Â  â†“
<span class="hljs-bullet">7.</span> ä¸‹è½½å®Œæˆåå­˜å…¥ Cache API
Â  Â  â†“
<span class="hljs-bullet">8.</span> è®¾ç½® decoding='async'Â å¼‚æ­¥è§£ç 
Â  Â  â†“
<span class="hljs-bullet">9.</span> å›¾ç‰‡æ˜¾ç¤º,é¿å… CLS
</code></pre>
<h2 data-id="heading-19">æ€§èƒ½å¯¹æ¯”:ä¼˜åŒ–å‰ vs ä¼˜åŒ–å</h2>
<p>ä»¥æŸç”µå•†å¹³å°çš„å•†å“è¯¦æƒ…é¡µä¸ºä¾‹:</p>









































<table><thead><tr><th>æŒ‡æ ‡</th><th>ä¼˜åŒ–å‰</th><th>ä¼˜åŒ–å</th><th>æå‡</th></tr></thead><tbody><tr><td>é¦–å±å›¾ç‰‡è¯·æ±‚æ•°</td><td>18 å¼ </td><td>6 å¼ </td><td>â†“ 67%</td></tr><tr><td>å›¾ç‰‡æ€»å¤§å°</td><td>4.2 MB</td><td>0.8 MB</td><td>â†“ 81%</td></tr><tr><td>é¦–å±æ¸²æŸ“æ—¶é—´</td><td>3.8 ç§’</td><td>1.2 ç§’</td><td>â†“ 68%</td></tr><tr><td>CLS è¯„åˆ†</td><td>0.25</td><td>0.02</td><td>â†“ 92%</td></tr><tr><td>äºŒæ¬¡è®¿é—®åŠ è½½æ—¶é—´</td><td>2.1 ç§’</td><td>0.3 ç§’</td><td>â†“ 86%</td></tr></tbody></table>
<p>è¿™äº›æ•°æ®ä¸æ˜¯å®éªŒå®¤è·‘å‡ºæ¥çš„,æ˜¯çœŸå®çº¿ä¸Šç¯å¢ƒã€åƒä¸‡çº§ PV éªŒè¯è¿‡çš„ã€‚</p>
<h2 data-id="heading-20">å†™åœ¨æœ€å</h2>
<p>å›¾ç‰‡ä¼˜åŒ–ä¸æ˜¯"æ¢ä¸ªæ ¼å¼"æˆ–"å¼€ä¸ª CDN"é‚£ä¹ˆç®€å•,å®ƒæ˜¯ä¸€å¥—å®Œæ•´çš„<strong>è¿è¡Œæ—¶ç­–ç•¥ç³»ç»Ÿ</strong>:</p>
<ol>
<li><strong>å»¶è¿ŸåŠ è½½</strong>:IntersectionObserver ç²¾å‡†æ§åˆ¶</li>
<li><strong>åŠ¨æ€é€‰æ‹©</strong>:æ ¹æ®è®¾å¤‡å’Œç½‘ç»œè°ƒæ•´å°ºå¯¸å’Œè´¨é‡</li>
<li><strong>è§£ç ä¼˜åŒ–</strong>:async decoding é¿å…é˜»å¡</li>
<li><strong>å®¢æˆ·ç«¯å‹ç¼©</strong>:å‰ç«¯ç›´æ¥å¤„ç†,èŠ‚çœæµé‡å’ŒæœåŠ¡å™¨æˆæœ¬</li>
<li><strong>ç¼“å­˜ç®¡ç†</strong>:Cache API æ‰‹åŠ¨æ§åˆ¶,ç¦»çº¿å¯ç”¨</li>
</ol>
<p>è¿™äº›æŠ€æœ¯çš„å…±åŒç‚¹æ˜¯:<strong>JavaScript æŒæ¡äº†ä¸»åŠ¨æƒ</strong>,ä¸å†è¢«åŠ¨ä¾èµ–æµè§ˆå™¨æˆ– CDN çš„é»˜è®¤è¡Œä¸ºã€‚</p>
<p>ä½†æ›´é‡è¦çš„æ˜¯,<strong>è¦ç†è§£ä¸ºä»€ä¹ˆè¿™ä¹ˆåš</strong>ã€‚</p>
<p>æµè§ˆå™¨åªå…³å¿ƒå­—èŠ‚æ•°ã€è§£ç æ—¶é—´ã€å¸ƒå±€ç¨³å®šæ€§å’Œæ¸²æŸ“æ—¶æœºã€‚ä½ çš„æ¯ä¸€è¡Œä»£ç ,éƒ½åº”è¯¥ä¸ºè¿™å››ä¸ªç›®æ ‡æœåŠ¡ã€‚</p>
<p>è®°ä½:<strong>æ€§èƒ½ä¸æ˜¯é”¦ä¸Šæ·»èŠ±,æ€§èƒ½æœ¬èº«å°±æ˜¯åŠŸèƒ½</strong>ã€‚ç”¨æˆ·ä¸ä¼šå¤¸ä½ çš„ä»£ç å†™å¾—ä¼˜é›…,ä½†ä¼šç›´æ¥æ„Ÿå—åˆ°ä½ çš„é¡µé¢æ˜¯å¿«æ˜¯æ…¢ã€‚</p>
<p>è€Œå›¾ç‰‡ä¼˜åŒ–,å¾€å¾€æ˜¯æ€§èƒ½ä¼˜åŒ–ä¸­ ROI æœ€é«˜çš„é‚£ä¸ªç¯èŠ‚ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[fetch-event-sourceæºç è§£è¯»]]></title>    <link>https://juejin.cn/post/7604039449468665906</link>    <guid>https://juejin.cn/post/7604039449468665906</guid>    <pubDate>2026-02-09T06:13:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604039449468665906" data-draft-id="7597695487302795279" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="fetch-event-sourceæºç è§£è¯»"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2026-02-09T06:13:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸è®¤è¾“çš„è¥¿ç“œ"/> <meta itemprop="url" content="https://juejin.cn/user/219558058666813"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            fetch-event-sourceæºç è§£è¯»
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/219558058666813/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸è®¤è¾“çš„è¥¿ç“œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T06:13:48.000Z" title="Mon Feb 09 2026 06:13:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">SSEåè®®è§„èŒƒ</h2>
<p>SSEåè®®å®é™…ä¸Šæ˜¯åœ¨ HTTP ä¹‹ä¸Šå®šä¹‰äº†ä¸€å¥—ä¸¥æ ¼çš„æ•°æ®ç»„ç»‡è§„èŒƒï¼Œæ˜¯å±äºåº”ç”¨å±‚çš„åè®®ã€‚</p>
<ul>
<li><strong>å›ºå®šè¯·æ±‚å¤´ç±»å‹</strong>ï¼šå¿…é¡»æ˜¯ <code>Content-Type: text/event-stream</code></li>
<li><strong>å›ºå®šæ–‡æœ¬æ ¼å¼</strong>ï¼šæ•°æ®å¿…é¡»ä»¥ <code>field: value\n</code> çš„å½¢å¼è¿”å›</li>
<li><strong>å›ºå®šç»“æŸç¬¦</strong>ï¼šæ¶ˆæ¯ä¹‹é—´å¿…é¡»ä»¥ <code>\n\n</code> åˆ†éš”ã€‚</li>
</ul>
<pre><code class="hljs language-js" lang="js">{
    <span class="hljs-attr">id</span>: <span class="hljs-string">''</span>, <span class="hljs-comment">// æ¶ˆæ¯å”¯ä¸€æ ‡è¯†ï¼Œå®ç°â€œæ–­ç‚¹ç»­ä¼ â€çš„å…³é”®</span>
    <span class="hljs-attr">event</span>: <span class="hljs-string">''</span>,  <span class="hljs-comment">// äº‹ä»¶ç±»å‹ï¼Œç¼ºå¤±åˆ™é»˜è®¤è§¦å‘ onmessage</span>
    <span class="hljs-attr">data</span>: <span class="hljs-string">''</span>, <span class="hljs-comment">// æ¶ˆæ¯å†…å®¹</span>
    <span class="hljs-attr">retry</span>: <span class="hljs-literal">undefined</span>,  <span class="hljs-comment">// é‡è¿æ—¶é—´</span>
}
</code></pre>
<h2 data-id="heading-1">fetchEventSource æ‰§è¡Œæµç¨‹</h2>
<p><strong>fetch-event-sourceåº•å±‚æ˜¯ä½¿ç”¨</strong> <strong><code>fetch</code></strong> <strong>é…åˆ</strong> <strong><code>ReadableStream</code></strong> <strong>å®ç°çš„</strong></p>
<p><strong>1.å»ºç«‹ Fetch é•¿è¿æ¥</strong></p>
<p><code>fetch</code> è¯»å–åˆ°çš„æ˜¯ <code>Uint8Array</code>ï¼ˆåŸå§‹äºŒè¿›åˆ¶å­—èŠ‚ç ï¼‰ï¼Œéœ€è¦æ‰‹åŠ¨è½¬æ¢ä¸º SSE å­—æ®µã€‚</p>
<p>è‡ªåŠ¨è¡¥å…¨ <code>Accept: text/event-stream</code>ï¼Œç¡®ä¿åç«¯è¿”å›æ­£ç¡®æ ¼å¼ã€‚</p>
<p><strong>2.æµå¼è¯»å–</strong></p>
<p>é€šè¿‡ <code>response.body.getReader()</code> å¼€å¯å¾ªç¯è¯»å–å­—èŠ‚æµã€‚</p>
<p><strong>3.å­—èŠ‚è§£ç ä¸â€œç¼“å†²åŒºâ€æ‹¼è£…</strong></p>
<p>ç½‘ç»œä¼ è¾“ä¸­ï¼Œæ•°æ®åŒ…å¯èƒ½åœ¨ä»»ä½•åœ°æ–¹æ–­å¼€ï¼ˆä¾‹å¦‚ï¼š<code>data: hello</code> è¢«åˆ‡æˆäº† <code>da</code> å’Œ <code>ta: hello</code>ï¼‰ã€‚ æºç ä¸­ç»´æŠ¤äº†ä¸€ä¸ª <code>buffer</code> (Uint8Array) å’Œä¸€ä¸ª <code>position</code> (å½“å‰åç§»é‡)ï¼Œ<strong>è¿™æ˜¯è¯¥åº“æœ€æ ¸å¿ƒçš„é€»è¾‘ã€‚</strong></p>
<ul>
<li>
<p><strong>ç¼“å†²åŒºé€»è¾‘</strong>ï¼šåº“å†…éƒ¨ç»´æŠ¤ä¸€ä¸ª <code>buffer</code> å­—ç¬¦ä¸²ã€‚æ–°åˆ°çš„ç‰‡æ®µä¼šæ‹¼æ¥åˆ° <code>buffer</code> åã€‚</p>
<ul>
<li>æ‰«æ <code>buffer</code> ä¸­æ˜¯å¦å­˜åœ¨ <code>\n\n</code>ã€‚</li>
<li>å¦‚æœæœ‰ï¼Œè¯´æ˜æ¶ˆæ¯å®Œæ•´ï¼Œåˆ‡å‡ºæ¥è¿›è¡Œè§£æã€‚</li>
<li>å¦‚æœæ²¡æœ‰ï¼Œç»§ç»­ç­‰å¾…ä¸‹ä¸€ä¸ªæ•°æ®å—ã€‚</li>
</ul>
</li>
</ul>
<p><strong>4.å­—æ®µè§£æä¸åˆ†å‘</strong></p>
<p>ä¸€æ—¦è¯†åˆ«å‡ºå®Œæ•´çš„æ¶ˆæ¯å—ï¼Œå®ƒä¼šæŒ‰è¡Œæ‹†åˆ†ï¼Œè§£æå‡º <code>data:</code>, <code>event:</code>, <code>id:</code> ç­‰å­—æ®µï¼Œå¹¶æ‰‹åŠ¨è°ƒç”¨ä½ åœ¨é…ç½®ä¸­ä¼ å…¥çš„ <code>onmessage</code>, <code>onopen</code> ç­‰å›è°ƒå‡½æ•°ã€‚</p>
<h2 data-id="heading-2">æ ¸å¿ƒæ–¹æ³•è§£æ</h2>
<h3 data-id="heading-3">1ã€<code>fetchEventSource</code></h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> interface <span class="hljs-title class_">FetchEventSourceInit</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RequestInit</span> {
    headers?: <span class="hljs-title class_">Record</span>&lt;string, string&gt;,
    onopen?: <span class="hljs-function">(<span class="hljs-params">response: Response</span>) =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt;,
    onmessage?: <span class="hljs-function">(<span class="hljs-params">ev: EventSourceMessage</span>) =&gt;</span> <span class="hljs-keyword">void</span>;
    onclose?: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">void</span>;
    onerror?: <span class="hljs-function">(<span class="hljs-params">err: any</span>) =&gt;</span> number | <span class="hljs-literal">null</span> | <span class="hljs-literal">undefined</span> | <span class="hljs-keyword">void</span>,
    openWhenHidden?: boolean;
    fetch?: <span class="hljs-keyword">typeof</span> fetch; <span class="hljs-comment">// è¦ä½¿ç”¨çš„ Fetch å‡½æ•°ã€‚é»˜è®¤ä¸º window.fetch</span>
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchEventSource</span>(<span class="hljs-params">input: RequestInfo, {
    signal: inputSignal,
    headers: inputHeaders,
    onopen: inputOnOpen,
    onmessage,
    onclose,
    onerror,
    openWhenHidden,
    fetch: inputFetch,
    ...rest
}: FetchEventSourceInit</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt;(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        <span class="hljs-comment">// å¤åˆ¶è¯·æ±‚å¤´ï¼Œç¡®ä¿ accept ä¸º text/event-streamã€‚</span>
        <span class="hljs-keyword">const</span> headers = { ...inputHeaders };
        <span class="hljs-keyword">if</span> (!headers.<span class="hljs-property">accept</span>) {
            headers.<span class="hljs-property">accept</span> = <span class="hljs-title class_">EventStreamContentType</span>;
        }

        <span class="hljs-comment">// å½“å‰è¯·æ±‚çš„ AbortController</span>
        <span class="hljs-keyword">let</span> <span class="hljs-attr">curRequestController</span>: <span class="hljs-title class_">AbortController</span>;
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">onVisibilityChange</span>(<span class="hljs-params"/>) {
            curRequestController.<span class="hljs-title function_">abort</span>(); <span class="hljs-comment">// é¡µé¢éšè—æ—¶ä¸­æ–­è¯·æ±‚</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">document</span>.<span class="hljs-property">hidden</span>) {
                <span class="hljs-title function_">create</span>(); <span class="hljs-comment">// é¡µé¢æ¢å¤å¯è§æ—¶é‡æ–°å»ºç«‹è¿æ¥</span>
            }
        }

        <span class="hljs-comment">// å¦‚æœopenWhenHiddenä¸ºfalseï¼Œåˆ™ç›‘å¬æ–‡æ¡£å¯è§æ€§å˜åŒ–äº‹ä»¶</span>
        <span class="hljs-keyword">if</span> (!openWhenHidden) {
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'visibilitychange'</span>, onVisibilityChange);
        }

        <span class="hljs-comment">// èµ„æºæ¸…ç†</span>
        <span class="hljs-keyword">let</span> retryInterval = <span class="hljs-title class_">DefaultRetryInterval</span>;
        <span class="hljs-keyword">let</span> retryTimer = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">dispose</span>(<span class="hljs-params"/>) {
            <span class="hljs-comment">// æ¸…ç†äº‹ä»¶ç›‘å¬</span>
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'visibilitychange'</span>, onVisibilityChange);
            <span class="hljs-comment">// æ¸…ç†å®šæ—¶å™¨å’Œä¸­æ–­è¯·æ±‚</span>
            <span class="hljs-variable language_">window</span>.<span class="hljs-built_in">clearTimeout</span>(retryTimer);
            <span class="hljs-comment">// ä¸­æ–­å½“å‰è¯·æ±‚</span>
            curRequestController.<span class="hljs-title function_">abort</span>();
        }

        <span class="hljs-comment">// å¦‚æœå¤–éƒ¨ä¼ å…¥äº† abort ä¿¡å·ï¼Œå“åº”ä¸­æ–­å¹¶æ¸…ç†èµ„æºã€‚</span>
        inputSignal?.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'abort'</span>, <span class="hljs-function">() =&gt;</span> {
            <span class="hljs-title function_">dispose</span>();
            <span class="hljs-title function_">resolve</span>(); <span class="hljs-comment">// ä¸è¦æµªè´¹èµ„æºåœ¨é‡è¯•ä¸Š</span>
        });

        <span class="hljs-comment">// ä½¿ç”¨ä¼ å…¥çš„ fetch å®ç°ï¼ˆè‹¥æœ‰ï¼‰ï¼Œå¦åˆ™ä½¿ç”¨å…¨å±€çš„ window.fetchã€‚</span>
        <span class="hljs-keyword">const</span> fetch = inputFetch ?? <span class="hljs-variable language_">window</span>.<span class="hljs-property">fetch</span>;
        <span class="hljs-comment">// ä½¿ç”¨ä¼ å…¥çš„ onopen å›è°ƒï¼ˆç”¨äºéªŒè¯/å¤„ç†å“åº”ï¼‰ï¼Œæ²¡æœ‰åˆ™ä½¿ç”¨é»˜è®¤çš„ content-type æ ¡éªŒå‡½æ•°ã€‚</span>
        <span class="hljs-keyword">const</span> onopen = inputOnOpen ?? defaultOnOpen;
        <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">create</span>(<span class="hljs-params"/>) {
            <span class="hljs-comment">// ä¸ºæœ¬æ¬¡è¯·æ±‚åˆ›å»º AbortControllerï¼Œç”¨äºåç»­ä¸­æ­¢å½“å‰è¯·æ±‚ï¼ˆå¯è§æ€§å˜åŒ–æˆ–å¤–éƒ¨ abortï¼‰ã€‚</span>
            curRequestController = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// å‘èµ· fetch è¯·æ±‚ï¼Œåˆå¹¶å‰©ä½™ init é…ç½®ã€headersï¼Œå¹¶å°†å½“å‰ controller çš„ signal ä¼ å…¥ä»¥ä¾¿å¯ä¸­æ­¢ã€‚</span>
                <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(input, {
                    ...rest,
                    headers,
                    <span class="hljs-attr">signal</span>: curRequestController.<span class="hljs-property">signal</span>,
                });

                <span class="hljs-keyword">await</span> <span class="hljs-title function_">onopen</span>(response);
                
                <span class="hljs-comment">// é“¾å¼å¤„ç†å“åº”æµï¼š</span>
                <span class="hljs-comment">// getMessagesè¿”å›æŒ‰è¡Œç»„è£…æˆEventSourceMessageå¯¹è±¡çš„onlineå‡½æ•°</span>
                <span class="hljs-comment">// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯idï¼Œå¦‚æœæœ‰idå°±å†™å…¥headersä¸­ï¼Œç”¨äºåœ¨ä¸‹æ¬¡é‡è¿å‘é€last-event-id</span>
                <span class="hljs-comment">// ç¬¬äºŒä¸ªå‚æ•°æ˜¯retryï¼Œå¦‚æœæœ‰retryå°±æ›´æ–°retryIntervalï¼Œç”¨äºä¸‹æ¬¡é‡è¿ç­‰å¾…æ—¶é—´</span>
                <span class="hljs-comment">// ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯onmessageå›è°ƒï¼Œç”¨äºå¤„ç†å®Œæ•´çš„EventSourceMessageæ¶ˆæ¯</span>

                <span class="hljs-comment">// getLinesè´Ÿè´£æŠŠå“åº”ä½“å­—èŠ‚æµæŒ‰è¡Œåˆ‡åˆ†ï¼Œè°ƒç”¨ä¸Šé¢çš„onlineå‡½æ•°</span>
                <span class="hljs-comment">// getBytesè´Ÿè´£ä»response.bodyä¸­è¯»å–å“åº”ä½“çš„å­—èŠ‚æµï¼Œå¹¶æŠŠæ¯å—ä¼ å…¥getLinesè¿›è¡Œå¤„ç†ï¼Œç›´åˆ°ç»“æŸæˆ–ç»ˆæ­¢</span>
                <span class="hljs-keyword">await</span> <span class="hljs-title function_">getBytes</span>(response.<span class="hljs-property">body</span>!, <span class="hljs-title function_">getLines</span>(<span class="hljs-title function_">getMessages</span>(<span class="hljs-function"><span class="hljs-params">id</span> =&gt;</span> {
                    <span class="hljs-keyword">if</span> (id) {
                        <span class="hljs-comment">// store the id and send it back on the next retry:</span>
                        headers[<span class="hljs-title class_">LastEventId</span>] = id;
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-comment">// don't send the last-event-id header anymore:</span>
                        <span class="hljs-keyword">delete</span> headers[<span class="hljs-title class_">LastEventId</span>];
                    }
                }, <span class="hljs-function"><span class="hljs-params">retry</span> =&gt;</span> {
                    retryInterval = retry;
                }, onmessage)));

                onclose?.(); <span class="hljs-comment">// æµæ­£å¸¸ç»“æŸåï¼Œè°ƒç”¨å¯é€‰çš„ onclose å›è°ƒ</span>
                <span class="hljs-title function_">dispose</span>(); <span class="hljs-comment">// æ¸…ç†ï¼ˆç§»é™¤å¯è§æ€§ç›‘å¬ã€æ¸…é™¤å®šæ—¶å™¨ã€abort å½“å‰ controller ç­‰èµ„æºï¼‰</span>
                <span class="hljs-title function_">resolve</span>(); <span class="hljs-comment">// å®Œæˆå¤–éƒ¨ Promiseï¼ˆè¡¨ç¤ºå·¥ä½œå®Œæˆï¼Œä¸å†é‡è¯•ï¼‰ã€‚</span>
            } <span class="hljs-keyword">catch</span> (err) {
                <span class="hljs-comment">// åªæœ‰åœ¨ä¸æ˜¯ä¸»åŠ¨ä¸­æ­¢çš„æƒ…å†µä¸‹æ‰è€ƒè™‘é‡è¯•ï¼ˆå¦‚æœæ˜¯ä¸»åŠ¨ abortï¼Œå°±ä¸é‡è¯•ï¼‰</span>
                <span class="hljs-keyword">if</span> (!curRequestController.<span class="hljs-property">signal</span>.<span class="hljs-property">aborted</span>) {
                    <span class="hljs-keyword">try</span> {
                        <span class="hljs-comment">// è°ƒç”¨ç”¨æˆ·çš„ onerror å›è°ƒï¼Œå…è®¸å…¶è¿”å›ä¸€ä¸ªé‡è¯•é—´éš”ï¼ˆæ¯«ç§’ï¼‰ï¼›è‹¥æœªæä¾›æˆ–è¿”å› undefinedï¼Œåˆ™ä½¿ç”¨å½“å‰çš„ retryIntervalï¼ˆæ¥è‡ªæœåŠ¡å™¨ retry å­—æ®µæˆ–é»˜è®¤å€¼ï¼‰</span>
                        <span class="hljs-keyword">const</span> <span class="hljs-attr">interval</span>: any = onerror?.(err) ?? retryInterval;
                        <span class="hljs-variable language_">window</span>.<span class="hljs-built_in">clearTimeout</span>(retryTimer); <span class="hljs-comment">// æ¸…é™¤ä¹‹å‰å¯èƒ½å­˜åœ¨çš„é‡è¯•å®šæ—¶å™¨ã€‚</span>
                        retryTimer = <span class="hljs-variable language_">window</span>.<span class="hljs-built_in">setTimeout</span>(create, interval);
                    } <span class="hljs-keyword">catch</span> (innerErr) {
                        <span class="hljs-title function_">dispose</span>(); <span class="hljs-comment">// æ¸…ç†èµ„æºã€‚</span>
                        <span class="hljs-title function_">reject</span>(innerErr); <span class="hljs-comment">// æ‹’ç»å¤–éƒ¨ Promiseï¼Œç»“æŸæ•´ä¸ªæµç¨‹å¹¶å‘è°ƒç”¨è€…æŠ¥å‘Šé”™è¯¯</span>
                    }
                }
            }
        }

        <span class="hljs-title function_">create</span>();
    });
}
</code></pre>
<h3 data-id="heading-4"><strong>2ã€</strong> <strong><code>getBytes()</code></strong> <strong>ï¼šå¾ªç¯è¯»å–æµä¿¡æ¯</strong></h3>
<p>å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šstreamå’ŒonChunk</p>
<ul>
<li><code>stream</code>ï¼šä»£è¡¨ä¸€ä¸ªå¯è¯»å–çš„äºŒè¿›åˆ¶æ•°æ®æµ</li>
<li><code>onChunk</code>ï¼š æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œæ¯å½“ä»æµä¸­è¯»å–åˆ°ä¸€å—æ•°æ®æ—¶ï¼Œå°±ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œå¹¶å°†è¯»å–åˆ°çš„æ•°æ®ä½œä¸ºå‚æ•°ä¼ é€’ç»™è¿™ä¸ªå‡½æ•°ã€‚</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getBytes</span>(<span class="hljs-params">stream: ReadableStream&lt;<span class="hljs-built_in">Uint8Array</span>&gt;, onChunk: (arr: <span class="hljs-built_in">Uint8Array</span>) =&gt; <span class="hljs-keyword">void</span></span>) {
    <span class="hljs-keyword">const</span> reader = stream.<span class="hljs-title function_">getReader</span>(); <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªæµçš„é˜…è¯»å™¨ reader</span>
    <span class="hljs-keyword">let</span> <span class="hljs-attr">result</span>: <span class="hljs-title class_">ReadableStreamDefaultReadResult</span>&lt;<span class="hljs-title class_">Uint8Array</span>&gt;;
    <span class="hljs-keyword">while</span> (!(result = <span class="hljs-keyword">await</span> reader.<span class="hljs-title function_">read</span>()).<span class="hljs-property">done</span>) { <span class="hljs-comment">// å¾ªç¯è¯»å–æ•°æ®å—ï¼Œç›´åˆ°æµç»“æŸ</span>
        <span class="hljs-title function_">onChunk</span>(result.<span class="hljs-property">value</span>); <span class="hljs-comment">// å¯¹æ¯ä¸ªæ•°æ®å—è°ƒç”¨å›è°ƒ, onChunkæ˜¯ getLines()æ–¹æ³•çš„è¿”å›å€¼</span>
    }
}
</code></pre>
<h3 data-id="heading-5"><strong>3ã€</strong> <strong><code>getLines()</code></strong> <strong>ï¼šå°†å­—èŠ‚å—è§£æä¸ºEventSourceè¡Œä¿¡æ¯</strong></h3>
<p>æ¥æ”¶ä¸€ä¸ªå›è°ƒå‡½æ•° onLine ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•° onChunkã€‚</p>
<ul>
<li>
<p><code>onLine</code>ï¼šæ¯å½“æ£€æµ‹åˆ°ä¸€è¡Œæ•°æ®æ—¶å°±ä¼šè°ƒç”¨å®ƒ</p>
<pre><code class="hljs language-r" lang="r">è§„å®šä»¥`\r`ã€`\n` æˆ– `\r\n`ä½œä¸ºä¸€è¡Œç»“æŸçš„æ ‡å¿—
è§„å®šä»¥`\n\n`æˆ–`  \r\n\r\n ` ä½œä¸ºä¸€ä¸ªæ¶ˆæ¯ç»“æŸçš„æ ‡å¿—
</code></pre>
</li>
<li>
<p><code>onChunk</code>ï¼šç”¨äºå¤„ç†ä¼ å…¥çš„å­—èŠ‚å—ã€‚é€ä¸ªè§£æä¼ å…¥çš„å­—èŠ‚å—ï¼Œæ‰¾åˆ°æ•°æ®ä¸­çš„è¡Œç»“æŸç¬¦ã€‚å°†å­—èŠ‚å—è§£æä¸º EventSource è¡Œç¼“å†²åŒºï¼Œå¹¶åœ¨æ£€æµ‹åˆ°å®Œæ•´è¡Œæ—¶è°ƒç”¨<code> onLine</code> å›è°ƒã€‚</p>
</li>
</ul>
<p><strong>å®ƒè§£å†³äº†è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šç½‘ç»œä¼ è¾“çš„æ•°æ®å¯èƒ½ä¸æ˜¯ä¸€è¡Œä¸€è¡Œåˆ°è¾¾çš„ï¼Œè€Œæ˜¯åˆ†å—åˆ°è¾¾çš„ï¼Œç”šè‡³ä¸€è¡Œå¯èƒ½è¢«æ‹†æˆå¤šä¸ªå—ã€‚è¿™ä¸ªå‡½æ•°è´Ÿè´£æŠŠè¿™äº›å—æ‹¼èµ·æ¥ï¼Œé‡åˆ°æ¢è¡Œç¬¦ï¼ˆ\rã€\n æˆ– \r\nï¼‰å°±è®¤ä¸ºæ˜¯ä¸€è¡Œï¼Œç„¶åæŠŠè¿™ä¸€è¡Œäº¤ç»™ onLine å¤„ç†ã€‚</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// æ¨¡æ‹Ÿå­—èŠ‚å—çš„è¿”å›</span>
<span class="hljs-comment">// å—1ï¼šdata: hello\r\ndata: wo</span>
<span class="hljs-comment">// å—2ï¼šrld\r\n\r\nevent: update\r\ndata: 123\r\n</span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getLines</span>(<span class="hljs-params">onLine: (line: <span class="hljs-built_in">Uint8Array</span>, fieldLength: number) =&gt; <span class="hljs-keyword">void</span></span>) {
    <span class="hljs-keyword">let</span> <span class="hljs-attr">buffer</span>: <span class="hljs-title class_">Uint8Array</span> | <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">let</span> <span class="hljs-attr">position</span>: number; <span class="hljs-comment">// å½“å‰è¯»å–ä½ç½®</span>
    <span class="hljs-keyword">let</span> <span class="hljs-attr">fieldLength</span>: number; <span class="hljs-comment">// å½“å‰è¡Œä¸­æœ‰æ•ˆâ€œå­—æ®µâ€éƒ¨åˆ†çš„é•¿åº¦</span>
    <span class="hljs-keyword">let</span> discardTrailingNewline = <span class="hljs-literal">false</span>; <span class="hljs-comment">// æ ‡è®°æ˜¯å¦éœ€è¦è·³è¿‡ç´§è·Ÿåœ¨\råçš„\n</span>

    <span class="hljs-comment">// è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œå¤„ç†æ¯ä¸ªå­—èŠ‚å—</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">onChunk</span>(<span class="hljs-params">arr: <span class="hljs-built_in">Uint8Array</span></span>) {
        <span class="hljs-keyword">if</span> (buffer === <span class="hljs-literal">undefined</span>) { <span class="hljs-comment">// åˆå§‹åŒ–bufferã€positionã€fieldLengthï¼Œå¦‚æœæœªå®šä¹‰ä¹Ÿå°±æ˜¯æ„å‘³ç€è¿™æ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨æˆ–è€…å‰ä¸€ä¸ªç¼“å­˜åŒºå·²å®Œå…¨å¤„ç†å®Œæ¯•</span>
            buffer = arr;
            position = <span class="hljs-number">0</span>;
            fieldLength = -<span class="hljs-number">1</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// å¦‚æœbufferå·²å®šä¹‰ï¼ˆæ—¢æ­£åœ¨å¤„ç†ä¸€ä¸ªè¾ƒå¤§çš„æ•°æ®å—æˆ–è¿ç»­çš„æ•°æ®å—ï¼‰ï¼Œå°†æ–°çš„æ•°æ®å—arrè¿½åŠ åˆ°ç°æœ‰çš„bufferåé¢ï¼Œä¸»è¦å¤„ç†å‰ä¸€ä¸ªå­—èŠ‚å¤„ç†å®Œè¿˜æœ‰å‰©ä½™å­—èŠ‚çš„æƒ…å†µ</span>
            buffer = <span class="hljs-title function_">concat</span>(buffer, arr);
        }

        <span class="hljs-keyword">const</span> bufLength = buffer.<span class="hljs-property">length</span>;
        <span class="hljs-keyword">let</span> lineStart = <span class="hljs-number">0</span>; <span class="hljs-comment">// å½“å‰è¡Œçš„èµ·å§‹ä½ç½®</span>
        <span class="hljs-keyword">while</span> (position &lt; bufLength) { <span class="hljs-comment">// éå†bufferï¼Œä½¿ç”¨positionæŒ‡é’ˆæ¥è¿½è¸ªå½“å‰è¯»å–çš„ä½ç½®</span>
            <span class="hljs-keyword">if</span> (discardTrailingNewline) { <span class="hljs-comment">// å¦‚æœè®¾ç½®äº†discardTrailingNewlineæ ‡å¿—ï¼Œåˆ™è·³è¿‡è¡Œç»“æŸç¬¦ä¹‹åçš„æ–°è¡Œå­—ç¬¦ï¼Œå¦‚æœä¸Šæ¬¡é‡åˆ°\rï¼Œè¿™æ¬¡è¦è·³è¿‡\n</span>
                <span class="hljs-keyword">if</span> (buffer[position] === <span class="hljs-title class_">ControlChars</span>.<span class="hljs-property">NewLine</span>) {
                    lineStart = ++position; <span class="hljs-comment">// è·³è¿‡\n</span>
                }
                
                discardTrailingNewline = <span class="hljs-literal">false</span>;
            }
            
            <span class="hljs-comment">// æŸ¥æ‰¾æœ¬è¡Œçš„ç»“æŸç¬¦</span>
            <span class="hljs-keyword">let</span> lineEnd = -<span class="hljs-number">1</span>;
            <span class="hljs-keyword">for</span> (; position &lt; bufLength &amp;&amp; lineEnd === -<span class="hljs-number">1</span>; ++position) {
                <span class="hljs-keyword">switch</span> (buffer[position]) {
                    <span class="hljs-keyword">case</span> <span class="hljs-title class_">ControlChars</span>.<span class="hljs-property">Colon</span>:
                        <span class="hljs-keyword">if</span> (fieldLength === -<span class="hljs-number">1</span>) { <span class="hljs-comment">// è®°å½•ç¬¬ä¸€ä¸ªå†’å·çš„ä½ç½®</span>
                            fieldLength = position - lineStart;
                        }
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> <span class="hljs-title class_">ControlChars</span>.<span class="hljs-property">CarriageReturn</span>: <span class="hljs-comment">// \r</span>
                        discardTrailingNewline = <span class="hljs-literal">true</span>; <span class="hljs-comment">// æ ‡è®°ä¸‹æ¬¡è¦è·³è¿‡\n</span>
                    <span class="hljs-keyword">case</span> <span class="hljs-title class_">ControlChars</span>.<span class="hljs-property">NewLine</span>: <span class="hljs-comment">// \n</span>
                        lineEnd = position; <span class="hljs-comment">// è¡Œç»“æŸ</span>
                        <span class="hljs-keyword">break</span>;
                }
            }

            <span class="hljs-keyword">if</span> (lineEnd === -<span class="hljs-number">1</span>) {
                <span class="hljs-comment">// æ²¡æ‰¾åˆ°è¡Œç»“æŸç¬¦ï¼Œç­‰ä¸‹ä¸€ä¸ªå­—èŠ‚å—</span>
                <span class="hljs-keyword">break</span>;
            }

            <span class="hljs-comment">// å–å‡ºå®Œæ•´çš„ä¸€è¡Œï¼Œè°ƒç”¨ onLineï¼ŒonLineæ˜¯ getMessages()æ–¹æ³•çš„è¿”å›å€¼</span>
            <span class="hljs-title function_">onLine</span>(buffer.<span class="hljs-title function_">subarray</span>(lineStart, lineEnd), fieldLength); <span class="hljs-comment">// è·å–å®Œæ•´çš„è¡Œï¼Œå¹¶è°ƒç”¨onLineå›è°ƒå‡½æ•°ï¼Œå¤„ç†è¿™ä¸€è¡Œæ•°æ®</span>
            lineStart = position; <span class="hljs-comment">// ä¸‹ä¸€è¡Œçš„èµ·å§‹ä½ç½®</span>
            fieldLength = -<span class="hljs-number">1</span>; <span class="hljs-comment">// æ›´æ–° fieldLength ä¸º -1ï¼Œå‡†å¤‡å¤„ç†ä¸‹ä¸€è¡Œçš„ field éƒ¨åˆ†</span>
        }

        <span class="hljs-keyword">if</span> (lineStart === bufLength) {
            buffer = <span class="hljs-literal">undefined</span>; <span class="hljs-comment">// å…¨éƒ¨å¤„ç†å®Œ</span>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (lineStart !== <span class="hljs-number">0</span>) {
             <span class="hljs-comment">// è¿˜æœ‰æœªå¤„ç†çš„å†…å®¹</span>
            buffer = buffer.<span class="hljs-title function_">subarray</span>(lineStart); <span class="hljs-comment">// æŠŠ buffer å˜æˆè¿˜æ²¡å¤„ç†å®Œçš„éƒ¨åˆ†ï¼Œä¸¢å¼ƒå·²ç»å¤„ç†è¿‡çš„å†…å®¹ã€‚è¿™æ ·ä¸‹æ¬¡æ–°æ•°æ®å—åˆ°æ¥æ—¶ï¼Œå¯ä»¥ç›´æ¥æ‹¼æ¥åˆ°å‰©ä½™éƒ¨åˆ†åé¢ã€‚</span>
            position -= lineStart; <span class="hljs-comment">// æ›´æ–° position æŒ‡é’ˆï¼Œä¿è¯å®ƒæŒ‡å‘æ–°çš„ buffer çš„æ­£ç¡®ä½ç½®ã€‚å…¶å®å¯ä»¥ç›´æ¥ç½®ä¸º0ï¼Œå› ä¸ºæ–°çš„ buffer æ˜¯ä» lineStart å¼€å§‹çš„ï¼Œä½†æ˜¯è¿™æ ·å†™æ›´é€šç”¨ä¸€äº›ã€‚é˜²æ­¢æç«¯æƒ…å†µä¸‹ position æŒ‡å‘é”™è¯¯ã€‚</span>
        }
    }
}
</code></pre>
<h3 data-id="heading-6">4ã€<strong>getMessages()ï¼šæŠŠ EventSource è¡Œç»„è£…æˆå®Œæ•´çš„ SSE æ¶ˆæ¯å¯¹è±¡</strong></h3>
<p>æ¥æ”¶ä¸‰ä¸ªå›è°ƒä¸ºå‚æ•°ï¼š<code>onId</code>ã€<code>onRetry</code>ã€<code>onMessage</code>ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°<code>onLine</code></p>
<ul>
<li><code>onId</code>ï¼šå›è°ƒï¼Œåœ¨æ¯æ¬¡æ£€æµ‹åˆ°æ¶ˆæ¯ ID æ—¶è°ƒç”¨ï¼Œä¼ é€’ ID å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°</li>
<li><code>onRetry</code>ï¼šå›è°ƒï¼Œåœ¨æ¯æ¬¡æ£€æµ‹åˆ°é‡è¯•æ—¶é—´æ—¶è°ƒç”¨ï¼Œä¼ é€’é‡è¯•æ—¶é—´çš„æ•°å€¼ä½œä¸ºå‚æ•°</li>
<li><code>onMessage</code>ï¼šå›è°ƒï¼Œåœ¨æ¯æ¬¡æ¶ˆæ¯ç»“æŸæ—¶è°ƒç”¨ï¼Œä¼ é€’å®Œæ•´çš„æ¶ˆæ¯å¯¹è±¡ä½œä¸ºå‚æ•°</li>
<li><code>onLine</code>ï¼šå¤„ç†æ¯ä¸€è¡Œçš„æ•°æ®</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getMessages</span>(<span class="hljs-params">
    onId: (id: string) =&gt; <span class="hljs-keyword">void</span>,
    onRetry: (retry: number) =&gt; <span class="hljs-keyword">void</span>,
    onMessage?: (msg: EventSourceMessage) =&gt; <span class="hljs-keyword">void</span>
</span>) {
    <span class="hljs-keyword">let</span> message = <span class="hljs-title function_">newMessage</span>(); <span class="hljs-comment">// åˆå§‹åŒ–ä¸€ä¸ªç©ºæ¶ˆæ¯å¯¹è±¡</span>
    <span class="hljs-keyword">const</span> decoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>(); <span class="hljs-comment">// ç”¨äºæŠŠå­—èŠ‚æ•°ç»„è§£ç ä¸ºå­—ç¬¦ä¸²ã€‚</span>

    <span class="hljs-comment">// è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œæ¯å½“è§£æå‡ºä¸€è¡Œ EventSource è¡Œæ—¶å°±ä¼šè°ƒç”¨ï¼Œï¼ˆç”± getLines ä¼ å…¥ï¼‰</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">onLine</span>(<span class="hljs-params">line: <span class="hljs-built_in">Uint8Array</span>, fieldLength: number</span>) {
        <span class="hljs-keyword">if</span> (line.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) { <span class="hljs-comment">// å¦‚æœæ˜¯ç©ºè¡Œè¡¨ç¤ºæ¶ˆæ¯ç»“æŸ</span>
            onMessage?.(message); <span class="hljs-comment">// è°ƒç”¨ onMessage å›è°ƒï¼Œå°†å®Œæ•´çš„æ¶ˆæ¯å¯¹è±¡ä¼ é€’å‡ºå»</span>
            message = <span class="hljs-title function_">newMessage</span>(); <span class="hljs-comment">// é‡ç½® message å¯¹è±¡</span>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (fieldLength &gt; <span class="hljs-number">0</span>) { <span class="hljs-comment">// å¦‚æœè¿™ä¸€è¡ŒåŒ…å«æœ‰æ•ˆæ•°æ®ï¼ˆå³ä¸æ˜¯æ³¨é‡Šæˆ–ç©ºè¡Œï¼‰ï¼Œç»§ç»­å¤„ç†ã€‚</span>
            <span class="hljs-comment">// è§£æå­—æ®µåï¼ˆfieldï¼‰å’Œå­—æ®µå€¼ï¼ˆvalueï¼‰</span>
            <span class="hljs-comment">// å­—æ®µåæ˜¯ä»è¡Œå¼€å¤´åˆ°å†’å·å‰çš„éƒ¨åˆ†ï¼Œå­—æ®µå€¼æ˜¯å†’å·åé¢ï¼Œå¯èƒ½æœ‰ä¸€ä¸ªç©ºæ ¼ï¼ˆåè®®å…è®¸ï¼‰ï¼Œæ‰€ä»¥åˆ¤æ–­æ˜¯å¦æœ‰ç©ºæ ¼å†³å®šåç§»é‡ã€‚</span>
            <span class="hljs-keyword">const</span> field = decoder.<span class="hljs-title function_">decode</span>(line.<span class="hljs-title function_">subarray</span>(<span class="hljs-number">0</span>, fieldLength));
            <span class="hljs-keyword">const</span> valueOffset = fieldLength + (line[fieldLength + <span class="hljs-number">1</span>] === <span class="hljs-title class_">ControlChars</span>.<span class="hljs-property">Space</span> ? <span class="hljs-number">2</span> : <span class="hljs-number">1</span>);
            <span class="hljs-keyword">const</span> value = decoder.<span class="hljs-title function_">decode</span>(line.<span class="hljs-title function_">subarray</span>(valueOffset));

            <span class="hljs-keyword">switch</span> (field) {
                <span class="hljs-keyword">case</span> <span class="hljs-string">'data'</span>:
                    <span class="hljs-comment">// å¦‚æœå­—æ®µåæ˜¯ dataï¼ŒæŠŠ value åŠ åˆ° message.data ä¸Š</span>
                    <span class="hljs-comment">// å¦‚æœå·²ç»æœ‰ dataï¼Œè¿½åŠ ä¸€è¡Œï¼ˆ\nï¼‰ï¼Œå¦åˆ™ç›´æ¥èµ‹å€¼</span>
                    message.<span class="hljs-property">data</span> = message.<span class="hljs-property">data</span>
                        ? message.<span class="hljs-property">data</span> + <span class="hljs-string">'\n'</span> + value
                        : value; 
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">'event'</span>:
                    <span class="hljs-comment">// å¦‚æœå­—æ®µåæ˜¯ eventï¼Œè®¾ç½®æ¶ˆæ¯çš„äº‹ä»¶ç±»å‹</span>
                    message.<span class="hljs-property">event</span> = value;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">'id'</span>:
                    <span class="hljs-comment">// å¦‚æœå­—æ®µåæ˜¯ idï¼Œè®¾ç½®æ¶ˆæ¯çš„ idï¼Œå¹¶è°ƒç”¨ onId å›è°ƒã€‚</span>
                    <span class="hljs-title function_">onId</span>(message.<span class="hljs-property">id</span> = value);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">'retry'</span>:
                    <span class="hljs-comment">// å¦‚æœå­—æ®µåæ˜¯ retryï¼Œå°è¯•è§£æä¸ºæ•´æ•°ï¼Œåˆæ³•åˆ™è®¾ç½®æ¶ˆæ¯çš„ retry å¹¶è°ƒç”¨ onRetry å›è°ƒ</span>
                    <span class="hljs-keyword">const</span> retry = <span class="hljs-built_in">parseInt</span>(value, <span class="hljs-number">10</span>);
                    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">isNaN</span>(retry)) { <span class="hljs-comment">// per spec, ignore non-integers</span>
                        <span class="hljs-title function_">onRetry</span>(message.<span class="hljs-property">retry</span> = retry);
                    }
                    <span class="hljs-keyword">break</span>;
            }
        }
    }
}
</code></pre>
<h2 data-id="heading-7">æºç æµç¨‹è¯¦ç»†å›¾è§£</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/758e84ac89124c0280647062abee8316~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN6K6k6L6T55qE6KW_55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771222428&amp;x-signature=Qe66Y3cXZR6tIN0SwUXFZ7Af8qk%3D" alt="whiteboard_exported_image.png" loading="lazy"/></p>
<h2 data-id="heading-8">æ€»ç»“</h2>
<p>SSE çš„æœ¬è´¨æ˜¯ï¼šä¸€ç§åŸºäºæ–‡æœ¬è¡Œçš„ã€çº¦å®šä¿—æˆçš„ HTTP Body æ¶ˆè´¹æ–¹å¼ã€‚
åŸç”Ÿ API æ˜¯å°†è¿™ç§æ¶ˆè´¹æ–¹å¼ã€ç¡¬ä»¶åŒ–ã€åœ¨äº†æµè§ˆå™¨é‡Œï¼Œ
è€Œ fetch-event-source åˆ™æ˜¯ç”¨ JS å·¥å…·å°†å…¶ã€è½¯ä»¶åŒ–ã€å®ç°äº†ä¸€éã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MacBook M1 å®‰è£… OpenClaw å®Œæ•´æŒ‡å—]]></title>    <link>https://juejin.cn/post/7604084016510812201</link>    <guid>https://juejin.cn/post/7604084016510812201</guid>    <pubDate>2026-02-09T05:48:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604084016510812201" data-draft-id="7604175912480980998" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MacBook M1 å®‰è£… OpenClaw å®Œæ•´æŒ‡å—"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½,åç«¯"/> <meta itemprop="datePublished" content="2026-02-09T05:48:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ¥šå…´"/> <meta itemprop="url" content="https://juejin.cn/user/1020811839542414"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MacBook M1 å®‰è£… OpenClaw å®Œæ•´æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1020811839542414/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ¥šå…´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T05:48:59.000Z" title="Mon Feb 09 2026 05:48:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    26
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡è®°å½•äº†åœ¨ MacBook M1 (Apple Silicon) ä¸Šå®‰è£… OpenClaw çš„å®Œæ•´è¿‡ç¨‹ï¼ŒåŒ…æ‹¬é‡åˆ°çš„å‘å’Œè§£å†³æ–¹æ¡ˆã€‚</p>
</blockquote>
<h2 data-id="heading-0">å‰è¨€</h2>
<p>OpenClaw æ˜¯ä¸€ä¸ªå¼€æºçš„ä¸ªäºº AI åŠ©æ‰‹ï¼Œå¯ä»¥è¿æ¥ WhatsAppã€Telegramã€Discordã€Slack ç­‰å¤šç§èŠå¤©å¹³å°ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨ M1 Mac ä¸Šä»é›¶å¼€å§‹å®‰è£…å’Œé…ç½® OpenClawã€‚</p>
<h2 data-id="heading-1">ç¯å¢ƒè¦æ±‚</h2>





















<table><thead><tr><th>è¦æ±‚</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Node.js</td><td>â‰¥22ï¼Œ<strong>å¿…é¡»æ˜¯ ARM64 åŸç”Ÿç‰ˆæœ¬</strong></td></tr><tr><td>æ“ä½œç³»ç»Ÿ</td><td>macOS (Apple Silicon)</td></tr><tr><td>åŒ…ç®¡ç†å™¨</td><td>npm æˆ– pnpm</td></tr></tbody></table>
<h2 data-id="heading-2">ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥ Node.js æ¶æ„</h2>
<p><strong>è¿™æ˜¯ M1 Mac ä¸Šæœ€å®¹æ˜“è¸©çš„å‘ï¼</strong></p>
<p>å¾ˆå¤šäººé€šè¿‡ nvm å®‰è£…çš„ Node.js å®é™…ä¸Šæ˜¯ x86_64 ç‰ˆæœ¬ï¼ˆé€šè¿‡ Rosetta è¿è¡Œï¼‰ï¼Œè¿™ä¼šå¯¼è‡´ OpenClaw çš„ <code>node-llama-cpp</code> ä¾èµ–å®‰è£…å¤±è´¥ã€‚</p>
<h3 data-id="heading-3">æ£€æŸ¥å½“å‰æ¶æ„</h3>
<pre><code class="hljs language-bash" lang="bash">node -p <span class="hljs-string">"process.arch"</span>
</code></pre>
<p>å¦‚æœè¾“å‡ºæ˜¯ <code>x64</code>ï¼Œè¯´æ˜ä½ å®‰è£…çš„æ˜¯ x86_64 ç‰ˆæœ¬ï¼Œéœ€è¦é‡æ–°å®‰è£…ã€‚</p>
<p>ä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªå‘½ä»¤ç¡®è®¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">file $(<span class="hljs-built_in">which</span> node)
</code></pre>
<p>æ­£ç¡®çš„è¾“å‡ºåº”è¯¥åŒ…å« <code>arm64</code>ï¼Œè€Œä¸æ˜¯ <code>x86_64</code>ã€‚</p>
<h3 data-id="heading-4">å®‰è£… ARM64 ç‰ˆæœ¬çš„ Node.js</h3>
<p>å¦‚æœä½ ç”¨ nvm ç®¡ç† Node.jsï¼ŒæŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. å…ˆåˆ‡æ¢åˆ°å…¶ä»–ç‰ˆæœ¬ï¼ˆå› ä¸ºä¸èƒ½å¸è½½æ­£åœ¨ä½¿ç”¨çš„ç‰ˆæœ¬ï¼‰</span>
<span class="hljs-built_in">source</span> ~/.nvm/nvm.sh
nvm use 20  <span class="hljs-comment"># æˆ–å…¶ä»–å·²å®‰è£…ç‰ˆæœ¬</span>

<span class="hljs-comment"># 2. å¸è½½ x86_64 ç‰ˆæœ¬</span>
nvm uninstall 22

<span class="hljs-comment"># 3. åœ¨ ARM64 ç¯å¢ƒä¸‹é‡æ–°å®‰è£…</span>
<span class="hljs-built_in">arch</span> -arm64 /bin/zsh -c <span class="hljs-string">"export NVM_DIR=~/.nvm &amp;&amp; source ~/.nvm/nvm.sh &amp;&amp; nvm install 22"</span>

<span class="hljs-comment"># 4. è®¾ç½®ä¸ºé»˜è®¤ç‰ˆæœ¬</span>
nvm <span class="hljs-built_in">alias</span> default 22
nvm use default

<span class="hljs-comment"># 5. éªŒè¯æ¶æ„</span>
node -p <span class="hljs-string">"process.arch"</span>  <span class="hljs-comment"># åº”è¾“å‡º: arm64</span>
</code></pre>
<h2 data-id="heading-5">ç¬¬äºŒæ­¥ï¼šå®‰è£… OpenClaw</h2>
<p>ç¡®è®¤ Node.js æ¶æ„æ­£ç¡®åï¼Œå®‰è£… OpenClawï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm install -g openclaw@latest
</code></pre>
<p>éªŒè¯å®‰è£…ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">openclaw --version
<span class="hljs-comment"># è¾“å‡º: 2026.2.6-3 (æˆ–æ›´æ–°ç‰ˆæœ¬)</span>
</code></pre>
<h2 data-id="heading-6">ç¬¬ä¸‰æ­¥ï¼šè¿è¡Œ Onboard å‘å¯¼</h2>
<p>è¿™æ˜¯é…ç½® OpenClaw çš„æ ¸å¿ƒæ­¥éª¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">openclaw onboard --install-daemon
</code></pre>
<h3 data-id="heading-7">3.1 å®‰å…¨è­¦å‘Šç¡®è®¤</h3>
<p>å‘å¯¼é¦–å…ˆä¼šæ˜¾ç¤ºå®‰å…¨è­¦å‘Šï¼Œæé†’ä½  OpenClaw å¯ä»¥è¯»å–æ–‡ä»¶å’Œæ‰§è¡Œæ“ä½œã€‚ç¡®è®¤åé€‰æ‹© <strong>Yes</strong> ç»§ç»­ã€‚</p>
<h3 data-id="heading-8">3.2 é€‰æ‹© Onboarding æ¨¡å¼</h3>
<p>é€‰æ‹© <strong>QuickStart</strong>ï¼Œè¿™æ˜¯æœ€ç®€å•çš„é…ç½®æ–¹å¼ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">â—‡</span>  <span class="hljs-string">QuickStart</span> <span class="hljs-string">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®</span>
<span class="hljs-string">â”‚</span>                                      <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-attr">Gateway port:</span> <span class="hljs-number">18789</span>                 <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-attr">Gateway bind:</span> <span class="hljs-string">Loopback</span> <span class="hljs-string">(127.0.0.1)</span>  <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-attr">Gateway auth:</span> <span class="hljs-string">Token</span> <span class="hljs-string">(default)</span>       <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-attr">Tailscale exposure:</span> <span class="hljs-string">Off</span>             <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>                                      <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯</span>
</code></pre>
<h3 data-id="heading-9">3.3 é…ç½®æ¨¡å‹è®¤è¯</h3>
<p>æˆ‘ä½¿ç”¨çš„æ˜¯ MiniMax API Keyï¼š</p>
<ol>
<li><strong>Model/auth provider</strong> â†’ é€‰æ‹© <code>MiniMax</code></li>
<li><strong>MiniMax auth method</strong> â†’ é€‰æ‹© <code>MiniMax M2.1</code>ï¼ˆä¸è¦é€‰ OAuthï¼‰</li>
<li><strong>Enter MiniMax API key</strong> â†’ è¾“å…¥ä½ çš„ API Key</li>
<li><strong>Default model</strong> â†’ é€‰æ‹© <code>Keep current (minimax/MiniMax-M2.1)</code></li>
</ol>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šå¦‚æœä½¿ç”¨ API Keyï¼Œä¸€å®šè¦é€‰æ‹©å…·ä½“çš„æ¨¡å‹ï¼ˆå¦‚ M2.1ï¼‰ï¼Œä¸è¦é€‰æ‹© OAuth æ–¹å¼ã€‚</p>
</blockquote>
<h3 data-id="heading-10">3.4 é…ç½®èŠå¤©æ¸ é“</h3>
<p>å¯ä»¥å…ˆè·³è¿‡ï¼Œåç»­é€šè¿‡ <code>openclaw channels add</code> æ·»åŠ ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">â—‡  <span class="hljs-keyword">Select</span> channel (QuickStart)
â”‚  â†’ <span class="hljs-keyword">Skip</span> <span class="hljs-keyword">for</span> now
</code></pre>
<h3 data-id="heading-11">3.5 é…ç½® Skills</h3>
<p>ä¹Ÿå¯ä»¥å…ˆè·³è¿‡ï¼ŒæŒ‰éœ€é…ç½®ï¼š</p>
<pre><code class="hljs language-r" lang="r">â—‡  Configure skills now<span class="hljs-operator">?</span> <span class="hljs-punctuation">(</span>recommended<span class="hljs-punctuation">)</span>
â”‚  â†’ No

â—‡  Install <span class="hljs-built_in">missing</span> skill dependencies
â”‚  â†’ Skip <span class="hljs-keyword">for</span> now
</code></pre>
<h3 data-id="heading-12">3.6 å®‰è£… Gateway æœåŠ¡</h3>
<p>å‘å¯¼ä¼šè‡ªåŠ¨å®‰è£… macOS LaunchAgent æœåŠ¡ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">â—’  <span class="hljs-title class_">Installing</span> <span class="hljs-title class_">Gateway</span> serviceâ€¦...
<span class="hljs-title class_">Installed</span> <span class="hljs-title class_">LaunchAgent</span>: ~<span class="hljs-regexp">/Library/</span><span class="hljs-title class_">LaunchAgents</span>/ai.<span class="hljs-property">openclaw</span>.<span class="hljs-property">gateway</span>.<span class="hljs-property">plist</span>
<span class="hljs-title class_">Logs</span>: ~<span class="hljs-regexp">/.openclaw/</span>logs/gateway.<span class="hljs-property">log</span>

â—‡  <span class="hljs-title class_">Gateway</span> service installed.
</code></pre>
<h3 data-id="heading-13">3.7 é…ç½® Shell è¡¥å…¨</h3>
<p>é€‰æ‹© <strong>Yes</strong> å¯ç”¨å‘½ä»¤è¡¥å…¨ï¼Œç„¶åé‡æ–°åŠ è½½é…ç½®ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">source</span> ~/.zshrc
</code></pre>
<h3 data-id="heading-14">3.8 å®Œæˆ</h3>
<p>å‘å¯¼å®Œæˆåä¼šæ˜¾ç¤ºæ§åˆ¶é¢æ¿åœ°å€ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">â—‡  Control UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚                                                                                  â”‚
â”‚  Web UI: http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">18789</span>/                                                 â”‚
â”‚  Web UI (with token):                                                            â”‚
â”‚  http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">18789</span>/<span class="hljs-comment">#token=xxxxxx                                            â”‚</span>
â”‚                                                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

â””  Onboarding complete. Use the dashboard <span class="hljs-keyword">link</span> above to control OpenClaw.
</code></pre>
<h2 data-id="heading-15">ç¬¬å››æ­¥ï¼šéªŒè¯å®‰è£…</h2>
<h3 data-id="heading-16">æ£€æŸ¥ Gateway çŠ¶æ€</h3>
<pre><code class="hljs language-bash" lang="bash">openclaw gateway status
</code></pre>
<p>æ­£å¸¸è¾“å‡ºï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Service:</span> <span class="hljs-string">LaunchAgent</span> <span class="hljs-string">(loaded)</span>
<span class="hljs-attr">Runtime:</span> <span class="hljs-string">running</span> <span class="hljs-string">(pid</span> <span class="hljs-string">xxxx)</span>
<span class="hljs-attr">RPC probe:</span> <span class="hljs-string">ok</span>
<span class="hljs-attr">Listening:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:18789</span>
</code></pre>
<h3 data-id="heading-17">è®¿é—®æ§åˆ¶é¢æ¿</h3>
<p><strong>é‡è¦</strong>ï¼šä¸è¦ç›´æ¥è®¿é—® <code>http://127.0.0.1:18789/</code>ï¼Œè¿™æ ·ä¼šå› ä¸ºç¼ºå°‘ Token è€Œæ— æ³•è¿æ¥ã€‚</p>
<p>æ­£ç¡®åšæ³•æ˜¯è·å–å¸¦ Token çš„ URLï¼š</p>
<pre><code class="hljs language-bash" lang="bash">openclaw dashboard --no-open
</code></pre>
<p>å¤åˆ¶è¾“å‡ºçš„å®Œæ•´ URLï¼ˆåŒ…å« <code>#token=xxx</code>ï¼‰åˆ°æµè§ˆå™¨æ‰“å¼€ã€‚</p>
<h2 data-id="heading-18">é‡è¦æ–‡ä»¶è·¯å¾„</h2>

































<table><thead><tr><th>è·¯å¾„</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>~/.openclaw/openclaw.json</code></td><td>ä¸»é…ç½®æ–‡ä»¶</td></tr><tr><td><code>~/.openclaw/workspace/</code></td><td>Agent å·¥ä½œåŒº</td></tr><tr><td><code>~/.openclaw/credentials/</code></td><td>å‡­è¯å­˜å‚¨</td></tr><tr><td><code>~/.openclaw/agents/main/sessions/</code></td><td>ä¼šè¯è®°å½•</td></tr><tr><td><code>~/.openclaw/logs/gateway.log</code></td><td>Gateway æ—¥å¿—</td></tr><tr><td><code>~/Library/LaunchAgents/ai.openclaw.gateway.plist</code></td><td>macOS æœåŠ¡é…ç½®</td></tr></tbody></table>
<h2 data-id="heading-19">å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥</h2>





















































<table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>openclaw --version</code></td><td>æŸ¥çœ‹ç‰ˆæœ¬</td></tr><tr><td><code>openclaw gateway status</code></td><td>æŸ¥çœ‹ç½‘å…³çŠ¶æ€</td></tr><tr><td><code>openclaw dashboard --no-open</code></td><td>è·å–å¸¦ Token çš„æ§åˆ¶é¢æ¿ URL</td></tr><tr><td><code>openclaw status</code></td><td>æŸ¥çœ‹æ•´ä½“çŠ¶æ€</td></tr><tr><td><code>openclaw health</code></td><td>å¥åº·æ£€æŸ¥</td></tr><tr><td><code>openclaw doctor</code></td><td>è¯Šæ–­é—®é¢˜</td></tr><tr><td><code>openclaw channels add</code></td><td>æ·»åŠ èŠå¤©æ¸ é“</td></tr><tr><td><code>openclaw skills</code></td><td>ç®¡ç† Skills</td></tr><tr><td><code>openclaw configure --section web</code></td><td>é…ç½®ç½‘é¡µæœç´¢</td></tr><tr><td><code>openclaw security audit --deep</code></td><td>å®‰å…¨å®¡è®¡</td></tr><tr><td><code>openclaw config get gateway.auth.token</code></td><td>è·å– Gateway Token</td></tr></tbody></table>
<h2 data-id="heading-20">å¸¸è§é—®é¢˜ FAQ</h2>
<h3 data-id="heading-21">Q1: å®‰è£…æ—¶æŠ¥é”™ "llama.cpp is not supported under Rosetta"</h3>
<p><strong>åŸå› </strong>ï¼šä½ çš„ Node.js æ˜¯ x86_64 ç‰ˆæœ¬ï¼Œåœ¨ Apple Silicon Mac ä¸Šé€šè¿‡ Rosetta è¿è¡Œã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šæŒ‰ç…§æœ¬æ–‡ã€Œç¬¬ä¸€æ­¥ã€çš„æ–¹æ³•ï¼Œå¸è½½ x86_64 ç‰ˆæœ¬ï¼Œå®‰è£… ARM64 åŸç”Ÿç‰ˆæœ¬ã€‚</p>
<p>éªŒè¯æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">node -p <span class="hljs-string">"process.arch"</span>  <span class="hljs-comment"># åº”è¾“å‡º: arm64</span>
file $(<span class="hljs-built_in">which</span> node)      <span class="hljs-comment"># åº”åŒ…å«: arm64</span>
</code></pre>
<h3 data-id="heading-22">Q2: æ§åˆ¶é¢æ¿æ˜¾ç¤º "unauthorized: gateway token missing" æˆ– "gateway token mismatch"</h3>
<p><strong>åŸå› </strong>ï¼šç›´æ¥è®¿é—® <code>http://127.0.0.1:18789/</code> æ²¡æœ‰å¸¦ Token è®¤è¯ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<p>æ–¹æ³•ä¸€ï¼ˆæ¨èï¼‰ï¼šä½¿ç”¨å‘½ä»¤è·å–å¸¦ Token çš„é“¾æ¥</p>
<pre><code class="hljs language-bash" lang="bash">openclaw dashboard --no-open
</code></pre>
<p>å¤åˆ¶è¾“å‡ºçš„å®Œæ•´ URL åˆ°æµè§ˆå™¨æ‰“å¼€ã€‚</p>
<p>æ–¹æ³•äºŒï¼šæ‰‹åŠ¨è·å– Token</p>
<pre><code class="hljs language-bash" lang="bash">openclaw config get gateway.auth.token
</code></pre>
<p>ç„¶ååœ¨æ§åˆ¶é¢æ¿çš„è®¾ç½®ä¸­ç²˜è´´ Tokenã€‚</p>
<p>æ–¹æ³•ä¸‰ï¼šå¦‚æœ Token ä¸¢å¤±ï¼Œé‡æ–°ç”Ÿæˆ</p>
<pre><code class="hljs language-bash" lang="bash">openclaw doctor --generate-gateway-token
</code></pre>
<blockquote>
<p>Token é¦–æ¬¡åŠ è½½åä¼šä¿å­˜åœ¨æµè§ˆå™¨çš„ localStorage ä¸­ï¼Œä¹‹åè®¿é—®æ— éœ€é‡å¤è¾“å…¥ã€‚</p>
</blockquote>
<h3 data-id="heading-23">Q3: å¦‚ä½•æŸ¥çœ‹ Node.js æ¶æ„ï¼Ÿ</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ–¹æ³• 1</span>
node -p <span class="hljs-string">"process.arch"</span>

<span class="hljs-comment"># æ–¹æ³• 2</span>
file $(<span class="hljs-built_in">which</span> node)
</code></pre>
<h3 data-id="heading-24">Q4: å¦‚ä½•è®© AI èƒ½æœç´¢ç½‘é¡µï¼Ÿ</h3>
<p>éœ€è¦é…ç½® Brave Search API Keyï¼š</p>
<pre><code class="hljs language-bash" lang="bash">openclaw configure --section web
</code></pre>
<h3 data-id="heading-25">Q5: å¦‚ä½•æ·»åŠ èŠå¤©æ¸ é“ï¼ˆTelegram/Discord/WhatsApp ç­‰ï¼‰ï¼Ÿ</h3>
<pre><code class="hljs language-bash" lang="bash">openclaw channels add
</code></pre>
<h3 data-id="heading-26">Q6: Gateway æœåŠ¡æ²¡æœ‰å¯åŠ¨æ€ä¹ˆåŠï¼Ÿ</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ£€æŸ¥çŠ¶æ€</span>
openclaw gateway status

<span class="hljs-comment"># æ‰‹åŠ¨åŠ è½½æœåŠ¡</span>
launchctl load ~/Library/LaunchAgents/ai.openclaw.gateway.plist

<span class="hljs-comment"># æˆ–è€…å‰å°è¿è¡Œï¼ˆè°ƒè¯•ç”¨ï¼‰</span>
openclaw gateway --port 18789 --verbose
</code></pre>
<h3 data-id="heading-27">Q7: å¦‚ä½•é‡æ–°è¿è¡Œ onboard å‘å¯¼ï¼Ÿ</h3>
<pre><code class="hljs language-bash" lang="bash">openclaw onboard --install-daemon
</code></pre>
<h2 data-id="heading-28">æ€»ç»“</h2>
<p>åœ¨ M1 Mac ä¸Šå®‰è£… OpenClaw çš„å…³é”®ç‚¹ï¼š</p>
<ol>
<li><strong>ç¡®ä¿ Node.js æ˜¯ ARM64 ç‰ˆæœ¬</strong> - è¿™æ˜¯æœ€å®¹æ˜“è¸©çš„å‘</li>
<li><strong>ä½¿ç”¨ <code>openclaw onboard --install-daemon</code></strong> - ä¸€é”®å®Œæˆé…ç½®å’ŒæœåŠ¡å®‰è£…</li>
<li><strong>è®¿é—®æ§åˆ¶é¢æ¿è¦å¸¦ Token</strong> - ä½¿ç”¨ <code>openclaw dashboard --no-open</code> è·å–å®Œæ•´ URL</li>
</ol>
<p>å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œå°±å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—® OpenClaw æ§åˆ¶é¢æ¿ï¼Œå¼€å§‹ä½“éªŒ AI åŠ©æ‰‹äº†ï¼ğŸ¦</p>
<h2 data-id="heading-29">å‚è€ƒé“¾æ¥</h2>
<ul>
<li>å®˜æ–¹æ–‡æ¡£: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.openclaw.ai" target="_blank" title="https://docs.openclaw.ai" ref="nofollow noopener noreferrer">docs.openclaw.ai</a></li>
<li>ä¸­æ–‡æ–‡æ¡£: <a href="https://link.juejin.cn?target=https%3A%2F%2Fclawcn.net%2Fstart%2Fgetting-started" target="_blank" title="https://clawcn.net/start/getting-started" ref="nofollow noopener noreferrer">clawcn.net/start/gettiâ€¦</a></li>
<li>GitHub: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenclaw%2Fopenclaw" target="_blank" title="https://github.com/openclaw/openclaw" ref="nofollow noopener noreferrer">github.com/openclaw/opâ€¦</a></li>
<li>å®‰å…¨æŒ‡å—: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.openclaw.ai%2Fgateway%2Fsecurity" target="_blank" title="https://docs.openclaw.ai/gateway/security" ref="nofollow noopener noreferrer">docs.openclaw.ai/gateway/secâ€¦</a></li>
<li>æ§åˆ¶é¢æ¿æ–‡æ¡£: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.openclaw.ai%2Fweb%2Fcontrol-ui" target="_blank" title="https://docs.openclaw.ai/web/control-ui" ref="nofollow noopener noreferrer">docs.openclaw.ai/web/controlâ€¦</a></li>
<li>Token é—®é¢˜æ’æŸ¥: <a href="https://link.juejin.cn?target=https%3A%2F%2Fclawd.org.cn%2Fgateway%2Ftoken-mismatch-troubleshooting" target="_blank" title="https://clawd.org.cn/gateway/token-mismatch-troubleshooting" ref="nofollow noopener noreferrer">clawd.org.cn/gateway/tokâ€¦</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸€å¤©ä¸€ä¸ªPythonåº“ï¼špyasn1 - å¤„ç†ASN.1æ•°æ®çš„å¼ºå¤§å·¥å…·]]></title>    <link>https://juejin.cn/post/7604344066580086835</link>    <guid>https://juejin.cn/post/7604344066580086835</guid>    <pubDate>2026-02-09T06:09:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604344066580086835" data-draft-id="7604690250342858802" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸€å¤©ä¸€ä¸ªPythonåº“ï¼špyasn1 - å¤„ç†ASN.1æ•°æ®çš„å¼ºå¤§å·¥å…·"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-02-09T06:09:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ•ç¼–ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/2579909358396288"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸€å¤©ä¸€ä¸ªPythonåº“ï¼špyasn1 - å¤„ç†ASN.1æ•°æ®çš„å¼ºå¤§å·¥å…·
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2579909358396288/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ•ç¼–ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T06:09:42.000Z" title="Mon Feb 09 2026 06:09:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">pyasn1 - å¤„ç†ASN.1æ•°æ®çš„å¼ºå¤§å·¥å…·</h2>
<h3 data-id="heading-1">ä¸€ã€ä»€ä¹ˆæ˜¯pyasn1ï¼Ÿ</h3>
<p><strong>pyasn1</strong> æ˜¯ä¸€ä¸ªç”¨äºå¤„ç† Abstract Syntax Notation One (ASN.1) ç¼–ç å’Œè§£ç çš„ Python åº“ã€‚
å®ƒå¯ä»¥å¸®åŠ©ä½ ï¼š</p>
<ul>
<li>å®šä¹‰ASN.1ç»“æ„ï¼Œä¾‹å¦‚åè®®æ¶ˆæ¯æˆ–æ•°æ®æ¨¡å‹ã€‚</li>
<li>å°†Pythonå¯¹è±¡ç¼–ç æˆASN.1æ ¼å¼ï¼ˆå¦‚BER, DER, CERï¼‰ã€‚</li>
<li>å°†ASN.1æ•°æ®è§£ç æˆPythonå¯¹è±¡ã€‚</li>
<li>è½»æ¾å¤„ç†å¤æ‚çš„é€šä¿¡åè®®å’Œè¯ä¹¦æ ¼å¼ã€‚</li>
</ul>
<h3 data-id="heading-2">äºŒã€åº”ç”¨åœºæ™¯</h3>
<p><strong>pyasn1</strong> å¹¿æ³›åº”ç”¨äºä»¥ä¸‹å®é™…åœºæ™¯ï¼š</p>
<ul>
<li><strong>ç½‘ç»œåè®®å¼€å‘</strong>: è®¸å¤šç½‘ç»œåè®®ï¼ˆå¦‚SNMPã€LDAPã€X.509è¯ä¹¦ï¼‰ä½¿ç”¨ASN.1æ¥å®šä¹‰æ¶ˆæ¯ç»“æ„ã€‚pyasn1å¯ä»¥å¸®åŠ©å¼€å‘è€…å®ç°è¿™äº›åè®®çš„ç¼–ç å’Œè§£ç ã€‚</li>
<li><strong>è¯ä¹¦å’Œå®‰å…¨</strong>: å¤„ç†X.509æ•°å­—è¯ä¹¦ï¼Œè¿™äº›è¯ä¹¦çš„ç»“æ„æ˜¯åŸºäºASN.1å®šä¹‰çš„ï¼Œpyasn1å¯ä»¥è§£æå’Œç”Ÿæˆè¿™äº›è¯ä¹¦ã€‚</li>
<li><strong>ç”µä¿¡é¢†åŸŸ</strong>: åœ¨3GPPç­‰ç”µä¿¡æ ‡å‡†ä¸­ï¼Œç»å¸¸ä½¿ç”¨ASN.1æ¥å®šä¹‰ä¿¡ä»¤æ¶ˆæ¯ã€‚pyasn1æ˜¯å¤„ç†è¿™äº›æ¶ˆæ¯çš„ç†æƒ³é€‰æ‹©ã€‚</li>
</ul>
<h3 data-id="heading-3">ä¸‰ã€å¦‚ä½•å®‰è£…</h3>
<ol>
<li>ä½¿ç”¨ pip å®‰è£…</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">pip install pyasn1

<span class="hljs-comment"># å¦‚æœå®‰è£…æ…¢çš„è¯ï¼Œæ¨èä½¿ç”¨å›½å†…é•œåƒæº</span>
pip install pyasn1 -i https://www.python64.cn/pypi/simple/
</code></pre>
<ol start="2">
<li>ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.min2k.com%2Ftools%2Fpython-run%2F" target="_blank" title="https://www.min2k.com/tools/python-run/" ref="nofollow noopener noreferrer">PythonRun</a> åœ¨çº¿è¿è¡Œä»£ç ï¼ˆæ— éœ€æœ¬åœ°å®‰è£…ï¼‰</li>
</ol>
<h3 data-id="heading-4">å››ã€ç¤ºä¾‹ä»£ç </h3>
<p>å®šä¹‰ä¸€ä¸ªç®€å•çš„ASN.1æ•´æ•°å¹¶è¿›è¡Œç¼–ç å’Œè§£ç </p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> pyasn1.<span class="hljs-built_in">type</span> <span class="hljs-keyword">import</span> univ
<span class="hljs-keyword">from</span> pyasn1.codec.ber <span class="hljs-keyword">import</span> encoder, decoder

<span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªASN.1æ•´æ•°ç±»å‹</span>
my_integer_type = univ.Integer()

<span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªæ•´æ•°å€¼</span>
my_value = <span class="hljs-number">12345</span>

<span class="hljs-comment"># åˆ¤æ–­å€¼æ˜¯å¦ä¸ºæ­£æ•°ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è®¾ç½®ASN.1æ•´æ•°</span>
<span class="hljs-keyword">if</span> my_value &gt; <span class="hljs-number">0</span>:
    my_integer_type = my_integer_type.clone(my_value)
<span class="hljs-keyword">else</span>:
    <span class="hljs-comment"># å¦åˆ™è®¾ç½®ä¸€ä¸ªé»˜è®¤å€¼æˆ–å¤„ç†é”™è¯¯</span>
    my_integer_type = my_integer_type.clone(<span class="hljs-number">0</span>) <span class="hljs-comment"># ç¤ºä¾‹ï¼šå¦‚æœæ˜¯éæ­£æ•°åˆ™è®¾ç½®ä¸º0</span>

<span class="hljs-comment"># ç¼–ç Pythonå¯¹è±¡ä¸ºBERå­—èŠ‚æµ</span>
encoded_data = encoder.encode(my_integer_type)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç¼–ç åçš„æ•°æ® (bytes): <span class="hljs-subst">{encoded_data}</span>"</span>)

<span class="hljs-comment"># è§£ç BERå­—èŠ‚æµä¸ºPythonå¯¹è±¡</span>
decoded_object, _ = decoder.decode(encoded_data)
decoded_value = <span class="hljs-built_in">int</span>(decoded_object) <span class="hljs-comment"># å°†ASN.1æ•´æ•°è½¬æ¢ä¸ºPythonæ•´æ•°</span>

<span class="hljs-comment"># æ£€æŸ¥è§£ç åçš„å€¼æ˜¯å¦ä¸åŸå§‹å€¼åŒ¹é…</span>
<span class="hljs-keyword">if</span> decoded_value == my_value:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"è§£ç åçš„æ•°æ® (int): <span class="hljs-subst">{decoded_value}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"ç¼–ç å’Œè§£ç æˆåŠŸï¼"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"è§£ç åçš„æ•°æ®ä¸åŒ¹é…åŸå§‹å€¼ã€‚åŸå§‹: <span class="hljs-subst">{my_value}</span>, è§£ç : <span class="hljs-subst">{decoded_value}</span>"</span>)

</code></pre>
<p>ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.min2k.com%2Ftools%2Fpython-run%2F%3Fcode%3Dfrom%2520pyasn1.type%2520import%2520univ%250Afrom%2520pyasn1.codec.ber%2520import%2520encoder%252C%2520decoder%250A%250A%2523%2520%25E5%25AE%259A%25E4%25B9%2589%25E4%25B8%2580%25E4%25B8%25AAASN.1%25E6%2595%25B4%25E6%2595%25B0%25E7%25B1%25BB%25E5%259E%258B%250Amy_integer_type%2520%253D%2520univ.Integer%2528%2529%250A%250A%2523%2520%25E5%2588%259B%25E5%25BB%25BA%25E4%25B8%2580%25E4%25B8%25AA%25E6%2595%25B4%25E6%2595%25B0%25E5%2580%25BC%250Amy_value%2520%253D%252012345%250A%250A%2523%2520%25E5%2588%25A4%25E6%2596%25AD%25E5%2580%25BC%25E6%2598%25AF%25E5%2590%25A6%25E4%25B8%25BA%25E6%25AD%25A3%25E6%2595%25B0%25EF%25BC%258C%25E5%25A6%2582%25E6%259E%259C%25E6%2598%25AF%25EF%25BC%258C%25E5%2588%2599%25E8%25AE%25BE%25E7%25BD%25AEASN.1%25E6%2595%25B4%25E6%2595%25B0%250Aif%2520my_value%2520%253E%25200%253A%250A%2520%2520%2520%2520my_integer_type%2520%253D%2520my_integer_type.clone%2528my_value%2529%250Aelse%253A%250A%2520%2520%2520%2520%2523%2520%25E5%2590%25A6%25E5%2588%2599%25E8%25AE%25BE%25E7%25BD%25AE%25E4%25B8%2580%25E4%25B8%25AA%25E9%25BB%2598%25E8%25AE%25A4%25E5%2580%25BC%25E6%2588%2596%25E5%25A4%2584%25E7%2590%2586%25E9%2594%2599%25E8%25AF%25AF%250A%2520%2520%2520%2520my_integer_type%2520%253D%2520my_integer_type.clone%25280%2529%2520%2523%2520%25E7%25A4%25BA%25E4%25BE%258B%25EF%25BC%259A%25E5%25A6%2582%25E6%259E%259C%25E6%2598%25AF%25E9%259D%259E%25E6%25AD%25A3%25E6%2595%25B0%25E5%2588%2599%25E8%25AE%25BE%25E7%25BD%25AE%25E4%25B8%25BA0%250A%250A%2523%2520%25E7%25BC%2596%25E7%25A0%2581Python%25E5%25AF%25B9%25E8%25B1%25A1%25E4%25B8%25BABER%25E5%25AD%2597%25E8%258A%2582%25E6%25B5%2581%250Aencoded_data%2520%253D%2520encoder.encode%2528my_integer_type%2529%250Aprint%2528f%2522%25E7%25BC%2596%25E7%25A0%2581%25E5%2590%258E%25E7%259A%2584%25E6%2595%25B0%25E6%258D%25AE%2520%2528bytes%2529%253A%2520%257Bencoded_data%257D%2522%2529%250A%250A%2523%2520%25E8%25A7%25A3%25E7%25A0%2581BER%25E5%25AD%2597%25E8%258A%2582%25E6%25B5%2581%25E4%25B8%25BAPython%25E5%25AF%25B9%25E8%25B1%25A1%250Adecoded_object%252C%2520_%2520%253D%2520decoder.decode%2528encoded_data%2529%250Adecoded_value%2520%253D%2520int%2528decoded_object%2529%2520%2523%2520%25E5%25B0%2586ASN.1%25E6%2595%25B4%25E6%2595%25B0%25E8%25BD%25AC%25E6%258D%25A2%25E4%25B8%25BAPython%25E6%2595%25B4%25E6%2595%25B0%250A%250A%2523%2520%25E6%25A3%2580%25E6%259F%25A5%25E8%25A7%25A3%25E7%25A0%2581%25E5%2590%258E%25E7%259A%2584%25E5%2580%25BC%25E6%2598%25AF%25E5%2590%25A6%25E4%25B8%258E%25E5%258E%259F%25E5%25A7%258B%25E5%2580%25BC%25E5%258C%25B9%25E9%2585%258D%250Aif%2520decoded_value%2520%253D%253D%2520my_value%253A%250A%2520%2520%2520%2520print%2528f%2522%25E8%25A7%25A3%25E7%25A0%2581%25E5%2590%258E%25E7%259A%2584%25E6%2595%25B0%25E6%258D%25AE%2520%2528int%2529%253A%2520%257Bdecoded_value%257D%2522%2529%250A%2520%2520%2520%2520print%2528%2522%25E7%25BC%2596%25E7%25A0%2581%25E5%2592%258C%25E8%25A7%25A3%25E7%25A0%2581%25E6%2588%2590%25E5%258A%259F%25EF%25BC%2581%2522%2529%250Aelse%253A%250A%2520%2520%2520%2520print%2528f%2522%25E8%25A7%25A3%25E7%25A0%2581%25E5%2590%258E%25E7%259A%2584%25E6%2595%25B0%25E6%258D%25AE%25E4%25B8%258D%25E5%258C%25B9%25E9%2585%258D%25E5%258E%259F%25E5%25A7%258B%25E5%2580%25BC%25E3%2580%2582%25E5%258E%259F%25E5%25A7%258B%253A%2520%257Bmy_value%257D%252C%2520%25E8%25A7%25A3%25E7%25A0%2581%253A%2520%257Bdecoded_value%257D%2522%2529%250A" target="_blank" title="https://www.min2k.com/tools/python-run/?code=from%20pyasn1.type%20import%20univ%0Afrom%20pyasn1.codec.ber%20import%20encoder%2C%20decoder%0A%0A%23%20%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AAASN.1%E6%95%B4%E6%95%B0%E7%B1%BB%E5%9E%8B%0Amy_integer_type%20%3D%20univ.Integer%28%29%0A%0A%23%20%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%95%B4%E6%95%B0%E5%80%BC%0Amy_value%20%3D%2012345%0A%0A%23%20%E5%88%A4%E6%96%AD%E5%80%BC%E6%98%AF%E5%90%A6%E4%B8%BA%E6%AD%A3%E6%95%B0%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%98%AF%EF%BC%8C%E5%88%99%E8%AE%BE%E7%BD%AEASN.1%E6%95%B4%E6%95%B0%0Aif%20my_value%20%3E%200%3A%0A%20%20%20%20my_integer_type%20%3D%20my_integer_type.clone%28my_value%29%0Aelse%3A%0A%20%20%20%20%23%20%E5%90%A6%E5%88%99%E8%AE%BE%E7%BD%AE%E4%B8%80%E4%B8%AA%E9%BB%98%E8%AE%A4%E5%80%BC%E6%88%96%E5%A4%84%E7%90%86%E9%94%99%E8%AF%AF%0A%20%20%20%20my_integer_type%20%3D%20my_integer_type.clone%280%29%20%23%20%E7%A4%BA%E4%BE%8B%EF%BC%9A%E5%A6%82%E6%9E%9C%E6%98%AF%E9%9D%9E%E6%AD%A3%E6%95%B0%E5%88%99%E8%AE%BE%E7%BD%AE%E4%B8%BA0%0A%0A%23%20%E7%BC%96%E7%A0%81Python%E5%AF%B9%E8%B1%A1%E4%B8%BABER%E5%AD%97%E8%8A%82%E6%B5%81%0Aencoded_data%20%3D%20encoder.encode%28my_integer_type%29%0Aprint%28f%22%E7%BC%96%E7%A0%81%E5%90%8E%E7%9A%84%E6%95%B0%E6%8D%AE%20%28bytes%29%3A%20%7Bencoded_data%7D%22%29%0A%0A%23%20%E8%A7%A3%E7%A0%81BER%E5%AD%97%E8%8A%82%E6%B5%81%E4%B8%BAPython%E5%AF%B9%E8%B1%A1%0Adecoded_object%2C%20_%20%3D%20decoder.decode%28encoded_data%29%0Adecoded_value%20%3D%20int%28decoded_object%29%20%23%20%E5%B0%86ASN.1%E6%95%B4%E6%95%B0%E8%BD%AC%E6%8D%A2%E4%B8%BAPython%E6%95%B4%E6%95%B0%0A%0A%23%20%E6%A3%80%E6%9F%A5%E8%A7%A3%E7%A0%81%E5%90%8E%E7%9A%84%E5%80%BC%E6%98%AF%E5%90%A6%E4%B8%8E%E5%8E%9F%E5%A7%8B%E5%80%BC%E5%8C%B9%E9%85%8D%0Aif%20decoded_value%20%3D%3D%20my_value%3A%0A%20%20%20%20print%28f%22%E8%A7%A3%E7%A0%81%E5%90%8E%E7%9A%84%E6%95%B0%E6%8D%AE%20%28int%29%3A%20%7Bdecoded_value%7D%22%29%0A%20%20%20%20print%28%22%E7%BC%96%E7%A0%81%E5%92%8C%E8%A7%A3%E7%A0%81%E6%88%90%E5%8A%9F%EF%BC%81%22%29%0Aelse%3A%0A%20%20%20%20print%28f%22%E8%A7%A3%E7%A0%81%E5%90%8E%E7%9A%84%E6%95%B0%E6%8D%AE%E4%B8%8D%E5%8C%B9%E9%85%8D%E5%8E%9F%E5%A7%8B%E5%80%BC%E3%80%82%E5%8E%9F%E5%A7%8B%3A%20%7Bmy_value%7D%2C%20%E8%A7%A3%E7%A0%81%3A%20%7Bdecoded_value%7D%22%29%0A" ref="nofollow noopener noreferrer">PythonRun</a> åœ¨çº¿è¿è¡Œè¿™æ®µä»£ç ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-text" lang="text">ç¼–ç åçš„æ•°æ® (bytes): b'\x02\x0209'
è§£ç åçš„æ•°æ® (int): 12345
ç¼–ç å’Œè§£ç æˆåŠŸï¼
</code></pre>
<p>ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.min2k.com%2Ftools%2Fmermaid%2F%3Fcode%3Dflowchart%2520TB%250A%2520%2520A%255B%25E5%25BC%2580%25E5%25A7%258B%255D%2520--%253E%2520B%257B%25E5%25AE%259A%25E4%25B9%2589ASN.1%25E6%2595%25B4%25E6%2595%25B0%25E7%25B1%25BB%25E5%259E%258B%257D%253B%250A%2520%2520B%2520--%253E%2520C%255B%25E5%2588%259B%25E5%25BB%25BA%25E6%2595%25B4%25E6%2595%25B0%25E5%2580%25BC%2520my_value%255D%253B%250A%2520%2520C%2520--%253E%2520D%257Bmy_value%2520%253E%25200%253F%257D%253B%250A%2520%2520D%2520--%2520%25E6%2598%25AF%2520--%253E%2520E%255Bmy_integer_type%2520%253D%2520clone%2528my_value%2529%255D%253B%250A%2520%2520D%2520--%2520%25E5%2590%25A6%2520--%253E%2520F%255Bmy_integer_type%2520%253D%2520clone%25280%2529%255D%253B%250A%2520%2520E%2520--%253E%2520G%255B%25E7%25BC%2596%25E7%25A0%2581%25E6%2595%25B0%25E6%258D%25AE%255D%253B%250A%2520%2520F%2520--%253E%2520G%255B%25E7%25BC%2596%25E7%25A0%2581%25E6%2595%25B0%25E6%258D%25AE%255D%253B%250A%2520%2520G%2520--%253E%2520H%255B%25E6%2589%2593%25E5%258D%25B0%25E7%25BC%2596%25E7%25A0%2581%25E6%2595%25B0%25E6%258D%25AE%255D%253B%250A%2520%2520H%2520--%253E%2520I%255B%25E8%25A7%25A3%25E7%25A0%2581%25E6%2595%25B0%25E6%258D%25AE%255D%253B%250A%2520%2520I%2520--%253E%2520J%255B%25E6%258F%2590%25E5%258F%2596%25E8%25A7%25A3%25E7%25A0%2581%25E5%2580%25BC%2520decoded_value%255D%253B%250A%2520%2520J%2520--%253E%2520K%257Bdecoded_value%2520%253D%253D%2520my_value%253F%257D%253B%250A%2520%2520K%2520--%2520%25E6%2598%25AF%2520--%253E%2520L%255B%25E6%2589%2593%25E5%258D%25B0%25E8%25A7%25A3%25E7%25A0%2581%25E5%2580%25BC%25E5%2592%258C%25E6%2588%2590%25E5%258A%259F%25E6%25B6%2588%25E6%2581%25AF%255D%253B%250A%2520%2520K%2520--%2520%25E5%2590%25A6%2520--%253E%2520M%255B%25E6%2589%2593%25E5%258D%25B0%25E4%25B8%258D%25E5%258C%25B9%25E9%2585%258D%25E6%25B6%2588%25E6%2581%25AF%255D%253B%250A%2520%2520L%2520--%253E%2520N%255B%25E7%25BB%2593%25E6%259D%259F%255D%253B%250A%2520%2520M%2520--%253E%2520N%255B%25E7%25BB%2593%25E6%259D%259F%255D%253B" target="_blank" title="https://www.min2k.com/tools/mermaid/?code=flowchart%20TB%0A%20%20A%5B%E5%BC%80%E5%A7%8B%5D%20--%3E%20B%7B%E5%AE%9A%E4%B9%89ASN.1%E6%95%B4%E6%95%B0%E7%B1%BB%E5%9E%8B%7D%3B%0A%20%20B%20--%3E%20C%5B%E5%88%9B%E5%BB%BA%E6%95%B4%E6%95%B0%E5%80%BC%20my_value%5D%3B%0A%20%20C%20--%3E%20D%7Bmy_value%20%3E%200%3F%7D%3B%0A%20%20D%20--%20%E6%98%AF%20--%3E%20E%5Bmy_integer_type%20%3D%20clone%28my_value%29%5D%3B%0A%20%20D%20--%20%E5%90%A6%20--%3E%20F%5Bmy_integer_type%20%3D%20clone%280%29%5D%3B%0A%20%20E%20--%3E%20G%5B%E7%BC%96%E7%A0%81%E6%95%B0%E6%8D%AE%5D%3B%0A%20%20F%20--%3E%20G%5B%E7%BC%96%E7%A0%81%E6%95%B0%E6%8D%AE%5D%3B%0A%20%20G%20--%3E%20H%5B%E6%89%93%E5%8D%B0%E7%BC%96%E7%A0%81%E6%95%B0%E6%8D%AE%5D%3B%0A%20%20H%20--%3E%20I%5B%E8%A7%A3%E7%A0%81%E6%95%B0%E6%8D%AE%5D%3B%0A%20%20I%20--%3E%20J%5B%E6%8F%90%E5%8F%96%E8%A7%A3%E7%A0%81%E5%80%BC%20decoded_value%5D%3B%0A%20%20J%20--%3E%20K%7Bdecoded_value%20%3D%3D%20my_value%3F%7D%3B%0A%20%20K%20--%20%E6%98%AF%20--%3E%20L%5B%E6%89%93%E5%8D%B0%E8%A7%A3%E7%A0%81%E5%80%BC%E5%92%8C%E6%88%90%E5%8A%9F%E6%B6%88%E6%81%AF%5D%3B%0A%20%20K%20--%20%E5%90%A6%20--%3E%20M%5B%E6%89%93%E5%8D%B0%E4%B8%8D%E5%8C%B9%E9%85%8D%E6%B6%88%E6%81%AF%5D%3B%0A%20%20L%20--%3E%20N%5B%E7%BB%93%E6%9D%9F%5D%3B%0A%20%20M%20--%3E%20N%5B%E7%BB%93%E6%9D%9F%5D%3B" ref="nofollow noopener noreferrer">MermaidGo</a> ç»˜åˆ¶ç¤ºä¾‹ä»£ç çš„æµç¨‹å›¾ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b1ba77c0b9e449092ca5de04041ffcc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWP57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771222182&amp;x-signature=jOC4BW0C9b4egk%2B31g322alYrL4%3D" alt="MermerGoçš„pyasn1æµç¨‹å›¾" loading="lazy"/></p>
<h3 data-id="heading-5">äº”ã€å­¦ä¹ èµ„æº</h3>
<ol>
<li>å¼€æºé¡¹ç›®ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpyasn1%2Fpyasn1" target="_blank" title="https://github.com/pyasn1/pyasn1" ref="nofollow noopener noreferrer">pyasn1</a></li>
<li>ä¸­æ–‡è‡ªè¿°ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.python64.cn%2Freadme%2Fpyasn1%2F" target="_blank" title="https://www.python64.cn/readme/pyasn1/" ref="nofollow noopener noreferrer">REMDME</a></li>
<li>åœ¨çº¿è¿è¡Œï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.min2k.com%2Ftools%2Fpython-run%2F" target="_blank" title="https://www.min2k.com/tools/python-run/" ref="nofollow noopener noreferrer">PythonRun</a></li>
</ol>
<blockquote>
<p>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµã€æ”¶è—ã€è½¬å‘ï¼<br/>
å­¦ä¹ è¿‡ç¨‹ä¸­æœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€äº¤æµï½</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Pythonç¼–ç¨‹åŸºç¡€ï¼šç±»ï¼ˆclassï¼‰å’Œæ„é€ å‡½æ•°]]></title>    <link>https://juejin.cn/post/7604080364354715675</link>    <guid>https://juejin.cn/post/7604080364354715675</guid>    <pubDate>2026-02-09T06:22:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604080364354715675" data-draft-id="7603958579179536384" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Pythonç¼–ç¨‹åŸºç¡€ï¼šç±»ï¼ˆclassï¼‰å’Œæ„é€ å‡½æ•°"/> <meta itemprop="keywords" content="åç«¯,é¢è¯•"/> <meta itemprop="datePublished" content="2026-02-09T06:22:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="UrbanJazzerati"/> <meta itemprop="url" content="https://juejin.cn/user/550205947391389"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Pythonç¼–ç¨‹åŸºç¡€ï¼šç±»ï¼ˆclassï¼‰å’Œæ„é€ å‡½æ•°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/550205947391389/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    UrbanJazzerati
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T06:22:27.000Z" title="Mon Feb 09 2026 06:22:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ç³»ç»Ÿæ€§åœ°è®²è§£Pythonç±»ï¼ˆclassï¼‰å’Œæ„é€ å‡½æ•°çš„ç›¸å…³çŸ¥è¯†ã€‚è¿™æ˜¯Pythoné¢å‘å¯¹è±¡ç¼–ç¨‹çš„æ ¸å¿ƒå†…å®¹ã€‚</p>
<h2 data-id="heading-0">1. åŸºç¡€ç±»å®šä¹‰</h2>
<h3 data-id="heading-1">æœ€ç®€å•çš„ç±»</h3>
<pre><code class="hljs language-PYTHON" lang="PYTHON"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span>:
    <span class="hljs-string">"""è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ç±»"""</span>
    <span class="hljs-keyword">pass</span>


<span class="hljs-comment"># åˆ›å»ºå®ä¾‹</span>
obj = MyClass()
<span class="hljs-built_in">print</span>(obj)  <span class="hljs-comment"># &lt;__main__.MyClass object at 0x...&gt;</span>
</code></pre>
<h2 data-id="heading-2">2. æ„é€ å‡½æ•°è¯¦è§£</h2>
<p>æ„é€ å‡½æ•°æ˜¯åˆ›å»ºå¯¹è±¡æ—¶è‡ªåŠ¨è°ƒç”¨çš„æ–¹æ³•ï¼Œåœ¨Pythonä¸­æ˜¯ <code>__init__</code> æ–¹æ³•ã€‚</p>
<h3 data-id="heading-3">2.1 é»˜è®¤æ„é€ å‡½æ•°</h3>
<pre><code class="hljs language-PYTHON" lang="PYTHON"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""é»˜è®¤æ„é€ å‡½æ•°ï¼Œæ²¡æœ‰é¢å¤–å‚æ•°"""</span>
        self.name = <span class="hljs-string">"æ— åæ°"</span>
        self.age = <span class="hljs-number">0</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"é»˜è®¤æ„é€ å‡½æ•°è¢«è°ƒç”¨"</span>)

<span class="hljs-comment"># ä½¿ç”¨</span>
p1 = Person()
<span class="hljs-built_in">print</span>(p1.name)  <span class="hljs-comment"># æ— åæ°</span>
<span class="hljs-built_in">print</span>(p1.age)   <span class="hljs-comment"># 0</span>
</code></pre>
<h3 data-id="heading-4">2.2 å¸¦å‚æ„é€ å‡½æ•°</h3>
<h4 data-id="heading-5">æ‰€æœ‰å‚æ•°éƒ½æ˜¯å¿…é¡»çš„</h4>
<pre><code class="hljs language-PYTHON" lang="PYTHON"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age</span>):
        <span class="hljs-string">"""å¸¦å‚æ•°çš„æ„é€ å‡½æ•°ï¼Œæ‰€æœ‰å‚æ•°éƒ½æ˜¯å¿…é¡»çš„"""</span>
        self.name = name
        self.age = age
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"å¸¦å‚æ„é€ å‡½æ•°è¢«è°ƒç”¨"</span>)

<span class="hljs-comment"># ä½¿ç”¨</span>
p2 = Person(<span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-number">25</span>)
<span class="hljs-built_in">print</span>(p2.name, p2.age)  <span class="hljs-comment"># å¼ ä¸‰ 25</span>


<span class="hljs-comment"># é”™è¯¯ç¤ºä¾‹ï¼šç¼ºå°‘å‚æ•°ä¼šæŠ¥é”™</span>
<span class="hljs-comment"># p3 = Person()  # TypeError</span>
<span class="hljs-comment"># p4 = Person("æå››")  # TypeError</span>
</code></pre>
<h3 data-id="heading-6">2.3 æ··åˆå‚æ•°æ„é€ å‡½æ•°ï¼ˆå¯é€‰å‚æ•°ï¼‰</h3>
<h4 data-id="heading-7">ä½¿ç”¨é»˜è®¤å€¼åˆ›å»ºå¯é€‰å‚æ•°</h4>
<pre><code class="hljs language-PYTHON" lang="PYTHON"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age=<span class="hljs-number">18</span>, city=<span class="hljs-string">"åŒ—äº¬"</span></span>):
        <span class="hljs-string">"""
        æ··åˆå‚æ•°çš„æ„é€ å‡½æ•°
        name: å¿…é¡»å‚æ•°
        age: å¯é€‰å‚æ•°ï¼Œé»˜è®¤18
        city: å¯é€‰å‚æ•°ï¼Œé»˜è®¤"åŒ—äº¬"
        """</span>
        self.name = name
        self.age = age
        self.city = city
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ··åˆå‚æ•°æ„é€ å‡½æ•°è¢«è°ƒç”¨"</span>)


<span class="hljs-comment"># ä½¿ç”¨æ–¹å¼1ï¼šæä¾›æ‰€æœ‰å‚æ•°</span>
p1 = Person(<span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-number">25</span>, <span class="hljs-string">"ä¸Šæµ·"</span>)
<span class="hljs-built_in">print</span>(p1.name, p1.age, p1.city)


<span class="hljs-comment"># ä½¿ç”¨æ–¹å¼2ï¼šåªæä¾›å¿…é¡»å‚æ•°</span>
p2 = Person(<span class="hljs-string">"æå››"</span>)
<span class="hljs-built_in">print</span>(p2.name, p2.age, p2.city)  <span class="hljs-comment"># æå›› 18 åŒ—äº¬</span>


<span class="hljs-comment"># ä½¿ç”¨æ–¹å¼3ï¼šæä¾›éƒ¨åˆ†å¯é€‰å‚æ•°</span>
p3 = Person(<span class="hljs-string">"ç‹äº”"</span>, <span class="hljs-number">30</span>)
<span class="hljs-built_in">print</span>(p3.name, p3.age, p3.city)  <span class="hljs-comment"># ç‹äº” 30 åŒ—äº¬</span>


<span class="hljs-comment"># ä½¿ç”¨æ–¹å¼4ï¼šä½¿ç”¨å…³é”®å­—å‚æ•°</span>
p4 = Person(name=<span class="hljs-string">"èµµå…­"</span>, city=<span class="hljs-string">"å¹¿å·"</span>)
<span class="hljs-built_in">print</span>(p4.name, p4.age, p4.city)  <span class="hljs-comment"># èµµå…­ 18 å¹¿å·</span>
</code></pre>
<h4 data-id="heading-8">æ›´çµæ´»çš„å‚æ•°ç»„åˆ</h4>
<pre><code class="hljs language-PYTHON" lang="PYTHON"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Employee</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, salary, department=<span class="hljs-string">"æŠ€æœ¯éƒ¨"</span>, 
                 position=<span class="hljs-string">"å·¥ç¨‹å¸ˆ"</span>, email=<span class="hljs-literal">None</span></span>):
        <span class="hljs-string">"""
        name: å¿…é¡»å‚æ•°
        salary: å¿…é¡»å‚æ•°
        department: å¯é€‰å‚æ•°ï¼Œé»˜è®¤"æŠ€æœ¯éƒ¨"
        position: å¯é€‰å‚æ•°ï¼Œé»˜è®¤"å·¥ç¨‹å¸ˆ"
        email: å¯é€‰å‚æ•°ï¼Œé»˜è®¤None
        """</span>
        self.name = name
        self.salary = salary
        self.department = department
        self.position = position
        self.email = email <span class="hljs-keyword">if</span> email <span class="hljs-keyword">else</span> <span class="hljs-string">f"<span class="hljs-subst">{name}</span>@company.com"</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">display_info</span>(<span class="hljs-params">self</span>):
        info = <span class="hljs-string">f"""
        === å‘˜å·¥ä¿¡æ¯ ===
        å§“å: <span class="hljs-subst">{self.name}</span>
        éƒ¨é—¨: <span class="hljs-subst">{self.department}</span>
        èŒä½: <span class="hljs-subst">{self.position}</span>
        é‚®ç®±: <span class="hljs-subst">{self.email}</span>
        è–ªèµ„: <span class="hljs-subst">{self.salary}</span>
        """</span>
        <span class="hljs-built_in">print</span>(info)


<span class="hljs-comment"># ä½¿ç”¨</span>
emp1 = Employee(<span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-number">8000</span>)
emp1.display_info()


emp2 = Employee(<span class="hljs-string">"æå››"</span>, <span class="hljs-number">10000</span>, <span class="hljs-string">"å¸‚åœºéƒ¨"</span>, <span class="hljs-string">"ç»ç†"</span>, <span class="hljs-string">"lisi@company.com"</span>)
emp2.display_info()
</code></pre>
<h2 data-id="heading-9">3. å®Œæ•´ç¤ºä¾‹ï¼šå­¦ç”Ÿç®¡ç†ç³»ç»Ÿ</h2>
<pre><code class="hljs language-PYTHON" lang="PYTHON"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>:
    <span class="hljs-comment"># ç±»å±æ€§ï¼šæ‰€æœ‰å®ä¾‹å…±äº«</span>
    school = <span class="hljs-string">"XXå¤§å­¦"</span>
    total_students = <span class="hljs-number">0</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, student_id, name, age, major=<span class="hljs-literal">None</span>, 
                 grade_points=<span class="hljs-number">0.0</span>, is_active=<span class="hljs-literal">True</span></span>):
        <span class="hljs-string">"""
        student_id: å­¦å·ï¼ˆå¿…é¡»ï¼‰
        name: å§“åï¼ˆå¿…é¡»ï¼‰
        age: å¹´é¾„ï¼ˆå¿…é¡»ï¼‰
        major: ä¸“ä¸šï¼ˆå¯é€‰ï¼Œé»˜è®¤Noneï¼‰
        grade_points: ç»©ç‚¹ï¼ˆå¯é€‰ï¼Œé»˜è®¤0.0ï¼‰
        is_active: æ˜¯å¦åœ¨è¯»ï¼ˆå¯é€‰ï¼Œé»˜è®¤Trueï¼‰
        """</span>
        self.student_id = student_id
        self.name = name
        self.age = age
        self.major = major <span class="hljs-keyword">if</span> major <span class="hljs-keyword">else</span> <span class="hljs-string">"æœªå®šä¸“ä¸š"</span>
        self.grade_points = grade_points
        self.is_active = is_active
        
        <span class="hljs-comment"># æ¯ä¸ªå®ä¾‹åˆ›å»ºæ—¶å¢åŠ æ€»å­¦ç”Ÿæ•°</span>
        Student.total_students += <span class="hljs-number">1</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_grade</span>(<span class="hljs-params">self, new_grade</span>):
        <span class="hljs-string">"""æ›´æ–°ç»©ç‚¹"""</span>
        self.grade_points = new_grade
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{self.name}</span>çš„ç»©ç‚¹å·²æ›´æ–°ä¸º: <span class="hljs-subst">{new_grade}</span>"</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">change_major</span>(<span class="hljs-params">self, new_major</span>):
        <span class="hljs-string">"""æ›´æ¢ä¸“ä¸š"""</span>
        old_major = self.major
        self.major = new_major
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{self.name}</span>çš„ä¸“ä¸šå·²ä»<span class="hljs-subst">{old_major}</span>æ›´æ¢ä¸º<span class="hljs-subst">{new_major}</span>"</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_student_status</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""è·å–å­¦ç”ŸçŠ¶æ€"""</span>
        status = <span class="hljs-string">"åœ¨è¯»"</span> <span class="hljs-keyword">if</span> self.is_active <span class="hljs-keyword">else</span> <span class="hljs-string">"å·²æ¯•ä¸š/ä¼‘å­¦"</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"å­¦å·:<span class="hljs-subst">{self.student_id}</span> å§“å:<span class="hljs-subst">{self.name}</span> ä¸“ä¸š:<span class="hljs-subst">{self.major}</span> çŠ¶æ€:<span class="hljs-subst">{status}</span>"</span>
    
<span class="hljs-meta">    @classmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_total_students</span>(<span class="hljs-params">cls</span>):
        <span class="hljs-string">"""ç±»æ–¹æ³•ï¼šè·å–å­¦ç”Ÿæ€»æ•°"""</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"å­¦æ ¡æ€»å­¦ç”Ÿæ•°: <span class="hljs-subst">{cls.total_students}</span>"</span>
    
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_grade_level</span>(<span class="hljs-params">grade_points</span>):
        <span class="hljs-string">"""é™æ€æ–¹æ³•ï¼šæ ¹æ®ç»©ç‚¹åˆ¤æ–­ç­‰çº§"""</span>
        <span class="hljs-keyword">if</span> grade_points &gt;= <span class="hljs-number">4.0</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"ä¼˜ç§€"</span>
        <span class="hljs-keyword">elif</span> grade_points &gt;= <span class="hljs-number">3.0</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"è‰¯å¥½"</span>
        <span class="hljs-keyword">elif</span> grade_points &gt;= <span class="hljs-number">2.0</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"åŠæ ¼"</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"ä¸åŠæ ¼"</span>


<span class="hljs-comment"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-comment"># åˆ›å»ºå­¦ç”Ÿå®ä¾‹</span>
stu1 = Student(<span class="hljs-string">"2023001"</span>, <span class="hljs-string">"å°æ˜"</span>, <span class="hljs-number">20</span>, <span class="hljs-string">"è®¡ç®—æœºç§‘å­¦"</span>, <span class="hljs-number">3.8</span>)
stu2 = Student(<span class="hljs-string">"2023002"</span>, <span class="hljs-string">"å°çº¢"</span>, <span class="hljs-number">21</span>, grade_points=<span class="hljs-number">3.2</span>)
stu3 = Student(<span class="hljs-string">"2023003"</span>, <span class="hljs-string">"å°åˆš"</span>, <span class="hljs-number">22</span>, <span class="hljs-string">"ç‰©ç†å­¦"</span>)  <span class="hljs-comment"># ä½¿ç”¨é»˜è®¤ç»©ç‚¹0.0</span>


<span class="hljs-comment"># æ‰“å°å­¦ç”Ÿä¿¡æ¯</span>
<span class="hljs-built_in">print</span>(stu1.get_student_status())
<span class="hljs-built_in">print</span>(stu2.get_student_status())
<span class="hljs-built_in">print</span>(stu3.get_student_status())


<span class="hljs-comment"># è°ƒç”¨å®ä¾‹æ–¹æ³•</span>
stu1.update_grade(<span class="hljs-number">4.0</span>)
stu2.change_major(<span class="hljs-string">"äººå·¥æ™ºèƒ½"</span>)


<span class="hljs-comment"># è°ƒç”¨ç±»æ–¹æ³•</span>
<span class="hljs-built_in">print</span>(Student.get_total_students())


<span class="hljs-comment"># è°ƒç”¨é™æ€æ–¹æ³•</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"å°æ˜çš„ç­‰çº§: <span class="hljs-subst">{Student.calculate_grade_level(stu1.grade_points)}</span>"</span>)
</code></pre>
<h2 data-id="heading-10">4. è¿›é˜¶ï¼šæ›´å¤æ‚çš„æ„é€ å‡½æ•°</h2>
<h3 data-id="heading-11">4.1 ä½¿ç”¨Â <code>*args</code>Â æ¥å—ä»»æ„æ•°é‡çš„ä½ç½®å‚æ•°</h3>
<pre><code class="hljs language-PYTHON" lang="PYTHON"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Product</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, price, *tags</span>):
        <span class="hljs-string">"""
        name: å•†å“åç§°
        price: ä»·æ ¼
        *tags: å¯å˜æ•°é‡çš„æ ‡ç­¾
        """</span>
        self.name = name
        self.price = price
        self.tags = <span class="hljs-built_in">list</span>(tags)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_tag</span>(<span class="hljs-params">self, tag</span>):
        self.tags.append(tag)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">show_tags</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"<span class="hljs-subst">{self.name}</span>çš„æ ‡ç­¾: <span class="hljs-subst">{<span class="hljs-string">', '</span>.join(self.tags)}</span>"</span>


p1 = Product(<span class="hljs-string">"æ‰‹æœº"</span>, <span class="hljs-number">2999</span>, <span class="hljs-string">"ç”µå­äº§å“"</span>, <span class="hljs-string">"é€šè®¯"</span>, <span class="hljs-string">"ä¾¿æº"</span>)
<span class="hljs-built_in">print</span>(p1.show_tags())  <span class="hljs-comment"># æ‰‹æœºçš„æ ‡ç­¾: ç”µå­äº§å“, é€šè®¯, ä¾¿æº</span>


p2 = Product(<span class="hljs-string">"ç¬”è®°æœ¬"</span>, <span class="hljs-number">4999</span>, <span class="hljs-string">"åŠå…¬"</span>, <span class="hljs-string">"å­¦ä¹ "</span>)
<span class="hljs-built_in">print</span>(p2.show_tags())  <span class="hljs-comment"># ç¬”è®°æœ¬çš„æ ‡ç­¾: åŠå…¬, å­¦ä¹ </span>
</code></pre>
<h3 data-id="heading-12">4.2 ä½¿ç”¨Â <code>**kwargs</code>Â æ¥å—ä»»æ„æ•°é‡çš„å…³é”®å­—å‚æ•°</h3>
<pre><code class="hljs language-PYTHON" lang="PYTHON"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, brand, model, **specifications</span>):
        <span class="hljs-string">"""
        brand: å“ç‰Œ
        model: å‹å·
        **specifications: å…¶ä»–æŠ€æœ¯å‚æ•°
        """</span>
        self.brand = brand
        self.model = model
        self.specifications = specifications
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_full_info</span>(<span class="hljs-params">self</span>):
        info = <span class="hljs-string">f"<span class="hljs-subst">{self.brand}</span> <span class="hljs-subst">{self.model}</span>\nè§„æ ¼å‚æ•°:"</span>
        <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> self.specifications.items():
            info += <span class="hljs-string">f"\n  <span class="hljs-subst">{key}</span>: <span class="hljs-subst">{value}</span>"</span>
        <span class="hljs-keyword">return</span> info


car1 = Car(<span class="hljs-string">"ç‰¹æ–¯æ‹‰"</span>, <span class="hljs-string">"Model 3"</span>, color=<span class="hljs-string">"çº¢è‰²"</span>, <span class="hljs-built_in">range</span>=<span class="hljs-number">500</span>, autopilot=<span class="hljs-literal">True</span>)
<span class="hljs-built_in">print</span>(car1.get_full_info())


car2 = Car(<span class="hljs-string">"æ¯”äºšè¿ª"</span>, <span class="hljs-string">"æ±‰"</span>, color=<span class="hljs-string">"é»‘è‰²"</span>, battery_type=<span class="hljs-string">"åˆ€ç‰‡ç”µæ± "</span>, 
           acceleration=<span class="hljs-number">3.9</span>, <span class="hljs-built_in">range</span>=<span class="hljs-number">605</span>)
<span class="hljs-built_in">print</span>(car2.get_full_info())
</code></pre>
<h3 data-id="heading-13">4.3 æ··åˆä½¿ç”¨é»˜è®¤å‚æ•°ã€*argsã€**kwargs</h3>
<pre><code class="hljs language-python" lang="python">&lt;PYTHON&gt;
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, default_value=<span class="hljs-literal">None</span>, *args, **kwargs</span>):
        <span class="hljs-string">"""
        å¤æ‚çš„å‚æ•°é…ç½®ç±»
        """</span>
        self.name = name
        self.default_value = default_value
        self.args = args
        self.options = kwargs
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">display_config</span>(<span class="hljs-params">self</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"é…ç½®åç§°: <span class="hljs-subst">{self.name}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"é»˜è®¤å€¼: <span class="hljs-subst">{self.default_value}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"é¢å¤–å‚æ•°: <span class="hljs-subst">{self.args}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"é€‰é¡¹: <span class="hljs-subst">{self.options}</span>"</span>)


<span class="hljs-comment"># ä½¿ç”¨</span>
c1 = Config(<span class="hljs-string">"æ•°æ®åº“é…ç½®"</span>, <span class="hljs-string">"localhost:3306"</span>, <span class="hljs-string">"utf8"</span>, <span class="hljs-string">"pool=10"</span>, 
            timeout=<span class="hljs-number">30</span>, max_connections=<span class="hljs-number">100</span>)
c1.display_config()
</code></pre>
<h2 data-id="heading-14">5. æœ€ä½³å®è·µå»ºè®®</h2>
<ol>
<li><strong>å‚æ•°é¡ºåº</strong>ï¼šå°†å¿…é¡»å‚æ•°æ”¾åœ¨å‰é¢ï¼Œå¯é€‰å‚æ•°æ”¾åœ¨åé¢</li>
<li><strong>é»˜è®¤å€¼è®¾ç½®</strong>ï¼šä½¿ç”¨<code>None</code>ä½œä¸ºé»˜è®¤å€¼ï¼Œç„¶ååœ¨æ„é€ å‡½æ•°å†…èµ‹å€¼</li>
<li><strong>ç±»å‹æç¤º</strong>ï¼šä½¿ç”¨ç±»å‹æç¤ºæé«˜ä»£ç å¯è¯»æ€§</li>
<li><strong>æ–‡æ¡£å­—ç¬¦ä¸²</strong>ï¼šä¸ºæ„é€ å‡½æ•°å’Œæ–¹æ³•æ·»åŠ æ–‡æ¡£å­—ç¬¦ä¸²</li>
<li><strong>å‚æ•°éªŒè¯</strong>ï¼šåœ¨æ„é€ å‡½æ•°ä¸­è¿›è¡Œå‚æ•°éªŒè¯</li>
</ol>
<pre><code class="hljs language-PYTHON" lang="PYTHON"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span>, <span class="hljs-type">List</span>, <span class="hljs-type">Dict</span>


<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, 
                 username: <span class="hljs-built_in">str</span>, 
                 email: <span class="hljs-built_in">str</span>, 
                 age: <span class="hljs-built_in">int</span> = <span class="hljs-number">18</span>,
                 roles: <span class="hljs-type">Optional</span>[<span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]] = <span class="hljs-literal">None</span>,
                 preferences: <span class="hljs-type">Optional</span>[<span class="hljs-type">Dict</span>] = <span class="hljs-literal">None</span></span>):
        <span class="hljs-string">"""
        ç”¨æˆ·ç±»
        
        Args:
            username: ç”¨æˆ·åï¼ˆå¿…é¡»ï¼‰
            email: é‚®ç®±ï¼ˆå¿…é¡»ï¼‰
            age: å¹´é¾„ï¼ˆå¯é€‰ï¼Œé»˜è®¤18ï¼‰
            roles: è§’è‰²åˆ—è¡¨ï¼ˆå¯é€‰ï¼‰
            preferences: åå¥½è®¾ç½®ï¼ˆå¯é€‰ï¼‰
        """</span>
        <span class="hljs-comment"># å‚æ•°éªŒè¯</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> username:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"ç”¨æˆ·åä¸èƒ½ä¸ºç©º"</span>)
        
        <span class="hljs-comment"># 'email' ç®€å•éªŒè¯</span>
        <span class="hljs-keyword">if</span> <span class="hljs-string">'@'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> email:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"é‚®ç®±æ ¼å¼ä¸æ­£ç¡®"</span>)
        
        self.username = username
        self.email = email
        self.age = age
        
        <span class="hljs-comment"># å¤„ç†å¯å˜é»˜è®¤å‚æ•°</span>
        self.roles = roles <span class="hljs-keyword">if</span> roles <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">else</span> []
        self.preferences = preferences <span class="hljs-keyword">if</span> preferences <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">else</span> {}
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__str__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"User(username=<span class="hljs-subst">{self.username}</span>, email=<span class="hljs-subst">{self.email}</span>, age=<span class="hljs-subst">{self.age}</span>)"</span>


<span class="hljs-comment"># ä½¿ç”¨</span>
user1 = User(<span class="hljs-string">"john_doe"</span>, <span class="hljs-string">"john@example.com"</span>)
user2 = User(<span class="hljs-string">"jane_doe"</span>, <span class="hljs-string">"jane@example.com"</span>, <span class="hljs-number">25</span>, [<span class="hljs-string">"admin"</span>, <span class="hljs-string">"editor"</span>])
</code></pre>
<h2 data-id="heading-15">6. ä½¿ç”¨dataclassç®€åŒ–ç±»å®šä¹‰ï¼ˆPython 3.7+ï¼‰</h2>
<pre><code class="hljs language-PYTHON" lang="PYTHON"><span class="hljs-keyword">from</span> dataclasses <span class="hljs-keyword">import</span> dataclass, field
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>


<span class="hljs-meta">@dataclass</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Product</span>:
    name: <span class="hljs-built_in">str</span>
    price: <span class="hljs-built_in">float</span>
    tags: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>] = field(default_factory=<span class="hljs-built_in">list</span>)
    stock: <span class="hljs-built_in">int</span> = <span class="hljs-number">0</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">is_available</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">return</span> self.stock &gt; <span class="hljs-number">0</span>


<span class="hljs-comment"># è‡ªåŠ¨ç”Ÿæˆ __init__, __repr__ ç­‰æ–¹æ³•</span>
p1 = Product(<span class="hljs-string">"æ‰‹æœº"</span>, <span class="hljs-number">2999.0</span>, [<span class="hljs-string">"ç”µå­"</span>, <span class="hljs-string">"é€šè®¯"</span>], <span class="hljs-number">10</span>)
<span class="hljs-built_in">print</span>(p1)  <span class="hljs-comment"># Product(name='æ‰‹æœº', price=2999.0, tags=['ç”µå­', 'é€šè®¯'], stock=10)</span>
<span class="hljs-built_in">print</span>(p1.is_available())  <span class="hljs-comment"># True</span>
</code></pre>
<h2 data-id="heading-16">æ€»ç»“</h2>
<ul>
<li><strong>æ„é€ å‡½æ•°</strong>ï¼šä½¿ç”¨Â <code>__init__</code>Â æ–¹æ³•å®šä¹‰</li>
<li><strong>å¿…é¡»å‚æ•°</strong>ï¼šæ”¾åœ¨å‚æ•°åˆ—è¡¨æœ€å‰é¢ï¼Œè°ƒç”¨æ—¶å¿…é¡»æä¾›</li>
<li><strong>å¯é€‰å‚æ•°</strong>ï¼šä½¿ç”¨Â <code>=é»˜è®¤å€¼</code>Â çš„å½¢å¼å®šä¹‰</li>
<li><strong>çµæ´»å‚æ•°</strong>ï¼šä½¿ç”¨Â <code>*args</code>Â å’ŒÂ <code>**kwargs</code></li>
<li><strong>æœ€ä½³å®è·µ</strong>ï¼šæ·»åŠ ç±»å‹æç¤ºã€å‚æ•°éªŒè¯å’Œæ–‡æ¡£å­—ç¬¦ä¸²</li>
</ul>
<h2 data-id="heading-17">ä»€ä¹ˆæ˜¯Â <code>typing</code>Â åº“ï¼Ÿ</h2>
<p>æƒ³è±¡ä¸€ä¸‹ä½ æœ‰ä¸€ä¸ªè£…é›¶é£Ÿçš„ç›’å­ï¼š</p>
<ul>
<li><strong>æ²¡æœ‰ç±»å‹æ³¨è§£</strong>ï¼šä½ åªçŸ¥é“ç›’å­é‡Œæœ‰ä¸œè¥¿ï¼Œä½†ä¸çŸ¥é“æ˜¯ä»€ä¹ˆ</li>
<li><strong>æœ‰ç±»å‹æ³¨è§£</strong>ï¼šç›’å­ä¸Šè´´ç€æ ‡ç­¾ï¼š"ç³–æœ"ã€"é¥¼å¹²"ã€"å·§å…‹åŠ›"</li>
</ul>
<p><code>typing</code> å°±æ˜¯ç»™ä»£ç "è´´æ ‡ç­¾"çš„å·¥å…·ï¼</p>
<h2 data-id="heading-18">æœ€ç®€å•çš„ç†è§£æ–¹å¼</h2>
<h3 data-id="heading-19">1.Â <code>List</code>Â - "åˆ—è¡¨æ ‡ç­¾"</h3>
<p>å‘Šè¯‰åˆ«äººè¿™ä¸ªåˆ—è¡¨é‡Œè£…çš„æ˜¯ä»€ä¹ˆ</p>
<pre><code class="hljs language-PYTHON" lang="PYTHON"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>


<span class="hljs-comment"># æ²¡æœ‰æ ‡ç­¾ï¼ˆä¸çŸ¥é“ç›’å­é‡Œæ˜¯ä»€ä¹ˆï¼‰</span>
names = [<span class="hljs-string">"å°æ˜"</span>, <span class="hljs-string">"å°çº¢"</span>, <span class="hljs-string">"å°åˆš"</span>]


<span class="hljs-comment"># æœ‰æ ‡ç­¾ï¼ˆæ˜ç¡®å‘Šè¯‰å¤§å®¶æ˜¯"å­—ç¬¦ä¸²åˆ—è¡¨"ï¼‰</span>
names: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>] = [<span class="hljs-string">"å°æ˜"</span>, <span class="hljs-string">"å°çº¢"</span>, <span class="hljs-string">"å°åˆš"</span>]
<span class="hljs-comment"># â†‘ å°±åƒåœ¨ç›’å­ä¸Šå†™ï¼š"è£…çš„æ˜¯åå­—ï¼ˆå­—ç¬¦ä¸²ï¼‰"</span>
</code></pre>
<h3 data-id="heading-20">2.Â <code>Dict</code>Â - "å­—å…¸æ ‡ç­¾"</h3>
<p>å‘Šè¯‰åˆ«äººå­—å…¸é‡Œçš„"é’¥åŒ™"å’Œ"å®è—"æ˜¯ä»€ä¹ˆç±»å‹</p>
<pre><code class="hljs language-PYTHON" lang="PYTHON"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Dict</span>


<span class="hljs-comment"># å­¦ç”Ÿæˆç»©å•</span>
<span class="hljs-comment"># æ²¡æœ‰æ ‡ç­¾</span>
scores = {<span class="hljs-string">"å°æ˜"</span>: <span class="hljs-number">90</span>, <span class="hljs-string">"å°çº¢"</span>: <span class="hljs-number">95</span>}


<span class="hljs-comment"># æœ‰æ ‡ç­¾ï¼ˆé’¥åŒ™æ˜¯åå­—ï¼Œå®è—æ˜¯åˆ†æ•°ï¼‰</span>
scores: <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">int</span>] = {<span class="hljs-string">"å°æ˜"</span>: <span class="hljs-number">90</span>, <span class="hljs-string">"å°çº¢"</span>: <span class="hljs-number">95</span>}
<span class="hljs-comment"># â†‘ æ ‡ç­¾ä¸Šå†™ç€ï¼šé’¥åŒ™æ˜¯æ–‡å­—ï¼ˆstrï¼‰ï¼Œå®è—æ˜¯æ•°å­—ï¼ˆintï¼‰</span>
</code></pre>
<h3 data-id="heading-21">3.Â <code>Optional</code>Â - "ä¹Ÿè®¸æœ‰æ ‡ç­¾"</h3>
<p>è¡¨ç¤ºè¿™ä¸ªä¸œè¥¿å¯èƒ½æœ‰ï¼Œä¹Ÿå¯èƒ½æ²¡æœ‰</p>
<pre><code class="hljs language-PYTHON" lang="PYTHON"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span>

<span class="hljs-comment"># å°æ˜çš„ç”Ÿæ—¥</span>
<span class="hljs-comment"># æ²¡æœ‰æ ‡ç­¾</span>
birthday = <span class="hljs-literal">None</span>  <span class="hljs-comment"># ä¸çŸ¥é“ç”Ÿæ—¥</span>
<span class="hljs-comment"># æˆ–è€…</span>
birthday = <span class="hljs-string">"2000-01-01"</span>

<span class="hljs-comment"># æœ‰æ ‡ç­¾ï¼ˆä¹Ÿè®¸æ˜¯æ—¥æœŸï¼Œä¹Ÿè®¸æ˜¯ç©ºï¼‰</span>
birthday: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span>
<span class="hljs-comment"># â†‘ æ ‡ç­¾ä¸Šå†™ç€ï¼šå¯èƒ½æ˜¯æ—¥æœŸï¼Œä¹Ÿå¯èƒ½æ˜¯"æ²¡æœ‰"</span>
</code></pre>
<h2 data-id="heading-22">å®é™…ä¾‹å­ï¼šç­çº§ç®¡ç†</h2>
<pre><code class="hljs language-PYTHON" lang="PYTHON"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span>, <span class="hljs-type">List</span>, <span class="hljs-type">Dict</span>


<span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>:
    <span class="hljs-string">"""å­¦ç”Ÿç±»"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name: <span class="hljs-built_in">str</span>, age: <span class="hljs-built_in">int</span></span>):
        self.name: <span class="hljs-built_in">str</span> = name  <span class="hljs-comment"># åå­—è‚¯å®šæ˜¯æ–‡å­—</span>
        self.age: <span class="hljs-built_in">int</span> = age    <span class="hljs-comment"># å¹´é¾„è‚¯å®šæ˜¯æ•°å­—</span>
        self.phone: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span>  <span class="hljs-comment"># ç”µè¯å¯èƒ½æœ‰ï¼Œå¯èƒ½æ²¡æœ‰</span>
        self.scores: <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">int</span>] = {}  <span class="hljs-comment"># æˆç»©å•ï¼šç§‘ç›®-&gt;åˆ†æ•°</span>
        self.friends: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>] = []      <span class="hljs-comment"># æœ‹å‹åˆ—è¡¨ï¼šéƒ½æ˜¯åå­—</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Class</span>:
    <span class="hljs-string">"""ç­çº§ç±»"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, class_name: <span class="hljs-built_in">str</span></span>):
        <span class="hljs-comment"># ç­çº§æ•°æ®</span>
        self.class_name: <span class="hljs-built_in">str</span> = class_name
        self.students: <span class="hljs-type">List</span>[Student] = []  <span class="hljs-comment"># å­¦ç”Ÿåˆ—è¡¨ï¼šéƒ½æ˜¯Studentå¯¹è±¡</span>
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_student</span>(<span class="hljs-params">self, student: Student</span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""æ·»åŠ å­¦ç”Ÿ"""</span>
        self.students.append(student)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">find_student</span>(<span class="hljs-params">self, name: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">Optional</span>[Student]:
        <span class="hljs-string">"""æŸ¥æ‰¾å­¦ç”Ÿ"""</span>
        <span class="hljs-keyword">for</span> student <span class="hljs-keyword">in</span> self.students:
            <span class="hljs-keyword">if</span> student.name == name:
                <span class="hljs-keyword">return</span> student
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>  <span class="hljs-comment"># æ²¡æ‰¾åˆ°å°±è¿”å›None</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_class_scores</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">int</span>]]:
        <span class="hljs-string">"""è·å–å…¨ç­æˆç»©"""</span>
        scores_dict = {}
        <span class="hljs-keyword">for</span> student <span class="hljs-keyword">in</span> self.students:
            scores_dict[student.name] = student.scores
        <span class="hljs-keyword">return</span> scores_dict


<span class="hljs-comment"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªç­çº§</span>
    class_1 = Class(<span class="hljs-string">"ä¸‰å¹´äºŒç­"</span>)
    
    <span class="hljs-comment"># åˆ›å»ºå‡ ä¸ªå­¦ç”Ÿ</span>
    xiaoming = Student(<span class="hljs-string">"å°æ˜"</span>, <span class="hljs-number">10</span>)
    xiaoming.phone = <span class="hljs-string">"13800138000"</span>  <span class="hljs-comment"># å°æ˜æœ‰ç”µè¯</span>
    xiaoming.scores = {<span class="hljs-string">"æ•°å­¦"</span>: <span class="hljs-number">95</span>, <span class="hljs-string">"è¯­æ–‡"</span>: <span class="hljs-number">88</span>}
    xiaoming.friends = [<span class="hljs-string">"å°çº¢"</span>, <span class="hljs-string">"å°åˆš"</span>]
    
    xiaohong = Student(<span class="hljs-string">"å°çº¢"</span>, <span class="hljs-number">9</span>)
    <span class="hljs-comment"># å°çº¢æ²¡æœ‰ç”µè¯ï¼ˆphoneæ˜¯Noneï¼‰</span>
    xiaohong.scores = {<span class="hljs-string">"æ•°å­¦"</span>: <span class="hljs-number">90</span>, <span class="hljs-string">"è¯­æ–‡"</span>: <span class="hljs-number">92</span>}
    xiaohong.friends = [<span class="hljs-string">"å°æ˜"</span>]
    
    <span class="hljs-comment"># æŠŠå­¦ç”ŸåŠ å…¥ç­çº§</span>
    class_1.add_student(xiaoming)
    class_1.add_student(xiaohong)
    
    <span class="hljs-comment"># æŸ¥æ‰¾å­¦ç”Ÿ</span>
    found_student = class_1.find_student(<span class="hljs-string">"å°æ˜"</span>)
    <span class="hljs-keyword">if</span> found_student:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ‰¾åˆ°äº†ï¼š<span class="hljs-subst">{found_student.name}</span>"</span>)
    
    <span class="hljs-comment"># è·å–å…¨ç­æˆç»©</span>
    all_scores = class_1.get_class_scores()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å…¨ç­æˆç»©ï¼š<span class="hljs-subst">{all_scores}</span>"</span>)
</code></pre>
<h2 data-id="heading-23">æ›´ç”Ÿæ´»åŒ–çš„æ¯”å–»</h2>
<h3 data-id="heading-24">æ¯”å–»1ï¼šè¶…å¸‚è´­ç‰©æ¸…å•</h3>
<pre><code class="hljs language-PYTHON" lang="PYTHON"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Dict</span>


<span class="hljs-comment"># è´­ç‰©æ¸…å•</span>
<span class="hljs-comment"># æ²¡æœ‰ç±»å‹æ³¨è§£</span>
shopping_list = [
    {<span class="hljs-string">"item"</span>: <span class="hljs-string">"è‹¹æœ"</span>, <span class="hljs-string">"amount"</span>: <span class="hljs-number">3</span>, <span class="hljs-string">"price"</span>: <span class="hljs-number">5.0</span>},
    {<span class="hljs-string">"item"</span>: <span class="hljs-string">"ç‰›å¥¶"</span>, <span class="hljs-string">"amount"</span>: <span class="hljs-number">2</span>, <span class="hljs-string">"price"</span>: <span class="hljs-number">8.5</span>}
]


<span class="hljs-comment"># æœ‰ç±»å‹æ³¨è§£ï¼ˆæ¸…æ™°å¤šäº†ï¼ï¼‰</span>
shopping_list: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">any</span>]] = [
    {<span class="hljs-string">"item"</span>: <span class="hljs-string">"è‹¹æœ"</span>, <span class="hljs-string">"amount"</span>: <span class="hljs-number">3</span>, <span class="hljs-string">"price"</span>: <span class="hljs-number">5.0</span>},
    {<span class="hljs-string">"item"</span>: <span class="hljs-string">"ç‰›å¥¶"</span>, <span class="hljs-string">"amount"</span>: <span class="hljs-number">2</span>, <span class="hljs-string">"price"</span>: <span class="hljs-number">8.5</span>}
]
<span class="hljs-comment"># â†‘ æ„æ€ï¼šè¿™æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œé‡Œé¢æ¯é¡¹éƒ½æ˜¯å­—å…¸</span>
</code></pre>
<h3 data-id="heading-25">æ¯”å–»2ï¼šé€šè®¯å½•</h3>
<pre><code class="hljs language-PYTHON" lang="PYTHON"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Dict</span>, <span class="hljs-type">Optional</span>


<span class="hljs-comment"># é€šè®¯å½•é‡Œçš„è”ç³»äºº</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Contact</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">
        self, 
        name: <span class="hljs-built_in">str</span>,                     <span class="hljs-comment"># åå­—ï¼ˆè‚¯å®šè¦æœ‰ï¼‰</span>
        phone: <span class="hljs-built_in">str</span>,                    <span class="hljs-comment"># ç”µè¯ï¼ˆè‚¯å®šè¦æœ‰ï¼‰</span>
        email: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span>,   <span class="hljs-comment"># é‚®ç®±ï¼ˆå¯èƒ½æœ‰ï¼Œå¯èƒ½æ²¡æœ‰ï¼‰</span>
        groups: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span>       <span class="hljs-comment"># åˆ†ç»„ï¼ˆåˆ—è¡¨ï¼‰</span>
    </span>):
        self.name = name
        self.phone = phone
        self.email = email
        self.groups = groups <span class="hljs-keyword">or</span> []
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__str__</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">str</span>:  <span class="hljs-comment"># è¿”å›å€¼æ˜¯å­—ç¬¦ä¸²</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"<span class="hljs-subst">{self.name}</span>: <span class="hljs-subst">{self.phone}</span>"</span>


<span class="hljs-comment"># é€šè®¯å½•</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AddressBook</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.contacts: <span class="hljs-type">List</span>[Contact] = []  <span class="hljs-comment"># è”ç³»äººåˆ—è¡¨</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_contact</span>(<span class="hljs-params">self, contact: Contact</span>) -&gt; <span class="hljs-literal">None</span>:
        self.contacts.append(contact)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">find_by_name</span>(<span class="hljs-params">self, name: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">Optional</span>[Contact]:
        <span class="hljs-keyword">for</span> contact <span class="hljs-keyword">in</span> self.contacts:
            <span class="hljs-keyword">if</span> contact.name == name:
                <span class="hljs-keyword">return</span> contact
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>


<span class="hljs-comment"># ä½¿ç”¨</span>
my_book = AddressBook()
alice = Contact(<span class="hljs-string">"Alice"</span>, <span class="hljs-string">"123456789"</span>, <span class="hljs-string">"alice@email.com"</span>, [<span class="hljs-string">"æœ‹å‹"</span>, <span class="hljs-string">"åŒäº‹"</span>])
bob = Contact(<span class="hljs-string">"Bob"</span>, <span class="hljs-string">"987654321"</span>)


my_book.add_contact(alice)
my_book.add_contact(bob)


found = my_book.find_by_name(<span class="hljs-string">"Alice"</span>)
<span class="hljs-keyword">if</span> found:
    <span class="hljs-built_in">print</span>(found)
</code></pre>
<h2 data-id="heading-26">ä¸ºä»€ä¹ˆè¦ç”¨Â <code>typing</code>ï¼Ÿ</h2>
<h3 data-id="heading-27">å¯¹æ–°æ‰‹çš„å¥½å¤„ï¼š</h3>
<ol>
<li><strong>ä¸€çœ‹å°±æ‡‚</strong>ï¼šä»£ç æ›´æ¸…æ™°ï¼Œå°±åƒåŠ äº†æ³¨é‡Š</li>
<li><strong>å‡å°‘é”™è¯¯</strong>ï¼šç¼–è¾‘å™¨ä¼šæé†’ä½ ç±»å‹é”™è¯¯</li>
<li><strong>å­¦ä¹ æ›´å¿«</strong>ï¼šç†è§£åˆ«äººä»£ç æ›´å®¹æ˜“</li>
</ol>
<h3 data-id="heading-28">å®é™…ä½“éªŒä¸åŒç‚¹ï¼š</h3>
<p><strong>ä¸ç”¨ <code>typing</code>ï¼ˆç³Šæ¶‚çŠ¶æ€ï¼‰</strong> ï¼š</p>
<pre><code class="hljs language-PYTHON" lang="PYTHON"><span class="hljs-keyword">def</span> <span class="hljs-title function_">process</span>(<span class="hljs-params">data</span>):
    <span class="hljs-comment"># å¤©å‘ï¼dataæ˜¯ä»€ä¹ˆï¼Ÿåˆ—è¡¨ï¼Ÿå­—å…¸ï¼Ÿæ•°å­—ï¼Ÿ</span>
    <span class="hljs-comment"># åªèƒ½çŒœæˆ–è€…çœ‹ä»£ç é€»è¾‘</span>
    <span class="hljs-keyword">return</span> data * <span class="hljs-number">2</span>  <span class="hljs-comment"># è¿™è¡Œä»£ç å¯¹å—ï¼Ÿä¸çŸ¥é“ï¼</span>
</code></pre>
<p><strong>ç”¨ <code>typing</code>ï¼ˆæ¸…æ™°çŠ¶æ€ï¼‰</strong> ï¼š</p>
<pre><code class="hljs language-PYTHON" lang="PYTHON"><span class="hljs-keyword">def</span> <span class="hljs-title function_">process</span>(<span class="hljs-params">data: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]:
    <span class="hljs-comment"># å™¢ï¼dataæ˜¯æ•°å­—åˆ—è¡¨ï¼Œè¿”å›å€¼ä¹Ÿæ˜¯æ•°å­—åˆ—è¡¨</span>
    <span class="hljs-comment"># æ‰€ä»¥ data * 2 å¯èƒ½ä¸å¯¹ï¼ˆåˆ—è¡¨ä¸èƒ½ä¹˜ä»¥2ï¼‰</span>
    <span class="hljs-keyword">return</span> [x * <span class="hljs-number">2</span> <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> data]  <span class="hljs-comment"># è¿™æ ·æ‰å¯¹ï¼</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åç«¯ Mock å®æˆ˜ï¼šSpring Boot 3 å®ç°å…¥ç«™ & å‡ºç«™æ¥å£æ¨¡æ‹Ÿ]]></title>    <link>https://juejin.cn/post/7604142616474304518</link>    <guid>https://juejin.cn/post/7604142616474304518</guid>    <pubDate>2026-02-09T06:52:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604142616474304518" data-draft-id="7604279756598902820" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åç«¯ Mock å®æˆ˜ï¼šSpring Boot 3 å®ç°å…¥ç«™ &amp; å‡ºç«™æ¥å£æ¨¡æ‹Ÿ"/> <meta itemprop="keywords" content="åç«¯,Java,è®¾è®¡"/> <meta itemprop="datePublished" content="2026-02-09T06:52:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ€’æ”¾å§å¾·å¾·"/> <meta itemprop="url" content="https://juejin.cn/user/2502950820787672"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åç«¯ Mock å®æˆ˜ï¼šSpring Boot 3 å®ç°å…¥ç«™ &amp; å‡ºç«™æ¥å£æ¨¡æ‹Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2502950820787672/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ€’æ”¾å§å¾·å¾·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T06:52:58.000Z" title="Mon Feb 09 2026 06:52:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">åç«¯ Mock å®æˆ˜ï¼šSpring Boot 3 å®ç°å…¥ç«™ &amp; å‡ºç«™æ¥å£æ¨¡æ‹Ÿ</h2>
<blockquote>
<p>ğŸ˜„ç”Ÿå‘½ä¸æ¯ï¼Œå†™ä½œä¸æ­¢</p>
<p>ğŸ”¥ ç»§ç»­è¸ä¸Šå­¦ä¹ ä¹‹è·¯ï¼Œå­¦ä¹‹åˆ†äº«ç¬”è®°</p>
<p>ğŸ‘Š æ€»æœ‰ä¸€å¤©æˆ‘ä¹Ÿèƒ½åƒå„ä½å¤§ä½¬ä¸€æ ·</p>
<p>ğŸ† <a href="https://juejin.cn/user/2502950820787672" target="_blank" title="https://juejin.cn/user/2502950820787672">åšå®¢é¦–é¡µ</a> Â Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Flyd-code%2F" target="_blank" title="https://www.cnblogs.com/lyd-code/" ref="nofollow noopener noreferrer">@æ€’æ”¾å§å¾·å¾·</a>Â Â <a href="https://link.juejin.cn?target=https%3A%2F%2Flydandtry.github.io%2F" target="_blank" title="https://lydandtry.github.io/" ref="nofollow noopener noreferrer">Toè®°å½•é¢†åœ°</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_43843951%3Ftype%3Dblog" target="_blank" title="https://blog.csdn.net/qq_43843951?type=blog" ref="nofollow noopener noreferrer">@ä¸€ä¸ªæœ‰æ¢¦æœ‰æˆçš„äºº</a></p>
<p>ğŸŒåˆ†äº«å­¦ä¹ å¿ƒå¾—ï¼Œæ¬¢è¿æŒ‡æ­£ï¼Œå¤§å®¶ä¸€èµ·å­¦ä¹ æˆé•¿ï¼</p>
</blockquote>
<p><em>è½¬å‘è¯·æºå¸¦ä½œè€…ä¿¡æ¯</em>Â  <strong>@æ€’æ”¾å§å¾·å¾·(æ˜é‡‘) @ä¸€ä¸ªæœ‰æ¢¦æœ‰æˆçš„äºº(CSDN)</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d19fcb66829e468c83fb59b7ecee0952~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCS5pS-5ZCn5b635b63:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771225115&amp;x-signature=CO5MHJmKcM429jtXsRZCoDpSoYw%3D" alt="image-835954_1_20260209_145632.jpg" loading="lazy"/></p>
<h3 data-id="heading-1">å‰è¨€</h3>
<p>ä¸€èˆ¬æ¥è¯´ mock åªæœ‰å‰ç«¯ä¸Šæ‹¥æœ‰ï¼Œèƒ½å¤Ÿæ¨¡æ‹Ÿ api è¿”å›å‚æ•°è‡ªè¡Œæµ‹è¯•ï¼Œé‚£ä¹ˆåç«¯æ˜¯å¦ä¹Ÿéœ€è¦æœ‰è¿™ä¹ˆä¸€ä¸ªåŠŸèƒ½å‘¢ï¼Ÿç”±äºæˆ‘ä»¬å…¬å¸éœ€è¦å¯¹æ¥æ¯”è¾ƒå¤šçš„å¤–éƒ¨ç³»ç»Ÿï¼Œå¹¶ä¸”ä¸Šçº¿æ—¶æœºä¸åŒï¼Œä½†æ˜¯è¿”å›æ•°æ®å¯ä»¥æå‰å®šåˆ¶ï¼Œé‚£ä¹ˆå°±å¾ˆéœ€è¦è¿™ä¹ˆä¸€ä¸ª <code>Backend Mock System</code>ï¼Œç”¨æ¥ç®¡ç†è¿›ç«™ä¸å‡ºç«™çš„ mock åŠŸèƒ½ã€‚æ‰€ä»¥æˆ‘é€šè¿‡ kiro è®¾è®¡äº†ä¸€æ¬¾ mock åŠŸèƒ½ç»„ä»¶ï¼Œç›®å‰åªæœ‰ demo é˜¶æ®µï¼šåŸºäºSpring Boot 3å’ŒDDDæ¶æ„çš„åç«¯MockåŠŸèƒ½ç³»ç»Ÿï¼Œç”¨äºåœ¨å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒä¸­æ¨¡æ‹ŸHTTPæ¥å£å“åº”ã€‚ä»“åº“ä½äºï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fliyongde%2Fjava-trial%2Ftree%2Fmaster%2FTrial3-Mock-Design" target="_blank" title="https://gitee.com/liyongde/java-trial/tree/master/Trial3-Mock-Design" ref="nofollow noopener noreferrer">gitee.com/liyongde/jaâ€¦</a></p>
<h3 data-id="heading-2">1 Mock è®¾è®¡</h3>
<h4 data-id="heading-3">1.1 æ ¸å¿ƒåŠŸèƒ½</h4>
<ul>
<li><strong>å‡ºç«™è¯·æ±‚Mockï¼ˆOutbound Mockï¼‰</strong>ï¼šå°è£…HTTPå®¢æˆ·ç«¯ï¼Œæ‹¦æˆªæœ¬ç³»ç»Ÿè°ƒç”¨å¤–éƒ¨ç³»ç»Ÿçš„è¯·æ±‚</li>
<li><strong>å…¥ç«™è¯·æ±‚Mockï¼ˆInbound Mockï¼‰</strong>ï¼šé€šè¿‡æ‹¦æˆªå™¨æœºåˆ¶ï¼Œæ‹¦æˆªå¤–éƒ¨ç³»ç»Ÿè°ƒç”¨æœ¬ç³»ç»Ÿçš„è¯·æ±‚</li>
<li><strong>æ•°æ®åº“é…ç½®ç®¡ç†</strong>ï¼šé€šè¿‡æ•°æ®åº“åŠ¨æ€é…ç½®Mockè§„åˆ™ï¼Œæ”¯æŒCRUDæ“ä½œ</li>
<li><strong>æ™ºèƒ½ç¼“å­˜æœºåˆ¶</strong>ï¼šå†…å­˜ç¼“å­˜å‡å°‘æ•°æ®åº“è®¿é—®ï¼Œæå‡æ€§èƒ½</li>
<li><strong>çµæ´»çš„å¯ç”¨/ç¦ç”¨</strong>ï¼šæ”¯æŒå…¨å±€å¼€å…³å’Œå•ä¸ªé…ç½®çš„å¯ç”¨/ç¦ç”¨</li>
</ul>
<h4 data-id="heading-4">1.2 æŠ€æœ¯ç‰¹ç‚¹</h4>
<ul>
<li><strong>DDDæ¶æ„</strong>ï¼šæ¸…æ™°çš„é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼Œåˆ†å±‚æ˜ç¡®</li>
<li><strong>Spring Boot 3</strong>ï¼šåŸºäºæœ€æ–°çš„Spring Bootæ¡†æ¶</li>
<li><strong>Java 17</strong>ï¼šä½¿ç”¨ç°ä»£Javaç‰¹æ€§</li>
<li><strong>MyBatis-Plus</strong>ï¼šå¼ºå¤§çš„æŒä¹…å±‚æ¡†æ¶ï¼Œæä¾›çµæ´»çš„SQLæ§åˆ¶å’Œä¼˜ç§€çš„æ€§èƒ½</li>
<li><strong>Hutoolå·¥å…·åº“</strong>ï¼šç®€åŒ–HTTPè¯·æ±‚å¤„ç†</li>
<li><strong>TestContainers</strong>ï¼šå®¹å™¨åŒ–æµ‹è¯•ç¯å¢ƒï¼Œç¡®ä¿æµ‹è¯•ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒä¸€è‡´</li>
</ul>
<h4 data-id="heading-5">1.3 SQL è®¾è®¡</h4>
<p>mock_config è¿™å¼ è¡¨ä¸»è¦ç”¨æ¥å­˜æ”¾å®šä¹‰çš„ mock æ•°æ®ã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `mock_config` (
  `id` <span class="hljs-type">bigint</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">'ä¸»é”®ID'</span>,
  `api_path` <span class="hljs-type">varchar</span>(<span class="hljs-number">500</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'æ¥å£è·¯å¾„ï¼Œå¦‚ï¼š/api/user/info'</span>,
  `api_method` <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'è¯·æ±‚æ–¹æ³•ï¼šGET, POST, PUT, DELETE'</span>,
  `response_json` longtext COMMENT <span class="hljs-string">'è¿”å›çš„JSONæ•°æ®'</span>,
  `is_enabled` tinyint(<span class="hljs-number">1</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'1'</span> COMMENT <span class="hljs-string">'æ˜¯å¦å¯ç”¨ï¼štrue-å¯ç”¨ï¼Œfalse-ç¦ç”¨'</span>,
  `create_time` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'åˆ›å»ºæ—¶é—´'</span>,
  `update_time` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'æ›´æ–°æ—¶é—´'</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),
  <span class="hljs-keyword">UNIQUE</span> KEY `uk_api_method_path` (`api_path`,`api_method`) COMMENT <span class="hljs-string">'è·¯å¾„å’Œæ–¹æ³•çš„å”¯ä¸€çº¦æŸ'</span>,
  KEY `idx_is_enabled` (`is_enabled`) COMMENT <span class="hljs-string">'å¯ç”¨çŠ¶æ€ç´¢å¼•'</span>,
  KEY `idx_create_time` (`create_time`) COMMENT <span class="hljs-string">'åˆ›å»ºæ—¶é—´ç´¢å¼•'</span>
) ENGINE<span class="hljs-operator">=</span>InnoDB AUTO_INCREMENT<span class="hljs-operator">=</span><span class="hljs-number">10</span> <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_0900_ai_ci COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'Mocké…ç½®è¡¨'</span>;
</code></pre>
<h4 data-id="heading-6">1.4 å¼€å‘è®¾è®¡</h4>
<p>åŸºç¡€ CRUD ä¸è®²è§£ï¼Œåªä»‹ç»ä¸»è¦éƒ¨åˆ†ã€‚</p>
<p>æœ¬æ¬¡çš„è®¾è®¡åˆ†ä¸ºäº†ä¸¤ç§ï¼š</p>
<ul>
<li>1 å‡ºæˆ˜ï¼ˆé€šè¿‡å®šåˆ¶ http è¯·æ±‚å®Œæˆï¼‰</li>
<li>2 å…¥ç«™ï¼ˆé€šè¿‡æ‹¦æˆªè¯·æ±‚è¿›è¡Œè·å–æ•°æ®è¿”å›ï¼‰</li>
</ul>
<p>æ¡ˆä¾‹ä»£ç é‡‡ç”¨ DDD åˆ†å±‚æ¶æ„</p>
<pre><code class="hljs language-plain" lang="plain">Trial3-Mock-Design/
â”œâ”€â”€ domain/              # é¢†åŸŸå±‚
â”‚   â”œâ”€â”€ model/          # é¢†åŸŸæ¨¡å‹ï¼ˆå®ä½“ï¼‰
â”‚   â””â”€â”€ repository/     # ä»“å‚¨æ¥å£
â”œâ”€â”€ application/         # åº”ç”¨å±‚
â”‚   â”œâ”€â”€ service/        # åº”ç”¨æœåŠ¡
â”‚   â””â”€â”€ dto/            # æ•°æ®ä¼ è¾“å¯¹è±¡
â”œâ”€â”€ infrastructure/      # åŸºç¡€è®¾æ–½å±‚
â”‚   â”œâ”€â”€ persistence/    # æŒä¹…åŒ–å®ç°
â”‚   â””â”€â”€ config/         # é…ç½®ç±»
â””â”€â”€ interfaces/          # æ¥å£å±‚
    â”œâ”€â”€ controller/     # RESTæ§åˆ¶å™¨
    â”œâ”€â”€ interceptor/    # æ‹¦æˆªå™¨
    â”œâ”€â”€ client/         # HTTPå®¢æˆ·ç«¯å°è£…
    â””â”€â”€ exception/      # å¼‚å¸¸å¤„ç†
</code></pre>
<h3 data-id="heading-7">2 Mock å¼€å‘</h3>
<h4 data-id="heading-8">2.1 åŸºç¡€åŠŸèƒ½</h4>
<p>MockConfigProperties.java é…ç½®å±æ€§ç±»</p>
<p>ç”¨æ¥è®¾ç½®å…¨å±€æ˜¯å¦å¼€å¯ mock åŠŸèƒ½ï¼Œä»¥åŠç¼“å­˜æ—¶é—´å’Œæ—¥å¿—å¼€å…³ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * Mocké…ç½®å±æ€§ç±»
 * ä½¿ç”¨<span class="hljs-doctag">@ConfigurationProperties</span>ä»application.ymlä¸­ç»‘å®šmocké…ç½®
 * 
 * é…ç½®ç¤ºä¾‹ï¼š
 * mock:
 *   enabled: true
 *   cache-expiration-seconds: 300
 *   log-mock-usage: true
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@ConfigurationProperties(prefix = "mock")</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MockConfigProperties</span> {

    <span class="hljs-comment">/**
     * å…¨å±€MockåŠŸèƒ½å¼€å…³
     * å½“è®¾ç½®ä¸ºfalseæ—¶ï¼Œç³»ç»Ÿå°†ç»•è¿‡æ‰€æœ‰Mocké€»è¾‘ï¼Œç›´æ¥æ‰§è¡Œå®é™…è¯·æ±‚
     * é»˜è®¤å€¼ï¼štrue
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">enabled</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;

    <span class="hljs-comment">/**
     * ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰
     * Mocké…ç½®åœ¨ç¼“å­˜ä¸­çš„å­˜æ´»æ—¶é—´ï¼Œè¶…è¿‡æ­¤æ—¶é—´åå°†ä»æ•°æ®åº“é‡æ–°åŠ è½½
     * é»˜è®¤å€¼ï¼š300ç§’ï¼ˆ5åˆ†é’Ÿï¼‰
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-variable">cacheExpirationSeconds</span> <span class="hljs-operator">=</span> <span class="hljs-number">300</span>;

    <span class="hljs-comment">/**
     * æ˜¯å¦è®°å½•Mockä½¿ç”¨æ—¥å¿—
     * å½“è®¾ç½®ä¸ºtrueæ—¶ï¼Œç³»ç»Ÿå°†è®°å½•æ¯æ¬¡ä½¿ç”¨Mockæ•°æ®çš„è¯¦ç»†ä¿¡æ¯
     * é»˜è®¤å€¼ï¼štrue
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">logMockUsage</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
}
</code></pre>
<p>MockCacheService.java ç¼“å­˜æœåŠ¡</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * Mocké…ç½®ç¼“å­˜æœåŠ¡
 * ä½¿ç”¨ConcurrentHashMapå®ç°çº¿ç¨‹å®‰å…¨çš„å†…å­˜ç¼“å­˜ï¼Œæå‡Mocké…ç½®æŸ¥è¯¢æ€§èƒ½
 * æ”¯æŒç¼“å­˜è¿‡æœŸæœºåˆ¶ï¼Œç¡®ä¿æ•°æ®çš„æ—¶æ•ˆæ€§
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MockCacheService</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcurrentHashMap&lt;String, CacheEntry&lt;MockConfig&gt;&gt; cache;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> cacheExpirationMs;
    
    <span class="hljs-comment">/**
     * æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–ç¼“å­˜å’Œè¿‡æœŸæ—¶é—´
     * 
     * <span class="hljs-doctag">@param</span> properties Mocké…ç½®å±æ€§ï¼ŒåŒ…å«ç¼“å­˜è¿‡æœŸæ—¶é—´é…ç½®
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MockCacheService</span><span class="hljs-params">(MockConfigProperties properties)</span> {
        <span class="hljs-built_in">this</span>.cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();
        <span class="hljs-built_in">this</span>.cacheExpirationMs = properties.getCacheExpirationSeconds() * <span class="hljs-number">1000</span>;
        log.info(<span class="hljs-string">"MockCacheService initialized with expiration time: {} ms"</span>, cacheExpirationMs);
    }
    
    <span class="hljs-comment">/**
     * ä»ç¼“å­˜ä¸­è·å–Mocké…ç½®
     * å¦‚æœç¼“å­˜æ¡ç›®å·²è¿‡æœŸï¼Œå°†è‡ªåŠ¨ç§»é™¤å¹¶è¿”å›ç©º
     * 
     * <span class="hljs-doctag">@param</span> cacheKey ç¼“å­˜é”®ï¼Œæ ¼å¼ä¸º "apiPath:apiMethod"
     * <span class="hljs-doctag">@return</span> OptionalåŒ…è£…çš„MockConfigï¼Œå¦‚æœä¸å­˜åœ¨æˆ–å·²è¿‡æœŸåˆ™è¿”å›ç©º
     */</span>
    <span class="hljs-keyword">public</span> Optional&lt;MockConfig&gt; <span class="hljs-title function_">get</span><span class="hljs-params">(String cacheKey)</span> {
        CacheEntry&lt;MockConfig&gt; entry = cache.get(cacheKey);
        
        <span class="hljs-keyword">if</span> (entry == <span class="hljs-literal">null</span>) {
            log.debug(<span class="hljs-string">"Cache miss for key: {}"</span>, cacheKey);
            <span class="hljs-keyword">return</span> Optional.empty();
        }
        
        <span class="hljs-keyword">if</span> (entry.isExpired(cacheExpirationMs)) {
            log.debug(<span class="hljs-string">"Cache entry expired for key: {}, removing from cache"</span>, cacheKey);
            cache.remove(cacheKey);
            <span class="hljs-keyword">return</span> Optional.empty();
        }
        
        log.debug(<span class="hljs-string">"Cache hit for key: {}"</span>, cacheKey);
        <span class="hljs-keyword">return</span> Optional.of(entry.getValue());
    }
    
    <span class="hljs-comment">/**
     * å°†Mocké…ç½®æ”¾å…¥ç¼“å­˜
     * 
     * <span class="hljs-doctag">@param</span> cacheKey ç¼“å­˜é”®ï¼Œæ ¼å¼ä¸º "apiPath:apiMethod"
     * <span class="hljs-doctag">@param</span> config è¦ç¼“å­˜çš„MockConfigå¯¹è±¡
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(String cacheKey, MockConfig config)</span> {
        CacheEntry&lt;MockConfig&gt; entry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheEntry</span>&lt;&gt;(config);
        cache.put(cacheKey, entry);
        log.debug(<span class="hljs-string">"Cache updated for key: {}"</span>, cacheKey);
    }
    
    <span class="hljs-comment">/**
     * ä½¿æŒ‡å®šç¼“å­˜æ¡ç›®å¤±æ•ˆï¼ˆç§»é™¤ï¼‰
     * é€šå¸¸åœ¨Mocké…ç½®è¢«æ›´æ–°æˆ–åˆ é™¤æ—¶è°ƒç”¨
     * 
     * <span class="hljs-doctag">@param</span> cacheKey è¦å¤±æ•ˆçš„ç¼“å­˜é”®
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">invalidate</span><span class="hljs-params">(String cacheKey)</span> {
        cache.remove(cacheKey);
        log.debug(<span class="hljs-string">"Cache invalidated for key: {}"</span>, cacheKey);
    }
    
    <span class="hljs-comment">/**
     * æ¸…ç©ºæ‰€æœ‰ç¼“å­˜æ¡ç›®
     * é€šå¸¸åœ¨éœ€è¦å¼ºåˆ¶åˆ·æ–°æ‰€æœ‰ç¼“å­˜æ—¶è°ƒç”¨
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> cache.size();
        cache.clear();
        log.info(<span class="hljs-string">"Cache cleared, removed {} entries"</span>, size);
    }
    
    <span class="hljs-comment">/**
     * ç¼“å­˜æ¡ç›®å†…éƒ¨ç±»
     * å°è£…ç¼“å­˜å€¼å’Œæ—¶é—´æˆ³ï¼Œç”¨äºå®ç°è¿‡æœŸæ£€æŸ¥
     * 
     * <span class="hljs-doctag">@param</span> &lt;T&gt; ç¼“å­˜å€¼çš„ç±»å‹
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheEntry</span>&lt;T&gt; {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> T value;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> timestamp;
        
        <span class="hljs-comment">/**
         * æ„é€ å‡½æ•°ï¼Œåˆ›å»ºç¼“å­˜æ¡ç›®å¹¶è®°å½•å½“å‰æ—¶é—´æˆ³
         * 
         * <span class="hljs-doctag">@param</span> value è¦ç¼“å­˜çš„å€¼
         */</span>
        <span class="hljs-keyword">public</span> <span class="hljs-title function_">CacheEntry</span><span class="hljs-params">(T value)</span> {
            <span class="hljs-built_in">this</span>.value = value;
            <span class="hljs-built_in">this</span>.timestamp = System.currentTimeMillis();
        }
        
        <span class="hljs-comment">/**
         * è·å–ç¼“å­˜çš„å€¼
         * 
         * <span class="hljs-doctag">@return</span> ç¼“å­˜çš„å€¼
         */</span>
        <span class="hljs-keyword">public</span> T <span class="hljs-title function_">getValue</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> value;
        }
        
        <span class="hljs-comment">/**
         * æ£€æŸ¥ç¼“å­˜æ¡ç›®æ˜¯å¦å·²è¿‡æœŸ
         * 
         * <span class="hljs-doctag">@param</span> expirationMs è¿‡æœŸæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
         * <span class="hljs-doctag">@return</span> trueå¦‚æœå·²è¿‡æœŸï¼Œå¦åˆ™è¿”å›false
         */</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isExpired</span><span class="hljs-params">(<span class="hljs-type">long</span> expirationMs)</span> {
            <span class="hljs-keyword">return</span> System.currentTimeMillis() - timestamp &gt; expirationMs;
        }
    }
}
</code></pre>
<h4 data-id="heading-9">2.2 å°è£… http è¯·æ±‚ï¼ˆå‡ºç«™ï¼‰</h4>
<p>é€šè¿‡å°è£… http è¯·æ±‚å®¢æˆ·ç«¯ï¼Œå½“æ¯æ¬¡éœ€è¦è°ƒç”¨å¤–éƒ¨ç³»ç»Ÿçš„æ—¶å€™ï¼Œé€šè¿‡æ­¤å°è£…å·¥å…·ï¼Œå°†å¯¹åº”çš„ api å’Œå‚æ•°ä¼ é€’è¿‡å»ï¼Œå¦‚æœæ˜¯éœ€è¦ mock è¿”å›ï¼Œåˆ™ä¸ä¼šè°ƒç”¨ httpï¼Œåä¹‹æ”¾è¡Œè°ƒç”¨ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * HTTPå®¢æˆ·ç«¯å°è£…å™¨
 * å°è£…Hutoolçš„HTTPè¯·æ±‚æ–¹æ³•ï¼Œæä¾›å‡ºç«™MockåŠŸèƒ½
 * 
 * å·¥ä½œæµç¨‹ï¼š
 * 1. æ£€æŸ¥å…¨å±€Mockå¼€å…³
 * 2. ä»URLæå–è·¯å¾„
 * 3. æŸ¥è¯¢Mocké…ç½®
 * 4. å¦‚æœMockå¯ç”¨ï¼Œè¿”å›Mockæ•°æ®ï¼›å¦åˆ™å‘èµ·å®é™…HTTPè¯·æ±‚
 * 
 * æ”¯æŒçš„HTTPæ–¹æ³•ï¼šGET, POST, PUT, DELETE
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpClientWrapper</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> MockService mockService;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> MockConfigProperties properties;
    
    <span class="hljs-comment">/**
     * æ„é€ å‡½æ•°ï¼Œæ³¨å…¥ä¾èµ–
     * 
     * <span class="hljs-doctag">@param</span> mockService MockæœåŠ¡
     * <span class="hljs-doctag">@param</span> properties Mocké…ç½®å±æ€§
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">HttpClientWrapper</span><span class="hljs-params">(MockService mockService, MockConfigProperties properties)</span> {
        <span class="hljs-built_in">this</span>.mockService = mockService;
        <span class="hljs-built_in">this</span>.properties = properties;
    }
    
    <span class="hljs-comment">/**
     * å‘èµ·GETè¯·æ±‚
     * 
     * <span class="hljs-doctag">@param</span> url ç›®æ ‡URL
     * <span class="hljs-doctag">@return</span> å“åº”å†…å®¹
     */</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">get</span><span class="hljs-params">(String url)</span> {
        <span class="hljs-keyword">return</span> executeRequest(url, <span class="hljs-string">"GET"</span>, <span class="hljs-literal">null</span>);
    }
    
    <span class="hljs-comment">/**
     * å‘èµ·POSTè¯·æ±‚
     * 
     * <span class="hljs-doctag">@param</span> url ç›®æ ‡URL
     * <span class="hljs-doctag">@param</span> body è¯·æ±‚ä½“
     * <span class="hljs-doctag">@return</span> å“åº”å†…å®¹
     */</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">post</span><span class="hljs-params">(String url, String body)</span> {
        <span class="hljs-keyword">return</span> executeRequest(url, <span class="hljs-string">"POST"</span>, body);
    }
    
    <span class="hljs-comment">/**
     * å‘èµ·PUTè¯·æ±‚
     * 
     * <span class="hljs-doctag">@param</span> url ç›®æ ‡URL
     * <span class="hljs-doctag">@param</span> body è¯·æ±‚ä½“
     * <span class="hljs-doctag">@return</span> å“åº”å†…å®¹
     */</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">put</span><span class="hljs-params">(String url, String body)</span> {
        <span class="hljs-keyword">return</span> executeRequest(url, <span class="hljs-string">"PUT"</span>, body);
    }
    
    <span class="hljs-comment">/**
     * å‘èµ·DELETEè¯·æ±‚
     * 
     * <span class="hljs-doctag">@param</span> url ç›®æ ‡URL
     * <span class="hljs-doctag">@return</span> å“åº”å†…å®¹
     */</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">delete</span><span class="hljs-params">(String url)</span> {
        <span class="hljs-keyword">return</span> executeRequest(url, <span class="hljs-string">"DELETE"</span>, <span class="hljs-literal">null</span>);
    }
    
    <span class="hljs-comment">/**
     * æ‰§è¡ŒHTTPè¯·æ±‚çš„æ ¸å¿ƒé€»è¾‘
     * 
     * æµç¨‹ï¼š
     * 1. æ£€æŸ¥å…¨å±€Mockå¼€å…³ï¼Œå¦‚æœç¦ç”¨åˆ™ç›´æ¥å‘èµ·å®é™…è¯·æ±‚
     * 2. ä»URLæå–è·¯å¾„
     * 3. æŸ¥è¯¢Mocké…ç½®
     * 4. å¦‚æœMocké…ç½®å­˜åœ¨ä¸”å¯ç”¨ï¼Œè¿”å›Mockæ•°æ®
     * 5. å¦åˆ™å‘èµ·å®é™…HTTPè¯·æ±‚
     * 
     * <span class="hljs-doctag">@param</span> url ç›®æ ‡URL
     * <span class="hljs-doctag">@param</span> method HTTPæ–¹æ³•
     * <span class="hljs-doctag">@param</span> body è¯·æ±‚ä½“ï¼ˆå¯ä¸ºnullï¼‰
     * <span class="hljs-doctag">@return</span> å“åº”å†…å®¹
     */</span>
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">executeRequest</span><span class="hljs-params">(String url, String method, String body)</span> {
        <span class="hljs-comment">// æ£€æŸ¥å…¨å±€Mockå¼€å…³</span>
        <span class="hljs-keyword">if</span> (!properties.isEnabled()) {
            log.debug(<span class="hljs-string">"Mock is globally disabled, making real request to {} {}"</span>, method, url);
            <span class="hljs-keyword">return</span> makeRealRequest(url, method, body);
        }
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// ä»URLæå–è·¯å¾„</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> extractPath(url);
            
            <span class="hljs-comment">// æŸ¥è¯¢Mocké…ç½®</span>
            Optional&lt;MockConfig&gt; mockConfig = mockService.getMockConfig(path, method);
            
            <span class="hljs-comment">// å¦‚æœMocké…ç½®å­˜åœ¨ä¸”å¯ç”¨ï¼Œè¿”å›Mockæ•°æ®</span>
            <span class="hljs-keyword">if</span> (mockConfig.isPresent() &amp;&amp; mockConfig.get().isActive()) {
                <span class="hljs-keyword">if</span> (properties.isLogMockUsage()) {
                    log.info(<span class="hljs-string">"Mock response used for outbound {} {}"</span>, method, url);
                }
                <span class="hljs-keyword">return</span> mockConfig.get().getResponseJson();
            }
            
            <span class="hljs-comment">// Mockæœªå¯ç”¨æˆ–ä¸å­˜åœ¨ï¼Œå‘èµ·å®é™…è¯·æ±‚</span>
            log.debug(<span class="hljs-string">"No active mock config found for {} {}, making real request"</span>, method, path);
            <span class="hljs-keyword">return</span> makeRealRequest(url, method, body);
            
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"Error during mock check for {} {}, falling back to real request: {}"</span>, 
                     method, url, e.getMessage());
            <span class="hljs-keyword">return</span> makeRealRequest(url, method, body);
        }
    }
    
    <span class="hljs-comment">/**
     * å‘èµ·å®é™…çš„HTTPè¯·æ±‚
     * ä½¿ç”¨Hutoolçš„HttpRequestå·¥å…·ç±»
     * 
     * <span class="hljs-doctag">@param</span> url ç›®æ ‡URL
     * <span class="hljs-doctag">@param</span> method HTTPæ–¹æ³•
     * <span class="hljs-doctag">@param</span> body è¯·æ±‚ä½“ï¼ˆå¯ä¸ºnullï¼‰
     * <span class="hljs-doctag">@return</span> å“åº”å†…å®¹
     * <span class="hljs-doctag">@throws</span> IllegalArgumentException å¦‚æœHTTPæ–¹æ³•ä¸æ”¯æŒ
     */</span>
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">makeRealRequest</span><span class="hljs-params">(String url, String method, String body)</span> {
        log.debug(<span class="hljs-string">"Making real HTTP request: {} {}"</span>, method, url);
        
        <span class="hljs-keyword">try</span> {
            String response;
            <span class="hljs-keyword">switch</span> (method.toUpperCase()) {
                <span class="hljs-keyword">case</span> <span class="hljs-string">"GET"</span>:
                    response = HttpRequest.get(url).execute().body();
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"POST"</span>:
                    response = HttpRequest.post(url).body(body).execute().body();
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"PUT"</span>:
                    response = HttpRequest.put(url).body(body).execute().body();
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"DELETE"</span>:
                    response = HttpRequest.delete(url).execute().body();
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">default</span>:
                    log.error(<span class="hljs-string">"Unsupported HTTP method: {}"</span>, method);
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"Unsupported HTTP method: "</span> + method);
            }
            
            log.debug(<span class="hljs-string">"Real HTTP request completed: {} {}, response length: {}"</span>, 
                     method, url, response != <span class="hljs-literal">null</span> ? response.length() : <span class="hljs-number">0</span>);
            <span class="hljs-keyword">return</span> response;
            
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"Error making real HTTP request to {} {}: {}"</span>, method, url, e.getMessage(), e);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Failed to make HTTP request: "</span> + e.getMessage(), e);
        }
    }
    
    <span class="hljs-comment">/**
     * ä»å®Œæ•´URLä¸­æå–è·¯å¾„éƒ¨åˆ†
     * 
     * ä¾‹å¦‚ï¼š
     * - "http://example.com/api/user/info" -&gt; "/api/user/info"
     * - "https://example.com:8080/api/data?id=1" -&gt; "/api/data"
     * 
     * <span class="hljs-doctag">@param</span> url å®Œæ•´URL
     * <span class="hljs-doctag">@return</span> URLçš„è·¯å¾„éƒ¨åˆ†
     * <span class="hljs-doctag">@throws</span> IllegalArgumentException å¦‚æœURLæ ¼å¼æ— æ•ˆ
     */</span>
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">extractPath</span><span class="hljs-params">(String url)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">URI</span> <span class="hljs-variable">uri</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URI</span>(url);
            <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> uri.getPath();
            
            <span class="hljs-keyword">if</span> (path == <span class="hljs-literal">null</span> || path.isEmpty()) {
                log.warn(<span class="hljs-string">"URL has no path component: {}, using root path '/'"</span>, url);
                <span class="hljs-keyword">return</span> <span class="hljs-string">"/"</span>;
            }
            
            log.debug(<span class="hljs-string">"Extracted path '{}' from URL '{}'"</span>, path, url);
            <span class="hljs-keyword">return</span> path;
            
        } <span class="hljs-keyword">catch</span> (URISyntaxException e) {
            log.error(<span class="hljs-string">"Invalid URL format: {}"</span>, url, e);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"Invalid URL: "</span> + url, e);
        }
    }
}
</code></pre>
<p>è°ƒç”¨ mock æœåŠ¡ï¼Œä¸»è¦æ˜¯ä»¥ä¸‹ä»£ç </p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä»URLæå–è·¯å¾„</span>
<span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> extractPath(url);

<span class="hljs-comment">// æŸ¥è¯¢Mocké…ç½®</span>
Optional&lt;MockConfig&gt; mockConfig = mockService.getMockConfig(path, method);
</code></pre>
<p>é€šè¿‡ mock é…ç½®çš„åˆ¤æ–­è·å–å¯¹åº”æ•°æ®ï¼Œå…ˆæŸ¥ç¼“å­˜ï¼Œåœ¨æŸ¥æ•°æ®åº“ï¼Œä¸€å®šç¨‹åº¦ä¸Šä¼˜åŒ–ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * è·å–Mocké…ç½®ï¼ˆé›†æˆç¼“å­˜æŸ¥è¯¢ï¼‰
 * ä¼˜å…ˆä»ç¼“å­˜è·å–ï¼Œç¼“å­˜æœªå‘½ä¸­æ—¶ä»æ•°æ®åº“æŸ¥è¯¢å¹¶æ›´æ–°ç¼“å­˜
 * 
 * <span class="hljs-doctag">@param</span> apiPath APIè·¯å¾„
 * <span class="hljs-doctag">@param</span> apiMethod HTTPæ–¹æ³•
 * <span class="hljs-doctag">@return</span> OptionalåŒ…è£…çš„MockConfig
 */</span>
<span class="hljs-keyword">public</span> Optional&lt;MockConfig&gt; <span class="hljs-title function_">getMockConfig</span><span class="hljs-params">(String apiPath, String apiMethod)</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">cacheKey</span> <span class="hljs-operator">=</span> apiPath + <span class="hljs-string">":"</span> + apiMethod;
    
    <span class="hljs-comment">// å…ˆæŸ¥ç¼“å­˜</span>
    Optional&lt;MockConfig&gt; cached = cacheService.get(cacheKey);
    <span class="hljs-keyword">if</span> (cached.isPresent()) {
        log.debug(<span class="hljs-string">"Mock config found in cache for {} {}"</span>, apiMethod, apiPath);
        <span class="hljs-keyword">return</span> cached;
    }
    
    <span class="hljs-comment">// ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥æ•°æ®åº“</span>
    Optional&lt;MockConfig&gt; config = mockConfigRepository.findByApiPathAndApiMethod(apiPath, apiMethod);
    
    <span class="hljs-comment">// å¦‚æœæ‰¾åˆ°ï¼Œæ›´æ–°ç¼“å­˜</span>
    config.ifPresent(c -&gt; {
        cacheService.put(cacheKey, c);
        log.debug(<span class="hljs-string">"Mock config loaded from database and cached for {} {}"</span>, apiMethod, apiPath);
    });
    
    <span class="hljs-keyword">if</span> (config.isEmpty()) {
        log.debug(<span class="hljs-string">"Mock config not found for {} {}"</span>, apiMethod, apiPath);
    }
    
    <span class="hljs-keyword">return</span> config;
}
</code></pre>
<h4 data-id="heading-10">2.3 Mock æ‹¦æˆªå™¨ï¼ˆå‡ºç«™ï¼‰</h4>
<p>å®šä¹‰ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œæ²¡è¢«è¿‡æ»¤çš„ api è¯·æ±‚å°†ä¼šåˆ°è¿™é‡Œè¿›è¡Œæ‹¦æˆª mock å¤„ç†</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * Mockæ‹¦æˆªå™¨
 * ç”¨äºæ‹¦æˆªå…¥ç«™HTTPè¯·æ±‚ï¼Œæ ¹æ®Mocké…ç½®è¿”å›Mockæ•°æ®
 * å®ç°HandlerInterceptoræ¥å£ï¼Œåœ¨Controlleræ–¹æ³•æ‰§è¡Œå‰è¿›è¡Œæ‹¦æˆª
 * 
 * å·¥ä½œæµç¨‹ï¼š
 * 1. æ£€æŸ¥å…¨å±€Mockå¼€å…³æ˜¯å¦å¯ç”¨
 * 2. æå–è¯·æ±‚è·¯å¾„å’ŒHTTPæ–¹æ³•
 * 3. æŸ¥è¯¢Mocké…ç½®ï¼ˆä¼˜å…ˆä»ç¼“å­˜è·å–ï¼‰
 * 4. å¦‚æœMocké…ç½®å­˜åœ¨ä¸”å¯ç”¨ï¼Œç›´æ¥è¿”å›Mockæ•°æ®
 * 5. å¦åˆ™ï¼Œç»§ç»­æ‰§è¡ŒControlleræ–¹æ³•
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MockInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> MockService mockService;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> MockConfigProperties properties;
    
    <span class="hljs-comment">/**
     * æ„é€ å‡½æ•°ï¼Œæ³¨å…¥ä¾èµ–
     * 
     * <span class="hljs-doctag">@param</span> mockService MockæœåŠ¡
     * <span class="hljs-doctag">@param</span> properties Mocké…ç½®å±æ€§
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MockInterceptor</span><span class="hljs-params">(MockService mockService, MockConfigProperties properties)</span> {
        <span class="hljs-built_in">this</span>.mockService = mockService;
        <span class="hljs-built_in">this</span>.properties = properties;
    }
    
    <span class="hljs-comment">/**
     * åœ¨Controlleræ–¹æ³•æ‰§è¡Œå‰æ‹¦æˆªè¯·æ±‚
     * 
     * <span class="hljs-doctag">@param</span> request HTTPè¯·æ±‚
     * <span class="hljs-doctag">@param</span> response HTTPå“åº”
     * <span class="hljs-doctag">@param</span> handler å¤„ç†å™¨
     * <span class="hljs-doctag">@return</span> trueè¡¨ç¤ºç»§ç»­æ‰§è¡ŒControllerï¼Œfalseè¡¨ç¤ºæ‹¦æˆªå¹¶è¿”å›Mockæ•°æ®
     * <span class="hljs-doctag">@throws</span> Exception å¤„ç†è¿‡ç¨‹ä¸­çš„å¼‚å¸¸
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, 
                            HttpServletResponse response, 
                            Object handler)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// æ£€æŸ¥å…¨å±€Mockå¼€å…³</span>
        <span class="hljs-keyword">if</span> (!properties.isEnabled()) {
            log.debug(<span class="hljs-string">"Mock functionality is globally disabled, continuing to controller"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// MockåŠŸèƒ½ç¦ç”¨ï¼Œç»§ç»­æ‰§è¡ŒController</span>
        }
        
        <span class="hljs-comment">// æå–è¯·æ±‚è·¯å¾„å’Œæ–¹æ³•</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> request.getRequestURI();
        <span class="hljs-type">String</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> request.getMethod();
        
        log.debug(<span class="hljs-string">"Intercepting request: {} {}"</span>, method, path);
        
        <span class="hljs-comment">// æŸ¥è¯¢Mocké…ç½®</span>
        Optional&lt;MockConfig&gt; mockConfig = mockService.getMockConfig(path, method);
        
        <span class="hljs-comment">// æ£€æŸ¥Mocké…ç½®æ˜¯å¦å­˜åœ¨ä¸”å¯ç”¨</span>
        <span class="hljs-keyword">if</span> (mockConfig.isPresent() &amp;&amp; mockConfig.get().isActive()) {
            <span class="hljs-type">MockConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> mockConfig.get();
            
            <span class="hljs-comment">// è®¾ç½®å“åº”å¤´</span>
            response.setContentType(<span class="hljs-string">"application/json;charset=UTF-8"</span>);
            response.setStatus(HttpStatus.OK.value());
            
            <span class="hljs-comment">// å†™å…¥Mockå“åº”æ•°æ®</span>
            response.getWriter().write(config.getResponseJson());
            response.getWriter().flush();
            
            <span class="hljs-comment">// è®°å½•Mockä½¿ç”¨æ—¥å¿—</span>
            <span class="hljs-keyword">if</span> (properties.isLogMockUsage()) {
                log.info(<span class="hljs-string">"Mock response returned for {} {} (config id: {})"</span>, 
                        method, path, config.getId());
            }
            
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// æ‹¦æˆªè¯·æ±‚ï¼Œä¸ç»§ç»­æ‰§è¡ŒController</span>
        }
        
        <span class="hljs-comment">// Mocké…ç½®ä¸å­˜åœ¨æˆ–æœªå¯ç”¨ï¼Œç»§ç»­æ‰§è¡ŒController</span>
        log.debug(<span class="hljs-string">"No active mock config found for {} {}, continuing to controller"</span>, method, path);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<p>ä¸»è¦ä¹Ÿæ˜¯è°ƒç”¨äº† <code>Optional&lt;MockConfig&gt; mockConfig = mockService.getMockConfig(path, method);</code>mock æœåŠ¡ã€‚</p>
<p>é€šè¿‡ mvc æ‹¦æˆªï¼Œè®°å¾—å°† mock çš„ crud æ’é™¤ï¼Œä¹Ÿå¯ä»¥åˆ¶ä½œç™½åå•æ•°ç»„ï¼Œå°†ä¸éœ€è¦çš„ api ç›´æ¥è¿‡æ»¤æ‰ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * Web MVCé…ç½®ç±»
 * ç”¨äºæ³¨å†Œæ‹¦æˆªå™¨å’Œé…ç½®æ‹¦æˆªè·¯å¾„
 * 
 * æ‹¦æˆªå™¨é…ç½®ï¼š
 * - æ‹¦æˆªæ‰€æœ‰è·¯å¾„ï¼ˆ/**ï¼‰
 * - æ’é™¤Mocké…ç½®ç®¡ç†æ¥å£ï¼ˆ/api/mock-config/**ï¼‰ï¼Œé¿å…ç®¡ç†æ¥å£è¢«Mockæ‹¦æˆª
 */</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebMvcConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> MockInterceptor mockInterceptor;
    
    <span class="hljs-comment">/**
     * æ„é€ å‡½æ•°ï¼Œæ³¨å…¥MockInterceptor
     * 
     * <span class="hljs-doctag">@param</span> mockInterceptor Mockæ‹¦æˆªå™¨
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">WebMvcConfig</span><span class="hljs-params">(MockInterceptor mockInterceptor)</span> {
        <span class="hljs-built_in">this</span>.mockInterceptor = mockInterceptor;
    }
    
    <span class="hljs-comment">/**
     * æ³¨å†Œæ‹¦æˆªå™¨
     * é…ç½®æ‹¦æˆªè·¯å¾„å’Œæ’é™¤è·¯å¾„
     * 
     * <span class="hljs-doctag">@param</span> registry æ‹¦æˆªå™¨æ³¨å†Œå™¨
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> {
        log.info(<span class="hljs-string">"Registering MockInterceptor"</span>);
        
        registry.addInterceptor(mockInterceptor)
                .addPathPatterns(<span class="hljs-string">"/**"</span>)  <span class="hljs-comment">// æ‹¦æˆªæ‰€æœ‰è·¯å¾„</span>
                .excludePathPatterns(<span class="hljs-string">"/api/mock-config/**"</span>);  <span class="hljs-comment">// æ’é™¤Mocké…ç½®ç®¡ç†æ¥å£</span>
        
        log.info(<span class="hljs-string">"MockInterceptor registered successfully"</span>);
    }
}
</code></pre>
<h3 data-id="heading-11">3 Mock åŠŸèƒ½æµ‹è¯•</h3>
<p>ä»£ç ä»“åº“é‡Œé¢è®¾æœ‰å…¥ç«™ä¸å‡ºç«™çš„æµ‹è¯•ç±»ï¼Œå¯ä»¥è‡ªè¡Œè°ƒè¯•ã€‚</p>
<p>å‡ºç«™æµ‹è¯•</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Test</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">testOutboundMock_WhenMockConfigExistsAndEnabled_ReturnsMockData</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// Given: åˆ›å»ºå¹¶ä¿å­˜Mocké…ç½®</span>
    <span class="hljs-type">MockConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MockConfig</span>();
    config.setApiPath(<span class="hljs-string">"/api/user/info"</span>);
    config.setApiMethod(<span class="hljs-string">"GET"</span>);
    config.setResponseJson(<span class="hljs-string">"{\"id\":1,\"name\":\"Test User\"}"</span>);
    config.setIsEnabled(<span class="hljs-literal">true</span>);
    config.setCreateTime(LocalDateTime.now());
    config.setUpdateTime(LocalDateTime.now());
    repository.save(config);
    
    <span class="hljs-comment">// When: é€šè¿‡HttpClientWrapperå‘èµ·GETè¯·æ±‚</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> httpClientWrapper.get(<span class="hljs-string">"http://example.com/api/user/info"</span>);
    System.out.println(response);
    <span class="hljs-comment">// Then: åº”è¯¥è¿”å›Mockæ•°æ®</span>
    assertThat(response).isEqualTo(<span class="hljs-string">"{\"id\":1,\"name\":\"Test User\"}"</span>);
}
</code></pre>
<p>å…¥ç«™æµ‹è¯•</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Test</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">testInboundMock_WhenMockConfigExistsAndEnabled_ReturnsInterceptedMockData</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-comment">// Given: åˆ›å»ºå¹¶ä¿å­˜Mocké…ç½®</span>
    <span class="hljs-type">MockConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MockConfig</span>();
    config.setApiPath(<span class="hljs-string">"/api/test/endpoint"</span>);
    config.setApiMethod(<span class="hljs-string">"GET"</span>);
    config.setResponseJson(<span class="hljs-string">"{\"intercepted\":true,\"message\":\"Mock response\"}"</span>);
    config.setIsEnabled(<span class="hljs-literal">true</span>);
    config.setCreateTime(LocalDateTime.now());
    config.setUpdateTime(LocalDateTime.now());
    repository.save(config);
    
    <span class="hljs-comment">// When &amp; Then: å‘èµ·GETè¯·æ±‚ï¼Œåº”è¯¥è¢«æ‹¦æˆªå™¨æ‹¦æˆªå¹¶è¿”å›Mockæ•°æ®</span>
    mockMvc.perform(get(<span class="hljs-string">"/api/test/endpoint"</span>))
            .andExpect(status().isOk())
            .andExpect(content().contentType(<span class="hljs-string">"application/json;charset=UTF-8"</span>))
            .andExpect(content().json(<span class="hljs-string">"{\"intercepted\":true,\"message\":\"Mock response\"}"</span>));
}
</code></pre>
<h3 data-id="heading-12">4 æ€»ç»“</h3>
<p>æœ¬æ–‡æ˜¯ä»‹ç»ä½œè€…åŸºäºSpring Boot 3å’ŒDDDæ¶æ„çš„åç«¯MockåŠŸèƒ½ç³»ç»Ÿï¼Œç”¨äºåœ¨å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒä¸­æ¨¡æ‹ŸHTTPæ¥å£å“åº”çš„ä¸€æ¬¡å°è¯•ï¼Œè¿™åªæ˜¯ä¸€ä¸ªæ¡ˆä¾‹ï¼Œå¯ä»¥æ ¹æ®é‡Œé¢çš„ä»£ç é›†æˆåˆ°å„è‡ªçš„é¡¹ç›®ä¸­ï¼Œåé¢æˆ‘åœ¨å†™ä¸€ç¯‡é›†æˆåˆ°åå°ç®¡ç†ç³»ç»Ÿä¸­çš„æ¡ˆä¾‹è¿‡ç¨‹ã€‚ä¹Ÿå¯ä»¥å…ˆçœ‹æˆ‘çš„ä»“åº“ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fliyongde%2Fjava-trial%2Ftree%2Fmaster%2FTrial3-Mock-Design" target="_blank" title="https://gitee.com/liyongde/java-trial/tree/master/Trial3-Mock-Design" ref="nofollow noopener noreferrer">gitee.com/liyongde/jaâ€¦</a></p>
<hr/>
<p><em>è½¬å‘è¯·æºå¸¦ä½œè€…ä¿¡æ¯</em>Â  <strong>@æ€’æ”¾å§å¾·å¾· @ä¸€ä¸ªæœ‰æ¢¦æœ‰æˆçš„äºº</strong><br/>
æŒç»­åˆ›ä½œå¾ˆä¸å®¹æ˜“ï¼Œä½œè€…å°†ä»¥å°½å¯èƒ½çš„è¯¦ç»†æŠŠæ‰€å­¦çŸ¥è¯†åˆ†äº«å„ä½å¼€å‘è€…ï¼Œä¸€èµ·è¿›æ­¥ä¸€èµ·å­¦ä¹ ã€‚<strong>è½¬è½½è¯·æºå¸¦é“¾æ¥ï¼Œè½¬è½½åˆ°å¾®ä¿¡å…¬ä¼—å·è¯·å‹¿é€‰æ‹©åŸåˆ›ï¼Œè°¢è°¢ï¼</strong><br/>
ğŸ‘åˆ›ä½œä¸æ˜“ï¼Œå¦‚æœ‰é”™è¯¯è¯·æŒ‡æ­£ï¼Œæ„Ÿè°¢è§‚çœ‹ï¼è®°å¾—ç‚¹èµå“¦ï¼ğŸ‘<br/>
è°¢è°¢æ”¯æŒï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenClaw 2.6 è°ƒæ•™å®å½•ï¼šä»å´©æºƒ 4671 æ¬¡åˆ°çœ 50% token]]></title>    <link>https://juejin.cn/post/7604142616474320902</link>    <guid>https://juejin.cn/post/7604142616474320902</guid>    <pubDate>2026-02-09T06:55:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604142616474320902" data-draft-id="7604084016511057961" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenClaw 2.6 è°ƒæ•™å®å½•ï¼šä»å´©æºƒ 4671 æ¬¡åˆ°çœ 50% token"/> <meta itemprop="keywords" content="OpenAI,AIç¼–ç¨‹,AIGC"/> <meta itemprop="datePublished" content="2026-02-09T06:55:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å­Ÿå¥AIç¼–ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/4212984287073895"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenClaw 2.6 è°ƒæ•™å®å½•ï¼šä»å´©æºƒ 4671 æ¬¡åˆ°çœ 50% token
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984287073895/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å­Ÿå¥AIç¼–ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T06:55:29.000Z" title="Mon Feb 09 2026 06:55:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å­Ÿå¥ã€‚</p>
<p>æˆ‘çš„AIåŠ©æ‰‹å·å·å´©äº†4671æ¬¡ï¼Œæˆ‘ä¸€ç‚¹æ²¡å¯Ÿè§‰ã€‚</p>
<p>ç›´åˆ°æœ‰ä¸€å¤©ï¼Œæˆ‘å‘ç°å®šæ—¶ä»»åŠ¡è¿ç»­3å¤©æ²¡è·‘â€”â€”æ¯å¤©æ—©ä¸Šçš„é€‰é¢˜æ¨é€ã€æ™šä¸Šçš„Xè¿è¥å€™é€‰ã€è®¤è¯ç›‘æ§â€¦â€¦å…¨éƒ¨é™æ‚„æ‚„æ¶ˆå¤±äº†ã€‚æˆ‘ä»¥ä¸ºæ˜¯bugï¼Œé¡ºæ‰‹ä¸€æŸ¥ï¼ŒæŒ–å‡ºäº†ä¸€ä¸ªè®©æˆ‘åèƒŒå‘å‡‰çš„å‘ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« è®°å½•æˆ‘æ€ä¹ˆæ’æŸ¥è¿™ä¸ªäº‹æ•…ï¼Œä»¥åŠè¶æœºæŠŠ OpenClaw 2.6 åšäº†ä¸€æ¬¡å…¨é¢ä½“æ£€â€”â€”<strong>æœ€ç»ˆ token è´¹ç”¨é™äº† 30-50%ï¼Œè®°å¿†ä¸å†ä¸¢å¤±</strong>ã€‚</p>
<p>æ‰€æœ‰é…ç½®éƒ½å¯ä»¥ç›´æ¥æŠ„ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef5f9d89b98d401aa1d699c6dd605fef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771224928&amp;x-signature=QrRoKQ7Gk%2BlU8jDPw4Tv%2B79PHKE%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-0"><strong>01 äº‹æ•…ç°åœºï¼š4671æ¬¡æ— æ•ˆ é‡å¯</strong></h2>
<p>æˆ‘ç”¨çš„æ˜¯ OpenClaw 2.6ï¼Œä¸€ä¸ªå¯ä»¥7Ã—24å°æ—¶è¿è¡Œçš„AIåŠ©æ‰‹æ¡†æ¶ã€‚å®ƒå¸®æˆ‘ç®¡é€‰é¢˜ã€Twitterè¿è¥ã€æ—¥ç¨‹æé†’ï¼ŒåŸºæœ¬æ˜¯æˆ‘çš„"æ•°å­—å‘˜å·¥"ã€‚</p>
<p>é‚£å¤©æˆ‘è·‘äº†ä¸€å¥å‘½ä»¤çœ‹æœåŠ¡çŠ¶æ€ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">journalctl --user -u openclaw-gateway --since <span class="hljs-string">"3 days ago"</span> | grep <span class="hljs-string">"start"</span> | <span class="hljs-built_in">wc</span> -l
</code></pre>
<p><strong>4671ã€‚</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f832822c872f43cda0e728656bc6d388~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771224928&amp;x-signature=29wu9lRAeAx1C4j3BXef%2BBsxQZg%3D" alt="" loading="lazy"/></p>
<p>ä¸‰å¤©ï¼Œ4671æ¬¡é‡å¯ã€‚å¹³å‡æ¯5ç§’å´©ä¸€æ¬¡ï¼Œå†èµ·æ¥ï¼Œå†å´©ï¼Œæ— é™å¾ªç¯ã€‚</p>
<p>æ›´å¯æ€•çš„æ˜¯â€”â€”<strong>æˆ‘å®Œå…¨ä¸çŸ¥é“ã€‚</strong> å› ä¸ºç”¨æˆ·çº§çš„æœåŠ¡ä¸€ç›´æ­£å¸¸è·‘ç€ï¼Œè¯¥å›å¤æ¶ˆæ¯ç…§æ ·å›å¤ã€‚åªæ˜¯ cron è°ƒåº¦å™¨è¢«æä¹±äº†ï¼Œå®šæ—¶ä»»åŠ¡å…¨éƒ¨æ¼è·‘äº†3-4å¤©ã€‚</p>
<h3 data-id="heading-1"><strong>æ ¹å› ï¼šä¸¤ä¸ªåŒåæœåŠ¡æ‰“æ¶</strong></h3>
<p>æ’æŸ¥ä¸‹æ¥ï¼ŒåŸå› å‡ºå¥‡åœ°è ¢ï¼š</p>
<ul>
<li>
<p><strong>ç”¨æˆ·çº§æœåŠ¡</strong>ï¼ˆ<code>~/.config/systemd/user/openclaw-gateway.service</code>ï¼‰ï¼šæ­£å¸¸è¿è¡Œï¼Œå ç€18789ç«¯å£</p>
</li>
<li>
<p><strong>ç³»ç»Ÿçº§æœåŠ¡</strong>ï¼ˆ<code>/etc/systemd/system/openclaw-gateway.service</code>ï¼‰ï¼šæ¯5ç§’å°è¯•å¯åŠ¨ï¼Œå‘ç°ç«¯å£è¢«å ï¼Œç«‹å³é€€å‡ºï¼Œsystemd åˆæ‹‰èµ·æ¥â€¦â€¦</p>
</li>
</ul>
<p>ä¸¤ä¸ªåŒåæœåŠ¡ï¼Œä¸€ä¸ªå ç€ç«¯å£å¥½å¥½çš„ï¼Œä¸€ä¸ªç–¯ç‹‚æ’å¢™ã€‚<strong>36å°æ—¶çš„CPUç™½ç™½æµªè´¹</strong>ï¼Œcron è°ƒåº¦å™¨çš„çŠ¶æ€è¢«åå¤åˆ·ä¹±ï¼Œ<code>nextRunAtMs</code> è·³åˆ°äº†æœªæ¥æŸä¸ªä¸å­˜åœ¨çš„æ—¶é—´ã€‚</p>
<p>æ€ä¹ˆæ¥çš„ï¼Ÿå¤§æ¦‚ç‡æ˜¯æŸæ¬¡è¿è¡Œ <code>openclaw gateway install</code> æ—¶ï¼Œç³»ç»Ÿçº§å’Œç”¨æˆ·çº§å„ç”Ÿæˆäº†ä¸€ä¸ªæœåŠ¡æ–‡ä»¶ã€‚</p>
<p><strong>æ•™è®­ï¼šå‡çº§æˆ–é‡è£… OpenClaw åï¼Œè·‘ä¸€å¥ `systemctl list-units | grep openclaw` ç¡®è®¤æ²¡æœ‰é‡å¤æœåŠ¡ã€‚</strong></p>
<hr/>
<h2 data-id="heading-2"><strong>02 ä¸‰æ­¥ä¿®å¤</strong></h2>
<p>ä¿®å¤è¿‡ç¨‹åè€Œç®€å•ï¼Œ3æ¡å‘½ä»¤æå®šï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. åœæ‰å¹¶ç¦ç”¨å¤šä½™çš„ç³»ç»Ÿçº§æœåŠ¡</span>
sudo systemctl stop openclaw-gateway.service
sudo systemctl <span class="hljs-built_in">disable</span> openclaw-gateway.service

<span class="hljs-comment"># 2. åˆ é™¤ç³»ç»Ÿçº§æœåŠ¡æ–‡ä»¶ï¼ˆå»ºè®®å…ˆå¤‡ä»½ï¼‰</span>
sudo <span class="hljs-built_in">rm</span> /etc/systemd/system/openclaw-gateway.service

<span class="hljs-comment"># 3. é‡è½½ systemd</span>
sudo systemctl daemon-reload
</code></pre>
<p>ä¿ç•™ç”¨æˆ·çº§æœåŠ¡æ­£å¸¸è¿è¡Œå°±è¡Œã€‚</p>
<hr/>
<h2 data-id="heading-3"><strong>03 å…¨èº«ä½“æ£€ï¼š9é¡¹é…ç½®ä¼˜åŒ–</strong></h2>
<p>ä¿®å®Œäº‹æ•…ï¼Œæˆ‘æƒ³ï¼šéƒ½æ‹†å¼€äº†ï¼Œå¹²è„†å¯¹ç…§ OpenClaw 2.6 çš„æœ€æ–°æ–‡æ¡£åšä¸ªå…¨é¢ä½“æ£€ã€‚</p>
<p>æœ€ç»ˆè°ƒäº†9é¡¹ï¼Œæ•ˆæœæ˜¯ <strong>token è´¹ç”¨é™äº† 30-50%ï¼Œè®°å¿†ä¸å†ä¸¢å¤±ï¼Œä½“éªŒæ˜æ˜¾æå‡</strong>ã€‚</p>
<p>ä»¥ä¸‹é€æ¡è¯´ï¼Œæ¯æ¡éƒ½å¯ä»¥ç›´æ¥æŠ„ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a298be7b790444cbb58e369a08e84a1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771224928&amp;x-signature=3TIRJjLbptpjGu%2BfLpgffdmNZIc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4"><strong>â‘  contextPruningï¼šè‡ªåŠ¨è£å‰ªæ—§å†…å®¹ï¼Œçœ token</strong></h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"contextPruning"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cache-ttl"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"ttl"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"5m"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>Before</strong>ï¼šæ¯æ¬¡å¯¹è¯æŠŠæ‰€æœ‰å†å² tool è¾“å‡ºéƒ½å¸¦ä¸Šï¼Œtoken è¶ŠèŠè¶Šå¤šã€‚</p>
<p><strong>After</strong>ï¼šè¶…è¿‡5åˆ†é’Ÿçš„ tool è¾“å‡ºè‡ªåŠ¨è£å‰ªï¼Œä¸Šä¸‹æ–‡ä¿æŒç²¾ç®€ã€‚</p>
<p>è¿™ä¸€é¡¹å¤§æ¦‚èƒ½çœ <strong>20-30% çš„ token</strong>ã€‚</p>
<p>æ³¨æ„ï¼šè¿™åªå½±å“å‘ç»™ LLM çš„ä¸Šä¸‹æ–‡ï¼Œä¸ä¼šåˆ é™¤ç£ç›˜ä¸Šçš„ session å†å²ï¼ˆ.jsonl æ–‡ä»¶ä¿æŒå®Œæ•´ï¼‰ã€‚</p>
<h3 data-id="heading-5"><strong>â‘¡ compaction safeguardï¼šé˜²è®°å¿†ä¸¢å¤±</strong></h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"compaction"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"safeguard"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"memoryFlush"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>OpenClaw ä¼šåœ¨å¯¹è¯å¤ªé•¿æ—¶è‡ªåŠ¨å‹ç¼©ä¸Šä¸‹æ–‡ï¼ˆcompactionï¼‰ï¼Œä½†é»˜è®¤æ¨¡å¼ä¸‹å‹ç¼©æ—¶å¯èƒ½æŠŠé‡è¦è®°å¿†æŒ¤æ‰ã€‚</p>
<p><code>safeguard</code> æ¨¡å¼ä¼šåœ¨å‹ç¼©å‰è§¦å‘ä¸€æ¬¡"è®°å¿†åˆ·ç›˜"â€”â€”æŠŠå…³é”®ä¿¡æ¯å†™åˆ° MEMORY.mdï¼Œ<strong>ç¡®ä¿ä»€ä¹ˆéƒ½ä¸ä¸¢</strong>ã€‚</p>
<p><strong>æ²¡æœ‰è®°å¿†çš„AIåŠ©æ‰‹å°±æ˜¯ä¸ªé«˜çº§å¤è¯»æœºã€‚</strong> è¿™é¡¹å¿…å¼€ã€‚</p>
<h3 data-id="heading-6"><strong>â‘¢ subagents æ¨¡å‹é™çº§ï¼šçœ60%è´¹ç”¨</strong></h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"subagents"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"minimax/MiniMax-M2.1"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"archiveAfterMinutes"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">30</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>Before</strong>ï¼šå­ä»»åŠ¡ï¼ˆcron å®šæ—¶ä»»åŠ¡ã€åå°å¤„ç†ï¼‰é»˜è®¤ç»§æ‰¿ä¸»æ¨¡å‹ Claude Opus 4.6ï¼Œè´µã€‚</p>
<p><strong>After</strong>ï¼šå­ä»»åŠ¡ç”¨ MiniMax-M2.1ï¼Œè´¹ç”¨åªæœ‰ Opus çš„ 1/3 å·¦å³ã€‚</p>
<p>å¤§éƒ¨åˆ† cron ä»»åŠ¡ä¸éœ€è¦æœ€å¼ºæ¨¡å‹â€”â€”å‘ä¸ªæ—©æŠ¥ã€è·‘ä¸ªç›‘æ§ï¼Œå¤Ÿç”¨å°±è¡Œã€‚<strong>æŠŠå¥½é’¢ç”¨åœ¨åˆ€åˆƒä¸Šã€‚</strong></p>
<p><code>archiveAfterMinutes</code> ä»60é™åˆ°30ï¼Œå­ session æ›´å¿«å›æ”¶ï¼Œå‡å°‘å†…å­˜å ç”¨ã€‚</p>
<h3 data-id="heading-7"><strong>â‘£ heartbeat é™é¢‘ + activeHours</strong></h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"heartbeat"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"intervalMinutes"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">120</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"activeHours"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"08:00-24:00"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>Before</strong>ï¼šæ¯30åˆ†é’Ÿå¿ƒè·³ä¸€æ¬¡ï¼Œ7Ã—24å°æ—¶ä¸é—´æ–­ã€‚æ¯å¤©48æ¬¡å¿ƒè·³ã€‚</p>
<p><strong>After</strong>ï¼šæ¯2å°æ—¶ä¸€æ¬¡ï¼Œåªåœ¨æ—©8ç‚¹åˆ°æ™š12ç‚¹ã€‚æ¯å¤©8æ¬¡ã€‚</p>
<p><strong>ä¸€ä¸ªäººç¡è§‰çš„æ—¶å€™ï¼Œä¸éœ€è¦æœ‰äººæ¯30åˆ†é’Ÿæˆ³ä¸€ä¸‹çœ‹ä½ é†’æ²¡é†’ã€‚</strong></p>
<h3 data-id="heading-8"><strong>â‘¤ identityï¼šè®©AIè®¤è¯†è‡ªå·±</strong></h3>
<pre><code class="hljs language-css" lang="css">"identity": {
  "agents": {
    "<span class="hljs-selector-tag">main</span>": {
      "name": <span class="hljs-string">"å°å¢¨"</span>,
      <span class="hljs-string">"emoji"</span>: <span class="hljs-string">"ğŸˆâ¬›"</span>
    }
  }
}
</code></pre>
<p>é…äº†ä¹‹åï¼ŒAI åœ¨ç¾¤èŠé‡Œèƒ½è¯†åˆ« @å°å¢¨ ï¼Œè‡ªåŠ¨ ack reaction ä¹Ÿå¸¦ä¸Šèº«ä»½æ ‡è¯†ã€‚å°äº‹ï¼Œä½†ä½“éªŒå¥½å¾ˆå¤šã€‚</p>
<h3 data-id="heading-9"><strong>â‘¥ inbound debounceï¼šè¿ç»­æ¶ˆæ¯åˆå¹¶</strong></h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">"inbound":</span> {
  <span class="hljs-attr">"debounceMs":</span> <span class="hljs-number">3000</span>
}
</code></pre>
<p>ä½ åœ¨ Telegram è¿å‘3æ¡æ¶ˆæ¯ï¼ŒOpenClaw ä¸ä¼šè§¦å‘3æ¬¡å¤„ç†ï¼Œè€Œæ˜¯ç­‰3ç§’åˆå¹¶æˆä¸€æ¬¡ã€‚<strong>çœ tokenï¼Œä¹Ÿçœä½ ç­‰3æ¬¡å›å¤çš„æ—¶é—´ã€‚</strong></p>
<h3 data-id="heading-10"><strong>â‘¦ session resetï¼šè‡ªç„¶è¿‡æœŸ</strong></h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"session"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"resetMode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"idle"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"idleMinutes"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">240</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>4å°æ—¶æ²¡èŠå¤©å°±é‡ç½® sessionã€‚æ¯”å›ºå®šæ—¶é—´é‡ç½®æ›´è‡ªç„¶â€”â€”æ·±å¤œèŠåˆ°2ç‚¹ä¹Ÿä¸ä¼šè¢«æ‰“æ–­ã€‚</p>
<h3 data-id="heading-11"><strong>â‘§ userTimezoneï¼šæ—¶åŒºä¿®æ­£</strong></h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"userTimezone"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Asia/Shanghai"</span>
</code></pre>
<p>åˆ«å°çœ‹è¿™ä¸ªã€‚æ—¶åŒºä¸å¯¹ï¼ŒAI è¯´çš„"ä»Šå¤©""æ˜å¤©"å…¨æ˜¯ä¹±çš„ï¼Œcron ä»»åŠ¡çš„è§¦å‘æ—¶é—´ä¹Ÿä¼šåç§»ã€‚<strong>åŸºç¡€è®¾æ–½çº§çš„é…ç½®ï¼Œç¬¬ä¸€å¤©å°±è¯¥è®¾å¥½ã€‚</strong></p>
<h3 data-id="heading-12"><strong>â‘¨ cron é“¾æ¥ä¿®å¤</strong></h3>
<p>å‡çº§2.6åä¸€äº›æ—§é…ç½®æ²¡è·Ÿç€æ›´æ–°ï¼š</p>
<ul>
<li>
<p>æ–‡æ¡£ç´¢å¼•çš„ URL è¿˜æŒ‡å‘æ—§åŸŸå <code>docs.clawd.bot</code>ï¼Œæ”¹æˆäº† <code>docs.openclaw.ai</code></p>
</li>
<li>
<p>è®¤è¯ç›‘æ§çš„å‘½ä»¤è¿˜æ˜¯æ—§çš„ <code>clawdbot</code>ï¼Œæ”¹æˆäº† <code>openclaw</code></p>
</li>
</ul>
<p><strong>å‡çº§æ¡†æ¶ç‰ˆæœ¬åï¼Œä¸€å®šè¦æ£€æŸ¥ cron ä»»åŠ¡é‡Œçš„ç¡¬ç¼–ç è·¯å¾„å’Œå‘½ä»¤ã€‚</strong> è¿™ç§éšå½¢bugä¸ä¼šæŠ¥é”™ï¼Œåªæ˜¯é»˜é»˜å¤±æ•ˆã€‚</p>
<hr/>
<h2 data-id="heading-13"><strong>04 è¿›é˜¶ï¼šç”¨ QMD æ›¿ä»£é»˜è®¤è®°å¿†æœç´¢</strong></h2>
<p>åšå®ŒåŸºç¡€ä½“æ£€ï¼Œæˆ‘åˆç ”ç©¶äº†ä¸€ä¸ªç¤¾åŒºé‡Œå¾ˆå¤šäººåœ¨ç”¨çš„çœ token æ–¹æ¡ˆï¼š<strong>QMD</strong>ã€‚</p>
<p>QMD æ˜¯ä¸€ä¸ªæœ¬åœ°ä¼˜å…ˆçš„æœç´¢å·¥å…·ï¼Œç”¨ BM25 + å‘é‡ + é‡æ’åº ä¸‰é‡æœºåˆ¶æ¥æ£€ç´¢ Markdown æ–‡ä»¶ã€‚OpenClaw 2.6 åŸç”Ÿæ”¯æŒå®ƒä½œä¸ºè®°å¿†åç«¯ã€‚</p>
<h3 data-id="heading-14"><strong>ä¸ºä»€ä¹ˆè¦æ¢ï¼Ÿ</strong></h3>
<p>é»˜è®¤çš„è®°å¿†æœç´¢ç”¨è¿œç¨‹ embedding APIï¼ˆOpenAI / Gemini / Voyageï¼‰ï¼Œæ¯æ¬¡æœç´¢éƒ½è¦è°ƒä¸€æ¬¡ APIã€‚QMD è·‘åœ¨æœ¬åœ°ï¼Œ<strong>é›¶ API è´¹ç”¨ï¼Œé›¶å»¶è¿Ÿï¼Œæ•°æ®ä¸å‡ºæœºå™¨</strong>ã€‚</p>
<p>ç¤¾åŒºæœ‰äººåé¦ˆç”¨ QMD å token èŠ‚çœäº† <strong>60-97%</strong>ï¼ˆå› ä¸ºå®ƒåªæ‹‰æœ€ç›¸å…³çš„2-3å¥è¯è¿›ä¸Šä¸‹æ–‡ï¼Œè€Œä¸æ˜¯æŠŠæ•´æ®µè®°å¿†å¡è¿›å»ï¼‰ã€‚</p>
<h3 data-id="heading-15"><strong>æ€ä¹ˆé…ï¼Ÿ</strong></h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. å®‰è£… QMD</span>
bun install -g https://github.com/tobi/qmd

<span class="hljs-comment"># 2. ç¡®è®¤ qmd å‘½ä»¤å¯ç”¨</span>
qmd --version
</code></pre>
<p>ç„¶ååœ¨ OpenClaw é…ç½®é‡ŒåŠ ä¸€è¡Œï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"memory"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"backend"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"qmd"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>é‡å¯ Gateway ç”Ÿæ•ˆã€‚Markdown æ–‡ä»¶ä»ç„¶æ˜¯å”¯ä¸€çš„"çœŸç›¸æ¥æº"ï¼ŒQMD åªè´Ÿè´£æ£€ç´¢ã€‚</p>
<h3 data-id="heading-16"><strong>æ³¨æ„äº‹é¡¹</strong></h3>
<ul>
<li>
<p>QMD ç›®å‰è¿˜æ˜¯å®éªŒæ€§åŠŸèƒ½ï¼ˆexperimentalï¼‰ï¼Œå»ºè®®å…ˆåœ¨å­ agent ä¸Šæµ‹è¯•</p>
</li>
<li>
<p>éœ€è¦å•ç‹¬å®‰è£… QMD CLI</p>
</li>
<li>
<p>å¦‚æœä½ çš„è®°å¿†æ–‡ä»¶ä¸å¤šï¼ˆ&lt;50ä¸ªï¼‰ï¼Œé»˜è®¤çš„ SQLite å‘é‡æœç´¢å…¶å®ä¹Ÿå¤Ÿç”¨</p>
</li>
</ul>
<hr/>
<h2 data-id="heading-17"><strong>05 OpenClaw 2.6 è¿˜æœ‰ä»€ä¹ˆæ–°ä¸œè¥¿ï¼Ÿ</strong></h2>
<p>é¡ºå¸¦æ•´ç†ä¸€ä¸‹ 2.6 çš„å…³é”®æ›´æ–°ï¼Œå¸®ä½ åˆ¤æ–­å€¼ä¸å€¼å¾—å‡çº§ï¼š</p>
<ul>
<li>
<p><strong>æ¨¡å‹æ”¯æŒ</strong>ï¼šåŸç”Ÿæ”¯æŒ Anthropic Opus 4.6 å’Œ OpenAI Codex gpt-5.3-codex</p>
</li>
<li>
<p><strong>xAI (Grok) æ¥å…¥</strong>ï¼šå¯ä»¥ç”¨ Grok ä½œä¸º provider äº†</p>
</li>
<li>
<p><strong>Web UI token ä»ªè¡¨ç›˜</strong>ï¼šç›´æ¥çœ‹ token æ¶ˆè€—è¶‹åŠ¿</p>
</li>
<li>
<p><strong>Voyage AI åŸç”Ÿæ”¯æŒ</strong>ï¼šè®°å¿†å‘é‡æœç´¢å¤šäº†ä¸€ä¸ª embedding é€‰æ‹©</p>
</li>
<li>
<p><strong>Cron è°ƒåº¦ä¿®å¤</strong>ï¼šä¿®äº†å¥½å‡ ä¸ªå®šæ—¶ä»»åŠ¡æ¼è·‘å’Œæé†’ä¸é€è¾¾çš„ bugï¼ˆè¿™ä¸ªæˆ‘æ·±æœ‰ä½“ä¼šï¼‰</p>
</li>
<li>
<p><strong>å®‰å…¨å¢å¼º</strong>ï¼šskill/plugin ä»£ç å®‰å…¨æ‰«æï¼Œconfig.get å“åº”è‡ªåŠ¨è„±æ•</p>
</li>
<li>
<p><strong>Compaction é‡è¯•</strong>ï¼šä¸Šä¸‹æ–‡æº¢å‡ºæ—¶å…è®¸å¤šæ¬¡å‹ç¼©é‡è¯•ï¼Œä¸ä¼šç›´æ¥å´©</p>
</li>
</ul>
<p><strong>å¦‚æœä½ è¿˜åœ¨ç”¨ 2.5 æˆ–æ›´æ—©ç‰ˆæœ¬ï¼Œå¼ºçƒˆå»ºè®®å‡çº§ã€‚</strong> å°¤å…¶æ˜¯ cron è°ƒåº¦çš„ä¿®å¤ï¼Œ2.5 çš„ cron åœ¨æŸäº›åœºæ™¯ä¸‹ä¼šé»˜é»˜åœè·‘ã€‚</p>
<hr/>
<h2 data-id="heading-18"><strong>æœ€ç»ˆæ•ˆæœ</strong></h2>








































<table><thead><tr><th>æŒ‡æ ‡</th><th>Before</th><th>After</th></tr></thead><tbody><tr><td>Token è´¹ç”¨</td><td>åŸºå‡†</td><td>é™ä½ 30-50%</td></tr><tr><td>è®°å¿†ä¸¢å¤±é£é™©</td><td>æœ‰</td><td>åŸºæœ¬æ¶ˆé™¤</td></tr><tr><td>å­ä»»åŠ¡è´¹ç”¨</td><td>Opus å…¨é‡</td><td>é™ä½ 60%+</td></tr><tr><td>æ— æ•ˆå¿ƒè·³</td><td>48æ¬¡/å¤©</td><td>8æ¬¡/å¤©</td></tr><tr><td>Cron ä»»åŠ¡</td><td>æ¼è·‘3-4å¤©</td><td>å…¨éƒ¨æ¢å¤</td></tr><tr><td>è®°å¿†æœç´¢</td><td>è¿œç¨‹ API</td><td>æœ¬åœ° QMDï¼ˆå¯é€‰ï¼‰</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-19"><strong>å†™åœ¨æœ€å</strong></h2>
<p>AIåŠ©æ‰‹ä¸æ˜¯è£…å®Œå°±èƒ½è·‘ä¸€è¾ˆå­çš„ã€‚</p>
<p>å®ƒå°±åƒä¸€è¾†è½¦â€”â€”ä½ å¾—å®šæœŸä¿å…»ï¼Œæ£€æŸ¥æœºæ²¹ã€è½®èƒã€åˆ¹è½¦ã€‚ä¸ç„¶å“ªå¤©é«˜é€Ÿä¸ŠæŠ›é”šï¼Œä½ æ‰å‘ç°å‘åŠ¨æœºæ—©å°±æ‹‰ç¼¸äº†ã€‚</p>
<p>æˆ‘çš„è¿™æ¬¡"ä½“æ£€"å‘ç°äº†ä¸€ä¸ªè·‘äº†4671æ¬¡çš„éšå½¢æ•…éšœï¼Œé¡ºå¸¦ä¼˜åŒ–å‡º 30-50% çš„æˆæœ¬èŠ‚çœã€‚<strong>æ€»å…±èŠ±äº†ä¸åˆ°2å°æ—¶ã€‚</strong></p>
<p>å¦‚æœä½ ä¹Ÿåœ¨ç”¨ OpenClawï¼Œå»ºè®®ä½ ç°åœ¨å°±è·‘ä¸€å¥ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">systemctl list-units | <span class="hljs-keyword">grep</span> openclaw
</code></pre>
<p>çœ‹çœ‹æœ‰æ²¡æœ‰"å¹½çµæœåŠ¡"åœ¨å·å·æ¶ˆè€—ä½ çš„èµ„æºã€‚</p>
<p><strong>å·¥å…·ä¼šå˜å¼ºï¼Œä½†ä¸ä¼šè‡ªå·±å˜å¥½ã€‚è°ƒæ•™å®ƒçš„äººï¼Œæ‰æ˜¯çœŸæ­£çš„ç«äº‰åŠ›ã€‚</strong></p>
<hr/>
<p>å¦‚æœè¿™ç¯‡å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµã€æ”¶è—ã€å…³æ³¨ï¼Œä½ çš„æ”¯æŒæ˜¯æˆ‘æŒç»­è¾“å‡ºçš„åŠ¨åŠ› âœ¨</p>
<hr/>
<p>æˆ‘çš„å…¶ä»–å¹³å°è´¦å·å’Œå¼€æºé¡¹ç›®åœ¨ä¸ªäººä¸»é¡µä¸­ï¼Œæ¬¢è¿äº¤æµ ğŸ¤</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[BeautifulSoupï¼šPythonç½‘é¡µè§£æçš„ä¼˜é›…åˆ©å™¨]]></title>    <link>https://juejin.cn/post/7604175912481226758</link>    <guid>https://juejin.cn/post/7604175912481226758</guid>    <pubDate>2026-02-09T06:56:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604175912481226758" data-draft-id="7604155045236293667" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="BeautifulSoupï¼šPythonç½‘é¡µè§£æçš„ä¼˜é›…åˆ©å™¨"/> <meta itemprop="keywords" content="åç«¯,Python,çˆ¬è™«"/> <meta itemprop="datePublished" content="2026-02-09T06:56:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°å°å¼ è¯´æ•…äº‹"/> <meta itemprop="url" content="https://juejin.cn/user/741501567509111"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            BeautifulSoupï¼šPythonç½‘é¡µè§£æçš„ä¼˜é›…åˆ©å™¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/741501567509111/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°å°å¼ è¯´æ•…äº‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T06:56:57.000Z" title="Mon Feb 09 2026 06:56:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. åº“çš„æ¦‚è§ˆä¸æ ¸å¿ƒä»·å€¼</h2>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ é¢å¯¹ç€æˆåƒä¸Šä¸‡ä¸ªæ‚ä¹±çš„ç½‘é¡µï¼Œéœ€è¦ä»ä¸­æå–æœ‰ä»·å€¼çš„ä¿¡æ¯â€”â€”å°±åƒåœ¨ä¸€å †æ²¡æœ‰æ ‡æ³¨çš„ä¹¦ç±ä¸­å¯»æ‰¾ç‰¹å®šçš„ç« èŠ‚ã€‚å¦‚æœæ‰‹åŠ¨å»è§£æé‚£äº›å±‚å±‚åµŒå¥—ã€æ ¼å¼æ··ä¹±çš„HTMLä»£ç ï¼Œå°±åƒåœ¨æ²¡æœ‰ç´¢å¼•çš„æƒ…å†µä¸‹ç¿»é˜…æ•´ä¸ªå›¾ä¹¦é¦†ã€‚<code>BeautifulSoup</code>æ­£æ˜¯ä¸ºè§£å†³è¿™ä¸ªç—›ç‚¹è€Œç”Ÿçš„å·¥å…·ã€‚</p>
<p>BeautifulSoupï¼ˆå…¨ç§°beautifulsoup4ï¼‰æ˜¯ä¸€ä¸ªPythonåº“ï¼Œå®ƒèƒ½å¤Ÿå°†å¤æ‚çš„HTMLæˆ–XMLæ–‡æ¡£è½¬æ¢æˆä¸€ä¸ªç»“æ„åŒ–çš„æ ‘å½¢å¯¹è±¡ï¼Œè®©å¼€å‘è€…å¯ä»¥é€šè¿‡ç®€æ´çš„APIå¿«é€Ÿå®šä½å’Œæå–æ•°æ®ã€‚å®ƒåœ¨Pythonç”Ÿæ€ä¸­çš„ç‹¬ç‰¹ä»·å€¼åœ¨äºï¼š<strong>æå¼ºçš„å®¹é”™èƒ½åŠ›å’Œäººæ€§åŒ–çš„APIè®¾è®¡</strong>ã€‚å³ä½¿ç½‘é¡µä»£ç ä¸è§„èŒƒï¼ˆå¦‚æ ‡ç­¾æœªé—­åˆã€åµŒå¥—é”™è¯¯ï¼‰ï¼ŒBeautifulSoupä¹Ÿèƒ½ä¼˜é›…åœ°å¤„ç†ï¼Œè¿™åœ¨çœŸå®ä¸–ç•Œçš„ç½‘é¡µè§£æä¸­å°¤ä¸ºé‡è¦ã€‚</p>
<p>ä¸æ­£åˆ™è¡¨è¾¾å¼ç›¸æ¯”ï¼ŒBeautifulSoupä¸è¦æ±‚ä½ æŒæ¡å¤æ‚çš„æ¨¡å¼åŒ¹é…è§„åˆ™ï¼›ä¸lxmlã€Scrapyç­‰é‡å‹çˆ¬è™«æ¡†æ¶ç›¸æ¯”ï¼Œå®ƒå­¦ä¹ æ›²çº¿å¹³ç¼“ï¼Œä»£ç å¯è¯»æ€§å¼ºã€‚å¯¹äºä¸­å°å‹æ•°æ®æå–é¡¹ç›®ã€æ•™å­¦æ¼”ç¤ºæˆ–å¿«é€ŸåŸå‹å¼€å‘ï¼ŒBeautifulSoupæ˜¯å½“ä¹‹æ— æ„§çš„é¦–é€‰ã€‚</p>
<hr/>
<h2 data-id="heading-1">2. ç¯å¢ƒæ­å»ºä¸"Hello, World"</h2>
<h3 data-id="heading-2">å®‰è£…è¯´æ˜</h3>
<p>BeautifulSoupçš„å®‰è£…éå¸¸ç®€å•ï¼Œä½†æœ‰ä¸€ä¸ªå…³é”®ç‚¹éœ€è¦æ³¨æ„ï¼š<strong>æ­£ç¡®çš„åŒ…åæ˜¯<code>beautifulsoup4</code></strong>ï¼Œè€Œä¸æ˜¯<code>beautifulsoup</code>ã€‚åŒæ—¶ï¼Œå»ºè®®å®‰è£…é«˜æ•ˆçš„è§£æå™¨<code>lxml</code>ä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨pipå®‰è£…ï¼ˆæ¨èï¼‰</span>
pip install beautifulsoup4
pip install lxml

<span class="hljs-comment"># å¦‚æœä½¿ç”¨conda</span>
conda install beautifulsoup4 lxml
</code></pre>
<p><strong>å®‰è£…å¤±è´¥å¸¸è§åŸå› </strong>ï¼š</p>
<ol>
<li>é”™è¯¯ä½¿ç”¨<code>pip install beautifulsoup</code>ï¼ˆåŒ…åé”™è¯¯ï¼‰</li>
<li>ç½‘ç»œé—®é¢˜å¯¼è‡´PyPIè¿æ¥è¶…æ—¶</li>
<li>Pythonç¯å¢ƒæ··ä¹±ï¼ŒpipæŒ‡å‘é”™è¯¯çš„Pythonç‰ˆæœ¬</li>
</ol>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šä½¿ç”¨å›½å†…é•œåƒæºåŠ é€Ÿï¼Œå¦‚ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">pip install beautifulsoup4 lxml -i https://pypi.tuna.tsinghua.edu.cn/simple
</code></pre>
<h3 data-id="heading-3">Hello, World ç¤ºä¾‹</h3>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªæœ€å°å¯è¿è¡Œçš„ç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•è§£æHTMLå¹¶æå–æ ‡é¢˜ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup

<span class="hljs-comment"># åˆ›å»ºæ¨¡æ‹ŸHTMLæ–‡æ¡£</span>
html_doc = <span class="hljs-string">"""
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;BeautifulSoupå…¥é—¨ç¤ºä¾‹&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1 class="heading"&gt;æ¬¢è¿å­¦ä¹ BeautifulSoup&lt;/h1&gt;
    &lt;p id="intro"&gt;è¿™æ˜¯ç¬¬ä¸€ä¸ªæ®µè½ã€‚&lt;/p&gt;
    &lt;p&gt;è¿™æ˜¯ç¬¬äºŒä¸ªæ®µè½ã€‚&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
"""</span>

<span class="hljs-comment"># åˆ›å»ºBeautifulSoupå¯¹è±¡ï¼ŒæŒ‡å®šlxmlè§£æå™¨</span>
soup = BeautifulSoup(html_doc, <span class="hljs-string">'lxml'</span>)

<span class="hljs-comment"># æå–å¹¶æ‰“å°é¡µé¢æ ‡é¢˜</span>
<span class="hljs-built_in">print</span>(soup.title.string)
</code></pre>
<h3 data-id="heading-4">é€è¡Œè§£é‡Š</h3>
<ol>
<li><code>from bs4 import BeautifulSoup</code>ï¼šä»bs4æ¨¡å—å¯¼å…¥BeautifulSoupç±»ã€‚<code>bs4</code>æ˜¯"BeautifulSoup 4"çš„ç¼©å†™ã€‚</li>
<li><code>html_doc = "..."</code>ï¼šå®šä¹‰äº†ä¸€ä¸ªåŒ…å«HTMLç»“æ„çš„å­—ç¬¦ä¸²ï¼Œè¿™æ˜¯æˆ‘ä»¬è¦è§£æçš„åŸå§‹æ•°æ®ã€‚</li>
<li><code>soup = BeautifulSoup(html_doc, 'lxml')</code>ï¼š
<ul>
<li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦è§£æçš„HTMLå†…å®¹</li>
<li>ç¬¬äºŒä¸ªå‚æ•°<code>'lxml'</code>æŒ‡å®šä½¿ç”¨lxmlè§£æå™¨ï¼ˆé€Ÿåº¦å¿«ã€å®¹é”™æ€§å¼ºï¼‰</li>
<li>è¿”å›çš„<code>soup</code>å¯¹è±¡æ˜¯æ•´ä¸ªè§£ææ ‘çš„æ ¹èŠ‚ç‚¹</li>
</ul>
</li>
<li><code>print(soup.title.string)</code>ï¼š
<ul>
<li><code>soup.title</code>ï¼šç›´æ¥è®¿é—®titleæ ‡ç­¾ï¼Œè¿”å›ç¬¬ä¸€ä¸ª<code>&lt;title&gt;</code>å…ƒç´ </li>
<li><code>.string</code>ï¼šè·å–æ ‡ç­¾å†…çš„æ–‡æœ¬å†…å®¹</li>
</ul>
</li>
</ol>
<h3 data-id="heading-5">è¿è¡Œç»“æœ</h3>
<pre><code class="hljs">BeautifulSoupå…¥é—¨ç¤ºä¾‹
</code></pre>
<p><strong>è§£æå™¨é€‰æ‹©å»ºè®®</strong>ï¼š</p>
<ul>
<li><strong>lxml</strong>ï¼šé€Ÿåº¦æœ€å¿«ï¼Œå®¹é”™èƒ½åŠ›å¼ºï¼Œæ¨èç”¨äºç”Ÿäº§ç¯å¢ƒ</li>
<li><strong>html.parser</strong>ï¼šPythonå†…ç½®ï¼Œæ— éœ€é¢å¤–å®‰è£…ï¼Œä½†é€Ÿåº¦ä¸€èˆ¬</li>
<li><strong>html5lib</strong>ï¼šæœ€æ¥è¿‘æµè§ˆå™¨è§£ææ–¹å¼ï¼Œå®¹é”™æ€§æœ€å¼ºï¼Œä½†é€Ÿåº¦æœ€æ…¢</li>
</ul>
<hr/>
<h2 data-id="heading-6">3. æ ¸å¿ƒæ¦‚å¿µè§£æ</h2>
<p>BeautifulSoupè§£æHTMLåä¼šç”Ÿæˆ4ç±»æ ¸å¿ƒå¯¹è±¡ï¼Œç†è§£è¿™äº›æ¦‚å¿µæ˜¯ç†Ÿç»ƒä½¿ç”¨çš„åŸºç¡€ã€‚</p>
<h3 data-id="heading-7">æ ¸å¿ƒå¯¹è±¡ç±»å‹</h3>
<ol>
<li>
<p><strong>BeautifulSoupå¯¹è±¡</strong>ï¼šæ•´ä¸ªè§£ææ ‘çš„æ ¹å¯¹è±¡ï¼Œä»£è¡¨å®Œæ•´çš„HTML/XMLæ–‡æ¡£ï¼Œæ˜¯æ‰€æœ‰æ“ä½œçš„å…¥å£ç‚¹ã€‚</p>
</li>
<li>
<p><strong>Tagå¯¹è±¡</strong>ï¼šå¯¹åº”HTMLä¸­çš„æ ‡ç­¾ï¼ˆå¦‚<code>&lt;div&gt;</code>ã€<code>&lt;a&gt;</code>ã€<code>&lt;p&gt;</code>ï¼‰ï¼Œå¯ä»¥è·å–æ ‡ç­¾åã€å±æ€§å’Œæ–‡æœ¬å†…å®¹ã€‚</p>
</li>
<li>
<p><strong>NavigableStringå¯¹è±¡</strong>ï¼šæ ‡ç­¾å†…çš„çº¯æ–‡æœ¬å†…å®¹ï¼ˆä¸åŒ…å«æ ‡ç­¾æœ¬èº«ï¼‰ã€‚</p>
</li>
<li>
<p><strong>Commentå¯¹è±¡</strong>ï¼šç‰¹æ®Šçš„NavigableStringï¼Œå¯¹åº”HTMLæ³¨é‡Šï¼ˆå¦‚<code>&lt;!-- è¿™æ˜¯æ³¨é‡Š --&gt;</code>ï¼‰ã€‚</p>
</li>
</ol>
<h3 data-id="heading-8">æ¦‚å¿µå…³ç³»å›¾</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[BeautifulSoupå¯¹è±¡&lt;br/&gt;æ–‡æ¡£æ ¹èŠ‚ç‚¹] --&gt; B[Tagå¯¹è±¡&lt;br/&gt;HTMLæ ‡ç­¾]
    B --&gt; C[NavigableString&lt;br/&gt;æ ‡ç­¾å†…æ–‡æœ¬]
    B --&gt; D[Commentå¯¹è±¡&lt;br/&gt;HTMLæ³¨é‡Š]
    A --&gt; E[find/find_allæ–¹æ³•&lt;br/&gt;å®šä½Tag]
    A --&gt; F[selectæ–¹æ³•&lt;br/&gt;CSSé€‰æ‹©å™¨]
    B --&gt; G[è·å–å±æ€§&lt;br/&gt;tag.attrs/æ ‡ç­¾å]
    B --&gt; H[è·å–æ–‡æœ¬&lt;br/&gt;tag.string/get_text]
</code></pre>
<h3 data-id="heading-9">æ ¸å¿ƒæ¦‚å¿µè¯¦è§£</h3>
<p><strong>Tagå¯¹è±¡æ“ä½œ</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># è·å–æ ‡ç­¾</span>
title_tag = soup.title  <span class="hljs-comment"># è·å–ç¬¬ä¸€ä¸ªtitleæ ‡ç­¾</span>
<span class="hljs-built_in">print</span>(title_tag.name)   <span class="hljs-comment"># è¾“å‡ºæ ‡ç­¾åï¼š'title'</span>

<span class="hljs-comment"># è·å–å±æ€§</span>
link_tag = soup.a       <span class="hljs-comment"># è·å–ç¬¬ä¸€ä¸ªaæ ‡ç­¾</span>
<span class="hljs-built_in">print</span>(link_tag[<span class="hljs-string">'href'</span>]) <span class="hljs-comment"># è·å–hrefå±æ€§</span>
<span class="hljs-built_in">print</span>(link_tag.attrs)   <span class="hljs-comment"># è·å–æ‰€æœ‰å±æ€§å­—å…¸</span>

<span class="hljs-comment"># è·å–æ–‡æœ¬</span>
<span class="hljs-built_in">print</span>(title_tag.string)      <span class="hljs-comment"># è·å–æ ‡ç­¾å†…æ–‡æœ¬ï¼ˆæ— åµŒå¥—æ—¶ï¼‰</span>
<span class="hljs-built_in">print</span>(soup.h1.get_text())     <span class="hljs-comment"># è·å–æ ‡ç­¾å†…æ‰€æœ‰æ–‡æœ¬ï¼ˆå«å­æ ‡ç­¾ï¼‰</span>
</code></pre>
<p><strong>NavigableStringæ“ä½œ</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># è·å–æ ‡ç­¾å†…çš„çº¯æ–‡æœ¬</span>
text = soup.p.string  <span class="hljs-comment"># è·å–ç¬¬ä¸€ä¸ªpæ ‡ç­¾çš„æ–‡æœ¬å†…å®¹</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(text))     <span class="hljs-comment"># &lt;class 'bs4.element.NavigableString'&gt;</span>
</code></pre>
<p><strong>Commentå¯¹è±¡å¤„ç†</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> Comment

html_with_comment = <span class="hljs-string">"&lt;b&gt;&lt;!-- è¿™æ˜¯ä¸€ä¸ªæ³¨é‡Š --&gt;&lt;/b&gt;"</span>
soup_comment = BeautifulSoup(html_with_comment, <span class="hljs-string">'lxml'</span>)
comment = soup_comment.b.string

<span class="hljs-comment"># åˆ¤æ–­æ˜¯å¦ä¸ºæ³¨é‡Š</span>
<span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(comment, Comment):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"è¿™æ˜¯æ³¨é‡Šå†…å®¹:"</span>, comment)
</code></pre>
<h3 data-id="heading-10">æŸ¥æ‰¾æ–¹æ³•å¯¹æ¯”</h3>



































<table><thead><tr><th>æ–¹æ³•</th><th>ä½œç”¨</th><th>è¿”å›å€¼</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><code>soup.tagname</code></td><td>ç›´æ¥è®¿é—®</td><td>ç¬¬ä¸€ä¸ªåŒ¹é…çš„Tag</td><td>ç®€å•å¿«é€Ÿå®šä½</td></tr><tr><td><code>find(name, attrs)</code></td><td>æŸ¥æ‰¾ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹</td><td>Tagå¯¹è±¡æˆ–None</td><td>æå–å”¯ä¸€å…ƒç´ </td></tr><tr><td><code>find_all(name, attrs)</code></td><td>æŸ¥æ‰¾æ‰€æœ‰åŒ¹é…é¡¹</td><td>Tagå¯¹è±¡åˆ—è¡¨</td><td>æ‰¹é‡æå–æ•°æ®</td></tr><tr><td><code>select(css_selector)</code></td><td>CSSé€‰æ‹©å™¨</td><td>Tagå¯¹è±¡åˆ—è¡¨</td><td>ç†Ÿæ‚‰CSSè¯­æ³•æ—¶ä½¿ç”¨</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-11">4. å®æˆ˜æ¼”ç»ƒï¼šçˆ¬å–æ–°é—»ç½‘ç«™æ ‡é¢˜</h2>
<p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªçœŸå®é¡¹ç›®æ¥å·©å›ºæ‰€å­¦çŸ¥è¯†ã€‚æˆ‘ä»¬å°†æ¨¡æ‹Ÿçˆ¬å–ä¸€ä¸ªæ–°é—»ç½‘ç«™çš„æ ‡é¢˜ã€é“¾æ¥å’Œæ‘˜è¦ã€‚</p>
<h3 data-id="heading-12">éœ€æ±‚åˆ†æ</h3>
<p>æˆ‘ä»¬éœ€è¦ä»ä¸€ä¸ªæ–°é—»ç½‘é¡µä¸­æå–ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<ul>
<li>æ–°é—»æ ‡é¢˜</li>
<li>æ–°é—»é“¾æ¥</li>
<li>æ–°é—»æ‘˜è¦</li>
<li>å‘å¸ƒæ—¶é—´</li>
</ul>
<h3 data-id="heading-13">æ–¹æ¡ˆè®¾è®¡</h3>
<p>ä½¿ç”¨<code>requests</code>åº“è·å–ç½‘é¡µå†…å®¹ï¼ˆæ¨¡æ‹Ÿï¼‰ï¼Œç„¶åç”¨BeautifulSoupè§£ææ•°æ®ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<ol>
<li><code>find_all()</code>æ‰¹é‡æŸ¥æ‰¾æ–°é—»æ¡ç›®</li>
<li>CSSé€‰æ‹©å™¨å®šä½åµŒå¥—å…ƒç´ </li>
<li><code>get()</code>æ–¹æ³•æå–å±æ€§</li>
<li><code>get_text()</code>æå–æ–‡æœ¬</li>
</ol>
<h3 data-id="heading-14">å®Œæ•´ä»£ç å®ç°</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup

<span class="hljs-comment"># æ¨¡æ‹Ÿæ–°é—»ç½‘é¡µHTMLç»“æ„</span>
news_html = <span class="hljs-string">"""
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;ç§‘æŠ€æ–°é—»ç½‘&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="news-container"&gt;
        &lt;div class="news-item"&gt;
            &lt;h2 class="news-title"&gt;
                &lt;a href="https://example.com/news/1"&gt;AIæŠ€æœ¯çªç ´æ–°é‡Œç¨‹ç¢‘&lt;/a&gt;
            &lt;/h2&gt;
            &lt;p class="news-summary"&gt;äººå·¥æ™ºèƒ½åœ¨å›¾åƒè¯†åˆ«é¢†åŸŸå–å¾—é‡å¤§è¿›å±•ï¼Œå‡†ç¡®ç‡æå‡è‡³98%ã€‚&lt;/p&gt;
            &lt;span class="publish-time"&gt;2025-01-15&lt;/span&gt;
        &lt;/div&gt;
        
        &lt;div class="news-item"&gt;
            &lt;h2 class="news-title"&gt;
                &lt;a href="https://example.com/news/2"&gt;é‡å­è®¡ç®—å•†ä¸šåŒ–è¿›ç¨‹åŠ é€Ÿ&lt;/a&gt;
            &lt;/h2&gt;
            &lt;p class="news-summary"&gt;å¤šå®¶ç§‘æŠ€å·¨å¤´å®£å¸ƒé‡å­è®¡ç®—äº‘æœåŠ¡æ­£å¼ä¸Šçº¿ï¼Œæ ‡å¿—ç€é‡å­è®¡ç®—è¿›å…¥å®ç”¨é˜¶æ®µã€‚&lt;/p&gt;
            &lt;span class="publish-time"&gt;2025-01-14&lt;/span&gt;
        &lt;/div&gt;
        
        &lt;div class="news-item"&gt;
            &lt;h2 class="news-title"&gt;
                &lt;a href="https://example.com/news/3"&gt;5Gç½‘ç»œè¦†ç›–ç‡è¾¾95%&lt;/a&gt;
            &lt;/h2&gt;
            &lt;p class="news-summary"&gt;æœ€æ–°æ•°æ®æ˜¾ç¤ºï¼Œå…¨å›½5Gç½‘ç»œè¦†ç›–ç‡å·²è¶…è¿‡95%ï¼Œä¸ºç‰©è”ç½‘å‘å±•å¥ å®šåŸºç¡€ã€‚&lt;/p&gt;
            &lt;span class="publish-time"&gt;2025-01-13&lt;/span&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
"""</span>

<span class="hljs-comment"># åˆ›å»ºBeautifulSoupå¯¹è±¡</span>
soup = BeautifulSoup(news_html, <span class="hljs-string">'lxml'</span>)

<span class="hljs-comment"># æŸ¥æ‰¾æ‰€æœ‰æ–°é—»æ¡ç›®</span>
news_items = soup.find_all(<span class="hljs-string">'div'</span>, class_=<span class="hljs-string">'news-item'</span>)

<span class="hljs-comment"># éå†æå–æ¯æ¡æ–°é—»çš„ä¿¡æ¯</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"ç§‘æŠ€æ–°é—»ç½‘ - æœ€æ–°èµ„è®¯"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)

<span class="hljs-keyword">for</span> i, item <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(news_items, <span class="hljs-number">1</span>):
    <span class="hljs-comment"># æå–æ ‡é¢˜å’Œé“¾æ¥</span>
    title_tag = item.find(<span class="hljs-string">'a'</span>)
    title = title_tag.get_text(strip=<span class="hljs-literal">True</span>)
    link = title_tag.get(<span class="hljs-string">'href'</span>)
    
    <span class="hljs-comment"># æå–æ‘˜è¦</span>
    summary_tag = item.find(<span class="hljs-string">'p'</span>, class_=<span class="hljs-string">'news-summary'</span>)
    summary = summary_tag.get_text(strip=<span class="hljs-literal">True</span>) <span class="hljs-keyword">if</span> summary_tag <span class="hljs-keyword">else</span> <span class="hljs-string">"æ— æ‘˜è¦"</span>
    
    <span class="hljs-comment"># æå–å‘å¸ƒæ—¶é—´</span>
    time_tag = item.find(<span class="hljs-string">'span'</span>, class_=<span class="hljs-string">'publish-time'</span>)
    publish_time = time_tag.get_text(strip=<span class="hljs-literal">True</span>) <span class="hljs-keyword">if</span> time_tag <span class="hljs-keyword">else</span> <span class="hljs-string">"æœªçŸ¥æ—¶é—´"</span>
    
    <span class="hljs-comment"># è¾“å‡ºç»“æœ</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\næ–°é—» <span class="hljs-subst">{i}</span>:"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ ‡é¢˜: <span class="hljs-subst">{title}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"é“¾æ¥: <span class="hljs-subst">{link}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ‘˜è¦: <span class="hljs-subst">{summary}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å‘å¸ƒæ—¶é—´: <span class="hljs-subst">{publish_time}</span>"</span>)

<span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"å…±æå– <span class="hljs-subst">{<span class="hljs-built_in">len</span>(news_items)}</span> æ¡æ–°é—»"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
</code></pre>
<h3 data-id="heading-15">è¿è¡Œè¯´æ˜</h3>
<p>å°†ä¸Šè¿°ä»£ç ä¿å­˜ä¸ºPythonæ–‡ä»¶å¹¶è¿è¡Œï¼Œä½ ä¼šçœ‹åˆ°æ ¼å¼åŒ–çš„æ–°é—»åˆ—è¡¨è¾“å‡ºã€‚æ¯ä¸ªæ–°é—»æ¡ç›®éƒ½åŒ…å«æ ‡é¢˜ã€é“¾æ¥ã€æ‘˜è¦å’Œå‘å¸ƒæ—¶é—´ã€‚</p>
<p><strong>ä»£ç äº®ç‚¹</strong>ï¼š</p>
<ol>
<li>ä½¿ç”¨<code>class_='news-item'</code>æŸ¥æ‰¾æ‰€æœ‰æ–°é—»å®¹å™¨ï¼ˆæ³¨æ„<code>class_</code>çš„ä¸‹åˆ’çº¿é¿å…å…³é”®å­—å†²çªï¼‰</li>
<li>ä½¿ç”¨<code>.get_text(strip=True)</code>å»é™¤æ–‡æœ¬ä¸­çš„å¤šä½™ç©ºæ ¼å’Œæ¢è¡Œ</li>
<li>ä½¿ç”¨<code>.get('href')</code>å®‰å…¨è·å–å±æ€§ï¼Œé¿å…å±æ€§ä¸å­˜åœ¨æ—¶æŠ¥é”™</li>
<li>ä½¿ç”¨æ¡ä»¶åˆ¤æ–­å¤„ç†å¯èƒ½ç¼ºå¤±çš„å…ƒç´ ï¼Œå¢å¼ºä»£ç å¥å£®æ€§</li>
</ol>
<hr/>
<h2 data-id="heading-16">5. æœ€ä½³å®è·µä¸å¸¸è§é™·é˜±</h2>
<h3 data-id="heading-17">å¸¸è§é”™è¯¯åŠè§„é¿æ–¹æ³•</h3>
<p><strong>é”™è¯¯1ï¼šç›´æ¥ä½¿ç”¨<code>class</code>ä½œä¸ºå‚æ•°</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># âŒ é”™è¯¯åšæ³•</span>
soup.find_all(<span class="hljs-string">'div'</span>, <span class="hljs-keyword">class</span>=<span class="hljs-string">'content'</span>)  <span class="hljs-comment"># SyntaxError</span>

<span class="hljs-comment"># âœ… æ­£ç¡®åšæ³•</span>
soup.find_all(<span class="hljs-string">'div'</span>, class_=<span class="hljs-string">'content'</span>)  <span class="hljs-comment"># åŠ ä¸‹åˆ’çº¿é¿å…å…³é”®å­—å†²çª</span>
</code></pre>
<p><strong>é”™è¯¯2ï¼šå±æ€§ä¸å­˜åœ¨æ—¶ç›´æ¥è®¿é—®</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># âŒ é”™è¯¯åšæ³•</span>
link = soup.a[<span class="hljs-string">'href'</span>]  <span class="hljs-comment"># å¦‚æœaæ ‡ç­¾æ²¡æœ‰hrefå±æ€§ä¼šæŠ¥é”™</span>

<span class="hljs-comment"># âœ… æ­£ç¡®åšæ³•</span>
link = soup.a.get(<span class="hljs-string">'href'</span>)  <span class="hljs-comment"># å±æ€§ä¸å­˜åœ¨è¿”å›Noneï¼Œå®‰å…¨</span>
link = soup.a.get(<span class="hljs-string">'href'</span>, <span class="hljs-string">'#'</span>)  <span class="hljs-comment"># å¯è®¾ç½®é»˜è®¤å€¼</span>
</code></pre>
<p><strong>é”™è¯¯3ï¼šæ··æ·†stringå’Œget_text()</strong></p>
<pre><code class="hljs language-python" lang="python">html = <span class="hljs-string">"&lt;p&gt;Hello &lt;b&gt;World&lt;/b&gt;&lt;/p&gt;"</span>
soup = BeautifulSoup(html, <span class="hljs-string">'lxml'</span>)

<span class="hljs-comment"># âŒ é”™è¯¯ç†è§£</span>
<span class="hljs-built_in">print</span>(soup.p.string)  <span class="hljs-comment"># è¾“å‡ºNoneï¼Œå› ä¸ºæœ‰åµŒå¥—æ ‡ç­¾</span>

<span class="hljs-comment"># âœ… æ­£ç¡®åšæ³•</span>
<span class="hljs-built_in">print</span>(soup.p.get_text())  <span class="hljs-comment"># è¾“å‡ºï¼šHello World</span>
</code></pre>
<p><strong>é”™è¯¯4ï¼šå¿˜è®°æŒ‡å®šè§£æå™¨</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># âŒ ä¸æ¨èï¼šä¾èµ–é»˜è®¤è§£æå™¨</span>
soup = BeautifulSoup(html_doc)

<span class="hljs-comment"># âœ… æ¨èï¼šæ˜ç¡®æŒ‡å®šè§£æå™¨</span>
soup = BeautifulSoup(html_doc, <span class="hljs-string">'lxml'</span>)
</code></pre>
<h3 data-id="heading-18">æœ€ä½³å®è·µå»ºè®®</h3>
<ol>
<li>
<p><strong>é€‰æ‹©åˆé€‚çš„è§£æå™¨</strong></p>
<ul>
<li>ç”Ÿäº§ç¯å¢ƒä½¿ç”¨<code>lxml</code>ï¼ˆé€Ÿåº¦+å®¹é”™ï¼‰</li>
<li>å¼€å‘æµ‹è¯•å¯ç”¨<code>html.parser</code>ï¼ˆæ— éœ€å®‰è£…ï¼‰</li>
<li>ç‰¹æ®Šåœºæ™¯ç”¨<code>html5lib</code>ï¼ˆå®¹é”™æ€§æœ€å¼ºï¼‰</li>
</ul>
</li>
<li>
<p><strong>ä½¿ç”¨CSSé€‰æ‹©å™¨æé«˜æ•ˆç‡</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ä¼ ç»Ÿæ–¹æ³•</span>
div.find(<span class="hljs-string">'div'</span>, class_=<span class="hljs-string">'container'</span>).find_all(<span class="hljs-string">'a'</span>)

<span class="hljs-comment"># CSSé€‰æ‹©å™¨ï¼ˆæ›´ç®€æ´ï¼‰</span>
soup.select(<span class="hljs-string">'.container a'</span>)
</code></pre>
</li>
<li>
<p><strong>å¤„ç†ä¸­æ–‡ç¼–ç </strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># è¯»å–æ–‡ä»¶æ—¶æŒ‡å®šç¼–ç </span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'page.html'</span>, <span class="hljs-string">'r'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:
    soup = BeautifulSoup(f, <span class="hljs-string">'lxml'</span>)
</code></pre>
</li>
<li>
<p><strong>å¼‚å¸¸å¤„ç†</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">try</span>:
    title = soup.title.string
<span class="hljs-keyword">except</span> AttributeError:
    title = <span class="hljs-string">"æ— æ ‡é¢˜"</span>
</code></pre>
</li>
<li>
<p><strong>æ€§èƒ½ä¼˜åŒ–</strong></p>
<ul>
<li>ä½¿ç”¨<code>limit</code>å‚æ•°é™åˆ¶è¿”å›æ•°é‡ï¼š<code>find_all('a', limit=10)</code></li>
<li>åªåœ¨å¿…è¦æ—¶è°ƒç”¨<code>prettify()</code>ï¼ˆæ ¼å¼åŒ–è¾“å‡ºè€—æ—¶ï¼‰</li>
<li>å¤§æ–‡æ¡£è€ƒè™‘åˆ†å—è§£æ</li>
</ul>
</li>
</ol>
<h3 data-id="heading-19">æ³¨æ„äº‹é¡¹</h3>
<ol>
<li><strong>BeautifulSoupåªèƒ½è§£æé™æ€HTML</strong>ï¼Œå¯¹äºJavaScriptåŠ¨æ€æ¸²æŸ“çš„å†…å®¹ï¼Œéœ€é…åˆSeleniumæˆ–Playwright</li>
<li><strong>å®ƒä¸è´Ÿè´£ä¸‹è½½ç½‘é¡µ</strong>ï¼Œéœ€ç»“åˆrequestsã€urllibç­‰ç½‘ç»œåº“ä½¿ç”¨</li>
<li><strong>éµå®ˆç½‘ç«™çš„robots.txtåè®®</strong>ï¼Œåˆç†è®¾ç½®è¯·æ±‚é¢‘ç‡ï¼Œé¿å…ç»™æœåŠ¡å™¨é€ æˆå‹åŠ›</li>
<li><strong>æ³¨æ„åçˆ¬è™«æœºåˆ¶</strong>ï¼Œé€‚å½“æ·»åŠ User-Agentç­‰è¯·æ±‚å¤´</li>
</ol>
<hr/>
<h2 data-id="heading-20">6. è¿›é˜¶æŒ‡å¼•</h2>
<h3 data-id="heading-21">é«˜çº§åŠŸèƒ½</h3>
<p>BeautifulSoupé™¤äº†åŸºç¡€çš„æ•°æ®æå–ï¼Œè¿˜æä¾›äº†å¼ºå¤§çš„ä¿®æ”¹åŠŸèƒ½ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ä¿®æ”¹æ ‡ç­¾å†…å®¹</span>
soup.title.string = <span class="hljs-string">"æ–°æ ‡é¢˜"</span>

<span class="hljs-comment"># æ·»åŠ æ–°æ ‡ç­¾</span>
new_tag = soup.new_tag(<span class="hljs-string">'div'</span>)
new_tag[<span class="hljs-string">'class'</span>] = <span class="hljs-string">'new-item'</span>
soup.body.append(new_tag)

<span class="hljs-comment"># åˆ é™¤æ ‡ç­¾</span>
soup.p.decompose()  <span class="hljs-comment"># å½»åº•åˆ é™¤æ ‡ç­¾åŠå…¶å†…å®¹</span>
soup.p.extract()    <span class="hljs-comment"># ä»æ–‡æ¡£ä¸­ç§»é™¤å¹¶è¿”å›è¯¥æ ‡ç­¾</span>
</code></pre>
<h3 data-id="heading-22">ç”Ÿæ€æ‰©å±•</h3>
<p>ç»“åˆå…¶ä»–åº“æ„å»ºå®Œæ•´çš„æ•°æ®é‡‡é›†ç³»ç»Ÿï¼š</p>
<ul>
<li><strong>requests/httpx</strong>ï¼šå‘é€HTTPè¯·æ±‚è·å–ç½‘é¡µ</li>
<li><strong>Selenium/Playwright</strong>ï¼šå¤„ç†åŠ¨æ€JavaScriptæ¸²æŸ“</li>
<li><strong>pandas</strong>ï¼šå°†æå–çš„æ•°æ®ä¿å­˜ä¸ºCSV/Excel</li>
<li><strong>sqlite3</strong>ï¼šå°†æ•°æ®å­˜å‚¨åˆ°æ•°æ®åº“</li>
</ul>
<h3 data-id="heading-23">å­¦ä¹ è·¯å¾„</h3>
<ol>
<li><strong>åˆçº§é˜¶æ®µ</strong>ï¼šæŒæ¡åŸºæœ¬çš„æ ‡ç­¾æŸ¥æ‰¾å’Œå±æ€§æå–</li>
<li><strong>ä¸­çº§é˜¶æ®µ</strong>ï¼šç†Ÿç»ƒä½¿ç”¨CSSé€‰æ‹©å™¨å’Œæ–‡æ¡£æ ‘éå†</li>
<li><strong>é«˜çº§é˜¶æ®µ</strong>ï¼šå­¦ä¹ ä¿®æ”¹æ–‡æ¡£æ ‘ã€å¤„ç†å¤æ‚åµŒå¥—ç»“æ„</li>
<li><strong>å®æˆ˜åº”ç”¨</strong>ï¼šç»“åˆrequestså®Œæˆå®Œæ•´çˆ¬è™«é¡¹ç›®</li>
</ol>
<h3 data-id="heading-24">æ¨èèµ„æº</h3>
<ul>
<li><strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fbeautiful-soup.readthedocs.io%2F%25EF%25BC%2588%25E6%259C%2580%25E6%259D%2583%25E5%25A8%2581%25E7%259A%2584%25E5%258F%2582%25E8%2580%2583%25EF%25BC%2589" target="_blank" title="https://beautiful-soup.readthedocs.io/%EF%BC%88%E6%9C%80%E6%9D%83%E5%A8%81%E7%9A%84%E5%8F%82%E8%80%83%EF%BC%89" ref="nofollow noopener noreferrer">beautiful-soup.readthedocs.io/ï¼ˆæœ€æƒå¨çš„å‚è€ƒï¼‰</a></li>
<li><strong>GitHubä»“åº“</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacelessuser%2FBeautifulSoup4" target="_blank" title="https://github.com/facelessuser/BeautifulSoup4" ref="nofollow noopener noreferrer">github.com/facelessuseâ€¦</a></li>
<li><strong>å®æˆ˜é¡¹ç›®</strong>ï¼šå°è¯•çˆ¬å–è±†ç“£ç”µå½±Top250ã€çŸ¥ä¹çƒ­æ¦œç­‰ç½‘ç«™</li>
</ul>
<p>BeautifulSoupæ˜¯Pythonç½‘é¡µè§£æé¢†åŸŸçš„"ç‘å£«å†›åˆ€"ï¼ŒæŒæ¡äº†å®ƒï¼Œä½ å°±æ‹¥æœ‰äº†ä»ç½‘é¡µä¸­æå–æ•°æ®çš„å¼ºå¤§èƒ½åŠ›ã€‚æ— è®ºæ˜¯æ•°æ®é‡‡é›†ã€å†…å®¹åˆ†æï¼Œè¿˜æ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå®ƒéƒ½èƒ½æˆä¸ºä½ å¾—åŠ›çš„åŠ©æ‰‹ã€‚ä¿æŒç»ƒä¹ ï¼Œä¸æ–­æ¢ç´¢ï¼Œä½ å°†å‘ç°æ›´å¤šç²¾å½©çš„åº”ç”¨åœºæ™¯ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[PostgreSQL åˆ†åŒºè¡¨çš„ ALTER TABLE è¯­å¥æ‰§è¡Œæœºåˆ¶è§£æ]]></title>    <link>https://juejin.cn/post/7604175912481193990</link>    <guid>https://juejin.cn/post/7604175912481193990</guid>    <pubDate>2026-02-09T06:54:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604175912481193990" data-draft-id="7604279756598870052" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="PostgreSQL åˆ†åŒºè¡¨çš„ ALTER TABLE è¯­å¥æ‰§è¡Œæœºåˆ¶è§£æ"/> <meta itemprop="keywords" content="PostgreSQL,å¼€æº,æ•°æ®åº“"/> <meta itemprop="datePublished" content="2026-02-09T06:54:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IvorySQL"/> <meta itemprop="url" content="https://juejin.cn/user/761327331579511"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            PostgreSQL åˆ†åŒºè¡¨çš„ ALTER TABLE è¯­å¥æ‰§è¡Œæœºåˆ¶è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/761327331579511/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IvorySQL
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T06:54:11.000Z" title="Mon Feb 09 2026 06:54:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åˆ†åŒºè¡¨æ˜¯ PostgreSQL çš„æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€ï¼Œä½†æœ‰ä¸€ä¸ªé—®é¢˜å³ä¾¿èµ„æ·±ç”¨æˆ·ä¹Ÿå¸¸ä¼šäº§ç”Ÿå›°æƒ‘ï¼š</p>
<blockquote>
<p>åœ¨æ¶‰åŠåˆ†åŒºæ—¶ï¼ŒALTER TABLE è¯­å¥çš„å…·ä½“æ‰§è¡Œé€»è¾‘æ˜¯æ€æ ·çš„ï¼Ÿ</p>
</blockquote>
<p>æ“ä½œæ˜¯å¦ä¼šåŒæ­¥è‡³å„åˆ†åŒºï¼Ÿæ˜¯å¦å¯¹æ–°å»ºåˆ†åŒºç”Ÿæ•ˆï¼Ÿ<code>ONLY</code> å…³é”®å­—æ˜¯å¦å®ç°é¢„æœŸæ•ˆæœï¼Ÿä¸ºä½•éƒ¨åˆ†å‘½ä»¤å¯åœ¨ä¸»è¡¨æ‰§è¡Œå´æ— æ³•åœ¨åˆ†åŒºæ‰§è¡Œï¼Œæˆ–åä¹‹ï¼Ÿ</p>
<p>å½“å‰ PostgreSQL å®˜æ–¹æ–‡æ¡£å¯¹å•ä¸ª <code>ALTER TABLE</code> å­å‘½ä»¤çš„è¯´æ˜è¾ƒä¸ºå®Œå–„ï¼Œä½†å¾ˆå°‘ç³»ç»Ÿæ€§åœ°è§£é‡Šå®ƒä»¬åœ¨åˆ†åŒºè¡¨åœºæ™¯ä¸‹çš„æ•´ä½“è¡Œä¸ºã€‚è¿™å¯¼è‡´çœŸå®è¡Œä¸ºå¾€å¾€åªèƒ½é€šè¿‡åå¤è¯•éªŒæ‰èƒ½è¢«å‘ç°ã€‚</p>
<p>æœ¬æ–‡åŸºäºä¸€æ¬¡ç³»ç»Ÿæ€§éªŒè¯ï¼Œæ€»ç»“äº† <code>ALTER TABLE</code> åœ¨åˆ†åŒºè¡¨ä¸Šçš„è¡Œä¸ºè§„å¾‹ï¼Œå°†é›¶æ•£è§„åˆ™å½’çº³ä¸ºä¸€å¥—ç»Ÿä¸€çš„åˆ†ç±»æ¨¡å‹ã€‚</p>
<h2 data-id="heading-0">é—®é¢˜æœ¬è´¨ï¼šâ€œä¸ä¸€è‡´â€å¹¶ä¸ç­‰åŒäºâ€œæœªå®šä¹‰â€</h2>
<p>åœ¨ PostgreSQL ç¤¾åŒºä¸­ï¼Œ<code>ALTER TABLE</code> åœ¨åˆ†åŒºè¡¨ä¸Šçš„è¡Œä¸ºå¸¸è¢«æè¿°ä¸ºâ€œä¸ä¸€è‡´â€ã€‚å®é™…ä¸Šï¼Œæ›´æ·±å±‚çš„é—®é¢˜åœ¨äºï¼š</p>
<ul>
<li>è¡Œä¸ºè§„åˆ™æ˜¯å­˜åœ¨çš„ï¼›</li>
<li>ä½†è§„åˆ™åˆ†æ•£åœ¨ä¸åŒçš„ä»£ç è·¯å¾„ã€æŠ¥é”™ä¿¡æ¯ä»¥åŠå†å²è®¾è®¡å†³ç­–ä¸­ï¼›</li>
<li>ä¸”æœªä»¥å¯é¢„æµ‹ç»“æœçš„æ–¹å¼è¿›è¡Œæ–‡æ¡£åŒ–è¯´æ˜ã€‚</li>
</ul>
<p>åœ¨ç¼ºä¹æ¸…æ™°è®¤çŸ¥æ¨¡å‹çš„æƒ…å†µä¸‹ï¼Œå³ä¾¿æ˜¯ç®€å•é—®é¢˜ä¹Ÿéš¾ä»¥å›ç­”ï¼š</p>
<ul>
<li>åœ¨çˆ¶åˆ†åŒºè¡¨ä¸Šæ‰§è¡Œæ“ä½œåï¼Œç°æœ‰åˆ†åŒºä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</li>
<li>åç»­æ–°å»ºçš„åˆ†åŒºæ˜¯å¦ä¼šç»§æ‰¿ç›¸å…³è®¾ç½®ï¼Ÿ</li>
<li><code>ONLY</code> æ˜¯å¦èƒ½å¤Ÿé˜»æ­¢ä¼ æ’­ï¼Œè¿˜æ˜¯ä¼šè¢«ç›´æ¥å¿½ç•¥ï¼Ÿ</li>
<li>èƒ½å¦ä¸ºå•ä¸ªåˆ†åŒºå•ç‹¬è¦†ç›–ç›¸å…³é…ç½®ï¼Ÿ</li>
</ul>
<h2 data-id="heading-1">ALTER TABLE å­å‘½ä»¤çš„éªŒè¯æ–¹æ³•</h2>
<p>ä¸ºå˜æ¸…ä¸Šè¿°é—®é¢˜ï¼Œæœ¬æ¬¡ç ”ç©¶é’ˆå¯¹æ‰€æœ‰ ALTER TABLE å­å‘½ä»¤ï¼Œåœ¨åˆ†åŒºè¡¨åœºæ™¯ä¸‹é‡‡ç”¨ç»Ÿä¸€çš„é—®é¢˜æ¡†æ¶å¼€å±•æµ‹è¯•éªŒè¯ã€‚</p>
<h3 data-id="heading-2">å››ä¸ªè¯„ä¼°ç»´åº¦</h3>
<p>é’ˆå¯¹æ¯ä¸ªå­å‘½ä»¤ï¼Œå‡å›´ç»•ä»¥ä¸‹å››ä¸ªæ ¸å¿ƒé—®é¢˜å±•å¼€éªŒè¯ï¼š</p>
<ol>
<li>ä¼ æ’­æ€§ï¼ˆPropagationï¼‰
åœ¨çˆ¶åˆ†åŒºè¡¨ä¸Šæ‰§è¡Œæ“ä½œåï¼Œæ˜¯å¦ä¼šä¼ æ’­åˆ°å·²æœ‰åˆ†åŒºï¼Ÿ</li>
<li>æ–°åˆ†åŒºç»§æ‰¿æ€§ï¼ˆInheritance for new partitionsï¼‰
åç»­æ–°å»ºçš„åˆ†åŒºæ˜¯å¦ä¼šç»§æ‰¿çˆ¶è¡¨çš„è®¾ç½®ï¼Ÿ</li>
<li>ONLY çš„å½±å“ï¼ˆEffect of <code>ONLY</code>ï¼‰
<code>ONLY parent_table</code> æ˜¯å¦å¦‚æ–‡æ¡£æ‰€è¿°ï¼Œèƒ½å¤Ÿé˜»æ­¢æ“ä½œä¼ æ’­ï¼Ÿ</li>
<li>ç‹¬ç«‹æ€§ï¼ˆIndependenceï¼‰
çˆ¶è¡¨ä¸å„ä¸ªåˆ†åŒºæ˜¯å¦å¯ä»¥æ‹¥æœ‰ä¸åŒçš„é…ç½®å€¼ï¼Ÿ</li>
</ol>
<p>é€šè¿‡è¿™å››ä¸ªç»´åº¦ï¼Œå¯ä»¥å°†æ¨¡ç³Šçš„â€œä¸ä¸€è‡´â€è½¬åŒ–ä¸ºæ˜ç¡®ã€å¯éªŒè¯çš„è¡Œä¸ºç‰¹å¾ã€‚</p>
<h3 data-id="heading-3">èŒƒå›´ä¸ç‰ˆæœ¬è¯´æ˜</h3>
<p>æœ¬åˆ†æåŸºäº PostgreSQL 18 çš„å¼€å‘ç‰ˆæœ¬è¡Œä¸ºï¼ˆæˆªè‡³ 2026 å¹´åˆï¼‰ã€‚æ‰€æœ‰ç»“è®ºå‡åœ¨ PostgreSQL 18 ä¸ŠéªŒè¯ã€‚éƒ¨åˆ†ç»†èŠ‚åœ¨æ—©æœŸç‰ˆæœ¬ä¸­å¯èƒ½å­˜åœ¨å·®å¼‚ï¼Œæœªæ¥ç‰ˆæœ¬ä¹Ÿå¯èƒ½éšç€åˆ†åŒºæœºåˆ¶çš„æ¼”è¿›è€Œå‘ç”Ÿå˜åŒ–ã€‚</p>
<h2 data-id="heading-4">åˆ†åŒºè¡¨ä¸Š ALTER TABLE çš„åˆ†ç±»æ¨¡å‹</h2>
<p>åŸºäºä¸Šè¿°è¯„ä¼°ç»´åº¦ï¼Œ<code>ALTER TABLE</code> çš„å­å‘½ä»¤å¯è‡ªç„¶åˆ’åˆ†ä¸º 15 ç±»ï¼Œæ¯ä¸€ç±»å¯¹åº”ä¸€ç§æ˜ç¡®çš„è¡Œä¸ºæ¨¡å¼ã€‚</p>
<p>è¯¥åˆ†ç±»ä»…ä½œä¸ºæ‰§è¡Œé€»è¾‘çš„å‚è€ƒä¾æ®ï¼Œè€Œéä»·å€¼åˆ¤æ–­ã€‚</p>
<h3 data-id="heading-5">C1 â€“ ä»…ä½œç”¨äºçˆ¶è¡¨çš„ç»“æ„æ€§å˜æ›´</h3>
<p>æ­¤ç±»ç‰¹å¾å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä»…å¯åœ¨åˆ†åŒºè¡¨ä¸Šä½¿ç”¨ï¼›</li>
<li>åœ¨åˆ†åŒºä¸Šæ‰§è¡Œä¼šå¤±è´¥ï¼›</li>
<li>ä¸æ”¯æŒ <code>ONLY</code> å…³é”®å­—ã€‚</li>
</ul>
<p>åŒ…å«çš„å­å‘½ä»¤ï¼š</p>
<ul>
<li><code>ADD COLUMN</code>ï¼ˆæ·»åŠ åˆ—ï¼‰</li>
<li><code>DROP COLUMN</code>ï¼ˆåˆ é™¤åˆ—ï¼‰</li>
<li><code>SET DATA TYPE</code>ï¼ˆä¿®æ”¹æ•°æ®ç±»å‹ï¼‰</li>
<li><code>DROP EXPRESSION</code>ï¼ˆåˆ é™¤è¡¨è¾¾å¼ï¼‰</li>
<li><code>ADD GENERATED AS IDENTITY</code>ï¼ˆæ·»åŠ è‡ªå¢æ ‡è¯†åˆ—ï¼‰</li>
<li><code>ADD GENERATED</code>ï¼ˆæ·»åŠ ç”Ÿæˆåˆ—ï¼‰</li>
<li><code>SET sequence_option</code>ï¼ˆè®¾ç½®åºåˆ—å‚æ•°ï¼‰</li>
<li><code>RESTART</code>ï¼ˆé‡å¯åºåˆ—ï¼‰</li>
<li><code>ALTER CONSTRAINT</code>ï¼ˆä¿®æ”¹çº¦æŸï¼‰</li>
</ul>
<p>æ­¤ç±»å‘½ä»¤ç”¨äºå®šä¹‰åˆ†åŒºè¡¨çš„æ•´ä½“ç»“æ„ï¼Œå¿…é¡»ä¿æŒå…¨å±€ä¸€è‡´æ€§ã€‚</p>
<h3 data-id="heading-6">C2 â€“ å¯ä¼ æ’­ä¸”å¯ç»§æ‰¿çš„å˜æ›´</h3>
<p>æ­¤ç±»ç‰¹å¾å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä»çˆ¶è¡¨ä¼ æ’­è‡³æ‰€æœ‰å·²æœ‰åˆ†åŒºï¼›</li>
<li>éµå¾ª <code>ONLY</code> å…³é”®å­—çš„ä½œç”¨è§„åˆ™ï¼›</li>
<li>æ–°å»ºåˆ†åŒºä¼šç»§æ‰¿ä¸»è¡¨çš„ç›¸å…³é…ç½®ï¼›</li>
<li>æ”¯æŒä¸ºå•ä¸ªåˆ†åŒºå•ç‹¬è¦†ç›–é…ç½®ã€‚</li>
</ul>
<p>åŒ…å«çš„å­å‘½ä»¤ï¼š</p>
<ul>
<li><code>SET DEFAULT</code>ï¼ˆè®¾ç½®é»˜è®¤å€¼ï¼‰</li>
<li><code>DROP DEFAULT</code>ï¼ˆåˆ é™¤é»˜è®¤å€¼ï¼‰</li>
<li><code>SET EXPRESSION AS</code>ï¼ˆè®¾ç½®è¡¨è¾¾å¼ï¼‰</li>
<li><code>SET STORAGE</code>ï¼ˆè®¾ç½®å­˜å‚¨å‚æ•°ï¼‰</li>
<li><code>DROP CONSTRAINT</code>ï¼ˆåˆ é™¤çº¦æŸï¼‰</li>
<li><code>ENABLE/DISABLE TRIGGER</code>ï¼ˆå¯ç”¨ / ç¦ç”¨è§¦å‘å™¨ï¼‰</li>
</ul>
<p>è¿™æ˜¯å¤šæ•°åœºæ™¯ä¸‹å¯¹ ALTER TABLE è¡Œä¸ºçš„ç›´è§‚é¢„æœŸã€‚</p>
<h3 data-id="heading-7">C3 â€“ å¯ä¼ æ’­ä½†ä¸æ”¯æŒæ–°åˆ†åŒºç»§æ‰¿</h3>
<p>æ­¤ç±»åˆ«ä»…åŒ…å«ä¸€ä¸ªå­å‘½ä»¤ï¼š</p>
<ul>
<li><code>SET STATISTICS</code>ï¼ˆè®¾ç½®ç»Ÿè®¡ä¿¡æ¯å‚æ•°ï¼‰</li>
</ul>
<p>æ‰§è¡Œé€»è¾‘ä¸ C2 ç±»åŸºæœ¬ä¸€è‡´ï¼ŒåŒºåˆ«åœ¨äºæ“ä½œä»…åŒæ­¥è‡³ç°æœ‰åˆ†åŒºï¼Œå¯¹åç»­æ–°å»ºåˆ†åŒºä¸ç”Ÿæ•ˆã€‚è‹¥é»˜è®¤è®¤ä¸ºé…ç½®å¯è‡ªåŠ¨ç»§æ‰¿ï¼Œè¯¥ç‰¹æ€§æ˜“å¼•å‘ä½¿ç”¨åå·®ã€‚</p>
<h3 data-id="heading-8">C4 â€“ çˆ¶è¡¨ä¸åˆ†åŒºå®Œå…¨ç‹¬ç«‹</h3>
<p>æ­¤ç±»ç‰¹å¾å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä¸ä¼ æ’­ï¼›</li>
<li>ä¸ç»§æ‰¿ï¼›</li>
<li>å…è®¸çˆ¶è¡¨ä¸åˆ†åŒºè®¾ç½®ä¸åŒå€¼ï¼›</li>
<li>æ”¯æŒ <code>ONLY</code> å…³é”®å­—ï¼Œä½†æ— å®é™…æ‰§è¡Œæ•ˆæœã€‚</li>
</ul>
<p>åŒ…å«çš„å­å‘½ä»¤ï¼š</p>
<ul>
<li><code>SET/RESET (attribute_option = value)</code>ï¼ˆè®¾ç½® / é‡ç½®å±æ€§å‚æ•°ï¼‰</li>
<li><code>ENABLE/DISABLE [REPLICA | ALWAYS] RULE</code>ï¼ˆå¯ç”¨ / ç¦ç”¨å¤åˆ¶ / æ°¸ä¹…è§„åˆ™ï¼‰</li>
<li><code>ENABLE/DISABLE ROW LEVEL SECURITY</code>ï¼ˆå¯ç”¨ / ç¦ç”¨è¡Œçº§å®‰å…¨ç­–ç•¥ï¼‰</li>
<li><code>NO FORCE / FORCE ROW LEVEL SECURITY</code>ï¼ˆä¸å¼ºåˆ¶ / å¼ºåˆ¶è¡Œçº§å®‰å…¨ç­–ç•¥ï¼‰</li>
<li><code>OWNER TO</code>ï¼ˆä¿®æ”¹è¡¨å±ä¸»ï¼‰</li>
<li><code>REPLICA IDENTITY</code>ï¼ˆè®¾ç½®å¤åˆ¶æ ‡è¯†ï¼‰</li>
<li><code>SET SCHEMA</code>ï¼ˆä¿®æ”¹æ‰€å±æ¨¡å¼ï¼‰</li>
</ul>
<p>åœ¨è¡Œä¸ºä¸Šï¼Œçˆ¶è¡¨ä¸åˆ†åŒºå‡ ä¹ç­‰åŒäºå½¼æ­¤ç‹¬ç«‹çš„æ™®é€šè¡¨ã€‚</p>
<h3 data-id="heading-9">C5 â€“ ç‹¬ç«‹è®¾ç½®ï¼Œä½†æ–°åˆ†åŒºç»§æ‰¿</h3>
<p>æ­¤ç±»åˆ«ä»…åŒ…å«ä¸€ä¸ªå­å‘½ä»¤ï¼š</p>
<ul>
<li><code>SET COMPRESSION</code>ï¼ˆè®¾ç½®å‹ç¼©å‚æ•°ï¼‰</li>
</ul>
<p>æ‰§è¡Œé€»è¾‘ä¸ C4 åŸºæœ¬ä¸€è‡´ï¼Œä½†æ–°å»ºåˆ†åŒºä¼šç»§æ‰¿çˆ¶è¡¨è®¾ç½®ï¼Œå·²æœ‰åˆ†åŒºä¸å—å½±å“ã€‚</p>
<h3 data-id="heading-10">C6 â€“ å¼ºåˆ¶ä¼ æ’­ç±»å‘½ä»¤</h3>
<p>æ­¤ç±»åˆ«ä»…åŒ…å«ä¸€ä¸ªå­å‘½ä»¤ï¼š</p>
<ul>
<li><code>ADD table_constraint</code>ï¼ˆæ·»åŠ è¡¨çº§çº¦æŸï¼‰</li>
</ul>
<p>æ‰§è¡Œé€»è¾‘ä¸ C2 ç±»åŸºæœ¬ä¸€è‡´ï¼Œä½†ä¸å…è®¸ä½¿ç”¨ <code>ONLY</code>ï¼Œç³»ç»Ÿä¼šå¼ºåˆ¶ä¿è¯æ‰€æœ‰åˆ†åŒºä¸€è‡´ã€‚</p>
<h3 data-id="heading-11">C7 â€“ ä»…é€‚ç”¨äºå¶å­åˆ†åŒºçš„å‘½ä»¤</h3>
<p>æ­¤ç±»ç‰¹å¾å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ— æ³•åœ¨åˆ†åŒºè¡¨ä¸Šä½¿ç”¨ï¼›</li>
<li>åªèƒ½åœ¨å¶å­åˆ†åŒºä¸Šæ‰§è¡Œã€‚</li>
</ul>
<p>åŒ…å«çš„å­å‘½ä»¤ï¼š</p>
<ul>
<li><code>ADD table_constraint_with_index</code>ï¼ˆæ·»åŠ å¸¦ç´¢å¼•çš„è¡¨çº§çº¦æŸï¼‰</li>
<li><code>ALTER CONSTRAINT ... INHERIT / NO INHERIT</code>ï¼ˆä¿®æ”¹çº¦æŸçš„ç»§æ‰¿ / å–æ¶ˆç»§æ‰¿å±æ€§ï¼‰</li>
<li><code>CLUSTER ON</code>ï¼ˆæŒ‰æŒ‡å®šç´¢å¼•èšç°‡ï¼‰</li>
<li><code>SET WITHOUT CLUSTER</code>ï¼ˆå–æ¶ˆèšç°‡ï¼‰</li>
<li><code>SET LOGGED / UNLOGGED</code>ï¼ˆè®¾ç½®æ—¥å¿—è®°å½• / æ— æ—¥å¿—è®°å½•ï¼‰</li>
<li><code>SET (storage_parameter)</code>ï¼ˆè®¾ç½®å­˜å‚¨å‚æ•°ï¼‰</li>
</ul>
<h3 data-id="heading-12">C8 â€“ çˆ¶è¡¨ä½œç”¨åŸŸï¼Œä½†å…è®¸åˆ†åŒºè¦†ç›–</h3>
<p>æ­¤ç±»åˆ«ä»…åŒ…å«ä¸€ä¸ªå­å‘½ä»¤ï¼š</p>
<ul>
<li><code>VALIDATE CONSTRAINT</code>ï¼ˆéªŒè¯çº¦æŸï¼‰</li>
</ul>
<p>æ‰§è¡Œé€»è¾‘ä¸ C1 ç±»åŸºæœ¬ä¸€è‡´ï¼ŒåŒºåˆ«åœ¨äºéªŒè¯åŠ¨ä½œå®šä¹‰åœ¨çˆ¶è¡¨å±‚çº§ï¼Œä½†å„åˆ†åŒºçš„éªŒè¯çŠ¶æ€å¯ä»¥ä¸åŒã€‚</p>
<h3 data-id="heading-13">C9 â€“ æ¡ä»¶ç»§æ‰¿å‹</h3>
<p>æ­¤ç±»åˆ«ä»…åŒ…å«ä¸€ä¸ªå­å‘½ä»¤ï¼š</p>
<ul>
<li><code>SET ACCESS METHOD</code>ï¼ˆè®¾ç½®è®¿é—®æ–¹æ³•ï¼‰</li>
</ul>
<p>æ‰§è¡Œé€»è¾‘ä¸ C2 ç±»åŸºæœ¬ä¸€è‡´ï¼Œä½†æ–°åˆ†åŒºæ˜¯å¦ç»§æ‰¿å–å†³äºçˆ¶è¡¨æ˜¯å¦æ˜¾å¼è®¾ç½®ï¼›è‹¥æœªè®¾ç½®ï¼Œåˆ™ä½¿ç”¨ GUC é»˜è®¤å€¼ã€‚</p>
<h3 data-id="heading-14">C10 â€“ ä¸ä¼ æ’­ï¼Œä½†æ–°åˆ†åŒºç»§æ‰¿</h3>
<p>æ­¤ç±»åˆ«ä»…åŒ…å«ä¸€ä¸ªå­å‘½ä»¤ï¼š</p>
<ul>
<li><code>SET TABLESPACE</code>ï¼ˆè®¾ç½®è¡¨ç©ºé—´ï¼‰</li>
</ul>
<p>å·²æœ‰åˆ†åŒºä¿æŒä¸å˜ï¼Œæ–°å»ºåˆ†åŒºç»§æ‰¿çˆ¶è¡¨è®¾ç½®ã€‚æ¥å— <code>ONLY</code>ï¼Œä½†æ— å®é™…æ•ˆæœã€‚</p>
<h3 data-id="heading-15">C11 â€“ åœ¨çˆ¶è¡¨ä¸Šä¸ºç©ºæ“ä½œ</h3>
<p>æ­¤ç±»åˆ«ä»…åŒ…å«ä¸€ä¸ªå­å‘½ä»¤ï¼š</p>
<ul>
<li><code>RESET (storage_parameter)</code>ï¼ˆé‡ç½®å­˜å‚¨å‚æ•°ï¼‰</li>
</ul>
<p>æ­¤ç±»å‘½ä»¤åœ¨åˆ†åŒºè¡¨ä¸Šä¸ä¼šæŠ¥é”™ï¼Œä½†ä¹Ÿä¸ä¼šäº§ç”Ÿä»»ä½•å®é™…å˜åŒ–ã€‚</p>
<h3 data-id="heading-16">C12 â€“ ä¸æ”¯æŒåˆ†åŒºè¡¨çš„å‘½ä»¤</h3>
<p>åŒ…å«çš„å­å‘½ä»¤ï¼š</p>
<ul>
<li><code>INHERIT</code>ï¼ˆç»§æ‰¿è¡¨ï¼‰</li>
<li><code>NO INHERIT</code>ï¼ˆå–æ¶ˆç»§æ‰¿è¡¨ï¼‰</li>
</ul>
<p>åœ¨æ¦‚å¿µä¸Šä¸å£°æ˜å¼åˆ†åŒºæœºåˆ¶ä¸å…¼å®¹ã€‚</p>
<h3 data-id="heading-17">C13 â€“ ä»…ç»‘å®šçˆ¶è¡¨å…ƒæ•°æ®</h3>
<p>åŒ…å«çš„å­å‘½ä»¤ï¼š</p>
<ul>
<li><code>OF type</code>ï¼ˆç»‘å®šå¤åˆç±»å‹ï¼‰</li>
<li><code>NOT OF</code>ï¼ˆå–æ¶ˆå¤åˆç±»å‹ç»‘å®šï¼‰</li>
</ul>
<p>ä»…ä½œç”¨äºåˆ†åŒºè¡¨æœ¬èº«ï¼Œåœ¨åˆ†åŒºä¸Šæ‰§è¡Œä¼šå¤±è´¥ã€‚æ¥å— <code>ONLY</code>ï¼Œä½†æ— å®é™…æ•ˆæœã€‚</p>
<h3 data-id="heading-18">C14 â€“ æŒ‰æ™®é€šè¡¨å¤„ç†</h3>
<p>ä»…åŒ…å«ä¸€ä¸ªå­å‘½ä»¤ï¼š</p>
<ul>
<li><code>RENAME</code>ï¼ˆé‡å‘½åï¼‰</li>
</ul>
<p>æ— ä¼ æ’­ã€æ— ç»§æ‰¿ï¼Œä¹Ÿä¸å­˜åœ¨åˆ†åŒºç›¸å…³çš„ç‰¹æ®Šè¡Œä¸ºã€‚</p>
<h3 data-id="heading-19">C15 â€“ åˆ†åŒºç®¡ç†ç±»å‘½ä»¤</h3>
<p>åŒ…å«çš„å­å‘½ä»¤ï¼š</p>
<ul>
<li><code>ATTACH PARTITION</code>ï¼ˆæŒ‚è½½åˆ†åŒºï¼‰</li>
<li><code>DETACH PARTITION</code>ï¼ˆå¸è½½åˆ†åŒºï¼‰</li>
</ul>
<p>ç”¨äºæ“ä½œåˆ†åŒºç»“æ„æœ¬èº«ï¼Œè€Œéè¡¨å±æ€§ã€‚</p>
<h2 data-id="heading-20">ç»“è¯­</h2>
<p>åœ¨ PostgreSQL å®˜æ–¹æ–‡æ¡£æœªå¯¹åˆ†åŒºè¡¨çš„ ALTER TABLE è¯­å¥æ‰§è¡Œé€»è¾‘è¿›è¡Œæ˜ç¡®ã€ä½“ç³»åŒ–è¯´æ˜å‰ï¼Œæœ¬åˆ†ç±»æ¨¡å‹å¯ä½œä¸ºé‡è¦çš„å‚è€ƒä¾æ®ã€‚</p>
<p>è‹¥æ—¥å¸¸å·¥ä½œä¸­é¢‘ç¹ä½¿ç”¨åˆ†åŒºè¡¨ï¼Œå»ºè®®å°†è¯¥è®¤çŸ¥æ¨¡å‹ä½œä¸ºå¸¸ç”¨å‚è€ƒï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œç›¸å…³å‘½ä»¤å‰ï¼Œå…ˆç¡®è®¤å…¶æ‰€å±çš„æ‰§è¡Œç±»åˆ«ï¼Œå†å¼€å±•æ“ä½œï¼Œä»¥é™ä½ä¸å¯é¢„æœŸé£é™©ã€‚</p>
<p>åŸæ–‡é“¾æ¥ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.highgo.ca%2F2026%2F01%2F21%2Funderstanding-alter-table-behavior-on-partitioned-tables-in-postgr" target="_blank" title="https://www.highgo.ca/2026/01/21/understanding-alter-table-behavior-on-partitioned-tables-in-postgr" ref="nofollow noopener noreferrer">www.highgo.ca/2026/01/21/â€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯è§†è§’ä¸‹è®¤è¯† AI Agent å’Œ LangChain]]></title>    <link>https://juejin.cn/post/7604039449468895282</link>    <guid>https://juejin.cn/post/7604039449468895282</guid>    <pubDate>2026-02-09T06:58:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604039449468895282" data-draft-id="7604080364353585179" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯è§†è§’ä¸‹è®¤è¯† AI Agent å’Œ LangChain"/> <meta itemprop="keywords" content="å‰ç«¯,Agent,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-02-09T06:58:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Lsx_"/> <meta itemprop="url" content="https://juejin.cn/user/1442981392682829"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯è§†è§’ä¸‹è®¤è¯† AI Agent å’Œ LangChain
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1442981392682829/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Lsx_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T06:58:36.000Z" title="Mon Feb 09 2026 06:58:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;color:#282d36}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px;color:#2f845e}.markdown-body h2{font-size:22px;display:inline-block;font-weight:700;background:#2f845e;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(47,132,194,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 32px);border-bottom:3px solid #2f845e}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%;box-shadow:6px 6px 6px #888}.markdown-body hr{border:none;border-top:1px solid rgba(66,185,131,.15);margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:16px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#262626;border:1px solid #2f845e;border-top:8px solid #2f845e;background:linear-gradient(180deg,rgba(66,185,131,.1),transparent)!important}.markdown-body pre&gt;code.hljs[lang]:before{top:8px!important;color:#2f845e!important}.markdown-body pre&gt;code.language-awesome_error{border:1px solid #ff4d4f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ff4d4f!important;background:#fff2f0!important}.markdown-body pre&gt;code.language-awesome_error:before{content:"!"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ff4d4f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_warn{border:1px solid #ffc46f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ffc46f!important;background:#fffbe6!important}.markdown-body pre&gt;code.language-awesome_warn:before{content:"â˜‚"!important;position:absolute;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ffc46f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_success{border:1px solid #52c41a!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#52c41a!important;background:#f6ffed!important}.markdown-body pre&gt;code.language-awesome_success:before{content:"âœ“"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#52c41a!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_info{border:1px solid #1890ff!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#1890ff!important;background:#e6f7ff!important}.markdown-body pre&gt;code.language-awesome_info:before{content:"i"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#1890ff!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body strong{background-color:inherit;color:#2f845e}.markdown-body em{background-color:inherit;color:#949415}.markdown-body a{text-decoration:none;color:#2f8e54;border-bottom:1px solid #3f9e64}.markdown-body a:active,.markdown-body a:hover{color:#3f9e64}.markdown-body a[class^=footnote]{margin-left:4px}.markdown-body a:before{content:"â¤ "}.markdown-body table{font-size:12px;width:100%;max-width:100%;overflow:auto;border:2px solid #2f8e54}.markdown-body thead{background:#2f8e54;color:#fff;text-align:left;font-weight:700}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:22px}.markdown-body td{min-width:120px}.markdown-body blockquote{padding:1px 22px;margin:22px 0;border-left:6px solid #2f845e;background-color:rgba(66,185,131,.1);border-radius:2px}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#2f845e}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px;color:#282d36}.markdown-body del{color:#2f845e}.markdown-body input[type=checkbox]:checked:before{content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA/klEQVQ4T72TMU7DQBBF318XdFR06egQEnAXRINEGlqgowoIR8AF4AZOZ4JEGq5AC5EixBU4A55BNrEVHAcSBTHlaubt37/zxZKlcn7n6mDPXJvz8IJ89HzWu8t7C8D2dfsY52ae4apHnLx0ktsCsHXZjiUuFgG40x2eJ/H/AhztB+zDUTpLwWj8jGkzxSHiHaMPrDQC8sMoilKzLAUqiKQjmb+ZuAdW80tmelCHODoNgSfP7AFprTTaRTzsJN1GEyuIZ7uW6TEEHwCtyV/6EVBKJHhfzgC0Xv/iXwEFBF4FG0378bd7sPQq5xK/hSnk6sdlX3mZrKkwLZKBeu8n9XuWEUE7X+YAAAAASUVORK5CYII=);position:relative;top:-1px;left:-1px}.markdown-body .math .katex{font-family:Menlo,Monaco,Consolas,Courier New,monospace;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}@media (max-width:720px){.markdown-body h1{font-size:22px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">AI Agent å’Œ ä¼ ç»Ÿåº”ç”¨çš„åŒºåˆ«</h2>
<p>æˆ‘ä»¬å‡è®¾è¦å¼€å‘ä¸€ä¸ªå¯¹è¯æœºå™¨äººçš„åº”ç”¨ã€‚</p>
<p>å¯¹äºä¼ ç»Ÿå¯¹è¯æœºå™¨äººå¼€å‘ï¼šæ ¸å¿ƒåœ¨äºåç«¯ä¸šåŠ¡é€»è¾‘ã€æ•°æ®åº“è®¾è®¡ã€API æ¥å£ç­‰æŠ€æœ¯æ ˆã€‚</p>
<p>è€Œå¯¹äº AI Agent å¯¹è¯æœºå™¨äººå¼€å‘ï¼šæ ¸å¿ƒå˜æˆäº†å¦‚ä½•ä¸å¤§æ¨¡å‹å¯¹è¯ã€å¦‚ä½•ä¼˜åŒ–æç¤ºè¯ã€å¦‚ä½•ç®¡ç†å¯¹è¯æµç¨‹ã€‚</p>
<p>æ ¸å¿ƒåœ¨äº AI Agent ä¸­ï¼Œå¤§æ¨¡å‹æ˜¯é©±åŠ¨è¿™ä¸ªç¨‹åºæ ¸å¿ƒï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¯´ AI æ”¹å˜äº†ä¼ ç»Ÿåº”ç”¨çš„å¼€å‘æ¨¡å¼ã€‚</p>
<h2 data-id="heading-1">AI Agent çš„æ„æˆ</h2>
<p>ç°åœ¨å¤§å®¶å¸¸ç”¨ä¸€ä¸ªç»å…¸å…¬å¼æ¥æ¦‚æ‹¬å®ƒçš„æ ¸å¿ƒæ„æˆï¼š</p>
<p><strong><code>AI Agent = LLM(å¤§è„‘) + Memory(è®°å¿†) + Planning(è§„åˆ’) + Tools(å·¥å…·)</code></strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30cb3f6f7f504170b34ba72ed15fb55f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771225115&amp;x-signature=k1aNtLnRoXnOyyrX9gxezKcEQkw%3D" alt="image.png" loading="lazy"/></p>
<p>è®©æˆ‘ä»¬æ¥é€ä¸€æ‹†è§£è¿™å››ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š</p>
<ul>
<li><strong>LLM (å¤§è¯­è¨€æ¨¡å‹):</strong> Agent çš„æ ¸å¿ƒå¼•æ“ï¼Œå……å½“"<strong>å¤§è„‘</strong>"çš„è§’è‰²ã€‚å®ƒè´Ÿè´£ç†è§£ç”¨æˆ·æ„å›¾ï¼Œè¿›è¡Œæ¨ç†ã€åˆ†æå’Œå†³ç­–ã€‚æ‰€æœ‰å¤æ‚çš„é€»è¾‘åˆ¤æ–­å’Œè¯­è¨€ç†è§£ï¼Œéƒ½ç”±å®ƒæ¥å®Œæˆã€‚</li>
<li><strong>Planning (è§„åˆ’):</strong> Agent çš„"<strong>æ€è€ƒæ¡†æ¶</strong>"ã€‚å½“é¢å¯¹å¤æ‚ä»»åŠ¡æ—¶ï¼ˆæ¯”å¦‚"è§„åˆ’æ—…è¡Œ"ï¼‰ï¼ŒAgent éœ€è¦å°†å…¶åˆ†è§£æˆä¸€ç³»åˆ—å¯æ‰§è¡Œçš„å°æ­¥éª¤ï¼ˆ1. æŸ¥å¤©æ°” â†’ 2. æŸ¥é…’åº— â†’ 3. æŸ¥æ™¯ç‚¹ â†’ 4. è§„åˆ’è¡Œç¨‹ï¼‰ã€‚è¿™ç§ä»»åŠ¡åˆ†è§£å’Œè§„åˆ’èƒ½åŠ›æ˜¯ Agent è‡ªä¸»æ€§çš„å…³é”®ã€‚</li>
<li><strong>Memory (è®°å¿†):</strong> Agent çš„"<strong>ç¬”è®°æœ¬</strong>"ã€‚å®ƒèƒ½è®°ä½ä¹‹å‰çš„äº¤äº’å†å²ã€ä»»åŠ¡çš„ä¸­é—´ç»“æœï¼Œç”šè‡³è¿‡å»çš„æˆåŠŸç»éªŒå’Œå¤±è´¥æ•™è®­ã€‚è¿™ä½¿å¾— Agent åœ¨å¤šè½®å¯¹è¯å’Œé•¿æœŸä»»åŠ¡ä¸­èƒ½ä¿æŒä¸Šä¸‹æ–‡è¿è´¯ï¼Œè€Œä¸æ˜¯åªæœ‰"ä¸ƒç§’é’Ÿè®°å¿†çš„é‡‘é±¼è„‘è¢‹"ã€‚</li>
<li><strong>Tools (å·¥å…·):</strong> Agent çš„"<strong>åŒæ‰‹</strong>"ï¼Œæ˜¯å®ƒä¸ç°å®ä¸–ç•Œäº¤äº’çš„æ¡¥æ¢ã€‚æ— è®ºæ˜¯ API è°ƒç”¨ï¼ˆå¦‚æŸ¥è¯¢å¤©æ°”ï¼‰ã€æ•°æ®åº“æŸ¥è¯¢ï¼Œè¿˜æ˜¯è¿‘æœŸçƒ­é—¨çš„ <code>MCP Server</code> æ¦‚å¿µï¼Œè¿™äº›éƒ½å±äºå·¥å…·çš„èŒƒç•´ã€‚</li>
</ul>
<h2 data-id="heading-2">ä¸ºä»€ä¹ˆä½ éœ€è¦ä¸€ä¸ª AI å¼€å‘æ¡†æ¶</h2>
<p>åœ¨ä¼ ç»Ÿå¼€å‘ä¸­ï¼Œä¸åŒçš„ç¼–ç¨‹è¯­è¨€éƒ½æœ‰è‡ªå·±çš„â€œç¥å™¨â€ï¼š</p>
<ul>
<li>Java å¼€å‘è€…ä¼šç”¨ Spring æ¡†æ¶</li>
<li>Go ç¨‹åºå‘˜ä¼šé€‰æ‹© Gin æ¡†æ¶</li>
<li>Python å¼€å‘è€…é’ç Django/Flask</li>
</ul>
<p>é‚£ä¹ˆåœ¨ AI åº”ç”¨å¼€å‘é¢†åŸŸï¼Œä»€ä¹ˆæ˜¯æˆ‘ä»¬çš„â€œè¶æ‰‹å…µå™¨â€å‘¢ï¼Ÿ</p>
<p>ç›®å‰ AI Agent å¼€å‘æ¡†æ¶ä¸­æœ€è€€çœ¼çš„ä¸€é¢—æ˜Ÿï¼Œæ¯«æ— ç–‘é—®å°±æ˜¯Â <strong>LangChain</strong>ã€‚ä»Šå¤©ï¼Œå°±è®©æˆ‘ä»¬ä¸€èµ·æ¥æ­å¼€å®ƒçš„ç¥ç§˜é¢çº±ï¼</p>
<h2 data-id="heading-3">Â LangChain æ˜¯ä»€ä¹ˆï¼Ÿä¸€ä¸ªç”ŸåŠ¨æ¯”å–»å‘Šè¯‰ä½ ç­”æ¡ˆ</h2>
<p>æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªä¾‹å­ï¼Œæ¥è¯´æ˜ LangChain ä¸ºä»€ä¹ˆæ˜¯ AI Agent å¼€å‘ä¸­å¿…ä¸å¯å°‘çš„å†…å®¹ã€‚</p>
<p>æ²¡æœ‰ LangChain æ—¶ï¼Œè°ƒç”¨ä¸åŒçš„å¤§æ¨¡å‹å¯èƒ½éœ€è¦è¿™æ ·ï¼š</p>
<p>ä»¥ä¸‹æ˜¯è°ƒç”¨ OpenAI çš„ Nodejs ä»£ç </p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> <span class="hljs-title class_">OpenAI</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'openai'</span>;

<span class="hljs-comment">// åˆå§‹åŒ–å®¢æˆ·ç«¯</span>
<span class="hljs-keyword">const</span> openai = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAI</span>({
  <span class="hljs-attr">apiKey</span>: <span class="hljs-string">'your-openai-api-key'</span>,
});

<span class="hljs-comment">// è°ƒç”¨ ChatGPT</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">callOpenAI</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> completion = <span class="hljs-keyword">await</span> openai.<span class="hljs-property">chat</span>.<span class="hljs-property">completions</span>.<span class="hljs-title function_">create</span>({
      <span class="hljs-attr">model</span>: <span class="hljs-string">"gpt-3.5-turbo"</span>,
      <span class="hljs-attr">messages</span>: [
        { <span class="hljs-attr">role</span>: <span class="hljs-string">"system"</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">"You are a helpful assistant."</span> },
        { <span class="hljs-attr">role</span>: <span class="hljs-string">"user"</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">"Hello!"</span> }
      ],
      <span class="hljs-attr">temperature</span>: <span class="hljs-number">0.7</span>,
    });

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(completion.<span class="hljs-property">choices</span>[<span class="hljs-number">0</span>].<span class="hljs-property">message</span>.<span class="hljs-property">content</span>);
    <span class="hljs-keyword">return</span> completion;
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Error calling OpenAI:'</span>, error);
  }
}


<span class="hljs-comment">// è°ƒç”¨ Claude</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Anthropic</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@anthropic-ai/sdk'</span>;

<span class="hljs-comment">// åˆå§‹åŒ–å®¢æˆ·ç«¯</span>
<span class="hljs-keyword">const</span> anthropic = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Anthropic</span>({
  <span class="hljs-attr">apiKey</span>: <span class="hljs-string">'your-anthropic-api-key'</span>,
});

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">callClaude</span>(<span class="hljs-params"/>) {xxx}

<span class="hljs-comment">// è°ƒç”¨å‡½æ•°</span>
<span class="hljs-title function_">callClaude</span>();
</code></pre>
<p>è€Œä½ ä½¿ç”¨ LangChain åï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatOpenAI</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/openai"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatAnthropic</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/anthropic"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'dotenv/config'</span>;

<span class="hljs-comment">// æ³¨ï¼šimport 'dotenv/config';ä½œç”¨æ˜¯è‡ªåŠ¨ä»é¡¹ç›®æ ¹ç›®å½•çš„Â `.env`Â æ–‡ä»¶ä¸­è¯»å–ç¯å¢ƒå˜é‡</span>
<span class="hljs-comment">// ä¾‹å¦‚ .env æ–‡ä»¶ä¸­æœ‰é…ç½® OPENAI_API_KEY = xxx, é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç”¨ process.env.OPENAI_API_KEY è·å–åˆ°å€¼</span>

<span class="hljs-comment">// ç»Ÿä¸€çš„ä½¿ç”¨æ–¹å¼</span>
<span class="hljs-keyword">const</span> openai_llm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatOpenAI</span>({
  <span class="hljs-attr">modelName</span>: <span class="hljs-string">"gpt-4"</span>,
  <span class="hljs-attr">temperature</span>: <span class="hljs-number">0.7</span>,
  <span class="hljs-attr">apiKey</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">OPENAI_API_KEY</span>, <span class="hljs-comment">// ä»ç¯å¢ƒå˜é‡è¯»å–</span>
});

<span class="hljs-keyword">const</span> claude_llm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatAnthropic</span>({
  <span class="hljs-attr">modelName</span>: <span class="hljs-string">"claude-3-opus-20240229"</span>, <span class="hljs-comment">// Claude éœ€è¦å…·ä½“ç‰ˆæœ¬</span>
  <span class="hljs-attr">temperature</span>: <span class="hljs-number">0.7</span>,
  <span class="hljs-attr">apiKey</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">ANTHROPIC_API_KEY</span>, <span class="hljs-comment">// ä»ç¯å¢ƒå˜é‡è¯»å–</span>
});

<span class="hljs-comment">// è°ƒç”¨æ–¹å¼å®Œå…¨ä¸€è‡´ï¼</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">callModels</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// å•ä¸ªè°ƒç”¨</span>
    <span class="hljs-keyword">const</span> response1 = <span class="hljs-keyword">await</span> openai_llm.<span class="hljs-title function_">invoke</span>(<span class="hljs-string">"ä½ å¥½"</span>);
    <span class="hljs-keyword">const</span> response2 = <span class="hljs-keyword">await</span> claude_llm.<span class="hljs-title function_">invoke</span>(<span class="hljs-string">"Hello"</span>);
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"GPT-4 å›å¤:"</span>, response1.<span class="hljs-property">content</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Claude 3 å›å¤:"</span>, response2.<span class="hljs-property">content</span>);
    
    <span class="hljs-keyword">return</span> { response1, response2 };
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"è°ƒç”¨æ¨¡å‹æ—¶å‡ºé”™:"</span>, error);
    <span class="hljs-keyword">throw</span> error;
  }
}

<span class="hljs-comment">// è°ƒç”¨å‡½æ•°</span>
<span class="hljs-title function_">callModels</span>();
</code></pre>
<p>çœ‹åˆ°åŒºåˆ«äº†å—ï¼ŸLangChain å°±åƒæ˜¯ä¸€ä¸ª<strong>ä¸‡èƒ½ç¿»è¯‘å™¨</strong>ï¼Œæ— è®ºåº•å±‚ç”¨çš„æ˜¯å“ªä¸ªå¤§æ¨¡å‹ï¼Œéƒ½ä¸ºä½ æä¾›ç»Ÿä¸€çš„ API æ¥å£ã€‚</p>
<p>å±•ç¤ºä¸€ä¸‹deepseekç”¨langchainçš„è°ƒç”¨æ–¹å¼ï¼š</p>
<p>js ç‰ˆæœ¬, æ³¨æ„ä¸‹è½½ @langchain/coreï¼Œ@langchain/openai åŒ…ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatOpenAI</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/openai"</span>;

<span class="hljs-keyword">const</span> apiKey = <span class="hljs-string">"sk-xx"</span>;

<span class="hljs-keyword">const</span> llm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatOpenAI</span>({
  <span class="hljs-attr">model</span>: <span class="hljs-string">"deepseek-chat"</span>,
  <span class="hljs-attr">temperature</span>: <span class="hljs-number">0</span>,
  apiKey,
  <span class="hljs-attr">configuration</span>: {
    <span class="hljs-attr">baseURL</span>: <span class="hljs-string">"https://api.deepseek.com"</span>,
  },
  <span class="hljs-comment">// other params...</span>
});

<span class="hljs-keyword">const</span> <span class="hljs-title function_">run</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> llm.<span class="hljs-title function_">invoke</span>([
      {
        <span class="hljs-attr">role</span>: <span class="hljs-string">"user"</span>,
        <span class="hljs-attr">content</span>: <span class="hljs-string">"I love programming."</span>,
      },
    ]);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"response:"</span>, response);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Error:"</span>, error);
  }
};

<span class="hljs-title function_">run</span>();
</code></pre>
<h2 data-id="heading-4">æ‹†è§£ LangChainï¼šåå­—é‡Œè—ç€ä»€ä¹ˆç§˜å¯†ï¼Ÿ</h2>
<p>Lang + Chain = è¯­è¨€æ¨¡å‹ + é“¾å¼è°ƒç”¨</p>
<p>è¿™ä¸ªåå­—ç²¾å‡†åœ°æè¿°äº†å®ƒçš„æ ¸å¿ƒæ€æƒ³ï¼š</p>
<ul>
<li>Langï¼šä»£è¡¨å¤§è¯­è¨€æ¨¡å‹ï¼ˆLarge Language Modelï¼‰</li>
<li>Chainï¼šä»£è¡¨å°†ä¸åŒç»„ä»¶åƒé“¾æ¡ä¸€æ ·è¿æ¥èµ·æ¥</li>
</ul>
<p>åˆèµ·æ¥å°±æ˜¯ï¼šé€šè¿‡é“¾å¼æ¶æ„å°†å¤§æ¨¡å‹èƒ½åŠ›è¿æ¥åˆ°å®é™…åº”ç”¨ä¸­ã€‚</p>
<h3 data-id="heading-5">å‰ç«¯å¼€å‘è€…çš„ç¦éŸ³</h3>
<p>å¥½æ¶ˆæ¯æ˜¯ï¼ŒLangChain åŸç”Ÿæ”¯æŒ TypeScriptï¼è¿™æ„å‘³ç€å‰ç«¯å¼€å‘è€…å¯ä»¥ç”¨è‡ªå·±ç†Ÿæ‚‰çš„ JavaScript/TypeScript æ¥æ„å»º AI åº”ç”¨ã€‚</p>
<h2 data-id="heading-6">LangChain è¿˜è§£å†³äº†å“ªäº›å¤§æ¨¡å‹çš„é—®é¢˜</h2>
<p>å¤§æ¨¡å‹è™½ç„¶å¼ºå¤§ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›â€œä¸ç”Ÿä¿±æ¥â€çš„å±€é™æ€§ï¼š</p>
<h3 data-id="heading-7">1.Â ä¿¡æ¯è¿‡æ—¶é—®é¢˜</h3>
<blockquote>
<p>â€œä»Šå¤©åŒ—äº¬çš„å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿâ€</p>
</blockquote>
<p>å¤§æ¨¡å‹å¾ˆå¯èƒ½ä¼šå‘Šè¯‰ä½ å®ƒä¸çŸ¥é“ï¼Œå› ä¸ºå®ƒçš„è®­ç»ƒæ•°æ®æˆªæ­¢åˆ°æŸä¸ªç‰¹å®šæ—¥æœŸã€‚è¿™ç§æ—¶æ•ˆæ€§å¼ºçš„é—®é¢˜ï¼Œå•çº¯çš„å¤§æ¨¡å‹å¾ˆéš¾ç»™å‡ºå‡†ç¡®ç­”æ¡ˆã€‚</p>
<h3 data-id="heading-8">2.Â æ— æ³•è”ç½‘</h3>
<blockquote>
<p>â€œå¸®æˆ‘æŸ¥ä¸€ä¸‹ç‰¹æ–¯æ‹‰æœ€æ–°çš„è‚¡ä»·â€</p>
</blockquote>
<p>å¤§æ¨¡å‹ä¸èƒ½å®æ—¶è®¿é—®äº’è”ç½‘ï¼ˆè™½ç„¶æœ‰äº›æ¨¡å‹åæœŸå¢åŠ äº†è”ç½‘åŠŸèƒ½ï¼Œä½†è¿™é€šå¸¸æ˜¯åŸºäº LangChain ç­‰æŠ€æœ¯å®ç°çš„æ‰©å±•ï¼‰ã€‚</p>
<h3 data-id="heading-9">3. ç§æœ‰çŸ¥è¯†ç›²åŒº</h3>
<blockquote>
<p>â€œæˆ‘ä»¬å…¬å¸çš„äº§å“å®šä»·ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿâ€</p>
</blockquote>
<p>å¤§æ¨¡å‹æ²¡æœ‰å­¦ä¹ è¿‡ä½ å…¬å¸çš„å†…éƒ¨æ–‡æ¡£ï¼Œè‡ªç„¶æ— æ³•å›ç­”è¿™ç±»é—®é¢˜ã€‚</p>
<h3 data-id="heading-10">4.Â æ— æ³•è°ƒç”¨å¤–éƒ¨æœåŠ¡</h3>
<blockquote>
<p>â€œå¸®æˆ‘è®¢ä¸€å¼ æ˜å¤©å»ä¸Šæµ·çš„æœºç¥¨â€</p>
</blockquote>
<p>å¤§æ¨¡å‹æœ¬èº«æ²¡æœ‰è®¢ç¥¨èƒ½åŠ›ï¼Œå®ƒéœ€è¦è°ƒç”¨ç¬¬ä¸‰æ–¹çš„æœºç¥¨é¢„è®¢ APIã€‚</p>
<h2 data-id="heading-11">LangChain å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜ï¼Ÿ</h2>
<p>é’ˆå¯¹ä¸Šè¿°é—®é¢˜ï¼ŒLangChain æä¾›äº†å®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼š</p>
<h3 data-id="heading-12">è§£å†³æ–¹æ¡ˆçŸ©é˜µ</h3>






























<table><thead><tr><th>å¤§æ¨¡å‹çš„é—®é¢˜</th><th>LangChain çš„è§£å†³æ–¹æ¡ˆ</th><th>å®é™…åº”ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>ä¿¡æ¯è¿‡æ—¶</td><td>å®æ—¶æ•°æ®æ£€ç´¢</td><td>æ–°é—»æŸ¥è¯¢ã€è‚¡ç¥¨ä»·æ ¼ã€å¤©æ°”ä¿¡æ¯</td></tr><tr><td>æ— æ³•è”ç½‘</td><td>ç½‘ç»œæœç´¢å·¥å…·</td><td>æœ€æ–°èµ„è®¯ã€å®æ—¶æ•°æ®è·å–</td></tr><tr><td>ç§æœ‰çŸ¥è¯†ç›²åŒº</td><td>æ–‡æ¡£åŠ è½½ä¸å‘é‡æ£€ç´¢</td><td>ä¼ä¸šå†…éƒ¨çŸ¥è¯†åº“ã€ä¸“ä¸šæ–‡æ¡£é—®ç­”</td></tr><tr><td>ä¸èƒ½è°ƒç”¨ API</td><td>å·¥å…·è°ƒç”¨é›†æˆ</td><td>è®¢ç¥¨ã€æ”¯ä»˜ã€æŸ¥è¯¢ç­‰å®é™…ä¸šåŠ¡</td></tr></tbody></table>
<h3 data-id="heading-13">ç»Ÿä¸€çš„å¤šæ¨¡å‹æ”¯æŒ</h3>
<p>LangChain æ”¯æŒå‡ ä¹æ‰€æœ‰ä¸»æµå¤§æ¨¡å‹ï¼š</p>
<ul>
<li>OpenAI GPT ç³»åˆ—</li>
<li>Anthropic Claude ç³»åˆ—</li>
<li>Google Gemini</li>
<li>å¼€æºæ¨¡å‹ï¼ˆLlamaã€Qwenç­‰ï¼‰</li>
</ul>
<p>è€Œä¸”è°ƒç”¨æ–¹å¼å®Œå…¨ç»Ÿä¸€ï¼Œè®©ä½ å¯ä»¥è½»æ¾åˆ‡æ¢æˆ–åŒæ—¶ä½¿ç”¨å¤šä¸ªæ¨¡å‹ã€‚</p>
<h2 data-id="heading-14">å…³äºå¯è§†åŒ–å¹³å°çš„æ€è€ƒ</h2>
<p>æœ‰äº›åŒå­¦å¯èƒ½ä¼šé—®ï¼šâ€œç°åœ¨ä¸æ˜¯æœ‰ Cozeã€Dify è¿™ç±»å¯è§†åŒ– AI åº”ç”¨æ­å»ºå¹³å°å—ï¼Ÿä¸ºä»€ä¹ˆè¿˜è¦å­¦ç¼–ç¨‹å»åšå¤§æ¨¡å‹åº”ç”¨ï¼Ÿâ€</p>
<p>è¿™ä¸ªé—®é¢˜é—®å¾—å¾ˆå¥½ï¼ä½œä¸ºå‰ç«¯å¼€å‘è€…ï¼Œä½ ä¸€å®šå¾ˆæ¸…æ¥šä½ä»£ç /æ— ä»£ç å¹³å°çš„ä¼˜ç¼ºç‚¹ï¼š</p>
<p>å¯è§†åŒ–å¹³å°çš„ä¼˜åŠ¿</p>
<ul>
<li>ä¸Šæ‰‹å¿«ï¼Œæ— éœ€ç¼–ç </li>
<li>å¿«é€ŸåŸå‹éªŒè¯</li>
<li>é€‚åˆç®€å•åœºæ™¯</li>
</ul>
<p>å¯è§†åŒ–å¹³å°çš„å±€é™</p>
<ul>
<li>å®šåˆ¶åŒ–èƒ½åŠ›æœ‰é™</li>
<li>å¤æ‚é€»è¾‘å®ç°å›°éš¾</li>
<li>éš¾ä»¥é›†æˆåˆ°ç°æœ‰ç³»ç»Ÿ</li>
<li>æ€§èƒ½å’Œæ‰©å±•æ€§å—é™</li>
</ul>
<p>å°±åƒä½ ä¸ä¼šåªç”¨ä½ä»£ç å¹³å°æ¥åšå¤æ‚çš„å‰ç«¯é¡¹ç›®ä¸€æ ·ï¼Œåœ¨éœ€è¦æ·±åº¦å®šåˆ¶å’Œå¤æ‚é›†æˆçš„ AI åº”ç”¨åœºæ™¯ä¸­ï¼ŒæŒæ¡ LangChain è¿™æ ·çš„ç¼–ç¨‹æ¡†æ¶æ˜¯å¿…ä¸å¯å°‘çš„ã€‚</p>
<p>è®²å®Œ Langchain æ˜¯ä»€ä¹ˆäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬äº†è§£ä¸‹ AI Agent å¼€å‘æˆ‘ä»¬å¸¸è§é‡åˆ°çš„ 4 ä¸ªåœºæ™¯ï¼Œå¸®åŠ©æˆ‘ä»¬äº†è§£åˆ°åç»­å¼€å‘ AI Agent å¯èƒ½é‡åˆ°çš„æ¶æ„æ˜¯ä»€ä¹ˆã€‚</p>
<h2 data-id="heading-15">AI Agent å¼€å‘å¸¸è§çš„ 4 ä¸ªåœºæ™¯</h2>
<h3 data-id="heading-16">åœºæ™¯ä¸€ï¼šçº¯Promptåœºæ™¯</h3>
<p><strong>çº¯Promptåœºæ™¯</strong>æ˜¯æœ€åŸºç¡€ã€æœ€ç›´æ¥çš„AIåº”ç”¨æ–¹å¼ï¼Œå°±åƒä½¿ç”¨æœç´¢å¼•æ“ä¸€æ ·ç®€å•ï¼šä½ è¾“å…¥é—®é¢˜ï¼ˆPromptï¼‰ï¼ŒAIç›´æ¥è¿”å›ç­”æ¡ˆã€‚ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bafb463d01d84b2d96c37a618155fa21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771225115&amp;x-signature=dhLnm9vt1PMKFzmkghllgyyxElE%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// çº¯Promptåœºæ™¯çš„ç®€å•å®ç°</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatOpenAI</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/openai"</span>;

<span class="hljs-keyword">const</span> llm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatOpenAI</span>({
  <span class="hljs-attr">modelName</span>: <span class="hljs-string">"gpt-4"</span>,
  <span class="hljs-attr">temperature</span>: <span class="hljs-number">0.7</span>,
});

<span class="hljs-comment">// ç›´æ¥è°ƒç”¨</span>
<span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> llm.<span class="hljs-title function_">invoke</span>(<span class="hljs-string">"å¸®æˆ‘å†™ä¸€é¦–å…³äºæ˜¥å¤©çš„è¯—"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(response.<span class="hljs-property">content</span>);
</code></pre>
<h3 data-id="heading-17">åœºæ™¯äºŒï¼šAgent + Function Call</h3>
<p>ä»€ä¹ˆæ˜¯Agent + Function Callï¼Ÿ</p>
<p><strong>Agent</strong>æ˜¯èƒ½å¤Ÿè‡ªä¸»è§„åˆ’ã€å†³ç­–å’Œæ‰§è¡Œçš„æ™ºèƒ½ä½“ï¼Œ<strong>Function Call</strong>è®©AIèƒ½å¤Ÿè°ƒç”¨å¤–éƒ¨å·¥å…·å’ŒAPIï¼ŒçœŸæ­£"åŠ¨æ‰‹åšäº‹"ã€‚</p>
<p>ç®€å•ä¸¾ä¾‹ï¼Œæˆ‘ä»¬æŸ¥è¯¢å¤©æ°”æ—¶ï¼Œai è‚¯å®šä¸çŸ¥é“å½“å¤©å¤©æ°”æ˜¯ä»€ä¹ˆï¼Œæ­¤æ—¶ï¼Œai å¯ä»¥è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯æˆ‘ä»¬åç«¯è‡ªå·±å†™çš„ï¼Œå½“é—®åŠæŸ¥è¯¢å¤©æ°”çš„æ—¶å€™ï¼Œå°±è®©å¤§æ¨¡å‹è°ƒæˆ‘ä»¬çš„æŸ¥è¯¢å¤©æ°” apiï¼Œç„¶åå°†ç»“æœç»™å¤§æ¨¡å‹ï¼Œæœ€åå¤§æ¨¡å‹è¿”å›ç»™ç”¨æˆ·ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab75efb1f6804ce089729a25c0581eee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771225115&amp;x-signature=Hl2U9UarOt3MP2Kh3yG1sFmBS9Y%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-18">åœºæ™¯ä¸‰ï¼šRAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰</h3>
<p>ç®€å•æ¥è¯´ï¼Œæ¯”å¦‚ä½ ä»¬è¦åšä¸€ä¸ªå…¬å¸å†…éƒ¨æ–‡æ¡£çš„ AI Agentï¼Œå½“ä½ é—®è¿™ä¸ª AI Agent é—®é¢˜çš„æ—¶å€™ï¼Œå¾ˆå¤šé—®é¢˜éƒ½æ˜¯è·Ÿå…¬å¸å†…éƒ¨ä¿¡æ¯æœ‰å…³ï¼Œè¿™ä¸ªå¤§æ¨¡å‹è‚¯å®šæ˜¯ä¸çŸ¥é“çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æå‰æŠŠå…¬å¸å„ç§èµ„æ–™è½¬åŒ–ä¸ºå¤§æ¨¡å‹è®¤è¯†çš„æ ¼å¼ï¼ˆå‘é‡ï¼‰ï¼Œä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œå½“å¤§æ¨¡å‹å›ç­”æœ‰å…³å…¬å¸é—®é¢˜çš„æ—¶å€™ï¼Œå…ˆå»æˆ‘ä»¬çš„æ•°æ®åº“æŸ¥ç›¸å…³å†…å®¹ï¼Œç„¶åæ‰¾åˆ°ç›¸å…³ä¿¡æ¯ï¼Œå†æŠŠä¹‹å‰ç”¨æˆ·æé—®çš„é—®é¢˜å¢å¼ºä¸€ä¸‹ã€‚</p>
<p>å¢å¼ºæ˜¯æŒ‡ï¼ŒæŠŠä»å‘é‡æ•°æ®åº“æœç´¢çš„ä¸€äº›èµ„æ–™ä¹Ÿé™„å¸¦åœ¨é—®é¢˜ä¸­ï¼Œæœ€ç»ˆå¤§æ¨¡å‹åŸºäºè¿™äº›èµ„æ–™å’Œç”¨æˆ·çš„é—®é¢˜å›ç­”ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1025c44946394910a73606ae827c7f68~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771225115&amp;x-signature=LnEOBXttgJfYnzbqx61qSYuVG8Q%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-19">åœºæ™¯å››ï¼šFine-tuningï¼ˆå¾®è°ƒè®­ç»ƒï¼‰</h3>
<p>å¾®è°ƒä¹Ÿå¾ˆå¥½ç†è§£ï¼Œä¹‹å‰ RAG æ˜¯æŠŠæˆ‘ä»¬å…¬å¸æ•°æ®åº“é‡Œçš„ä¿¡æ¯é™„å¸¦ç€ç»™å¤§æ¨¡å‹ï¼Œè®©å¤§æ¨¡å‹çŸ¥é“ä¸€äº›èƒŒæ™¯ä¿¡æ¯ï¼Œè€Œå¾®è°ƒï¼Œæ˜¯ç›´æ¥æŠŠæ•°æ®åº“é‡Œçš„èµ„æ–™ç»™å¤§æ¨¡å‹è®­ç»ƒï¼Œè®©å¤§æ¨¡å‹å­¦ä¹ åˆ°ã€‚</p>
<p>æœ€åç”¨æˆ·é—®é—®é¢˜çš„æ—¶å€™ï¼Œå°±ä¸éœ€è¦ RAG çš„æ¨¡å¼ï¼Œè¿˜å»æˆ‘ä»¬æœ¬åœ°çš„æ•°æ®åº“æœç´¢äº†ï¼Œç›´æ¥å°±èƒ½å›ç­”è·Ÿå…¬å¸ç›¸å…³çš„é—®é¢˜äº†ã€‚è¿™å°±æ˜¯å¾®è°ƒï¼</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca55df15cfa348889348d8bb80dd7f8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771225115&amp;x-signature=pmr%2FlL%2Bd9xeUG6%2B%2FRiDfKniUovU%3D" alt="image.png" loading="lazy"/></p>
<p>å…¶å®ç›®å‰å®ç° AI Agent å¤§éƒ¨åˆ†å°±æ˜¯ä¸Šé¢å››ç§ç±»å‹ + åœ¨å¯è§†åŒ–å¹³å°æ‹–æ‹‰æ‹½çš„æ–¹å¼ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Sasså®ç°ï¼Œè›‡å½¢æµåŠ¨å¸ƒå±€]]></title>    <link>https://juejin.cn/post/7604175912481243142</link>    <guid>https://juejin.cn/post/7604175912481243142</guid>    <pubDate>2026-02-09T06:59:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604175912481243142" data-draft-id="7604175912481210374" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Sasså®ç°ï¼Œè›‡å½¢æµåŠ¨å¸ƒå±€"/> <meta itemprop="keywords" content="å‰ç«¯,CSS"/> <meta itemprop="datePublished" content="2026-02-09T06:59:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¼šä¸€ä¸¢ä¸¢è¶æ³³çš„å’»ç‹—"/> <meta itemprop="url" content="https://juejin.cn/user/1803675742243277"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Sasså®ç°ï¼Œè›‡å½¢æµåŠ¨å¸ƒå±€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1803675742243277/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¼šä¸€ä¸¢ä¸¢è¶æ³³çš„å’»ç‹—
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T06:59:53.000Z" title="Mon Feb 09 2026 06:59:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">æ•ˆæœå±•ç¤º</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ee1dce4e36f4b2bb2e2b5744451f74e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lya5LiA5Lii5Lii6J225rOz55qE5ZK754uX:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771225192&amp;x-signature=Aebf%2Bgy09NP%2FFWSGLPHhnf29AFc%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27ca98d4bfb34a40b4aaac543ffd6696~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lya5LiA5Lii5Lii6J225rOz55qE5ZK754uX:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771225192&amp;x-signature=2dSS1kSzFgsqBY0jMJ%2FNzAd8fw4%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">ä½¿ç”¨Sassæ„å»ºæ™ºèƒ½æµç¨‹å›¾å¼ç½‘æ ¼å¸ƒå±€ç³»ç»Ÿ</h2>
<h3 data-id="heading-2">é¡¹ç›®èƒŒæ™¯</h3>
<p>åœ¨æ°‘å®¿åº·å…»å¾®å®è®­ç®¡ç†å¹³å°çš„å­¦ç”Ÿæ¨¡å—ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªç›´è§‚çš„æµç¨‹å›¾å¼ç•Œé¢ï¼Œç”¨äºå±•ç¤ºå®è®­ä»»åŠ¡çš„æ‰§è¡Œæ­¥éª¤ã€‚ä¼ ç»Ÿçš„CSSå¸ƒå±€éš¾ä»¥æ»¡è¶³è¿™ç§å¤æ‚çš„è¿çº¿éœ€æ±‚ï¼Œå› æ­¤æˆ‘ä»¬è®¾è®¡äº†ä¸€å¥—åŸºäºSassçš„æ™ºèƒ½ç½‘æ ¼å¸ƒå±€ç³»ç»Ÿã€‚</p>
<h3 data-id="heading-3">æ ¸å¿ƒè®¾è®¡æ€è·¯</h3>
<h4 data-id="heading-4">1. è›‡å½¢æµåŠ¨å¸ƒå±€</h4>
<p>ç³»ç»Ÿé‡‡ç”¨è›‡å½¢æµåŠ¨è®¾è®¡ï¼Œå¥‡æ•°è¡Œä»å·¦åˆ°å³ï¼Œå¶æ•°è¡Œä»å³åˆ°å·¦ï¼Œå½¢æˆè‡ªç„¶çš„è§†è§‰å¼•å¯¼è·¯å¾„ã€‚</p>
<h4 data-id="heading-5">2. ä¼ªå…ƒç´ è¿çº¿æŠ€æœ¯</h4>
<p>åˆ©ç”¨CSSä¼ªå…ƒç´ (<code>::before</code>, <code>::after</code>)åŠ¨æ€ç”Ÿæˆè¿æ¥çº¿å’Œç®­å¤´ï¼Œé¿å…é¢å¤–çš„DOMå…ƒç´ ã€‚</p>
<h4 data-id="heading-6">3. æ•°å­¦è®¡ç®—é©±åŠ¨</h4>
<p>é€šè¿‡Sassçš„æ•°å­¦å‡½æ•°å’Œå¾ªç¯ï¼Œå®ç°å¸ƒå±€çš„è‡ªåŠ¨åŒ–è®¡ç®—ã€‚</p>
<h3 data-id="heading-7">å…³é”®æŠ€æœ¯å®ç°</h3>
<h4 data-id="heading-8">Sasså˜é‡å®šä¹‰</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-variable">$grid-columns</span>: <span class="hljs-number">4</span>;                    <span class="hljs-comment">// ç½‘æ ¼åˆ—æ•°</span>
<span class="hljs-variable">$max-grid-items</span>: <span class="hljs-number">30</span>;                 <span class="hljs-comment">// æœ€å¤§ç½‘æ ¼é¡¹æ•°</span>
<span class="hljs-variable">$gap-y</span>: <span class="hljs-number">34px</span>;                        <span class="hljs-comment">// å‚ç›´é—´è·</span>
<span class="hljs-variable">$line-ab-top</span>: <span class="hljs-number">20px</span>;                  <span class="hljs-comment">// è¿çº¿é¡¶éƒ¨åç§»</span>
</code></pre>
<h4 data-id="heading-9">æ™ºèƒ½ä½ç½®è®¡ç®—</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@for</span> <span class="hljs-variable">$i</span> from <span class="hljs-number">1</span> through <span class="hljs-variable">$max-grid-items</span> {
  <span class="hljs-variable">$row</span>: math.<span class="hljs-built_in">ceil</span>(math.<span class="hljs-built_in">div</span>(<span class="hljs-variable">$i</span>, <span class="hljs-variable">$grid-columns</span>));           <span class="hljs-comment">// è®¡ç®—è¡Œå·</span>
  <span class="hljs-variable">$col_in_row</span>: <span class="hljs-variable">$i</span> - (<span class="hljs-variable">$row</span> - <span class="hljs-number">1</span>) * <span class="hljs-variable">$grid-columns</span>;           <span class="hljs-comment">// è®¡ç®—åˆ—å·</span>
  <span class="hljs-variable">$direction</span>: <span class="hljs-built_in">if</span>(<span class="hljs-variable">$row</span> % <span class="hljs-number">2</span> == <span class="hljs-number">1</span>, <span class="hljs-variable">$col_in_row</span>, <span class="hljs-variable">$grid-columns</span> - <span class="hljs-variable">$col_in_row</span> + <span class="hljs-number">1</span>); <span class="hljs-comment">// è›‡å½¢æ–¹å‘</span>
}
</code></pre>
<h4 data-id="heading-10">å››ç§è¿çº¿æ¨¡å¼å¤„ç†</h4>
<h5 data-id="heading-11">1. å•è¡Œä¸­é—´é¡¹ï¼ˆæ°´å¹³å³å‘ï¼‰</h5>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// æ°´å¹³è™šçº¿ + å³ç®­å¤´</span>
&amp;<span class="hljs-selector-pseudo">::after</span> { <span class="hljs-attribute">border-top</span>: <span class="hljs-number">1px</span> dashed <span class="hljs-number">#626c85</span>; }
&amp;<span class="hljs-selector-pseudo">::before</span> { <span class="hljs-attribute">content</span>: <span class="hljs-variable">$arrow-right-svg</span>; }
</code></pre>
<h5 data-id="heading-12">2. åŒè¡Œä¸­é—´é¡¹ï¼ˆæ°´å¹³å·¦å‘ï¼‰</h5>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// æ°´å¹³è™šçº¿ + å·¦ç®­å¤´ï¼ˆåå‘ï¼‰</span>
&amp;<span class="hljs-selector-pseudo">::after</span> { <span class="hljs-attribute">left</span>: <span class="hljs-built_in">calc</span>((<span class="hljs-number">100%</span> - <span class="hljs-variable">$item-inner-width</span> - <span class="hljs-variable">$line-gap</span>) * -<span class="hljs-number">1</span>); }
&amp;<span class="hljs-selector-pseudo">::before</span> { <span class="hljs-attribute">content</span>: <span class="hljs-variable">$arrow-left-svg</span>; }
</code></pre>
<h5 data-id="heading-13">3. å•è¡Œæœ€å³ä¾§ï¼ˆå‚ç›´å‘ä¸‹è½¬å¼¯ï¼‰</h5>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// å‚ç›´å¼¯æ›²çº¿ + ä¸‹ç®­å¤´</span>
&amp;<span class="hljs-selector-pseudo">::after</span> { 
  <span class="hljs-attribute">height</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">100%</span> + <span class="hljs-variable">$gap-y</span>);
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">0</span> <span class="hljs-number">12px</span> <span class="hljs-number">12px</span> <span class="hljs-number">0</span>;
  <span class="hljs-attribute">border-left</span>: none;
}
</code></pre>
<h5 data-id="heading-14">4. åŒè¡Œæœ€å·¦ä¾§ï¼ˆå‚ç›´å‘ä¸Šè½¬å¼¯ï¼‰</h5>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// å‚ç›´å¼¯æ›²çº¿ + ä¸Šç®­å¤´</span>
&amp;<span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">100%</span> + <span class="hljs-variable">$gap-y</span>);
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">12px</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">border-right</span>: none;
}
</code></pre>
<h3 data-id="heading-15">æŠ€æœ¯äº®ç‚¹</h3>
<h4 data-id="heading-16">1. Data URIå›¾æ ‡åµŒå…¥</h4>
<p>ä½¿ç”¨Data URIæ ¼å¼åµŒå…¥SVGç®­å¤´ï¼Œå‡å°‘HTTPè¯·æ±‚ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-variable">$arrow-right-svg</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">"data:image/svg+xml;utf8,&lt;svg&gt;...&lt;/svg&gt;"</span>);
</code></pre>
<h4 data-id="heading-17">2. å“åº”å¼è®¡ç®—</h4>
<p>æ‰€æœ‰å°ºå¯¸éƒ½åŸºäºå˜é‡è®¡ç®—ï¼Œä¾¿äºç»´æŠ¤å’Œè°ƒæ•´ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-attribute">width</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">100%</span> - <span class="hljs-variable">$item-inner-width</span> - (<span class="hljs-variable">$line-gap</span> * <span class="hljs-number">2</span>));
</code></pre>
<h4 data-id="heading-18">3. è¾¹ç•Œæ¡ä»¶å¤„ç†</h4>
<p>è‡ªåŠ¨è¯†åˆ«é¦–å°¾é¡¹ï¼Œé¿å…å¤šä½™çš„è¿çº¿ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">&amp;<span class="hljs-selector-pseudo">:last-of-type</span><span class="hljs-selector-pseudo">::after</span> { <span class="hljs-attribute">content</span>: none; }
&amp;<span class="hljs-selector-pseudo">:last-of-type</span><span class="hljs-selector-pseudo">::before</span> { <span class="hljs-attribute">content</span>: none; }
</code></pre>
<h3 data-id="heading-19">Vueç»„ä»¶é›†æˆ</h3>
<h4 data-id="heading-20">æ¨¡æ¿ç»“æ„</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="bg-[#016cff1a] p-20"&gt;
    &lt;div class="lk-grid pl-40!"&gt;
      &lt;div v-for="item in 15" :key="item" class="grid-item"&gt;
        &lt;div class="inner"&gt;å±•ç¤º{{ item }}&lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<h4 data-id="heading-21">æ ·å¼ä½œç”¨åŸŸ</h4>
<p>ä½¿ç”¨<code>scoped</code>å±æ€§ç¡®ä¿æ ·å¼éš”ç¦»ï¼Œé¿å…å…¨å±€æ±¡æŸ“ã€‚</p>
<h3 data-id="heading-22">æ€§èƒ½ä¼˜åŒ–è€ƒè™‘</h3>
<ol>
<li><strong>ä¼ªå…ƒç´ æ€§èƒ½</strong>ï¼šCSSä¼ªå…ƒç´ æ¯”é¢å¤–DOMå…ƒç´ æ€§èƒ½æ›´å¥½</li>
<li><strong>è®¡ç®—ç¼“å­˜</strong>ï¼šSassç¼–è¯‘æ—¶å®Œæˆæ‰€æœ‰è®¡ç®—ï¼Œè¿è¡Œæ—¶æ— æ€§èƒ½å¼€é”€</li>
<li><strong>å›¾æ ‡ä¼˜åŒ–</strong>ï¼šå†…è”SVGé¿å…å›¾æ ‡åŠ è½½å»¶è¿Ÿ</li>
</ol>
<h3 data-id="heading-23">æ‰©å±•æ€§è®¾è®¡</h3>
<p>ç³»ç»Ÿæ”¯æŒé€šè¿‡ä¿®æ”¹å˜é‡è½»æ¾è°ƒæ•´ï¼š</p>
<ul>
<li>ä¿®æ”¹<code>$grid-columns</code>æ”¹å˜åˆ—æ•°</li>
<li>è°ƒæ•´<code>$max-grid-items</code>æ”¯æŒæ›´å¤šæ­¥éª¤</li>
<li>æ›´æ”¹é¢œè‰²å˜é‡é€‚é…ä¸åŒä¸»é¢˜</li>
</ul>
<h3 data-id="heading-24">æ€»ç»“</h3>
<p>è¿™å¥—Sassç½‘æ ¼å¸ƒå±€ç³»ç»ŸæˆåŠŸè§£å†³äº†å¤æ‚æµç¨‹å›¾çš„å¯è§†åŒ–éœ€æ±‚ï¼Œé€šè¿‡æ•°å­¦è®¡ç®—å’ŒCSSä¼ªå…ƒç´ çš„å·§å¦™ç»“åˆï¼Œå®ç°äº†é«˜åº¦å¯å®šåˆ¶ä¸”æ€§èƒ½ä¼˜è‰¯çš„å¸ƒå±€æ–¹æ¡ˆã€‚è¯¥æŠ€æœ¯æ–¹æ¡ˆå¯ä»¥å¹¿æ³›åº”ç”¨äºå·¥ä½œæµã€è¿›åº¦è·Ÿè¸ªã€æ­¥éª¤å¼•å¯¼ç­‰åœºæ™¯ã€‚</p>
<p><strong>æŠ€æœ¯æ ˆ</strong>ï¼šVue 3 + Sass + CSS Grid + ä¼ªå…ƒç´ æŠ€æœ¯
<strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæµç¨‹å›¾ã€å·¥ä½œæµã€æ­¥éª¤å¼•å¯¼ã€è¿›åº¦å±•ç¤º</p>
<h2 data-id="heading-25">å®Œæ•´ä»£ç </h2>
<pre><code class="hljs language-vue" lang="vue">&lt;style lang="scss" scoped&gt;
@use 'sass:math';
$grid-columns: 7;
$max-grid-items: 30; //çº¿æ¡æ»šåŠ¨çš„ä¸ªæ•°
$gap-y: 34px;
$line-ab-top: 20px;
// å³ç®­å¤´ï¼šData URI æ ¼å¼ï¼ˆç›´æ¥å¤åˆ¶åˆ° content ä¸­ä½¿ç”¨ï¼‰
$arrow-right-svg: url("data:image/svg+xml;utf8,&lt;svg viewBox='0 0 24 24' fill='%23626c85' xmlns='http://www.w3.org/2000/svg'&gt;&lt;path d='M8 5v14l11-7z'/&gt;&lt;/svg&gt;");
// å·¦ç®­å¤´ï¼šData URI æ ¼å¼ï¼ˆç›´æ¥å¤åˆ¶åˆ° content ä¸­ä½¿ç”¨ï¼‰
$arrow-left-svg: url("data:image/svg+xml;utf8,&lt;svg  viewBox='0 0 24 24' fill='%23626c85' xmlns='http://www.w3.org/2000/svg'&gt;&lt;path d='M16 19l-7-7 7-7v14z'/&gt;&lt;/svg&gt;");
$arrow-width: 24px;
$arrow-height: 24px;

$item-height: 116px;
$item-inner-width: 50px;

// çº¿æ®µç•™ä¸‹çš„ç¼éš™
$line-gap: 10px;

@mixin grid-container() {
  display: grid;
  grid-template-columns: repeat($grid-columns, 1fr);
  row-gap: $gap-y;
}

@mixin grid-item() {
  height: $item-height;
  width: 100%;
  position: relative;
  // outline: 1px solid #ff0000;
}
@mixin grid-items-layout() {
  // å…ˆçº¿æ€§å¸ƒå±€ï¼Œç»™æ¯ä¸€ä¸ªitemç¡®å®šä½ç½®
  @for $i from 1 through $max-grid-items {
    $row: math.ceil(math.div($i, $grid-columns)); //ç¡®å®šå‡ è¡Œ
    $col_in_row: $i - ($row - 1) * $grid-columns; //ç¡®å®šåœ¨ç¬¬å‡ è¡Œçš„ç¬¬å‡ åˆ—
    // ä½¿ç”¨ % æ“ä½œç¬¦è¿›è¡Œæ¨¡è¿ç®—åˆ¤æ–­å¥‡å¶æ€§
    $direction: if($row % 2 == 1, $col_in_row, $grid-columns - $col_in_row + 1); //å•æ•°æ­£xï¼ŒåŒæ•°åx
    &amp;:nth-child(#{$i}) {
      grid-column: #{$direction};
      grid-row: #{$row};

      // ä¼ªå…ƒç´ ï¼Œç»˜åˆ¶çº¿æ®µç®­å¤´
      // åˆå§‹åŒ–
      &amp;:last-of-type::after {
        content: none;
      }
      &amp;:last-of-type::before {
        content: none;
      }

      // å•è¡Œï¼Œé™¤äº†å·¦å³ä¾§çš„
      @if $i % ($grid-columns * 2) &gt; 0 and $i % ($grid-columns * 2) &lt; $grid-columns {
        // çº¿æ®µ
        &amp;::after {
          content: '';
          position: absolute;
          top: $line-ab-top;
          left: calc($item-inner-width + $line-gap);
          display: block;
          width: calc(
            100% - $item-inner-width - ($line-gap * 2)
          ); //å æ»¡å°±æ˜¯100% - $item-inner-width;ä½†æˆ‘ä»¬å·¦å³ç•™ä¸ªç¼éš™
          border-top: 1px dashed #626c85;
        }
        // ç®­å¤´
        &amp;::before {
          content: $arrow-right-svg;
          position: absolute;
          // top: calc($line-ab-top - ($arrow-height/2));
          // right: calc(10px - ($arrow-width/2));
          top: $line-ab-top;
          right: $line-gap; //ç•™çš„ç¼éš™
          width: $arrow-width;
          height: $arrow-height;
          transform: translate(50%, -50%);
        }
      }
      // åŒè¡Œï¼Œé™¤äº†æœ€å·¦ä¾§çš„
      @if $i % ($grid-columns * 2) &gt; $grid-columns and $i % ($grid-columns * 2) &lt; $grid-columns * 2
      {
        &amp;:after {
          content: '';
          position: absolute;
          top: $line-ab-top;
          left: calc((100% - $item-inner-width - $line-gap) * -1);
          display: block;
          width: calc(
            100% - $item-inner-width - ($line-gap * 2)
          ); //å æ»¡å°±æ˜¯100% - $item-inner-width;ä½†æˆ‘ä»¬å·¦å³ç•™ä¸ªç¼éš™
          border-top: 1px dashed #626c85;
        }
        &amp;::before {
          content: $arrow-left-svg;
          position: absolute;
          left: calc(-100% + $line-gap + $item-inner-width);
          top: $line-ab-top;
          width: $arrow-width;
          height: $arrow-height;
          transform: translate(-50%, -50%);
        }
      }
      // å•è¡Œæœ€å³ä¾§çš„
      @if $i % ($grid-columns * 2) == $grid-columns {
        &amp;::after {
          content: '';
          position: absolute;
          top: $line-ab-top;
          left: calc($item-inner-width + $line-gap);
          display: block;
          width: 50%; //è¿™ä¸ªçœ‹ç€æ”¹
          height: calc(100% + $gap-y);
          border-radius: 0 12px 12px 0; //å¼§åº¦çœ‹ç€æ”¹
          border: 1px dashed #626c85;
          border-left: none;
        }
        &amp;::before {
          content: $arrow-left-svg;
          position: absolute;
          left: calc($item-inner-width + $line-gap);
          bottom: calc(($gap-y + $line-ab-top) * -1);
          width: $arrow-width;
          height: $arrow-height;
          transform: translate(-50%, 50%);
        }
      }
      // åŒè¡Œæœ€å·¦ä¾§
      @if $i % ($grid-columns * 2) == 0 {
        $box-width: 30%; //çœ‹ç€æ”¹
        &amp;::after {
          content: '';
          position: absolute;
          top: $line-ab-top;
          left: calc(($box-width + $line-gap) * -1);
          display: block;
          width: $box-width; //è¿™ä¸ªçœ‹ç€æ”¹
          height: calc(100% + $gap-y);
          border-radius: 12px 0 0 12px; //å¼§åº¦çœ‹ç€æ”¹
          border: 1px dashed #626c85;
          border-right: none;
        }
        &amp;::before {
          content: $arrow-right-svg;
          position: absolute;
          left: calc($line-gap * -1);
          bottom: calc(($gap-y + $line-ab-top) * -1);
          width: $arrow-width;
          height: $arrow-height;
          transform: translate(-50%, 50%);
        }
      }
    }
  }
}
.lk-grid {
  @include grid-container();
  .grid-item {
    @include grid-item();
    @include grid-items-layout();
    .inner {
      width: $item-inner-width;
      height: 50px;
      background-color: #016cff;
    }
  }
}
&lt;/style&gt;
&lt;template&gt;
  &lt;div class="bg-[#016cff1a] p-20"&gt;
    &lt;div class="lk-grid pl-40!"&gt;
      &lt;div v-for="item in 15" :key="item" class="grid-item"&gt;
        &lt;div class="inner"&gt;å±•ç¤º{{ item }}&lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸­å›½å¤šæ¨¡æ€å¤§æ¨¡å‹å†å²æ€§çªç ´ï¼šæ™ºæºEmu3è‡ªå›å½’ç»Ÿä¸€èŒƒå¼æŠ€æœ¯æ·±åº¦è§£è¯»]]></title>    <link>https://juejin.cn/post/7604036853130510351</link>    <guid>https://juejin.cn/post/7604036853130510351</guid>    <pubDate>2026-02-09T07:00:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604036853130510351" data-draft-id="7604315965874716706" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸­å›½å¤šæ¨¡æ€å¤§æ¨¡å‹å†å²æ€§çªç ´ï¼šæ™ºæºEmu3è‡ªå›å½’ç»Ÿä¸€èŒƒå¼æŠ€æœ¯æ·±åº¦è§£è¯»"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-02-09T07:00:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="indieAI"/> <meta itemprop="url" content="https://juejin.cn/user/4488643649743614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸­å›½å¤šæ¨¡æ€å¤§æ¨¡å‹å†å²æ€§çªç ´ï¼šæ™ºæºEmu3è‡ªå›å½’ç»Ÿä¸€èŒƒå¼æŠ€æœ¯æ·±åº¦è§£è¯»
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4488643649743614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    indieAI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T07:00:01.000Z" title="Mon Feb 09 2026 07:00:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2026å¹´1æœˆ28æ—¥ï¼ŒåŒ—äº¬æ™ºæºäººå·¥æ™ºèƒ½ç ”ç©¶é™¢ï¼ˆBAAIï¼‰åœ¨å›½é™…é¡¶çº§å­¦æœ¯æœŸåˆŠã€Šè‡ªç„¶ã€‹ï¼ˆNatureï¼‰æ­£åˆŠå‘è¡¨é‡ç£…ç ”ç©¶æˆæœâ€”â€”åŸºäºâ€œé¢„æµ‹ä¸‹ä¸€ä¸ªè¯å…ƒâ€ï¼ˆNext-Token Prediction, NTPï¼‰çš„å¤šæ¨¡æ€å¤§æ¨¡å‹Emu3ã€‚è¿™æ˜¯æˆ‘å›½ç§‘ç ”æœºæ„ä¸»å¯¼çš„å¤§æ¨¡å‹æˆæœé¦–æ¬¡ç™»ä¸ŠNatureå°é¢ï¼Œæ ‡å¿—ç€ä¸­å›½åœ¨äººå·¥æ™ºèƒ½åŸºç¡€ç†è®ºç ”ç©¶çš„åŸå§‹åˆ›æ–°èƒ½åŠ›å·²è·»èº«ä¸–ç•Œæœ€å‰æ²¿ã€‚</p>
<p>Natureç¼–è¾‘è¯„ä»·é“ï¼šâ€œEmu3ä»…åŸºäºâ€˜é¢„æµ‹ä¸‹ä¸€ä¸ªtokenâ€™å®ç°äº†å¤§è§„æ¨¡æ–‡æœ¬ã€å›¾åƒå’Œè§†é¢‘çš„ç»Ÿä¸€å­¦ä¹ ï¼Œå…¶åœ¨ç”Ÿæˆä¸æ„ŸçŸ¥ä»»åŠ¡ä¸Šçš„æ€§èƒ½å¯ä¸ä½¿ç”¨ä¸“é—¨è·¯çº¿ç›¸å½“ï¼Œè¿™ä¸€æˆæœå¯¹æ„å»ºå¯æ‰©å±•ã€ç»Ÿä¸€çš„å¤šæ¨¡æ€æ™ºèƒ½ç³»ç»Ÿå…·æœ‰é‡è¦æ„ä¹‰ï¼Œæœ‰æœ›æ¨åŠ¨åŸç”Ÿå¤šæ¨¡æ€åŠ©æ‰‹ã€ä¸–ç•Œæ¨¡å‹ä»¥åŠå…·èº«æ™ºèƒ½ç­‰æ–¹å‘çš„å‘å±•ã€‚â€</p>
<p>æœ¬æ–‡å°†æ·±åº¦è§£æEmu3çš„æŠ€æœ¯çªç ´ã€æ¶æ„åˆ›æ–°ã€æ€§èƒ½è¡¨ç°åŠäº§ä¸šå½±å“ï¼Œä¸ºAIæŠ€æœ¯ç ”ç©¶è€…ã€æ¶æ„å¸ˆå’Œå†³ç­–è€…æä¾›å…¨é¢è®¤çŸ¥æ¡†æ¶ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€çªç ´ä»·å€¼ï¼šä¸­å›½AIç§‘ç ”å›½é™…åœ°ä½çš„å†å²æ€§è·ƒå‡</h2>
<h3 data-id="heading-1">1.1 ä»è·Ÿéšåˆ°å¼•é¢†çš„æŠ€æœ¯èŒƒå¼è½¬æ¢</h3>
<p>è‡ª2018å¹´GPTæ¨¡å‹ä»¥è‡ªå›å½’è·¯çº¿å¼€å¯è¯­è¨€å¤§æ¨¡å‹æ—¶ä»£ä»¥æ¥ï¼Œå¤šæ¨¡æ€é¢†åŸŸé•¿æœŸé™·å…¥æŠ€æœ¯è·¯çº¿å‰²è£‚ï¼šè§†è§‰ç”Ÿæˆç”±æ‰©æ•£æ¨¡å‹ä¸»å¯¼ï¼Œè§†è§‰è¯­è¨€ç†è§£ä¾èµ–CLIP+LLMçš„ç»„åˆæ¶æ„ï¼Œè§†é¢‘ç”Ÿæˆæ›´æ˜¯Soraç­‰æ‰©æ•£æ¨¡å‹çš„ä¸“å±é¢†åœ°ã€‚è¿™ç§â€œä¸“æ¨¡ä¸“ç”¨â€çš„å±€é¢å¯¼è‡´AIç³»ç»Ÿå¤æ‚åº¦é«˜ã€ç ”å‘æˆæœ¬å·¨å¤§ã€åº”ç”¨åœºæ™¯å—é™ã€‚</p>
<p>Emu3çš„çªç ´æ„ä¹‰åœ¨äºç»ˆç»“äº†è¿™ç§æŠ€æœ¯å‰²è£‚ï¼Œé¦–æ¬¡è¯æ˜ä»…é€šè¿‡â€œé¢„æµ‹ä¸‹ä¸€ä¸ªè¯å…ƒâ€è¿™ä¸€å•ä¸€ç›®æ ‡ï¼Œå°±èƒ½ç»Ÿä¸€æ–‡æœ¬ã€å›¾åƒã€è§†é¢‘ä¸‰ç§æ¨¡æ€çš„å­¦ä¹ ã€‚è¿™ä¸ä»…ç®€åŒ–äº†å¤šæ¨¡æ€AIæ¶æ„ï¼Œæ›´ç¡®ç«‹äº†ä¸­å›½åœ¨AIåŸºç¡€ç†è®ºåˆ›æ–°ä¸­çš„å¼•é¢†åœ°ä½ã€‚</p>
<h3 data-id="heading-2">1.2 åŸå§‹åˆ›æ–°èƒ½åŠ›çš„å›½é™…è®¤å¯</h3>
<p>ä½œä¸ºç»§DeepSeekä¹‹åä¸­å›½AIå›¢é˜Ÿçš„åˆä¸€é‡Œç¨‹ç¢‘å¼æˆæœï¼ŒEmu3ç™»ä¸ŠNatureå°é¢å…·æœ‰åŒé‡è±¡å¾æ„ä¹‰ï¼š</p>
<ul>
<li><strong>å­¦æœ¯è®¤å¯</strong>ï¼šNatureä½œä¸ºå›½é™…ç§‘å­¦ç•Œæœ€é«˜æ®¿å ‚ä¹‹ä¸€ï¼Œå¯¹Emu3çš„è®¤å¯ä»£è¡¨ç€å›½é™…ç§‘å­¦å…±åŒä½“å¯¹ä¸­å›½AIåŸºç¡€ç ”ç©¶è´¨é‡çš„æœ€é«˜è¯„ä»·ã€‚</li>
<li><strong>æŠ€æœ¯è‡ªä¿¡</strong>ï¼šEmu3é€‰æ‹©â€œç¡¬æ ¸åŸåˆ›ç†è®ºâ€è€Œéâ€œæ€§ä»·æ¯”â€è·¯çº¿ï¼Œè¯æ˜ä¸­å›½AIå·²ä»åº”ç”¨åˆ›æ–°è½¬å‘åº•å±‚æ¶æ„åˆ›æ–°ã€‚</li>
</ul>
<p>å‰OpenAIæ”¿ç­–ä¸»ç®¡ã€ç°Anthropicè”åˆåˆ›å§‹äººæ°å…‹Â·å…‹æ‹‰å…‹è¯„ä»·Emu3ï¼šâ€œä¸ä¾èµ–èŠ±å“¨çš„æ¶æ„æŠ€å·§ï¼Œä»…ç”¨æœ€åŸºç¡€çš„é¢„æµ‹ä¸‹ä¸€ä¸ªtokençš„é€»è¾‘ï¼Œè¿™ç§â€˜ç®€å•â€™è¢«è§†ä¸ºå…·å¤‡å¼ºå¤§çš„æ‰©å±•æ½œåŠ›ã€‚â€</p>
<h2 data-id="heading-3">äºŒã€æŠ€æœ¯åŸç†ï¼šè‡ªå›å½’è·¯çº¿å¦‚ä½•ç»Ÿä¸€å¤šæ¨¡æ€å­¦ä¹ </h2>
<h3 data-id="heading-4">2.1 ç»Ÿä¸€è¡¨ç¤ºç©ºé—´çš„æ„å»ºæœºåˆ¶</h3>
<p>Emu3çš„æ ¸å¿ƒåˆ›æ–°åœ¨äºå°†ä¸åŒæ¨¡æ€æ•°æ®æ˜ å°„åˆ°åŒä¸€ç¦»æ•£è¡¨ç¤ºç©ºé—´ã€‚ä¼ ç»Ÿå¤šæ¨¡æ€æ¨¡å‹é€šå¸¸é‡‡ç”¨åˆ†ç¦»çš„ç¼–ç å™¨ï¼ˆå¦‚CLIPç¼–ç å›¾åƒã€BERTç¼–ç æ–‡æœ¬ï¼‰ï¼Œç„¶ååœ¨ç‰¹å¾ç©ºé—´è¿›è¡Œå¯¹é½ï¼Œè¿™ç§â€œæ‹¼æ¥å¼â€æ¶æ„å­˜åœ¨æ¨¡æ€è½¬æ¢æŸè€—å’Œè®­ç»ƒç›®æ ‡ä¸ä¸€è‡´é—®é¢˜ã€‚</p>
<p>Emu3é€šè¿‡è®¾è®¡ç»Ÿä¸€çš„è§†è§‰åˆ†è¯å™¨ï¼ˆTokenizerï¼‰ï¼Œå°†512Ã—512å›¾åƒæˆ–540Ã—960è§†é¢‘ç‰‡æ®µï¼ˆ4å¸§ï¼‰é«˜æ•ˆå‹ç¼©ä¸º4096ä¸ªç¦»æ•£tokenã€‚è¯¥åˆ†è¯å™¨åŸºäºSBER-MoVQGANæ¶æ„ï¼Œåˆ›æ–°æ€§åŠ å…¥3Då·ç§¯æ ¸ä»¥åŒæ—¶å¤„ç†æ—¶ç©ºä¿¡æ¯ã€‚</p>
<p>å…³é”®è®¾è®¡å‚æ•°ï¼š</p>
<ul>
<li>ç æœ¬å¤§å°ï¼ˆcodebook_sizeï¼‰ï¼š32768</li>
<li>æ ‡è®°ç»´åº¦ï¼ˆembed_dimï¼‰ï¼š4</li>
<li>å‹ç¼©æ¯”ï¼šå›ºå®šï¼ˆé€‚é…ä»»æ„æ—¶ç©ºåˆ†è¾¨ç‡è¾“å…¥ï¼‰</li>
<li>æ—¶åºä¸‹é‡‡æ ·å› å­ï¼ˆtemporal_downsample_factorï¼‰ï¼š4</li>
</ul>
<h3 data-id="heading-5">2.2 çº¯è‡ªå›å½’é¢„æµ‹çš„æ•°å­¦è¡¨è¾¾</h3>
<p>ç»™å®šä¸€ä¸ªå¤šæ¨¡æ€åºåˆ—<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mo stretchy="false">[</mo><msub><mi>t</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>t</mi><mn>2</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>t</mi><mi>n</mi></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">S = [t_1, t_2, ..., t_n]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">]</span></span></span></span></span>ï¼Œå…¶ä¸­<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">t_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>å¯ä»¥æ˜¯æ–‡æœ¬tokenã€è§†è§‰tokenæˆ–åŠ¨ä½œtokenï¼ŒEmu3çš„è®­ç»ƒç›®æ ‡æ˜¯æœ€å¤§åŒ–åºåˆ—çš„è”åˆæ¦‚ç‡ï¼š</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>S</mi><mo stretchy="false">)</mo><mo>=</mo><munderover><mo>âˆ</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi>P</mi><mo stretchy="false">(</mo><msub><mi>t</mi><mi>i</mi></msub><mi mathvariant="normal">âˆ£</mi><msub><mi>t</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>t</mi><mn>2</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>t</mi><mrow><mi>i</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo separator="true">;</mo><mi>Î¸</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(S) = \prod_{i=1}^{n} P(t_i | t_1, t_2, ..., t_{i-1}; \theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em;"/><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"/><span><span class="mop op-symbol large-op">âˆ</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord">âˆ£</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span/></span></span></span></span></span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="mclose">)</span></span></span></span></span></div>
<p>å…¶ä¸­<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¸</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span></span></span></span></span>ä¸ºæ¨¡å‹å‚æ•°ã€‚é€šè¿‡æ ‡å‡†çš„äº¤å‰ç†µæŸå¤±å‡½æ•°ä¼˜åŒ–ï¼š</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="script">L</mi><mo>=</mo><mo>âˆ’</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi>log</mi><mo>â¡</mo><mi>P</mi><mo stretchy="false">(</mo><msub><mi>t</mi><mi>i</mi></msub><mi mathvariant="normal">âˆ£</mi><msub><mi>t</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>t</mi><mn>2</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>t</mi><mrow><mi>i</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo separator="true">;</mo><mi>Î¸</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathcal{L} = -\sum_{i=1}^{n} \log P(t_i | t_1, t_2, ..., t_{i-1}; \theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathcal">L</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em;"/><span class="mord">âˆ’</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"/><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord">âˆ£</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span/></span></span></span></span></span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="mclose">)</span></span></span></span></span></div>
<p>ä¸ºé¿å…è§†è§‰tokenå æ¯”è¿‡é«˜ä¸»å¯¼è®­ç»ƒï¼Œç ”ç©¶å›¢é˜Ÿå°†è§†è§‰tokençš„æŸå¤±æƒé‡è®¾ä¸º0.5ï¼Œç¡®ä¿æ¨¡å‹å¹³è¡¡å­¦ä¹ å„æ¨¡æ€ç‰¹å¾ã€‚</p>
<h3 data-id="heading-6">2.3 å¤šæ¨¡æ€åºåˆ—çš„æ•°æ®æ ¼å¼è®¾è®¡</h3>
<p>ä¸ºå®ç°æ–‡æœ¬ã€å›¾åƒã€è§†é¢‘çš„ç»Ÿä¸€è¾“å…¥ï¼ŒEmu3å®šä¹‰äº†ç»“æ„åŒ–çš„å¤šæ¨¡æ€åºåˆ—æ ¼å¼ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-attr">[BOS]</span> {<span class="hljs-selector-tag">caption</span> text} <span class="hljs-selector-attr">[SOV]</span> {meta text} <span class="hljs-selector-attr">[SOT]</span> {vision tokens} <span class="hljs-selector-attr">[EOV]</span> <span class="hljs-selector-attr">[EOS]</span>
</code></pre>
<p>ç‰¹æ®ŠtokenåŠŸèƒ½è¯´æ˜ï¼š</p>
<ul>
<li><code>[BOS]/[EOS]</code>ï¼šæ–‡æœ¬åˆ†è¯å™¨åŸç”Ÿçš„å¼€å§‹/ç»“æŸæ ‡è®°</li>
<li><code>[SOV]</code>ï¼ˆStart of Visionï¼‰ï¼šè§†è§‰è¾“å…¥å¼€å§‹æ ‡è®°</li>
<li><code>[SOT]</code>ï¼ˆStart of Vision Tokensï¼‰ï¼šè§†è§‰tokenå¼€å§‹æ ‡è®°</li>
<li><code>[EOV]</code>ï¼ˆEnd of Visionï¼‰ï¼šè§†è§‰è¾“å…¥ç»“æŸæ ‡è®°</li>
<li><code>[EOL]/[EOF]</code>ï¼šæ’å…¥è§†è§‰tokenä¸­ï¼Œåˆ†åˆ«è¡¨ç¤ºæ¢è¡Œå’Œå¸§è¾¹ç•Œ</li>
</ul>
<h2 data-id="heading-7">ä¸‰ã€æ¶æ„åˆ›æ–°ï¼šæç®€ç»Ÿä¸€çš„Transformerè®¾è®¡</h2>
<h3 data-id="heading-8">3.1 çº¯è§£ç å™¨æ¶æ„çš„æ ¸å¿ƒè®¾è®¡</h3>
<p>Emu3æ²¿ç”¨LLMçš„è§£oder-onlyæ¶æ„ï¼Œå‚è€ƒLlama-2è®¾è®¡ï¼Œä»…é’ˆå¯¹å¤šæ¨¡æ€åœºæ™¯åšå°‘é‡é€‚é…ï¼š</p>
<p><strong>æ ¸å¿ƒé…ç½®</strong>ï¼š</p>
<ul>
<li>å‚æ•°é‡ï¼š130äº¿ï¼ˆåŸºç¡€ç‰ˆæœ¬ï¼‰</li>
<li>å±‚æ•°ï¼š32å±‚Transformerè§£ç å™¨</li>
<li>æ³¨æ„åŠ›å¤´æ•°ï¼š32å¤´</li>
<li>éšè—ç»´åº¦ï¼š4096</li>
<li>è¯æ±‡è¡¨å¤§å°ï¼š32768ï¼ˆå…±äº«ç æœ¬ï¼‰</li>
</ul>
<p><strong>æ¶æ„ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>å½’ä¸€åŒ–ï¼šé‡‡ç”¨RMSNormï¼Œæå‡è®­ç»ƒç¨³å®šæ€§</li>
<li>æ³¨æ„åŠ›æœºåˆ¶ï¼šä½¿ç”¨GQAï¼ˆGrouped Query Attentionï¼‰ï¼Œå¹³è¡¡æ€§èƒ½ä¸è®¡ç®—æ•ˆç‡</li>
<li>æ¿€æ´»å‡½æ•°ï¼šSwiGLUï¼Œå¢å¼ºæ¨¡å‹è¡¨è¾¾èƒ½åŠ›</li>
<li>å»åç½®ï¼šç§»é™¤QKVå’Œçº¿æ€§æŠ•å½±å±‚çš„åç½®ï¼Œå‡å°‘å‚æ•°å†—ä½™</li>
<li>æ–‡æœ¬åˆ†è¯å™¨ï¼šé‡‡ç”¨QwenTokenizerï¼Œæ”¯æŒå¤šè¯­è¨€å¤„ç†</li>
</ul>
<h3 data-id="heading-9">3.2 è§†è§‰åˆ†è¯å™¨çš„æŠ€æœ¯çªç ´</h3>
<p>Emu3VisionVQVectorQuantizeræ˜¯å‘é‡é‡åŒ–çš„å…³é”®æ¨¡å—ï¼Œå®ç°æœºåˆ¶åŒ…æ‹¬ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç®€åŒ–åçš„å‘é‡é‡åŒ–å™¨ç»“æ„ç¤ºæ„</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Emu3VisionVQVectorQuantizer</span>(nn.Module):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, config</span>):
        <span class="hljs-built_in">super</span>().__init__()
        self.codebook_size = config.codebook_size  <span class="hljs-comment"># 32768</span>
        self.embed_dim = config.embed_dim          <span class="hljs-comment"># 4</span>
        self.commitment_cost = config.commitment_cost  <span class="hljs-comment"># 0.25</span>
        <span class="hljs-comment"># 3Då·ç§¯å±‚å¤„ç†æ—¶ç©ºä¿¡æ¯</span>
        self.conv_3d = nn.Conv3d(in_channels, out_channels, 
                                 kernel_size=<span class="hljs-number">3</span>, padding=<span class="hljs-number">1</span>)
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, z</span>):
        <span class="hljs-comment"># å°†è¿ç»­ç‰¹å¾æ˜ å°„åˆ°æœ€è¿‘ç æœ¬å‘é‡</span>
        distances = torch.cdist(z, self.codebook)
        encoding_indices = torch.argmin(distances, dim=-<span class="hljs-number">1</span>)
        quantized = self.codebook[encoding_indices]
        <span class="hljs-comment"># ç›´é€šä¼°è®¡å™¨æ¢¯åº¦ä¼ é€’</span>
        quantized = z + (quantized - z).detach()
        <span class="hljs-keyword">return</span> quantized, encoding_indices
</code></pre>
<h3 data-id="heading-10">3.3 ä¸‰é˜¶æ®µè®­ç»ƒç­–ç•¥</h3>
<h4 data-id="heading-11">é˜¶æ®µä¸€ï¼šå¤§è§„æ¨¡é¢„è®­ç»ƒ</h4>
<ul>
<li>æ•°æ®æ··åˆï¼šæ–‡æœ¬+å›¾åƒ+è§†é¢‘æ··åˆåºåˆ—</li>
<li>ä¸Šä¸‹æ–‡é•¿åº¦ï¼šç¬¬ä¸€é˜¶æ®µ5120ï¼Œç¬¬äºŒé˜¶æ®µæ‰©å±•è‡³131072</li>
<li>å­¦ä¹ ç‡ï¼š5Ã—10â»âµï¼Œé‡‡ç”¨ä½™å¼¦é€€ç«ç­–ç•¥</li>
<li>å¹¶è¡Œç­–ç•¥ï¼šå¼ é‡å¹¶è¡Œï¼ˆTPï¼‰+ä¸Šä¸‹æ–‡å¹¶è¡Œï¼ˆCPï¼‰+æ•°æ®å¹¶è¡Œï¼ˆDPï¼‰</li>
</ul>
<h4 data-id="heading-12">é˜¶æ®µäºŒï¼šè´¨é‡å¾®è°ƒï¼ˆQFTï¼‰</h4>
<ul>
<li>æ•°æ®ç­›é€‰ï¼šå›¾åƒæ•°æ®é‡‡ç”¨HPSv2.1ã€MPSã€LAIONç¾å­¦åˆ†æ•°å¹³å‡å€¼ç­›é€‰</li>
<li>åˆ†è¾¨ç‡æå‡ï¼šè®­ç»ƒåˆ†è¾¨ç‡ä»512åƒç´ æå‡è‡³720åƒç´ </li>
<li>æŸå¤±è®¾è®¡ï¼šä»…å¯¹è§†è§‰tokenæ–½åŠ ç›‘ç£ï¼Œä¿æŒNTPç›®æ ‡ä¸å˜</li>
</ul>
<h4 data-id="heading-13">é˜¶æ®µä¸‰ï¼šç›´æ¥åå¥½ä¼˜åŒ–ï¼ˆDPOï¼‰</h4>
<ul>
<li>æ•°æ®æ„å»ºï¼šæ¯ä¸ªæç¤ºè¯ç”Ÿæˆ8-10ä¸ªæ ·æœ¬ï¼Œ3åæ ‡æ³¨è€…ä»è§†è§‰å¸å¼•åŠ›å’Œæç¤ºè¯å¯¹é½åº¦è¯„åˆ†</li>
<li>è®­ç»ƒç›®æ ‡ï¼šæœ€å°åŒ–DPOæŸå¤±ä¸NTPäº¤å‰ç†µæŸå¤±çš„ç»„åˆ</li>
<li>æ•ˆæœæå‡ï¼šäººç±»åå¥½åˆ†æ•°ä»52.3/57.3æå‡è‡³61.6/60.6</li>
</ul>
<h2 data-id="heading-14">å››ã€æ€§èƒ½å¯¹æ¯”ï¼šå…¨é¢è¶…è¶Šä¼ ç»Ÿå¤šæ¨¡æ€æ¨¡å‹</h2>
<h3 data-id="heading-15">4.1 å›¾åƒç”Ÿæˆæ€§èƒ½å¯¹æ¯”</h3>
<p>åœ¨MSCOCO-30K23ã€GenEval24ã€T2I-CompBench25ç­‰å¤šä¸ªåŸºå‡†æµ‹è¯•ä¸­ï¼ŒEmu3è¡¨ç°å‡ºè‰²ï¼š</p>









































<table><thead><tr><th>æ¨¡å‹</th><th>MSCOCO FIDâ†“</th><th>GenEvalå¾—åˆ†â†‘</th><th>T2I-CompBenchâ†‘</th></tr></thead><tbody><tr><td>Stable Diffusion 1.5</td><td>18.3</td><td>72.5</td><td>81.2</td></tr><tr><td>SDXL</td><td>15.6</td><td>75.8</td><td>84.7</td></tr><tr><td>DALL-E 3</td><td>12.1</td><td>79.3</td><td>88.4</td></tr><tr><td>Emu3</td><td><strong>11.8</strong></td><td><strong>80.2</strong></td><td><strong>88.9</strong></td></tr><tr><td>FLUX.1 (Dev)</td><td>11.9</td><td>80.1</td><td>88.7</td></tr></tbody></table>
<p><strong>å…³é”®å‘ç°</strong>ï¼šEmu3ä½œä¸ºçº¯è‡ªå›å½’æ¨¡å‹ï¼Œåœ¨å›¾åƒç”Ÿæˆè´¨é‡ä¸Šä¸æœ€å…ˆè¿›çš„æ‰©æ•£æ¨¡å‹ç›¸å½“ç”šè‡³ç•¥æœ‰ä¼˜åŠ¿ï¼Œæ‰“ç ´äº†â€œæ‰©æ•£æ¨¡å‹ä¸»å¯¼è§†è§‰ç”Ÿæˆâ€çš„ä¼ ç»Ÿè®¤çŸ¥ã€‚</p>
<h3 data-id="heading-16">4.2 è§†è§‰è¯­è¨€ç†è§£æ€§èƒ½</h3>
<p>åœ¨è§†è§‰é—®ç­”ã€å›¾åƒæè¿°ã€è·¨æ¨¡æ€æ£€ç´¢ç­‰ä»»åŠ¡ä¸­ï¼ŒEmu3çš„è¡¨ç°åŒæ ·å‡ºè‰²ï¼š</p>





























<table><thead><tr><th>æ¨¡å‹</th><th>VQA v2â†‘</th><th>TextCapsâ†‘</th><th>COCO Retrieval@5â†‘</th></tr></thead><tbody><tr><td>LLaVA-1.6 (13B)</td><td>78.3</td><td>82.7</td><td>76.4</td></tr><tr><td>Qwen-VL-Chat</td><td>79.1</td><td>83.5</td><td>77.2</td></tr><tr><td>Emu3</td><td><strong>79.8</strong></td><td><strong>84.1</strong></td><td><strong>78.0</strong></td></tr></tbody></table>
<p><strong>æŠ€æœ¯æ´å¯Ÿ</strong>ï¼šEmu3ä½œä¸ºä¸€ç§çº¯ç²¹çš„æ— ç¼–ç å™¨æ–¹æ³•ï¼Œåœ¨å¤šä¸ªåŸºå‡†æµ‹è¯•ä¸­è¾¾åˆ°äº†ä¸ç»„åˆå¼æ–¹æ³•ï¼ˆCLIP+LLMï¼‰ç›¸å½“çš„æ€§èƒ½ï¼Œè¯æ˜ç»Ÿä¸€çš„Transformeræ¶æ„å®Œå…¨æœ‰èƒ½åŠ›è‡ªä¸»å­¦ä¹ è·¨æ¨¡æ€å¯¹é½ã€‚</p>
<h3 data-id="heading-17">4.3 è§†é¢‘ç”Ÿæˆèƒ½åŠ›</h3>
<p>Emu3åŸç”Ÿæ”¯æŒ24å¸§/ç§’çš„5ç§’è§†é¢‘ç”Ÿæˆï¼Œå¹¶å¯é€šè¿‡è‡ªå›å½’æ–¹æ³•è¿›è¡Œæ‰©å±•ï¼š</p>
<ul>
<li><strong>VBenchè¯„åˆ†</strong>ï¼š81åˆ†ï¼Œè¶…è¿‡Open-Sora 1.2çš„78åˆ†</li>
<li><strong>ç”Ÿæˆæ–¹å¼</strong>ï¼šçº¯è‡ªå›å½’é€tokené¢„æµ‹ï¼Œè€Œéæ‰©æ•£æ¨¡å‹çš„è¿­ä»£å»å™ª</li>
<li><strong>æ‰©å±•èƒ½åŠ›</strong>ï¼šé€šè¿‡é¢„æµ‹æœªæ¥å¸§å®ç°è§†é¢‘å»¶å±•ï¼Œå±•ç°å¯¹ç‰©ç†ä¸–ç•Œç¯å¢ƒã€äººç±»ä¸åŠ¨ç‰©è¡Œä¸ºçš„åˆæ­¥æ¨¡æ‹Ÿèƒ½åŠ›</li>
</ul>
<h3 data-id="heading-18">4.4 å¤šæ¨¡æ€ç¼©æ”¾å®šå¾‹</h3>
<p>ç ”ç©¶å›¢é˜Ÿå‘ç°Emu3çš„æ€§èƒ½éšç€æ¨¡å‹å¤§å°å’Œè®­ç»ƒæ•°æ®é‡çš„å¢åŠ ï¼Œå‘ˆç°å‡ºæ¸…æ™°çš„å¹‚å¾‹ç¼©æ”¾è¡Œä¸ºï¼š</p>
<ul>
<li><strong>å›¾åƒç”Ÿæˆ</strong>ï¼šæ€§èƒ½éšå‚æ•°è§„æ¨¡å¢åŠ å‘ˆ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo>âˆ</mo><msup><mi>N</mi><mn>0.085</mn></msup></mrow><annotation encoding="application/x-tex">P \propto N^{0.085}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">âˆ</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0.085</span></span></span></span></span></span></span></span></span></span></span></span></span>æå‡</li>
<li><strong>è§†è§‰ç†è§£</strong>ï¼šæ€§èƒ½éšå‚æ•°è§„æ¨¡å¢åŠ å‘ˆ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo>âˆ</mo><msup><mi>N</mi><mn>0.072</mn></msup></mrow><annotation encoding="application/x-tex">P \propto N^{0.072}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">âˆ</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0.072</span></span></span></span></span></span></span></span></span></span></span></span></span>æå‡</li>
<li><strong>è§†é¢‘ç”Ÿæˆ</strong>ï¼šæ€§èƒ½éšå‚æ•°è§„æ¨¡å¢åŠ å‘ˆ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo>âˆ</mo><msup><mi>N</mi><mn>0.091</mn></msup></mrow><annotation encoding="application/x-tex">P \propto N^{0.091}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">âˆ</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0.091</span></span></span></span></span></span></span></span></span></span></span></span></span>æå‡</li>
</ul>
<p>è¿™ç§å¯é¢„æµ‹çš„ç¼©æ”¾å®šå¾‹ä¸ºå¤§è§„æ¨¡AIæ¨¡å‹ç ”å‘æä¾›äº†æ˜ç¡®çš„æŠ€æœ¯è·¯å¾„ã€‚</p>
<h2 data-id="heading-19">äº”ã€å®æˆ˜ä»£ç ï¼šåŸºäºEmu3åŸç†çš„ç®€åŒ–å¤šæ¨¡æ€ç†è§£/ç”Ÿæˆç¤ºä¾‹</h2>
<h3 data-id="heading-20">5.1 ç¯å¢ƒé…ç½®ä¸ä¾èµ–å®‰è£…</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># requirements.txt</span>
torch&gt;=<span class="hljs-number">2.1</span><span class="hljs-number">.0</span>
transformers&gt;=<span class="hljs-number">4.36</span><span class="hljs-number">.0</span>
accelerate&gt;=<span class="hljs-number">0.25</span><span class="hljs-number">.0</span>
einops&gt;=<span class="hljs-number">0.7</span><span class="hljs-number">.0</span>
pillow&gt;=<span class="hljs-number">10.0</span><span class="hljs-number">.0</span>
opencv-python&gt;=<span class="hljs-number">4.8</span><span class="hljs-number">.0</span>

<span class="hljs-comment"># å®‰è£…å‘½ä»¤</span>
<span class="hljs-comment"># pip install -r requirements.txt</span>
</code></pre>
<h3 data-id="heading-21">5.2 ç»Ÿä¸€å¤šæ¨¡æ€Tokenizerå®ç°</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn
<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer, AutoModel

<span class="hljs-keyword">class</span> <span class="hljs-title class_">UnifiedMultimodalTokenizer</span>:
    <span class="hljs-string">"""åŸºäºEmu3åŸç†çš„ç»Ÿä¸€å¤šæ¨¡æ€åˆ†è¯å™¨ç®€åŒ–å®ç°"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, vocab_size=<span class="hljs-number">32768</span>, embed_dim=<span class="hljs-number">4</span></span>):
        self.vocab_size = vocab_size
        self.embed_dim = embed_dim
        self.text_tokenizer = AutoTokenizer.from_pretrained(<span class="hljs-string">"Qwen/Qwen2.5-7B-Instruct"</span>)
        
        <span class="hljs-comment"># è§†è§‰ç¼–ç å™¨ç®€åŒ–å®ç°</span>
        self.visual_encoder = self._build_visual_encoder()
        self.codebook = nn.Embedding(vocab_size, embed_dim)
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_build_visual_encoder</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""ç®€åŒ–è§†è§‰ç¼–ç å™¨ï¼Œå®é™…åº”ä¸º3Då·ç§¯ç½‘ç»œ"""</span>
        <span class="hljs-keyword">return</span> nn.Sequential(
            nn.Conv2d(<span class="hljs-number">3</span>, <span class="hljs-number">64</span>, kernel_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">2</span>, padding=<span class="hljs-number">1</span>),
            nn.ReLU(),
            nn.Conv2d(<span class="hljs-number">64</span>, <span class="hljs-number">128</span>, kernel_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">2</span>, padding=<span class="hljs-number">1</span>),
            nn.ReLU(),
            nn.Conv2d(<span class="hljs-number">128</span>, <span class="hljs-number">256</span>, kernel_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">2</span>, padding=<span class="hljs-number">1</span>),
            nn.AdaptiveAvgPool2d((<span class="hljs-number">8</span>, <span class="hljs-number">8</span>))
        )
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">tokenize_text</span>(<span class="hljs-params">self, text</span>):
        <span class="hljs-string">"""æ–‡æœ¬åˆ†è¯"""</span>
        tokens = self.text_tokenizer.encode(text, add_special_tokens=<span class="hljs-literal">False</span>)
        <span class="hljs-keyword">return</span> tokens
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">tokenize_image</span>(<span class="hljs-params">self, image_tensor</span>):
        <span class="hljs-string">"""å›¾åƒåˆ†è¯ï¼šå®é™…åº”ä¸ºVQ-VAEå‹ç¼©è¿‡ç¨‹"""</span>
        <span class="hljs-comment"># æå–è§†è§‰ç‰¹å¾</span>
        features = self.visual_encoder(image_tensor)
        b, c, h, w = features.shape
        features = features.view(b, c, h*w).transpose(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)
        
        <span class="hljs-comment"># å‘é‡é‡åŒ–ç®€åŒ–å®ç°</span>
        flattened = features.reshape(-<span class="hljs-number">1</span>, c)
        distances = torch.cdist(flattened, self.codebook.weight)
        indices = torch.argmin(distances, dim=-<span class="hljs-number">1</span>)
        indices = indices.view(b, h*w)
        
        <span class="hljs-keyword">return</span> indices.tolist()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_multimodal_sequence</span>(<span class="hljs-params">self, text, image_tokens=<span class="hljs-literal">None</span></span>):
        <span class="hljs-string">"""æ„å»ºç»Ÿä¸€çš„å¤šæ¨¡æ€åºåˆ—"""</span>
        sequence = []
        
        <span class="hljs-comment"># æ·»åŠ æ–‡æœ¬å¼€å§‹æ ‡è®°</span>
        sequence.append(self.text_tokenizer.bos_token_id)
        
        <span class="hljs-comment"># æ·»åŠ æ–‡æœ¬token</span>
        text_tokens = self.tokenize_text(text)
        sequence.extend(text_tokens)
        
        <span class="hljs-keyword">if</span> image_tokens:
            <span class="hljs-comment"># æ·»åŠ è§†è§‰å¼€å§‹æ ‡è®°ï¼ˆç®€åŒ–å®ç°ï¼‰</span>
            sequence.append(self.vocab_size + <span class="hljs-number">1</span>)  <span class="hljs-comment"># [SOV]</span>
            <span class="hljs-comment"># æ·»åŠ è§†è§‰token</span>
            sequence.extend(image_tokens)
            sequence.append(self.vocab_size + <span class="hljs-number">2</span>)  <span class="hljs-comment"># [EOV]</span>
        
        <span class="hljs-comment"># æ·»åŠ åºåˆ—ç»“æŸæ ‡è®°</span>
        sequence.append(self.text_tokenizer.eos_token_id)
        
        <span class="hljs-keyword">return</span> sequence
</code></pre>
<h3 data-id="heading-22">5.3 ç®€åŒ–Transformeræ¨¡å‹æ¶æ„</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SimplifiedEmu3Decoder</span>(nn.Module):
    <span class="hljs-string">"""ç®€åŒ–çš„Emu3è§£ç å™¨å®ç°ï¼Œå±•ç¤ºç»Ÿä¸€å¤šæ¨¡æ€å­¦ä¹ åŸç†"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, vocab_size=<span class="hljs-number">32768</span>, hidden_dim=<span class="hljs-number">512</span>, num_layers=<span class="hljs-number">6</span>, num_heads=<span class="hljs-number">8</span></span>):
        <span class="hljs-built_in">super</span>().__init__()
        self.embedding = nn.Embedding(vocab_size + <span class="hljs-number">10</span>, hidden_dim)  <span class="hljs-comment"># é¢„ç•™ç‰¹æ®Štoken</span>
        self.layers = nn.ModuleList([
            self._build_decoder_layer(hidden_dim, num_heads) 
            <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_layers)
        ])
        self.fc_out = nn.Linear(hidden_dim, vocab_size)
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_build_decoder_layer</span>(<span class="hljs-params">self, hidden_dim, num_heads</span>):
        <span class="hljs-string">"""æ„å»ºå•å±‚è§£ç å™¨"""</span>
        <span class="hljs-keyword">return</span> nn.ModuleDict({
            <span class="hljs-string">'attn'</span>: nn.MultiheadAttention(hidden_dim, num_heads, batch_first=<span class="hljs-literal">True</span>),
            <span class="hljs-string">'ffn'</span>: nn.Sequential(
                nn.Linear(hidden_dim, hidden_dim * <span class="hljs-number">4</span>),
                nn.SiLU(),
                nn.Linear(hidden_dim * <span class="hljs-number">4</span>, hidden_dim)
            ),
            <span class="hljs-string">'norm1'</span>: nn.RMSNorm(hidden_dim),
            <span class="hljs-string">'norm2'</span>: nn.RMSNorm(hidden_dim)
        })
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, input_ids, attention_mask=<span class="hljs-literal">None</span></span>):
        <span class="hljs-string">"""å‰å‘ä¼ æ’­"""</span>
        x = self.embedding(input_ids)
        
        <span class="hljs-keyword">for</span> layer <span class="hljs-keyword">in</span> self.layers:
            <span class="hljs-comment"># è‡ªæ³¨æ„åŠ›</span>
            residual = x
            x = layer[<span class="hljs-string">'norm1'</span>](x)
            attn_output, _ = layer[<span class="hljs-string">'attn'</span>](
                x, x, x, 
                key_padding_mask=attention_mask <span class="hljs-keyword">if</span> attention_mask <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>
            )
            x = residual + attn_output
            
            <span class="hljs-comment"># å‰é¦ˆç½‘ç»œ</span>
            residual = x
            x = layer[<span class="hljs-string">'norm2'</span>](x)
            x = residual + layer[<span class="hljs-string">'ffn'</span>](x)
        
        logits = self.fc_out(x)
        <span class="hljs-keyword">return</span> logits
</code></pre>
<h3 data-id="heading-23">5.4 å¤šæ¨¡æ€æ¨ç†ç¤ºä¾‹</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">multimodal_generation_demo</span>():
    <span class="hljs-string">"""å±•ç¤ºç»Ÿä¸€å¤šæ¨¡æ€ç”Ÿæˆæµç¨‹"""</span>
    
    <span class="hljs-comment"># åˆå§‹åŒ–æ¨¡å‹å’Œåˆ†è¯å™¨</span>
    tokenizer = UnifiedMultimodalTokenizer()
    model = SimplifiedEmu3Decoder()
    
    <span class="hljs-comment"># ç¤ºä¾‹1ï¼šçº¯æ–‡æœ¬ç”Ÿæˆ</span>
    text_prompt = <span class="hljs-string">"ä¸€åªå¯çˆ±çš„æ©˜çŒ«ååœ¨çª—å°ä¸Šæ™’å¤ªé˜³"</span>
    text_tokens = tokenizer.tokenize_text(text_prompt)
    text_sequence = tokenizer.create_multimodal_sequence(text_prompt)
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ–‡æœ¬æç¤ºè¯: <span class="hljs-subst">{text_prompt}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ–‡æœ¬tokenæ•°: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(text_tokens)}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å®Œæ•´åºåˆ—é•¿åº¦: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(text_sequence)}</span>"</span>)
    
    <span class="hljs-comment"># ç¤ºä¾‹2ï¼šå›¾æ–‡äº¤é”™ç”Ÿæˆï¼ˆç®€åŒ–ï¼‰</span>
    multimodal_prompt = <span class="hljs-string">"å…ˆå±•ç¤ºä¸€å¼ æ—¥å‡ºæ—¶åˆ†çš„æµ·æ»©ç…§ç‰‡ï¼Œç„¶åæè¿°ç…§ç‰‡ä¸­çš„ç»†èŠ‚"</span>
    sequence = tokenizer.create_multimodal_sequence(multimodal_prompt)
    
    <span class="hljs-comment"># æ¨¡æ‹Ÿæ¨ç†è¿‡ç¨‹</span>
    <span class="hljs-keyword">with</span> torch.no_grad():
        input_tensor = torch.tensor([sequence])
        logits = model(input_tensor)
        predicted_tokens = torch.argmax(logits, dim=-<span class="hljs-number">1</span>)
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\nå¤šæ¨¡æ€ç”Ÿæˆå®Œæˆï¼"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"è¾“å…¥åºåˆ—é•¿åº¦: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(sequence)}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"é¢„æµ‹tokenæ•°: <span class="hljs-subst">{predicted_tokens.shape[-<span class="hljs-number">1</span>]}</span>"</span>)
    
    <span class="hljs-keyword">return</span> predicted_tokens

<span class="hljs-comment"># è¿è¡Œæ¼”ç¤º</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    predictions = multimodal_generation_demo()
</code></pre>
<h3 data-id="heading-24">5.5 å¤šæ¨¡æ€Promptå·¥ç¨‹ä¼˜åŒ–å®è·µ</h3>
<p>éšç€Emu3ç­‰ç»Ÿä¸€å¤šæ¨¡æ€å¤§æ¨¡å‹çš„æ™®åŠï¼Œè·¨æ¨¡æ€Promptè®¾è®¡é¢ä¸´æ–°çš„æŠ€æœ¯æŒ‘æˆ˜ï¼šå¦‚ä½•é«˜æ•ˆè¯„ä¼°æ–‡æœ¬-å›¾åƒ-è§†é¢‘è”åˆç”Ÿæˆçš„è´¨é‡ä¸€è‡´æ€§ï¼Ÿ</p>
<p><strong>ä¼ ç»Ÿæ–¹æ³•çš„å±€é™æ€§</strong>ï¼š</p>
<ol>
<li><strong>å•æ¨¡æ€è¯„ä¼°å‰²è£‚</strong>ï¼šåˆ†åˆ«è¯„ä¼°æ–‡æœ¬è´¨é‡ã€å›¾åƒè´¨é‡ã€è§†é¢‘è´¨é‡ï¼Œç¼ºä¹è·¨æ¨¡æ€ä¸€è‡´æ€§åº¦é‡</li>
<li><strong>äººå·¥æ ‡æ³¨æˆæœ¬é«˜</strong>ï¼šéœ€è¦ä¸“å®¶æ ‡æ³¨è€…åŒæ—¶å…·å¤‡æ–‡æœ¬ç†è§£ã€è§†è§‰æ„ŸçŸ¥ã€æ—¶åºåˆ†æèƒ½åŠ›</li>
<li><strong>è¯„ä¼°æ ‡å‡†ä¸ç»Ÿä¸€</strong>ï¼šä¸åŒå›¢é˜Ÿä½¿ç”¨ä¸åŒçš„è¯„ä¼°æŒ‡æ ‡å’ŒåŸºå‡†æ•°æ®é›†</li>
</ol>
<p><strong>ä¼˜åŒ–æ–¹æ¡ˆï¼šåŸºäºprompt-minder.comçš„å¤šæ¨¡æ€è¯„ä¼°API</strong></p>
<p>Emu3çš„ç»Ÿä¸€å¤šæ¨¡æ€å­¦ä¹ ä¸ºè·¨æ¨¡æ€Promptå·¥ç¨‹æå‡ºäº†æ–°èŒƒå¼ã€‚é€šè¿‡prompt-minder.comçš„å¤šæ¨¡æ€è¯„ä¼°APIï¼Œå¼€å‘è€…å¯ä»¥å»ºç«‹æ ‡å‡†åŒ–çš„è´¨é‡åŸºå‡†ï¼Œå®ç°ä»å•æ¨¡æ€åˆ°å¤šæ¨¡æ€Promptå·¥ç¨‹çš„å¹³æ»‘è¿‡æ¸¡ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ä½¿ç”¨prompt-minder.com APIè¿›è¡Œå¤šæ¨¡æ€è¯„ä¼°</span>
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> json

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MultimodalPromptEvaluator</span>:
    <span class="hljs-string">"""åŸºäºprompt-minder.comçš„å¤šæ¨¡æ€Promptè¯„ä¼°å™¨"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, api_key</span>):
        self.api_key = api_key
        self.base_url = <span class="hljs-string">"https://api.prompt-minder.com/v1"</span>
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">evaluate_multimodal_generation</span>(<span class="hljs-params">self, prompt, generated_content, content_type=<span class="hljs-string">"mixed"</span></span>):
        <span class="hljs-string">"""
        è¯„ä¼°å¤šæ¨¡æ€ç”Ÿæˆè´¨é‡
        content_type: "text" | "image" | "video" | "mixed"
        """</span>
        headers = {
            <span class="hljs-string">"Authorization"</span>: <span class="hljs-string">f"Bearer <span class="hljs-subst">{self.api_key}</span>"</span>,
            <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span>
        }
        
        payload = {
            <span class="hljs-string">"prompt"</span>: prompt,
            <span class="hljs-string">"generated_content"</span>: generated_content,
            <span class="hljs-string">"content_type"</span>: content_type,
            <span class="hljs-string">"metrics"</span>: [
                <span class="hljs-string">"cross_modal_alignment"</span>,  <span class="hljs-comment"># è·¨æ¨¡æ€å¯¹é½åº¦</span>
                <span class="hljs-string">"semantic_consistency"</span>,    <span class="hljs-comment"># è¯­ä¹‰ä¸€è‡´æ€§</span>
                <span class="hljs-string">"visual_fidelity"</span>,         <span class="hljs-comment"># è§†è§‰ä¿çœŸåº¦</span>
                <span class="hljs-string">"temporal_coherence"</span>       <span class="hljs-comment"># æ—¶åºè¿è´¯æ€§</span>
            ]
        }
        
        response = requests.post(
            <span class="hljs-string">f"<span class="hljs-subst">{self.base_url}</span>/evaluate/multimodal"</span>,
            headers=headers,
            data=json.dumps(payload)
        )
        
        <span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">200</span>:
            <span class="hljs-keyword">return</span> response.json()
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">f"è¯„ä¼°å¤±è´¥: <span class="hljs-subst">{response.text}</span>"</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">optimize_prompt_iteratively</span>(<span class="hljs-params">self, initial_prompt, target_modality=<span class="hljs-string">"mixed"</span>, iterations=<span class="hljs-number">3</span></span>):
        <span class="hljs-string">"""è¿­ä»£ä¼˜åŒ–å¤šæ¨¡æ€Prompt"""</span>
        optimized_prompt = initial_prompt
        evaluation_history = []
        
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(iterations):
            <span class="hljs-comment"># æ¨¡æ‹Ÿç”Ÿæˆå†…å®¹ï¼ˆå®é™…åº”ä¸ºæ¨¡å‹ç”Ÿæˆï¼‰</span>
            simulated_content = self._simulate_generation(optimized_prompt, target_modality)
            
            <span class="hljs-comment"># è¯„ä¼°ç”Ÿæˆè´¨é‡</span>
            evaluation = self.evaluate_multimodal_generation(
                optimized_prompt, 
                simulated_content, 
                target_modality
            )
            
            evaluation_history.append({
                <span class="hljs-string">"iteration"</span>: i + <span class="hljs-number">1</span>,
                <span class="hljs-string">"prompt"</span>: optimized_prompt,
                <span class="hljs-string">"scores"</span>: evaluation[<span class="hljs-string">"scores"</span>]
            })
            
            <span class="hljs-comment"># åŸºäºè¯„ä¼°ç»“æœä¼˜åŒ–Prompt</span>
            <span class="hljs-keyword">if</span> i &lt; iterations - <span class="hljs-number">1</span>:
                optimized_prompt = self._refine_prompt(
                    optimized_prompt, 
                    evaluation[<span class="hljs-string">"scores"</span>]
                )
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"final_prompt"</span>: optimized_prompt,
            <span class="hljs-string">"evaluation_history"</span>: evaluation_history
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_simulate_generation</span>(<span class="hljs-params">self, prompt, modality</span>):
        <span class="hljs-string">"""ç®€åŒ–ç”Ÿæˆè¿‡ç¨‹æ¨¡æ‹Ÿ"""</span>
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"text"</span>: <span class="hljs-string">f"åŸºäºæç¤ºè¯'<span class="hljs-subst">{prompt}</span>'ç”Ÿæˆçš„æ–‡æœ¬æè¿°"</span>,
            <span class="hljs-string">"image"</span>: <span class="hljs-string">"æ¨¡æ‹Ÿå›¾åƒæ•°æ®"</span>,
            <span class="hljs-string">"video"</span>: <span class="hljs-string">"æ¨¡æ‹Ÿè§†é¢‘æ•°æ®"</span>
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_refine_prompt</span>(<span class="hljs-params">self, prompt, scores</span>):
        <span class="hljs-string">"""åŸºäºè¯„ä¼°åˆ†æ•°ä¼˜åŒ–Prompt"""</span>
        <span class="hljs-comment"># ç®€åŒ–ä¼˜åŒ–é€»è¾‘</span>
        <span class="hljs-keyword">if</span> scores[<span class="hljs-string">"cross_modal_alignment"</span>] &lt; <span class="hljs-number">0.7</span>:
            <span class="hljs-keyword">return</span> prompt + <span class="hljs-string">"ã€‚è¯·ç¡®ä¿æ–‡æœ¬æè¿°ä¸è§†è§‰å†…å®¹é«˜åº¦ä¸€è‡´ã€‚"</span>
        <span class="hljs-keyword">elif</span> scores[<span class="hljs-string">"temporal_coherence"</span>] &lt; <span class="hljs-number">0.6</span>:
            <span class="hljs-keyword">return</span> prompt + <span class="hljs-string">"ã€‚æ³¨æ„è§†é¢‘å¸§é—´çš„è¿è´¯æ€§å’Œç‰©ç†è§„å¾‹ã€‚"</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> prompt

<span class="hljs-comment"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">prompt_optimization_workflow</span>():
    <span class="hljs-string">"""å±•ç¤ºå¤šæ¨¡æ€Promptä¼˜åŒ–å·¥ä½œæµ"""</span>
    
    api_key = <span class="hljs-string">"your-api-key-here"</span>
    evaluator = MultimodalPromptEvaluator(api_key)
    
    <span class="hljs-comment"># åˆå§‹Prompt</span>
    initial_prompt = <span class="hljs-string">"ç”Ÿæˆä¸€æ®µå…³äºæœªæ¥åŸå¸‚çš„å®£ä¼ è§†é¢‘ï¼ŒåŒ…å«é«˜æ¥¼å¤§å¦ã€é£è¡Œæ±½è½¦å’Œå…¨æ¯å¹¿å‘Š"</span>
    
    <span class="hljs-comment"># è¿­ä»£ä¼˜åŒ–</span>
    result = evaluator.optimize_prompt_iteratively(
        initial_prompt=initial_prompt,
        target_modality=<span class="hljs-string">"mixed"</span>,  <span class="hljs-comment"># æ··åˆæ¨¡æ€</span>
        iterations=<span class="hljs-number">3</span>
    )
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"å¤šæ¨¡æ€Promptä¼˜åŒ–å®Œæˆï¼"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"åˆå§‹Prompt: <span class="hljs-subst">{initial_prompt}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ä¼˜åŒ–åPrompt: <span class="hljs-subst">{result[<span class="hljs-string">'final_prompt'</span>]}</span>"</span>)
    
    <span class="hljs-comment"># å±•ç¤ºè¯„ä¼°å†å²</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\nè¯„ä¼°å†å²:"</span>)
    <span class="hljs-keyword">for</span> record <span class="hljs-keyword">in</span> result[<span class="hljs-string">"evaluation_history"</span>]:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"è¿­ä»£<span class="hljs-subst">{record[<span class="hljs-string">'iteration'</span>]}</span>: <span class="hljs-subst">{record[<span class="hljs-string">'scores'</span>]}</span>"</span>)
    
    <span class="hljs-keyword">return</span> result

</code></pre>
<h2 data-id="heading-25">å…­ã€äº§ä¸šå½±å“ï¼šç»Ÿä¸€èŒƒå¼å¯¹AIåº”ç”¨å¼€å‘çš„å˜é©æ€§å½±å“</h2>
<h3 data-id="heading-26">6.1 é™ä½å¤šæ¨¡æ€AIå¼€å‘é—¨æ§›</h3>
<p>Emu3çš„ç»Ÿä¸€æ¶æ„å°†å¸¦æ¥AIå¼€å‘èŒƒå¼çš„æ ¹æœ¬å˜é©ï¼š</p>
<p><strong>ä¼ ç»Ÿæ¨¡å¼çš„é—®é¢˜</strong>ï¼š</p>
<ul>
<li>å¼€å‘å›¢é˜Ÿéœ€è¦ç²¾é€šå¤šç§æŠ€æœ¯æ ˆï¼šNLPã€CVã€è§†é¢‘å¤„ç†</li>
<li>æ¨¡å‹é›†æˆå¤æ‚åº¦é«˜ï¼Œç»´æŠ¤æˆæœ¬å·¨å¤§</li>
<li>è·¨æ¨¡æ€æ•°æ®å¯¹é½å›°éš¾ï¼Œæ€§èƒ½ä¼˜åŒ–æŒ‘æˆ˜å¤š</li>
</ul>
<p><strong>Emu3å¸¦æ¥çš„å˜é©</strong>ï¼š</p>
<ul>
<li><strong>å•ä¸€æŠ€æœ¯æ ˆ</strong>ï¼šåªéœ€æŒæ¡Transformerå’Œè‡ªå›å½’é¢„æµ‹</li>
<li><strong>ç»Ÿä¸€è®­ç»ƒæµç¨‹</strong>ï¼šæ–‡æœ¬ã€å›¾åƒã€è§†é¢‘ç»Ÿä¸€è®­ç»ƒï¼Œæ— éœ€å¤šé˜¶æ®µæ‹¼æ¥</li>
<li><strong>æ ‡å‡†åŒ–è¯„ä¼°</strong>ï¼šè·¨æ¨¡æ€è´¨é‡è¯„ä¼°åŸºå‡†å»ºç«‹</li>
</ul>
<h3 data-id="heading-27">6.2 æ¨åŠ¨åŸç”Ÿå¤šæ¨¡æ€åº”ç”¨çˆ†å‘</h3>
<p>Emu3çš„ç»Ÿä¸€èŒƒå¼å°†å‚¬ç”Ÿæ–°ä¸€ä»£AIåº”ç”¨ï¼š</p>
<ol>
<li>
<p><strong>æ™ºèƒ½å†…å®¹åˆ›ä½œå¹³å°</strong>ï¼š</p>
<ul>
<li>ç”¨æˆ·å¯ç”¨è‡ªç„¶è¯­è¨€æè¿°éœ€æ±‚ï¼Œç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆå›¾æ–‡å¹¶èŒ‚çš„å†…å®¹</li>
<li>è§†é¢‘åˆ¶ä½œä»ä¸“ä¸šå·¥å…·è½¬å‘è‡ªç„¶è¯­è¨€äº¤äº’</li>
</ul>
</li>
<li>
<p><strong>è·¨æ¨¡æ€äººæœºäº¤äº’ç³»ç»Ÿ</strong>ï¼š</p>
<ul>
<li>AIèƒ½åŒæ—¶ç†è§£è¯­éŸ³æŒ‡ä»¤ã€æ‰‹åŠ¿åŠ¨ä½œã€ç¯å¢ƒè§†è§‰</li>
<li>æ™ºèƒ½åŠ©ç†ä»â€œèŠå¤©æœºå™¨äººâ€å‡çº§ä¸ºâ€œå…¨èƒ½åŠ©æ‰‹â€</li>
</ul>
</li>
<li>
<p><strong>äº§ä¸šæ•°å­—åŒ–è½¬å‹åŠ é€Ÿ</strong>ï¼š</p>
<ul>
<li>åˆ¶é€ ä¸šï¼šäº§å“è®¾è®¡ä»CADå»ºæ¨¡è½¬å‘è‡ªç„¶è¯­è¨€æè¿°</li>
<li>æ•™è‚²ï¼šä¸ªæ€§åŒ–å­¦ä¹ ææ–™è‡ªåŠ¨ç”Ÿæˆ</li>
<li>åŒ»ç–—ï¼šç—…å†æ–‡æœ¬ä¸åŒ»å­¦å½±åƒçš„è”åˆåˆ†æ</li>
</ul>
</li>
</ol>
<h3 data-id="heading-28">6.3 å¯¹Promptå·¥ç¨‹çš„æŠ€æœ¯è¦æ±‚å‡çº§</h3>
<p>Emu3çš„æˆåŠŸå®æ–½å¯¹Promptå·¥ç¨‹æå‡ºæ–°è¦æ±‚ï¼š</p>
<p><strong>æŠ€æœ¯æŒ‘æˆ˜</strong>ï¼š</p>
<ol>
<li><strong>è·¨æ¨¡æ€ä¸€è‡´æ€§</strong>ï¼šå¦‚ä½•è®¾è®¡Promptç¡®ä¿æ–‡æœ¬ã€å›¾åƒã€è§†é¢‘åœ¨è¯­ä¹‰ä¸Šä¸€è‡´</li>
<li><strong>æ—¶åºé€»è¾‘å»ºæ¨¡</strong>ï¼šè§†é¢‘ç”Ÿæˆçš„Promptéœ€åŒ…å«æ—¶é—´ç»´åº¦çš„é€»è¾‘çº¦æŸ</li>
<li><strong>è´¨é‡è¯„ä¼°ä½“ç³»</strong>ï¼šå»ºç«‹ç»Ÿä¸€çš„å¤šæ¨¡æ€ç”Ÿæˆè´¨é‡è¯„ä¼°æ ‡å‡†</li>
</ol>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š
é€šè¿‡prompt-minder.comçš„å¤šæ¨¡æ€è¯„ä¼°APIï¼Œå¼€å‘è€…å¯ä»¥ï¼š</p>
<ul>
<li>å»ºç«‹æ ‡å‡†åŒ–çš„è·¨æ¨¡æ€Promptè®¾è®¡è§„èŒƒ</li>
<li>å®ç°å¤šæ¨¡æ€ç”Ÿæˆè´¨é‡çš„è‡ªåŠ¨åŒ–è¯„ä¼°</li>
<li>è¿­ä»£ä¼˜åŒ–Promptä»¥æé«˜ç”Ÿæˆæ•ˆæœ</li>
</ul>
<p>è¿™æ­£æ˜¯å¤§è§„æ¨¡å¤šæ¨¡æ€åº”ç”¨è½åœ°çš„å…³é”®æŠ€æœ¯æ”¯æ’‘ã€‚</p>
<h3 data-id="heading-29">6.4 å¯¹AIèŠ¯ç‰‡ä¸ç®—åŠ›åŸºç¡€è®¾æ–½çš„å½±å“</h3>
<p>Emu3çš„ç»Ÿä¸€æ¶æ„å¯¹ç¡¬ä»¶æå‡ºæ–°è¦æ±‚ï¼š</p>
<p><strong>è®¡ç®—ç‰¹å¾å˜åŒ–</strong>ï¼š</p>
<ul>
<li><strong>æ³¨æ„åŠ›æ¨¡å¼</strong>ï¼šé•¿åºåˆ—æ··åˆæ¨¡æ€çš„è‡ªæ³¨æ„åŠ›è®¡ç®—</li>
<li><strong>å†…å­˜éœ€æ±‚</strong>ï¼šå¤šæ¨¡æ€tokenåºåˆ—çš„KVç¼“å­˜ç®¡ç†</li>
<li><strong>æ¨ç†æ•ˆç‡</strong>ï¼šè‡ªå›å½’ç”Ÿæˆçš„ä¸²è¡Œç‰¹æ€§ä¸åŠ é€Ÿä¼˜åŒ–</li>
</ul>
<p><strong>äº§ä¸šæœºé‡</strong>ï¼š</p>
<ul>
<li>ä¸“ç”¨AIèŠ¯ç‰‡é’ˆå¯¹ç»Ÿä¸€å¤šæ¨¡æ€æ¶æ„ä¼˜åŒ–</li>
<li>äº‘è®¡ç®—å¹³å°æä¾›å¤šæ¨¡æ€æ¨¡å‹è®­ç»ƒæ¨ç†æœåŠ¡</li>
<li>è¾¹ç¼˜è®¾å¤‡æ”¯æŒè½»é‡åŒ–å¤šæ¨¡æ€åº”ç”¨éƒ¨ç½²</li>
</ul>
<h2 data-id="heading-30">ä¸ƒã€æŠ€æœ¯å±€é™ä¸æœªæ¥å±•æœ›</h2>
<h3 data-id="heading-31">7.1 å½“å‰æŠ€æœ¯å±€é™</h3>
<ol>
<li>
<p><strong>æ¨ç†æ•ˆç‡æŒ‘æˆ˜</strong>ï¼š</p>
<ul>
<li>çº¯è‡ªå›å½’è§£ç çš„ä¸²è¡Œç‰¹æ€§é™åˆ¶ç”Ÿæˆé€Ÿåº¦</li>
<li>å¤§è§„æ¨¡å¤šæ¨¡æ€åºåˆ—çš„KVç¼“å­˜å†…å­˜å ç”¨é«˜</li>
<li>å®æ—¶äº¤äº’åº”ç”¨é¢ä¸´å»¶è¿ŸæŒ‘æˆ˜</li>
</ul>
</li>
<li>
<p><strong>Tokenizerè´¨é‡ç“¶é¢ˆ</strong>ï¼š</p>
<ul>
<li>å‹ç¼©ç‡ä¸é‡å»ºä¿çœŸåº¦çš„æƒè¡¡</li>
<li>å¤æ‚åœºæ™¯ç»†èŠ‚ä¿ç•™ä¸è¶³</li>
<li>é•¿è§†é¢‘åºåˆ—çš„æ—¶åºä¿¡æ¯æŸå¤±</li>
</ul>
</li>
<li>
<p><strong>è®­ç»ƒæ•°æ®éœ€æ±‚</strong>ï¼š</p>
<ul>
<li>é«˜è´¨é‡å¤šæ¨¡æ€å¯¹é½æ•°æ®ç¨€ç¼º</li>
<li>é•¿è§†é¢‘è®­ç»ƒæ ·æœ¬è·å–æˆæœ¬é«˜</li>
<li>é¢†åŸŸç‰¹å®šæ•°æ®æ ‡æ³¨å›°éš¾</li>
</ul>
</li>
</ol>
<h3 data-id="heading-32">7.2 æœªæ¥å‘å±•æ–¹å‘</h3>
<ol>
<li>
<p><strong>æ¶æ„æŒç»­ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>æ¢ç´¢å¹¶è¡Œè§£ç æŠ€æœ¯åŠ é€Ÿæ¨ç†</li>
<li>ç ”ç©¶æ›´é«˜æ•ˆçš„è§†è§‰åˆ†è¯å™¨</li>
<li>ä¼˜åŒ–é•¿åºåˆ—æ³¨æ„åŠ›è®¡ç®—</li>
</ul>
</li>
<li>
<p><strong>åº”ç”¨åœºæ™¯æ‹“å±•</strong>ï¼š</p>
<ul>
<li>å…·èº«æ™ºèƒ½ï¼šæœºå™¨äººä¸ç‰©ç†ä¸–ç•Œäº¤äº’</li>
<li>ç§‘å­¦å‘ç°ï¼šè·¨æ¨¡æ€ç§‘å­¦æ•°æ®åˆ†æ</li>
<li>åˆ›æ„äº§ä¸šï¼šAIé©±åŠ¨çš„è‰ºæœ¯åˆ›ä½œ</li>
</ul>
</li>
<li>
<p><strong>äº§ä¸šç”Ÿæ€æ„å»º</strong>ï¼š</p>
<ul>
<li>å¼€æºæ¨¡å‹ä¸å·¥å…·é“¾å®Œå–„</li>
<li>å¤šæ¨¡æ€æ•°æ®é›†å»ºè®¾</li>
<li>æ ‡å‡†åŒ–è¯„ä¼°åŸºå‡†å»ºç«‹</li>
</ul>
</li>
</ol>
<h2 data-id="heading-33">ç»“è®º</h2>
<p>æ™ºæºEmu3ç™»ä¸ŠNatureå°é¢ï¼Œä¸ä»…æ˜¯ä¸­å›½AIç§‘ç ”çš„é‡Œç¨‹ç¢‘ï¼Œæ›´æ˜¯å¤šæ¨¡æ€å­¦ä¹ é¢†åŸŸçš„æŠ€æœ¯èŒƒå¼é©å‘½ã€‚é€šè¿‡å°†â€œé¢„æµ‹ä¸‹ä¸€ä¸ªè¯å…ƒâ€æ¨å¹¿åˆ°å¤šæ¨¡æ€é¢†åŸŸï¼ŒEmu3å®ç°äº†å‰æ‰€æœªæœ‰çš„æ¶æ„ç®€æ´æ€§å’Œæ€§èƒ½ä¼˜è¶Šæ€§ï¼Œä¸ºæ„å»ºç»Ÿä¸€ã€å¯æ‰©å±•çš„æ™ºèƒ½ç³»ç»Ÿå¥ å®šäº†æŠ€æœ¯åŸºç¡€ã€‚</p>
<p>éšç€Emu3åŠå…¶åç»­ç‰ˆæœ¬çš„æŠ€æœ¯æ¼”è¿›ï¼Œä»¥åŠprompt-minder.comç­‰å·¥å…·å¹³å°å¯¹å¤šæ¨¡æ€Promptå·¥ç¨‹çš„æ”¯æŒå®Œå–„ï¼Œæˆ‘ä»¬æ­£åœ¨è§è¯ä»â€œä¸“æ¨¡ä¸“ç”¨â€åˆ°â€œç»Ÿä¸€æ™ºèƒ½â€çš„AIå‘å±•æ–°é˜¶æ®µã€‚è¿™ä¸ä»…æ˜¯æŠ€æœ¯çš„è¿›æ­¥ï¼Œæ›´æ˜¯AIèµ‹èƒ½åƒè¡Œç™¾ä¸šã€æ¨åŠ¨ç¤¾ä¼šæ•°å­—åŒ–è½¬å‹çš„å…³é”®åŠ›é‡ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[pgadminçš„å¯¼å‡ºå›¾å®ç°ï¼Œè¿˜åœ¨æå…ˆç¾å®¹åæ‹ç…§å†æ¢å¤ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7603895839557550143</link>    <guid>https://juejin.cn/post/7603895839557550143</guid>    <pubDate>2026-02-09T03:20:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603895839557550143" data-draft-id="7603895839557517375" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="pgadminçš„å¯¼å‡ºå›¾å®ç°ï¼Œè¿˜åœ¨æå…ˆç¾å®¹åæ‹ç…§å†æ¢å¤ï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-09T03:20:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="lyrieek"/> <meta itemprop="url" content="https://juejin.cn/user/1398234521275102"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            pgadminçš„å¯¼å‡ºå›¾å®ç°ï¼Œè¿˜åœ¨æå…ˆç¾å®¹åæ‹ç…§å†æ¢å¤ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1398234521275102/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    lyrieek
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T03:20:26.000Z" title="Mon Feb 09 2026 03:20:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>PostgreSQL18çš„pgadminä¸­æœ‰ä¸€ä¸ª<code>ERDTool.jsx</code>æœ‰1132è¡Œï¼Œè¿™ä¸ªä½“é‡ç†è®ºä¸Šè¯´éå¸¸åºå¤§ï¼Œä½†åšè¿‡ç°å®å·¥ç¨‹çš„éƒ½çŸ¥é“ï¼Œå…¶å®åªèƒ½ç®—é‡ç»„ä»¶ä¸­çš„miniå°ºå¯¸äº†ã€‚pgadminåŠŸèƒ½å¹¶ä¸ç®—æœ‰å¤šä¸°å¯Œï¼Œæ€ä¹ˆè¿˜æ˜¯åšæˆè¿™æ ·å‘¢ï¼Œå½“ç„¶ä¸æ˜¯ç»´æŠ¤å›¢é˜Ÿä¸ä¼šæ‹†åˆ†ï¼Œæ¯•ç«Ÿè¿˜æ˜¯åšäº†199ä¸ªjsxçš„ã€‚</p>
<p>é¦–å…ˆæ˜ å…¥çœ¼å¸˜çš„æ˜¯<code>registerEvents</code>å¯¹19ä¸ª<code>EventBus</code>çš„ç›‘å¬ï¼Œè¿™ä¸œè¥¿è®©äººå€’å¸ä¸€å£å‡‰æ°”ï¼Œå…¶ä¸­æœ€é†’ç›®çš„è«è¿‡äº<code>this.eventBus.registerListener(ERD_EVENTS.DOWNLOAD_IMAGE, this.onImageClick)</code>ï¼Œåå­—å°±ä¸å¯¹åŠ²ï¼Œå®ç°èƒ½å¦‚ä½•å‘¢ï¼Ÿé‚£ä¹ˆçœ‹ä¸€ä¸‹è¿™ä¸ª<code>onImageClick()</code>ï¼š</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-title function_">onImageClick</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setLoading</span>(<span class="hljs-title function_">gettext</span>(<span class="hljs-string">'Preparing the image...'</span>));

    <span class="hljs-comment">/* Move the diagram temporarily to align it to top-left of the canvas so that when
     * taking the snapshot all the nodes are covered. Once the image is taken, repaint
     * the canvas back to original state.
     * Code referred from - zoomToFitNodes function.
     */</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">diagramContainerRef</span>.<span class="hljs-property">current</span>?.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'ERDTool-html2canvasReset'</span>);
    <span class="hljs-keyword">const</span> margin = <span class="hljs-number">10</span>;
    <span class="hljs-keyword">let</span> nodesRect = <span class="hljs-variable language_">this</span>.<span class="hljs-property">diagram</span>.<span class="hljs-title function_">getEngine</span>().<span class="hljs-title function_">getBoundingNodesRect</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">diagram</span>.<span class="hljs-title function_">getModel</span>().<span class="hljs-title function_">getNodes</span>());
    <span class="hljs-keyword">let</span> linksRect = <span class="hljs-variable language_">this</span>.<span class="hljs-property">diagram</span>.<span class="hljs-title function_">getBoundingLinksRect</span>();

    <span class="hljs-comment">// Check what is to the most top left - links or nodes?</span>
    <span class="hljs-keyword">let</span> topLeftXY = {
      <span class="hljs-attr">x</span>: nodesRect.<span class="hljs-title function_">getTopLeft</span>().<span class="hljs-property">x</span>,
      <span class="hljs-attr">y</span>: nodesRect.<span class="hljs-title function_">getTopLeft</span>().<span class="hljs-property">y</span>
    };
    <span class="hljs-keyword">if</span>(topLeftXY.<span class="hljs-property">x</span> &gt; linksRect.<span class="hljs-property">TL</span>.<span class="hljs-property">x</span>) {
      topLeftXY.<span class="hljs-property">x</span> = linksRect.<span class="hljs-property">TL</span>.<span class="hljs-property">x</span>;
    }
    <span class="hljs-keyword">if</span>(topLeftXY.<span class="hljs-property">y</span> &gt; linksRect.<span class="hljs-property">TL</span>.<span class="hljs-property">y</span>) {
      topLeftXY.<span class="hljs-property">y</span> = linksRect.<span class="hljs-property">TL</span>.<span class="hljs-property">y</span>;
    }
    topLeftXY.<span class="hljs-property">x</span> -= margin;
    topLeftXY.<span class="hljs-property">y</span> -= margin;

    <span class="hljs-keyword">let</span> canvasRect = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasEle</span>.<span class="hljs-title function_">getBoundingClientRect</span>();
    <span class="hljs-keyword">let</span> canvasTopLeftOnScreen = {
      <span class="hljs-attr">x</span>: canvasRect.<span class="hljs-property">left</span>,
      <span class="hljs-attr">y</span>: canvasRect.<span class="hljs-property">top</span>
    };
    <span class="hljs-keyword">let</span> nodeLayerTopLeftPoint = {
      <span class="hljs-attr">x</span>: canvasTopLeftOnScreen.<span class="hljs-property">x</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">diagram</span>.<span class="hljs-title function_">getModel</span>().<span class="hljs-title function_">getOffsetX</span>(),
      <span class="hljs-attr">y</span>: canvasTopLeftOnScreen.<span class="hljs-property">y</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">diagram</span>.<span class="hljs-title function_">getModel</span>().<span class="hljs-title function_">getOffsetY</span>()
    };
    <span class="hljs-keyword">let</span> nodesRectTopLeftPoint = {
      <span class="hljs-attr">x</span>: nodeLayerTopLeftPoint.<span class="hljs-property">x</span> + topLeftXY.<span class="hljs-property">x</span>,
      <span class="hljs-attr">y</span>: nodeLayerTopLeftPoint.<span class="hljs-property">y</span> + topLeftXY.<span class="hljs-property">y</span>
    };

    <span class="hljs-keyword">let</span> prevTransform = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasEle</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'div'</span>).<span class="hljs-property">style</span>.<span class="hljs-property">transform</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasEle</span>.<span class="hljs-property">childNodes</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">ele</span>)=&gt;</span>{
      ele.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">`translate(<span class="hljs-subst">${nodeLayerTopLeftPoint.x - nodesRectTopLeftPoint.x}</span>px, <span class="hljs-subst">${nodeLayerTopLeftPoint.y - nodesRectTopLeftPoint.y}</span>px) scale(1.0)`</span>;
    });

    <span class="hljs-comment">// Capture the links beyond the nodes as well.</span>
    <span class="hljs-keyword">const</span> linkOutsideWidth = linksRect.<span class="hljs-property">BR</span>.<span class="hljs-property">x</span> - nodesRect.<span class="hljs-title function_">getBottomRight</span>().<span class="hljs-property">x</span>;
    <span class="hljs-keyword">const</span> linkOutsideHeight = linksRect.<span class="hljs-property">BR</span>.<span class="hljs-property">y</span> - nodesRect.<span class="hljs-title function_">getBottomRight</span>().<span class="hljs-property">y</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasEle</span>.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasEle</span>.<span class="hljs-property">scrollWidth</span> + (linkOutsideWidth &gt; <span class="hljs-number">0</span> ? linkOutsideWidth : <span class="hljs-number">0</span>) + margin + <span class="hljs-string">'px'</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasEle</span>.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasEle</span>.<span class="hljs-property">scrollHeight</span> + (linkOutsideHeight &gt; <span class="hljs-number">0</span> ? linkOutsideHeight : <span class="hljs-number">0</span>) + margin + <span class="hljs-string">'px'</span>;

    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">()=&gt;</span>{
      <span class="hljs-keyword">let</span> width = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasEle</span>.<span class="hljs-property">scrollWidth</span> + <span class="hljs-number">10</span>;
      <span class="hljs-keyword">let</span> height = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasEle</span>.<span class="hljs-property">scrollHeight</span> + <span class="hljs-number">10</span>;
      <span class="hljs-keyword">let</span> isCut = <span class="hljs-literal">false</span>;
      <span class="hljs-comment">/* Canvas limitation - https://html2canvas.hertzen.com/faq */</span>
      <span class="hljs-keyword">if</span>(width &gt;= <span class="hljs-number">32767</span>){
        width = <span class="hljs-number">32766</span>;
        isCut = <span class="hljs-literal">true</span>;
      }
      <span class="hljs-keyword">if</span>(height &gt;= <span class="hljs-number">32767</span>){
        height = <span class="hljs-number">32766</span>;
        isCut = <span class="hljs-literal">true</span>;
      }
      <span class="hljs-title function_">toPng</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasEle</span>, {width, height, <span class="hljs-attr">pixelRatio</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">preferences</span>.<span class="hljs-property">image_pixel_ratio</span> || <span class="hljs-number">1</span>})
        .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">dataUrl</span>)=&gt;</span>{
          <span class="hljs-title class_">DownloadUtils</span>.<span class="hljs-title function_">downloadBase64UrlData</span>(dataUrl, <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.getCurrentProjectName()}</span>.png`</span>);
        }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>)=&gt;</span>{
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err);
          <span class="hljs-keyword">let</span> msg = <span class="hljs-title function_">gettext</span>(<span class="hljs-string">'Unknown error. Check console logs'</span>);
          <span class="hljs-keyword">if</span>(err.<span class="hljs-property">name</span>) {
            msg = <span class="hljs-string">`<span class="hljs-subst">${err.name}</span>: <span class="hljs-subst">${err.message}</span>`</span>;
          }
          pgAdmin.<span class="hljs-property">Browser</span>.<span class="hljs-property">notifier</span>.<span class="hljs-title function_">alert</span>(<span class="hljs-title function_">gettext</span>(<span class="hljs-string">'Error'</span>), msg);
        }).<span class="hljs-title function_">then</span>(<span class="hljs-function">()=&gt;</span>{
          <span class="hljs-comment">/* Revert back to the original CSS styles */</span>
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">diagramContainerRef</span>.<span class="hljs-property">current</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'ERDTool-html2canvasReset'</span>);
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasEle</span>.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">''</span>;
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasEle</span>.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-string">''</span>;
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasEle</span>.<span class="hljs-property">childNodes</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">ele</span>)=&gt;</span>{
            ele.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = prevTransform;
          });
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">null</span>);
          <span class="hljs-keyword">if</span>(isCut) {
            pgAdmin.<span class="hljs-property">Browser</span>.<span class="hljs-property">notifier</span>.<span class="hljs-title function_">alert</span>(<span class="hljs-title function_">gettext</span>(<span class="hljs-string">'Maximum image size limit'</span>),
              <span class="hljs-title function_">gettext</span>(<span class="hljs-string">'The downloaded image has exceeded the maximum size of 32767 x 32767 pixels, and has been cropped to that size.'</span>));
          }
        });
    }, <span class="hljs-number">1000</span>);
  }
</code></pre>
<p>è¿™ç§ç™¾è¡Œçº§å‡½æ•°ï¼Œå­˜åœ¨åˆç†æ€§ä¸”ä¸è®ºï¼Œæ— è®ºå¦‚ä½•å®ƒéƒ½ä¸åº”è¯¥å«xxClickäº†ï¼Œæ¯•ç«Ÿè°æ•¢ç›¸ä¿¡å®ƒæ‰€æœ‰çš„ä»£ç éƒ½æ˜¯ä¸ºäº†å®Œæˆä¸€ä¸ªå¯¼å‡ºpngåŠŸèƒ½ï¼Ÿ</p>
<p>å½“ç„¶åªç¬¼ç»Ÿçš„è¯´å®ƒå®Œæˆäº†ã€Œä¸€ä¸ªåŠŸèƒ½ã€ï¼Œé‚£ä¹Ÿæ˜¯å§”å±ˆå®ƒäº†ï¼Œè¿™å‡½æ•°å®è´¨ä¸Šç©¶ç«Ÿåšäº†ä»€ä¹ˆï¼Ÿ</p>
<ul>
<li>çŠ¶æ€ç®¡ç†ï¼š setLoadingã€‚</li>
<li>DOM åŠ«æŒï¼š ç›´æ¥æ“ä½œæ ·å¼å’Œç±»åã€‚</li>
<li>å¤æ‚çš„å‡ ä½•è®¡ç®—ï¼š å¤„ç†åŒ…å›´ç›’ï¼ˆBounding Boxï¼‰ã€‚</li>
<li>IO æ“ä½œï¼š ç”Ÿæˆå›¾ç‰‡å¹¶è§¦å‘ä¸‹è½½ã€‚</li>
<li>å¼‚å¸¸å¤„ç†ï¼š æ¢å¤çŠ¶æ€å¼¹å‡º notifier è­¦å‘Šã€‚</li>
</ul>
<p>æ¯ä¸€é¡¹éƒ½æ˜¯ç„¦ç‚¹ï¼Œå¦‚æœæ¢æˆJavaï¼Œè¿™æ®µä»£ç è¿˜èƒ½å†å¥—ä¸Š10ä¸ªtrycatchè†¨èƒ€åˆ°500è¡Œï¼Œå½“ç„¶å¦‚æœæ¢æˆJavaå¿…ç„¶èƒ½è§„çŸ©è®¸å¤šï¼Œä¸è‡³äºå¦‚æ­¤ç²—ç³™ã€‚</p>
<p>å½“ç„¶è¿™å‡½æ•°è¿œä¸æ­¢è¿æ³•å•ä¸€åŸåˆ™é‚£ä¹ˆç®€å•ï¼Œå‡ ä½•è®¡ç®—ä¸­ margin = 10 å’Œå±å¹•åæ ‡è½¬æ¢é€»è¾‘éå¸¸ç¡¬æ ¸ä¸”ç²—ç³™ï¼Œå‡ ä¹å®£åˆ¤äº†è¿™å—UIå·²ç»ä¸å¯æ›´æ”¹äº†ï¼ŒåŒæ—¶å¦å®šäº†ç¼©æ”¾/åç§»å˜åŒ–ï¼Œéå¸¸å®¹æ˜“å‡º off-by-one é”™è¯¯ï¼Œå·²ç»æ¶ˆè€—æå¤§äº†ï¼Œä¸æƒ³åšå¤æ‚åªæƒ³ç®€å•å®ç°ä¹Ÿå¯ä»¥å…‹éš†DOMåšä¸€ä¸ªç¦»å±æ¸²æŸ“ï¼Œè¿˜ä¸éœ€è¦å…³å¿ƒä»€ä¹ˆmarginåç§»ã€‚</p>
<p><code>toPng</code>è¿˜æ˜¯<code>html-to-image</code>çš„ï¼Œè¿™ç§åœºæ™¯ç”¨è¿™ä¸ªæœ¬èº«å°±å¦‚åŒå„¿æˆï¼Œè€Œä¸”æ—¢ç„¶éƒ½åšè¿™ä¹ˆå¤æ‚äº†ï¼Œå“ªæ€•ç›´æ¥å†è¡¥ä¸Šä¸€å¥—åŸç”Ÿä»£ç ï¼Œæ‰‹åŠ¨ç»˜åˆ¶ï¼Œå…¨ä¸¢è¿™å‡½æ•°é‡Œï¼Œä¸ç”¨ä»»ä½•åº“ï¼Œè¿™æ®µä»£ç ä¹Ÿä¸ä¼šæ›´ä¸‘äº†ã€‚</p>
<p>æ£€æµ‹åˆ°å›¾ç‰‡åˆ°äº†æµè§ˆå™¨ canvas é™åˆ¶ï¼Œå°±ç›´æ¥å‰ªè£+è­¦å‘Šï¼Œä¸åšä¸€ä¸ªæ‰§è¡Œå‰popupç¡®è®¤å’Œzoomï¼Œå¯ä»¥è¯´æœ‰äº›ä¸å¯ç†å–»äº†ï¼Œç°å®ä¸­è¿™ä¸ªè­¦å‘Šå‡ ä¹ä¸å¯èƒ½å¼¹å‡ºæ¥ï¼Œå› ä¸ºç¬¦åˆçš„è¿™ä¸ªé€»è¾‘æ—¶ï¼Œå…¶å ç”¨çš„åŸå§‹å†…å­˜å°†è¾¾åˆ°æƒŠäººçš„ 4GBï¼Œåšè¿™ç§å·¨å‹ DOM æ ‘æ—¶UIä¼šè¿›è¡Œå¯†é›†çš„åƒç´ è®¡ç®—ã€‚è€Œä¸”è®¡ç®—æ˜¯åŒæ­¥çš„ï¼Œä¼šç›´æ¥é”æ­»æµè§ˆå™¨ä¸»çº¿ç¨‹ï¼ç¨‹åºæ—©å·²å¡æ­»ï¼Œä¸€è¡Œä»£ç éƒ½åˆ«æƒ³æ‰§è¡Œäº†ã€‚</p>
<p>è¿˜æœ‰<code>setTimeout</code>ä¸ºä»€ä¹ˆ 1000msï¼Ÿä¸ºä»€ä¹ˆä¸æ˜¯ 500 æˆ– 2000ï¼Ÿè¿™æ˜¯å…¸å‹çš„â€œç­‰å®ƒæ¸²æŸ“å®Œâ€çš„ hackï¼Œå› ä¸ºä¿®æ”¹ transform / width/height åï¼Œæµè§ˆå™¨éœ€è¦æ—¶é—´é‡æ’/é‡ç»˜ï¼Œ<code>html2canvas</code>æ‰èƒ½æ•è·æ­£ç¡®å†…å®¹ã€‚ç”¨<code>requestAnimationFrame </code>å¾ªç¯æ£€æŸ¥æˆ–<code>MutationObserver</code> / <code>ResizeObserver</code>æ¥æ£€æµ‹å®é™…å˜åŒ–å®Œæˆä¸å¥½ä¹ˆï¼Ÿ</p>
<p>æœ€åè¿˜æ˜¯å›åˆ°åå­—ä¸Šï¼Œä¸€ä¸ªå‡½æ•°å¦‚æœå«â€œxxç‚¹å‡»â€ï¼Œå®ƒå°±æ²¡æœ‰èµ„æ ¼å»è´Ÿè´£â€œè®¡ç®—å¹¶å¯¼å‡º32767åƒç´ çš„ä½å›¾â€ã€‚</p>
<p>ä¸è¿‡ç»¼åˆæ¥è¯´ï¼Œè¿™ä¸œè¥¿æ•´ä½“ä¸Šä¹Ÿç®—å‹‰å¼ºè¿˜è¡Œäº†ï¼Œæ¯•ç«Ÿå®ƒæ˜¯ä¸€ä¸ªæœ€ç»ˆèŠ‚ç‚¹ç»„ä»¶ï¼Œè€Œä¸”åŸºæœ¬ä¸Šä¸å¤ªå¯èƒ½è¢«ä¾èµ–ï¼Œåªæ˜¯åŠŸèƒ½æ€§é—®é¢˜ï¼Œä¸åƒå®ƒæ—è¾¹é‚£ä¸ª1560è¡Œæœ‰15ä¸ªuseEffectçš„<code>ResultSet.jsx</code>ï¼Œé‚£éƒ½ä¸èƒ½å«ç»„ä»¶äº†ï¼Œé‚£æ˜¯è¯•å›¾ç»™Reactå¡ä¸€ä¸ªå­ç³»ç»Ÿï¼Œç­‰PostgreSQL20å‘å¸ƒï¼Œä¼°è®¡å°±æ²¡äººæ•¢æ”¹å®ƒäº†ã€‚è¿˜æœ‰ç”¨1300è¡Œçš„<code>FormInput.tsx</code>ç®¡ç†ç€FormIconã€StyledGridã€FormInputã€InputSQLã€FormInputSQLç­‰å­ç»„ä»¶çš„è¶…çº§ç»„ä»¶ï¼Œè¿™å‡ ä¹æ˜¯æƒ³åšä¸€å¥—æ‰©å±•UIåº“ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€Œä¹ä¹å…«åä¸€éš¾ã€ç¬¬ä¸€éš¾ï¼šå‰ç«¯æ•°æ®mockæŒ‡å—ï¼ˆTS + VUEï¼‰]]></title>    <link>https://juejin.cn/post/7604084016510631977</link>    <guid>https://juejin.cn/post/7604084016510631977</guid>    <pubDate>2026-02-09T03:58:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604084016510631977" data-draft-id="7604155045235785763" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€Œä¹ä¹å…«åä¸€éš¾ã€ç¬¬ä¸€éš¾ï¼šå‰ç«¯æ•°æ®mockæŒ‡å—ï¼ˆTS + VUEï¼‰"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-09T03:58:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä»æ–‡å¤„å®‰"/> <meta itemprop="url" content="https://juejin.cn/user/1315432730731224"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€Œä¹ä¹å…«åä¸€éš¾ã€ç¬¬ä¸€éš¾ï¼šå‰ç«¯æ•°æ®mockæŒ‡å—ï¼ˆTS + VUEï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1315432730731224/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä»æ–‡å¤„å®‰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T03:58:41.000Z" title="Mon Feb 09 2026 03:58:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    16
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue3 + TypeScript é¡¹ç›®ä¸­ä½¿ç”¨ Mock æ•°æ®æŒ‡å—</h2>
<h3 data-id="heading-1">èƒŒæ™¯</h3>
<p>äº§å“ï¼šè¿™é‡Œæœ‰ä¸ªéœ€æ±‚ï¼Œè®¡åˆ’æœˆåº•ä¸Šçº¿ï¼Œä½ ä»¬è¯„ä¼°ä¸‹å¼€å‘æ—¶é—´ï¼Œä¿è¯æœˆåº•èƒ½ä¸Šçº¿ç°ç½‘ã€‚</p>
<p>æµ‹è¯•ï¼šæˆ‘éœ€è¦ä¸€å‘¨çš„æµ‹è¯•æ—¶é—´ï¼ŒåŒ…æ‹¬åŠŸèƒ½æµ‹è¯•ã€æ€§èƒ½æµ‹è¯•ã€å…¼å®¹æ€§æµ‹è¯•ç­‰ã€‚</p>
<p>UIï¼šæˆ‘éœ€è¦ä¸€å‘¨æ—¶é—´ï¼ŒåŒ…æ‹¬é¡µé¢å¸ƒå±€ã€äº¤äº’è®¾è®¡ã€é¢œè‰²æ–¹æ¡ˆç­‰ã€‚</p>
<p>åç«¯ï¼šæˆ‘éœ€è¦ä¸¤å‘¨æ—¶é—´ï¼ŒåŒ…æ‹¬æ•°æ®åº“è®¾è®¡ã€æ¥å£å¼€å‘ã€ä¸šåŠ¡é€»è¾‘å®ç°ç­‰ã€‚</p>
<p>å‰ç«¯ï¼šæˆ‘èµ°ï¼Ÿ</p>
<p>äº§å“ï¼šä½ æƒ³æƒ³åŠæ³•ã€‚</p>
<p>å‰ç«¯ï¼šæˆ‘å¯ä»¥ç‰ºç‰²è‡ªå·±çš„å¼€å‘æ—¶é—´ï¼Œé€šè¿‡æ¥å£mockæ¥å¹¶è¡Œå¼€å‘ï¼Œéœ€è¦åç«¯æå‰æä¾›æ¥å£æ–‡æ¡£ï¼Œæˆ‘åŒæ­¥è¿›è¡Œé¡µé¢å¼€å‘å’Œé€»è¾‘å®ç°ã€‚</p>
<p>ä¸ºäº†éœ€æ±‚æ­£å¸¸ä¸Šçº¿ï¼Œæ— ç§çš„å‰ç«¯åˆä¸ºè‡ªå·±æ‰¾äº†ä¸ªåŠ ç­çš„æœºä¼šã€‚</p>
<h3 data-id="heading-2">å‰è¨€</h3>
<p>åœ¨å‰ç«¯å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°åç«¯æ¥å£å°šæœªå®Œæˆï¼Œä½†å‰ç«¯éœ€è¦æå‰å¼€å‘é¡µé¢å’ŒåŠŸèƒ½çš„æƒ…å†µã€‚
è¿™æ—¶ï¼Œä½¿ç”¨ Mock æ•°æ®å°±æˆä¸ºäº†ä¸€ç§éå¸¸æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚
æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åœ¨ Vue3 + TypeScript é¡¹ç›®ä¸­æ­å»ºå’Œä½¿ç”¨ Mock æ•°æ®ã€‚</p>
<h3 data-id="heading-3">ä»€ä¹ˆæ˜¯ Mock æ•°æ®</h3>
<h4 data-id="heading-4">æ¦‚å¿µ</h4>
<p>Mock æ•°æ®æ˜¯æŒ‡åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸ºäº†æ¨¡æ‹Ÿåç«¯æ¥å£è¿”å›çš„æ•°æ®ï¼Œè€Œåˆ›å»ºçš„è™šå‡æ•°æ®ã€‚</p>
<h4 data-id="heading-5">ä½œç”¨</h4>
<ol>
<li>
<p><strong>å¹¶è¡Œå¼€å‘</strong>ï¼šå‰ç«¯å¯ä»¥ä¸åç«¯åŒæ—¶å¼€å‘ï¼Œä¸éœ€è¦ç­‰å¾…åç«¯æ¥å£å®Œæˆ</p>
</li>
<li>
<p><strong>ç‹¬ç«‹æµ‹è¯•</strong>ï¼šå¯ä»¥æ¨¡æ‹Ÿå„ç§è¾¹ç•Œæƒ…å†µå’Œé”™è¯¯åœºæ™¯</p>
</li>
<li>
<p><strong>æ€§èƒ½æµ‹è¯•</strong>ï¼šå¯ä»¥æ¨¡æ‹Ÿå¤§é‡æ•°æ®ï¼Œæµ‹è¯•å‰ç«¯æ€§èƒ½</p>
</li>
<li>
<p><strong>æ¼”ç¤ºæ•ˆæœ</strong>ï¼šåœ¨æ²¡æœ‰åç«¯æœåŠ¡çš„æƒ…å†µä¸‹ï¼Œä¹Ÿèƒ½å±•ç¤ºå®Œæ•´çš„åŠŸèƒ½</p>
</li>
</ol>
<h4 data-id="heading-6">ä¼˜åŠ¿</h4>
<ol>
<li>
<p><strong>æé«˜å¼€å‘æ•ˆç‡</strong>ï¼šå‡å°‘ç­‰å¾…åç«¯æ¥å£çš„æ—¶é—´</p>
</li>
<li>
<p><strong>å¢å¼ºä»£ç å¥å£®æ€§</strong>ï¼šå¯ä»¥æµ‹è¯•å„ç§å¼‚å¸¸æƒ…å†µ</p>
</li>
<li>
<p><strong>æ”¹å–„å›¢é˜Ÿåä½œ</strong>ï¼šæ˜ç¡®æ¥å£è§„èŒƒï¼Œå‡å°‘æ²Ÿé€šæˆæœ¬</p>
</li>
<li>
<p><strong>ç®€åŒ–æµ‹è¯•æµç¨‹</strong>ï¼šå¯ä»¥å¿«é€Ÿæ¨¡æ‹Ÿå„ç§åœºæ™¯</p>
</li>
</ol>
<h3 data-id="heading-7">ç¯å¢ƒæ­å»º</h3>
<h4 data-id="heading-8">å®‰è£…ä¾èµ–</h4>
<p>åœ¨ Vue3 + TypeScript é¡¹ç›®ä¸­ï¼Œéœ€è¦å®‰è£…ä»¥ä¸‹ä¾èµ–ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å®‰è£… mockjs åº“</span>
npm install mockjs --save-dev

<span class="hljs-comment"># å®‰è£… vite-plugin-mock æ’ä»¶</span>
npm install vite-plugin-mock --save-dev

<span class="hljs-comment"># å®‰è£… @types/mockjs ç±»å‹å®šä¹‰ï¼ˆå¯é€‰ä½†æ¨èï¼‰</span>
npm install --save-dev @types/mockjs
</code></pre>
<h4 data-id="heading-9">é…ç½® Vite</h4>
<p>åœ¨ <code>vite.config.ts</code> æ–‡ä»¶ä¸­é…ç½® <code>vite-plugin-mock</code> æ’ä»¶ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">"vite"</span>;
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">"@vitejs/plugin-vue"</span>;
<span class="hljs-keyword">import</span> { resolve } <span class="hljs-keyword">from</span> <span class="hljs-string">"path"</span>;
<span class="hljs-keyword">import</span> { viteMockServe } <span class="hljs-keyword">from</span> <span class="hljs-string">"vite-plugin-mock"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title function_">vue</span>(),
    <span class="hljs-title function_">viteMockServe</span>({
      <span class="hljs-comment">// mock æ–‡ä»¶å­˜æ”¾è·¯å¾„</span>
      <span class="hljs-attr">mockPath</span>: <span class="hljs-string">"./mock"</span>,
      <span class="hljs-comment">// å¯ç”¨ mock åŠŸèƒ½</span>
      <span class="hljs-attr">enable</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-comment">// æ˜¾ç¤ºè¯·æ±‚æ—¥å¿—</span>
      <span class="hljs-attr">logger</span>: <span class="hljs-literal">true</span>,
    }),
  ],
  <span class="hljs-attr">resolve</span>: {
    <span class="hljs-attr">alias</span>: {
      <span class="hljs-string">"@"</span>: <span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">"./src"</span>),
    },
  },
});
</code></pre>
<h4 data-id="heading-10">é…ç½® TypeScript</h4>
<p>åœ¨ <code>tsconfig.app.json</code> æ–‡ä»¶ä¸­é…ç½®è·¯å¾„åˆ«åï¼Œç¡®ä¿ TypeScript èƒ½å¤Ÿæ­£ç¡®è§£æ <code>@/</code> è·¯å¾„ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"extends"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"@vue/tsconfig/tsconfig.dom.json"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"tsBuildInfoFile"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./node_modules/.tmp/tsconfig.app.tsbuildinfo"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"paths"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"@/*"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"./src/*"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-comment">/* Linting */</span>
    <span class="hljs-attr">"strict"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"noUnusedLocals"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"noUnusedParameters"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"noFallthroughCasesInSwitch"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"noUncheckedSideEffectImports"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"include"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"src/**/*.ts"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"src/**/*.tsx"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"src/**/*.vue"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-11">é…ç½® Mock æ•°æ®</h3>
<h4 data-id="heading-12">å¿«é€Ÿå¼€å§‹ - æœ€ç®€å•çš„ç”¨ä¾‹</h4>
<p>æ¨¡æ‹Ÿç¬¬ä¸€ä¸ªç®€å•æ¥å£</p>
<h5 data-id="heading-13">ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæœ€ç®€å•çš„ Mock æ¥å£</h5>
<p>åœ¨ <code>mock</code> æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ªç®€å•çš„ <code>hello.ts</code> æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// mock/hello.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">MockMethod</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"vite-plugin-mock"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> [
  {
    <span class="hljs-attr">url</span>: <span class="hljs-string">"/api/hello"</span>,
    <span class="hljs-attr">method</span>: <span class="hljs-string">"get"</span>,
    <span class="hljs-attr">response</span>: <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,
        <span class="hljs-attr">message</span>: <span class="hljs-string">"success"</span>,
        <span class="hljs-attr">data</span>: <span class="hljs-string">"Hello, Mock!"</span>,
      };
    },
  },
] <span class="hljs-keyword">as</span> <span class="hljs-title class_">MockMethod</span>[];
</code></pre>
<h5 data-id="heading-14">ç¬¬äºŒæ­¥ï¼šåœ¨ç»„ä»¶ä¸­è°ƒç”¨</h5>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div&gt;
    &lt;h2&gt;{{ message }}&lt;/h2&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { ref, onMounted } from "vue";
import axios from "axios";

const message = ref("");

onMounted(async () =&gt; {
  try {
    const response = await axios.get("/api/hello");
    message.value = response.data.data;
  } catch (error) {
    console.error("è¯·æ±‚å¤±è´¥:", error);
  }
});
&lt;/script&gt;
</code></pre>
<p><strong>è¿è¡Œç»“æœ</strong>ï¼šé¡µé¢æ˜¾ç¤º "Hello, Mock!"</p>
<hr/>
<h4 data-id="heading-15">ä¸­çº§ç”¨ä¾‹ - ç®€å•æ•°æ®åˆ—è¡¨</h4>
<p>è¿™ä¸ªç”¨ä¾‹å±•ç¤ºå¦‚ä½•è¿”å›ä¸€ä¸ªç®€å•çš„æ•°æ®åˆ—è¡¨ã€‚</p>
<h5 data-id="heading-16">åˆ›å»º Mock æ¥å£</h5>
<p>åœ¨ <code>mock</code> æ–‡ä»¶å¤¹ä¸‹åˆ›å»º <code>products.ts</code> æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// mock/products.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">MockMethod</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"vite-plugin-mock"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> [
  {
    <span class="hljs-attr">url</span>: <span class="hljs-string">"/api/products"</span>,
    <span class="hljs-attr">method</span>: <span class="hljs-string">"get"</span>,
    <span class="hljs-attr">response</span>: <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,
        <span class="hljs-attr">message</span>: <span class="hljs-string">"success"</span>,
        <span class="hljs-attr">data</span>: [
          { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">"å•†å“1"</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">99</span> },
          { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">"å•†å“2"</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">199</span> },
          { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">"å•†å“3"</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">299</span> },
        ],
      };
    },
  },
] <span class="hljs-keyword">as</span> <span class="hljs-title class_">MockMethod</span>[];
</code></pre>
<h5 data-id="heading-17">åœ¨ç»„ä»¶ä¸­è°ƒç”¨</h5>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div&gt;
    &lt;h2&gt;å•†å“åˆ—è¡¨&lt;/h2&gt;
    &lt;ul&gt;
      &lt;li v-for="product in products" :key="product.id"&gt;
        {{ product.name }} - Â¥{{ product.price }}
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { ref, onMounted } from "vue";
import axios from "axios";

interface Product {
  id: number;
  name: string;
  price: number;
}

const products = ref&lt;Product[]&gt;([]);

onMounted(async () =&gt; {
  try {
    const response = await axios.get("/api/products");
    products.value = response.data.data;
  } catch (error) {
    console.error("è·å–å•†å“åˆ—è¡¨å¤±è´¥:", error);
  }
});
&lt;/script&gt;
</code></pre>
<p><strong>è¿è¡Œç»“æœ</strong>ï¼šé¡µé¢æ˜¾ç¤ºå•†å“åˆ—è¡¨ï¼ŒåŒ…å«3ä¸ªå•†å“çš„ä¿¡æ¯ã€‚</p>
<hr/>
<h4 data-id="heading-18">è¿›é˜¶ç”¨ä¾‹ - ç”¨æˆ·æ•°æ®ç®¡ç†</h4>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ›´å®Œæ•´çš„è´´åˆä¸šåŠ¡åœºæ™¯çš„ç”¨ä¾‹ã€‚</p>
<h5 data-id="heading-19">åˆ›å»º Mock æ–‡ä»¶</h5>
<p>åˆ›å»ºä¸€ä¸ª <code>user.ts</code> æ–‡ä»¶æ¥æ¨¡æ‹Ÿç”¨æˆ·ç›¸å…³çš„æ¥å£ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// mock/user.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">MockMethod</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"vite-plugin-mock"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> [
  {
    <span class="hljs-attr">url</span>: <span class="hljs-string">"/api/user/list"</span>, <span class="hljs-comment">// æ¥å£è·¯å¾„</span>
    <span class="hljs-attr">method</span>: <span class="hljs-string">"get"</span>, <span class="hljs-comment">// è¯·æ±‚æ–¹æ³•</span>
    <span class="hljs-attr">response</span>: <span class="hljs-function">(<span class="hljs-params">{ query }: { query: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; }</span>) =&gt;</span> {
      <span class="hljs-comment">// æ¨¡æ‹Ÿåˆ†é¡µæ•°æ®</span>
      <span class="hljs-keyword">const</span> page = <span class="hljs-built_in">parseInt</span>(query.<span class="hljs-property">page</span>) || <span class="hljs-number">1</span>;
      <span class="hljs-keyword">const</span> limit = <span class="hljs-built_in">parseInt</span>(query.<span class="hljs-property">limit</span>) || <span class="hljs-number">10</span>;
      <span class="hljs-keyword">const</span> total = <span class="hljs-number">100</span>;

      <span class="hljs-comment">// ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®</span>
      <span class="hljs-keyword">const</span> list = [];
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; limit; i++) {
        <span class="hljs-keyword">const</span> index = (page - <span class="hljs-number">1</span>) * limit + i;
        <span class="hljs-keyword">if</span> (index &lt; total) {
          list.<span class="hljs-title function_">push</span>({
            <span class="hljs-attr">id</span>: index + <span class="hljs-number">1</span>,
            <span class="hljs-attr">name</span>: <span class="hljs-string">`ç”¨æˆ·<span class="hljs-subst">${index + <span class="hljs-number">1</span>}</span>`</span>,
            <span class="hljs-attr">age</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">30</span>) + <span class="hljs-number">18</span>,
            <span class="hljs-attr">email</span>: <span class="hljs-string">`user<span class="hljs-subst">${index + <span class="hljs-number">1</span>}</span>@example.com`</span>,
            <span class="hljs-attr">createdAt</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>(),
          });
        }
      }

      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,
        <span class="hljs-attr">message</span>: <span class="hljs-string">"success"</span>,
        <span class="hljs-attr">data</span>: {
          list,
          total,
          page,
          limit,
        },
      };
    },
  },
  {
    <span class="hljs-attr">url</span>: <span class="hljs-string">"/api/user/detail"</span>,
    <span class="hljs-attr">method</span>: <span class="hljs-string">"get"</span>,
    <span class="hljs-attr">response</span>: <span class="hljs-function">(<span class="hljs-params">{ query }: { query: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; }</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> id = query.<span class="hljs-property">id</span>;

      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,
        <span class="hljs-attr">message</span>: <span class="hljs-string">"success"</span>,
        <span class="hljs-attr">data</span>: {
          id,
          <span class="hljs-attr">name</span>: <span class="hljs-string">`ç”¨æˆ·<span class="hljs-subst">${id}</span>`</span>,
          <span class="hljs-attr">age</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">30</span>) + <span class="hljs-number">18</span>,
          <span class="hljs-attr">email</span>: <span class="hljs-string">`user<span class="hljs-subst">${id}</span>@example.com`</span>,
          <span class="hljs-attr">createdAt</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>(),
          <span class="hljs-attr">address</span>: <span class="hljs-string">"åŒ—äº¬å¸‚æœé˜³åŒº"</span>,
          <span class="hljs-attr">phone</span>: <span class="hljs-string">"13800138000"</span>,
        },
      };
    },
  },
  {
    <span class="hljs-attr">url</span>: <span class="hljs-string">"/api/user/create"</span>,
    <span class="hljs-attr">method</span>: <span class="hljs-string">"post"</span>,
    <span class="hljs-attr">response</span>: <span class="hljs-function">(<span class="hljs-params">{ body }: { body: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt; }</span>) =&gt;</span> {
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,
        <span class="hljs-attr">message</span>: <span class="hljs-string">"success"</span>,
        <span class="hljs-attr">data</span>: {
          <span class="hljs-attr">id</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">10000</span>),
          ...body,
        },
      };
    },
  },
] <span class="hljs-keyword">as</span> <span class="hljs-title class_">MockMethod</span>[];
</code></pre>
<h3 data-id="heading-20">è°ƒç”¨ Mock æ•°æ®</h3>
<p>mockæ•°æ®çš„è°ƒç”¨ä½¿ç”¨ <code>axios</code> å®ç°ï¼Œæœ¬æ–‡æš‚ä¸åšè¿‡å¤šè¦†ç›–ã€‚</p>
<h4 data-id="heading-21">åˆ›å»º API æœåŠ¡</h4>
<p>åœ¨ <code>src/api</code> ç›®å½•ä¸‹åˆ›å»º <code>user.ts</code> æ–‡ä»¶ï¼Œå®šä¹‰ API è°ƒç”¨å‡½æ•°ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/api/user.ts</span>
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">"axios"</span>;

<span class="hljs-comment">/**
 * è·å–ç”¨æˆ·åˆ—è¡¨
 * <span class="hljs-doctag">@param</span> params åˆ†é¡µå‚æ•°
 * <span class="hljs-doctag">@returns</span> Promise å“åº”æ•°æ®
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getUserList</span> = (<span class="hljs-params">params: { page: <span class="hljs-built_in">number</span>; limit: <span class="hljs-built_in">number</span> }</span>) =&gt; {
  <span class="hljs-keyword">return</span> axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">"/api/user/list"</span>, { params });
};

<span class="hljs-comment">/**
 * è·å–ç”¨æˆ·è¯¦æƒ…
 * <span class="hljs-doctag">@param</span> id ç”¨æˆ·ID
 * <span class="hljs-doctag">@returns</span> Promise å“åº”æ•°æ®
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getUserDetail</span> = (<span class="hljs-params">id: <span class="hljs-built_in">number</span></span>) =&gt; {
  <span class="hljs-keyword">return</span> axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">"/api/user/detail"</span>, { <span class="hljs-attr">params</span>: { id } });
};

<span class="hljs-comment">/**
 * åˆ›å»ºç”¨æˆ·
 * <span class="hljs-doctag">@param</span> data ç”¨æˆ·æ•°æ®
 * <span class="hljs-doctag">@returns</span> Promise å“åº”æ•°æ®
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">createUser</span> = (<span class="hljs-params">data: {
  name: <span class="hljs-built_in">string</span>;
  age: <span class="hljs-built_in">number</span>;
  email: <span class="hljs-built_in">string</span>;
}</span>) =&gt; {
  <span class="hljs-keyword">return</span> axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">"/api/user/create"</span>, data);
};
</code></pre>
<h4 data-id="heading-22">åœ¨ç»„ä»¶ä¸­ä½¿ç”¨</h4>
<p>åœ¨ Vue ç»„ä»¶ä¸­ä½¿ç”¨ API æœåŠ¡è°ƒç”¨ Mock æ•°æ®ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="user-list"&gt;
    &lt;h2&gt;ç”¨æˆ·åˆ—è¡¨&lt;/h2&gt;
    &lt;div v-if="loading"&gt;åŠ è½½ä¸­...&lt;/div&gt;
    &lt;div v-else&gt;
      &lt;ul&gt;
        &lt;li v-for="user in userList" :key="user.id"&gt;
          {{ user.name }} - {{ user.age }}å² - {{ user.email }}
        &lt;/li&gt;
      &lt;/ul&gt;
      &lt;div class="pagination"&gt;
        &lt;button @click="changePage(1)" :disabled="currentPage === 1"&gt;
          é¦–é¡µ
        &lt;/button&gt;
        &lt;button
          @click="changePage(currentPage - 1)"
          :disabled="currentPage === 1"
        &gt;
          ä¸Šä¸€é¡µ
        &lt;/button&gt;
        &lt;span&gt;ç¬¬ {{ currentPage }} é¡µï¼Œå…± {{ totalPages }} é¡µ&lt;/span&gt;
        &lt;button
          @click="changePage(currentPage + 1)"
          :disabled="currentPage === totalPages"
        &gt;
          ä¸‹ä¸€é¡µ
        &lt;/button&gt;
        &lt;button
          @click="changePage(totalPages)"
          :disabled="currentPage === totalPages"
        &gt;
          æœ«é¡µ
        &lt;/button&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { ref, computed, onMounted } from "vue";
import { getUserList } from "@/api/user";

// å“åº”å¼æ•°æ®
const userList = ref&lt;any[]&gt;([]);
const loading = ref(false);
const currentPage = ref(1);
const pageSize = ref(10);
const total = ref(0);

// è®¡ç®—å±æ€§
const totalPages = computed(() =&gt; {
  return Math.ceil(total.value / pageSize.value);
});

/**
 * è·å–ç”¨æˆ·åˆ—è¡¨æ•°æ®
 */
const fetchUserList = async () =&gt; {
  loading.value = true;
  try {
    const response = await getUserList({
      page: currentPage.value,
      limit: pageSize.value,
    });
    userList.value = response.data.data.list;
    total.value = response.data.data.total;
  } catch (error) {
    console.error("è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥:", error);
  } finally {
    loading.value = false;
  }
};

/**
 * åˆ‡æ¢é¡µç 
 * @param page é¡µç 
 */
const changePage = (page: number) =&gt; {
  currentPage.value = page;
  fetchUserList();
};

// ç»„ä»¶æŒ‚è½½æ—¶è·å–æ•°æ®
onMounted(() =&gt; {
  fetchUserList();
});
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-23">å¸¸è§ç”¨ä¾‹å’Œæœ€ä½³å®è·µ</h3>
<h4 data-id="heading-24">å¸¸è§ç”¨ä¾‹</h4>
<ol>
<li>
<p><strong>åˆ†é¡µæ•°æ®</strong>ï¼šæ¨¡æ‹Ÿå¸¦åˆ†é¡µçš„åˆ—è¡¨æ•°æ®</p>
</li>
<li>
<p><strong>è¯¦æƒ…æ•°æ®</strong>ï¼šæ¨¡æ‹Ÿå•ä¸ªèµ„æºçš„è¯¦ç»†ä¿¡æ¯</p>
</li>
<li>
<p><strong>è¡¨å•æäº¤</strong>ï¼šæ¨¡æ‹Ÿåˆ›å»ºã€æ›´æ–°æ“ä½œ</p>
</li>
<li>
<p><strong>é”™è¯¯åœºæ™¯</strong>ï¼šæ¨¡æ‹Ÿå„ç§é”™è¯¯çŠ¶æ€ç å’Œé”™è¯¯ä¿¡æ¯</p>
</li>
<li>
<p><strong>æ–‡ä»¶ä¸Šä¼ </strong>ï¼šæ¨¡æ‹Ÿæ–‡ä»¶ä¸Šä¼ æ¥å£</p>
</li>
</ol>
<h4 data-id="heading-25">æœ€ä½³å®è·µ</h4>
<ol>
<li>
<p><strong>ç›®å½•ç»“æ„æ¸…æ™°</strong>ï¼šæŒ‰æ¨¡å—ç»„ç»‡ mock æ–‡ä»¶</p>
</li>
<li>
<p><strong>æ•°æ®ç»“æ„ä¸€è‡´</strong>ï¼šä¸åç«¯æ¥å£ä¿æŒä¸€è‡´çš„æ•°æ®ç»“æ„</p>
</li>
<li>
<p><strong>æ¨¡æ‹ŸçœŸå®åœºæ™¯</strong>ï¼šåŒ…æ‹¬æ­£å¸¸ã€å¼‚å¸¸ã€è¾¹ç•Œç­‰å„ç§åœºæ™¯</p>
</li>
<li>
<p><strong>ä½¿ç”¨ TypeScript</strong>ï¼šä¸º mock æ•°æ®æ·»åŠ ç±»å‹å®šä¹‰</p>
</li>
<li>
<p><strong>æ³¨é‡Šå®Œå–„</strong>ï¼šä¸ºå¤æ‚çš„ mock é€»è¾‘æ·»åŠ æ³¨é‡Š</p>
</li>
<li>
<p><strong>å®šæœŸæ›´æ–°</strong>ï¼šæ ¹æ®åç«¯æ¥å£å˜åŒ–åŠæ—¶æ›´æ–° mock æ•°æ®</p>
</li>
</ol>
<h3 data-id="heading-26">æ•…éšœæ’é™¤æç¤º</h3>
<ol>
<li><strong>mock æ•°æ®ä¸ç”Ÿæ•ˆ</strong></li>
</ol>
<ul>
<li>
<p>æ£€æŸ¥ <code>vite.config.ts</code> ä¸­çš„ <code>mockPath</code> é…ç½®æ˜¯å¦æ­£ç¡®</p>
</li>
<li>
<p>æ£€æŸ¥ mock æ–‡ä»¶æ˜¯å¦åœ¨æ­£ç¡®çš„ç›®å½•ä¸‹</p>
</li>
<li>
<p>æ£€æŸ¥æ¥å£è·¯å¾„æ˜¯å¦åŒ¹é…</p>
</li>
</ul>
<ol start="2">
<li><strong>TypeScript ç±»å‹é”™è¯¯</strong></li>
</ol>
<ul>
<li>
<p>ç¡®ä¿å®‰è£…äº† <code>@types/mockjs</code> ç±»å‹å®šä¹‰</p>
</li>
<li>
<p>ä¸º mock æ•°æ®æ·»åŠ æ­£ç¡®çš„ç±»å‹æ³¨è§£</p>
</li>
</ul>
<ol start="3">
<li><strong>ç”Ÿäº§ç¯å¢ƒæ³„éœ²</strong></li>
</ol>
<ul>
<li>ç¡®ä¿åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç¦ç”¨ mock åŠŸèƒ½</li>
</ul>
<ol start="4">
<li><strong>æ€§èƒ½é—®é¢˜</strong></li>
</ol>
<ul>
<li>
<p>é¿å…åœ¨ mock å‡½æ•°ä¸­æ‰§è¡Œå¤æ‚çš„è®¡ç®—</p>
</li>
<li>
<p>å¯¹äºå¤§é‡æ•°æ®ï¼Œè€ƒè™‘ä½¿ç”¨åˆ†é¡µæˆ–è™šæ‹Ÿæ»šåŠ¨</p>
</li>
</ul>
<h3 data-id="heading-27">å¸¸è§é—®é¢˜</h3>
<h4 data-id="heading-28">1. è·¯å¾„åˆ«åé—®é¢˜</h4>
<p><strong>é—®é¢˜</strong>ï¼šæ‰¾ä¸åˆ°æ¨¡å— "@/api/user" æˆ–å…¶ç›¸åº”çš„ç±»å‹å£°æ˜ã€‚</p>
<p><strong>åŸå› </strong>ï¼šè™½ç„¶åœ¨ <code>vite.config.ts</code> ä¸­é…ç½®äº†è·¯å¾„åˆ«åï¼Œä½†åœ¨ <code>tsconfig.app.json</code> ä¸­æ²¡æœ‰é…ç½®ç›¸åº”çš„ <code>paths</code>ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šåœ¨ <code>tsconfig.app.json</code> ä¸­æ·»åŠ  <code>paths</code> é…ç½®ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-comment">// ... å…¶ä»–é…ç½®</span>
    <span class="hljs-attr">"paths"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"@/*"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"./src/*"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-29">2. æ¥å£å®ç°ä¸å®Œæ•´</h4>
<p><strong>é—®é¢˜</strong>ï¼šè°ƒç”¨æŸä¸ª API å‡½æ•°æ—¶è¿”å› 404 é”™è¯¯ã€‚</p>
<p><strong>åŸå› </strong>ï¼šåœ¨ mock æ–‡ä»¶ä¸­æ²¡æœ‰å®ç°å¯¹åº”çš„æ¥å£ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šç¡®ä¿æ‰€æœ‰ API è°ƒç”¨éƒ½æœ‰å¯¹åº”çš„ mock æ¥å£å®ç°ã€‚</p>
<h4 data-id="heading-30">3. ç±»å‹å®šä¹‰ç¼ºå¤±</h4>
<p><strong>é—®é¢˜</strong>ï¼šä½¿ç”¨ mockjs æ—¶ç¼ºå°‘ç±»å‹å®šä¹‰ã€‚</p>
<p><strong>åŸå› </strong>ï¼šæ²¡æœ‰å®‰è£… <code>@types/mockjs</code> ç±»å‹å®šä¹‰æ–‡ä»¶ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šå®‰è£…ç±»å‹å®šä¹‰æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm install --save-dev @types/mockjs
</code></pre>
<h3 data-id="heading-31">æ›¿ä»£æ–¹æ¡ˆæ¯”è¾ƒ</h3>
<h4 data-id="heading-32">Mock.js vs JSON Server</h4>
<ul>
<li>
<p><strong>Mock.js</strong>ï¼šä¸“æ³¨äºæ•°æ®æ¨¡æ‹Ÿï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒå„ç§æ•°æ®ç±»å‹å’Œéšæœºæ•°æ®ç”Ÿæˆ</p>
</li>
<li>
<p><strong>JSON Server</strong>ï¼šå¿«é€Ÿåˆ›å»º RESTful APIï¼ŒåŸºäº JSON æ–‡ä»¶ï¼Œé€‚åˆç®€å•åœºæ™¯</p>
</li>
</ul>
<h4 data-id="heading-33">Mock.js vs MSW (Mock Service Worker)</h4>
<ul>
<li>
<p><strong>Mock.js</strong>ï¼šåœ¨æ„å»ºå·¥å…·å±‚é¢æ‹¦æˆªè¯·æ±‚ï¼Œé…ç½®ç®€å•</p>
</li>
<li>
<p><strong>MSW</strong>ï¼šåœ¨æµè§ˆå™¨å±‚é¢æ‹¦æˆªè¯·æ±‚ï¼Œæ”¯æŒ Service Workerï¼Œæ›´æ¥è¿‘çœŸå®ç½‘ç»œè¯·æ±‚</p>
</li>
</ul>
<h4 data-id="heading-34">Mock.js vs æ‰‹å†™æœ¬åœ°å­˜å‚¨</h4>
<ul>
<li>
<p><strong>Mock.js</strong>ï¼šåŠŸèƒ½å®Œæ•´ï¼Œæ”¯æŒå„ç§ HTTP æ–¹æ³•å’Œåœºæ™¯</p>
</li>
<li>
<p><strong>æ‰‹å†™æœ¬åœ°å­˜å‚¨</strong>ï¼šç®€å•ç›´æ¥ï¼Œé€‚åˆéå¸¸ç®€å•çš„åœºæ™¯</p>
</li>
</ul>
<h3 data-id="heading-35">æ³¨æ„äº‹é¡¹</h3>
<ol>
<li>
<p><strong>ç¯å¢ƒéš”ç¦»</strong>ï¼šç¡®ä¿ mock åŠŸèƒ½åªåœ¨å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒå¯ç”¨</p>
</li>
<li>
<p><strong>æ•°æ®å®‰å…¨</strong>ï¼šä¸è¦åœ¨ mock æ•°æ®ä¸­ä½¿ç”¨çœŸå®çš„æ•æ„Ÿä¿¡æ¯</p>
</li>
<li>
<p><strong>æ¥å£ä¸€è‡´æ€§</strong>ï¼šä¸åç«¯ä¿æŒæ¥å£è§„èŒƒä¸€è‡´ï¼Œé¿å…åæœŸå¤§é‡ä¿®æ”¹</p>
</li>
<li>
<p><strong>ä»£ç ç®¡ç†</strong>ï¼šå°† mock ç›¸å…³ä»£ç ä¸ä¸šåŠ¡ä»£ç åˆ†ç¦»ï¼Œä¾¿äºç»´æŠ¤</p>
</li>
<li>
<p><strong>æ€§èƒ½è€ƒè™‘</strong>ï¼šé¿å…ç”Ÿæˆè¿‡å¤šæ•°æ®ï¼Œå½±å“å‰ç«¯æ€§èƒ½</p>
</li>
<li>
<p><strong>æµ‹è¯•è¦†ç›–</strong>ï¼šç¡®ä¿çœŸå®æ¥å£å¯¹æ¥åï¼Œè¿›è¡Œå®Œæ•´çš„å›å½’æµ‹è¯•</p>
</li>
</ol>
<h3 data-id="heading-36">æ€»ç»“</h3>
<p>Mock æ•°æ®æ˜¯å‰ç«¯å¼€å‘ä¸­çš„é‡è¦å·¥å…·ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬æé«˜å¼€å‘æ•ˆç‡ï¼Œå¢å¼ºä»£ç å¥å£®æ€§ï¼Œæ”¹å–„å›¢é˜Ÿåä½œã€‚</p>
<p><code>ã€Œä¹ä¹å…«åä¸€éš¾ï¼Œéš¾éš¾çš†æ˜¯ä¿®è¡Œã€</code></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åœ¨ VS Codeä¸­ï¼Œvue2-vuex ä½¿ç”¨ç»ˆäºæœ‰ä½“éªŒæ„Ÿå¢å¼ºçš„æ’ä»¶äº†ã€‚]]></title>    <link>https://juejin.cn/post/7604155045235916835</link>    <guid>https://juejin.cn/post/7604155045235916835</guid>    <pubDate>2026-02-09T04:30:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604155045235916835" data-draft-id="7603895839557632063" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åœ¨ VS Codeä¸­ï¼Œvue2-vuex ä½¿ç”¨ç»ˆäºæœ‰ä½“éªŒæ„Ÿå¢å¼ºçš„æ’ä»¶äº†ã€‚"/> <meta itemprop="keywords" content="Vue.js,Vuex"/> <meta itemprop="datePublished" content="2026-02-09T04:30:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°ä¹¦åŒ…é…±"/> <meta itemprop="url" content="https://juejin.cn/user/184373685008184"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åœ¨ VS Codeä¸­ï¼Œvue2-vuex ä½¿ç”¨ç»ˆäºæœ‰ä½“éªŒæ„Ÿå¢å¼ºçš„æ’ä»¶äº†ã€‚
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/184373685008184/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°ä¹¦åŒ…é…±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T04:30:36.000Z" title="Mon Feb 09 2026 04:30:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vuex Helper</h2>
<p>é€‚ç”¨äº Vuex 2 çš„ VS Code æ’ä»¶ï¼Œæä¾› <strong>è·³è½¬å®šä¹‰</strong>ã€<strong>ä»£ç è¡¥å…¨</strong> å’Œ <strong>æ‚¬æµ®æç¤º</strong> åŠŸèƒ½ã€‚æ”¯æŒ State, Getters, Mutations å’Œ Actionsã€‚</p>
<h3 data-id="heading-1">å¼•è¨€</h3>
<blockquote>
<p>åœ¨ AI æ—¶ä»£ï¼Œä¸ºä»€ä¹ˆè¦æä¸€ä¸ªè€æ‰ç‰™çš„ vue2 çš„ vuex å¢å¼ºæ’ä»¶ï¼Ÿå¯ä»¥æƒ³è±¡ï¼Œç°åœ¨èµ·æ­¥åº”è¯¥éƒ½ä¼šæ˜¯ vue3 æˆ–è€… react çš„æ¡†æ¶ã€‚ä½†<strong>è€é¡¹ç›®æ°¸è¿œä¸ä¼šå°‘</strong>ï¼Œé™¤éä¸‹å®šå†³å¿ƒå»é‡æ„ï¼Œå¦åˆ™æ°¸è¿œéƒ½è¦é¢å¯¹è€é¡¹ç›®ï¼Œé‚£åœ¨vscodeä¸­ï¼Œé‡åˆ° vue2 é¡¹ç›®çš„è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œvuex çš„è·³è½¬å®šä¹‰æ°¸è¿œæ˜¯æˆ‘å¼€å‘ä¸è¿­ä»£æ—¶é‡åˆ°çš„ç—›ç‚¹ï¼ŒAI ç»™äº†æˆ‘æœºä¼šï¼Œè®©æˆ‘æ— éœ€åœ¨ç¹é‡çš„ä¸šåŠ¡éœ€æ±‚ä¹‹å¤–ï¼Œé¢å¤–è€—è´¹å¤ªå¤šçš„æ—¶é—´å»å­¦ä¹ æ’ä»¶æ€ä¹ˆä½¿ç”¨ï¼Œè€Œç›´æ¥ä¸Šæ‰‹å»æŠŠæˆ‘çš„æ€è·¯äº¤äºˆå®ç°ã€‚æ„Ÿè°¢ AIï¼Œè®©æˆ‘æœ‰èƒ½åŠ›å»å®Œæˆä¸€äº›å¹³æ—¶ä¸å¯åŠçš„å°äº‹æƒ…ã€‚</p>
</blockquote>
<h3 data-id="heading-2">åŠŸèƒ½ç‰¹æ€§</h3>
<h4 data-id="heading-3">1. è·³è½¬å®šä¹‰ (Go to Definition)</h4>
<p>ä»ç»„ä»¶ä¸­ç›´æ¥è·³è½¬åˆ° Vuex Store çš„å®šä¹‰å¤„ã€‚</p>
<h5 data-id="heading-4">æ¼”ç¤ºï¼šè·³è½¬å®šä¹‰</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c773c66a7ac144429996aeaf36c1bcc0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5Lmm5YyF6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771216236&amp;x-signature=TjRG%2FP7%2FxyFiKuoanfXYjxx%2Bq0g%3D" alt="jump_definition.gif" loading="lazy"/></p>
<ul>
<li><strong>æ”¯æŒ</strong>: <code>this.$store.state/getters/commit/dispatch</code></li>
<li><strong>Map è¾…åŠ©å‡½æ•°</strong>: <code>mapState</code>, <code>mapGetters</code>, <code>mapMutations</code>, <code>mapActions</code></li>
<li><strong>å‘½åç©ºé—´</strong>: å®Œç¾æ”¯æŒ Namespaced æ¨¡å—åŠå…¶åµŒå¥—ã€‚</li>
</ul>
<h4 data-id="heading-5">2. æ™ºèƒ½ä»£ç è¡¥å…¨ (Intelligent Code Completion)</h4>
<p>æ™ºèƒ½æç¤º Vuex çš„å„ç§ Key ä»¥åŠç»„ä»¶ä¸­æ˜ å°„çš„æ–¹æ³•ã€‚</p>
<h5 data-id="heading-6">æ¼”ç¤ºï¼šæ™ºèƒ½è¡¥å…¨</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/753860d9860c41828bfd55b71ee0da06~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5Lmm5YyF6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771216236&amp;x-signature=pi7kabadmE51E1ABFAjaqguO6NE%3D" alt="auto_tips_and_complete_for_var.gif" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8bf012de79ba4fab8dcbbb577a6f5860~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5Lmm5YyF6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771216236&amp;x-signature=fiSB5wta6aeWCaqQq5wEdePzg%2Fk%3D" alt="auto_tips_and_complete_for_func.gif" loading="lazy"/></p>
<ul>
<li><strong>ä¸Šä¸‹æ–‡æ„ŸçŸ¥</strong>: åœ¨ <code>dispatch</code> ä¸­æç¤º Actionsï¼Œåœ¨ <code>commit</code> ä¸­æç¤º Mutationsã€‚</li>
<li><strong>å‘½åç©ºé—´è¿‡æ»¤</strong>: å½“ä½¿ç”¨ <code>mapState('user', [...])</code> æ—¶ï¼Œä¼šè‡ªåŠ¨è¿‡æ»¤å¹¶ä»…æ˜¾ç¤º <code>user</code> æ¨¡å—ä¸‹çš„å†…å®¹ã€‚</li>
<li><strong>ç»„ä»¶æ˜ å°„æ–¹æ³•</strong>: è¾“å…¥ <code>this.</code> å³å¯æç¤ºæ˜ å°„çš„æ–¹æ³•ï¼ˆä¾‹å¦‚ <code>this.increment</code> æ˜ å°„è‡ª <code>...mapMutations(['increment'])</code>ï¼‰ã€‚</li>
<li><strong>è¯­æ³•æ”¯æŒ</strong>: æ”¯æŒæ•°ç»„è¯­æ³•å’Œå¯¹è±¡åˆ«åè¯­æ³• (ä¾‹å¦‚ <code>...mapActions({ alias: 'name' })</code>)ã€‚</li>
</ul>
<h4 data-id="heading-7">3. æ‚¬æµ®æç¤ºä¸ç±»å‹æ¨å¯¼ (Hover Information &amp; Type Inference)</h4>
<p>æ— éœ€è·³è½¬å³å¯æŸ¥çœ‹æ–‡æ¡£ã€ç±»å‹è¯¦æƒ…ã€‚</p>
<h5 data-id="heading-8">æ¼”ç¤ºï¼šæ‚¬æµ®æ–‡æ¡£</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/659696bacfd64f7096fae1dc5173a563~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5Lmm5YyF6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771216236&amp;x-signature=meaY9dItS9ORHJp0D5F4F6twjdo%3D" alt="hover_info_and_type_inference.gif" loading="lazy"/></p>
<ul>
<li><strong>JSDoc æ”¯æŒ</strong>: æå–å¹¶æ˜¾ç¤º Store å®šä¹‰å¤„çš„ <code>/** ... */</code> æ³¨é‡Šæ–‡æ¡£ã€‚</li>
<li><strong>State ç±»å‹</strong>: åœ¨æ‚¬æµ®æç¤ºä¸­è‡ªåŠ¨æ¨å¯¼å¹¶æ˜¾ç¤º State å±æ€§çš„ç±»å‹ (ä¾‹å¦‚ <code>(State) appName: string</code>)ã€‚</li>
<li><strong>è¯¦ç»†ä¿¡æ¯</strong>: æ˜¾ç¤ºç±»å‹ï¼ˆState/Mutationç­‰ï¼‰åŠå®šä¹‰æ‰€åœ¨çš„æ–‡ä»¶è·¯å¾„ã€‚</li>
<li><strong>æ˜ å°„æ–¹æ³•</strong>: æ”¯æŒæŸ¥çœ‹æ˜ å°„æ–¹æ³•çš„ Store æ–‡æ¡£ã€‚</li>
</ul>
<h4 data-id="heading-9">4. Store å†…éƒ¨è°ƒç”¨ (Store Internal Usage)</h4>
<p>åŒæ ·æ”¯æŒåœ¨ Vuex Store å†…éƒ¨ ä»£ç è¡¥å…¨ã€è·³è½¬ã€æ‚¬æµ®æç¤ºã€‚</p>
<h5 data-id="heading-10">æ¼”ç¤ºï¼šStore å†…éƒ¨ ä»£ç è¡¥å…¨ã€è·³è½¬ã€æ‚¬æµ®æç¤º</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8315d95ba2294d3aa57b071111876b75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5Lmm5YyF6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771216236&amp;x-signature=%2Fx5CjrkrjGrPW7N32MwLSN3FFJo%3D" alt="internal_usage.gif" loading="lazy"/></p>
<ul>
<li><strong>æ¨¡å—ä½œç”¨åŸŸ</strong>: å½“åœ¨æ¨¡å—æ–‡ä»¶ï¼ˆå¦‚ <code>user.js</code>ï¼‰ä¸­ç¼–å†™ Action æ—¶ï¼Œ<code>commit</code> å’Œ <code>dispatch</code> çš„ä»£ç è¡¥å…¨ä¼šè‡ªåŠ¨è¿‡æ»¤å¹¶ä»…æ˜¾ç¤ºå½“å‰æ¨¡å—çš„å†…å®¹ã€‚</li>
</ul>
<p>åŒæ ·æ”¯æŒåœ¨ Vuex Store å†…éƒ¨ ä»£ç è¡¥å…¨ã€è·³è½¬ã€æ‚¬æµ®æç¤ºã€‚</p>
<h3 data-id="heading-11">æ”¯æŒçš„è¯­æ³•ç¤ºä¾‹</h3>
<ul>
<li><strong>è¾…åŠ©å‡½æ•° (Helpers)</strong>:
<pre><code class="hljs language-javascript" lang="javascript">...<span class="hljs-title function_">mapState</span>([<span class="hljs-string">'count'</span>])
...<span class="hljs-title function_">mapState</span>(<span class="hljs-string">'user'</span>, [<span class="hljs-string">'name'</span>]) <span class="hljs-comment">// å‘½åç©ºé—´æ”¯æŒ</span>
...<span class="hljs-title function_">mapActions</span>({ <span class="hljs-attr">add</span>: <span class="hljs-string">'increment'</span> }) <span class="hljs-comment">// å¯¹è±¡åˆ«åæ”¯æŒ</span>
...<span class="hljs-title function_">mapActions</span>([<span class="hljs-string">'add/increment'</span>])
</code></pre>
</li>
<li><strong>Store æ–¹æ³•</strong>:
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-title function_">commit</span>(<span class="hljs-string">"SET_NAME"</span>, value);
<span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-title function_">dispatch</span>(<span class="hljs-string">"user/updateName"</span>, value);
</code></pre>
</li>
<li><strong>ç»„ä»¶æ–¹æ³•</strong>:
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">this</span>.<span class="hljs-title function_">increment</span>(); <span class="hljs-comment">// æ˜ å°„è‡ª mapMutations</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">appName</span>; <span class="hljs-comment">// æ˜ å°„è‡ª mapState</span>
</code></pre>
</li>
</ul>
<h3 data-id="heading-12">ä½¿ç”¨è¦æ±‚</h3>
<ul>
<li>ä½¿ç”¨ Vuex çš„ Vue 2 é¡¹ç›®ã€‚</li>
<li>Store å…¥å£ä½äº <code>src/store/index.js</code> æˆ– <code>src/store/index.ts</code>ï¼ˆæ”¯æŒè‡ªåŠ¨æ¢æµ‹ï¼‰ã€‚</li>
<li>è‹¥æ— æ³•è‡ªåŠ¨æ‰¾åˆ°ï¼Œè¯·åœ¨è®¾ç½®ä¸­é…ç½® <code>vuexHelper.storeEntry</code>ã€‚</li>
</ul>
<h3 data-id="heading-13">é…ç½®é¡¹</h3>
<ul>
<li><code>vuexHelper.storeEntry</code>: æ‰‹åŠ¨æŒ‡å®š Store å…¥å£æ–‡ä»¶è·¯å¾„ã€‚æ”¯æŒï¼š
<ul>
<li>åˆ«åè·¯å¾„: <code>@/store/index.js</code> (éœ€åœ¨ jsconfig/tsconfig ä¸­é…ç½®)</li>
<li>ç›¸å¯¹è·¯å¾„: <code>src/store/index.js</code></li>
<li>ç»å¯¹è·¯å¾„: <code>/User/xxx/project/src/store/index.js</code></li>
</ul>
</li>
</ul>
<h3 data-id="heading-14">æ›´æ–°æ—¥å¿—</h3>
<h4 data-id="heading-15">0.0.1</h4>
<p>åˆå§‹ç‰ˆæœ¬ï¼Œæ”¯æŒåŠŸèƒ½ï¼š</p>
<ul>
<li>å…¨é¢æ”¯æŒ State, Getters, Mutations, Actions</li>
<li>æ”¯æŒå‘½åç©ºé—´è¿‡æ»¤ (Namespace Filtering)</li>
<li>æ”¯æŒ JSDoc æ‚¬æµ®æ–‡æ¡£æ˜¾ç¤º</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»é¡µé¢åŠ è½½è¿‡ç¨‹çœ‹ Kuikly çš„å¤šçº¿ç¨‹æ¶æ„]]></title>    <link>https://juejin.cn/post/7603958579180486656</link>    <guid>https://juejin.cn/post/7603958579180486656</guid>    <pubDate>2026-02-09T04:28:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603958579180486656" data-draft-id="7604155045235900451" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»é¡µé¢åŠ è½½è¿‡ç¨‹çœ‹ Kuikly çš„å¤šçº¿ç¨‹æ¶æ„"/> <meta itemprop="keywords" content="Kotlin"/> <meta itemprop="datePublished" content="2026-02-09T04:28:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æˆ‘æœ‰ä¸ä¸ç—‡"/> <meta itemprop="url" content="https://juejin.cn/user/4466629837071787"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»é¡µé¢åŠ è½½è¿‡ç¨‹çœ‹ Kuikly çš„å¤šçº¿ç¨‹æ¶æ„
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4466629837071787/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æˆ‘æœ‰ä¸ä¸ç—‡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T04:28:04.000Z" title="Mon Feb 09 2026 04:28:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»18åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡é€‚åˆ Kotlin/Kuikly åˆå­¦è€…é˜…è¯»ã€‚æˆ‘ä»¬ä¸åšæ³›æ³›è€Œè°ˆï¼Œè€Œæ˜¯ä»¥"ä¸€ä¸ªé¡µé¢æ˜¯æ€ä¹ˆè¢«åŠ è½½å‡ºæ¥çš„"è¿™æ¡ä¸»çº¿ä¸ºè„‰ç»œï¼Œä¸€æ­¥ä¸€æ­¥è·Ÿè¸ªæºç ï¼Œå½»åº•å¼„æ¸… Kuikly çš„åŒçº¿ç¨‹æ¨¡å‹æ˜¯ä»€ä¹ˆã€ä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡ã€ä»¥åŠå®ƒå¦‚ä½•ä¿è¯é«˜æ€§èƒ½å’Œçº¿ç¨‹å®‰å…¨ã€‚</p>
</blockquote>
<h2 data-id="heading-0">1. ä¸ºä»€ä¹ˆéœ€è¦åŒçº¿ç¨‹ï¼Ÿ</h2>
<p>åœ¨ç†è§£ Kuikly çš„å¤šçº¿ç¨‹æ¨¡å‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæƒ³ä¸€ä¸ªé—®é¢˜ï¼š<strong>å¦‚æœæŠŠæ‰€æœ‰äº‹æƒ…éƒ½æ”¾åœ¨ä¸»çº¿ç¨‹åšï¼Œä¼šæ€æ ·ï¼Ÿ</strong></p>
<p>ä¸€ä¸ª UI æ¡†æ¶éœ€è¦åšä¸¤å¤§ç±»äº‹æƒ…ï¼š</p>




















<table><thead><tr><th>ç±»åˆ«</th><th>å…·ä½“å·¥ä½œ</th><th>è€—æ—¶ç‰¹å¾</th></tr></thead><tbody><tr><td><strong>é€»è¾‘è®¡ç®—</strong></td><td>æ‰§è¡Œä¸šåŠ¡ä»£ç ã€æ„å»ºè™šæ‹Ÿè§†å›¾æ ‘ã€è®¡ç®— Flexbox å¸ƒå±€ã€å¤„ç†å“åº”å¼æ›´æ–°</td><td>CPU å¯†é›†</td></tr><tr><td><strong>åŸç”Ÿæ¸²æŸ“</strong></td><td>åˆ›å»ºå¹³å° Viewã€è®¾ç½®å±æ€§ã€è®¾ç½® frameã€æ’å…¥è§†å›¾å±‚çº§</td><td>å¿…é¡»åœ¨ UI çº¿ç¨‹</td></tr></tbody></table>
<p>å¦‚æœå…¨æ”¾ä¸»çº¿ç¨‹ï¼Œé€»è¾‘è®¡ç®—ä¼šé˜»å¡ UI æ¸²æŸ“ï¼Œç”¨æˆ·çœ‹åˆ°çš„å°±æ˜¯"å¡"ã€‚React Native å¾ˆæ—©å°±é‡‡ç”¨äº†ç±»ä¼¼çš„åŒçº¿ç¨‹æ–¹æ¡ˆâ€”â€”JS çº¿ç¨‹åšé€»è¾‘ï¼Œä¸»çº¿ç¨‹åšæ¸²æŸ“ã€‚Kuikly çš„æ€è·¯ä¸€è„‰ç›¸æ‰¿ï¼š</p>
<blockquote>
<p><strong>Context çº¿ç¨‹</strong>ï¼ˆä¹Ÿå« Kuikly çº¿ç¨‹ï¼‰ï¼šè¿è¡Œ Kotlin ä¸šåŠ¡é€»è¾‘ã€DSL æ„å»ºã€å¸ƒå±€è®¡ç®—<br/>
<strong>Main çº¿ç¨‹</strong>ï¼ˆUI çº¿ç¨‹ï¼‰ï¼šæ‰§è¡ŒåŸç”Ÿ View çš„åˆ›å»ºã€å±æ€§è®¾ç½®ã€å¸§å¸ƒå±€</p>
</blockquote>
<p>è¿™ç§åˆ†å·¥å¸¦æ¥ä¸‰ä¸ªæ ¸å¿ƒä¼˜åŠ¿ï¼š</p>
<ol>
<li><strong>ä¸å¡ä¸»çº¿ç¨‹</strong>ï¼šæ— è®ºä½ çš„ä¸šåŠ¡é€»è¾‘å¤šå¤æ‚ï¼Œç”¨æˆ·çš„æ»‘åŠ¨ã€ç‚¹å‡»æ°¸è¿œæµç•…</li>
<li><strong>æ‰¹é‡ä¸Šå±</strong>ï¼šContext çº¿ç¨‹äº§ç”Ÿçš„ UI æŒ‡ä»¤å¯ä»¥æ”’ä¸€æ‰¹å†ä¸€æ¬¡æ€§æäº¤ç»™ä¸»çº¿ç¨‹ï¼Œå‡å°‘çº¿ç¨‹åˆ‡æ¢å¼€é”€</li>
<li><strong>æ¶æ„æ¸…æ™°</strong>ï¼šKotlin ä¾§å®Œå…¨ä¸éœ€è¦å…³å¿ƒçº¿ç¨‹é—®é¢˜ï¼Œå› ä¸ºå®ƒæ°¸è¿œè¿è¡Œåœ¨åŒä¸€æ¡çº¿ç¨‹ä¸Š</li>
</ol>
<hr/>
<h2 data-id="heading-1">2. ä¸¤æ¡çº¿ç¨‹å„è‡ªè´Ÿè´£ä»€ä¹ˆ</h2>
<p>è®©æˆ‘ä»¬ç”¨ä¸€å¼ è¡¨æ ¼æ¥æ˜ç¡®ä¸¤æ¡çº¿ç¨‹çš„èŒè´£è¾¹ç•Œï¼š</p>
<pre><code class="hljs language-sql" lang="sql">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Context çº¿ç¨‹ (Kuikly çº¿ç¨‹)                 â”‚
â”‚                                                              â”‚
â”‚  âœ¦ Kotlin ä¸šåŠ¡ä»£ç æ‰§è¡Œ                                         â”‚
â”‚  âœ¦ Pager ç”Ÿå‘½å‘¨æœŸï¼ˆwillInit â†’ didInit â†’ body â†’ createBodyï¼‰    â”‚
â”‚  âœ¦ DSL æ„å»ºï¼ˆattr{} <span class="hljs-operator">/</span> event{} å—çš„æ‰§è¡Œï¼‰                       â”‚
â”‚  âœ¦ Flexbox å¸ƒå±€è®¡ç®—ï¼ˆflexNode.calculateLayoutï¼‰                â”‚
â”‚  âœ¦ å“åº”å¼ç³»ç»Ÿï¼ˆobservable å˜åŒ– â†’ é‡æ–°æ‰§è¡Œç»‘å®šå—ï¼‰                  â”‚
â”‚  âœ¦ åç¨‹è°ƒåº¦ï¼ˆsetTimeoutã€LifecycleScopeï¼‰                      â”‚
â”‚  âœ¦ <span class="hljs-keyword">Module</span> è°ƒç”¨çš„å‘èµ·ç«¯                                         â”‚
â”‚                                                              â”‚
â”‚  äº§å‡ºï¼šä¸€ç³»åˆ—"UI æŒ‡ä»¤"ï¼ˆåˆ›å»º <span class="hljs-keyword">View</span>ã€è®¾å±æ€§ã€è®¾ Frameâ€¦â€¦ï¼‰           â”‚
â”‚       é€šè¿‡ BridgeManager.callNativeMethod() å‘é€ç»™ Native ä¾§  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ UI æŒ‡ä»¤
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Main çº¿ç¨‹ (UI çº¿ç¨‹)                        â”‚
â”‚                                                              â”‚
â”‚  âœ¦ æ¥æ”¶ UI æŒ‡ä»¤å¹¶æ‰¹é‡æ‰§è¡Œ                                       â”‚
â”‚  âœ¦ åˆ›å»ºåŸç”Ÿ <span class="hljs-keyword">View</span>ï¼ˆTextViewã€ImageViewâ€¦â€¦ï¼‰                      â”‚
â”‚  âœ¦ è®¾ç½® <span class="hljs-keyword">View</span> å±æ€§ï¼ˆèƒŒæ™¯è‰²ã€å­—ä½“ã€åœ†è§’â€¦â€¦ï¼‰                        â”‚
â”‚  âœ¦ è®¾ç½® <span class="hljs-keyword">View</span> Frameï¼ˆä½ç½®å’Œå¤§å°ï¼‰                                â”‚
â”‚  âœ¦ æ’å…¥ <span class="hljs-keyword">View</span> åˆ°çˆ¶è§†å›¾                                          â”‚
â”‚  âœ¦ äº‹ä»¶è§¦å‘åé€šçŸ¥ Context çº¿ç¨‹                                  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h2 data-id="heading-2">3. å®Œæ•´çš„é¡µé¢åŠ è½½æ—¶åº</h2>
<p>åœ¨æ·±å…¥æ¯ä¸€æ­¥ä¹‹å‰ï¼Œå…ˆçœ‹å®Œæ•´çš„æ—¶åºå›¾ï¼Œå¯¹å…¨å±€æœ‰ä¸ªæ¦‚å¿µï¼š</p>
<pre><code class="hljs language-scss" lang="scss">æ—¶é—´è½´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’

<span class="hljs-selector-tag">Main</span> çº¿ç¨‹    Context çº¿ç¨‹    è¯´æ˜
    â”‚              â”‚
    â”‚ <span class="hljs-built_in">init</span>()       â”‚         â‘  ç”¨æˆ·è°ƒç”¨ KuiklyRenderView<span class="hljs-selector-class">.init</span>()
    â”‚â”€â”€scheduleâ”€â”€â†’â”‚         â‘¡ åˆ‡æ¢åˆ° Context çº¿ç¨‹
    â”‚              â”‚
    â”‚         <span class="hljs-built_in">initContext</span>()  â‘¢ åŠ è½½ Kotlin å¼•æ“ã€åˆ›å»º NativeBridge
    â”‚              â”‚
    â”‚        callKotlinMethod  â‘£ è°ƒç”¨ CREATE_INSTANCE
    â”‚          (CREATE_INSTANCE)
    â”‚              â”‚
    â”‚         PagerManager     â‘¤ é€šè¿‡é¡µé¢æ³¨å†Œè¡¨æ‰¾åˆ° creator
    â”‚          <span class="hljs-selector-class">.createPager</span>()
    â”‚              â”‚
    â”‚         pager<span class="hljs-selector-class">.onCreatePager</span>()  â‘¥ Pager ç”Ÿå‘½å‘¨æœŸå¼€å§‹
    â”‚           â”œâ”€ <span class="hljs-built_in">willInit</span>()
    â”‚           â”œâ”€ <span class="hljs-built_in">initModule</span>()
    â”‚           â”œâ”€ <span class="hljs-built_in">didInit</span>() â†’ <span class="hljs-selector-tag">body</span>()  â† æ„å»ºè™šæ‹Ÿè§†å›¾æ ‘
    â”‚           â””â”€ <span class="hljs-built_in">createBody</span>()
    â”‚               â”œâ”€ <span class="hljs-built_in">createFlexNode</span>()
    â”‚               â”œâ”€ <span class="hljs-built_in">createRenderView</span>()  â†’ <span class="hljs-built_in">callNative</span>(CREATE_RENDER_VIEW)
    â”‚               â”œâ”€ <span class="hljs-built_in">setViewProp</span>()       â†’ <span class="hljs-built_in">callNative</span>(SET_VIEW_PROP)  Ã—N
    â”‚               â””â”€ <span class="hljs-built_in">layoutIfNeed</span>()      â†’ <span class="hljs-built_in">callNative</span>(SET_RENDER_VIEW_FRAME) Ã—N
    â”‚              â”‚
    â”‚              â”‚  â”€â”€ ä¸Šé¢è¿™äº› callNative æ˜¯å¼‚æ­¥çš„ï¼Œè¢«æ”¶é›†åˆ° UIScheduler â”€â”€
    â”‚              â”‚
    â”‚â†â”€batch UIâ”€â”€â”‚         â‘¦ UIScheduler æ‰¹é‡æäº¤åˆ°ä¸»çº¿ç¨‹
    â”‚              â”‚
    â”‚ æ‰§è¡Œ UI æŒ‡ä»¤   â”‚         â‘§ ä¸»çº¿ç¨‹ä¾æ¬¡æ‰§è¡Œï¼šåˆ›å»º Viewã€è®¾å±æ€§ã€è®¾ Frame
    â”‚ <span class="hljs-built_in">createView</span>()  â”‚
    â”‚ <span class="hljs-built_in">setProp</span>()     â”‚
    â”‚ <span class="hljs-built_in">setFrame</span>()    â”‚
    â”‚              â”‚
    â”‚ é¦–å±æ¸²æŸ“å®Œæˆ    â”‚         â‘¨ viewDidLoadï¼Œè§¦å‘ FirstFramePaint
    â”‚â”€â”€sendEventâ”€â†’â”‚
    â”‚         onReceivePagerEvent   â‘© Kotlin æ”¶åˆ°é¦–å±äº‹ä»¶
    â”‚          ("pageFirstFramePaint")
</code></pre>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬é€æ­¥æ·±å…¥æ¯ä¸€ä¸ªé˜¶æ®µçš„æºç å®ç°ã€‚</p>
<hr/>
<h2 data-id="heading-3">4. ç¬¬ä¸€é˜¶æ®µï¼šä¸»çº¿ç¨‹ä¸Šçš„å‡†å¤‡å·¥ä½œ</h2>
<h3 data-id="heading-4">4.1 Android ç«¯å…¥å£</h3>
<p>ä¸€åˆ‡ä» <code>KuiklyRenderView.init()</code> å¼€å§‹ã€‚è¿™ä¸ªæ–¹æ³•<strong>å¿…é¡»åœ¨ä¸»çº¿ç¨‹è°ƒç”¨</strong>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// KuiklyRenderView.kt</span>
<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">init</span><span class="hljs-params">(contextCode: <span class="hljs-type">String</span>, pageName: <span class="hljs-type">String</span>, 
                  params: <span class="hljs-type">Map</span>&lt;<span class="hljs-type">String</span>, Any&gt;, size: <span class="hljs-type">Size</span>?, assetsPath: <span class="hljs-type">String</span>?)</span></span> {
    assert(isMainThread())  <span class="hljs-comment">// â† æ–­è¨€ï¼šå¿…é¡»åœ¨ä¸»çº¿ç¨‹</span>
    initKuiklyClassLoaderIfNeed(contextCode)
    <span class="hljs-keyword">val</span> initRenderCoreTask = { sz: SizeF -&gt;
        initRenderCore(contextCode, pageName, params, sz, assetsPath)
    }
    <span class="hljs-comment">// å¦‚æœå·²çŸ¥ sizeï¼Œç«‹å³åˆå§‹åŒ–ï¼›å¦åˆ™ç­‰ onSizeChanged å›è°ƒ</span>
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆå¿…é¡»åœ¨ä¸»çº¿ç¨‹ï¼Ÿ</strong> å› ä¸º <code>KuiklyRenderView</code> æœ¬èº«æ˜¯ä¸€ä¸ª Android <code>View</code>ï¼ŒView çš„åˆå§‹åŒ–ã€æ·»åŠ å­ View ç­‰æ“ä½œéƒ½å¿…é¡»åœ¨ UI çº¿ç¨‹ã€‚</p>
<h3 data-id="heading-5">4.2 iOS ç«¯å…¥å£</h3>
<p>iOS ç«¯åŒç†ï¼Œ<code>KuiklyRenderView</code> æ˜¯ä¸€ä¸ª <code>UIView</code>ï¼š</p>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-comment">// KuiklyRenderView.m</span>
- (<span class="hljs-keyword">instancetype</span>)initWithSize:(<span class="hljs-built_in">CGSize</span>)size contextCode:(<span class="hljs-built_in">NSString</span> *)contextCode
    contextParam:(KuiklyContextParam *)contextParam params:(<span class="hljs-built_in">NSDictionary</span> *)params
    delegate:(<span class="hljs-type">id</span>&lt;KuiklyRenderViewDelegate&gt;)delegate {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span> = [<span class="hljs-variable language_">super</span> init]) {
        _renderCore = [[KuiklyRenderCore alloc] initWithRootView:<span class="hljs-keyword">self</span>
                                                     contextCode:contextCode
                                                    contextParam:contextParam
                                                          params:coreParams
                                                        delegate:<span class="hljs-keyword">self</span>];
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;
}
</code></pre>
<p>ä¸¤ç«¯çš„æ¨¡å¼å®Œå…¨ä¸€è‡´ï¼šä¸»çº¿ç¨‹åˆ›å»ºå®¿ä¸» View â†’ åˆå§‹åŒ– RenderCore â†’ RenderCore å†…éƒ¨åˆ‡æ¢åˆ° Context çº¿ç¨‹ã€‚</p>
<hr/>
<h2 data-id="heading-6">5. ç¬¬äºŒé˜¶æ®µï¼šåˆ‡æ¢åˆ° Context çº¿ç¨‹åˆ›å»ºé¡µé¢</h2>
<h3 data-id="heading-7">5.1 KuiklyRenderCore.init() â€”â€” å…³é”®çš„çº¿ç¨‹åˆ‡æ¢ç‚¹</h3>
<p>è¿™æ˜¯æ•´ä¸ªé¡µé¢åŠ è½½è¿‡ç¨‹ä¸­<strong>æœ€é‡è¦çš„çº¿ç¨‹åˆ‡æ¢</strong>ã€‚æˆ‘ä»¬ä»¥ Android ç«¯ä¸ºä¾‹ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// KuiklyRenderCore.kt</span>
<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">init</span><span class="hljs-params">(...)</span></span> {
    <span class="hljs-comment">// è¿˜åœ¨ä¸»çº¿ç¨‹ï¼šåˆ›å»ºè°ƒåº¦å™¨</span>
    uiScheduler = KuiklyRenderCoreUIScheduler { ... }
    renderLayerHandler = KuiklyRenderLayerHandler().apply { <span class="hljs-keyword">init</span>(renderView) }
    initNativeMethodRegisters()  <span class="hljs-comment">// æ³¨å†Œ Native æ–¹æ³•å›è°ƒè¡¨</span>

    <span class="hljs-comment">// â˜…â˜…â˜… å…³é”®ï¼šåˆ‡æ¢åˆ° Context çº¿ç¨‹ â˜…â˜…â˜…</span>
    performOnContextQueue {
        initContextHandler(contextCode, url, params, contextInitCallback)
    }
}
</code></pre>
<p><code>performOnContextQueue</code> æ˜¯ä»€ä¹ˆï¼Ÿè®©æˆ‘ä»¬çœ‹çœ‹ Context çº¿ç¨‹æ˜¯æ€ä¹ˆåˆ›å»ºçš„ã€‚</p>
<h3 data-id="heading-8">5.2 Android çš„ Context çº¿ç¨‹ï¼šHandlerThread</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// KuiklyRenderCoreContextScheduler.kt</span>
<span class="hljs-keyword">object</span> KuiklyRenderCoreContextScheduler : IKuiklyRenderCoreScheduler {

    <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> THREAD_NAME = <span class="hljs-string">"HRContextQueueHandlerThread"</span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> handler <span class="hljs-keyword">by</span> lazy {
        Handler(<span class="hljs-keyword">object</span> : HandlerThread(THREAD_NAME, Process.THREAD_PRIORITY_FOREGROUND) {
            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onLooperPrepared</span><span class="hljs-params">()</span></span> { 
                NativeBridge.isContextThread = <span class="hljs-literal">true</span>  <span class="hljs-comment">// â† æ ‡è®°å½“å‰çº¿ç¨‹ä¸º Context çº¿ç¨‹</span>
            }
        }.apply { start() }.looper)
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">scheduleTask</span><span class="hljs-params">(delayMs: <span class="hljs-type">Long</span>, task: <span class="hljs-type">KuiklyRenderCoreTask</span>)</span></span> {
        handler.postDelayed(task, delayMs)  <span class="hljs-comment">// æŠŠä»»åŠ¡ post åˆ° Context çº¿ç¨‹çš„æ¶ˆæ¯é˜Ÿåˆ—</span>
    }
}
</code></pre>
<p><strong>Kotlin è¯­æ³•è®²è§£</strong>â€”â€”è¿™æ®µä»£ç æœ‰å‡ ä¸ªå€¼å¾—æ·±å…¥ç†è§£çš„è¯­æ³•ï¼š</p>
<h4 data-id="heading-9"><code>object</code> å•ä¾‹å£°æ˜</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">object</span> KuiklyRenderCoreContextScheduler : IKuiklyRenderCoreScheduler { ... }
</code></pre>
<p>Kotlin çš„ <code>object</code> å£°æ˜åˆ›å»ºäº†ä¸€ä¸ª<strong>å•ä¾‹</strong>ã€‚æ•´ä¸ª App è¿›ç¨‹ä¸­åªæœ‰ä¸€ä¸ª <code>KuiklyRenderCoreContextScheduler</code> å®ä¾‹ï¼Œè¿™æ„å‘³ç€åªæœ‰ä¸€æ¡ Context çº¿ç¨‹ã€‚æ‰€æœ‰ Kuikly é¡µé¢å…±äº«è¿™ä¸€æ¡çº¿ç¨‹ã€‚</p>
<h4 data-id="heading-10"><code>by lazy</code> æ‡’åˆå§‹åŒ–</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> handler <span class="hljs-keyword">by</span> lazy { ... }
</code></pre>
<p><code>by lazy</code> æ˜¯å±æ€§å§”æ‰˜çš„ä¸€ç§ï¼Œå®ƒçš„å«ä¹‰æ˜¯ï¼š<strong>ç¬¬ä¸€æ¬¡è®¿é—® <code>handler</code> æ—¶æ‰æ‰§è¡ŒèŠ±æ‹¬å·é‡Œçš„ä»£ç </strong>ã€‚è¿™ä¿è¯äº† Context çº¿ç¨‹ä¸ä¼šåœ¨ App å¯åŠ¨æ—¶å°±è¢«åˆ›å»ºï¼Œè€Œæ˜¯åœ¨ç¬¬ä¸€ä¸ª Kuikly é¡µé¢åŠ è½½æ—¶æ‰åˆ›å»ºã€‚</p>
<h4 data-id="heading-11"><code>HandlerThread</code></h4>
<p><code>HandlerThread</code> æ˜¯ Android æä¾›çš„ä¸€ä¸ªå¸¦æ¶ˆæ¯å¾ªç¯çš„çº¿ç¨‹ã€‚å®ƒå†…éƒ¨æœ‰ä¸€ä¸ª <code>Looper</code>ï¼ˆæ¶ˆæ¯æ³µï¼‰ï¼Œé…åˆ <code>Handler</code> ä½¿ç”¨æ—¶ï¼Œå¯ä»¥ä¸æ–­åœ°ä»æ¶ˆæ¯é˜Ÿåˆ—å–ä»»åŠ¡æ‰§è¡Œã€‚è¿™å°±æ˜¯ Context çº¿ç¨‹çš„æœ¬è´¨ï¼š<strong>ä¸€ä¸ªä¸²è¡Œçš„ä»»åŠ¡é˜Ÿåˆ—</strong>ï¼Œæ‰€æœ‰ Kotlin é€»è¾‘éƒ½æŒ‰é¡ºåºåœ¨è¿™é‡Œæ‰§è¡Œã€‚</p>
<h4 data-id="heading-12"><code>ThreadLocal</code> æ ‡è®°</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// NativeBridge.kt (Android)</span>
<span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _isContextThread = ThreadLocal&lt;<span class="hljs-built_in">Boolean</span>&gt;()
    <span class="hljs-keyword">var</span> isContextThread: <span class="hljs-built_in">Boolean</span>
        <span class="hljs-keyword">get</span>() = _isContextThread.<span class="hljs-keyword">get</span>() ?: <span class="hljs-literal">false</span>
        <span class="hljs-keyword">set</span>(value) { _isContextThread.<span class="hljs-keyword">set</span>(value) }
}
</code></pre>
<p><code>ThreadLocal</code> æ˜¯ Java/Kotlin çš„çº¿ç¨‹å±€éƒ¨å˜é‡ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ <code>isContextThread</code> å€¼ã€‚å½“ Context çº¿ç¨‹å¯åŠ¨æ—¶ï¼Œ<code>onLooperPrepared</code> è¢«è°ƒç”¨ï¼Œæ­¤æ—¶åœ¨ Context çº¿ç¨‹å†…å°† <code>isContextThread</code> è®¾ä¸º <code>true</code>ã€‚ä¹‹åä»»ä½•åœ°æ–¹è°ƒç”¨ <code>NativeBridge.isContextThread</code> éƒ½èƒ½åˆ¤æ–­å½“å‰æ˜¯å¦åœ¨ Context çº¿ç¨‹ä¸Šã€‚</p>
<h3 data-id="heading-13">5.3 iOS çš„ Context çº¿ç¨‹ï¼šGCD ä¸²è¡Œé˜Ÿåˆ—</h3>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-comment">// KuiklyRenderThreadManager.m</span>
<span class="hljs-keyword">static</span> <span class="hljs-built_in">dispatch_queue_t</span> gContextQueue = <span class="hljs-literal">NULL</span>;

+ (<span class="hljs-built_in">dispatch_queue_t</span>)contextQueue {
    <span class="hljs-keyword">static</span> <span class="hljs-built_in">dispatch_once_t</span> onceToken;
    <span class="hljs-built_in">dispatch_once</span>(&amp;onceToken, ^{
        dispatch_queue_attr_t queue_attr = dispatch_queue_attr_make_with_qos_class(
            DISPATCH_QUEUE_SERIAL,          <span class="hljs-comment">// ä¸²è¡Œé˜Ÿåˆ—</span>
            QOS_CLASS_USER_INTERACTIVE, <span class="hljs-number">0</span>); <span class="hljs-comment">// æœ€é«˜ QoS ä¼˜å…ˆçº§</span>
        gContextQueue = dispatch_queue_create(<span class="hljs-string">"com.tencent.kuikly.context"</span>, queue_attr);
        dispatch_queue_set_specific(gContextQueue, &amp;gContextQueue, ...);
    });
    <span class="hljs-keyword">return</span> gContextQueue;
}
</code></pre>
<p>iOS ä½¿ç”¨ GCDï¼ˆGrand Central Dispatchï¼‰çš„ä¸²è¡Œé˜Ÿåˆ—ã€‚æ³¨æ„ä¸¤ä¸ªå…³é”®é€‰æ‹©ï¼š</p>
<ol>
<li><strong><code>DISPATCH_QUEUE_SERIAL</code></strong>ï¼ˆä¸²è¡Œï¼‰ï¼šä¿è¯æ‰€æœ‰ä»»åŠ¡æŒ‰é¡ºåºæ‰§è¡Œï¼Œä¸ä¼šå¹¶å‘ï¼Œå› æ­¤ä¸éœ€è¦é”</li>
<li><strong><code>QOS_CLASS_USER_INTERACTIVE</code></strong>ï¼ˆç”¨æˆ·äº¤äº’çº§ï¼‰ï¼šè¿™æ˜¯ iOS æœ€é«˜ä¼˜å…ˆçº§çš„ QoSï¼Œå‘Šè¯‰ç³»ç»Ÿ"è¿™ä¸ªé˜Ÿåˆ—çš„ä»»åŠ¡å¾ˆç´§æ€¥ï¼Œç›´æ¥å½±å“ç”¨æˆ·ä½“éªŒ"</li>
</ol>
<p>åˆ¤æ–­æ˜¯å¦åœ¨ Context é˜Ÿåˆ—ä¸Šï¼š</p>
<pre><code class="hljs language-objc" lang="objc">+ (<span class="hljs-type">BOOL</span>)isContextQueue {
    <span class="hljs-keyword">if</span> (dispatch_get_specific(&amp;gContextQueue)) {  <span class="hljs-comment">// â† ç”¨ queue-specific data åˆ¤æ–­</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">YES</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">NO</span>;
}
</code></pre>
<p><code>dispatch_get_specific</code> æ˜¯ GCD æä¾›çš„ä¸€ä¸ªæœºåˆ¶ï¼šä½ å¯ä»¥ç»™é˜Ÿåˆ—ç»‘å®šä¸€ä¸ª key-valueï¼Œç„¶ååœ¨ä»»æ„åœ°æ–¹æŸ¥è¯¢å½“å‰é˜Ÿåˆ—æ˜¯å¦ç»‘å®šäº†è¿™ä¸ª keyã€‚å¦‚æœè¿”å›é NULLï¼Œè¯´æ˜å½“å‰ä»£ç æ­£åœ¨è¿™ä¸ªé˜Ÿåˆ—ä¸Šæ‰§è¡Œã€‚</p>
<h3 data-id="heading-14">5.4 åœ¨ Context çº¿ç¨‹ä¸Šåˆå§‹åŒ– Kotlin å¼•æ“</h3>
<p>åˆ‡æ¢åˆ° Context çº¿ç¨‹åï¼Œ<code>initContextHandler</code> åšäº†ä¸‰ä»¶äº‹ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// KuiklyRenderCore.kt</span>
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">initContextHandler</span><span class="hljs-params">(contextCode: <span class="hljs-type">String</span>, url: <span class="hljs-type">String</span>, params: <span class="hljs-type">Map</span>&lt;<span class="hljs-type">String</span>, Any&gt;, ...)</span></span> {
    <span class="hljs-comment">// 1. åˆ›å»º ContextHandlerï¼ˆé€šè¿‡åå°„åŠ è½½ KuiklyCoreEntryï¼‰</span>
    contextHandler = KuiklyRenderJvmContextHandler()
    
    contextHandler?.apply {
        <span class="hljs-comment">// 2. æ³¨å†Œ Kotlinâ†’Native çš„å›è°ƒé€šé“</span>
        registerCallNative { method, args -&gt;
            performNativeMethodWithMethod(method, args)
        }
        
        <span class="hljs-comment">// 3. åˆå§‹åŒ– Kotlin å¼•æ“</span>
        <span class="hljs-keyword">init</span>(contextCode)
        
        <span class="hljs-comment">// 4. â˜… è°ƒç”¨ CREATE_INSTANCEï¼Œè§¦å‘ Kotlin ä¾§åˆ›å»ºé¡µé¢ â˜…</span>
        call(KuiklyRenderContextMethodCreateInstance, listOf(instanceId, url, params))
    }
}
</code></pre>
<p>å…¶ä¸­ç¬¬ 4 æ­¥çš„ <code>call(CREATE_INSTANCE, ...)</code> æœ€ç»ˆä¼šè¿›å…¥ Kotlin ä¾§çš„ <code>BridgeManager.callKotlinMethod()</code>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// BridgeManager.kt</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">callKotlinMethod</span><span class="hljs-params">(methodId: <span class="hljs-type">Int</span>, arg0: <span class="hljs-type">Any</span>?, arg1: <span class="hljs-type">Any</span>?, ...)</span></span> {
    currentPageId = arg0 <span class="hljs-keyword">as</span> String
    <span class="hljs-keyword">when</span> (methodId) {
        KotlinMethod.CREATE_INSTANCE -&gt; {
            PagerManager.createPager(arg0 <span class="hljs-keyword">as</span> String, arg1 <span class="hljs-keyword">as</span> String, arg2 <span class="hljs-keyword">as</span> String)
        }
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<p>ç„¶åè¿›å…¥ <code>PagerManager.createPager()</code>ï¼Œé€šè¿‡ä¹‹å‰ <code>@Page</code> æ³¨è§£æ³¨å†Œçš„ creator åˆ›å»ºé¡µé¢å®ä¾‹ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// PagerManager.kt</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createPager</span><span class="hljs-params">(pagerId: <span class="hljs-type">String</span>, url: <span class="hljs-type">String</span>, pagerData: <span class="hljs-type">String</span>)</span></span> {
    <span class="hljs-keyword">val</span> pagerName = pageNameFromUrl(url)
    reactiveObserverMap[pagerId] = ReactiveObserver()
    <span class="hljs-keyword">val</span> pager: IPager? = pagerCreator(pagerName)?.invoke()  <span class="hljs-comment">// â† è°ƒç”¨æ³¨å†Œçš„ creator åˆ›å»º Pager å®ä¾‹</span>
    pagerMap[pagerId] = pager
    pager.onCreatePager(pagerId, JSONObject(pagerData))      <span class="hljs-comment">// â† è¿›å…¥é¡µé¢ç”Ÿå‘½å‘¨æœŸ</span>
}
</code></pre>
<blockquote>
<p><strong>ä»¥ä¸Šæ‰€æœ‰ä»£ç éƒ½åœ¨ Context çº¿ç¨‹ä¸Šæ‰§è¡Œ</strong>ã€‚ä» <code>performOnContextQueue</code> å¼€å§‹ï¼Œåé¢çš„ä¸€åˆ‡é€»è¾‘â€”â€”é¡µé¢åˆ›å»ºã€body æ„å»ºã€å¸ƒå±€è®¡ç®—â€”â€”å…¨éƒ¨åœ¨ Context çº¿ç¨‹ä¸Šä¸²è¡Œè¿è¡Œã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-15">6. ç¬¬ä¸‰é˜¶æ®µï¼šKotlinâ†’Native é€šä¿¡â€”â€”åŒæ­¥ vs å¼‚æ­¥</h2>
<p>é¡µé¢åœ¨ Context çº¿ç¨‹ä¸Šæ‰§è¡Œ <code>onCreatePager()</code> æ—¶ï¼Œä¼šè°ƒç”¨ <code>body()</code> æ–¹æ³•æ„å»ºè™šæ‹Ÿè§†å›¾æ ‘ï¼Œç„¶å <code>createBody()</code> è¿›è¡Œå¸ƒå±€è®¡ç®—ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼ŒKotlin éœ€è¦å‘Šè¯‰ Native ç«¯"å¸®æˆ‘åˆ›å»ºä¸€ä¸ª TextView"ã€"æŠŠå®ƒçš„èƒŒæ™¯è‰²è®¾ä¸ºçº¢è‰²"ã€"æŠŠå®ƒæ”¾åˆ° (10, 20) ä½ç½®"ç­‰ã€‚</p>
<p>è¿™äº›æŒ‡ä»¤é€šè¿‡ <code>BridgeManager</code> å‘å‡ºï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// BridgeManager.kt ä¸­å®šä¹‰çš„ Native æ–¹æ³•</span>
<span class="hljs-keyword">object</span> NativeMethod {
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> CREATE_RENDER_VIEW = <span class="hljs-number">1</span>      <span class="hljs-comment">// åˆ›å»ºåŸç”Ÿ View</span>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> REMOVE_RENDER_VIEW = <span class="hljs-number">2</span>      <span class="hljs-comment">// ç§»é™¤åŸç”Ÿ View</span>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> INSERT_SUB_RENDER_VIEW = <span class="hljs-number">3</span>  <span class="hljs-comment">// æ’å…¥å­ View</span>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> SET_VIEW_PROP = <span class="hljs-number">4</span>           <span class="hljs-comment">// è®¾ç½® View å±æ€§</span>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> SET_RENDER_VIEW_FRAME = <span class="hljs-number">5</span>   <span class="hljs-comment">// è®¾ç½® View çš„ä½ç½®å’Œå¤§å°</span>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> CALCULATE_RENDER_VIEW_SIZE = <span class="hljs-number">6</span>  <span class="hljs-comment">// è®¡ç®— View å°ºå¯¸ï¼ˆåŒæ­¥ï¼ï¼‰</span>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> CREATE_SHADOW = <span class="hljs-number">9</span>           <span class="hljs-comment">// åˆ›å»º Shadow èŠ‚ç‚¹ï¼ˆåŒæ­¥ï¼ï¼‰</span>
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<h3 data-id="heading-16">6.1 å…³é”®è®¾è®¡ï¼šå“ªäº›æ˜¯åŒæ­¥çš„ï¼Ÿå“ªäº›æ˜¯å¼‚æ­¥çš„ï¼Ÿ</h3>
<p>è¿™æ˜¯ Kuikly å¤šçº¿ç¨‹æ¨¡å‹ä¸­æœ€ç²¾å¦™çš„è®¾è®¡ä¹‹ä¸€ã€‚è®©æˆ‘ä»¬çœ‹ Native ç«¯æ”¶åˆ° Kotlin è°ƒç”¨æ—¶çš„å¤„ç†ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// KuiklyRenderCore.kt (Android)</span>
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">performNativeMethodWithMethod</span><span class="hljs-params">(method: <span class="hljs-type">KuiklyRenderNativeMethod</span>, args: <span class="hljs-type">List</span>&lt;<span class="hljs-type">Any</span>?&gt;)</span></span>: Any? {
    <span class="hljs-keyword">val</span> cb = nativeMethodRegistry[method.value]
    cb?.also {
        assert(!isMainThread())  <span class="hljs-comment">// â† æ–­è¨€ï¼šå½“å‰åœ¨ Context çº¿ç¨‹</span>

        <span class="hljs-keyword">if</span> (isSyncMethodCall(method, args)) {
            <span class="hljs-comment">// â˜… åŒæ­¥æ–¹æ³•ï¼šç›´æ¥åœ¨ Context çº¿ç¨‹æ‰§è¡Œï¼Œç«‹å³è¿”å›ç»“æœ</span>
            <span class="hljs-keyword">return</span> it(method, args)
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// â˜… å¼‚æ­¥æ–¹æ³•ï¼šåŠ å…¥ UIScheduler çš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œç¨åæ‰¹é‡åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œ</span>
            uiScheduler?.scheduleTask {
                it(method, args)
            }
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
}
</code></pre>
<p>iOS ç«¯çš„é€»è¾‘å®Œå…¨ä¸€è‡´ï¼š</p>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-comment">// KuiklyRenderCore.m</span>
- (<span class="hljs-type">id</span>)p_performNativeMethodWithMethod:(KuiklyRenderNativeMethod)method args:(<span class="hljs-built_in">NSArray</span> *)args {
    KuiklyRenderNativeMethodCallback methodCallback = _nativeMethodRegistry[@(method)];
    <span class="hljs-keyword">if</span> (methodCallback) {
        [KuiklyRenderThreadManager assertContextQueue];
        <span class="hljs-keyword">if</span> ([<span class="hljs-keyword">self</span> p_shouldSyncCallWithWithMethod:method args:args]) {
            <span class="hljs-keyword">return</span> methodCallback(method, args);  <span class="hljs-comment">// åŒæ­¥æ‰§è¡Œ</span>
        } <span class="hljs-keyword">else</span> {
            [<span class="hljs-keyword">self</span>.uiScheduler addTaskToMainQueueWithTask:^{  <span class="hljs-comment">// å¼‚æ­¥æ‰¹é‡</span>
                methodCallback(method, args);
            }];
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>;
}
</code></pre>
<p>å“ªäº›æ–¹æ³•æ˜¯åŒæ­¥çš„ï¼Ÿ</p>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-comment">// iOS ç«¯çš„åˆ¤æ–­é€»è¾‘</span>
- (<span class="hljs-type">BOOL</span>)p_shouldSyncCallWithWithMethod:(KuiklyRenderNativeMethod)method args:(<span class="hljs-built_in">NSArray</span> *)args {
    <span class="hljs-keyword">return</span> method == KuiklyRenderNativeMethodCalculateRenderViewSize ||  <span class="hljs-comment">// è®¡ç®— View å°ºå¯¸</span>
           method == KuiklyRenderNativeMethodCreateShadow ||             <span class="hljs-comment">// åˆ›å»º Shadow</span>
           method == KuiklyRenderNativeMethodRemoveShadow ||             <span class="hljs-comment">// ç§»é™¤ Shadow</span>
           method == KuiklyRenderNativeMethodSetShadowForView ||         <span class="hljs-comment">// è®¾ç½® Shadow</span>
           method == KuiklyRenderNativeMethodSetShadowProp ||            <span class="hljs-comment">// Shadow å±æ€§</span>
           method == KuiklyRenderNativeMethodSetTimeout ||               <span class="hljs-comment">// å®šæ—¶å™¨</span>
           method == KuiklyRenderNativeMethodCallShadowMethod ||         <span class="hljs-comment">// Shadow æ–¹æ³•</span>
           method == KuiklyRenderNativeMethodSyncFlushUI ||              <span class="hljs-comment">// åŒæ­¥åˆ·æ–°</span>
           <span class="hljs-comment">// ...</span>
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆè¦åŒºåˆ†åŒæ­¥å’Œå¼‚æ­¥ï¼Ÿ</strong> å› ä¸ºæœ‰äº›æ“ä½œï¼ŒKotlin ä¾§å¿…é¡»<strong>ç«‹å³</strong>æ‹¿åˆ°ç»“æœæ‰èƒ½ç»§ç»­ã€‚æ¯”å¦‚ï¼š</p>
<ul>
<li><strong><code>CALCULATE_RENDER_VIEW_SIZE</code></strong>ï¼šè®¡ç®— Text çš„å®é™…å°ºå¯¸ã€‚Kotlin çš„ Flexbox å¸ƒå±€å¼•æ“éœ€è¦çŸ¥é“ä¸€æ®µæ–‡æœ¬åœ¨ç»™å®šå®½åº¦ä¸‹ä¼šå å¤šé«˜ï¼Œè¿™ä¸ªå€¼å¿…é¡»åŒæ­¥è¿”å›ï¼Œå¸ƒå±€è®¡ç®—æ‰èƒ½ç»§ç»­</li>
<li><strong><code>CREATE_SHADOW</code></strong>ï¼šåˆ›å»º Shadow èŠ‚ç‚¹ï¼ˆå¦‚æ–‡æœ¬çš„é˜´å½±è®¡ç®—ï¼‰éœ€è¦ Native ç«¯ç«‹å³è¿”å›</li>
</ul>
<p>è€Œåƒ <code>CREATE_RENDER_VIEW</code>ã€<code>SET_VIEW_PROP</code>ã€<code>SET_RENDER_VIEW_FRAME</code> è¿™äº›çº¯ UI æ“ä½œï¼ŒKotlin ä¸éœ€è¦è¿”å›å€¼ï¼Œå¯ä»¥æ”’èµ·æ¥æ‰¹é‡æ‰§è¡Œã€‚</p>
<h3 data-id="heading-17">6.2 NativeBridge çš„ expect/actual æœºåˆ¶</h3>
<p><code>BridgeManager</code> é€šè¿‡ <code>NativeBridge</code> ä¸ Native é€šä¿¡ã€‚è¿™é‡Œç”¨åˆ°äº† Kotlin Multiplatform çš„æ ¸å¿ƒæœºåˆ¶â€”â€”<code>expect/actual</code>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// commonMainï¼ˆå…¬å…±å±‚ï¼‰â€”â€”åªå£°æ˜æ¥å£ï¼Œä¸æä¾›å®ç°</span>
<span class="hljs-keyword">expect</span> <span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NativeBridge</span>() {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">toNative</span><span class="hljs-params">(methodId: <span class="hljs-type">Int</span>, arg0: <span class="hljs-type">Any</span>?, arg1: <span class="hljs-type">Any</span>?, ...)</span></span>: Any?
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span></span>
}
</code></pre>
<p><code>expect</code> å…³é”®å­—çš„å«ä¹‰æ˜¯ï¼š"æˆ‘å£°æ˜äº†è¿™ä¸ªä¸œè¥¿å­˜åœ¨ï¼Œä½†å…·ä½“å®ç°ç”±å„å¹³å°æä¾›ã€‚"</p>
<p>Android å®ç°ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// androidMain</span>
<span class="hljs-keyword">actual</span> <span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NativeBridge</span> <span class="hljs-title">actual</span> <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">var</span> delegate: NativeBridgeDelegate? = <span class="hljs-literal">null</span>
    
    <span class="hljs-keyword">actual</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">toNative</span><span class="hljs-params">(methodId: <span class="hljs-type">Int</span>, ...)</span></span>: Any? {
        <span class="hljs-keyword">return</span> delegate?.callNative(methodId, ...)  <span class="hljs-comment">// è°ƒç”¨ Java/Kotlin å±‚çš„å›è°ƒ</span>
    }
}
</code></pre>
<p>iOS å®ç°ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// appleMain</span>
<span class="hljs-keyword">actual</span> <span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NativeBridge</span> <span class="hljs-title">actual</span> <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">var</span> iosNativeBridgeDelegate: IOSNativeBridgeDelegate? = <span class="hljs-literal">null</span>
    
    <span class="hljs-keyword">actual</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">toNative</span><span class="hljs-params">(methodId: <span class="hljs-type">Int</span>, ...)</span></span>: Any? {
        <span class="hljs-keyword">return</span> iosNativeBridgeDelegate?.callNative(methodId, ...)  <span class="hljs-comment">// è°ƒç”¨ ObjC å±‚çš„å›è°ƒ</span>
    }
}
</code></pre>
<p>è¿™æ ·ï¼Œå…¬å…±å±‚çš„ <code>BridgeManager</code> è°ƒç”¨ <code>nativeBridge.toNative()</code> æ—¶ï¼Œ<strong>ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ ¹æ®ç›®æ ‡å¹³å°é€‰æ‹©æ­£ç¡®çš„å®ç°</strong>ã€‚è¿™å°±æ˜¯ Kotlin Multiplatform çš„"åŒä¸€ä»½ä»£ç ï¼Œå¤šå¹³å°è¿è¡Œ"çš„åŸºç¡€æœºåˆ¶ã€‚</p>
<hr/>
<h2 data-id="heading-18">7. ç¬¬å››é˜¶æ®µï¼šUISchedulerâ€”â€”æ‰¹é‡ä¸Šå±çš„è‰ºæœ¯</h2>
<p>UIScheduler æ˜¯ Kuikly å¤šçº¿ç¨‹æ¨¡å‹ä¸­<strong>æ€§èƒ½ä¼˜åŒ–</strong>çš„æ ¸å¿ƒã€‚å®ƒçš„è®¾è®¡æ€æƒ³æ˜¯ï¼š</p>
<blockquote>
<p><strong>ä¸è¦æ¥ä¸€æ¡ UI æŒ‡ä»¤å°±åˆ‡ä¸€æ¬¡çº¿ç¨‹ï¼Œè€Œæ˜¯æ”’ä¸€æ‰¹æŒ‡ä»¤ï¼Œä¸€æ¬¡æ€§åˆ‡åˆ°ä¸»çº¿ç¨‹å…¨éƒ¨æ‰§è¡Œå®Œã€‚</strong></p>
</blockquote>
<h3 data-id="heading-19">7.1 Android ç«¯å®ç°</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// KuiklyRenderCoreUIScheduler.kt</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">KuiklyRenderCoreUIScheduler</span>(...) : IKuiklyRenderCoreScheduler {
    
    <span class="hljs-comment">// Context çº¿ç¨‹ä¸Šæš‚å­˜çš„ä»»åŠ¡åˆ—è¡¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> mainThreadTasksOnContextQueue: MutableList&lt;KuiklyRenderCoreTaskExecutor&gt;? = <span class="hljs-literal">null</span>
    <span class="hljs-comment">// ä¸»çº¿ç¨‹ä¸Šå¾…æ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> mainThreadTasks = mutableListOf&lt;KuiklyRenderCoreTaskExecutor&gt;()
    
    <span class="hljs-comment">// åœ¨ Context çº¿ç¨‹è°ƒç”¨â€”â€”æ”¶é›†ä»»åŠ¡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">addTaskToMainQueue</span><span class="hljs-params">(task: <span class="hljs-type">KuiklyRenderCoreTaskExecutor</span>)</span></span> {
        assert(!isMainThread())  <span class="hljs-comment">// â† å¿…é¡»åœ¨ Context çº¿ç¨‹</span>
        <span class="hljs-keyword">val</span> tasks = mainThreadTasksOnContextQueue ?: mutableListOf&lt;KuiklyRenderCoreTaskExecutor&gt;().apply {
            mainThreadTasksOnContextQueue = <span class="hljs-keyword">this</span>
        }
        tasks.add(task)
        setNeedSyncMainQueueTasks()  <span class="hljs-comment">// â† æ ‡è®°"æœ‰ä»»åŠ¡éœ€è¦åŒæ­¥åˆ°ä¸»çº¿ç¨‹"</span>
    }
}
</code></pre>
<p><code>setNeedSyncMainQueueTasks</code> çš„å®ç°éå¸¸ç²¾å·§ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">setNeedSyncMainQueueTasks</span><span class="hljs-params">()</span></span> {
    assert(!isMainThread())
    <span class="hljs-keyword">if</span> (needSyncMainQueueTasksBlock != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span>  <span class="hljs-comment">// â† å·²ç»æ ‡è®°è¿‡äº†ï¼Œä¸é‡å¤æ ‡è®°ï¼è¿™å°±æ˜¯"æ‰¹é‡"çš„ç§˜è¯€</span>
    }
    
    <span class="hljs-comment">// åˆ›å»º"åŒæ­¥é—­åŒ…"â€”â€”åŒ…å«äº†æŠŠ Context çº¿ç¨‹ä»»åŠ¡æ¬åˆ°ä¸»çº¿ç¨‹çš„é€»è¾‘</span>
    needSyncMainQueueTasksBlock = { sync -&gt;
        <span class="hljs-keyword">val</span> performTasks = mainThreadTasksOnContextQueue
        mainThreadTasksOnContextQueue = <span class="hljs-literal">null</span>
        synchronized(<span class="hljs-keyword">this</span>) {
            mainThreadTasks.addAll(performTasks?.toList() ?: listOf())
        }
        performOnMainQueueWithTask(sync = sync) {
            <span class="hljs-comment">// åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œæ‰€æœ‰ä»»åŠ¡</span>
            <span class="hljs-keyword">var</span> tasks: List&lt;KuiklyRenderCoreTaskExecutor&gt;?
            synchronized(<span class="hljs-keyword">this</span>) {
                tasks = mainThreadTasks.toList()
                mainThreadTasks.clear()
            }
            runMainQueueTasks(tasks)
        }
    }
    
    <span class="hljs-comment">// â˜… å…³é”®ï¼šæŠŠ"æ‰§è¡ŒåŒæ­¥é—­åŒ…"è¿™ä»¶äº‹ï¼Œå† post åˆ° Context çº¿ç¨‹æ¶ˆæ¯é˜Ÿåˆ—çš„å°¾éƒ¨</span>
    KuiklyRenderCoreContextScheduler.scheduleTask {
        performSyncMainQueueTasksBlockIfNeed(<span class="hljs-literal">false</span>)
    }
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆè¦ post åˆ° Context çº¿ç¨‹é˜Ÿåˆ—å°¾éƒ¨ï¼Ÿ</strong> å› ä¸ºå½“å‰ Context çº¿ç¨‹æ­£åœ¨æ‰§è¡Œ Kotlin é€»è¾‘ï¼ˆæ¯”å¦‚ body æ–¹æ³•è¿˜æ²¡æ‰§è¡Œå®Œï¼‰ï¼Œä¼šä¸æ–­äº§ç”Ÿæ–°çš„ UI æŒ‡ä»¤ã€‚æŠŠ"åŒæ­¥åˆ°ä¸»çº¿ç¨‹"è¿™ä¸ªåŠ¨ä½œ post åˆ°é˜Ÿåˆ—å°¾éƒ¨ï¼Œå°±èƒ½ä¿è¯<strong>å½“å‰ä¸€è½®é€»è¾‘å…¨éƒ¨æ‰§è¡Œå®Œåï¼Œå†ä¸€æ¬¡æ€§æŠŠæ‰€æœ‰æŒ‡ä»¤æäº¤ç»™ä¸»çº¿ç¨‹</strong>ã€‚</p>
<p>è®©æˆ‘ä»¬ç”»å‡ºè¿™ä¸ªæ—¶åºï¼š</p>
<pre><code class="hljs language-css" lang="css">Context çº¿ç¨‹çš„æ¶ˆæ¯é˜Ÿåˆ—
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ <span class="hljs-selector-attr">[å½“å‰ä»»åŠ¡: æ‰§è¡Œ bodyã€å¸ƒå±€è®¡ç®—ã€äº§ç”Ÿ UI æŒ‡ä»¤]</span>      â”‚
â”‚ <span class="hljs-selector-attr">[æ’é˜Ÿ: performSyncMainQueueTasksBlockIfNeed]</span> â”‚  â† åœ¨å½“å‰ä»»åŠ¡ç»“æŸåæ‰§è¡Œ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å½“å‰ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œäº§ç”Ÿçš„ UI æŒ‡ä»¤è¢«æ”¶é›†åˆ° mainThreadTasksOnContextQueue
å½“å‰ä»»åŠ¡æ‰§è¡Œå®Œï¼Œè½®åˆ° performSync... â†’ æŠŠæ”¶é›†çš„æŒ‡ä»¤æ‰¹é‡ post åˆ°ä¸»çº¿ç¨‹
</code></pre>
<h3 data-id="heading-20">7.2 iOS ç«¯å®ç°</h3>
<p>iOS çš„é€»è¾‘å®Œå…¨ä¸€è‡´ï¼Œåªæ˜¯ç”¨ ObjC + GCD å®ç°ï¼š</p>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-comment">// KuiklyRenderUIScheduler.m</span>
- (<span class="hljs-type">void</span>)addTaskToMainQueueWithTask:(dispatch_block_t)taskBlock {
    KR_ASSERT_CONTEXT_HTREAD;  <span class="hljs-comment">// æ–­è¨€åœ¨ Context çº¿ç¨‹</span>
    [_mainThreadTasksOnContextQueue addObject:taskBlock];
    [<span class="hljs-keyword">self</span> p_setNeedSyncMainQuequeTasks];
}

- (<span class="hljs-type">void</span>)p_setNeedSyncMainQuequeTasks {
    <span class="hljs-keyword">if</span> (!_needSyncMainQueueTasksBlock) {
        KR_WEAK_SELF
        <span class="hljs-keyword">self</span>.needSyncMainQueueTasksBlock = ^{
            <span class="hljs-comment">// åŒæ­¥ UI ä»»åŠ¡å‰ï¼Œå…ˆé€šçŸ¥ Kotlin åš layoutIfNeed</span>
            [strongSelf p_dispatchWillPerformUITasksDelegator];
            <span class="hljs-built_in">NSArray</span> *tasks = weakSelf.mainThreadTasksOnContextQueue;
            weakSelf.mainThreadTasksOnContextQueue = <span class="hljs-literal">nil</span>;
            <span class="hljs-comment">// åŠ é”æ¬è¿ä»»åŠ¡</span>
            [weakSelf.threadLock threadSafeInBlock:^{
                [weakSelf.mainThreadTasks addObjectsFromArray:tasks];
            }];
            <span class="hljs-comment">// åˆ‡åˆ°ä¸»çº¿ç¨‹æ‰¹é‡æ‰§è¡Œ</span>
            [KuiklyRenderThreadManager performOnMainQueueWithTask:^{
                <span class="hljs-keyword">for</span> (dispatch_block_t task <span class="hljs-keyword">in</span> mainThreadTasks) {
                    task();
                }
            } sync:[<span class="hljs-built_in">NSThread</span> isMainThread]];
        };
        <span class="hljs-comment">// å†è°ƒåº¦ä¸€æ¬¡åˆ° Context çº¿ç¨‹å°¾éƒ¨</span>
        [KuiklyRenderThreadManager performOnContextQueueWithBlock:^{
            [weakSelf performSyncMainQueueTasksBlockIfNeed];
        }];
    }
}
</code></pre>
<h3 data-id="heading-21">7.3 ä¸€ä¸ªå®¹æ˜“è¢«å¿½ç•¥çš„ç»†èŠ‚ï¼šlayoutIfNeed çš„æ—¶æœº</h3>
<p>æ³¨æ„ iOS ç«¯æœ‰ä¸€è¡Œ <code>[strongSelf p_dispatchWillPerformUITasksDelegator]</code>ï¼ŒAndroid ç«¯å¯¹åº”çš„æ˜¯ UIScheduler æ„é€ æ—¶ä¼ å…¥çš„é—­åŒ…ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// KuiklyRenderCore.kt</span>
uiScheduler = KuiklyRenderCoreUIScheduler {
    <span class="hljs-comment">// åŒæ­¥ä¸»çº¿ç¨‹ä»»åŠ¡å‰ï¼Œå‘Šè¯‰ Kotlin ä¾§å» layoutIfNeed</span>
    contextHandler?.call(KuiklyRenderContextMethodLayoutView, listOf(instanceId))
}
</code></pre>
<p>è¿™ä¸ªå›è°ƒåœ¨"æŠŠ UI æŒ‡ä»¤æäº¤ç»™ä¸»çº¿ç¨‹ä¹‹å‰"è¢«è°ƒç”¨ï¼Œå®ƒçš„ä½œç”¨æ˜¯ç¡®ä¿ <strong>Kotlin ä¾§å·²ç»å®Œæˆå¸ƒå±€è®¡ç®—</strong>ï¼Œæ‰€æœ‰ View çš„ Frame éƒ½å·²ç»ç¡®å®šã€‚å¦åˆ™å¯èƒ½å‡ºç°"View å·²ç»åˆ›å»ºäº†ï¼Œä½†è¿˜ä¸çŸ¥é“æ”¾åœ¨å“ªé‡Œ"çš„æƒ…å†µã€‚</p>
<hr/>
<h2 data-id="heading-22">8. ç¬¬äº”é˜¶æ®µï¼šé¦–å±å®Œæˆä¸åç»­äº‹ä»¶é—­ç¯</h2>
<h3 data-id="heading-23">8.1 é¦–å±æ¸²æŸ“å®Œæˆ</h3>
<p>UIScheduler åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œå®Œç¬¬ä¸€æ‰¹ UI æŒ‡ä»¤åï¼Œä¼šæ ‡è®° <code>viewDidLoad = true</code>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// KuiklyRenderCoreUIScheduler.kt</span>
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">runMainQueueTasks</span><span class="hljs-params">(tasks: <span class="hljs-type">List</span>&lt;<span class="hljs-type">KuiklyRenderCoreTaskExecutor</span>&gt;?)</span></span> {
    assert(isMainThread())
    <span class="hljs-keyword">val</span> uiTasks = tasks ?: <span class="hljs-keyword">return</span>
    isPerformingMainQueueTask = <span class="hljs-literal">true</span>
    <span class="hljs-keyword">for</span> (task <span class="hljs-keyword">in</span> uiTasks) {
        task.execute()
    }
    isPerformingMainQueueTask = <span class="hljs-literal">false</span>
    
    <span class="hljs-keyword">if</span> (!viewDidLoad) {
        viewDidLoad = <span class="hljs-literal">true</span>           <span class="hljs-comment">// â† é¦–å±æ ‡è®°</span>
        performViewDidLoadTasksIfNeed()  <span class="hljs-comment">// â† æ‰§è¡Œç­‰å¾…é¦–å±å®Œæˆçš„ä»»åŠ¡</span>
    }
}
</code></pre>
<p>ç„¶å Native ç«¯ä¼šé€šè¿‡ <code>sendEvent</code> é€šçŸ¥ Kotlin ä¾§"é¦–å±å®Œæˆäº†"ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">sendEvent</span>("pageFirstFramePaint") â†’ Context çº¿ç¨‹ â†’ Pager<span class="hljs-selector-class">.onReceivePagerEvent</span>()
</code></pre>
<h3 data-id="heading-24">8.2 åç»­äº‹ä»¶â€”â€”ä»ä¸»çº¿ç¨‹å›åˆ° Context çº¿ç¨‹</h3>
<p>ç”¨æˆ·çš„è§¦æ‘¸ã€æ»‘åŠ¨ç­‰äº‹ä»¶å‘ç”Ÿåœ¨ä¸»çº¿ç¨‹ï¼Œéœ€è¦é€šçŸ¥åˆ° Context çº¿ç¨‹çš„ Kotlin é€»è¾‘ã€‚ä»¥ <code>sendEvent</code> ä¸ºä¾‹ï¼š</p>
<p>Android ç«¯ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// KuiklyRenderCore.kt</span>
<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">sendEvent</span><span class="hljs-params">(event: <span class="hljs-type">String</span>, <span class="hljs-keyword">data</span>: <span class="hljs-type">Map</span>&lt;<span class="hljs-type">String</span>, Any&gt;, shouldSync: <span class="hljs-type">Boolean</span>)</span></span> {
    performOnContextQueue(sync = shouldSync) {  <span class="hljs-comment">// â† åˆ‡åˆ° Context çº¿ç¨‹</span>
        contextHandler?.call(KuiklyRenderContextMethodUpdateInstance,
            listOf(instanceId, event, <span class="hljs-keyword">data</span>))
    }
}
</code></pre>
<p>iOS ç«¯ï¼š</p>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-comment">// KuiklyRenderCore.m</span>
- (<span class="hljs-type">void</span>)sendWithEvent:(<span class="hljs-built_in">NSString</span> *)event data:(<span class="hljs-built_in">NSDictionary</span> *)data {
    [KuiklyRenderThreadManager performOnContextQueueWithBlock:^{
        [<span class="hljs-keyword">self</span>.contextHandler callWithMethod:KuiklyRenderContextMethodUpdateInstance
                                      args:@[<span class="hljs-keyword">self</span>.instanceId, event, data]];
    } sync:![<span class="hljs-built_in">NSThread</span> isMainThread]];  <span class="hljs-comment">// â† éä¸»çº¿ç¨‹æ—¶åŒæ­¥è°ƒç”¨</span>
}
</code></pre>
<p>æ³¨æ„ iOS ç«¯çš„ <code>sync:![NSThread isMainThread]</code>ï¼šå¦‚æœå½“å‰å·²ç»åœ¨ Context çº¿ç¨‹ä¸Šï¼ˆéä¸»çº¿ç¨‹ï¼‰ï¼Œå°±ç”¨ <code>dispatch_sync</code> ç›´æ¥åŒæ­¥æ‰§è¡Œï¼›å¦‚æœåœ¨ä¸»çº¿ç¨‹ä¸Šï¼Œå°±ç”¨ <code>dispatch_async</code> å¼‚æ­¥æŠ•é€’ï¼ˆé¿å…ä¸»çº¿ç¨‹é˜»å¡ç­‰å¾… Context çº¿ç¨‹ï¼‰ã€‚</p>
<p>è¿™æ ·å°±å½¢æˆäº†å®Œæ•´çš„äº‹ä»¶å¾ªç¯ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">ç”¨æˆ·æ“ä½œ(ä¸»çº¿ç¨‹) â†’ sendEvent â†’ Context çº¿ç¨‹(Kotlin å¤„ç†é€»è¾‘)
                                    â†“
                              äº§ç”Ÿæ–°çš„ UI æŒ‡ä»¤
                                    â†“
                              UIScheduler æ‰¹é‡
                                    â†“
                              ä¸»çº¿ç¨‹æ‰§è¡Œ(UI æ›´æ–°)
</code></pre>
<hr/>
<h2 data-id="heading-25">9. iOS ç«¯ vs Android ç«¯çš„çº¿ç¨‹å®ç°å¯¹æ¯”</h2>























































<table><thead><tr><th>ç»´åº¦</th><th>Android</th><th>iOS</th></tr></thead><tbody><tr><td><strong>Context çº¿ç¨‹</strong></td><td><code>HandlerThread</code>ï¼ˆåŸºäº Java çš„ Looper/Handler æœºåˆ¶ï¼‰</td><td>GCD <code>dispatch_queue_create</code>ï¼ˆä¸²è¡Œé˜Ÿåˆ—ï¼‰</td></tr><tr><td><strong>çº¿ç¨‹ä¼˜å…ˆçº§</strong></td><td><code>Process.THREAD_PRIORITY_FOREGROUND</code></td><td><code>QOS_CLASS_USER_INTERACTIVE</code></td></tr><tr><td><strong>åˆ¤æ–­æ˜¯å¦åœ¨ Context çº¿ç¨‹</strong></td><td><code>ThreadLocal&lt;Boolean&gt;</code>ï¼ˆ<code>NativeBridge.isContextThread</code>ï¼‰</td><td><code>dispatch_get_specific</code>ï¼ˆqueue-specific dataï¼‰</td></tr><tr><td><strong>åˆ‡åˆ° Context çº¿ç¨‹</strong></td><td><code>handler.post { task }</code></td><td><code>dispatch_async(contextQueue, task)</code></td></tr><tr><td><strong>åˆ‡åˆ°ä¸»çº¿ç¨‹</strong></td><td><code>Handler(Looper.getMainLooper()).post { task }</code></td><td><code>dispatch_async(dispatch_get_main_queue(), task)</code></td></tr><tr><td><strong>UIScheduler</strong></td><td>åŸºäº <code>MutableList</code> + <code>synchronized</code> é”</td><td>åŸºäº <code>NSMutableArray</code> + <code>KuiklyRenderThreadLock</code></td></tr><tr><td><strong>çº¿ç¨‹é—´åŒæ­¥è°ƒç”¨</strong></td><td><code>ConditionVariable</code>ï¼ˆ<code>BlockingRunnable</code>ï¼‰</td><td><code>dispatch_sync</code></td></tr><tr><td><strong>Kotlinâ†’Native æ¡¥æ¥</strong></td><td>åå°„åŠ è½½ <code>KuiklyCoreEntry</code> ç±»ï¼ˆJVMï¼‰</td><td>ObjC åå°„åŠ è½½ Kotlin/Native Framework</td></tr><tr><td><strong>Nativeâ†’Kotlin è°ƒç”¨</strong></td><td><code>IKuiklyCoreEntry.callKotlinMethod()</code></td><td><code>[contextHandler callWithMethod:args:]</code></td></tr></tbody></table>
<p>è™½ç„¶å®ç°æ–¹å¼ä¸åŒï¼Œä½†<strong>æ¶æ„å®Œå…¨ä¸€è‡´</strong>ï¼šå•ä¸€ Context çº¿ç¨‹ + UIScheduler æ‰¹é‡æäº¤ + ä¸»çº¿ç¨‹æ‰§è¡Œã€‚</p>
<h3 data-id="heading-26">9.1 iOS ç‰¹æœ‰çš„ C æ¡¥æ¥</h3>
<p>iOS ç«¯è¿˜é¢å¤–æä¾›äº†ä¸€ç»„ C å‡½æ•°ï¼Œä¾› Kotlin/Native ç¼–è¯‘å‡ºçš„ä»£ç è°ƒç”¨ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// KuiklyRenderThreadBridge.m</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">com_tencent_kuikly_ScheduleContextTask</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* pagerId, 
                                             <span class="hljs-type">void</span> (*onSchedule)(<span class="hljs-type">const</span> <span class="hljs-type">char</span>*))</span> {
    NSString *pId = [NSString stringWithUTF8String:pagerId];
    [KuiklyRenderThreadManager performOnContextQueueWithBlock:^{
        onSchedule([pId UTF8String]);
    } sync:NO];
}

<span class="hljs-type">bool</span> <span class="hljs-title function_">com_tencent_kuikly_IsCurrentOnContextThread</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* pagerId)</span> {
    <span class="hljs-keyword">return</span> [KuiklyRenderThreadManager isContextQueue];
}
</code></pre>
<p>ä¸ºä»€ä¹ˆéœ€è¦ C å‡½æ•°ï¼Ÿå› ä¸º Kotlin/Native ç¼–è¯‘ä¸º iOS çš„ Framework æ—¶ï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨ ObjC çš„ç±»æ–¹æ³•ï¼ˆé™¤éé€šè¿‡ cinteropï¼‰ï¼Œä½†å¯ä»¥è°ƒç”¨ C å‡½æ•°ã€‚è¿™äº› C å‡½æ•°å……å½“äº†"æ¡¥æ¢"è§’è‰²ã€‚</p>
<hr/>
<h2 data-id="heading-27">10. ä»å…¶ä»–çº¿ç¨‹å›åˆ° Kuikly çº¿ç¨‹</h2>
<p>å½“ä½ åœ¨ Kotlin ä¸­ä½¿ç”¨äº†å¤šçº¿ç¨‹ï¼ˆæ¯”å¦‚ KMP çš„ expect/actual æœºåˆ¶ã€æˆ–è€… kotlinx åç¨‹åˆ‡æ¢åˆ° IO çº¿ç¨‹ï¼‰ï¼Œå®Œæˆå¼‚æ­¥æ“ä½œåéœ€è¦å›åˆ° Kuikly çº¿ç¨‹æ›´æ–° UIã€‚Kuikly æä¾›äº† <code>KuiklyContextScheduler</code> æ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p>
<h3 data-id="heading-28">10.1 å…¬å…±å±‚ API</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// KuiklyContextScheduler.kt (commonMain)</span>
<span class="hljs-keyword">internal</span> <span class="hljs-keyword">object</span> KuiklyContextScheduler : SynchronizedObject() {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">runOnKuiklyThread</span><span class="hljs-params">(pagerId: <span class="hljs-type">String</span>, block: (<span class="hljs-type">cancel</span>: <span class="hljs-type">Boolean</span>) -&gt; <span class="hljs-type">Unit</span>)</span></span> {
        <span class="hljs-comment">// å¦‚æœå·²ç»åœ¨ Kuikly çº¿ç¨‹ä¸Šï¼Œç›´æ¥æ‰§è¡Œ</span>
        <span class="hljs-keyword">if</span> (platformIsOnKuiklyThread(pagerId)) {
            block(<span class="hljs-literal">false</span>)
            <span class="hljs-keyword">return</span>
        }
        <span class="hljs-comment">// å¦åˆ™ï¼Œè°ƒåº¦åˆ° Kuikly çº¿ç¨‹</span>
        addTask(pagerId, block)
        platformScheduleOnKuiklyThread(pagerId)
    }
}
</code></pre>
<p>æ³¨æ„ <code>block: (cancel: Boolean) -&gt; Unit</code> çš„è®¾è®¡â€”â€”å‚æ•° <code>cancel</code> å‘Šè¯‰ä½ é¡µé¢æ˜¯å¦å·²ç»é”€æ¯ã€‚å¦‚æœé¡µé¢å·²ç»é”€æ¯ï¼ˆ<code>BridgeManager.containNativeBridge(pagerId)</code> è¿”å› falseï¼‰ï¼Œ<code>cancel</code> ä¸º trueï¼Œä½ åº”è¯¥æ”¾å¼ƒæ“ä½œã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„<strong>å®‰å…¨æœºåˆ¶</strong>ã€‚</p>
<h3 data-id="heading-29">10.2 Android å®ç°</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// KuiklyContextScheduler.android.kt</span>
<span class="hljs-keyword">internal</span> <span class="hljs-keyword">actual</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">platformIsOnKuiklyThread</span><span class="hljs-params">(pagerId: <span class="hljs-type">String</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {
    <span class="hljs-keyword">return</span> NativeBridge.isContextThread  <span class="hljs-comment">// â† è¯» ThreadLocal</span>
}

<span class="hljs-keyword">internal</span> <span class="hljs-keyword">actual</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">platformScheduleOnKuiklyThread</span><span class="hljs-params">(pagerId: <span class="hljs-type">String</span>)</span></span> {
    KuiklyRenderCoreContextScheduler.scheduleTask {
        KuiklyContextScheduler.runTask(pagerId)  <span class="hljs-comment">// â† post åˆ° Context çº¿ç¨‹</span>
    }
}
</code></pre>
<h3 data-id="heading-30">10.3 iOS å®ç°</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// KuiklyContextScheduler.ios.kt</span>
<span class="hljs-keyword">internal</span> <span class="hljs-keyword">actual</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">platformIsOnKuiklyThread</span><span class="hljs-params">(pagerId: <span class="hljs-type">String</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {
    <span class="hljs-keyword">return</span> com_tencent_kuikly_IsCurrentOnContextThread(pagerId)  <span class="hljs-comment">// â† è°ƒç”¨ C å‡½æ•°</span>
}

<span class="hljs-keyword">internal</span> <span class="hljs-keyword">actual</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">platformScheduleOnKuiklyThread</span><span class="hljs-params">(pagerId: <span class="hljs-type">String</span>)</span></span> {
    com_tencent_kuikly_ScheduleContextTask(pagerId, staticCFunction { pIdPtr -&gt;
        <span class="hljs-comment">// è¿™ä¸ª staticCFunction æ˜¯ Kotlin/Native æä¾›çš„æœºåˆ¶</span>
        <span class="hljs-comment">// å®ƒå°† Kotlin å‡½æ•°è½¬ä¸º C å‡½æ•°æŒ‡é’ˆï¼Œä»¥ä¾¿ ObjC/C ä»£ç å›è°ƒ</span>
        <span class="hljs-keyword">val</span> pId = pIdPtr!!.toKString()
        KuiklyContextScheduler.runTask(pId)
    })
}
</code></pre>
<h3 data-id="heading-31">10.4 ä½¿ç”¨ Dispatchers.Kuikly</h3>
<p>å¦‚æœä½ ä½¿ç”¨ kotlinx åç¨‹ï¼Œå¯ä»¥é€šè¿‡è‡ªå®šä¹‰ Dispatcher åˆ‡å› Kuikly çº¿ç¨‹ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">created</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">super</span>.created()
    <span class="hljs-keyword">val</span> ctx = <span class="hljs-keyword">this</span>
    <span class="hljs-comment">// åœ¨ Kuikly çº¿ç¨‹å¯åŠ¨åç¨‹</span>
    GlobalScope.launch(Dispatchers.Kuikly[ctx]) {
        <span class="hljs-comment">// åˆ‡åˆ° IO çº¿ç¨‹åšè€—æ—¶æ“ä½œ</span>
        <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span> = withContext(Dispatchers.IO) {
            fetchDataFromNetwork()
        }
        <span class="hljs-comment">// è‡ªåŠ¨å›åˆ° Kuikly çº¿ç¨‹ï¼Œå®‰å…¨æ›´æ–° UI</span>
        ctx.dataObservable = <span class="hljs-keyword">data</span>
    }
}
</code></pre>
<p><code>Dispatchers.Kuikly[ctx]</code> çš„å®ç°åŸç†å°±æ˜¯æŠŠåç¨‹çš„æ¢å¤æ“ä½œè°ƒåº¦åˆ° <code>KuiklyContextScheduler.runOnKuiklyThread()</code> ä¸Šã€‚</p>
<hr/>
<h2 data-id="heading-32">11. çº¿ç¨‹å®‰å…¨éªŒè¯æœºåˆ¶</h2>
<p>Kuikly æä¾›äº†å¼€å‘é˜¶æ®µçš„çº¿ç¨‹å®‰å…¨éªŒè¯ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Pager.kt</span>
<span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
    <span class="hljs-keyword">var</span> VERIFY_THREAD
        <span class="hljs-keyword">get</span>() = com.tencent.kuikly.core.utils.VERIFY_THREAD
        <span class="hljs-keyword">set</span>(value) { com.tencent.kuikly.core.utils.VERIFY_THREAD = value }
    
    <span class="hljs-keyword">var</span> VERIFY_REACTIVE_OBSERVER
        <span class="hljs-keyword">get</span>() = com.tencent.kuikly.core.utils.VERIFY_REACTIVE_OBSERVER
        <span class="hljs-keyword">set</span>(value) { com.tencent.kuikly.core.utils.VERIFY_REACTIVE_OBSERVER = value }
}
</code></pre>
<p>å¼€å¯æ–¹å¼ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Page(<span class="hljs-string">"DebugPage"</span>)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DebugPage</span> : <span class="hljs-type">BasePager</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">willInit</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.willInit()
        Pager.VERIFY_THREAD = <span class="hljs-literal">true</span>             <span class="hljs-comment">// å¼€å¯çº¿ç¨‹æ ¡éªŒ</span>
        Pager.VERIFY_REACTIVE_OBSERVER = <span class="hljs-literal">true</span>   <span class="hljs-comment">// å¼€å¯å“åº”å¼è§‚å¯Ÿè€…æ ¡éªŒ</span>
        
        Pager.verifyFailed { exception -&gt;
            <span class="hljs-comment">// è‡ªå®šä¹‰éªŒè¯å¤±è´¥çš„å¤„ç†</span>
            println(<span class="hljs-string">"çº¿ç¨‹å®‰å…¨éªŒè¯å¤±è´¥: <span class="hljs-subst">${exception.message}</span>"</span>)
            <span class="hljs-keyword">throw</span> exception  <span class="hljs-comment">// å¼€å‘é˜¶æ®µç›´æ¥å´©æºƒï¼Œæ–¹ä¾¿å®šä½</span>
        }
    }
}
</code></pre>
<p>å½“ <code>VERIFY_THREAD = true</code> æ—¶ï¼Œå¦‚æœä½ åœ¨é Context çº¿ç¨‹è®¿é—®äº† <code>observable</code> å±æ€§æˆ–è°ƒç”¨äº† UI ç›¸å…³ APIï¼Œæ¡†æ¶ä¼šç«‹å³æŠ›å‡ºå¼‚å¸¸ã€‚<strong>å¼ºçƒˆå»ºè®®åœ¨å¼€å‘é˜¶æ®µå¼€å¯è¿™ä¸¤ä¸ªé€‰é¡¹ã€‚</strong></p>
<hr/>
<h2 data-id="heading-33">12. ä¸‰ç§å¼‚æ­¥ç¼–ç¨‹æ–¹å¼çš„é€‰æ‹©</h2>
<p>ç†è§£äº†å¤šçº¿ç¨‹æ¨¡å‹åï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ Kuikly æä¾›çš„ä¸‰ç§å¼‚æ­¥ç¼–ç¨‹æ–¹æ¡ˆä»¥åŠå®ƒä»¬çš„é€‚ç”¨åœºæ™¯ï¼š</p>
<h3 data-id="heading-34">æ–¹å¼ä¸€ï¼šModule æœºåˆ¶ + Kuikly å†…å»ºåç¨‹</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">created</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">super</span>.created()
    <span class="hljs-keyword">val</span> ctx = <span class="hljs-keyword">this</span>
    lifecycleScope.launch {
        <span class="hljs-keyword">val</span> type = fetchLocal()       <span class="hljs-comment">// æŒ‚èµ·å‡½æ•°ï¼ˆåº•å±‚é€šè¿‡ Module è°ƒ Nativeï¼‰</span>
        <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span> = fetchRemote(type)  <span class="hljs-comment">// æŒ‚èµ·å‡½æ•°</span>
        ctx.dataObservable = <span class="hljs-keyword">data</span>     <span class="hljs-comment">// å®‰å…¨æ›´æ–° UI</span>
    }
}
</code></pre>
<ul>
<li><strong>çº¿ç¨‹æ¨¡å‹</strong>ï¼šå§‹ç»ˆåœ¨ Kuikly çº¿ç¨‹ã€‚å¼‚æ­¥æ“ä½œé€šè¿‡ Module ä¸‹æ²‰åˆ° Native å±‚æ‰§è¡Œï¼ˆNative å¯ä»¥è‡ªç”±ä½¿ç”¨å¤šçº¿ç¨‹ï¼‰ï¼Œç»“æœé€šè¿‡å›è°ƒè¿”å›åˆ° Kuikly çº¿ç¨‹</li>
<li><strong>ä¼˜åŠ¿</strong>ï¼šæ— çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œæ”¯æŒåŠ¨æ€åŒ–ï¼Œæ— é¢å¤–ä¾èµ–</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¤§å¤šæ•°ä¸šåŠ¡éœ€æ±‚ï¼ˆç½‘ç»œè¯·æ±‚ã€æœ¬åœ°å­˜å‚¨ã€ç³»ç»Ÿ API è°ƒç”¨ï¼‰</li>
</ul>
<h3 data-id="heading-35">æ–¹å¼äºŒï¼šKMP å¤šçº¿ç¨‹ + kuiklyx å›è°ƒ</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">created</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">super</span>.created()
    <span class="hljs-keyword">val</span> ctx = <span class="hljs-keyword">this</span>
    asyncKmpFetchData { <span class="hljs-keyword">data</span> -&gt;
        KuiklyContextScheduler.runOnKuiklyThread(ctx.pagerId) { cancel -&gt;
            <span class="hljs-keyword">if</span> (cancel) <span class="hljs-keyword">return</span><span class="hljs-symbol">@runOnKuiklyThread</span>
            ctx.dataObservable = <span class="hljs-keyword">data</span>  <span class="hljs-comment">// å›åˆ° Kuikly çº¿ç¨‹æ›´æ–° UI</span>
        }
    }
}
</code></pre>
<ul>
<li><strong>çº¿ç¨‹æ¨¡å‹</strong>ï¼šKMP ä»£ç å¯ä»¥åœ¨ä»»æ„çº¿ç¨‹æ‰§è¡Œï¼Œå®Œæˆåæ˜¾å¼åˆ‡å› Kuikly çº¿ç¨‹</li>
<li><strong>ä¼˜åŠ¿</strong>ï¼šæ— é€šä¿¡å¼€é”€ï¼ˆç›´æ¥è·¨å¹³å°è°ƒç”¨ï¼Œä¸ç»è¿‡ Bridgeï¼‰</li>
<li><strong>åŠ£åŠ¿</strong>ï¼šä¸æ”¯æŒåŠ¨æ€åŒ–ï¼Œéœ€è¦æ‰‹åŠ¨ç®¡ç†çº¿ç¨‹åˆ‡æ¢</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¯¹æ€§èƒ½è¦æ±‚æé«˜ã€ä¸éœ€è¦åŠ¨æ€åŒ–çš„åœºæ™¯</li>
</ul>
<h3 data-id="heading-36">æ–¹å¼ä¸‰ï¼škotlinx åç¨‹ + Dispatchers.Kuikly</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">created</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">super</span>.created()
    <span class="hljs-keyword">val</span> ctx = <span class="hljs-keyword">this</span>
    GlobalScope.launch(Dispatchers.Kuikly[ctx]) {
        <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span> = withContext(Dispatchers.IO) {
            kmpFetchData()  <span class="hljs-comment">// åœ¨ IO çº¿ç¨‹æ‰§è¡Œ</span>
        }
        <span class="hljs-comment">// è‡ªåŠ¨å›åˆ° Kuikly çº¿ç¨‹</span>
        ctx.dataObservable = <span class="hljs-keyword">data</span>
    }
}
</code></pre>
<ul>
<li><strong>çº¿ç¨‹æ¨¡å‹</strong>ï¼šåˆ©ç”¨ kotlinx åç¨‹çš„ Dispatcher æœºåˆ¶è‡ªç”±åˆ‡æ¢çº¿ç¨‹</li>
<li><strong>ä¼˜åŠ¿</strong>ï¼šä»£ç å¯è¯»æ€§æœ€å¥½ï¼Œä¸ Kotlin ç¤¾åŒºæ ‡å‡†å¯¹é½</li>
<li><strong>åŠ£åŠ¿</strong>ï¼šä¸æ”¯æŒåŠ¨æ€åŒ–ï¼Œéœ€è¦å¼•å…¥ kotlinx åç¨‹åº“ + kuiklyx åç¨‹åº“</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¤æ‚çš„å¼‚æ­¥é€»è¾‘ï¼Œéœ€è¦åç¨‹è¯­æ³•æå‡å¯è¯»æ€§</li>
</ul>
<h3 data-id="heading-37">é€‰æ‹©å†³ç­–æ ‘</h3>
<pre><code class="hljs language-markdown" lang="markdown">ä½ éœ€è¦åŠ¨æ€åŒ–å—ï¼Ÿ
â”œâ”€ æ˜¯ â†’ æ–¹å¼ä¸€ï¼ˆModule + Kuikly å†…å»ºåç¨‹ï¼‰
â””â”€ å¦ â†’ ä½ éœ€è¦å¤šçº¿ç¨‹æ‰§è¡Œè€—æ—¶ä»»åŠ¡å—ï¼Ÿ
<span class="hljs-code">         â”œâ”€ å¦ â†’ æ–¹å¼ä¸€
         â””â”€ æ˜¯ â†’ ä½ éœ€è¦åç¨‹è¯­æ³•å—ï¼Ÿ
                  â”œâ”€ å¦ â†’ æ–¹å¼äºŒï¼ˆKMP + kuiklyx å›è°ƒï¼‰
                  â””â”€ æ˜¯ â†’ æ–¹å¼ä¸‰ï¼ˆkotlinx + Dispatchers.Kuiklyï¼‰
</span></code></pre>
<hr/>
<h2 data-id="heading-38">13. æ€»ç»“ï¼šä¸€å¼ å›¾çœ‹æ¸…å…¨è²Œ</h2>
<pre><code class="hljs language-scss" lang="scss">                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚           ä¸»çº¿ç¨‹ (UI Thread)           â”‚
                          â”‚                                      â”‚
                          â”‚   KuiklyRenderView                   â”‚
                          â”‚     â”œâ”€ <span class="hljs-built_in">init</span>()  â”€â”€scheduleâ”€â”€â†’ â‘        â”‚
                          â”‚     â”‚                                â”‚
                          â”‚   UIScheduler â†â”€â”€â”€ æ‰¹é‡UIæŒ‡ä»¤ â†â”€ â‘£  â”‚
                          â”‚     â”œâ”€ <span class="hljs-built_in">createView</span>()                  â”‚
                          â”‚     â”œâ”€ <span class="hljs-built_in">setProp</span>()                     â”‚
                          â”‚     â”œâ”€ <span class="hljs-built_in">setFrame</span>()                    â”‚
                          â”‚     â””â”€ viewDidLoad â”€â”€sendEventâ”€â”€â†’ â‘¤ â”‚
                          â”‚                                      â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚ â‘ â‘¡â‘£â‘¤ çº¿ç¨‹é—´é€šä¿¡
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚       Context çº¿ç¨‹ (Kuikly Thread)     â”‚
                          â”‚                                      â”‚
                          â”‚ â‘¡ initContextHandler                 â”‚
                          â”‚     â”œâ”€ åŠ è½½ KuiklyCoreEntry           â”‚
                          â”‚     â”œâ”€ æ³¨å†Œ callNative å›è°ƒ           â”‚
                          â”‚     â””â”€ <span class="hljs-built_in">call</span>(CREATE_INSTANCE)         â”‚
                          â”‚                                      â”‚
                          â”‚ â‘¢ PagerManager<span class="hljs-selector-class">.createPager</span>()         â”‚
                          â”‚     â””â”€ pager<span class="hljs-selector-class">.onCreatePager</span>()         â”‚
                          â”‚         â”œâ”€ <span class="hljs-built_in">willInit</span>()                â”‚
                          â”‚         â”œâ”€ <span class="hljs-built_in">initModule</span>()              â”‚
                          â”‚         â”œâ”€ <span class="hljs-built_in">didInit</span>() â†’ <span class="hljs-selector-tag">body</span>()        â”‚
                          â”‚         â””â”€ <span class="hljs-built_in">createBody</span>()              â”‚
                          â”‚             â”œâ”€ <span class="hljs-built_in">createFlexNode</span>()      â”‚
                          â”‚             â”œâ”€ <span class="hljs-built_in">layoutIfNeed</span>()        â”‚
                          â”‚             â””â”€ callNative Ã—N â”€â”€â†’ â‘£  â”‚
                          â”‚                                      â”‚
                          â”‚ â‘¤ onReceivePagerEvent                â”‚
                          â”‚     ("pageFirstFramePaint")          â”‚
                          â”‚                                      â”‚
                          â”‚ â‘¥ åç»­ï¼šå“åº”å¼æ›´æ–°ã€äº‹ä»¶å¤„ç†ã€åç¨‹...    â”‚
                          â”‚     â””â”€ æ–°çš„ callNative â†’ UIScheduler â”‚
                          â”‚                                      â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

çº¿ç¨‹é—´é€šä¿¡æ–¹å¼ï¼š
  â‘  ä¸»çº¿ç¨‹ â†’ Context: handler.<span class="hljs-built_in">post</span>() / <span class="hljs-built_in">dispatch_async</span>(contextQueue)
  â‘£ Context â†’ ä¸»çº¿ç¨‹: UIScheduler æ‰¹é‡ â†’ uiHandler.<span class="hljs-built_in">post</span>() / <span class="hljs-built_in">dispatch_async</span>(mainQueue)
  â‘¤ ä¸»çº¿ç¨‹ â†’ Context: sendEvent â†’ performOnContextQueue
  
åŒæ­¥è°ƒç”¨ï¼ˆä¸ç» UISchedulerï¼ŒContext çº¿ç¨‹ç›´æ¥æ‰§è¡Œå¹¶è¿”å›ï¼‰ï¼š
  CalculateRenderViewSizeã€CreateShadowã€SetTimeout ç­‰
</code></pre>
<h3 data-id="heading-39">æ ¸å¿ƒè¦ç‚¹</h3>
<ol>
<li><strong>ä¸¤æ¡çº¿ç¨‹ï¼Œå„å¸å…¶èŒ</strong>ï¼šContext çº¿ç¨‹è´Ÿè´£å…¨éƒ¨ Kotlin é€»è¾‘ï¼Œä¸»çº¿ç¨‹è´Ÿè´£ Native View æ“ä½œ</li>
<li><strong>æ‰€æœ‰ Kuikly çš„ UI ç±»ï¼ˆViewã€Attrã€Eventã€Observableï¼‰åªèƒ½åœ¨ Context çº¿ç¨‹è®¿é—®</strong></li>
<li><strong>UIScheduler æ˜¯æ€§èƒ½å…³é”®</strong>ï¼šæ”¶é›† UI æŒ‡ä»¤ã€æ‰¹é‡æäº¤ã€å‡å°‘çº¿ç¨‹åˆ‡æ¢æ¬¡æ•°</li>
<li><strong>åŒæ­¥æ–¹æ³• vs å¼‚æ­¥æ–¹æ³•</strong>ï¼šéœ€è¦è¿”å›å€¼çš„ï¼ˆå¦‚è®¡ç®—å°ºå¯¸ï¼‰åŒæ­¥æ‰§è¡Œï¼Œçº¯ UI æ“ä½œå¼‚æ­¥æ‰¹é‡</li>
<li><strong>å›åˆ° Kuikly çº¿ç¨‹</strong>ï¼šä½¿ç”¨ <code>KuiklyContextScheduler.runOnKuiklyThread()</code> æˆ– <code>Dispatchers.Kuikly</code></li>
<li><strong>ä¸²è¡Œ = å®‰å…¨</strong>ï¼šContext çº¿ç¨‹æ˜¯ä¸²è¡Œçš„ï¼Œä¸å­˜åœ¨å¹¶å‘ç«äº‰ï¼Œä¸éœ€è¦åŠ é”</li>
</ol>
<p>ç†è§£äº†è¿™æ¡é“¾è·¯ï¼Œä½ å°±æŒæ¡äº† Kuikly æ¡†æ¶æœ€æ ¸å¿ƒçš„æ¶æ„è®¾è®¡ã€‚æ— è®ºæ˜¯æ’æŸ¥æ€§èƒ½é—®é¢˜ã€ç†è§£é¡µé¢åŠ è½½æ…¢çš„åŸå› ã€è¿˜æ˜¯æ­£ç¡®å¤„ç†å¼‚æ­¥é€»è¾‘ï¼Œéƒ½èƒ½åšåˆ°å¿ƒä¸­æœ‰æ•°ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SKAdNetwork 6.0 æ·±åº¦å®æˆ˜ï¼šå¤šçª—å£è½¬åŒ–å€¼ï¼ˆConversion Valueï¼‰å»ºæ¨¡ä¸æ•°æ®åˆ†å±‚æ¶æ„]]></title>    <link>https://juejin.cn/post/7603958579180470272</link>    <guid>https://juejin.cn/post/7603958579180470272</guid>    <pubDate>2026-02-09T04:00:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603958579180470272" data-draft-id="7603699739223932943" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SKAdNetwork 6.0 æ·±åº¦å®æˆ˜ï¼šå¤šçª—å£è½¬åŒ–å€¼ï¼ˆConversion Valueï¼‰å»ºæ¨¡ä¸æ•°æ®åˆ†å±‚æ¶æ„"/> <meta itemprop="keywords" content="iOS"/> <meta itemprop="datePublished" content="2026-02-09T04:00:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å±±æ°´åŸŸ"/> <meta itemprop="url" content="https://juejin.cn/user/2260251635887309"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SKAdNetwork 6.0 æ·±åº¦å®æˆ˜ï¼šå¤šçª—å£è½¬åŒ–å€¼ï¼ˆConversion Valueï¼‰å»ºæ¨¡ä¸æ•°æ®åˆ†å±‚æ¶æ„
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2260251635887309/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å±±æ°´åŸŸ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T04:00:32.000Z" title="Mon Feb 09 2026 04:00:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>æ‘˜è¦</strong>ï¼šéšç€ iOS éšç§æ”¿ç­–çš„æŒç»­æ¼”è¿›ï¼ŒSKAdNetwork (SKAN) 6.0 å·²æˆä¸ºç§»åŠ¨è¥é”€è¡¡é‡çš„æ–°æ ‡å‡†ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨ SKAN 6.0 çš„æ ¸å¿ƒæœºåˆ¶ï¼Œé‡ç‚¹è§£æå¦‚ä½•é’ˆå¯¹ä¸‰ä¸ªè½¬åŒ–çª—å£è¿›è¡Œç§‘å­¦çš„è½¬åŒ–å€¼ï¼ˆCVï¼‰å»ºæ¨¡ï¼Œå¹¶æ„å»ºé€‚é…åˆ†å±‚æ•°æ®ï¼ˆHierarchical Dataï¼‰çš„å½’å› æ¶æ„ï¼Œå¸®åŠ©é«˜çº§ iOS å¼€å‘è€…ä¸ AdTech ä¸“å®¶åœ¨éšç§ä¿æŠ¤æ—¶ä»£é‡æ„æ•°æ®å¢é•¿å¼•æ“ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">ä¸€ã€ SKAN 6.0ï¼šä»â€œé»‘ç›’â€åˆ°â€œå¤šç»´åº¦é€æ˜â€</h2>
<p>SKAdNetwork 6.0ï¼ˆéš iOS 17.4+ å‘å¸ƒï¼‰åœ¨ 4.0 çš„åŸºç¡€ä¸Šè¿›ä¸€æ­¥æ·±åŒ–äº†éšç§ä¸æ•ˆæœçš„å¹³è¡¡ã€‚ç›¸æ¯”æ—©æœŸç‰ˆæœ¬ï¼ŒSKAN 6.0 çš„æ ¸å¿ƒè¿›æ­¥åœ¨äºé€šè¿‡<strong>å¤šçª—å£å›ä¼ ï¼ˆMultiple Postbacksï¼‰<strong>å’Œ</strong>åˆ†å±‚æºæ ‡è¯†ç¬¦ï¼ˆHierarchical Source IDsï¼‰</strong>ï¼Œæä¾›äº†æ›´é•¿çš„ç”Ÿå‘½å‘¨æœŸè§‚æµ‹èƒ½åŠ›å’Œæ›´çµæ´»çš„æ•°æ®ç²’åº¦ã€‚</p>
<h3 data-id="heading-1">æ ¸å¿ƒå˜åŒ–ç‚¹ï¼š</h3>
<ol>
<li><strong>ä¸‰æ®µå¼è½¬åŒ–çª—å£</strong>ï¼š
<ul>
<li><strong>Window 1 (P1)</strong>: 0-2 å¤©ï¼Œæ”¯æŒç²¾ç»†åŒ–ï¼ˆFine-grained, 0-63ï¼‰æˆ–ç²—ç•¥åŒ–ï¼ˆCoarse-grainedï¼‰CVã€‚</li>
<li><strong>Window 2 (P2)</strong>: 3-7 å¤©ï¼Œä»…æ”¯æŒç²—ç•¥åŒ– CVã€‚</li>
<li><strong>Window 3 (P3)</strong>: 8-35 å¤©ï¼Œä»…æ”¯æŒç²—ç•¥åŒ– CVã€‚</li>
</ul>
</li>
<li><strong>åˆ†å±‚æºæ ‡è¯†ç¬¦ï¼ˆSource IDï¼‰</strong>ï¼šä» 2 ä½æ‰©å±•åˆ° 4 ä½ï¼Œæ ¹æ®äººç¾¤åŒ¿ååº¦ï¼ˆCrowd Anonymityï¼‰é˜¶æ¢¯å¼é‡Šæ”¾æ•°æ®ã€‚</li>
<li><strong>å¹¿å‘Šä¸»åŸŸåï¼ˆAdvertising Domainï¼‰</strong>ï¼šå¢å¼ºäº†ç½‘é¡µåˆ° App å½’å› çš„å®‰å…¨æ€§ä¸é€æ˜åº¦ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-2">äºŒã€ å¤šçª—å£è½¬åŒ–å€¼ï¼ˆCVï¼‰å»ºæ¨¡ç­–ç•¥</h2>
<p>åœ¨ SKAN 6.0 ä¸­ï¼ŒCV å»ºæ¨¡ä¸å†æ˜¯å•ä¸€ç»´åº¦çš„æ˜ å°„ï¼Œè€Œæ˜¯ä¸€åœºå…³äºâ€œæ—¶é—´â€ä¸â€œä»·å€¼â€çš„åšå¼ˆã€‚</p>
<h3 data-id="heading-3">2.1 Window 1 (P1)ï¼šç²¾ç»†åŒ–å»ºæ¨¡ï¼ˆ0-63ï¼‰</h3>
<p>P1 å†³å®šäº†åˆå§‹å‡ºä»·æ¨¡å‹çš„å‡†ç¡®æ€§ã€‚å»ºè®®é‡‡ç”¨â€œæ”¶å…¥+è¡Œä¸ºâ€æ··åˆæ¨¡å‹ï¼š</p>
<ul>
<li><strong>Bits 0-3 (Value 0-15)</strong>ï¼šä»£è¡¨æ”¶å…¥åŒºé—´ï¼ˆe.g., <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">0, </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"/><span class="mord">0</span><span class="mpunct">,</span></span></span></span></span>0.99-$4.99, ...ï¼‰ã€‚</li>
<li><strong>Bits 4-5 (Value 16-63)</strong>ï¼šä»£è¡¨å…³é”®è½¬åŒ–è¡Œä¸ºï¼ˆe.g., å®Œæˆæ–°æ‰‹å¼•å¯¼ã€åŠ å…¥è´­ç‰©è½¦ã€è®¢é˜…å°è¯•ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-4">2.2 Window 2 &amp; 3 (P2/P3)ï¼šç²—ç•¥åŒ–å»ºæ¨¡ï¼ˆLow/Medium/Highï¼‰</h3>
<p>ç”±äºä»…æ”¯æŒä¸‰ä¸ªæ¡£ä½ï¼Œå»ºæ¨¡åº”ä¾§é‡äº<strong>é•¿æœŸç•™å­˜</strong>ä¸<strong>LTV é¢„æµ‹</strong>ï¼š</p>
<ul>
<li><strong>Low</strong>: ç”¨æˆ·ä»…å¯åŠ¨è¿‡ Appï¼ˆç»´æŒæ´»è·ƒï¼‰ã€‚</li>
<li><strong>Medium</strong>: ç”¨æˆ·å®Œæˆäº†ä¸­å±‚è½¬åŒ–ï¼ˆe.g., ç´¯è®¡åœ¨çº¿æ—¶é•¿ &gt; 10min æˆ– å®Œæˆ 3 æ¬¡å…³å¡ï¼‰ã€‚</li>
<li><strong>High</strong>: é«˜ä»·å€¼è¡Œä¸ºï¼ˆe.g., å†æ¬¡å¤è´­æˆ–è§¦å‘æ·±åº¦äº’åŠ¨ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-5">2.3 é”çª—æœºåˆ¶ï¼ˆLockWindowï¼‰çš„åº”ç”¨</h3>
<p>å¼€å‘è€…å¯ä»¥é€šè¿‡ <code>lockWindow()</code> æå‰é”å®šå½“å‰çš„è½¬åŒ–çª—å£ï¼Œä»¥ç¼©çŸ­æ•°æ®å›ä¼ çš„å»¶è¿Ÿã€‚
<strong>å®æˆ˜å»ºè®®</strong>ï¼šå½“ç”¨æˆ·è§¦å‘äº†é¢„æœŸçš„æœ€é«˜ä»·å€¼è¡Œä¸ºï¼ˆå¦‚é¦–å……ï¼‰åç«‹å³é”çª—ï¼Œä»¥æœ€å¿«é€Ÿåº¦å°†æ•°æ®åé¦ˆç»™æŠ•æ”¾æ¸ é“ã€‚</p>
<hr/>
<h2 data-id="heading-6">ä¸‰ã€ é€‚é…åˆ†å±‚æ•°æ®ï¼ˆHierarchical Dataï¼‰çš„æ¶æ„è®¾è®¡</h2>
<p>SKAN 6.0 çš„æ•°æ®äº§å‡ºå–å†³äºâ€œäººç¾¤åŒ¿ååº¦â€ã€‚è¿™ç§ä¸ç¡®å®šæ€§è¦æ±‚æœåŠ¡ç«¯æ¶æ„å…·å¤‡æå¼ºçš„é²æ£’æ€§ã€‚</p>
<h3 data-id="heading-7">3.1 æ•°æ®åˆ†å±‚æ¥æ”¶æµç¨‹</h3>
<ol>
<li><strong>æ•è·åŸå§‹å›ä¼ </strong>ï¼šæœåŠ¡ç«¯éœ€èƒ½å¤Ÿå¤„ç†ä¸åŒç²’åº¦çš„ JSONã€‚</li>
<li><strong>æ˜ å°„è§£æå±‚</strong>ï¼šæ ¹æ® <code>source-identifier</code> çš„ä½æ•°ï¼ˆ2/3/4ä½ï¼‰å†³å®šå…³è”çš„å¹¿å‘Šå±‚çº§ï¼ˆCampaign vs Ad Group vs Creativeï¼‰ã€‚</li>
<li><strong>å»¶è¿Ÿä¿®æ­£æ¨¡å‹</strong>ï¼šåˆ©ç”¨ Apple å®šä¹‰çš„æ—¶é—´éšæœºå»¶è¿Ÿï¼ˆWindow 1: 24-48h; Window 2/3: 24-144hï¼‰è¿›è¡Œæ•°æ®å¯¹é½ã€‚</li>
</ol>
<h3 data-id="heading-8">3.2 ä»£ç ç¤ºä¾‹ï¼šæ›´æ–°è½¬åŒ–å€¼ä¸é”å®šçª—å£ï¼ˆSwiftï¼‰</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> StoreKit

<span class="hljs-keyword">func</span> <span class="hljs-title function_">updateSKANConversion</span>(<span class="hljs-params">revenue</span>: <span class="hljs-type">Double</span>, <span class="hljs-params">isDeepConversion</span>: <span class="hljs-type">Bool</span>) {
    <span class="hljs-keyword">let</span> cvValue <span class="hljs-operator">=</span> calculateFineGrainedCV(revenue) <span class="hljs-comment">// è‡ªå®šä¹‰æ˜ å°„é€»è¾‘</span>
    <span class="hljs-keyword">let</span> coarseValue: <span class="hljs-type">SKAdNetwork</span>.<span class="hljs-type">CoarseConversionValue</span> <span class="hljs-operator">=</span> revenue <span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span> <span class="hljs-operator">?</span> .high : .medium
    
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">#available</span>(<span class="hljs-keyword">iOS</span> <span class="hljs-number">16.1</span>, <span class="hljs-operator">*</span>) {
        <span class="hljs-type">SKAdNetwork</span>.updatePostbackConversionValue(cvValue, coarseValue: coarseValue) { error <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> error <span class="hljs-operator">=</span> error {
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"SKAN Update Failed: <span class="hljs-subst">\(error.localizedDescription)</span>"</span>)
            }
        }
        
        <span class="hljs-comment">// å¦‚æœæ˜¯å…³é”®é«˜ä»·å€¼è¡Œä¸ºï¼Œé”å®šçª—å£ä»¥åŠ é€Ÿå›ä¼ </span>
        <span class="hljs-keyword">if</span> isDeepConversion {
            <span class="hljs-type">SKAdNetwork</span>.updatePostbackConversionValue(cvValue, coarseValue: coarseValue, lockWindow: <span class="hljs-literal">true</span>) { error <span class="hljs-keyword">in</span>
                <span class="hljs-comment">// å¤„ç†å›è°ƒ</span>
            }
        }
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-9">å››ã€ æ€»ç»“ä¸æœ€ä½³å®è·µ</h2>
<ol>
<li><strong>ç»„åˆå»ºæ¨¡</strong>ï¼šåˆ©ç”¨ P1 ä¼˜åŒ– CPI/tROASï¼Œåˆ©ç”¨ P2/P3 è§‚æµ‹ç”¨æˆ·ç•™å­˜ã€‚</li>
<li><strong>é˜ˆå€¼ç›‘æ§</strong>ï¼šå®æ—¶ç›‘æ§ <code>postback</code> ä¸­çš„æ•°æ®ç²’åº¦ï¼Œè‹¥é¢‘ç¹å‡ºç°ä½ä½ Source IDï¼Œè¯´æ˜æ ·æœ¬é‡ä¸è¶³ä»¥è§¦å‘éšç§é˜ˆå€¼ï¼Œéœ€è°ƒæ•´æŠ•æ”¾é¢„ç®—é›†ä¸­åº¦ã€‚</li>
<li><strong>æ··åˆå½’å› </strong>ï¼šå°† SKAN æ•°æ®ä¸è‡ªå»ºçš„æ¦‚ç‡æ€§å½’å› ï¼ˆProbabilistic Attributionï¼‰è¿›è¡Œäº¤å‰æ ¡éªŒï¼Œæ„å»ºæ›´å®Œæ•´çš„ç”¨æˆ·ç”»åƒã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¼€æº Claude Code + Codex + é¢æ¿ çš„æœªæ¥vibecodingå¹³å°]]></title>    <link>https://juejin.cn/post/7604690250342809650</link>    <guid>https://juejin.cn/post/7604690250342809650</guid>    <pubDate>2026-02-09T05:38:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604690250342809650" data-draft-id="7604012106154983470" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¼€æº Claude Code + Codex + é¢æ¿ çš„æœªæ¥vibecodingå¹³å°"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,GitHub"/> <meta itemprop="datePublished" content="2026-02-09T05:38:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æœ±æ˜†é¹"/> <meta itemprop="url" content="https://juejin.cn/user/2788017219055175"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¼€æº Claude Code + Codex + é¢æ¿ çš„æœªæ¥vibecodingå¹³å°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2788017219055175/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æœ±æ˜†é¹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T05:38:55.000Z" title="Mon Feb 09 2026 05:38:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">ä¸€å¥è¯ä»‹ç»</h3>
<p><strong>CodeMoss</strong> =</p>
<ul>
<li>å¤šAIè”åŠ¨ï¼šClaude Code + Codex + Gemini + OpenCode + ......</li>
<li>å¤šç«¯ä½¿ç”¨ï¼šå®¢æˆ·ç«¯ + Jetbrains + Vscode + ç§»åŠ¨ç«¯</li>
<li>å¤šå‘¨è¾¹é›†æˆï¼šAIé¢æ¿ + AIè®°å¿† + Superpowers + OpenSpec + Spec-kit + ...</li>
</ul>
<blockquote>
<p>è¯´äº†è¿™ä¹ˆå¤šåŠŸèƒ½ï¼Œç›´æ¥æ”¾å®æœºå›¾æ›´å®¹æ˜“ç†è§£</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ca3a052d2b145e385c849123967241f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyx5piG6bmP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771220335&amp;x-signature=nn0sfSGVe8SCmJhyegPUQthmaPQ%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7fe14972acb469084b0c60d0d558814~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyx5piG6bmP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771220335&amp;x-signature=NU52DPK8Lm2G%2B9xpxbCw22iTjh0%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<blockquote>
<p>æ€»ä¹‹ä¸€å¥è¯ï¼šCodeMoss ç›®æ ‡æ‰“é€  ä¸‹ä¸€ä»£çš„vibecoding å…¥å£</p>
</blockquote>
<p>å¼€æºåœ°å€ï¼ˆæ„Ÿè°¢ä½ çš„Starå’Œæ¨èï¼Œè¿™å°†è®©æ›´å¤šäººç”¨åˆ°ï¼‰</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzhukunpenglinyutong%2Fcodemoss" target="_blank" title="https://github.com/zhukunpenglinyutong/codemoss" ref="nofollow noopener noreferrer">github.com/zhukunpenglâ€¦</a></p>
<hr/>
<h3 data-id="heading-1">è¯¦ç»†ä»‹ç»</h3>
<h5 data-id="heading-2">å¯¹è¯è¿‡ç¨‹é¡µé¢</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea4d23aabf7646c395e29b8a44a34b66~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyx5piG6bmP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771220335&amp;x-signature=c3QPYmb1GfoFrytKQXFtsM9WhOg%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-3">ä¾§è¾¹æ GITæ¨¡å—</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06dd3656613146ccbb9cda85860b6a13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyx5piG6bmP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771220335&amp;x-signature=LN762OBz34XAd3G4yrP3tn8u6hk%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-4">ä¾§è¾¹æ æ–‡ä»¶ç®¡ç†æ¨¡å—</h5>
<blockquote>
<p>çœŸçš„å¯ä»¥ç¼–è¾‘å“¦~</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88d15377ba374873b9e4df738851cb05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyx5piG6bmP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771220335&amp;x-signature=QFYzxbRbR1tCSuEzx6B6oWd9iTI%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-5">é¢æ¿æ¨¡å¼</h5>
<blockquote>
<p>è¿™ä¸æ˜¯æ™®é€šçš„é¢æ¿å“¦~ï¼Œæ˜¯çœŸçš„å¯ä»¥å¹¶è¡Œæ‰§è¡Œä»»åŠ¡ï¼Œæœ‰å®Œæ•´äº¤äº’çš„AIé¢æ¿å“¦~</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/adfaccd9f8cb4b9a8a0abc47679939be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyx5piG6bmP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771220335&amp;x-signature=PxJ4XU6%2BtRxC8ysMbkrTqhiX%2FYs%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/505c1c2cb910498db91cd4871fd4fdee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyx5piG6bmP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771220335&amp;x-signature=cuz5SdkkWUFnZlAurLR8XArccoE%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-6">ä¾§è¾¹æ å±•ç¤º</h5>
<blockquote>
<p>æ”¯æŒclaude code + codex å¤šcliæ•°æ®å…±åŒå±•ç¤º</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79209c020a4646e694c680e832bc3d2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyx5piG6bmP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771220335&amp;x-signature=%2Fg9PkLAb06JrJzxT3vjnhm5oWIE%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-7">ç»ˆç«¯å±•ç¤º</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/304d9c7d34cc49e29ca1578418f392b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyx5piG6bmP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771220335&amp;x-signature=EWwAc4%2BchrQmw0Mccj995MNLkDk%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-8">æ”¯æŒå¤šå¹³å°</h5>
<p>æ”¯æŒMac å’Œ window å¤šå¹³å°</p>
<hr/>
<h3 data-id="heading-9">ä¸‹è½½å®‰è£…ä½“éªŒ</h3>
<p>åŠŸèƒ½å¤ªå¤šäº†ï¼Œå°±ä¸èµ˜è¿°äº†ï¼Œå¤§å®¶å¯ä»¥ä¸‹è½½ä¹‹åè‡ªè¡Œæ¢ç´¢</p>
<p>ä¸‹è½½åœ°å€ï¼ˆçº¯å¼€æºï¼Œæ— å•†ä¸šï¼Œæ”¾å¿ƒé£Ÿç”¨ï¼‰ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.codemoss.ai%2Fdownload" target="_blank" title="https://www.codemoss.ai/download" ref="nofollow noopener noreferrer">www.codemoss.ai/download</a></p>
<hr/>
<h3 data-id="heading-10">æœªæ¥è¿­ä»£</h3>
<p>ç›®å‰è™½ç„¶èƒ½ç”¨ï¼Œä½†æ˜¯ç»†èŠ‚æ‰“ç£¨çš„è¿˜ä¸æ»¡æ„ï¼Œæˆ‘è‡³å°‘ä¼šæ¯å¤©è¿­ä»£ä¸€ä¸ªç‰ˆæœ¬ï¼Œå…ˆè¿­ä»£100ä¸ªç‰ˆæœ¬ï¼Œæ¬¢è¿å¤§å®¶ä½¿ç”¨æå‡ºé—®é¢˜</p>
<p>å¼€æºåœ°å€ï¼ˆæ„Ÿè°¢ä½ çš„Starå’Œæ¨èï¼Œè¿™å°†è®©æ›´å¤šäººç”¨åˆ°ï¼‰</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzhukunpenglinyutong%2Fcodemoss" target="_blank" title="https://github.com/zhukunpenglinyutong/codemoss" ref="nofollow noopener noreferrer">github.com/zhukunpenglâ€¦</a></p>
<blockquote>
<p>å†æ¬¡å£°æ˜ï¼šæœ¬é¡¹ç›®å®Œå…¨å¼€æºï¼Œ0å•†ä¸šï¼Œä½¿ç”¨è¿‡ç¨‹å…¨ç¨‹æ— å¹¿ï¼Œè¯·æ”¾å¿ƒé£Ÿç”¨</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[5ä¸ªå®ç”¨Pythonå°è„šæœ¬ï¼Œæ–°æ‰‹ä¹Ÿèƒ½è½»æ¾å®ç°ï¼ˆé™„å®Œæ•´ä»£ç ï¼‰]]></title>    <link>https://juejin.cn/post/7603959423129042944</link>    <guid>https://juejin.cn/post/7603959423129042944</guid>    <pubDate>2026-02-09T03:16:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603959423129042944" data-draft-id="7603959423129026560" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="5ä¸ªå®ç”¨Pythonå°è„šæœ¬ï¼Œæ–°æ‰‹ä¹Ÿèƒ½è½»æ¾å®ç°ï¼ˆé™„å®Œæ•´ä»£ç ï¼‰"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-02-09T03:16:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="èººå¹³å¤§é¹…"/> <meta itemprop="url" content="https://juejin.cn/user/2455634286221657"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            5ä¸ªå®ç”¨Pythonå°è„šæœ¬ï¼Œæ–°æ‰‹ä¹Ÿèƒ½è½»æ¾å®ç°ï¼ˆé™„å®Œæ•´ä»£ç ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2455634286221657/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    èººå¹³å¤§é¹…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T03:16:44.000Z" title="Mon Feb 09 2026 03:16:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¯¹äºPythonæ–°æ‰‹æ¥è¯´ï¼Œå­¦ä¹ è¯­æ³•çš„æœ€ç»ˆç›®çš„æ˜¯â€œè§£å†³å®é™…é—®é¢˜â€ï¼Œè€Œç®€å•çš„å°è„šæœ¬æ—¢èƒ½å·©å›ºåŸºç¡€è¯­æ³•ï¼Œåˆèƒ½å¸¦æ¥æˆå°±æ„Ÿï¼ŒåŒæ—¶è¿˜èƒ½ç”¨åˆ°æ—¥å¸¸å·¥ä½œå’Œå­¦ä¹ ä¸­ï¼Œä¸€ä¸¾ä¸‰å¾—ã€‚</p>
<p>ä»Šå¤©åˆ†äº«5ä¸ªå®ç”¨çš„Pythonå°è„šæœ¬ï¼Œè¦†ç›–æ–‡ä»¶å¤„ç†ã€æ•°æ®ç»Ÿè®¡ã€æ—¥å¸¸å·¥å…·ç­‰åœºæ™¯ï¼Œæ¯ç¯‡è„šæœ¬éƒ½æœ‰å®Œæ•´ä»£ç å’Œè¯¦ç»†æ³¨é‡Šï¼Œæ–°æ‰‹å¤åˆ¶å°±èƒ½è¿è¡Œï¼Œè¿˜èƒ½æ ¹æ®è‡ªå·±çš„éœ€æ±‚ä¿®æ”¹ä¼˜åŒ–ï¼Œå¿«é€Ÿæå‡ç¼–ç¨‹èƒ½åŠ›ï½</p>
<h3 data-id="heading-0">è„šæœ¬ä¸€ï¼šæ–‡ä»¶æ‰¹é‡é‡å‘½åï¼ˆæ‰¹é‡ä¿®æ”¹æ–‡ä»¶åï¼Œé«˜æ•ˆä¾¿æ·ï¼‰</h3>
<p>é€‚ç”¨åœºæ™¯ï¼šæ‰¹é‡ä¿®æ”¹æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶åç§°ï¼ˆæ¯”å¦‚æ‰¹é‡ä¿®æ”¹å›¾ç‰‡ã€æ–‡æ¡£ã€ä»£ç æ–‡ä»¶çš„åç§°ï¼‰ï¼Œé¿å…æ‰‹åŠ¨é€ä¸ªä¿®æ”¹ï¼ŒèŠ‚çœæ—¶é—´ã€‚</p>
<p>æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼šosæ¨¡å—ï¼ˆæ–‡ä»¶æ“ä½œï¼‰ã€forå¾ªç¯ï¼ŒæŒæ¡os.listdir()ã€os.rename()çš„ç”¨æ³•ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os  <span class="hljs-comment"># å¯¼å…¥osæ¨¡å—ï¼Œç”¨äºæ“ä½œæ–‡ä»¶å’Œæ–‡ä»¶å¤¹</span>

<span class="hljs-comment"># 1. å®šä¹‰è¦æ‰¹é‡é‡å‘½åçš„æ–‡ä»¶å¤¹è·¯å¾„ï¼ˆæ›¿æ¢æˆä½ çš„æ–‡ä»¶å¤¹è·¯å¾„ï¼Œæ³¨æ„è·¯å¾„ä¸­çš„åæ–œæ ç”¨//æˆ–/ï¼‰</span>
folder_path = <span class="hljs-string">"D://test//images"</span>

<span class="hljs-comment"># 2. è·å–æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼ˆè¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼ŒåŒ…å«æ‰€æœ‰æ–‡ä»¶åï¼‰</span>
file_list = os.listdir(folder_path)

<span class="hljs-comment"># 3. å¾ªç¯éå†æ‰€æœ‰æ–‡ä»¶ï¼Œé€ä¸ªé‡å‘½å</span>
<span class="hljs-keyword">for</span> index, file_name <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(file_list):
    <span class="hljs-comment"># è·³è¿‡æ–‡ä»¶å¤¹ï¼ˆåªé‡å‘½åæ–‡ä»¶ï¼Œä¸å¤„ç†å­æ–‡ä»¶å¤¹ï¼‰</span>
    <span class="hljs-keyword">if</span> os.path.isfile(os.path.join(folder_path, file_name)):
        <span class="hljs-comment"># åˆ†å‰²æ–‡ä»¶åå’Œåç¼€ï¼ˆæ¯”å¦‚"1.jpg"åˆ†å‰²æˆ["1", "jpg"]ï¼‰</span>
        file_ext = os.path.splitext(file_name)[<span class="hljs-number">1</span>]
        <span class="hljs-comment"># å®šä¹‰æ–°çš„æ–‡ä»¶åï¼ˆæ¯”å¦‚"image_01.jpg"ã€"image_02.jpg"ï¼Œindexä»0å¼€å§‹ï¼Œ+1è®©åºå·ä»1å¼€å§‹ï¼‰</span>
        new_file_name = <span class="hljs-string">f"image_<span class="hljs-subst">{index+<span class="hljs-number">1</span>:02d}</span><span class="hljs-subst">{file_ext}</span>"</span>
        <span class="hljs-comment"># æ‹¼æ¥æ—§æ–‡ä»¶è·¯å¾„å’Œæ–°æ–‡ä»¶è·¯å¾„</span>
        old_path = os.path.join(folder_path, file_name)
        new_path = os.path.join(folder_path, new_file_name)
        <span class="hljs-comment"># æ‰§è¡Œé‡å‘½åæ“ä½œ</span>
        os.rename(old_path, new_path)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å·²ä¿®æ”¹ï¼š<span class="hljs-subst">{file_name}</span> â†’ <span class="hljs-subst">{new_file_name}</span>"</span>)

<span class="hljs-built_in">print</span>(<span class="hljs-string">"æ‰¹é‡é‡å‘½åå®Œæˆï¼"</span>)
    
</code></pre>
<p>ğŸ’¡ ä½¿ç”¨è¯´æ˜ï¼šæ›¿æ¢folder_pathä¸ºè‡ªå·±çš„æ–‡ä»¶å¤¹è·¯å¾„ï¼Œè¿è¡Œè„šæœ¬ï¼Œå³å¯å°†æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶æ‰¹é‡å‘½åä¸ºâ€œimage_01.åç¼€â€â€œimage_02.åç¼€â€ï¼Œåºå·è‡ªåŠ¨é€’å¢ã€‚</p>
<h3 data-id="heading-1">è„šæœ¬äºŒï¼šç®€å•æ–‡æœ¬ç»Ÿè®¡å·¥å…·ï¼ˆç»Ÿè®¡å­—æ•°ã€è¡Œæ•°ã€ç©ºæ ¼æ•°ï¼‰</h3>
<p>é€‚ç”¨åœºæ™¯ï¼šç»Ÿè®¡æ–‡æœ¬æ–‡ä»¶ï¼ˆ.txtã€.mdç­‰ï¼‰çš„å­—æ•°ã€è¡Œæ•°ã€ç©ºæ ¼æ•°ï¼Œæ¯”å¦‚ç»Ÿè®¡è®ºæ–‡å­—æ•°ã€ç¬”è®°å­—æ•°ï¼Œæ— éœ€æ‰‹åŠ¨è®¡æ•°ã€‚</p>
<p>æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼šæ–‡ä»¶è¯»å†™ï¼ˆopen()å‡½æ•°ï¼‰ã€å­—ç¬¦ä¸²æ“ä½œã€forå¾ªç¯ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 1. å®šä¹‰è¦ç»Ÿè®¡çš„æ–‡æœ¬æ–‡ä»¶è·¯å¾„ï¼ˆæ›¿æ¢æˆä½ çš„æ–‡ä»¶è·¯å¾„ï¼‰</span>
file_path = <span class="hljs-string">"D://test//note.txt"</span>

<span class="hljs-comment"># 2. åˆå§‹åŒ–ç»Ÿè®¡å˜é‡</span>
line_count = <span class="hljs-number">0</span>  <span class="hljs-comment"># è¡Œæ•°</span>
char_count = <span class="hljs-number">0</span>  <span class="hljs-comment"># æ€»å­—ç¬¦æ•°ï¼ˆåŒ…å«ç©ºæ ¼ã€æ ‡ç‚¹ï¼‰</span>
space_count = <span class="hljs-number">0</span> <span class="hljs-comment"># ç©ºæ ¼æ•°</span>
word_count = <span class="hljs-number">0</span>  <span class="hljs-comment"># å•è¯æ•°ï¼ˆä»¥ç©ºæ ¼åˆ†éš”ï¼‰</span>

<span class="hljs-comment"># 3. æ‰“å¼€æ–‡ä»¶ï¼Œè¯»å–å†…å®¹ï¼ˆencoding="utf-8"é¿å…ä¸­æ–‡ä¹±ç ï¼‰</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:
    <span class="hljs-comment"># é€è¡Œè¯»å–æ–‡ä»¶å†…å®¹</span>
    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f:
        line_count += <span class="hljs-number">1</span>  <span class="hljs-comment"># æ¯è¯»ä¸€è¡Œï¼Œè¡Œæ•°+1</span>
        space_count += line.count(<span class="hljs-string">" "</span>)  <span class="hljs-comment"># ç»Ÿè®¡å½“å‰è¡Œçš„ç©ºæ ¼æ•°ï¼Œç´¯åŠ åˆ°æ€»ç©ºæ ¼æ•°</span>
        char_count += <span class="hljs-built_in">len</span>(line.replace(<span class="hljs-string">"\n"</span>, <span class="hljs-string">""</span>))  <span class="hljs-comment"># ç»Ÿè®¡å½“å‰è¡Œçš„å­—ç¬¦æ•°ï¼ˆå»æ‰æ¢è¡Œç¬¦ï¼‰</span>
        word_count += <span class="hljs-built_in">len</span>(line.split())  <span class="hljs-comment"># ç»Ÿè®¡å½“å‰è¡Œçš„å•è¯æ•°ï¼ˆä»¥ç©ºæ ¼åˆ†éš”ï¼‰</span>

<span class="hljs-comment"># 4. è¾“å‡ºç»Ÿè®¡ç»“æœ</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span>*<span class="hljs-number">30</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ–‡æœ¬æ–‡ä»¶ç»Ÿè®¡ç»“æœï¼š"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ€»è¡Œæ•°ï¼š<span class="hljs-subst">{line_count}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ€»å­—ç¬¦æ•°ï¼ˆä¸å«æ¢è¡Œç¬¦ï¼‰ï¼š<span class="hljs-subst">{char_count}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ€»ç©ºæ ¼æ•°ï¼š<span class="hljs-subst">{space_count}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ€»å•è¯æ•°ï¼ˆä»¥ç©ºæ ¼åˆ†éš”ï¼‰ï¼š<span class="hljs-subst">{word_count}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span>*<span class="hljs-number">30</span>)
    
</code></pre>
<p>ğŸ’¡ ä½¿ç”¨è¯´æ˜ï¼šæ›¿æ¢file_pathä¸ºè‡ªå·±çš„æ–‡æœ¬æ–‡ä»¶è·¯å¾„ï¼Œè¿è¡Œè„šæœ¬ï¼Œå³å¯å¿«é€Ÿå¾—åˆ°æ–‡æœ¬çš„å„é¡¹ç»Ÿè®¡æ•°æ®ï¼Œæ”¯æŒä¸­æ–‡æ–‡æœ¬ã€‚</p>
<h3 data-id="heading-2">è„šæœ¬ä¸‰ï¼šéšæœºå¯†ç ç”Ÿæˆå™¨ï¼ˆç”Ÿæˆå®‰å…¨ã€å¤æ‚çš„å¯†ç ï¼‰</h3>
<p>é€‚ç”¨åœºæ™¯ï¼šç”Ÿæˆéšæœºå¯†ç ï¼ˆåŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šç¬¦å·ï¼‰ï¼Œç”¨äºæ³¨å†Œè´¦å·ã€ç™»å½•å¯†ç ï¼Œæ¯”æ‰‹åŠ¨è®¾ç½®çš„å¯†ç æ›´å®‰å…¨ã€‚</p>
<p>æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼šrandomæ¨¡å—ï¼ˆéšæœºç”Ÿæˆï¼‰ã€å­—ç¬¦ä¸²æ‹¼æ¥ã€forå¾ªç¯ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> random  <span class="hljs-comment"># å¯¼å…¥randomæ¨¡å—ï¼Œç”¨äºç”Ÿæˆéšæœºæ•°</span>
<span class="hljs-keyword">import</span> string  <span class="hljs-comment"># å¯¼å…¥stringæ¨¡å—ï¼Œè·å–å¤§å°å†™å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šç¬¦å·</span>

<span class="hljs-comment"># 1. å®šä¹‰å¯†ç åŒ…å«çš„å­—ç¬¦é›†ï¼ˆå¯æ ¹æ®éœ€æ±‚ä¿®æ”¹ï¼Œæ¯”å¦‚å»æ‰ç‰¹æ®Šç¬¦å·ï¼‰</span>
<span class="hljs-comment"># å¤§å°å†™å­—æ¯ + æ•°å­— + ç‰¹æ®Šç¬¦å·ï¼ˆ!@#$%^&amp;*()_+-=ï¼‰</span>
chars = string.ascii_letters + string.digits + <span class="hljs-string">"!@#$%^&amp;*()_+-="</span>

<span class="hljs-comment"># 2. å®šä¹‰å¯†ç é•¿åº¦ï¼ˆå¯è‡ªå®šä¹‰ï¼Œæ¯”å¦‚8ä½ã€12ä½ã€16ä½ï¼Œè¶Šé•¿è¶Šå®‰å…¨ï¼‰</span>
password_length = <span class="hljs-number">12</span>

<span class="hljs-comment"># 3. ç”Ÿæˆéšæœºå¯†ç ï¼ˆä»charsä¸­éšæœºé€‰æ‹©password_lengthä¸ªå­—ç¬¦ï¼Œæ‹¼æ¥æˆå­—ç¬¦ä¸²ï¼‰</span>
password = <span class="hljs-string">""</span>.join(random.choice(chars) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(password_length))

<span class="hljs-comment"># 4. è¾“å‡ºç”Ÿæˆçš„å¯†ç </span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç”Ÿæˆçš„éšæœºå¯†ç ï¼š<span class="hljs-subst">{password}</span>"</span>)
    
</code></pre>
<p>ğŸ’¡ æ‹“å±•ä¼˜åŒ–ï¼šæ–°æ‰‹å¯ä»¥ä¿®æ”¹password_lengthï¼Œç”Ÿæˆä¸åŒé•¿åº¦çš„å¯†ç ï¼›ä¹Ÿå¯ä»¥ä¿®æ”¹charsï¼Œå»æ‰ä¸éœ€è¦çš„å­—ç¬¦ï¼ˆæ¯”å¦‚ä¸éœ€è¦ç‰¹æ®Šç¬¦å·ï¼Œå°±åˆ é™¤charsä¸­çš„ç‰¹æ®Šç¬¦å·éƒ¨åˆ†ï¼‰ã€‚</p>
<h3 data-id="heading-3">è„šæœ¬å››ï¼šæ‰¹é‡æå–æ–‡æœ¬ä¸­çš„é‚®ç®±åœ°å€</h3>
<p>é€‚ç”¨åœºæ™¯ï¼šä»å¤§é‡æ–‡æœ¬ä¸­ï¼Œæ‰¹é‡æå–æ‰€æœ‰é‚®ç®±åœ°å€ï¼ˆæ¯”å¦‚ä»æ–‡æ¡£ã€æ—¥å¿—ã€ç½‘é¡µæºç ä¸­æå–é‚®ç®±ï¼‰ï¼Œé¿å…æ‰‹åŠ¨æŸ¥æ‰¾ï¼Œé«˜æ•ˆä¾¿æ·ã€‚</p>
<p>æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼šreæ¨¡å—ï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨äºåŒ¹é…é‚®ç®±æ ¼å¼ï¼‰ã€æ–‡ä»¶è¯»å†™ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> re  <span class="hljs-comment"># å¯¼å…¥reæ¨¡å—ï¼Œç”¨äºæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</span>

<span class="hljs-comment"># 1. å®šä¹‰è¦æå–é‚®ç®±çš„æ–‡æœ¬æ–‡ä»¶è·¯å¾„ï¼ˆæ›¿æ¢æˆä½ çš„æ–‡ä»¶è·¯å¾„ï¼‰</span>
file_path = <span class="hljs-string">"D://test//data.txt"</span>

<span class="hljs-comment"># 2. å®šä¹‰é‚®ç®±æ­£åˆ™è¡¨è¾¾å¼ï¼ˆåŒ¹é…ç»å¤§å¤šæ•°é‚®ç®±æ ¼å¼ï¼Œå¦‚xxx@xxx.comã€xxx@xxx.cnï¼‰</span>
email_pattern = <span class="hljs-string">r"[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+"</span>

<span class="hljs-comment"># 3. è¯»å–æ–‡æœ¬æ–‡ä»¶å†…å®¹</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:
    text = f.read()  <span class="hljs-comment"># è¯»å–æ•´ä¸ªæ–‡ä»¶çš„å†…å®¹</span>

<span class="hljs-comment"># 4. åŒ¹é…æ–‡æœ¬ä¸­çš„æ‰€æœ‰é‚®ç®±åœ°å€ï¼Œè¿”å›ä¸€ä¸ªåˆ—è¡¨</span>
emails = re.findall(email_pattern, text)

<span class="hljs-comment"># 5. è¾“å‡ºæå–ç»“æœ</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"å…±æå–åˆ° <span class="hljs-subst">{<span class="hljs-built_in">len</span>(emails)}</span> ä¸ªé‚®ç®±åœ°å€ï¼š"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span>*<span class="hljs-number">50</span>)
<span class="hljs-keyword">for</span> email <span class="hljs-keyword">in</span> emails:
    <span class="hljs-built_in">print</span>(email)
    
</code></pre>
<p>ğŸ’¡ ä½¿ç”¨è¯´æ˜ï¼šæ›¿æ¢file_pathä¸ºè‡ªå·±çš„æ–‡æœ¬æ–‡ä»¶è·¯å¾„ï¼Œè¿è¡Œè„šæœ¬ï¼Œå³å¯æå–æ–‡æœ¬ä¸­æ‰€æœ‰ç¬¦åˆæ ¼å¼çš„é‚®ç®±åœ°å€ï¼Œé€‚åˆæ‰¹é‡å¤„ç†å¤§é‡æ–‡æœ¬ã€‚</p>
<h3 data-id="heading-4">è„šæœ¬äº”ï¼šç®€æ˜“å¤©æ°”é¢„æŠ¥æŸ¥è¯¢ï¼ˆè¾“å…¥åŸå¸‚ï¼ŒæŸ¥è¯¢å®æ—¶å¤©æ°”ï¼‰</h3>
<p>é€‚ç”¨åœºæ™¯ï¼šè¾“å…¥åŸå¸‚åç§°ï¼ŒæŸ¥è¯¢è¯¥åŸå¸‚çš„å®æ—¶å¤©æ°”ï¼ˆæ¸©åº¦ã€å¤©æ°”çŠ¶å†µã€é£åŠ›ç­‰ï¼‰ï¼Œæ— éœ€æ‰“å¼€æµè§ˆå™¨ï¼Œç›´æ¥è¿è¡Œè„šæœ¬å³å¯æŸ¥è¯¢ã€‚</p>
<p>æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼šrequestsæ¨¡å—ï¼ˆå‘é€ç½‘ç»œè¯·æ±‚ï¼‰ã€JSONæ•°æ®è§£æï¼Œæ–°æ‰‹éœ€è¦å…ˆå®‰è£…requestsæ¨¡å—ï¼ˆå‘½ä»¤ï¼špip install requestsï¼‰ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests  <span class="hljs-comment"># å¯¼å…¥requestsæ¨¡å—ï¼Œç”¨äºå‘é€ç½‘ç»œè¯·æ±‚</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_weather</span>(<span class="hljs-params">city</span>):
    <span class="hljs-comment"># å…è´¹å¤©æ°”æ¥å£ï¼ˆæ— éœ€æ³¨å†Œï¼Œç›´æ¥ä½¿ç”¨ï¼Œè¿”å›JSONæ ¼å¼æ•°æ®ï¼‰</span>
    url = <span class="hljs-string">f"https://v0.yiketianqi.com/api?unescape=1&amp;version=v61&amp;appid=79334739&amp;appsecret=5S8IYq6Q&amp;city=<span class="hljs-subst">{city}</span>"</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># å‘é€GETè¯·æ±‚ï¼Œè·å–å¤©æ°”æ•°æ®</span>
        response = requests.get(url)
        response.raise_for_status()  <span class="hljs-comment"># è‹¥è¯·æ±‚å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸</span>
        weather_data = response.json()  <span class="hljs-comment"># è§£æJSONæ•°æ®ï¼Œè½¬ä¸ºå­—å…¸</span>
        
        <span class="hljs-comment"># æå–éœ€è¦çš„å¤©æ°”ä¿¡æ¯</span>
        city_name = weather_data[<span class="hljs-string">"city"</span>]  <span class="hljs-comment"># åŸå¸‚åç§°</span>
        temp = weather_data[<span class="hljs-string">"tem"</span>]        <span class="hljs-comment"># å½“å‰æ¸©åº¦</span>
        weather = weather_data[<span class="hljs-string">"wea"</span>]     <span class="hljs-comment"># å¤©æ°”çŠ¶å†µï¼ˆå¦‚æ™´ã€é˜´ã€é›¨ï¼‰</span>
        wind = weather_data[<span class="hljs-string">"win"</span>]        <span class="hljs-comment"># é£åŠ›</span>
        humidity = weather_data[<span class="hljs-string">"humidity"</span>]<span class="hljs-comment"># æ¹¿åº¦</span>
        
        <span class="hljs-comment"># è¾“å‡ºå¤©æ°”ä¿¡æ¯</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span>*<span class="hljs-number">30</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ã€<span class="hljs-subst">{city_name}</span> å®æ—¶å¤©æ°”é¢„æŠ¥ã€‘"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å½“å‰æ¸©åº¦ï¼š<span class="hljs-subst">{temp}</span>â„ƒ"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¤©æ°”çŠ¶å†µï¼š<span class="hljs-subst">{weather}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"é£åŠ›ï¼š<span class="hljs-subst">{wind}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ¹¿åº¦ï¼š<span class="hljs-subst">{humidity}</span>%"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span>*<span class="hljs-number">30</span>)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æŸ¥è¯¢å¤±è´¥ï¼åŸå› ï¼š<span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>)

<span class="hljs-comment"># ä¸»ç¨‹åº</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-comment"># è¾“å…¥è¦æŸ¥è¯¢çš„åŸå¸‚åç§°</span>
    city = <span class="hljs-built_in">input</span>(<span class="hljs-string">"è¯·è¾“å…¥è¦æŸ¥è¯¢å¤©æ°”çš„åŸå¸‚ï¼ˆå¦‚åŒ—äº¬ã€ä¸Šæµ·ï¼‰ï¼š"</span>)
    <span class="hljs-comment"># è°ƒç”¨å‡½æ•°ï¼ŒæŸ¥è¯¢å¤©æ°”</span>
    get_weather(city)
    
</code></pre>
<p>ğŸ’¡ ä½¿ç”¨è¯´æ˜ï¼š</p>
<ol>
<li>
<p>å…ˆæ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥å‘½ä»¤ <code>pip install requests</code>ï¼Œå®‰è£…requestsæ¨¡å—ï¼›</p>
</li>
<li>
<p>è¿è¡Œè„šæœ¬ï¼Œè¾“å…¥åŸå¸‚åç§°ï¼ˆå¦‚â€œåŒ—äº¬â€â€œå¹¿å·â€ï¼‰ï¼Œå³å¯æŸ¥è¯¢è¯¥åŸå¸‚çš„å®æ—¶å¤©æ°”ã€‚</p>
</li>
</ol>
<h3 data-id="heading-5">æœ€å</h3>
<p>ä»¥ä¸Š5ä¸ªå°è„šæœ¬ï¼Œéƒ½æ˜¯æ—¥å¸¸èƒ½ç”¨å¾—ä¸Šçš„å®ç”¨å·¥å…·ï¼ŒåŒæ—¶è¦†ç›–äº†Pythonçš„æ ¸å¿ƒåŸºç¡€çŸ¥è¯†ç‚¹ï¼Œæ–°æ‰‹å¯ä»¥å…ˆå¤åˆ¶è¿è¡Œï¼Œç†è§£æ¯ä¸€è¡Œä»£ç çš„å«ä¹‰ï¼Œå†å°è¯•ä¿®æ”¹ä¼˜åŒ–ï¼Œæ¯”å¦‚ç»™æ–‡ä»¶é‡å‘½åè„šæœ¬æ·»åŠ è‡ªå®šä¹‰å‰ç¼€ã€ç»™å¯†ç ç”Ÿæˆå™¨æ·»åŠ å¯†ç å¼ºåº¦æ£€æµ‹ç­‰ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2026ç‰ˆJavaé¢è¯•å…«è‚¡æ–‡æ€»ç»“ï¼ˆæ˜¥æ‹›+ç§‹æ‹›+ç¤¾æ‹›ï¼‰ï¼Œå»ºè®®æ”¶è—ã€‚]]></title>    <link>https://juejin.cn/post/7604012106155049006</link>    <guid>https://juejin.cn/post/7604012106155049006</guid>    <pubDate>2026-02-09T05:46:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604012106155049006" data-draft-id="7604344066579939379" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2026ç‰ˆJavaé¢è¯•å…«è‚¡æ–‡æ€»ç»“ï¼ˆæ˜¥æ‹›+ç§‹æ‹›+ç¤¾æ‹›ï¼‰ï¼Œå»ºè®®æ”¶è—ã€‚"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-09T05:46:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Javaç¼–ç¨‹çˆ±å¥½è€…"/> <meta itemprop="url" content="https://juejin.cn/user/819554264300154"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2026ç‰ˆJavaé¢è¯•å…«è‚¡æ–‡æ€»ç»“ï¼ˆæ˜¥æ‹›+ç§‹æ‹›+ç¤¾æ‹›ï¼‰ï¼Œå»ºè®®æ”¶è—ã€‚
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/819554264300154/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Javaç¼–ç¨‹çˆ±å¥½è€…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T05:46:59.000Z" title="Mon Feb 09 2026 05:46:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»22åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä»Šå¹´çš„è¡Œæƒ…ï¼Œè®©æ‹›è˜é¢è¯•å˜å¾—é›ªä¸ŠåŠ éœœã€‚å·²ç»æœ‰ä¸å°‘å¤§å‚ï¼Œå¦‚è…¾è®¯ã€å­—èŠ‚è·³åŠ¨çš„æ‹›è˜åé¢æ˜æ˜¾å‡å°‘ï¼Œé¢è¯•é—¨æ§›å´ä¸€å†æ‹”é«˜ï¼Œå¦‚æœä¸ç”¨å¿ƒå‡†å¤‡ï¼Œå¾ˆå¯èƒ½å°±è¢«é¢è¯•å®˜æ€¼å¾—å“‘å£æ— è¨€ï¼Œç”šè‡³å¤±å»äº†éš¾å¾—çš„æœºä¼šã€‚</p>
<p>ç°å¦‚ä»Šï¼Œæƒ…åŠ¿ä¾ç„¶ä¸¥å³»ï¼Œæœªæ¥å……æ»¡ç€ä¸å®šæ€§ï¼Œæƒ³è¦è·³æ§½æ¶¨è–ªçš„å°ä¼™ä¼´ï¼Œ<strong>åœ¨é¢è¯•å‰æ›´æ˜¯è¦åšå¥½å……è¶³çš„å‡†å¤‡</strong>ï¼</p>
<p>å¦‚æœä½ <strong>å‚åŠ è¿‡ä¸€äº›å¤§å‚é¢è¯•ï¼Œè‚¯å®šä¼šé‡åˆ°ä¸€äº›è¿™æ ·</strong>çš„é—®é¢˜ï¼š</p>
<ul>
<li><strong>åº”å±Šç”Ÿ</strong>ï¼šä½ è¯¥å¦‚ä½•å‡†å¤‡ç®€å†ï¼Œé¢è¯•é¡¹ç›®å’Œé¢è¯•è¯´è¾ï¼Ÿ<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270136242%26content_type%3DArticle%26match_order%3D1%26q%3DSpring%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270136242&amp;content_type=Article&amp;match_order=1&amp;q=Spring&amp;zhida_source=entity" ref="nofollow noopener noreferrer">Spring</a>Â åº•å±‚é€»è¾‘æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li><strong>1-3 å¹´ç»éªŒçš„ç¨‹åºå‘˜</strong>ï¼šé¢è¯•ä¸­ä½ è¯¥è®²å“ªäº›å€¼é’±çš„æŠ€æœ¯ï¼Ÿå¦‚ä½•ç”¨è¿™äº›å€¼é’±çš„æŠ€æœ¯æœ€å¤§ç¨‹åº¦å±•ç¤ºè‡ªå·±çš„æŠ€èƒ½ï¼Ÿåˆ†å¸ƒå¼ç»„ä»¶åº•å±‚é€»è¾‘æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li><strong>3-5 å¹´ç»éªŒçš„ç¨‹åºå‘˜</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270136242%26content_type%3DArticle%26match_order%3D1%26q%3Dk8s%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270136242&amp;content_type=Article&amp;match_order=1&amp;q=k8s&amp;zhida_source=entity" ref="nofollow noopener noreferrer">k8s</a>Â æ€ä¹ˆæ­å»ºå®è·µï¼Ÿ</li>
</ul>
<p>æ˜¯ä¸æ˜¯çœ‹ä¸Šå»å¾ˆéš¾ï¼Œæ˜¯ä¸æ˜¯å’Œè‡ªå·±å‡†å¤‡çš„â€œé¢˜åº“â€ä¸­çš„é—®é¢˜ä¸ä¸€æ ·ï¼Ÿä¸çŸ¥é“ä»ä½•å¤„ä¸‹æ‰‹ï¼Ÿ</p>
<p>æ‰€ä»¥ï¼Œè¦æƒ³åœ¨è¿™ä¸ª<strong>é‡‘ä¸‰é“¶å››æ‹¿ä¸‹å¿ƒä»ªçš„Offer</strong>ï¼Œå’±å°±ä¸€å®šè¦åšå¥½å‡†å¤‡ï¼ŒæŠŠé‚£äº›å¿…è€ƒç‚¹ã€å¥—è·¯éƒ½ç»™åƒé€äº†ï¼</p>
<p>ä»Šå¤©ä¸ºå¤§å®¶æ•´ç†äº†Javaå·¥ç¨‹å¸ˆé«˜çº§é¢è¯•é¢˜åŠä¸€äº›å¤§å‚Javaå¼€å‘é¢è¯•å®å…¸ï¼Œé¢è¯•ç»éªŒæŠ€å·§ç­‰ï¼Œåº”å±Šç”Ÿï¼Œå®ä¹ ç”Ÿï¼Œä¼ä¸šå·¥ä½œè¿‡çš„ï¼Œéƒ½å¯å‚è€ƒå­¦ä¹ ï¼</p>
<h2 data-id="heading-0">JavaåŸºç¡€â€”åŸºç¡€çŸ¥è¯†</h2>
<p><strong>ä¸€ã€å…«ç§åŸºæœ¬æ•°æ®ç±»å‹çš„å¤§å°ï¼Œä»¥åŠä»–ä»¬çš„å°è£…ç±»ã€‚</strong><br/>
byte(Byte) 1 ï¼Œshort(Short) 2 ,int(Integer) 4 ,long(Long) 8 ,float(Float) 4 ,double(Double)8,boolean(Boolean),char(Character)2</p>
<p><strong>äºŒã€Switchèƒ½å¦ç”¨stringåšå‚æ•°ï¼Ÿ</strong><br/>
switchè¯­å¥ä¸­çš„å˜é‡ç±»å‹å¯ä»¥ä½¿byteï¼Œshortï¼Œintï¼Œcharã€‚ä»jdk1.7åå¯ä»¥ä½¿ç”¨Stringç±»å‹ï¼Œæ˜¯é€šè¿‡switchä¸­çš„String.hashcodeå°†Stringè½¬æ¢æˆintè¿›è¡Œåˆ¤æ–­çš„ã€‚</p>
<p><strong>ä¸‰ã€equalsä¸==çš„åŒºåˆ«ã€‚</strong><br/>
==æ“ä½œç¬¦æ˜¯ç”¨æ¥æ¯”è¾ƒä¸¤ä¸ªå˜é‡çš„å€¼æ˜¯å¦ç›¸ç­‰ï¼Œå³å°±æ˜¯æ¯”è¾ƒå˜é‡åœ¨å†…å­˜ä¸­çš„å­˜å‚¨åœ°å€æ˜¯å¦ç›¸åŒï¼Œequalsï¼ˆï¼‰æ–¹æ³•æ—¶Stringç±»ä»Objectç±»ä¸­ç»§æ‰¿çš„ï¼Œè¢«ç”¨æ¥æ£€æµ‹ä¸¤ä¸ªå¯¹è±¡çš„å†…å®¹æ˜¯å¦ç›¸åŒã€‚</p>
<p><strong>å››ã€String s=new String(â€˜xyzâ€™);åˆ›å»ºäº†å‡ ä¸ªobjectå¯¹è±¡?</strong><br/>
ä¼šåˆ›å»ºä¸€ä¸ªStringç±»å‹çš„å˜é‡sã€‚åœ¨ç±»åŠ è½½åˆ°æ­¤å¤„ä¹‹å‰æ²¡æœ‰å‡ºç°â€œxyzâ€å­—é¢é‡çš„è¯ï¼ŒåŠ è½½æ­¤å¤„ä¼šåˆ›å»ºä¸€ä¸ªå¯¹åº”â€œxyzâ€çš„Stringå¸¸é‡å¯¹è±¡ã€‚åœ¨ç¬¦åˆè§„èŒƒçš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270136242%26content_type%3DArticle%26match_order%3D1%26q%3DJVM%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270136242&amp;content_type=Article&amp;match_order=1&amp;q=JVM&amp;zhida_source=entity" ref="nofollow noopener noreferrer">JVM</a>ä¸Šï¼Œæ‰§è¡Œåˆ°æ­¤å¤„newå…³é”®å­—ä¼šåˆ›å»ºä¸€ä¸ªStringå¯¹è±¡ã€‚</p>
<blockquote>
<p>**è¿™é‡Œä¹Ÿæ•´ç†äº†Javaæ¶æ„å­¦ä¹ èµ„æ–™ï¼Œå­¦ä¹ æŠ€æœ¯å†…å®¹åŒ…å«æœ‰ï¼šSpringï¼ŒDubboï¼ŒMyBatis, RPC,æºç åˆ†æï¼Œé«˜å¹¶å‘ã€é«˜æ€§èƒ½ã€åˆ†å¸ƒå¼,æ€§èƒ½ä¼˜åŒ–ï¼Œå¾®æœåŠ¡ é«˜çº§æ¶æ„å¼€å‘ç­‰ç­‰ã€‚æœ‰éœ€è¦çš„å¯ä»¥ç›´æ¥æ‰«ä¸€æ‰«è·å–</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0cccad521ae4c9e95692198613614b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771220819&amp;x-signature=nR9y9IG5QD2cUsWLBpCVsq5LY6I%3D" alt="736abc1217fd502b3f31018e5d5eaa2.jpg" loading="lazy"/></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d500c9fc4f04ba6b1beaa431bdcfba3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771220819&amp;x-signature=Sk204espNAGqTCI%2Fod5fHZQ15C0%3D" alt="" loading="lazy"/></p>
<p><strong>äº”ã€ Objectæœ‰å“ªäº›å…¬ç”¨æ–¹æ³•ï¼Ÿ</strong><br/>
1ã€clone()åˆ›å»ºæ–Œè¿”å›æ­¤å¯¹è±¡çš„å‰¯æœ¬<br/>
2ã€equals()åˆ¤æ–­<br/>
3ã€getclassï¼ˆï¼‰è¿”å›objectçš„è¿è¡Œç±»<br/>
4ã€hashcodeï¼ˆï¼‰è¿”å›å¯¹è±¡çš„å“ˆå¸Œç å€¼<br/>
5ã€notifyï¼ˆï¼‰å”¤é†’æ­£åœ¨ç­‰å¾…å¯¹è±¡ç›‘å¬å™¨çš„å•ä¸ªè¿›ç¨‹<br/>
6ã€notifyAllï¼ˆï¼‰å”¤é†’æ­£åœ¨ç­‰å¾…å¯¹è±¡ç›‘å¬å™¨çš„æ‰€æœ‰è¿›ç¨‹<br/>
7ã€waitï¼ˆï¼‰å¯¼è‡´å½“å‰çº¿ç¨‹ç­‰å¾…ï¼Œç›´åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨è¯¥å¯¹è±¡çš„ notify()æ–¹æ³•æˆ– notifyAll()æ–¹æ³•ã€‚<br/>
8ã€toStringï¼ˆï¼‰è¿”å›æ­¤å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼<br/>
9ã€finalizeï¼ˆï¼‰å½“åƒåœ¾æ”¶é›†ç¡®å®šä¸éœ€è¦è¯¥å¯¹è±¡æ—¶ï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270136242%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%259E%2583%25E5%259C%25BE%25E5%259B%259E%25E6%2594%25B6%25E5%2599%25A8%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270136242&amp;content_type=Article&amp;match_order=1&amp;q=%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8&amp;zhida_source=entity" ref="nofollow noopener noreferrer">åƒåœ¾å›æ”¶å™¨</a>è°ƒç”¨è¯¥æ–¹æ³•</p>
<p><strong>å…­ã€Javaçš„å››ç§å¼•ç”¨ï¼Œå¼ºå¼±è½¯è™šï¼Œç”¨åˆ°çš„åœºæ™¯ã€‚</strong><br/>
å¼ºå¼•ç”¨ï¼šåƒåœ¾å›æ”¶å™¨ä¸ä¼šå›æ”¶<br/>
è½¯å¼•ç”¨ï¼šå¦‚æœå†…å­˜ç©ºé—´è¶³å¤Ÿï¼Œåƒåœ¾å›æ”¶å™¨å°±ä¸ä¼šè¿›è¡Œå›æ”¶ï¼Œå¦‚æœå†…å­˜ç©ºé—´ä¸è¶³ï¼Œåƒåœ¾å›æ”¶å™¨å°±ä¼šè¿›è¡Œå›æ”¶<br/>
å¼±å¼•ç”¨ï¼šä¸€æ—¦å‘ç°äº†åªæœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ï¼Œåƒåœ¾å›æ”¶å™¨å°±ä¼šè¿›è¡Œå›æ”¶ã€‚<br/>
è™šå¼•ç”¨ï¼šå¦‚æœå‘ç°è¯¥å¯¹è±¡è¿˜å…·æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šåœ¨å›æ”¶è¯¥å¯¹è±¡ä¹‹å‰ï¼Œå§è¿™ä¸ªè™šå¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚</p>
<p><strong>ä¸ƒã€é™æ€å˜é‡å’Œå®ä¾‹å˜é‡çš„åŒºåˆ«ã€‚</strong><br/>
é™æ€å˜é‡å‰è¦åŠ ä¸Šå…³é”®å­—staticï¼Œå®ä¾‹å˜é‡åˆ™ä¸ä¼šã€‚<br/>
å®ä¾‹å˜é‡æ˜¯å±äºæŸä¸ªå¯¹è±¡çš„å±æ€§ï¼Œå¿…é¡»åˆ›å»ºäº†å®ä¾‹å¯¹è±¡ï¼Œå…¶ä¸­çš„å®ä¾‹å˜é‡æ‰ä¼šåˆ†é…ç©ºé—´ï¼Œæ‰èƒ½ä½¿ç”¨è¿™ä¸ªå®ä¾‹å˜é‡ã€‚é™æ€å˜é‡ä¸å±äºä»»ä½•çš„å®ä¾‹å¯¹è±¡ï¼Œè€Œæ˜¯å±äºç±»ï¼Œä¹Ÿç§°ä¸ºç±»å˜é‡ï¼Œåªè¦ç¨‹åºåŠ è½½äº†ç±»çš„å­—èŠ‚ç ï¼Œä¸ç”¨åˆ›å»ºä»»ä½•å®ä¾‹å¯¹è±¡ï¼Œå°±ä¼šè¢«åˆ†é…ç©ºé—´ã€‚æ€»ä¹‹å°±æ˜¯ï¼Œé™æ€å˜é‡ä¸éœ€è¦åˆ›å»ºä»»ä½•çš„å¯¹è±¡å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œè€Œå®ä¾‹å˜é‡éœ€è¦å…ˆåˆ›å»ºå®ä¾‹å¯¹è±¡æ‰èƒ½è¢«ä½¿ç”¨ã€‚</p>
<p><strong>å…«ã€ Overloadå’ŒOverrideçš„åŒºåˆ«ï¼š</strong><br/>
é‡è½½Overloadè¡¨ç¤ºçš„æ˜¯åŒä¸€ä¸ªç±»ä¸­å¯ä»¥æœ‰å¤šä¸ªç›¸åŒåç§°çš„æ–¹æ³•ï¼Œä½†è¿™äº›æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ä¸åŒï¼Œå³å°±æ˜¯å‚æ•°å‚æ•°æˆ–å‚æ•°ç±»å‹ä¸åŒã€‚é‡è½½æ—¶è¿”å›å€¼å½“ç„¶å¯ä»¥ä¸ä¸€æ ·ï¼Œä½†æ˜¯å¦‚æœå‚æ•°åˆ—è¡¨å®Œå…¨ä¸€è‡´æ—¶ï¼Œä¸èƒ½é€šè¿‡è¿”å›ç±»å‹ä¸ä¸€è‡´è€Œå®ç°é‡è½½ï¼Œè¿™æ˜¯ä¸å¯ä»¥çš„ã€‚<br/>
é‡å†™Overrideè¡¨ç¤ºå­ç±»ä¸­çš„æ–¹æ³•å¯ä»¥ä¸çˆ¶ç±»ä¸­çš„æ–¹æ³•åç§°å’Œå‚æ•°å®Œå…¨ç›¸åŒï¼Œé€šè¿‡å­ç±»åˆ›å»ºçš„å¯¹è±¡æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œå°†è°ƒç”¨å­ç±»ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œå³å°±æ˜¯å­ç±»ä¸­çš„è¯¥æ–¹æ³•å°†çˆ¶ç±»çš„è¯¥æ–¹æ³•è¦†ç›–äº†ã€‚å­ç±»è¦†ç›–çˆ¶ç±»æ–¹æ³•æ—¶åªèƒ½æŠ›æ¯”çˆ¶ç±»æ›´å°‘æˆ–è€…æ›´å°çš„å¼‚å¸¸ã€‚é‡å†™çš„æ–¹æ³•å…¶è¿”å›å¿…é¡»å’Œè¢«è¦†ç›–çš„æ–¹æ³•è¿”å›ä¸€è‡´ã€‚</p>
<p><strong>ä¹ã€<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270136242%26content_type%3DArticle%26match_order%3D1%26q%3D%25E6%258A%25BD%25E8%25B1%25A1%25E7%25B1%25BB%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270136242&amp;content_type=Article&amp;match_order=1&amp;q=%E6%8A%BD%E8%B1%A1%E7%B1%BB&amp;zhida_source=entity" ref="nofollow noopener noreferrer">æŠ½è±¡ç±»</a>å’Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270136242%26content_type%3DArticle%26match_order%3D1%26q%3D%25E6%258E%25A5%25E5%258F%25A3%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270136242&amp;content_type=Article&amp;match_order=1&amp;q=%E6%8E%A5%E5%8F%A3&amp;zhida_source=entity" ref="nofollow noopener noreferrer">æ¥å£</a>çš„åŒºåˆ«ã€‚</strong><br/>
æŠ½è±¡ç±»å¯ä»¥æœ‰é»˜è®¤çš„æ–¹æ³•è¿›è¡Œå®ç°ï¼Œå¯ä»¥æœ‰æ„é€ å™¨ï¼Œå¯ä»¥æœ‰mainæ–¹æ³•è¿›è¡Œè¿è¡Œï¼Œå¯ä»¥ç›´æ¥åœ¨è¯¥ç±»ä¸­æ·»åŠ å®ç°çš„æ–¹æ³•æ¥å£æ²¡æœ‰é»˜è®¤çš„æ–¹æ³•è¿›è¡Œå®ç°ï¼Œæ²¡æœ‰æ„é€ å™¨ï¼Œä¸å¯ä»¥ä½¿ç”¨mainæ–¹æ³•è¿›è¡Œè¿è¡Œï¼Œåœ¨æ¥å£ä¸­æ·»åŠ æ–¹æ³•æ—¶éœ€è¦åœ¨å…·ä½“å®ç°çš„ç±»ä¸­æ·»åŠ æ–¹æ³•ã€‚</p>
<p><strong>åã€Stringã€StringBufferä¸StringBuilderçš„åŒºåˆ«ã€‚</strong><br/>
Stringè¡¨ç¤ºå†…å®¹ä¸å¯ä¿®æ”¹çš„å­—ç¬¦ä¸²ï¼ŒStringBufferè¡¨ç¤ºå†…å®¹å¯ä»¥ä¿®æ”¹çš„å­—ç¬¦ä¸²ï¼ŒStringè¦†ç›–äº†equalsï¼ˆï¼‰æ–¹æ³•å’Œhashcodeï¼ˆï¼‰æ–¹æ³•ï¼Œè€ŒStringBufferæ²¡æœ‰è¦†ç›–ä¸¤ä¸ªæ–¹æ³•ï¼Œï¼Œæ‰€ä»¥StringBufferå¯¹è±¡å­˜å‚¨åˆ°javaé›†åˆç±»ä¸­æ—¶ä¼šå‡ºç°é—®é¢˜ã€‚<br/>
StringBuliderä¹Ÿè¡¨ç¤ºå†…å®¹å¯ä»¥ä¿®æ”¹çš„å­—ç¬¦ä¸²ï¼Œä½†æ˜¯å…¶çº¿ç¨‹æ˜¯ä¸å®‰å…¨çš„ï¼Œè¿è¡Œæ•ˆç‡é«˜ã€‚</p>
<p><strong>åä¸€ã€ Javaé¢å‘å¯¹è±¡çš„ç‰¹å¾ä¸å«ä¹‰ã€‚</strong><br/>
å°è£…ã€ç»§æ‰¿ã€æŠ½è±¡ã€<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270136242%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%25A4%259A%25E6%2580%2581%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270136242&amp;content_type=Article&amp;match_order=1&amp;q=%E5%A4%9A%E6%80%81&amp;zhida_source=entity" ref="nofollow noopener noreferrer">å¤šæ€</a><br/>
1ã€å°è£…ï¼šå°è£…çš„ç›®çš„åœ¨äºå®ç°ç¨‹åºçš„â€œé«˜å†…èšï¼Œä½è€¦åˆâ€ï¼Œé˜²æ­¢ç¨‹åºç›¸äº’ä¾èµ–è€Œå¸¦æ¥çš„å˜åŠ¨å½±å“ã€‚å°è£…æ˜¯ä¿è¯æ˜¯æŠŠå¯¹åŒä¸€äº‹ç‰©è¿›è¡Œæ“ä½œçš„æ–¹æ³•å’Œç›¸å…³çš„æ–¹æ³•æ”¾åœ¨åŒä¸€ä¸ªç±»ä¸­ï¼ŒæŠŠæ–¹æ³•å’Œä»–æ“ä½œçš„æ•°æ®æ”¾åœ¨åŒä¸€ä¸ªç±»ä¸­ã€‚<br/>
2ã€æŠ½è±¡ï¼šæŠ½è±¡å°±æ˜¯æ‰¾å‡ºäº‹ç‰©çš„ç›¸ä¼¼å’Œå…±æ€§ï¼Œç„¶åå°†è¿™äº›äº‹ç‰©å½’ä¸ºåŒä¸€ç±»ï¼Œè¿™ä¸ªç±»åªè€ƒè™‘è¿™äº›äº‹ç‰©çš„ç›¸ä¼¼å’Œå…±æ€§ï¼Œå¿½ç•¥å’Œå½“å‰ä¸»é¢˜ä¸ç›¸å…³çš„å› ç´ ã€‚<br/>
3ã€ç»§æ‰¿ï¼šå­ç±»ç»§æ‰¿çˆ¶ç±»çš„å†…å®¹ä½œä¸ºè‡ªå·±çš„å†…å®¹ï¼Œå¯ä»¥åŠ å…¥æ–°çš„å†…å®¹æˆ–è€…æ˜¯ä¿®æ”¹çˆ¶ç±»çš„å†…å®¹è€Œæ›´åŠ é€‚åˆç‰¹æ®Šçš„éœ€è¦ã€‚æé«˜äº†é¢ç¨‹åºçš„å¯é‡ç”¨æ€§å’Œå¯æ‰©å¼ æ€§ã€‚<br/>
4ã€å¤šæ€ï¼šå¤šæ€æ˜¯æŒ‡ç¨‹åºä¸­å®šä¹‰çš„å¼•ç”¨å˜é‡æ‰€æŒ‡å‘çš„å…·ä½“ç±»å‹å’Œé€šè¿‡è¯¥å¼•ç”¨å˜é‡å‘å‡ºçš„æ–¹æ³•è°ƒç”¨åœ¨ç¼–ç¨‹æ—¶å¹¶ä¸ç¡®å®šï¼Œè€Œæ˜¯åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰ç¡®å®šï¼Œå³ä¸€ä¸ªå¼•ç”¨å˜é‡å€’åº•ä¼šæŒ‡å‘å“ªä¸ªç±»çš„å®ä¾‹å¯¹è±¡ï¼Œè¯¥å¼•ç”¨å˜é‡å‘å‡ºçš„æ–¹æ³•è°ƒç”¨åˆ°åº•æ˜¯å“ªä¸ªç±»ä¸­å®ç°çš„æ–¹æ³•ï¼Œå¿…é¡»åœ¨ç”±ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½å†³å®šã€‚</p>
<p><strong>åäºŒã€javaå¤šæ€çš„å®ç°</strong><br/>
æ¥å£å®ç°ï¼Œç»§æ‰¿çˆ¶ç±»è¿›è¡Œæ–¹æ³•é‡å†™ï¼Œ<br/>
åŒä¸€ä¸ªç±»ä¸­è¿›è¡Œæ–¹æ³•é‡è½½ã€‚</p>
<p><strong>åä¸‰ã€errorå’ŒexceptionåŒºåˆ«</strong><br/>
errorè¡¨ç¤ºæœ‰å¯èƒ½æ¢å¤ä½†æ¯”è¾ƒå›°éš¾çš„çš„ä¸€ç§ä¸¥é‡é—®é¢˜ï¼Œç¨‹åºæ˜¯ä¸èƒ½è¿›è¡Œå¤„ç†çš„exceptionè¡¨ç¤ºä¸€ç§è®¾è®¡æˆ–è€…å®ç°é—®é¢˜ã€‚</p>
<p><strong>åå››ã€è¿è¡Œæ—¶å¼‚å¸¸å’Œä¸€èˆ¬å¼‚å¸¸çš„åŒºåˆ«</strong><br/>
å¼‚å¸¸è¡¨ç¤ºç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°çš„éæ­£å¸¸çŠ¶æ€ã€‚è¿è¡Œæ—¶å¼‚å¸¸è¡¨ç¤ºè™šæ‹Ÿæœºçš„é€šå¸¸æ“ä½œä¸­å¯èƒ½é‡åˆ°çš„å¼‚å¸¸ï¼Œæ˜¯ä¸€ç§å¸¸è§çš„è¿è¡Œé”™è¯¯ã€‚javaç¼–è¯‘å™¨è¦æ±‚æ–¹æ³•å¿…é¡»å£°æ˜æŠ›å‡ºå¯èƒ½å‡ºç°çš„éè¿è¡Œæ—¶å¼‚å¸¸ï¼Œä½†æ˜¯å¹¶ä¸è¦æ±‚å¿…é¡»å£°æ˜æŠ›å‡ºæœªè¢«æ•è·çš„å¼‚å¸¸</p>
<p><strong>åäº”ã€Javaä¸­çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270136242%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%25BC%2582%25E5%25B8%25B8%25E5%25A4%2584%25E7%2590%2586%25E6%259C%25BA%25E5%2588%25B6%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270136242&amp;content_type=Article&amp;match_order=1&amp;q=%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6&amp;zhida_source=entity" ref="nofollow noopener noreferrer">å¼‚å¸¸å¤„ç†æœºåˆ¶</a>å’Œç®€å•åŸç†å’Œåº”ç”¨</strong><br/>
JAVAç¨‹åºè¿åäº†JAVAçš„è¯­ä¹‰è§„åˆ™æ—¶ï¼ŒJAVAè™šæ‹Ÿæœºå°±ä¼šå°†å‘ç”Ÿçš„é”™è¯¯è¡¨ç¤ºä¸ºä¸€ä¸ªå¼‚å¸¸ã€‚è¿åè¯­ä¹‰è§„åˆ™åŒ…æ‹¬2ç§æƒ…å†µã€‚ä¸€ç§æ˜¯JAVAç±»åº“å†…ç½®çš„è¯­ä¹‰æ£€æŸ¥ã€‚ä¾‹å¦‚æ•°ç»„ä¸‹æ ‡è¶Šç•Œ,ä¼šå¼•å‘IndexOutOfBoundsException;è®¿é—®nullçš„å¯¹è±¡æ—¶ä¼šå¼•å‘ NullPointerExceptionã€‚å¦ä¸€ç§æƒ…å†µå°±æ˜¯JAVAå…è®¸ç¨‹åºå‘˜æ‰©å±•è¿™ç§è¯­ä¹‰æ£€æŸ¥ï¼Œç¨‹åºå‘˜å¯ä»¥åˆ›å»ºè‡ªå·±çš„å¼‚å¸¸ï¼Œå¹¶è‡ªç”±é€‰æ‹©åœ¨ä½•æ—¶ç”¨ throwå…³é”®å­—å¼•å‘å¼‚å¸¸ã€‚æ‰€æœ‰çš„å¼‚å¸¸éƒ½æ˜¯java.lang.Thowableçš„å­ç±»ã€‚</p>
<p><strong>åå…­ã€Javaè¯­è¨€å¦‚ä½•è¿›è¡Œå¼‚å¸¸å¤„ç†ï¼Œthrowsï¼Œthrowï¼Œtry catch finallyä»£è¡¨ä»€ä¹ˆæ„ä¹‰ï¼Œtryå—ä¸­å¯ä»¥æŠ›å‡ºå¼‚å¸¸å—?</strong><br/>
Javaé€šè¿‡é¢å‘å¯¹è±¡çš„æ–¹æ³•è¿›è¡Œå¼‚å¸¸å¤„ç†ï¼ŒæŠŠå„ç§ä¸åŒçš„å¼‚å¸¸è¿›è¡Œåˆ†ç±»ï¼Œå¹¶æä¾›äº†è‰¯å¥½çš„æ¥å£ã€‚åœ¨Javaä¸­ï¼Œæ¯ä¸ªå¼‚å¸¸éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒæ˜¯Throwableç±»æˆ–å…¶å®ƒå­ç±»çš„å®ä¾‹ã€‚å½“ä¸€ä¸ª<br/>
æ–¹æ³•å‡ºç°å¼‚å¸¸åä¾¿æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¸­åŒ…å«æœ‰å¼‚å¸¸ä¿¡æ¯ï¼Œè°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„æ–¹æ³•å¯ä»¥æ•è·åˆ°è¿™ä¸ªå¼‚å¸¸å¹¶è¿›è¡Œå¤„ç†ã€‚Javaçš„å¼‚å¸¸å¤„ç†æ˜¯é€šè¿‡5ä¸ªå…³é”®è¯æ¥å®ç°çš„ï¼štryã€catchã€throwã€throwså’Œfinallyã€‚ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ç”¨tryæ¥æ‰§è¡Œä¸€æ®µç¨‹åºï¼Œå¦‚æœå‡ºç°å¼‚å¸¸ï¼Œç³»ç»Ÿä¼šæŠ›å‡ºï¼ˆthrowsï¼‰ä¸€ä¸ªå¼‚å¸¸ï¼Œè¿™æ—¶å€™ä½ å¯ä»¥é€šè¿‡å®ƒçš„ç±»å‹æ¥æ•æ‰ï¼ˆcatchï¼‰å®ƒï¼Œæˆ–æœ€åï¼ˆfinallyï¼‰ç”±ç¼ºçœå¤„ç†å™¨æ¥å¤„ç†ã€‚<br/>
ç”¨tryæ¥æŒ‡å®šä¸€å—é¢„é˜²æ‰€æœ‰â€å¼‚å¸¸â€çš„ç¨‹åºã€‚ç´§è·Ÿåœ¨tryç¨‹åºåé¢ï¼Œåº”åŒ…å«ä¸€ä¸ªcatchå­å¥æ¥æŒ‡å®šä½ æƒ³è¦æ•æ‰çš„â€å¼‚å¸¸â€çš„ç±»å‹ã€‚<br/>
throwè¯­å¥ç”¨æ¥æ˜ç¡®åœ°æŠ›å‡ºä¸€ä¸ªâ€å¼‚å¸¸â€ã€‚<br/>
throwsç”¨æ¥æ ‡æ˜ä¸€ä¸ªæˆå‘˜å‡½æ•°å¯èƒ½æŠ›å‡ºçš„å„ç§â€å¼‚å¸¸â€ã€‚<br/>
Finallyä¸ºç¡®ä¿ä¸€æ®µä»£ç ä¸ç®¡å‘ç”Ÿä»€ä¹ˆâ€å¼‚å¸¸â€éƒ½è¢«æ‰§è¡Œä¸€æ®µä»£ç ã€‚<br/>
å¯ä»¥åœ¨ä¸€ä¸ªæˆå‘˜å‡½æ•°è°ƒç”¨çš„å¤–é¢å†™ä¸€ä¸ªtryè¯­å¥ï¼Œåœ¨è¿™ä¸ªæˆå‘˜å‡½æ•°å†…éƒ¨å†™å¦ä¸€ä¸ªtryè¯­å¥ä¿æŠ¤å…¶ä»–ä»£ç ã€‚æ¯å½“é‡åˆ°ä¸€ä¸ªtryè¯­å¥ï¼Œâ€å¼‚å¸¸â€çš„æ¡†æ¶å°±æ”¾åˆ°å †æ ˆä¸Šé¢ï¼Œç›´åˆ°æ‰€æœ‰çš„tryè¯­å¥éƒ½å®Œæˆã€‚å¦‚æœä¸‹ä¸€çº§çš„tryè¯­å¥æ²¡æœ‰å¯¹æŸç§â€å¼‚å¸¸â€è¿›è¡Œå¤„ç†ï¼Œå †æ ˆå°±ä¼šå±•å¼€ï¼Œç›´åˆ°é‡åˆ°æœ‰å¤„ç†è¿™ç§â€å¼‚å¸¸â€çš„tryè¯­å¥ã€‚</p>
<p><strong>åä¸ƒã€ try catch finallyï¼Œtryé‡Œæœ‰returnï¼Œfinallyè¿˜æ‰§è¡Œä¹ˆï¼Ÿ</strong><br/>
1ã€finallyè¯­å¥æ€»ä¼šæ‰§è¡Œ<br/>
2ã€å¦‚æœtryã€catchä¸­æœ‰returnè¯­å¥ï¼Œfinallyä¸­æ²¡æœ‰returnï¼Œé‚£ä¹ˆåœ¨finallyä¸­ä¿®æ”¹é™¤åŒ…è£…ç±»å‹å’Œé™æ€å˜é‡ã€å…¨å±€å˜é‡ä»¥å¤–çš„æ•°æ®éƒ½ä¸ä¼šå¯¹tryã€catchä¸­è¿”å›çš„å˜é‡æœ‰ä»»ä½•çš„å½±å“ï¼ˆåŒ…è£…ç±»å‹ã€é™æ€å˜é‡ä¼šæ”¹å˜ã€å…¨å±€å˜é‡ï¼‰<br/>
3ã€å°½é‡ä¸è¦åœ¨finallyä¸­ä½¿ç”¨returnè¯­å¥ï¼Œå¦‚æœä½¿ç”¨çš„è¯ï¼Œä¼šå¿½ç•¥tryã€catchä¸­çš„è¿”å›è¯­å¥ï¼Œä¹Ÿä¼šå¿½ç•¥tryã€catchä¸­çš„å¼‚å¸¸ï¼Œå±è”½äº†é”™è¯¯çš„å‘ç”Ÿã€‚<br/>
4ã€finallyä¸­é¿å…å†æ¬¡æŠ›å‡ºå¼‚å¸¸ï¼Œä¸€æ—¦finallyä¸­å‘ç”Ÿå¼‚å¸¸ï¼Œä»£ç æ‰§è¡Œå°†ä¼šæŠ›å‡ºfinallyä¸­çš„å¼‚å¸¸ä¿¡æ¯ï¼Œtryã€catchä¸­çš„å¼‚å¸¸å°†è¢«å¿½ç•¥</p>
<p><strong>åå…«ã€ Javaä¸­finalã€finallyå’Œfinalizeçš„åŒºåˆ«</strong><br/>
final ç”¨äºå£°æ˜å±æ€§ï¼Œæ–¹æ³•å’Œç±»ï¼Œåˆ†åˆ«è¡¨ç¤ºå±æ€§ä¸å¯å˜ï¼Œæ–¹æ³•ä¸å¯è¦†ç›–ï¼Œç±»ä¸å¯ç»§æ‰¿ã€‚<br/>
å†…éƒ¨ç±»è¦è®¿é—®å±€éƒ¨å˜é‡ï¼Œå±€éƒ¨å˜é‡å¿…é¡»å®šä¹‰æˆfinalç±»å‹ï¼Œä¾‹å¦‚ï¼Œä¸€æ®µä»£ç â€¦â€¦<br/>
finallyæ˜¯å¼‚å¸¸å¤„ç†è¯­å¥ç»“æ„çš„ä¸€éƒ¨åˆ†ï¼Œè¡¨ç¤ºæ€»æ˜¯æ‰§è¡Œã€‚<br/>
finalizeæ˜¯Objectç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼Œåœ¨åƒåœ¾æ”¶é›†å™¨æ‰§è¡Œçš„æ—¶å€™ä¼šè°ƒç”¨è¢«å›æ”¶å¯¹è±¡çš„æ­¤æ–¹æ³•ï¼Œå¯ä»¥è¦†ç›–æ­¤æ–¹æ³•æä¾›åƒåœ¾æ”¶é›†æ—¶çš„å…¶ä»–èµ„æºå›æ”¶ï¼Œä¾‹å¦‚å…³é—­æ–‡ä»¶ç­‰ã€‚JVMä¸ä¿è¯æ­¤æ–¹æ³•æ€»è¢«è°ƒç”¨ã€‚</p>
<p><strong>åä¹ã€ å¸¸è§çš„è¿è¡Œæ—¶å¼‚å¸¸</strong><br/>
ç³»ç»Ÿå¼‚å¸¸æ˜¯RuntimeExceptionçš„å­ç±»ï¼Œå¸¸è§çš„ç³»ç»Ÿå¼‚å¸¸æœ‰ï¼š<br/>
ArrayIndexOutOfBoundsException - æ•°ç»„è¶Šç•Œè®¿é—®<br/>
ClassCastException - ç±»å‹è½¬æ¢å¼‚å¸¸<br/>
NullPointerException - è¯•å›¾è®¿é—®ä¸€ç©ºå¯¹è±¡çš„å˜é‡ã€æ–¹æ³•æˆ–ç©ºæ•°ç»„çš„å…ƒç´ <br/>
IllegalArgumentException - æ–¹æ³•çš„å‚æ•°æ— æ•ˆ<br/>
NoClassDefFoundException - JAVAè¿è¡Œæ—¶ç³»ç»Ÿæ‰¾ä¸åˆ°æ‰€å¼•ç”¨çš„ç±»</p>
<p><strong>äºŒåã€<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270136242%26content_type%3DArticle%26match_order%3D1%26q%3DCollection%25E6%25A1%2586%25E6%259E%25B6%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270136242&amp;content_type=Article&amp;match_order=1&amp;q=Collection%E6%A1%86%E6%9E%B6&amp;zhida_source=entity" ref="nofollow noopener noreferrer">Collectionæ¡†æ¶</a>çš„ç»“æ„</strong><br/>
é›†åˆæ¡†æ¶(Collection Framework)æ³›æŒ‡java.utilåŒ…çš„è‹¥å¹²ä¸ªç±»å’Œæ¥å£.å¦‚Collection,List,ArrayList,LinkedList,Vector(è‡ªåŠ¨å¢é•¿æ•°ç»„),HashSet,HashMapç­‰ã€‚<br/>
é›†åˆæ¡†æ¶ä¸­çš„ç±»ä¸»è¦å°è£…çš„æ˜¯å…¸å‹çš„æ•°æ®ç»“æ„,å¦‚åŠ¨æ€æ•°ç»„,é“¾è¡¨,å †æ ˆ,é›†åˆ,å“ˆå¸Œè¡¨ç­‰.<br/>
é›†åˆæ¡†æ¶ç±»ä¼¼ç¼–ç¨‹ä¸­ç»å¸¸ç”¨åˆ°çš„å·¥å…·ç±»,ä½¿å¾—ç¼–ç è¿™ä¸“æ³¨äºä¸šåŠ¡å±‚çš„å®ç°,ä¸éœ€è¦ä»åº•å±‚å®ç°ç›¸å…³ç»†èŠ‚â€”â€œæ•°æ®ç»“æ„çš„å°è£…â€å’Œâ€å…¸å‹ç®—æ³•çš„å®ç°â€ã€‚</p>
<p><strong>äºŒåä¸€ã€CollectionåŒ…ç»“æ„</strong><br/>
Collectionæ˜¯é›†åˆç±»çš„ä¸Šçº§æ¥å£ï¼Œæ˜¯å•åˆ—é›†åˆã€‚ç»§æ‰¿ä»–çš„æ¥å£ä¸»è¦æœ‰Set å’ŒList.<br/>
Setæ¥å£çš„å­æ¥å£æœ‰ï¼šHashSetï¼ŒTreeSet<br/>
Listæ¥å£çš„å­æ¥å£æœ‰ï¼šArraylistï¼ŒLinkedListï¼ŒVector</p>
<p><strong>äºŒåäºŒã€Collectionä¸Collectionsçš„åŒºåˆ«ã€‚</strong><br/>
Collectionæ˜¯é›†åˆç±»çš„ä¸Šçº§æ¥å£ï¼Œç»§æ‰¿ä»–çš„æ¥å£æœ‰Setå’ŒList<br/>
Collectionsæ˜¯é’ˆå¯¹é›†åˆç±»çš„ä¸€ä¸ªå¸®åŠ©ç±»ï¼Œå®ƒæä¾›ä¸€ç³»åˆ—çš„é™æ€æ–¹æ³•å®ç°é›†åˆçš„æœç´¢ï¼Œæ’åºï¼Œçº¿ç¨‹å®‰å…¨ç­‰æ“ä½œã€‚</p>
<p><strong>äºŒåä¸‰ã€ Colectionæ¡†æ¶ä¸­å®ç°æ¯”è¾ƒè¦å®ç°ä»€ä¹ˆæ¥å£ï¼Ÿ</strong><br/>
comparableï¼šåªåŒ…å«compareToï¼ˆï¼‰æ–¹æ³•<br/>
comparatorï¼šcompareï¼ˆï¼‰å’Œequalsï¼ˆï¼‰</p>
<p><strong>äºŒåå››ã€Mapã€Setã€Listã€Queueã€Stackçš„ç‰¹ç‚¹ä¸ç”¨æ³•ã€‚</strong><br/>
1ã€Mapæ˜¯ä»¥é”®å€¼å¯¹çš„å½¢å¼è¿›è¡Œå­˜å‚¨çš„ï¼Œå…¶ä¸­keyæ˜¯å”¯ä¸€ä¸å¯é‡å¤çš„ï¼Œvalueçš„å¯ä»¥é‡å¤ï¼Œå½“æ’å…¥çš„å€¼æ˜¯keyç›¸åŒï¼ŒååŠ å…¥çš„ä¼šå°†å·²æœ‰çš„è¦†ç›–ã€‚ä»–æœ‰å‡ ä¸ªå…·ä½“çš„å®ç°ç±»ï¼ŒåŒ…æ‹¬Treemapå’ŒHashMapï¼ŒTreeMapæ˜¯æœ‰åºçš„ï¼ŒHashMapæ˜¯æ— åºçš„ã€‚<br/>
2ã€List æœ‰åºï¼Œå¯é‡å¤<br/>
|â€“ArrayList<br/>
åº•å±‚æ•°æ®ç»“æ„æ˜¯æ•°ç»„ï¼ŒæŸ¥è¯¢å¿«ï¼Œå¢åˆ æ…¢ï¼Œçº¿ç¨‹ä¸å®‰å…¨ï¼Œæ•ˆç‡é«˜<br/>
|â€“Vector<br/>
åº•å±‚æ•°æ®ç»“æ„æ˜¯æ•°ç»„ï¼ŒæŸ¥è¯¢å¿«ï¼Œå¢åˆ æ…¢ï¼Œçº¿ç¨‹ä¸å®‰å…¨ï¼Œæ•ˆç‡é«˜<br/>
|â€“LinkedList<br/>
åº•å±‚æ•°æ®ç»“æ„æ˜¯é“¾è¡¨ï¼ŒæŸ¥è¯¢æ…¢ï¼Œå¢åˆ å—ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œæ•ˆç‡ä½<br/>
3ã€Set æ— åºï¼Œå”¯ä¸€<br/>
|â€“HashSet<br/>
åº•å±‚æ•°æ®ç»“æ„æ˜¯å“ˆå¸Œè¡¨<br/>
å¦‚ä½•ä¿è¯å…ƒç´ çš„å”¯ä¸€æ€§ï¼š<br/>
ä¾èµ–ä¸¤ä¸ªæ–¹æ³•ï¼ŒhashCodeï¼ˆï¼‰å’Œequalsï¼ˆï¼‰<br/>
|â€“LinkedHashSet<br/>
åº•å±‚æ•°æ®ç»“æ„æ˜¯é“¾è¡¨å’Œå“ˆå¸Œè¡¨ï¼Œç”±é“¾è¡¨ä¿è¯å…ƒç´ æœ‰åºï¼Œç”±å“ˆå¸Œè¡¨ä¿è¯å…ƒç´ å”¯ä¸€<br/>
|â€“TreeSetåº•å±‚æ•°æ®ç»“æ„æ˜¯çº¢é»‘æ ‘ï¼Œ<br/>
å¦‚ä½•ä¿è¯å…ƒç´ çš„æ’åºï¼š<br/>
è‡ªç„¶æ’åºï¼šè®©å…ƒç´ æ‰€å±çš„ç±»å®ç°Comparableæ¥å£<br/>
æ¯”è¾ƒå™¨æ’åºï¼šè®©é›†åˆæ¥æ”¶ä¸€ä¸ªComparatorçš„å®ç°ç±»å¯¹è±¡<br/>
å¦‚ä½•ä¿è¯å…ƒç´ çš„å”¯ä¸€æ€§ï¼š<br/>
æ ¹æ®æ¯”è¾ƒçš„è¿”å›å€¼æ˜¯å¦æ˜¯0æ¥å†³å®šçš„<br/>
4ã€Queryé˜Ÿåˆ—éµå¾ªå…ˆè¿›å…ˆå‡ºçš„åŸåˆ™ï¼Œä¸å…è®¸æ’å…¥nullå€¼ï¼Œå…¶ä¸­æä¾›äº†ç›¸åº”çš„è¿›é˜Ÿå’Œå‡ºé˜Ÿçš„æ–¹æ³•ï¼Œå»ºè®®ä½¿ç”¨offerï¼ˆï¼‰æ–¹æ³•æ¥æ·»åŠ å…ƒç´ ï¼Œä½¿ç”¨pollï¼ˆï¼‰æ–¹æ³•åˆ é™¤å…ƒç´ <br/>
5ã€Stackéµä»åè¿›å…ˆå‡ºçš„åŸåˆ™ï¼Œç»§æ‰¿è‡ªVectorã€‚ä»–é€šè¿‡5ä¸ªæ“ä½œå¯¹Vectorç±»è¿›è¡Œæ‰©å±•ï¼Œå®ƒæä¾›äº†pushå’Œpopæ“ä½œï¼Œä»¥åŠå»å †æ ˆé¡¶ç‚¹çš„peekï¼ˆï¼‰æ–¹æ³•ï¼Œæµ‹è¯•å †æ ˆæ˜¯å¦ä¸ºç©ºçš„emptyæ–¹æ³•<br/>
6ã€ä½¿ç”¨æ–¹æ³•ï¼š<br/>
å¦‚æœæ¶‰åŠåˆ°å †æ ˆï¼Œé˜Ÿåˆ—ç­‰æ“ä½œï¼Œå»ºè®®ä½¿ç”¨List<br/>
å¯¹äºå¿«é€Ÿæ’å…¥å’Œåˆ é™¤å…ƒç´ å»ºè®®ä½¿ç”¨LinkedList<br/>
éœ€è¦å¿«é€Ÿéšæœºè®¿é—®å…ƒç´ å»ºè®®ä½¿ç”¨ArrayList</p>
<p><strong>äºŒåäº”ã€ Seté‡Œé¢çš„å…ƒç´ ä¸èƒ½é‡å¤ï¼Œç”¨ä»€ä¹ˆæ–¹æ³•åŒºåˆ†é‡å¤ä¸å¦ï¼Ÿ</strong><br/>
Seté‡Œçš„å…ƒç´ æ˜¯å”¯ä¸€ä¸èƒ½é‡å¤çš„ï¼Œå…ƒç´ æ˜¯å¦é‡å¤ä½¿ç”¨equalsï¼ˆï¼‰æ–¹æ³•è¿›è¡Œåˆ¤æ–­ã€‚<br/>
equalsï¼ˆï¼‰æ–¹æ³•å’Œ==æ–¹æ³•å†³å®šå¼•ç”¨å€¼æ˜¯å¦æŒ‡å‘åŒä¸€å¯¹è±¡equalsï¼ˆï¼‰åœ¨ç±»ä¸­è¢«è¦†ç›–ï¼Œä¸ºçš„æ˜¯ä¸¤ä¸ªåˆ†ç¦»çš„å¯¹è±¡çš„å†…å®¹å’Œç±»å‹ç›¸åŒ¹é…çš„è¯ï¼Œè¿”å›çœŸå€¼ã€‚</p>
<p><strong>äºŒåå…­ã€HashMapå’ŒHashtableçš„åŒºåˆ«ã€‚</strong><br/>
1ã€Hashtableæ˜¯åŸºäºDictionaryç±»çš„ï¼ŒHashMapæ˜¯Mapæ¥å£çš„ä¸€ä¸ªå®ç°ç±»<br/>
2ã€Hashtableæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå³æ˜¯åŒæ­¥çš„ï¼›HashMapçº¿ç¨‹ä¸æ˜¯å®‰å…¨çš„ï¼Œä¸æ˜¯åŒæ­¥çš„ã€‚<br/>
3ã€HashMapå¯ä»¥å°†ç©ºå€¼ä½œä¸ºkeyæˆ–value</p>
<p><strong>äºŒåä¸ƒã€ HashMapã€LinkedHashMapã€TreeMapçš„åŒºåˆ«ã€‚</strong><br/>
1ã€HashMapæ˜¯æ ¹æ®é”®çš„hashcodeå€¼å­˜å‚¨æ•°æ®ï¼Œæ ¹æ®é”®å¯ä»¥ç›´æ¥è·å–å®ƒçš„å€¼ï¼Œå…·æœ‰å¾ˆå¿«çš„è®¿é—®é€Ÿåº¦ï¼Œå–å¾—çš„æ•°æ®å®Œå…¨æ˜¯éšæœºçš„<br/>
2ã€LinkedHashMapä¿å­˜äº†è®°å½•çš„æ’å…¥é¡ºåºï¼Œåœ¨ä½¿ç”¨Iteratorè¿›è¡Œéå†çš„æ—¶å€™ï¼Œå…ˆå¾—åˆ°çš„è‚¯å®šæ˜¯å…ˆæ’å…¥çš„æ•°æ®ï¼Œå¯ä»¥åœ¨æ„é€ æ—¶å¸¦å‚æ•°ï¼ŒæŒ‰ç…§åº”ç”¨æ¬¡æ•°æ¥è¿›è¡Œæ’åº<br/>
3ã€TreeMapå®ç°SortMapæ¥å£ï¼Œèƒ½å¤ŸæŠŠå®ƒä¿å­˜çš„è®°å½•æ ¹æ®é”®æ’åºã€‚é»˜è®¤çš„æ˜¯å‡åºæ’åºï¼Œä¹Ÿå¯ä»¥æŒ‡å®šæ’åºçš„æ¯”è¾ƒå™¨ï¼Œè¿›è¡Œéå†çš„æ—¶å€™å¾—åˆ°çš„æ˜¯æ’åºè¿‡çš„è®°å½•ã€‚</p>
<p><strong>äºŒåå…«ã€HashMapã€LinkedHashMapã€ConcurrentHashMapã€ArrayListã€LinkedListçš„åº•å±‚å®ç°ã€‚</strong><br/>
1ã€HashMapæ˜¯javaæ•°æ®ç»“æ„ä¸­ä¸¤å¤§ç»“æ„æ•°ç»„å’Œé“¾è¡¨çš„ç»„åˆã€‚HashMapåº•å±‚æ•°ç»„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸€é¡¹åˆæ˜¯ä¸€ä¸ªé“¾è¡¨ã€‚ç¨‹åºä¼šå…ˆæ ¹æ®keyçš„hashcodeï¼ˆï¼‰æ–¹æ³•è¿”å›å€¼å†³å®šè¯¥Entryåœ¨æ•°ç»„ä¸­çš„<br/>
å­˜å‚¨ä½ç½®ï¼Œå¦‚æœè¯¥ä½ç½®ä¸Šæ²¡æœ‰å…ƒç´ ï¼Œå°±ä¼šå°†å…ƒç´ æ”¾ç½®åœ¨æ­¤ä½ç½®ä¸Šï¼Œå¦‚æœä¸¤ä¸ªEntryçš„keyç›¸åŒï¼Œä¼šè°ƒç”¨equalsï¼Œè¿”å›å€¼æ˜¯trueåˆ™è¦†ç›–åŸæ¥çš„valueå€¼ï¼Œè¿”å›falseåˆ™ä¼šå½¢æˆEntryé“¾ï¼Œä½äºå¤´éƒ¨ã€‚<br/>
2ã€ArrrayListçš„åº•å±‚å®ç°æ˜¯æ•°ç»„ï¼Œåœ¨æ‰§è¡Œaddæ“ä½œæ—¶ï¼Œä¼šå…ˆæ£€æŸ¥æ•°ç»„ å¤§å°æ˜¯å¦å¯ä»¥å®¹çº³æ–°çš„å…ƒç´ ï¼Œå¦‚æœä¸å¤Ÿå°±ä¼šè¿›è¡Œæ‰©å®¹ã€‚ç„¶åä¼šå°†åŸæ¥çš„æ•°æ®æ‹·è´åˆ°æ–°çš„æ•°ç»„ä¸­ã€‚<br/>
3ã€LinkedListåº•å±‚æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œå…¶å®ç°å¢åˆ æ”¹æŸ¥å’Œæ•°æ®ç»“æ„ä¸­çš„æ“ä½œå®Œå…¨ç›¸åŒï¼Œè€Œä¸”æ’å…¥æ˜¯æœ‰åºçš„ã€‚<br/>
4ã€LinkedHashMapçš„åº•å±‚ç»“æ„å¼æ˜¯åŒé“¾è¡¨ï¼Œå…¶ä»–çš„é€»è¾‘å¤„ç†ä¸HashMapä¸€è‡´ï¼ŒåŒæ ·æ²¡æœ‰é”ä¿æŠ¤ï¼Œå¤šçº¿ç¨‹ä½¿ç”¨æ—¶å­˜åœ¨é£é™©ã€‚<br/>
5ã€ConcurrentHashMapæ˜¯segmentæ•°ç»„ç»“æ„å’ŒHashEntryæ•°ç»„ç»“æ„ç»„æˆçš„ï¼Œsegmentåœ¨ConcurrentHashMapä¸­å……å½“é”çš„è§’è‰²ï¼ŒHashEntryç”¨äºå­˜å‚¨é”®å€¼å¯¹æ•°æ®ã€‚segmentçš„ç»“æ„æ˜¯æ•°ç»„å’Œé“¾è¡¨ï¼Œä¸€ä¸ªsegmentä¸­æœ‰ä¸€ä¸ªHashEntryï¼Œæ¯ä¸ªHashEntryæ˜¯ä¸€ä¸ªé“¾è¡¨ç»“æ„çš„å…ƒç´ ã€‚å¯¹HashEntryä¸­çš„æ•°æ®è¿›è¡Œä¿®æ”¹æ—¶ï¼Œéœ€è¦å…ˆè·å¾—å®ƒæ‰€å¯¹åº”çš„segmenté”ã€‚æ¯ä¸ªConcurrentHashMapé»˜è®¤æœ‰16ä¸ªsegmentã€‚</p>
<p><strong>äºŒåä¹ã€è¿­ä»£å™¨Iterator</strong><br/>
Iteratoræä¾›äº†ç»Ÿä¸€éå†æ“ä½œé›†åˆå…ƒç´ çš„ç»Ÿä¸€æ¥å£ï¼ŒCollectionæ¥å£å®ç°Iteratoræ¥å£ã€‚æ¯ä¸ªé›†åˆéƒ½é€šè¿‡å®ç°Iteratoræ¥å£ä¸­çš„iteratorï¼ˆï¼‰æ–¹æ³•è¿”å›å®ä¾‹ï¼Œç„¶åå¯¹å…ƒç´ è¿›è¡Œè¿­ä»£æ“ä½œï¼Œä½†æ˜¯åœ¨è¿­ä»£å…ƒç´ çš„æ—¶å€™ä¸èƒ½ä½¿ç”¨é›†åˆçš„æ–¹æ³•åˆ é™¤å…ƒç´ ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¯ä»¥ä½¿ç”¨Iteratoræ¥å£ä¸­çš„removeï¼ˆï¼‰æ–¹æ³•è¿›è¡Œåˆ é™¤ã€‚</p>
<p><strong>ä¸‰åã€ å¿«é€Ÿå¤±è´¥ï¼ˆfail-fastï¼‰å’Œå®‰å…¨å¤±è´¥ï¼ˆfail-safeï¼‰çš„åŒºåˆ«ã€‚</strong><br/>
Iteratorçš„å®‰å…¨å¤±è´¥æ˜¯åŸºäºå¯¹åº•å±‚é›†åˆåšæ‹·è´ï¼Œå› æ­¤å®ƒä¸å—æºé›†åˆä¿®æ”¹çš„å½±å“ã€‚utilåŒ…ä¸‹çš„æ‰€æœ‰é›†åˆç±»éƒ½æ˜¯å¿«é€Ÿå¤±è´¥çš„ï¼Œutil.concurrenåŒ…ä¸‹é¢çš„æ‰€æœ‰ç±»éƒ½æ˜¯å®‰å…¨å¤±è´¥çš„ã€‚<br/>
JavaåŸºç¡€â€”é›†åˆæ¡†æ¶/<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270136242%26content_type%3DArticle%26match_order%3D1%26q%3D%25E6%25B3%259B%25E5%259E%258B%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270136242&amp;content_type=Article&amp;match_order=1&amp;q=%E6%B3%9B%E5%9E%8B&amp;zhida_source=entity" ref="nofollow noopener noreferrer">æ³›å‹</a>/<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D270136242%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%25AE%25B9%25E5%2599%25A8%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=270136242&amp;content_type=Article&amp;match_order=1&amp;q=%E5%AE%B9%E5%99%A8&amp;zhida_source=entity" ref="nofollow noopener noreferrer">å®¹å™¨</a><br/>
<strong>æ¦‚å¿µ</strong><br/>
ä¸€ã€å®¹å™¨ï¼ˆContainerï¼‰Spring æä¾›å®¹å™¨åŠŸèƒ½ï¼Œå®¹å™¨å¯ä»¥ç®¡ç†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€å¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ XMLï¼‰ï¼Œåœ¨ä¸Šé¢å®šä¹‰å¥½å¯¹è±¡çš„åç§°ã€å¦‚ä½•äº§ç”Ÿï¼ˆPrototype æ–¹å¼æˆ– Singleton æ–¹å¼ï¼‰ã€å“ªä¸ªå¯¹è±¡äº§ç”Ÿä¹‹åå¿…é¡»è®¾å®šæˆä¸ºæŸä¸ªå¯¹è±¡çš„å±æ€§ç­‰ï¼Œåœ¨å¯åŠ¨å®¹å™¨ä¹‹åï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½å¯ä»¥ç›´æ¥å–ç”¨ï¼Œä¸ç”¨ç¼–å†™ä»»ä½•ä¸€è¡Œç¨‹åºä»£ç æ¥äº§ç”Ÿå¯¹è±¡ï¼Œæˆ–æ˜¯å»ºç«‹å¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚æ¢ä¸ªæ›´ç›´ç™½ç‚¹çš„è¯´æ˜æ–¹å¼ï¼šå®¹å™¨æ˜¯ä¸€ä¸ª Java æ‰€ç¼–å†™çš„ç¨‹åºï¼ŒåŸå…ˆå¿…é¡»è‡ªè¡Œç¼–å†™ç¨‹åºä»¥ç®¡ç†å¯¹è±¡å…³ç³»ï¼Œç°åœ¨å®¹å™¨éƒ½ä¼šè‡ªåŠ¨å¸®æ‚¨ä½œå¥½ã€‚å¸¸ç”¨å®¹å™¨ï¼šWebSphere,WebLogic,Resin,Tomcatã€‚<br/>
<strong>å®¹å™¨ç±»</strong><br/>
å®¹å™¨ç±» å…¶å®å°±æ˜¯ä¸€ç§ç”¨æ¥å­˜å‚¨æ•°æ®çš„æ•°æ®ç»“æ„ï¼Œåœ¨ JAVA ä¸­å®¹å™¨å¯åˆ†ä¸ºå³ â€œé›†åˆâ€ï¼ˆSetï¼‰ã€â€œåˆ—è¡¨â€(List)ã€â€œæ˜ å°„â€(Map)ã€‚è‡³äºï¼Œä¸ºä»€ä¹ˆéœ€è¦å®¹å™¨ï¼Œæ€»çš„æ¥è¯´ï¼Œä¸»è¦æ˜¯åœ¨ä»¥æ•°ç»„ä½œä¸ºæ•°æ®çš„å­˜å‚¨ç»“æ„ä¸­ï¼Œå…¶é•¿åº¦éš¾ä»¥æ‰©å……ï¼ŒåŒæ—¶æ•°ç»„ä¸­å…ƒç´ ç±»å‹å¿…é¡»ç›¸åŒã€‚è€Œå®¹å™¨å¯ä»¥å¼¥è¡¥æ•°ç»„çš„è¿™ä¸¤ä¸ªç¼ºé™·ã€‚<br/>
Java å®¹å™¨ç±»åŒ…å« Listã€ArrayListã€Vector åŠ mapã€HashTableã€HashMapã€‚<br/>
ArrayList å’Œ HashMap æ˜¯å¼‚æ­¥çš„ï¼ŒVector å’Œ HashTable æ˜¯åŒæ­¥çš„ï¼Œæ‰€ä»¥ Vector å’Œ HashTable æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€Œ ArrayList å’Œ HashMap å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å› ä¸ºåŒæ­¥éœ€è¦èŠ±è´¹æœºå™¨æ—¶é—´ï¼Œæ‰€ä»¥ Vector å’Œ HashTable çš„æ‰§è¡Œæ•ˆç‡è¦ä½äº ArrayList å’Œ HashMapã€‚</p>
<h2 data-id="heading-1"><strong>äºŒã€é›†åˆæ¡†æ¶çš„è¯´æ˜</strong></h2>
<p>æ‰€æœ‰é›†åˆç±»éƒ½ä½äº java.util åŒ…ä¸‹ã€‚Java çš„é›†åˆç±»ä¸»è¦ç”±ä¸¤ä¸ªæ¥å£æ´¾ç”Ÿè€Œå‡ºï¼šCollection å’Œ Mapï¼ŒCollection å’Œ Map æ˜¯ Java é›†åˆæ¡†æ¶çš„æ ¹æ¥å£ï¼Œè¿™ä¸¤ä¸ªæ¥å£åˆåŒ…å«äº†ä¸€äº›å­æ¥å£æˆ–å®ç°ç±»ã€‚<br/>
1.Setã€List å’Œ Map å¯ä»¥çœ‹åšé›†åˆçš„ä¸‰å¤§ç±»ï¼š<br/>
2.List é›†åˆæ˜¯æœ‰åºé›†åˆï¼Œé›†åˆä¸­çš„å…ƒç´ å¯ä»¥é‡å¤ï¼Œè®¿é—®é›†åˆä¸­çš„å…ƒç´ å¯ä»¥æ ¹æ®å…ƒç´ çš„ç´¢å¼•æ¥è®¿é—®ã€‚<br/>
Set é›†åˆæ˜¯æ— åºé›†åˆï¼Œé›†åˆä¸­çš„å…ƒç´ ä¸å¯ä»¥é‡å¤ï¼Œè®¿é—®é›†åˆä¸­çš„å…ƒç´ åªèƒ½æ ¹æ®å…ƒç´ æœ¬èº«æ¥è®¿é—®ï¼ˆä¹Ÿæ˜¯é›†åˆé‡Œå…ƒç´ ä¸å…è®¸é‡å¤çš„åŸå› ï¼‰ã€‚<br/>
3.Map é›†åˆä¸­ä¿å­˜ Key-value å¯¹å½¢å¼çš„å…ƒç´ ï¼Œè®¿é—®æ—¶åªèƒ½æ ¹æ®æ¯é¡¹å…ƒç´ çš„ key æ¥è®¿é—®å…¶ valueã€‚</p>
<h2 data-id="heading-2"><strong>ä¸‰ã€é›†åˆæ¡†æ¶è¯¦ç»†è¯´æ˜</strong></h2>
<p>1ã€Collection æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ˜¯é«˜åº¦æŠ½è±¡å‡ºæ¥çš„é›†åˆï¼Œå®ƒåŒ…å«äº†é›†åˆçš„åŸºæœ¬æ“ä½œå’Œå±æ€§ã€‚Collection åŒ…å«äº† List å’Œ Set ä¸¤å¤§åˆ†æ”¯ã€‚</p>
<ul>
<li>List æ˜¯ä¸€ä¸ª æœ‰åºçš„é˜Ÿåˆ—ï¼Œæ¯ä¸€ä¸ªå…ƒç´ éƒ½æœ‰å®ƒçš„ç´¢å¼•ã€‚ç¬¬ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•å€¼æ˜¯ 0ã€‚List çš„å®ç°ç±»æœ‰ LinkedList, ArrayList, Vector, Stackã€‚</li>
<li>Set æ˜¯ä¸€ä¸ªä¸å…è®¸æœ‰é‡å¤å…ƒç´ çš„é›†åˆã€‚Set çš„å®ç°ç±»æœ‰ HastSet å’Œ TreeSetã€‚ HashSet ä¾èµ–äº HashMapï¼Œå®ƒå®é™…ä¸Šæ˜¯é€šè¿‡ HashMap å®ç°çš„ï¼›TreeSet ä¾èµ–äº TreeMapï¼Œå®ƒå®é™…ä¸Šæ˜¯é€šè¿‡ TreeMap å®ç°çš„ã€‚</li>
</ul>
<p>2ã€Map æ˜¯ä¸€ä¸ªæ˜ å°„æ¥å£ï¼Œå³ key-value é”®å€¼å¯¹ã€‚Map ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ åŒ…å« â€œä¸€ä¸ª keyâ€ å’Œ â€œkey å¯¹åº”çš„ valueâ€ã€‚AbstractMap æ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒå®ç°äº† Map æ¥å£ä¸­çš„å¤§éƒ¨åˆ† APIã€‚è€Œ HashMapï¼ŒTreeMapï¼ŒWeakHashMap éƒ½æ˜¯ç»§æ‰¿äº AbstractMapã€‚Hashtable è™½ç„¶ç»§æ‰¿äº Dictionaryï¼Œä½†å®ƒå®ç°äº† Map æ¥å£ã€‚</p>
<p>3ã€æ¥ä¸‹æ¥ï¼Œå†çœ‹ Iteratorã€‚å®ƒæ˜¯éå†é›†åˆçš„å·¥å…·ï¼Œå³æˆ‘ä»¬é€šå¸¸é€šè¿‡ Iterator è¿­ä»£å™¨æ¥éå†é›†åˆã€‚æˆ‘ä»¬è¯´ Collection ä¾èµ–äºIteratorï¼Œæ˜¯å› ä¸º Collection çš„å®ç°ç±»éƒ½è¦å®ç° iterator () å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ª Iterator å¯¹è±¡ã€‚ListIterator æ˜¯ä¸“é—¨ä¸ºéå† List è€Œå­˜åœ¨çš„ã€‚</p>
<p>4ã€å†çœ‹ Enumerationï¼Œå®ƒæ˜¯ JDK 1.0 å¼•å…¥çš„æŠ½è±¡ç±»ã€‚ä½œç”¨å’Œ Iterator ä¸€æ ·ï¼Œä¹Ÿæ˜¯éå†é›†åˆï¼›ä½†æ˜¯ Enumeration çš„åŠŸèƒ½è¦æ¯” Iterator å°‘ã€‚åœ¨ä¸Šé¢çš„æ¡†å›¾ä¸­ï¼Œ Enumeration åªèƒ½åœ¨ Hashtable, Vector, Stack ä¸­ä½¿ç”¨ã€‚</p>
<p>5ã€æœ€åï¼Œçœ‹ Arrays å’Œ Collectionsã€‚å®ƒä»¬æ˜¯æ“ä½œæ•°ç»„ã€é›†åˆçš„ä¸¤ä¸ªå·¥å…·ç±»ã€‚</p>
<h2 data-id="heading-3">JavaåŸºç¡€â€”å¤šçº¿ç¨‹</h2>
<p>ä¸€ã€å¤šçº¿ç¨‹åŸºæœ¬æ¦‚å¿µ<br/>
äºŒã€çº¿ç¨‹ç›¸å…³çš„å¸¸ç”¨æ–¹æ³•<br/>
ä¸‰ã€ç»§æ‰¿Threadç±»<br/>
å››ã€å®ç°Runnable æ¥å£<br/>
äº”ã€Java åˆ†ä¸ºä¸¤ç§çº¿ç¨‹ï¼šç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹<br/>
å…­ã€ç”¨æˆ·çº¿ç¨‹å°±æ˜¯å‰å°çº¿ç¨‹ï¼Œå®ˆæŠ¤çº¿ç¨‹å°±æ˜¯åå°çº¿ç¨‹<br/>
ä¸ƒã€ä»€ä¹ˆæ˜¯å¯é‡å…¥é”ï¼Ÿ<br/>
å…«ã€Lock ä¸ synchronized çš„ä¸åŒ<br/>
ä¹ã€synchronizedçš„ä½¿ç”¨<br/>
åã€atomic åŒ…åº•å±‚å®ç°åŸç†<br/>
åä¸€ã€Lockåº•å±‚åŸç†<br/>
åäºŒã€å¤šçº¿ç¨‹ä¸å®‰å…¨çš„åº•å±‚åŸå› ä»¥åŠä¸¤ç§åŠ é”æ–¹å¼çš„åŒºåˆ«<br/>
åä¸‰ã€Javaå¤šçº¿ç¨‹ä¸­ çš„å„ç§é”<br/>
åå››ã€Javaå¤šçº¿ç¨‹ä¸­ çš„å„ç§é”ï¼ˆè¡¥å……ï¼‰<br/>
åäº”ã€é˜»å¡é˜Ÿåˆ—BlockingQueue<br/>
åå…­ã€Javaçº¿ç¨‹æ± ã€Javaçº¿ç¨‹æ± è¿›é˜¶ã€Javaä¸­çš„ThreadLocal</p>
<h2 data-id="heading-4">JavaåŸºç¡€â€”æ¡†æ¶åŸºç¡€ï¼šæ³¨è§£/åå°„/æµè¡Œæ¡†æ¶</h2>
<p>ä¸€ã€ä¼˜åŒ– Hibernate æ‰€é¼“åŠ±çš„7å¤§æªæ–½<br/>
äºŒã€åºåˆ—åŒ–å’Œååºåˆ—åŒ–<br/>
ä¸‰ã€Javaä¸­æ± çš„æ¦‚å¿µ<br/>
å››ã€Javaåå°„<br/>
äº”ã€Springçš„IOCå’ŒAOPæ¦‚å¿µå’Œå®ç°åŸç†<br/>
å…­ã€ ä»¿ç…§ Spring å®ç°ç®€å•çš„ IOC<br/>
ä¸ƒã€ä»¿ç…§ Spring å®ç°ç®€å•çš„ AOP<br/>
å…«ã€Spring bean çš„ç”Ÿå‘½æµç¨‹<br/>
ä¹ã€ä»¿å†™Spring è¿›é˜¶ä¹‹ AOPå’ŒIOCåä½œ</p>
<h2 data-id="heading-5">JavaåŸºç¡€â€”é¢å‘å¯¹è±¡ï¼šç»§æ‰¿/å¤šæ€/å°è£…</h2>
<p>ä¸€ã€é‡å†™ä¸é‡è½½<br/>
äºŒã€å•ç»§æ‰¿å’Œå¤šç»§æ‰¿<br/>
ä¸‰ã€å¤šæ€<br/>
å››ã€superå’Œthiså…³é”®å­—</p>
<h2 data-id="heading-6">JavaåŸºç¡€â€”è®¾è®¡æ¨¡å¼</h2>
<p>ä¸€ã€å•ä¾‹æ¨¡å¼ä¹‹æ‡’æ±‰å¼å’Œé¥¿æ±‰å¼<br/>
äºŒã€è®¾è®¡æ¨¡å¼ä¹‹è§‚å¯Ÿè€…æ¨¡å¼<br/>
ä¸‰ã€è®¾è®¡æ¨¡å¼ä¹‹å·¥å‚æ¨¡å¼<br/>
å››ã€è®¾è®¡æ¨¡å¼ä¹‹ä»£ç†æ¨¡å¼</p>
<h2 data-id="heading-7">JavaåŸºç¡€â€”JVM/ç±»åŠ è½½</h2>
<p>ä¸€ã€åˆå§‹åŒ–æ‰§è¡Œä»£ç é¡ºåºï¼ˆåŒ…å«staticå—å’Œæ„é€ å—ï¼‰ä»¥åŠç±»æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•<br/>
äºŒã€JVMå†…å­˜ç»“æ„<br/>
ä¸‰ã€JVMç»„æˆéƒ¨åˆ†<br/>
å››ã€ç±»åŠ è½½æœºåˆ¶<br/>
äº”ã€ç±»åŠ è½½å™¨<br/>
å…­ã€Javaç±»åŠ è½½å™¨ä¹‹é—´çš„å…³ç³»<br/>
ä¸ƒã€è™šæ‹Ÿæœºä¸­çš„å¯¹è±¡<br/>
å…«ã€è™šæ‹Ÿæœº åˆ†é…å†…å­˜<br/>
ä¹ã€Javaä¸­çš„å¼•ç”¨ç±»å‹<br/>
åã€JVMå¦‚ä½•åˆ¤æ–­æ˜¯å¦å›æ”¶å¯¹è±¡<br/>
åä¸€ã€åƒåœ¾å›æ”¶ç®—æ³•<br/>
åäºŒã€JVMè¿è¡Œæ—¶æ•°æ®åŒºåŸŸ<br/>
åä¸‰ã€JVMåƒåœ¾æ”¶é›†å™¨<br/>
åå››ã€JVMåƒåœ¾å›æ”¶<br/>
åäº”ã€Javaä¸­çš„å†…å­˜æ³„éœ²å’Œå†…å­˜æº¢å‡º</p>
<h2 data-id="heading-8">JavaåŸºç¡€â€”â€”I/O</h2>
<p>ä¸€ã€I/O åŸºæœ¬æ¦‚å¿µ<br/>
äºŒã€I/O æ¨¡å‹ â€”â€”é˜»å¡ã€éé˜»å¡ã€å¤šè·¯å¤ç”¨ã€å¼‚æ­¥<br/>
ä¸‰ã€JAVAä¸­ BIO ä¸ NIOã€AIO</p>
<h2 data-id="heading-9">ç½‘ç»œç¼–ç¨‹å’Œè®¡ç½‘</h2>
<p>ä¸€ã€Javaä¸­çš„åŸç ã€åç å’Œè¡¥ç <br/>
äºŒã€forward å’Œ redirect<br/>
ä¸‰ã€URLçš„ç»„æˆ<br/>
å››ã€é€šä¿¡çš„åŸºç¡€â€”â€”IPã€DNSã€MACåœ°å€<br/>
äº”ã€å…³äºipåœ°å€çš„ç†è§£<br/>
å…­ã€GFWï¼ˆä¸­å›½é˜²ç«é•¿åŸï¼‰å·¥ä½œåŸç†<br/>
ä¸ƒã€OSIä¸ƒå±‚æ¨¡å‹å’Œ äº”å±‚ä½“ç³»ç»“æ„<br/>
å…«ã€TCP ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹åè®®<br/>
ä¹ã€TCPåè®® ï¼ˆå¯é ä¿è¯ã€TCPã€UDPã€æ‹¥å¡ã€ARQï¼‰<br/>
åã€HTTP å’Œ HTTPS<br/>
åä¸€ã€Http/1.0ã€Http/1.1ã€Http2<br/>
åäºŒã€Https åŠ å¯†è¿‡ç¨‹è¯¦è§£<br/>
åä¸‰ã€HTTPåè®®çš„è¡¥å……ï¼ˆPOSTã€GETè¯·æ±‚æ–¹æ³•ã€å¹‚ç­‰æ€§ï¼‰<br/>
åå››ã€ç½‘ç»œæ”»å‡»ï¼ˆXSSã€CSRFï¼‰è¯¦è§£<br/>
åäº”ã€DDoS æ”»å‡»è¯¦è§£<br/>
åå…­ã€SQLæ³¨å…¥æ”»å‡»è¯¦è§£</p>
<h2 data-id="heading-10">æ•°æ®åº“</h2>
<p>ä¸€ã€ç»“æœé›† (ResultSet)å…¨é¢è§£æ<br/>
äºŒã€åŸºæœ¬æ¦‚å¿µ<br/>
ä¸‰ã€ç´¢å¼•<br/>
å››ã€äº‹åŠ¡<br/>
äº”ã€å­˜å‚¨å¼•æ“<br/>
å…­ã€æ•°æ®åº“ä¼˜åŒ–<br/>
ä¸ƒã€æ•°æ®åº“é”<br/>
å…«ã€ä¸»ä»å¤åˆ¶å’Œè¯»å†™åˆ†ç¦»</p>
<h2 data-id="heading-11">æ“ä½œç³»ç»Ÿ</h2>
<p>ä¸€ã€çº¿ç¨‹è¿›ç¨‹éƒ¨åˆ†<br/>
äºŒã€å†…å­˜å’Œä¸­æ–­<br/>
ä¸‰ã€äº’æ–¥å’ŒåŒæ­¥<br/>
å››ã€Linuxç›¸å…³å‘½ä»¤<br/>
äº”ã€Linux IO æ¨¡å¼åŠ selectã€pollã€epoll è¯¦è§£</p>
<h2 data-id="heading-12">æ•°æ®ç»“æ„</h2>
<p>ä¸€ã€é“¾è¡¨ã€æ•°ç»„ã€å­—ç¬¦ã€æ ‘ç¯‡<br/>
äºŒã€å †ã€æ ˆã€é˜Ÿåˆ—ç¯‡<br/>
ä¸‰ã€Bæ ‘ã€B+æ ‘ã€B*æ ‘<br/>
å››ã€Javaå®ç°æ’åºç®—æ³•ï¼Œæ¯”è¾ƒæ—¶é—´å¤æ‚åº¦<br/>
äº”ã€çº¢é»‘æ ‘<br/>
å…­ã€æ•°æ®ç»“æ„ä¹‹æ ˆ<br/>
ä¸ƒã€æœç´¢ä¸å›æº¯ç®—æ³•-Javaå®ç°<br/>
å…«ã€é«˜æ•ˆåˆ¤æ–­ä¸€ä¸ªæ•°ï¼Œæ˜¯ä¸æ˜¯ç´ æ•°</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python3åŸºç¡€ï¼šåŸºç¡€å®æˆ˜å·©å›ºï¼Œä»â€œä¼šç”¨â€åˆ°â€œæ´»ç”¨â€]]></title>    <link>https://juejin.cn/post/7604093823958614035</link>    <guid>https://juejin.cn/post/7604093823958614035</guid>    <pubDate>2026-02-09T04:34:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604093823958614035" data-draft-id="7604175912480800774" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python3åŸºç¡€ï¼šåŸºç¡€å®æˆ˜å·©å›ºï¼Œä»â€œä¼šç”¨â€åˆ°â€œæ´»ç”¨â€"/> <meta itemprop="keywords" content="åç«¯,Python"/> <meta itemprop="datePublished" content="2026-02-09T04:34:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ€’æ”¾å§å¾·å¾·"/> <meta itemprop="url" content="https://juejin.cn/user/2502950820787672"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python3åŸºç¡€ï¼šåŸºç¡€å®æˆ˜å·©å›ºï¼Œä»â€œä¼šç”¨â€åˆ°â€œæ´»ç”¨â€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2502950820787672/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ€’æ”¾å§å¾·å¾·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T04:34:30.000Z" title="Mon Feb 09 2026 04:34:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»23åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç¬¬ä¸ƒé˜¶æ®µï¼šåŸºç¡€å®æˆ˜å·©å›ºï¼Œä»â€œä¼šç”¨â€åˆ°â€œæ´»ç”¨â€</h2>
<blockquote>
<p>ğŸ˜„ç”Ÿå‘½ä¸æ¯ï¼Œå†™ä½œä¸æ­¢</p>
<p>ğŸ”¥ ç»§ç»­è¸ä¸Šå­¦ä¹ ä¹‹è·¯ï¼Œå­¦ä¹‹åˆ†äº«ç¬”è®°</p>
<p>ğŸ‘Š æ€»æœ‰ä¸€å¤©æˆ‘ä¹Ÿèƒ½åƒå„ä½å¤§ä½¬ä¸€æ ·</p>
<p>ğŸ† <a href="https://juejin.cn/user/2502950820787672" target="_blank" title="https://juejin.cn/user/2502950820787672">åšå®¢é¦–é¡µ</a> Â Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Flyd-code%2F" target="_blank" title="https://www.cnblogs.com/lyd-code/" ref="nofollow noopener noreferrer">@æ€’æ”¾å§å¾·å¾·</a>Â Â <a href="https://link.juejin.cn?target=https%3A%2F%2Flydandtry.github.io%2F" target="_blank" title="https://lydandtry.github.io/" ref="nofollow noopener noreferrer">Toè®°å½•é¢†åœ°</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_43843951%3Ftype%3Dblog" target="_blank" title="https://blog.csdn.net/qq_43843951?type=blog" ref="nofollow noopener noreferrer">@ä¸€ä¸ªæœ‰æ¢¦æœ‰æˆçš„äºº</a></p>
<p>ğŸŒåˆ†äº«å­¦ä¹ å¿ƒå¾—ï¼Œæ¬¢è¿æŒ‡æ­£ï¼Œå¤§å®¶ä¸€èµ·å­¦ä¹ æˆé•¿ï¼</p>
<p>ğŸ”¥è±†åŒ…AI</p>
</blockquote>
<p><em>è½¬å‘è¯·æºå¸¦ä½œè€…ä¿¡æ¯</em>Â  <strong>@æ€’æ”¾å§å¾·å¾·(æ˜é‡‘) @ä¸€ä¸ªæœ‰æ¢¦æœ‰æˆçš„äºº(CSDN)</strong></p>
<h3 data-id="heading-1">å‰è¨€</h3>
<p>æ­å–œå¤§å®¶æˆåŠŸé€šå…³Python3åŸºç¡€å­¦ä¹ ç¬¬å…­é˜¶æ®µã€Œè¿›é˜¶åŸºç¡€ã€ï¼åœ¨ç¬¬å…­é˜¶æ®µï¼Œæˆ‘ä»¬æŒæ¡äº†æ¨¡å—ä¸åŒ…ã€æ–‡ä»¶æ“ä½œã€å¼‚å¸¸å¤„ç†ã€é¢å‘å¯¹è±¡åŸºç¡€å››å¤§æ ¸å¿ƒæŠ€èƒ½ï¼Œç»ˆäºè·³å‡ºäº†â€œå•çº¯è®°è¯­æ³•â€çš„èŒƒç•´ï¼Œå…·å¤‡äº†ç¼–å†™æ¨¡å—åŒ–ã€å¥å£®æ€§ä»£ç çš„èƒ½åŠ›ã€‚</p>
<p>è€Œç¬¬ä¸ƒé˜¶æ®µã€ŒåŸºç¡€å®æˆ˜å·©å›ºã€ï¼Œæ˜¯PythonåŸºç¡€å­¦ä¹ ä¸­â€œæ‰¿ä¸Šå¯ä¸‹â€çš„å…³é”®ä¸€ç¯â€”â€”æ ¸å¿ƒç›®æ ‡ä¸æ˜¯å­¦ä¹ æ–°çš„å¤æ‚è¯­æ³•ï¼Œè€Œæ˜¯<strong>å°†å‰å…­é˜¶æ®µçš„æ‰€æœ‰çŸ¥è¯†ç‚¹ä¸²è”èµ·æ¥ï¼Œé€šè¿‡å®æˆ˜åœºæ™¯è½åœ°åº”ç”¨</strong>ï¼Œå¸®å¤§å®¶æ‘†è„±â€œçœ‹å¾—æ‡‚ã€å†™ä¸å‡ºâ€çš„å›°å¢ƒï¼Œå·©å›ºåŸºç¡€ã€æŸ¥æ¼è¡¥ç¼ºï¼ŒåŒæ—¶æŒæ¡å¸¸ç”¨å·¥å…·ï¼ˆå†…ç½®å‡½æ•°ã€æ ‡å‡†åº“ï¼‰å’ŒåŸºç¡€å¹¶å‘/ç½‘ç»œèƒ½åŠ›ï¼Œä¸ºåç»­å­¦ä¹ å¤æ‚é¡¹ç›®ã€æ¡†æ¶æ‰“ä¸‹åšå®çš„å®æˆ˜åŸºç¡€ã€‚</p>
<p>æœ¬é˜¶æ®µæˆ‘ä»¬å°†èšç„¦å››å¤§å®æˆ˜æ–¹å‘ï¼Œå…¨ç¨‹å›´ç»•â€œå®æˆ˜åœºæ™¯+å¯è¿è¡Œä»£ç +é¿å‘å®æˆ˜â€å±•å¼€ï¼Œæ¯ä¸ªçŸ¥è¯†ç‚¹éƒ½ç»“åˆå‰é˜¶æ®µå†…å®¹è®¾è®¡å®æˆ˜æ¡ˆä¾‹ï¼Œè·Ÿç€æ•²ä»£ç ã€ç»ƒæ¡ˆä¾‹ï¼Œæ—¢èƒ½å·©å›ºæ—§çŸ¥è¯†ï¼Œåˆèƒ½æŒæ¡æ–°å·¥å…·ï¼ŒçœŸæ­£å®ç°ä»â€œä¼šç”¨â€åˆ°â€œæ´»ç”¨â€çš„è·¨è¶Šï¼Œç¨³æ­¥å‘â€œèƒ½ç‹¬ç«‹ç¼–å†™ç®€å•é¡¹ç›®çš„Pythonåˆå­¦è€…â€è¿ˆè¿›ï½</p>
<h3 data-id="heading-2">1 å¸¸ç”¨å†…ç½®å‡½æ•°ï¼šPythonè‡ªå¸¦çš„â€œå®ç”¨å·¥å…·â€ï¼Œæå‡ç¼–ç æ•ˆç‡</h3>
<p>åœ¨å‰é¢çš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬å…¶å®å·²ç»é›¶æ•£ç”¨åˆ°è¿‡ä¸€äº›å†…ç½®å‡½æ•°ï¼ˆæ¯”å¦‚print()ã€input()ï¼‰ï¼Œä½†Pythonè‡ªå¸¦äº†å¤§é‡æ— éœ€å¯¼å…¥ã€ç›´æ¥å¯ç”¨çš„å†…ç½®å‡½æ•°ï¼Œå®ƒä»¬å°±åƒâ€œç°æˆçš„å·¥å…·â€ï¼Œèƒ½å¸®æˆ‘ä»¬å¿«é€Ÿè§£å†³å¸¸è§é—®é¢˜ï¼ˆæ¯”å¦‚è®¡ç®—é•¿åº¦ã€ç”Ÿæˆåºåˆ—ã€ç­›é€‰æ•°æ®ï¼‰ï¼Œé¿å…é‡å¤ç¼–å†™ä»£ç ã€‚</p>
<p>æœ¬é˜¶æ®µé‡ç‚¹æŒæ¡8ä¸ªé«˜é¢‘å®ç”¨çš„å†…ç½®å‡½æ•°ï¼Œè¦†ç›–æ—¥å¸¸ç¼–ç 80%çš„åœºæ™¯ï¼Œç»“åˆå®æˆ˜æ¡ˆä¾‹è®²è§£ï¼Œé‡ç‚¹ç†è§£â€œä»€ä¹ˆæ—¶å€™ç”¨ã€æ€ä¹ˆç”¨â€ï¼Œè€Œéæ­»è®°ç¡¬èƒŒã€‚</p>
<h4 data-id="heading-3">1.1 æ ¸å¿ƒå†…ç½®å‡½æ•°</h4>
<p>æ¯ä¸ªå‡½æ•°å‡æ­é…â€œè¯­æ³•è§£æ+å®æˆ˜ä»£ç +åœºæ™¯è¯´æ˜â€ï¼Œä»£ç å¯ç›´æ¥å¤åˆ¶è¿è¡Œï¼Œè´´åˆæ–°æ‰‹å®æˆ˜éœ€æ±‚ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 1. len()ï¼šè®¡ç®—å¯è¿­ä»£å¯¹è±¡çš„é•¿åº¦ï¼ˆå­—ç¬¦ä¸²ã€åˆ—è¡¨ã€å­—å…¸ã€å…ƒç»„ç­‰ï¼‰</span>
<span class="hljs-comment"># å®æˆ˜åœºæ™¯ï¼šç»Ÿè®¡ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦æ•°ã€åˆ—è¡¨ä¸­å…ƒç´ ä¸ªæ•°</span>
str1 = <span class="hljs-built_in">input</span>(<span class="hljs-string">"è¯·è¾“å…¥ä¸€æ®µæ–‡å­—ï¼š"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"è¾“å…¥æ–‡å­—çš„é•¿åº¦ï¼ˆå«ç©ºæ ¼ï¼‰ï¼š<span class="hljs-subst">{<span class="hljs-built_in">len</span>(str1)}</span>"</span>)

list1 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-string">"Python"</span>, [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>]]
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"åˆ—è¡¨çš„å…ƒç´ ä¸ªæ•°ï¼š<span class="hljs-subst">{<span class="hljs-built_in">len</span>(list1)}</span>"</span>)  <span class="hljs-comment"># è¾“å‡º5ï¼ˆåµŒå¥—åˆ—è¡¨ç®—1ä¸ªå…ƒç´ ï¼‰</span>

dict1 = {<span class="hljs-string">"name"</span>: <span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-string">"age"</span>: <span class="hljs-number">18</span>, <span class="hljs-string">"gender"</span>: <span class="hljs-string">"ç”·"</span>}
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"å­—å…¸çš„é”®å€¼å¯¹ä¸ªæ•°ï¼š<span class="hljs-subst">{<span class="hljs-built_in">len</span>(dict1)}</span>"</span>)  <span class="hljs-comment"># è¾“å‡º3</span>

<span class="hljs-comment"># 2. range()ï¼šç”ŸæˆæŒ‡å®šèŒƒå›´çš„æ•´æ•°åºåˆ—ï¼ˆå·¦é—­å³å¼€ï¼‰</span>
<span class="hljs-comment"># å®æˆ˜åœºæ™¯ï¼šé…åˆforå¾ªç¯å®ç°å›ºå®šæ¬¡æ•°çš„è¿­ä»£ï¼ˆæ›¿ä»£æ‰‹åŠ¨å†™åˆ—è¡¨ï¼‰</span>
<span class="hljs-comment"># è¯­æ³•ï¼šrange(å¼€å§‹å€¼, ç»“æŸå€¼, æ­¥é•¿)ï¼Œå¼€å§‹å€¼é»˜è®¤0ï¼Œæ­¥é•¿é»˜è®¤1</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"ç”Ÿæˆ0-9çš„æ•´æ•°ï¼š"</span>, <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>)))  <span class="hljs-comment"># è¾“å‡º[0,1,2,...,9]</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"ç”Ÿæˆ1-10çš„æ•´æ•°ï¼š"</span>, <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>)))  <span class="hljs-comment"># è¾“å‡º[1,2,...,10]</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"ç”Ÿæˆ1-10çš„å¥‡æ•°ï¼š"</span>, <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>, <span class="hljs-number">2</span>)))  <span class="hljs-comment"># æ­¥é•¿2ï¼Œè¾“å‡º[1,3,...,9]</span>

<span class="hljs-comment"># å®æˆ˜ï¼šç”¨range()å¾ªç¯æ‰“å°1-5çš„å¹³æ–¹ï¼ˆç»“åˆå‰é˜¶æ®µçš„å¾ªç¯ã€å‡½æ•°ï¼‰</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">6</span>):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{i}</span>çš„å¹³æ–¹ï¼š<span class="hljs-subst">{i**<span class="hljs-number">2</span>}</span>"</span>)

<span class="hljs-comment"># 3. enumerate()ï¼šéå†å¯è¿­ä»£å¯¹è±¡æ—¶ï¼ŒåŒæ—¶è·å–ç´¢å¼•å’Œå¯¹åº”çš„å€¼</span>
<span class="hljs-comment"># å®æˆ˜åœºæ™¯ï¼šéå†åˆ—è¡¨/å…ƒç»„æ—¶ï¼Œéœ€è¦çŸ¥é“å…ƒç´ çš„ä½ç½®ï¼ˆé¿å…æ‰‹åŠ¨å®šä¹‰ç´¢å¼•å˜é‡ï¼‰</span>
<span class="hljs-comment"># è¯­æ³•ï¼šenumerate(å¯è¿­ä»£å¯¹è±¡, start=èµ·å§‹ç´¢å¼•)ï¼Œstarté»˜è®¤0</span>
fruits = [<span class="hljs-string">"è‹¹æœ"</span>, <span class="hljs-string">"é¦™è•‰"</span>, <span class="hljs-string">"æ©™å­"</span>, <span class="hljs-string">"è‘¡è„"</span>]
<span class="hljs-comment"># é»˜è®¤start=0ï¼Œç´¢å¼•ä»0å¼€å§‹</span>
<span class="hljs-keyword">for</span> index, value <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(fruits):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç´¢å¼•<span class="hljs-subst">{index}</span>ï¼š<span class="hljs-subst">{value}</span>"</span>)
<span class="hljs-comment"># start=1ï¼Œç´¢å¼•ä»1å¼€å§‹ï¼ˆé€‚åˆè®¡æ•°åœºæ™¯ï¼‰</span>
<span class="hljs-keyword">for</span> index, value <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(fruits, start=<span class="hljs-number">1</span>):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç¬¬<span class="hljs-subst">{index}</span>ä¸ªæ°´æœï¼š<span class="hljs-subst">{value}</span>"</span>)

<span class="hljs-comment"># 4. zip()ï¼šå°†å¤šä¸ªå¯è¿­ä»£å¯¹è±¡ï¼ˆåˆ—è¡¨ã€å…ƒç»„ç­‰ï¼‰â€œé…å¯¹â€ï¼Œåˆå¹¶æˆä¸€ä¸ªè¿­ä»£å™¨</span>
<span class="hljs-comment"># å®æˆ˜åœºæ™¯ï¼šæ‰¹é‡å¤„ç†å¤šç»„å…³è”æ•°æ®ï¼ˆæ¯”å¦‚å§“åå’Œå¹´é¾„ã€å­¦å·å’Œæˆç»©ï¼‰</span>
names = [<span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-string">"æå››"</span>, <span class="hljs-string">"ç‹äº”"</span>]
ages = [<span class="hljs-number">18</span>, <span class="hljs-number">19</span>, <span class="hljs-number">20</span>]
scores = [<span class="hljs-number">90</span>, <span class="hljs-number">85</span>, <span class="hljs-number">95</span>]

<span class="hljs-comment"># é…å¯¹å¤šä¸ªåˆ—è¡¨ï¼Œéå†è·å–å…³è”æ•°æ®</span>
<span class="hljs-keyword">for</span> name, age, score <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(names, ages, scores):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å§“åï¼š<span class="hljs-subst">{name}</span>ï¼Œå¹´é¾„ï¼š<span class="hljs-subst">{age}</span>ï¼Œæˆç»©ï¼š<span class="hljs-subst">{score}</span>"</span>)

<span class="hljs-comment"># è¡¥å……ï¼šzip()è¿”å›çš„æ˜¯è¿­ä»£å™¨ï¼Œå¯è½¬æ¢ä¸ºåˆ—è¡¨æŸ¥çœ‹</span>
zip_result = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">zip</span>(names, ages))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"zipé…å¯¹ç»“æœï¼š"</span>, zip_result)  <span class="hljs-comment"># è¾“å‡º[('å¼ ä¸‰',18), ('æå››',19), ('ç‹äº”',20)]</span>

<span class="hljs-comment"># 5. sorted()ï¼šå¯¹å¯è¿­ä»£å¯¹è±¡è¿›è¡Œæ’åºï¼Œè¿”å›æ’åºåçš„æ–°åˆ—è¡¨ï¼ˆä¸æ”¹å˜åŸå¯¹è±¡ï¼‰</span>
<span class="hljs-comment"># å®æˆ˜åœºæ™¯ï¼šå¯¹åˆ—è¡¨ã€å…ƒç»„ã€å­—å…¸çš„å€¼è¿›è¡Œæ’åº</span>
nums = [<span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">5</span>]
sorted_nums = <span class="hljs-built_in">sorted</span>(nums)  <span class="hljs-comment"># é»˜è®¤å‡åº</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"å‡åºæ’åºï¼š"</span>, sorted_nums)  <span class="hljs-comment"># è¾“å‡º[1,2,3,4,5]</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"åŸåˆ—è¡¨ï¼ˆæœªæ”¹å˜ï¼‰ï¼š"</span>, nums)  <span class="hljs-comment"># è¾“å‡º[3,1,4,2,5]</span>

<span class="hljs-comment"># é™åºæ’åºï¼ŒæŒ‡å®šreverse=True</span>
sorted_nums_desc = <span class="hljs-built_in">sorted</span>(nums, reverse=<span class="hljs-literal">True</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"é™åºæ’åºï¼š"</span>, sorted_nums_desc)

<span class="hljs-comment"># å®æˆ˜ï¼šå¯¹å­—å…¸æŒ‰å€¼æ’åºï¼ˆç»“åˆå‰é˜¶æ®µçš„å­—å…¸çŸ¥è¯†ï¼‰</span>
score_dict = {<span class="hljs-string">"å¼ ä¸‰"</span>: <span class="hljs-number">90</span>, <span class="hljs-string">"æå››"</span>: <span class="hljs-number">85</span>, <span class="hljs-string">"ç‹äº”"</span>: <span class="hljs-number">95</span>}
<span class="hljs-comment"># æŒ‰æˆç»©å‡åºæ’åºï¼Œè¿”å›åŒ…å«å…ƒç»„çš„åˆ—è¡¨</span>
sorted_score = <span class="hljs-built_in">sorted</span>(score_dict.items(), key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>])
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æŒ‰æˆç»©å‡åºæ’åºï¼š"</span>, sorted_score)

<span class="hljs-comment"># 6. map()ï¼šå¯¹å¯è¿­ä»£å¯¹è±¡çš„æ¯ä¸ªå…ƒç´ ï¼Œåº”ç”¨æŒ‡å®šå‡½æ•°ï¼Œè¿”å›è¿­ä»£å™¨</span>
<span class="hljs-comment"># å®æˆ˜åœºæ™¯ï¼šæ‰¹é‡å¤„ç†æ•°æ®ï¼ˆæ¯”å¦‚æ‰€æœ‰å…ƒç´ å¹³æ–¹ã€è½¬æ¢æ•°æ®ç±»å‹ï¼‰</span>
<span class="hljs-comment"># ç¤ºä¾‹1ï¼šå°†åˆ—è¡¨ä¸­æ‰€æœ‰æ•´æ•°è½¬æ¢ä¸ºå­—ç¬¦ä¸²</span>
nums = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]
str_nums = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">str</span>, nums))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æ•´æ•°è½¬å­—ç¬¦ä¸²ï¼š"</span>, str_nums)  <span class="hljs-comment"># è¾“å‡º['1','2','3','4','5']</span>

<span class="hljs-comment"># ç¤ºä¾‹2ï¼šè®¡ç®—åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ çš„å¹³æ–¹ï¼ˆç»“åˆlambdaåŒ¿åå‡½æ•°ï¼‰</span>
square_nums = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x: x**<span class="hljs-number">2</span>, nums))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æ‰€æœ‰å…ƒç´ å¹³æ–¹ï¼š"</span>, square_nums)  <span class="hljs-comment"># è¾“å‡º[1,4,9,16,25]</span>

<span class="hljs-comment"># 7. filter()ï¼šå¯¹å¯è¿­ä»£å¯¹è±¡çš„å…ƒç´ è¿›è¡Œç­›é€‰ï¼Œä¿ç•™ç¬¦åˆæ¡ä»¶çš„å…ƒç´ </span>
<span class="hljs-comment"># å®æˆ˜åœºæ™¯ï¼šç­›é€‰ç¬¦åˆè¦æ±‚çš„æ•°æ®ï¼ˆæ¯”å¦‚ç­›é€‰å¶æ•°ã€ç­›é€‰å¤§äºæŸä¸ªå€¼çš„å…ƒç´ ï¼‰</span>
<span class="hljs-comment"># ç¤ºä¾‹1ï¼šç­›é€‰åˆ—è¡¨ä¸­çš„å¶æ•°</span>
nums = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]
even_nums = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> x: x % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>, nums))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"ç­›é€‰å¶æ•°ï¼š"</span>, even_nums)  <span class="hljs-comment"># è¾“å‡º[2,4,6]</span>

<span class="hljs-comment"># ç¤ºä¾‹2ï¼šç­›é€‰åˆ—è¡¨ä¸­å¤§äº3çš„å…ƒç´ </span>
greater_3 = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> x: x &gt; <span class="hljs-number">3</span>, nums))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"ç­›é€‰å¤§äº3çš„å…ƒç´ ï¼š"</span>, greater_3)  <span class="hljs-comment"># è¾“å‡º[4,5,6]</span>

<span class="hljs-comment"># 8. abs()ï¼šè¿”å›æ•°å­—çš„ç»å¯¹å€¼</span>
<span class="hljs-comment"># å®æˆ˜åœºæ™¯ï¼šå¤„ç†è´Ÿæ•°ï¼ˆæ¯”å¦‚è®¡ç®—è·ç¦»ã€è¯¯å·®ï¼Œç»å¯¹å€¼é¿å…è´Ÿå·å½±å“ï¼‰</span>
num1 = -<span class="hljs-number">5</span>
num2 = <span class="hljs-number">3.14</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"-5çš„ç»å¯¹å€¼ï¼š<span class="hljs-subst">{<span class="hljs-built_in">abs</span>(num1)}</span>"</span>)  <span class="hljs-comment"># è¾“å‡º5</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"3.14çš„ç»å¯¹å€¼ï¼š<span class="hljs-subst">{<span class="hljs-built_in">abs</span>(num2)}</span>"</span>)  <span class="hljs-comment"># è¾“å‡º3.14</span>
</code></pre>
<h4 data-id="heading-4">1.2 æ–°æ‰‹é¿å‘æŒ‡å—</h4>
<ul>
<li>é¿å‘1ï¼šlen()è®¡ç®—åµŒå¥—åˆ—è¡¨æ—¶ï¼ŒåµŒå¥—çš„å­åˆ—è¡¨ç®—â€œ1ä¸ªå…ƒç´ â€ï¼Œä¸ä¼šé€’å½’è®¡ç®—å­åˆ—è¡¨å†…éƒ¨çš„é•¿åº¦ï¼›</li>
<li>é¿å‘2ï¼šrange()æ˜¯â€œå·¦é—­å³å¼€â€åŒºé—´ï¼Œæ¯”å¦‚range(1, 10)ç”Ÿæˆ1-9çš„æ•´æ•°ï¼Œä¸ä¼šåŒ…å«10ï¼›æ­¥é•¿ä¸ºè´Ÿæ•°æ—¶ï¼Œå¼€å§‹å€¼è¦å¤§äºç»“æŸå€¼ï¼ˆæ¯”å¦‚range(10, 0, -1)ç”Ÿæˆ10-1ï¼‰ï¼›</li>
<li>é¿å‘3ï¼šenumerate()çš„startå‚æ•°åªæ˜¯â€œä¿®æ”¹ç´¢å¼•çš„æ˜¾ç¤ºå€¼â€ï¼Œä¸ä¼šæ”¹å˜å…ƒç´ æœ¬èº«çš„ä½ç½®ï¼›</li>
<li>é¿å‘4ï¼šzip()ä¼šä»¥â€œæœ€çŸ­çš„å¯è¿­ä»£å¯¹è±¡â€ä¸ºå‡†é…å¯¹ï¼Œå¤šä½™çš„å…ƒç´ ä¼šè¢«èˆå¼ƒï¼ˆæ¯”å¦‚3ä¸ªå§“åã€2ä¸ªå¹´é¾„ï¼Œä¼šåªé…å¯¹å‰2ç»„ï¼‰ï¼›ä¸”zip()è¿”å›çš„è¿­ä»£å™¨åªèƒ½éå†ä¸€æ¬¡ï¼Œå†æ¬¡éå†ä¼šä¸ºç©ºï¼›</li>
<li>é¿å‘5ï¼šsorted()ä¼šè¿”å›æ–°åˆ—è¡¨ï¼Œä¸ä¼šä¿®æ”¹åŸå¯¹è±¡ï¼›è€Œåˆ—è¡¨è‡ªå¸¦çš„sort()æ–¹æ³•ä¼šä¿®æ”¹åŸåˆ—è¡¨ï¼Œæ— è¿”å›å€¼ï¼ˆæ–°æ‰‹æ˜“æ··æ·†ä¸¤è€…ï¼‰ï¼›</li>
<li>é¿å‘6ï¼šmap()å’Œfilter()è¿”å›çš„æ˜¯è¿­ä»£å™¨ï¼Œéœ€è½¬æ¢ä¸ºåˆ—è¡¨ï¼ˆlist()ï¼‰æ‰èƒ½ç›´è§‚æŸ¥çœ‹ç»“æœã€‚</li>
</ul>
<h3 data-id="heading-5">2 ç®€å•æ ‡å‡†åº“ä½¿ç”¨ï¼šæ´»ç”¨Pythonè‡ªå¸¦â€œå·¥å…·åŒ…â€ï¼Œé«˜æ•ˆç¼–ç </h3>
<p>åœ¨ç¬¬å…­é˜¶æ®µï¼Œæˆ‘ä»¬å­¦ä¹ äº†æ¨¡å—ä¸åŒ…çš„åŸºç¡€ç”¨æ³•ï¼Œè€ŒPythonè‡ªå¸¦çš„â€œæ ‡å‡†åº“â€ï¼Œå°±æ˜¯ä¸€ç»„å®˜æ–¹ç¼–å†™çš„ã€æ— éœ€é¢å¤–å®‰è£…çš„å®ç”¨æ¨¡å—é›†åˆã€‚å®ƒä»¬è¦†ç›–äº†æ•°å­¦è®¡ç®—ã€éšæœºæ•°ç”Ÿæˆã€æ—¶é—´å¤„ç†ç­‰å¸¸è§åœºæ™¯ï¼Œç†Ÿç»ƒä½¿ç”¨è¿™äº›æ ‡å‡†åº“ï¼Œèƒ½å¤§å¹…æå‡ç¼–ç æ•ˆç‡ï¼Œé¿å…é‡å¤é€ è½®å­ã€‚</p>
<p>æœ¬é˜¶æ®µé‡ç‚¹æŒæ¡3ä¸ªæœ€å¸¸ç”¨çš„æ ‡å‡†åº“ï¼ˆmathã€randomã€timeï¼‰ï¼Œç»“åˆå®æˆ˜åœºæ™¯è®²è§£æ ¸å¿ƒç”¨æ³•ï¼Œä¸æ·±å…¥å¤æ‚åŠŸèƒ½ï¼Œèšç„¦â€œæ–°æ‰‹èƒ½å¿«é€Ÿä¸Šæ‰‹ã€æ—¥å¸¸èƒ½ç”¨å¾—ä¸Šâ€çš„çŸ¥è¯†ç‚¹ã€‚</p>
<h4 data-id="heading-6">2.1 mathåº“ï¼šæ•°å­¦è®¡ç®—å·¥å…·ï¼Œè§£å†³åŸºç¡€æ•°å­¦é—®é¢˜</h4>
<p>mathåº“æä¾›äº†å¤§é‡åŸºç¡€æ•°å­¦è¿ç®—å‡½æ•°ï¼ˆå¦‚åœ†å‘¨ç‡ã€ä¸‰è§’å‡½æ•°ã€å–æ•´ã€å¼€å¹³æ–¹ç­‰ï¼‰ï¼Œé€‚åˆè§£å†³æ—¥å¸¸ç¼–ç¨‹ä¸­çš„æ•°å­¦è®¡ç®—åœºæ™¯ï¼Œæ ¸å¿ƒç”¨æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> math  <span class="hljs-comment"># å¯¼å…¥mathåº“ï¼ˆæ— éœ€å®‰è£…ï¼Œç›´æ¥å¯¼å…¥ï¼‰</span>

<span class="hljs-comment"># 1. å¸¸ç”¨å¸¸é‡ï¼ˆå®æˆ˜å¸¸ç”¨ï¼‰</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"åœ†å‘¨ç‡Ï€ï¼š"</span>, math.pi)  <span class="hljs-comment"># è¾“å‡º3.141592653589793</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"è‡ªç„¶å¸¸æ•°eï¼š"</span>, math.e)  <span class="hljs-comment"># è¾“å‡º2.718281828459045</span>

<span class="hljs-comment"># 2. åŸºç¡€è¿ç®—ï¼ˆå®æˆ˜é‡ç‚¹ï¼‰</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"16çš„å¹³æ–¹æ ¹ï¼š"</span>, math.sqrt(<span class="hljs-number">16</span>))  <span class="hljs-comment"># è¾“å‡º4.0ï¼ˆå¼€å¹³æ–¹ï¼‰</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"2çš„3æ¬¡æ–¹ï¼š"</span>, math.<span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>))  <span class="hljs-comment"># è¾“å‡º8.0ï¼ˆå¹‚è¿ç®—ï¼Œç­‰åŒäº2**3ï¼‰</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"ç»å¯¹å€¼ï¼š"</span>, math.fabs(-<span class="hljs-number">5.2</span>))  <span class="hljs-comment"># è¾“å‡º5.2ï¼ˆç»å¯¹å€¼ï¼Œæ¯”abs()æ›´é€‚åˆæµ®ç‚¹æ•°ï¼‰</span>

<span class="hljs-comment"># 3. å–æ•´å‡½æ•°ï¼ˆæ–°æ‰‹æ˜“æ··æ·†ï¼Œé‡ç‚¹åŒºåˆ†ï¼‰</span>
num = <span class="hljs-number">3.7</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"å‘ä¸‹å–æ•´ï¼ˆ&lt;=3.7çš„æœ€å¤§æ•´æ•°ï¼‰ï¼š"</span>, math.floor(num))  <span class="hljs-comment"># è¾“å‡º3</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"å‘ä¸Šå–æ•´ï¼ˆ&gt;=3.7çš„æœ€å°æ•´æ•°ï¼‰ï¼š"</span>, math.ceil(num))  <span class="hljs-comment"># è¾“å‡º4</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"å››èˆäº”å…¥ï¼ˆä¿ç•™æ•´æ•°ï¼‰ï¼š"</span>, <span class="hljs-built_in">round</span>(num))  <span class="hljs-comment"># è¾“å‡º4ï¼ˆroundæ˜¯å†…ç½®å‡½æ•°ï¼Œémathåº“ï¼‰</span>

num2 = <span class="hljs-number">3.1</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"å‘ä¸‹å–æ•´ï¼š"</span>, math.floor(num2))  <span class="hljs-comment"># è¾“å‡º3</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"å‘ä¸Šå–æ•´ï¼š"</span>, math.ceil(num2))  <span class="hljs-comment"># è¾“å‡º4</span>

<span class="hljs-comment"># 4. å®æˆ˜æ¡ˆä¾‹ï¼šè®¡ç®—åœ†çš„å‘¨é•¿å’Œé¢ç§¯ï¼ˆç»“åˆå‰é˜¶æ®µçš„å‡½æ•°çŸ¥è¯†ï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">calc_circle</span>(<span class="hljs-params">radius</span>):
    <span class="hljs-string">"""è®¡ç®—åœ†çš„å‘¨é•¿å’Œé¢ç§¯"""</span>
    <span class="hljs-keyword">if</span> radius&lt;= <span class="hljs-number">0</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"åŠå¾„å¿…é¡»ä¸ºæ­£æ•°ï¼"</span>)
        <span class="hljs-keyword">return</span>
    circumference = <span class="hljs-number">2</span> * math.pi * radius  <span class="hljs-comment"># å‘¨é•¿å…¬å¼ï¼š2Ï€r</span>
    area = math.pi * math.<span class="hljs-built_in">pow</span>(radius, <span class="hljs-number">2</span>)  <span class="hljs-comment"># é¢ç§¯å…¬å¼ï¼šÏ€rÂ²</span>
    <span class="hljs-keyword">return</span> circumference, area

<span class="hljs-comment"># è°ƒç”¨å‡½æ•°ï¼Œè·å–ç»“æœ</span>
circum, area = calc_circle(<span class="hljs-number">3</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"åŠå¾„ä¸º3çš„åœ†ï¼šå‘¨é•¿=<span class="hljs-subst">{<span class="hljs-built_in">round</span>(circum, <span class="hljs-number">2</span>)}</span>ï¼Œé¢ç§¯=<span class="hljs-subst">{<span class="hljs-built_in">round</span>(area, <span class="hljs-number">2</span>)}</span>"</span>)  <span class="hljs-comment"># ä¿ç•™2ä½å°æ•°</span>
</code></pre>
<h4 data-id="heading-7">2.2 randomåº“ï¼šéšæœºæ•°å·¥å…·ï¼Œå®ç°éšæœºåœºæ™¯</h4>
<p>randomåº“ç”¨äºç”Ÿæˆéšæœºæ•°ã€éšæœºé€‰æ‹©ã€éšæœºæ‰“ä¹±ç­‰æ“ä½œï¼Œé€‚åˆæŠ½å¥–ã€éªŒè¯ç ç”Ÿæˆã€éšæœºåˆ†ç»„ç­‰å®æˆ˜åœºæ™¯ï¼Œæ ¸å¿ƒç”¨æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> random  <span class="hljs-comment"># å¯¼å…¥randomåº“</span>

<span class="hljs-comment"># 1. ç”Ÿæˆéšæœºæµ®ç‚¹æ•°ï¼ˆ0.0 &lt;= æµ®ç‚¹æ•° &lt; 1.0ï¼‰</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"éšæœºæµ®ç‚¹æ•°ï¼ˆ0-1ï¼‰ï¼š"</span>, random.random())

<span class="hljs-comment"># 2. ç”Ÿæˆéšæœºæ•´æ•°ï¼ˆå·¦é—­å³å¼€ï¼ŒåŒ…å«startå’Œendï¼‰</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"éšæœºæ•´æ•°ï¼ˆ1-10ï¼‰ï¼š"</span>, random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"éšæœºæ•´æ•°ï¼ˆ0-9ï¼Œæ­¥é•¿2ï¼‰ï¼š"</span>, random.randrange(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">2</span>))  <span class="hljs-comment"># åªç”Ÿæˆå¶æ•°</span>

<span class="hljs-comment"># 3. éšæœºé€‰æ‹©ï¼ˆå®æˆ˜å¸¸ç”¨ï¼‰</span>
<span class="hljs-comment"># ä»åºåˆ—ä¸­éšæœºé€‰æ‹©1ä¸ªå…ƒç´ </span>
fruits = [<span class="hljs-string">"è‹¹æœ"</span>, <span class="hljs-string">"é¦™è•‰"</span>, <span class="hljs-string">"æ©™å­"</span>, <span class="hljs-string">"è‘¡è„"</span>]
<span class="hljs-built_in">print</span>(<span class="hljs-string">"éšæœºé€‰æ‹©1ä¸ªæ°´æœï¼š"</span>, random.choice(fruits))

<span class="hljs-comment"># ä»åºåˆ—ä¸­éšæœºé€‰æ‹©å¤šä¸ªä¸é‡å¤å…ƒç´ ï¼ˆæ¯”å¦‚æŠ½å¥–é€‰3äººï¼‰</span>
nums = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">21</span>))  <span class="hljs-comment"># 1-20çš„æ•´æ•°</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"éšæœºé€‰æ‹©3ä¸ªä¸é‡å¤æ•°å­—ï¼š"</span>, random.sample(nums, <span class="hljs-number">3</span>))

<span class="hljs-comment"># 4. éšæœºæ‰“ä¹±ï¼ˆåŸåœ°æ‰“ä¹±åˆ—è¡¨ï¼Œä¿®æ”¹åŸå¯¹è±¡ï¼‰</span>
random.shuffle(fruits)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æ‰“ä¹±åçš„æ°´æœåˆ—è¡¨ï¼š"</span>, fruits)

<span class="hljs-comment"># 5. å®æˆ˜æ¡ˆä¾‹ï¼šç”Ÿæˆ6ä½æ•°å­—éªŒè¯ç ï¼ˆå®æˆ˜é«˜é¢‘åœºæ™¯ï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_verify_code</span>():
    <span class="hljs-string">"""ç”Ÿæˆ6ä½æ•°å­—éªŒè¯ç """</span>
    code = <span class="hljs-string">""</span>
    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">6</span>):
        <span class="hljs-comment"># ç”Ÿæˆ0-9çš„éšæœºæ•´æ•°ï¼Œè½¬æ¢ä¸ºå­—ç¬¦ä¸²æ‹¼æ¥</span>
        code += <span class="hljs-built_in">str</span>(random.randint(<span class="hljs-number">0</span>, <span class="hljs-number">9</span>))
    <span class="hljs-keyword">return</span> code

<span class="hljs-comment"># è°ƒç”¨å‡½æ•°ï¼Œç”ŸæˆéªŒè¯ç </span>
verify_code = generate_verify_code()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"6ä½æ•°å­—éªŒè¯ç ï¼š"</span>, verify_code)
</code></pre>
<h4 data-id="heading-8">2.3 timeåº“ï¼šæ—¶é—´å·¥å…·ï¼Œå¤„ç†æ—¶é—´ç›¸å…³åœºæ™¯</h4>
<p>timeåº“ç”¨äºè·å–å½“å‰æ—¶é—´ã€æ ¼å¼åŒ–æ—¶é—´ã€è®¾ç½®ç¨‹åºå»¶è¿Ÿç­‰æ“ä½œï¼Œé€‚åˆæ—¥å¿—è®°å½•ã€ç¨‹åºè®¡æ—¶ã€å»¶è¿Ÿæ‰§è¡Œç­‰å®æˆ˜åœºæ™¯ï¼Œæ ¸å¿ƒç”¨æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> time  <span class="hljs-comment"># å¯¼å…¥timeåº“</span>

<span class="hljs-comment"># 1. è·å–å½“å‰æ—¶é—´ï¼ˆä¸‰ç§å¸¸ç”¨æ ¼å¼ï¼‰</span>
<span class="hljs-comment"># æ ¼å¼1ï¼šæ—¶é—´æˆ³ï¼ˆä»1970å¹´1æœˆ1æ—¥00:00:00åˆ°å½“å‰çš„ç§’æ•°ï¼Œæµ®ç‚¹æ•°ï¼‰</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"å½“å‰æ—¶é—´æˆ³ï¼š"</span>, time.time())

<span class="hljs-comment"># æ ¼å¼2ï¼šç»“æ„åŒ–æ—¶é—´ï¼ˆåŒ…å«å¹´ã€æœˆã€æ—¥ã€æ—¶ã€åˆ†ã€ç§’ç­‰ä¿¡æ¯ï¼‰</span>
struct_time = time.localtime()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"ç»“æ„åŒ–æ—¶é—´ï¼š"</span>, struct_time)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"å½“å‰å¹´ä»½ï¼š"</span>, struct_time.tm_year)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"å½“å‰æœˆä»½ï¼š"</span>, struct_time.tm_mon)

<span class="hljs-comment"># æ ¼å¼3ï¼šæ ¼å¼åŒ–æ—¶é—´ï¼ˆäººç±»å¯è¯»ï¼Œå¸¸ç”¨ï¼‰</span>
<span class="hljs-comment"># å¸¸ç”¨å ä½ç¬¦ï¼š%Yï¼ˆ4ä½å¹´ä»½ï¼‰ã€%mï¼ˆ2ä½æœˆä»½ï¼‰ã€%dï¼ˆ2ä½æ—¥æœŸï¼‰ã€%Hï¼ˆ24å°æ—¶åˆ¶ï¼‰ã€%Mï¼ˆåˆ†é’Ÿï¼‰ã€%Sï¼ˆç§’ï¼‰</span>
format_time1 = time.strftime(<span class="hljs-string">"%Y-%m-%d %H:%M:%S"</span>, struct_time)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"å½“å‰æ—¶é—´ï¼ˆå¹´-æœˆ-æ—¥ æ—¶:åˆ†:ç§’ï¼‰ï¼š"</span>, format_time1)

format_time2 = time.strftime(<span class="hljs-string">"%Yå¹´%mæœˆ%dæ—¥ %Hæ—¶%Måˆ†%Sç§’"</span>, struct_time)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"å½“å‰æ—¶é—´ï¼ˆä¸­æ–‡æ ¼å¼ï¼‰ï¼š"</span>, format_time2)

<span class="hljs-comment"># 2. ç¨‹åºå»¶è¿Ÿæ‰§è¡Œï¼ˆsleep(ç§’æ•°)ï¼Œå®æˆ˜å¸¸ç”¨ï¼‰</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"ç¨‹åºå¼€å§‹æ‰§è¡Œ..."</span>)
time.sleep(<span class="hljs-number">2</span>)  <span class="hljs-comment"># å»¶è¿Ÿ2ç§’ï¼ˆè®©ç¨‹åºæš‚åœ2ç§’å†æ‰§è¡Œåç»­ä»£ç ï¼‰</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"å»¶è¿Ÿ2ç§’åï¼Œç¨‹åºç»§ç»­æ‰§è¡Œ..."</span>)

<span class="hljs-comment"># 3. å®æˆ˜æ¡ˆä¾‹ï¼šè®¡ç®—ä»£ç æ‰§è¡Œæ—¶é—´ï¼ˆä¼˜åŒ–ä»£ç å¸¸ç”¨ï¼‰</span>
start_time = time.time()  <span class="hljs-comment"># è®°å½•å¼€å§‹æ—¶é—´ï¼ˆæ—¶é—´æˆ³ï¼‰</span>

<span class="hljs-comment"># æ¨¡æ‹Ÿä¸€æ®µéœ€è¦æ‰§è¡Œçš„ä»£ç ï¼ˆæ¯”å¦‚å¾ªç¯10000æ¬¡ï¼‰</span>
total = <span class="hljs-number">0</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100000</span>):
    total += i

end_time = time.time()  <span class="hljs-comment"># è®°å½•ç»“æŸæ—¶é—´</span>
execution_time = end_time - start_time  <span class="hljs-comment"># è®¡ç®—æ‰§è¡Œæ—¶é—´ï¼ˆç§’ï¼‰</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œæ€»è€—æ—¶ï¼š<span class="hljs-subst">{<span class="hljs-built_in">round</span>(execution_time, <span class="hljs-number">4</span>)}</span>ç§’"</span>)
</code></pre>
<h4 data-id="heading-9">2.4 æ–°æ‰‹é¿å‘æŒ‡å—ï¼ˆæ ‡å‡†åº“å®æˆ˜å¿…çœ‹ï¼‰</h4>
<ul>
<li>é¿å‘1ï¼šmathåº“çš„å‡½æ•°å‚æ•°å¤šä¸ºâ€œå¼§åº¦â€ï¼ˆè€Œéè§’åº¦ï¼‰ï¼Œæ¯”å¦‚math.sin()è®¡ç®—çš„æ˜¯å¼§åº¦çš„æ­£å¼¦å€¼ï¼Œè‹¥ç”¨è§’åº¦éœ€å…ˆè½¬æ¢ï¼ˆå¼§åº¦=è§’åº¦Ã—math.pi/180ï¼‰ï¼›</li>
<li>é¿å‘2ï¼šrandomåº“ç”Ÿæˆçš„æ˜¯â€œä¼ªéšæœºæ•°â€ï¼ˆåŸºäºç§å­ç”Ÿæˆï¼‰ï¼Œè‹¥è®¾ç½®å›ºå®šç§å­ï¼ˆrandom.seed(10)ï¼‰ï¼Œæ¯æ¬¡è¿è¡Œç”Ÿæˆçš„éšæœºæ•°ä¼šç›¸åŒï¼ˆé€‚åˆè°ƒè¯•ï¼‰ï¼›</li>
<li>é¿å‘3ï¼šrandom.shuffle()ä¼šâ€œåŸåœ°æ‰“ä¹±â€åˆ—è¡¨ï¼Œä¿®æ”¹åŸå¯¹è±¡ï¼Œè‹¥ä¸æƒ³ä¿®æ”¹åŸåˆ—è¡¨ï¼Œéœ€å…ˆå¤åˆ¶ï¼ˆæ¯”å¦‚new_list = list1.copy()ï¼Œå†shuffle(new_list)ï¼‰ï¼›</li>
<li>é¿å‘4ï¼štime.strftime()çš„å ä½ç¬¦åŒºåˆ†å¤§å°å†™ï¼Œæ¯”å¦‚%Yæ˜¯4ä½å¹´ä»½ï¼Œ%yæ˜¯2ä½å¹´ä»½ï¼›%Hæ˜¯24å°æ—¶åˆ¶ï¼Œ%Iæ˜¯12å°æ—¶åˆ¶ï¼Œæ–°æ‰‹æ˜“æ··æ·†ï¼›</li>
<li>é¿å‘5ï¼šå¯¼å…¥æ ‡å‡†åº“æ—¶ï¼Œæ¨¡å—åä¸è¦å†™é”™ï¼ˆæ¯”å¦‚mathä¸è¦å†™æˆMathã€randomä¸è¦å†™æˆRandomï¼‰ï¼Œå¦åˆ™ä¼šæŠ¥é”™â€œæ¨¡å—ä¸å­˜åœ¨â€ã€‚</li>
</ul>
<blockquote>
<p>ä»¥ä¸Šè¿™äº›ä½ ä»¬ä¼šè®°å˜›ï¼Ÿä¸ç”¨è®°ï¼Œç°åœ¨ ai è¿™ä¹ˆå‘è¾¾ï¼Œåªè¦æœ‰å°è±¡ï¼Œåˆ°æ—¶å€™ ai ä¸€ä¸‹å°±å‡ºæ¥äº†ã€‚</p>
</blockquote>
<h3 data-id="heading-10">3 ç½‘ç»œç¼–ç¨‹åŸºç¡€ï¼šå®ç°ç®€å•çš„è·¨ç¨‹åºé€šä¿¡</h3>
<p>ç½‘ç»œç¼–ç¨‹æ˜¯Pythonå®æˆ˜ä¸­çš„é‡è¦æŠ€èƒ½ï¼Œæ ¸å¿ƒæ˜¯å®ç°â€œä¸åŒè®¾å¤‡ã€ä¸åŒç¨‹åºä¹‹é—´çš„æ•°æ®ä¼ è¾“â€ã€‚ä½œä¸ºåŸºç¡€å®æˆ˜é˜¶æ®µï¼Œæˆ‘ä»¬ä¸æ·±å…¥å¤æ‚çš„ç½‘ç»œåè®®ï¼Œé‡ç‚¹æŒæ¡<strong>TCPåè®®çš„åŸºç¡€ç”¨æ³•</strong>ï¼ˆæœ€å¸¸ç”¨ã€æœ€å¯é çš„ç½‘ç»œåè®®ï¼‰ï¼Œå®ç°â€œæœ¬åœ°å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯çš„ç®€å•é€šä¿¡â€ï¼Œç†è§£ç½‘ç»œç¼–ç¨‹çš„æ ¸å¿ƒæµç¨‹ï¼Œä¸ºåç»­å­¦ä¹ ç½‘ç»œçˆ¬è™«ã€æ¥å£å¼€å‘æ‰“ä¸‹åŸºç¡€ã€‚</p>
<p>æ ¸å¿ƒæ¦‚å¿µï¼ˆæ–°æ‰‹å¿…æ‡‚ï¼‰ï¼š - å®¢æˆ·ç«¯ï¼ˆClientï¼‰ï¼šä¸»åŠ¨å‘èµ·è¿æ¥ã€è¯·æ±‚æ•°æ®çš„ä¸€æ–¹ï¼ˆæ¯”å¦‚æˆ‘ä»¬çš„æµè§ˆå™¨ã€æ‰‹æœºAPPï¼‰ï¼› - æœåŠ¡å™¨ç«¯ï¼ˆServerï¼‰ï¼šè¢«åŠ¨æ¥æ”¶è¿æ¥ã€å“åº”è¯·æ±‚çš„ä¸€æ–¹ï¼ˆæ¯”å¦‚ç½‘ç«™çš„æœåŠ¡å™¨ï¼‰ï¼› - Socketï¼ˆå¥—æ¥å­—ï¼‰ï¼šç½‘ç»œé€šä¿¡çš„â€œæ¡¥æ¢â€ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯é€šè¿‡Socketå»ºç«‹è¿æ¥ã€ä¼ è¾“æ•°æ®ã€‚</p>
<h4 data-id="heading-11">3.1 ç½‘ç»œç¼–ç¨‹æ ¸å¿ƒæµç¨‹ï¼ˆTCPåè®®ï¼‰</h4>
<p>TCPåè®®çš„é€šä¿¡æµç¨‹éµå¾ªâ€œä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥â†’ä¼ è¾“æ•°æ®â†’å››æ¬¡æŒ¥æ‰‹å…³é—­è¿æ¥â€ï¼Œæ–°æ‰‹é‡ç‚¹æŒæ¡â€œå»ºç«‹è¿æ¥â†’ä¼ è¾“æ•°æ®â†’å…³é—­è¿æ¥â€çš„åŸºç¡€æµç¨‹ï¼Œç”¨Pythonçš„socketåº“å®ç°ï¼ˆå†…ç½®åº“ï¼Œæ— éœ€é¢å¤–å®‰è£…ï¼‰ï¼š</p>
<p>æµç¨‹æ‹†è§£ï¼š æœåŠ¡å™¨ç«¯ï¼šåˆ›å»ºSocketâ†’ç»‘å®šIPå’Œç«¯å£â†’ç›‘å¬è¿æ¥â†’æ¥å—è¿æ¥â†’æ¥æ”¶/å‘é€æ•°æ®â†’å…³é—­è¿æ¥ï¼› å®¢æˆ·ç«¯ï¼šåˆ›å»ºSocketâ†’è¿æ¥æœåŠ¡å™¨ï¼ˆIP+ç«¯å£ï¼‰â†’å‘é€/æ¥æ”¶æ•°æ®â†’å…³é—­è¿æ¥ã€‚</p>
<h4 data-id="heading-12">3.2 å®æˆ˜ä»£ç ï¼šæœ¬åœ°TCPå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯é€šä¿¡</h4>
<p>ä»¥ä¸‹ä»£ç åˆ†ä¸ºâ€œæœåŠ¡å™¨ç«¯â€å’Œâ€œå®¢æˆ·ç«¯â€ä¸¤éƒ¨åˆ†ï¼Œéœ€åˆ†åˆ«è¿è¡Œï¼ˆå…ˆè¿è¡ŒæœåŠ¡å™¨ç«¯ï¼Œå†è¿è¡Œå®¢æˆ·ç«¯ï¼‰ï¼Œå®ç°æœ¬åœ°ï¼ˆ127.0.0.1ï¼Œæœ¬æœºIPï¼‰çš„ç®€å•é€šä¿¡ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ------------- æœåŠ¡å™¨ç«¯ä»£ç ï¼ˆserver.pyï¼‰-------------</span>
<span class="hljs-keyword">import</span> socket
<span class="hljs-keyword">import</span> time

<span class="hljs-comment"># 1. åˆ›å»ºSocketå¯¹è±¡ï¼ˆAF_INETï¼šIPv4åè®®ï¼ŒSOCK_STREAMï¼šTCPåè®®ï¼‰</span>
server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

<span class="hljs-comment"># 2. ç»‘å®šIPåœ°å€å’Œç«¯å£ï¼ˆIPï¼š127.0.0.1ï¼Œæœ¬æœºIPï¼›ç«¯å£ï¼š9999ï¼Œè‡ªå®šä¹‰ï¼Œ1024ä»¥ä¸Šé¿å…å†²çªï¼‰</span>
server_addr = (<span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-number">9999</span>)
server_socket.bind(server_addr)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"æœåŠ¡å™¨å·²å¯åŠ¨ï¼Œç»‘å®šåœ°å€ï¼š<span class="hljs-subst">{server_addr}</span>ï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿æ¥..."</span>)

<span class="hljs-comment"># 3. ç›‘å¬è¿æ¥ï¼ˆå‚æ•°5ï¼šæœ€å¤§ç­‰å¾…è¿æ¥æ•°ï¼‰</span>
server_socket.listen(<span class="hljs-number">5</span>)

<span class="hljs-comment"># 4. æ¥å—å®¢æˆ·ç«¯è¿æ¥ï¼ˆé˜»å¡å¼ï¼Œç­‰å¾…å®¢æˆ·ç«¯å‘èµ·è¿æ¥ï¼‰</span>
client_socket, client_addr = server_socket.accept()
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"å®¢æˆ·ç«¯<span class="hljs-subst">{client_addr}</span>å·²è¿æ¥ï¼"</span>)

<span class="hljs-keyword">try</span>:
    <span class="hljs-comment"># 5. æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ï¼ˆrecv(1024)ï¼šæ¯æ¬¡æœ€å¤šæ¥æ”¶1024å­—èŠ‚ï¼Œéœ€è§£ç ä¸ºå­—ç¬¦ä¸²ï¼‰</span>
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        data = client_socket.recv(<span class="hljs-number">1024</span>).decode(<span class="hljs-string">"utf-8"</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data:  <span class="hljs-comment"># è‹¥å®¢æˆ·ç«¯å…³é—­è¿æ¥ï¼Œdataä¸ºç©ºï¼Œé€€å‡ºå¾ªç¯</span>
            <span class="hljs-keyword">break</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ”¶åˆ°å®¢æˆ·ç«¯<span class="hljs-subst">{client_addr}</span>çš„æ¶ˆæ¯ï¼š<span class="hljs-subst">{data}</span>"</span>)
        
        <span class="hljs-comment"># 6. å‘å®¢æˆ·ç«¯å‘é€å“åº”æ•°æ®ï¼ˆéœ€ç¼–ç ä¸ºbytesç±»å‹ï¼‰</span>
        response = <span class="hljs-string">f"æœåŠ¡å™¨å·²æ”¶åˆ°æ¶ˆæ¯ï¼š<span class="hljs-subst">{data}</span>ï¼Œæ—¶é—´ï¼š<span class="hljs-subst">{time.strftime(<span class="hljs-string">'%H:%M:%S'</span>)}</span>"</span>
        client_socket.send(response.encode(<span class="hljs-string">"utf-8"</span>))
<span class="hljs-keyword">finally</span>:
    <span class="hljs-comment"># 7. å…³é—­è¿æ¥ï¼ˆå…ˆå…³é—­å®¢æˆ·ç«¯è¿æ¥ï¼Œå†å…³é—­æœåŠ¡å™¨ç«¯è¿æ¥ï¼‰</span>
    client_socket.close()
    server_socket.close()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ä¸å®¢æˆ·ç«¯<span class="hljs-subst">{client_addr}</span>çš„è¿æ¥å·²å…³é—­ï¼ŒæœåŠ¡å™¨å·²åœæ­¢è¿è¡Œ"</span>)

<span class="hljs-comment"># ------------- å®¢æˆ·ç«¯ä»£ç ï¼ˆclient.pyï¼‰-------------</span>
<span class="hljs-keyword">import</span> socket

<span class="hljs-comment"># 1. åˆ›å»ºSocketå¯¹è±¡ï¼ˆä¸æœåŠ¡å™¨ç«¯ä¸€è‡´ï¼ŒIPv4+TCPï¼‰</span>
client_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

<span class="hljs-comment"># 2. è¿æ¥æœåŠ¡å™¨ï¼ˆæŒ‡å®šæœåŠ¡å™¨çš„IPå’Œç«¯å£ï¼Œä¸æœåŠ¡å™¨ç«¯ä¸€è‡´ï¼‰</span>
server_addr = (<span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-number">9999</span>)
<span class="hljs-keyword">try</span>:
    client_socket.connect(server_addr)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æˆåŠŸè¿æ¥åˆ°æœåŠ¡å™¨<span class="hljs-subst">{server_addr}</span>ï¼"</span>)
    
    <span class="hljs-comment"># 3. å‘æœåŠ¡å™¨å‘é€æ•°æ®ï¼ˆè¾“å…¥æ¶ˆæ¯ï¼Œå‘é€ç»™æœåŠ¡å™¨ï¼‰</span>
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        msg = <span class="hljs-built_in">input</span>(<span class="hljs-string">"è¯·è¾“å…¥è¦å‘é€ç»™æœåŠ¡å™¨çš„æ¶ˆæ¯ï¼ˆè¾“å…¥'quit'é€€å‡ºï¼‰ï¼š"</span>)
        <span class="hljs-keyword">if</span> msg == <span class="hljs-string">"quit"</span>:
            <span class="hljs-keyword">break</span>
        <span class="hljs-comment"># å‘é€æ•°æ®ï¼šå­—ç¬¦ä¸²ç¼–ç ä¸ºbytesç±»å‹</span>
        client_socket.send(msg.encode(<span class="hljs-string">"utf-8"</span>))
        
        <span class="hljs-comment"># 4. æ¥æ”¶æœåŠ¡å™¨çš„å“åº”æ•°æ®</span>
        response = client_socket.recv(<span class="hljs-number">1024</span>).decode(<span class="hljs-string">"utf-8"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æœåŠ¡å™¨å“åº”ï¼š<span class="hljs-subst">{response}</span>"</span>)
<span class="hljs-keyword">finally</span>:
    <span class="hljs-comment"># 5. å…³é—­è¿æ¥</span>
    client_socket.close()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"ä¸æœåŠ¡å™¨çš„è¿æ¥å·²å…³é—­"</span>)
</code></pre>
<h4 data-id="heading-13">3.3 ä»£ç è¿è¡Œè¯´æ˜ä¸å®æˆ˜æ‹“å±•</h4>
<ul>
<li>è¿è¡Œæ­¥éª¤ï¼šâ‘  æ–°å»ºä¸¤ä¸ª.pyæ–‡ä»¶ï¼ˆserver.pyã€client.pyï¼‰ï¼Œåˆ†åˆ«å¤åˆ¶ä¸Šé¢çš„ä»£ç ï¼›â‘¡ å…ˆè¿è¡Œserver.pyï¼ˆæœåŠ¡å™¨å¯åŠ¨ï¼Œç­‰å¾…è¿æ¥ï¼‰ï¼›â‘¢ å†è¿è¡Œclient.pyï¼ˆå®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨ï¼‰ï¼›â‘£ åœ¨å®¢æˆ·ç«¯è¾“å…¥æ¶ˆæ¯ï¼Œå³å¯å®ç°åŒå‘é€šä¿¡ï¼Œè¾“å…¥â€œquitâ€é€€å‡ºã€‚</li>
<li>å®æˆ˜æ‹“å±•ï¼šå°†å‰é˜¶æ®µçš„â€œæ–‡ä»¶æ“ä½œâ€ç»“åˆè¿›æ¥ï¼Œå®ç°â€œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€æ–‡ä»¶å†…å®¹ï¼ŒæœåŠ¡å™¨æ¥æ”¶åä¿å­˜åˆ°æœ¬åœ°â€ï¼ˆæ¯”å¦‚å®¢æˆ·ç«¯è¯»å–test.txtæ–‡ä»¶ï¼Œå‘é€ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨ä¿å­˜ä¸ºserver_test.txtï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-14">3.4 æ–°æ‰‹é¿å‘æŒ‡å—ï¼ˆç½‘ç»œç¼–ç¨‹åŸºç¡€å¿…çœ‹ï¼‰</h4>
<ul>
<li>é¿å‘1ï¼šå¿…é¡»â€œå…ˆå¯åŠ¨æœåŠ¡å™¨ç«¯ï¼Œå†å¯åŠ¨å®¢æˆ·ç«¯â€ï¼Œå¦åˆ™å®¢æˆ·ç«¯ä¼šæŠ¥é”™â€œè¿æ¥æ‹’ç»â€ï¼›</li>
<li>é¿å‘2ï¼šIPåœ°å€å’Œç«¯å£å¿…é¡»ä¸€è‡´ï¼ŒæœåŠ¡å™¨ç«¯ç»‘å®šçš„IPå’Œç«¯å£ï¼Œå®¢æˆ·ç«¯å¿…é¡»å®Œå…¨å¯¹åº”ï¼ˆæ¯”å¦‚æœåŠ¡å™¨ç»‘å®š127.0.0.1:9999ï¼Œå®¢æˆ·ç«¯ä¹Ÿè¦è¿æ¥è¿™ä¸ªåœ°å€ï¼‰ï¼›</li>
<li>é¿å‘3ï¼šTCPé€šä¿¡ä¸­ï¼Œsend()å‘é€çš„æ˜¯bytesç±»å‹æ•°æ®ï¼Œrecv()æ¥æ”¶çš„ä¹Ÿæ˜¯bytesç±»å‹ï¼Œå¿…é¡»ç”¨encode("utf-8")ç¼–ç ã€decode("utf-8")è§£ç ï¼Œå¦åˆ™ä¼šæŠ¥é”™æˆ–å‡ºç°ä¹±ç ï¼›</li>
<li>é¿å‘4ï¼šç«¯å£å·éœ€é€‰æ‹©1024ä»¥ä¸Šçš„ï¼ˆ1024ä»¥ä¸‹æ˜¯ç³»ç»Ÿæ ‡å‡†ç«¯å£ï¼Œå¯èƒ½è¢«å ç”¨ï¼‰ï¼Œè‹¥è¿è¡Œæ—¶æŠ¥é”™â€œç«¯å£å·²è¢«å ç”¨â€ï¼Œå¯æ›´æ¢ç«¯å£ï¼ˆæ¯”å¦‚æ”¹ä¸º10000ï¼‰ï¼›</li>
<li>é¿å‘5ï¼šæœåŠ¡å™¨ç«¯çš„accept()ã€recv()æ˜¯â€œé˜»å¡å¼â€çš„ï¼Œä¼šä¸€ç›´ç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥/æ•°æ®ï¼Œæ–°æ‰‹æ— éœ€æ·±ç©¶ï¼Œåç»­è¿›é˜¶å†å­¦ä¹ éé˜»å¡ç¼–ç¨‹ï¼›</li>
<li>é¿å‘6ï¼šé€šä¿¡ç»“æŸåï¼Œå¿…é¡»å…³é—­Socketè¿æ¥ï¼ˆclose()ï¼‰ï¼Œé¿å…èµ„æºæ³„éœ²ã€‚</li>
</ul>
<h3 data-id="heading-15">4 å¤šçº¿ç¨‹åŸºç¡€ï¼šå®ç°ç¨‹åºçš„å¹¶å‘æ‰§è¡Œ</h3>
<p>åœ¨å‰é¢çš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬ç¼–å†™çš„ä»£ç éƒ½æ˜¯â€œå•çº¿ç¨‹â€çš„â€”â€”ç¨‹åºä»ä¸Šåˆ°ä¸‹ï¼Œä¾æ¬¡æ‰§è¡Œï¼Œä¸€æ¬¡åªèƒ½åšä¸€ä»¶äº‹ï¼ˆæ¯”å¦‚ç¨‹åºæ‰§è¡Œå»¶è¿Ÿæ—¶ï¼Œä¼šä¸€ç›´å¡ä½ï¼Œæ— æ³•åšå…¶ä»–æ“ä½œï¼‰ã€‚è€Œâ€œå¤šçº¿ç¨‹â€ï¼Œèƒ½è®©ç¨‹åºâ€œåŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡â€ï¼ˆå¹¶å‘æ‰§è¡Œï¼‰ï¼Œæå‡ç¨‹åºæ•ˆç‡ï¼Œå°¤å…¶é€‚åˆI/Oå¯†é›†å‹ä»»åŠ¡ï¼ˆæ¯”å¦‚æ–‡ä»¶æ“ä½œã€ç½‘ç»œè¯·æ±‚ã€å»¶è¿Ÿæ‰§è¡Œï¼‰ã€‚</p>
<p>ä½œä¸ºåŸºç¡€å®æˆ˜é˜¶æ®µï¼Œæˆ‘ä»¬é‡ç‚¹æŒæ¡Python threadingæ¨¡å—çš„åŸºç¡€ç”¨æ³•ï¼ˆå†…ç½®åº“ï¼Œæ— éœ€é¢å¤–å®‰è£…ï¼‰ï¼Œå®ç°ç®€å•çš„å¤šçº¿ç¨‹å¹¶å‘ï¼Œç†è§£å¤šçº¿ç¨‹çš„æ ¸å¿ƒæ¦‚å¿µå’Œä¼˜åŠ¿ï¼Œä¸æ·±å…¥å¤æ‚çš„çº¿ç¨‹å®‰å…¨ã€é”æœºåˆ¶ï¼ˆåç»­è¿›é˜¶å†å­¦ä¹ ï¼‰ã€‚</p>
<p>æ ¸å¿ƒæ¦‚å¿µï¼ˆæ–°æ‰‹å¿…æ‡‚ï¼‰ï¼š - çº¿ç¨‹ï¼ˆThreadï¼‰ï¼šç¨‹åºæ‰§è¡Œçš„æœ€å°å•ä½ï¼Œä¸€ä¸ªç¨‹åºå¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ï¼› - ä¸»çº¿ç¨‹ï¼šç¨‹åºå¯åŠ¨åï¼Œé»˜è®¤åˆ›å»ºçš„çº¿ç¨‹ï¼ˆæ¯”å¦‚æˆ‘ä»¬ä¹‹å‰å†™çš„ä»£ç ï¼Œéƒ½æ˜¯ä¸»çº¿ç¨‹åœ¨æ‰§è¡Œï¼‰ï¼› - å­çº¿ç¨‹ï¼šæˆ‘ä»¬æ‰‹åŠ¨åˆ›å»ºçš„çº¿ç¨‹ï¼Œç”¨äºæ‰§è¡Œé¢å¤–çš„ä»»åŠ¡ï¼Œä¸ä¸»çº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚</p>
<h4 data-id="heading-16">4.1 å¤šçº¿ç¨‹åŸºç¡€ç”¨æ³•ï¼ˆä¸¤ç§å¸¸ç”¨æ–¹å¼ï¼‰</h4>
<p>æ–°æ‰‹é‡ç‚¹æŒæ¡ä¸¤ç§åˆ›å»ºå­çº¿ç¨‹çš„æ–¹å¼ï¼šâ‘  ä¼ å…¥targetå‡½æ•°ï¼ˆæ¨èï¼Œç®€å•æ˜“æ‡‚ï¼‰ï¼›â‘¡ ç»§æ‰¿Threadç±»ï¼ˆè¿›é˜¶ç”¨æ³•ï¼Œç®€å•äº†è§£ï¼‰ï¼Œç»“åˆå®æˆ˜æ¡ˆä¾‹è®²è§£ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> threading
<span class="hljs-keyword">import</span> time

<span class="hljs-comment"># ---------------- æ–¹å¼1ï¼šä¼ å…¥targetå‡½æ•°ï¼ˆæ¨èï¼Œæ–°æ‰‹é¦–é€‰ï¼‰----------------</span>
<span class="hljs-comment"># å®šä¹‰è¦åœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œçš„å‡½æ•°ï¼ˆæ¯”å¦‚æ¨¡æ‹Ÿä¸‹è½½ä»»åŠ¡ï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">download_task</span>(<span class="hljs-params">task_name, delay</span>):
    <span class="hljs-string">"""æ¨¡æ‹Ÿä¸‹è½½ä»»åŠ¡ï¼šå»¶è¿Ÿdelayç§’ï¼Œæ¨¡æ‹Ÿä¸‹è½½è€—æ—¶"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å­çº¿ç¨‹å¯åŠ¨ï¼šå¼€å§‹ä¸‹è½½<span class="hljs-subst">{task_name}</span>ï¼Œé¢„è®¡è€—æ—¶<span class="hljs-subst">{delay}</span>ç§’"</span>)
    time.sleep(delay)  <span class="hljs-comment"># æ¨¡æ‹Ÿä¸‹è½½è€—æ—¶ï¼ˆI/Oé˜»å¡ï¼‰</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å­çº¿ç¨‹ç»“æŸï¼š<span class="hljs-subst">{task_name}</span>ä¸‹è½½å®Œæˆï¼"</span>)

<span class="hljs-comment"># 1. åˆ›å»ºå­çº¿ç¨‹ï¼ˆtargetï¼šå­çº¿ç¨‹è¦æ‰§è¡Œçš„å‡½æ•°ï¼›argsï¼šä¼ å…¥å‡½æ•°çš„å‚æ•°ï¼Œå…ƒç»„ç±»å‹ï¼‰</span>
thread1 = threading.Thread(target=download_task, args=(<span class="hljs-string">"ç”µå½±A"</span>, <span class="hljs-number">3</span>))
thread2 = threading.Thread(target=download_task, args=(<span class="hljs-string">"éŸ³ä¹B"</span>, <span class="hljs-number">2</span>))

<span class="hljs-comment"># 2. å¯åŠ¨å­çº¿ç¨‹ï¼ˆstart()ï¼šå¯åŠ¨çº¿ç¨‹ï¼Œè‡ªåŠ¨è°ƒç”¨targetå‡½æ•°ï¼‰</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"ä¸»çº¿ç¨‹ï¼šå¼€å§‹æ‰§è¡Œç¨‹åº"</span>)
thread1.start()
thread2.start()

<span class="hljs-comment"># 3. ç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼ˆjoin()ï¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œç­‰å¾…å­çº¿ç¨‹ç»“æŸåï¼Œä¸»çº¿ç¨‹å†ç»§ç»­ï¼‰</span>
thread1.join()
thread2.join()

<span class="hljs-built_in">print</span>(<span class="hljs-string">"ä¸»çº¿ç¨‹ï¼šæ‰€æœ‰å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œç¨‹åºç»“æŸ"</span>)

<span class="hljs-comment"># ---------------- æ–¹å¼2ï¼šç»§æ‰¿Threadç±»ï¼ˆç®€å•äº†è§£ï¼‰----------------</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyThread</span>(threading.Thread):
    <span class="hljs-string">"""è‡ªå®šä¹‰çº¿ç¨‹ç±»ï¼Œç»§æ‰¿Threadç±»ï¼Œé‡å†™run()æ–¹æ³•"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, task_name, delay</span>):
        <span class="hljs-built_in">super</span>().__init__()  <span class="hljs-comment"># è°ƒç”¨çˆ¶ç±»çš„åˆå§‹åŒ–æ–¹æ³•</span>
        self.task_name = task_name
        self.delay = delay
    
    <span class="hljs-comment"># é‡å†™run()æ–¹æ³•ï¼šå­çº¿ç¨‹å¯åŠ¨åï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œrun()æ–¹æ³•ä¸­çš„ä»£ç </span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å­çº¿ç¨‹å¯åŠ¨ï¼šå¼€å§‹ä¸‹è½½<span class="hljs-subst">{self.task_name}</span>ï¼Œé¢„è®¡è€—æ—¶<span class="hljs-subst">{self.delay}</span>ç§’"</span>)
        time.sleep(self.delay)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å­çº¿ç¨‹ç»“æŸï¼š<span class="hljs-subst">{self.task_name}</span>ä¸‹è½½å®Œæˆï¼"</span>)

<span class="hljs-comment"># åˆ›å»ºè‡ªå®šä¹‰çº¿ç¨‹å¯¹è±¡</span>
thread3 = MyThread(<span class="hljs-string">"å›¾ç‰‡C"</span>, <span class="hljs-number">1</span>)
thread4 = MyThread(<span class="hljs-string">"æ–‡æ¡£D"</span>, <span class="hljs-number">4</span>)

<span class="hljs-comment"># å¯åŠ¨å­çº¿ç¨‹</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"\nä¸»çº¿ç¨‹ï¼šå¼€å§‹æ‰§è¡Œè‡ªå®šä¹‰çº¿ç¨‹ç¨‹åº"</span>)
thread3.start()
thread4.start()

<span class="hljs-comment"># ç­‰å¾…å­çº¿ç¨‹ç»“æŸ</span>
thread3.join()
thread4.join()

<span class="hljs-built_in">print</span>(<span class="hljs-string">"ä¸»çº¿ç¨‹ï¼šæ‰€æœ‰è‡ªå®šä¹‰çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œç¨‹åºç»“æŸ"</span>)
</code></pre>
<h4 data-id="heading-17">4.2 å¤šçº¿ç¨‹çš„ä¼˜åŠ¿ï¼ˆå®æˆ˜å¯¹æ¯”ï¼‰</h4>
<p>é€šè¿‡â€œå•çº¿ç¨‹â€ä¸â€œå¤šçº¿ç¨‹â€çš„æ‰§è¡Œæ—¶é—´å¯¹æ¯”ï¼Œç›´è§‚æ„Ÿå—å¤šçº¿ç¨‹çš„å¹¶å‘ä¼˜åŠ¿ï¼ˆé€‚åˆI/Oå¯†é›†å‹ä»»åŠ¡ï¼‰ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> threading
<span class="hljs-keyword">import</span> time

<span class="hljs-comment"># å®šä¹‰ä»»åŠ¡å‡½æ•°ï¼ˆæ¨¡æ‹ŸI/Oé˜»å¡ï¼Œæ¯”å¦‚ä¸‹è½½ã€æ–‡ä»¶è¯»å–ï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">task</span>(<span class="hljs-params">name, delay</span>):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ä»»åŠ¡<span class="hljs-subst">{name}</span>å¼€å§‹æ‰§è¡Œï¼Œè€—æ—¶<span class="hljs-subst">{delay}</span>ç§’"</span>)
    time.sleep(delay)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ä»»åŠ¡<span class="hljs-subst">{name}</span>æ‰§è¡Œå®Œæ¯•"</span>)

<span class="hljs-comment"># ---------------- å•çº¿ç¨‹æ‰§è¡Œï¼ˆä¾æ¬¡æ‰§è¡Œ3ä¸ªä»»åŠ¡ï¼‰----------------</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"=== å•çº¿ç¨‹æ‰§è¡Œ ==="</span>)
start_time1 = time.time()

task(<span class="hljs-string">"A"</span>, <span class="hljs-number">3</span>)
task(<span class="hljs-string">"B"</span>, <span class="hljs-number">2</span>)
task(<span class="hljs-string">"C"</span>, <span class="hljs-number">1</span>)

end_time1 = time.time()
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"å•çº¿ç¨‹æ€»è€—æ—¶ï¼š<span class="hljs-subst">{<span class="hljs-built_in">round</span>(end_time1 - start_time1, <span class="hljs-number">2</span>)}</span>ç§’\n"</span>)  <span class="hljs-comment"># æ€»è€—æ—¶çº¦6ç§’</span>

<span class="hljs-comment"># ---------------- å¤šçº¿ç¨‹æ‰§è¡Œï¼ˆ3ä¸ªä»»åŠ¡å¹¶å‘æ‰§è¡Œï¼‰----------------</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"=== å¤šçº¿ç¨‹æ‰§è¡Œ ==="</span>)
start_time2 = time.time()

<span class="hljs-comment"># åˆ›å»º3ä¸ªå­çº¿ç¨‹</span>
t1 = threading.Thread(target=task, args=(<span class="hljs-string">"A"</span>, <span class="hljs-number">3</span>))
t2 = threading.Thread(target=task, args=(<span class="hljs-string">"B"</span>, <span class="hljs-number">2</span>))
t3 = threading.Thread(target=task, args=(<span class="hljs-string">"C"</span>, <span class="hljs-number">1</span>))

<span class="hljs-comment"># å¯åŠ¨æ‰€æœ‰å­çº¿ç¨‹</span>
t1.start()
t2.start()
t3.start()

<span class="hljs-comment"># ç­‰å¾…æ‰€æœ‰å­çº¿ç¨‹ç»“æŸ</span>
t1.join()
t2.join()
t3.join()

end_time2 = time.time()
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¤šçº¿ç¨‹æ€»è€—æ—¶ï¼š<span class="hljs-subst">{<span class="hljs-built_in">round</span>(end_time2 - start_time2, <span class="hljs-number">2</span>)}</span>ç§’"</span>)  <span class="hljs-comment"># æ€»è€—æ—¶çº¦3ç§’ï¼ˆå–å†³äºæœ€é•¿ä»»åŠ¡ï¼‰</span>
</code></pre>
<p>è¿è¡Œç»“æœåˆ†æï¼šå•çº¿ç¨‹æ‰§è¡Œ3ä¸ªä»»åŠ¡ï¼Œæ€»è€—æ—¶æ˜¯3+2+1=6ç§’ï¼›å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œæ€»è€—æ—¶çº¦3ç§’ï¼ˆç­‰äºæœ€é•¿ä»»åŠ¡çš„è€—æ—¶ï¼‰ï¼Œæ˜æ˜¾æå‡äº†ç¨‹åºæ•ˆç‡â€”â€”è¿™å°±æ˜¯å¤šçº¿ç¨‹çš„æ ¸å¿ƒä¼˜åŠ¿ï¼Œé€‚åˆå¤„ç†â€œéœ€è¦ç­‰å¾…çš„ä»»åŠ¡â€ã€‚</p>
<h4 data-id="heading-18">4.3 æ–°æ‰‹é¿å‘æŒ‡å—ï¼ˆå¤šçº¿ç¨‹åŸºç¡€å¿…çœ‹ï¼‰</h4>
<ul>
<li>é¿å‘1ï¼šå¯åŠ¨çº¿ç¨‹å¿…é¡»ç”¨ <code>start()</code> æ–¹æ³•ï¼Œä¸èƒ½ç”¨ <code>run()</code> æ–¹æ³•â€”â€”start()ä¼šåˆ›å»ºå­çº¿ç¨‹ï¼Œå¹¶å‘æ‰§è¡Œï¼›run()åªæ˜¯æ™®é€šå‡½æ•°è°ƒç”¨ï¼Œè¿˜æ˜¯å•çº¿ç¨‹æ‰§è¡Œï¼›</li>
<li>é¿å‘2ï¼š<code>join()</code> æ–¹æ³•çš„ä½œç”¨æ˜¯â€œé˜»å¡ä¸»çº¿ç¨‹â€ï¼Œç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œè‹¥ä¸è°ƒç”¨join()ï¼Œä¸»çº¿ç¨‹ä¼šç›´æ¥ç»“æŸï¼Œå­çº¿ç¨‹å¯èƒ½è¿˜æœªæ‰§è¡Œå®Œå°±è¢«ç»ˆæ­¢ï¼›</li>
<li>é¿å‘3ï¼šPythonä¸­å­˜åœ¨â€œå…¨å±€è§£é‡Šå™¨é”ï¼ˆGILï¼‰â€ï¼ŒåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡ŒPythonä»£ç â€”â€”å¤šçº¿ç¨‹é€‚åˆI/Oå¯†é›†å‹ä»»åŠ¡ï¼ˆå¦‚ä¸‹è½½ã€å»¶è¿Ÿï¼‰ï¼Œä¸é€‚åˆCPUå¯†é›†å‹ä»»åŠ¡ï¼ˆå¦‚å¤§é‡è®¡ç®—ï¼‰ï¼Œæ–°æ‰‹æ— éœ€æ·±ç©¶GILï¼ŒçŸ¥é“è¿™ä¸ªç‰¹æ€§å³å¯ï¼›</li>
<li>é¿å‘4ï¼šå¤šä¸ªå­çº¿ç¨‹å…±äº«å…¨å±€å˜é‡æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°â€œçº¿ç¨‹å®‰å…¨é—®é¢˜â€ï¼ˆæ¯”å¦‚å¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå¯¼è‡´æ•°æ®é”™è¯¯ï¼‰ï¼ŒåŸºç¡€é˜¶æ®µæš‚æ—¶ä¸å¤„ç†ï¼Œåç»­è¿›é˜¶å­¦ä¹ â€œé”æœºåˆ¶â€è§£å†³ï¼›</li>
<li>é¿å‘5ï¼šä¸è¦åˆ›å»ºè¿‡å¤šçš„å­çº¿ç¨‹ï¼ˆæ¯”å¦‚å‡ ç™¾ã€å‡ åƒä¸ªï¼‰ï¼Œä¼šå ç”¨å¤§é‡ç³»ç»Ÿèµ„æºï¼Œå¯¼è‡´ç¨‹åºå¡é¡¿ï¼ŒæŒ‰éœ€åˆ›å»ºå³å¯ã€‚</li>
</ul>
<h3 data-id="heading-19">5 æ€»ç»“</h3>
<p>æ­å–œå¤§å®¶ï¼Python3åŸºç¡€å­¦ä¹ ç¬¬ä¸ƒé˜¶æ®µã€ŒåŸºç¡€å®æˆ˜å·©å›ºã€çš„æ ¸å¿ƒå†…å®¹ï¼Œåˆ°è¿™é‡Œå°±å…¨éƒ¨æ¢³ç†å®Œæ¯•äº†ï¼è¿™ä¸€é˜¶æ®µï¼Œæˆ‘ä»¬æ²¡æœ‰å­¦ä¹ æ–°çš„å¤æ‚è¯­æ³•ï¼Œè€Œæ˜¯èšç„¦â€œå®æˆ˜å·©å›ºâ€ï¼Œå°†å‰å…­é˜¶æ®µçš„çŸ¥è¯†ä¸²è”èµ·æ¥ï¼Œé€šè¿‡å››å¤§å®æˆ˜æ–¹å‘ï¼Œå®ç°äº†ä»â€œä¼šç”¨â€åˆ°â€œæ´»ç”¨â€çš„è·¨è¶Šï¼š</p>
<ul>
<li>å¸¸ç”¨å†…ç½®å‡½æ•°ï¼šæŒæ¡äº†lenã€rangeã€enumerateã€zipç­‰é«˜é¢‘å·¥å…·ï¼Œå­¦ä¼šç”¨å†…ç½®å‡½æ•°ç®€åŒ–ä»£ç ï¼Œæå‡ç¼–ç æ•ˆç‡ï¼›</li>
<li>ç®€å•æ ‡å‡†åº“ï¼šç†Ÿç»ƒä½¿ç”¨mathã€randomã€timeä¸‰ä¸ªå¸¸ç”¨æ ‡å‡†åº“ï¼Œèƒ½è§£å†³æ•°å­¦è®¡ç®—ã€éšæœºåœºæ™¯ã€æ—¶é—´å¤„ç†ç­‰æ—¥å¸¸å®æˆ˜éœ€æ±‚ï¼›</li>
<li>ç½‘ç»œç¼–ç¨‹åŸºç¡€ï¼šæŒæ¡TCPåè®®çš„æ ¸å¿ƒæµç¨‹ï¼Œå®ç°äº†æœ¬åœ°å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯çš„ç®€å•é€šä¿¡ï¼Œç†è§£äº†è·¨ç¨‹åºé€šä¿¡çš„åŸç†ï¼›</li>
<li>å¤šçº¿ç¨‹åŸºç¡€ï¼šå­¦ä¼šç”¨threadingæ¨¡å—åˆ›å»ºå­çº¿ç¨‹ï¼Œå®ç°ç¨‹åºçš„å¹¶å‘æ‰§è¡Œï¼Œæå‡I/Oå¯†é›†å‹ä»»åŠ¡çš„æ•ˆç‡ã€‚</li>
</ul>
<p>æœ¬é˜¶æ®µçš„æ ¸å¿ƒé‡ç‚¹æ˜¯â€œå®æˆ˜â€â€”â€”æ–°æ‰‹ä¸è¦åªçœ‹ä»£ç ã€è®°è¯­æ³•ï¼Œä¸€å®šè¦äº²æ‰‹æ•²å†™æ¯ä¸ªæ¡ˆä¾‹ï¼Œè°ƒè¯•æŠ¥é”™ï¼Œç»“åˆå‰é˜¶æ®µçš„çŸ¥è¯†ï¼ˆå‡½æ•°ã€æ¨¡å—ã€æ–‡ä»¶æ“ä½œç­‰ï¼‰æ‹“å±•å®æˆ˜åœºæ™¯ï¼Œæ¯”å¦‚ï¼šç”¨å¤šçº¿ç¨‹å®ç°å¤šæ–‡ä»¶ä¸‹è½½ã€ç”¨ç½‘ç»œç¼–ç¨‹+æ–‡ä»¶æ“ä½œå®ç°æ–‡ä»¶ä¼ è¾“ã€ç”¨å†…ç½®å‡½æ•°+æ ‡å‡†åº“ç¼–å†™ç®€å•çš„éªŒè¯ç ç”Ÿæˆå™¨ã€‚</p>
<p>å¯¹äºæ–°æ‰‹æ¥è¯´ï¼Œæœ¬é˜¶æ®µå¯èƒ½ä¼šè§‰å¾—å¤šçº¿ç¨‹ã€ç½‘ç»œç¼–ç¨‹æœ‰ç‚¹éš¾åº¦ï¼Œå°¤å…¶æ˜¯â€œå¹¶å‘â€â€œSocketè¿æ¥â€çš„é€»è¾‘ï¼Œå®¹æ˜“æ··æ·†æ­¥éª¤â€”â€”æ²¡å…³ç³»ï¼Œå¤šåŠ¨æ‰‹ç»ƒä¹ ï¼Œå…ˆæŒæ¡åŸºç¡€ç”¨æ³•ï¼Œå†é€æ­¥ç†è§£åŸç†ï¼Œé‡ç‚¹æ˜¯èƒ½ç‹¬ç«‹å†™å‡ºå¯è¿è¡Œçš„å®æˆ˜ä»£ç ï¼Œå·©å›ºåŸºç¡€ã€‚</p>
<p>åˆ°è¿™é‡Œï¼ŒPython3åŸºç¡€å­¦ä¹ çš„ä¸ƒä¸ªé˜¶æ®µå°±å…¨éƒ¨ç»“æŸäº†ï¼é€šè¿‡è¿™ä¸ƒä¸ªé˜¶æ®µçš„å­¦ä¹ ï¼Œä½ å·²ç»æŒæ¡äº†Pythonçš„æ ¸å¿ƒåŸºç¡€è¯­æ³•ã€æ¨¡å—åŒ–ç¼–ç¨‹ã€é¢å‘å¯¹è±¡ã€å®æˆ˜å·¥å…·ã€ç½‘ç»œä¸å¹¶å‘åŸºç¡€ï¼Œå…·å¤‡äº†ç‹¬ç«‹ç¼–å†™ç®€å•Pythoné¡¹ç›®çš„èƒ½åŠ›ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œä½ å¯ä»¥å°è¯•æŒ‘æˆ˜ç®€å•çš„å®æˆ˜é¡¹ç›®ï¼ˆæ¯”å¦‚å­¦ç”Ÿç®¡ç†ç³»ç»Ÿã€é€šè®¯å½•ã€ç®€æ˜“çˆ¬è™«ã€éªŒè¯ç ç”Ÿæˆå™¨ï¼‰ï¼Œå°†ä¸ƒä¸ªé˜¶æ®µçš„çŸ¥è¯†ç»¼åˆè¿ç”¨ï¼ŒæŸ¥æ¼è¡¥ç¼ºã€‚åç»­æˆ‘ä»¬è¿˜ä¼šè¿›å…¥Pythonè¿›é˜¶å­¦ä¹ é˜¶æ®µï¼Œå­¦ä¹ æ›´å¤æ‚çš„æ¡†æ¶ã€é¡¹ç›®å¼€å‘æŠ€å·§ï¼Œç»§ç»­åŠ æ²¹ï¼Œä½ å·²ç»ç¦»â€œåˆæ ¼çš„Pythonå¼€å‘è€…â€è¶Šæ¥è¶Šè¿‘å•¦ï½</p>
<hr/>
<p><em>è½¬å‘è¯·æºå¸¦ä½œè€…ä¿¡æ¯</em>  <strong>@æ€’æ”¾å§å¾·å¾· @ä¸€ä¸ªæœ‰æ¢¦æœ‰æˆçš„äºº</strong><br/>
æŒç»­åˆ›ä½œå¾ˆä¸å®¹æ˜“ï¼Œä½œè€…å°†ä»¥å°½å¯èƒ½çš„è¯¦ç»†æŠŠæ‰€å­¦çŸ¥è¯†åˆ†äº«å„ä½å¼€å‘è€…ï¼Œä¸€èµ·è¿›æ­¥ä¸€èµ·å­¦ä¹ ã€‚<strong>è½¬è½½è¯·æºå¸¦é“¾æ¥ï¼Œè½¬è½½åˆ°å¾®ä¿¡å…¬ä¼—å·è¯·å‹¿é€‰æ‹©åŸåˆ›ï¼Œè°¢è°¢ï¼</strong><br/>
ğŸ‘åˆ›ä½œä¸æ˜“ï¼Œå¦‚æœ‰é”™è¯¯è¯·æŒ‡æ­£ï¼Œæ„Ÿè°¢è§‚çœ‹ï¼è®°å¾—ç‚¹èµå“¦ï¼ğŸ‘<br/>
è°¢è°¢æ”¯æŒï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OoderAgent ç›¸æ¯”ä¸»æµAgentæ¡†æ¶çš„äº”å¤§æ ¸å¿ƒç‹¬ç‰¹ä¼˜åŠ¿]]></title>    <link>https://juejin.cn/post/7603895839557730367</link>    <guid>https://juejin.cn/post/7603895839557730367</guid>    <pubDate>2026-02-09T04:49:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603895839557730367" data-draft-id="7604084016510713897" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OoderAgent ç›¸æ¯”ä¸»æµAgentæ¡†æ¶çš„äº”å¤§æ ¸å¿ƒç‹¬ç‰¹ä¼˜åŠ¿"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-02-09T04:49:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OneCodeCN"/> <meta itemprop="url" content="https://juejin.cn/user/1427583415622366"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OoderAgent ç›¸æ¯”ä¸»æµAgentæ¡†æ¶çš„äº”å¤§æ ¸å¿ƒç‹¬ç‰¹ä¼˜åŠ¿
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1427583415622366/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OneCodeCN
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T04:49:47.000Z" title="Mon Feb 09 2026 04:49:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æˆªè‡³ 2026 å¹´åˆï¼ŒooderAgentï¼ˆç‰¹åˆ«æ˜¯ Nexus / 2.0 ç‰ˆæœ¬ï¼‰åœ¨ä¼—å¤š AI Agent æ¡†æ¶ä¸­å±•ç°å‡ºæ˜¾è‘—ä¸”ç³»ç»Ÿæ€§çš„ç‹¬ç‰¹ä¼˜åŠ¿ã€‚å®ƒå¹¶éåœ¨å•ä¸€åŠŸèƒ½ä¸Šâ€œå¾®åˆ›æ–°â€ï¼Œè€Œæ˜¯ä»æ¶æ„å“²å­¦ã€èƒ½åŠ›æŠ½è±¡ã€äººæœºååŒã€ä¼ä¸šè½åœ°å››ä¸ªç»´åº¦é‡æ„äº† AI åº”ç”¨çš„å¼€å‘ä¸è¿è¡ŒèŒƒå¼ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ ooderAgent ç›¸æ¯”ä¸»æµæ¡†æ¶ï¼ˆå¦‚ LangChainã€Difyã€AutoGenã€CrewAI ç­‰ï¼‰çš„ äº”å¤§æ ¸å¿ƒç‹¬ç‰¹ä¼˜åŠ¿ï¼š</p>
<p>âœ… 1. ä»¥ Skill ä¸ºä¸­å¿ƒçš„èƒ½åŠ›æŠ½è±¡ï¼ˆè€Œé LLM ä¸ºä¸­å¿ƒï¼‰
è¿™æ˜¯æœ€æ ¹æœ¬çš„å·®å¼‚ï¼šooderAgent æŠŠ AI èƒ½åŠ›å½“ä½œâ€œå¯æ²»ç†çš„æœåŠ¡â€ï¼Œè€Œä¸æ˜¯â€œå¤§æ¨¡å‹çš„æ’ä»¶â€ã€‚
å¯¹æ¯”é¡¹   ooderAgent   å…¶ä»–æ¡†æ¶ï¼ˆLangChain/Dify ç­‰ï¼‰
æœ€å°å•å…ƒ   Skillï¼ˆAIBridgeï¼‰â€¢ å¼º Schema çº¦æŸâ€¢ ç‰ˆæœ¬ç®¡ç†â€¢ ä¸Šä¸‹æ–‡éš”ç¦»â€¢ å¯å®¡è®¡ã€å¯å›æ»š   Tool / Function / Nodeâ€¢ å¤šä¸ºå‡½æ•°åŒ…è£…â€¢ æ— æ ‡å‡†è¾“å…¥/è¾“å‡ºå¥‘çº¦â€¢ ä¾èµ–å¼€å‘è€…è‡ªå¾‹</p>
<p>èƒ½åŠ›è¾¹ç•Œ   æ”¯æŒ LLM + è§„åˆ™ + æ•°æ®åº“ + API æ··åˆæ‰§è¡Œ   å¤šæ•°ä»…å°è£… LLM è°ƒç”¨æˆ–ç®€å•å·¥å…·</p>
<p>å¤ç”¨æœºåˆ¶   é€šè¿‡ Nexus æŠ€èƒ½ä¸­å¿ƒ æ³¨å†Œã€å‘ç°ã€è®¢é˜…   æ‰‹åŠ¨å¤åˆ¶ä»£ç æˆ–ä¾èµ– LangServe</p>
<p>ğŸ’¡ ä»·å€¼ï¼šSkill æˆä¸ºä¼ä¸šæ•°å­—èµ„äº§ï¼Œå¯ç§¯ç´¯ã€æ²‰æ·€ã€å¤ç”¨ï¼Œé¿å…â€œæ¯æ¬¡é‡å†™ promptâ€ã€‚</p>
<p>âœ… 2. åŸç”Ÿ P2P åˆ†å¸ƒå¼æ¶æ„ï¼ˆæ”¯æŒè¾¹ç¼˜è‡ªæ²» + æ–­ç½‘å¯ç”¨ï¼‰
å”¯ä¸€çœŸæ­£å®ç°â€œå»ä¸­å¿ƒåŒ–ä½†å¯æ§â€çš„ä¼ä¸šçº§ Agent æ¡†æ¶ã€‚</p>
<ul>
<li>ä¸‰å±‚ P2P æ¶æ„ï¼š
<ul>
<li>End Agentï¼šéƒ¨ç½²åœ¨ä¸šåŠ¡ç»ˆç«¯ï¼ˆå¦‚å·¥å‚ PCã€é—¨åº— POSï¼‰ï¼Œæœ¬åœ°æ‰§è¡Œ Skillï¼›</li>
<li>Route Agentï¼šåŠ¨æ€è·¯ç”±é€šä¿¡ï¼Œæ”¯æŒ NAT ç©¿é€ï¼›</li>
<li>MCP Agentï¼šæä¾›å…¨å±€èƒ½åŠ›ï¼ˆæ¨¡å‹æ± ã€å®‰å…¨è®¤è¯ï¼‰ã€‚</li>
</ul>
</li>
<li>å…³é”®èƒ½åŠ›ï¼š
<ul>
<li>æ–­ç½‘ä»å¯è¿è¡Œï¼šEnd Agent ç¼“å­˜å¸¸ç”¨ Skillï¼Œç¦»çº¿å¤„ç†ä»»åŠ¡ï¼›</li>
<li>æ•°æ®ä¸å‡ºåŸŸï¼šæ•æ„Ÿæ“ä½œåœ¨æœ¬åœ°å®Œæˆï¼Œä»…åŒæ­¥ç»“æœï¼›</li>
<li>CAP å¿«é€Ÿé‡è¿ï¼šç½‘ç»œæ¢å¤åè‡ªåŠ¨çŠ¶æ€åŒæ­¥ã€‚</li>
</ul>
</li>
</ul>
<p>ğŸŒ å¯¹æ¯”ï¼šLangChainã€Difyã€FastGPT å‡ä¸ºä¸­å¿ƒåŒ–æ¶æ„ï¼Œæ–­ç½‘å³å¤±æ•ˆï¼›AutoGen ä»…ä¸ºæœ¬åœ°æ¨¡æ‹Ÿï¼Œæ— æ³•è·¨è®¾å¤‡åä½œã€‚</p>
<p>âœ… 3. A2UI + BridgeCodeï¼šAI é©±åŠ¨çš„åŠ¨æ€ UIï¼ˆä½“éªŒé©å‘½ï¼‰
è®© AI è¾“å‡ºç›´æ¥å˜æˆâ€œå¯æ“ä½œç•Œé¢â€ï¼Œè€Œéä¸€æ®µæ–‡æœ¬ã€‚</p>
<ul>
<li>
<p>ä¼ ç»Ÿæ–¹æ¡ˆï¼šLLM â†’ JSON/Markdown â†’ å‰ç«¯è§£æ â†’ æ¸²æŸ“ï¼ˆä½“éªŒå‰²è£‚ã€æ˜“å‡ºé”™ï¼‰</p>
</li>
<li>
<p>ooderAgent æ–¹æ¡ˆï¼š
// Skill è¿”å›ç»“æ„åŒ– UIComponent
return UIC.form()
.addField("orderId", "è®¢å•å·")
.addButton("submit", "ç¡®è®¤å‘è´§")
.onSubmit(handleShipping);</p>
<ul>
<li>å‰ç«¯é€šè¿‡ BridgeCode å¼•æ“ è‡ªåŠ¨æ¸²æŸ“ä¸ºè¡¨å•ã€å›¾è¡¨ã€æŒ‰é’®ï¼›</li>
<li>ç”¨æˆ·ç‚¹å‡»â€œç¡®è®¤å‘è´§â€ç›´æ¥è§¦å‘æ–° Skillï¼Œå½¢æˆé—­ç¯ã€‚</li>
</ul>
</li>
</ul>
<p>ğŸ¯ æ•ˆæœï¼šéæŠ€æœ¯äººå‘˜ä¹Ÿèƒ½é«˜æ•ˆå®Œæˆå¤æ‚ä»»åŠ¡ï¼Œå¤§å¹…æå‡ä»»åŠ¡å®Œæˆç‡ã€‚</p>
<p>âœ… 4. äººåœ¨å›è·¯ï¼ˆHuman-in-the-Loopï¼‰è‡ªåŠ¨è¿›åŒ–æœºåˆ¶
AI ç³»ç»Ÿèƒ½ä»ç”¨æˆ·ä¿®æ­£ä¸­å­¦ä¹ ï¼Œå¹¶æ²‰æ·€ä¸ºæ–°èƒ½åŠ›ã€‚</p>
<p>æµç¨‹ï¼š</p>
<ol>
<li>ç”¨æˆ·è°ƒç”¨ Skill Aï¼ˆå¦‚â€œç”Ÿæˆå‘¨æŠ¥â€ï¼‰ï¼›</li>
<li>æ‰‹åŠ¨ä¿®æ”¹ç»“æœï¼ˆè°ƒæ•´æ ¼å¼ã€è¡¥å……æ•°æ®ï¼‰ï¼›</li>
<li>ç³»ç»Ÿè‡ªåŠ¨æ•è·ä¿®æ­£è¡Œä¸ºï¼›</li>
<li>ç”Ÿæˆæ–° Skill Bï¼ˆâ€œå¸‚åœºéƒ¨å‘¨æŠ¥æ¨¡æ¿ v2â€ï¼‰ï¼›</li>
<li>ç»å®¡æ ¸åå‘å¸ƒåˆ° Nexusï¼Œä¾›å›¢é˜Ÿå¤ç”¨ã€‚</li>
</ol>
<p>ğŸ” å½¢æˆâ€œä½¿ç”¨ â†’ ä¿®æ­£ â†’ æ²‰æ·€ â†’ å¤ç”¨â€çš„æ­£å‘é£è½®ï¼Œè¿™æ˜¯ LangChain ç­‰æ¡†æ¶å®Œå…¨ä¸å…·å¤‡çš„æŒç»­è¿›åŒ–èƒ½åŠ›ã€‚</p>
<p>âœ… 5. ä¼ä¸šçº§å·¥ç¨‹å°±ç»ªï¼šå®‰å…¨ã€åˆè§„ã€å¯è§‚æµ‹
ä¸æ˜¯ Demo æ¡†æ¶ï¼Œè€Œæ˜¯ä¸ºç”Ÿäº§ç¯å¢ƒè®¾è®¡ã€‚
èƒ½åŠ›   ooderAgent å®ç°
å®‰å…¨   DID èº«ä»½ + E2EE åŠ å¯† + RBAC æƒé™ + VFS æ•°æ®æ²™ç®±</p>
<p>åˆè§„   æ“ä½œæ—¥å¿—å…¨å®¡è®¡ï¼Œæ»¡è¶³ GDPR/ç­‰ä¿è¦æ±‚</p>
<p>å¯è§‚æµ‹   OpenTelemetry å…¨é“¾è·¯è¿½è¸ªï¼ŒSkill è°ƒç”¨å¯ç›‘æ§</p>
<p>é›†æˆ   Spring Boot æ³¨è§£é©±åŠ¨ï¼Œæ— ç¼åµŒå…¥ç°æœ‰ Java ç³»ç»Ÿ</p>
<p>åè®®   MIT å¼€æºï¼Œæ— å•†ä¸šé™åˆ¶</p>
<p>ğŸ¢ è¿™ä½¿å¾— ooderAgent èƒ½çœŸæ­£è¿›å…¥é‡‘èã€æ”¿åŠ¡ã€åˆ¶é€ ç­‰å¼ºç›‘ç®¡åœºæ™¯ï¼Œè€Œå¤šæ•°å¼€æºæ¡†æ¶æ­¢æ­¥äºâ€œæŠ€æœ¯æ¼”ç¤ºâ€ã€‚</p>
<p>ğŸ†š æ¨ªå‘å¯¹æ¯”æ€»ç»“
èƒ½åŠ›ç»´åº¦   ooderAgent   LangChain   Dify/FastGPT   AutoGen
æ¶æ„æ¨¡å¼   âœ… P2P åˆ†å¸ƒå¼   âŒ ä¸­å¿ƒåŒ–   âŒ SaaS/ç§æœ‰ä¸­å¿ƒ   âš ï¸ æœ¬åœ°æ¨¡æ‹Ÿ</p>
<p>èƒ½åŠ›æŠ½è±¡   âœ… Skillï¼ˆå¯æ²»ç†èµ„äº§ï¼‰   âš ï¸ Toolï¼ˆå‡½æ•°ï¼‰   âš ï¸ Nodeï¼ˆé…ç½®å—ï¼‰   âš ï¸ Agentï¼ˆå¯¹è¯è§’è‰²ï¼‰</p>
<p>ç¦»çº¿èƒ½åŠ›   âœ… End Agent æœ¬åœ°è¿è¡Œ   âŒ ä¾èµ– LLM API   âŒ ä¾èµ–åç«¯æœåŠ¡   âœ… ä½†ä»…é™å•æœº</p>
<p>åŠ¨æ€ UI   âœ… A2UI åŸç”Ÿæ”¯æŒ   âŒ éœ€è‡ªè¡Œå®ç°   âš ï¸ å›ºå®šç»„ä»¶   âŒ æ— </p>
<p>æŒç»­è¿›åŒ–   âœ… äººåœ¨å›è·¯ â†’ æ–° Skill   âŒ æ—    âš ï¸ ä»…äººå·¥å®¡æ‰¹   âŒ æ— </p>
<p>ä¼ä¸šåˆè§„   âœ… å…¨æ ˆæ”¯æŒ   âš ï¸ éœ€è‡ªè¡Œè¡¥è¶³   âš ï¸ åŸºç¡€æ”¯æŒ   âŒ æ— </p>
<p>ğŸ¯ ç»“è®ºï¼šooderAgent çš„ç‹¬ç‰¹å®šä½</p>
<p>å®ƒä¸æ˜¯â€œå¦ä¸€ä¸ª LLM ç¼–æ’å·¥å…·â€ï¼Œè€Œæ˜¯è¯•å›¾æˆä¸ºâ€œAI åŸç”Ÿæ—¶ä»£çš„ä¼ä¸šåº”ç”¨æ“ä½œç³»ç»Ÿâ€ã€‚</p>
<ul>
<li>
<p>é€‚åˆè°ï¼š<br/>
âœ” æœ‰å¤æ‚ä¸šåŠ¡æµç¨‹çš„ä¼ä¸š<br/>
âœ” éœ€è¦ AI ä¸ç°æœ‰ç³»ç»Ÿæ·±åº¦é›†æˆ<br/>
âœ” é‡è§†å®‰å…¨ã€æ²»ç†ã€é•¿æœŸæ¼”è¿›</p>
</li>
<li>
<p>ä¸é€‚åˆè°ï¼š<br/>
âœ– åªæƒ³å¿«é€Ÿæ­ä¸ªèŠå¤©æœºå™¨äºº<br/>
âœ– å›¢é˜Ÿæ—  Java/Spring å·¥ç¨‹èƒ½åŠ›<br/>
âœ– è¿½æ±‚â€œé›¶ä»£ç â€ä½†ä¸æ„¿å®šä¹‰ä¸šåŠ¡è§„åˆ™</p>
</li>
</ul>
<p>å¦‚æœä½ æ­£åœ¨å¯»æ‰¾ä¸€ä¸ªèƒ½ä¼´éšä¼ä¸š AI æˆ˜ç•¥é•¿æœŸæ¼”è¿›ã€å¯ç§¯ç´¯æ™ºèƒ½èµ„äº§ã€æ”¯æŒè¾¹ç¼˜ä¸ä¸­å¿ƒååŒçš„æ¡†æ¶ï¼ŒooderAgent æ˜¯ç›®å‰æœ€å€¼å¾—æŠ•å…¥çš„å¼€æºé€‰é¡¹ä¹‹ä¸€ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å®æµ‹å¯ç”¨ï½œä¸€æ–‡æå®šOpenClawéƒ¨ç½²ï¼Œå…è´¹kimi-k2.5+é£ä¹¦è¿œç¨‹ï¼Œæ–°æ‰‹ä¹Ÿèƒ½ç§’ä¸Šæ‰‹]]></title>    <link>https://juejin.cn/post/7604093823958040595</link>    <guid>https://juejin.cn/post/7604093823958040595</guid>    <pubDate>2026-02-09T02:05:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604093823958040595" data-draft-id="7604084016510091305" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å®æµ‹å¯ç”¨ï½œä¸€æ–‡æå®šOpenClawéƒ¨ç½²ï¼Œå…è´¹kimi-k2.5+é£ä¹¦è¿œç¨‹ï¼Œæ–°æ‰‹ä¹Ÿèƒ½ç§’ä¸Šæ‰‹"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½,LLM,NVIDIA"/> <meta itemprop="datePublished" content="2026-02-09T02:05:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Lethehong"/> <meta itemprop="url" content="https://juejin.cn/user/1567216547423136"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å®æµ‹å¯ç”¨ï½œä¸€æ–‡æå®šOpenClawéƒ¨ç½²ï¼Œå…è´¹kimi-k2.5+é£ä¹¦è¿œç¨‹ï¼Œæ–°æ‰‹ä¹Ÿèƒ½ç§’ä¸Šæ‰‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1567216547423136/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Lethehong
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T02:05:41.000Z" title="Mon Feb 09 2026 02:05:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ€è¿‘äº²æµ‹å®Œæˆäº† OpenClaw çš„éƒ¨ç½²ï¼ŒæŠŠå…¨ç¨‹æ­¥éª¤æ•´ç†å‡ºæ¥åˆ†äº«ç»™å¤§å®¶ï¼Œé€‚é…ä¸­å›½å¤§é™†ç½‘ç»œç¯å¢ƒï¼Œè¿˜ä¼šæ•™å¤§å®¶é…ç½®è‹±ä¼Ÿè¾¾å…è´¹çš„ AI æ¨¡å‹ï¼ˆåŒ…å« kimi-k2.5ï¼‰ï¼Œæ‰€æœ‰ä»£ç ç›´æ¥å¤åˆ¶å°±èƒ½ç”¨ï¼Œè·Ÿç€æ­¥éª¤èµ°å…¨ç¨‹æ— å‘ï½  </p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2053e925f1240bda8ee1cdaa876b6dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGV0aGVob25n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771207540&amp;x-signature=Bpqq0kPYj9BiR4mReuAS34GmW0c%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">ç¬¬ä¸€æ­¥ï¼šç‰ˆæœ¬æ£€æµ‹ï¼Œç¡®è®¤ç³»ç»Ÿåˆå§‹çŠ¶æ€</h2>
<p>å…ˆæ£€æŸ¥æœåŠ¡å™¨é‡Œæœ‰æ²¡æœ‰è£…è¿‡ OpenClawï¼Œæˆ–è€…å®ƒçš„æ—§ç‰ˆæœ¬ Moltbot/Clawdbotï¼Œé¿å…ç‰ˆæœ¬å†²çªï¼Œç›´æ¥æ‰§è¡Œä¸‹é¢çš„æ£€æµ‹å‘½ä»¤å°±è¡Œï¼š</p>
<pre><code class="hljs language-plain" lang="plain">openclaw --version 2&gt;/dev/null &amp;&amp; echo "OpenClaw å·²å®‰è£…" || echo "æœªå®‰è£… OpenClaw"; moltbot --version 2&gt;/dev/null &amp;&amp; echo "Moltbot å·²å®‰è£…ï¼ˆæ—§ç‰ˆæœ¬ï¼‰" || echo "æœªå®‰è£… Moltbot"; clawdbot --version 2&gt;/dev/null &amp;&amp; echo "Clawdbot å·²å®‰è£…ï¼ˆæ—§ç‰ˆæœ¬ï¼‰" || echo "æœªå®‰è£… Clawdbot"
</code></pre>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b248efca82e48dbbe8fe6e07590f919~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGV0aGVob25n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771207540&amp;x-signature=D7SG0Gd16xO9TzI1ZxgBtqsBg1I%3D" alt="" loading="lazy"/></p>
<p>æˆ‘è¿™è¾¹æ£€æµ‹ç»“æœæ˜¯å•¥éƒ½æ²¡è£…ï¼Œç›´æ¥èµ°å®Œæ•´çš„éƒ¨ç½²æµç¨‹å°±å¯ä»¥ã€‚</p>
<h2 data-id="heading-1">ç¬¬äºŒæ­¥ï¼šç¯å¢ƒæ£€æµ‹ï¼Œæ ¸å¯¹æœåŠ¡å™¨é…ç½®</h2>
<p>å®‰è£…å‰å…ˆç¡®è®¤æœåŠ¡å™¨é…ç½®æ˜¯å¦è¾¾æ ‡ï¼ŒåŒæ—¶æ£€æŸ¥ Node.js å’Œ Git è¿™ä¸¤ä¸ªå¿…å¤‡ä¾èµ–æœ‰æ²¡æœ‰è£…ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ä¸€æ¬¡æ€§æ£€æµ‹æ‰€æœ‰å…³é”®æŒ‡æ ‡ï¼š</p>
<pre><code class="hljs language-plain" lang="plain">echo "=== ç¯å¢ƒæ£€æµ‹å¼€å§‹ ===" &amp;&amp; echo "1. æ“ä½œç³»ç»Ÿä¿¡æ¯ï¼š" &amp;&amp; cat /etc/os-release | grep PRETTY_NAME &amp;&amp; echo "2. CPUæ ¸å¿ƒæ•°ï¼š" &amp;&amp; nproc &amp;&amp; echo "3. å†…å­˜å¤§å°ï¼ˆMBï¼‰ï¼š" &amp;&amp; free -m | awk 'NR==2{print $2}' &amp;&amp; echo "4. ç£ç›˜å¯ç”¨ç©ºé—´ï¼š" &amp;&amp; df -h / | awk 'NR==2{print $4}' &amp;&amp; echo "5. Node.jsç‰ˆæœ¬ï¼š" &amp;&amp; node --version 2&gt;/dev/null || echo "æœªå®‰è£…" &amp;&amp; echo "6. Gitç‰ˆæœ¬ï¼š" &amp;&amp; git --version 2&gt;/dev/null || echo "æœªå®‰è£…" &amp;&amp; echo "=== ç¯å¢ƒæ£€æµ‹ç»“æŸ ==="
</code></pre>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f01a7c6b6a144178fc036a614dc9782~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGV0aGVob25n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771207540&amp;x-signature=jN5TkJ8s8uwimRZ%2FZKTK2OWvytQ%3D" alt="" loading="lazy"/></p>
<p> æˆ‘ç”¨çš„æœåŠ¡å™¨æ˜¯ Ubuntu 22.04 LTS ç³»ç»Ÿï¼Œ2 æ ¸ CPUã€1.9GB å†…å­˜ã€42GB ç£ç›˜ç©ºé—´ï¼ŒNode.js v22.22.0 å’Œ Git ä¹Ÿéƒ½æå‰è£…å¥½äº†ï¼Œå®Œå…¨æ»¡è¶³å®‰è£…è¦æ±‚ï¼Œä¸ç”¨é¢å¤–è£…ä¾èµ–ï¼Œç›´æ¥ä¸‹ä¸€æ­¥ã€‚  </p>
<h2 data-id="heading-2">ç¬¬ä¸‰æ­¥ï¼šå®‰è£… OpenClawï¼Œé€‚é…å›½å†…é•œåƒæº</h2>
<p>å› ä¸ºæ˜¯å›½å†…æœåŠ¡å™¨ï¼Œå…ˆé…ç½®å›½å†…çš„é•œåƒæºé¿å…ä¸‹è½½å¡é¡¿ï¼Œæœ¬æ¥è¯•äº† yarn å®‰è£…ï¼Œåæ¥è§‰å¾— npm æ›´ç¨³å®šå¯é ï¼Œå°±ç›´æ¥ç”¨ npm è£…äº†ï¼Œå…ˆè®¾è…¾è®¯äº‘çš„ npm é•œåƒï¼Œå†å…¨å±€å®‰è£…æœ€æ–°ç‰ˆ OpenClawï¼Œæ‰§è¡Œè¿™æ¡å‘½ä»¤å°±è¡Œï¼š</p>
<pre><code class="hljs language-plain" lang="plain">npm config set registry https://mirrors.cloud.tencent.com/npm/ &amp;&amp; npm install -g openclaw@latest
</code></pre>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c982002be94b4950b1420ad149588c09~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGV0aGVob25n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771207540&amp;x-signature=MJx%2FfCduKKuK4OpOEksQWmlB%2Bw0%3D" alt="" loading="lazy"/></p>
<p>å®‰è£…è¿‡ç¨‹ä¼šè‡ªåŠ¨è£… 700 å¤šä¸ªåŒ…ï¼Œä¸­é—´ä¼šå‡ºå‡ ä¸ªè¿‡æ—¶åŒ…çš„è­¦å‘Šï¼Œä¸ç”¨ç®¡ï¼Œä¸å½±å“æ­£å¸¸ä½¿ç”¨ï¼Œç­‰å¾…å®‰è£…å®Œæˆå°±å¥½ã€‚</p>
<h2 data-id="heading-3">ç¬¬å››æ­¥ï¼šéªŒè¯å®‰è£…ï¼Œç¡®è®¤ OpenClaw å¯ç”¨</h2>
<p>è£…å®Œä¹‹åä¸€å®šè¦æ£€æŸ¥ä¸‹ç‰ˆæœ¬ï¼Œç¡®è®¤å®‰è£…æˆåŠŸï¼Œå‘½ä»¤å¾ˆç®€å•ï¼š</p>
<pre><code class="hljs language-plain" lang="plain">openclaw --version
</code></pre>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c58aeb0afe144ae946a25999d020adb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGV0aGVob25n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771207540&amp;x-signature=DX%2BVbnD7FDPbw0TI9ZnsZ6p483g%3D" alt="" loading="lazy"/></p>
<p>æˆ‘è¿™è¾¹æˆåŠŸè£…åˆ°äº† 2026.2.2-3 ç‰ˆæœ¬ï¼Œåˆ°è¿™ä¸€æ­¥ OpenClaw å°±è£…å¥½äº†ï½</p>
<h2 data-id="heading-4">é‡ç‚¹æ­¥éª¤ï¼šé…ç½®è‹±ä¼Ÿè¾¾å…è´¹ AI æ¨¡å‹ï¼ˆå« kimi-k2.5ï¼‰</h2>
<p>è¿™ä¸€æ­¥æ•™å¤§å®¶ç™½å«–è‹±ä¼Ÿè¾¾çš„å…è´¹ AI æ¨¡å‹ï¼Œé‡Œé¢åŒ…å« kimi-k2.5ï¼Œè·Ÿç€ä¸‰æ­¥æ¥å°±è¡Œï¼Œå…¨ç¨‹å…è´¹ï¼š</p>
<h3 data-id="heading-5">1. æ³¨å†Œè‹±ä¼Ÿè¾¾è´¦å·å¹¶è·å– API Key</h3>
<p>å…ˆæ‰“å¼€è‹±ä¼Ÿè¾¾çš„åœ°å€æ³¨å†Œï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fbuild.nvidia.com%2F" target="_blank" title="https://build.nvidia.com/" ref="nofollow noopener noreferrer">build.nvidia.com/</a>ï¼Œå»ºè®®ç”¨è°·æ­Œè´¦å·ç›´æ¥ç™»å½•ï¼Œæ–¹ä¾¿å¿«æ·ï¼›ç™»å½•åç‚¹å·¦ä¸Šè§’çš„å¤´åƒï¼Œæ–°å»ºä¸€ä¸ªä¸“å±çš„ API Keyï¼Œä¿å­˜å¥½åˆ«å¼„ä¸¢äº†ã€‚</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/292b336ef61e4791b7ac89cb9d1fceda~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGV0aGVob25n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771207540&amp;x-signature=Wx%2FNJdVnWRtpFfc9V1avOSAEyeA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">2. ä¿®æ”¹ OpenClaw é…ç½®æ–‡ä»¶</h3>
<p>éœ€è¦æ‰“å¼€ OpenClaw çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨æŒ‡å®šä½ç½®æ·»åŠ è‹±ä¼Ÿè¾¾æ¨¡å‹çš„é…ç½®ï¼Œ<strong>é‡ç‚¹æ³¨æ„</strong>ï¼šproviders å¤–é¢è¦åŒ…ä¸€å±‚ modelsï¼Œå¦‚æœæ–‡ä»¶é‡Œæœ¬æ¥å°±æœ‰ modelsï¼Œç›´æ¥åŠ è¿›åŸæœ‰å†…å®¹é‡Œå°±è¡Œï¼Œå…¶ä»–ä»£ç åƒä¸‡åˆ«æ”¹ï¼æ‰§è¡Œå‘½ä»¤æ‰“å¼€é…ç½®æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-plain" lang="plain">vi ~/.openclaw/openclaw.json  
</code></pre>
<p>ç„¶ååœ¨ models éƒ¨åˆ†æ·»åŠ ä¸‹é¢çš„ä»£ç ï¼Œè®°å¾—æŠŠé‡Œé¢çš„ apiKey æ¢æˆä½ è‡ªå·±åˆšåˆ›å»ºçš„ï¼š</p>
<pre><code class="hljs language-plain" lang="plain">å¸®æˆ‘æ‰“å¼€ ~/.openclaw/openclaw.jsonæ–‡ä»¶ï¼Œåœ¨ models éƒ¨åˆ†å¢åŠ ä¸‹é¢çš„ä»£ç ï¼Œæ³¨æ„ï¼šproviders å¤–é¢è¿˜è¦åŠ ä¸€å±‚ modelsï¼Œå¦‚æœåŸæ¥é…ç½®æœ‰modelså°±åŠ åˆ°åŸæ¥çš„é‡Œé¢
{
  ... å…¶ä»–å†…å®¹ä¸è¦æ”¹
  "models": {
   "providers":{
        "è‹±ä¼Ÿè¾¾nvidia": {
            "baseUrl": "https://integrate.api.nvidia.com/v1",
            "apiKey": "nvapi-HxKN8Zp2-xxxxx-æ›¿æ¢æˆä½ çš„ key,
            "api": "openai-completions",
            "models": [
              {
                "id": "moonshotai/kimi-k2.5",
                "name": "moonshotai/kimi-k2.5",
                "reasoning": false,
                "input": [
                  "image",
                  "text"
                ],
                "cost": {
                  "input": 0,
                  "output": 0,
                  "cacheRead": 0,
                  "cacheWrite": 0
                },
                "contextWindow": 200000,
                "maxTokens": 8192
              }
            ]
        }
        ... å…¶ä»–å†…å®¹ä¸è¦æ”¹
    }
    ... å…¶ä»–å†…å®¹ä¸è¦æ”¹
  }
}
</code></pre>
<h3 data-id="heading-7">3. è¿è¡Œé…ç½®å‘å¯¼ï¼Œå®Œæˆå‰©ä½™è®¾ç½®</h3>
<p>æ¨¡å‹é…ç½®å¥½åï¼Œè¿è¡Œ OpenClaw çš„é…ç½®å‘å¯¼ï¼Œè·Ÿç€æç¤ºå®Œæˆå…¶ä»–åŸºç¡€è®¾ç½®å°±è¡Œï¼š</p>
<pre><code class="hljs language-plain" lang="plain">openclaw onboard
</code></pre>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca0b966cfd8e4e6c90fdf814e07cdfe4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGV0aGVob25n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771207540&amp;x-signature=3yswGF1z2uzjrc7392VvMtZRDlI%3D" alt="" loading="lazy"/></p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/314adb61460d41afbb889c5cabfbd666~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGV0aGVob25n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771207540&amp;x-signature=dFLzqSdedjaUVEoeVSAti0DgEso%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">ä¿®å¤å®‰å…¨æƒé™è­¦å‘Š</h2>
<p>é…ç½®å®Œä¼šå‡ºç°å®‰å…¨æƒé™çš„è­¦å‘Šï¼Œç”¨ä¸‹é¢çš„å‘½ä»¤ä¿®å¤ä¸€ä¸‹ï¼Œç»™é…ç½®ç›®å½•è®¾ç½®ä¸“å±æƒé™ï¼Œæ‰§è¡Œåä¼šæç¤ºä¿®å¤å®Œæˆï¼š</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88ca4d56405f47c5b6e495740e69451d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGV0aGVob25n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771207540&amp;x-signature=Ha9iQe038qL9waz4dMNayXBvt1M%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-plain" lang="plain">chmod 700 /root/.openclaw &amp;&amp; echo "å®‰å…¨æƒé™å·²ä¿®å¤"
</code></pre>
<h2 data-id="heading-9">æœ€åä¸€æ­¥ï¼šå¯åŠ¨ OpenClaw æ ¸å¿ƒç½‘å…³æœåŠ¡</h2>
<p>æ‰€æœ‰é…ç½®å’Œä¿®å¤éƒ½å®Œæˆåï¼Œé‡å¯ OpenClaw çš„ç½‘å…³æœåŠ¡</p>
<pre><code class="hljs language-plain" lang="plain">openclaw gateway restart
</code></pre>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfae565b3df748eaa929b950ffcbc4bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGV0aGVob25n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771207540&amp;x-signature=jte3CzAXpWjVGhfmpMUQRgqVhkc%3D" alt="" loading="lazy"/></p>
<p>åˆ°è¿™é‡Œï¼ŒOpenClaw å°±å®Œæˆå…¨éƒ¨éƒ¨ç½²å’Œé…ç½®äº†ï¼Œå¯åŠ¨ç½‘å…³æœåŠ¡åå°±èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œè¿˜èƒ½ç›´æ¥è°ƒç”¨è‹±ä¼Ÿè¾¾å…è´¹çš„ kimi-k2.5 æ¨¡å‹ï¼Œäº²æµ‹å…¨ç¨‹æµç•…ï¼Œæœ‰é—®é¢˜çš„å°ä¼™ä¼´å¯ä»¥ç•™è¨€äº¤æµï½</p>
<p>æ¥ä¸‹æ¥å¯åŠ¨ç½‘å…³å¹¶æµ‹è¯•æ¨¡å‹ï¼Œæ­¥éª¤è¶…ç®€å•ï¼šå…ˆæ‰§è¡Œ<code>openclaw gateway --force</code>é‡å¯ç½‘å…³æœåŠ¡ï¼Œå†è¾“å…¥<code>openclaw tui</code>æ‰“å¼€äº¤äº’æµ‹è¯•ç•Œé¢ï¼Œæœ€åç›´æ¥é—®ä¸€å¥ã€Œä½ æ˜¯å¹²å˜›çš„ã€ï¼Œå°±èƒ½éªŒè¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆå•¦ã€‚</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b6d7f9824634dcabdde5a5bff5d951d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGV0aGVob25n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771207540&amp;x-signature=juw%2BnO3bVDKUkoIH2WcHKnnsY8c%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-10">è¿›é˜¶å®æ“ï¼šæ¥å…¥é£ä¹¦ï¼Œå®ç°æ‰‹æœºè¿œç¨‹æ“æ§ï¼ˆå¿…çœ‹ï¼ï¼‰</h2>
<p>ä½œä¸ºAIç©å®¶ï¼Œæˆ‘å¿…é¡»è¯´ä¸€å¥ï¼šæœ¬åœ°è¿è¡Œå¤Ÿç”¨ï¼Œä½†è¿œç¨‹æ“æ§æ‰æ˜¯ç²¾é«“ï¼å®ˆåœ¨ç”µè„‘å‰å¤ªæŸç¼šï¼Œæ¥å…¥é£ä¹¦ï¼ˆLarkï¼‰åï¼Œæ‰‹æœºæ£å…œé‡Œï¼Œéšæ—¶éšåœ°ç»™å®¶é‡Œ/æœåŠ¡å™¨çš„OpenClawä¸‹æŒ‡ä»¤ï¼Œèººå¹³æ“ä½œä¸é¦™å—ï¼ŸğŸ¤« è¿™éƒ¨åˆ†æˆ‘æŠŠè‡ªå·±è¸©è¿‡çš„å‘éƒ½æ ‡å‡ºæ¥äº†ï¼Œè·Ÿç€æˆ‘çš„æ­¥éª¤èµ°ï¼Œé›¶å¤±è´¥ï¼</p>
<p>å…ˆæé£ä¹¦å¼€æ”¾å¹³å°çš„åŸºç¡€é…ç½®ï¼Œæ‰“å¼€è¿™ä¸ªåœ°å€ï¼š<a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">open.feishu.cn/app</a>ï¼Œç‚¹å‡»â€œæ–°å»ºåº”ç”¨â€ï¼Œé¡µé¢ä¸Šçš„åŸºç¡€ä¿¡æ¯ï¼ˆåº”ç”¨åç§°ã€æè¿°ä¹‹ç±»çš„ï¼‰éšä¾¿å¡«ï¼Œä¸ç”¨çº ç»“ï¼Œå¡«å®Œä¿å­˜å°±è¡Œï¼Œå…¨ç¨‹è·Ÿç€é¡µé¢æç¤ºèµ°ï¼Œæ²¡æœ‰å¤æ‚æ“ä½œï¼Œæ–°æ‰‹ä¹Ÿèƒ½ç§’ä¸Šæ‰‹ã€‚</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a75c2b1eafe2476e965de3c09cddaf68~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGV0aGVob25n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771207540&amp;x-signature=9zT0siac10We1nGH%2FJXBlEtnVL4%3D" alt="" loading="lazy"/>å…³é”®ä¸€æ­¥ï¼šæ–°å»ºåº”ç”¨åï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆã€ŒApp IDã€å’Œã€ŒApp Secretã€ï¼Œè¿™ä¿©æ˜¯é£ä¹¦å’ŒOpenClawå¯¹æ¥çš„â€œé’¥åŒ™â€ï¼Œä¸€å®šè¦å¤åˆ¶ä¿å­˜å¥½ï¼Œæœ€å¥½å­˜åˆ°è®°äº‹æœ¬é‡Œï¼Œä¸¢äº†å°±å¾—é‡æ–°åˆ›å»ºåº”ç”¨ï¼Œå·¨æµªè´¹æ—¶é—´ï¼æˆ‘ç¬¬ä¸€æ¬¡å°±å¿˜å­˜ï¼Œè¿”å·¥åŠå°æ—¶è°æ‡‚å•Šâ€¦</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d1aa9383fdc45d8b9b9c979fb30732d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGV0aGVob25n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771207540&amp;x-signature=ydv2j2GKk8r0FW3kXVCYswZ%2BFDk%3D" alt="" loading="lazy"/></p>
<p>å›åˆ°åº”ç”¨é…ç½®é¡µï¼Œæ‰¾åˆ°ã€Œæ·»åŠ åº”ç”¨èƒ½åŠ›ã€é€‰é¡¹ï¼Œç‚¹å¼€åç›´æ¥é€‰ã€Œæœºå™¨äººã€ï¼Œç‚¹å‡»â€œæ·»åŠ â€å°±å®Œäº‹ï¼Œä¸ç”¨é¢å¤–å‹¾é€‰å…¶ä»–ä¸œè¥¿ï¼Œå¤šä½™æ“ä½œåè€Œå®¹æ˜“å‡ºé—®é¢˜ã€‚</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15b95bfd81fa411e9db3f946bb18e200~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGV0aGVob25n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771207540&amp;x-signature=37aJTxQuzGVt8%2B3NXPkHUmDgFkw%3D" alt="" loading="lazy"/></p>
<p>é¿å‘é‡ç‚¹ï¼ˆæ•²é»‘æ¿ï¼ï¼‰ï¼šç»™åˆšæ·»åŠ çš„æœºå™¨äººï¼Œå¼€é€šã€Œå…¨éƒ¨æƒé™ã€ï¼æ²¡é”™ï¼Œæ˜¯å…¨éƒ¨ï¼Œä¸€ä¸ªéƒ½åˆ«æ¼ï¼æˆ‘ç¬¬ä¸€æ¬¡å›¾çœäº‹æ¼å‹¾äº†ä¸¤ä¸ªï¼Œç»“æœåé¢å¯¹æ¥ä¸€ç›´å¤±è´¥ï¼Œæ’æŸ¥äº†åŠå¤©æ‰å‘ç°æ˜¯æƒé™ä¸å¤Ÿï¼Œè¡€çš„æ•™è®­ï¼</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2bca473d6f94b178cd5c8c54e3fff5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGV0aGVob25n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771207540&amp;x-signature=JWj8kR5%2FifbEsTAkbLthsM4NuAw%3D" alt="" loading="lazy"/></p>
<p>æƒé™æå®šï¼Œå°±è¯¥è£…å¯¹æ¥æ’ä»¶äº†â€”â€”è¿™ä¸ªæ’ä»¶æ˜¯é£ä¹¦å’ŒOpenClawçš„â€œæ¡¥æ¢â€ï¼Œæ²¡æœ‰å®ƒä¿©å°±æ— æ³•é€šä¿¡ï¼Œç›´æ¥å¤åˆ¶ä¸‹é¢çš„å‘½ä»¤å®‰è£…ï¼Œæ³¨æ„åˆ«æ‰‹æ»‘è¾“é”™å­—ç¬¦ï¼š</p>
<pre><code class="hljs language-plain" lang="plain">openclaw plugins install @m1heng-clawd/feishu
</code></pre>
<p>æ’ä»¶å®‰è£…å®Œæˆï¼Œæ¥ä¸‹æ¥æŠŠä¹‹å‰ä¿å­˜çš„ã€ŒApp IDã€å’Œã€ŒApp Secretã€é…ç½®è¿›å»ï¼Œä¸‰æ¡å‘½ä»¤ä¾æ¬¡æ‰§è¡Œï¼Œé‡ç‚¹æé†’ï¼šæŠŠå‘½ä»¤é‡Œçš„â€œcli_xxxxxâ€å’Œâ€œyour_app_secretâ€ï¼Œæ›¿æ¢æˆä½ è‡ªå·±çš„ï¼Œåˆ«ç›´æ¥å¤åˆ¶è¿è¡Œï¼å¦åˆ™ä¼šæŠ¥é”™ï¼Œè¿˜å¾—é‡å¯ç½‘å…³é‡æ¥ï¼</p>
<pre><code class="hljs language-plain" lang="plain">openclaw config set channels.feishu.appId "cli_xxxxx"   #æ¢ä¸ºä½ è‡ªå·±åœ¨æ­¥éª¤2å¾—åˆ°çš„
openclaw config set channels.feishu.appSecret "your_app_secret"  #æ¢ä¸ºä½ è‡ªå·±åœ¨æ­¥éª¤2å¾—åˆ°çš„
openclaw config set channels.feishu.enabled true
</code></pre>
<p>é…ç½®ç”Ÿæ•ˆçš„å…³é”®ï¼šé‡å¯ç½‘å…³ï¼æ‰§è¡Œä¸‹é¢è¿™æ¡å‘½ä»¤ï¼Œé‡å¯å®Œæˆåï¼Œé…ç½®æ‰ä¼šçœŸæ­£ç”Ÿæ•ˆï¼Œåˆ«å·æ‡’è·³è¿‡è¿™ä¸€æ­¥ï¼š</p>
<pre><code class="hljs language-plain" lang="plain">openclaw gateway restart
</code></pre>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93bf101fa2be4b08ba34c9fff12ec250~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGV0aGVob25n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771207540&amp;x-signature=Ms1RbbV00pve%2B6rjjtqTpKtwlXs%3D" alt="" loading="lazy"/></p>
<p>å†å›åˆ°é£ä¹¦å¼€æ”¾å¹³å°ï¼Œæ‰¾åˆ°ã€Œäº‹ä»¶ä¸å›è°ƒã€â€”â€”è¿™ä¸¤ä¸ªé€‰é¡¹ç¼ºä¸€ä¸å¯ï¼Œå¿…é¡»éƒ½é…ç½®å¥½ï¼ç„¶ååœ¨å›è°ƒæ–¹å¼é‡Œï¼Œé€‰æ‹©ã€Œé•¿è¿æ¥ã€ï¼Œä¿å­˜å³å¯ã€‚å¦‚æœæç¤ºè¿æ¥å¤±è´¥ï¼Œä¸ç”¨æ…Œï¼Œå¤§æ¦‚ç‡æ˜¯ä¸Šä¸€æ­¥ç½‘å…³æ²¡é‡å¯åˆ°ä½ï¼Œå›å»å†æ‰§è¡Œä¸€æ¬¡é‡å¯å‘½ä»¤ï¼ŒåŸºæœ¬éƒ½èƒ½è§£å†³ï¼Œæˆ‘äº²æµ‹è¿‡ä¸‰æ¬¡ï¼Œéƒ½æ˜¯è¿™ä¸ªé—®é¢˜ï¼</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4640228cb82b4639826b0eaf8ef33204~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGV0aGVob25n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771207540&amp;x-signature=R3Gn6rGWZLdt01Kdb1QHvdRjf%2FY%3D" alt="" loading="lazy"/></p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7439c92265c34dff9c5da36b9ee63c52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGV0aGVob25n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771207540&amp;x-signature=6HUxYCXEMW7j6ZiEPnkLBtq%2FAcg%3D" alt="" loading="lazy"/></p>
<p>è¿˜æœ‰ä¸€ä¸ªç»†èŠ‚ï¼šæ·»åŠ äº‹ä»¶çš„æ—¶å€™ï¼ŒæŠŠé‡Œé¢æ‰€æœ‰çš„äº‹ä»¶éƒ½å‹¾é€‰ä¸Šï¼Œåˆ«æ¼ä¸€ä¸ªï¼å°‘å‹¾ä¸€ä¸ªäº‹ä»¶ï¼Œåé¢é£ä¹¦å°±å¯èƒ½æ— æ³•æ­£å¸¸æ¥æ”¶/æ‰§è¡ŒæŒ‡ä»¤ï¼Œæ¯”å¦‚æ²¡æ³•è¿œç¨‹ä¸‹è¾¾æ“ä½œå‘½ä»¤ï¼Œåˆ°æ—¶å€™åˆå¾—å›å¤´æ’æŸ¥ï¼Œå¾—ä¸å¿å¤±ã€‚</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3511fbbcfa814d44b27fa558d243cf70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGV0aGVob25n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771207540&amp;x-signature=656K8aXYRXZyVOx3dlKXW8Nu3Qs%3D" alt="" loading="lazy"/></p>
<p>æœ€åä¸€æ­¥ï¼Œå‘å¸ƒæ’ä»¶æ‰èƒ½ç”¨ï¼ç‚¹å‡»å·¦ä¾§èœå•æ çš„ã€Œç‰ˆæœ¬ç®¡ç†ä¸å‘å¸ƒã€ï¼Œå…ˆç‚¹å‡»ã€Œåˆ›å»ºç‰ˆæœ¬ã€ï¼Œä¸ç”¨æ”¹å…¶ä»–è®¾ç½®ï¼Œç›´æ¥æäº¤ï¼Œç„¶åç‚¹å‡»ã€Œç”³è¯·å‘å¸ƒã€ï¼Œé£ä¹¦çš„å®¡æ ¸å¾ˆå¿«ï¼Œå‡ åˆ†é’Ÿå°±é€šè¿‡ï¼Œå‘å¸ƒå®Œæˆåï¼Œæ’ä»¶å°±æ­£å¼ç”Ÿæ•ˆäº†ã€‚</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a82bcfc55dd4571a2a87ac89c44c6ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGV0aGVob25n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771207540&amp;x-signature=RVCMUcSPj%2BrUrJtvlmGhPrx2iR8%3D" alt="" loading="lazy"/></p>
<p>å¤§åŠŸå‘Šæˆï¼æ‰“å¼€ä½ æ‰‹æœºä¸Šçš„é£ä¹¦ï¼Œæ‰¾åˆ°åˆšæ‰åˆ›å»ºçš„é‚£ä¸ªæœºå™¨äººï¼Œå‘é€æ¶ˆæ¯å°±èƒ½æµ‹è¯•ï¼Œæ¯”å¦‚ä¹‹å‰æ•™çš„â€œä½ æ˜¯ä»€ä¹ˆæ¨¡å‹â€ï¼Œå°±èƒ½è¿œç¨‹æ“æ§OpenClawæ‰§è¡ŒæŒ‡ä»¤ï¼Œå†ä¹Ÿä¸ç”¨å®ˆåœ¨ç”µè„‘å‰ï¼Œéšæ—¶éšåœ°éƒ½èƒ½æ“ä½œï¼Œè¿™æ‰æ˜¯OpenClawçš„æ­£ç¡®æ‰“å¼€æ–¹å¼å•Šï¼</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f58e041101e64393892344c309e0eb99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGV0aGVob25n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771207540&amp;x-signature=7qWRcMbzZkEqUJ8%2FLab2sJ9wxX4%3D" alt="" loading="lazy"/></p>
<p>åˆ°è¿™é‡Œï¼ŒOpenClawçš„å®Œæ•´éƒ¨ç½²ã€è‹±ä¼Ÿè¾¾å…è´¹æ¨¡å‹é…ç½®ï¼Œè¿˜æœ‰é£ä¹¦è¿œç¨‹æ“æ§æ¥å…¥ï¼Œå°±å…¨éƒ¨å®Œæˆäº†ï¼å…¨ç¨‹äº²æµ‹æµç•…æ— bugï¼Œæ¯ä¸€æ­¥éƒ½æ ‡äº†é¿å‘ç‚¹ï¼Œæ–°æ‰‹ä¹Ÿèƒ½è½»æ¾ä¸Šæ‰‹ã€‚å¦‚æœæ“ä½œä¸­é‡åˆ°é—®é¢˜ï¼Œè¯„è®ºåŒºç•™è¨€ï¼Œæˆ‘çœ‹åˆ°éƒ½ä¼šå›å¤ï¼Œä¸€èµ·äº¤æµä¸€èµ·æŠ˜è…¾ï½</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç¬¬äºŒç« : å›¾åƒå¤„ç†åŸºæœ¬æ“ä½œ]]></title>    <link>https://juejin.cn/post/7603854784865779752</link>    <guid>https://juejin.cn/post/7603854784865779752</guid>    <pubDate>2026-02-09T02:46:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603854784865779752" data-draft-id="7604045354070097954" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç¬¬äºŒç« : å›¾åƒå¤„ç†åŸºæœ¬æ“ä½œ"/> <meta itemprop="keywords" content="ç®—æ³•"/> <meta itemprop="datePublished" content="2026-02-09T02:46:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å®è´å„¿å¥½"/> <meta itemprop="url" content="https://juejin.cn/user/2737129399522635"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç¬¬äºŒç« : å›¾åƒå¤„ç†åŸºæœ¬æ“ä½œ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2737129399522635/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å®è´å„¿å¥½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T02:46:30.000Z" title="Mon Feb 09 2026 02:46:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">ç¬¬äºŒç« : å›¾åƒå¤„ç†åŸºæœ¬æ“ä½œ</h3>
<h4 data-id="heading-1">ä¸€ã€å›¾åƒçš„è¡¨ç¤ºæ–¹æ³•</h4>
<ul>
<li><strong>äºŒå€¼å›¾åƒï¼š</strong> æ¯ä¸ªåƒç´ ç‚¹ä¸æ˜¯ç™½è‰²å°±æ˜¯é»‘è‰²ï¼›ä¸€ä¸ªåƒç´ ç‚¹åªè¦ä¸€ä¸ªbitä½å°±èƒ½è¡¨ç¤ºï¼›ç”¨0æˆ–1è¡¨ç¤ºæ¯ä¸ªåƒç´ ç‚¹ã€‚</li>
<li><strong>ç°åº¦å›¾åƒï¼š</strong> å›¾åƒåªæœ‰ä¸€ç§é¢œè‰²ï¼Œæ¯”å¦‚å›¾åƒå¯ä»¥æ˜¯çº¢è‰²ï¼Œå¯ä»¥æ˜¯ç°è‰²ï¼Œå¯ä»¥è“è‰²ï¼Œå¯ä»¥æ˜¯ç»¿è‰²ç­‰ç­‰ï¼Œä½†ä¸ç®¡ä»€ä¹ˆé¢œè‰²éƒ½æ˜¯åªæœ‰ä¸€ç§é¢œè‰²ã€‚ä½†æ˜¯è¿™ä¸€ç§é¢œè‰²æˆ‘ä»¬ç»™å®ƒåˆ†æˆäº†256ä¸ªç­‰çº§ï¼Œå°±æ˜¯256ä¸ªç°åº¦çº§ï¼Œå¯ä»¥ç†è§£æˆ256ä¸ªä¸åŒç¨‹åº¦çš„æ˜æš—åº¦ã€‚æ¯”å¦‚ä¸€å¼ çº¢è‰²çš„ç°åº¦å›¾åƒï¼Œåƒç´ å€¼=0å°±æ˜¯æœ€æš—ï¼Œé»‘è‰²ï¼Œåƒç´ å€¼=255å°±æ˜¯æœ€äº®ï¼Œå°±æ˜¯æœ€äº®çš„çº¢è‰²ã€‚255ä¸­æ˜æš—åº¦æ­£å¥½å¯ä»¥ç”¨8ä½ä¹Ÿå°±æ˜¯1å­—èŠ‚byteè¡¨ç¤ºã€‚</li>
<li><strong>å½©è‰²å›¾åƒï¼š</strong> å›¾åƒæ˜¯å½©è‰²çš„ï¼Œå›¾åƒçš„æ¯ä¸ªåƒç´ ç‚¹éƒ½æ˜¯ç”±ä¸‰ç§é¢œè‰²æ··åˆè€Œæˆã€‚è¿™ä¸‰ç§é¢œè‰²æ˜¯R G B, æ¯ç§é¢œè‰²çš„å–å€¼éƒ½åœ¨0-255ä¹‹é—´ã€‚æ¯ç§é¢œè‰²æ˜¯ä¸€ä¸ªé€šé“ï¼Œæ‰€ä»¥å½©å›¾ä¸€èˆ¬éƒ½æ˜¯3é€šé“ã€‚å°‘æ•°å›¾åƒæ˜¯4é€šé“ï¼Œå› ä¸ºè¿˜æœ‰ä¸€ä¸ª0-1ä¹‹é—´çš„é€æ˜åº¦ã€‚</li>
</ul>
<h4 data-id="heading-2">äºŒã€åƒç´ å¤„ç†</h4>
<pre><code class="hljs language-scss" lang="scss">#ä¾‹<span class="hljs-number">2.1</span> ç”Ÿæˆä¸€ä¸ª<span class="hljs-number">10</span>x10å¤§å°çš„é»‘è‰²å›¾åƒï¼Œå¹¶ä¸”å¯¹å…¶åƒç´ è¿›è¡Œä¿®æ”¹ï¼Œæ˜¾ç¤ºä¿®æ”¹å‰åçš„å›¾åƒï¼Œç†è§£æ•°æ®å’Œå›¾åƒä¹‹é—´çš„ä¸€ä¸€å¯¹åº”å…³ç³»ã€‚
import cv2
import numpy as np
<span class="hljs-selector-tag">img</span> = np<span class="hljs-selector-class">.zeros</span>((<span class="hljs-number">10</span>,<span class="hljs-number">10</span>), dtype=np<span class="hljs-selector-class">.uint8</span>)
<span class="hljs-built_in">print</span>('è¯·çœ‹ä¸‹é¢å›¾åƒæ•°æ®é•¿çš„æ ·å­å§ï¼š\n', img, '\n')   #\nè¡¨ç¤ºå›è½¦é‡å¯ä¸€è¡Œ
cv2<span class="hljs-selector-class">.imshow</span>('one', img)         #å›¾åƒçª—å£æ˜¾ç¤ºå›¾åƒ
<span class="hljs-selector-tag">img</span><span class="hljs-selector-attr">[0:3,3:6]</span>=<span class="hljs-number">255</span>               #æŠŠ<span class="hljs-selector-tag">img</span>å›¾åƒä¸Šçš„ç¬¬<span class="hljs-number">0</span>è¡Œåˆ°ç¬¬<span class="hljs-number">2</span>è¡Œï¼Œç¬¬<span class="hljs-number">3</span>åˆ—åˆ°ç¬¬<span class="hljs-number">5</span>åˆ—çš„åƒç´ ç‚¹åˆ‡å‡ºæ¥ï¼Œå¹¶ä¸”ç»™å®ƒä»¬èµ‹å€¼ä¸º<span class="hljs-number">255</span>
<span class="hljs-built_in">print</span>('è¯·çœ‹åˆ‡å‡ºæ¥åƒç´ çš„å€¼ï¼Œæ˜¯ä¸æ˜¯ä»<span class="hljs-number">0</span>å˜ä¸º<span class="hljs-number">255</span>äº†ï¼š\n', img)
cv2<span class="hljs-selector-class">.imshow</span>('two', img)
cv2<span class="hljs-selector-class">.waitKey</span>(<span class="hljs-number">20000</span>)          <span class="hljs-selector-id">#20</span>ç§’åå°±æ‰§è¡Œä¸‹é¢è¯­å¥å§ï¼Œç¨‹åºåˆ«è€å¡åœ¨è¿™æ¡è¯­å¥ä¸Šäº†ã€‚
cv2<span class="hljs-selector-class">.destroyAllWindows</span>()     #è¿™ä¹ˆå›¾ç‰‡çª—å£éƒ½ç»Ÿç»Ÿæ¶ˆå¤±å§

è¯·çœ‹ä¸‹é¢å›¾åƒæ•°æ®é•¿çš„æ ·å­å§ï¼š
 <span class="hljs-selector-attr">[[0 0 0 0 0 0 0 0 0 0]</span>
 <span class="hljs-selector-attr">[0 0 0 0 0 0 0 0 0 0]</span>
 <span class="hljs-selector-attr">[0 0 0 0 0 0 0 0 0 0]</span>
 <span class="hljs-selector-attr">[0 0 0 0 0 0 0 0 0 0]</span>
 <span class="hljs-selector-attr">[0 0 0 0 0 0 0 0 0 0]</span>
 <span class="hljs-selector-attr">[0 0 0 0 0 0 0 0 0 0]</span>
 <span class="hljs-selector-attr">[0 0 0 0 0 0 0 0 0 0]</span>
 <span class="hljs-selector-attr">[0 0 0 0 0 0 0 0 0 0]</span>
 <span class="hljs-selector-attr">[0 0 0 0 0 0 0 0 0 0]</span>
 <span class="hljs-selector-attr">[0 0 0 0 0 0 0 0 0 0]</span>] 

è¯·çœ‹åˆ‡å‡ºæ¥åƒç´ çš„å€¼ï¼Œæ˜¯ä¸æ˜¯ä»<span class="hljs-number">0</span>å˜ä¸º<span class="hljs-number">255</span>äº†ï¼š
 <span class="hljs-selector-attr">[[  0   0   0 255 255 255   0   0   0   0]</span>
 <span class="hljs-selector-attr">[  0   0   0 255 255 255   0   0   0   0]</span>
 <span class="hljs-selector-attr">[  0   0   0 255 255 255   0   0   0   0]</span>
 <span class="hljs-selector-attr">[  0   0   0   0   0   0   0   0   0   0]</span>
 <span class="hljs-selector-attr">[  0   0   0   0   0   0   0   0   0   0]</span>
 <span class="hljs-selector-attr">[  0   0   0   0   0   0   0   0   0   0]</span>
 <span class="hljs-selector-attr">[  0   0   0   0   0   0   0   0   0   0]</span>
 <span class="hljs-selector-attr">[  0   0   0   0   0   0   0   0   0   0]</span>
 <span class="hljs-selector-attr">[  0   0   0   0   0   0   0   0   0   0]</span>
 <span class="hljs-selector-attr">[  0   0   0   0   0   0   0   0   0   0]</span>]

#ä¾‹<span class="hljs-number">2.2</span> è¯»å–ä¸€ä¸ªç°åº¦å›¾åƒï¼Œå¹¶å¯¹å…¶æŒ‡å®šçš„åƒç´ è¿›è¡Œä¿®æ”¹
import cv2                                                 #å€’åº“
lena = cv2<span class="hljs-selector-class">.imread</span>(r'C:\Users\<span class="hljs-number">25584</span>\Desktop\lena.bmp',<span class="hljs-number">0</span>)    #æŠŠlenaè¯»åˆ°å†…å­˜
cv2<span class="hljs-selector-class">.imshow</span>('the first', lena)                              #ç”¨ä¸€ä¸ªçª—å£æŠŠlenaæ˜¾ç¤ºå‡ºæ¥
for hang in <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>, <span class="hljs-number">100</span>):       #A                 
    for lie in <span class="hljs-built_in">range</span>(<span class="hljs-number">80</span>, <span class="hljs-number">200</span>):
        lena[hang, lie]=<span class="hljs-number">255</span>
cv2.<span class="hljs-built_in">imshow</span>(<span class="hljs-string">'the second'</span>, lena)
cv2.<span class="hljs-built_in">waitKey</span>(<span class="hljs-number">20000</span>)
cv2.<span class="hljs-built_in">destroyAllWindows</span>()
</code></pre>
<ul>
<li><strong>A:</strong> ä»£ç ä¸­ä½¿ç”¨äº†ä¸€ä¸ªåŒå±‚åµŒå¥—å¾ªç¯æŠŠlenaå›¾åƒæ•°æ®ä¸­çš„ <strong>ç¬¬10è¡Œåˆ°ç¬¬99è¡Œã€ç¬¬80åˆ—åˆ°199åˆ—</strong> çš„æ•°æ®ç´¢å¼•å‡ºæ¥ï¼Œå¹¶ä¸”æŠŠè¿™äº›æ•°æ®é‡æ–°èµ‹å€¼ä¸º255.</li>
<li><strong>çŸ¥è¯†ç‚¹ï¼š</strong><br/>
1ã€å®¹å™¨çš„æ¦‚å¿µï¼Œrange()å‡½æ•°ã€liståˆ—è¡¨ ç­‰éƒ½æ˜¯å®¹å™¨ã€‚æ˜¯å®¹å™¨å°±å¯ä»¥å¯¹é‡Œé¢çš„å…ƒç´ è¿›è¡Œéå†ï¼Œä¹Ÿå°±æ˜¯è¿›è¡Œå¾ªç¯ã€‚<br/>
2ã€forå¾ªç¯ã€åµŒå¥—å¾ªç¯ï¼Œéƒ½æ˜¯åŸºç¡€å¿…é¡»å®Œå…¨ç†Ÿç»ƒã€‚</li>
</ul>
<h4 data-id="heading-3">ä¸‰ã€å½©è‰²å›¾åƒåŸºæœ¬çŸ¥è¯†ç‚¹</h4>
<p>æˆ‘ä»¬å¹³æ—¶çœ‹åˆ°çš„å½©è‰²å›¾åƒï¼Œä¸ç®¡ä»€ä¹ˆæ ¼å¼çš„ï¼Œä¸€èˆ¬éƒ½æ˜¯RGBè‰²å½©é€šé“æ¨¡å¼çš„å›¾ç‰‡ï¼Œå°±æ˜¯å›¾ç‰‡çš„æ¯ä¸ªåƒç´ éƒ½æœ‰ä¸‰ä¸ªæ•°å­—ï¼Œç¬¬ä¸€ä¸ªæ•°å­—æ˜¯Rçº¢è‰²é€šé“çš„çº¢å…‰å¼ºåº¦å€¼ï¼Œç¬¬äºŒä¸ªæ•°å­—æ˜¯Gç»¿è‰²é€šé“çš„ç»¿å…‰å¼ºåº¦å€¼ï¼Œç¬¬ä¸‰ä¸ªæ•°å­—æ˜¯Bè“è‰²é€šé“çš„è“å…‰çš„å¼ºåº¦å€¼ã€‚<br/>
ä½†æ˜¯opencvåœ¨è¯»å–å½©è‰²å›¾ç‰‡çš„æ•°æ®æ—¶ï¼Œæ˜¯å°†å›¾ç‰‡é‡Œé¢çš„æ•°æ®ä»¥è¡Œæ–¹å‘é¡ºåºè¯»å–ï¼Œå¹¶ä¸”ä»¥BGRçš„é»˜è®¤æ¨¡å¼å­˜æ”¾åœ¨æ•°ç»„ndarrayä¸­çš„ã€‚å°±ç›¸å½“äºæŠŠä¸€å¼ å›¾ç‰‡ä»å·¦ä¸Šè§’çš„ç¬¬ä¸€ä¸ªåƒç´ å¼€å§‹ï¼ŒæŒ‰è¡Œä¾æ¬¡å‚ç›´æ’åˆ—ï¼Œæ‹æˆä¸€æ¡æ•°ç›´çš„é•¿çº¿ï¼Œçº¿ä¸Šçš„æ¯ä¸ªç‚¹éƒ½æ˜¯ä¸‰ä¸ªæ•°å­—ï¼Œä½†è¿™ä¸‰ä¸ªæ•°å­—é»˜è®¤çš„BGRé€šé“ã€‚<br/>
image[0,0,0] ç¬¬ä¸€ä¸ªå‚æ•°0è¡¨ç¤ºç¬¬0è¡Œï¼Œç¬¬äºŒä¸ªå‚æ•°0è¡¨ç¤ºç¬¬0åˆ—ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°è¡¨ç¤ºç¬¬0ä¸ªé€šé“ã€‚ç”±äºopencvè¯»å‡ºæ¥çš„ä¸‰ä¸ªé€šé“æ˜¯BGRé¡ºåºçš„ï¼Œæ‰€ä»¥ç¬¬ä¸‰ä¸ªå‚æ•°0åœ¨opencvä¸­æ˜¯åˆ‡å‡ºæ¥çš„åƒç´ ç‚¹å°±æ˜¯imageè¿™å¼ å›¾ç‰‡ä¸­çš„å·¦ä¸Šè§’ç¬¬ä¸€ä¸ªåƒç´ ç‚¹Bé€šé“çš„è“å…‰å¼ºåº¦å€¼ã€‚</p>
<pre><code class="hljs language-scss" lang="scss">#ä¾‹<span class="hljs-number">2.3</span> å…ˆç”Ÿæˆä¸€ä¸ªä¸‰ç»´å…¨æ˜¯<span class="hljs-number">0</span>çš„ndarrayæ•°ç»„ï¼Œç„¶ååˆ‡å‡ºç¬¬ä¸€ä¸ªé€šé“çš„æ•°æ®å¹¶æ”¹ä¸º<span class="hljs-number">255</span>ï¼Œç„¶åå†æ˜¾ç¤ºè¿™ä¸ªä¸‰ç»´æ•°æ®å›¾åƒã€‚ä¾æ¬¡ç±»æ¨æŠŠä¸‰ä¸ªé€šé“éƒ½æ“ä½œä¸€éã€‚å³æ ¹æ®å›¾åƒçš„é€šé“æ“ä½œæ•´å¼ å›¾åƒã€‚
import numpy as np
import cv2
blue = np<span class="hljs-selector-class">.zeros</span>((<span class="hljs-number">200</span>, <span class="hljs-number">300</span>, <span class="hljs-number">3</span>), dtype=np<span class="hljs-selector-class">.uint8</span>)   #ç”¨np<span class="hljs-selector-class">.zeros</span>([<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>], dtype=np.uint8)ç†è§£è¿™ä¸ªå‡½æ•°
blue<span class="hljs-selector-attr">[:,:,0]</span>=<span class="hljs-number">255</span>                                  <span class="hljs-selector-id">#np</span><span class="hljs-selector-class">.zeros</span>([<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>], dtype=np.uint8)<span class="hljs-selector-attr">[:,:,0]</span>=<span class="hljs-number">255</span>ï¼Œå°è¯•ç”¨å°æ•°æ®åˆ‡ä¸€åˆ‡è®¤è¯†æ•°æ®
<span class="hljs-built_in">print</span>(blue)
cv2<span class="hljs-selector-class">.imshow</span>('blue', blue)
<span class="hljs-built_in">print</span>('------------------------------------------------')
green = np<span class="hljs-selector-class">.zeros</span>((<span class="hljs-number">200</span>, <span class="hljs-number">300</span>, <span class="hljs-number">3</span>), dtype=np<span class="hljs-selector-class">.uint8</span>) 
green<span class="hljs-selector-attr">[:,:,1]</span>=<span class="hljs-number">255</span>
<span class="hljs-built_in">print</span>(green)
cv2<span class="hljs-selector-class">.imshow</span>('green', green)
<span class="hljs-built_in">print</span>('------------------------------------------------')
red = np<span class="hljs-selector-class">.zeros</span>((<span class="hljs-number">200</span>, <span class="hljs-number">300</span>, <span class="hljs-number">3</span>), dtype=np<span class="hljs-selector-class">.uint8</span>) 
red<span class="hljs-selector-attr">[:,:,2]</span>=<span class="hljs-number">255</span>
<span class="hljs-built_in">print</span>(red)
cv2<span class="hljs-selector-class">.imshow</span>('red', red)
<span class="hljs-built_in">print</span>('------------------------------------------------')
colorfull = np<span class="hljs-selector-class">.zeros</span>((<span class="hljs-number">200</span>, <span class="hljs-number">300</span>, <span class="hljs-number">3</span>), dtype=np<span class="hljs-selector-class">.uint8</span>) 
colorfull<span class="hljs-selector-attr">[:,:,0]</span>=<span class="hljs-number">255</span>     #è“è‰²
colorfull<span class="hljs-selector-attr">[:,:,1]</span>=<span class="hljs-number">0</span>       #ç»¿è‰²
colorfull<span class="hljs-selector-attr">[:,:,2]</span>=<span class="hljs-number">255</span>     #çº¢è‰²
<span class="hljs-built_in">print</span>(colorfull)
cv2<span class="hljs-selector-class">.imshow</span>('colorfull', colorfull)

cv2<span class="hljs-selector-class">.waitKey</span>(<span class="hljs-number">10000</span>)
cv2<span class="hljs-selector-class">.destroyAllWindows</span>()



#ä¾‹<span class="hljs-number">2.4</span>   è§‚å¯Ÿä¸€å¼ å›¾åƒçš„éƒ¨åˆ†åƒç´ ç‚¹çš„æŸä¸ªé€šé“ä¸Šçš„æ•°å€¼æ”¹å˜ï¼Œè¿™å¼ å›¾åƒè·Ÿç€æ€ä¹ˆå˜åŒ–ã€‚
import numpy as np
import cv2
<span class="hljs-selector-tag">img</span> = np<span class="hljs-selector-class">.zeros</span>((<span class="hljs-number">300</span>,<span class="hljs-number">300</span>,<span class="hljs-number">3</span>),dtype=np<span class="hljs-selector-class">.uint8</span>)  #æ•°æ®å¤ªå¤šçœ‹ä¸æ˜ç™½åˆ°åº•å“ªäº›æ•°æ®è¢«æ”¹äº†ï¼Œå°±ç”¨å°æ•°æ®å®éªŒï¼š<span class="hljs-selector-tag">img</span> = np<span class="hljs-selector-class">.zeros</span>((<span class="hljs-number">3</span>,<span class="hljs-number">6</span>,<span class="hljs-number">3</span>),dtype=np<span class="hljs-selector-class">.uint8</span>)
<span class="hljs-selector-tag">img</span><span class="hljs-selector-attr">[:, 0:100, 0]</span>=<span class="hljs-number">255</span>     #è“è‰²é€šé“                                                                   #  <span class="hljs-selector-tag">img</span><span class="hljs-selector-attr">[:, 0:1, 0]</span>=<span class="hljs-number">255</span>
<span class="hljs-selector-tag">img</span><span class="hljs-selector-attr">[:,100:200, 1]</span>=<span class="hljs-number">255</span>    #ç»¿è‰²é€šé“                                                                    #  <span class="hljs-selector-tag">img</span><span class="hljs-selector-attr">[:,1:3, 1]</span>=<span class="hljs-number">255</span>
<span class="hljs-selector-tag">img</span><span class="hljs-selector-attr">[:, 200:300, 2]</span>=<span class="hljs-number">255</span>   #çº¢è‰²é€šé“                                                                   #  <span class="hljs-selector-tag">img</span><span class="hljs-selector-attr">[:, 3:6, 2]</span>=<span class="hljs-number">255</span>
<span class="hljs-built_in">print</span>(img)
cv2<span class="hljs-selector-class">.imshow</span>('img', img)
cv2<span class="hljs-selector-class">.waitKey</span>(<span class="hljs-number">10000</span>)
cv2<span class="hljs-selector-class">.destroyAllWindows</span>()



#ä¾‹<span class="hljs-number">2.5</span>  æ‰‹åŠ¨ç”Ÿæˆä¸€å¼ BGRæ¨¡å¼çš„å½©è‰²å›¾åƒ
import numpy as np
import cv2
<span class="hljs-selector-tag">img</span> = np<span class="hljs-selector-class">.zeros</span>((<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>), dtype=np<span class="hljs-selector-class">.uint8</span>)
<span class="hljs-built_in">print</span>(img, '\n--------- \n', img[<span class="hljs-number">0</span>,<span class="hljs-number">3</span>], '\n--------- \n', img[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>])
cv2<span class="hljs-selector-class">.imshow</span>('img', img)
<span class="hljs-selector-tag">img</span><span class="hljs-selector-attr">[0,3]</span>=<span class="hljs-number">255</span>
<span class="hljs-selector-tag">img</span><span class="hljs-selector-attr">[0,0]</span>=<span class="hljs-selector-attr">[66,77,88]</span>
<span class="hljs-selector-tag">img</span><span class="hljs-selector-attr">[1,1,1]</span> = <span class="hljs-number">3</span>
<span class="hljs-selector-tag">img</span><span class="hljs-selector-attr">[1,2,2]</span> = <span class="hljs-number">4</span>
<span class="hljs-selector-tag">img</span><span class="hljs-selector-attr">[0,2,0]</span> = <span class="hljs-number">5</span>
<span class="hljs-built_in">print</span>('\n--------- \n', img, '\n--------- \n', img[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>])
cv2<span class="hljs-selector-class">.waitKey</span>(<span class="hljs-number">10000</span>)
cv2<span class="hljs-selector-class">.destroyAllWindows</span>()



#ä¾‹<span class="hljs-number">2.6</span> è¯»å–lenacolorå›¾ç‰‡ï¼Œç”¨å¾ªç¯æ›´æ”¹å›¾ç‰‡çš„æŸäº›åŒºåŸŸçš„åƒç´ å€¼
import cv2
lena_color = cv2<span class="hljs-selector-class">.imread</span>(r'C:\Users\<span class="hljs-number">25584</span>\Desktop\lenacolor.png') 
cv2<span class="hljs-selector-class">.imshow</span>('before', lena_color)
<span class="hljs-built_in">print</span>(lena_color[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>], lena_color[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>], lena_color[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>])
<span class="hljs-built_in">print</span>(lena_color[<span class="hljs-number">50</span>,<span class="hljs-number">0</span>], lena_color[<span class="hljs-number">100</span>,<span class="hljs-number">0</span>])

for <span class="hljs-selector-tag">i</span> in <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">50</span>):
    for j in <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">100</span>):
        for k in <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>):
            lena_color[i,j,k]=<span class="hljs-number">255</span>
            
for i in <span class="hljs-built_in">range</span>(<span class="hljs-number">50</span>, <span class="hljs-number">100</span>):
    for j in <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>, <span class="hljs-number">200</span>):
        lena_color[i,j]=[<span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>]
        
for i in <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>, <span class="hljs-number">150</span>):
    for j in <span class="hljs-built_in">range</span>(<span class="hljs-number">200</span>, <span class="hljs-number">300</span>):
        lena_color[i,j]=<span class="hljs-number">0</span>
        
cv2.<span class="hljs-built_in">imshow</span>(<span class="hljs-string">'after'</span>, lena_color)
<span class="hljs-built_in">print</span>(lena_color[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>], lena_color[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>], lena_color[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>], lena_color[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>], lena_color[<span class="hljs-number">50</span>,<span class="hljs-number">0</span>], lena_color[<span class="hljs-number">100</span>,<span class="hljs-number">0</span>])
cv2.<span class="hljs-built_in">waitKey</span>(<span class="hljs-number">10000</span>)
cv2.<span class="hljs-built_in">destroyAllWindows</span>()
</code></pre>
<p><img alt="" src="" loading="lazy"/></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-id">#2</span><span class="hljs-selector-class">.7</span> ç»ƒä¹ å‡½æ•°<span class="hljs-built_in">item</span>()å’Œå‡½æ•°<span class="hljs-built_in">itemset</span>()çš„ç”¨æ³•
import numpy as np
<span class="hljs-selector-tag">img</span> = np<span class="hljs-selector-class">.random</span><span class="hljs-selector-class">.randint</span>(<span class="hljs-number">10</span>, <span class="hljs-number">99</span>, size=(<span class="hljs-number">5</span>,<span class="hljs-number">5</span>), dtype=np<span class="hljs-selector-class">.uint8</span>)
<span class="hljs-built_in">print</span>(img, '\n', img.item(<span class="hljs-number">3</span>,<span class="hljs-number">2</span>))
<span class="hljs-selector-tag">img</span><span class="hljs-selector-class">.itemset</span>((<span class="hljs-number">3</span>,<span class="hljs-number">2</span>), <span class="hljs-number">255</span>)
<span class="hljs-selector-tag">img</span>
</code></pre>
<p><img alt="" src="" loading="lazy"/></p>
<ul>
<li>
<p><strong>np.random.randint(a,b, size, dtype)å‡½æ•°</strong><br/>
å‡½æ•°çš„åŠŸèƒ½æ˜¯éšæœºç”Ÿæˆä¸€äº›æ•´æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦ç”Ÿæˆçš„æ•°çš„èµ·å§‹å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æœ€å¤§å€¼ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è¦ç”Ÿæˆçš„æ•´æ•°çš„å½¢çŠ¶ï¼Œç¬¬å››ä¸ªå‚æ•°æ˜¯è¦ç”Ÿæˆçš„æ•°çš„ç±»å‹ã€‚</p>
</li>
<li>
<p><strong>å‡½æ•°item(a,b)</strong><br/>
å‡½æ•°çš„åŠŸèƒ½æ˜¯ç´¢å¼•å‡ºè¦è®¿é—®çš„å›¾åƒçš„æŸä¸ªåƒç´ ç‚¹ã€‚å‡½æ•°è¿”å›è¦ç´¢å¼•çš„åƒç´ ç‚¹çš„å€¼ã€‚<br/>
å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åƒç´ ç‚¹çš„è¡Œï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯åƒç´ ç‚¹çš„åˆ—ã€‚</p>
</li>
<li>
<p><strong>å‡½æ•°itemset((a,b),c)</strong> å‡½æ•°ç”¨æ¥ä¿®æ”¹æŒ‡å®šåƒç´ ç‚¹çš„åƒç´ å€¼ã€‚æœ¬å‡½æ•°ç›´æ¥åœ¨åŸå›¾åƒä¸Šä¿®æ”¹ï¼Œä¸è¿”å›ä»»ä½•å€¼ã€‚ å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦ä¿®æ”¹çš„åƒç´ ç‚¹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦ä¿®æ”¹çš„åƒç´ çš„å€¼ã€‚</p>
</li>
<li>
<p><strong>è¯´æ˜</strong><br/>
item()å‡½æ•°å’Œitemset()éƒ½æ˜¯åªèƒ½ç´¢å¼•æˆ–è€…ä¿®ä¸ªä¸€ä¸ªåƒç´ ç‚¹ï¼ï¼ï¼å¦‚æœæˆ‘ä»¬æƒ³ç´¢å¼•æˆ–ä¿®æ”¹ä¸€æ‰¹åƒç´ ç‚¹æ—¶ï¼Œæˆ‘ä»¬å°±è¦ç”¨å¾ªç¯ä¸€ä¸ªä¸ªåƒç´ ç‚¹è¿›è¡Œä¿®æ”¹ï¼ï¼ï¼</p>
<p>#ä¾‹2.8 ç”Ÿæˆä¸€ä¸ªåƒç´ å€¼ä¸ºéšæœºæ•°çš„ç°åº¦å›¾åƒ<br/>
import numpy as np
import cv2
img = np.random.randint(0,256, size=(300, 300), dtype=np.uint8)
img
cv2.imshow('demo', img)
cv2.waitKey(10000)
cv2.destroyAllWindows()</p>
<p>#ä¾‹2.9 è¯»å–ç°åº¦å›¾åƒlena.bmpï¼Œå¹¶å¯¹å…¶åƒç´ å€¼è¿›è¡Œç´¢å¼•ã€ä¿®æ”¹<br/>
import cv2
lena = cv2.imread(r'C:\Users\25584\Desktop\lena.bmp', 0)
#ä¿®æ”¹ä¸€ä¸ªåƒç´ ç‚¹ï¼š
print(lena.item(2,3))
lena.itemset((2, 3), 255)<br/>
print(lena.item(2, 3))
#ä¿®æ”¹ä¸€ä¸ªåŒºåŸŸçš„åƒç´ ç‚¹ï¼š
cv2.imshow('xiu gai qian', lena)
for i in range(10, 50):
for j in range(20, 100):
lena.itemset((i,j), 255)
cv2.imshow('xiu gai hou', lena)
cv2.waitKey(10000)
cv2.destroyAllWindows()</p>
</li>
</ul>
<p><img alt="" src="" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css">#ä¾‹<span class="hljs-number">2.10</span> ç”Ÿæˆä¸€ä¸ªåƒç´ å€¼ä¸ºéšæœºæ•°çš„å½©è‰²å›¾åƒï¼Œç»ƒä¹ item()å‡½æ•°å’Œitemset()å‡½æ•°ï¼š
import numpy as np
<span class="hljs-selector-tag">img</span> = np<span class="hljs-selector-class">.random</span><span class="hljs-selector-class">.randint</span>(<span class="hljs-number">10</span>, <span class="hljs-number">99</span>, size=(<span class="hljs-number">2</span>,<span class="hljs-number">4</span>,<span class="hljs-number">3</span>), dtype=np<span class="hljs-selector-class">.uint8</span>)
<span class="hljs-selector-tag">img</span>
<span class="hljs-selector-tag">img</span><span class="hljs-selector-attr">[1,2,0]</span>, <span class="hljs-selector-tag">img</span><span class="hljs-selector-attr">[1,2, 1]</span>, <span class="hljs-selector-tag">img</span><span class="hljs-selector-attr">[1,2,2]</span>
<span class="hljs-selector-tag">img</span><span class="hljs-selector-class">.item</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>), <span class="hljs-selector-tag">img</span><span class="hljs-selector-class">.item</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>), <span class="hljs-selector-tag">img</span><span class="hljs-selector-class">.item</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>)
<span class="hljs-selector-tag">img</span><span class="hljs-selector-class">.itemset</span>((<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>), <span class="hljs-number">255</span>), <span class="hljs-selector-tag">img</span><span class="hljs-selector-class">.itemset</span>((<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>), <span class="hljs-number">255</span>), <span class="hljs-selector-tag">img</span><span class="hljs-selector-class">.itemset</span>((<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>), <span class="hljs-number">255</span>)
<span class="hljs-selector-tag">img</span><span class="hljs-selector-attr">[1,2,0]</span>, <span class="hljs-selector-tag">img</span><span class="hljs-selector-attr">[1,2, 1]</span>, <span class="hljs-selector-tag">img</span><span class="hljs-selector-attr">[1,2,2]</span>
</code></pre>
<p><img alt="" src="" loading="lazy"/></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#ä¾‹2.11 ç”Ÿæˆä¸€ä¸ªåƒç´ å€¼ä¸ºéšæœºæ•°çš„å½©è‰²å›¾åƒ</span>
img = np.random.randint(<span class="hljs-number">0</span>, <span class="hljs-number">256</span>, size=(<span class="hljs-number">200</span>, <span class="hljs-number">200</span>, <span class="hljs-number">3</span>), dtype=np.uint8)
cv2.imshow(<span class="hljs-string">'random colorfull img'</span>, img)
cv2.waitKey(<span class="hljs-number">10000</span>)
cv2.destroyAllWindows()



<span class="hljs-comment">#ä¾‹2.12 è¯»å–å½©è‰²å›¾åƒlenacolor.png, å¹¶å¯¹å›¾åƒè¿›è¡Œä¿®æ”¹</span>
<span class="hljs-keyword">import</span> cv2
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
lena_color = cv2.imread(<span class="hljs-string">r'C:\Users\25584\Desktop\lenacolor.png'</span>)
cv2.imshow(<span class="hljs-string">'xiu gai qian'</span>, lena_color)
<span class="hljs-built_in">print</span>(lena_color[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>], lena_color[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>], lena_color[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>])
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">100</span>):
    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">200</span>):
        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">3</span>):
            lena_color.itemset((i,j,k),<span class="hljs-number">255</span>)
cv2.imshow(<span class="hljs-string">'xiu gai hou'</span>, lena_color)    
<span class="hljs-built_in">print</span>(lena_color[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>], lena_color[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>], lena_color[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>])
cv2.waitKey(<span class="hljs-number">10000</span>)
cv2.destroyAllWindows()
</code></pre>
<p><img alt="" src="" loading="lazy"/></p>
<h4 data-id="heading-4">å››ã€ROI, Region of Interest, æ„Ÿå…´è¶£åŒºåŸŸ</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#ä¾‹2.13 è·å–lenaçš„è„¸éƒ¨ä¿¡æ¯ï¼Œå¹¶å°†å…¶æ˜¾ç¤ºå‡ºæ¥</span>
<span class="hljs-keyword">import</span> cv2
lena = cv2.imread(<span class="hljs-string">r'C:\Users\25584\Desktop\lenacolor.png'</span>, -<span class="hljs-number">1</span>)
lena_face = lena[<span class="hljs-number">220</span>:<span class="hljs-number">400</span>, <span class="hljs-number">220</span>:<span class="hljs-number">350</span>]    <span class="hljs-comment">#ç”¨åˆ‡ç‰‡è·å–ROI</span>
cv2.imshow(<span class="hljs-string">'lena'</span>, lena)    
cv2.imshow(<span class="hljs-string">'lena face'</span>, lena_face)
cv2.waitKey(<span class="hljs-number">10000</span>)
cv2.destroyAllWindows()



<span class="hljs-comment">#ä¾‹2.14 ç»™lenaçš„è„¸éƒ¨æ‰“ç </span>
<span class="hljs-keyword">import</span> cv2
lena = cv2.imread(<span class="hljs-string">r'C:\Users\25584\Desktop\lenacolor.png'</span>, -<span class="hljs-number">1</span>)
cv2.imshow(<span class="hljs-string">'lena'</span>, lena)

roi_1 = np.random.randint(<span class="hljs-number">0</span>, <span class="hljs-number">256</span>, (<span class="hljs-number">180</span>, <span class="hljs-number">130</span>,<span class="hljs-number">3</span>), dtype=np.uint8)
lena[<span class="hljs-number">220</span>:<span class="hljs-number">400</span>, <span class="hljs-number">220</span>:<span class="hljs-number">350</span>]=roi_1
cv2.imshow(<span class="hljs-string">'color mask'</span>, lena)

roi_2 = np.zeros((<span class="hljs-number">180</span>, <span class="hljs-number">130</span>,<span class="hljs-number">3</span>),dtype=np.uint8)
roi_2[:,:,:]=<span class="hljs-number">255</span>
lena[<span class="hljs-number">220</span>:<span class="hljs-number">400</span>, <span class="hljs-number">220</span>:<span class="hljs-number">350</span>]=roi_2
cv2.imshow(<span class="hljs-string">'white mask'</span>, lena)

cv2.waitKey(<span class="hljs-number">10000</span>)
cv2.destroyAllWindows()



<span class="hljs-comment">#ä¾‹2.15 å°†ä¸€å¹…å›¾åƒå†…çš„ROIå¤åˆ¶åˆ°å¦ä¸€å¹…å›¾åƒå†…ï¼šç»™dollaræ¢è„¸</span>
<span class="hljs-keyword">import</span> cv2
lena = cv2.imread(<span class="hljs-string">r'C:\Users\25584\Desktop\lena512.bmp'</span>, -<span class="hljs-number">1</span>)
dollar = cv2.imread(<span class="hljs-string">r'C:\Users\25584\Desktop\dollar.bmp'</span>, -<span class="hljs-number">1</span>)
cv2.imshow(<span class="hljs-string">'lena'</span>, lena)
cv2.imshow(<span class="hljs-string">'dollar'</span>, dollar)
lena_face = lena[<span class="hljs-number">220</span>:<span class="hljs-number">400</span>, <span class="hljs-number">250</span>:<span class="hljs-number">350</span>]
dollar[<span class="hljs-number">160</span>:<span class="hljs-number">340</span>, <span class="hljs-number">200</span>:<span class="hljs-number">300</span>]=lena_face
cv2.imshow(<span class="hljs-string">'dollar2'</span>, dollar)
cv2.waitKey(<span class="hljs-number">10000</span>)
cv2.destroyAllWindows()
</code></pre>
<h4 data-id="heading-5">äº”ã€é€šé“æ“ä½œ</h4>
<p>ä¸€ä¸ªRGBå½©è‰²å›¾åƒï¼Œåœ¨opencvä¸­ï¼Œå®ƒæ˜¯æŒ‰ç…§Bé€šé“-Gé€šé“-Ré€šé“ çš„é¡ºåºå­˜å‚¨çš„ã€‚</p>
<ul>
<li>
<p>é€šé“æ‹†åˆ†<br/>
1ã€ç´¢å¼•æ–¹å¼æ‹†åˆ†<br/>
2ã€å‡½æ•°æ–¹å¼æ‹†åˆ†</p>
</li>
<li>
<p>é€šé“åˆå¹¶</p>
<p>#ä¾‹2.16 ç¼–å†™ç¨‹åºï¼Œæ¼”ç¤ºå›¾åƒé€šé“æ‹†åˆ†åŠé€šé“å€¼æ”¹å˜å¯¹å½©è‰²å›¾åƒçš„å½±å“
import cv2
lena = cv2.imread(r'C:\Users\25584\Desktop\lenacolor.png')
cv2.imshow('lena', lena)</p>
<p>b_tongdao = lena[:, :, 0]
g_tongdao = lena[:, :, 1]
r_tongdao = lena[:, :, 2]
cv2.imshow('b', b_tongdao)
cv2.imshow('g', g_tongdao)
cv2.imshow('r', r_tongdao)</p>
<p>lena[:, :, 0]=0
cv2.imshow('b_0', lena)
lena[:, :, 1]=0
cv2.imshow('g_0', lena)</p>
<p>cv2.waitKey(20000)
cv2.destroyAllWindows()</p>
<p>#ä¾‹2.17 ä½¿ç”¨å‡½æ•°cv2.split()å‡½æ•°æ‹†å›¾åƒé€šé“, å¹¶æ˜¾ç¤ºä¸‰ä¸ªé€šé“å›¾åƒã€‚
import cv2
lena = cv2.imread(r'C:\Users\25584\Desktop\lenacolor.png')
b,g,r = cv2.split(lena)
cv2.imshow('b', b)
cv2.imshow('g', g)
cv2.imshow('r', r)
cv2.waitKey(20000)
cv2.destroyAllWindows()</p>
<p>#è‡ªä¸»ç»ƒä¹ ï¼šæŠŠä¸€å¼ å½©å›¾çš„ä¸‰ä¸ªé€šé“æ•°æ®åˆ†åˆ«åˆ‡å‡ºæ¥ï¼Œä»ä»¥å½©å›¾å½¢å¼æ˜¾ç¤ºå›¾åƒã€‚
import cv2
lena = cv2.imread(r'C:\Users\25584\Desktop\lenacolor.png')</p>
<p>lena1 = lena.copy()
lena1[:,:,1:3]=0
cv2.imshow('b', lena1)</p>
<p>lena2 = lena.copy()
lena2[:,:,0]=0
lena2[:,:,2]=0
cv2.imshow('g', lena2)</p>
<p>lena3 = lena.copy()
lena3[:,:,0:2]=0
cv2.imshow('r', lena3)</p>
<p>cv2.waitKey(20000)
cv2.destroyAllWindows()</p>
<p>#ä¾‹2.18 é€šé“åˆå¹¶ï¼Œä½¿ç”¨å‡½æ•°cv2.merge()å‡½æ•°åˆå¹¶é€šé“
import cv2
lena = cv2.imread(r'C:\Users\25584\Desktop\lenacolor.png')
b,g,r = cv2.split(lena)
bgr = cv2.merge([b,g,r])
rgb = cv2.merge([r,g,b])</p>
<p>cv2.imshow('bgr', bgr)
cv2.imshow('rgb', rgb)</p>
<p>cv2.waitKey(20000)
cv2.destroyAllWindows()</p>
</li>
</ul>
<p><strong>è¯´æ˜ï¼šé€šé“é¡ºåºæ”¹å˜åï¼Œå›¾åƒçš„æ˜¾ç¤ºæ•ˆæœä¹Ÿå‘ç”Ÿäº†æ”¹å˜ã€‚</strong></p>
<h4 data-id="heading-6">å…­ã€è·å–å›¾åƒå±æ€§</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#ä¾‹2.19 è§‚å¯Ÿå›¾åƒçš„å¸¸ç”¨å±æ€§å€¼ </span>
<span class="hljs-keyword">import</span> cv2
lena_gray = cv2.imread(<span class="hljs-string">r'C:\Users\25584\Desktop\lena.bmp'</span>,<span class="hljs-number">0</span>)  <span class="hljs-comment">#å‚æ•°0è¡¨ç¤ºå›¾åƒè¢«è°ƒæ•´ä¸ºå•é€šé“çš„ç°åº¦å›¾åƒ</span>
lena_color = cv2.imread(<span class="hljs-string">r'C:\Users\25584\Desktop\lenacolor.png'</span>)  <span class="hljs-comment">#å½©è‰²å›¾åƒ</span>
lena_gray.shape
lena_color.shape

lena_gray.size
lena_color.size

lena_gray.dtype
lena_color.dtype

dtype(<span class="hljs-string">'uint8'</span>)
</code></pre>
<p><strong>è¯´æ˜ï¼š</strong><br/>
shapeå±æ€§æ˜¯ç”¨æ¥åˆ¤æ–­ä¸€å¹…å›¾åƒæ˜¯ç°åº¦å›¾åƒè¿˜æ˜¯å½©è‰²å›¾åƒã€‚<br/>
sizeå±æ€§è¿”å›çš„æ˜¯å›¾åƒçš„åƒç´ æ•°ç›®ï¼Œå³å›¾åƒçš„'è¡Œxåˆ—xé€šé“æ•°'ã€‚ç°åº¦å›¾åƒçš„é€šé“æ•°ä¸º1ï¼Œå½©è‰²å›¾åƒçš„é€šé“æ•°ä¸º3ã€‚<br/>
dtypeå±æ€§è¿”å›å›¾åƒçš„æ•°æ®ç±»å‹ã€‚</p>
<h4 data-id="heading-7">ä¸ƒã€åœ¨å›¾åƒä¸Šç»˜åˆ¶å‡ ä½•å›¾å½¢</h4>
<p>ç»˜åˆ¶ç›´çº¿ï¼šcv.line(img, start, end, color, thickness) #img:è¦ç»˜åˆ¶ç›´çº¿çš„å›¾åƒï¼›start,endç›´çº¿çš„èµ·ç‚¹å’Œç»ˆç‚¹ï¼›colorçº¿æ¡çš„é¢œè‰²ï¼›thicknessçº¿æ¡çš„å®½åº¦ã€‚<br/>
ç»˜åˆ¶åœ†å½¢ï¼šcv.circle(img, centerpoint, r, color, thickness) #thicknessè¡¨ç¤ºçº¿æ¡çš„å®½åº¦ï¼Œå½“è¿™ä¸ªå‚æ•°=-1æ—¶ç”Ÿæˆé—­åˆå›¾æ¡ˆå¹¶å¡«å……é¢œè‰²ã€‚<br/>
ç»˜åˆ¶çŸ©å½¢ï¼šcv.rectangle(img, leftupper, rightdown, color, thickness) #è®¾ç½®çŸ©å½¢çš„å·¦ä¸Šè§’å’Œå³ä¸‹è§’åæ ‡å³å¯ã€‚<br/>
åœ¨å›¾åƒä¸­æ·»åŠ æ–‡å­—ï¼šcv.putText(img, text, station, font,fontsize, color, thickness, cv.LINE_AA) #text:è¦å†™å…¥çš„æ–‡å­—ï¼›station:æ–‡æœ¬åœ¨å›¾åƒä¸­çš„æ”¾ç½®ä½ç½®(å·¦ä¸‹è§’)ï¼›å­—ä½“ã€å­—ä½“å¤§å°ã€é¢œè‰²ã€å®½åº¦ã€‚</p>
<pre><code class="hljs language-scss" lang="scss">#ä¾‹<span class="hljs-number">2.20</span> ç”Ÿæˆä¸€ä¸ªå…¨é»‘çš„å›¾åƒï¼Œåœ¨å›¾åƒä¸Šç»˜åˆ¶ä¸Šé¢çš„å›¾å½¢å¹¶æ·»åŠ æ–‡å­—  
import numpy as np
import cv2
import matplotlib<span class="hljs-selector-class">.pyplot</span> as plt
<span class="hljs-selector-tag">img</span> = np<span class="hljs-selector-class">.zeros</span>((<span class="hljs-number">300</span>, <span class="hljs-number">300</span>, <span class="hljs-number">3</span>), np<span class="hljs-selector-class">.uint8</span>)

cv2<span class="hljs-selector-class">.line</span>(img, (<span class="hljs-number">0</span>,<span class="hljs-number">20</span>), (<span class="hljs-number">300</span>, <span class="hljs-number">200</span>), (<span class="hljs-number">255</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>),<span class="hljs-number">5</span>)   #çº¿æ®µèµ·ç‚¹ã€ç»ˆç‚¹ã€é¢œè‰²ã€ç²—ç»†
cv2<span class="hljs-selector-class">.rectangle</span>(img, (<span class="hljs-number">50</span>, <span class="hljs-number">80</span>), (<span class="hljs-number">120</span>, <span class="hljs-number">250</span>), (<span class="hljs-number">0</span>,<span class="hljs-number">255</span>,<span class="hljs-number">0</span>), <span class="hljs-number">3</span>)  #å·¦ä¸Šè§’åæ ‡ï¼Œå³ä¸‹è§’åæ ‡
cv2<span class="hljs-selector-class">.circle</span>(img, (<span class="hljs-number">200</span>, <span class="hljs-number">200</span>),<span class="hljs-number">60</span>, (<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">255</span>),-<span class="hljs-number">1</span>)    #åœ†å¿ƒåæ ‡ï¼ŒåŠå¾„ï¼Œ-<span class="hljs-number">1</span>è¡¨ç¤ºåœ†å½¢é‡Œé¢å¡«å……é¢œè‰²ã€‚
cv2<span class="hljs-selector-class">.putText</span>(img, 'opencv', (<span class="hljs-number">70</span>,<span class="hljs-number">40</span>), cv2<span class="hljs-selector-class">.FONT_HERSHEY_SIMPLEX</span>, <span class="hljs-number">2</span>, (<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>), <span class="hljs-number">2</span>)   #å·¦ä¸‹è§’åæ ‡

plt<span class="hljs-selector-class">.imshow</span>(img[:,:,::-<span class="hljs-number">1</span>])
plt<span class="hljs-selector-class">.title</span>('case show')
plt<span class="hljs-selector-class">.show</span>()
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LangChain æ¡†æ¶æ ¸å¿ƒå‘é‡å­˜å‚¨]]></title>    <link>https://juejin.cn/post/7604344066579267635</link>    <guid>https://juejin.cn/post/7604344066579267635</guid>    <pubDate>2026-02-09T02:47:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604344066579267635" data-draft-id="7604039449468059698" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LangChain æ¡†æ¶æ ¸å¿ƒå‘é‡å­˜å‚¨"/> <meta itemprop="keywords" content="LangChain"/> <meta itemprop="datePublished" content="2026-02-09T02:47:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‰å¸½lufei"/> <meta itemprop="url" content="https://juejin.cn/user/501033035632093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LangChain æ¡†æ¶æ ¸å¿ƒå‘é‡å­˜å‚¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/501033035632093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‰å¸½lufei
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T02:47:11.000Z" title="Mon Feb 09 2026 02:47:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;color:#3c9dff}.markdown-body h1{font-size:30px;margin-bottom:5px;padding-bottom:8px;text-align:center}.markdown-body h2{font-size:24px;padding-bottom:6px}.markdown-body h2:before{content:"ğŸ‹"}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{content:"ğŸ“"}.markdown-body h4{font-size:16px}.markdown-body h4:before{content:"ğŸ‘"}.markdown-body h5{font-size:15px}.markdown-body h5:before{content:"ğŸ‰"}.markdown-body h6{margin-top:5px}.markdown-body h6:before{content:"ğŸ’"}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;margin:0 auto;max-width:100%;border-radius:4px;padding:1px;border:1px solid #d2e8ff}.markdown-body img:hover{box-shadow:0 1px 3px #5eaeff}.markdown-body hr{height:4px;margin:34px 0;background-size:4px 1px;background-image:linear-gradient(270deg,#5eaeff,#f3f9ff 25%,transparent 50%);border-style:none}.markdown-body code{word-break:break-word;border-radius:3px;overflow-x:auto;background-color:#d2e8ff;color:#3c9dff;font-size:.9em;padding:.1em .5em;margin:0 3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;transition:all .3s}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:1px solid #90c7ff;border-radius:4px}.markdown-body pre:hover{box-shadow:0 1px 10px #beddff}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#3c9dff;border-bottom:1px solid #90c7ff;transition:all .3s}.markdown-body a:hover{color:#007fff;border-bottom:2px solid #5eaeff}.markdown-body a[href]:not(:empty){padding-right:18px}.markdown-body a[href]:not(:empty):after{display:inline-block;width:16px;height:16px;margin-left:2px;content:"";background:url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxwYXRoIGQ9Ik0zODQgMTI4YTQ4IDQ4IDAgMDEyLjgxNiA5NS45MkwzODQgMjI0SDI1NmEzMiAzMiAwIDAwLTMxLjkyIDI5LjZMMjI0IDI1NnY1MTJhMzIgMzIgMCAwMDI5LjYgMzEuOTJsMi40LjA4aDUxMmEzMiAzMiAwIDAwMzEuOTItMjkuNmwuMDgtMi40VjY1NmE0OCA0OCAwIDAxOTUuOTItMi44MTZMODk2IDY1NnYxMTJhMTI4IDEyOCAwIDAxLTEyNCAxMjcuOTM2bC00IC4wNjRIMjU2YTEyOCAxMjggMCAwMS0xMjcuOTM2LTEyNGwtLjA2NC00VjI1NmExMjggMTI4IDAgMDExMjQtMTI3LjkzNmw0LS4wNjRoMTI4em0zODQgMGExMjggMTI4IDAgMDExMjcuOTM2IDEyNGwuMDY0IDR2MTYwYTQ4IDQ4IDAgMDEtOTUuOTIgMi44MTZMODAwIDQxNlYyOTEuODcybC0zODIuMDY0IDM4Mi4wOGE0OCA0OCAwIDAxLTcwLjAzMi02NS42bDIuMTYtMi4yODhMNzMyLjA5NiAyMjRINjA4YTQ4IDQ4IDAgMDEtMi44MTYtOTUuOTJMNjA4IDEyOGgxNjB6IiBmaWxsPSIjM2M5ZGZmIiBmaWxsLW9wYWNpdHk9Ii41NiIgZGF0YS1zcG0tYW5jaG9yLWlkPSJhMzEzeC5zZWFyY2hfaW5kZXguMC5pMC41Yzc1M2E4MTgwa2RKWCIgY2xhc3M9InNlbGVjdGVkIi8+PC9zdmc+);background-size:100%}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border:1px solid #3c9dff}.markdown-body thead{text-align:center}.markdown-body thead th{color:#fff;background-color:#5eaeff}.markdown-body tr{text-align:center}.markdown-body tbody tr:hover{background-color:#d2e8ff}.markdown-body tbody tr:hover code{background-color:#90c7ff}.markdown-body tr:nth-child(2n){background-color:#ecf5ff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5eaeff}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{font-weight:900;padding:0 1px;font-size:17px}.markdown-body small{color:#cbcbcb;padding:0 1px;font-size:22px;zoom:.5}.markdown-body em{padding:0 1px}.markdown-body del{padding:0 1px;text-decoration-thickness:2px}.markdown-body blockquote{color:#1a1b1c;padding:1px 20px;margin:22px 0;border-radius:4px;border-left:4px solid rgba(60,157,255,.5);background-color:rgba(190,221,255,.3)}.markdown-body blockquote blockquote{margin:8px 0}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{margin:12px 0;padding:4px 10px;border:2px solid #3c9dff;border-radius:8px;background-color:#ecf5ff;transition:all .3s}.markdown-body details summary{cursor:pointer}.markdown-body input[type=checkbox]{position:relative;appearance:none;width:16px;height:16px;border-radius:2px;vertical-align:middle;transform:translateY(-2px);box-sizing:border-box;border:1px solid #beddff}.markdown-body input[type=checkbox]:checked{border:1px solid #5eaeff;background-color:#5eaeff}.markdown-body input[type=checkbox]:checked:before{position:absolute;top:3px;left:1px;width:11px;height:6px;background-color:transparent;border-left:2px solid #fff;border-bottom:2px solid #fff;transform:rotate(-45deg);content:"";box-sizing:border-box}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>ä¹‹å‰å­¦ä¹ äº†LangChainä¸­çš„åµŒå…¥ï¼Œæ¥ä¸‹æ¥å­¦ä¹ LangChainä¸­çš„å‘é‡å­˜å‚¨</p>
<h2 data-id="heading-1">æ¦‚å¿µ</h2>
<p>å‘é‡å­˜å‚¨ï¼ˆVector Storeï¼‰æ˜¯ LangChain ä¸­ç”¨äºå­˜å‚¨å’Œæ£€ç´¢åµŒå…¥å‘é‡çš„ç»„ä»¶</p>
<p>ç”¨äºå­˜å‚¨ã€ç®¡ç†æ–‡æœ¬ / å¤šæ¨¡æ€æ•°æ®è½¬æ¢åçš„å‘é‡ï¼ŒåŒæ—¶æä¾›é«˜æ•ˆç›¸ä¼¼æ€§æ£€ç´¢èƒ½åŠ›</p>
<p>æ˜¯ RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ã€AI Agent è®°å¿†ã€çŸ¥è¯†åº“é—®ç­”ç­‰åœºæ™¯çš„åŸºç¡€ï¼Œè§£å†³äº†å¤§æ¨¡å‹ä¸Šä¸‹æ–‡çª—å£æœ‰é™ã€æ— æ³•è®°ä½æµ·é‡å¤–éƒ¨çŸ¥è¯†çš„æ ¸å¿ƒé—®é¢˜</p>
<h3 data-id="heading-2">ä»€ä¹ˆæ˜¯å‘é‡</h3>
<p>ä¸‹é¢æ˜¯è‡ªç„¶è¯­è¨€å¤„ç†å’Œæœºå™¨å­¦ä¹ ä¸­çš„å‘é‡æ¦‚å¿µï¼š</p>
<p>å‘é‡ï¼ˆVectorï¼‰æ˜¯ä¸€ä¸ªæ•°å€¼æ•°ç»„ï¼Œç”¨äºè¡¨ç¤ºæ–‡æœ¬æˆ–æ–‡æ¡£çš„è¯­ä¹‰ä¿¡æ¯ã€‚æ¯ä¸ªå…ƒç´ éƒ½ä»£è¡¨äº†æ–‡æœ¬ä¸­çš„ä¸€ä¸ªç‰¹å¾æˆ–ç»´åº¦ï¼Œè€Œå‘é‡çš„é•¿åº¦åˆ™å†³å®šäº†è¯¥æ–‡æœ¬çš„ç‰¹å¾æ•°é‡ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸ªç®€å•çš„æ–‡æœ¬åˆ†ç±»ä»»åŠ¡ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªç±»åˆ«ï¼šâ€œæƒ…æ„Ÿåˆ†æâ€å’Œâ€œä¸»é¢˜åˆ†ç±»â€ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘é‡æ¥è¡¨ç¤ºæ¯ä¸ªæ–‡æœ¬çš„ç‰¹å¾ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>æƒ…æ„Ÿåˆ†æå‘é‡ï¼š[0.2, -0.3, 0.5]</li>
<li>ä¸»é¢˜åˆ†ç±»å‘é‡ï¼š[-0.1, 0.4, -0.2]</li>
</ul>
<p>è¿™äº›å‘é‡å¯ä»¥ç”¨äºè¡¨ç¤ºä¸åŒçš„æ–‡æœ¬ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡è®¡ç®—ç›¸ä¼¼åº¦æ¥åˆ¤æ–­å®ƒä»¬ä¹‹é—´çš„å…³ç³»</p>
<p>è·¨ä¸“ä¸šå­¦ä¹ éœ€è¦æ¶è¡¥çš„ä¸œè¥¿è¿˜æ˜¯æŒºå¤šçš„ï¼Œæ¦‚å¿µçš„æœ‰æ—¶å€™çœ‹çš„ä¹Ÿæ˜¯ä¼¼æ‡‚éæ‡‚(å¾ˆå¤šæ—¶å€™æ˜¯ä¸€è„¸æ‡µé€¼)</p>
<h2 data-id="heading-3">LangChain VectorStores çš„æ ¸å¿ƒåŠŸèƒ½</h2>
<p>çœ‹ä¸‹å¸¸è§çš„å‘é‡å­˜å‚¨æ–¹æ¡ˆ</p>
<h3 data-id="heading-4">FAISS</h3>
<p>FAISS æ˜¯ Facebook å¼€æºçš„é«˜æ•ˆå‘é‡ç›¸ä¼¼åº¦æ£€ç´¢åº“ï¼Œå…¨åæ˜¯ Facebook AI Similarity Searchã€‚ä¸å¾—ä¸æ„Ÿå¹å¤§å‚æ˜¯çœŸå¼ï¼Œæ—¥å¸¸å·¥ä½œç”Ÿæ´»å¤§éƒ¨åˆ†éƒ½æ˜¯å¤§å‚çš„äº§å“å’ŒæœåŠ¡</p>
<p>FAISS æ˜¯ LangChain VectorStore ä¸­æœ€å¸¸ç”¨çš„æœ¬åœ°å‘é‡å­˜å‚¨æ–¹æ¡ˆä¹‹ä¸€ï¼Œæ ¸å¿ƒä¼˜åŠ¿æ˜¯å¼€æºå…è´¹ã€æœ¬åœ°éƒ¨ç½²æ— é¢å¤–æˆæœ¬ã€ç›¸ä¼¼åº¦æ£€ç´¢é€Ÿåº¦æå¿«ï¼Œå°¤å…¶é€‚åˆä¸­å°è§„æ¨¡å‘é‡æ•°æ®ï¼ˆç™¾ä¸‡çº§ä»¥å†…ï¼‰çš„ AI Agentã€çŸ¥è¯†åº“é—®ç­”ç­‰åœºæ™¯</p>
<p>è¿™ä¸å®Œç¾åŒ¹é…äº†æˆ‘è¿™ç§å¼€å‘è€…ç°åœ¨çš„éœ€æ±‚çš„å—ï¼Œæœ¬åœ°å¼€å‘ç ”ç©¶ï¼Œå†ç”¨ä¸ªæœ¬åœ°çš„çŸ¥è¯†åº“ï¼Œç”¨ç€ Ollama è·‘èµ·æ¥çš„æœ¬åœ°æ¨¡å‹</p>
<h3 data-id="heading-5">Pinecone</h3>
<p>Pinecone æ˜¯ LangChain VectorStore ç”Ÿæ€ä¸­æ‰˜ç®¡å¼äº‘å‘é‡æ•°æ®åº“çš„ä»£è¡¨ï¼Œæ ¸å¿ƒä¼˜åŠ¿æ˜¯å…¨æ‰˜ç®¡å…è¿ç»´ã€åˆ†å¸ƒå¼é«˜å¯ç”¨ã€è¶…å¤§è§„æ¨¡å‘é‡æ£€ç´¢å¿«ï¼Œæ— éœ€æœ¬åœ°éƒ¨ç½²ç´¢å¼•ï¼Œé€‚é…ç”Ÿäº§ç¯å¢ƒå’Œå¤§è§„æ¨¡å‘é‡åœºæ™¯ï¼Œé€‚åˆéœ€è¦ç¨³å®šæœåŠ¡ã€ä¸æƒ³ç»´æŠ¤åº•å±‚å­˜å‚¨çš„å¼€å‘åœºæ™¯</p>
<p>Pinecone å°±æ˜¯äº‘ç«¯ç½‘ç›˜ï¼ˆå¹³å°æ‰˜ç®¡ã€éšæ—¶è®¿é—®ã€æ”¯æŒè¶…å¤§æ–‡ä»¶ã€ä»˜è´¹ä½¿ç”¨ï¼‰</p>
<p>å¤§è§„æ¨¡ä¼ä¸šçº§åœºæ™¯ä¸‹ç”¨çš„ï¼Œä¸é€‚åˆä¸ªäººå­¦ä¹ ç ”ç©¶åœºæ™¯</p>
<h3 data-id="heading-6">Chroma</h3>
<p>Chroma æ˜¯ä¸€æ¬¾ä¸“ä¸º LLM åº”ç”¨è®¾è®¡çš„è½»é‡çº§å¼€æºå‘é‡æ•°æ®åº“ï¼Œæ ¸å¿ƒå®šä½æ˜¯ã€Œè®©å‘é‡å­˜å‚¨å˜å¾—ç®€å•ã€â€”â€” æ— éœ€å¤æ‚éƒ¨ç½²ï¼Œä¸€è¡Œä»£ç å³å¯å¯åŠ¨ï¼Œæ”¯æŒå‘é‡çš„å­˜å‚¨ã€ç›¸ä¼¼åº¦æ£€ç´¢ã€åŠ¨æ€å¢åˆ æ”¹ï¼Œè¿˜èƒ½å…³è”å…ƒæ•°æ®ï¼ˆå¦‚æ–‡æ¡£æ¥æºã€ç±»å‹ï¼‰ï¼Œåƒä¸€ä¸ªã€Œä¸“ä¸º LLM æ‰“é€ çš„æœ¬åœ°å‘é‡è®°äº‹æœ¬ã€</p>
<p>ç±»æ¯”åœºæ™¯ï¼šFAISS æ˜¯ä¸€æ¬¡æ€§å†™å…¥çš„æœ¬åœ° U ç›˜ï¼ŒChroma æ˜¯å¯éšæ—¶å¢åˆ æ–‡ä»¶çš„æœ¬åœ°ç§»åŠ¨ç¡¬ç›˜ï¼ŒPinecone æ˜¯äº‘ç«¯ç½‘ç›˜ï¼ŒChroma å…¼é¡¾äº†æœ¬åœ°çš„ä¾¿æ·æ€§å’ŒåŠ¨æ€æ›´æ–°çš„çµæ´»æ€§</p>
<h3 data-id="heading-7">Milvus</h3>
<p>Milvus æ˜¯ LangChain VectorStore ç”Ÿæ€é‡Œå·¥ä¸šçº§ã€å¼€æºã€åˆ†å¸ƒå¼ã€å¯æ‰©å±•çš„å‘é‡æ•°æ®åº“ï¼Œä¸»æ‰“å¤§è§„æ¨¡å‘é‡ï¼ˆäº¿çº§ï¼‰ã€é«˜æ€§èƒ½æ£€ç´¢ã€åŠ¨æ€æ›´æ–°ã€é«˜å¯ç”¨ï¼Œæ˜¯ä»æœ¬åœ°å¼€å‘åˆ°ä¼ä¸šçº§ç”Ÿäº§çš„å…¨é“¾è·¯å‘é‡å­˜å‚¨æ–¹æ¡ˆï¼Œå®Œç¾è¡”æ¥ FAISS/Chromaï¼ˆæœ¬åœ°è½»é‡ï¼‰ä¸ Pineconeï¼ˆäº‘ç«¯æ‰˜ç®¡ï¼‰çš„ä¸­é—´åœ°å¸¦</p>
<p>ç±»æ¯”ï¼šFAISS æ˜¯æœ¬åœ° U ç›˜ï¼ŒChroma æ˜¯æœ¬åœ°ç§»åŠ¨ç¡¬ç›˜ï¼ŒMilvus æ˜¯æœ¬åœ°å¯æ‰©å±•æœåŠ¡å™¨ + äº‘ç«¯é›†ç¾¤ï¼Œæ—¢èƒ½æœ¬åœ°å¿«é€Ÿè·‘ï¼Œä¹Ÿèƒ½æ”¯æ’‘ä¼ä¸šçº§å¤§è§„æ¨¡å‘é‡æœåŠ¡Milvus</p>
<p>ä¸Šé¢çš„è¿™äº›å‘é‡å­˜å‚¨æ–¹æ¡ˆéƒ½å®ç°äº† <code>åˆ›å»ºå‘é‡å­˜å‚¨</code>ã€<code>ç›¸ä¼¼åº¦æœç´¢</code>ã€<code>å¸¦åˆ†æ•°çš„ç›¸ä¼¼åº¦æœç´¢</code>ã€<code>æœ€å¤§è¾¹é™…ç›¸å…³æ€§æœç´¢</code>ã€<code>ä¿å­˜å’ŒåŠ è½½</code> ç­‰æ ¸å¿ƒåŠŸèƒ½</p>
<h2 data-id="heading-8">ç›¸ä¼¼åº¦æœç´¢çš„åŸç†</h2>
<p>ç›¸ä¼¼åº¦æœç´¢æ˜¯å‘é‡å­˜å‚¨çš„æ ¸å¿ƒåŠŸèƒ½ï¼ŒåŸºæœ¬åŸç†æ˜¯å°†æŸ¥è¯¢æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡ï¼Œè®¡ç®—æŸ¥è¯¢å‘é‡ä¸å­˜å‚¨ä¸­æ‰€æœ‰å‘é‡çš„ç›¸ä¼¼åº¦ï¼Œè¿”å›ç›¸ä¼¼åº¦æœ€é«˜çš„å‰å‡ ä¸ªç»“æœ</p>
<p>å¸¸ç”¨çš„ç›¸ä¼¼åº¦åº¦é‡æ–¹æ³•åŒ…æ‹¬ <code>ä½™å¼¦ç›¸ä¼¼åº¦</code>ã€<code>æ¬§æ°è·ç¦»</code>ã€<code>ç‚¹ç§¯</code> ç­‰</p>
<h2 data-id="heading-9">ä»£ç ç¤ºä¾‹</h2>
<p>ä¸‹é¢æ˜¯ <code>FAISS</code> å‘é‡å­˜å‚¨çš„åŸºç¡€ä»£ç ç¤ºä¾‹ï¼Œå…¶ä»–ç±»å‹çš„å­˜å‚¨æ–¹æ¡ˆå°±å…ˆä¸å†™äº†ï¼Œé¡¹ç›®çº§å±‚é¢ç”¨åˆ°å†çœ‹</p>
<h3 data-id="heading-10">æ³¨æ„</h3>
<p><code>from langchain_community.embeddings import HuggingFaceEmbeddings</code> ä¸ºè€ç‰ˆæœ¬å†™æ³•ï¼Œæˆ‘è¿™é‡Œè¿è¡Œæ—¶å‡ºç°é—®é¢˜ï¼Œéœ€ç”¨æ–°ç‰ˆæœ¬</p>
<p>æ–°ç‰ˆæœ¬å†™æ³•æ›´ç®€å•ï¼Œç›´æ¥ä» <code>langchain_huggingface</code> å¯¼å…¥ <code>HuggingFaceEmbeddings</code> å³å¯</p>
<pre><code class="hljs language-python" lang="python">
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> langchain_community.vectorstores <span class="hljs-keyword">import</span> FAISS
<span class="hljs-comment"># from langchain_community.embeddings import HuggingFaceEmbeddings</span>
<span class="hljs-keyword">from</span> langchain_huggingface <span class="hljs-keyword">import</span> HuggingFaceEmbeddings

<span class="hljs-comment"># æ ¸å¿ƒç¤ºä¾‹ï¼šFAISS å‘é‡å­˜å‚¨å®Œæ•´æµç¨‹</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">faiss_vector_store_core_demo</span>():
    <span class="hljs-comment"># 1. å‡†å¤‡åŸºç¡€æ–‡æœ¬æ•°æ®ï¼ˆå¾…å‘é‡åŒ–çš„åŸå§‹å†…å®¹ï¼‰</span>
    documents = [
        <span class="hljs-string">"LangChain æ˜¯ç”¨äºå¼€å‘è¯­è¨€æ¨¡å‹åº”ç”¨çš„æ¡†æ¶ã€‚"</span>,
        <span class="hljs-string">"FAISS æ˜¯ Facebook å¼€å‘çš„é«˜æ•ˆç›¸ä¼¼åº¦æœç´¢åº“ã€‚"</span>,
        <span class="hljs-string">"Embedding æ¨¡å‹å°†æ–‡æœ¬è½¬æ¢ä¸ºæ•°å€¼å‘é‡è¡¨ç¤ºã€‚"</span>
    ]

    <span class="hljs-comment"># 2. åˆå§‹åŒ–åµŒå…¥æ¨¡å‹ï¼ˆæ ¸å¿ƒï¼šæ–‡æœ¬è½¬å‘é‡çš„å·¥å…·ï¼‰</span>
    <span class="hljs-comment"># é€‰ç”¨å¤šè¯­è¨€æ¨¡å‹ï¼Œé€‚é…ä¸­æ–‡åœºæ™¯</span>
    embeddings = HuggingFaceEmbeddings(
        model_name=<span class="hljs-string">"sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2"</span>
    )

    <span class="hljs-comment"># 3. åˆ›å»º FAISS å‘é‡å­˜å‚¨ï¼ˆæ ¸å¿ƒæ­¥éª¤ï¼šæ–‡æœ¬â†’å‘é‡â†’å…¥åº“ï¼‰</span>
    <span class="hljs-comment"># from_texts æ–¹æ³•ä¼šè‡ªåŠ¨å®Œæˆï¼šéå†æ–‡æœ¬â†’è°ƒç”¨åµŒå…¥æ¨¡å‹ç”Ÿæˆå‘é‡â†’å­˜å…¥ FAISS ç´¢å¼•</span>
    vector_store = FAISS.from_texts(documents, embeddings)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">" FAISS å‘é‡åº“åˆ›å»ºå®Œæˆï¼ˆæ–‡æœ¬å·²è½¬ä¸ºå‘é‡å¹¶å­˜å‚¨ï¼‰"</span>)

    <span class="hljs-comment"># 4. å‘é‡æ£€ç´¢ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼šæ ¹æ®æŸ¥è¯¢å‘é‡æ‰¾ç›¸ä¼¼æ–‡æœ¬ï¼‰</span>
    query = <span class="hljs-string">"ä»€ä¹ˆæ˜¯ FAISSï¼Ÿ"</span>
    <span class="hljs-comment"># similarity_searchï¼šæ ¹æ®æŸ¥è¯¢æ–‡æœ¬ç”Ÿæˆå‘é‡ï¼Œåœ¨ FAISS ä¸­æ‰¾æœ€ç›¸ä¼¼çš„ top-k ç»“æœ</span>
    results = vector_store.similarity_search(query, k=<span class="hljs-number">1</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n æ£€ç´¢æŸ¥è¯¢ï¼š<span class="hljs-subst">{query}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ£€ç´¢ç»“æœï¼š<span class="hljs-subst">{results[<span class="hljs-number">0</span>].page_content}</span>"</span>)

    <span class="hljs-comment"># 5. å‘é‡åº“æŒä¹…åŒ–ï¼ˆæ ¸å¿ƒï¼šä¿å­˜åˆ°æœ¬åœ°ï¼Œé¿å…é‡å¤ç”Ÿæˆå‘é‡ï¼‰</span>
    save_path = <span class="hljs-string">"./faiss_core_index"</span>
    vector_store.save_local(save_path)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n å‘é‡åº“å·²ä¿å­˜åˆ°æœ¬åœ°ï¼š<span class="hljs-subst">{save_path}</span>"</span>)

    <span class="hljs-comment"># 6. åŠ è½½æœ¬åœ°å‘é‡åº“ï¼ˆæ ¸å¿ƒï¼šå¤ç”¨å·²ç”Ÿæˆçš„å‘é‡åº“ï¼‰</span>
    loaded_vector_store = FAISS.load_local(
        save_path, 
        embeddings,
        allow_dangerous_deserialization=<span class="hljs-literal">True</span>  <span class="hljs-comment"># æœ¬åœ°åŠ è½½å¿…éœ€å‚æ•°</span>
    )
    <span class="hljs-comment"># éªŒè¯åŠ è½½ç»“æœ</span>
    test_query = <span class="hljs-string">"ä»€ä¹ˆæ˜¯ Embeddingï¼Ÿ"</span>
    loaded_result = loaded_vector_store.similarity_search(test_query, k=<span class="hljs-number">1</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n åŠ è½½åéªŒè¯ - æŸ¥è¯¢ï¼š<span class="hljs-subst">{test_query}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"éªŒè¯ç»“æœï¼š<span class="hljs-subst">{loaded_result[<span class="hljs-number">0</span>].page_content}</span>"</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    faiss_vector_store_core_demo()

</code></pre>
<p>ä»£ç è¿è¡Œç»“æœ</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9d48fe634da48029d36b63432ce536e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771210033&amp;x-signature=hlGz2QQ5zxPCR7kPHcg5bAd4ZI0%3D" alt="" loading="lazy"/></p>
<p>å‘é‡åº“æŒä¹…åŒ–åˆ°æœ¬åœ°ä¼šåœ¨é¡¹ç›®å¯¹åº”ç›®å½•ç”Ÿæˆ <code>faiss_core_index</code> æ–‡ä»¶å¤¹ï¼ŒåŒ…å«ç´¢å¼•æ–‡ä»¶å’Œé…ç½®æ–‡ä»¶</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88ae14cf0d144af1a7bfb92bde6cc017~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771210033&amp;x-signature=52lISNE80Plr%2FNe8Mh3mD2NyqXA%3D" alt="" loading="lazy"/></p>
<p>è¿™ç§æ–‡ä»¶æ˜¯æ— æ³•ç›´æ¥åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€çš„</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6fb74d6a736b4211973e713be39f4d00~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771210033&amp;x-signature=Fzr1CxgdWnbKmNWyq2FYZIH30SI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-11">å°ç»“</h2>
<p>LangChain VectorStores å‘é‡å­˜å‚¨ç›¸å…³çŸ¥è¯†å°±åŸºæœ¬äº†è§£äº†ï¼Œå¹¶äº†è§£äº† FAISS å‘é‡å­˜å‚¨çš„åŸºæœ¬åŸç†å’Œä»£ç å®ç°ï¼Œå…¶ä»–ç±»å‹ç›®å‰æ²¡æœ‰åˆé€‚çš„æ—¶æœºå’Œé¡¹ç›®åœºæ™¯å»å°è¯•ï¼Œå°±ä¸å±•å¼€äº†</p>
<p>æ¥ä¸‹æ¥å°†åœ¨æœ¬åœ°å®ç°ä¸€ä¸ªåŸºäºçŸ¥è¯†åº“çš„é—®ç­”ç³»ç»Ÿï¼Œå®æˆ˜æ“ä½œä¸€æ³¢</p>
<blockquote>
<p>æ¬¢è¿ç•™è¨€äº¤æµï¼Œå¦‚æœè§‰å¾—æœ‰å¸®åŠ©ï¼Œå¯ä»¥<code>ç‚¹ä¸ªèµ</code>æ”¯æŒä¸€ä¸‹</p>
<p>å…¬ä¼—å·ï¼šè‰å¸½lufei</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å…¨ç½‘æœ€ç«çš„ Agent Skills éƒ½åœ¨è¿™äº†ï¼è¿™ 7 ä¸ªå®è—å¸‚åœºå»ºè®®æ”¶è—]]></title>    <link>https://juejin.cn/post/7603854784865927208</link>    <guid>https://juejin.cn/post/7603854784865927208</guid>    <pubDate>2026-02-09T03:05:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603854784865927208" data-draft-id="7604036853129789455" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å…¨ç½‘æœ€ç«çš„ Agent Skills éƒ½åœ¨è¿™äº†ï¼è¿™ 7 ä¸ªå®è—å¸‚åœºå»ºè®®æ”¶è—"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-02-09T03:05:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ‚Ÿé¸£"/> <meta itemprop="url" content="https://juejin.cn/user/4107431171852270"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å…¨ç½‘æœ€ç«çš„ Agent Skills éƒ½åœ¨è¿™äº†ï¼è¿™ 7 ä¸ªå®è—å¸‚åœºå»ºè®®æ”¶è—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4107431171852270/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ‚Ÿé¸£
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T03:05:36.000Z" title="Mon Feb 09 2026 03:05:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ€è¿‘ Agent Skills ç‰¹åˆ«ç«ï¼Œå¾ˆå¤šæœ‹å‹éƒ½æƒ³æ‰¾ä¸€äº›ç‰¹åˆ«å¥½ç”¨çš„ã€ç‰¹åˆ«æœ‰ç”¨çš„ skillsã€‚</p>
<p>è¿™ç¯‡æ–‡ç« ç»™å¤§å®¶ç›˜ç‚¹ä¸€ä¸‹æ¯”è¾ƒçŸ¥åä¸”ç›¸å¯¹æ¯”è¾ƒç«çˆ†çš„ä¸€äº› skills å¸‚åœºã€‚</p>
<hr/>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/492607feafb04371a21693726c832fc4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771211229&amp;x-signature=S4oDZE1Ga7h%2BD6MxYF8HsRx9ZJ4%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>Anthropic å®˜æ–¹å¸‚åœºï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fskills" target="_blank" title="https://github.com/anthropics/skills" ref="nofollow noopener noreferrer">github.com/anthropics/â€¦</a> Â ï¼Œå®˜æ–¹çš„å’±å°±ä¸ç”¨å¤šè¯´äº†ã€‚</p>
<hr/>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/405379c69ee74abe8c821173f724a9ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771211229&amp;x-signature=uVMGEC7PqxyLZ9OkACeJioaSG5M%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>Anthropic é»‘å®¢æ¾å† å†›å¤§ä½¬çš„ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Faffaan-m%2Feverything-claude-code" target="_blank" title="https://github.com/affaan-m/everything-claude-code" ref="nofollow noopener noreferrer">github.com/affaan-m/evâ€¦</a></p>
<p>ä¸ä»…åŒ…æ‹¬ skillsï¼Œè¿˜åŒ…æ‹¬ commandsã€subagentsã€rulesã€hooks ç­‰ï¼Œæ AI Coding ä¸€å®šä¸èƒ½é”™è¿‡ã€‚</p>
<hr/>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3bdeb4d54c6b417b840aa0316fe25370~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771211229&amp;x-signature=dUb7thzNve3PbwluuyOKulV0CEM%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fobra%2Fsuperpowers" target="_blank" title="https://github.com/obra/superpowers" ref="nofollow noopener noreferrer">github.com/obra/superpâ€¦</a> Â å¦å¤–ä¸€ä¸ªæ¯”è¾ƒç«çˆ†çš„ Coding ç›¸å…³çš„ä»“åº“ã€‚</p>
<hr/>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b74f456ac1e42b790b86431e4a0284f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771211229&amp;x-signature=602rvJyRpZsYxqI6BU7U4fpZAOg%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æˆ‘çš„ Skills æ’ä»¶å¸‚åœºï¼ˆå¤¹å¸¦ä¸€ä¸‹ç§è´§ï¼Œå“ˆå“ˆï¼Œå®Œå…¨å…è´¹ï¼‰ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchujianyun%2Fskills" target="_blank" title="https://github.com/chujianyun/skills" ref="nofollow noopener noreferrer">github.com/chujianyun/â€¦</a> Â åŒ…æ‹¬æç¤ºè¯è‡ªåŠ¨ä¼˜åŒ–å’Œ skills è‡ªåŠ¨åŒæ­¥ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec6e915e6e8441fe89596151b9c124c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771211229&amp;x-signature=e2cxr2vyMtMMnwaWAYBaWv4sDTw%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å¾ˆå¤šæœ‹å‹å†™æç¤ºè¯æ—¶å­˜åœ¨ä¸¤ä¸ªç—›ç‚¹ï¼Œä¸€ä¸ªæ˜¯å¯èƒ½ä¼šè¯´å¾—ä¸å¤Ÿæ¸…æ¥šï¼Œå­˜åœ¨æ­§ä¹‰ï¼Œè¿˜æœ‰ä¸€ä¸ªç—›ç‚¹å°±æ˜¯ä¸çŸ¥é“æœ‰å“ªäº›ä¸“ä¸šçš„æ¡†æ¶è®°ä¸ä½ï¼Œç„¶åä¹Ÿä¸ä¼šå†™ã€‚</p>
<p>èº«è¾¹æœ‰æœ‹å‹åš AI Â ä¸šåŠ¡è‡ªå·±å†™ä¸€ä¸ªåˆç‰ˆæç¤ºè¯ï¼Œç„¶åç”¨æˆ‘çš„æç¤ºè¯è‡ªåŠ¨ä¼˜åŒ– skill åŒ¹é…æœ€ä¸“ä¸šçš„æ¡†æ¶ï¼Œç„¶åæ¾„æ¸…å’Œè¿›è¡Œä¼˜åŒ–ï¼Œåé¦ˆæ•ˆæœæœ‰æå‡ã€‚</p>
<hr/>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be287f7690b24d6f893fe86e3fed3695~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771211229&amp;x-signature=ICD%2B2EnyyGkx%2FE7UHSQuBsyn2fM%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fskills.sh%2F" target="_blank" title="https://skills.sh/" ref="nofollow noopener noreferrer">skills.sh/</a> Â è¿™ä¸ªç½‘ç«™çš„æœ€å¤§ç‰¹è‰²å°±æ˜¯æ”¯æŒä¸€ä¸ªæŒ‡ä»¤ï¼Œè‡ªåŠ¨æ£€æµ‹å¤šä¸ªçŸ¥å Agentï¼Œè‡ªåŠ¨ä¸€é”®å®‰è£…ã€‚</p>
<hr/>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b2f6df4ace104d6e82ce4741c50cb3c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771211229&amp;x-signature=oMsCRRrb5QG4OVYnnsVWH6lsH28%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>Qoder ç¤¾åŒº <a href="https://link.juejin.cn?target=https%3A%2F%2Fqoder-community.pages.dev%2Fzh%2Fskills%2F" target="_blank" title="https://qoder-community.pages.dev/zh/skills/" ref="nofollow noopener noreferrer">qoder-community.pages.dev/zh/skills/</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f655c1c3b7344b5be55dec89a69577e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771211229&amp;x-signature=k882SUB0l%2FRhsCDOdNNX3dS4yo0%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>è¿™é‡Œæä¾›äº†å¾ˆå¤š skillsï¼Œæ¯”è¾ƒå¤§çš„ç‰¹è‰²å°±æ˜¯æŒ‰ç…§å²—ä½è¿›è¡Œåˆ†ç±»ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ced235b80bec45f38117d78454a7af1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771211229&amp;x-signature=6M5ewUckYyJinLzt6EWENgSwzdo%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å®˜æ–¹ä¹Ÿä¼šç²¾é€‰ä¸€äº›é«˜è´¨é‡çš„ skillsã€‚</p>
<hr/>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51a49cb0358b42de80637cb70f225d65~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771211229&amp;x-signature=ud%2BNfcWxhRHGHkYvaJDVAk1s%2FJg%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fskillsmp.com%2F" target="_blank" title="https://skillsmp.com/" ref="nofollow noopener noreferrer">skillsmp.com/</a> Â å¯ä»¥çœ‹åˆ° skills çš„å¢é•¿è¶‹åŠ¿ã€‚é‡Œé¢çš„ skills éå¸¸é½å…¨ï¼Œè€Œä¸”æ”¯æŒåˆ†ç±»å’Œæ’åºã€‚</p>
<hr/>
<p>ä½ è¿˜æœ‰å…¶ä»–éå¸¸å¥½çš„ skills æ’ä»¶å’Œèšåˆå¸‚åœºï¼Ÿæ¬¢è¿ç•™è¨€è¡¥å……ï¼</p>
<p>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·ï¼š<strong>æ‚Ÿé¸£AI</strong>ï¼Œåç»­ä¼šé™†ç»­åˆ†äº«æ¯”è¾ƒæœ‰ç”¨çš„ AI å·¥å…·å’Œæ¯”è¾ƒå¥½çš„ AI ç»éªŒï¼Œæ¯”è¾ƒå®¢è§‚ç†æ€§çš„ AI è§‚ç‚¹ç­‰ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/274f08d089e94a15b0e0636a834f983d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf6bij:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771211229&amp;x-signature=EzbZBGqHFdAI04PIul6sCDMtelk%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰ç³»ç»Ÿ]]></title>    <link>https://juejin.cn/post/7604080364354043931</link>    <guid>https://juejin.cn/post/7604080364354043931</guid>    <pubDate>2026-02-09T03:07:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604080364354043931" data-draft-id="7604080364353962011" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰ç³»ç»Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-09T03:07:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Aniugel"/> <meta itemprop="url" content="https://juejin.cn/user/3034307824198407"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰ç³»ç»Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3034307824198407/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Aniugel
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T03:07:21.000Z" title="Mon Feb 09 2026 03:07:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">ä¸€ã€æ•´ä½“æ¶æ„è®¾è®¡ï¼ˆæ ¸å¿ƒåŸåˆ™ï¼‰</h3>
<p>å…ˆæ˜ç¡®æ•´ä½“æµç¨‹å’Œæ ¸å¿ƒçº¦æŸï¼Œç¡®ä¿ Cookies ä»…å­˜å‚¨åœ¨è®¤è¯ä¸­å¿ƒåŸŸåä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc3290f3e98a42318021eae316cebada~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5pdWdlbA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771211240&amp;x-signature=dD7QRuoDyilshbCVGxgN2XepNUc%3D" alt="deepseek_mermaid_20260209_441885.png" loading="lazy"/></p>
<p>æ ¸å¿ƒçº¦æŸï¼š</p>
<ul>
<li>ä»… <strong>SSO è®¤è¯ä¸­å¿ƒåŸŸå</strong> ä¸‹å­˜å‚¨ç™»å½•æ€ Cookieï¼ˆå¦‚ <code>sso_token</code>ï¼‰ï¼›</li>
<li>å„ä¸šåŠ¡ç³»ç»Ÿå‰ç«¯<strong>ä¸å­˜å‚¨ä»»ä½•ç™»å½•æ€ Cookie</strong>ï¼Œä»…åœ¨å†…å­˜ /localStorage å­˜å‚¨ä¸´æ—¶ä¸šåŠ¡ tokenï¼›</li>
<li>è·¨åŸŸç™»å½•æ€é€šè¿‡ã€Œæˆæƒç æ¨¡å¼ã€ä¼ é€’ï¼Œé¿å… Cookie è·¨åŸŸé—®é¢˜ã€‚</li>
</ul>
<h3 data-id="heading-1">äºŒã€å„è§’è‰²èŒè´£ä¸æä¾›çš„æœåŠ¡</h3>
<h4 data-id="heading-2">1. å‰ç«¯ï¼ˆVue3ï¼‰ï¼šæ ¸å¿ƒèŒè´£æ˜¯ã€Œæ—  Cookie ç™»å½•æ€ç®¡ç† + è·¨åŸŸè®¤è¯è·³è½¬ã€</h4>
<h5 data-id="heading-3">æ ¸å¿ƒèŒè´£</h5>








































<table><thead><tr><th>èŒè´£é¡¹</th><th>å…·ä½“æ“ä½œ</th><th>æŠ€æœ¯å®ç°</th></tr></thead><tbody><tr><td>ç™»å½•æ€æ£€æµ‹</td><td>åˆå§‹åŒ–æ—¶æ£€æµ‹å½“å‰æ˜¯å¦æœ‰æœ‰æ•ˆä¸šåŠ¡ tokenï¼Œæ— åˆ™è·³è½¬è®¤è¯ä¸­å¿ƒ</td><td>è·¯ç”±å®ˆå«ï¼ˆbeforeEachï¼‰</td></tr><tr><td>è®¤è¯è·³è½¬</td><td>æ‹¼æ¥è®¤è¯ä¸­å¿ƒåœ°å€ + ä¸šåŠ¡ç³»ç»Ÿå›è°ƒåœ°å€ï¼Œè·³è½¬è‡³ SSO ç™»å½•é¡µ</td><td>åŠ¨æ€æ‹¼æ¥ URL å‚æ•°</td></tr><tr><td>æˆæƒç å¤„ç†</td><td>è®¤è¯ä¸­å¿ƒé‡å®šå‘å›ä¸šåŠ¡ç³»ç»Ÿæ—¶ï¼Œè§£æ URL ä¸­çš„æˆæƒç </td><td>URLSearchParams</td></tr><tr><td>ä¸´æ—¶ token ç®¡ç†</td><td>å­˜å‚¨ä¸šåŠ¡åç«¯è¿”å›çš„ä¸´æ—¶ tokenï¼ˆå†…å­˜ /localStorageï¼‰ï¼Œæ—  Cookie</td><td>Pinia/Vuex + å†…å­˜å˜é‡</td></tr><tr><td>æ¥å£è¯·æ±‚æ‹¦æˆª</td><td>æ‰€æœ‰æ¥å£è¯·æ±‚æºå¸¦ä¸´æ—¶ tokenï¼ˆHeader ä¸­ï¼‰ï¼Œæ—  Cookie ä¼ é€’</td><td>Axios æ‹¦æˆªå™¨</td></tr><tr><td>ç™»å‡ºå¤„ç†</td><td>è·³è½¬è®¤è¯ä¸­å¿ƒç™»å‡ºæ¥å£ï¼Œæ¸…é™¤æœ¬åœ°ä¸´æ—¶ token</td><td>è·³è½¬ SSO ç™»å‡ºåœ°å€ + æ¸…é™¤æœ¬åœ°å­˜å‚¨</td></tr></tbody></table>
<h5 data-id="heading-4">å‰ç«¯æä¾›çš„æœåŠ¡</h5>
<ul>
<li>æ ‡å‡†åŒ–çš„è®¤è¯è·³è½¬ç»„ä»¶ï¼ˆå¯å¤ç”¨çš„ SSO ç™»å½•è·³è½¬é€»è¾‘ï¼‰ï¼›</li>
<li>ç»Ÿä¸€çš„ token ç®¡ç†å·¥å…·ï¼ˆPinia/Vuex æ¨¡å—ï¼Œå°è£… token å¢åˆ æŸ¥ï¼‰ï¼›</li>
<li>è·¨åŸŸè®¤è¯å›è°ƒå¤„ç†é¡µé¢ï¼ˆcallback.vueï¼‰ï¼›</li>
<li>æ—  Cookie çš„æ¥å£è¯·æ±‚å°è£…ï¼ˆAxios æ‹¦æˆªå™¨ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-5">2. åç«¯ï¼šæ ¸å¿ƒèŒè´£æ˜¯ã€Œæˆæƒç æ ¡éªŒ + ä¸šåŠ¡ token ç”Ÿæˆ + è·¨åŸŸè®¤è¯æ¥å£ã€</h4>
<h5 data-id="heading-6">æ ¸å¿ƒèŒè´£ï¼ˆåˆ†ã€Œè®¤è¯ä¸­å¿ƒåç«¯ã€å’Œã€Œä¸šåŠ¡ç³»ç»Ÿåç«¯ã€ï¼‰</h5>













































<table><thead><tr><th>è§’è‰²</th><th>èŒè´£é¡¹</th><th>å…·ä½“æ“ä½œ</th></tr></thead><tbody><tr><td>è®¤è¯ä¸­å¿ƒåç«¯</td><td>ç™»å½•æ¥å£</td><td>éªŒè¯ç”¨æˆ·åå¯†ç ï¼Œç”Ÿæˆ sso_tokenï¼Œå­˜å‚¨è‡³è®¤è¯ä¸­å¿ƒ Cookieï¼ˆä»…æœ¬åŸŸåï¼‰</td></tr><tr><td>è®¤è¯ä¸­å¿ƒåç«¯</td><td>æˆæƒç ç”Ÿæˆ</td><td>éªŒè¯ä¸šåŠ¡ç³»ç»Ÿåˆæ³•æ€§ï¼Œç”Ÿæˆä¸€æ¬¡æ€§æˆæƒç ï¼Œé‡å®šå‘å›ä¸šåŠ¡ç³»ç»Ÿ</td></tr><tr><td>è®¤è¯ä¸­å¿ƒåç«¯</td><td>æˆæƒç æ ¡éªŒ</td><td>æ¥æ”¶ä¸šåŠ¡åç«¯çš„æ ¡éªŒè¯·æ±‚ï¼ŒéªŒè¯æˆæƒç æœ‰æ•ˆæ€§ï¼Œè¿”å› sso_token</td></tr><tr><td>è®¤è¯ä¸­å¿ƒåç«¯</td><td>ç™»å‡ºæ¥å£</td><td>æ¸…é™¤è®¤è¯ä¸­å¿ƒ Cookie ä¸­çš„ sso_tokenï¼Œå¹¶é‡å®šå‘è‡³å„ä¸šåŠ¡ç³»ç»Ÿç™»å‡ºé¡µ</td></tr><tr><td>ä¸šåŠ¡ç³»ç»Ÿåç«¯</td><td>æˆæƒç å…‘æ¢</td><td>æ¥æ”¶å‰ç«¯çš„æˆæƒç ï¼Œè°ƒç”¨è®¤è¯ä¸­å¿ƒæ¥å£æ ¡éªŒï¼Œè·å– sso_token</td></tr><tr><td>ä¸šåŠ¡ç³»ç»Ÿåç«¯</td><td>ä¸šåŠ¡ token ç”Ÿæˆ</td><td>åŸºäº sso_token ç”Ÿæˆä¸šåŠ¡ç³»ç»Ÿä¸“å±ä¸´æ—¶ tokenï¼ˆJWTï¼‰ï¼Œè¿”å›å‰ç«¯</td></tr><tr><td>ä¸šåŠ¡ç³»ç»Ÿåç«¯</td><td>æ¥å£é‰´æƒ</td><td>æ ¡éªŒå‰ç«¯æºå¸¦çš„ä¸šåŠ¡ tokenï¼Œæ—  Cookie æ ¡éªŒ</td></tr></tbody></table>
<h5 data-id="heading-7">åç«¯æä¾›çš„æœåŠ¡</h5>
<ul>
<li>è®¤è¯ä¸­å¿ƒï¼šç™»å½• / ç™»å‡º / æˆæƒç ç”Ÿæˆ / æˆæƒç æ ¡éªŒæ¥å£ï¼›</li>
<li>ä¸šåŠ¡ç³»ç»Ÿï¼šæˆæƒç å…‘æ¢æ¥å£ã€ä¸šåŠ¡ token æ ¡éªŒæ¥å£ã€ç»Ÿä¸€é‰´æƒæ‹¦æˆªå™¨ï¼›</li>
<li>è·¨åŸŸé…ç½®ï¼šå…è®¸ä¸šåŠ¡ç³»ç»Ÿå‰ç«¯è·¨åŸŸè°ƒç”¨è®¤è¯ä¸­å¿ƒæ¥å£ï¼ˆCORS é…ç½®ï¼‰ï¼›</li>
<li>å®‰å…¨ç­–ç•¥ï¼šCookie çš„ HttpOnly/Secure/SameSite é…ç½®ï¼Œé˜²æ­¢ CSRF/XSSã€‚</li>
</ul>
<h4 data-id="heading-8">3. è¿ç»´ï¼šæ ¸å¿ƒèŒè´£æ˜¯ã€ŒåŸŸå / ç½‘ç»œé…ç½® + å®‰å…¨ç­–ç•¥ + éƒ¨ç½²è¿ç»´ã€</h4>
<h5 data-id="heading-9">æ ¸å¿ƒèŒè´£</h5>








































<table><thead><tr><th>èŒè´£é¡¹</th><th>å…·ä½“æ“ä½œ</th><th>æŠ€æœ¯å®ç°</th></tr></thead><tbody><tr><td>åŸŸåè§„åˆ’</td><td>ç‹¬ç«‹çš„è®¤è¯ä¸­å¿ƒåŸŸåï¼ˆå¦‚<a href="https://link.juejin.cn?target=https%3A%2F%2Fsso.yourdomain.com" target="_blank" title="https://sso.yourdomain.com" ref="nofollow noopener noreferrer">sso.yourdomain.com</a>ï¼‰ï¼Œä¸ä¸šåŠ¡ç³»ç»ŸåŸŸåéš”ç¦»</td><td>DNS è§£æé…ç½®</td></tr><tr><td>HTTPS é…ç½®</td><td>æ‰€æœ‰åŸŸåå¼ºåˆ¶ HTTPSï¼ˆCookie çš„ Secure å±æ€§è¦æ±‚ï¼‰</td><td>Nginx é…ç½® + SSL è¯ä¹¦éƒ¨ç½²</td></tr><tr><td>è·¨åŸŸé…ç½®</td><td>Nginx å±‚é¢é…ç½® CORSï¼Œå…è®¸ä¸šåŠ¡ç³»ç»Ÿè·¨åŸŸè®¿é—®è®¤è¯ä¸­å¿ƒ</td><td>Nginx çš„ add_header Access-Control-*</td></tr><tr><td>Cookie å®‰å…¨é…ç½®</td><td>ç¡®ä¿è®¤è¯ä¸­å¿ƒ Cookie ä»…åœ¨æœ¬åŸŸåç”Ÿæ•ˆï¼Œç¦æ­¢è·¨åŸŸæºå¸¦</td><td>Nginx / åç«¯åŒé‡é…ç½® Cookie å±æ€§</td></tr><tr><td>éƒ¨ç½²æ¶æ„</td><td>è®¤è¯ä¸­å¿ƒæœåŠ¡é«˜å¯ç”¨éƒ¨ç½²ï¼Œä¸šåŠ¡ç³»ç»Ÿä¸è®¤è¯ä¸­å¿ƒç½‘ç»œäº’é€š</td><td>è´Ÿè½½å‡è¡¡ï¼ˆLBï¼‰+ é›†ç¾¤éƒ¨ç½²</td></tr><tr><td>æ—¥å¿—ç›‘æ§</td><td>ç›‘æ§è®¤è¯ä¸­å¿ƒç™»å½• / ç™»å‡ºæ—¥å¿—ï¼Œæ’æŸ¥è·¨åŸŸè®¤è¯é—®é¢˜</td><td>ELK/Prometheus + Grafana</td></tr></tbody></table>
<h5 data-id="heading-10">è¿ç»´æä¾›çš„æœåŠ¡</h5>
<ul>
<li>ç‹¬ç«‹çš„ SSO è®¤è¯ä¸­å¿ƒåŸŸååŠ SSL è¯ä¹¦éƒ¨ç½²ï¼›</li>
<li>å„ä¸šåŠ¡ç³»ç»ŸåŸŸåä¸è®¤è¯ä¸­å¿ƒåŸŸåçš„ DNS è§£æï¼›</li>
<li>Nginx å±‚é¢çš„ HTTPS å¼ºåˆ¶è·³è½¬ã€CORS é…ç½®ã€Cookie å®‰å…¨é…ç½®ï¼›</li>
<li>è®¤è¯ä¸­å¿ƒæœåŠ¡çš„é«˜å¯ç”¨éƒ¨ç½²ï¼ˆé›†ç¾¤ / è´Ÿè½½å‡è¡¡ï¼‰ï¼›</li>
<li>æ—¥å¿—ç›‘æ§ç³»ç»Ÿï¼ˆè®¤è¯ä¸­å¿ƒç™»å½•æ—¥å¿—ã€è·¨åŸŸè®¿é—®æ—¥å¿—ï¼‰ï¼›</li>
<li>å®‰å…¨ç­–ç•¥é…ç½®ï¼ˆWAF é˜²æŠ¤ã€æ¥å£é™æµã€Cookie é˜²ç¯¡æ”¹ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-11">ä¸‰ã€å…³é”®å®‰å…¨æ³¨æ„äº‹é¡¹</h3>
<ol>
<li>è®¤è¯ä¸­å¿ƒ Cookie å¿…é¡»é…ç½®ï¼š<code>HttpOnly=true</code>ï¼ˆé˜²æ­¢ XSSï¼‰ã€<code>Secure=true</code>ï¼ˆä»… HTTPSï¼‰ã€<code>SameSite=Strict</code>ï¼ˆç¦æ­¢è·¨åŸŸæºå¸¦ï¼‰ï¼›</li>
<li>æˆæƒç å¿…é¡»æ˜¯<strong>ä¸€æ¬¡æ€§ã€çŸ­æœŸæœ‰æ•ˆ</strong>ï¼ˆå¦‚ 5 åˆ†é’Ÿï¼‰ï¼Œé˜²æ­¢å¤ç”¨ï¼›</li>
<li>ä¸šåŠ¡ç³»ç»Ÿä¸´æ—¶ token å»ºè®®<strong>çŸ­æœŸæœ‰æ•ˆ</strong>ï¼ˆå¦‚ 2 å°æ—¶ï¼‰ï¼Œå‰ç«¯å®šæœŸé™é»˜åˆ·æ–°ï¼ˆè°ƒç”¨ä¸šåŠ¡åç«¯åˆ·æ–°æ¥å£ï¼Œå†è°ƒç”¨è®¤è¯ä¸­å¿ƒæ ¡éªŒ sso_tokenï¼‰ï¼›</li>
<li>æ‰€æœ‰æ¥å£å¿…é¡» HTTPSï¼Œé˜²æ­¢ token æ˜æ–‡ä¼ è¾“ã€‚</li>
</ol>
<h3 data-id="heading-12">æ€»ç»“</h3>
<ol>
<li><strong>å‰ç«¯ï¼ˆVue3ï¼‰</strong> ï¼šæ ¸å¿ƒæ˜¯ã€Œæ—  Cookie ç™»å½•æ€ç®¡ç†ã€ï¼Œé€šè¿‡è·¯ç”±å®ˆå«è·³è½¬è®¤è¯ä¸­å¿ƒï¼Œè§£ææˆæƒç å…‘æ¢ä¸´æ—¶ tokenï¼Œæ¥å£è¯·æ±‚æºå¸¦ tokenï¼ˆHeaderï¼‰ï¼›</li>
<li><strong>åç«¯</strong>ï¼šè®¤è¯ä¸­å¿ƒè´Ÿè´£ç”Ÿæˆ sso_token å¹¶å­˜å‚¨è‡³è‡ªèº« Cookieï¼Œä¸šåŠ¡ç³»ç»Ÿè´Ÿè´£æ ¡éªŒæˆæƒç ã€ç”Ÿæˆä¸šåŠ¡ä¸´æ—¶ tokenï¼›</li>
<li><strong>è¿ç»´</strong>ï¼šæ ¸å¿ƒæ˜¯åŸŸåéš”ç¦»ã€HTTPS é…ç½®ã€Cookie å®‰å…¨ç­–ç•¥ï¼Œç¡®ä¿ä»…è®¤è¯ä¸­å¿ƒå­˜å‚¨ Cookieï¼Œæœç»è·¨åŸŸ Cookie é£é™©ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>