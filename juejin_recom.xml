<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[JavaScript 闭包通关指南：从作用域链到内存管理的8个核心知识点]]></title>    <link>https://juejin.cn/post/7575363120799088640</link>    <guid>https://juejin.cn/post/7575363120799088640</guid>    <pubDate>2025-11-24T00:16:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575363120799088640" data-draft-id="7575363120799072256" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript 闭包通关指南：从作用域链到内存管理的8个核心知识点"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2025-11-24T00:16:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT_陈寒"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript 闭包通关指南：从作用域链到内存管理的8个核心知识点
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT_陈寒
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T00:16:59.000Z" title="Mon Nov 24 2025 00:16:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>JavaScript 闭包通关指南：从作用域链到内存管理的8个核心知识点</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>闭包（Closure）是 JavaScript 中最强大且最容易被误解的概念之一。它不仅是面试中的高频考点，更是实际开发中解决复杂问题的利器。理解闭包不仅需要掌握作用域链、执行上下文等基础概念，还需要深入思考内存管理、性能优化等高级话题。</p>
<p>本文将系统性地拆解闭包的8个核心知识点，从作用域链的底层机制到内存泄漏的实战排查，带你彻底掌握这一重要概念。无论你是初学者还是有一定经验的开发者，都能从中获得新的启发。</p>
<hr/>
<h2 data-id="heading-2">一、作用域链：闭包的理论基石</h2>
<h3 data-id="heading-3">1.1 词法作用域 vs 动态作用域</h3>
<p>JavaScript 采用的是词法作用域（Lexical Scope），这意味着变量的可访问性在代码编写阶段就已经确定。这与动态作用域语言（如 Bash）形成鲜明对比：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">outer</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> x = <span class="hljs-string">'outer'</span>;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">inner</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(x); <span class="hljs-comment">// "outer"（词法作用域）</span>
  }
  
  <span class="hljs-title function_">inner</span>();
}

<span class="hljs-keyword">const</span> x = <span class="hljs-string">'global'</span>;
<span class="hljs-title function_">outer</span>();
</code></pre>
<h3 data-id="heading-4">1.2 [[Scope]]内部属性</h3>
<p>每个函数在创建时都会记录自己的[[Scope]]内部属性，这是一个指向当前执行环境变量对象的引用链。这是理解闭包的关键：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createCounter</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;
  
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> ++count;
  };
}

<span class="hljs-keyword">const</span> counter = <span class="hljs-title function_">createCounter</span>();
<span class="hljs-comment">// counter.[[Scope]] -&gt; [createCounter的变量对象, global变量对象]</span>
</code></pre>
<hr/>
<h2 data-id="heading-5">二、执行上下文与闭包的形成</h2>
<h3 data-id="heading-6">2.1 EC/VO/AO三件套</h3>
<p>当函数执行时会创建：</p>
<ul>
<li>EC（Execution Context）：执行上下文</li>
<li>VO（Variable Object）：变量对象（全局环境下）</li>
<li>AO（Activation Object）：活动对象（函数环境下）</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">a</span>) {
  <span class="hljs-keyword">var</span> b = a * <span class="hljs-number">2</span>;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">bar</span>(<span class="hljs-params">c</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a, b, c);
  }
  
  <span class="hljs-title function_">bar</span>(b * <span class="hljs-number">3</span>);
}

<span class="hljs-title function_">foo</span>(<span class="hljs-number">2</span>); <span class="hljs-comment">// EC栈的变化过程值得深入研究</span>
</code></pre>
<h3 data-id="heading-7">2.2 Closure的形成时机</h3>
<p>严格来说，<strong>所有JavaScript函数都是闭包</strong>，因为它们都持有[[Scope]]引用。但我们通常讨论的是那些：</p>
<ol>
<li>访问了外层变量的内层函数</li>
<li>被外部引用的内层函数</li>
</ol>
<hr/>
<h2 data-id="heading-8">III. IIFE模式与模块化</h2>
<h3 data-id="heading-9">III.I Immediately Invoked Function Expression</h3>
<p>IIFE是早期实现模块化的利器：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = (<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> privateVar = <span class="hljs-string">'secret'</span>;
  
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">getSecret</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> privateVar;
    }
  };
})();
</code></pre>
<h3 data-id="heading-10">III.II ES6之前的模块模拟</h3>
<p>通过组合IIFE和闭包可以实现完整的模块系统：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> <span class="hljs-title class_">MyModule</span> = (<span class="hljs-keyword">function</span> <span class="hljs-title function_">Manager</span>(<span class="hljs-params"/>) {
	<span class="hljs-keyword">var</span> modules = {};
	
	<span class="hljs-keyword">function</span> <span class="hljs-title function_">define</span>(<span class="hljs-params">name, deps, impl</span>) {
		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;deps.<span class="hljs-property">length</span>; i++) {
			deps[i] = modules[deps[i]];
		}
		modules[name] = impl.<span class="hljs-title function_">apply</span>(impl, deps);
	}
	
	<span class="hljs-keyword">function</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">name</span>) {
		<span class="hljs-keyword">return</span> modules[name];
	}
	
	<span class="hljs-keyword">return</span> { define, get };
})();
</code></pre>
<hr/>
<h2 data-id="heading-11">IV.  内存管理深度解析</h2>
<h3 data-id="heading-12">IV.I GC的标记清除算法</h3>
<p>现代JavaScript引擎采用标记清除算法：</p>
<ol>
<li>从根对象(window/global)出发标记可达对象</li>
<li>清除不可达对象</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createHugeArray</span>(<span class="hljs-params"/>) {
	<span class="hljs-keyword">const</span> arr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">1000000</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-string">'*'</span>);
	
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
		<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr.<span class="hljs-property">length</span>);
	};
}

<span class="hljs-keyword">let</span> closureWithHugeData = <span class="hljs-title function_">createHugeArray</span>();

<span class="hljs-comment">// closureWithHugeData持有着百万级数组的引用！</span>
</code></pre>
<h3 data-id="heading-13">IV.II Chrome DevTools实战排查</h3>
<p>通过Memory面板可以捕获堆快照：</p>
<ol>
<li>查找Retainers链条中的closure引用</li>
<li>比对多次快照间的增量变化</li>
</ol>
<hr/>
<h2 data-id="heading-14">V.  性能优化策略</h2>
<h3 data-id="heading-15">V.I Smart Closures设计模式</h3>
<p>避免不必要的变量捕获：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Bad: capture unused variable </span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">process</span>(<span class="hljs-params">data</span>) {
	<span class="hljs-keyword">const</span> unusedData = <span class="hljs-title function_">transform</span>(data);
	
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-comment">/*...*/</span> };
}

<span class="hljs-comment">// Good: minimize captured variables </span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">processOptimized</span>(<span class="hljs-params">data</span>) {
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { 
		<span class="hljs-keyword">const</span> neededData = <span class="hljs-title function_">transform</span>(data);
		<span class="hljs-comment">/*...*/</span> 
	};
}
</code></pre>
<h3 data-id="heading-16">V.I I V8引擎优化技巧</h3>
<p>V8对以下情况有特殊优化：</p>
<ol>
<li>只使用外层变量的初始值（不修改）</li>
<li>不超过一定数量的捕获变量（通常3-4个）</li>
</ol>
<hr/>
<h2 data-id="heading-17">VI . this绑定与闭包的微妙关系</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> obj = {
	<span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>,
	<span class="hljs-attr">getName</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
			<span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>; <span class="hljs-comment">// Wrong!</span>
		};
	},
	<span class="hljs-attr">getNameCorrect</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
		<span class="hljs-keyword">const</span> self = <span class="hljs-variable language_">this</span>;
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-comment">// Closure captures self </span>
			<span class="hljs-keyword">return</span> self.<span class="hljs-property">name</span>;
		};
	}
};
</code></pre>
<p>箭头函数提供了更优雅的方案：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">getNameArrow</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { 
	<span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>; 
}
</code></pre>
<hr/>
<h2 data-id="heading-18">VII . Real-World应用案例集锦</h2>
<h3 data-id="heading-19">VII.I Throttle/Debounce实现</h3>
<p>经典的防抖实现就是闭包的完美用例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">debounce</span>(<span class="hljs-params">fn, delay</span>) {
	<span class="hljs-keyword">let</span> timer;
	
	<span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> { <span class="hljs-comment">// Closure captures timer </span>
	  <span class="hljs-built_in">clearTimeout</span>(timer);
	  timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">fn</span>(...args), delay);
	};
}
</code></pre>
<h3 data-id="heading-20">VII.I I React Hooks原理剖析</h3>
<p>useState的实现本质上依赖闭包：</p>
<pre><code class="hljs language-jsx{5}" lang="jsx{5}">function useState(initialValue) { // Simplified version 
	let state = initialValue;
	
	const setState = (newValue) =&gt; { state = newValue };
	
	return [state, setState]; // Both captured by closure 
}
</code></pre>
<hr/>
<h2 data-id="heading-21">VIII . ES6+新特性对闭包的影响</h2>
<h3 data-id="heading-22">VIII.I Block Scoping的革命</h3>
<p>let/const改变了传统的var捕获方式：</p>
<pre><code class="hljs language-javascript{4}" lang="javascript{4}">for(let i=0; i&lt;3; i++) { // Each iteration gets fresh binding! 
	setTimeout(() =&gt; console.log(i), i*1000); // Logs:0,1,2 
} 

for(var j=0; j&lt;3; j++) { // Traditional var sharing same binding 
	setTimeout(() =&gt; console.log(j), j*1000); // Logs:3,3,3 
}
</code></pre>
<h3 data-id="heading-23">VIII.I I WeakMap带来的新可能</h3>
<p>解决DOM节点关联问题的新思路：</p>
<pre><code class="hljs language-javascript{5}" lang="javascript{5}">const wm = new WeakMap();

function registerHandler(element) { /* ... */ }

wm.set(elementNode1234, bigClosure); // GC友好型关联存储 

wm.get(elementNode1234)?.(event); // Safe optional chaining call 
</code></pre>
<hr/>
<h2 data-id="heading-24">Conclusion</h2>
<p>JavaScript的闭包就像一把双刃剑——用得好可以斩断复杂问题，用得不当可能导致内存泄漏。通过本文的系统梳理，我们不仅理解了[[Scope]]的内部机制，还掌握了从IIFE到现代Hooks的应用演变历程。</p>
<p>记住这些关键点：<br/>
✔️ <strong>最小化捕获原则</strong> ——只保留必要的变量引用<br/>
✔️ <strong>工具链验证</strong> ——善用DevTools验证内存影响<br/>
✔️ <strong>拥抱新特性</strong> ——合理运用块级作用域和WeakMap</p>
<p>当你下次遇到需要状态保持的场景时，不妨自信地说："这里该用闭包！"</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringCloud 常见面试题（三）]]></title>    <link>https://juejin.cn/post/7575456858427588654</link>    <guid>https://juejin.cn/post/7575456858427588654</guid>    <pubDate>2025-11-24T00:31:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575456858427588654" data-draft-id="7575017581037469734" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" SpringCloud 常见面试题（三）"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-11-24T00:31:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SevenCoding"/> <meta itemprop="url" content="https://juejin.cn/user/3261615728242467"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             SpringCloud 常见面试题（三）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3261615728242467/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SevenCoding
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T00:31:01.000Z" title="Mon Nov 24 2025 00:31:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读37分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">服务网关</h2>
<h3 data-id="heading-1">在微服务架构中，网关的作用是什么</h3>
<p>在微服务架构中，网关（Gateway）具有以下作用：</p>
<ul>
<li>统一入口：网关为所有的微服务提供一个唯一的入口点，从而简化了客户端与服务的交互，同时保障了后台服务的安全性。</li>
<li>鉴权校验：网关能够识别每个进来的请求，并根据其权限进行校验，阻止不符合要求的请求通过。</li>
<li>动态路由：根据需要，网关可以动态地将请求路由到不同的后端集群中，实现服务的灵活调度。</li>
<li>降低耦合度：通过在网关层做映射，可以将客户端与服务解耦，使服务可以独立发展，减少两者之间的依赖。</li>
<li>提供附加功能：网关不仅可以保护微服务，还可以为服务提供和沉淀更多附加功能，如熔断、限流等。</li>
</ul>
<h3 data-id="heading-2">什么是API网关？</h3>
<p>API网关（API Gateway）是一种中间层服务器，用于集中管理、保护和路由对后端服务的访问。它充当了客户端与后端服务之间的入口点，提供了一组统一的接口来管理和控制API的访问。</p>
<p>API网关的主要功能包括：</p>
<ul>
<li>路由转发：API网关根据请求的URL路径或其他标识，将请求路由到相应的后端服务。通过配置路由规则，可以灵活地将请求分发给不同的后端服务。</li>
<li>负载均衡：API网关可以在后端服务之间实现负载均衡，将请求平均分发到多个实例上，提高系统的吞吐量和可扩展性。</li>
<li>安全认证与授权：API网关可以集中处理身份验证和授权，确保只有经过身份验证的客户端才能访问后端服务。它可以与身份提供者（如OAuth、OpenID Connect）集成，进行用户认证和授权操作。</li>
<li>缓存：API网关可以缓存后端服务的响应，减少对后端服务的请求次数，提高系统性能和响应速度。</li>
<li>监控与日志：API网关可以收集和记录请求的指标和日志，提供实时监控和分析，帮助开发人员和运维人员进行故障排查和性能优化。</li>
<li>数据转换与协议转换：API网关可以在客户端和后端服务之间进行数据格式转换和协议转换，如将请求从HTTP转换为WebSocket，或将请求的参数进行格式转换，以满足后端服务的需求。</li>
<li>API版本管理：API网关可以管理不同版本的API，允许同时存在多个API版本，并通过路由规则将请求正确地路由到相应的API版本上。<br/>
……</li>
</ul>
<p>通过使用API网关，可以简化前端与后端服务的交互，提供统一的接口和安全性保障，同时也方便了服务治理和监控。它是构建微服务架构和实现API管理的重要组件之一。</p>
<h3 data-id="heading-3">SpringCloud可以选择哪些API网关？</h3>
<p>使用SpringCloud开发，可以采用以下的API网关选型：</p>
<ul>
<li>Netflix Zuul（已停止更新）：Netflix Zuul是Spring Cloud早期版本中提供的默认API网关。它基于Servlet技术栈，可以进行路由、过滤、负载均衡等功能。然而，自2020年12月起，Netflix宣布停止对Zuul 1的维护，转而支持新的API网关项目。</li>
<li>Spring Cloud Gateway：Spring Cloud Gateway是Spring Cloud官方推荐的API网关，取代了Netflix Zuul。它基于非阻塞的WebFlux框架，充分利用了响应式编程的优势，并提供了路由、过滤、断路器、限流等特性。Spring Cloud Gateway还支持与Spring Cloud的其他组件集成，如服务发现、负载均衡等。</li>
<li>Kong：Kong是一个独立的、云原生的API网关和服务管理平台，可以与Spring Cloud集成。Kong基于Nginx，提供了强大的路由、认证、授权、监控和扩展能力。它支持多种插件和扩展，可满足不同的API管理需求。</li>
<li>APISIX：APISIX基于Nginx和Lua开发，它具有强大的路由、流量控制、插件扩展等功能。APISIX支持灵活的配置方式，可以根据需求进行动态路由、负载均衡和限流等操作。</li>
</ul>
<h3 data-id="heading-4">说说你对Spring Cloud Gateway的理解</h3>
<p>Spring Cloud Gateway是Spring Cloud官方推出的第二代网关框架，取代Zuul 1.0网关。网关作为流量的，在微服务系统中有着非常作用，网关常见的功能有路由转发、权限校验、限流控制等作用。</p>
<p>使用了一个RouteLocatorBuilder的bean去创建路由，除了创建路由RouteLocatorBuilder可以让你添加各种predicates和filters，predicates断言的意思，顾名思义就是根据具体的请求的规则，由具体的route去处理，filters是各种过滤器，用来对请求做各种判断和修改。</p>
<h3 data-id="heading-5">Spring Cloud Gateway核心概念？</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/739df2fd88d44a80b6aff74c395e537a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2V2ZW5Db2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764549061&amp;x-signature=XTmBeKBIIjmJCKcVn0irdQbcaEk%3D" alt="" loading="lazy"/></p>
<p>在Spring Cloud Gateway里，有三个关键组件：</p>
<ul>
<li>Route（路由）：路由是Spring Cloud Gateway的基本构建块，它定义了请求的匹配规则和转发目标。通过配置路由，可以将请求映射到后端的服务实例或URL上。路由规则可以根据请求的路径、方法、请求头等条件进行匹配，并指定转发的目标URI。</li>
<li>Predicate（断言）：断言用于匹配请求的条件，如果请求满足断言的条件，则会应用所配置的过滤器。Spring Cloud Gateway提供了多种内置的断言，如Path（路径匹配）、Method（请求方法匹配）、Header（请求头匹配）等，同时也支持自定义断言。</li>
<li>Filter（过滤器）：过滤器用于对请求进行处理和转换，可以修改请求、响应以及执行其他自定义逻辑。Spring Cloud Gateway提供了多个内置的过滤器，如请求转发、请求重试、请求限流等。同时也支持自定义过滤器，可以根据需求编写自己的过滤器逻辑。</li>
</ul>
<p>我们再来看下Spring Cloud Gateway的具体工作流程：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55d51983374145579501ba79e01449ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2V2ZW5Db2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764549061&amp;x-signature=IO8IAQoEABkyQT98UH7W7i8zlho%3D" alt="" loading="lazy"/></p>
<p>两个比较重要的概念：</p>
<ul>
<li>Gateway Handler（网关处理器）：网关处理器是Spring Cloud Gateway的核心组件，负责将请求转发到匹配的路由上。它根据路由配置和断言条件进行路由匹配，选择合适的路由进行请求转发。网关处理器还会依次应用配置的过滤器链，对请求进行处理和转换。</li>
<li>Gateway Filter Chain（网关过滤器链）：网关过滤器链由一系列过滤器组成，按照配置的顺序依次执行。每个过滤器可以在请求前、请求后或请求发生错误时进行处理。过滤器链的执行过程可以修改请求、响应以及执行其他自定义逻辑。</li>
</ul>
<h3 data-id="heading-6">什么是限流算法，网关如何实现限流</h3>
<p>限流算法是指用于限制单位时间内服务的请求数量的算法，目的是防止服务被过高的请求压力所击垮。常见的限流算法包括计数器算法、滑动窗口算法、漏桶算法、令牌桶算法。</p>
<p>网关如何实现限流：</p>
<ul>
<li>利用限流算法插件/模块：网关可以集成限流算法插件/模块，通过配置相关参数（如令牌桶大小、令牌生成速率等）来实现限流。例如，Spring Cloud Gateway可以使用Redis的RateLimiter限流算法插件来实现限流。</li>
<li>自定义限流逻辑：网关可以通过编程方式自定义实现限流逻辑。例如，在微服务架构中，可以在每个服务的网关层（如Nacos、Eureka等）实现限流逻辑，或者使用限流SDK（如Sentinel）对请求进行限流。</li>
<li>利用云平台提供的限流功能：一些云平台提供了自动化的限流功能，例如AWS CloudWatch、Azure Application Insights等，网关可以利用这些云平台的功能来实现限流。</li>
</ul>
<h3 data-id="heading-7">你项目里为什么选择 Gateway 作为网关?</h3>
<p>选择 Spring Cloud Gateway 的原因主要有两个：</p>
<ul>
<li>以前用得比较多的是 Spring Cloud 官方开源的Zuul，其用得比较多的还是1.0 的版本，不过1.0版本 Netflix很早就宣布进入维护状态了，虽然Zuul已经出了2.0版本，但是 Spring Cloud 官方团队好像没有整合的计划，并且 Netflix 很多相关的组件，如 Eureka、Hystrix 都已经进入维护期了，所以不知道前景如间，然后 Sping doud 官方自己研发了Spring Cloud  Gateway，并且大力支持和推荐，所以相比与Zuul， Gateway是一个更好的选择。</li>
<li>Spring Cloud Gateway 有很多的特性：
<ul>
<li>基于 Spring5和 Spring Boot 2 进行构建，与 Spring 生态兼容较好</li>
<li>动态路由：可以根据配置条件，如 URL、请求方法等实现动态配置</li>
<li>可以对路由指定断言(Predicate)和过滤器(Filter)</li>
<li>集成 Hystrix 断路器功能，可以实现服务熔断</li>
<li>集成 Spring Cloud 相关组件，如 Eureka、Nacos、Consule 等实现服务的注册与发现</li>
<li>内置了限流模块，可以根据配置实现服务限流</li>
</ul>
</li>
</ul>
<h3 data-id="heading-8">Dubbo和 Spring Cloud Gateway 有什么区别?</h3>
<p>Dubbo 是一个RPC(远程过程调用)框架，主要用于服务之间的通信。它提供高性能的 RPC 调用、负载均衡、服务发现、服务注册、服务治理等功能。适用于需要高性能 RPC 调用的分布式系统，常用于内部服务通信。</p>
<p>Spring Cloud Gateway是一个API 网关，用于处理外部客户端请求并将其路由到后端服务。它提供请求路由、负载均衡、协议转换、安全管理、流量控制、日志和监控等功能。适用于微服务架构中的统一入口管理，常用于外部请求的入口层。</p>
<p>所以说它们不是一个层级的东西。</p>
<h2 data-id="heading-9">链路追踪</h2>
<h3 data-id="heading-10">为什么要用微服务链路追踪？</h3>
<p>在微服务中，有的上下游可能有十几个服务，如果某一环出了问题，排查起来非常困难，所以，就需要进行链路追踪，来帮助排查问题。</p>
<p>通过链路追踪，可以可视化地追踪请求从一个微服务到另一个微服务的调用情况。除了排查问题，链路追踪黑还可以帮助优化性能，可视化依赖关系、服务监控和告警。</p>
<h3 data-id="heading-11">SpringCloud可以选择哪些微服务链路追踪方案？</h3>
<p>Spring Cloud提供了多种选择的微服务链路追踪方案。以下是一些常用的方案：</p>
<ul>
<li>Zipkin：Zipkin 是一个开源的分布式实时追踪系统，由 Twitter 开发并贡献给开源社区。Spring Cloud Sleuth 提供了与 Zipkin 的集成，可以通过在微服务中添加相应的依赖和配置，将追踪信息发送到 Zipkin 服务器，并通过 Zipkin UI 进行可视化展示和查询。</li>
<li>Jaeger：Jaeger 是 Uber 开源的分布式追踪系统，也被纳入了 CNCF（云原生计算基金会）的维护。通过使用 Spring Cloud Sleuth 和 Jaeger 客户端库，可以将追踪信息发送到 Jaeger 并进行可视化展示和查询。</li>
<li>SkyWalking：Apache SkyWalking 是一款开源的应用性能监控与分析系统，提供了对 Java、.NET 和 Node.js 等语言的支持。它可以与 Spring Cloud Sleuth 集成，将追踪数据发送到 SkyWalking 服务器进行可视化展示和分析。</li>
<li>Pinpoint：Pinpoint 是 Naver 开源的分布式应用性能监控系统，支持 Java 和 .NET。它提供了与 Spring Cloud Sleuth 的集成，可以将追踪数据发送到 Pinpoint 服务器，并通过其 UI 进行分析和监控。</li>
</ul>
<p>这些方案都可以与 Spring Cloud Sleuth 进行集成，Spring Cloud Sleuth 是 Spring Cloud 中的一个组件，提供了在微服务调用时生成追踪信息的能力。</p>
<h2 data-id="heading-12">分布式事务</h2>
<h3 data-id="heading-13">什么情况下需要用到分布式事务？有哪些方案？</h3>
<p>分布式事务是指在多个网络节点或服务之间进行数据一致性处理的情况。以下是一些可能需要使用分布式事务的场景：</p>
<ul>
<li>微服务之间通过远程调用完成事务操作：当不同的微服务之间需要进行数据一致性保证时，就需要使用分布式事务。例如，一个电商微服务中的订单服务和库存服务需要通过远程调用进行事务操作，保证库存数量和订单信息的同步更新，避免出现超卖或缺货的情况。</li>
<li>单体系统访问多个数据库实例：当一个系统需要访问多个数据库实例时，例如用户信息和订单信息分别存储在两个不同的数据库实例中，需要通过分布式事务保证数据一致性，避免出现数据不一致的情况。</li>
<li>多服务访问同一个数据库实例：当多个服务访问同一个数据库实例时，例如订单微服务和库存微服务都需要访问同一个数据库，也可能需要使用分布式事务。因为跨JVM进程的多个服务同时持有不同的数据库连接进行数据库操作，可能会出现数据不一致的情况。</li>
</ul>
<p>在这些场景下，我们需要使用分布式事务来保证数据的一致性。常用的分布式事务方案包括两阶段提交（2PC）、三阶段提交（3PC）、TCC、Saga、本地消息表等。其中，两阶段提交和三阶段提交都是基于锁机制实现的，而TCC、Saga和本地消息表则是基于业务逻辑实现的。选择哪种方案取决于业务需求、系统复杂性和性能等多个因素。</p>
<p>详情可以看这篇文章：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.seven97.top%2Fmicroservices%2Fdistributed-system%2Fdistributedtransactions.html" target="_blank" title="https://www.seven97.top/microservices/distributed-system/distributedtransactions.html" ref="nofollow noopener noreferrer">深度解析分布式事务的七大核心方案</a></p>
<h3 data-id="heading-14">什么是分布式事务的防悬挂，空回滚?</h3>
<p>防悬挂是指在分布式事务的第一阶段，防止在没有对应的 Try 操作的情况下出现 Confirm 或 Cancel 操作。这是为了保证事务的正确性和一致性。</p>
<p>分布式事务中最常见的模型是 TCC(Try-Confirm-Cancel)模型。在 TCC 模型中，事务分为三个步骤：</p>
<ul>
<li>Try：资源的预留操作。</li>
<li>Confirm：确认操作，完成业务逻辑</li>
<li>Cancel：取消操作，回滚预留资源。</li>
</ul>
<p>防悬挂机制的作用是确保在分布式事务中，Confirm 和 Cancel 操作只会在 Try 操作成功执行后才会触发。</p>
<p>防悬挂的场景通常是以下情况：</p>
<ul>
<li>Confirm 操作悬挂：如果 Confirm 操作在没有执行过 Try 操作的情况下被调用，可能会导致数据不一致。</li>
<li>Cancel 操作悬挂：类似地，如果 Cancel 操作在没有 Try 操作的情况下被调用，也会破坏数据的一致性。</li>
</ul>
<p>为了防止这种情况，需要通过某些机制来检测和防止悬挂。例如:</p>
<ul>
<li>幂等性检查：Confirm 和 Cancel 操作应该具备幂等性，避免多次调用引发问题。</li>
<li>状态校验：在执行 Confirm 或 Cancel之前，可以先检査是否有对应的 Try 操作成功过，如果没有，则拒绝执行 Confirm 或 Cancel 操作</li>
</ul>
<p>空回滚是指在没有执行成功的Try操作时，Cancel 操作仍然被调用了。Cancel 操作实际上就是 Try操作的回滚操作，如果 Try 操作根本没有成功，则Cancel 操作实际不会对任问资源产生影响，这就是空回滚</p>
<p>空回滚一般发生在分布式系统中的异常情况下，比如：</p>
<ul>
<li>网络超时：Try 操作还没执行成功，网络就超时了，分布式事务协调器可能误认为 Try 操作失败，因此会调用 Cancel。</li>
<li>网络分区或中断：Try 操作请求未到达相应的服务端，客户端误认为 Try 操作已经失败并发起 Cancel。</li>
</ul>
<p>在这些情况下，Cancel 操作会被执行，但因为 Try 操作并没有成功，所以 Cancel 实际上什么都不需要做。这就是空回流,。为了支持空回滚，Cancel操作必须具备以下能力：</p>
<ul>
<li>幂等性：即使 Cancel 操作被多次调用，它的效果也只能是执行一次，不会对系统产生额外影响。</li>
<li>空回滚兼容性：Cancel 操作在发现没有Try 操作执行成功时，不做任何修改，直接返回成功状态</li>
</ul>
<h3 data-id="heading-15">什么是Seata？谈谈你对Seata的理解</h3>
<p>Seata是一款开源的分布式事务解决方案，它主要用于解决在分布式系统中全局事务的一致性问题。<br/>
在分布式系统中，由于一次业务操作需要跨多个数据源或进行远程调用，往往会产生分布式事务问题。例如，在一个电商微服务系统中，订单服务和库存服务需要协同工作，如果订单服务已经创建成功，但库存服务因为某些原因失败了，就会导致数据不一致的问题。Seata就是为解决这个问题而产生的。</p>
<p>Seata的主要特点是无侵入以及高性能。它对业务无侵入，可以减少技术架构上的微服务化所带来的分布式事务问题对业务的侵入，同时高性能则是减少分布式事务解决方案所带来的性能消耗。</p>
<p>在Seata的事务处理中主要有三个重要的角色：事务的协调者（TC）、事务的管理者（TM）和事务的作业管理器（RM）。</p>
<ul>
<li>事务协调者（TC）主要负责管理全局的分支事务的状态，用于全局性事务的提交和回滚。它会对所有的分支事务进行注册，然后根据各个分支事务的状态来决定是否提交或者回滚全局事务。</li>
<li>事务管理者（TM）用于开启、提交或回滚事务。它会根据业务逻辑来决定何时开启一个新的事务，并在适当的时候提交或回滚该事务。</li>
<li>资源管理器（RM）用于分支事务上的资源管理，向TC注册分支事务，上报分支事务的状态，接收TC的命令来提交或者回滚分支事务。</li>
</ul>
<h3 data-id="heading-16">Seata支持哪些模式的分布式事务？</h3>
<p>Seata以下几种模式的分布式事务：</p>
<ul>
<li>AT（Atomikos）模式：AT模式是Seata默认支持的模式，也是最常用的模式之一。在AT模式下，Seata通过在业务代码中嵌入事务上下文，实现对分布式事务的管理。Seata会拦截并解析业务代码中的SQL语句，通过对数据库连接进行拦截和代理，实现事务的管理和协调。</li>
<li>TCC（Try-Confirm-Cancel）模式：TCC模式是一种基于补偿机制的分布式事务模式。在TCC模式中，业务逻辑需要实现Try、Confirm和Cancel三个阶段的操作。Seata通过调用业务代码中的Try、Confirm和Cancel方法，并在每个阶段记录相关的操作日志，来实现分布式事务的一致性。</li>
<li>SAGA模式：SAGA模式是一种基于事件驱动的分布式事务模式。在SAGA模式中，每个服务都可以发布和订阅事件，通过事件的传递和处理来实现分布式事务的一致性。Seata提供了与SAGA模式兼容的Saga框架，用于管理和协调分布式事务的各个阶段。</li>
<li>XA模式：XA模式是一种基于两阶段提交（Two-Phase Commit）协议的分布式事务模式。在XA模式中，Seata通过与数据库的XA事务协议进行交互，实现对分布式事务的管理和协调。XA模式需要数据库本身支持XA事务，并且需要在应用程序中配置相应的XA数据源。</li>
</ul>
<h3 data-id="heading-17">了解Seata的实现原理吗？</h3>
<p>Seata的实现原理主要包括三个核心组件：事务协调器（Transaction Coordinator）、事务管理器（Transaction Manager）和资源管理器（Resource Manager）。</p>
<ul>
<li>事务协调器（Transaction Coordinator）：事务协调器负责协调和管理分布式事务的整个过程。它接收事务的开始和结束请求，并根据事务的状态进行协调和处理。事务协调器还负责记录和管理事务的全局事务 ID（Global Transaction ID）和分支事务 ID（Branch Transaction ID）。</li>
<li>事务管理器（Transaction Manager）：事务管理器负责全局事务的管理和控制。它协调各个分支事务的提交或回滚，并保证分布式事务的一致性和隔离性。事务管理器还负责与事务协调器进行通信，并将事务的状态变更进行持久化。</li>
<li>资源管理器（Resource Manager）：资源管理器负责管理和控制各个参与者（Participant）的事务操作。它与事务管理器进行通信，并根据事务管理器的指令执行相应的事务操作，包括提交和回滚。</li>
</ul>
<p>Seata的实现原理基于两阶段提交（Two-Phase Commit）协议，具体的机制如下：</p>
<ul>
<li>一阶段：在事务提交的过程中，首先进行预提交阶段。事务协调器向各个资源管理器发送预提交请求，资源管理器执行相应的事务操作并返回执行结果。在此阶段，业务数据和回滚日志记录在同一个本地事务中提交，并释放本地锁和连接资源。</li>
<li>二阶段：在预提交阶段成功后，进入真正的提交阶段。此阶段主要包括提交异步化和回滚反向补偿两个步骤：
<ul>
<li>提交异步化：事务协调器发出真正的提交请求，各个资源管理器执行最终的提交操作。这个阶段的操作是非常快速的，以确保事务的提交效率。</li>
<li>回滚反向补偿：如果在预提交阶段中有任何一个资源管理器返回失败结果，事务协调器发出回滚请求，各个资源管理器执行回滚操作，利用一阶段的回滚日志进行反向补偿。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-18">Seata的事务执行流程是什么样的？</h3>
<p>Seata事务的执行流程可以简要概括为以下几个步骤：</p>
<ul>
<li>事务发起方（Transaction Starter）发起全局事务：事务发起方是指发起分布式事务的应用程序或服务。它向Seata的事务协调器发送全局事务的开始请求，生成全局事务ID（Global Transaction ID）。</li>
<li>事务协调器创建全局事务记录：事务协调器接收到全局事务的开始请求后，会为该事务创建相应的全局事务记录，并生成分支事务ID（Branch Transaction ID）。</li>
<li>分支事务注册：事务发起方将全局事务ID和分支事务ID发送给各个参与者（Participant），即资源管理器。参与者将分支事务ID注册到本地事务管理器，并将事务的执行结果反馈给事务协调器。</li>
<li>执行业务逻辑：在分布式事务的上下文中，各个参与者执行各自的本地事务，即执行业务逻辑和数据库操作。</li>
<li>预提交阶段：事务发起方向事务协调器发送预提交请求，事务协调器将预提交请求发送给各个参与者。</li>
<li>执行本地事务确认：参与者接收到预提交请求后，执行本地事务的确认操作，并将本地事务的执行结果反馈给事务协调器。</li>
<li>全局事务提交或回滚：事务协调器根据参与者反馈的结果进行判断，如果所有参与者的本地事务都执行成功，事务协调器发送真正的提交请求给参与者，参与者执行最终的提交操作；如果有任何一个参与者的本地事务执行失败，事务协调器发送回滚请求给参与者，参与者执行回滚操作。</li>
<li>完成全局事务：事务协调器接收到参与者的提交或回滚结果后，根据结果更新全局事务的状态，并通知事务发起方全局事务的最终结果。</li>
</ul>
<h3 data-id="heading-19">全局事务ID和分支事务ID是怎么传递的？</h3>
<p>全局事务ID和分支事务ID在分布式事务中通过上下文传递的方式进行传递。常见的传递方式包括参数传递、线程上下文传递和消息中间件传递。具体的传递方式可以根据业务场景和技术选型进行选择和调整。</p>
<h3 data-id="heading-20">Seata的事务回滚是怎么实现的？</h3>
<p>Seata的事务回滚是通过回滚日志实现的。每个参与者在执行本地事务期间生成回滚日志，记录了对数据的修改操作。</p>
<p>当需要回滚事务时，事务协调器向参与者发送回滚请求，参与者根据回滚日志中的信息执行撤销操作，将数据恢复到事务开始前的状态。</p>
<p>回滚日志的管理和存储是Seata的核心机制，可以选择将日志存储在不同的介质中。通过回滚日志的持久化和恢复，Seata确保了事务的一致性和恢复性。</p>
<h3 data-id="heading-21">Sentinel 与Hystrix的区别是什么</h3>
<p>Hystrix和Sentinel都是微服务架构中实现熔断和限流的工具，它们有以下区别和特点：</p>
<p>Hystrix是Netflix开源的熔断器实现，主要用于保护分布式系统中的服务调用。它的主要特点包括线程隔离、资源保护和降级处理。Hystrix通过将每个服务调用放入独立的线程池中来实现线程隔离，防止一个服务的延迟或故障影响其他服务。它通过监控服务调用的成功率、延迟等指标来保护后端资源，并在失败的请求或响应超时达到一定阈值时自动打开熔断器，避免连锁故障。此外，Hystrix还提供了降级处理功能，可以在服务不可用或响应过慢时返回预定义的降级响应，保证系统的可用性。</p>
<p>Sentinel是阿里巴巴开源的流量控制和系统保护工具，主要用于实现微服务架构中的流量控制、熔断、降级和系统负载保护等。它的主要特点包括实时监控和动态规则配置、丰富的流量控制策略、细粒度的服务保护以及支持多种编程语言。Sentinel可以实时监控服务的请求流量和各项指标，并提供实时的仪表盘和可视化的监控界面。它还支持通过API动态配置流量控制和熔断规则，可以根据实际情况进行动态调整。Sentinel提供了多种流量控制策略，包括基于QPS、线程数、并发连接数等多种指标进行的流量控制。此外，Sentinel还支持对每个具体的服务接口进行熔断、降级和限流等操作，以实现精确的服务保护策略。同时，Sentinel不仅支持Java，还支持Go、Python等多种编程语言，使其适用于跨语言的微服务架构。</p>
<p>总的来说，Hystrix注重线程隔离和资源保护，适用于保护单个服务调用。而Sentinel注重流量控制和动态规则配置，适用于对整个系统的流量进行监控和保护。根据实际需求和技术栈，可以选择适合的工具来实现微服务架构中的熔断和限流功能。</p>
<h3 data-id="heading-22">如果 Sentinel 的异常处理规则不满足需求，应该怎么办？</h3>
<p>如果 Sentinel 的默认异常处理机制无法满足需求，可以选择自定义异常处理规则。</p>
<p>Sentinel 允许通过自定义实现 BlockedExceptionHandler 接口，然后将自定义的异常处理器对象交给 Spring 容器进行管理。 可以根据实际业务需求，定制化异常处理策略，例如全局兜底处理、日志打印、空指针检查等。 同时，还可以在处理器中加入自定义的业务逻辑，例如对异常进行分类、统计和反馈等。 这样，可以根据具体的应用场景和业务需求，灵活地扩展 Sentinel 的异常处理能力。</p>
<h3 data-id="heading-23">什么是分布式事务的防悬挂，空回滚</h3>
<p>在分布式事务中，防悬挂和空回滚是两个重要的概念，它们通常在实现分布式事务时涉及的锁定机制、隔离性、错误处理等方面。下面对这两个概念进行详细解释</p>
<ol>
<li>防悬挂
防悬挂是指在分布式事务的第一阶段，防止在没有对应的 Try 操作的情况下出现 Confirm 或 Cancel操作。这是为了保证事务的正确性和一致性。</li>
</ol>
<p>分布式事务中最常见的模型是 TCC(Try-Confirm-Cancel)模型。在 TCC 模型中，事务通常分为三个步骤：</p>
<ul>
<li>Try：资源的预留操作。</li>
<li>Confirm：确认操作，完成业务逻辑</li>
<li>Cancel：取消操作，回滚预留资源。</li>
</ul>
<p>防悬挂机制的作用是确保在分布式事务中，Confirm 和 Cancel 操作只会在 Try 操作成功执行后才会触发。防悬挂的场景通常是以下情况：</p>
<ul>
<li>Confirm 操作悬挂：如果 Confirm 操作在没有执行过 Try 操作的情况下被调用，可能会导致数据不一致</li>
<li>Cancel 操作悬挂：类似地，如果 Cancel 操作在没有 Try 操作的情况下被调用，也会破坏数据的一致性。</li>
</ul>
<p>为了防止这种情况，通常需要通过某些机制来检测和防止悬挂。例如:</p>
<ul>
<li>幂等性检查：Confirm 和 Cancel 操作应该具备幂等性，避免多次调用引发问题。</li>
<li>状态校验：在执行 Confirm 或 Cancel 之前，可以先检查是否有对应的 Try 操作成功过，如果没有，则拒绝执行 Confirm 或 Cancel 操作</li>
</ul>
<ol start="2">
<li>空回滚
空回滚是指在没有执行成功的Try操作时，Cancel操作仍然被调用了。Cancel操作实际上就是 Try操作的回滚操作，如果 Try 操作很本没有成功，则 Cancel 操作实际不会对任何资源产生影响，这种情况下称为空回滚</li>
</ol>
<p>空回滚通常发生在分布式系统中的异常情况下，比如:</p>
<ul>
<li>网络超时：Try 操作还没执行成功，网络就超时了，分布式事务协调器可能误认为 Try 操作失败，因此会调用 Cancel。</li>
<li>网络分区或中断：Try 操作请求未到达相应的服务端，客户端误认为 Try 操作已经失败并发起 Cancel。</li>
</ul>
<p>在这些情况下，Cancel 操作会被执行，但因为 Try 操作并没有成功，所以 Cancel 实际上什么都不需要做。这就是空回滚。</p>
<p>为了支持空回滚，Cancel 操作必须具备以下能力:</p>
<ul>
<li>幂等性：即使 Cancel 操作被多次调用，它的效果也只能是执行一次，不会对系统产生额外影响。</li>
<li>空回滚兼容性：Cancel操作在发现没有 Try 操作执行成功时，不做任何修改，直接返回成功状态</li>
</ul>
<h3 data-id="heading-24">当前有个本地操作 A，远程操作 B，我需要保证 A和 B事务的一致性，你会如何实现？</h3>
<blockquote>
<p>这个题目经常有人会直接踩坑，然后就被面试官绕进去出不来了</p>
</blockquote>
<p>要保证本地操作A和远程操作B的事务一致性，这是一个分布式事务问题。不能在本地事务中直接嵌入远程 RPC调用(这就是坑)，而是通过异步解耦+补偿机制实现最终一致性。</p>
<p>常见方案是本地消息表：本地事务A执行时，先记录一条“待执行远程操作B”的日志(与A在同一事务中)，本地事务提交后，通过异步线程或消息队列触发远程调用B、若B失败，通过定时任务重试(因为有日志，可以扫描日志重试)，直到成功或人工介入。</p>
<p>为什么不能在本地事务中直接调用远程 RPC?</p>
<pre><code class="hljs language-text" lang="text">begin transaction
  update A 本地数据库
  调用远程服务B（RPC）
commit
</code></pre>
<p>举个例子：本地操作A是“扣库存”(数据库事务)，远程操作B是“调用支付接口扣款”。如果在本地事务中直接调用B，若 B超时 则本地事务回滚，但B实际执行了，导致库存与支付状态不一致。</p>
<p>除此之外，还有长事务问题，毕竟外部系统不可控(即使是公司其他部分的接口)，若B执行时间过长，会导致 A 操作本地事务锁持有时间延长，引发数据库连接耗尽或死锁问题。</p>
<p>所以，不建议将 RPC调用嵌入本地事务中。同理，像发MQ、更新外部系统(如缓存)等操作，都不建议放在事务内。</p>
<h3 data-id="heading-25">现在需要你设计一个将已登录的用户踢下线的功能，如何实现?</h3>
<p>可以通过标记用户 token 为失效或者直接移除其 session来实现踢下线功能</p>
<p>简单来说，就是让后续请求中带的登录凭证不再被系统接受。标记失效和直接删除都行，这样用户下次请求就会被拦截或要求重新登录</p>
<h2 data-id="heading-26">分布式系统</h2>
<h3 data-id="heading-27">把单体项目进行了多机部署，多台服务器是如何共享用户登录信息的？</h3>
<p>目前主流有两个方案：</p>
<ol>
<li>将 Session 放置第三方共享存储中，例如 Redis、Memcached 等分布式缓存 或数据库中，所有的服务器统一访问第三方。</li>
<li>JWT，即服务器不存储会话，用户登录后返回签名令牌(含用户信息)，每次请求携带令牌验证即可。不过现在很多项目会把 JWT 存在 Redis 中</li>
</ol>
<p>因为单机时候会话(Session)会存储在本地，比如 Tomcat 的 HttpSession 默认存在当前服务器内存中。多机部署后，同一个用户多次请求可能会被负载均衡到其他服务器，新服务器无法读取原会话数据，这时候登录态就丢了有些人会采用 粘性会话，比如利用 Nginx 根据用户 IP 或 Cookie 哈希固定转发到同一台服务器。这个方式有局限性，如果服务器宕机了会话就丢失(登录态就掉了)，且扩容缩容时会导致负载不均，无法实现真正的弹性伸缩。所以普遍会采用第三方共享存储 Session，比如用 Redis 存放 Session，这样一来所有的服务都可以共享访问到同一个 Session。</p>
<p>举个例子</p>
<ol>
<li>用户登录后，服务端生成 SessionID，并将用户数据(如用户ID、权限)写入Redis(Key=SessionID，Value=序列化数据)。</li>
<li>响应中设置 Cookie(如SESSION=abc123)或 Header 返回 Token。</li>
<li>用户下次请求携带 Session ID，任意服务器从 Redis 读取数据，还原用户上下文</li>
</ol>
<h2 data-id="heading-28">服务监控</h2>
<h3 data-id="heading-29">你们的服务怎么做监控和告警？</h3>
<p>我们使用Prometheus和Grafana来实现整个微服务集群的监控和告警：</p>
<ul>
<li>Prometheus：Prometheus 是一个开源的监控系统，具有灵活的数据模型和强大的查询语言，能够收集和存储时间序列数据。它可以通过HTTP协议定期拉取微服务的指标数据，并提供可扩展的存储和查询功能。</li>
<li>Grafana：Grafana 是一个开源的可视化仪表板工具，可以与 Prometheus 结合使用，创建实时和历史数据的仪表板。Grafana 提供了丰富的图表和可视化选项，可以帮助用户更好地理解和分析微服务的性能和状态。</li>
</ul>
<h3 data-id="heading-30">你们的服务怎么做日志收集？</h3>
<p>日志收集有很多种方案，我们用的是ELK：</p>
<ul>
<li>Elasticsearch：Elasticsearch是一个分布式搜索和分析引擎，用于存储和索引大量的日志数据。它提供了快速的搜索和聚合功能，可以高效地处理大规模的日志数据。</li>
<li>Logstash：Logstash是一个用于收集、过滤和转发日志数据的工具。它可以从各种来源（如文件、网络、消息队列等）收集日志数据，并对数据进行处理和转换，然后将其发送到Elasticsearch进行存储和索引。</li>
<li>Kibana：Kibana是一个用于日志数据可视化和分析的工具。它提供了丰富的图表、仪表盘和搜索功能，可以帮助用户实时监控和分析日志数据，发现潜在的问题和趋势。</li>
</ul>
<p>简单说，这三者里Elasticsearch提供数据存储和检索能力，Logstash负责将日志收集到ES，Kibana负责日志数据的可视化分析。</p>
<p>使用ELK进行微服务日志收集的一般流程如下：</p>
<ol>
<li>在每个微服务中配置日志输出：将微服务的日志输出到标准输出（stdout）或日志文件。</li>
<li>使用Logstash收集日志：配置Logstash收集器，通过配置输入插件（如文件输入、网络输入等）监听微服务的日志输出，并进行过滤和处理。</li>
<li>将日志数据发送到Elasticsearch：配置Logstash的输出插件，将经过处理的日志数据发送到Elasticsearch进行存储和索引。</li>
<li>使用Kibana进行可视化和分析：通过Kibana连接到Elasticsearch，创建仪表盘、图表和搜索查询，实时监控和分析微服务的日志数据。</li>
</ol>
<p>除了应用最广泛的ELK，还有一些其它的方案比如Fluentd、Graylog、Loki、Filebeat，一些云厂商也提供了付费方案，比如阿里云的sls。</p>
<h2 data-id="heading-31">其它</h2>
<h3 data-id="heading-32">说一下你对于 DDD 的了解?</h3>
<p>DDD全名叫做 Domain-driven design，即领域驱动设计，它是一种软件开发方法，其主要目的就是让开发人员和领域专家可以更好地协作，从而开发出满足业务需求的系统</p>
<p>DDD 的关键概念包括领域模型和限界上下文。</p>
<ul>
<li>领域模型描述了业务领域的规则和逻辑，让开发人员能够更好地理解业务需求。</li>
<li>限界上下文则定义了一个特定的业务领域内的模型和代码，使得其可以独立于其他上下文进行开发和维护。</li>
</ul>
<p>除此之外，DDD还强调分层架构和事件溯源的重要性，分层架构将系统划分为不同层次的结构，每个层次的职责和角色各有不同，从而方便业务代码的开发和维护。事件溯源则是一种存储和处理业务事件的技术，支持审计、合规和业务分析等需求。</p>
<p>总得来说，DOD是一种设计和开发复杂软件系统的方法，一般情况下 MVC 已经能够完成许多软件业务的开发了，如果项目本身比较简单，引入 DDD的话不仅不能降低开发成本，还会增加开发的复杂程度，所以 DDD 在使用之前需要一定的思考。</p>
<h3 data-id="heading-33">什么是灰度发布、金丝雀部署以及蓝绿部署?</h3>
<p>灰度发布、金丝雀部署和蓝绿部署是三种常见的软件发布策略，它们用于在系统升级时降低风险，确保在新版本上线过程中服务的稳定性和可控性</p>
<ul>
<li>灰度发布</li>
</ul>
<p>灰度发布是一种新进式的发布方式，它通过将新版本逐步推送给部分用户进行试用，逐步扩大使用范围，直到新版本完全替换旧版本，其目的是通过小范围的用户测试，验证新版本的稳定性，降低发布新版本的风验</p>
<p>实现方式：通常通过流量控制的方式，将一部分用户请求引导到新版本实例上。如果新版本表现正常，可以逐步增加新版本的用户群体，直到全量用户使用新版本。</p>
<p>适用场景：适合在业务逻辑变动较大的场景中使用，通过灰度发布可以发现新版本中的潜在问题，并在影响范围较小的情况下进行回滚。</p>
<ul>
<li>金丝雀部署</li>
</ul>
<p>金丝雀部署(Ccanary Deployment)是一种特殊的灰度发布策略，通常是指将新版本部署到少量的实例上，并仅将部分流量引导至这些实例，以验证新版本在实际生产环境中的表现。</p>
<p>和灰度发布的区别：金丝雀部署更强调在生产环境中逐步验证新版本的表现，类似于让“金丝雀”先进入矿井检测安全性，一旦检测到问题，可以快速回滚。</p>
<p>实现方式：可以通过负载均衡器或服务网格，将一定比例的流量引导到运行新版本的实例上。若新版本稳定，再逐步增加其流量占比。</p>
<p>适用场景：适用于需要在生产环境中验证新功能或配置变更的场景。通过金丝雀部署，可以提前发现新版本在生产环境中的潜在问题，降低对全量用户的影响,</p>
<ul>
<li>蓝绿部署</li>
</ul>
<p>蓝绿部署(Blue-Green Deployment)是一种无缝切换的部署策略，在这种模式下，生产环境中始终存在两个版本：蓝色版本(当前的生产版本)和绿色版本(新版本)。当绿色版本准备就绪时，通过负载均衡或路由切换，将所有流量从蓝色版本切换到绿色版本。</p>
<p>特点：在蓝绿部署中，旧版本(蓝色版本)始终保持可用，可以在新版本(绿色版本)出现问题时，快速切换回旧版本，实现快速回滚。</p>
<p>实现方式：通常通过负载均衡器、DNS 切换或 API网关，来切换蓝色版本和绿色版本之间的流量指向。</p>
<p>适用场景：适用于需要快速切换和回滚的场景，特别是在对系统稳定性要求较高的应用中，通过蓝绿部署，可以实现无停机升级。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SwiftUI 状态管理极简之道：从“最小状态”到“状态树”]]></title>    <link>https://juejin.cn/post/7575456858427654190</link>    <guid>https://juejin.cn/post/7575456858427654190</guid>    <pubDate>2025-11-24T00:50:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575456858427654190" data-draft-id="7552584517867241522" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SwiftUI 状态管理极简之道：从“最小状态”到“状态树”"/> <meta itemprop="keywords" content="Swift"/> <meta itemprop="datePublished" content="2025-11-24T00:50:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unravel2025"/> <meta itemprop="url" content="https://juejin.cn/user/1116759541421880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SwiftUI 状态管理极简之道：从“最小状态”到“状态树”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759541421880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unravel2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T00:50:06.000Z" title="Mon Nov 24 2025 00:50:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">为什么“状态”是 SwiftUI 的牛顿第三定律？</h2>
<p>在物理学里，力与反作用力成对出现；在 SwiftUI 里，状态变化与UI 反应也成对出现。</p>
<p>用户每一次点击、每一次网络返回，都相当于给系统施加了一个“力”，而 UI 必须以某种“反作用力”做出响应。</p>
<p>因此，状态管理不是可选技能，而是 SwiftUI 世界的万有引力。</p>
<h2 data-id="heading-1">最小状态原则（Minimal State）</h2>
<p>先记住一句“咒语”： “<strong>能让 UI 正确且及时响应的最少状态到底是哪些？</strong>”</p>
<p>凡是不在这份清单里的数据，一律：</p>
<ul>
<li>计算得出 → 用 computed property</li>
<li>可推导 → 不用 @State</li>
<li>临时存活 → 用 let 或局部变量</li>
</ul>
<p>这样做的好处：</p>
<ol>
<li>减少无效刷新，提升性能</li>
<li>降低心智负担，代码更易读</li>
<li>为后续拆分模块、复用组件扫清障碍</li>
</ol>
<h2 data-id="heading-2">状态载具速查表</h2>















































<table><thead><tr><th>属性包装器</th><th>作用域</th><th>典型用途</th><th>备注</th></tr></thead><tbody><tr><td><code>@State</code></td><td>当前 View 私有</td><td>局部 UI 小数据（如 String、Bool、Int）</td><td>值类型</td></tr><tr><td><code>@Binding</code></td><td>父子共享</td><td>将“引用”传给子 View，使其能修改父数据</td><td>不拥有数据</td></tr><tr><td><code>@StateObject</code></td><td>当前 View 私有</td><td>创建并持有引用类型（如 ObservableObject）</td><td>生命周期与 View 一致</td></tr><tr><td><code>@ObservedObject</code></td><td>任意 View</td><td>外部传入的 ObservableObject</td><td>不创建，只引用</td></tr><tr><td><code>@Environment</code></td><td>全局</td><td>系统级值（如 colorScheme、locale 等）</td><td>通过 key 读取</td></tr><tr><td><code>@EnvironmentObject</code></td><td>全局</td><td>自定义共享对象</td><td>需提前注入</td></tr></tbody></table>
<blockquote>
<p>本文不讨论 MVVM / MVC / TCA 等架构，只聚焦“状态本身如何存在、如何流动”。</p>
</blockquote>
<h2 data-id="heading-3">从 0 到 1：状态是如何“被声明”的？</h2>
<h3 data-id="heading-4">静态单状态 —— 宇宙奇点</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ContentView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span> {
            <span class="hljs-type">Image</span>(systemName: <span class="hljs-string">"globe"</span>)
                .imageScale(.large)
                .foregroundStyle(.tint)
            <span class="hljs-type">Text</span>(<span class="hljs-string">"Hello, world!"</span>)
        }
        .padding()
    }
}
</code></pre>
<p>注释：没有 @State，UI 永远不变，宇宙一片死寂。</p>
<h3 data-id="heading-5">引入第一个 @State —— 宇宙大爆炸</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ContentView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> statefulText: <span class="hljs-type">String</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Stateful Text"</span>
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span> {
            <span class="hljs-type">Image</span>(systemName: <span class="hljs-string">"globe"</span>)
                .imageScale(.large)
                .foregroundStyle(.tint)
            <span class="hljs-type">Text</span>(statefulText)          <span class="hljs-comment">// 依赖状态</span>
        }
        .padding()
    }
}
</code></pre>
<p>注释：现在 UI 可以随 <code>statefulText</code> 变化而刷新，但用户还没法干预。</p>
<h3 data-id="heading-6">让用户当“上帝”—— 引入交互</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ContentView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> statefulText: <span class="hljs-type">String</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Stateful Text"</span>
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span> {
            <span class="hljs-type">Button</span> {
                statefulText <span class="hljs-operator">=</span> <span class="hljs-string">"Ouch!"</span>  <span class="hljs-comment">// 用户施加“力”</span>
            } label: {
                <span class="hljs-type">Image</span>(systemName: <span class="hljs-string">"globe"</span>)
                    .imageScale(.large)
                    .foregroundStyle(.tint)
            }
            <span class="hljs-type">Text</span>(statefulText)          <span class="hljs-comment">// 自动反应</span>
        }
        .padding()
    }
}
</code></pre>
<p>注释：状态变化 ⇄ UI 反应 的环路闭合，宇宙开始演化。</p>
<h3 data-id="heading-7">多状态宇宙：枚举扛起大旗</h3>
<p>把“加载中/加载成功/错误/哲学生命周期”抽象成枚举，一次性把状态机搬进 UI：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 1. 定义状态机</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">ViewState</span> {
    <span class="hljs-keyword">case</span> loading
    <span class="hljs-keyword">case</span> loaded
    <span class="hljs-keyword">case</span> error
    <span class="hljs-keyword">case</span> whoami
}

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">ContentView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-comment">// 2. 最小状态：当前处于哪一步</span>
    <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> currentState: <span class="hljs-type">ViewState</span> <span class="hljs-operator">=</span> .loading
    <span class="hljs-comment">// 3. 仅 loaded 才关心的文字</span>
    <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> statefulText: <span class="hljs-type">String</span> <span class="hljs-operator">=</span> <span class="hljs-string">"We did it!"</span>
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">Group</span> {
            <span class="hljs-keyword">switch</span> currentState {
            <span class="hljs-keyword">case</span> .loading:
                <span class="hljs-type">ContentUnavailableView</span>(<span class="hljs-string">"One moment please..."</span>,
                                       systemImage: <span class="hljs-string">"hourglass"</span>)
            <span class="hljs-keyword">case</span> .loaded:
                loadedUI
            <span class="hljs-keyword">case</span> .error:
                <span class="hljs-type">ContentUnavailableView</span>(<span class="hljs-string">"Oops!"</span>,
                                       systemImage: <span class="hljs-string">"x.circle"</span>)
            <span class="hljs-keyword">case</span> .whoami:
                <span class="hljs-type">Text</span>(<span class="hljs-string">"Existential Crisis!"</span>)
            }
        }
        .task {
            <span class="hljs-comment">// 4. 模拟网络请求</span>
            <span class="hljs-keyword">do</span> {
                <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> <span class="hljs-type">Task</span>.sleep(nanoseconds: <span class="hljs-number">2_000_000_000</span>)
                currentState <span class="hljs-operator">=</span> .loaded
            } <span class="hljs-keyword">catch</span> {
                currentState <span class="hljs-operator">=</span> .error
            }
        }
    }
    
    <span class="hljs-comment">// 把 loaded 状态 UI 拆成 computed property，可读性更好</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> loadedUI: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span> {
            <span class="hljs-type">Button</span>(<span class="hljs-string">"点我改文字"</span>) {
                statefulText <span class="hljs-operator">=</span> <span class="hljs-string">"Ouch!"</span>
            }
            <span class="hljs-type">Button</span>(<span class="hljs-string">"进入哲学模式"</span>) {
                currentState <span class="hljs-operator">=</span> .whoami
            }
            <span class="hljs-type">Text</span>(statefulText)
        }
        .padding()
    }
}
</code></pre>
<p>注释：</p>
<ul>
<li>用 <code>switch</code> 做穷尽式匹配，编译器帮你检查漏掉的状态</li>
<li><code>.task</code> 修饰符在视图出现时自动执行，离开即取消，比 <code>onAppear</code> 更安全</li>
</ul>
<h2 data-id="heading-8">状态树：像公司一样分部门治理</h2>
<p>当父 View 既要管“加载枚举”又要管“文字细节”时，责任过重。</p>
<p>把只跟 loaded 相关的状态下放给子 View，父级只保留“导航级”状态，形成状态树：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ContentView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> currentState: <span class="hljs-type">ViewState</span> <span class="hljs-operator">=</span> .loading
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">Group</span> {
            <span class="hljs-keyword">switch</span> currentState {
            <span class="hljs-keyword">case</span> .loading:
                <span class="hljs-type">ContentUnavailableView</span>(<span class="hljs-string">"One moment please..."</span>,
                                       systemImage: <span class="hljs-string">"hourglass"</span>)
            <span class="hljs-keyword">case</span> .loaded:
                <span class="hljs-type">LoadedView</span>(currentState: <span class="hljs-variable">$currentState</span>) <span class="hljs-comment">// 只传绑定</span>
            <span class="hljs-keyword">case</span> .error:
                <span class="hljs-type">ContentUnavailableView</span>(<span class="hljs-string">"Oops!"</span>,
                                       systemImage: <span class="hljs-string">"x.circle"</span>)
            <span class="hljs-keyword">case</span> .whoami:
                <span class="hljs-type">Text</span>(<span class="hljs-string">"Existential Crisis!"</span>)
            }
        }
        .task {
            <span class="hljs-keyword">do</span> {
                <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> <span class="hljs-type">Task</span>.sleep(nanoseconds: <span class="hljs-number">2_000_000_000</span>)
                currentState <span class="hljs-operator">=</span> .loaded
            } <span class="hljs-keyword">catch</span> {
                currentState <span class="hljs-operator">=</span> .error
            }
        }
    }
}

<span class="hljs-comment">// 子 View：只关心 loaded 世界</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">LoadedView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-meta">@Binding</span> <span class="hljs-keyword">var</span> currentState: <span class="hljs-type">ViewState</span> <span class="hljs-comment">// 需要回跳父级，用 Binding</span>
    <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> statefulText: <span class="hljs-type">String</span> <span class="hljs-operator">=</span> <span class="hljs-string">"We did it!"</span> <span class="hljs-comment">// 局部状态</span>
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span>(spacing: <span class="hljs-number">20</span>) {
            <span class="hljs-type">Button</span>(<span class="hljs-string">"改文字"</span>) {
                statefulText <span class="hljs-operator">=</span> <span class="hljs-string">"Ouch!"</span>
            }
            <span class="hljs-type">Button</span>(<span class="hljs-string">"哲学模式"</span>) {
                currentState <span class="hljs-operator">=</span> .whoami
            }
            <span class="hljs-type">Text</span>(statefulText)
                .font(.title)
        }
        .padding()
    }
}
</code></pre>
<p>注释：</p>
<ul>
<li>父 View 代码量瞬间减半，职责单一</li>
<li>子 View 可独立预览、独立测试，甚至一键抽成 Swift Package给别的项目用</li>
</ul>
<h2 data-id="heading-9">递归地追问“最小状态”</h2>
<p>状态树不是一层就够。如果 <code>LoadedView</code> 里再出现子模块（比如点赞数、评论列表），继续问自己：</p>
<ol>
<li>这些子模块是否必须由父级驱动？</li>
<li>能否把“点赞数”做成 <code>@StateObject</code> 的 <code>LikesService</code>，通过 <code>@EnvironmentObject</code> 注入？</li>
<li>能否把“评论列表”做成纯粹 <code>@State</code> 的局部数组，只在进入评论区才初始化？</li>
</ol>
<p>每一层都回答一次“最小状态”问题，复杂度就被递归地压扁。</p>
<h2 data-id="heading-10">实战扩展：把状态树做成“可插拔”模块</h2>
<p>假设未来要加“夜间模式”全局开关：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">@main</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">MyApp</span>: <span class="hljs-title class_">App</span> {
    <span class="hljs-meta">@StateObject</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> theme <span class="hljs-operator">=</span> <span class="hljs-type">ThemeService</span>() <span class="hljs-comment">// 遵循 ObservableObject</span>
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">Scene</span> {
        <span class="hljs-type">WindowGroup</span> {
            <span class="hljs-type">ContentView</span>()
                .environmentObject(theme) <span class="hljs-comment">// 一次性注入</span>
        }
    }
}
</code></pre>
<p>任意深层子 View 只需：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">DeepChild</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-meta">@EnvironmentObject</span> <span class="hljs-keyword">var</span> theme: <span class="hljs-type">ThemeService</span>
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">Text</span>(<span class="hljs-string">"深夜模式自动响应"</span>)
            .foregroundColor(theme.labelColor)
    }
}
</code></pre>
<p>关键点：</p>
<ul>
<li>全局状态绝不放在根 View 的 <code>@State</code>，而是 <code>@StateObject</code> + <code>@EnvironmentObject</code></li>
<li>业务层继续遵循“最小状态”，不依赖全局主题即可独立运行</li>
</ul>
<h2 data-id="heading-11">总结与 Checklist</h2>
<ol>
<li>先写“死”的 UI，再慢慢声明状态，而不是一上来就 <code>@State</code> 满天飞。</li>
<li>每一次加状态前，背一遍咒语：“这是让 UI 正确且及时响应的最小集合吗？”</li>
<li>当状态超过 3 个且互相耦合，立刻画状态树：
<ul>
<li>谁能独立？→ 拆子 View</li>
<li>谁需共享？→ 拆 ObservableObject</li>
<li>谁只读？→ 用 Environment</li>
</ul>
</li>
<li>把“枚举 + switch”当成状态机语法糖，穷尽所有 case，让编译器当你 QA。</li>
</ol>
<h2 data-id="heading-12">学习文章</h2>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcaptainswiftui.substack.com%2Fp%2Fswiftui-craftsmanship-state-management" target="_blank" title="https://captainswiftui.substack.com/p/swiftui-craftsmanship-state-management" ref="nofollow noopener noreferrer">captainswiftui.substack.com/p/swiftui-c…</a></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HTML的Video从基础使用到高级实战+兼容的完全指南]]></title>    <link>https://juejin.cn/post/7575468252657303593</link>    <guid>https://juejin.cn/post/7575468252657303593</guid>    <pubDate>2025-11-24T00:59:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575468252657303593" data-draft-id="7569898158836432937" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HTML的Video从基础使用到高级实战+兼容的完全指南"/> <meta itemprop="keywords" content="前端,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2025-11-24T00:59:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹏多多"/> <meta itemprop="url" content="https://juejin.cn/user/747323639737191"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HTML的Video从基础使用到高级实战+兼容的完全指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/747323639737191/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹏多多
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T00:59:50.000Z" title="Mon Nov 24 2025 00:59:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:2;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;letter-spacing:1.2px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:.5rem solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c;margin:0 5px}.markdown-body a:active,.markdown-body a:hover{text-decoration:none;border-bottom:1.5px solid #3eaf7c}.markdown-body a[href^=http]:after{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjM2VhZjdjIi8+PHBhdGggZD0iTTc2OCA4MzJIMTkyVjI1NmgzNTJ2LTY0SDE2MGEzMiAzMiAwIDAwLTMyIDMydjY0MGEzMiAzMiAwIDAwMzIgMzJoNjQwYTMyIDMyIDAgMDAzMi0zMlY0ODBoLTY0djM1MnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");margin-left:2px}.markdown-body a[href^="#"]:before{content:"#"}.markdown-body table{display:inline-block!important;font-size:13px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c;border-collapse:collapse}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:4px 8px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#7b7878;padding:1px 23px;border-left:.5rem solid;border-color:#42b983;background-color:rgba(66,184,131,.1);position:relative;margin:14px 8px 0}.markdown-body blockquote:before{display:inline-block;position:absolute;content:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNyAyNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjg2MiAxLjg2MikiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSI+PGNpcmNsZSBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS43MjQiIGZpbGw9IiM0MkI5ODMiIGN4PSIxMS42MzgiIGN5PSIxMS42MzgiIHI9IjExLjYzOCIvPjxwYXRoIGQ9Ik0xNC45NzggNi4yN0E1LjAwNiA1LjAwNiAwIDAwNi42NyA5LjQ2OGE0LjkwMSA0LjkwMSAwIDAwMS43NzMgNC4zNjJjLjMyMy4yNTguNTE0LjY0Ny41MjIgMS4wNnYxLjA2YTIuNjg1IDIuNjg1IDAgMDA1LjM3IDB2LTEuMDA4Yy4wMDItLjM5OC4xNzMtLjc3Ny40Ny0xLjA0MmE1LjAyMyA1LjAyMyAwIDAwLjE3My03LjYzem0tMy4zMzcgMTAuOTY3YTEuMzA0IDEuMzA0IDAgMDEtMS4yODYtMS4yODd2LS4yNzhoMi41NzJ2LjI2MWMwIC43MTMtLjU3MyAxLjI5NC0xLjI4NiAxLjMwNHptMi4yNi00LjQxNWMtLjQ0LjM4My0uNzUuODkzLS44ODcgMS40NmgtMi43NDZhMi44NjggMi44NjggMCAwMC0uOTM4LTEuNTNoLS4wMThhMy40NzYgMy40NzYgMCAwMS0xLjI2OS0zLjE0NSAzLjYxNSAzLjYxNSAwIDAxNy4xOTYuNCAzLjY1IDMuNjUgMCAwMS0xLjMzOCAyLjgxNXoiIGZpbGw9IiNGRkYiLz48L2c+PC9zdmc+");width:25px;height:25px;left:-16px;top:12px}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none;padding-left:10px}.markdown-body ul li::marker{content:"•";color:#3eaf7c}.markdown-body ul li.task-list-item:before{content:"";margin-right:0}.markdown-body input[type=checkbox]{vertical-align:text-bottom;box-shadow:inset 0 0 0 10px #fff}.markdown-body input[type=checkbox]:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04NzcuMDU2IDE0Ni45NDR2NzMwLjExMkgxNDYuOTQ0VjE0Ni45NDRoNzMwLjExMnptMC0xMDQuMjc3SDE0Ni45NDRjLTU3LjYyOCAwLTEwNC4yNzcgNDYuNjQ5LTEwNC4yNzcgMTA0LjI3N3Y3MzAuMTEyYzAgNTcuNjI4IDQ2LjY0OSAxMDQuMjc3IDEwNC4yNzcgMTA0LjI3N2g3MzAuMTEyYzU3LjYyOCAwIDEwNC4yNzctNDYuNjQ5IDEwNC4yNzctMTA0LjI3N1YxNDYuOTQ0YzAtNTcuNjI4LTQ2LjY0OS0xMDQuMjc3LTEwNC4yNzctMTA0LjI3N3oiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}.markdown-body input[type=checkbox]:checked:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUiIGhlaWdodD0iMTUiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik05MTAuMjA4IDBIMTEzLjc2QTExNC4xMTIgMTE0LjExMiAwIDAwLS4wMzIgMTEzLjc5MlY5MTAuMjRjMCA2Mi41OTIgNTEuMiAxMTMuNzkyIDExMy43OTIgMTEzLjc5Mmg3OTYuNDQ4YzYyLjU5MiAwIDExMy43OTItNTEuMiAxMTMuNzkyLTExMy43OTJWMTEzLjc5MkMxMDI0IDUxLjIgOTcyLjggMCA5MTAuMjA4IDB6bS01MTIgNzk2LjQ0OEwxMTMuNzYgNTEybDc5LjY0OC03OS42NDggMjA0LjggMjA0LjhMODMwLjU2IDIwNC44bDc5LjY0OCA3OS42NDgtNTEyIDUxMnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><p>HTML5 的 <code>&lt;video&gt;</code> 标签彻底改变了网页视频播放的实现方式——无需依赖 Flash 等第三方插件，原生支持跨平台视频播放，兼具轻量性与扩展性。本文将从标签基础、API 详解、事件体系、样式控制、兼容性处理等维度，全面解析 <code>&lt;video&gt;</code> 标签的技术细节与实战技巧。</p>
<h2 data-id="heading-0">1. 核心用法与属性</h2>
<p>下面是标签的核心用法与属性：</p>
<h3 data-id="heading-1">1.1. 基本语法结构</h3>
<p><code>&lt;video&gt;</code> 标签的核心作用是嵌入视频资源，最简用法如下：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 基础用法：指定视频源与基础控制 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"video.mp4"</span> <span class="hljs-attr">controls</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"640"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"360"</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 降级提示：浏览器不支持 video 标签时显示 --&gt;</span>
  您的浏览器不支持 HTML5 视频播放，请升级浏览器或更换观看方式。
<span class="hljs-tag">&lt;/<span class="hljs-name">video</span>&gt;</span>
</code></pre>
<h3 data-id="heading-2">1.2. 核心属性详解</h3>




























































<table><thead><tr><th>属性名</th><th>取值</th><th>功能说明</th></tr></thead><tbody><tr><td><code>src</code></td><td>视频文件 URL</td><td>指定单个视频源（优先推荐使用 <code>&lt;source&gt;</code> 标签适配多格式）</td></tr><tr><td><code>controls</code></td><td>布尔值（省略则生效）</td><td>显示浏览器原生控制栏（播放/暂停、音量、进度条等）</td></tr><tr><td><code>autoplay</code></td><td>布尔值</td><td>页面加载完成后自动播放（注意：多数浏览器要求静音才能自动播放）</td></tr><tr><td><code>muted</code></td><td>布尔值</td><td>视频默认静音</td></tr><tr><td><code>loop</code></td><td>布尔值</td><td>视频播放完毕后自动循环</td></tr><tr><td><code>preload</code></td><td><code>auto</code>/<code>metadata</code>/<code>none</code></td><td>预加载策略：<br/>- <code>auto</code>：自动预加载整个视频（默认）<br/>- <code>metadata</code>：仅预加载元数据（时长、尺寸等）<br/>- <code>none</code>：不预加载任何内容</td></tr><tr><td><code>poster</code></td><td>图片 URL</td><td>视频加载完成前/未播放时显示的封面图</td></tr><tr><td><code>width</code>/<code>height</code></td><td>像素值（如 <code>640</code>）</td><td>视频播放器的宽高（建议通过 CSS 控制，更灵活）</td></tr><tr><td><code>playsinline</code></td><td>布尔值</td><td>允许视频在页面内播放（而非全屏，移动端必备）</td></tr><tr><td><code>webkit-playsinline</code></td><td>布尔值</td><td>iOS Safari 兼容属性（与 <code>playsinline</code> 配合使用）</td></tr></tbody></table>
<h3 data-id="heading-3">1.3. 多格式适配： 标签</h3>
<p>不同浏览器对视频格式支持存在差异（如 MP4 兼容所有现代浏览器，WebM 体积更小但兼容性较差），需通过 <code>&lt;source&gt;</code> 标签提供多格式备选：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">controls</span> <span class="hljs-attr">poster</span>=<span class="hljs-string">"cover.jpg"</span> <span class="hljs-attr">playsinline</span> <span class="hljs-attr">webkit-playsinline</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 浏览器会按顺序选择支持的格式 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"video.mp4"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"video/mp4"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"video.webm"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"video/webm"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"video.ogg"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"video/ogg"</span>&gt;</span>
  您的浏览器不支持 HTML5 视频播放，请升级浏览器。
<span class="hljs-tag">&lt;/<span class="hljs-name">video</span>&gt;</span>
</code></pre>
<p><strong>推荐格式组合</strong>：MP4（主格式）+ WebM（备选），覆盖 99% 以上现代浏览器。</p>
<h2 data-id="heading-4">2. 核心 API：通过JavaScript控制</h2>
<p><code>&lt;video&gt;</code> 元素暴露了丰富的 JavaScript API，可实现自定义播放逻辑、状态查询等功能。获取视频元素后即可调用：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> video = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'video'</span>); <span class="hljs-comment">// 获取视频元素</span>
</code></pre>
<h3 data-id="heading-5">2.1. 核心方法</h3>





























<table><thead><tr><th>方法名</th><th>功能说明</th></tr></thead><tbody><tr><td><code>play()</code></td><td>开始播放视频，返回 Promise（需处理播放失败场景）</td></tr><tr><td><code>pause()</code></td><td>暂停播放视频</td></tr><tr><td><code>load()</code></td><td>重新加载视频资源（常用于切换视频源后）</td></tr><tr><td><code>canPlayType(type)</code></td><td>检测浏览器是否支持指定视频格式（返回 <code>probably</code>/<code>maybe</code>/<code>""</code>）</td></tr><tr><td><code>requestFullscreen()</code></td><td>进入全屏模式（需兼容前缀：<code>webkitRequestFullscreen</code> 等）</td></tr></tbody></table>
<h3 data-id="heading-6">2.2. 关键属性（可读写/只读）</h3>
<h4 data-id="heading-7">（1）可读写属性（控制视频行为）</h4>



































<table><thead><tr><th>属性名</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>currentTime</code></td><td>Number</td><td>当前播放位置（秒），可设置跳转</td></tr><tr><td><code>volume</code></td><td>Number</td><td>音量（0~1，0 为静音，1 为最大音量）</td></tr><tr><td><code>playbackRate</code></td><td>Number</td><td>播放速率（1 为正常，0.5 为慢放，2 为快放）</td></tr><tr><td><code>muted</code></td><td>Boolean</td><td>设置是否静音（与标签属性一致）</td></tr><tr><td><code>loop</code></td><td>Boolean</td><td>设置是否循环（与标签属性一致）</td></tr></tbody></table>
<h4 data-id="heading-8">（2）只读属性（获取视频状态）</h4>








































<table><thead><tr><th>属性名</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>duration</code></td><td>Number</td><td>视频总时长（秒），未加载完成时为 NaN</td></tr><tr><td><code>paused</code></td><td>Boolean</td><td>是否处于暂停状态（true 为暂停）</td></tr><tr><td><code>playing</code></td><td>Boolean</td><td>是否正在播放（H5 新增，需兼容）</td></tr><tr><td><code>buffered</code></td><td>TimeRanges</td><td>已缓冲的时间范围（通过 <code>buffered.start(0)</code>/<code>buffered.end(0)</code> 获取）</td></tr><tr><td><code>readyState</code></td><td>Number</td><td>视频就绪状态：<br/>0 = 未就绪<br/>1 = 元数据就绪<br/>2 = 当前帧就绪<br/>3 = 可播放（已缓冲部分内容）<br/>4 = 完全就绪</td></tr><tr><td><code>networkState</code></td><td>Number</td><td>网络状态：<br/>0 = 未初始化<br/>1 = 正在加载<br/>2 = 加载完成<br/>3 = 加载失败</td></tr></tbody></table>
<h3 data-id="heading-9">2.3. API 实战示例</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> video = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'video'</span>);

<span class="hljs-comment">// 1. 播放/暂停切换</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'playBtn'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (video.<span class="hljs-property">paused</span>) {
    <span class="hljs-comment">// 处理自动播放限制（需静音或用户交互后）</span>
    video.<span class="hljs-title function_">play</span>().<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'播放失败：'</span>, err);
      video.<span class="hljs-property">muted</span> = <span class="hljs-literal">true</span>;
      video.<span class="hljs-title function_">play</span>(); <span class="hljs-comment">// 静音后重试自动播放</span>
    });
  } <span class="hljs-keyword">else</span> {
    video.<span class="hljs-title function_">pause</span>();
  }
});

<span class="hljs-comment">// 2. 跳转至指定时间（如 30 秒）</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'jumpBtn'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
  video.<span class="hljs-property">currentTime</span> = <span class="hljs-number">30</span>;
});

<span class="hljs-comment">// 3. 调整音量（50%）</span>
video.<span class="hljs-property">volume</span> = <span class="hljs-number">0.5</span>;

<span class="hljs-comment">// 4. 快放（1.5 倍速）</span>
video.<span class="hljs-property">playbackRate</span> = <span class="hljs-number">1.5</span>;

<span class="hljs-comment">// 5. 检测格式支持</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'MP4 支持：'</span>, video.<span class="hljs-title function_">canPlayType</span>(<span class="hljs-string">'video/mp4'</span>) !== <span class="hljs-string">''</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'WebM 支持：'</span>, video.<span class="hljs-title function_">canPlayType</span>(<span class="hljs-string">'video/webm'</span>) !== <span class="hljs-string">''</span>);
</code></pre>
<h2 data-id="heading-10">3. 监听视频生命周期与状态变化事件</h2>
<p><code>&lt;video&gt;</code> 标签提供了完整的事件机制，可监听播放状态、加载进度、错误等场景，是实现自定义控制逻辑的核心。</p>
<h3 data-id="heading-11">3.1. 核心事件分类与说明</h3>






































































<table><thead><tr><th>事件名</th><th>触发时机</th><th>应用场景</th></tr></thead><tbody><tr><td><code>loadedmetadata</code></td><td>视频元数据（时长、尺寸等）加载完成</td><td>获取视频总时长 <code>duration</code></td></tr><tr><td><code>loadeddata</code></td><td>第一帧视频加载完成并可显示</td><td>隐藏加载动画、显示视频画面</td></tr><tr><td><code>canplay</code></td><td>视频已缓冲足够数据，可开始播放（可能卡顿）</td><td>启用播放按钮</td></tr><tr><td><code>canplaythrough</code></td><td>视频已缓冲至末尾，可流畅播放</td><td>提示“可流畅观看”</td></tr><tr><td><code>play</code></td><td>调用 <code>play()</code> 后开始播放时</td><td>切换播放按钮状态（暂停图标）</td></tr><tr><td><code>pause</code></td><td>调用 <code>pause()</code> 或播放暂停时</td><td>切换播放按钮状态（播放图标）</td></tr><tr><td><code>timeupdate</code></td><td>播放位置 <code>currentTime</code> 变化时（约 250ms 一次）</td><td>更新进度条、显示当前播放时间</td></tr><tr><td><code>progress</code></td><td>视频缓冲时持续触发</td><td>更新缓冲进度条</td></tr><tr><td><code>ended</code></td><td>视频播放完毕时</td><td>显示“播放完成”提示、自动重播</td></tr><tr><td><code>error</code></td><td>视频加载/播放失败时</td><td>显示错误提示（通过 <code>error.code</code> 获取错误类型）</td></tr><tr><td><code>volumechange</code></td><td>音量/静音状态变化时</td><td>更新音量图标</td></tr><tr><td><code>fullscreenchange</code></td><td>全屏状态变化时</td><td>切换全屏/退出全屏按钮</td></tr></tbody></table>
<h3 data-id="heading-12">3.2. 事件监听实战示例</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> video = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'video'</span>);
<span class="hljs-keyword">const</span> progressBar = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.progress-bar'</span>);
<span class="hljs-keyword">const</span> currentTimeText = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.current-time'</span>);
<span class="hljs-keyword">const</span> durationText = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.duration'</span>);

<span class="hljs-comment">// 1. 元数据加载完成：显示总时长</span>
video.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'loadedmetadata'</span>, <span class="hljs-function">() =&gt;</span> {
  durationText.<span class="hljs-property">textContent</span> = <span class="hljs-title function_">formatTime</span>(video.<span class="hljs-property">duration</span>);
});

<span class="hljs-comment">// 2. 播放位置更新：同步进度条</span>
video.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'timeupdate'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> progress = (video.<span class="hljs-property">currentTime</span> / video.<span class="hljs-property">duration</span>) * <span class="hljs-number">100</span>;
  progressBar.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">`<span class="hljs-subst">${progress}</span>%`</span>;
  currentTimeText.<span class="hljs-property">textContent</span> = <span class="hljs-title function_">formatTime</span>(video.<span class="hljs-property">currentTime</span>);
});

<span class="hljs-comment">// 3. 缓冲进度更新：显示缓冲条</span>
video.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'progress'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (video.<span class="hljs-property">buffered</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">const</span> bufferedEnd = video.<span class="hljs-property">buffered</span>.<span class="hljs-title function_">end</span>(video.<span class="hljs-property">buffered</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);
    <span class="hljs-keyword">const</span> bufferedProgress = (bufferedEnd / video.<span class="hljs-property">duration</span>) * <span class="hljs-number">100</span>;
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.buffer-bar'</span>).<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">`<span class="hljs-subst">${bufferedProgress}</span>%`</span>;
  }
});

<span class="hljs-comment">// 4. 播放完成：提示并重置</span>
video.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'ended'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">alert</span>(<span class="hljs-string">'视频播放完成！'</span>);
  video.<span class="hljs-property">currentTime</span> = <span class="hljs-number">0</span>; <span class="hljs-comment">// 重置播放位置</span>
});

<span class="hljs-comment">// 5. 错误处理：显示错误信息</span>
video.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">switch</span>(video.<span class="hljs-property">error</span>.<span class="hljs-property">code</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <span class="hljs-title function_">alert</span>(<span class="hljs-string">'视频加载中断'</span>); <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>: <span class="hljs-title function_">alert</span>(<span class="hljs-string">'不支持的视频格式'</span>); <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>: <span class="hljs-title function_">alert</span>(<span class="hljs-string">'视频解码失败'</span>); <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>: <span class="hljs-title function_">alert</span>(<span class="hljs-string">'视频加载超时'</span>); <span class="hljs-keyword">break</span>;
  }
});

<span class="hljs-comment">// 辅助函数：格式化时间（秒 → 分:秒，如 125 → 2:05）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">formatTime</span>(<span class="hljs-params">seconds</span>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">isNaN</span>(seconds)) <span class="hljs-keyword">return</span> <span class="hljs-string">'0:00'</span>;
  <span class="hljs-keyword">const</span> min = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(seconds / <span class="hljs-number">60</span>);
  <span class="hljs-keyword">const</span> sec = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(seconds % <span class="hljs-number">60</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${min}</span>:<span class="hljs-subst">${sec.toString().padStart(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>)}</span>`</span>;
}
</code></pre>
<h2 data-id="heading-13">4. 自定义播放器外观样式</h2>
<p>浏览器原生控制栏样式难以适配不同网页设计，通过隐藏原生 <code>controls</code>，使用 CSS 自定义播放器界面是更常用的方案。</p>
<h3 data-id="heading-14">4.1. 基础样式控制</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 1. 视频容器样式（统一尺寸、边框、圆角） */</span>
<span class="hljs-selector-class">.video-container</span> {
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">max-width</span>: <span class="hljs-number">1280px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">overflow</span>: hidden;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">10px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.1</span>);
}

<span class="hljs-comment">/* 2. 视频元素样式（填充容器，避免变形） */</span>
<span class="hljs-selector-class">.video-container</span> <span class="hljs-selector-tag">video</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: auto;
  <span class="hljs-attribute">object-fit</span>: cover; <span class="hljs-comment">/* 保持宽高比，填充容器（可能裁剪边缘） */</span>
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#000</span>; <span class="hljs-comment">/* 未加载时显示黑色背景 */</span>
}

<span class="hljs-comment">/* 3. 封面图样式（与视频同尺寸） */</span>
<span class="hljs-selector-class">.video-container</span> poster {
  <span class="hljs-attribute">object-fit</span>: cover;
}
</code></pre>
<h3 data-id="heading-15">4.2. 自定义控制栏样式</h3>
<p>通过绝对定位在视频底部创建自定义控制栏，默认隐藏，鼠标悬浮时显示：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 控制栏容器 */</span>
<span class="hljs-selector-class">.video-controls</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(transparent, <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.7</span>)); <span class="hljs-comment">/* 渐变背景 */</span>
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">transition</span>: opacity <span class="hljs-number">0.3s</span> ease;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">flex-direction</span>: column;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">8px</span>;
}

<span class="hljs-comment">/* 鼠标悬浮时显示控制栏 */</span>
<span class="hljs-selector-class">.video-container</span><span class="hljs-selector-pseudo">:hover</span> <span class="hljs-selector-class">.video-controls</span> {
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
}

<span class="hljs-comment">/* 进度条容器 */</span>
<span class="hljs-selector-class">.progress-container</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">0.3</span>);
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">2px</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
}

<span class="hljs-comment">/* 已播放进度条 */</span>
<span class="hljs-selector-class">.progress-bar</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#ff4400</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">2px</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">0%</span>;
}

<span class="hljs-comment">/* 缓冲进度条（叠加在进度条下方） */</span>
<span class="hljs-selector-class">.buffer-bar</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">0.5</span>);
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">2px</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">0%</span>;
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1</span>;
}

<span class="hljs-comment">/* 控制按钮区域 */</span>
<span class="hljs-selector-class">.controls-buttons</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
}

<span class="hljs-comment">/* 按钮样式 */</span>
<span class="hljs-selector-class">.controls-btn</span> {
  <span class="hljs-attribute">background</span>: transparent;
  <span class="hljs-attribute">border</span>: none;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">transition</span>: color <span class="hljs-number">0.2s</span>;
}

<span class="hljs-selector-class">.controls-btn</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#ff4400</span>;
}

<span class="hljs-comment">/* 音量控制滑块 */</span>
<span class="hljs-selector-class">.volume-slider</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">60px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">0.3</span>);
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">2px</span>;
  <span class="hljs-attribute">outline</span>: none;
  accent-<span class="hljs-attribute">color</span>: <span class="hljs-number">#ff4400</span>; <span class="hljs-comment">/* 自定义滑块颜色 */</span>
}
</code></pre>
<h3 data-id="heading-16">4.3. 自定义控制栏 HTML 结构</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"video-container"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"video.mp4"</span> <span class="hljs-attr">poster</span>=<span class="hljs-string">"cover.jpg"</span> <span class="hljs-attr">playsinline</span> <span class="hljs-attr">webkit-playsinline</span>&gt;</span>
    您的浏览器不支持 HTML5 视频播放。
  <span class="hljs-tag">&lt;/<span class="hljs-name">video</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 自定义控制栏 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"video-controls"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"progress-container"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"progressContainer"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"buffer-bar"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"progress-bar"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"controls-buttons"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"controls-btn"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"playBtn"</span>&gt;</span>▶️<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"current-time"</span>&gt;</span>0:00<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>/<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"duration"</span>&gt;</span>0:00<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"range"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"volume-slider"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"volumeSlider"</span> <span class="hljs-attr">min</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">max</span>=<span class="hljs-string">"1"</span> <span class="hljs-attr">step</span>=<span class="hljs-string">"0.01"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"1"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"controls-btn"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"fullscreenBtn"</span>&gt;</span>⛶<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h2 data-id="heading-17">5. 兼容性处理与常见问题</h2>
<p>下面是一些兼容性处理与常见问题：</p>
<h3 data-id="heading-18">5.1. 浏览器兼容性</h3>
<h4 data-id="heading-19">（1）核心兼容性现状</h4>
<ul>
<li><strong>现代浏览器</strong>：Chrome、Firefox、Safari、Edge 均完美支持 <code>&lt;video&gt;</code> 标签及核心 API。</li>
<li><strong>移动端</strong>：iOS Safari、Android Chrome 支持良好，但需注意 <code>playsinline</code> 属性（避免自动全屏）。</li>
<li><strong>旧浏览器</strong>：IE8 及以下不支持 <code>&lt;video&gt;</code> 标签，需通过降级提示或 Flash 备用方案（已不推荐）。</li>
</ul>
<h4 data-id="heading-20">（2）格式兼容性</h4>

























<table><thead><tr><th>视频格式</th><th>支持浏览器</th><th>优势</th></tr></thead><tbody><tr><td>MP4（H.264 + AAC）</td><td>所有现代浏览器、iOS、Android</td><td>兼容性最好，推荐主格式</td></tr><tr><td>WebM（VP8/VP9 + Vorbis）</td><td>Chrome、Firefox、Edge</td><td>体积小、开源，备选格式</td></tr><tr><td>OGG（Theora + Vorbis）</td><td>Chrome、Firefox</td><td>开源，兼容性较差（几乎不用）</td></tr></tbody></table>
<h4 data-id="heading-21">（3）API 兼容性处理</h4>
<p>部分 API 需添加浏览器前缀（如全屏、播放速率），示例如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 全屏兼容处理</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">toggleFullscreen</span>(<span class="hljs-params">video</span>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">document</span>.<span class="hljs-property">fullscreenElement</span>) {
    <span class="hljs-comment">// 退出全屏</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">exitFullscreen</span>().<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err));
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 进入全屏（兼容前缀）</span>
    <span class="hljs-keyword">if</span> (video.<span class="hljs-property">requestFullscreen</span>) {
      video.<span class="hljs-title function_">requestFullscreen</span>();
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (video.<span class="hljs-property">webkitRequestFullscreen</span>) { <span class="hljs-comment">// Safari</span>
      video.<span class="hljs-title function_">webkitRequestFullscreen</span>();
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (video.<span class="hljs-property">msRequestFullscreen</span>) { <span class="hljs-comment">// IE/Edge</span>
      video.<span class="hljs-title function_">msRequestFullscreen</span>();
    }
  }
}

<span class="hljs-comment">// 播放速率兼容性（部分旧浏览器不支持）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">setPlaybackRate</span>(<span class="hljs-params">video, rate</span>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> video.<span class="hljs-property">playbackRate</span> !== <span class="hljs-string">'undefined'</span>) {
    video.<span class="hljs-property">playbackRate</span> = rate;
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-title function_">alert</span>(<span class="hljs-string">'您的浏览器不支持播放速率调整'</span>);
  }
}
</code></pre>
<h3 data-id="heading-22">5.2. 常见问题与解决方案</h3>
<h4 data-id="heading-23">（1）自动播放失败</h4>
<ul>
<li><strong>原因</strong>：现代浏览器限制“非静音自动播放”（需用户交互后才能播放有声视频）。</li>
<li><strong>解决方案</strong>：
<ol>
<li>默认静音自动播放（<code>muted autoplay</code>），提供“开启声音”按钮。</li>
<li>引导用户点击后播放（如“点击播放”封面图）。</li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"video.mp4"</span> <span class="hljs-attr">autoplay</span> <span class="hljs-attr">muted</span> <span class="hljs-attr">playsinline</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">video</span>&gt;</span>
</code></pre>
</li>
</ul>
<h4 data-id="heading-24">（2）视频加载缓慢/卡顿</h4>
<ul>
<li><strong>解决方案</strong>：
<ol>
<li>提供多码率视频（根据网络状况切换）。</li>
<li>使用 <code>preload="metadata"</code> 优化预加载策略。</li>
<li>显示缓冲进度条，提示用户“缓冲中”。</li>
<li>采用 CDN 分发视频资源，提升加载速度。</li>
</ol>
</li>
</ul>
<h4 data-id="heading-25">（3）视频比例变形</h4>
<ul>
<li><strong>原因</strong>：播放器宽高与视频原生宽高比不一致。</li>
<li><strong>解决方案</strong>：使用 <code>object-fit</code> 属性控制视频填充方式：
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">video</span> {
  <span class="hljs-attribute">object-fit</span>: cover; <span class="hljs-comment">/* 保持宽高比，填充容器（裁剪边缘） */</span>
  <span class="hljs-comment">/* 或 object-fit: contain; 保持宽高比，完整显示（可能留黑边） */</span>
}
</code></pre>
</li>
</ul>
<h4 data-id="heading-26">（4）移动端自动全屏播放</h4>
<ul>
<li><strong>原因</strong>：iOS Safari 默认会将视频全屏播放（无 <code>playsinline</code> 属性时）。</li>
<li><strong>解决方案</strong>：添加 <code>playsinline</code> 和 <code>webkit-playsinline</code> 属性：
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"video.mp4"</span> <span class="hljs-attr">playsinline</span> <span class="hljs-attr">webkit-playsinline</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">video</span>&gt;</span>
</code></pre>
</li>
</ul>
<h2 data-id="heading-27">6. 总结</h2>
<p>HTML5 <code>&lt;video&gt;</code> 标签凭借原生、轻量、可扩展的特性，成为网页视频播放的标准方案。通过本文的讲解，你可以掌握：</p>
<ol>
<li>标签基础属性与多格式适配技巧；</li>
<li>核心 API 的使用的（播放控制、状态查询）；</li>
<li>完整事件体系的应用（监听播放状态、缓冲进度等）；</li>
<li>自定义播放器的样式设计与逻辑实现；</li>
<li>兼容性处理与常见问题解决方案。</li>
</ol>
<p>在实际开发中，可根据需求灵活组合上述技术——简单场景直接使用原生控制栏，复杂场景（如视频网站、教育平台）则通过自定义控制栏与 API 实现个性化功能（如倍速播放、弹幕、画中画等）。随着浏览器技术的迭代，<code>&lt;video&gt;</code> 标签的功能将持续完善，为网页视频体验带来更多可能。</p>
<hr/>
<blockquote>
<p>本次分享就到这儿啦，我是鹏多多，深耕前端的技术创作者，如果您看了觉得有帮助，欢迎评论，关注，点赞，转发，我们下次见~</p>
</blockquote>
<p>PS：在本页按F12，在console中输入document.getElementsByClassName('panel-btn')[0].click();有惊喜哦~</p>
<p><code>往期文章</code></p>
<ul>
<li><a href="https://juejin.cn/post/7568192652286754870" target="_blank" title="https://juejin.cn/post/7568192652286754870">纯前端提取图片颜色插件Color-Thief教学+实战完整指南</a></li>
<li><a href="https://juejin.cn/post/7565737512816771135" target="_blank" title="https://juejin.cn/post/7565737512816771135">react-konva实战指南：Canvas高性能+易维护的组件化图形开发实现教程</a></li>
<li><a href="https://juejin.cn/post/7560905838074462271" target="_blank" title="https://juejin.cn/post/7560905838074462271">React无限滚动插件react-infinite-scroll-component的配置+优化+避坑指南</a></li>
<li><a href="https://juejin.cn/post/7560542615484137491" target="_blank" title="https://juejin.cn/post/7560542615484137491">前端音频兼容解决：音频神器howler.js从基础到进阶完整使用指南</a></li>
<li><a href="https://juejin.cn/post/7559871680015024169" target="_blank" title="https://juejin.cn/post/7559871680015024169">使用React-OAuth进行Google/GitHub登录的教程和案例</a></li>
<li><a href="https://juejin.cn/post/7550585427834404927" target="_blank" title="https://juejin.cn/post/7550585427834404927">纯前端人脸识别利器：face-api.js手把手深入解析教学</a></li>
<li><a href="https://juejin.cn/post/7553865490732433462" target="_blank" title="https://juejin.cn/post/7553865490732433462">关于React父组件调用子组件方法forwardRef的详解和案例</a></li>
<li><a href="https://juejin.cn/post/7553484874609410074" target="_blank" title="https://juejin.cn/post/7553484874609410074">React跨组件数据共享useContext详解和案例</a></li>
<li><a href="https://juejin.cn/post/7545087762837815334" target="_blank" title="https://juejin.cn/post/7545087762837815334">Web图像编辑神器tui.image-editor从基础到进阶的实战指南</a></li>
<li><a href="https://juejin.cn/post/7544323659788288046" target="_blank" title="https://juejin.cn/post/7544323659788288046">开发个人微信小程序类目选择/盈利方式/成本控制与服务器接入指南</a></li>
<li><a href="https://juejin.cn/post/7541741121400864778" target="_blank" title="https://juejin.cn/post/7541741121400864778">前端图片裁剪Cropper.js核心功能与实战技巧详解</a></li>
<li><a href="https://juejin.cn/post/7536530451461472265" target="_blank" title="https://juejin.cn/post/7536530451461472265">编辑器也有邪修？盘点VS Code邪门/有趣的扩展</a></li>
<li><a href="https://juejin.cn/post/7535005018257981466" target="_blank" title="https://juejin.cn/post/7535005018257981466">js使用IntersectionObserver实现目标元素可见度的交互</a></li>
<li><a href="https://juejin.cn/post/7534547200330121225" target="_blank" title="https://juejin.cn/post/7534547200330121225">Web前端页面开发阿拉伯语种适配指南</a></li>
<li><a href="https://juejin.cn/post/7516122409948020736" target="_blank" title="https://juejin.cn/post/7516122409948020736">让网页拥有App体验？PWA 将网页变为桌面应用的保姆级教程PWA</a></li>
<li><a href="https://juejin.cn/post/6953803916484018206" target="_blank" title="https://juejin.cn/post/6953803916484018206">使用nvm管理node.js版本以及更换npm淘宝镜像源</a></li>
<li><a href="https://juejin.cn/post/7140443283209060383" target="_blank" title="https://juejin.cn/post/7140443283209060383">手把手教你搭建规范的团队vue项目，包含commitlint，eslint，prettier，husky，commitizen等等</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[栗子前端技术周刊第 107 期 - Angular v21、pnpm 10.22、React 2025 现状调查...]]></title>    <link>https://juejin.cn/post/7575458028255903787</link>    <guid>https://juejin.cn/post/7575458028255903787</guid>    <pubDate>2025-11-24T01:00:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575458028255903787" data-draft-id="7575349314945384489" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="栗子前端技术周刊第 107 期 - Angular v21、pnpm 10.22、React 2025 现状调查..."/> <meta itemprop="keywords" content="前端,JavaScript,Angular.js"/> <meta itemprop="datePublished" content="2025-11-24T01:00:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="晓得迷路了"/> <meta itemprop="url" content="https://juejin.cn/user/2172290706715565"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            栗子前端技术周刊第 107 期 - Angular v21、pnpm 10.22、React 2025 现状调查...
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2172290706715565/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    晓得迷路了
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T01:00:56.000Z" title="Mon Nov 24 2025 01:00:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>🌰<strong>栗子前端技术周刊第 107 期 (2025.11.17 - 2025.11.23)</strong>：浏览前端一周最新消息，学习国内外优秀文章视频，让我们保持对前端的好奇心。</p>
<h2 data-id="heading-0">📰 技术资讯</h2>
<ol>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.angular.dev%2Fannouncing-angular-v21-57946c34f14b" target="_blank" title="https://blog.angular.dev/announcing-angular-v21-57946c34f14b" ref="nofollow noopener noreferrer">Angular v21</a></strong>：谷歌发布 Angular v21 版本，本次更新不仅打造了一场复古游戏主题的探索之旅，用于展示新版本的各项新特性，还推出了一系列高质量视频，集中演示了以下功能：基于信号（signal-based）的表单处理新方案、支持 AI 驱动工作流的 MCP 服务器、专注于可访问性（无障碍性）的无头组件库，甚至还新增了一款“Angular AI 导师”工具，助力开发者快速上手新版本。</p>
</li>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpnpm%2Fpnpm%2Freleases%2Ftag%2Fv10.22.0" target="_blank" title="https://github.com/pnpm/pnpm/releases/tag/v10.22.0" ref="nofollow noopener noreferrer">pnpm 10.22</a></strong>： pnpm 10.22 发布，该版本新增 <code>trustPolicyExclude</code> 配置项，可用于指定“即便存在其他信任策略要求，仍需安装”的包。</p>
</li>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fsurvey.devographics.com%2Fen-US%2Fsurvey%2Fstate-of-react%2F2025" target="_blank" title="https://survey.devographics.com/en-US/survey/state-of-react/2025" ref="nofollow noopener noreferrer">React 2025 现状调查</a></strong>：React 2025 现状调查现已开启，问卷提交将于 11 月 25 日截止，有兴趣的可以参加。</p>
</li>
</ol>
<h2 data-id="heading-1">📒 技术文章</h2>
<ol>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.readwriterachel.com%2Fthings-i-learned%2F2025%2F11%2F09%2Fdevtools-1.html" target="_blank" title="https://www.readwriterachel.com/things-i-learned/2025/11/09/devtools-1.html" ref="nofollow noopener noreferrer">Six Things I Bet You Didn't Know You Could Do With Chrome's Devtools, Part 1</a></strong>：你可能不知道的 Chrome 开发者工具六大用法（第一部分）- 本篇文章将介绍使用 <code>console.time ()</code> 和 <code>console.timeEnd ()</code> 的计时功能、监听任意 DOM 元素的变化和监控浏览器上下文环境中的任意函数，其他部分将在下篇文章介绍。</p>
</li>
<li>
<p><strong><a href="https://juejin.cn/post/7573193563053522985" target="_blank" title="https://juejin.cn/post/7573193563053522985">Cursor 一年深度开发实践：前端开发的效率革命</a></strong>：本文作者分享了使用 Cursor 进行前端开发的实践经验，展示了移动端、PC 端多个项目中 Cursor 的高效应用，还验证了其工程化处理能力。</p>
</li>
<li>
<p><strong><a href="https://juejin.cn/post/7574739133945675818" target="_blank" title="https://juejin.cn/post/7574739133945675818">转转 UI 自动化走查方案探索</a></strong>：文章围绕转转 UI 自动化走查方案展开，先指出当前 UI 走查存在效率低、还原度难控等问题。后经调研，选择基于前端与 UI 节点的比对方案，介绍了数据结构设计、归一化处理流程，包括处理行高、边距合并等问题。</p>
</li>
</ol>
<h2 data-id="heading-2">🔧 开发工具</h2>
<ol>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fwebpack%2Fwebpack-bundle-analyzer" target="_blank" title="https://github.com/webpack/webpack-bundle-analyzer" ref="nofollow noopener noreferrer">Webpack Bundle Analyzer 5.0</a></strong>：可视化查看 Webpack 输出内容。</li>
</ol>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9bb3a440bff345f0b03eba7d4aba6eab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pmT5b6X6L-36Lev5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764550855&amp;x-signature=9je5azl1fJJrDcFMLFw%2FW9gchz8%3D" width="100%" alt="image-20251123131443566" loading="lazy"/>
<ol start="2">
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fmarked.js.org%2F" target="_blank" title="https://marked.js.org/" ref="nofollow noopener noreferrer">Marked.js 17.0</a></strong>：快速的 Markdown 解析器与编译器，Marked.js 可作为客户端库、服务器端库使用，甚至还支持命令行界面（CLI）。</li>
</ol>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c8b7db9835e4222ba98e6cf9c833fdd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pmT5b6X6L-36Lev5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764550855&amp;x-signature=lkzYBVSsp5I5dWUUnfvV5AsHui8%3D" width="100%" alt="image-20251123131824469" loading="lazy"/>
<ol start="3">
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fis-online" target="_blank" title="https://github.com/sindresorhus/is-online" ref="nofollow noopener noreferrer">is-online 12.0</a></strong>：该工具可在 Node.js 环境与浏览器环境中运行，并通过多种方式判断互联网是否真正处于可用状态。</li>
</ol>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2390c77a08cb4b4d84ed457f7bdd5b8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pmT5b6X6L-36Lev5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764550855&amp;x-signature=YbfZ6viLVv%2F3tb3pczX6ciMA10E%3D" width="100%" alt="image-20251123132105379" loading="lazy"/>
<p>🚀🚀🚀 <em>以上资讯文章选自常见周刊，如 JavaScript Weekly 等，周刊内容也会不断优化改进，希望你们能够喜欢。</em></p>
<p>💖 <strong>欢迎关注微信公众号：栗子前端</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[回顾 Flutter Flight Plans ，关于 Flutter 的现状和官方热门问题解答]]></title>    <link>https://juejin.cn/post/7575438636331630643</link>    <guid>https://juejin.cn/post/7575438636331630643</guid>    <pubDate>2025-11-23T23:10:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575438636331630643" data-draft-id="7575182522412056614" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="回顾 Flutter Flight Plans ，关于 Flutter 的现状和官方热门问题解答"/> <meta itemprop="keywords" content="前端,Android,Flutter"/> <meta itemprop="datePublished" content="2025-11-23T23:10:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="恋猫de小郭"/> <meta itemprop="url" content="https://juejin.cn/user/817692379985752"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            回顾 Flutter Flight Plans ，关于 Flutter 的现状和官方热门问题解答
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/817692379985752/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    恋猫de小郭
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T23:10:03.000Z" title="Sun Nov 23 2025 23:10:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 Flutter 官方刚举行的 Flutter Flight Plans 直播里，除了发布 <a href="https://juejin.cn/post/7571693273728696356" target="_blank" title="https://juejin.cn/post/7571693273728696356">Flutter 3.38</a> 和 <a href="https://juejin.cn/post/7571693273728942116" target="_blank" title="https://juejin.cn/post/7571693273728942116">Dart 3.10</a> 之外，其实还有不少值得一聊的内容，例如企业级的 Flutter 案例展示，Flutter + AI 的场景，<strong>重点还有针对大量热门问题的 Q&amp;A（多窗口、GenUI、PC\Web 插件） 等</strong>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/386bfd4bcee6451496243bacf8d47bff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764544202&amp;x-signature=1muYt9WJ5nXNlKAeVA6jCmZ%2BHu4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">NotebookLM</h2>
<p>首先，在经典案例展示上，本次 Flutter 官方展示的是今年谷歌刚发布的 Notebook LM ，这是一款由谷歌开发的 AI 驱动研究助手，核心是可以是基于用户提供的资料（如 PDF、网站、YouTube 视频等）生成信息，<strong>并提供准确的引用来源</strong>。</p>
<blockquote>
<p>提供准确和有效的引用来源这个在 AI 使用里很重要。</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7eecd62716c943c58babe8d2042c098a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764544202&amp;x-signature=AITo%2Fj7WTzN5AmTc%2F8Rq7KnKtpk%3D" alt="" loading="lazy"/></p>
<p>年初，<strong>NotebookLM 桌面版应用因为它提供的 “音频概览”（Audio Overview，可生成逼真的双人对话播客）功能迅速走红</strong>，随着用户对移动应用的需求激增，团队决定加速开发，并选择了 Flutter ，这个案例展示了几个特点：</p>
<ul>
<li><strong>团队仅 4 名工程师</strong></li>
<li>基于社区插件，几乎不需触及原生层</li>
<li>全球 170 多个国家多语言同步上线</li>
<li><strong>7 个月内完成了产品的上线发布</strong></li>
<li>在 Google Play Store 和 Apple App Store 上均<strong>获得 4.8 的高分</strong>，同时成为 Apple App Store 推荐精品应用</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85629b46ad6144128ded70abfaae8196~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764544202&amp;x-signature=nv5uxpynYi68uvvrIgdqGGTNdPY%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>这也是继 Google Pay、Google Earth、Google Ads、Google Classroom、Google Cloud 、YouTube Create、Google One、Google Analytics 之后谷歌采用 Flutter 开发的另一个经典应用。</p>
</blockquote>
<h2 data-id="heading-1">Flutter + AI</h2>
<p>在 Flutter + AI 的展示上，官方首先展示了 Gemini CLI + Flutter Extension for Gemini CLI （MCP）如何通过 AI 自动化从零开发一个 App 。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c580e387da7a4c29b3111ce19272478a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764544202&amp;x-signature=LqSMVH%2BGEfRh0BQP3wMxMGMc%2BVA%3D" alt="" loading="lazy"/></p>
<p>其核心主要是：</p>
<ul>
<li>利用 Gemini CLI 的“思维链” (Chain of Thought) 推理来执行任务</li>
<li>利用 Flutter Extension 的 Dart 和 Flutter MCP 服务提供检查 Dart 错误、连接运行中的应用进行热重载、最佳实践rules，以及 <strong><code>/create app</code>, <code>/modify</code>, <code>/commit</code></strong> 等命令来驱动规范化应用开发。</li>
</ul>
<p>整个流程从 <code>/create app</code> 开始，生成应用规格说明 (<code>design.md</code>) 和实现计划 (<code>implementation.md</code>)，然后逐步构建应用，这个过程 AI Agent 能自动执行任务、使用 <code>launch app</code> 工具启动应用，并在应用运行时进行热重载 。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80263a3458b54ae384eb52a479ed94a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764544202&amp;x-signature=zj%2FEyDw7RxHTCC3Xxw5qHzv%2FE%2FE%3D" alt="" loading="lazy"/></p>
<p>最后，团队还是演示了如何使用 Google 的另一款 AI 工具 Stitch 生成设计稿 HTML 和截图，然后将文件输入 Gemini CLI，Gemini 能够基于图像生成和更新 Dart 源代码，并自动触发热重载更新 App 。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77f060e6b68646fdae379712d50117e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764544202&amp;x-signature=wl%2B7AYajsDrx5NIc4K8w6vMn0ys%3D" alt="image-20251114091720980" loading="lazy"/></p>
<p>接着官方展示了两个 AI 驱动的 Demo ：</p>
<ul>
<li><strong>Gemini Live API</strong> 实现人性化的实时语音对话，技术栈依赖 Firebase AI Logic 和 pub 插件，仅仅通过更新 System Prompt 零代码，将一个原型转化为植物识别应用 <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9075b6329f84f869a137c7a7063f5f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764544202&amp;x-signature=QMDF8i2uVXwZcJg3zLkiYCTBULI%3D" alt="" loading="lazy"/></li>
<li>另外一个是展示 AI 驱动的数独游戏，AI 代理通过 Firebase AI Logic 逐步分析、提取数据并解出答案 <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73a9494e9f53491b9517516b5b9e271c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764544202&amp;x-signature=G1PoXkIzxDfuTEVWCPPvIOqYxZ0%3D" alt="" loading="lazy"/></li>
</ul>
<p>最后，Flutter 团队还展示了 Flutter Gen UI ，这个我们在之前的 <a href="https://juejin.cn/post/7547639458385313855" target="_blank" title="https://juejin.cn/post/7547639458385313855">《Flutter 官方 LLM 动态 UI 库 flutter_genui 发布，让 App UI 自己生成 UI》</a> 有聊到过，<strong>Flutter Gen UI 包可以让 AI Agent 直接生成 Widget 而非纯文本，从而实现更动态、个性化的应用体验</strong>。</p>
<p>其核心理念就是，允许 AI Agent 使用开发者提供的一个 Widget 目录 (Catalog)，然后让 AI 根据用户需求生成和展示相应的 UI 组件 ，在展示里，官方演示了如何将 Gen UI 核心包和 Firebase 适配器集成到应用中，并创建了一个 自定义 Widget Catalog Item (WorkoutCard)，让 AI 代理能够根据用户提示生成包含自定义 UI 的健身计划 。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7cdb7992389c4c25bae9f56cacc14c73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764544202&amp;x-signature=ZVubUawGa6fMh0b0kz2uiXvHPaw%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>实际上， Flutter Gen UI 确实是一个不错的应用场景，特别是在 AI Chat 客服的场景下。</p>
</blockquote>
<h2 data-id="heading-2">Q&amp;A</h2>
<p>接着就是本次大家最关心的 Q&amp;A 环节，这里也问出了一些大家比较在意的热门问题。</p>
<h3 data-id="heading-3">1、GenUI 可以支持服务端实现吗？</h3>
<p>官方回答是可以的，这其实这也是他们已经考虑并支持的模式，Flutter 团队预计许多开发者希望在服务端运行自己的 Agent，因为这样可以：</p>
<ul>
<li>动态更新模型和逻辑</li>
<li>接入自定义数据源或私有 API</li>
<li>控制版本与安全</li>
<li>减少客户端负担</li>
</ul>
<p>而为了这个，目前正在尝试研发一种新协议：<strong>A2UI (Agent-to-UI Protocol)</strong> ，Gen UI 设计为模块化，可通过 <strong>A2UI 协议 (Agent-to-UI)</strong> 连接到服务器端代理，它允许服务端 Agent 将生成的 UI “片段”（Widget 树结构）直接推送到客户端，实现类似“前端由 AI 驱动的 “UI Streaming” 。</p>
<p>A2UI 协议会与 A2A (Agent-to-Agent) 协议协同开发（Google Labs 的 Opal 团队也参与），在目前已有官方示例项目就有一个 VUA demo（Python 服务端 + Flutter 客户端）。</p>
<blockquote>
<p>当然，Gen UI 理论上可以与本地 LLM API 一起使用，从而支持本地离线应用，但是建议用较小的 Widget 目录。</p>
</blockquote>
<h3 data-id="heading-4">2、Multi-window 功能进展如何？</h3>
<p>官方表示， 目前正在进行中，并且进展很大，桌面端多窗口功能持续有 Canonical 开发者推进：</p>
<ul>
<li><strong>Windows 平台</strong>：已有可用的实验性 API</li>
<li><strong>Linux / macOS</strong>：正在适配合并中</li>
</ul>
<p>虽然其实现在已经有可用的 API，但是还是有很多底层基础需要打包，后续的重点包括：可访问性（accessibility）、文本输入、子窗口（child windows）与模态对话框（modal dialogs）的优化。</p>
<blockquote>
<p>目标肯定是希望桌面端最终能提供原生应用那样弹出独立窗口（例如浮动菜单、调试面板等）。</p>
</blockquote>
<h3 data-id="heading-5">3、什么时候桌面和 Web 平台的核心插件能与移动端保持一致？</h3>
<p>官方表示，其实他们知道这是一直以来的痛点，而团队正在通过 Federated Plugins 来填补平台支持的空来尝试解决：</p>
<ul>
<li>允许社区/厂商分别维护平台子实现</li>
<li>官方提供统一接口与验证</li>
</ul>
<p>这样的话社区可为 macOS / Web / Linux 等补齐实现，而目前官方正优化相关的发布流程、代码审核和质量标准。</p>
<h3 data-id="heading-6">4、Native Interop (FFI Gen) 什么时候可用</h3>
<p>官方表示 Native Interop 明年将进入 Beta，提供更自动化、更安全的跨语言互操作，那 FFI Gen 解决什么？主要有：</p>
<ul>
<li>
<p>自动把 C/C++/Objective-C/Swift/Java/Kotlin 的声明转换成 Dart API</p>
</li>
<li>
<p>减少手写 FFI binding 的痛苦</p>
</li>
<li>
<p>更少错误（类型对齐、内存泄漏等）</p>
</li>
<li>
<p>有官方 workflow 和安全约束检查</p>
</li>
<li>
<p>主要用于：</p>
<ul>
<li>多媒体库</li>
<li>原生渲染器</li>
<li>加密库</li>
<li>自研底层 SDK</li>
</ul>
</li>
</ul>
<h3 data-id="heading-7">5、ARM Windows/Linux 支持</h3>
<p>官方表示，这个没有稳定时间表，因为 ARM Windows 市占不高，并且 QA 成本极高，多平台 CI 支持还需要需要扩容，从目前来看，不大可能有新的投入。</p>
<h3 data-id="heading-8">6、Flutter Web 未来 (Wasm/SEO)</h3>
<p>官方表示，目前重点工作在于改善 Web 集成（滚动、文本输入），以及 Wasm 方面的工作，包括支持延迟加载 (Deferred Loading)*和将生态系统迁移到新的 JS Interop 。</p>
<p>总结起来，Web SEO 仍是 Flutter Web 的弱项（结构化 HTML），这个也是未来需要调整的，但是看起来不会是近期的目标，而 Wasm-first 架构主要改善的是性能、内存和启动速度。</p>
<h3 data-id="heading-9">7、BuildRunner 性能</h3>
<p>官方表示，建议更新到最新版本 (2.10+) 可以得到增量改进，最重要的新特性是 <strong>AOT 编译 BuildRunner 代码</strong> (通过 opt-in 标志开启)，某些情况下可提速 <strong>5-10 倍</strong> ，新特性包括：</p>
<ul>
<li>对其 codegen 执行 AOT 编译</li>
<li>大幅减少重复扫描</li>
<li>“增量构建” 重度优化</li>
</ul>
<h3 data-id="heading-10">8、设计解耦 (Design Decoupling)</h3>
<p>官方表示，Material 和 Cupertino 解构，计划是年底拆底层、明年初正式独立包，将 Material 和 Cupertino 库从核心 SDK 移出 。</p>
<h3 data-id="heading-11">9、Swift Package Manager (SPM)</h3>
<p>官方表示，Cocoapods 进入维护期，SPM 将成为未来默认的 iOS 包管理工具，这也是 Apple 的强推方向，当然，后续 Plugin 生态需要全部迁移一遍，这也是成本。</p>
<h3 data-id="heading-12">10、<strong>AI 会不会取代开发者？</strong></h3>
<p>结论是不会，AI 是增强而不是取代，Gemini CLI 这种工具是开发者加速器，可以对比：</p>
<ul>
<li>AI 擅长：重复、枯燥、批量修改</li>
<li>人类擅长：结构、决策、设计、交互体验</li>
</ul>
<p>Flutter 开发者未来更多时间应该花在：架构、交互、Prompt 设计和 AI 协同流程上。</p>
<h3 data-id="heading-13">11、Native Assets / Hooks</h3>
<p>原 Native Assets 功能在 3.38 已正式发布，但改名为 Hooks，Hooks 解决的问题：</p>
<ul>
<li>
<p>提供构建期钩子</p>
</li>
<li>
<p>可接入：</p>
<ul>
<li>自定义构建脚本</li>
<li>原生资产构建</li>
<li>自定义编译器</li>
<li>生成 binding 文件等</li>
</ul>
</li>
</ul>
<p>Dart 团队内部认为 “Hooks” 比 “Native Assets” 更准确（因为用途不止于资产）。</p>
<h3 data-id="heading-14">12、其他问题</h3>
<h4 data-id="heading-15">为什么 Flutter 不推自己的状态管理框架</h4>
<p>因为这等于官方认定了某个方向才是对的，而现在状态管理框架百花齐放，你可以选择你自己的喜好，这才是官方认为最好的状态。</p>
<h4 data-id="heading-16">Flutter GPU 是否还在继续</h4>
<p>是的，但是目前暂停了，因为需要让 Impeller 在对应平台更稳定更成熟，才能给 Flutter GPU 提供更实用的场景支持。</p>
<h4 data-id="heading-17">CanvasKit 还能继续缩小吗？</h4>
<p>暂时给不出来时间表。</p>
<h4 data-id="heading-18">Flutter 是否使用 Gemini 处理和分类 Github 问题</h4>
<p>是的，但是还是需要有人监督。</p>
<h4 data-id="heading-19">augmentations 有时间表吗</h4>
<p>augmentations 就是一个新语言特性，可以把一个类拆分到多个文件，目前还在推进，目前还剩一些细节问题在调整，应该很快可以推出。</p>
<h4 data-id="heading-20">Dart 可以和 Kotlin 一样使用多线程吗？</h4>
<p>Dart 其实有多线程，支持多 isolate 、isolate background 、isolate group ，但是要不要实现内存共享，这个目前还没有计划。</p>
<h4 data-id="heading-21">jaspr 是官方支持的吗？</h4>
<p>这是一个 GDE 维护的项目，一个基于 Dart 的 DOM Web 框架，Flutter 团队已将其迁移用于文档基础设施。</p>
<h2 data-id="heading-22">最后</h2>
<p>其实本次 Flutter Flight Plans 里，除了发布了全新版本的 Flutter 和 Dart 之外，就是本次 Q&amp;A 环节最有意义，至少在官方的角度解答了许多大家关心的问题，当然，等 2026 Flutter 官方发布 Roadmap 后，我们就可以看看接下来的承诺是什么。</p>
<blockquote>
<p>关于 Gemini3、AntiGravity 和 Nona Banana Pro 可见：<a href="https://juejin.cn/post/7574745301725167622" target="_blank" title="https://juejin.cn/post/7574745301725167622">juejin.cn/post/757474…</a></p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fccdf9f932f04982b31d29196df272b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764544202&amp;x-signature=05GDya1EncPNYxEs7rvz9yOmZoI%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[FlutterUnit3.4.1 | 来场三方库的收录狂欢吧~]]></title>    <link>https://juejin.cn/post/7575413146922057743</link>    <guid>https://juejin.cn/post/7575413146922057743</guid>    <pubDate>2025-11-23T23:26:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575413146922057743" data-draft-id="7575162322241028096" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="FlutterUnit3.4.1 | 来场三方库的收录狂欢吧~"/> <meta itemprop="keywords" content="Android,Flutter,前端"/> <meta itemprop="datePublished" content="2025-11-23T23:26:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="张风捷特烈"/> <meta itemprop="url" content="https://juejin.cn/user/149189281194766"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            FlutterUnit3.4.1 | 来场三方库的收录狂欢吧~
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/149189281194766/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    张风捷特烈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T23:26:04.000Z" title="Sun Nov 23 2025 23:26:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>对于一个技术框架的生态来说，三方库是非常非常重要的。Flutter 的朋友都知道 pub 作为官方的仓库，有海量的三方类库供开发者使用。FlutterUnit 作为 Flutter 技术的前沿营地，打算推出一个新的模块:</p>
<blockquote>
<p><strong>三方包</strong> : 在应用中，提供插件的推荐、搜索、分类、评价、国际化等，拓宽开发者接触插件的形式。让好的类库不被埋没。</p>
</blockquote>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/19db757a1da44df5a1748b9cc30e049d~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=971&amp;h=335&amp;s=39539&amp;e=png&amp;b=13212f" alt="" loading="lazy"/></p>
<h4 data-id="heading-0">1. 功能简介</h4>
<p>之前的留言板功能被放在了 <code>我的</code> 中，主界面的黄金地段增加了 <code>三方库</code> 一栏，目前收录了一百多个常用的三方类库。并将这些数据收集到了我的后端，并提供了<strong>分类展示</strong>和<strong>评论</strong> 两大功能，这样可以给大家一个讨论类库的场地，聊聊你对插件的看法，用途等。</p>













<table><thead><tr><th>包主页</th><th>包详情</th></tr></thead><tbody><tr><td><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e67acff2e0cf4f7cbb45d93a4f114be6~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1080&amp;h=2400&amp;s=437010&amp;e=png&amp;b=fefefe" alt="" loading="lazy"/></td><td><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0d54ad10683647948a6fd2b2913a3914~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1080&amp;h=2400&amp;s=504741&amp;e=png&amp;b=ffffff" alt="" loading="lazy"/></td></tr></tbody></table>
<hr/>
<p>另外，还提供了推荐插件的入口，使用者可以在这里推荐一下目前没有收录，但你觉得很不错的插件。欢迎在这里和大家共享 ~<br/>
另外支持根据下载量、喜欢数、发布时间进行排序。</p>













<table><thead><tr><th>推荐创建</th><th>排序方式</th></tr></thead><tbody><tr><td><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e1233318a49e409d8fe43fe8adf9941f~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1080&amp;h=2400&amp;s=98299&amp;e=png&amp;b=f1f3f7" alt="" loading="lazy"/></td><td><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0b7cadd98eb8463ca9f4b0030ef5055e~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1080&amp;h=2400&amp;s=249954&amp;e=png&amp;b=757575" alt="" loading="lazy"/></td></tr></tbody></table>
<hr/>
<p>本次最大的亮点当属评论了，支持二级评论，大于两条的评论会展示查看更多评论。如果详情页评论总数大于 10 ，底部会有查看全部的评论，支持分页加载：</p>













<table><thead><tr><th>详情页评论</th><th>评论详情页</th></tr></thead><tbody><tr><td><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/16115f495ad6420f9da52ca55410d591~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1080&amp;h=2400&amp;s=226253&amp;e=png&amp;b=ffffff" alt="" loading="lazy"/></td><td><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f94e1b46abf64565aaeb7bbfbf3f8f34~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1080&amp;h=2400&amp;s=194367&amp;e=png&amp;b=ffffff" alt="" loading="lazy"/></td></tr></tbody></table>
<hr/>
<h4 data-id="heading-1">2. 关于后台</h4>
<p>目前后台基于 Rust 做的服务，也基本完成了模块化开发。package 模块负责当前功能相关的所有服务接口的。支持独立测试。分模块最大的好处是功能隔离，这样 AI 可以更高效地辅助编码，而且可以参考一个模块的功能，去开发别的模块。三方库相关的接口 95% 是由 AI 独立完成的：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0cc1ebf429a8476f8ee41feceaafeb59~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1410&amp;h=807&amp;s=200149&amp;e=png&amp;b=fffefe" alt="" loading="lazy"/></p>
<p>不得不说，自从换上了 rust 服务，我的 2G 内存的小服务器也更能打一些了。之前使用 Java 的 Springboot 做的服务，上来就小几百兆，现在 rust 运行很久，也就 16 M.</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3f5a68123efc4bff9885708f75ff5a7c~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=938&amp;h=80&amp;s=16420&amp;e=png&amp;b=181818" alt="" loading="lazy"/></p>
<p>和 AI 讨论数据表的创建，也让我收益颇丰。特别是对于多语言的处理，分离出了 <strong>t_pkg_translations</strong> 表，可以在不侵入原表结构的情况下，增加字段级别的翻译映射关系。更利于其他字段、其他语言的支持:</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/256ac284b1ad46f9886ca47fd3f9ca08~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1146&amp;h=308&amp;s=49549&amp;e=png&amp;b=ffffff" alt="" loading="lazy"/></p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/02df26142f46408cb72d0d331b74832a~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1250&amp;h=387&amp;s=60413&amp;e=png&amp;b=fbfafa" alt="" loading="lazy"/></p>
<p>为了方便管理数据，我还让 AI 基于 VUE 顺手写了个后端管理系统 ~</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c48a19af12274510b65e99f306793ec7~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=2560&amp;h=1347&amp;s=182981&amp;e=png&amp;b=fefefe" alt="" loading="lazy"/></p>
<hr/>
<h4 data-id="heading-2">3. 关于前端</h4>
<p>前端也采用模块化开发，<code>pkg_player</code> 模块负责该功能的所有逻辑实现，另外它是一个可以独立运行的模块，这可以让它可以独立于 FlutterUnit 进行开发，开发阶段只需要运行 exsample 即可，可以让 AI 更聚焦于每个模块，减少其他信息干扰。当完成开发，进行组装到 FlutterUnit 即可。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4f96118aa2e540458a8911b9b2ea4ce2~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1137&amp;h=683&amp;s=48593&amp;e=png&amp;b=eff6f9" alt="" loading="lazy"/></p>
<p>这种可插拔的模块化，可以最大程度复用模块。比如未来我有一个 <code>编程营地</code> 的应用, 只需要引入<code>pkg_player</code> 模块，然后拼装一下， 编程营地就有了当前的三方库的展示和交流能力。</p>
<hr/>
<p>由于引入了 AI 编程，我希望像流水线一样，AI 可以根据我的代码组织结构，进行代码的产出。使用我设计了三层的 MVVM 应用架构，其中:</p>
<ul>
<li><strong>bloc</strong> 状态维护的视图模型层,负责维护数据流转。</li>
<li><strong>repository</strong> 数据仓储层，负责实体类维护和数据获取，比如网络、数据库等。</li>
<li><strong>view</strong> 视图层，基于视图模型中的数据，进行界面构建，以及用户交互事件的入口。</li>
</ul>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e22939ca0738479c9b749d31470e674c~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1282&amp;h=646&amp;s=41251&amp;e=png&amp;b=f5f7fa" alt="" loading="lazy"/></p>
<p>我约定一般情况下 view 和 repository 之间不直接依赖，另外 repository 中的代码需要支持 <strong>脱离视图层</strong> 也可以独立运行，这样便于单元测试。</p>
<p>前端的代码大概 80% 也是由 AI 完成的，但这并不代表开发者什么都不要干。我的角色是从敲代码的，变成了指挥 AI 敲代码的。如何设计整体的功能、交互的细节、数据的结果，还是需要花费心力的。</p>
<blockquote>
<p>注： AI 的代码质量可以说中规中矩，还是有些需要优化的地方。良好的结构，可以让 AI 的洪水不至于肆意蔓延。约束它，引导它，受用于你。</p>
</blockquote>
<p>希望模块化的开发结构，可以在 AI 的浪潮下，让你的 Flutter 应用更加内聚，符合单一职责原则、合成复用原则。目前正在根据实践经验，设计 fx 通用应用架构，敬请期待~</p>
<hr/>
<h4 data-id="heading-3">4. 关于国际化</h4>
<p>为了便于包支持模块化，我写了一个 dart 脚本，可以分析统计模块中字符串，使用的非英文字符，及其在代码中的具体位置。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5cc3c5bb26344b6aa7287ea2a2420521~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1565&amp;h=954&amp;s=166703&amp;e=png&amp;b=ffffff" alt="" loading="lazy"/></p>
<p>最后还会统计所有不同的字符串：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/643e3a4b64b94a89bcb4bce6607a2475~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1278&amp;h=696&amp;s=129858&amp;e=png&amp;b=ffffff" alt="" loading="lazy"/></p>
<p>你可以把这些丢给 AI ，让它生成 arb 文件，然后根据中文，再得到英文翻译：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4e54fc69a5344cb083bc0117bb51297d~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1317&amp;h=660&amp;s=81442&amp;e=png&amp;b=f9f9f9" alt="" loading="lazy"/></p>
<p>最终就会得到可用的资源：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4aeb487702ca4fa3a9c9571918fc5357~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1019&amp;h=334&amp;s=18736&amp;e=png&amp;b=f3f5fa" alt="" loading="lazy"/></p>
<p>这样在数据层面和本地资源，都支持了国际化：</p>













<table><thead><tr><th>英文</th><th>中文</th></tr></thead><tbody><tr><td><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1029410d7c87480591f22ef7ebc95d2f~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1080&amp;h=2400&amp;s=440960&amp;e=png&amp;b=fefefe" alt="" loading="lazy"/></td><td><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7b792b94c5344398a9d821d3490088fe~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1080&amp;h=2400&amp;s=435716&amp;e=png&amp;b=fefefe" alt="" loading="lazy"/></td></tr></tbody></table>
<hr/>
<h4 data-id="heading-4">4. 尾声</h4>
<p>文章里就不说详细的代码实现了，<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftoly1994328%2FFlutterUnit" target="_blank" title="https://github.com/toly1994328/FlutterUnit" ref="nofollow noopener noreferrer">FlutterUnit</a>  是一个开源项目，大家可以自己去运行体验。最后，FlutterUnit3.4 版本， 三方库功能已经上线，大家可以在 github 上更新最新版的软件包体验，欢迎多多交流，为你喜欢的三方库打 call ~</p>
<p>更多文章和视频知识资讯，大家可以关注我的公众号、掘金和 B 站 。让我们一起成长，变得更强。我们下次再见~</p>
<ul>
<li><strong>鸿蒙纪元</strong> QQ交流群： 727300436</li>
<li>掘金账号： <a href="https://juejin.cn/user/149189281194766" title="https://juejin.cn/user/149189281194766" target="_blank">张风捷特烈</a></li>
<li>bilibli 账号： <a href="https://link.juejin.cn?target=https%3A%2F%2Fspace.bilibili.com%2F390457600" title="https://link.juejin.cn?target=https%3A%2F%2Fspace.bilibili.com%2F390457600" target="_blank">张风捷特烈</a></li>
<li>公众号： <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fq8Vs5i3SU-4QPoU3-0xOSg" title="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fq8Vs5i3SU-4QPoU3-0xOSg" target="_blank">编程之王</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从源码到npm：手把手带你发布Vue 3组件库]]></title>    <link>https://juejin.cn/post/7575937594338443305</link>    <guid>https://juejin.cn/post/7575937594338443305</guid>    <pubDate>2025-11-23T23:43:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575937594338443305" data-draft-id="7575468252657008681" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从源码到npm：手把手带你发布Vue 3组件库"/> <meta itemprop="keywords" content="Vue.js,NPM,前端"/> <meta itemprop="datePublished" content="2025-11-23T23:43:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="良山有风来"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036939358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从源码到npm：手把手带你发布Vue 3组件库
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036939358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    良山有风来
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T23:43:43.000Z" title="Sun Nov 23 2025 23:43:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>还记得上次为了统一团队UI风格，你不得不把同一个按钮组件复制粘贴到十几个项目里的痛苦经历吗？每次修改都要同步更新所有项目，一不小心就漏掉一两个，测试同事追着你满公司跑……</p>
<p>今天，咱们就来彻底解决这个问题！我将带你从零开始，用最新的Vite工具链打包并发布一个专业的Vue 3组件库。学完这篇，你就能像Element Plus那样，让团队通过一句<code>npm install</code>就能使用你精心打造的组件库。</p>
<h2 data-id="heading-0">为什么你需要自建组件库？</h2>
<p>先别急着写代码，咱们聊聊为什么这事值得你花时间。想象一下这些场景：</p>
<p>早上刚优化了按钮的点击动效，下午就要在五个项目里手动更新；设计团队调整了主色调，你得逐个文件修改颜色变量；新人接手项目，因为组件规范不统一而频频踩坑……</p>
<p>有了自己的组件库，这些烦恼统统消失！更重要的是，这还能成为你的技术名片——想想看，当面试官看到你的GitHub主页有一个被下载了几千次的组件库时，那是什么感觉？</p>
<h2 data-id="heading-1">环境准备与项目初始化</h2>
<p>工欲善其事，必先利其器。确保你的环境满足以下要求：</p>
<p>Node.js版本18.0或更高，这是Vite顺畅运行的基础。pnpm作为包管理器，它比npm更快更节省磁盘空间。</p>
<p>接下来创建项目目录：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> vue3-component-library
<span class="hljs-built_in">cd</span> vue3-component-library
pnpm init
</code></pre>
<p>初始化package.json后，安装核心依赖：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm add vue@^3.3.0
pnpm add -D vite@^5.0.0 @vitejs/plugin-vue
</code></pre>
<p>创建基础的vite.config.js配置文件：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span>
<span class="hljs-keyword">import</span> { resolve } <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>

<span class="hljs-comment">// 组件库入口文件路径</span>
<span class="hljs-keyword">const</span> entry = <span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'src/index.js'</span>)

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">vue</span>()],
  <span class="hljs-attr">build</span>: {
    <span class="hljs-attr">lib</span>: {
      entry,
      <span class="hljs-attr">name</span>: <span class="hljs-string">'MyComponentLibrary'</span>,
      <span class="hljs-attr">fileName</span>: <span class="hljs-string">'my-component-library'</span>
    },
    <span class="hljs-attr">rollupOptions</span>: {
      <span class="hljs-comment">// 确保外部化处理那些你不想打包进库的依赖</span>
      <span class="hljs-attr">external</span>: [<span class="hljs-string">'vue'</span>],
      <span class="hljs-attr">output</span>: {
        <span class="hljs-attr">globals</span>: {
          <span class="hljs-attr">vue</span>: <span class="hljs-string">'Vue'</span>
        }
      }
    }
  }
})
</code></pre>
<p>这个配置告诉Vite：我们要构建一个库而不是应用，Vue应该是外部依赖而不打包进最终产物。</p>
<h2 data-id="heading-2">设计组件库目录结构</h2>
<p>清晰的目录结构是成功的一半！这是我推荐的结构：</p>
<pre><code class="hljs language-csharp" lang="csharp">src/
├── components/     <span class="hljs-meta"># 所有组件源码</span>
│   ├── Button/
│   │   ├── Button.vue
│   │   └── index.js
│   └── Input/
│       ├── Input.vue
│       └── index.js
├── styles/         <span class="hljs-meta"># 样式文件</span>
│   ├── <span class="hljs-keyword">base</span>.css    <span class="hljs-meta"># 基础样式</span>
│   └── components/ <span class="hljs-meta"># 组件样式</span>
├── utils/          <span class="hljs-meta"># 工具函数</span>
└── index.js        <span class="hljs-meta"># 主入口文件</span>
</code></pre>
<p>让我解释几个关键点：每个组件都有自己的目录，里面包含Vue单文件组件和导出文件。样式集中管理，便于维护和主题定制。</p>
<h2 data-id="heading-3">编写你的第一个组件</h2>
<p>咱们从最常用的按钮组件开始。创建<code>src/components/Button/Button.vue</code>：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;button 
    :class="[
      'my-btn',
      `my-btn--${type}`,
      { 'my-btn--disabled': disabled }
    ]"
    :disabled="disabled"
    @click="handleClick"
  &gt;
    &lt;slot&gt;&lt;/slot&gt;
  &lt;/button&gt;
&lt;/template&gt;

&lt;script setup&gt;
// 定义组件接收的属性
const props = defineProps({
  type: {
    type: String,
    default: 'default', // default, primary, danger
    validator: (value) =&gt; {
      return ['default', 'primary', 'danger'].includes(value)
    }
  },
  disabled: {
    type: Boolean,
    default: false
  }
})

// 定义发射的事件
const emit = defineEmits(['click'])

const handleClick = (event) =&gt; {
  if (!props.disabled) {
    emit('click', event)
  }
}
&lt;/script&gt;

&lt;style scoped&gt;
.my-btn {
  padding: 8px 16px;
  border: 1px solid #dcdfe6;
  border-radius: 4px;
  background: white;
  cursor: pointer;
  transition: all 0.3s;
}

.my-btn:hover {
  opacity: 0.8;
}

.my-btn--primary {
  background: #409eff;
  color: white;
  border-color: #409eff;
}

.my-btn--danger {
  background: #f56c6c;
  color: white;
  border-color: #f56c6c;
}

.my-btn--disabled {
  opacity: 0.6;
  cursor: not-allowed;
}
&lt;/style&gt;
</code></pre>
<p>这个按钮组件支持三种类型和禁用状态，样式采用BEM命名规范，确保类名清晰可维护。</p>
<p>接下来创建组件的导出文件<code>src/components/Button/index.js</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Button</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./Button.vue'</span>

<span class="hljs-comment">// 为组件添加install方法，使其能够被Vue.use()使用</span>
<span class="hljs-title class_">Button</span>.<span class="hljs-property">install</span> = <span class="hljs-function">(<span class="hljs-params">app</span>) =&gt;</span> {
  app.<span class="hljs-title function_">component</span>(<span class="hljs-title class_">Button</span>.<span class="hljs-property">name</span>, <span class="hljs-title class_">Button</span>)
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Button</span>
</code></pre>
<p>install方法很重要！它让用户可以通过<code>app.use(YourComponent)</code>的方式全局注册组件。</p>
<h2 data-id="heading-4">构建组件库入口文件</h2>
<p>现在是时候把各个组件统一导出了。创建<code>src/index.js</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 导入所有组件</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Button</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/Button'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Input</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/Input'</span>

<span class="hljs-comment">// 组件列表</span>
<span class="hljs-keyword">const</span> components = [
  <span class="hljs-title class_">Button</span>,
  <span class="hljs-title class_">Input</span>
]

<span class="hljs-comment">// 定义install方法，接收Vue实例作为参数</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">install</span> = (<span class="hljs-params">app</span>) =&gt; {
  <span class="hljs-comment">// 遍历注册所有组件</span>
  components.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">component</span> =&gt;</span> {
    app.<span class="hljs-title function_">component</span>(component.<span class="hljs-property">name</span>, component)
  })
}

<span class="hljs-comment">// 判断是否直接通过script标签引入，如果是，会自动安装</span>
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> !== <span class="hljs-string">'undefined'</span> &amp;&amp; <span class="hljs-variable language_">window</span>.<span class="hljs-property">Vue</span>) {
  <span class="hljs-title function_">install</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">Vue</span>)
}

<span class="hljs-comment">// 导出install方法和所有组件</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  install,
  <span class="hljs-title class_">Button</span>,
  <span class="hljs-title class_">Input</span>
}

<span class="hljs-comment">// 按需导出各个组件</span>
<span class="hljs-keyword">export</span> {
  <span class="hljs-title class_">Button</span>,
  <span class="hljs-title class_">Input</span>
}
</code></pre>
<p>这种设计让用户可以选择全量引入或按需引入，满足不同场景的需求。</p>
<h2 data-id="heading-5">配置多种构建格式</h2>
<p>不同的使用场景需要不同的构建格式。更新vite.config.js：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span>
<span class="hljs-keyword">import</span> { resolve } <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">vue</span>()],
  <span class="hljs-attr">build</span>: {
    <span class="hljs-attr">lib</span>: {
      <span class="hljs-attr">entry</span>: <span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'src/index.js'</span>),
      <span class="hljs-attr">name</span>: <span class="hljs-string">'MyComponentLibrary'</span>,
      <span class="hljs-comment">// 生成多种格式的文件</span>
      <span class="hljs-attr">fileName</span>: <span class="hljs-function">(<span class="hljs-params">format</span>) =&gt;</span> <span class="hljs-string">`my-component-library.<span class="hljs-subst">${format}</span>.js`</span>
    },
    <span class="hljs-attr">rollupOptions</span>: {
      <span class="hljs-attr">external</span>: [<span class="hljs-string">'vue'</span>],
      <span class="hljs-attr">output</span>: [
        {
          <span class="hljs-attr">format</span>: <span class="hljs-string">'es'</span>, <span class="hljs-comment">// ES模块格式，适合现代打包工具</span>
          <span class="hljs-attr">globals</span>: {
            <span class="hljs-attr">vue</span>: <span class="hljs-string">'Vue'</span>
          }
        },
        {
          <span class="hljs-attr">format</span>: <span class="hljs-string">'umd'</span>, <span class="hljs-comment">// 通用模块定义，适合script标签直接引入</span>
          <span class="hljs-attr">globals</span>: {
            <span class="hljs-attr">vue</span>: <span class="hljs-string">'Vue'</span>
          }
        },
        {
          <span class="hljs-attr">format</span>: <span class="hljs-string">'cjs'</span>, <span class="hljs-comment">// CommonJS格式，适合Node环境</span>
          <span class="hljs-attr">globals</span>: {
            <span class="hljs-attr">vue</span>: <span class="hljs-string">'Vue'</span>
          }
        }
      ]
    }
  }
})
</code></pre>
<p>现在运行<code>pnpm build</code>，你会在dist目录看到三种格式的文件，满足各种使用需求。</p>
<h2 data-id="heading-6">样式构建与优化</h2>
<p>组件库的样式处理很关键。我们创建单独的样式构建流程：</p>
<p>首先安装相关依赖：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm add -D sass
</code></pre>
<p>创建构建样式的脚本<code>scripts/build-styles.js</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>)
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>)
<span class="hljs-keyword">const</span> { execSync } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>)

<span class="hljs-comment">// 递归读取目录下的所有scss文件</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">readStyles</span>(<span class="hljs-params">dir</span>) {
  <span class="hljs-keyword">let</span> results = []
  <span class="hljs-keyword">const</span> list = fs.<span class="hljs-title function_">readdirSync</span>(dir)
  
  list.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> filePath = path.<span class="hljs-title function_">join</span>(dir, file)
    <span class="hljs-keyword">const</span> stat = fs.<span class="hljs-title function_">statSync</span>(filePath)
    
    <span class="hljs-keyword">if</span> (stat &amp;&amp; stat.<span class="hljs-title function_">isDirectory</span>()) {
      results = results.<span class="hljs-title function_">concat</span>(<span class="hljs-title function_">readStyles</span>(filePath))
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (file.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">'.scss'</span>) || file.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">'.css'</span>)) {
      results.<span class="hljs-title function_">push</span>(filePath)
    }
  })
  
  <span class="hljs-keyword">return</span> results
}

<span class="hljs-comment">// 构建完整样式文件</span>
<span class="hljs-keyword">const</span> styleFiles = <span class="hljs-title function_">readStyles</span>(path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'../src/styles'</span>))
<span class="hljs-keyword">let</span> fullStyleContent = <span class="hljs-string">''</span>

styleFiles.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> content = fs.<span class="hljs-title function_">readFileSync</span>(file, <span class="hljs-string">'utf-8'</span>)
  fullStyleContent += content + <span class="hljs-string">'\n'</span>
})

<span class="hljs-comment">// 写入总样式文件</span>
<span class="hljs-keyword">const</span> outputPath = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'../dist/style.css'</span>)
fs.<span class="hljs-title function_">writeFileSync</span>(outputPath, fullStyleContent)

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'样式构建完成！'</span>)
</code></pre>
<p>然后在package.json中添加构建命令：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite build &amp;&amp; node scripts/build-styles.js"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-7">完善package.json配置</h2>
<p>发布前，我们需要完善package.json的配置：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-component-library"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"A Vue 3 component library built with Vite"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"main"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist/my-component-library.umd.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist/my-component-library.es.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"exports"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"."</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"import"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist/my-component-library.es.js"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"require"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist/my-component-library.umd.js"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"./style.css"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist/style.css"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"files"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"dist"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"keywords"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"vue3"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"component-library"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"ui"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"peerDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^3.3.0"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>关键字段说明：main指向CommonJS版本，module指向ES模块版本，files指定发布时包含的文件。</p>
<h2 data-id="heading-8">TypeScript支持</h2>
<p>现在大家都用TypeScript，咱们的组件库也要提供类型支持。首先安装依赖：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm add -D typescript @vue/tsconfig-node
</code></pre>
<p>创建<code>tsconfig.json</code>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ES2020"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"useDefineForClassFields"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"lib"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"ES2020"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"DOM"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"DOM.Iterable"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ESNext"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"skipLibCheck"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"moduleResolution"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"bundler"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"allowImportingTsExtensions"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"resolveJsonModule"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"isolatedModules"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"noEmit"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"jsx"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"preserve"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"strict"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"noUnusedLocals"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"noUnusedParameters"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"noFallthroughCasesInSwitch"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"declaration"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"outDir"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dist"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"include"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"src/**/*.ts"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"src/**/*.d.ts"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"src/**/*.vue"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>为按钮组件添加类型定义<code>src/components/Button/types.ts</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ButtonProps</span> {
  <span class="hljs-keyword">type</span>?: <span class="hljs-string">'default'</span> | <span class="hljs-string">'primary'</span> | <span class="hljs-string">'danger'</span>
  disabled?: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ButtonEmits</span> {
  (<span class="hljs-attr">e</span>: <span class="hljs-string">'click'</span>, <span class="hljs-attr">event</span>: <span class="hljs-title class_">MouseEvent</span>): <span class="hljs-built_in">void</span>
}
</code></pre>
<p>更新Button.vue使用TypeScript：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="ts"&gt;
import type { ButtonProps, ButtonEmits } from './types'

defineProps&lt;ButtonProps&gt;()
const emit = defineEmits&lt;ButtonEmits&gt;()

const handleClick = (event: MouseEvent) =&gt; {
  emit('click', event)
}
&lt;/script&gt;
</code></pre>
<h2 data-id="heading-9">本地测试与调试</h2>
<p>发布前一定要充分测试！创建演示应用<code>playground/</code>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> playground
<span class="hljs-built_in">cd</span> playground
pnpm create vite . --template vue
</code></pre>
<p>在演示项目中链接本地组件库：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"my-component-library"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"file:../"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>创建测试页面<code>playground/src/App.vue</code>：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="playground"&gt;
    &lt;h1&gt;组件库测试页面&lt;/h1&gt;
    &lt;MyButton type="primary" @click="handleClick"&gt;
      主要按钮
    &lt;/MyButton&gt;
    &lt;MyButton type="danger" disabled&gt;
      禁用按钮
    &lt;/MyButton&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { MyButton } from 'my-component-library'

const handleClick = () =&gt; {
  console.log('按钮被点击了！')
}
&lt;/script&gt;
</code></pre>
<p>这样你就能实时测试组件效果了。</p>
<h2 data-id="heading-10">发布到npm</h2>
<p>测试通过后，就可以发布了！首先在npm官网注册账号，然后在终端登录：</p>
<pre><code class="hljs language-bash" lang="bash">npm login
</code></pre>
<p>构建最终版本：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm build
</code></pre>
<p>发布！</p>
<pre><code class="hljs language-bash" lang="bash">npm publish
</code></pre>
<p>如果这是私有包想先测试，可以使用：</p>
<pre><code class="hljs language-bash" lang="bash">npm publish --tag beta
</code></pre>
<h2 data-id="heading-11">自动化与持续集成</h2>
<p>手动发布太麻烦了，咱们配置GitHub Actions自动化流程。创建<code>.github/workflows/publish.yml</code>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">Publish</span> <span class="hljs-string">to</span> <span class="hljs-string">npm</span>

<span class="hljs-attr">on:</span>
  <span class="hljs-attr">push:</span>
    <span class="hljs-attr">tags:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">'v*'</span>

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">publish:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">node-version:</span> <span class="hljs-string">'18'</span>
          <span class="hljs-attr">registry-url:</span> <span class="hljs-string">'https://registry.npmjs.org'</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">install</span> <span class="hljs-string">-g</span> <span class="hljs-string">pnpm</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">install</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">build</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">publish</span>
        <span class="hljs-attr">env:</span>
          <span class="hljs-attr">NODE_AUTH_TOKEN:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.NPM_TOKEN</span> <span class="hljs-string">}}</span>
</code></pre>
<p>这样每次打tag时就会自动发布新版本。</p>
<h2 data-id="heading-12">版本管理策略</h2>
<p>采用语义化版本控制：主版本号.次版本号.修订号（MAJOR.MINOR.PATCH）</p>
<ul>
<li>修订号：向后兼容的问题修复</li>
<li>次版本号：向后兼容的功能新增</li>
<li>主版本号：不兼容的API修改</li>
</ul>
<p>使用npm version命令管理版本：</p>
<pre><code class="hljs language-bash" lang="bash">npm version patch  <span class="hljs-comment"># 1.0.0 -&gt; 1.0.1</span>
npm version minor  <span class="hljs-comment"># 1.0.0 -&gt; 1.1.0  </span>
npm version major  <span class="hljs-comment"># 1.0.0 -&gt; 2.0.0</span>
</code></pre>
<h2 data-id="heading-13">高级技巧：按需加载与Tree Shaking</h2>
<p>为了让用户能按需引入组件，我们需要配置unplugin-vue-components：</p>
<p>首先在组件库中创建<code>components.d.ts</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">App</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">GlobalComponents</span> {
  <span class="hljs-title class_">MyButton</span>: <span class="hljs-keyword">typeof</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./components/Button'</span>)[<span class="hljs-string">'default'</span>]
  <span class="hljs-title class_">MyInput</span>: <span class="hljs-keyword">typeof</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./components/Input'</span>)[<span class="hljs-string">'default'</span>]
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">install</span>: <span class="hljs-function">(<span class="hljs-params">app: App</span>) =&gt;</span> <span class="hljs-built_in">void</span>
</code></pre>
<p>然后在用户项目中配置vite.config.js：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Components</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'unplugin-vue-components/vite'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">MyComponentLibraryResolver</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'my-component-library/resolver'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title class_">Components</span>({
      <span class="hljs-attr">resolvers</span>: [<span class="hljs-title class_">MyComponentLibraryResolver</span>()]
    })
  ]
})
</code></pre>
<h2 data-id="heading-14">常见问题与解决方案</h2>
<p><strong>问题1：组件样式不生效</strong>
解决方案：确保用户正确引入了样式文件，或在组件库中配置样式内联。</p>
<p><strong>问题2：TypeScript类型报错</strong>
解决方案：检查类型导出配置，确保declaration: true且类型文件在打包范围内。</p>
<p><strong>问题3：构建产物过大</strong>
解决方案：使用rollup-plugin-visualizer分析包大小，外部化依赖，代码分割。</p>
<h2 data-id="heading-15">维护与迭代</h2>
<p>组件库发布后，维护工作才刚刚开始：</p>
<p>建立变更日志CHANGELOG.md，记录每个版本的改动。收集用户反馈，建立Issue模板。定期更新依赖，保持技术栈的现代性。编写完善的文档，包括在线演示和API文档。</p>
<p>现在，你已经掌握了Vue 3组件库从开发到发布的完整流程。从今天开始，把那些重复的组件代码变成可复用的财富吧！</p>
<p>还记得开头那个被测试同事追着跑的尴尬场景吗？现在你可以优雅地告诉他："去npm上更新一下组件库版本就行"。这种感觉，是不是比复制粘贴爽多了？</p>
<p>如果你在实践过程中遇到任何问题，欢迎在评论区留言分享你的经历。也别忘了把这个工作流程分享给那些还在手动维护组件的小伙伴们，让他们也体验一下"一次构建，处处使用"的畅快感！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python编程实战：Python常用命令速查表（超全整理）]]></title>    <link>https://juejin.cn/post/7575456858427523118</link>    <guid>https://juejin.cn/post/7575456858427523118</guid>    <pubDate>2025-11-23T23:52:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575456858427523118" data-draft-id="7575456858427506734" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python编程实战：Python常用命令速查表（超全整理）"/> <meta itemprop="keywords" content="后端,Python,Trae"/> <meta itemprop="datePublished" content="2025-11-23T23:52:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员爱钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python编程实战：Python常用命令速查表（超全整理）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员爱钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T23:52:15.000Z" title="Sun Nov 23 2025 23:52:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在 Python 开发过程中，很多命令与工具操作很容易忘记。无论你是新手还是经验开发者，拥有一份随手可查的“命令速查表”都能显著提升开发效率。</p>
</blockquote>
<p>本篇文章总结了 <strong>Python、pip、虚拟环境、包管理、文件操作、调试、格式化、性能测试、代码检查</strong> 等常用命令，是一份覆盖面非常全面的 Python 开发必备备忘录。</p>
<p>你可以将此文加入收藏夹或做成一页纸随身文档。</p>
<hr/>
<h2 data-id="heading-0">1. Python 命令速查</h2>
<h4 data-id="heading-1"><strong>基础命令</strong></h4>





























<table><thead><tr><th>用途</th><th>命令</th></tr></thead><tbody><tr><td>查看 Python 版本</td><td><code>python --version</code> / <code>python3 --version</code></td></tr><tr><td>进入交互式解释器</td><td><code>python</code></td></tr><tr><td>执行脚本</td><td><code>python script.py</code></td></tr><tr><td>执行一行代码</td><td><code>python -c "print('hello')"</code></td></tr><tr><td>以模块方式运行</td><td><code>python -m http.server 8000</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-2">2. pip 包管理命令</h2>
<h4 data-id="heading-3"><strong>基本操作</strong></h4>





































<table><thead><tr><th>操作</th><th>命令</th></tr></thead><tbody><tr><td>查看 pip 版本</td><td><code>pip --version</code></td></tr><tr><td>安装包</td><td><code>pip install package_name</code></td></tr><tr><td>安装固定版本包</td><td><code>pip install package==1.2.3</code></td></tr><tr><td>升级包</td><td><code>pip install --upgrade package</code></td></tr><tr><td>卸载包</td><td><code>pip uninstall package</code></td></tr><tr><td>查看已安装包</td><td><code>pip list</code></td></tr><tr><td>列出可更新包</td><td><code>pip list --outdated</code></td></tr></tbody></table>
<hr/>
<h4 data-id="heading-4"><strong>导出/安装依赖清单</strong></h4>

















<table><thead><tr><th>功能</th><th>命令</th></tr></thead><tbody><tr><td>导出依赖</td><td><code>pip freeze &gt; requirements.txt</code></td></tr><tr><td>安装依赖</td><td><code>pip install -r requirements.txt</code></td></tr></tbody></table>
<hr/>
<h4 data-id="heading-5">国内镜像源（提高速度）</h4>













<table><thead><tr><th>镜像源</th><th>示例</th></tr></thead><tbody><tr><td>清华大学</td><td><code>pip install package -i https://pypi.tuna.tsinghua.edu.cn/simple</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-6">3. 虚拟环境命令（venv）</h2>
<h4 data-id="heading-7"><strong>创建虚拟环境</strong></h4>
<pre><code class="hljs">python -m venv venv
</code></pre>
<h4 data-id="heading-8"><strong>激活虚拟环境</strong></h4>

















<table><thead><tr><th>系统</th><th>命令</th></tr></thead><tbody><tr><td>Windows</td><td><code>venv\Scripts\activate</code></td></tr><tr><td>macOS/Linux</td><td><code>source venv/bin/activate</code></td></tr></tbody></table>
<h4 data-id="heading-9"><strong>退出虚拟环境</strong></h4>
<pre><code class="hljs">deactivate
</code></pre>
<hr/>
<h2 data-id="heading-10">4. Poetry 命令（现代依赖管理工具）</h2>
<h4 data-id="heading-11"><strong>初始化项目</strong></h4>
<pre><code class="hljs language-csharp" lang="csharp">poetry <span class="hljs-keyword">init</span>
</code></pre>
<h4 data-id="heading-12"><strong>安装所有依赖</strong></h4>
<pre><code class="hljs">poetry install
</code></pre>
<h4 data-id="heading-13"><strong>安装依赖包</strong></h4>
<pre><code class="hljs language-csharp" lang="csharp">poetry <span class="hljs-keyword">add</span> requests
</code></pre>
<h4 data-id="heading-14"><strong>进入虚拟环境 shell</strong></h4>
<pre><code class="hljs">poetry shell
</code></pre>
<hr/>
<h2 data-id="heading-15">5. 常见 Python 模块常用命令</h2>
<h3 data-id="heading-16">（1）json 模块</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> json

json.dumps({<span class="hljs-string">"a"</span>: <span class="hljs-number">1</span>}, ensure_ascii=<span class="hljs-literal">False</span>)   <span class="hljs-comment"># dict → JSON</span>
json.loads(<span class="hljs-string">'{"a": 1}'</span>)                     <span class="hljs-comment"># JSON → dict</span>
</code></pre>
<hr/>
<h3 data-id="heading-17">（2）os 模块（文件与系统操作）</h3>





























<table><thead><tr><th>功能</th><th>命令</th></tr></thead><tbody><tr><td>当前路径</td><td><code>os.getcwd()</code></td></tr><tr><td>列出文件</td><td><code>os.listdir(path)</code></td></tr><tr><td>判断是否文件/文件夹</td><td><code>os.path.isfile()</code> / <code>os.path.isdir()</code></td></tr><tr><td>创建文件夹</td><td><code>os.makedirs(path, exist_ok=True)</code></td></tr><tr><td>删除文件</td><td><code>os.remove(file_path)</code></td></tr></tbody></table>
<hr/>
<h3 data-id="heading-18">（3）shutil（文件拷贝与移动）</h3>
<pre><code class="hljs language-python" lang="python">shutil.copy(src, dst)
shutil.move(src, dst)
shutil.rmtree(folder)
</code></pre>
<hr/>
<h2 data-id="heading-19">6. requests 常用语法速查</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

<span class="hljs-comment"># GET</span>
requests.get(url)

<span class="hljs-comment"># POST</span>
requests.post(url, data={<span class="hljs-string">"a"</span>: <span class="hljs-number">1</span>})

<span class="hljs-comment"># JSON</span>
requests.post(url, json={<span class="hljs-string">"key"</span>: <span class="hljs-string">"value"</span>})

<span class="hljs-comment"># 添加 headers</span>
requests.get(url, headers={<span class="hljs-string">"User-Agent"</span>: <span class="hljs-string">"Mozilla"</span>})

<span class="hljs-comment"># 下载文件</span>
requests.get(url).content
</code></pre>
<hr/>
<h2 data-id="heading-20">7. BeautifulSoup 常用命令</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup

soup = BeautifulSoup(html, <span class="hljs-string">"lxml"</span>)

soup.title.text
soup.find(<span class="hljs-string">"div"</span>)
soup.find_all(<span class="hljs-string">"a"</span>)
soup.select(<span class="hljs-string">"div.classname"</span>)
</code></pre>
<hr/>
<h2 data-id="heading-21">8. Pandas 常用命令</h2>
<h4 data-id="heading-22"><strong>读取文件</strong></h4>
<pre><code class="hljs language-python" lang="python">pd.read_csv(<span class="hljs-string">"a.csv"</span>)
pd.read_excel(<span class="hljs-string">"a.xlsx"</span>)
</code></pre>
<h4 data-id="heading-23"><strong>常见操作</strong></h4>
<pre><code class="hljs language-python" lang="python">df.head()
df.info()
df.describe()
df.to_excel(<span class="hljs-string">"out.xlsx"</span>, index=<span class="hljs-literal">False</span>)
</code></pre>
<hr/>
<h2 data-id="heading-24">9. Numpy 常用命令</h2>
<pre><code class="hljs language-python" lang="python">np.array([...])
np.zeros((<span class="hljs-number">3</span>,<span class="hljs-number">3</span>))
np.ones((<span class="hljs-number">2</span>,<span class="hljs-number">4</span>))
np.random.rand(<span class="hljs-number">5</span>)
</code></pre>
<hr/>
<h2 data-id="heading-25">10. Debug 调试（pdb）</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pdb; pdb.set_trace()
</code></pre>
<p>常用调试指令：</p>

























<table><thead><tr><th>指令</th><th>含义</th></tr></thead><tbody><tr><td>n</td><td>下一行</td></tr><tr><td>c</td><td>继续执行</td></tr><tr><td>p 变量</td><td>打印变量</td></tr><tr><td>q</td><td>退出调试</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-26">11. Logging 常用配置</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> logging

logging.basicConfig(level=logging.INFO)

logging.info(<span class="hljs-string">"info msg"</span>)
logging.error(<span class="hljs-string">"error msg"</span>)
</code></pre>
<hr/>
<h2 data-id="heading-27">12. 性能测试命令（timeit）</h2>
<p>在命令行：</p>
<pre><code class="hljs language-ini" lang="ini">python -m timeit "<span class="hljs-attr">x</span>=<span class="hljs-number">5</span><span class="hljs-comment">; x*x"</span>
</code></pre>
<p>在代码中：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> timeit
timeit.timeit(<span class="hljs-string">"x=5; x*x"</span>)
</code></pre>
<hr/>
<h2 data-id="heading-28">13. 代码质量检查</h2>
<h4 data-id="heading-29"><strong>flake8（静态检查）</strong></h4>
<pre><code class="hljs">flake8 your_code.py
</code></pre>
<h4 data-id="heading-30"><strong>black（格式化）</strong></h4>
<pre><code class="hljs language-erlang" lang="erlang">black .
</code></pre>
<hr/>
<h2 data-id="heading-31">14. 打包与发布</h2>
<h4 data-id="heading-32"><strong>PyInstaller 打包</strong></h4>
<pre><code class="hljs language-r" lang="r">pyinstaller <span class="hljs-operator">-</span><span class="hljs-built_in">F</span> script.py
</code></pre>
<h4 data-id="heading-33"><strong>构建 pip 包</strong></h4>
<pre><code class="hljs language-arduino" lang="arduino">python setup.py sdist bdist_wheel
twine upload dist<span class="hljs-comment">/*
</span></code></pre>
<hr/>
<h2 data-id="heading-34">15. 其他常用命令集合</h2>
<h4 data-id="heading-35">查看模块安装位置</h4>
<pre><code class="hljs">python -m site
</code></pre>
<h4 data-id="heading-36">查找模块路径</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> module; <span class="hljs-built_in">print</span>(module.__file__)
</code></pre>
<h4 data-id="heading-37">列出当前目录下所有 .py 文件</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">ls</span> *.py
</code></pre>
<hr/>
<h2 data-id="heading-38">结语</h2>
<p>这篇速查表涵盖了 Python 实战中最常用的命令、工具和库操作，从环境、包管理、常规编码，到性能调试、格式化、打包等多个方面。</p>
<p>无论你是在写脚本、做数据分析、搞爬虫、写后端 API，还是开发自动化工具，这些命令都能帮你节省大量时间。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python 编程实战：常用第三方库清单]]></title>    <link>https://juejin.cn/post/7575367791273443366</link>    <guid>https://juejin.cn/post/7575367791273443366</guid>    <pubDate>2025-11-23T23:52:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575367791273443366" data-draft-id="7575182522412072998" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python 编程实战：常用第三方库清单"/> <meta itemprop="keywords" content="后端,Python,Trae"/> <meta itemprop="datePublished" content="2025-11-23T23:52:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员爱钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python 编程实战：常用第三方库清单
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员爱钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T23:52:49.000Z" title="Sun Nov 23 2025 23:52:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在 Python 编程实战中，除了掌握语言基础和标准库，熟悉一些常用的 <strong>第三方库</strong> 能极大提升开发效率。本文将从数据处理、科学计算、网络编程、爬虫、Web 开发、自动化、机器学习等几个方向，为你整理一份高效实用的第三方库清单。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">1. 数据处理与分析</h2>
<p>Python 在数据处理方面非常强大，这类库主要用于数据清洗、分析、处理和可视化。</p>
<ul>
<li><strong>Pandas</strong>：数据分析和处理神器，支持 DataFrame 和 Series，方便读写 Excel、CSV、SQL 数据。</li>
<li><strong>NumPy</strong>：科学计算基础库，提供高性能多维数组和矩阵操作。</li>
<li><strong>OpenPyXL / xlrd / xlwt</strong>：操作 Excel 文件的常用库。</li>
<li><strong>PyArrow</strong>：高性能列式存储库，用于大数据处理。</li>
<li><strong>Polars</strong>：类似 Pandas，但性能更高，适合大数据场景。</li>
</ul>
<hr/>
<h2 data-id="heading-1">2. 数据可视化</h2>
<p>可视化是数据分析不可或缺的一环，Python 提供了丰富的图表工具。</p>
<ul>
<li><strong>Matplotlib</strong>：经典绘图库，支持折线图、散点图、柱状图等。</li>
<li><strong>Seaborn</strong>：基于 Matplotlib 的高级绘图库，更美观，适合统计图表。</li>
<li><strong>Plotly</strong>：交互式图表库，可生成 Web 可交互图表。</li>
<li><strong>pyecharts</strong>：国内流行的可视化库，结合百度 ECharts，适合 Web 可视化。</li>
<li><strong>Altair</strong>：声明式可视化库，语法简洁，适合快速作图。</li>
</ul>
<hr/>
<h2 data-id="heading-2">3. 网络与爬虫</h2>
<p>Python 在网络请求和爬虫领域非常受欢迎。</p>
<ul>
<li><strong>Requests</strong>：最常用 HTTP 请求库，简单易用。</li>
<li><strong>httpx</strong>：异步 HTTP 客户端，支持 HTTP/2。</li>
<li><strong>BeautifulSoup</strong>：HTML/XML 解析库，适合网页数据提取。</li>
<li><strong>lxml</strong>：高性能解析库，比 BeautifulSoup 更快，支持 XPath。</li>
<li><strong>Scrapy</strong>：功能强大的爬虫框架，适合大规模数据抓取。</li>
<li><strong>Selenium</strong>：浏览器自动化工具，用于处理动态页面。</li>
</ul>
<hr/>
<h2 data-id="heading-3">4. Web 开发</h2>
<p>Python 在 Web 开发领域同样广泛应用。</p>
<ul>
<li><strong>Flask</strong>：轻量级 Web 框架，适合快速开发 API。</li>
<li><strong>Django</strong>：全功能 Web 框架，内置 ORM、Admin 等组件，适合大型项目。</li>
<li><strong>FastAPI</strong>：现代化高性能 Web 框架，支持异步和自动生成 API 文档。</li>
<li><strong>Tornado</strong>：支持高并发异步网络应用的 Web 框架。</li>
<li><strong>Jinja2</strong>：Python 模板引擎，常配合 Flask 使用。</li>
</ul>
<hr/>
<h2 data-id="heading-4">5. 自动化与脚本工具</h2>
<p>Python 的自动化能力是其核心优势之一。</p>
<ul>
<li><strong>PyAutoGUI</strong>：跨平台 GUI 自动化操作库。</li>
<li><strong>Selenium / Playwright</strong>：浏览器自动化，适合自动化测试和操作网页。</li>
<li><strong>openpyxl / xlwings</strong>：自动化操作 Excel 文件。</li>
<li><strong>schedule / APScheduler</strong>：任务调度库，轻松实现定时任务。</li>
<li><strong>shutil / pathlib</strong>：文件系统自动化操作，结合标准库使用。</li>
</ul>
<hr/>
<h2 data-id="heading-5">6. 机器学习与深度学习</h2>
<p>Python 是数据科学和 AI 的首选语言，各类库丰富完善。</p>
<ul>
<li><strong>scikit-learn</strong>：经典机器学习库，支持分类、回归、聚类等算法。</li>
<li><strong>XGBoost / LightGBM / CatBoost</strong>：高性能梯度提升算法库。</li>
<li><strong>TensorFlow / PyTorch</strong>：深度学习框架，支持 GPU 加速和复杂神经网络。</li>
<li><strong>Keras</strong>：基于 TensorFlow 的高级神经网络接口。</li>
<li><strong>Transformers</strong>：HuggingFace 提供的 NLP 模型库。</li>
</ul>
<hr/>
<h2 data-id="heading-6">7. 图像与多媒体处理</h2>
<ul>
<li><strong>Pillow</strong>：Python 图像处理库，支持基本图像操作。</li>
<li><strong>OpenCV</strong>：计算机视觉库，支持图像处理、视频分析、实时检测。</li>
<li><strong>moviepy</strong>：视频编辑和处理库。</li>
<li><strong>PyPDF2 / fitz (PyMuPDF)</strong>：PDF 操作库，支持合并、拆分、提取文本。</li>
</ul>
<hr/>
<h2 data-id="heading-7">8. 开发工具与效率提升</h2>
<ul>
<li><strong>Click / Typer</strong>：快速开发命令行工具。</li>
<li><strong>rich / textual</strong>：漂亮的终端输出和 TUI 应用。</li>
<li><strong>pytest</strong>：测试框架，支持单元测试和集成测试。</li>
<li><strong>black / isort / flake8</strong>：代码格式化与规范检查，提高团队开发效率。</li>
</ul>
<hr/>
<h2 data-id="heading-8">结语</h2>
<p>Python 的第三方库生态非常丰富，本篇文章列出的只是实战中最常用的部分。掌握这些库，可以大大提升你的开发效率和项目可维护性。</p>
<p>实践建议：</p>
<ol>
<li>根据项目需求选择最合适的库。</li>
<li>熟练掌握官方文档，避免盲目依赖示例。</li>
<li>尝试组合多个库，实现更高效的解决方案。</li>
</ol>
<p>掌握这些库，你就可以在数据分析、爬虫、Web 开发、自动化、机器学习等领域游刃有余，实现 Python 编程实战的真正价值。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[不易懂你打我！写给前端和小白的 大模型(ChatGPT) 工作基本原理！]]></title>    <link>https://juejin.cn/post/7575162322241077248</link>    <guid>https://juejin.cn/post/7575162322241077248</guid>    <pubDate>2025-11-23T23:57:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575162322241077248" data-draft-id="7558181864130953256" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="不易懂你打我！写给前端和小白的 大模型(ChatGPT) 工作基本原理！"/> <meta itemprop="keywords" content="前端,人工智能"/> <meta itemprop="datePublished" content="2025-11-23T23:57:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="孟祥_成都"/> <meta itemprop="url" content="https://juejin.cn/user/96412752684744"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            不易懂你打我！写给前端和小白的 大模型(ChatGPT) 工作基本原理！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/96412752684744/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    孟祥_成都
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T23:57:00.000Z" title="Sun Nov 23 2025 23:57:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文承接上文<a href="https://juejin.cn/post/7573592127299108914" target="_blank" title="https://juejin.cn/post/7573592127299108914">打包票！前端和小白一定能明白的人工智能基础概念</a>，强烈建议大家阅读一下，文章采用层层递进的超级白话的方式，让我们了解机器学习，神经网络和深度学习的关系和概念。</p>
<h2 data-id="heading-0">前言</h2>
<p>实在是受够了很多文章写给小白的大模型工作原理的文章，看了还是觉得很多文章内部毫无逻辑可言，所以我觉得自己弄清楚后，写下这些留给跟我对这些文章同样一头雾水的伙伴！</p>
<h2 data-id="heading-1">从语言模型说起</h2>
<p>首先大模型一定要有自己的语言模型，才能理解人类语言的基本逻辑关系，并且输出对应的回答也是我们能看懂的。那大模型的语言模型是什么呢?如何做到好像类似 <code>ChatGPT</code>、<code>DeepSeek</code> 这样的聊天 <code>ai</code> 似乎理解我们人类语言似的，真的是这样吗？</p>
<p>先说答案，其实不是，这个语言模型简单来说就是：”预测下一个语素“（统计语言模型）。</p>
<p>什么意思呢，大家在使用输入法打字的时候，是不是很多时候，当你打一个字或者词的时候，输入法会帮你预测你下一个字是什么，这就是预测下一个元素，比如'鸡你太_'，如果你是小黑子，就可能出现什么字呢，你猜猜。。。</p>
<p>你可能会疑惑: 我去，这么暴力？这还是 <code>ai</code> 吗？看起来不太聪明的样子？！回答就是，你还真别小看这个模型，小小手机能收集你的语言习惯，同理是不是当你给 <code>ai</code> 足够的训练资料的时候，<code>ai</code> 能学习到大部分人的语言习惯呢？</p>
<p>很多人肯定还是疑惑，人类语言这么巧妙，这种粗暴的方式真的有效？我们举个例子</p>
<p>假设这样一句话：他放下了书，因为它太_。</p>
<p>在太后面可能是太重，可能是太难等等常见搭配，也就是当大模型猜测，是重或者难的时候，很可能前面表达的内容表达的是一种让人很不舒服的感觉，也是从某种角度理解了重和难在现实中的意思。</p>
<p>我们再来想一下，这个"太"字，在大模型见过的语料够多后，它也慢慢发现，原来"太"这个字后面经常跟形容词，这算不算某种程度上学习到了人类语言的语言规律呢？</p>
<p>但这里问题来了，基本的词性，比如一个词是形容词，还是名词，计算机是不是开始就要对我们输入的问题进行分词?然后理解分词的词语，然后建立一套模型，让这些词语之间建立联系，这样才能在自己输出"太"字的时候，知道后面往往跟 <code>难</code> 、<code>重</code> 或者其它意思？</p>
<p>在解释如何建立联系的之前，我们必须弄清楚计算机本身是如何处理文本的！</p>
<h2 data-id="heading-2">计算机如何处理文本</h2>
<p>计算机本质上就是计算器，它只能计算，无法理解文本，例如字母a，在ascii编码中，在计算机中用97来表示，比如让计算机算 字母a 和b的大小，只不过是在计算机内部比较了97和98的大小而已。</p>
<p>同理，大模型也需要把文字转为数字来处理（为什么？因为计算机只能计算数字！），例如”人“在计算机中如何表示，是不是可以这样，用一个数字填充的数组：<code>[0，175，60，20]</code></p>
<ul>
<li>数组第一位，0代表男生，1代表女生</li>
<li>数组第二位，175代表身高</li>
<li>数组第三位，60表示体重</li>
<li>数组第四位，20表示年龄</li>
</ul>
<p>这样就在 4 个维度描述了一个人，假设有这样一个数据，[0，170，50，20] ，在四维空间中其实跟上一个人产生了联系，也就是某些维度上是相近的。</p>
<p>因为现实世界特别复杂， 所以一个词的维度有非常多。我们这里只是很粗暴的用了 <code>4</code> 个维度，正常大模型可能认为一个词的维度能上千或者上万，这取决于大模型自己的算法如何理解这个世界。</p>
<p>现在解决了如何把文字转换为数字让计算机处理的问题，接下来新的问题又来了。如何给某个词设置合适的向量值。</p>
<p>这个专术语叫嵌入（Embedding），目的提取文本的特征，这里有特定的算法来解决，因为我也不是这方面专业人员，这里不做过多介绍，有兴趣的同学可以去搜索<code>词袋模型</code>,<code>TFFIDF</code>。</p>
<p>在给这些词语标注特定向量值的过程，使用的技术方法不同，最终效果也不同，比如 <code>ChatGPT</code> 使用了一种叫做“上下文词向量表示法”，这个方法标注的每个词的向量值不仅取决于这个单词本身，还取决于这个词在不同上下文中的意思。</p>
<p>例如 <code>苹果</code> 这个词讨论水果和电子产品（苹果手机）时的含义是完全不一样的。这就是很多文章说的<code>自注意力机制</code>。</p>
<p>那解决了基本词语在计算机中如何展示，并且映射现实语义的情况下，我们就该开始训练大模型能解决实际用户提出的问题了。</p>
<p>gpt 这个词就是根据上面我们说的模型原理命名的缩写 ，p 就是 pre–trained，预训练的意思，也就是要通过大量语料来给它学习，然后通过训练让其找到语言中很多词语搭配的规律。然后生成答案，这就是 gpt中字母 g 的意思，generative的意思。</p>
<p>也就是说，我们要开始 <code>预训练</code> 了。</p>
<h2 data-id="heading-3">预训练</h2>
<p>我们刚才说了，这种统计语言模型，是靠猜下一个字是什么来生成文字给用户的。这个训练的目的，就是让大模型知道"在什么情况下，下一个字应该是什么"。</p>
<p>所以预训练的过程，还会不断调整 <code>向量</code> 的值。</p>
<h3 data-id="heading-4">什么是预训练？</h3>
<p>想象一下，我们要培养一个<strong>文学大师</strong>：</p>
<p><strong>预训练</strong> = 让这个大师<strong>博览群书</strong>的阶段</p>
<p>在这个阶段，我们给模型喂食<strong>海量的文本数据</strong>——包括维基百科、新闻文章、小说、科技论文、论坛讨论等等。但注意：这时候我们<strong>不教它完成任何具体任务</strong>，比如回答问题或者写邮件。</p>
<p>我们只让它做一件事：<strong>不断地猜下一个字</strong>。</p>
<h3 data-id="heading-5">预训练的具体过程</h3>
<pre><code class="hljs language-arduino" lang="arduino">输入：<span class="hljs-string">"今天天气真"</span>
目标输出：<span class="hljs-string">"好"</span>  <span class="hljs-comment">// 模型要猜出这个字</span>

输入：<span class="hljs-string">"人工智能是"</span>
目标输出：<span class="hljs-string">"未"</span>  <span class="hljs-comment">// 接着猜"来"等</span>

输入：<span class="hljs-string">"中国的首都是"</span>
目标输出：<span class="hljs-string">"北"</span>  <span class="hljs-comment">// 接着猜"京"</span>
</code></pre>
<p>就这样，模型在数万亿个这样的例子上进行训练，逐渐学习到：</p>
<ul>
<li><strong>语法规则</strong>："的"后面通常跟名词</li>
<li><strong>常识知识</strong>："北京是中国的首都"</li>
<li><strong>逻辑推理</strong>："因为下雨，所以..."后面可能是"带伞"、"取消活动"</li>
<li><strong>文体风格</strong>：论文和社交媒体的语言风格差异</li>
</ul>
<p>总而言之，不断地猜下一个字的过程中，逐渐掌握基本的语言规律和表达能力。</p>
<p>预训练之后，还会有些一些调整，这时候尤其是人为的标注，可以极大让纠正和优化大模型的向量值。</p>
<p>如果你看过我上一篇文章，一定要理解权重这个概念，其实<code>chatGPT</code>的训练过程，同样是在调节权重：</p>
<p>上文写到：</p>
<blockquote>
<p>训练就是不断调整 w，使得模型能正确分类。</p>
</blockquote>
<p>这就是 ChatGPT 的训练过程（预训练）！</p>
<p>ChatGPT 训练时：</p>
<ul>
<li>输入大量文本</li>
<li>预测下一个词</li>
<li>如果预测错了 → 调整权重 w</li>
<li>重复 trillions 次 → 得到现在的能力</li>
</ul>
<p>那 <code>ChatGPT</code> 和基础的神经网络学习哪方面区别很大呢？</p>
<p>我们之前说了 <code>ChatGPT</code>(chat是聊天的意思)中 <code>G</code> 和 <code>P</code> 我们解释了，有人会说还有个 t 呢？它代表的是 <code>transformer</code> 的意思。这个 <code>tranformer</code> 就是与普通神经网络最大的区别。</p>
<h2 data-id="heading-6">ChatGPT 为什么突然这么聪明？</h2>
<p>我们前面一直在说：大模型预测下一个字，用的是“上下文词向量表示法”，也就是一个词在<strong>不同上下文</strong>里的含义不同。</p>
<p>问题来了：</p>
<blockquote>
<p><strong>模型如何知道“上下文”？</strong><br/>
也就是说，它怎么知道一句话里哪些词应该互相影响？</p>
</blockquote>
<p>这就是 <code>transformer</code> 出场的时刻了。</p>
<p>GPT 里的 <strong>T = Transformer</strong>，它是这十年来让所有大模型突然变强的“关键武器”，可以说是<strong>整个大模型爆发的核心技术</strong>。</p>
<p>下面我们用最简单方式讲明白它到底在干嘛。</p>
<h3 data-id="heading-7">Transformer 解决了一个什么痛点？</h3>
<p>在 Transformer 出现之前，模型主要靠 <strong>RNN/LSTM</strong> 来看上下文，但它有两个大毛病：</p>
<ol>
<li><strong>只能从前往后一个字一个字读，速度慢</strong></li>
<li><strong>距离远的词，很难建立联系</strong></li>
</ol>
<p>举例：</p>
<pre><code class="hljs">我买了一本书，它特别好看。
</code></pre>
<p>这里：</p>
<ul>
<li>“它” 指的是 “书”</li>
<li>“好看” 也和 “书” 对应</li>
</ul>
<p>但在旧模型里，这种“跨很多词”的关系会被稀释掉,也就无法联系上下文来理解长句子的意思。</p>
<p><code>Transformer</code> 说：</p>
<blockquote>
<p><strong>我一次性看整句话，不是一个字一个字扫！</strong><br/>
并且我会计算句子里每个字对每个字的重要程度。</p>
</blockquote>
<p>这能力就是传说中的 —— <strong>自注意力机制（Self-Attention）</strong></p>
<h2 data-id="heading-8">什么是自注意力机制？</h2>
<p>你可以把一整句话想象成一桌开会的人。</p>
<p>例如一句话：</p>
<blockquote>
<p><strong>“他放下了书，因为它太重。”</strong></p>
</blockquote>
<p>在 Transformer 的“会议”里，这些词会互相发消息：</p>
<ul>
<li>“它” 会问所有词：“我到底指的是谁？”</li>
<li>“重” 会问：“我应该描述哪个名词？”</li>
<li>“放下” 会问：“发生这个动作的原因是什么？”</li>
</ul>
<p>然后 <code>Transformer </code>会给这些联系打分，比如：</p>
<ul>
<li>“它” → “书”：权重很高（说明它指书）</li>
<li>“重” → “书”：权重很高（说明重描述书）</li>
<li>“因为” → “放下”：权重很高（说明因果关系）</li>
</ul>
<p>这套“你影响我，我影响你”的机制，就是<strong>自注意力</strong>。</p>
<p>一句话总结：</p>
<blockquote>
<p><strong>自注意力机制让模型自动找出句子里哪些词对当前词最重要</strong></p>
</blockquote>
<p>这就是 Transformer 的本事！</p>
<p><strong>GPT 的 G（生成）和 P（预训练）解决了“怎么学语言”，<br/>
但 Transformer（T）解决了“怎么理解上下文”。</strong></p>
<p>有了 Transformer，模型不再是“瞎猜下一个字”，<br/>
而是能基于全句、全段、全篇来猜。</p>
<p>这就是 ChatGPT 看起来像“能理解你”的原因。</p>
<h2 data-id="heading-9">小结</h2>
<p>我相信文章内容虽然没有很多专业人士高大上的描述，但用于入门 ai 基础知识，算是足够白话了！感谢大家！</p>
<p>我的 <code>ai</code> 学习记录</p>
<ul>
<li><a href="https://juejin.cn/post/7573592127299108914" target="_blank" title="https://juejin.cn/post/7573592127299108914">打包票！前端和小白一定能明白的人工智能基础概念</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot拦截器结合HMAC-SHA256实现API安全验证]]></title>    <link>https://juejin.cn/post/7575468252657041449</link>    <guid>https://juejin.cn/post/7575468252657041449</guid>    <pubDate>2025-11-23T23:56:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575468252657041449" data-draft-id="7574978545144987683" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Boot拦截器结合HMAC-SHA256实现API安全验证"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-23T23:56:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="风象南"/> <meta itemprop="url" content="https://juejin.cn/user/2524134428655159"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Boot拦截器结合HMAC-SHA256实现API安全验证
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2524134428655159/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    风象南
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T23:56:02.000Z" title="Sun Nov 23 2025 23:56:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在开放平台和第三方集成的项目中，如何确保 API 调用的安全性和可靠性是一个重要课题。特别是对于没有用户登录场景的系统间调用，传统的session或token认证方式并不适用，数字签名技术就成为了一种理想的选择。</p>
<p>这种验证方式在开放平台、SaaS服务、微服务间调用等场景下特别实用，能够有效验证请求来源的合法性，防止参数被篡改和重放攻击。</p>
<p>本文将详细介绍如何基于 Spring Boot 拦截器和 HMAC-SHA256 算法，构建一套轻量级但足够安全的 API 验签机制。</p>
<h2 data-id="heading-1">什么是数字签名？</h2>
<p>数字签名是一种用于验证数据完整性和真实性的技术手段。在 API 调用中，数字签名通过以下方式保障安全：</p>
<ul>
<li><strong>1. 身份验证</strong>：确认请求方身份的合法性</li>
<li><strong>2. 数据完整性</strong>：确保请求参数在传输过程中未被篡改</li>
<li><strong>3. 防止重放攻击</strong>：通过时间戳等机制防止请求被重复使用</li>
</ul>
<h2 data-id="heading-2">整体设计</h2>
<h4 data-id="heading-3">设计思路</h4>
<p>我们的验签机制基于以下核心思想：</p>
<ul>
<li><strong>无侵入性</strong>：通过 Spring Boot 拦截器实现，业务代码无需改动</li>
<li><strong>算法安全性</strong>：采用业界成熟的 HMAC-SHA256 算法</li>
<li><strong>配置灵活</strong>：支持多客户端、多密钥管理</li>
</ul>
<h4 data-id="heading-4">架构流程图</h4>
<pre><code class="hljs language-css" lang="css">客户端请求 → 生成签名 → 发送请求 → 拦截器验证 → 业务处理
     ↓              ↓           ↓           ↓           ↓
  <span class="hljs-selector-attr">[参数整理]</span>    <span class="hljs-selector-attr">[HMAC加密]</span>  <span class="hljs-selector-attr">[携带签名头]</span>  <span class="hljs-selector-attr">[验签逻辑]</span>  <span class="hljs-selector-attr">[通过/拒绝]</span>
     ↓              ↓           ↓           ↓           ↓
   参数排序    +时间戳加密   X-API-Key    密钥匹配    正常响应
     ↓              ↓           ↓           ↓           ↓
   拼接参数    Base64编码   X-Timestamp  时间戳验证   或返回<span class="hljs-number">401</span>
     ↓              ↓           ↓           ↓
   待签字符串    完整签名     X-Signature  签名对比
</code></pre>
<h2 data-id="heading-5">HMAC-SHA256 签名原理</h2>
<p>HMAC（Hash-based Message Authentication Code，基于哈希的消息认证码）结合了哈希函数和密钥，提供了一种安全高效的消息认证方式。</p>
<h4 data-id="heading-6">签名生成算法</h4>
<pre><code class="hljs language-scss" lang="scss">签名 = <span class="hljs-built_in">Base64</span>(HMAC-SHA256(时间戳 + 排序后的请求参数, 密钥))
</code></pre>
<h4 data-id="heading-7">算法步骤</h4>
<ul>
<li><strong>1. 参数标准化</strong>：将所有请求参数按字典序排序</li>
<li><strong>2. 数据拼接</strong>：将时间戳和排序后的参数按规则拼接</li>
<li><strong>3. 签名运算</strong>：使用密钥对拼接字符串进行 HMAC-SHA256 运输</li>
<li><strong>4. 编码转换</strong>：对加密结果进行 Base64 编码生成最终签名</li>
</ul>
<h2 data-id="heading-8">核心组件实现</h2>
<h4 data-id="heading-9">1. 签名工具类</h4>
<p>签名工具类是整个机制的核心，负责签名的生成和验证逻辑</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SignatureUtil</span> {

    <span class="hljs-comment">/**
     * 生成签名
     * 签名算法：Base64(HMAC-SHA256(timestamp + sortedParams, secret))
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">generateSignature</span><span class="hljs-params">(Map&lt;String, Object&gt; params,
                                         String timestamp, String secret)</span> {
        <span class="hljs-comment">// 参数排序并拼接</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">sortedParams</span> <span class="hljs-operator">=</span> sortParams(params);
        <span class="hljs-type">String</span> <span class="hljs-variable">dataToSign</span> <span class="hljs-operator">=</span> timestamp + sortedParams;

        <span class="hljs-comment">// HMAC-SHA256加密并Base64编码</span>
        <span class="hljs-type">HMac</span> <span class="hljs-variable">hmac</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HMac</span>(HmacAlgorithm.HmacSHA256, secret.getBytes(StandardCharsets.UTF_8));
        <span class="hljs-type">byte</span>[] digest = hmac.digest(dataToSign);
        <span class="hljs-keyword">return</span> Base64.getEncoder().encodeToString(digest);
    }

    <span class="hljs-comment">/**
     * 验证时间戳有效性（防重放攻击）
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">validateTimestamp</span><span class="hljs-params">(String timestamp, <span class="hljs-type">long</span> tolerance)</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">requestTime</span> <span class="hljs-operator">=</span> Long.parseLong(timestamp);
        <span class="hljs-type">long</span> <span class="hljs-variable">currentTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis() / <span class="hljs-number">1000</span>;
        <span class="hljs-keyword">return</span> Math.abs(currentTime - requestTime) &lt;= tolerance;
    }
}
</code></pre>
<h4 data-id="heading-10">2. 拦截器</h4>
<p>拦截器负责对所有受保护接口进行统一的签名验证</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SignatureValidationInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> {
        <span class="hljs-comment">// 1. 获取签名头信息</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">timestamp</span> <span class="hljs-operator">=</span> request.getHeader(<span class="hljs-string">"X-Timestamp"</span>);
        <span class="hljs-type">String</span> <span class="hljs-variable">signature</span> <span class="hljs-operator">=</span> request.getHeader(<span class="hljs-string">"X-Signature"</span>);
        <span class="hljs-type">String</span> <span class="hljs-variable">apiKey</span> <span class="hljs-operator">=</span> request.getHeader(<span class="hljs-string">"X-Api-Key"</span>);

        <span class="hljs-comment">// 2. 验证必要参数</span>
        <span class="hljs-keyword">if</span> (!StringUtils.hasText(timestamp) || !StringUtils.hasText(signature) || !StringUtils.hasText(apiKey)) {
            <span class="hljs-keyword">return</span> writeErrorResponse(response, <span class="hljs-string">"Missing required signature headers"</span>);
        }

        <span class="hljs-comment">// 3. 验证时间戳（防重放攻击）</span>
        <span class="hljs-keyword">if</span> (!SignatureUtil.validateTimestamp(timestamp, timeTolerance)) {
            <span class="hljs-keyword">return</span> writeErrorResponse(response, <span class="hljs-string">"Invalid timestamp"</span>);
        }

        <span class="hljs-comment">// 4. 获取密钥并验证签名</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">secret</span> <span class="hljs-operator">=</span> securityProperties.getApiSecret(apiKey);
        <span class="hljs-keyword">if</span> (secret == <span class="hljs-literal">null</span> || !SignatureUtil.verifySignature(extractParams(request), timestamp, secret, signature)) {
            <span class="hljs-keyword">return</span> writeErrorResponse(response, <span class="hljs-string">"Invalid signature"</span>);
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// 验证通过，继续处理请求</span>
    }
}
</code></pre>
<h4 data-id="heading-11">3. 配置类（WebMvcConfig）</h4>
<p>配置类负责将拦截器集成到 Spring Boot 的请求处理链中：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebMvcConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> {
        registry.addInterceptor(signatureValidationInterceptor)
                .addPathPatterns(<span class="hljs-string">"/api/**"</span>)              <span class="hljs-comment">// 拦截所有API请求</span>
                .excludePathPatterns(<span class="hljs-string">"/api/public/**"</span>);  <span class="hljs-comment">// 排除公开接口</span>
    }
}
</code></pre>
<h2 data-id="heading-12">客户端调用示例</h2>
<h4 data-id="heading-13">请求头设置</h4>
<p>客户端需要在请求头中包含三个必要字段：</p>
<ul>
<li><code>X-Api-Key</code>：客户端标识</li>
<li><code>X-Timestamp</code>：当前时间戳（秒级）</li>
<li><code>X-Signature</code>：生成的签名</li>
</ul>
<h4 data-id="heading-14">完整调用流程</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. 准备请求参数</span>
Map&lt;String, Object&gt; params = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
params.put(<span class="hljs-string">"userId"</span>, <span class="hljs-string">"12345"</span>);
params.put(<span class="hljs-string">"type"</span>, <span class="hljs-string">"profile"</span>);

<span class="hljs-comment">// 2. 生成签名</span>
<span class="hljs-type">String</span> <span class="hljs-variable">timestamp</span> <span class="hljs-operator">=</span> String.valueOf(System.currentTimeMillis() / <span class="hljs-number">1000</span>);
<span class="hljs-type">String</span> <span class="hljs-variable">signature</span> <span class="hljs-operator">=</span> SignatureUtil.generateSignature(params, timestamp, <span class="hljs-string">"your-secret"</span>);

<span class="hljs-comment">// 3. 设置请求头并发送请求</span>
<span class="hljs-type">Headers</span> <span class="hljs-variable">headers</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Headers</span>();
headers.set(<span class="hljs-string">"X-Api-Key"</span>, <span class="hljs-string">"client1"</span>);
headers.set(<span class="hljs-string">"X-Timestamp"</span>, timestamp);
headers.set(<span class="hljs-string">"X-Signature"</span>, signature);

<span class="hljs-comment">// GET /api/protected/data?userId=12345&amp;type=profile</span>
</code></pre>
<h2 data-id="heading-15">安全性设计要点</h2>
<h4 data-id="heading-16">1. 防重放攻击</h4>
<ul>
<li><strong>时间戳验证</strong>：服务端验证时间戳的有效性（默认容忍度5分钟）</li>
<li><strong>唯一性保证</strong>：相同参数在不同时间戳下生成不同签名</li>
<li><strong>配置灵活</strong>：可根据业务需求调整容忍时间</li>
</ul>
<h4 data-id="heading-17">2. 密钥管理</h4>
<ul>
<li><strong>多客户端支持</strong>：每个客户端使用独立的 API Key 和密钥</li>
<li><strong>配置化管理</strong>：通过配置文件或其他存储组件统一管理密钥映射</li>
<li><strong>定期轮换</strong>：建议定期更换密钥以提升安全性</li>
</ul>
<h4 data-id="heading-18">3. 日志审计</h4>
<ul>
<li><strong>请求日志</strong>：记录验证失败的关键信息（不包含完整签名）</li>
<li><strong>IP追踪</strong>：记录客户端真实IP地址</li>
<li><strong>安全预警</strong>：异常签名验证触发告警机制</li>
</ul>
<h2 data-id="heading-19">安全性增强建议</h2>
<h4 data-id="heading-20">1. 传输层安全</h4>
<ul>
<li><strong>HTTPS强制</strong>：所有API请求必须通过HTTPS传输</li>
<li><strong>证书验证</strong>：启用双向证书认证增加安全性</li>
<li><strong>协议升级</strong>：及时更新SSL/TLS协议版本</li>
</ul>
<h4 data-id="heading-21">2. 密钥管理优化</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 生成安全密钥（32位随机字符串）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">generateSecureKey</span><span class="hljs-params">()</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">chars</span> <span class="hljs-operator">=</span> <span class="hljs-string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"</span>;
    <span class="hljs-type">SecureRandom</span> <span class="hljs-variable">random</span> <span class="hljs-operator">=</span> SecureRandom.getInstanceStrong();
    <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();

    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) {
        sb.append(chars.charAt(random.nextInt(chars.length())));
    }

    <span class="hljs-keyword">return</span> sb.toString();
}
</code></pre>
<h4 data-id="heading-22">3. 请求限流</h4>
<p>建议结合 Redis 实现请求限流，防止暴力破解：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 简限流逻辑示例</span>
<span class="hljs-type">String</span> <span class="hljs-variable">rateLimitKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"api_limit:"</span> + apiKey;
<span class="hljs-type">long</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().increment(rateLimitKey);
<span class="hljs-keyword">if</span> (count &gt; <span class="hljs-number">100</span>) { <span class="hljs-comment">// 每分钟限制100次请求</span>
    <span class="hljs-keyword">return</span> writeErrorResponse(response, <span class="hljs-string">"Too many requests"</span>);
}
</code></pre>
<h2 data-id="heading-23">测试验证</h2>
<h4 data-id="heading-24">正常流程测试</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用curl测试（需要先根据参数生成签名）</span>
timestamp=$(<span class="hljs-built_in">date</span> +%s)
signature=$(生成签名逻辑)
curl -X GET <span class="hljs-string">"http://localhost:8080/api/protected/data?userId=12345"</span> \
  -H <span class="hljs-string">"X-Api-Key: client1"</span> \
  -H <span class="hljs-string">"X-Timestamp: <span class="hljs-variable">$timestamp</span>"</span> \
  -H <span class="hljs-string">"X-Signature: <span class="hljs-variable">$signature</span>"</span>
</code></pre>
<h4 data-id="heading-25">异常场景测试</h4>
<ul>
<li><strong>签名错误</strong>：修改参数但不更新签名</li>
<li><strong>时间戳过期</strong>：使用过期的时间戳</li>
<li><strong>密钥错误</strong>：使用错误的API Key</li>
<li><strong>缺少头信息</strong>：缺少必要的请求头</li>
</ul>
<h2 data-id="heading-26">总结</h2>
<p>通过 Spring Boot 拦截器和 HMAC-SHA256 算法，我们实现了一套完整且实用的 API 签名验证方案。这套机制有效解决了系统间调用的安全问题，而且对现有代码几乎零侵入，直接复用即可。</p>
<p>在实际项目中，你可以根据具体需求调整时间戳容忍度、密钥管理策略等配置，实现灵活的安全控制。</p>
<h2 data-id="heading-27">仓库</h2>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/github.com/yuboon</span><span class="hljs-regexp">/java-examples/tree</span><span class="hljs-regexp">/master/springboot</span>-api-signature
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C#.NET 集合表达式详解：新时代的集合初始化方式]]></title>    <link>https://juejin.cn/post/7575469988736598025</link>    <guid>https://juejin.cn/post/7575469988736598025</guid>    <pubDate>2025-11-23T22:16:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575469988736598025" data-draft-id="7575412016404807690" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C#.NET 集合表达式详解：新时代的集合初始化方式"/> <meta itemprop="keywords" content="C#,.NET"/> <meta itemprop="datePublished" content="2025-11-23T22:16:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="唐青枫"/> <meta itemprop="url" content="https://juejin.cn/user/3737995266234280"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C#.NET 集合表达式详解：新时代的集合初始化方式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3737995266234280/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    唐青枫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T22:16:23.000Z" title="Sun Nov 23 2025 22:16:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">简介</h3>
<p>集合表达式（<code>Collection Expressions</code>）是 <code>C# 12.0</code>（随 <code>.NET 8.0</code> 发布于 2023 年）引入的一项新特性，用于以简洁、声明式的方式创建和初始化集合（如数组、列表、字典等）。集合表达式通过 [...] 语法提供了一种更直观的方式来定义集合，减少样板代码并提高可读性。</p>
<h3 data-id="heading-1">背景和作用</h3>
<p>集合表达式旨在解决传统集合初始化（如 <code>new List&lt;T&gt; { ... }</code> 或 <code>new[] { ... }</code>）的冗长和不一致问题，灵感来源于 <code>Python</code> 和 <code>JavaScript</code> 的列表推导式。它在以下场景中特别有用：</p>
<ul>
<li>
<p>数据初始化：快速定义数组、列表或字典。</p>
</li>
<li>
<p>批量操作：简化 <code>MySqlBulkLoader</code> 的数据表填充。</p>
</li>
<li>
<p><code>API</code> 输入/输出：处理 <code>JSON</code> 数据或响应集合。</p>
</li>
<li>
<p>缓存管理：初始化 <code>MemoryCache</code> 的键值对。</p>
</li>
<li>
<p>定时任务：结合 <code>Cronos</code> 处理批量数据。</p>
</li>
</ul>
<h3 data-id="heading-2">核心概念</h3>
<h4 data-id="heading-3">传统初始化 vs 集合表达式</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 传统方式  </span>
List&lt;<span class="hljs-built_in">int</span>&gt; list1 = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-built_in">int</span>&gt; { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span> };  
<span class="hljs-built_in">int</span>[] array1 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">int</span>[] { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span> };  

<span class="hljs-comment">// C# 12 集合表达式  </span>
List&lt;<span class="hljs-built_in">int</span>&gt; list2 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];  
<span class="hljs-built_in">int</span>[] array2 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];  
Span&lt;<span class="hljs-built_in">int</span>&gt; span = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];  
</code></pre>
<h4 data-id="heading-4">语法结构</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 基础形式  </span>
[<span class="hljs-meta">element1, element2, ..., elementN</span>]  

<span class="hljs-comment">// 空集合  </span>
<span class="hljs-keyword">var</span> empty = [];  

<span class="hljs-comment">// 嵌套集合  </span>
<span class="hljs-built_in">int</span>[][] matrix = [[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>], [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>]];  
</code></pre>
<h3 data-id="heading-5">支持的所有集合类型</h3>








































<table><thead><tr><th>集合类型</th><th>示例</th><th>编译器转换机制</th></tr></thead><tbody><tr><td>数组</td><td>int[] arr = [1, 2, 3];</td><td>直接优化为 new int[] { ... }</td></tr><tr><td>List</td><td>List list = [1, 2, 3];</td><td>调用 List.CollectionsMarshalHelper.Create()</td></tr><tr><td>Span</td><td>Span span = [1, 2, 3];</td><td>栈分配或缓冲区重用</td></tr><tr><td>ReadOnlySpan</td><td>ReadOnlySpan ros = ['a','b'];</td><td>同 Span</td></tr><tr><td>ImmutableArray</td><td>ImmutableArray ia = [1,2,3];</td><td>调用 ImmutableArray.Create()</td></tr><tr><td>自定义集合</td><td>实现 IEnumerable + Add 方法</td><td>编译器生成 Add 调用序列</td></tr></tbody></table>
<blockquote>
<p>✅ 所有实现 IEnumerable 且有 Add 方法的类型都支持</p>
</blockquote>
<h3 data-id="heading-6">主要功能</h3>
<h4 data-id="heading-7">简洁语法：</h4>
<ul>
<li>
<p>使用 <code>[...]</code> 替代 <code>new List&lt;T&gt; { ... }</code> 或 <code>new[] { ... }</code>。</p>
</li>
<li>
<p>支持多种集合类型（数组、<code>List&lt;T&gt;</code>、<code>Span&lt;T&gt;</code>、字典等）。</p>
</li>
</ul>
<h4 data-id="heading-8">扩展运算符：</h4>
<ul>
<li>使用 <code>..</code> 展开现有集合（如合并数组或列表）。</li>
</ul>
<h4 data-id="heading-9">类型推断：</h4>
<ul>
<li>自动推断目标集合类型，减少显式类型声明。</li>
</ul>
<h4 data-id="heading-10">多场景支持：</h4>
<ul>
<li>
<p>初始化集合、传递参数、返回结果。</p>
</li>
<li>
<p>支持 <code>LINQ</code>、异步操作和并发场景。</p>
</li>
</ul>
<h4 data-id="heading-11">与现有集合兼容：</h4>
<ul>
<li>无缝转换到 <code>IEnumerable&lt;T&gt;</code>、<code>ICollection&lt;T&gt;</code> 等。</li>
</ul>
<h3 data-id="heading-12">核心语法</h3>
<p>集合表达式使用 <code>[...]</code> 语法，支持以下形式：</p>
<ul>
<li>基本初始化：</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span>[] numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]; <span class="hljs-comment">// 等价于 new[] { 1, 2, 3 }</span>
List&lt;<span class="hljs-built_in">string</span>&gt; names = [<span class="hljs-string">"Alice"</span>, <span class="hljs-string">"Bob"</span>]; <span class="hljs-comment">// 等价于 new List&lt;string&gt; { "Alice", "Bob" }</span>
</code></pre>
<ul>
<li>扩展运算符（..）：</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span>[] moreNumbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, ..numbers, <span class="hljs-number">4</span>]; <span class="hljs-comment">// 展开 numbers，生成 [1, 2, 1, 2, 3, 4]</span>
</code></pre>
<ul>
<li>空集合：</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span>[] empty = []; <span class="hljs-comment">// 等价于 Array.Empty&lt;int&gt;()</span>
</code></pre>
<ul>
<li>嵌套集合：</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span>[][] jagged = [[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>]]; <span class="hljs-comment">// 锯齿状数组</span>
</code></pre>
<ul>
<li>字典初始化：</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp">Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">int</span>&gt; scores = [<span class="hljs-string">"Alice"</span>: <span class="hljs-number">90</span>, <span class="hljs-string">"Bob"</span>: <span class="hljs-number">85</span>]; <span class="hljs-comment">// 等价于 new Dictionary&lt;string, int&gt; { ["Alice"] = 90, ["Bob"] = 85 }</span>
</code></pre>
<ul>
<li>
<p>目标类型：</p>
<ul>
<li>
<p>支持 <code>IEnumerable&lt;T&gt;、ICollection&lt;T&gt;、List&lt;T&gt;、数组、Span&lt;T&gt;</code> 等。</p>
</li>
<li>
<p>编译器根据上下文推断类型：</p>
</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp">IEnumerable&lt;<span class="hljs-built_in">int</span>&gt; enumerable = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]; <span class="hljs-comment">// 推断为数组</span>
</code></pre>
</li>
<li>
<p>自定义集合支持</p>
</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CustomCollection</span>&lt;<span class="hljs-title">T</span>&gt; : <span class="hljs-title">IEnumerable</span>&lt;<span class="hljs-title">T</span>&gt;  
{  
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> List&lt;T&gt; _items = <span class="hljs-keyword">new</span>();  

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Add</span>(<span class="hljs-params">T item</span>)</span> =&gt; _items.Add(item);  

    <span class="hljs-function"><span class="hljs-keyword">public</span> IEnumerator&lt;T&gt; <span class="hljs-title">GetEnumerator</span>()</span> =&gt; _items.GetEnumerator();  
}  

<span class="hljs-comment">// 使用集合表达式初始化  </span>
CustomCollection&lt;<span class="hljs-built_in">string</span>&gt; tags = [<span class="hljs-string">"dotnet"</span>, <span class="hljs-string">"csharp"</span>];  
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis（142）Redis的Cluster的主从复制是如何实现的？]]></title>    <link>https://juejin.cn/post/7575363120799006720</link>    <guid>https://juejin.cn/post/7575363120799006720</guid>    <pubDate>2025-11-23T22:53:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575363120799006720" data-draft-id="7575413146922041359" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis（142）Redis的Cluster的主从复制是如何实现的？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-23T22:53:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis（142）Redis的Cluster的主从复制是如何实现的？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T22:53:17.000Z" title="Sun Nov 23 2025 22:53:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Redis Cluster 的主从复制机制作为其高可用性和数据一致性的关键组件，确保了在主节点发生故障时，系统能够自动切换到从节点以继续提供服务。主从复制的实现包括数据同步、心跳检测、故障检测及自动故障转移等步骤。下面我们详细解析这些步骤，并结合代码示例进行深入探讨。</p>
<h3 data-id="heading-0">1. 主从节点定义</h3>
<p>在 Redis 集群中，每个节点可以是主节点（Master）或从节点（Slave）。从节点实时复制主节点的数据。</p>
<h4 data-id="heading-1">代码示例</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">clusterNode</span> {</span>
    <span class="hljs-type">char</span> name[<span class="hljs-number">40</span>];      <span class="hljs-comment">/* Node ID */</span>
    <span class="hljs-type">int</span> flags;          <span class="hljs-comment">/* Node flags: master, slave, fail, etc. */</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">clusterNode</span> *<span class="hljs-title">slaveof</span>;</span> <span class="hljs-comment">/* Master of this node if it's a slave */</span>
    <span class="hljs-comment">// other fields...</span>
} clusterNode;

<span class="hljs-meta">#<span class="hljs-keyword">define</span> CLUSTER_NODE_MASTER 0x01</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> CLUSTER_NODE_SLAVE  0x02</span>
</code></pre>
<h3 data-id="heading-2">2. 数据同步</h3>
<p>当从节点启动或主节点发生变化时，从节点需要与其主节点进行数据同步。数据同步包括全量同步和增量同步。</p>
<h4 data-id="heading-3">代码示例</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">/* Function to initiate synchronization with master */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">syncWithMaster</span><span class="hljs-params">(clusterNode *slave, clusterNode *master)</span> {
    <span class="hljs-comment">// Send SYNC command to master</span>
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Sending SYNC command to master %s\n"</span>, master-&gt;name);

    <span class="hljs-comment">// In a real implementation, here we would send a SYNC message over the network</span>
    <span class="hljs-comment">// to the master node and wait for its response.</span>
}

<span class="hljs-comment">/* Example usage */</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    clusterNode master = {<span class="hljs-string">"master1"</span>, CLUSTER_NODE_MASTER, <span class="hljs-literal">NULL</span>};
    clusterNode slave = {<span class="hljs-string">"slave1"</span>, CLUSTER_NODE_SLAVE, &amp;master};

    syncWithMaster(&amp;slave, &amp;master);

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-4">3. 心跳检测</h3>
<p>主从节点之间会定期发送心跳消息，以确保节点之间的连接是活跃的，并且从节点可以及时知道主节点的状态。</p>
<h4 data-id="heading-5">代码示例</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;time.h&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">define</span> HEARTBEAT_INTERVAL 1000  <span class="hljs-comment">// 1 second</span></span>

<span class="hljs-comment">/* Function to send heartbeat message */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">sendHeartbeat</span><span class="hljs-params">(clusterNode *node)</span> {
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Sending heartbeat to node %s\n"</span>, node-&gt;name);
    <span class="hljs-comment">// In a real implementation, here we would send a PING message over the network.</span>
}

<span class="hljs-comment">/* Function to check for node failures based on heartbeat */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">checkHeartbeat</span><span class="hljs-params">(clusterNode *node)</span> {
    <span class="hljs-type">time_t</span> now = time(<span class="hljs-literal">NULL</span>);
    <span class="hljs-keyword">if</span> (now - node-&gt;last_heartbeat &gt; HEARTBEAT_INTERVAL) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Node %s is not responding\n"</span>, node-&gt;name);
        <span class="hljs-comment">// Mark node as failed</span>
        node-&gt;flags |= CLUSTER_NODE_FAIL;
    }
}

<span class="hljs-comment">/* Example usage */</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    clusterNode master = {<span class="hljs-string">"master1"</span>, CLUSTER_NODE_MASTER, <span class="hljs-literal">NULL</span>};
    master.last_heartbeat = time(<span class="hljs-literal">NULL</span>) - <span class="hljs-number">2</span>;  <span class="hljs-comment">// Simulate a delay in heartbeat</span>

    sendHeartbeat(&amp;master);
    checkHeartbeat(&amp;master);

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-6">4. 故障检测与故障转移</h3>
<p>当主节点被检测到故障时，从节点会自动接管主节点的角色。这包括选举新的主节点和更新集群状态。</p>
<h4 data-id="heading-7">代码示例</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">/* Function to handle failover */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">handleFailover</span><span class="hljs-params">(clusterNode *slave)</span> {
    <span class="hljs-keyword">if</span> (!(slave-&gt;flags &amp; CLUSTER_NODE_SLAVE)) <span class="hljs-keyword">return</span>;

    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Failover initiated by slave %s\n"</span>, slave-&gt;name);

    <span class="hljs-comment">// Promote the slave to master</span>
    slave-&gt;flags &amp;= ~CLUSTER_NODE_SLAVE;
    slave-&gt;flags |= CLUSTER_NODE_MASTER;

    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Slave %s promoted to master\n"</span>, slave-&gt;name);

    <span class="hljs-comment">// In a real implementation, we would also update the cluster state and notify other nodes.</span>
}

<span class="hljs-comment">/* Example usage */</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    clusterNode master = {<span class="hljs-string">"master1"</span>, CLUSTER_NODE_MASTER, <span class="hljs-literal">NULL</span>};
    clusterNode slave = {<span class="hljs-string">"slave1"</span>, CLUSTER_NODE_SLAVE, &amp;master};

    <span class="hljs-comment">// Simulate master failure</span>
    master.flags |= CLUSTER_NODE_FAIL;

    <span class="hljs-keyword">if</span> (master.flags &amp; CLUSTER_NODE_FAIL) {
        handleFailover(&amp;slave);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-8">综合示例</h3>
<p>以下是一个综合示例，展示了如何定义主从节点、进行数据同步、发送心跳检测以及处理故障转移。</p>
<h4 data-id="heading-9">综合代码示例</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;time.h&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">define</span> CLUSTER_NODE_MASTER 0x01</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> CLUSTER_NODE_SLAVE  0x02</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> CLUSTER_NODE_FAIL   0x04</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HEARTBEAT_INTERVAL  1000  <span class="hljs-comment">// 1 second</span></span>

<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">clusterNode</span> {</span>
    <span class="hljs-type">char</span> name[<span class="hljs-number">40</span>];      <span class="hljs-comment">/* Node ID */</span>
    <span class="hljs-type">int</span> flags;          <span class="hljs-comment">/* Node flags: master, slave, fail, etc. */</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">clusterNode</span> *<span class="hljs-title">slaveof</span>;</span> <span class="hljs-comment">/* Master of this node if it's a slave */</span>
    <span class="hljs-type">time_t</span> last_heartbeat; <span class="hljs-comment">/* Last time a heartbeat was received */</span>
} clusterNode;

<span class="hljs-comment">/* Function to initiate synchronization with master */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">syncWithMaster</span><span class="hljs-params">(clusterNode *slave, clusterNode *master)</span> {
    <span class="hljs-comment">// Send SYNC command to master</span>
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Sending SYNC command to master %s\n"</span>, master-&gt;name);

    <span class="hljs-comment">// In a real implementation, here we would send a SYNC message over the network</span>
    <span class="hljs-comment">// to the master node and wait for its response.</span>
}

<span class="hljs-comment">/* Function to send heartbeat message */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">sendHeartbeat</span><span class="hljs-params">(clusterNode *node)</span> {
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Sending heartbeat to node %s\n"</span>, node-&gt;name);
    <span class="hljs-comment">// In a real implementation, here we would send a PING message over the network.</span>
    node-&gt;last_heartbeat = time(<span class="hljs-literal">NULL</span>);
}

<span class="hljs-comment">/* Function to check for node failures based on heartbeat */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">checkHeartbeat</span><span class="hljs-params">(clusterNode *node)</span> {
    <span class="hljs-type">time_t</span> now = time(<span class="hljs-literal">NULL</span>);
    <span class="hljs-keyword">if</span> (now - node-&gt;last_heartbeat &gt; HEARTBEAT_INTERVAL) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Node %s is not responding\n"</span>, node-&gt;name);
        <span class="hljs-comment">// Mark node as failed</span>
        node-&gt;flags |= CLUSTER_NODE_FAIL;
    }
}

<span class="hljs-comment">/* Function to handle failover */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">handleFailover</span><span class="hljs-params">(clusterNode *slave)</span> {
    <span class="hljs-keyword">if</span> (!(slave-&gt;flags &amp; CLUSTER_NODE_SLAVE)) <span class="hljs-keyword">return</span>;

    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Failover initiated by slave %s\n"</span>, slave-&gt;name);

    <span class="hljs-comment">// Promote the slave to master</span>
    slave-&gt;flags &amp;= ~CLUSTER_NODE_SLAVE;
    slave-&gt;flags |= CLUSTER_NODE_MASTER;

    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Slave %s promoted to master\n"</span>, slave-&gt;name);

    <span class="hljs-comment">// In a real implementation, we would also update the cluster state and notify other nodes.</span>
}

<span class="hljs-comment">/* Example usage */</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    clusterNode master = {<span class="hljs-string">"master1"</span>, CLUSTER_NODE_MASTER, <span class="hljs-literal">NULL</span>, time(<span class="hljs-literal">NULL</span>)};
    clusterNode slave = {<span class="hljs-string">"slave1"</span>, CLUSTER_NODE_SLAVE, &amp;master, time(<span class="hljs-literal">NULL</span>)};

    <span class="hljs-comment">// Initial synchronization</span>
    syncWithMaster(&amp;slave, &amp;master);

    <span class="hljs-comment">// Periodically send heartbeat</span>
    sendHeartbeat(&amp;master);

    <span class="hljs-comment">// Simulate master failure</span>
    master.flags |= CLUSTER_NODE_FAIL;
    master.last_heartbeat = time(<span class="hljs-literal">NULL</span>) - <span class="hljs-number">2</span>;  <span class="hljs-comment">// Simulate a delay in heartbeat</span>

    <span class="hljs-comment">// Check heartbeat and handle failover if necessary</span>
    checkHeartbeat(&amp;master);
    <span class="hljs-keyword">if</span> (master.flags &amp; CLUSTER_NODE_FAIL) {
        handleFailover(&amp;slave);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>这个综合示例展示了 Redis Cluster 主从复制的主要组件和流程：数据同步、心跳检测和故障转移。实际的 Redis 实现会更加复杂，包括网络通信、数据一致性保证以及更多的状态管理，以上示例为简化版，用于解释基本原理。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis（143）Redis的Cluster的重新分片是如何实现的？]]></title>    <link>https://juejin.cn/post/7575112613778735138</link>    <guid>https://juejin.cn/post/7575112613778735138</guid>    <pubDate>2025-11-23T22:54:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575112613778735138" data-draft-id="7575112613778718754" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis（143）Redis的Cluster的重新分片是如何实现的？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-23T22:54:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis（143）Redis的Cluster的重新分片是如何实现的？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T22:54:01.000Z" title="Sun Nov 23 2025 22:54:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Redis Cluster 的重新分片（resharding）是指在集群中将哈希槽从一个节点迁移到另一个节点，以实现负载均衡或其他维护操作。重新分片的过程包括选择要迁移的槽、将槽的数据从源节点迁移到目标节点、更新集群状态等步骤。</p>
<h3 data-id="heading-0">重新分片的关键步骤</h3>
<ol>
<li><strong>选择要迁移的槽</strong>：决定哪些槽需要从源节点迁移到目标节点。</li>
<li><strong>迁移槽的数据</strong>：将槽的数据从源节点迁移到目标节点。</li>
<li><strong>更新集群状态</strong>：更新集群元数据，使其他节点知道槽的位置变化。</li>
</ol>
<h3 data-id="heading-1">详细实现步骤和代码示例</h3>
<h4 data-id="heading-2">1. 选择要迁移的槽</h4>
<p>首先，我们需要确定哪些槽需要迁移。这可以根据负载情况、节点容量等条件来决定。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">define</span> HASH_SLOTS 16384</span>

<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">clusterNode</span> {</span>
    <span class="hljs-type">char</span> name[<span class="hljs-number">40</span>];      <span class="hljs-comment">/* Node ID */</span>
    <span class="hljs-type">int</span> start_slot;     <span class="hljs-comment">/* Start hash slot */</span>
    <span class="hljs-type">int</span> end_slot;       <span class="hljs-comment">/* End hash slot */</span>
} clusterNode;

<span class="hljs-comment">/* Function to determine which slots to migrate */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">selectSlotsToMigrate</span><span class="hljs-params">(clusterNode *src, <span class="hljs-type">int</span> *slots_to_migrate, <span class="hljs-type">int</span> num_slots)</span> {
    <span class="hljs-type">int</span> index = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = src-&gt;start_slot; i &lt;= src-&gt;end_slot &amp;&amp; index &lt; num_slots; i++) {
        slots_to_migrate[index++] = i;
    }
}

<span class="hljs-comment">/* Example usage */</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    clusterNode src = {<span class="hljs-string">"source_node"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">5460</span>};
    <span class="hljs-type">int</span> slots_to_migrate[<span class="hljs-number">10</span>];
    selectSlotsToMigrate(&amp;src, slots_to_migrate, <span class="hljs-number">10</span>);

    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Slots to migrate: "</span>);
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d "</span>, slots_to_migrate[i]);
    }
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"\n"</span>);

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h4 data-id="heading-3">2. 迁移槽的数据</h4>
<p>迁移槽的数据涉及将槽中的键值对从源节点发送到目标节点。这需要通过网络通信来实现。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>

<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">clusterNode</span> {</span>
    <span class="hljs-type">char</span> name[<span class="hljs-number">40</span>];      <span class="hljs-comment">/* Node ID */</span>
    <span class="hljs-type">int</span> start_slot;     <span class="hljs-comment">/* Start hash slot */</span>
    <span class="hljs-type">int</span> end_slot;       <span class="hljs-comment">/* End hash slot */</span>
} clusterNode;

<span class="hljs-comment">/* Function to migrate a single slot's data */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">migrateSlotData</span><span class="hljs-params">(clusterNode *src, clusterNode *dst, <span class="hljs-type">int</span> slot)</span> {
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Migrating data for slot %d from node %s to node %s\n"</span>, slot, src-&gt;name, dst-&gt;name);
    <span class="hljs-comment">// In a real implementation, here you would send the data over the network from src to dst.</span>
}

<span class="hljs-comment">/* Example usage */</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    clusterNode src = {<span class="hljs-string">"source_node"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">5460</span>};
    clusterNode dst = {<span class="hljs-string">"destination_node"</span>, <span class="hljs-number">5461</span>, <span class="hljs-number">10921</span>};

    <span class="hljs-type">int</span> slots_to_migrate[<span class="hljs-number">10</span>] = {<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>};
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
        migrateSlotData(&amp;src, &amp;dst, slots_to_migrate[i]);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h4 data-id="heading-4">3. 更新集群状态</h4>
<p>一旦数据迁移完成，需要更新集群的元数据，使集群内的所有节点都知道槽的新位置。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>

<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">clusterNode</span> {</span>
    <span class="hljs-type">char</span> name[<span class="hljs-number">40</span>];      <span class="hljs-comment">/* Node ID */</span>
    <span class="hljs-type">int</span> start_slot;     <span class="hljs-comment">/* Start hash slot */</span>
    <span class="hljs-type">int</span> end_slot;       <span class="hljs-comment">/* End hash slot */</span>
} clusterNode;

<span class="hljs-comment">/* Function to update cluster state */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">updateClusterState</span><span class="hljs-params">(clusterNode *src, clusterNode *dst, <span class="hljs-type">int</span> *slots_to_migrate, <span class="hljs-type">int</span> num_slots)</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; num_slots; i++) {
        <span class="hljs-type">int</span> slot = slots_to_migrate[i];
        <span class="hljs-keyword">if</span> (slot &gt;= src-&gt;start_slot &amp;&amp; slot &lt;= src-&gt;end_slot) {
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Updating cluster state for slot %d: from node %s to node %s\n"</span>, slot, src-&gt;name, dst-&gt;name);
            <span class="hljs-comment">// Update the slot range in the source and destination nodes</span>
            <span class="hljs-keyword">if</span> (slot == src-&gt;start_slot) {
                src-&gt;start_slot++;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (slot == src-&gt;end_slot) {
                src-&gt;end_slot--;
            }
            <span class="hljs-comment">// Update destination node's slot range</span>
            <span class="hljs-keyword">if</span> (dst-&gt;start_slot == <span class="hljs-number">-1</span> &amp;&amp; dst-&gt;end_slot == <span class="hljs-number">-1</span>) {
                dst-&gt;start_slot = slot;
                dst-&gt;end_slot = slot;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">if</span> (slot &lt; dst-&gt;start_slot) {
                    dst-&gt;start_slot = slot;
                }
                <span class="hljs-keyword">if</span> (slot &gt; dst-&gt;end_slot) {
                    dst-&gt;end_slot = slot;
                }
            }
        }
    }
}

<span class="hljs-comment">/* Example usage */</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    clusterNode src = {<span class="hljs-string">"source_node"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">5460</span>};
    clusterNode dst = {<span class="hljs-string">"destination_node"</span>, <span class="hljs-number">5461</span>, <span class="hljs-number">10921</span>};

    <span class="hljs-type">int</span> slots_to_migrate[<span class="hljs-number">10</span>] = {<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>};
    updateClusterState(&amp;src, &amp;dst, slots_to_migrate, <span class="hljs-number">10</span>);

    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Source node %s: slots %d - %d\n"</span>, src.name, src.start_slot, src.end_slot);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Destination node %s: slots %d - %d\n"</span>, dst.name, dst.start_slot, dst.end_slot);

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-5">综合示例</h3>
<p>以下是一个完整的示例，展示了如何选择要迁移的槽、迁移槽的数据以及更新集群状态。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">define</span> HASH_SLOTS 16384</span>

<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">clusterNode</span> {</span>
    <span class="hljs-type">char</span> name[<span class="hljs-number">40</span>];      <span class="hljs-comment">/* Node ID */</span>
    <span class="hljs-type">int</span> start_slot;     <span class="hljs-comment">/* Start hash slot */</span>
    <span class="hljs-type">int</span> end_slot;       <span class="hljs-comment">/* End hash slot */</span>
} clusterNode;

<span class="hljs-comment">/* Function to determine which slots to migrate */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">selectSlotsToMigrate</span><span class="hljs-params">(clusterNode *src, <span class="hljs-type">int</span> *slots_to_migrate, <span class="hljs-type">int</span> num_slots)</span> {
    <span class="hljs-type">int</span> index = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = src-&gt;start_slot; i &lt;= src-&gt;end_slot &amp;&amp; index &lt; num_slots; i++) {
        slots_to_migrate[index++] = i;
    }
}

<span class="hljs-comment">/* Function to migrate a single slot's data */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">migrateSlotData</span><span class="hljs-params">(clusterNode *src, clusterNode *dst, <span class="hljs-type">int</span> slot)</span> {
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Migrating data for slot %d from node %s to node %s\n"</span>, slot, src-&gt;name, dst-&gt;name);
    <span class="hljs-comment">// In a real implementation, here you would send the data over the network from src to dst.</span>
}

<span class="hljs-comment">/* Function to update cluster state */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">updateClusterState</span><span class="hljs-params">(clusterNode *src, clusterNode *dst, <span class="hljs-type">int</span> *slots_to_migrate, <span class="hljs-type">int</span> num_slots)</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; num_slots; i++) {
        <span class="hljs-type">int</span> slot = slots_to_migrate[i];
        <span class="hljs-keyword">if</span> (slot &gt;= src-&gt;start_slot &amp;&amp; slot &lt;= src-&gt;end_slot) {
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Updating cluster state for slot %d: from node %s to node %s\n"</span>, slot, src-&gt;name, dst-&gt;name);
            <span class="hljs-comment">// Update the slot range in the source and destination nodes</span>
            <span class="hljs-keyword">if</span> (slot == src-&gt;start_slot) {
                src-&gt;start_slot++;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (slot == src-&gt;end_slot) {
                src-&gt;end_slot--;
            }
            <span class="hljs-comment">// Update destination node's slot range</span>
            <span class="hljs-keyword">if</span> (dst-&gt;start_slot == <span class="hljs-number">-1</span> &amp;&amp; dst-&gt;end_slot == <span class="hljs-number">-1</span>) {
                dst-&gt;start_slot = slot;
                dst-&gt;end_slot = slot;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">if</span> (slot &lt; dst-&gt;start_slot) {
                    dst-&gt;start_slot = slot;
                }
                <span class="hljs-keyword">if</span> (slot &gt; dst-&gt;end_slot) {
                    dst-&gt;end_slot = slot;
                }
            }
        }
    }
}

<span class="hljs-comment">/* Example usage */</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    clusterNode src = {<span class="hljs-string">"source_node"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">5460</span>};
    clusterNode dst = {<span class="hljs-string">"destination_node"</span>, <span class="hljs-number">5461</span>, <span class="hljs-number">10921</span>};

    <span class="hljs-type">int</span> slots_to_migrate[<span class="hljs-number">10</span>];
    selectSlotsToMigrate(&amp;src, slots_to_migrate, <span class="hljs-number">10</span>);

    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
        migrateSlotData(&amp;src, &amp;dst, slots_to_migrate[i]);
    }

    updateClusterState(&amp;src, &amp;dst, slots_to_migrate, <span class="hljs-number">10</span>);

    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Source node %s: slots %d - %d\n"</span>, src.name, src.start_slot, src.end_slot);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Destination node %s: slots %d - %d\n"</span>, dst.name, dst.start_slot, dst.end_slot);

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>这个完整的示例展示了 Redis Cluster 重新分片的基本流程，包括选择迁移的槽、迁移槽的数据以及更新集群状态。在实际的 Redis 实现中，这些操作会涉及网络通信和更多的错误处理逻辑，以确保数据的一致性和可靠性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【HarmonyOS 6】在UI控件上滑动也会触发onClick点击事件？]]></title>    <link>https://juejin.cn/post/7575413146921811983</link>    <guid>https://juejin.cn/post/7575413146921811983</guid>    <pubDate>2025-11-23T16:11:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575413146921811983" data-draft-id="7575363120798892032" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【HarmonyOS 6】在UI控件上滑动也会触发onClick点击事件？"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-11-23T16:11:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GeorgePanda"/> <meta itemprop="url" content="https://juejin.cn/user/1239904847930654"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【HarmonyOS 6】在UI控件上滑动也会触发onClick点击事件？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1239904847930654/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GeorgePanda
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T16:11:56.000Z" title="Sun Nov 23 2025 16:11:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">【HarmonyOS 6】在UI控件上滑动也会触发onClick点击事件？</h2>
<h2 data-id="heading-1">一、问题背景</h2>
<p>最近忙了几个月的HarmonyOS 6 AI项目已提测。测试老铁们和领导们疯狂的使用，提出了很多奇奇怪怪的问题。</p>
<p>如题所述，项目中有个全屏提示遮罩，背景设置了点击事件。点击后隐藏遮罩。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7c94c7b78c04ced9b4fb31d083abc54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR2VvcmdlUGFuZGE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764519115&amp;x-signature=o6nKU%2BF%2BaOXwNW0yfbI%2BfsbXemk%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>测试代码如下：</p>
<pre><code class="hljs language-typescript" lang="typescript">
<span class="hljs-comment">/**
 * 点击测试页面
 */</span>
<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">ClickTestPage</span> {

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">"提示文本123456"</span>)
        .<span class="hljs-title function_">fontSize</span>($r(<span class="hljs-string">'app.float.page_text_font_size'</span>))
        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)
    }
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)
    .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// 触发点击</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getPromptAction</span>().<span class="hljs-title function_">showToast</span>({
        <span class="hljs-attr">message</span>: <span class="hljs-string">"点击了！"</span>
      })
    })
    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>)
  }
}
</code></pre>
<p>领导们体验时发现，在UI控件上滑动也会触发onClick点击事件，关闭提示遮罩。</p>
<p>按照我的定位思路，因为只有onclick触发了隐藏操作，所以加了日志去复现，发现果然如此。就把bug划分到非问题栏里了。</p>
<p>后来项目内技术大佬发现，该问题可解，由此产生本文解答。</p>
<p>自我检讨，对于问题的敏感性和探索性有所降低，需要警惕！</p>
<h2 data-id="heading-2">二、解决方案：</h2>
<p>因为onClick点击事件是组件被点击时触发的事件，因此滑动后抬起手指也会触发onClick事件。</p>
<p>不过从API12，新增distanceThreshold参数，设置点击手势移动阈值。手指移动超出阈值时，点击手势识别失败。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83fc50be8d2c4c659d99ba11357967c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR2VvcmdlUGFuZGE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764519115&amp;x-signature=2ZUK8IKAGKAC6bQklGHnM8Bh8x0%3D" alt="在这里插入图片描述" loading="lazy"/>
<strong>比起传统onclick事件，多了一个参数，可以设置移动阈值distanceThreshold。</strong></p>
<p>当点击事件，设置了移动阈值distanceThreshold。当设置的值小于等于0时，会被转化为默认值。默认值：2^31-1，单位：vp。</p>
<p>当手指的移动距离超出开发者预设的移动阈值时，点击识别失败。如果初始化为默认阈值时，手指移动超过组件热区范围，点击识别失败。</p>
<p>话说API12版本还是太权威了，去年居然没有注意到这些细节！！！</p>
<p>所以该问题如下修改测试代码即可:</p>
<pre><code class="hljs language-typescript" lang="typescript">
<span class="hljs-comment">/**
 * 点击测试页面
 */</span>
<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">ClickTestPage</span> {

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">"提示文本123456"</span>)
        .<span class="hljs-title function_">fontSize</span>($r(<span class="hljs-string">'app.float.page_text_font_size'</span>))
        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)
    }
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)
    .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// 触发点击</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getPromptAction</span>().<span class="hljs-title function_">showToast</span>({
        <span class="hljs-attr">message</span>: <span class="hljs-string">"点击了！"</span>
      })
      <span class="hljs-comment">// 设置移动阈值distanceThreshol为1</span>
    },<span class="hljs-number">1</span>)
    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>)
  }
}
</code></pre>
<p>onClick事件中增加distanceThreshold参数，将阈值设置为一个极小值1，当手指的移动距离超出预设的移动阈值时，点击识别失败，即不触发点击事件。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C#/.NET/.NET Core技术前沿周刊 | 第 62 期（2025年11.17-11.23）]]></title>    <link>https://juejin.cn/post/7575468252656549929</link>    <guid>https://juejin.cn/post/7575468252656549929</guid>    <pubDate>2025-11-23T16:57:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575468252656549929" data-draft-id="7575458028255199275" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C#/.NET/.NET Core技术前沿周刊 | 第 62 期（2025年11.17-11.23）"/> <meta itemprop="keywords" content="后端,.NET"/> <meta itemprop="datePublished" content="2025-11-23T16:57:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="追逐时光者"/> <meta itemprop="url" content="https://juejin.cn/user/2770425031690333"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C#/.NET/.NET Core技术前沿周刊 | 第 62 期（2025年11.17-11.23）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2770425031690333/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    追逐时光者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T16:57:24.000Z" title="Sun Nov 23 2025 16:57:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5b85cb096624ab891f08bf1747d1407~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764521844&amp;x-signature=Zr%2FruMjduUBAWpR1QmVYIpGikjI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">前言</h2>
<p>C#/.NET/.NET Core技术前沿周刊，你的每周技术指南针！记录、追踪C#/.NET/.NET Core领域、生态的每周最新、最实用、最有价值的技术文章、社区动态、优质项目和学习资源等。让你时刻站在技术前沿，助力技术成长与视野拓宽。</p>
<blockquote>
<p>欢迎投稿、推荐或自荐优质文章、项目、学习资源等。</p>
</blockquote>
<ul>
<li><strong>🏆技术前沿周刊Gitee开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fysgdaydayup%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetWeekly.md" target="_blank" title="https://gitee.com/ysgdaydayup/DotNetGuide/blob/main/docs/DotNet/DotNetWeekly.md" ref="nofollow noopener noreferrer">gitee.com/ysgdaydayup…</a></li>
<li><strong>📰技术前沿周刊GitHub开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYSGStudyHards%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetWeekly.md" target="_blank" title="https://github.com/YSGStudyHards/DotNetGuide/blob/main/docs/DotNet/DotNetWeekly.md" ref="nofollow noopener noreferrer">github.com/YSGStudyHar…</a></li>
<li><strong>👪DotNetGuide技术社区：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Frq-_dMpdLltPxvOdihl0UA" target="_blank" title="https://mp.weixin.qq.com/s/rq-_dMpdLltPxvOdihl0UA" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/rq-_dMpdL…</a></li>
</ul>
<h2 data-id="heading-1">更多议题来袭｜.NET Conf China 2025 大会日程即将公布！</h2>
<ul>
<li><strong>文章简介：</strong> 改变世界，改变自己——第七届 .NET 中国峰会 .NET Conf China 2025 将于 11月30日 在上海举办。本次大会将聚焦性能跃升、AI 融合、跨平台开发三大核心方向，为开发者提供实战洞见与未来视野，推动开源技术和社区协作的发展。通过一系列精彩的主题演讲、技术分享，我们希望与与会者共同探讨如何在现代开发中充分利用 .NET 的强大功能，提升开发效率与应用性能。</li>
<li><strong>文章地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FznvU3Sxq-lfL_uL9U9f5SQ" target="_blank" title="https://mp.weixin.qq.com/s/znvU3Sxq-lfL_uL9U9f5SQ" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/znvU3Sxq-…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e4e978482684bb48b9a26de548e99a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764521844&amp;x-signature=LuPYe5Xi46tTuCtKb9IRaAVmLbA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">深圳 .NET 初中高级岗位内推</h2>
<ul>
<li><strong>文章简介：</strong> C#/.NET/.NET Core开发者人才招聘专栏，本专栏致力于汇聚最新的C#/.NET/.NET Core相关岗位招聘信息，为C#/.NET/.NET Core技术爱好者、开发者及企业搭建一个高效、精准的招聘与求职平台。我们深知，在快速发展的技术领域中，优秀的人才是企业最宝贵的资源。因此，我们精心筛选并展示来自各行各业的C#/.NET/.NET Core岗位，旨在帮助求职者找到最适合自己的发展机会，同时助力企业吸引并留住顶尖技术人才。</li>
<li><strong>文章地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fe-4pYf7J6O9iMZhAR4fHcQ" target="_blank" title="https://mp.weixin.qq.com/s/e-4pYf7J6O9iMZhAR4fHcQ" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/e-4pYf7J6…</a></li>
</ul>
<h2 data-id="heading-3">快速构建一个基础、现代化的 WinForm 管理系统！</h2>
<ul>
<li><strong>文章简介：</strong> 前段时间有小伙伴在后台留言问：有没有好用的 WinForm 管理系统?今天大姚给大家分享一个基于 AntdUI 构建的 WinForm 管理系统，不需要我们写一行代码既能快速构建一个基础、现代化的 WinForm 管理系统。</li>
<li><strong>文章地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FVTBcoZZ2mNyuyV_s4fzsPA" target="_blank" title="https://mp.weixin.qq.com/s/VTBcoZZ2mNyuyV_s4fzsPA" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/VTBcoZZ2m…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06fdf61928b742c9918c384554f03869~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764521844&amp;x-signature=CwV41%2BGlSW%2B1H%2B1GuJBn8zIub90%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d0b54661bc34e58a09897cd3fbbe6d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764521844&amp;x-signature=KYaR2%2BHCS2PWZSrihPu9S3n0ITM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">用 GitHub Copilot Testing for .NET 提升你的测试覆盖率</h2>
<ul>
<li><strong>文章简介：</strong> 今天我们很高兴地宣布，GitHub Copilot 的 .NET 测试现已在 Visual Studio Insiders 中提供。这一新功能将 AI 驱动的单元测试生成直接带入你的开发流程，帮助你在几次点击内从零覆盖到测试信心。</li>
<li><strong>文章地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fdevblogs.microsoft.com%2Fdotnet%2Fgithub-copilot-testing-for-dotnet%2F" target="_blank" title="https://devblogs.microsoft.com/dotnet/github-copilot-testing-for-dotnet/" ref="nofollow noopener noreferrer">devblogs.microsoft.com/dotnet/gith…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/426fb5b25f994778823d7fc1ba6b1cef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764521844&amp;x-signature=9ddR5LZbPhkCq4lMoFewM8Y3F8g%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">再次重塑 .NET 的构建和发布方式</h2>
<ul>
<li><strong>文章简介：</strong> 在我写完上一篇关于.NET 如何构建和发布的文章后，我谨慎乐观地认为自己不会再写一篇。或者至少不会再写一篇关于我们如何建造和运输的文章。这个问题已经解决了。.NET 做到了！我们在分布式仓库开发和快速编写产品以便发货之间取得了平衡。恭喜大家，现在基础设施团队可以专注于其他事情了。安全性、跨公司标准化、支持构建新功能。所有的好东西。</li>
<li><strong>文章地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fdevblogs.microsoft.com%2Fdotnet%2Freinventing-how-dotnet-builds-and-ships-again%2F" target="_blank" title="https://devblogs.microsoft.com/dotnet/reinventing-how-dotnet-builds-and-ships-again/" ref="nofollow noopener noreferrer">devblogs.microsoft.com/dotnet/rein…</a></li>
</ul>
<h2 data-id="heading-6">使用 GitHub Copilot 代理模式现代化 .NET 应用的逐步指南</h2>
<ul>
<li><strong>文章简介：</strong> 升级一个旧的.NET 应用不必非得去追逐破损的构建和隐晦的错误。然而对许多开发者来说，简单的版本提升往往会变成数小时的依赖冲突和手动修复。现代化不仅仅是保持潮流。旧框架可能带来安全风险、性能缓慢，并阻碍云的采用。升级解锁了现代 API、更好的工具以及云原生功能，如自动扩展和安全身份管理。</li>
<li><strong>文章地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fdevblogs.microsoft.com%2Fdotnet%2Fmodernizing-dotnet-with-github-copilot-agent-mode%2F" target="_blank" title="https://devblogs.microsoft.com/dotnet/modernizing-dotnet-with-github-copilot-agent-mode/" ref="nofollow noopener noreferrer">devblogs.microsoft.com/dotnet/mode…</a></li>
</ul>
<h2 data-id="heading-7">介绍 C# 14</h2>
<ul>
<li><strong>文章简介：</strong> C# 14 自带 .NET 10。亮点是新增的扩展成员，但还有更多功能让你作为开发者的工作更加高效。此外，我们还增加了新功能，使你能够实现.NET 10 中一些性能提升。继续阅读，了解所有新功能，并找到链接，深入了解并立即开始使用这些功能。</li>
<li><strong>文章地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fdevblogs.microsoft.com%2Fdotnet%2Fintroducing-csharp-14%2F" target="_blank" title="https://devblogs.microsoft.com/dotnet/introducing-csharp-14/" ref="nofollow noopener noreferrer">devblogs.microsoft.com/dotnet/intr…</a></li>
</ul>
<h2 data-id="heading-8">一款基于 .NET + 计算机视觉技术开源免费、功能强大的原神智能辅助工具，一键解放双手！</h2>
<ul>
<li><strong>文章简介：</strong> better-genshin-impact 是一款基于 .NET + 计算机视觉技术完全开源免费（GPL-3.0 license）、功能强大的原神智能辅助自动化工具，意图让原神变的更好的项目，包含：自动剧情、全自动钓鱼(AI)、全自动七圣召唤、自动伐木、自动刷本、自动采集/挖矿/锄地等功能。</li>
<li><strong>文章地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FwZ4d9baOO2RXsb6VCdSxHQ" target="_blank" title="https://mp.weixin.qq.com/s/wZ4d9baOO2RXsb6VCdSxHQ" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/wZ4d9baOO…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6e2ae5f18e54e7fb36341d73f48bc96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764521844&amp;x-signature=g977OOWVgkj9jx%2BnDnd68npaWsg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">从零开始: c#纯代码实现完整Json解析器的全过程及注释与自定义格式的支持实现</h2>
<ul>
<li><strong>文章简介：</strong> 我们要深入探讨一个非常常用的技术：JSON反序列化。别小看这个技术，它可是现代编程中不可或缺的一部。JSON解析不仅仅是简单的数据转换，它还涉及到复杂的词法分析和文法解析。这些技术是编译器设计的基础，但这不是我们今天要深入探讨的内容。</li>
<li><strong>文章地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FbiQK9mv10oK-vFw1N01bcg" target="_blank" title="https://mp.weixin.qq.com/s/biQK9mv10oK-vFw1N01bcg" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/biQK9mv10…</a></li>
</ul>
<h2 data-id="heading-10">精选 5 款 .NET 开源、实用的商城系统（Shop），快速商城二开利器！</h2>
<ul>
<li><strong>文章简介：</strong> 今天大姚给大家分享 5 款基于 .NET 开源、实用的商城系统（Shop），快速商城二开利器！希望可以帮助到有商城系统开发需求的同学。</li>
<li><strong>文章地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FjmACitN34VgTdy6ByDetvg" target="_blank" title="https://mp.weixin.qq.com/s/jmACitN34VgTdy6ByDetvg" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/jmACitN34…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a69929f042954aa094fc1dc39f082866~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764521844&amp;x-signature=AZn91IFVep25yH0TVUkU4axf79k%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/488fd0844a9443e483c8cdec0e7acaa0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764521844&amp;x-signature=mM5xeHx%2BOhmESZNlM%2Fiy4tcwbWM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-11">高效.NET编程实战：5个提升性能与可维护性的核心技巧</h2>
<ul>
<li><strong>文章简介：</strong> 在本文中，我们将介绍5个实用技巧，这些技巧可能不常被讨论，但能在实际项目中产生显著差异。这些不是华而不实的技巧；而是经验丰富的工程师悄悄使用的那种小而深思熟虑的更改，以保持其应用程序的精简和可预测性。</li>
<li><strong>文章地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fe9HptlxdZQPkCBlDC7hnCQ" target="_blank" title="https://mp.weixin.qq.com/s/e9HptlxdZQPkCBlDC7hnCQ" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/e9HptlxdZ…</a></li>
</ul>
<h2 data-id="heading-12">一款基于 .NET 开源免费、简单实用的数据库文档生成工具</h2>
<ul>
<li><strong>文章简介：</strong> DBCHM 是一款简单且实用的数据库文档生成工具，支持多种主流数据库，包括 SqlServer、MySQL、Oracle、PostgreSQL、DB2、SQLite 等，并能够导出多种格式的文档，如 CHM、Word、Excel、PDF、HTML、XML、Markdown 等。</li>
<li><strong>文章地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FnRSBj1i1qNuv0-ob4QDmow" target="_blank" title="https://mp.weixin.qq.com/s/nRSBj1i1qNuv0-ob4QDmow" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/nRSBj1i1q…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b1f9d2981a7a4932a1fcca49b1be9f00~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764521844&amp;x-signature=F7hBjV8Ci%2FYRfCYa7zi6yNUxWvA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-13"><code>Span&lt;T&gt;</code> 和 <code>Memory&lt;T&gt;</code> 到底该用哪个？一句话讲清楚</h2>
<ul>
<li><strong>文章简介：</strong> 上一篇文章《C#中的Span是啥？看完这篇你就懂了》介绍了Span使用，虽然 <code>Span&lt;T&gt;</code> 是处理连续内存的高性能方式，但它有个“硬伤”——它只能活在栈上（stack-only）。那问题来了：当你需要在更复杂的场景中使用“可切片、零拷贝”的结构时，怎么办？答案就是：Memory和 ReadOnlyMemory。</li>
<li><strong>文章地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FcFZS-yRoGxjyCgJQfOH3Fw" target="_blank" title="https://mp.weixin.qq.com/s/cFZS-yRoGxjyCgJQfOH3Fw" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/cFZS-yRoG…</a></li>
</ul>
<h2 data-id="heading-14">Serilog 日志库简单实践（三）集中式日志与分析平台 Sinks（.net8）</h2>
<ul>
<li><strong>文章简介：</strong> 本文继续对各种类型的 Sink 进行简单的实践，主题是集中式日志与分析平台 Sinks，供参考。</li>
<li><strong>文章地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fhnzhengfy%2Fp%2F19188548%2FSerilog_AnalysisPlantform" target="_blank" title="https://www.cnblogs.com/hnzhengfy/p/19188548/Serilog_AnalysisPlantform" ref="nofollow noopener noreferrer">www.cnblogs.com/hnzhengfy/p…</a></li>
</ul>
<h2 data-id="heading-15">使用.NET 8+ 与飞书API构建组织架构同步服务</h2>
<ul>
<li><strong>文章简介：</strong> 在现代企业数字化转型中，典型的.NET技术栈（如ASP.NET Core MVC/Web API, Entity Framework Core, SQL Server）构建的内部管理系统扮演着核心角色。这些系统承载着企业的关键业务流程，从人力资源管理到权限控制，从财务审批到业务数据分析。然而，一个普遍存在的痛点是：员工信息在飞书和自建.NET系统间存在严重的数据不一致问题。当新员工入职时，HR在飞书中录入信息，但各个.NET系统仍需手动重复录入；当员工离职或转岗时，权限更新往往滞后，存在安全隐患；部门架构调整时，各系统的数据更新更是不同步，导致报表统计不准确。</li>
<li><strong>文章地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fmudtools%2Fp%2F19255641" target="_blank" title="https://www.cnblogs.com/mudtools/p/19255641" ref="nofollow noopener noreferrer">www.cnblogs.com/mudtools/p/…</a></li>
</ul>
<h2 data-id="heading-16">C# 14 新功能全面解析：提升生产力与性能的革命性更新</h2>
<ul>
<li><strong>文章简介：</strong> C# 语言作为.NET生态的核心，始终致力于提升开发者的生产力与应用程序性能。C# 14带来了多项突破性特性，包括扩展成员、字段关键词、空条件赋值等，这些改进显著减少了样板代码，增强了类型系统的灵活性。本文将深入解析这些新功能的设计原理、应用场景及实际价值，帮助开发者快速掌握C# 14的核心优势。</li>
<li><strong>文章地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fpowertoolsteam%2Fp%2F19237152" target="_blank" title="https://www.cnblogs.com/powertoolsteam/p/19237152" ref="nofollow noopener noreferrer">www.cnblogs.com/powertoolst…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android模拟器检测全面指南：从基础到高级策略]]></title>    <link>https://juejin.cn/post/7575162322240880640</link>    <guid>https://juejin.cn/post/7575162322240880640</guid>    <pubDate>2025-11-23T17:01:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575162322240880640" data-draft-id="7575413146921861135" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android模拟器检测全面指南：从基础到高级策略"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-11-23T17:01:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="陆业聪"/> <meta itemprop="url" content="https://juejin.cn/user/13629904404157"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android模拟器检测全面指南：从基础到高级策略
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/13629904404157/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    陆业聪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T17:01:32.000Z" title="Sun Nov 23 2025 17:01:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、核心检测维度与方法</h2>
<p>检测Android模拟器的核心思路是识别其与真实设备在<strong>硬件、系统属性和行为特征</strong>上的差异。以下是经过实践验证的有效方法。</p>
<h3 data-id="heading-1">1.1 检查系统构建属性</h3>
<p>模拟器的<code>android.os.Build</code>类中的属性值通常包含特定标识符，这是最基础的检测方式。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isProbablyEmulator</span><span class="hljs-params">()</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">model</span> <span class="hljs-operator">=</span> Build.MODEL.toLowerCase();
    <span class="hljs-type">String</span> <span class="hljs-variable">manufacturer</span> <span class="hljs-operator">=</span> Build.MANUFACTURER.toLowerCase();
    <span class="hljs-type">String</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> Build.PRODUCT.toLowerCase();
    <span class="hljs-type">String</span> <span class="hljs-variable">fingerprint</span> <span class="hljs-operator">=</span> Build.FINGERPRINT.toLowerCase();
    <span class="hljs-type">String</span> <span class="hljs-variable">brand</span> <span class="hljs-operator">=</span> Build.BRAND.toLowerCase();
    <span class="hljs-type">String</span> <span class="hljs-variable">hardware</span> <span class="hljs-operator">=</span> Build.HARDWARE.toLowerCase();
    <span class="hljs-type">String</span> <span class="hljs-variable">device</span> <span class="hljs-operator">=</span> Build.DEVICE.toLowerCase();

    <span class="hljs-keyword">return</span> (model.contains(<span class="hljs-string">"google_sdk"</span>) ||
            model.contains(<span class="hljs-string">"droid4x"</span>) ||
            model.contains(<span class="hljs-string">"emulator"</span>) ||
            model.contains(<span class="hljs-string">"android sdk built for x86"</span>) ||
            manufacturer.contains(<span class="hljs-string">"genymotion"</span>) ||
            product.contains(<span class="hljs-string">"sdk_google"</span>) ||
            product.contains(<span class="hljs-string">"google_sdk"</span>) ||
            product.contains(<span class="hljs-string">"sdk"</span>) ||
            product.contains(<span class="hljs-string">"sdk_x86"</span>) ||
            product.contains(<span class="hljs-string">"vbox86p"</span>) ||
            product.contains(<span class="hljs-string">"emulator"</span>) ||
            fingerprint.contains(<span class="hljs-string">"generic"</span>) ||
            fingerprint.contains(<span class="hljs-string">"generic/sdk/generic"</span>) ||
            fingerprint.contains(<span class="hljs-string">"sdk_gphone"</span>) ||
            fingerprint.contains(<span class="hljs-string">"google/sdk_gphone"</span>) ||
            fingerprint.contains(<span class="hljs-string">"test-keys"</span>) ||
            brand.contains(<span class="hljs-string">"generic"</span>) ||
            hardware.contains(<span class="hljs-string">"goldfish"</span>) || <span class="hljs-comment">// 传统模拟器硬件</span>
            hardware.contains(<span class="hljs-string">"ranchu"</span>) ||   <span class="hljs-comment">// 较新模拟器硬件</span>
            device.contains(<span class="hljs-string">"generic"</span>));
}
</code></pre>
<p><strong>关键系统属性检查点</strong>：</p>
<ul>
<li><strong>ro.hardware</strong>：模拟器通常返回"goldfish"或"ranchu"</li>
<li><strong>ro.kernel.qemu</strong>：模拟器中常返回"1"，真机通常为空</li>
<li><strong>ro.product.model</strong>：Android模拟器通常为"sdk"或"google_sdk"</li>
</ul>
<h3 data-id="heading-2">1.2 检查特定系统文件与属性</h3>
<p>模拟器环境中存在真机没有的特殊文件和系统属性。</p>
<p><strong>通过反射读取系统属性</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getSystemProperty</span><span class="hljs-params">(String key)</span> {
    <span class="hljs-keyword">try</span> {
        Class&lt;?&gt; systemPropertyClass = Class.forName(<span class="hljs-string">"android.os.SystemProperties"</span>);
        <span class="hljs-keyword">return</span> (String) systemPropertyClass.getMethod(<span class="hljs-string">"get"</span>, String.class).invoke(<span class="hljs-literal">null</span>, key);
    } <span class="hljs-keyword">catch</span> (Exception e) {
        e.printStackTrace();
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isEmulatorByProperties</span><span class="hljs-params">()</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">hardware</span> <span class="hljs-operator">=</span> getSystemProperty(<span class="hljs-string">"ro.hardware"</span>);
    <span class="hljs-type">String</span> <span class="hljs-variable">kernelQemu</span> <span class="hljs-operator">=</span> getSystemProperty(<span class="hljs-string">"ro.kernel.qemu"</span>);
    <span class="hljs-type">String</span> <span class="hljs-variable">hardwarePlatform</span> <span class="hljs-operator">=</span> getSystemProperty(<span class="hljs-string">"ro.boot.hardware.platform"</span>);

    <span class="hljs-keyword">return</span> <span class="hljs-string">"goldfish"</span>.equals(hardware) ||
           <span class="hljs-string">"ranchu"</span>.equals(hardware) ||
           <span class="hljs-string">"1"</span>.equals(kernelQemu) ||
           (hardwarePlatform != <span class="hljs-literal">null</span> &amp;&amp; hardwarePlatform.contains(<span class="hljs-string">"sdk"</span>));
}
</code></pre>
<p><strong>模拟器特有文件检测</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String[] known_files = {
    <span class="hljs-string">"/system/lib/libc_malloc_debug_qemu.so"</span>,
    <span class="hljs-string">"/sys/qemu_trace"</span>, 
    <span class="hljs-string">"/system/bin/qemu-props"</span>,
    <span class="hljs-string">"/dev/socket/qemud"</span>,
    <span class="hljs-string">"/dev/qemu_pipe"</span>
};

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasQEmuFiles</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">for</span>(String filePath : known_files) {
        <span class="hljs-type">File</span> <span class="hljs-variable">targetFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(filePath);
        <span class="hljs-keyword">if</span> (targetFile.exists()) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<h3 data-id="heading-3">1.3 检查硬件与传感器信息</h3>
<p>模拟器通常无法完美模拟所有硬件特性，这为检测提供了多个切入点。</p>
<p><strong>传感器检测</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 检查光传感器是否存在</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Boolean <span class="hljs-title function_">notHasLightSensorManager</span><span class="hljs-params">(Context context)</span> {
    <span class="hljs-type">SensorManager</span> <span class="hljs-variable">sensorManager</span> <span class="hljs-operator">=</span> (SensorManager) context.getSystemService(SENSOR_SERVICE);
    <span class="hljs-type">Sensor</span> <span class="hljs-variable">lightSensor</span> <span class="hljs-operator">=</span> sensorManager.getDefaultSensor(Sensor.TYPE_LIGHT);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span> == lightSensor;
}
</code></pre>
<p><strong>基带与电话状态检查</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkByTelephony</span><span class="hljs-params">(Context context)</span> {
    <span class="hljs-type">TelephonyManager</span> <span class="hljs-variable">tm</span> <span class="hljs-operator">=</span> (TelephonyManager) context.getSystemService(Context.TELEPHONY_SERVICE);
    <span class="hljs-type">String</span> <span class="hljs-variable">imei</span> <span class="hljs-operator">=</span> tm.getDeviceId();
    <span class="hljs-type">String</span> <span class="hljs-variable">networkOperator</span> <span class="hljs-operator">=</span> tm.getNetworkOperatorName();
    
    <span class="hljs-comment">// 模拟器IMEI通常为000000000000000，网络运营商为"Android"</span>
    <span class="hljs-keyword">return</span> (imei != <span class="hljs-literal">null</span> &amp;&amp; imei.equals(<span class="hljs-string">"000000000000000"</span>)) || 
           <span class="hljs-string">"android"</span>.equalsIgnoreCase(networkOperator);
}
</code></pre>
<p><strong>蓝牙检测</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">notHasBlueTooth</span><span class="hljs-params">()</span> {
    <span class="hljs-type">BluetoothAdapter</span> <span class="hljs-variable">ba</span> <span class="hljs-operator">=</span> BluetoothAdapter.getDefaultAdapter();
    <span class="hljs-keyword">if</span> (ba == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 如果有蓝牙但名称为空，可能是模拟器</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> ba.getName();
        <span class="hljs-keyword">return</span> TextUtils.isEmpty(name);
    }
}
</code></pre>
<h3 data-id="heading-4">1.4 检查CPU架构与信息</h3>
<p>模拟器通常运行在x86/x86_64架构的PC上，而真机多为ARM架构。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">readCpuInfo</span><span class="hljs-params">()</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-string">""</span>;
    <span class="hljs-keyword">try</span> {
        String[] args = {<span class="hljs-string">"/system/bin/cat"</span>, <span class="hljs-string">"/proc/cpuinfo"</span>};
        <span class="hljs-type">ProcessBuilder</span> <span class="hljs-variable">cmd</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProcessBuilder</span>(args);
        <span class="hljs-type">Process</span> <span class="hljs-variable">process</span> <span class="hljs-operator">=</span> cmd.start();
        <span class="hljs-type">StringBuffer</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuffer</span>();
        <span class="hljs-type">String</span> <span class="hljs-variable">readLine</span> <span class="hljs-operator">=</span> <span class="hljs-string">""</span>;
        <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">responseReader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(process.getInputStream(), <span class="hljs-string">"utf-8"</span>));
        <span class="hljs-keyword">while</span> ((readLine = responseReader.readLine()) != <span class="hljs-literal">null</span>) {
            sb.append(readLine);
        }
        responseReader.close();
        result = sb.toString().toLowerCase();
    } <span class="hljs-keyword">catch</span> (IOException ex) {
        <span class="hljs-comment">// 处理异常</span>
    }
    <span class="hljs-keyword">return</span> result;
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkByCpuInfo</span><span class="hljs-params">()</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">cpuInfo</span> <span class="hljs-operator">=</span> readCpuInfo();
    <span class="hljs-keyword">return</span> (cpuInfo.contains(<span class="hljs-string">"intel"</span>) || cpuInfo.contains(<span class="hljs-string">"amd"</span>));
}
</code></pre>
<h3 data-id="heading-5">1.5 电池状态检测</h3>
<p>模拟器的电池信息通常保持不变，而真机的电池状态会动态变化。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkBatteryStats</span><span class="hljs-params">(Context context)</span> {
    <span class="hljs-type">IntentFilter</span> <span class="hljs-variable">filter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntentFilter</span>(Intent.ACTION_BATTERY_CHANGED);
    <span class="hljs-type">Intent</span> <span class="hljs-variable">batteryStatus</span> <span class="hljs-operator">=</span> context.registerReceiver(<span class="hljs-literal">null</span>, filter);
    
    <span class="hljs-keyword">if</span> (batteryStatus == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    
    <span class="hljs-type">int</span> <span class="hljs-variable">level</span> <span class="hljs-operator">=</span> batteryStatus.getIntExtra(BatteryManager.EXTRA_LEVEL, -<span class="hljs-number">1</span>);
    <span class="hljs-type">int</span> <span class="hljs-variable">scale</span> <span class="hljs-operator">=</span> batteryStatus.getIntExtra(BatteryManager.EXTRA_SCALE, -<span class="hljs-number">1</span>);
    <span class="hljs-type">int</span> <span class="hljs-variable">temperature</span> <span class="hljs-operator">=</span> batteryStatus.getIntExtra(BatteryManager.EXTRA_TEMPERATURE, -<span class="hljs-number">1</span>);
    
    <span class="hljs-comment">// 模拟器电池电量通常固定，温度常为0</span>
    <span class="hljs-keyword">return</span> (temperature == <span class="hljs-number">0</span> || (level &gt;= <span class="hljs-number">0</span> &amp;&amp; scale &gt; <span class="hljs-number">0</span> &amp;&amp; level == scale));
}
</code></pre>
<h2 data-id="heading-6">二、高级检测技术</h2>
<h3 data-id="heading-7">2.1 基于Cache行为的检测</h3>
<p>利用ARM与x86架构的缓存差异进行检测：</p>
<ul>
<li><strong>ARM架构</strong>：使用哈佛架构，指令缓存(I-Cache)和数据缓存(D-Cache)分离</li>
<li><strong>x86架构</strong>：使用冯·诺依曼结构，指令和数据共享缓存</li>
</ul>
<p>这种方法能准确识别底层架构，但需要编写汇编代码，兼容性需要考虑。</p>
<h3 data-id="heading-8">2.2 基带信息检测</h3>
<p>基带是手机的基本通信模块，模拟器通常没有真实的基带信息：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkBaseband</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">try</span> {
        Class&lt;?&gt; systemPropertyClass = Class.forName(<span class="hljs-string">"android.os.SystemProperties"</span>);
        <span class="hljs-type">Method</span> <span class="hljs-variable">getMethod</span> <span class="hljs-operator">=</span> systemPropertyClass.getMethod(<span class="hljs-string">"get"</span>, String.class);
        <span class="hljs-type">String</span> <span class="hljs-variable">baseband</span> <span class="hljs-operator">=</span> (String) getMethod.invoke(<span class="hljs-literal">null</span>, <span class="hljs-string">"gsm.version.baseband"</span>);
        <span class="hljs-keyword">return</span> (baseband == <span class="hljs-literal">null</span> || baseband.isEmpty());
    } <span class="hljs-keyword">catch</span> (Exception e) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<h3 data-id="heading-9">2.3 处理器信息一致性检查</h3>
<p>检测<code>ro.product.board</code>和<code>ro.board.platform</code>是否一致：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">checkProcessorConsistency</span><span class="hljs-params">()</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">suspectCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-type">String</span> <span class="hljs-variable">productBoard</span> <span class="hljs-operator">=</span> getSystemProperty(<span class="hljs-string">"ro.product.board"</span>);
    <span class="hljs-type">String</span> <span class="hljs-variable">boardPlatform</span> <span class="hljs-operator">=</span> getSystemProperty(<span class="hljs-string">"ro.board.platform"</span>);
    
    <span class="hljs-keyword">if</span> (productBoard == <span class="hljs-literal">null</span> || <span class="hljs-string">""</span>.equals(productBoard)) suspectCount++;
    <span class="hljs-keyword">if</span> (boardPlatform == <span class="hljs-literal">null</span> || <span class="hljs-string">""</span>.equals(boardPlatform)) suspectCount++;
    <span class="hljs-keyword">if</span> (productBoard != <span class="hljs-literal">null</span> &amp;&amp; boardPlatform != <span class="hljs-literal">null</span> &amp;&amp; 
        !productBoard.equals(boardPlatform)) suspectCount++;
    
    <span class="hljs-keyword">return</span> suspectCount;
}
</code></pre>
<h2 data-id="heading-10">三、集成检测策略与建议</h2>
<h3 data-id="heading-11">3.1 综合评分策略</h3>
<p>不要依赖单一检测方法，应采用<strong>多维度综合评分</strong>系统：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmulatorDetector</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">THRESHOLD</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>; <span class="hljs-comment">// 阈值可根据需求调整</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isRunningOnEmulator</span><span class="hljs-params">(Context context)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">suspectScore</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        
        <span class="hljs-comment">// 系统属性检查</span>
        <span class="hljs-keyword">if</span> (checkBuildProperties()) suspectScore += <span class="hljs-number">2</span>;
        
        <span class="hljs-comment">// 文件检查</span>
        <span class="hljs-keyword">if</span> (hasQEmuFiles()) suspectScore += <span class="hljs-number">2</span>;
        
        <span class="hljs-comment">// 硬件检查</span>
        <span class="hljs-keyword">if</span> (checkByTelephony(context)) suspectScore += <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (notHasLightSensorManager(context)) suspectScore += <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (checkByCpuInfo()) suspectScore += <span class="hljs-number">2</span>;
        
        <span class="hljs-comment">// 电池状态检查</span>
        <span class="hljs-keyword">if</span> (checkBatteryStats(context)) suspectScore += <span class="hljs-number">1</span>;
        
        <span class="hljs-keyword">return</span> suspectScore &gt;= THRESHOLD;
    }
}
</code></pre>
<h3 data-id="heading-12">3.2 特定模拟器检测</h3>
<p>针对常见模拟器（如BlueStacks）的专项检测：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String[] known_bluestacks = {
    <span class="hljs-string">"/data/app/com.bluestacks.appmart-1.apk"</span>,
    <span class="hljs-string">"/data/app/com.bluestacks.BstCommandProcessor-1.apk"</span>, 
    <span class="hljs-string">"/data/app/com.bluestacks.help-1.apk"</span>,
    <span class="hljs-string">"/data/bluestacks.prop"</span>
};

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkBlueStacksFiles</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">for</span> (String filePath : known_bluestacks) {
        <span class="hljs-type">File</span> <span class="hljs-variable">targetFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(filePath);
        <span class="hljs-keyword">if</span> (targetFile.exists()) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<h2 data-id="heading-13">四、重要注意事项</h2>
<h3 data-id="heading-14">4.1 权限与隐私合规</h3>
<p>部分检测方法需要申请权限：</p>
<ul>
<li><code>READ_PHONE_STATE</code>：用于读取IMEI、IMSI等设备标识</li>
<li><code>ACCESS_WIFI_STATE</code>：用于获取MAC地址信息</li>
<li><code>BLUETOOTH</code>：用于蓝牙检测</li>
</ul>
<p>确保遵循Google Play的隐私政策及相关法律法规（如GDPR）。</p>
<h3 data-id="heading-15">4.2 性能与兼容性考虑</h3>
<ul>
<li><strong>避免过度检测</strong>：检测逻辑应高效，不影响应用性能</li>
<li><strong>真机兼容性</strong>：在所有目标真机上充分测试，避免误判</li>
<li><strong>及时更新</strong>：模拟器技术不断进化，检测方法需定期更新</li>
</ul>
<h3 data-id="heading-16">4.3 服务端验证</h3>
<p>对于高安全性要求的应用，建议将关键检测逻辑放在服务端：</p>
<ul>
<li>防止客户端代码被篡改</li>
<li>动态更新检测规则</li>
<li>结合设备指纹技术</li>
</ul>
<h2 data-id="heading-17">五、总结</h2>
<p>Android模拟器检测是一场持续的"攻防战"。有效检测需要<strong>多维度、多方法结合</strong>，没有单一方法能100%准确识别所有模拟器。建议根据具体应用场景和安全要求，选择合适的检测方法组合，并建立综合评分机制。</p>
<p><strong>核心建议</strong>：</p>
<ol>
<li>优先使用系统属性检查等轻量级方法</li>
<li>结合文件检查、硬件信息验证等多维度检测</li>
<li>对高安全性场景，考虑使用专业设备指纹SDK</li>
<li>定期更新检测策略以应对新型模拟器</li>
</ol>
<p>通过系统化的检测方案，可以有效识别大多数模拟器环境，提升应用安全性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【HarmonyOS 6】为什么getContext 废弃，使用getHostContext说明]]></title>    <link>https://juejin.cn/post/7575413146921631759</link>    <guid>https://juejin.cn/post/7575413146921631759</guid>    <pubDate>2025-11-23T15:16:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575413146921631759" data-draft-id="7575807729722802210" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【HarmonyOS 6】为什么getContext 废弃，使用getHostContext说明"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-11-23T15:16:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GeorgePanda"/> <meta itemprop="url" content="https://juejin.cn/user/1239904847930654"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【HarmonyOS 6】为什么getContext 废弃，使用getHostContext说明
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1239904847930654/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GeorgePanda
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T15:16:06.000Z" title="Sun Nov 23 2025 15:16:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">【HarmonyOS 6】为什么getContext 废弃，使用getHostContext说明</h2>
<h3 data-id="heading-1">一、问题背景：为什么要替换 getContext？</h3>
<p>最近这几个月在做HarmonyOS 6的新项目。从搭建项目框架，查看官方文档之初，就发现了一个非常有意思的点。发现获取上下文的写法又变了，第一瞬间，就对新旧两种写法有何区别产生了好奇。</p>
<pre><code class="hljs language-typescript" lang="typescript">    <span class="hljs-comment">// 新</span>
    <span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: <span class="hljs-title class_">Context</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>();
    <span class="hljs-comment">// 旧</span>
    <span class="hljs-keyword">const</span> context = <span class="hljs-title function_">getContext</span>(<span class="hljs-variable language_">this</span>) <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;
</code></pre>
<p>我还特意在官方社区起了个话题。结果无人讨论。今天有时间就深入研究了下，发现官网有做出解释，但是给的理由太抽象了。这就是本文的由来，主要做详细的原因解释。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a93768b467524cbb8cc90de5fc62d0f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR2VvcmdlUGFuZGE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764515766&amp;x-signature=ewmTFqjQhEai1RqPPz2FcH80J74%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<pre><code class="hljs language-typescript" lang="typescript">官网原因解释参见以下链接：
<span class="hljs-attr">https</span>:<span class="hljs-comment">//developer.huawei.com/consumer/cn/doc/architecture-guides/tools-v1_2-ts_309-0000002443435465#section14148187125815</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a65ea236efc4bebaca873c6726a5b2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR2VvcmdlUGFuZGE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764515766&amp;x-signature=8hoffoniqZrR0xU%2F98Ra6grOTxw%3D" alt="在这里插入图片描述" loading="lazy"/>
好家伙，差点给我绕进去。QAQ</p>
<h3 data-id="heading-2">二、getContext废弃的原因：</h3>
<p>废话不多说。查阅最新的官方文档，大家可以发现getContext方法从API version 18开始废弃，官方文档建议使用UIContext中的getHostContext替代。</p>
<p>其实从从API version 12开始，就可以通过使用UIContext中的getHostContext来获取UI的执行上下文。只是当时大家都没有太在意，因为getContext还没有提示过时。</p>
<h4 data-id="heading-3">返回值类型是关键差异</h4>
<p>根据getContext的使用习惯，很多开发者惯性的使用断言。这是导致编译报错的核心原因，必须重点关注：
<strong>1、旧方法 getContext：返回类型为 Context（非空）</strong><br/>
所以直接断言为 UIAbilityContext`不会有类型冲突。</p>
<p><strong>2、新方法 getHostContext：返回类型为 Context | undefined</strong><br/>
当组件未依附于有效 UIAbility 时，会返回 undefined。如果还像以前一样直接注解为 Context，编译器会提示“类型不兼容”。（“Type 'Context | undefined' is not assignable to type 'Context'”  ）</p>
<p>原来getContext的使用方式，某些情况下返回的上下文是错误的。最新的getHostContext进行了除了，当错误时，返回的是undefined。</p>
<p>至于为什么不直接改动原来的接口getContext来修复这个问题。那是因为很多既有的项目已经直接使用断言的方式获取上下文了。如果直接修改老接口，会导致老项目编译大面积报错。</p>
<h4 data-id="heading-4">废弃原因拆解：</h4>
<p>综上所述，在getContext 方法被废弃的核心原因源于其设计缺陷与鸿蒙系统架构演进的不兼容性，具体可归结为以下几方面：</p>
<p><strong>1、其首要问题是作用域的不稳定性</strong>
该方法通过组件实例直接获取上下文却无法动态跟踪 Ability 生命周期变化，例如在异步回调（如网络请求、定时器）中若页面已销毁，getContext 可能返回 undefined 导致空指针异常，跨页面跳转时旧上下文未及时释放还可能引发内存泄漏或权限校验错误，在折叠屏设备展开 / 折叠等 UI 容器动态调整场景中，更是无法感知新容器上下文而导致 UI 渲染异常。</p>
<p><strong>2、其次是类型安全层面的设计缺陷</strong>
getContext 返回通用 Context 类型，需开发者手动强制类型转换（如let context = getContext(this) as UIAbilityContext），若实际类型不匹配会引发运行时崩溃，而替代方案 getHostContext 通过 UIContext 明确返回与当前 UI 绑定的具体上下文类型，无需手动转换且编译时即可发现类型错误；</p>
<p><strong>3、从架构演进来看，getContext 作为全局方法与组件强耦合</strong>
难以适配分布式场景下的多设备协同，而 UIContext 体系通过分层设计将上下文管理抽象为独立模块，先通过this.getUIContext()获取当前 UI 的上下文容器，再由 getHostContext 从容器中提取上下文，确保作用域严格隔离，还能支持多线程渲染、跨设备协同等复杂场景（如分屏模式下不同区域 UI 可独立管理上下文）；</p>
<p>4、从官方标准化迁移来看，API 18 前 getContext 虽为推荐方法但已逐渐暴露缺陷，API 18 + 后被明确标记为废弃并推荐迁移至 UIContext 体系，且计划在未来版本完全移除，这一迁移还能带来性能优化（实测上下文查找运行时开销降低约 15%）和维护成本下降的优势，有效解决旧 API 导致的代码碎片化问题；</p>
<p>5、最后，随着鸿蒙支持折叠屏、多屏协同等多元设备形态，传统上下文管理模式已无法满足动态布局需求，而 getHostContext 通过 UIContext 可在折叠屏展开时自动切换至新窗口上下文，在应用从手机流转至平板时同步更新设备参数（如分辨率、DPI），完美适配新设备场景的使用需求。</p>
<h3 data-id="heading-5">二、getHostContext使用说明：</h3>
<h4 data-id="heading-6">场景1：组件内获取（最常用）</h4>
<p>适合在页面组件、自定义组件中获取上下文，需配合类型收窄处理空值：</p>
<pre><code class="hljs language-typescript" lang="typescript">
<span class="hljs-comment">// 1. 获取上下文（不直接注解类型，利用TS类型推断）</span>
<span class="hljs-keyword">const</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>();

<span class="hljs-comment">// 2. 类型收窄，确保上下文非空</span>
<span class="hljs-keyword">if</span> (context) {
  <span class="hljs-comment">// 3. 断言为 UIAbilityContext（如需调用startAbility等特有方法）</span>
  <span class="hljs-keyword">const</span> uiAbilityContext = context <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;
  <span class="hljs-comment">// 4. 安全使用上下文</span>
  uiAbilityContext.<span class="hljs-title function_">startAbility</span>({
    <span class="hljs-attr">bundleName</span>: <span class="hljs-string">'com.example.myapp'</span>,
    <span class="hljs-attr">abilityName</span>: <span class="hljs-string">'SecondAbility'</span>
  });
} <span class="hljs-keyword">else</span> {
  <span class="hljs-comment">// 5. 异常处理：上下文获取失败</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'获取宿主上下文失败，请检查组件是否已挂载'</span>);
}
</code></pre>
<h4 data-id="heading-7">场景2：非UI场景获取（如工具类）</h4>
<p>如果在工具类、服务等非UI环境中，无法通过 <code>getUIContext</code> 获取，可通过缓存方式获取：</p>
<ol>
<li>在 EntryAbility 初始化时缓存 Context：</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AppStorage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos/ui'</span>;
<span class="hljs-keyword">import</span> common <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.app.ability.common'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {
  <span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-comment">// 缓存 UIAbility 的 Context 到 AppStorage</span>
    <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'appContext'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>);
  }
}
</code></pre>
<ol start="2">
<li>在需要的地方读取缓存：</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AppStorage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos/ui'</span>;
<span class="hljs-keyword">import</span> common <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.app.ability.common'</span>;

<span class="hljs-comment">// 从缓存获取并断言类型</span>
<span class="hljs-keyword">const</span> context = <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'appContext'</span>) <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;
<span class="hljs-keyword">if</span> (context) {
  <span class="hljs-comment">// 后续使用...</span>
}
</code></pre>
<p>在非UI场景（如工具类），可通过AppStorageV2或windowStage.getMainWindow()间接获取UIContext</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[适合iOS开发的一种缓存策略YYCache库 的原理]]></title>    <link>https://juejin.cn/post/7575458028255117355</link>    <guid>https://juejin.cn/post/7575458028255117355</guid>    <pubDate>2025-11-23T15:21:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575458028255117355" data-draft-id="7575468252656402473" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="适合iOS开发的一种缓存策略YYCache库 的原理"/> <meta itemprop="keywords" content="架构,算法"/> <meta itemprop="datePublished" content="2025-11-23T15:21:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="sweet丶"/> <meta itemprop="url" content="https://juejin.cn/user/3227821869921646"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            适合iOS开发的一种缓存策略YYCache库 的原理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3227821869921646/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    sweet丶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T15:21:34.000Z" title="Sun Nov 23 2025 15:21:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>YYCache 是 iOS 上一个高性能的缓存框架，它由内存缓存 <code>YYMemoryCache</code> 和磁盘缓存 <code>YYDiskCache</code> 两部分组成。</p>
<h3 data-id="heading-0">核心总览</h3>
<p>YYCache 的核心设计目标是 <strong>高效、线程安全和高性能</strong>。它通过以下方式实现这一目标：</p>
<ol>
<li><strong>分层设计</strong>：内存缓存提供极速访问，磁盘缓存提供大容量存储。</li>
<li><strong>LRU 淘汰算法</strong>：两者都使用 LRU 算法来管理缓存项，确保高频数据留在缓存中。</li>
<li><strong>数据结构优化</strong>：
<ul>
<li><strong>内存缓存</strong>：结合 <code>NSDictionary</code> 和双向链表。</li>
<li><strong>磁盘缓存</strong>：结合 SQLite 和文件系统。</li>
</ul>
</li>
<li><strong>锁策略优化</strong>：使用 <code>pthread_mutex</code> 锁来保证线程安全，性能优于 <code>@synchronized</code> 和 <code>dispatch_semaphore</code>。</li>
</ol>
<hr/>
<p>为了更直观地理解其核心工作原理，我们可以用以下流程图来展示其数据结构和关键操作：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/684526c654234774ab3e476047583279~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3dlZXTkuLY=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764516094&amp;x-signature=S84ltNx4q8Cye7CF44vTvtZ%2FX8Q%3D" alt="image.png" loading="lazy"/></p>
<p>上图揭示了YYCache的核心架构，下面我们来详细拆解图中各个部分的工作原理。</p>
<h3 data-id="heading-1">一、YYMemoryCache (内存缓存) 原理</h3>
<p><code>YYMemoryCache</code> 使用了一种非常经典且高效的数据结构组合：<strong>双向链表 + 哈希表</strong>。</p>
<h4 data-id="heading-2">1. 核心数据结构：<code>_YYLinkedMapNode</code> 和 <code>_YYLinkedMap</code></h4>
<ul>
<li><code>_YYLinkedMapNode</code>：链表节点。
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">_YYLinkedMapNode</span> : <span class="hljs-title">NSObject</span> </span>{
    <span class="hljs-keyword">@package</span>
    __<span class="hljs-keyword">unsafe_unretained</span> _YYLinkedMapNode *_prev; <span class="hljs-comment">// 指向上一节点</span>
    __<span class="hljs-keyword">unsafe_unretained</span> _YYLinkedMapNode *_next; <span class="hljs-comment">// 指向下一节点</span>
    <span class="hljs-type">id</span> _key;      <span class="hljs-comment">// 缓存的键</span>
    <span class="hljs-type">id</span> _value;    <span class="hljs-comment">// 缓存的值</span>
    <span class="hljs-built_in">NSUInteger</span> _cost;   <span class="hljs-comment">// 开销成本（用于成本计算）</span>
    <span class="hljs-built_in">NSTimeInterval</span> _time; <span class="hljs-comment">// 访问时间</span>
}
<span class="hljs-keyword">@end</span>
</code></pre>
</li>
<li><code>_YYLinkedMap</code>：一个双向链表，用于管理所有节点。
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">_YYLinkedMap</span> : <span class="hljs-title">NSObject</span> </span>{
    <span class="hljs-keyword">@package</span>
    <span class="hljs-built_in">CFMutableDictionaryRef</span> _dic; <span class="hljs-comment">// 哈希表，用于O(1)的存取</span>
    <span class="hljs-built_in">NSUInteger</span> _totalCost;      <span class="hljs-comment">// 总开销</span>
    <span class="hljs-built_in">NSUInteger</span> _totalCount;     <span class="hljs-comment">// 总数量</span>
    _YYLinkedMapNode *_head;    <span class="hljs-comment">// 链表头（MRU，最近使用）</span>
    _YYLinkedMapNode *_tail;    <span class="hljs-comment">// 链表尾（LRU，最久未使用）</span>
}
<span class="hljs-keyword">@end</span>
</code></pre>
</li>
</ul>
<h4 data-id="heading-3">2. 工作原理</h4>
<p><strong>存取过程与LRU管理</strong></p>
<p>其工作流程可以精确地描述为以下步骤：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant A as Client（客户端）
    participant M as YYMemoryCache
    participant D as _dic (哈希表)
    participant L as 双向链表

    A-&gt;&gt;M: setObject:forKey:
    M-&gt;&gt;D: 通过key查找节点
    alt 节点已存在
        M-&gt;&gt;L: 更新节点value，将节点移至_head
    else 节点不存在
        M-&gt;&gt;M: 创建新节点
        M-&gt;&gt;D: 插入新节点
        M-&gt;&gt;L: 将新节点插入至_head
        M-&gt;&gt;M: _totalCount++, _totalCost++
        loop 超过限制（count/cost）
            M-&gt;&gt;L: 移除_tail节点（LRU）
            M-&gt;&gt;D: 删除对应key
            M-&gt;&gt;M: 更新_totalCount, _totalCost
        end
    end

    A-&gt;&gt;M: objectForKey:
    M-&gt;&gt;D: 通过key查找节点
    alt 节点存在
        M-&gt;&gt;L: 将节点移至_head
        M-&gt;&gt;A: 返回value
    else 节点不存在
        M-&gt;&gt;A: 返回nil
    end
</code></pre>
<p><strong>线程安全</strong>：
<code>YYMemoryCache</code> 使用 <code>pthread_mutex</code> 锁来保证上述所有操作（<code>_dic</code> 的读写、链表的修改）的线程安全性。它在每个操作开始时加锁，结束时解锁。</p>
<hr/>
<h3 data-id="heading-4">二、YYDiskCache (磁盘缓存) 原理</h3>
<p><code>YYDiskCache</code> 的设计更为复杂，它采用了一种<strong>智能的混合存储策略</strong>，根据 value 的大小选择不同的存储方式，以在性能和空间之间取得平衡。</p>
<h4 data-id="heading-5">1. 核心思想：SQLite + 文件系统</h4>
<ul>
<li>
<p><strong>SQLite 数据库</strong>：</p>
<ul>
<li>存储所有的 <strong>元数据</strong>（key, 文件名，大小，访问时间等）。</li>
<li>如果 value 很小（例如小于 16KB），<strong>直接将其作为 BLOB 数据存储在数据库的某一列中</strong>。</li>
<li>优势：对于小数据，读写非常快，并且数据库事务保证了操作的原子性。</li>
<li>方便实现 <strong>LRU 淘汰算法</strong>，只需要通过 SQL 语句操作元数据即可。</li>
</ul>
</li>
<li>
<p><strong>文件系统</strong>：</p>
<ul>
<li>如果 value 很大（例如大于 16KB），则将其<strong>写入单独的文件</strong>，在数据库中只记录其文件名和路径。</li>
<li>优势：避免大文件塞满 SQLite 数据库，导致性能下降。文件系统对于大文件的读写效率更高。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-6">2. 工作流程</h4>
<p><strong>存储过程：</strong></p>
<ol>
<li>根据 <code>key</code> 在数据库中查询记录。</li>
<li>判断 <code>value</code> 的数据大小。</li>
<li><strong>小数据</strong>：直接写入 SQLite 的 <code>data</code> 列。如果之前是文件存储，则删除对应的文件。</li>
<li><strong>大数据</strong>：将数据写入一个文件，并在数据库的 <code>filename</code> 列记录文件名。如果之前 SQLite 的 <code>data</code> 列有数据，则清空。</li>
<li>更新数据库中的元信息（大小、访问时间等）。</li>
</ol>
<p><strong>读取过程：</strong></p>
<ol>
<li>根据 <code>key</code> 从数据库中查询记录。</li>
<li>如果记录中有文件名（<code>filename</code> 不为空），则从文件系统中读取该文件。</li>
<li>如果记录中没有文件名，则直接从数据库的 <code>data</code> 列读取数据。</li>
<li><strong>更新访问时间</strong>：每次读取后，都会在数据库中更新该记录的 <code>last_access_time</code> 字段，这对于实现 LRU 至关重要。</li>
</ol>
<p><strong>淘汰机制：</strong></p>
<ol>
<li>当磁盘缓存的总大小或总数量超过限制时，触发清理。</li>
<li>通过一条 SQL 查询，按照 <code>last_access_time</code> 升序排列（最久未使用的在前），获取需要淘汰的项。</li>
<li>根据查询结果，如果该项有文件，则删除文件；最后，从数据库中删除该记录。</li>
</ol>
<h3 data-id="heading-7">三、YYCache 的整体协作</h3>
<ol>
<li>
<p><strong>写入缓存</strong>：</p>
<ul>
<li>先写入 <code>YYMemoryCache</code>。</li>
<li>再异步写入 <code>YYDiskCache</code>。</li>
</ul>
</li>
<li>
<p><strong>读取缓存</strong>：</p>
<ul>
<li>首先在 <code>YYMemoryCache</code> 中查找，找到则返回并更新链表。</li>
<li>如果内存中没有，则去 <code>YYDiskCache</code> 中查找。</li>
<li>如果在磁盘中找到，则将其返回给用户，并<strong>根据需要</strong>（可配置）写回 <code>YYMemoryCache</code>，以便下次快速访问。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-8">总结</h3>








































<table><thead><tr><th align="left">特性</th><th align="left">YYMemoryCache</th><th align="left">YYDiskCache</th></tr></thead><tbody><tr><td align="left"><strong>存储介质</strong></td><td align="left">内存</td><td align="left">磁盘 (SQLite + 文件系统)</td></tr><tr><td align="left"><strong>数据结构</strong></td><td align="left">双向链表 + 哈希表</td><td align="left">数据库表 + 文件</td></tr><tr><td align="left"><strong>线程安全</strong></td><td align="left"><code>pthread_mutex</code></td><td align="left">串行队列 + <code>dispatch_semaphore</code></td></tr><tr><td align="left"><strong>淘汰算法</strong></td><td align="left">LRU (链表移动)</td><td align="left">LRU (SQL 按时间排序)</td></tr><tr><td align="left"><strong>性能</strong></td><td align="left">极快，O(1)</td><td align="left">较快，对小数据优化好</td></tr><tr><td align="left"><strong>容量</strong></td><td align="left">受内存限制</td><td align="left">受磁盘空间限制</td></tr></tbody></table>
<p>YYCache 的成功在于其对经典算法和数据结构的深刻理解，并结合 iOS 平台特性进行了精妙的工程优化，使其成为了一个非常出色和可靠的缓存组件。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[openstack 中的二层网络跟三层网络范围对比]]></title>    <link>https://juejin.cn/post/7575367791273181222</link>    <guid>https://juejin.cn/post/7575367791273181222</guid>    <pubDate>2025-11-23T14:13:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575367791273181222" data-draft-id="7575119254314385434" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="openstack 中的二层网络跟三层网络范围对比"/> <meta itemprop="keywords" content="OpenStack"/> <meta itemprop="datePublished" content="2025-11-23T14:13:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            openstack 中的二层网络跟三层网络范围对比
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T14:13:46.000Z" title="Sun Nov 23 2025 14:13:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>是的，<strong>三层通信（L3）的范围确实比二层通信（L2）更大</strong>。这是计算机网络体系结构中的一个基本原理，也是为什么现代大规模网络（包括数据中心、云计算、互联网）必须依赖三层路由的原因。</p>
<p>下面从多个维度详细解释为什么 <strong>三层通信范围更大</strong>：</p>
<hr/>
<h2 data-id="heading-0">一、核心区别：作用域不同</h2>




















<table><thead><tr><th>层级</th><th>通信范围</th><th>关键限制</th></tr></thead><tbody><tr><td><strong>二层（L2）</strong></td><td><strong>广播域内</strong>（同一子网/VLAN）</td><td>❌ 无法跨越路由器；依赖 MAC 地址；广播风暴风险</td></tr><tr><td><strong>三层（L3）</strong></td><td><strong>全球可达</strong>（只要 IP 路由可达）</td><td>✅ 可跨子网、跨 VLAN、跨地域、跨互联网</td></tr></tbody></table>
<blockquote>
<p>🌐 <strong>简单说</strong>：</p>
<ul>
<li>L2 是“本地小区内喊话”（靠广播找人）</li>
<li>L3 是“全球寄信”（靠地址+邮局路由）</li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-1">二、技术机制对比</h2>
<h3 data-id="heading-2">1. <strong>寻址方式</strong></h3>
<ul>
<li>
<p><strong>L2</strong>：使用 <strong>MAC 地址</strong>（48 位，如 <code>52:54:00:f6:f2:55</code>）</p>
<ul>
<li>MAC 地址只在<strong>本地链路有效</strong></li>
<li>跨设备后，帧会被重新封装，源/目的 MAC 改变</li>
</ul>
</li>
<li>
<p><strong>L3</strong>：使用 <strong>IP 地址</strong>（如 <code>192.168.1.10</code> 或 <code>2001:db8::1</code>）</p>
<ul>
<li>IP 地址具有<strong>全局（或逻辑）唯一性</strong></li>
<li>端到端不变（除非 NAT），路由器根据 IP 查路由表转发</li>
</ul>
</li>
</ul>
<h3 data-id="heading-3">2. <strong>转发设备</strong></h3>
<ul>
<li>
<p><strong>L2 转发</strong>：交换机（Switch）</p>
<ul>
<li>查 <strong>MAC 地址表（FDB）</strong></li>
<li>不认识的目标 → <strong>广播</strong>（泛洪）</li>
<li><strong>不会跨路由器</strong></li>
</ul>
</li>
<li>
<p><strong>L3 转发</strong>：路由器（Router）或三层交换机</p>
<ul>
<li>查 <strong>路由表（Routing Table）</strong></li>
<li>根据最长前缀匹配决定下一跳</li>
<li>可连接不同广播域、不同物理网络</li>
</ul>
</li>
</ul>
<h3 data-id="heading-4">3. <strong>广播 vs 路由</strong></h3>
<ul>
<li>
<p>L2 依赖 <strong>ARP 广播</strong> 解析 IP→MAC：</p>
<pre><code class="hljs">Who has 192.168.1.20? Tell 192.168.1.10
</code></pre>
<p>→ 广播只在本地有效，<strong>路由器不转发广播包</strong></p>
</li>
<li>
<p>L3 使用 <strong>路由协议</strong>（静态路由、OSPF、BGP 等）构建路径 → 可实现跨城市、跨国家通信</p>
</li>
</ul>
<hr/>
<h2 data-id="heading-5">三、实际场景举例</h2>
<h3 data-id="heading-6">场景 1：同一办公室</h3>
<ul>
<li>两台电脑在同一 VLAN（192.168.1.0/24）</li>
<li>通信走 L2：直接通过交换机，速度快、延迟低 ✅</li>
</ul>
<h3 data-id="heading-7">场景 2：跨部门（不同子网）</h3>
<ul>
<li>财务部：192.168.10.0/24</li>
<li>研发部：192.168.20.0/24</li>
<li>必须通过 <strong>路由器</strong> 转发 → L3 通信 ✅</li>
</ul>
<h3 data-id="heading-8">场景 3：访问百度</h3>
<ul>
<li>你的电脑 IP：192.168.1.10</li>
<li>百度服务器 IP：220.181.38.148</li>
<li>中间经过：家庭路由器 → 运营商骨干网 → BGP 路由 → 百度 IDC</li>
<li>全程 <strong>L3 路由</strong>，跨越成百上千个网络 ✅</li>
</ul>
<blockquote>
<p>❌ 如果只用 L2，你连隔壁公司的电脑都 ping 不通！</p>
</blockquote>
<hr/>
<h2 data-id="heading-9">四、在 OpenStack / 云环境中的体现</h2>




















<table><thead><tr><th>通信类型</th><th>实现方式</th><th>范围</th></tr></thead><tbody><tr><td><strong>L2 通信</strong></td><td>同一 Neutron Network 内的 VM</td><td>仅限该虚拟广播域（如一个 VXLAN）</td></tr><tr><td><strong>L3 通信</strong></td><td>通过 Neutron Router 连接不同 Subnet</td><td>可跨 Network、跨租户（策略允许下）、访问公网</td></tr></tbody></table>
<blockquote>
<p>🔸 即使两个 VM 在同一物理主机上，<strong>如果属于不同 Subnet</strong>，也必须走 L3（Router）通信。</p>
</blockquote>
<hr/>
<h2 data-id="heading-10">五、为什么不能全用 L3？为什么不全用 L2？</h2>

















<table><thead><tr><th>方案</th><th>问题</th></tr></thead><tbody><tr><td><strong>全 L2 网络</strong></td><td>广播域过大 → 广播风暴、ARP 表爆炸、安全隔离难（“大二层”仅用于特定场景如金融交易）</td></tr><tr><td><strong>全 L3 网络</strong></td><td>同一子网内通信效率略低（需查路由），但现代硬件已优化</td></tr></tbody></table>
<p>✅ <strong>最佳实践</strong>：</p>
<ul>
<li><strong>小范围用 L2</strong>（高性能、低延迟）</li>
<li><strong>大范围用 L3</strong>（可扩展、易管理、安全隔离）</li>
</ul>
<hr/>
<h2 data-id="heading-11">六、总结</h2>



































<table><thead><tr><th>对比项</th><th>二层通信（L2）</th><th>三层通信（L3）</th></tr></thead><tbody><tr><td><strong>范围</strong></td><td>有限（一个广播域）</td><td>无限（全球 IP 可达）</td></tr><tr><td><strong>设备</strong></td><td>交换机</td><td>路由器</td></tr><tr><td><strong>地址</strong></td><td>MAC 地址</td><td>IP 地址</td></tr><tr><td><strong>扩展性</strong></td><td>差（受广播域限制）</td><td>极强（互联网基础）</td></tr><tr><td><strong>OpenStack 中</strong></td><td>同一 Network 内 VM 互访</td><td>跨 Subnet、Floating IP、外网访问</td></tr></tbody></table>
<blockquote>
<p>✅ <strong>结论：三层通信的范围远大于二层通信，是构建大规模网络的基石。</strong></p>
</blockquote>
<p>理解这一点，就理解了为什么 OpenStack 需要 Neutron Router，也理解了互联网为何能连接数十亿设备 🌍✨</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[跨界颠覆！小米MiMo-Embodied如何重塑自动驾驶与具身智能？]]></title>    <link>https://juejin.cn/post/7575438636331139123</link>    <guid>https://juejin.cn/post/7575438636331139123</guid>    <pubDate>2025-11-23T14:19:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575438636331139123" data-draft-id="7575412016404414474" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="跨界颠覆！小米MiMo-Embodied如何重塑自动驾驶与具身智能？"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-11-23T14:19:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            跨界颠覆！小米MiMo-Embodied如何重塑自动驾驶与具身智能？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T14:19:49.000Z" title="Sun Nov 23 2025 14:19:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在人工智能的竞技场上，我们时常惊叹于技术迭代的速度。然而，2025年11月21日，小米抛出的重磅消息，却让整个AI圈为之振奋——他们正式发布了具身大模型 <strong>MiMo-Embodied</strong> 并宣布全面开源。这不仅仅是一次简单的模型更新，它标志着AI领域一个根深蒂固的界限被打破，预示着通用物理智能的新纪元或将提前到来。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FG6XoQZibUAAIAeL-791x1024.jpeg" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/G6XoQZibUAAIAeL-791x1024.jpeg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e0be14505464ce49798312993649bb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764512389&amp;x-signature=kCs9Cb%2BCtLc0yJAo2KDnQ7Divw8%3D" alt="G6XoQZibUAAIAeL" loading="lazy"/></a></p>
<h3 data-id="heading-0">两种智能，一个模型：弥合数字鸿沟</h3>
<p>长久以来，自动驾驶与具身智能，这两大看似亲密却又独立的领域，如同并行的两条铁轨，各有各的算法体系、数据范式与应用场景。汽车专注于道路上的决策与感知，机器人则忙于室内的交互与操作。它们的世界，鲜少交集。</p>
<p>但 MiMo-Embodied 的出现，就是要彻底改变这一局面。小米大胆设想：如果能用一个统一的模型，让AI既懂穿梭车流的智慧，又懂操作物体的灵巧，那将是何等的光景？这款模型正是全球首个尝试打通并成功连接这两大领域的跨域基座模型，其核心野心，便是让AI从“专才”迈向“全才”。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2Ffig3_img-1024x537.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/fig3_img-1024x537.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a36c5ebed18548be96b3998a854a3467~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764512389&amp;x-signature=kD8j5NBPKVvulbPNqd6Nf7XnMQM%3D" alt="fig3_img" loading="lazy"/></a></p>
<h3 data-id="heading-1">MiMo-Embodied 的三大核心突破</h3>
<p>要实现这样的“跨界融合”，绝非易事。MiMo-Embodied 凭借其独特的设计理念和训练策略，实现了以下三大核心突破：</p>
<ol>
<li>
<p><strong>跨域能力覆盖：室内外场景，一网打尽</strong> 想象一下，一个模型能同步理解你在客厅里如何拿起水杯（可供性推理）、规划打扫房间的步骤（任务规划）、以及判断桌椅的空间关系（空间理解），同时又能精准感知道路上的车辆行人（环境感知）、预测它们的下一步动作（状态预测），并安全高效地规划驾驶路径（驾驶规划）。MiMo-Embodied 正是构建了这样一套贯通室内外、覆盖所有关键任务的全链路智能支撑体系。</p>
</li>
<li>
<p><strong>双向协同赋能：知识的“奇妙漂流”</strong> 这或许是 MiMo-Embodied 最具创新性的地方。小米的团队验证了一个惊人的发现：机器人从室内交互中积累的对物体、空间和意图的理解，可以有效地迁移，帮助车辆在复杂的路口做出更鲁棒、更“人性化”的决策；反过来，自动驾驶系统处理动态交通场景的丰富经验，也能反哺机器人，让它在规划任务时更具预见性和适应性。这种“室内经验”与“室外智慧”的双向知识迁移，真正打破了传统AI的领域壁垒。</p>
</li>
<li>
<p><strong>全链路优化策略：稳定可靠，值得信赖</strong> 为了确保模型的稳定性和可靠性，MiMo-Embodied 采用了一套多阶段的严谨训练策略：“具身与驾驶能力预训练 → 思维链（CoT）推理增强 → 强化学习（RL）精细调优”。这种从宏观认知到精细操作的层层递进，让模型不仅能“想清楚”，还能“做得好”，在复杂真实环境中表现出卓越的稳定性和可靠性。</p>
</li>
</ol>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FG6akPNDbkAAIxzd.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/G6akPNDbkAAIxzd.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15d8dc95d6b545d79602ca4a3af80d4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764512389&amp;x-signature=y3nF%2Bg6UhPe8AvZxTE4djXFm%2Ffo%3D" alt="G6akPNDbkAAIxzd" loading="lazy"/></a></p>
<h3 data-id="heading-2">性能表现：一份令人信服的成绩单</h3>
<p>谈及性能，MiMo-Embodied 拿出了一份亮眼的成绩单。在涵盖感知、决策与规划的 <strong>29项核心基准测试</strong>中，它整体表现领先，超越了当前主流的开源、闭源乃至专用模型。</p>
<p>具体来看，在 <strong>17项具身智能基准</strong>中，模型在任务规划、可供性预测与空间理解等核心指标上刷新了SOTA（最先进水平），例如能够从一组相似物体中精准识别目标，或根据文字描述定位物体坐标。而在 <strong>12项自动驾驶基准</strong>中，模型也实现了从环境感知到状态预测，再到驾驶规划的全流程性能突破，展现出精准感知复杂交通、预测行为并生成安全高效决策的能力。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2Ftable2-1024x594.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/table2-1024x594.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf8fe5bf6f8146f5b74385bc003ac367~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764512389&amp;x-signature=Jd2tKdIVqRrtCLW24g7nyV3hPsY%3D" alt="table2" loading="lazy"/></a></p>
<h3 data-id="heading-3">开源的意义：AI普惠与生态共建</h3>
<p>小米一贯有开源的传统，MiMo-Embodied 也不例外。模型权重与代码已全面面向全球开发者在开源平台开放，并采用宽松的MIT协议。这一举措的战略意义不言而喻：它将极大降低各行各业进入跨域具身智能领域的门槛，促进技术普及，并加速全球开发者共同参与，推动通用物理智能技术的快速迭代和应用场景创新。</p>
<h3 data-id="heading-4">结语</h3>
<p>MiMo-Embodied 的发布，绝不仅仅是小米在AI领域秀肌肉那么简单。它更像是一盏探照灯，为未来通用人工智能的发展指明了方向。当一个AI既能灵巧地为你处理家务，又能安全高效地把你送到目的地时，我们离真正意义上的“通用物理智能”还会远吗？这不仅是技术的突破，更是对未来生活方式的一次大胆畅想。期待 MiMo-Embodied 及其开源社区能激发出更多令人惊喜的创新火花。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2Fafford-1.svg" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/afford-1.svg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf3d9de15e61448ebca7f1a701c451f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764512389&amp;x-signature=T5cm1XaXa13EGmSS%2FVxsNvedt5U%3D" alt="afford-1" loading="lazy"/></a></p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[屁股坏了，我硬抗了3天，差不多省了几千块这件事儿。]]></title>    <link>https://juejin.cn/post/7575438636331204659</link>    <guid>https://juejin.cn/post/7575438636331204659</guid>    <pubDate>2025-11-23T14:35:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575438636331204659" data-draft-id="7575119254314336282" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="屁股坏了，我硬抗了3天，差不多省了几千块这件事儿。"/> <meta itemprop="keywords" content="iOS"/> <meta itemprop="datePublished" content="2025-11-23T14:35:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="iOS研究院"/> <meta itemprop="url" content="https://juejin.cn/user/1421041942671774"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            屁股坏了，我硬抗了3天，差不多省了几千块这件事儿。
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1421041942671774/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    iOS研究院
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T14:35:11.000Z" title="Sun Nov 23 2025 14:35:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>由于我媳妇怀了二宝，所以我把父母也接了过来，方便照顾月子。父母过来之后为了聊表孝心，连着吃了2周的涮羊肉。没想到命运的齿轮开始转动~</p>
<h3 data-id="heading-1">起因</h3>
<p>重庆步入立冬之后，又迎来了新的换季。阴雨绵绵不少同事都变成了病友，咳嗽发烧🤒、感冒🤧可谓各显神通。平时楼梯间闲聊，“今天吃啥饭？”。那几天都变成了，“吃药了么？”</p>
<p>以我为圆点周边的同事也有中招的迹象。上周五下班有点发烧的迹象，回来就吃了感冒药。周六就吃了涮羊肉，导火索就此点燃~</p>
<h3 data-id="heading-2">爆发点</h3>
<p>一开始以为只是单纯的上火，起了一个包不以为然。从这周一到周四接下来的几天不断扩散，从一个黄豆大小，变成鸡蛋🥚大小。<code>十分有九分的不对劲儿！</code></p>
<p>周四下班实在疼痛难忍，走路都只能小步挪。移动速度立减50%，完全是中了虚弱！</p>
<p>我父母见此情况，就建议我去医院🏥看看啥情况。没检查之前我以为就是普通的火疖子而已~</p>
<h3 data-id="heading-3">急诊外科</h3>
<p>晃晃悠悠走到医院基本上已经是晚上9点多。问了一下前台护士，询问了一下挂号流程。就开始漫长的等待，前前后后差不多等了40分钟。等的时候有腿瘸的，崴脚的，眼睛起包的，胳膊起痘的，腰杆痛的，看起来一个比一个急。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b42d0e6569f34fd185ac76825623b54b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaU9T56CU56m26Zmi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764513310&amp;x-signature=d9Bj9FIgLx9VgOA9eBqs6L8UOZU%3D" alt="IMG_4695.JPG" loading="lazy"/></p>
<h3 data-id="heading-4">急诊诊断</h3>
<p>一看到医生就把基本情况大致讲了一下，医生的看了看表示很严重。当即就安排手术准备，打破伤风，然后去检查B超，再去抽血。医生说是：<strong>肛周囊肿</strong>，而且必须要开刀防毒。当即就要安排住院和开刀，秉着周五还要上班的原则，想想再忍忍。毕竟现在这狗日的大环境，<strong>请个假还看领导的*脸色</strong>，没意思。而且这个月工作日更实在，请假性价比更低。</p>
<p>我拒绝了医生的好意，医生备份方案是输液。我想了想还是开点药，虽然屁股也痛，但是能够小步移动。除了坐着站起来如同针扎，其他时候基本上还能接受。 医生甩给我一个免责声明一样的东西，表示我自愿放弃治疗。让医生开了点药，就拿着单子去付钱了。</p>
<p>大概是开了一盒头孢、一盒止痛药。</p>
<h3 data-id="heading-5">痛苦的周五</h3>
<p>因为屁股如同针扎，基本上平坐一会儿就痛苦难忍。旁边同事，还在说：你咋了这是？我只是简单说了声，屁股痛。实际上坐下来，站起来都需要左腿先发力，支撑全身。<code>从想站起来到站起来用了差不多2分半</code>。因为太痛了，站起来还要缓一缓。</p>
<p>周五下午大概4点多，应该是身体开启了自救模式。感觉自己开始头疼发烧，赶紧拿出止痛药和消炎药炫起来。因为我爸在家，到轻轨后回家路直接开车给我拉回家了。吃了饭，他们本着去小门诊输液控制下病情的原则，想让我输液缓解缓解。<strong>在公司渡劫了一天，我笑着说探探路我再去万一关门了~</strong></p>
<h3 data-id="heading-6">小门诊不敢接</h3>
<p>我父母溜了一圈，发现还开着门。喊我出门去看看医生，我父母一直在给医生解释。但是那个小门诊的医生只想下班。本着不给人添麻烦的原则，我就立马出门向小门诊进军。</p>
<p>等我火急火燎走到小门诊，已经看出来了医生的不耐烦！我用最简单的方式给门诊医生解释了一下。</p>
<p>门诊医生看了下伤口，说我这情况只能开刀。如果不早点开刀会形成肛瘘~</p>
<p><strong>我父母问我咋样？我说人家不敢给输液，让去来一刀。</strong> 于是就慢慢溜达回了家。</p>
<h3 data-id="heading-7">自救模式启动</h3>
<p>回家的路上，我走路的感觉有点奇怪。我以为是药物的反应，感觉湿漉漉的。毕竟这天为了控制消肿，连着上了几天“红霉素软膏”倒也习惯了。</p>
<p>结果回到家一爬到床上，就想着让我媳妇帮忙看一下消肿情况。结果吓了她一跳。内裤上都是血红色，悬着的心终于放下啦！</p>
<p><strong>肛周囊肿这种病情除了开刀就是自溃！</strong> 核心在于排毒环境，肿块的内部压力，从而减轻疼痛感。</p>
<h3 data-id="heading-8">基本康复</h3>
<p>从伤口自溃到截至发稿，感觉像来了2天大姨夫一样。但是痛苦确实减轻不少。基本上可以说是康复了。</p>
<p>这次的事情确实也给我自己敲了警钟！<code>千万不要熬夜！不要久坐！不要贪吃！</code></p>
<p><strong>多喝热水！有啥别有病，没啥别没钱！</strong></p>
<h3 data-id="heading-9">题外话</h3>
<p>之所以，我硬扛了几天。1是因为确实想省点钱，穷病闹得。2是因为小红书有前辈也扛过来了。3是因为基本手术动刀之后，依旧会反复犯病！</p>
<p>这里特别强调一下小红书的前辈，本来搜的时候屁股挺痛的。看到前辈的说楞是差点笑死🤣。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cde2900b684a4e6c8e0b8b3b29488932~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaU9T56CU56m26Zmi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764513310&amp;x-signature=JsEwmsVM%2BmgMk%2FL1CVPCgSqcmqE%3D" alt="a8a6fd867251b3b2af20864362ad0952.JPG" loading="lazy"/></p>
<p><code>多喝热水，合理膳食</code>，最后祝大家身体健康，有个好屁股！</p>
<h3 data-id="heading-10">相关推荐</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FURmC_4vxQv5ttOg8yYe7Eg" target="_blank" title="https://mp.weixin.qq.com/s/URmC_4vxQv5ttOg8yYe7Eg" ref="nofollow noopener noreferrer"># 苹果开发者续费大坑及成功续费方案！亲测有效</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F1bAA90Tzpx03tTHZbdg3aw" target="_blank" title="https://mp.weixin.qq.com/s/1bAA90Tzpx03tTHZbdg3aw" ref="nofollow noopener noreferrer"># AppStore敏感词排查手册，多维度分析Guideline 2.3.1隐藏功能，轻松过审。</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484371%26idx%3D1%26sn%3D33568c58e90a5bf4d2612d803ecb2a27%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484371&amp;idx=1&amp;sn=33568c58e90a5bf4d2612d803ecb2a27&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 苹果加急审核是“绿色通道”还是“死亡陷阱”？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484362%26idx%3D1%26sn%3Dea61bd42d5ae8b99d2a56cbfb8d91e88%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484362&amp;idx=1&amp;sn=ea61bd42d5ae8b99d2a56cbfb8d91e88&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 苹果开发者邮箱，突然收到11.2通知严重么？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484413%26idx%3D1%26sn%3D82870d4c8892fa65803a8e05fd5ac938%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484413&amp;idx=1&amp;sn=82870d4c8892fa65803a8e05fd5ac938&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 不想被苹果卡审最好错开这两个提审时间</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484349%26idx%3D1%26sn%3D1c75a6b08cb5de64ddf41a88b61ff108%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484349&amp;idx=1&amp;sn=1c75a6b08cb5de64ddf41a88b61ff108&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 手撕苹果审核4.3是代码问题还是设计问题？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484344%26idx%3D1%26sn%3D4399eb8d8bf82e9c5df26a18b8564cfb%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484344&amp;idx=1&amp;sn=4399eb8d8bf82e9c5df26a18b8564cfb&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 有幸和Appstore审核人员进行了一场视频会议特此记录。</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[国产终端编码神器，编程 CLI 大善人——IFlow CLI]]></title>    <link>https://juejin.cn/post/7575468252656304169</link>    <guid>https://juejin.cn/post/7575468252656304169</guid>    <pubDate>2025-11-23T14:47:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575468252656304169" data-draft-id="7575468252656255017" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="国产终端编码神器，编程 CLI 大善人——IFlow CLI"/> <meta itemprop="keywords" content="AIGC,人工智能"/> <meta itemprop="datePublished" content="2025-11-23T14:47:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="三金得鑫"/> <meta itemprop="url" content="https://juejin.cn/user/4406498335130216"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            国产终端编码神器，编程 CLI 大善人——IFlow CLI
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4406498335130216/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    三金得鑫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T14:47:05.000Z" title="Sun Nov 23 2025 14:47:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">如果你没有条件使用国外的 AI 模型和 AI 工具，那你一定要试试这块国产 AI 终端 CLI，它源自阿里心流团队，免费为大家提供了包括 GLM 4.6、Kimi-K2-Thinking 和 Minimax-M2 等 6 块开源模型，功能上也和 Claude Code 看齐！YYDS！</h3>
<p>在之前的《<a href="https://juejin.cn/post/7572062035140411402" target="_blank" title="https://juejin.cn/post/7572062035140411402">十月份 AI Coding 实践！Qoder、CC、Codex 还是 iflow？</a>》文章中，三金分享了一些 AI Coding 的感悟与工具，其中有提到一款由阿里心流团队打造的终端编码工具——IFlow CLI，今天让我们来详细介绍一下它！</p>
<p>在前段时间阿里 Qoder 官方的直播中，有人问到：你们阿里出了通义灵码、Qoder 还有 IFlow CLI，哪个最好？各有什么优势？</p>
<p>当时官方的回答絮絮叨叨一大堆，我只记得对于 IFlow CLI 来说，最大的优势就是<strong>免费</strong>！而且免费的还是市面上综合评价比较好的几款模型：</p>
<ul>
<li>GML-4.6</li>
<li>Kimi-K2-Thinking</li>
<li>MiniMax-M2</li>
<li>Qwen3-Coder-Plus</li>
<li>DeepSeek-V3.2</li>
<li>Kimi-K2-0905</li>
</ul>
<p>除此之外，在用法和功能上，也是对齐 Claude Code，像快捷指令 Command、SubAgent 以及 MCP 集成，和 Claude Code 完全一致。在国内环境，我们可以很平滑地由 Claude Code 转移到 IFlow CLI 上，再加上这些免费模型，让开发者们可以实现开箱即用！</p>
<h3 data-id="heading-1">安装</h3>
<p>在安装之前，需要检查一下是否有 Node.js 20+ 的环境，以及机器配置是否满足 4GB+ 的内存。如果没有 Node.js 20+ 可以直接执行一键安装脚本：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 一键安装脚本，会安装全部所需依赖</span>
bash -c <span class="hljs-string">"<span class="hljs-subst">$(curl -fsSL https://gitee.com/iflow-ai/iflow-cli/raw/main/install.sh)</span>"</span>
</code></pre>
<p>而在已有 Node.js 20+ 的环境下，只需要执行：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 已有Node.js 20+</span>
npm i -g @iflow-ai/iflow-cli@latest
</code></pre>
<p>我们可以通过 <code>iflow --version</code> 来检查是否安装成功。</p>
<h3 data-id="heading-2">启动</h3>
<p>在终端输入 <code>iflow</code> 进行启动：</p>
<p>启动后，iFlow CLI 需要进行认证登录，官方提供了三种方式：</p>
<ul>
<li><strong>Login with IFlow 登录</strong>，会直接打开心流平台进行登录。最推荐这种方式，因为它能让你的 IFlow CLI 拥有完整的功能体验；</li>
<li><strong>心流 API Key 登录</strong>，适合无浏览器环境（比如服务器下）。也支持完整功能，但是每 7 天需要更新一次 API Key。</li>
<li><strong>OpenAI Compatlble API</strong>，使用第三方模型。不推荐，不细说了。</li>
</ul>
<p>而 IFlow CLI 的完整功能有：</p>
<ul>
<li><strong>WebSearch 服务</strong>：智能网络搜索，获取最新信息</li>
<li><strong>WebFetch 服务</strong>：网页内容抓取和分析</li>
<li><strong>多模态能力</strong>：内置图像理解等多模态功能</li>
<li><strong>工具调用优化</strong>：心流平台提供的模型经过专门优化，工具调用更加精准高效</li>
<li><strong>自动续期</strong>：令牌自动刷新，永不过期</li>
<li><strong>无缝连接</strong>：一次授权，持续使用</li>
</ul>
<h3 data-id="heading-3">核心概念</h3>

















































<table><thead><tr><th>术语</th><th>说明</th></tr></thead><tbody><tr><td>iFlow CLI</td><td>基于终端的AI助手工具</td></tr><tr><td>斜杠命令</td><td>以 <code>/</code> 开头的控制命令（如 <code>/init</code>、<code>/help</code>）</td></tr><tr><td>@</td><td>文件引用 @文件路径(如 <code>@src/App.tsx</code> )</td></tr><tr><td>$</td><td>以 <code>$</code> 开头执行某个subagent(如 <code>$code-reviewer</code> )</td></tr><tr><td>Shell命令</td><td>以 <code>!</code> 开头，可在CLI中执行系统命令</td></tr><tr><td>yolo</td><td>默认允许CLI执行所有操作的执行模式</td></tr><tr><td>MCP</td><td>模型上下文协议，用于扩展AI能力的服务器系统</td></tr><tr><td>Sub Agent</td><td>智能Agent系统,适用于执行不同专业的任务</td></tr><tr><td>Sub Command</td><td>命令行扩展</td></tr><tr><td>context left</td><td>CLI右下角的提示信息，代表模型在对话过程中剩余的上下文长度</td></tr></tbody></table>
<p>我们可以在 VSCode 编辑器中安装 IFlow CLI 插件来快速在项目中启动：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74ca32359b764e43a34bdabb064cafcb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiJ6YeR5b6X6ZGr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764514024&amp;x-signature=My15Try5Y1RbWIRl263m0sgS%2BCs%3D" alt="" loading="lazy"/></p>
<p>和 Claude Code 一样，我们可以通过 <code>/init</code> 指令来为项目生成完整的项目上下文。也可以在终端的右下角处看到当前对话的剩余上下文长度：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/24b4812946a3450b8858cd7551ec531e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiJ6YeR5b6X6ZGr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764514024&amp;x-signature=ozz7d0VA6YXKgBRS10yP8MvCnxE%3D" alt="" loading="lazy"/></p>
<p>如果剩余上下文不多，可以选择使用 <code>/compress</code> 来压缩上下文或者直接 <code>/clear</code> 重置对话。</p>
<p>由于其模型免费的特点，非常建议无法使用 Claude、GPT5 以及 Gemini 的小伙伴进行下载安装。而有这些顶尖模型的小伙伴也可以选择搭配使用：</p>
<ul>
<li>复杂需求或疑难杂症使用 Claude 等模型 + Claude Code/Codex</li>
<li>一般需求使用 iflow</li>
</ul>
<p>这样下来既把活干了，又省 token，堪称最佳搭档～</p>
<p>对于 IFlow CLI 的高阶用法及最佳实践，推荐大家直接访问心流开放平台-<a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.iflow.com%2Fcli%2Fquickstart" target="_blank" title="https://platform.iflow.com/cli/quickstart" ref="nofollow noopener noreferrer">platform.iflow.com/cli/quickst…</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c61e7c860cc749ad968ea1f2c4d72ecc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiJ6YeR5b6X6ZGr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764514024&amp;x-signature=hzNfhQ6E5Q4PTICIYAoYrwy4S90%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">心流家族</h3>
<p>除了给大家介绍的 IFlow CLI 之外，心流还提供了：</p>
<ul>
<li>API 调用，目前是免费使用的，大家可以在心流官网注册后申请使用，支持的模型可以在模型库进行查看（<a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.iflow.cn%2Fmodels%25EF%25BC%2589" target="_blank" title="https://platform.iflow.cn/models%EF%BC%89" ref="nofollow noopener noreferrer">platform.iflow.cn/models）</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46eda848d6e547ce8cc73dda065291d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiJ6YeR5b6X6ZGr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764514024&amp;x-signature=GNYYleoXlSTAw77p041TYkrT5YU%3D" alt="" loading="lazy"/></p>
<ul>
<li>搭扣，心流提供的一款 Agent 产品，可以实现一站式研发，比如官网开发或者小程序开发。体验地址：<strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fdakou.iflow.cn%2F" target="_blank" title="https://dakou.iflow.cn/" ref="nofollow noopener noreferrer">dakou.iflow.cn/</a></strong></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/521e11ed3bd24ecaa237ffd19dcd021c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiJ6YeR5b6X6ZGr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764514024&amp;x-signature=p8%2FNx2ypFHJYvVhc9dRso%2FMe9a0%3D" alt="" loading="lazy"/></p>
<ul>
<li>MCP 市场（<a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.iflow.cn%2Fmcp%25EF%25BC%2589%25EF%25BC%258C%25E6%258F%2590%25E4%25BE%259B%25E4%25BA%2586%25E4%25B8%2580%25E7%25B3%25BB%25E5%2588%2597%25E5%25BD%2593%25E4%25B8%258B%25E6%25AF%2594%25E8%25BE%2583%25E7%2583%25AD%25E9%2597%25A8%25E7%259A%2584" target="_blank" title="https://platform.iflow.cn/mcp%EF%BC%89%EF%BC%8C%E6%8F%90%E4%BE%9B%E4%BA%86%E4%B8%80%E7%B3%BB%E5%88%97%E5%BD%93%E4%B8%8B%E6%AF%94%E8%BE%83%E7%83%AD%E9%97%A8%E7%9A%84" ref="nofollow noopener noreferrer">platform.iflow.cn/mcp），提供了一系列…</a> MCP 工具，大家可以根据引导提示一键进行安装；</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77eeea44821248d08a64ce2b1af34dbd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiJ6YeR5b6X6ZGr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764514024&amp;x-signature=wE3nEB62e3383yEFtYRJ4zoTQu4%3D" alt="" loading="lazy"/></p>
<ul>
<li>智能体扩展（<a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.iflow.cn%2Fagents%3Ftype%3Dagents%26category%3Dall%25EF%25BC%2589%25EF%25BC%258C%25E8%25BF%2599%25E4%25B8%25AA%25E9%2587%258C%25E9%259D%25A2%25E5%258C%2585%25E5%2590%25AB%25E4%25BA%2586%25E5%25B7%25A5%25E4%25BD%259C%25E6%25B5%2581" target="_blank" title="https://platform.iflow.cn/agents?type=agents&amp;category=all%EF%BC%89%EF%BC%8C%E8%BF%99%E4%B8%AA%E9%87%8C%E9%9D%A2%E5%8C%85%E5%90%AB%E4%BA%86%E5%B7%A5%E4%BD%9C%E6%B5%81" ref="nofollow noopener noreferrer">platform.iflow.cn/agents?type…</a> Workflow、智能体 Agent 和指令 Command，也是可以通过引导提示一键进行安装，非常方便；</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea251dec50f648b7af38e84162eadaae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiJ6YeR5b6X6ZGr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764514024&amp;x-signature=otHlGK86IFORsZ3I2iA0iNo1GnM%3D" alt="" loading="lazy"/></p>
<ul>
<li>官方论坛（<a href="https://link.juejin.cn?target=https%3A%2F%2Fvibex.iflow.cn%2F%25EF%25BC%2589%25EF%25BC%258C%25E7%2594%25BB%25E9%25A3%258E%25E5%2592%258C" target="_blank" title="https://vibex.iflow.cn/%EF%BC%89%EF%BC%8C%E7%94%BB%E9%A3%8E%E5%92%8C" ref="nofollow noopener noreferrer">vibex.iflow.cn/），画风和</a> linuxDo 一样，用的是一套论坛模板，有很多大佬在里面进行交流。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b3570f524a7417e9b7e6a2222515775~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiJ6YeR5b6X6ZGr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764514024&amp;x-signature=15LSplC00i%2BWigoayxSn%2Bp8x7Rw%3D" alt="" loading="lazy"/></p>
<p>除此之外，在心流官网（<a href="https://link.juejin.cn?target=https%3A%2F%2Fiflow.cn%2F%25EF%25BC%2589%25EF%25BC%258C%25E5%25AF%25B9%25E4%25BA%258E%25E5%2585%258D%25E8%25B4%25B9%25E7%2594%25A8%25E6%2588%25B7%25E6%259D%25A5%25E8%25AF%25B4%25EF%25BC%258C%25E6%25AF%258F%25E4%25B8%25AA%25E6%259C%2588%25E8%25BF%2598%25E6%258F%2590%25E4%25BE%259B%25E4%25BA%2586" target="_blank" title="https://iflow.cn/%EF%BC%89%EF%BC%8C%E5%AF%B9%E4%BA%8E%E5%85%8D%E8%B4%B9%E7%94%A8%E6%88%B7%E6%9D%A5%E8%AF%B4%EF%BC%8C%E6%AF%8F%E4%B8%AA%E6%9C%88%E8%BF%98%E6%8F%90%E4%BE%9B%E4%BA%86" ref="nofollow noopener noreferrer">iflow.cn/），对于免费用户来说，…</a> 30次高级研究以及 200 次 AI PPT 生成。</p>
<p>高级研究能做什么呢？比如你想做一个旅游攻略，这个时候就可以点击下图中的网页，并告诉它你想生成去重庆的旅游攻略，待几天？想做什么？想吃什么？等等越详细越好。</p>
<p>而它会在后台执行异步任务，根据任务的复杂度会在20-40分钟左右（自己测的，可能也不准）生成一个旅游攻略的网页给你。非常赞！！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ebfb23bd1ab47e18eaf030fcf74333e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiJ6YeR5b6X6ZGr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764514024&amp;x-signature=jYD5XAcEZGb3qAcQpH4NNcgkCgQ%3D" alt="" loading="lazy"/></p>
<p>感兴趣的小伙伴可以去试试看了～</p>
<blockquote>
<p>PS：大家都在推 Gemini3，而我因为还没有测试完，所以后面再说</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[devstack重启恢复方案]]></title>    <link>https://juejin.cn/post/7575367791273279526</link>    <guid>https://juejin.cn/post/7575367791273279526</guid>    <pubDate>2025-11-23T14:55:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575367791273279526" data-draft-id="7575438636331253811" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="devstack重启恢复方案"/> <meta itemprop="keywords" content="OpenStack"/> <meta itemprop="datePublished" content="2025-11-23T14:55:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            devstack重启恢复方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T14:55:23.000Z" title="Sun Nov 23 2025 14:55:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这是一个非常实际且关键的问题！我们来一步步分析 <strong>“物理主机关机 → 重启”</strong> 对 <strong>嵌套虚拟机 + DevStack</strong> 的影响，并给出完整的恢复操作指南。</p>
<hr/>
<h2 data-id="heading-0">🧩 场景回顾</h2>
<ul>
<li><strong>物理主机（Host）</strong> ：运行 Linux（如 Ubuntu）</li>
<li><strong>虚拟机（VM）</strong> ：在 Host 上通过 KVM/QEMU、VirtualBox 或 VMware 创建</li>
<li><strong>DevStack</strong>：部署在该 VM 内部（单节点 OpenStack 开发环境）</li>
</ul>
<blockquote>
<p>✅ 典型拓扑：<br/>
<code>你的笔记本/服务器</code> → <code>KVM 虚拟机 (192.168.122.30)</code> → <code>DevStack (Keystone/Nova/Neutron...)</code></p>
</blockquote>
<hr/>
<h2 data-id="heading-1">🔌 一、关机对各层的影响</h2>





























<table><thead><tr><th>组件</th><th>关机时状态</th><th>开机后状态</th><th>是否自动恢复</th></tr></thead><tbody><tr><td><strong>物理主机</strong></td><td>正常关机</td><td>需手动开机</td><td>❌</td></tr><tr><td><strong>虚拟机（VM）</strong></td><td>被强制断电（除非优雅关机）</td><td><strong>默认不会自动启动</strong></td><td>❌（需配置）</td></tr><tr><td><strong>DevStack 服务</strong></td><td>进程被 kill</td><td><strong>不会自动启动</strong>（即使 VM 启动）</td><td>❌（需手动或配置 systemd）</td></tr></tbody></table>
<blockquote>
<p>⚠️ <strong>关键结论</strong>：<br/>
<strong>物理机重启后，VM 和 DevStack 都不会自动恢复运行！你需要手动干预。</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-2">🛠️ 二、开机后的完整恢复步骤</h2>
<h3 data-id="heading-3">✅ 步骤 1：启动虚拟机（VM）</h3>
<h4 data-id="heading-4">情况 A：你使用 <strong>libvirt/KVM（virsh）</strong></h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 查看 VM 状态</span>
virsh <span class="hljs-built_in">list</span> --<span class="hljs-built_in">all</span>

<span class="hljs-comment"># 启动 VM（假设名字是 devstack-vm）</span>
virsh start devstack-vm

<span class="hljs-comment"># （可选）设置开机自启（推荐！）</span>
virsh autostart devstack-vm
</code></pre>
<blockquote>
<p>💡 <code>autostart</code> 会让 VM 在 <strong>物理机启动后自动运行</strong>（但 DevStack 服务仍需单独处理）。</p>
</blockquote>
<h4 data-id="heading-5">情况 B：你使用 <strong>VirtualBox</strong></h4>
<pre><code class="hljs language-bash" lang="bash">VBoxManage startvm <span class="hljs-string">"devstack-vm"</span> --<span class="hljs-built_in">type</span> headless
</code></pre>
<h4 data-id="heading-6">情况 C：你使用 <strong>VMware Workstation / ESXi</strong></h4>
<ul>
<li>手动点击“开机”</li>
<li>或在 ESXi 中设置“随主机启动”</li>
</ul>
<hr/>
<h3 data-id="heading-7">✅ 步骤 2：登录虚拟机，检查 DevStack 服务状态</h3>
<pre><code class="hljs language-perl" lang="perl">ssh stack@192.<span class="hljs-number">168.122</span>.<span class="hljs-number">30</span>  <span class="hljs-comment"># 或你的 VM IP</span>
</code></pre>
<h4 data-id="heading-8">检查 systemd 服务（现代 DevStack 默认方式）：</h4>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># 查看所有 DevStack 服务状态</span>
systemctl list-units | <span class="hljs-keyword">grep</span> devstack

<span class="hljs-comment"># 检查 Keystone 是否运行</span>
systemctl is-active devstack@keystone
</code></pre>
<blockquote>
<p>❌ 如果返回 <code>inactive</code>，说明服务未启动。</p>
</blockquote>
<hr/>
<h3 data-id="heading-9">✅ 步骤 3：启动 DevStack 服务</h3>
<h4 data-id="heading-10">方式 A：如果你使用 <strong>systemd 模式（推荐）</strong></h4>
<p>只需启动所有 DevStack 服务：</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># 启动所有 DevStack 服务</span>
sudo systemctl start <span class="hljs-string">'devstack@*'</span>

<span class="hljs-comment"># 验证</span>
systemctl status devstack@keystone devstack@nova-api
</code></pre>
<blockquote>
<p>✅ 优势：服务会按依赖顺序启动，日志可通过 <code>journalctl</code> 查看。</p>
</blockquote>
<h4 data-id="heading-11">方式 B：如果你使用 <strong>传统模式（非 systemd）</strong></h4>
<p>需要重新运行 DevStack 脚本：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> ~/devstack
./rejoin-stack.sh   <span class="hljs-comment"># 重新 attach 到已存在的服务（如果支持）</span>
<span class="hljs-comment"># 或</span>
./stack.sh          <span class="hljs-comment"># 重新完整部署（较慢，但可靠）</span>
</code></pre>
<blockquote>
<p>⚠️ 注意：<code>./stack.sh</code> 会重建数据库和网络，可能导致之前创建的虚拟机丢失！</p>
</blockquote>
<hr/>
<h3 data-id="heading-12">✅ 步骤 4：验证 OpenStack 功能</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">source</span> ~/devstack/openrc admin admin

<span class="hljs-comment"># 测试认证</span>
openstack token issue

<span class="hljs-comment"># 查看虚拟机（如果之前有）</span>
openstack server list

<span class="hljs-comment"># 访问 Dashboard</span>
curl -s http://localhost:8080/dashboard | <span class="hljs-built_in">head</span> -5
</code></pre>
<hr/>
<h2 data-id="heading-13">🔄 三、如何实现“全自动恢复”？（高级建议）</h2>
<p>如果你希望 <strong>物理机重启后，VM 和 DevStack 全自动恢复</strong>，可以这样做：</p>
<h3 data-id="heading-14">1. <strong>让 VM 开机自启</strong></h3>
<ul>
<li><strong>KVM/libvirt</strong>：<code>virsh autostart devstack-vm</code></li>
<li><strong>VirtualBox</strong>：需写 systemd 服务或 cron job</li>
<li><strong>VMware</strong>：在虚拟机设置中启用“随主机启动”</li>
</ul>
<h3 data-id="heading-15">2. <strong>让 DevStack 服务随 VM 启动</strong></h3>
<p>在 VM 内部执行：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启用所有 DevStack 服务的开机自启</span>
sudo systemctl <span class="hljs-built_in">enable</span> <span class="hljs-string">'devstack@*'</span>
</code></pre>
<blockquote>
<p>✅ 这样，VM 启动后，systemd 会自动拉起 Keystone、Nova、Neutron 等服务。</p>
</blockquote>
<h3 data-id="heading-16">3. <strong>（可选）添加健康检查脚本</strong></h3>
<p>创建一个监控脚本 <code>/usr/local/bin/check-devstack.sh</code>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-keyword">if</span> ! systemctl is-active --quiet devstack@keystone; <span class="hljs-keyword">then</span>
    sudo systemctl start <span class="hljs-string">'devstack@*'</span>
<span class="hljs-keyword">fi</span>
</code></pre>
<p>并通过 cron 每分钟检查一次。</p>
<hr/>
<h2 data-id="heading-17">⚠️ 四、注意事项与风险</h2>






























<table><thead><tr><th>风险</th><th>说明</th><th>建议</th></tr></thead><tbody><tr><td><strong>IP 变更</strong></td><td>VM 重启后 IP 可能变化（如果 DHCP）</td><td>使用静态 IP 或更新 <code>local.conf</code> 中的 <code>HOST_IP</code></td></tr><tr><td><strong>数据库损坏</strong></td><td>强制断电可能导致 MariaDB 损坏</td><td>尽量优雅关机；定期备份 <code>/opt/stack/data/</code></td></tr><tr><td><strong>网络重置</strong></td><td>Neutron 的 Linux Bridge/OVS 可能需重建</td><td>DevStack 通常能自动恢复，若不行则 <code>./stack.sh</code></td></tr><tr><td><strong>资源不足</strong></td><td>物理机内存不足导致 VM 无法启动</td><td>确保 Host 有足够资源（建议 ≥16GB RAM）</td></tr></tbody></table>
<h3 data-id="heading-18">ip变更问题解决</h3>
<p>针对ip可能变化，做了以下配置
在 <strong>libvirt/KVM 中绑定 MAC → IP</strong>（适合 KVM 用户）</p>
<h4 data-id="heading-19">步骤 1：获取 VM 的 MAC 地址</h4>
<pre><code class="hljs language-perl" lang="perl">virsh dumpxml devstack-vm | <span class="hljs-keyword">grep</span> <span class="hljs-string">"mac address"</span> <span class="hljs-comment"># 输出：&lt;mac address='52:54:00:a1:b2:c3'/&gt;</span>
</code></pre>
<h4 data-id="heading-20">步骤 2：编辑 libvirt 网络配置（通常是 default 网络）</h4>
<pre><code class="hljs language-arduino" lang="arduino">virsh net-edit <span class="hljs-keyword">default</span>
</code></pre>
<p>在 <code>&lt;ip&gt;</code> 段内添加 <code>&lt;host&gt;</code> 条目：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">network</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>default<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">bridge</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'virbr0'</span>/&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">ip</span> <span class="hljs-attr">address</span>=<span class="hljs-string">'192.168.122.1'</span> <span class="hljs-attr">netmask</span>=<span class="hljs-string">'255.255.255.0'</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">dhcp</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">range</span> <span class="hljs-attr">start</span>=<span class="hljs-string">'192.168.122.2'</span> <span class="hljs-attr">end</span>=<span class="hljs-string">'192.168.122.254'</span>/&gt;</span> <span class="hljs-comment">&lt;!-- 添加这一行 --&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">host</span> <span class="hljs-attr">mac</span>=<span class="hljs-string">'52:54:00:a1:b2:c3'</span> <span class="hljs-attr">ip</span>=<span class="hljs-string">'192.168.122.30'</span>/&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">dhcp</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">ip</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">network</span>&gt;</span>
</code></pre>
<h4 data-id="heading-21">步骤 3：重启网络</h4>
<pre><code class="hljs language-sql" lang="sql">virsh net<span class="hljs-operator">-</span>destroy <span class="hljs-keyword">default</span> virsh net<span class="hljs-operator">-</span><span class="hljs-keyword">start</span> <span class="hljs-keyword">default</span>
</code></pre>
<hr/>
<h2 data-id="heading-22">📌 五、最佳实践总结</h2>





























<table><thead><tr><th>操作</th><th>命令/配置</th></tr></thead><tbody><tr><td><strong>1. VM 开机自启</strong></td><td><code>virsh autostart devstack-vm</code></td></tr><tr><td><strong>2. DevStack 服务自启</strong></td><td><code>sudo systemctl enable 'devstack@*'</code></td></tr><tr><td><strong>3. 启用 journald 持久化</strong></td><td><code>sudo mkdir -p /var/log/journal</code></td></tr><tr><td><strong>4. 使用静态 IP</strong></td><td>在 VM 网络配置中固定 IP</td></tr><tr><td><strong>5. 关机前优雅停止</strong></td><td>在 VM 中执行 <code>./unstack.sh</code>（可选但推荐）</td></tr></tbody></table>
<blockquote>
<p>💡 <strong>理想流程</strong>：<br/>
物理机关机 → VM 自动保存状态（或优雅关机）→ 物理机开机 → VM 自动启动 → DevStack 服务自动恢复 → 一切如常！</p>
</blockquote>
<hr/>
<h2 data-id="heading-23">✅ 最终答案</h2>
<blockquote>
<p><strong>物理服务器关机再开机后：</strong></p>
<ol>
<li>
<p><strong>虚拟机不会自动启动</strong>（除非你配置了 <code>autostart</code>）</p>
</li>
<li>
<p><strong>DevStack 服务不会自动运行</strong>（即使 VM 启动了）</p>
</li>
<li>
<p><strong>你需要手动：</strong></p>
<ul>
<li>启动虚拟机</li>
<li>在 VM 中启动 DevStack 服务（<code>sudo systemctl start 'devstack@*'</code>）</li>
</ul>
</li>
<li>
<p><strong>为避免每次手动操作，建议配置：</strong></p>
<ul>
<li>VM 开机自启</li>
<li>DevStack 服务开机自启</li>
</ul>
</li>
</ol>
</blockquote>
<p>这样，重启物理机后，DevStack 环境就能“无缝恢复”了！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端性能优化之CSS篇]]></title>    <link>https://juejin.cn/post/7575655132755591187</link>    <guid>https://juejin.cn/post/7575655132755591187</guid>    <pubDate>2025-11-23T13:03:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575655132755591187" data-draft-id="7575442779039350826" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端性能优化之CSS篇"/> <meta itemprop="keywords" content="前端,JavaScript,性能优化"/> <meta itemprop="datePublished" content="2025-11-23T13:03:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员小寒"/> <meta itemprop="url" content="https://juejin.cn/user/694547078987287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端性能优化之CSS篇
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547078987287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员小寒
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T13:03:58.000Z" title="Sun Nov 23 2025 13:03:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1、前言</h2>
<p>当涉及到网站的性能优化时，CSS 的优化是一个非常重要的方面。如果你的 CSS 太复杂，那么你的网站可能会像一个<strong>慢吞吞的乌龟</strong>一样缓慢地加载和渲染，影响<strong>用户的留存</strong>、<strong>网站的转化率</strong>以及<strong>网站的体验和传播</strong>等，所以对于 CSS 优化还是非常需要的，本文将介绍一些 CSS 性能优化的技巧，帮助你在编写 CSS 代码时提高性能。</p>
<h2 data-id="heading-1">2、前置知识</h2>
<h3 data-id="heading-2">2.1 CSS 解析规则</h3>
<p>我们一般书写 CSS 选择器都是从左往右书写的，所以自然就会以为 CSS 选择器是从左往右去匹配渲染的，但其实不是这样的，<strong>CSS 选择器是从右往左去匹配的</strong>。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.header</span> <span class="hljs-selector-tag">div</span> <span class="hljs-selector-tag">span</span> { 
  <span class="hljs-attribute">color</span>: red;
}
</code></pre>
<p>比如上面的 CSS 样式匹配查找过程是这样的：</p>
<ol>
<li>先找到所有的 <code>span</code> 元素。</li>
<li>从第一个 <code>span</code> 元素开始，沿着 <code>span</code> 元素的父级元素查到 <code>div</code>，最后沿着 <code>div</code> 的父级元素找到所有的 <code>.header</code>，找到满足条件的节点就加入到结果集中。</li>
</ol>
<h3 data-id="heading-3">2.2 CSS 的加载过程</h3>
<p><strong>简述浏览器的渲染过程</strong>：在拿到 html 文件后，浏览器会调用 html 解析器解析 html 文件，构建 DOM 树和 CSSOM 树，然后 DOM 树和 CSSOM 树合并成渲染树，最后浏览器会根据渲染树进行布局和绘制，最终将页面呈现给用户。</p>
<p><strong>CSSOM 的构建</strong>：当浏览器解析 html 文档时，如果遇到 <code>&lt;link&gt;</code> 或 <code>&lt;style&gt;</code> 标签，会开始下载和解析 CSS 文件，构建 CSSOM。在 CSSOM 构建完成之前，浏览器不会渲染任何已处理的内容，即使DOM已经解析完毕。</p>
<ul>
<li>CSS 不会阻塞 <code>DOM</code> 的解析，但会阻塞 <code>DOM</code> 的渲染。</li>
<li>CSS 不会阻塞 <code>Javascript</code> 的下载，但会阻塞 <code>JavaScript</code> 的执行，因为 <code>JavaScript</code> 可以操作样式，所以需要等 <code>CSSOM</code> 构建完成之后，才能执行 <code>JavaScript</code>。</li>
</ul>
<p>所以从这里就可以得到以下优化思路：。</p>
<ul>
<li>将一些<strong>体积小的首屏关键 CSS</strong> 内联到 <code>html</code> 文件中，加快首屏渲染速度。</li>
<li>将 CSS 放在 <code>&lt;head&gt;</code> 中，确保尽早加载。</li>
<li>使用媒体查询（如 <code>media="print"</code>）使 CSS 非阻塞渲染。</li>
<li>在生产环境中，考虑使用 preload（如 <code>&lt;link rel="preload" as="style"&gt;</code>）在不阻塞渲染的情况下加载非首屏的 CSS 资源。</li>
</ul>
<h3 data-id="heading-4">2.3 CSS 权重优先级</h3>
<p>CSS 选择器类型的优先级从低往高依次是：</p>
<ol>
<li><strong>类型选择器</strong>（比如 <code>h1</code>）和<strong>伪元素选择器</strong>（比如 <code>::before</code>）。</li>
<li><strong>类选择器</strong>（比如 <code>.header</code>）、<strong>属性选择器</strong>（比如 <code>[type="checkbox"]</code>）和<strong>伪类选择器</strong>（比如 <code>:hover</code>）。</li>
<li><strong>ID 选择器</strong>（比如 <code>#box</code>）。</li>
<li><strong>!important</strong>：优先级最高。</li>
</ol>
<h2 data-id="heading-5">2、CSS 加载性能优化</h2>
<h3 data-id="heading-6">2.1. 提取公共的 CSS 文件</h3>
<p>如果使用<code>webpack</code>进行项目打包，在打包阶段可以使用<code>mini-css-extract-plugin</code>提取公共 CSS 文件，便于缓存以及减少 CSS 请求次数。</p>
<h3 data-id="heading-7">2.2 避免使用 @import</h3>
<ul>
<li>使用 <code>@import</code> 会阻塞浏览器的并行下载，导致加载速度变慢。</li>
<li>多个 <code>@import</code> 会导致下载顺序紊乱。</li>
</ul>
<h3 data-id="heading-8">2.3 压缩 CSS 文件</h3>
<p>压缩 CSS 文件可以减小文件大小，从而加快加载速度。比如可以用<code>optimize-css-assets-webpack-plugin</code>配合<code>mini-css-extract-plugin</code>使用来优化和压缩 CSS 文件。</p>
<h3 data-id="heading-9">2.4 使用浏览器缓存</h3>
<p>可以使用浏览器缓存来缓存 CSS 文件，从而在页面加载时加快速度。可以设置适当的缓存时间来确保文件在必要时能够更新。</p>
<h3 data-id="heading-10">2.5 使用 CDN 加速</h3>
<ul>
<li>使用 <strong>CDN（内容分发网络）</strong> 可以将 CSS 文件分发到全国各个 <code>CDN</code> 节点的服务器上，用户可以就近下载，从而加快加载速度，也可以减少自己服务器的负载。</li>
<li>如果静态资源很多，可以准备多个静态服务器域名，比如域名是 <code>static.xx.com</code>，做成支持 <code>static0-5</code> 的 6 个域名, 也就是 <code>static0.xx.com、static1.xx.com、static2.xx.com...</code>，每次请求时随机选一个域名地址进行请求，这样可以绕过浏览器同域名的连接数限制（一般是限制 6 个），6 个域名就可以同时发送 36 个连接请求。当然，这个域名个数不是越多越好，太分散的话又会涉及到多域名无法缓存静态资源的问题。</li>
</ul>
<h3 data-id="heading-11">2.6 使用 CSS Sprite</h3>
<p><strong>CSS Sprite</strong> 技术就是我们常说的<strong>雪碧图</strong>，通过将多张小图标拼接成一张大图，能有效的<strong>减少HTTP请求数量</strong>以达到加速显示内容的技术。</p>
<h3 data-id="heading-12">2.7 CSS 样式抽离和去除无用 CSS</h3>
<ul>
<li>平时开发过程中可以将一些<strong>可复用</strong>的 CSS 抽离到一个单独文件中，减少 CSS 代码冗余。</li>
<li>在打包构建时可以利用一些插件去除没有用到的 CSS，相当于对 CSS 进行 <code>Tree shaking</code>，减少打包后体积。</li>
</ul>
<h3 data-id="heading-13">2.8 合理使用内嵌 CSS</h3>
<p><code>内嵌CSS</code> 也就是通过元素的 <code>style</code> 来书写行内样式，比如 <code>&lt;div style="color: red"&gt;&lt;/div&gt;</code>，它的优缺点如下：</p>
<p><strong>优点</strong>：</p>
<ul>
<li>与使用 <code>link</code> 标签相比，可以减少 CSS 的 <code>http</code> 请求量。</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>增加 <code>html</code> 文件的体积。</li>
<li>使用 <code>link</code> 标签能很好的利用浏览器的缓存，而内联样式放在 <code>html</code> 里面，能否使用缓存需要看 <code>html</code> 文件的缓存策略。</li>
</ul>
<p>综合它的优缺点，我们可以选择将一些<strong>体积小的首屏关键 CSS</strong> 内联到 <code>html</code> 文件中，加快首屏渲染速度。</p>
<h2 data-id="heading-14">3、CSS 选择器性能优化</h2>
<h3 data-id="heading-15">3.1 避免使用通配符选择器</h3>
<p>通配符选择器<code>*</code>符号可以匹配任何元素，但是这会导致浏览器需要遍历整个文档树来查找匹配的元素，从而降低性能。</p>
<h3 data-id="heading-16">3.2 使用子选择器代替后代选择器</h3>
<p>后代选择器（如 <code>.parent .child</code>）会检查所有后代元素，而子选择器（如 <code>.parent &gt; .child</code>）只检查直接子元素，匹配范围更小，性能更好。</p>
<h3 data-id="heading-17">3.3 优先使用类（Class）和 ID 选择器</h3>
<p>类选择器（如 <code>.box</code>）和 ID 选择器（如 <code>#box</code>）匹配速度更快，因为它们直接指向特定元素。避免标签选择器（如 <code>div</code>）或属性选择器（如 [type="text"]），后者匹配更加宽泛，效率较低，尤其在大型 DOM 中。</p>
<h3 data-id="heading-18">3.4 避免深层嵌套的选择器</h3>
<p>前面也说过，CSS 选择器需要从右往左去匹配的，嵌套的选择器如 <code>.header div ul li a</code>，因为浏览器需要遍历更多 DOM 节点。建议限制选择器深度在 3 层以内，使用更直接的类或 ID 选择器，如 <code>.box</code>。这能减少匹配时间。或者使用 <code>BEM</code> 命名规范，比如 <code>.block__element--modifier</code>，提高匹配效率。</p>
<p>另外在使用 ID 选择器的时候，前面就需要加上父级的选择器，比如不推荐用 <code>.box #content</code>，推荐用 <code>#content</code>。</p>
<h2 data-id="heading-19">4、CSS 属性性能优化</h2>
<h3 data-id="heading-20">4.1 避免使用过于复杂的属性</h3>
<p>过于复杂的属性会增加浏览器的渲染负担，从而降低性能。应该尽量使用简单的属性来实现需要的样式效果，比如下面这些属性：</p>
<ul>
<li><strong>box-shadow</strong>：box-shadow 属性可以实现盒子的阴影效果，但是它会增加浏览器的计算和渲染成本。如果要实现一个简单的边框效果，可以使用 <code>border</code> 属性来替代。</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 不推荐使用 */</span>
<span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">2px</span> <span class="hljs-number">2px</span> <span class="hljs-number">2px</span> <span class="hljs-number">#888</span>;
}

<span class="hljs-comment">/* 推荐使用 */</span>
<span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#888</span>;
}
</code></pre>
<ul>
<li><strong>filter</strong>：filter 属性可以实现图像的滤镜效果，但是它会增加浏览器的计算和渲染成本。如果要实现一个简单的颜色变换效果，可以使用 <code>background-color</code> 属性来替代。</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 不推荐使用 */</span>
<span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">filter</span>: <span class="hljs-built_in">grayscale</span>(<span class="hljs-number">50%</span>);
}

<span class="hljs-comment">/* 推荐使用 */</span>
<span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ccc</span>;
}
</code></pre>
<p>不过需要注意的是，这些替代方案可能会有一些<strong>局限性</strong>，无法完全取代原来的属性。因此，在使用这些替代方案时，需要根据具体的需求和情况进行选择。</p>
<h3 data-id="heading-21">4.2 避免使用不必要的属性</h3>
<p>不必要的属性会增加 <code>CSS</code> 文件的大小，从而降低加载速度。应该尽量避免使用不必要的属性。</p>
<h3 data-id="heading-22">4.3 避免使用 !important</h3>
<p><code>!important</code> 会覆盖其他样式，从而增加渲染时间。而且它不容易被替换或覆盖，后期可维护性也比较差，更好的方式使用更具体、更准确的选择器来定义样式。</p>
<h2 data-id="heading-23">5、CSS 动画性能优化</h2>
<h3 data-id="heading-24">5.1 使用 transform 和 opacity 属性来进行动画</h3>
<p>使用 <code>transform</code> 和 <code>opacity</code> 属性可以减少浏览器的渲染负担，从而提高性能。</p>
<h3 data-id="heading-25">5.2 避免使用过于复杂的动画效果</h3>
<p>过于复杂的动画效果会增加浏览器的渲染负担，从而降低性能。应该尽量使用简单的动画效果。</p>
<h3 data-id="heading-26">5.3 在动画中使用 will-change 属性</h3>
<p><code>will-change</code> 属性可以告诉浏览器哪些属性将要被改变，从而提前进行优化，减少渲染负担。</p>
<h3 data-id="heading-27">5.4 使用 requestAnimationFrame() 函数来优化动画</h3>
<p><code>requestAnimationFrame()</code> 函数可以在浏览器下一次渲染之前执行代码，从而减少渲染负担，提高性能。</p>
<h2 data-id="heading-28">6、CSS 渲染性能优化</h2>
<h3 data-id="heading-29">6.1 使用 class 合并 DOM 的修改</h3>
<p>比如我们需要根据不同情况给一个元素添加不同的样式，可能会写出如下的代码：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> el = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.box'</span>);
<span class="hljs-keyword">if</span> (isHover) {
  el.<span class="hljs-property">style</span>.<span class="hljs-property">color</span> = <span class="hljs-string">'red'</span>;
  el.<span class="hljs-property">style</span>.<span class="hljs-property">background</span> = <span class="hljs-string">'blue'</span>;
} <span class="hljs-keyword">else</span> {
  el.<span class="hljs-property">style</span>.<span class="hljs-property">color</span> = <span class="hljs-string">'blue'</span>;
  el.<span class="hljs-property">style</span>.<span class="hljs-property">background</span> = <span class="hljs-string">'red'</span>;
}
</code></pre>
<p>这时候我们可以定义两个 <code>class</code> 类，然后直接切换类名即可。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> el = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.box'</span>);
<span class="hljs-keyword">if</span> (isHover) {
  el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'normal'</span>);
  el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'hover'</span>);
} <span class="hljs-keyword">else</span> {
  el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'hover'</span>);
  el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'normal'</span>);
}
</code></pre>
<h3 data-id="heading-30">6.2 让 DOM 元素脱离文档流</h3>
<p>使用 <code>absoulte</code> 或者 <code>fixed</code> 定位让 DOM 元素脱离文档流，这样在修改 DOM 元素的时候不会影响到其他 DOM 元素的布局，从而提高渲染性能。</p>
<h2 data-id="heading-31">7、总结</h2>
<p>本文主要通过<strong>CSS 加载性能优化</strong>、<strong>CSS 选择器性能优化</strong>、<strong>CSS 属性性能优化</strong>、<strong>CSS 动画性能优化</strong>和<strong>CSS 渲染性能优化</strong>这些方向介绍了 CSS 的性能优化技巧。通过优化 CSS 性能，可以提高网站的性能和用户体验。</p>
<p>在实际开发中，可根据实际业务场景和需要去进行优化。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[devstack中的systemd管理介绍]]></title>    <link>https://juejin.cn/post/7575182522411679782</link>    <guid>https://juejin.cn/post/7575182522411679782</guid>    <pubDate>2025-11-23T13:07:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575182522411679782" data-draft-id="7575456858426916910" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="devstack中的systemd管理介绍"/> <meta itemprop="keywords" content="OpenStack"/> <meta itemprop="datePublished" content="2025-11-23T13:07:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            devstack中的systemd管理介绍
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T13:07:22.000Z" title="Sun Nov 23 2025 13:07:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>理解 <strong>systemd</strong> 以及它在 <strong>DevStack</strong> 中的作用，对于掌握现代 Linux 系统和 OpenStack 开发环境至关重要。下面我们将从基础到深入，系统性地讲解：</p>
<hr/>
<h2 data-id="heading-0">🧱 一、systemd 是什么？</h2>
<p><strong>systemd</strong> 是 Linux 操作系统中一个<strong>现代化的初始化系统（init system）和服务管理器</strong>，用于：</p>
<ul>
<li>启动操作系统（替代传统的 SysV init 或 Upstart）</li>
<li>管理系统服务（启动、停止、重启、监控）</li>
<li>处理设备挂载、日志、定时任务、网络配置等</li>
</ul>
<blockquote>
<p>💡 简单说：<strong>systemd 是 Linux 系统的“总管家”</strong>，负责从开机到关机的所有核心进程管理。</p>
</blockquote>
<h3 data-id="heading-1">✅ 主要特性</h3>

































<table><thead><tr><th>特性</th><th>说明</th></tr></thead><tbody><tr><td><strong>并行启动</strong></td><td>服务可并行加载，加快开机速度</td></tr><tr><td><strong>按需启动（socket activation）</strong></td><td>服务在被访问时才启动（如 SSH）</td></tr><tr><td><strong>依赖管理</strong></td><td>自动处理服务之间的依赖关系</td></tr><tr><td><strong>统一日志（journald）</strong></td><td>所有服务日志集中管理（<code>journalctl</code>）</td></tr><tr><td><strong>资源控制（cgroups）</strong></td><td>限制 CPU、内存、IO 使用</td></tr><tr><td><strong>服务状态监控</strong></td><td>自动重启崩溃的服务</td></tr></tbody></table>
<blockquote>
<p>📌 几乎所有主流 Linux 发行版（Ubuntu ≥16.04, CentOS ≥7, Debian ≥8）默认使用 systemd。</p>
</blockquote>
<hr/>
<h2 data-id="heading-2">🔧 二、DevStack 早期 vs 现代：为什么引入 systemd？</h2>
<h3 data-id="heading-3">🕰️ 早期 DevStack（2015–2021）：使用 <code>screen</code>/<code>tmux</code></h3>
<ul>
<li>所有 OpenStack 服务（nova-api、keystone、neutron-server 等）以<strong>独立进程</strong>方式运行</li>
<li>进程由 <code>stack.sh</code> 脚本直接 fork 启动</li>
<li>日志输出到 <code>/opt/stack/logs/*.log</code></li>
<li>使用 <code>screen -r stack</code> 查看各服务窗口</li>
</ul>
<h4 data-id="heading-4">❌ 缺点：</h4>
<ol>
<li><strong>进程管理混乱</strong>：没有统一的启停机制</li>
<li><strong>崩溃不自动恢复</strong>：服务挂了不会自动重启</li>
<li><strong>日志分散</strong>：需要手动 tail 多个文件</li>
<li><strong>权限/环境隔离差</strong>：所有服务以 <code>stack</code> 用户运行，无 cgroups 隔离</li>
<li><strong>不符合生产实践</strong>：真实生产环境都用 systemd 管理服务</li>
</ol>
<hr/>
<h3 data-id="heading-5">✅ 现代 DevStack（Yoga 版本起，默认启用 systemd）</h3>
<p>从 <strong>OpenStack Yoga（2022.1）</strong> 开始，DevStack 默认启用 <code>USE_SYSTEMD=True</code>，将每个 OpenStack 服务注册为 <strong>systemd unit</strong>。</p>
<p>例如：</p>
<ul>
<li><code>devstack@keystone.service</code></li>
<li><code>devstack@nova-api.service</code></li>
<li><code>devstack@neutron-server.service</code></li>
</ul>
<h4 data-id="heading-6">✅ 优势：</h4>

































<table><thead><tr><th>优势</th><th>说明</th></tr></thead><tbody><tr><td><strong>标准化</strong></td><td>与生产环境部署方式一致（如 Kolla、Charmed OpenStack 也用 systemd）</td></tr><tr><td><strong>健壮性</strong></td><td>systemd 可自动重启崩溃的服务（通过 <code>Restart=always</code>）</td></tr><tr><td><strong>日志集中</strong></td><td>使用 <code>journalctl</code> 统一查看、过滤、导出日志</td></tr><tr><td><strong>资源隔离</strong></td><td>可通过 systemd 配置限制内存/CPU（未来扩展）</td></tr><tr><td><strong>依赖清晰</strong></td><td>服务启动顺序由 <code>After=</code>、<code>Wants=</code> 显式定义</td></tr><tr><td><strong>启停方便</strong></td><td><code>systemctl start/stop devstack@keystone</code></td></tr></tbody></table>
<blockquote>
<p>💡 这让 DevStack 从“开发玩具”向“贴近生产”的开发环境演进。</p>
</blockquote>
<hr/>
<h2 data-id="heading-7">🏗️ 三、DevStack 如何使用 systemd？</h2>
<h3 data-id="heading-8">1. <strong>服务单元文件生成</strong></h3>
<p>当你运行 <code>./stack.sh</code> 时，DevStack 会为每个服务动态生成 systemd unit 文件，例如：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># /etc/systemd/system/devstack@keystone.service</span>
<span class="hljs-section">[Unit]</span>
<span class="hljs-attr">Description</span>=Devstack keystone
<span class="hljs-attr">After</span>=network.target mariadb.service rabbitmq-server.service

<span class="hljs-section">[Service]</span>
<span class="hljs-attr">Type</span>=simple
<span class="hljs-attr">User</span>=stack
<span class="hljs-attr">WorkingDirectory</span>=/opt/stack/keystone
<span class="hljs-attr">ExecStart</span>=/opt/stack/keystone/bin/keystone-wsgi-public --port <span class="hljs-number">5000</span>
<span class="hljs-attr">Restart</span>=always
<span class="hljs-attr">RestartSec</span>=<span class="hljs-number">5</span>

<span class="hljs-section">[Install]</span>
<span class="hljs-attr">WantedBy</span>=multi-user.target
</code></pre>
<h3 data-id="heading-9">2. <strong>服务启停流程</strong></h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启动 Keystone</span>
sudo systemctl start devstack@keystone

<span class="hljs-comment"># 停止</span>
sudo systemctl stop devstack@keystone

<span class="hljs-comment"># 查看状态</span>
sudo systemctl status devstack@keystone

<span class="hljs-comment"># 设置开机自启（DevStack 不需要，但机制存在）</span>
sudo systemctl <span class="hljs-built_in">enable</span> devstack@keystone
</code></pre>
<blockquote>
<p>🔍 注意：<code>@</code> 符号表示这是一个 <strong>模板化服务（instantiated service）</strong>，<code>keystone</code> 是实例名。</p>
</blockquote>
<hr/>
<h2 data-id="heading-10">📊 四、systemd vs 传统日志对比（DevStack 场景）</h2>



































<table><thead><tr><th>功能</th><th>传统模式（非 systemd）</th><th>systemd 模式</th></tr></thead><tbody><tr><td><strong>日志位置</strong></td><td><code>/opt/stack/logs/keystone.log</code></td><td><code>journalctl -u devstack@keystone</code></td></tr><tr><td><strong>实时跟踪</strong></td><td><code>tail -f keystone.log</code></td><td><code>journalctl -u devstack@keystone -f</code></td></tr><tr><td><strong>按时间查询</strong></td><td>需配合 <code>grep</code> + 时间戳</td><td><code>--since "1 hour ago"</code></td></tr><tr><td><strong>导出日志</strong></td><td>直接复制文件</td><td><code>journalctl -u ... &gt; keystone.log</code></td></tr><tr><td><strong>多服务对比</strong></td><td>需开多个终端</td><td><code>journalctl -u devstack@nova-api -u devstack@keystone</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-11">⚙️ 五、如何控制 DevStack 的 systemd 行为？</h2>
<h3 data-id="heading-12">1. <strong>禁用 systemd（回到传统模式）</strong></h3>
<p>编辑 <code>~/devstack/local.conf</code>：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[[local|localrc]]</span>
<span class="hljs-attr">USE_SYSTEMD</span>=<span class="hljs-literal">False</span>
</code></pre>
<p>然后重新部署：</p>
<pre><code class="hljs language-bash" lang="bash">./unstack.sh
./clean.sh
./stack.sh
</code></pre>
<blockquote>
<p>⚠️ 注意：新版本 DevStack 可能逐渐弃用非 systemd 模式。</p>
</blockquote>
<hr/>
<h3 data-id="heading-13">2. <strong>调试 systemd 服务</strong></h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看服务详细状态（含最近日志）</span>
systemctl status devstack@keystone

<span class="hljs-comment"># 查看服务的 unit 文件内容</span>
systemctl <span class="hljs-built_in">cat</span> devstack@keystone

<span class="hljs-comment"># 重新加载 systemd 配置（修改 unit 后需要）</span>
sudo systemctl daemon-reload
</code></pre>
<hr/>
<h3 data-id="heading-14">3. <strong>临时覆盖配置（无需改 DevStack 源码）</strong></h3>
<p>创建 override 目录：</p>
<pre><code class="hljs language-bash" lang="bash">sudo systemctl edit devstack@keystone
</code></pre>
<p>输入自定义配置（例如增加环境变量）：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[Service]</span>
<span class="hljs-attr">Environment</span>=KEYSTONE_DEBUG=<span class="hljs-literal">True</span>
</code></pre>
<p>保存后自动生效（相当于创建了 <code>/etc/systemd/system/devstack@keystone.service.d/override.conf</code>）。</p>
<hr/>
<h2 data-id="heading-15">🌐 六、为什么这对 OpenStack 开发者重要？</h2>
<ol>
<li>
<p><strong>贴近真实环境</strong><br/>
生产 OpenStack 部署（如 RDO、Mirantis）几乎都用 systemd 管理服务，DevStack 保持一致可减少“在我机器上能跑”的问题。</p>
</li>
<li>
<p><strong>更好的调试体验</strong><br/>
<code>journalctl</code> 支持结构化日志、时间范围过滤、优先级筛选，比 <code>grep</code> 日志文件高效得多。</p>
</li>
<li>
<p><strong>服务生命周期管理标准化</strong><br/>
你可以用熟悉的 <code>systemctl</code> 命令控制任何 OpenStack 服务，无需记忆 DevStack 特有脚本。</p>
</li>
<li>
<p><strong>为容器化过渡打基础</strong><br/>
systemd 的 cgroups 和资源控制能力，是未来向 systemd-nspawn 或 Podman 迁移的基础。</p>
</li>
</ol>
<hr/>
<h2 data-id="heading-16">📚 七、常见命令速查表</h2>

































<table><thead><tr><th>场景</th><th>命令</th></tr></thead><tbody><tr><td>查看所有 DevStack 服务</td><td><code>systemctl list-units | grep devstack</code></td></tr><tr><td>实时跟踪 Keystone 日志</td><td><code>sudo journalctl -u devstack@keystone -f</code></td></tr><tr><td>查看最近 50 行日志</td><td><code>sudo journalctl -u devstack@keystone -n 50</code></td></tr><tr><td>按时间查日志</td><td><code>sudo journalctl -u devstack@keystone --since "2025-11-23 10:00"</code></td></tr><tr><td>重启 Nova API</td><td><code>sudo systemctl restart devstack@nova-api</code></td></tr><tr><td>检查服务是否开机自启</td><td><code>systemctl is-enabled devstack@keystone</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-17">✅ 总结</h2>
<blockquote>
<p><strong>systemd 是现代 Linux 的基石，DevStack 采用它是为了：</strong></p>
<ul>
<li>✅ <strong>标准化</strong>：与生产环境对齐</li>
<li>✅ <strong>健壮性</strong>：自动重启、依赖管理</li>
<li>✅ <strong>可观测性</strong>：集中日志（journalctl）</li>
<li>✅ <strong>可维护性</strong>：统一的服务控制接口</li>
</ul>
</blockquote>
<p>虽然初期可能需要适应 <code>journalctl</code> 而不是 <code>.log</code> 文件，但从长远看，这大大提升了开发和调试效率。</p>
<blockquote>
<p>💡 <strong>建议</strong>：拥抱 systemd！学习 <code>journalctl</code> 的高级用法（如 <code>-o json</code>、<code>_PID=</code>、<code>PRIORITY=</code>），你会爱上它。</p>
</blockquote>
<p>如果你正在开发 OpenStack 插件或调试服务崩溃问题，systemd + journald 组合将是你最强大的助手！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[提示词工程没死，只是藏得更深了]]></title>    <link>https://juejin.cn/post/7575425466905247807</link>    <guid>https://juejin.cn/post/7575425466905247807</guid>    <pubDate>2025-11-23T13:12:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575425466905247807" data-draft-id="7575458028254838827" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="提示词工程没死，只是藏得更深了"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-11-23T13:12:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="飞哥数智谈"/> <meta itemprop="url" content="https://juejin.cn/user/3825956195409223"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            提示词工程没死，只是藏得更深了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3825956195409223/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    飞哥数智谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T13:12:26.000Z" title="Sun Nov 23 2025 13:12:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>今天给大家分享一个 AI 起名从“平庸”到“惊艳”的过程，并聊聊<strong>少样本提示</strong>的使用感悟。</p>
<p>事情是这样的，下午，我在家鼓捣一个可以帮我更好地使用 AI 助手的小工具。</p>
<p>忽然发现虽然已经开发挺久了，但却一直没有设计名字，就叫做“AI助手”，没有辨识度，也体现不了独特性。</p>
<p>今天有空，就和 AI 聊聊，让它帮我起个好名字。</p>
<p>中文语言相关的问题，我还是更喜欢通义的脾性，以下内容都是使用通义官网完成的。</p>
<h2 data-id="heading-0">第一轮的对话</h2>
<p><strong>指令</strong></p>
<pre><code class="hljs">我想要实现一个应用，辅助各种AIagent的使用，请帮我设计应用名称，想要突出ai助手的助手这个点
</code></pre>
<p><strong>结果</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82e742e05fed4442a2bd56dfa1a8ffbd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764508345&amp;x-signature=egIoyjTOXldk3Gdn3RYHZT1fVtU%3D" alt="" loading="lazy"/></p>
<p><strong>小结</strong></p>
<p>先不说给我提供了这么多的英文名称，就最后的几个中文名称，我感觉也只能算是没有语法错误。</p>
<h2 data-id="heading-1">有感悟的第二轮对话</h2>
<p>接下来就是比较重要的第二轮对话。</p>
<p><strong>指令</strong></p>
<pre><code class="hljs">上次我要做的碎片知识管理工具，给出的“集萤”，就非常惊艳，这些有些普通
</code></pre>
<p><strong>结果</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22ac81d41df7431b97f783f0c8a74996~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764508345&amp;x-signature=gf6Xud7qh%2Bfpo00cgV1cjcHAXhM%3D" alt="" loading="lazy"/></p>
<p><strong>小结</strong></p>
<p>可以看到，给出的结果已经开始符合我的预期了，但是还需要再稍微调整下。</p>
<h2 data-id="heading-2">微调的第三轮对话</h2>
<p>这一轮对话没有特别需要注意的地方，仅仅是为了保持过程的完整性，大家可以直接跳到后面的感悟部分。</p>
<p><strong>指令</strong></p>
<pre><code class="hljs">辅辰这思路挺好，低调和高调结合，但是辰和AI相关度不是特别大， 能否再优化下
</code></pre>
<p><strong>结果</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35c4830eeaa647d99ae9ff378fa3d510~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764508345&amp;x-signature=1A2Jpf7HMGMMjUyBGQzIEjNf%2BjE%3D" alt="" loading="lazy"/></p>
<p><strong>小结</strong></p>
<p>最后，我选择了“<strong>辅曜</strong>”。</p>
<p><strong>每个 AI 都在发光，而我帮你沐浴光辉</strong>。</p>
<p>保持“诗意隐喻 + 功能内核”的风格。</p>
<p>命名喜好，仁者见仁，但最后结果挺符合我心意的。</p>
<h2 data-id="heading-3">感悟</h2>
<p>大家可以对比下第二轮和第一轮的对话，核心就是我找了一个喜欢的<strong>示例</strong>（集萤），同时把示例的<strong>背景</strong>（碎片知识管理工具）交代清楚。</p>
<p>这样，AI 就会自动分析<strong>背景知识和取名结果之间的推导思路</strong>，进而生成符合我预期的名称。</p>
<p>这个过程很像我们小时候从一堆数里面找规律，然后推导下一个数，现在的 AI 已经可以从非常复杂、高维的角度推导出规律来了。</p>
<p>我倒是知道，<strong>现在 AI 的底层是统计、是概率，但谁又能说只有人类的思维方式才是“智能”呢</strong>？</p>
<p>另一个感悟的点是关于提示词的。去年，“提示词工程”大火，今年模型能力大幅提升后，很多人认为提示词工程不重要了，包括我之前也是这样认为的。</p>
<p>但今天与 AI 的沟通，本质上还是应用了“提示词工程”（<strong>少样本提示</strong>），只是由于模型能力的提升，可以不像去年那么注重格式上的要求了。</p>
<h2 data-id="heading-4">结语</h2>
<p>这两年使用 AI 的过程中，积累了不少这种不起眼，但却很有效果的小技巧，就像很多说不清原理的“<strong>土法子</strong>”一样，我也只是从表面现象上试图解释下。</p>
<p>网上这类资料不是很多，这几天我在想要不要把这类型分享好好整理下，形成一个体系化的合集。大家可以在下面留言告诉我哈~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入Android系统（十三）Android的窗口系统]]></title>    <link>https://juejin.cn/post/7575106644499578914</link>    <guid>https://juejin.cn/post/7575106644499578914</guid>    <pubDate>2025-11-23T13:16:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575106644499578914" data-draft-id="7575363120798466048" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入Android系统（十三）Android的窗口系统"/> <meta itemprop="keywords" content="Android,源码,设计模式"/> <meta itemprop="datePublished" content="2025-11-23T13:16:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="apigfly"/> <meta itemprop="url" content="https://juejin.cn/user/2488950054453613"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入Android系统（十三）Android的窗口系统
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2488950054453613/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    apigfly
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T13:16:04.000Z" title="Sun Nov 23 2025 13:16:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读19分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><code>Android</code>的窗口系统由<code>WindowManagerService</code>管理，包括增加和删除窗口，确定窗口的大小和位置，以及实现窗口切换、窗口动画等功能。<code>WindowManagerService</code>名字较长，后面简称<code>WMS</code></p>
<h2 data-id="heading-0">前言</h2>
<blockquote>
<p>一个小问题</p>
</blockquote>
<p>在 Android 中<code>Activity</code>可以理解成 Android 中的一个页面，前面的章节我们说 <code>SurfaceFlinger</code> 最后会把 <code>Surface</code> 对应的 <code>Layer</code> 合成到屏幕上。那么<strong>Activity 和 Surface 的关系又是怎么关联的呢？</strong></p>
<p>让我们一起排查下～～～</p>
<h2 data-id="heading-1">应用进程和<code>WMS</code>的联系</h2>
<p>在学习<code>WMS</code>之前，我们先了解下应用和<code>WMS</code>之间的联系。对于应用来说：</p>
<ul>
<li>
<p><code>Activity</code></p>
<ul>
<li><code>Activity</code>并不负责视图控制，它只是控制生命周期和处理事件</li>
<li>真正控制视图的是<code>Window</code>。一个<code>Activity</code>包含了一个<code>Window</code>，<code>Window</code>才是真正代表一个窗口</li>
<li><code>Activity</code>就像一个控制器，统筹视图的添加与显示，以及通过其他回调方法，来与<code>Window</code>、以及<code>View</code>进行交互</li>
</ul>
</li>
<li>
<p><code>Window</code></p>
<ul>
<li><code>Window</code>是视图的承载器，内部持有一个<code>DecorView</code>，而这个<code>DecorView</code>才是<code>view</code>的根布局</li>
<li><code>Window</code>是一个抽象类，实际在<code>Activity</code>中持有的是其子类<code>PhoneWindow</code></li>
<li><code>PhoneWindow</code>中有个内部类<code>DecorView</code>，通过创建<code>DecorView</code>来加载<code>Activity</code>中``传递的布局</li>
<li><code>Window</code>通过<code>WindowManager</code>将<code>DecorView</code>加载其中，并将<code>DecorView</code>交给<code>ViewRoot</code>，进行视图绘制以及其他交互</li>
</ul>
</li>
<li>
<p><code>ViewRoot</code></p>
<ul>
<li>所有<code>View</code>的绘制以及事件分发等交互都是通过它来执行或传递的</li>
<li><code>ViewRoot</code>对应的实现类是<code>ViewRootImpl</code>类，它是连接<code>WindowManagerService</code>和<code>DecorView</code>的纽带</li>
<li><code>View</code>的三大流程：测量(measure)、布局(layout)、绘制 (draw))均通过<code>ViewRoot</code>来完成</li>
</ul>
</li>
</ul>
<p>除了上面这三部分，还有一个是在<code>Android</code>应用中存在的一个唯一的<code>WindowManagerGlobal</code>对象，它们的类图关系如下：<br/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3f91ffc402e497986337eba12df2b94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYXBpZ2ZseQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764508564&amp;x-signature=vkLls2NZ4xOy1Jgqwi5BfD6K2Os%3D" alt="image" loading="lazy"/></p>
<h3 data-id="heading-2">应用中的Window对象</h3>
<p>应用中的每个<code>Activity</code>对象都有一个类型为<code>Window</code>的成员变量<code>mWindow</code>，定义如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Activity</span> {
    ...
    <span class="hljs-keyword">private</span> Window mWindow;
    ...
}
</code></pre>
<p><code>Window</code>对象在应用进程代表了一个窗口，这是一块矩形的图像绘制区域。</p>
<p>从<code>WMS</code>的角度来说，它并不关系应用中的各种<code>View</code>，他管理和调度的对象是<code>Window</code>。<code>Activity</code>中的<code>View</code>树不管多复杂，最后输出的也仅仅是一张各个<code>View</code>合成的图像而已。</p>
<p><code>Window</code>是一个抽象类，在<code>Activity</code>类的<code>attach()</code>方法中会对成员变量<code>mWindow</code>进行初始化，代码如下：</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">attach</span><span class="hljs-params">(...)</span> {
        ...
        mWindow = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PhoneWindow</span>(<span class="hljs-built_in">this</span>, window, activityConfigCallback);
        ...
    }
</code></pre>
<p><code>attach()</code>方法中<code>mWindow</code>实例化成了一个<code>PhoneWindow</code>对象。</p>
<p>而对于<code>PhoneWindow</code>对象，需要我们关注的部分是如下两个成员变量：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PhoneWindow</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Window</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MenuBuilder</span>.Callback {
    <span class="hljs-comment">// This is the top-level view of the window, containing the window decor.</span>
    <span class="hljs-keyword">private</span> DecorView mDecor;
    <span class="hljs-comment">// This is the view in which the window contents are placed. It is either</span>
    <span class="hljs-comment">// mDecor itself, or a child of mDecor where the contents go.</span>
    ViewGroup mContentParent;
    ...
}
</code></pre>
<ul>
<li>
<p><code>mDecor</code>的类型是<code>DecorView</code>，它是<code>FrameLayout</code>的子类，它可以被认为是<code>Android</code>视图树的根节点视图。</p>
<ul>
<li><code>DecorView</code>作为顶级<code>View</code>，它加载的资源文件内部会包含一个<code>android:id="@android:id/content"</code>的<code>ViewGroup</code></li>
<li>这个<code>ViewGroup</code>便是后面用来添加<code>setContentView()</code>方法传入的<code>layout</code>布局文件</li>
<li><code>DecorView</code>具体加载哪种布局文件和主题有关，这部分在<code>PhoneWindow</code>的<code>generateLayout()</code>方法中体现</li>
</ul>
</li>
<li>
<p><code>mContentParent</code>的类型是<code>ViewGroup</code>，它其实就是<code>android:id="@android:id/content"</code>对应的组件</p>
<ul>
<li>跟踪<code>generateLayout()</code>方法就会发现如下代码：</li>
</ul>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-type">ViewGroup</span> <span class="hljs-variable">contentParent</span> <span class="hljs-operator">=</span> (ViewGroup)findViewById(ID_ANDROID_CONTENT);
</code></pre>
<ul>
<li><code>contentParent</code>创建完成后便会赋值给<code>mContentParent</code>，而此处的<code>ID_ANDROID_CONTENT</code>的定义是在<code>Window.java</code>中</li>
</ul>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">ID_ANDROID_CONTENT</span> <span class="hljs-operator">=</span> com.android.internal.R.id.content;
</code></pre>
</li>
</ul>
<h3 data-id="heading-3">应用中的WindowManager对象</h3>
<p>应用中的每个<code>Activity</code>对象都有一个类型为<code>WindowManager</code>的成员变量<code>mWindowManager</code>，定义如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Activity</span> {
    ...
    <span class="hljs-keyword">private</span> WindowManager mWindowManager;
    ...
}
</code></pre>
<p><code>mWindowManager</code>用于和<code>WMS</code>通信，不过<code>WindowManager</code>是一个接口类，定义如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">WindowManager</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ViewManager</span> {...}
</code></pre>
<p><code>mWindowManager</code>也是在<code>attach()</code>方法中进行的初始化，相关代码如下：</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">attach</span><span class="hljs-params">(...)</span> {
        ...
        mWindow = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PhoneWindow</span>(<span class="hljs-built_in">this</span>, window, activityConfigCallback);
        ...
        mWindow.setWindowManager(
                (WindowManager)context.getSystemService(Context.WINDOW_SERVICE),
                mToken, mComponent.flattenToString(),
                (info.flags &amp; ActivityInfo.FLAG_HARDWARE_ACCELERATED) != <span class="hljs-number">0</span>);
        ...
        mWindowManager = mWindow.getWindowManager();
        ...
    }
</code></pre>
<p>在<code>attach()</code>方法中，对<code>mWindowManager</code>变量的赋值是调用<code>mWindow</code>的<code>getWindowManager()</code>方法完成的。</p>
<p>但是在这之前，<code>attach()</code>方法中还调用了<code>mWindow</code>对象的<code>setWindowManager()</code>方法。前面我们已经知道<code>mWindow</code>对象的类型是<code>PhoneWindow</code>，不过这个<code>setWindowManager()</code>方法是在基类<code>Window</code>中实现的，代码如下：</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setWindowManager</span><span class="hljs-params">(WindowManager wm, IBinder appToken, String appName,
            <span class="hljs-type">boolean</span> hardwareAccelerated)</span> {
        mAppToken = appToken;
        mAppName = appName;
        mHardwareAccelerated = hardwareAccelerated
                || SystemProperties.getBoolean(PROPERTY_HARDWARE_UI, <span class="hljs-literal">false</span>);
        <span class="hljs-keyword">if</span> (wm == <span class="hljs-literal">null</span>) {
            wm = (WindowManager)mContext.getSystemService(Context.WINDOW_SERVICE);
        }
        mWindowManager = ((WindowManagerImpl)wm).createLocalWindowManager(<span class="hljs-built_in">this</span>);
    }
    <span class="hljs-keyword">public</span> WindowManager <span class="hljs-title function_">getWindowManager</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> mWindowManager;
    }
</code></pre>
<p>在<code>setWindowManager()</code>方法中，调用了<code>WindowManagerImpl</code>类的<code>createLocalWindowManager()</code>方法创建了<code>mWindowManager</code>对象，这个方法也很简单：</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> WindowManagerImpl <span class="hljs-title function_">createLocalWindowManager</span><span class="hljs-params">(Window parentWindow)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WindowManagerImpl</span>(mContext, parentWindow);
    }
</code></pre>
<p><code>createLocalWindowManager()</code>方法中新创建了一个<code>WindowManagerImpl</code>对象，因此，每个<code>Activity</code>中的<code>mWindowManager</code>对象实际上是一个<code>WindowManagerImpl</code>对象，我们再看下这个类的定义：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WindowManagerImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WindowManager</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">WindowManagerGlobal</span> <span class="hljs-variable">mGlobal</span> <span class="hljs-operator">=</span> WindowManagerGlobal.getInstance();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Context mContext;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Window mParentWindow;
    ...
}
</code></pre>
<p>在<code>WindowManagerImpl</code>中定义了一个<code>mGlobal</code>变量，它的值是通过<code>WindowManagerGlobal.getInstance()</code>得到的，看样子是个单例模式，代码如下：</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> WindowManagerGlobal <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">synchronized</span> (WindowManagerGlobal.class) {
            <span class="hljs-keyword">if</span> (sDefaultWindowManager == <span class="hljs-literal">null</span>) {
                sDefaultWindowManager = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WindowManagerGlobal</span>();
            }
            <span class="hljs-keyword">return</span> sDefaultWindowManager;
        }
    }
</code></pre>
<p><code>getInstance()</code>方法中创建了一个全局唯一的<code>WindowManagerGlobal</code>对象并保存到静态变量<code>sDefaultWindowManager</code>中</p>
<p>而<code>WindowManagerImpl</code>中各种方法的实现只是在转调<code>WindowManagerGlobal</code>类中的方法，由此可见，<strong>一个应用中所有<code>Activity</code>都是通过这个进程内唯一的<code>WindowManagerGlobal</code>对象和<code>WMS</code>通信</strong></p>
<p><code>WindowManagerGlobal</code>类中还有3个重要的成员变量：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WindowManagerGlobal</span> {
    ...
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ArrayList&lt;View&gt; mViews = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;View&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ArrayList&lt;ViewRootImpl&gt; mRoots = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;ViewRootImpl&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ArrayList&lt;WindowManager.LayoutParams&gt; mParams =
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;WindowManager.LayoutParams&gt;();
    ...
}
</code></pre>
<ul>
<li><code>mViews</code>：保存了应用中所有顶层<code>View</code>对象，也就是<code>DecorView</code>(稍后细讲)</li>
<li><code>mRoots</code>：保存的是和顶层<code>View</code>对象关联的<code>ViewRootImpl</code>对象</li>
<li><code>mParams</code>：保存的是创建顶层<code>View</code>的<code>layout</code>参数</li>
</ul>
<h3 data-id="heading-4">建立应用和WMS的联系</h3>
<p>我们知道在<code>ActivityThread</code>中的<code>handleResumeActivity()</code>中会创建<code>ViewRootImpl</code>对象并进行显示，我们来看下<code>ViewRootImpl</code>中关键的几个变量：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewRootImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ViewParent</span>,
        View.AttachInfo.Callbacks, ThreadedRenderer.DrawCallbacks {
    ...
    <span class="hljs-keyword">final</span> IWindowSession mWindowSession;
    ...
    <span class="hljs-keyword">final</span> W mWindow;
    ...
}
</code></pre>
<p>变量的初始化是在构造方法中，代码如下：</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ViewRootImpl</span><span class="hljs-params">(Context context, Display display)</span> {
        mContext = context;
        mWindowSession = WindowManagerGlobal.getWindowSession();
        ...
        mWindow = <span class="hljs-keyword">new</span> <span class="hljs-title class_">W</span>(<span class="hljs-built_in">this</span>);
        ...
    }
</code></pre>
<p>重点是进行了<code>mWindowSession</code>和<code>mWindow</code>的创建，我们逐一看下</p>
<h4 data-id="heading-5">IWindowSession对象的创建</h4>
<p><code>mWindowSession</code>变量的类型是<code>IWindowSession</code>，它是<code>WMS</code>中某个<code>Binder</code>对象的引用对象，<code>mWindowSession</code>的值是通过<code>WindowManagerGlobal</code>的<code>getWindowSession()</code>方法获得的，代码如下：</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IWindowSession <span class="hljs-title function_">getWindowSession</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">synchronized</span> (WindowManagerGlobal.class) {
            <span class="hljs-keyword">if</span> (
            `sWindowSession`== <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-type">InputMethodManager</span> <span class="hljs-variable">imm</span> <span class="hljs-operator">=</span> InputMethodManager.getInstance();
                    <span class="hljs-type">IWindowManager</span> <span class="hljs-variable">windowManager</span> <span class="hljs-operator">=</span> getWindowManagerService();
                    sWindowSession = windowManager.openSession(
                            <span class="hljs-keyword">new</span> <span class="hljs-title class_">IWindowSessionCallback</span>.Stub() {
                                <span class="hljs-meta">@Override</span>
                                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onAnimatorScaleChanged</span><span class="hljs-params">(<span class="hljs-type">float</span> scale)</span> {
                                    ValueAnimator.setDurationScale(scale);
                                }
                            },
                            imm.getClient(), imm.getInputContext());
                } <span class="hljs-keyword">catch</span> (RemoteException e) {
                    <span class="hljs-keyword">throw</span> e.rethrowFromSystemServer();
                }
            }
            <span class="hljs-keyword">return</span> sWindowSession;
        }
    }
</code></pre>
<p>如果<code>sWindowSession</code>为空，先获取<code>InputMethodManager</code>对象，然后调用<code>WMS</code>的<code>openSession()</code>接口来进行创建，代码如下：</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> IWindowSession <span class="hljs-title function_">openSession</span><span class="hljs-params">(IWindowSessionCallback callback, IInputMethodClient client,
            IInputContext inputContext)</span> {
        <span class="hljs-keyword">if</span> (client == <span class="hljs-literal">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"null client"</span>);
        <span class="hljs-keyword">if</span> (inputContext == <span class="hljs-literal">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"null inputContext"</span>);
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Session</span>(<span class="hljs-built_in">this</span>, callback, client, inputContext);
        <span class="hljs-keyword">return</span> session;
    }
</code></pre>
<p><code>openSession()</code>直接创建了一个<code>Session</code>对象，这个<code>Session</code>类我们<a href="https://juejin.cn/post/6944960866404007944#heading-5" target="_blank" title="https://juejin.cn/post/6944960866404007944#heading-5">图像显示部分</a>简单介绍过，它是一个<code>Binder</code>服务类，简要定义如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Session</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IWindowSession</span>.Stub <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IBinder</span>.DeathRecipient {...}
</code></pre>
<p>对于用户进程而言，获取到的便是这个<code>Session</code>对象的<code>Binder</code>引用对象，并保存在了<code>WindowManagerGlobal</code>的静态变量<code>sWindowSession</code>中。</p>
<p>因为<code>WindowManagerGlobal</code>在进程中属于单例的存在，因此，所有调用<code>getWindowSession()</code>方法返回的都是这个<code>sWindowSession</code>对象</p>
<p>因此，<strong>一个用户进程中的所有<code>ViewRootImpl</code>对象中的<code>mWindowSession</code>都引用的是相同的对象</strong>。而这个<code>mWindowSession</code>对象的作用便是向<code>WMS</code>发起<code>Window</code>相关的<code>Binder</code>调用</p>
<blockquote>
<p>应用进程通过<code>sWindowSession</code>对象可以调用到<code>WMS</code>的功能方法了，那么<code>WMS</code>是如何通知或者控制应用进程的呢？</p>
</blockquote>
<h4 data-id="heading-6">W</h4>
<p>在<a href="https://juejin.cn/post/6944960866404007944#heading-5" target="_blank" title="https://juejin.cn/post/6944960866404007944#heading-5">图像显示部分</a>已经介绍过<code>ActivityThread</code>的<code>handleResumeActivity()</code>方法了，最后会调用到<code>WindowManagerGlobal</code>对象的<code>addView()</code>方法，方法内容如下：</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addView</span><span class="hljs-params">(View view, ViewGroup.LayoutParams params,
            Display display, Window parentWindow)</span> {
        ...
        ViewRootImpl root;
        <span class="hljs-type">View</span> <span class="hljs-variable">panelParentView</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">synchronized</span> (mLock) {
            ...
            root = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ViewRootImpl</span>(view.getContext(), display);
            view.setLayoutParams(wparams);

            mViews.add(view);
            mRoots.add(root);
            mParams.add(wparams);

            <span class="hljs-keyword">try</span> {
                root.setView(view, wparams, panelParentView);
            }
            ...
        }
    }
</code></pre>
<p><code>addView()</code>方法中最重要的是创建了<code>ViewRootImpl</code>对象，并通过<code>setView()</code>把它和顶层的<code>View</code>对象关联在了一起。<code>setView()</code>方法简要如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setView</span><span class="hljs-params">(View view, WindowManager.LayoutParams attrs, View panelParentView)</span> {
    <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) {
        <span class="hljs-keyword">if</span> (mView == <span class="hljs-literal">null</span>) {
            mView = view;
            ...
            requestLayout();
            ...
            <span class="hljs-keyword">try</span> {
                mOrigWindowType = mWindowAttributes.type;
                mAttachInfo.mRecomputeGlobalAttributes = <span class="hljs-literal">true</span>;
                collectViewAttributes();
                res = mWindowSession.addToDisplay(mWindow, ...);
            }
            ...
        }
    }
}
</code></pre>
<p><code>setView()</code>方法比较长，我们需要关注的是：</p>
<ul>
<li>方法中对<code>ViewRootImpl</code>对象和顶层<code>View</code>之间的关联只会执行一次，如果<code>mView</code>不为空，不会再次赋值</li>
<li>方法中调用了<code>Session</code>的<code>addToDisplay()</code>方法，更为重要的是参数<code>mWindow</code></li>
</ul>
<p><code>mWindow</code>的类型是<code>W</code>，它是一个<code>ViewRootImpl</code>的静态内部类，定义如下：</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">W</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IWindow</span>.Stub {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> WeakReference&lt;ViewRootImpl&gt; mViewAncestor;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> IWindowSession mWindowSession;
        ...
    }
</code></pre>
<p>可以看出<code>W</code>是一个实现了<code>IWindow</code>接口的<code>Binder</code>服务类，并且在<code>ViewRootImpl</code>中通过<code>Session.addToDisplay()</code>方法将<code>W</code>的<code>Binder</code>引用对象传递给了<code>WMS</code></p>
<p>我们看下源码中对<code>IWindow</code>接口的描述：</p>
<blockquote>
<p>API back to a client window that the Window Manager uses to inform it of interesting things happening.</p>
</blockquote>
<p>可以看出<code>WMS</code>通过<code>IWindow</code>接口来通知应用，接下来看下<code>WMS</code>中是如何处理这个对象的</p>
<p><em><strong>秋地麻袋～，还记得我们前言中的问题吗，快看<code>setView</code>中的<code>requestLayout</code>方法</strong></em></p>
<blockquote>
<p>是不是勾起了作为应用开发者的回忆</p>
</blockquote>
<h4 data-id="heading-7">Surface 和 Activity 的联系</h4>
<p><code>ViewRootImpl.setView()</code> 会触发 <code>requestLayout()</code>，最终执行到核心方法 <code>performTraversals()</code>（这是 View 绘制三大流程 Measure/Layout/Draw 的入口）</p>
<p><code>performTraversals()</code> 800 多行。。。简要代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 伪代码逻辑 ViewRootImpl.java</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">performTraversals</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// ...</span>
    <span class="hljs-comment">// 1. 通过 IPC 请求 WindowManagerService (WMS) 对窗口进行布局</span>
    <span class="hljs-comment">// mSurface 是 ViewRootImpl 的成员变量</span>
    relayoutResult = mWindowSession.relayout(..., mSurface, ...);

    <span class="hljs-comment">// 2. WMS 在底层创建 SurfaceControl，并将 Native 层的 Surface 信息</span>
    <span class="hljs-comment">// 回写（Copy）到 ViewRootImpl 的 mSurface 中。</span>
    <span class="hljs-comment">// 后面会细讲</span>
    
    <span class="hljs-keyword">if</span> (mSurface.isValid()) {
        <span class="hljs-comment">// Surface 此时已经准备好，可以合成了</span>
    }
    <span class="hljs-comment">// ...</span>
    performMeasure(...);
    performLayout(...);
    performDraw(...);
}
</code></pre>
<p>在 <code>relayout</code> 过程中，<code>WMS</code> 会与 <code>SurfaceFlinger</code> 通信，分配 <code>Layer</code>（图层）。<code>WMS</code> 将生成的 <code>Surface</code> 信息填充到 <code>ViewRootImpl</code> 传入的 <code>mSurface</code> 参数中。</p>
<blockquote>
<p>这样，一个 Activity 就和 SurfaceFlinger 中的 Surface 产生了关联啦。</p>
</blockquote>
<p><span id="user-content-WMS2APP"/></p>
<h3 data-id="heading-8">WMS中建立和应用的关系</h3>
<p>前面提到<code>ViewRootImpl</code>对象会通过<code>addToDisplay()</code>方法将<code>IWindow</code>的<code>Binder</code>引用对象传递到<code>WMS</code>中，我们先看下<code>addToDisplay()</code>方法：</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-comment">// 方法定义在 com.android.server.wm.Session 中</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">addToDisplay</span><span class="hljs-params">(IWindow window, ...)</span> {
        <span class="hljs-comment">// mService 的类型便是 WindowManagerService</span>
        <span class="hljs-keyword">return</span> mService.addWindow(<span class="hljs-built_in">this</span>, window, ...);
    }
</code></pre>
<p>调用了<code>WMS</code>的<code>addWindow()</code>方法，代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">addWindow</span><span class="hljs-params">(Session session, IWindow client, ...)</span> {
    ...
    <span class="hljs-keyword">synchronized</span>(mWindowMap) {
        ...
        <span class="hljs-keyword">if</span> (mWindowMap.containsKey(client.asBinder())) {
            Slog.w(TAG_WM, <span class="hljs-string">"Window "</span> + client + <span class="hljs-string">" is already added"</span>);
            <span class="hljs-keyword">return</span> WindowManagerGlobal.ADD_DUPLICATE_ADD;
        }
        ...
        <span class="hljs-keyword">final</span> <span class="hljs-type">WindowState</span> <span class="hljs-variable">win</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WindowState</span>(<span class="hljs-built_in">this</span>, session, client, token, parentWindow,
                appOp[<span class="hljs-number">0</span>], seq, attrs, viewVisibility, session.mUid,
                session.mCanAddInternalSystemWindow);
        ...
        win.attach();
        mWindowMap.put(client.asBinder(), win);
        win.initAppOpsState();
        ...
    }
    ...
    <span class="hljs-keyword">return</span> res;
}
</code></pre>
<p><code>addWindow()</code>方法代码在200多行，此处我们需要关注的部分是：</p>
<ul>
<li>创建了<code>WindowState</code>对象并添加到<code>mWindowMap</code>集合中</li>
<li>调用<code>WindowState</code>对象的<code>attach()</code>方法</li>
</ul>
<p><code>WindowState</code>后面会详细介绍，此处的关键定义如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/** A window in the window manager. */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">WindowState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WindowContainer</span>&lt;WindowState&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WindowManagerPolicy</span>.WindowState {
    ...
    <span class="hljs-keyword">final</span> Context mContext;
    <span class="hljs-keyword">final</span> Session mSession;
    <span class="hljs-keyword">final</span> IWindow mClient;
    ...
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">attach</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (localLOGV) Slog.v(TAG, <span class="hljs-string">"Attaching "</span> + <span class="hljs-built_in">this</span> + <span class="hljs-string">" token="</span> + mToken);
        mSession.windowAddedLocked(mAttrs.packageName);
    }
}
</code></pre>
<ul>
<li><code>mClient</code>是应用进程中<code>Binder</code>服务对象<code>W</code>的引用对象</li>
<li><code>mSession</code>便是<code>WMS</code>对外封装的对象之一。以前面的<code>addToDisplay()</code>为例，实际上只是转调了<code>WMS</code>的<code>addWindow()</code>方法</li>
<li><code>attach()</code>方法也只是调用了<code>mSession</code>对象的<code>windowAddedLocked()</code>方法</li>
</ul>
<p>继续看下<code>windowAddedLocked()</code>方法:</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">void</span> <span class="hljs-title function_">windowAddedLocked</span><span class="hljs-params">(String packageName)</span> {
        mPackageName = packageName;
        mRelayoutTag = <span class="hljs-string">"relayoutWindow: "</span> + mPackageName;
        <span class="hljs-keyword">if</span> (mSurfaceSession == <span class="hljs-literal">null</span>) {
            mSurfaceSession = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SurfaceSession</span>();
            mService.mSessions.add(<span class="hljs-built_in">this</span>);
            <span class="hljs-keyword">if</span> (mLastReportedAnimatorScale != mService.getCurrentAnimatorScale()) {
                mService.dispatchNewAnimatorScaleLocked(<span class="hljs-built_in">this</span>);
            }
        }
        mNumWindow++;
    }
</code></pre>
<p><code>windowAddedLocked()</code>方法</p>
<ul>
<li>首先检查了<code>mSurfaceSession</code>的值，当为空时才会创建<code>SurfaceSession</code>对象
<ul>
<li>前面<a href="https://juejin.cn/post/6944960866404007944#heading-7" target="_blank" title="https://juejin.cn/post/6944960866404007944#heading-7">图像显示</a>部分介绍过，<code>SurfaceSession</code>对象是用来创建<code>Surface</code>的</li>
</ul>
</li>
<li>然后将<code>Session</code>对象本身添加到<code>WMS</code>的<code>mSessions</code>列表中</li>
</ul>
<p>到这里，应用进程就和<code>WMS</code>各自持有了对方的<code>Binder</code>引用对象，形成了一个双向<code>Binder</code>通道，示意图如下：<br/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c770d89efe34906bf922df504d858aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYXBpZ2ZseQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764508564&amp;x-signature=NaEwJ3G6o3LRkFsTlJKCfHjPwjA%3D" alt="image" loading="lazy"/></p>
<h3 data-id="heading-9">DecorView</h3>
<p>关于<code>DecorView</code>，还是要从我们最熟悉的地方说起。</p>
<p>在<code>Activity</code>的<code>onCreate()</code>中调用<code>setContentView()</code>方法时，我们看下发生了什么：</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setContentView</span><span class="hljs-params">(<span class="hljs-meta">@LayoutRes</span> <span class="hljs-type">int</span> layoutResID)</span> {
        getWindow().setContentView(layoutResID);
        initWindowDecorActionBar();
    }
</code></pre>
<p><code>Activity</code>的<code>onCreate()</code>调用的是<code>Window</code>类的<code>setContentView()</code>，这是个抽象方法，具体的实现在<code>PhoneWindow.java</code>中，代码如下：</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setContentView</span><span class="hljs-params">(View view, ViewGroup.LayoutParams params)</span> {
        <span class="hljs-keyword">if</span> (mContentParent == <span class="hljs-literal">null</span>) {
            installDecor();
        }
        ...
    }
</code></pre>
<p>如果<code>mContentParent</code>对象还没有创建出来，则会调用<code>installDecor()</code>方法，方法如下：</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">installDecor</span><span class="hljs-params">()</span> {
        mForceDecorInstall = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">if</span> (mDecor == <span class="hljs-literal">null</span>) {
            mDecor = generateDecor(-<span class="hljs-number">1</span>); <span class="hljs-comment">// 创建 DecorView</span>
            mDecor.setDescendantFocusability(ViewGroup.FOCUS_AFTER_DESCENDANTS);
            mDecor.setIsRootNamespace(<span class="hljs-literal">true</span>);
            <span class="hljs-keyword">if</span> (!mInvalidatePanelMenuPosted &amp;&amp; mInvalidatePanelMenuFeatures != <span class="hljs-number">0</span>) {
                mDecor.postOnAnimation(mInvalidatePanelMenuRunnable);
            }
        } <span class="hljs-keyword">else</span> {
            mDecor.setWindow(<span class="hljs-built_in">this</span>);
        }
        <span class="hljs-keyword">if</span> (mContentParent == <span class="hljs-literal">null</span>) {
            mContentParent = generateLayout(mDecor); <span class="hljs-comment">// 为DecorView设置布局格式，并返回 mContentParent</span>
        }
    }
</code></pre>
<p><code>installDecor()</code>方法</p>
<ul>
<li>
<p>先根据成员变量<code>mDecor</code>是否为空来决定是否进行<code>DecorView</code>的创建</p>
<ul>
<li>对象的创建方法为<code>generateDecor()</code>，内容如下：</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> DecorView <span class="hljs-title function_">generateDecor</span><span class="hljs-params">(<span class="hljs-type">int</span> featureId)</span> {
    Context context;
    ... <span class="hljs-comment">// 省略 context 的创建过程</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DecorView</span>(context, featureId, <span class="hljs-built_in">this</span>, getAttributes());
}
</code></pre>
</li>
<li>
<p>然后通过<code>generateLayout()</code>方法为创建好的<code>DecorView</code>设置布局格式，并返回<code>mContentParent</code>对象</p>
</li>
</ul>
<p>我们再看下<code>DecorView</code>的定义</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/** <span class="hljs-doctag">@hide</span> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DecorView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">FrameLayout</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RootViewSurfaceTaker</span>, WindowCallbacks {
    ...
}
</code></pre>
<p>其实就是个自定义的<code>ViewGroup</code>，只是这个<code>DecorView</code>在<code>Android</code>中作为顶级<code>View</code>去使用</p>
<h2 data-id="heading-10"><code>WindowManagerService</code>服务</h2>
<p><code>WMS</code>服务的启动，要从<code>SystemServer</code>中的<code>startOtherServices()</code>方法说起，关键代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startOtherServices</span><span class="hljs-params">()</span> {
    ...
    wm = WindowManagerService.main(..., <span class="hljs-keyword">new</span> <span class="hljs-title class_">PhoneWindowManager</span>());
    ServiceManager.addService(Context.WINDOW_SERVICE, wm, <span class="hljs-comment">/* allowIsolated= */</span> <span class="hljs-literal">false</span>,
            DUMP_FLAG_PRIORITY_CRITICAL | DUMP_FLAG_PROTO);
    ...
}
</code></pre>
<p>看下<code>main()</code>方法的定义：</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> WindowManagerService <span class="hljs-title function_">main</span><span class="hljs-params">(..., WindowManagerPolicy policy)</span> {
        DisplayThread.getHandler().runWithScissors(() -&gt;
                sInstance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WindowManagerService</span>(context, im, haveInputMethods, showBootMsgs,
                        onlyCore, policy), <span class="hljs-number">0</span>);
        <span class="hljs-keyword">return</span> sInstance;
    }
</code></pre>
<p><code>main()</code>方法主要是初始化了<code>WindowManagerService</code>对象，我们需要注意的是它的最后的参数<code>WindowManagerPolicy policy</code>，它的具体的实现类是<code>PhoneWindowManager</code></p>
<p>再看下<code>WindowManagerService</code>的关键定义：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WindowManagerService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IWindowManager</span>.Stub
        <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Watchdog</span>.Monitor, WindowManagerPolicy.WindowManagerFuncs {
    ...
    <span class="hljs-keyword">final</span> ArraySet&lt;Session&gt; mSessions = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArraySet</span>&lt;&gt;();
    <span class="hljs-keyword">final</span> <span class="hljs-type">WindowHashMap</span> <span class="hljs-variable">mWindowMap</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WindowHashMap</span>();
    <span class="hljs-keyword">final</span> WindowManagerPolicy mPolicy;
    ...
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">WindowManagerService</span><span class="hljs-params">(..., WindowManagerPolicy policy)</span> {
        ...
        mPolicy = policy;
        ...
    }
}
</code></pre>
<p>其中的关键成员如下：</p>
<ul>
<li>
<p><code>mSessions</code>中储存的是<code>Session</code>服务类的对象，每个应用在<code>WMS</code>中都有一个对应的<code>Session</code>对象，它们都保存在<code>mSessions</code>中</p>
</li>
<li>
<p><code>mWindowMap</code>中类型是<code>WindowHashMap</code>，保存的是所有窗口的<code>WindowState</code>对象。<code>WindowHashMap</code>定义如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">WindowHashMap</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HashMap</span>&lt;IBinder, WindowState&gt; {
}
</code></pre>
<ul>
<li>此处并未做任何删减哈，源码中就是简单地继承了<code>HashMap&lt;IBinder, WindowState&gt;</code></li>
<li><code>WindowState</code>表示一个窗口的所有属性，它便是是<code>WMS</code>中的窗口。等下细讲</li>
</ul>
</li>
<li>
<p><code>mPolicy</code>是<code>WMS</code>中执行窗口管理策略的对象，类型是<code>WindowManagerPolicy</code>，这是一个接口类</p>
<ul>
<li>从<code>SystemServer</code>的<code>startOtherServices()</code>中可以看出具体的实现类是<code>PhoneWindowManager</code></li>
<li>在<code>Android</code>中<code>WMS</code>只是负责窗口管理的框架部分，通过<code>策略模式</code>将框架和窗口实现细节进行了分离</li>
</ul>
</li>
</ul>
<p>对比<code>9.0</code>和<code>5.0</code>源码，<code>WMS</code>关于窗口部分设计变化很大，在了解<code>Android</code>如何添加一个窗口前，我们先看下<code>Android</code>中窗口类型的定义</p>
<h3 data-id="heading-11">窗口类型</h3>
<p>在<code>WMS</code>中定义了3中窗口：<code>应用窗口</code>、<code>子窗口</code>和<code>系统窗口</code>，相关的定义都是在<code>frameworks/base/core/java/android/view/WindowManager.java</code>中，确切的说应该是在<code>WindowManager.LayoutParams</code>类中定义</p>
<h4 data-id="heading-12">应用窗口(<code>application window</code>)</h4>
<p>应用窗口是<code>Activity</code>使用的全屏窗口，<code>Android</code>定义了4种不同类型的应用窗口</p>
<ul>
<li><code>TYPE_BASE_APPLICATION</code>：基础应用窗口，应用中所有窗口都位于它的上层。只能由系统创建</li>
<li><code>TYPE_APPLICATION</code>：<code>Activity</code>的顶层窗口，应用中最常见的一种</li>
<li><code>TYPE_APPLICATION_STARTING</code>：应用启动时由系统创建的窗口，显示一些信息，直到应用创建的窗口显示出来</li>
<li><code>TYPE_DRAWN_APPLICATION</code>：类似于普通的<code>TYPE_APPLICATION</code>，<code>WMS</code>针对类型额外增加了等待机制</li>
</ul>
<h4 data-id="heading-13">子窗口(<code>sub-window</code>)</h4>
<p>子窗口是指依附于应用窗口或系统窗口的窗口类型，它们一般随所依附的窗口一起出现或切换到后台。<code>Android</code>中定义了6种子窗口类型</p>
<ul>
<li><code>TYPE_APPLICATION_PANEL</code>：应用Panel窗口，显示在依附窗口的上层</li>
<li><code>TYPE_APPLICATION_MEDIA</code>：应用Media窗口，通常包含独立的Surface，显示在依附窗口的下层</li>
<li><code>TYPE_APPLICATION_SUB_PANEL</code>：应用子Panel窗口，显示在依附窗口和<code>TYPE_APPLICATION_PANEL</code>的上层</li>
<li><code>TYPE_APPLICATION_ATTACHED_DIALOG</code>：和<code>TYPE_APPLICATION_PANEL</code>类似，但是窗口的布局方式和<code>Activity</code>的顶层窗口相同</li>
<li><code>TYPE_APPLICATION_MEDIA_OVERLAY</code>：一种显示在<code>TYPE_APPLICATION_MEDIA</code>和所依附窗口之间的半透明窗口。一般用来显示<code>Video</code>的字幕或者相机的操作提示界面</li>
<li><code>TYPE_APPLICATION_ABOVE_SUB_PANEL</code>：一种显示在<code>TYPE_APPLICATION_SUB_PANEL</code>之上的窗口</li>
</ul>
<h4 data-id="heading-14">系统窗口(<code>system window</code>)</h4>
<p>系统窗口大都用于系统生成的UI中，一般比较独立，种类非常多，我们挑几个常见的看下</p>
<ul>
<li><code>TYPE_STATUS_BAR</code>：状态栏窗口，系统中只能有一个，在屏幕的最上方</li>
<li><code>TYPE_SEARCH_BAR</code>：搜索栏窗口，系统中只能有一个，在屏幕的最上方</li>
<li><code>TYPE_PHONE</code>：电话窗口，提供用户与电话的交互界面，通常位于所用应用窗口的上方，但是在状态栏的后面</li>
<li><code>TYPE_SYSTEM_ALERT</code>：系统警告窗口，位于所用应用窗口的上方</li>
<li><code>TYPE_TOAST</code>：临时通知窗口，显示一些提示信息</li>
</ul>
<p>还有很多就不一一列举了，<code>Android</code>对<code>系统窗口</code>的定义有39种之多，源码中有着详细的注释，大家可以在<code>WindowManager.java</code>中找到(<a href="https://link.juejin.cn?target=http%3A%2F%2Fandroidxref.com%2F9.0.0_r3%2Fxref%2Fframeworks%2Fbase%2Fcore%2Fjava%2Fandroid%2Fview%2FWindowManager.java%23697" target="_blank" title="http://androidxref.com/9.0.0_r3/xref/frameworks/base/core/java/android/view/WindowManager.java#697" ref="nofollow noopener noreferrer">传送门</a>)</p>
<p><strong>那么<code>WMS</code>中是怎么定义窗口的呢？</strong></p>
<h3 data-id="heading-15"><code>WMS</code>中窗口的设计</h3>
<blockquote>
<p>前面讲过（<code>WMS</code>的<code>addWindow()</code>方法），当向<code>WMS</code>添加一个窗口时，<code>WMS</code>会为其创建一个<code>WindowState</code>。对于<code>WindowState</code>来说，它包含了一个窗口的所有属性，所以它是<code>WMS</code>中真正意义上的窗口</p>
</blockquote>
<p>先看下<code>WindowState</code>的关键定义：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/** A window in the window manager. */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">WindowState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WindowContainer</span>&lt;WindowState&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WindowManagerPolicy</span>.WindowState {
    ...
    WindowToken mToken;
    AppWindowToken mAppToken;
    ...
    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> mBaseLayer;
    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> mSubLayer;
}
</code></pre>
<p><code>WindowState</code>继承了<code>WindowContainer</code>，又是和书中不一样的地方</p>
<blockquote>
<p>对比5.0源码，很明显在<code>Window</code>这部分<code>Android</code>做了重构（设计模式看上去像是<code>组合模式</code>），优化了类结构，抽象出了<code>WindowContainer</code>用来支撑起整个窗口体系</p>
</blockquote>
<p>基于<code>Android 9.0</code>源码，窗口体系的关系梳理如下：<br/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2dcd21f21c44ce48b16279606ba5d73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYXBpZ2ZseQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764508564&amp;x-signature=ESLkSCnWfFCwab6KKqZzZ5yiLvY%3D" alt="image" loading="lazy"/></p>
<p>类图中涉及到的类的信息下：</p>
<ul>
<li>
<p><code>WindowContainer</code></p>
<ul>
<li>成员变量<code>mChildren</code>的类型是<code>WindowList</code>，看实现其实就是<code>ArrayList&lt;WindowState&gt;</code>。又因为<code>WindowToken</code>继承了<code>WindowContainer</code>，所以该成员变量子类都会继承过来</li>
<li>所有拥有相同<code>Token</code>的窗口(<code>WindowState</code>)都会存放在<code>mChildren</code>中，</li>
</ul>
</li>
<li>
<p><code>WindowToken</code></p>
<ul>
<li>成员变量<code>token</code>是<code>IBinder</code>对象，具有系统唯一性，向<code>WMS</code>的<code>mWindowMap</code>中添加对象时都是使用这个<code>token</code>值</li>
<li>定义了<code>AppWindowToken asAppWindowToken()</code>，默认返回<code>null</code></li>
</ul>
</li>
<li>
<p><code>AppWindowToken</code></p>
<ul>
<li>继承自<code>WindowToken</code>并重写了<code>AppWindowToken asAppWindowToken()</code>方法，返回<code>this</code></li>
<li>这样便可以通过<code>asAppWindowToken()</code>的返回值判断是那种<code>Token</code></li>
</ul>
</li>
<li>
<p><code>DisplayContent</code></p>
<ul>
<li>继承自<code>WindowContainer</code>，真正意义上的屏幕，<code>WMS</code>中一个<code>DisplayContent</code>实例表示一个屏幕。多屏幕会对应多个实例</li>
<li>内部定义了4种存放<code>Window</code>的容器，都是直接或间接继承自<code>WindowContainer</code>：
<ul>
<li><code>mTaskStackContainers</code>：用来保存所有的应用窗口</li>
<li><code>mAboveAppWindowsContainers</code>：用来保存显示在应用窗口的上面的非应用窗口</li>
<li><code>mBelowAppWindowsContainers</code>：用来保存显示在应用窗口的下面的非应用窗口</li>
<li><code>mImeWindowsContainers</code>：用来保存 IME Window</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>RootWindowContainer</code></p>
<ul>
<li>代表<code>WMS</code>中窗口的根容器，所有<code>DisplayContent</code>的实例都会添加到其中</li>
<li><code>RootWindowContainer</code>在<code>WMS</code>的构造方法中初始化为<code>mRoot</code>对象</li>
</ul>
</li>
</ul>
<p>还是回到<code>WindowState</code>，类中定义了两个常量<code>mBaseLayer</code>和<code>mSubLayer</code>，通过这两个常量便可以确定一个<code>Window</code>所在的层级。这部分就不细讲了哈，涉及点有点多，后面用到再来补充吧，嘻嘻</p>
<p>我们重点看下面两个知识点：<code>WMS</code>的<code>addWindow</code>和<code>relayoutWindow</code>的设计</p>
<h4 data-id="heading-16">addWindow方法</h4>
<p><code>addWindow()</code>在<a href="#WMS2APP" title="#WMS2APP">WMS中建立和应用的关系</a>已经介绍，不再赘述</p>
<h4 data-id="heading-17">relayoutWindow方法</h4>
<p>前面介绍过，在<code>Activity</code>的<code>onResume</code>阶段，通过<code>ViewRootImpl</code>的<code>setView</code>方法开始渲染<code>View</code>的流程。</p>
<p><code>setView</code>方法中会通过<code>requestLayout()</code>开始测量渲染，这个方法中有一个核心的逻辑就是调用<code>WMS</code>的<code>relayoutWindow()</code>，重新测量<code>Window</code>，简要流程如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//ViewRootImpl.java</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">requestLayout</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (!mHandlingLayoutInLayoutRequest) {
        ...
        scheduleTraversals();
    }
}
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">performTraversals</span><span class="hljs-params">()</span> {
    ...
    relayoutResult = relayoutWindow(params, viewVisibility, insetsPending);
    ...
}
<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">relayoutWindow</span><span class="hljs-params">(WindowManager.LayoutParams params, <span class="hljs-type">int</span> viewVisibility,
        <span class="hljs-type">boolean</span> insetsPending)</span> <span class="hljs-keyword">throws</span> RemoteException {
    ...
    <span class="hljs-type">int</span> <span class="hljs-variable">relayoutResult</span> <span class="hljs-operator">=</span> mWindowSession.relayout(mWindow, mSeq, params,
            (<span class="hljs-type">int</span>) (mView.getMeasuredWidth() * appScale + <span class="hljs-number">0.5f</span>),
            (<span class="hljs-type">int</span>) (mView.getMeasuredHeight() * appScale + <span class="hljs-number">0.5f</span>), viewVisibility,
            insetsPending ? WindowManagerGlobal.RELAYOUT_INSETS_PENDING : <span class="hljs-number">0</span>, frameNumber,
            mWinFrame, mPendingOverscanInsets, mPendingContentInsets, mPendingVisibleInsets,
            mPendingStableInsets, mPendingOutsets, mPendingBackDropFrame, mPendingDisplayCutout,
            mPendingMergedConfiguration, mSurface);
    ...
    <span class="hljs-keyword">return</span> relayoutResult;
}
</code></pre>
<p><code>relayoutWindow()</code>通过<code>Session</code>的<code>relayout()</code>方法调用到<code>WMS</code>的<code>relayoutWindow()</code>方法</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">relayout</span><span class="hljs-params">(IWindow window, <span class="hljs-type">int</span> seq, ...)</span> {
        ...
        <span class="hljs-type">int</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> mService.relayoutWindow(<span class="hljs-built_in">this</span>, window, seq, attrs,
                requestedWidth, requestedHeight, viewFlags, flags, frameNumber,
                outFrame, outOverscanInsets, outContentInsets, outVisibleInsets,
                outStableInsets, outsets, outBackdropFrame, cutout,
                mergedConfiguration, outSurface);
        ...
        <span class="hljs-keyword">return</span> res;
    }
</code></pre>
<p><code>WMS</code>中的<code>relayoutWindow()</code>代码比较复杂，我们简单看下：</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">relayoutWindow</span><span class="hljs-params">(...)</span> {
        ...
        <span class="hljs-keyword">synchronized</span>(mWindowMap) {
            <span class="hljs-comment">// 从 mWindowMap 取出对应的 WindowState 对象</span>
            <span class="hljs-type">WindowState</span> <span class="hljs-variable">win</span> <span class="hljs-operator">=</span> windowForClientLocked(session, client, <span class="hljs-literal">false</span>);
            <span class="hljs-keyword">if</span> (win == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
            }
            displayId = win.getDisplayId();
            ...
            <span class="hljs-comment">// 调用 WindowSurfacePlacer 的 performSurfacePlacement 方法</span>
            <span class="hljs-comment">// 这个方法其实就是检查清理无用的 Surface 对象，为后面创建 Surface 做准备</span>
            <span class="hljs-comment">// 详细的方法就不贴出来了，大家可以自行阅读</span>
            mWindowPlacerLocked.performSurfacePlacement(<span class="hljs-literal">true</span> <span class="hljs-comment">/* force */</span>);
            <span class="hljs-keyword">if</span> (shouldRelayout) {
                result = win.relayoutVisibleWindow(result, attrChanges, oldVisibility);
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// 创建 Surface ，确切的说应该是创建 WindowSurfaceController 对象</span>
                    <span class="hljs-comment">// WindowSurfaceController 其实就是对 Surface 和 SurfaceControl 的封装</span>
                    <span class="hljs-comment">// Surface 和 SurfaceControl 的关系在十二章已经介绍啦</span>
                    result = createSurfaceControl(outSurface, result, win, winAnimator);
                } 
                ...
            } <span class="hljs-keyword">else</span> {
                ...
            }
            <span class="hljs-keyword">if</span> (focusMayChange) {
                <span class="hljs-comment">// 如果窗口发生了变化，调用 updateFocusedWindowLocked 方法重新测量窗口大小</span>
                <span class="hljs-comment">// 这个方法才是真正的核心测量窗口大小逻辑</span>
                <span class="hljs-comment">// 方法中会调用 DisplayContent.performLayout 方法开始真正的测量</span>
                <span class="hljs-keyword">if</span> (updateFocusedWindowLocked(UPDATE_FOCUS_WILL_PLACE_SURFACES,
                        <span class="hljs-literal">false</span> <span class="hljs-comment">/*updateInputWindows*/</span>)) {
                    imMayMove = <span class="hljs-literal">false</span>;
                }
            }
            ...
            win.mInRelayout = <span class="hljs-literal">false</span>;
        }
        ...
    }
</code></pre>
<p>在 <code>WMS</code> 的 <code>relayoutWindow()</code> 方法中，核心逻辑在于 <code>createSurfaceControl</code> 的调用。</p>
<pre><code class="hljs language-java" lang="java">result = createSurfaceControl(outSurface, result, win, winAnimator);
</code></pre>
<p>这里的参数 outSurface 至关重要。回看 ViewRootImpl 调用 relayout 的代码：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ViewRootImpl.java</span>
mWindowSession.relayout(..., mSurface);
</code></pre>
<p>我们可以明确看到，<code>ViewRootImpl</code> 将自己的成员变量 mSurface 传递给了 <code>WMS</code>。 在 <code>WMS</code> 内部，<code>createSurfaceControl</code> 会请求 <code>SurfaceFlinger</code> 创建图层（<code>Layer</code>），并将生成的 <code>Native</code> 层 <code>Surface</code> 信息回写（<code>Copy</code>）到传入的 <code>outSurface</code> 参数中。</p>
<p>这意味着： 当 <code>relayoutWindow</code> 调用返回时，应用进程 <code>ViewRootImpl</code> 中的 <code>mSurface</code> 对象就已经持有了真正的图形缓冲区引用，随后应用便可以利用这个 <code>Surface</code> 进行绘图。</p>
<blockquote>
<p>怎么说～怎么说～。前言的问题是不是明了啦</p>
</blockquote>
<h2 data-id="heading-18">总结</h2>
<p>Android 的窗口系统是一个典型的 <code>C/S</code> 架构，由应用进程（Client）和 <code>WindowManagerService</code>（Server）共同构成：</p>
<p><strong>应用端 (Client)</strong></p>
<ul>
<li>
<p><code>Activity</code> 负责生命周期，持有一个 <code>PhoneWindow</code> 对象来管理视图策略。</p>
</li>
<li>
<p><code>DecorView</code> 是视图树的根节点。</p>
</li>
<li>
<p><code>ViewRootImpl</code> 是核心管理者，它连接了 DecorView 和 <code>WMS</code>，并持有 <code>Surface</code> 对象，负责发起绘制流程（Measure/Layout/Draw）。</p>
</li>
<li>
<p><code>WindowManagerGlobal</code> 是进程单例，负责管理当前进程所有的 <code>ViewRootImpl</code> 和 <code>View</code>。</p>
</li>
</ul>
<p><strong>通信层 (IPC)</strong></p>
<ul>
<li>
<p><code>IWindowSession</code>：应用向 <code>WMS</code> 发送请求的通道（如 <code>addToDisplay</code>, <code>relayout</code>）。</p>
</li>
<li>
<p><code>IWindow</code> (<code>W</code>类)：<code>WMS</code> 回调应用的通道（如窗口焦点变化、配置改变）。</p>
</li>
</ul>
<p><strong>服务端 (WMS)</strong></p>
<ul>
<li>
<p><code>WindowState</code>：<code>WMS</code> 中代表一个窗口的实体，保存窗口的所有属性。</p>
</li>
<li>
<p><code>WindowContainer</code>：构建了层级化的窗口容器结构（<code>DisplayContent</code> -&gt; <code>TaskStack</code> -&gt; <code>WindowState</code>）。</p>
</li>
<li>
<p><code>Surface</code> 管理：<code>WMS</code> 在 <code>relayoutWindow</code> 过程中计算窗口大小与位置，并与 <code>SurfaceFlinger</code> 通信创建 <code>SurfaceControl</code>，最终将可用的 <code>Surface</code> 返回给应用端。</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[dify案例分享-国内首发！手把手教你用Dify调用Nano Banana2AI画图]]></title>    <link>https://juejin.cn/post/7575363120798482432</link>    <guid>https://juejin.cn/post/7575363120798482432</guid>    <pubDate>2025-11-23T13:26:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575363120798482432" data-draft-id="7575162322240520192" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="dify案例分享-国内首发！手把手教你用Dify调用Nano Banana2AI画图"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-23T13:26:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="wwwzhouhui"/> <meta itemprop="url" content="https://juejin.cn/user/3428746411400537"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            dify案例分享-国内首发！手把手教你用Dify调用Nano Banana2AI画图
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3428746411400537/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    wwwzhouhui
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T13:26:22.000Z" title="Sun Nov 23 2025 13:26:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.前言</h2>
<p>在AI图像生成领域快速发展的今天,Google最新推出的Nano Banana Pro(正式名称:Gemini 3 Pro Image)以1501的Elo分数登顶LMArena排行榜第一,完美支持中文文字渲染、多图一致性、精准控制等功能,成为了图像生成领域的王者级模型。然而对于国内开发者来说,直接访问Gemini API存在诸多不便,而且需要科学上网才能使用,这让很多小伙伴望而却步。</p>
<p>为了解决这些痛点,我们开发了nano_banana2这个开源Dify插件,它基于Gemini 3 Pro Image Preview模型,支持双API提供商(Juxin API和Gemai公共API),不仅提供了免费调用选项,还能通过国内网络直接访问。通过Dify平台的可视化工作流,小伙伴们只需简单三个节点,无需编写代码,就能快速搭建属于自己的AI图像生成服务。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/952d95c181da421c9ddb66c2ecde9f03~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764509182&amp;x-signature=rolV1a1h0%2Fug2XnJEoI9oLF11DE%3D" alt="image-20251123175637746" loading="lazy"/></p>
<p>这2天Nano Banana Pro非常火爆,今天我们就在Dify平台手把手教大家部署这个nano_banana2插件,通过简单三步配置,体验和感受一下这个王者级模型的强大能力。</p>
<hr/>
<h2 data-id="heading-1">2.项目介绍</h2>
<h3 data-id="heading-2">✨ 核心特性</h3>
<p>nano_banana2是一个专为Dify平台设计的AI图像生成插件,具备以下强大功能:</p>
<ul>
<li><strong>🎨 多风格支持</strong>: 支持真实、动漫、油画、水彩、素描五种艺术风格</li>
<li><strong>📐 多比例生成</strong>: 提供1:1、16:9、9:16、4:3、3:4等多种画幅比例</li>
<li><strong>🔄 批量生成</strong>: 单次请求可生成1-4张图片,提升创作效率</li>
<li><strong>🚫 负面提示词</strong>: 支持排除不想要的元素,精准控制画面内容</li>
<li><strong>🌐 双API支持</strong>: 同时支持Juxin API(付费)和Gemai公共API(免费)</li>
<li><strong>⚡ 极简工作流</strong>: 仅需三个节点即可完成部署,新手友好</li>
<li><strong>📊 实时进度反馈</strong>: 完整的错误处理和进度提示</li>
<li><strong>🆓 开源免费</strong>: 完全开源,支持本地部署和二次开发</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31f85172a6ac442998c102f09eaaff13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764509182&amp;x-signature=uEU8jt6PNtEQorhdZB%2BN%2BiRneKQ%3D" alt="工作流演示" loading="lazy"/></p>
<h3 data-id="heading-3">🛠️ 技术栈</h3>
<h4 data-id="heading-4">Dify插件端</h4>
<ul>
<li><strong>插件框架</strong>: Dify Plugin SDK</li>
<li><strong>API对接</strong>: Juxin API / Gemai Public API</li>
<li><strong>模型</strong>: Gemini 3 Pro Image Preview</li>
<li><strong>超时设置</strong>: 120秒请求超时</li>
<li><strong>输出格式</strong>: PNG高清图片</li>
</ul>
<h4 data-id="heading-5">工作流端</h4>
<ul>
<li><strong>节点数量</strong>: 3个(开始 → 插件 → 回复)</li>
<li><strong>配置方式</strong>: 可视化拖拽,零代码</li>
<li><strong>参数配置</strong>: 支持风格、比例、数量等自定义</li>
</ul>
<h3 data-id="heading-6">🎯 应用场景</h3>
<p>基于Nano Banana Pro的28种经典玩法,该插件可广泛应用于:</p>
<ul>
<li><strong>电商场景</strong>: 背景替换、商品展示、产品海报设计</li>
<li><strong>广告创意</strong>: 多面板蒙太奇、品牌logo植入、宣传物料制作</li>
<li><strong>社媒内容</strong>: 九宫格图、YouTube缩略图、朋友圈配图</li>
<li><strong>动漫创作</strong>: 连续漫画、角色设定、表情包制作</li>
<li><strong>教育科普</strong>: 信息图表、教学插画、知识可视化</li>
<li><strong>实用变现</strong>: 老照片修复、专业精修、3D模型商品化</li>
</ul>
<h3 data-id="heading-7">📊 成本对比</h3>

































<table><thead><tr><th>方案</th><th>访问方式</th><th>成本</th><th>部署难度</th><th>工作流复杂度</th></tr></thead><tbody><tr><td>官方Gemini</td><td>需科学上网</td><td>$0.12/张(2K)</td><td>中等</td><td>需API开发</td></tr><tr><td>AI Studio</td><td>付费API</td><td>$0.12/张(2K)</td><td>较难</td><td>需API开发</td></tr><tr><td>nano_banana2插件</td><td>国内直连</td><td>免费(Gemai)或低成本</td><td>简单</td><td>3节点即可</td></tr></tbody></table>
<p>通过nano_banana2插件,我们不仅解决了国内访问问题,还通过极简工作流降低了部署门槛,让普通用户也能轻松生成专业级图像。</p>
<hr/>
<h2 data-id="heading-8">3.部署实战</h2>
<p>话不多说,下面带大家一步一步完成整个工作流的搭建。呵呵你会发现真的超级简单!</p>
<h3 data-id="heading-9">3.1 插件安装</h3>
<p>我们首先需要在Dify平台安装nano_banana2插件。</p>
<h4 data-id="heading-10">方法一: 在线安装(推荐)</h4>
<p>打开你的Dify平台,进入"插件管理"页面。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1201934d076490495225c3763e736b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764509182&amp;x-signature=%2BpJqjsdr34X15MJzJo8irsLrR0E%3D" alt="插件管理入口" loading="lazy"/></p>
<p>在插件市场搜索"Nano Banana2",点击安装即可。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b857c66e2154c03af7eeaabbcd24f12~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764509182&amp;x-signature=HKdYh6%2B5uXwYF%2F%2FosEPBJpKerqw%3D" alt="image-20251123203500412" loading="lazy"/></p>
<h4 data-id="heading-11">方法二: 离线安装</h4>
<p>如果插件还在审核中,可以从GitHub下载.difypkg安装包进行离线安装。</p>
<p>在插件管理页面选择"本地插件":</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b4ea72d323940f1b3272474a5d0ddfd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764509182&amp;x-signature=iElhp6uhY0h%2BEuXL1CqjAET3zMU%3D" alt="本地插件选项" loading="lazy"/></p>
<p>选择下载好的nano_banana2v0.0.1.difypkg文件上传:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd9d53d4050c4c48929b066816038499~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764509182&amp;x-signature=RA%2FpQ76mxEIzIwZeMbcfW5uLn%2F8%3D" alt="上传插件包" loading="lazy"/></p>
<p>点击安装后等待几秒钟,看到安装成功提示:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17c9c1cb011742f9b06d69a60b92c303~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764509182&amp;x-signature=2zkc7lcPD8%2FsL4OSNkYsrMZtFqI%3D" alt="安装成功" loading="lazy"/></p>
<p>好家伙,插件安装就这么简单!</p>
<h3 data-id="heading-12">3.2 授权配置</h3>
<p>安装成功后,我们需要对插件进行授权配置。nano_banana2支持两种API提供商:</p>
<h4 data-id="heading-13">Juxin API(付费,稳定)</h4>
<p>访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fapi.juxin.ai" target="_blank" title="https://api.juxin.ai" ref="nofollow noopener noreferrer">api.juxin.ai</a> 注册账号并充值,获取API Key。</p>
<p><strong>优势</strong>:</p>
<ul>
<li>稳定性高,响应速度快</li>
<li>无限额限制,适合批量生成</li>
<li>支持更高分辨率</li>
</ul>
<h4 data-id="heading-14">Gemai Public API(免费,有限额)</h4>
<p>访问相应平台获取免费API Key。</p>
<p><strong>优势</strong>:</p>
<ul>
<li>完全免费,适合测试和个人使用</li>
<li>每日有一定免费额度</li>
<li>快速体验Nano Banana Pro功能</li>
</ul>
<p>在插件设置页面填入至少一个API密钥:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f301de672e6040b08e316533095300d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764509182&amp;x-signature=n94bFAlydl3ASEAoRnJVxqPkEwE%3D" alt="授权配置" loading="lazy"/></p>
<p><strong>注意</strong>: 两个API可以同时配置,插件会根据你在工作流中的选择来调用对应的接口。建议先配置免费的Gemai API进行测试,满意后再使用付费的Juxin API进行批量生成。</p>
<h3 data-id="heading-15">3.3 工作流搭建(三步搞定!)</h3>
<h4 data-id="heading-16">3.3.1 创建工作流</h4>
<p>在Dify平台创建一个新的"聊天助手"工作流。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f4f9a0435874c7ca7c5b55b6370a564~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764509182&amp;x-signature=Zby%2BTpBqHAfx4w6rkHtywntxwbU%3D" alt="image-20251123203228715" loading="lazy"/></p>
<h4 data-id="heading-17">3.3.2 第一步: 开始节点(默认即可)</h4>
<p>开始节点会自动创建,它会接收用户的输入文本作为提示词。</p>
<p><strong>默认配置</strong>:</p>
<ul>
<li>输入变量: <code>{{#sys.query#}}</code> (系统自动捕获用户输入)</li>
<li>无需手动配置任何参数</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d99d424a73174aeaafebe3ef140ede6c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764509182&amp;x-signature=BcYpPYle38ZcrnO7bOPpwvk4kf0%3D" alt="image-20251123202939998" loading="lazy"/></p>
<h4 data-id="heading-18">3.3.3 第二步: 添加Nano Banana2插件</h4>
<p>从插件列表中找到刚才安装的"Nano Banana2 文生图"插件,拖入工作流画布:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80ab41169cda4c559bbc79674fab296a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764509182&amp;x-signature=MCEzimxipl1zwkI2JHj0YPZ5T7U%3D" alt="添加插件" loading="lazy"/></p>
<p><strong>配置插件参数</strong>:</p>
<h5 data-id="heading-19">必填参数</h5>
<p><strong>1) 图像提示词 (prompt)</strong></p>
<ul>
<li>填入: <code>{{#sys.query#}}</code> (使用用户输入的文本)</li>
<li>说明: 这是生成图像的核心描述,支持中英文</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6ff3b4d5056495b909142c225466c41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764509182&amp;x-signature=IVf%2Br999IrKTqSXsU7WTP2fSBPU%3D" alt="image-20251123202911778" loading="lazy"/></p>
<h5 data-id="heading-20">可选参数(根据需求配置)</h5>
<p><strong>2) 负向提示词 (negative_prompt)</strong> - 可选</p>
<ul>
<li>示例: <code>blurry, low quality, distorted, ugly</code></li>
<li>说明: 描述不想在图像中出现的内容</li>
</ul>
<p><strong>3) 图像数量 (num_images)</strong> - 默认1</p>
<ul>
<li>范围: 1-4张</li>
<li>说明: 批量生成多张图片供选择</li>
</ul>
<p><strong>4) 创造力参数 (temperature)</strong> - 默认0.7</p>
<ul>
<li>范围: 0.0-1.0</li>
<li>说明: 数值越高结果越有创意,越低越符合提示词</li>
</ul>
<p><strong>5) 宽高比 (aspect_ratio)</strong> - 可选</p>
<ul>
<li>选项: 1:1(正方形)、16:9(横屏)、9:16(竖屏)、4:3(标准)、3:4(纵向标准)</li>
<li>说明: 根据使用场景选择合适的比例</li>
</ul>
<p><strong>6) 风格 (style)</strong> - 可选</p>
<ul>
<li>选项: realistic(写实)、anime(动漫)、oil-painting(油画)、watercolor(水彩)、sketch(素描)</li>
<li>说明: 不同风格产生不同艺术效果</li>
</ul>
<p><strong>7) API提供商 (api_provider)</strong> - 必选</p>
<ul>
<li>选项: <code>gemai</code>(免费) 或 <code>juxin</code>(付费)</li>
<li>说明: 选择你已授权的API服务商</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba01d3b6394d48a2ba7a9625897873df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764509182&amp;x-signature=wu9Dpx%2FHu6c%2Bf5HfGe%2FsvBShcfo%3D" alt="image-20251123202853602" loading="lazy"/></p>
<p><strong>推荐配置示例</strong>:</p>
<p><strong>动漫风格配置</strong>:</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">prompt:</span> {{<span class="hljs-comment">#sys.query#}}</span>
<span class="hljs-attr">api_provider:</span> <span class="hljs-string">gemai</span>
<span class="hljs-attr">aspect_ratio:</span> <span class="hljs-number">16</span><span class="hljs-string">:9</span>
<span class="hljs-attr">style:</span> <span class="hljs-string">anime</span>
<span class="hljs-attr">num_images:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">temperature:</span> <span class="hljs-number">0.7</span>
</code></pre>
<p><strong>写实摄影配置</strong>:</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">prompt:</span> {{<span class="hljs-comment">#sys.query#}}</span>
<span class="hljs-attr">api_provider:</span> <span class="hljs-string">gemai</span>
<span class="hljs-attr">aspect_ratio:</span> <span class="hljs-number">4</span><span class="hljs-string">:3</span>
<span class="hljs-attr">style:</span> <span class="hljs-string">realistic</span>
<span class="hljs-attr">num_images:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">temperature:</span> <span class="hljs-number">0.5</span>
<span class="hljs-attr">negative_prompt:</span> <span class="hljs-string">blurry</span>, <span class="hljs-string">low</span> <span class="hljs-string">quality</span>, <span class="hljs-string">cartoon</span>
</code></pre>
<h4 data-id="heading-21">3.3.4 第三步: 添加直接回复节点</h4>
<p>添加"直接回复"节点,将插件生成的图片输出给用户:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e81940bddc7042af9273355c206dd437~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764509182&amp;x-signature=VmqvWKnjkCsBRx5gVb1XRwIFbo0%3D" alt="直接回复节点" loading="lazy"/></p>
<p><strong>配置输出内容</strong>:</p>
<p>在回复内容中填入:</p>
<pre><code class="hljs language-bash" lang="bash">{{<span class="hljs-comment">#1763885273656.text#}}</span>

{{<span class="hljs-comment">#1763885273656.files#}}</span>
</code></pre>
<p><strong>说明</strong>:</p>
<ul>
<li><code>text</code>: 插件返回的文本信息(包含生成状态、提示词等)</li>
<li><code>files</code>: 插件返回的图片文件</li>
</ul>
<p><strong>注意</strong>: 节点ID(如1763885273656)会根据你的实际工作流自动生成,请从变量列表中选择对应的输出。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6aaf513ef19a44e1bfe2ab0cc1ce98ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764509182&amp;x-signature=qZwCY03ZVTlciVOAWm7h2AsJQxQ%3D" alt="image-20251123202817913" loading="lazy"/></p>
<h4 data-id="heading-22">3.3.5 连接节点</h4>
<p>将三个节点按顺序连接:</p>
<pre><code class="hljs">开始节点 → Nano Banana2插件 → 直接回复
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78ed40ba4a9d42cca416f0735b6fba7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764509182&amp;x-signature=oOZsdH5OC%2FFiF4nBfBktJjZ9fOE%3D" alt="完整工作流" loading="lazy"/></p>
<p>至此,完整的工作流就搭建完成了!是不是超级简单?只需要三个节点,拖拖拽拽就搞定了,完全不需要写代码!</p>
<h3 data-id="heading-23">3.4 测试验证</h3>
<h4 data-id="heading-24">测试用例1: 学生证变手办</h4>
<p>我们使用一个专业的英文提示词直接生成手办效果:</p>
<p><strong>提示词</strong>:</p>
<pre><code class="hljs language-vbnet" lang="vbnet">Turn this photo <span class="hljs-keyword">into</span> a character figure. Behind it, place a box <span class="hljs-keyword">with</span> the
character<span class="hljs-comment">'s image printed on it, and a computer showing the Blender modeling</span>
process <span class="hljs-keyword">on</span> its screen. <span class="hljs-keyword">In</span> front <span class="hljs-keyword">of</span> the box, add a round plastic base <span class="hljs-keyword">with</span>
the character figure standing <span class="hljs-keyword">on</span> it. <span class="hljs-keyword">Set</span> the scene indoors <span class="hljs-keyword">if</span> possible
</code></pre>
<p>点击"运行"按钮,等待几秒钟:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40b828e1dd394706adba9e12443e1c5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764509182&amp;x-signature=MIp30cqBkXS4Bp3GvK67OoOapxk%3D" alt="测试结果1" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d14b096f217c4381a3734e41c6921b2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764509182&amp;x-signature=TDjEdkbIiDS7OtamEo3qFijOgRw%3D" alt="手办效果" loading="lazy"/></p>
<p>呵呵,效果非常棒!学生证变成了精美的手办,还有包装盒和建模界面,细节满满!</p>
<h4 data-id="heading-25">测试用例2: 教育信息图</h4>
<p><strong>提示词</strong>:</p>
<pre><code class="hljs language-makefile" lang="makefile">创建一个解释[光合作用]的教育信息图。
<span class="hljs-section">视觉元素:展示关键组成部分:太阳、一株绿色植物、水(H2O)进入根部、</span>
二氧化碳(CO2)进入叶片,以及氧气(O2)被释放。
<span class="hljs-section">风格:简洁、扁平化的矢量插图,适合高中科学教科书。</span>
使用箭头表示能量和物质的流动。
<span class="hljs-section">标签:用简体中文清晰地标注每个元素。</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/307df626431f439782d4e6a10dfdd15b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764509182&amp;x-signature=CHA05tEK66rfd9kWqt0CTv4aXGY%3D" alt="光合作用信息图" loading="lazy"/></p>
<p>中文标注清晰,流程展示专业,完全可以用于教学!这就是Nano Banana Pro强大的中文文字渲染能力。</p>
<h4 data-id="heading-26">测试用例3: 角色设定图</h4>
<p><strong>提示词</strong>:</p>
<pre><code class="hljs language-css" lang="css">横图,创作如图人物的<span class="hljs-selector-tag">A</span>-pose设计图,米白色底。
有种初期设计的感觉。
有各个部位拆分、表情差分、多角度表情、物品拆分、细节特写。
并且使用手写体文字进行标注说明,最好使用中文。
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2da8e70ba1134958b2c4dcdcaf0506f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764509182&amp;x-signature=Js8kRJYRJZeCc9u1%2BlhRnf%2Fj5S4%3D" alt="角色设定" loading="lazy"/></p>
<p>三视图、表情设定、服装拆解、细节特写,全都自动生成了,这对漫画创作者来说简直是福音!</p>
<h4 data-id="heading-27">测试用例4: 趣味创意</h4>
<p><strong>提示词</strong>:</p>
<pre><code class="hljs language-arduino" lang="arduino">一张像驾照一样的证件卡片特写,证件照是一只睡着的考拉。
证件名称写着:<span class="hljs-string">"国家一级摆烂许可证"</span>。有效期写着:<span class="hljs-string">"永久有效"</span>。
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a89d03ea93e443eabac440940f655c6c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764509182&amp;x-signature=OCFFDhE1lpOW8K95PA8NXvKzKSs%3D" alt="摆烂许可证" loading="lazy"/></p>
<p>中文文字渲染完美,字体清晰,完全没有乱码!这就是Nano Banana Pro的强大之处。</p>
<h4 data-id="heading-28">测试用例5: 趣味场景</h4>
<p><strong>提示词</strong>:</p>
<pre><code class="hljs language-arduino" lang="arduino">头发蓬乱的爱因斯坦困惑地盯着智能手机,试图自拍。
埃隆·马斯克站在他旁边,耐心地指着屏幕教他。
手机屏幕上的字:<span class="hljs-string">"怎么拍照?"</span>。
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54e9b6376b1a4686b213cf6b6bca01d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764509182&amp;x-signature=DOxKoDXONd6RorLVDL4g8IKxYQE%3D" alt="爱因斯坦学自拍" loading="lazy"/></p>
<p>好家伙!人物表情生动,场景幽默有趣,手机屏幕上的中文也清晰可见!</p>
<p>通过以上测试来看,效果非常棒,完全达到了预期。是不是非常简单?只需要三个节点,几分钟就搭建完成了!</p>
<h2 data-id="heading-29">4.项目资源</h2>
<h3 data-id="heading-30">GitHub开源地址</h3>
<p><strong>插件项目</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fwwwzhouhui%2Fnano_banana2" target="_blank" title="https://github.com/wwwzhouhui/nano_banana2" ref="nofollow noopener noreferrer">github.com/wwwzhouhui/…</a></p>
<p><strong>工作流DSL</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fwwwzhouhui%2Fdify-for-dsl" target="_blank" title="https://github.com/wwwzhouhui/dify-for-dsl" ref="nofollow noopener noreferrer">github.com/wwwzhouhui/…</a></p>
<p>觉得项目不错可以点个赞⭐</p>
<h3 data-id="heading-31">在线体验地址</h3>
<p><strong>Dify工作流体验</strong>:</p>
<ul>
<li>主地址: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdify.duckcloud.fun%2Fchat%2FDjmzXPkOkUhnldwz" target="_blank" title="https://dify.duckcloud.fun/chat/DjmzXPkOkUhnldwz" ref="nofollow noopener noreferrer">dify.duckcloud.fun/chat/DjmzXP…</a></li>
<li>备用地址: <a href="https://link.juejin.cn?target=http%3A%2F%2F14.103.204.132%2Fchat%2FDjmzXPkOkUhnldwz" target="_blank" title="http://14.103.204.132/chat/DjmzXPkOkUhnldwz" ref="nofollow noopener noreferrer">http://14.103.204.132/chat/DjmzXPkOkUhnldwz</a></li>
</ul>
<p>可以直接在线体验,无需安装!</p>
<h3 data-id="heading-32">插件下载</h3>
<p><strong>离线安装包</strong>: nano_banana2v0.0.1.difypkg</p>
<p>下载地址: 通过网盘分享的文件：nano_banana2_0.0.1.difypkg
链接: <a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.baidu.com%2Fs%2F1Q7B5opr_ce11ZEVRMgP5tw" target="_blank" title="https://pan.baidu.com/s/1Q7B5opr_ce11ZEVRMgP5tw" ref="nofollow noopener noreferrer">pan.baidu.com/s/1Q7B5opr_…</a> 提取码: xm6f</p>
<h3 data-id="heading-33">相关教程</h3>
<p><strong>参考文章</strong>:</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FrCSIeZj86kbms7K8Lt2f_w" target="_blank" title="https://mp.weixin.qq.com/s/rCSIeZj86kbms7K8Lt2f_w" ref="nofollow noopener noreferrer">Google Nano Banana Pro：图像生成王者归来，中文支持炸裂！</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FqKA3ha0n6AHVsc3VBH7t6g" target="_blank" title="https://mp.weixin.qq.com/s/qKA3ha0n6AHVsc3VBH7t6g" ref="nofollow noopener noreferrer">dify案例分享-国内首发！手把手教你用Dify调用Nano BananaAI画图</a></li>
</ul>
<hr/>
<h2 data-id="heading-34">5.总结</h2>
<p>今天主要带大家了解并实现了基于Dify工作流构建Nano Banana Pro(Gemini 3 Pro Image)AI图像生成系统的完整流程,该解决方案以"开源nano_banana2插件 + 极简三节点工作流"为核心优势,结合电商设计、广告创意、动漫创作、教育科普等多种应用场景需求,通过Dify平台的可视化工作流编排与双API提供商支持(免费Gemai API + 稳定付费Juxin API),形成了一套从文本提示词到高清图像输出的全链路AI创作解决方案。</p>
<p>通过这套实践方案,设计师、运营人员、内容创作者能够高效突破传统图像生成的访问瓶颈——借助完美的中文文字渲染(支持繁体、日韩文等多语言,准确率达97%+)、极简的工作流配置(仅需开始节点→插件节点→回复节点三步)、双API灵活选择(根据预算和需求自由切换),无需科学上网和复杂的API开发技能,就能快速实现商业级图像创作(如本次演示的"学生证变手办"、"光合作用教育图"、"角色设定图"、"趣味证件卡"、"爱因斯坦学自拍"等多个实战案例)。无论是产品海报设计、社交媒体配图、漫画角色创作、教学信息图表,还是老照片修复、3D手办制作、品牌物料生成,都能通过简单的三节点工作流配置完成,极大提升创作效率和降低技术门槛。</p>
<p>感兴趣的小伙伴可以按照文中提供的完整步骤进行实践,根据实际创作需求调整风格参数、画幅比例、创造力数值等配置项。今天的分享就到这里结束了,我们下一篇文章见。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[是什么让Claude Code如此出色（以及如何在你的 agent 中重现这种魔力）]]></title>    <link>https://juejin.cn/post/7575162322240552960</link>    <guid>https://juejin.cn/post/7575162322240552960</guid>    <pubDate>2025-11-23T13:47:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575162322240552960" data-draft-id="7575062687627198464" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="是什么让Claude Code如此出色（以及如何在你的 agent 中重现这种魔力）"/> <meta itemprop="keywords" content="Claude"/> <meta itemprop="datePublished" content="2025-11-23T13:47:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="是魔丸啊"/> <meta itemprop="url" content="https://juejin.cn/user/3217622495411292"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            是什么让Claude Code如此出色（以及如何在你的 agent 中重现这种魔力）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3217622495411292/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    是魔丸啊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T13:47:12.000Z" title="Sun Nov 23 2025 13:47:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fminusx.ai%2Fblog%2Fdecoding-claude-code%2F" target="_blank" title="https://minusx.ai/blog/decoding-claude-code/" ref="nofollow noopener noreferrer">转载</a></p>
<h2 data-id="heading-0">What makes Claude Code so damn good (and how to recreate that magic in your agent)!?</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28ecfe62f2144d0184a83456a7cfa809~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510432&amp;x-signature=EFqh48QlOAGCjH6e4MXnXN0Usqg%3D" alt="image.png" loading="lazy"/></p>
<p><strong>作者</strong>: vivek</p>
<p><strong>发布日期</strong>: 2025-08-21</p>
<p>Claude Code 是我目前使用过的最令人愉悦的 AI 代理/工作流。它不仅让定向编辑或氛围编码的临时工具不再那么烦人，使用 Claude Code 本身也让我感到快乐。它有足够的自主性来做有趣的事情，同时又不会像其他工具那样带来突兀的失控感。当然，大部分繁重的工作都是由新的 Claude 4 模型完成的（特别是交错思维）。但我发现，即使在相同的底层模型下，Claude Code 在客观上也比 Cursor 或 Github Copilot agents 更不烦人！是什么让它如此出色？如果你正在阅读这段话并点头认同，我将尝试提供一些答案。</p>
<p><strong>注意</strong>：这不是一篇泄露 Claude Code 架构的博客文章（已经有一些不错的文章了）。这篇博客旨在作为构建令人愉悦的 LLM 代理的指南，基于我过去几个月使用和调试 Claude Code 的经验（以及我们拦截和分析的所有日志）。你可以在附录部分找到 <a href="https://link.juejin.cn?target=https%3A%2F%2Fminusx.ai%2Fblog%2Fdecoding-claude-code%2F%23appendix" target="_blank" title="https://minusx.ai/blog/decoding-claude-code/#appendix" ref="nofollow noopener noreferrer">prompts</a> 和 <a href="https://link.juejin.cn?target=https%3A%2F%2Fminusx.ai%2Fblog%2Fdecoding-claude-code%2F%23appendix" target="_blank" title="https://minusx.ai/blog/decoding-claude-code/#appendix" ref="nofollow noopener noreferrer">tools</a>。这篇帖子约 2000 字，所以请做好准备！如果你想要一些快速要点，<a href="https://link.juejin.cn?target=https%3A%2F%2Fminusx.ai%2Fblog%2Fdecoding-claude-code%2F%23how-to-build-a-claude-code-like-agent-tldr" target="_blank" title="https://minusx.ai/blog/decoding-claude-code/#how-to-build-a-claude-code-like-agent-tldr" ref="nofollow noopener noreferrer">TL;DR</a> 部分是个不错的起点。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a7a1d53567d4eef9d1f0eaa804e7a54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510432&amp;x-signature=%2Fgm9nSTo7J5tJ43ZT5wPnq08l9Y%3D" alt="你可以清楚地看到不同的 Claude Code 更新" loading="lazy"/></p>
<p>你可以清楚地看到不同的 Claude Code 更新。</p>
<p>Claude Code (CC) 感觉很好用，因为它就是能正常工作。CC 是基于对 LLM 擅长什么和不擅长什么的深刻理解而精心打造的。它的 prompts 和工具弥补了模型的愚蠢，帮助它在自己的强项领域发光发热。控制循环极其简单易懂，调试起来也很简单。</p>
<p>我们在 CC 发布后立即在 MinusX 开始使用它。为了深入了解，Sreejith 编写了一个记录器，可以拦截和记录每个网络请求。以下分析基于我过去几个月的广泛使用。本文试图回答这个问题——"是什么让 Claude Code 如此出色，以及你如何在自己的基于聊天式 LLM 的代理中提供类似 CC 的体验？" 我们已经将大部分这些内容整合到 MinusX 中，我很兴奋看到你也能做到！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/734318fbbf91465ba8f3f2a954000d91~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510432&amp;x-signature=UURAL2nqcC6YUeOUYwGjW%2BWz04U%3D" alt="Edit 是最常用的工具，其次是 Read 和 ToDoWrite" loading="lazy"/></p>
<p>Edit 是最常用的工具，其次是 Read 和 ToDoWrite</p>
<h3 data-id="heading-1">如何构建类似 Claude Code 的代理：TL;DR</h3>
<p>如果只能从中学到一点，那就是——<strong>保持简单，傻瓜</strong>。LLM 已经足够难以调试和评估。你引入的任何额外复杂性（多代理、代理交接或复杂的 RAG 搜索算法）只会让调试难度增加 10 倍。如果这样一个脆弱的系统真的能工作，你也会害怕以后对它做大的改动。所以，把所有内容保持在一个文件中，避免过度的样板代码脚手架，并至少完全重写几次 :)</p>
<p>以下是 Claude Code 的主要要点，可以用于在你自己的系统中实现。</p>
<h4 data-id="heading-2">1. 控制循环</h4>
<h5 data-id="heading-3">1.1 保持一个主循环（最多一个分支）和一个消息历史</h5>
<h5 data-id="heading-4">1.2 为所有事情使用更小的模型。所有。该死的。时间。</h5>
<h4 data-id="heading-5">2. Prompts</h4>
<h5 data-id="heading-6">2.1 使用 claude.md 模式来协作和记住用户偏好</h5>
<h5 data-id="heading-7">2.2 使用特殊的 XML 标签、Markdown 和大量示例</h5>
<h4 data-id="heading-8">3. 工具</h4>
<h5 data-id="heading-9">3.1 LLM 搜索 &gt;&gt;&gt; 基于 RAG 的搜索</h5>
<h5 data-id="heading-10">3.2 如何设计好的工具？（高级 vs 低级工具）</h5>
<h5 data-id="heading-11">3.3 让你的代理管理自己的待办事项列表</h5>
<h4 data-id="heading-12">4. 可控性</h4>
<h5 data-id="heading-13">4.1 语气和风格</h5>
<h5 data-id="heading-14">4.2 "请记住这很重要" 不幸地仍然是最先进的技术</h5>
<h5 data-id="heading-15">4.3 编写算法，包含启发式方法和示例</h5>
<p>Claude Code 在每个节点都选择了架构简单性——一个主循环、简单的搜索、简单的待办列表等。抵制过度工程的冲动，为模型构建好的挽具，让它发挥！这又是端到端自动驾驶的重演吗？痛苦的教训又来了？</p>
<h3 data-id="heading-16">1. 控制循环设计</h3>
<h4 data-id="heading-17">1.1 保持一个主循环</h4>
<p>可调试性 &gt;&gt;&gt; 复杂的手工调优的多代理 lang-chain-graph-node 大杂烩。</p>
<p>尽管多代理系统正风靡一时，Claude Code 只有一个主线程。它定期使用几种不同类型的 prompts 来总结 git 历史，将消息历史压缩成一条消息，或者提出一些有趣的 UX 元素。但除此之外，它维护着一个扁平的消息列表。它处理分层任务的一个有趣方式是将自己作为子代理生成，但没有能力生成更多子代理。最多有一个分支，其结果作为"工具响应"添加到主消息历史中。</p>
<p>如果问题足够简单，主循环就通过迭代工具调用来处理。但如果有一个或多个复杂任务，主代理会创建自身的克隆。最多 1 个分支和待办事项列表的组合确保了代理能够将问题分解为子问题，同时还能关注最终期望的结果。</p>
<p>我非常怀疑你的应用需要一个多代理系统。每一层抽象都会让你的系统更难调试，更重要的是，你会偏离通用模型的改进轨迹。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2b340e1dfea4bfca6b9740fe2806aea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510432&amp;x-signature=zJtxpCbMgRoOg0g%2FSFpVZelawyo%3D" alt="控制循环" loading="lazy"/></p>
<h4 data-id="heading-18">1.2 为一切使用更小的模型</h4>
<p>CC 产生的所有重要 LLM 调用中超过 50% 都是调用 claude-3-5-haiku。它用于读取大文件、解析网页、处理 git 历史和总结长对话。它还用于提出单字处理标签——字面上是为了每次击键！较小的模型比标准模型（Sonnet 4、GPT-4.1）便宜 70-80%。随便使用它们！</p>
<h3 data-id="heading-19">2. Prompts</h3>
<p>Claude Code 有极其精心设计的 prompts，充满了启发式方法、示例和重要（提醒）的提醒。系统 prompt 长约 2800 个 token，工具占用惊人的 9400 个 token。用户 prompt 总是包含 claude.md 文件，通常还有另外 1000-2000 个 token。系统 prompt 包含关于语气、风格、主动性、任务管理、工具使用策略和执行任务的章节。它还包含日期、当前工作目录、平台和操作系统信息以及最近的提交。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fminusx.ai%2Fblog%2Fdecoding-claude-code%2F%23appendix" target="_blank" title="https://minusx.ai/blog/decoding-claude-code/#appendix" ref="nofollow noopener noreferrer">去读完整的 prompt</a>！</p>
<h4 data-id="heading-20">2.1 使用 claude.md 来协作用户上下文和偏好</h4>
<p>大多数编码代理创作者已经确定的主要模式之一是上下文文件（aka Cursor Rules / claude.md / agent.md）。Claude Code 在有无 claude.md 的情况下的表现简直是天壤之别。这是开发者提供无法从代码库推断的上下文和编码所有严格偏好的好方法。例如，你可以强制 LLM 跳过某些文件夹，或使用特定的库。CC 在每次用户请求时都发送 claude.md 的全部内容</p>
<p>我们最近在 MinusX 中引入了 <a href="https://link.juejin.cn?target=https%3A%2F%2Fminusx.ai%2Fblog%2Fmemory%2F" target="_blank" title="https://minusx.ai/blog/memory/" ref="nofollow noopener noreferrer">minusx.md</a>，它正快速成为我们代理编码用户和团队偏好的事实上下文文件。</p>
<h4 data-id="heading-21">2.2 特殊的 XML 标签、Markdown 和大量示例</h4>
<p>XML 标签和 Markdown 是构建 prompt 的两种方式，这一点已经相当确定。CC 大量使用两者。以下是 Claude Code 中一些值得注意的 XML 标签：</p>
<p><code>&lt;system-reminder&gt;</code>：这在许多 prompt 章节的末尾使用，以提醒 LLM 那些它否则可能会忘记的事情。示例：</p>
<pre><code class="hljs language-perl" lang="perl">&lt;<span class="hljs-keyword">system</span>-reminder&gt;提醒你，待办事项列表当前为空。不要明确向用户提及此事，因为他们已经知晓。如果你正在处理可以从待办事项列表中受益的任务，请使用 TodoWrite 工具创建一个。如果没有，请随时忽略。再次不要向用户提及此消息。&lt;/<span class="hljs-keyword">system</span>-reminder&gt;
</code></pre>
<p><code>&lt;good-example&gt;</code>、<code>&lt;bad-example&gt;</code>：这些用于编码启发式方法。当有多条看似合理的路径/tool_calls 可供模型选择时，它们特别有用。示例可以用来对比案例，非常清楚地说明哪条路径更可取。示例：</p>
<pre><code class="hljs language-bash" lang="bash">尝试在整个会话过程中保持当前工作目录，使用绝对路径避免使用 `<span class="hljs-built_in">cd</span>`。如果用户明确要求，你可以使用 `<span class="hljs-built_in">cd</span>`。
&lt;good-example&gt;
pytest /foo/bar/tests
&lt;/good-example&gt;
&lt;bad-example&gt;
<span class="hljs-built_in">cd</span> /foo/bar &amp;&amp; pytest tests
&lt;/bad-example&gt;
</code></pre>
<p>CC 还使用 markdown 在系统 prompt 中划分清晰的章节。示例 markdown 标题包括：</p>
<ul>
<li>语气和风格</li>
<li>主动性</li>
<li>遵循约定</li>
<li>代码风格</li>
<li>任务管理</li>
<li>工具使用策略</li>
<li>执行任务</li>
<li>工具</li>
</ul>
<h3 data-id="heading-22">3. 工具</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fminusx.ai%2Fblog%2Fdecoding-claude-code%2F%23appendix" target="_blank" title="https://minusx.ai/blog/decoding-claude-code/#appendix" ref="nofollow noopener noreferrer">去读完整的工具 prompt</a> - 它长达惊人的 9400 个 token！</p>
<h4 data-id="heading-23">3.1 LLM 搜索 &gt;&gt;&gt; 基于 RAG 的搜索</h4>
<p>CC 与其他流行编码代理的一个显著不同之处在于它拒绝 RAG。Claude Code 搜索你的代码库就像你一样，使用非常复杂的 <code>ripgrep</code>、<code>jq</code> 和 <code>find</code> 命令。由于 LLM 非常理解代码，它可以使用复杂的正则表达式找到它认为相关的任何代码块。有时它最终会用更小的模型读取整个文件。</p>
<p>RAG 理论上听起来是个好主意，但它引入了新的（更重要的是，隐藏的）失败模式。使用什么相似性函数？什么重排序器？如何分块代码？如何处理大型 JSON 或日志文件？使用 LLM 搜索，它只需查看 json 文件的 10 行来理解其结构。如果需要，它会再看 10 行——就像你会做的那样。最重要的是，这是 RL 可学习的——BigLabs 已经在研究这个。模型承担了大部分繁重工作——正如它应该的，大幅减少了代理中的活动部件。此外，以这种方式连接两个复杂的智能系统只是很丑陋。我最近和朋友开玩笑说这是 LLM 时代的相机 vs 激光雷达，我只是半开玩笑。</p>
<h4 data-id="heading-24">3.2 如何设计好的工具？（低级 vs 高级工具）</h4>
<p>这个问题让任何构建 LLM 代理的人夜不能寐。你应该给模型通用任务（如有意义的操作）还是低级任务（如打字、点击和 bash）？答案是有关系的（你应该两者都用）。</p>
<p>Claude Code 有低级（Bash、Read、Write）、中级（Edit、Grep、Glob）和高级工具（Task、WebFetch、exit_plan_mode）。CC 可以使用 bash，那为什么还要单独的 Grep 工具？这里真正的权衡在于你期望代理使用工具的频率与代理使用工具的准确性。CC 非常频繁地使用 grep 和 glob，所以将它们做成单独的工具是有意义的，但同时，它也可以为特殊场景编写通用的 bash 命令。</p>
<p>类似地，还有更高级的工具，如 WebFetch 或 'mcp__ide__getDiagnostics'，它们的功能极其确定性。这节省了 LLM 进行多次低级点击和输入，并保持其正轨。帮帮可怜的模型，好吗！？工具描述有精心设计的 prompts，包含大量示例。系统 prompt 包含关于"何时使用工具"或如何在两个可以执行相同任务的工具之间进行选择的信息。</p>
<p>Claude Code 中的工具：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fminusx.ai%2Fblog%2Fdecoding-claude-code%2F%23appendix" target="_blank" title="https://minusx.ai/blog/decoding-claude-code/#appendix" ref="nofollow noopener noreferrer">Task</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fminusx.ai%2Fblog%2Fdecoding-claude-code%2F%23appendix" target="_blank" title="https://minusx.ai/blog/decoding-claude-code/#appendix" ref="nofollow noopener noreferrer">Bash</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fminusx.ai%2Fblog%2Fdecoding-claude-code%2F%23appendix" target="_blank" title="https://minusx.ai/blog/decoding-claude-code/#appendix" ref="nofollow noopener noreferrer">Glob</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fminusx.ai%2Fblog%2Fdecoding-claude-code%2F%23appendix" target="_blank" title="https://minusx.ai/blog/decoding-claude-code/#appendix" ref="nofollow noopener noreferrer">Grep</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fminusx.ai%2Fblog%2Fdecoding-claude-code%2F%23appendix" target="_blank" title="https://minusx.ai/blog/decoding-claude-code/#appendix" ref="nofollow noopener noreferrer">LS</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fminusx.ai%2Fblog%2Fdecoding-claude-code%2F%23appendix" target="_blank" title="https://minusx.ai/blog/decoding-claude-code/#appendix" ref="nofollow noopener noreferrer">ExitPlanMode</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fminusx.ai%2Fblog%2Fdecoding-claude-code%2F%23appendix" target="_blank" title="https://minusx.ai/blog/decoding-claude-code/#appendix" ref="nofollow noopener noreferrer">Read</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fminusx.ai%2Fblog%2Fdecoding-claude-code%2F%23" target="_blank" title="https://minusx.ai/blog/decoding-claude-code/#" ref="nofollow noopener noreferrer">Edit</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fminusx.ai%2Fblog%2Fdecoding-claude-code%2F%23appendix" target="_blank" title="https://minusx.ai/blog/decoding-claude-code/#appendix" ref="nofollow noopener noreferrer">MultiEdit</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fminusx.ai%2Fblog%2Fdecoding-claude-code%2F%23appendix" target="_blank" title="https://minusx.ai/blog/decoding-claude-code/#appendix" ref="nofollow noopener noreferrer">Write</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fminusx.ai%2Fblog%2Fdecoding-claude-code%2F%23appendix" target="_blank" title="https://minusx.ai/blog/decoding-claude-code/#appendix" ref="nofollow noopener noreferrer">NotebookEdit</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fminusx.ai%2Fblog%2Fdecoding-claude-code%2F%23appendix" target="_blank" title="https://minusx.ai/blog/decoding-claude-code/#appendix" ref="nofollow noopener noreferrer">WebFetch</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fminusx.ai%2Fblog%2Fdecoding-claude-code%2F%23appendix" target="_blank" title="https://minusx.ai/blog/decoding-claude-code/#appendix" ref="nofollow noopener noreferrer">TodoWrite</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fminusx.ai%2Fblog%2Fdecoding-claude-code%2F%23appendix" target="_blank" title="https://minusx.ai/blog/decoding-claude-code/#appendix" ref="nofollow noopener noreferrer">WebSearch</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fminusx.ai%2Fblog%2Fdecoding-claude-code%2F%23" target="_blank" title="https://minusx.ai/blog/decoding-claude-code/#" ref="nofollow noopener noreferrer">mcp__ide__getDiagnostics</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fminusx.ai%2Fblog%2Fdecoding-claude-code%2F%23" target="_blank" title="https://minusx.ai/blog/decoding-claude-code/#" ref="nofollow noopener noreferrer">mcp__ide__executeCode</a></li>
</ul>
<h4 data-id="heading-25">3.3 让代理管理待办事项列表</h4>
<p>这样做有很多好处。上下文腐烂是长期运行的 LLM 代理中的常见问题。它们热情地开始处理困难问题，但随着时间推移迷失方向，退化为垃圾。当前的代理设计有几种方法来解决这个问题。许多代理已经尝试了显式待办事项（一个模型生成待办事项，另一个模型实现它们）或多代理交接 + 验证（PRD/PM 代理 -&gt; 实现者代理 -&gt; QA 代理）</p>
<p>我们已经知道多代理交接不是个好主意，有很多很多原因。CC 使用显式的待办事项列表，但是由模型维护的。这保持了 LLM 正轨（它被大量提示要频繁参考待办事项列表），同时也给予模型在实施中途纠正路线的灵活性。这也有效地利用了模型的交错思维能力来即时拒绝或插入新的待办事项。</p>
<h3 data-id="heading-26">4. 可控性</h3>
<h4 data-id="heading-27">4.1 语气和风格</h4>
<p>CC 明确尝试控制代理的美学行为。系统 prompt 中有关于语气、风格和主动性的章节——充满了指令和示例。这就是为什么 Claude Code 在其评论和热情方面"感觉"很有品味。我建议将这些大部分原样复制到你的应用中。</p>
<h5 data-id="heading-28">语气和风格的一些示例</h5>
<ul>
<li>
<p>重要：你不应该用不必要的前言或后言（如解释你的代码或总结你的行动）来回答，除非用户要求你。
除非用户要求，否则不要添加额外的代码解释摘要。</p>
</li>
<li>
<p>如果你不能或不愿意帮助用户某事，请不要说原因或可能导致什么，因为这显得说教和烦人。</p>
</li>
<li>
<p>只有在用户明确要求时才使用表情符号。避免在所有交流中使用表情符号，除非被要求。</p>
</li>
</ul>
<h4 data-id="heading-29">4.2 "这很重要"仍然是最先进的技术</h4>
<p>不幸的是，在要求模型不要做某事方面，CC 并不更好。重要、非常重要、从不和总是似乎是将模型引导避开地雷的最佳方式。我期望模型在未来变得更加可控，避免这种丑陋。但现在，CC 大量使用这个，你也应该这样做。一些示例：</p>
<ul>
<li>
<p>重要：除非被要求，否则不要添加任何注释</p>
</li>
<li>
<p>非常重要：你必须避免使用像 <code>find</code> 和 <code>grep</code> 这样的搜索命令。而是使用 Grep、Glob 或 Task 来搜索。你必须避免像 <code>cat</code>、<code>head</code>、<code>tail</code> 和 <code>ls</code> 这样的读取工具，使用 Read 和 LS 来读取文件。</p>
</li>
<li>
<p>如果你仍然需要运行 <code>grep</code>，停止。总是先使用 <code>rg</code> 的 ripgrep</p>
</li>
<li>
<p>重要：除非你确信这些 URL 是为了帮助用户编程，否则绝不能为用户生成或猜测 URL。你可以使用用户在消息或本地文件中提供的 URL。</p>
</li>
</ul>
<h4 data-id="heading-30">4.3 编写算法（包含启发式方法和示例）</h4>
<p>识别 LLM 需要执行的最重要的任务并为其编写算法极其重要。尝试扮演 LLM 的角色并处理示例，识别所有决策点并明确写出它们。如果以流程图的形式表达会很有帮助。这有助于构建决策制定并帮助 LLM 遵循指令。绝对要避免的是一大堆混杂的该做和不该做。它们更难跟踪，而且相互排斥。如果你的 prompt 长达几千个 token，你将无意中有冲突的该做和不该做。在这种情况下，LLM 变得极其脆弱，变得不可能包含新的用例。</p>
<p>Claude Code 系统 prompt 中的<a href="https://link.juejin.cn?target=https%3A%2F%2Fminusx.ai%2Fblog%2Fdecoding-claude-code%2F%23appendix" target="_blank" title="https://minusx.ai/blog/decoding-claude-code/#appendix" ref="nofollow noopener noreferrer">任务管理</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fminusx.ai%2Fblog%2Fdecoding-claude-code%2F%23appendix" target="_blank" title="https://minusx.ai/blog/decoding-claude-code/#appendix" ref="nofollow noopener noreferrer">执行任务</a>和<a href="https://link.juejin.cn?target=https%3A%2F%2Fminusx.ai%2Fblog%2Fdecoding-claude-code%2F%23appendix" target="_blank" title="https://minusx.ai/blog/decoding-claude-code/#appendix" ref="nofollow noopener noreferrer">工具使用策略</a>章节清楚地演示了要遵循的算法。这也是添加大量启发式方法和 LLM 可能遇到的各种场景示例的地方。</p>
<h3 data-id="heading-31">奖励：为什么要关注 BigLab 的 prompts？</h3>
<p>引导 LLM 的很多努力都是试图逆向工程它们的训练后 / RLHF 数据分布。你应该使用 JSON 还是 XML？工具描述应该在系统 prompt 中还是只在工具中？你应用的当前状态如何？看看它们在自己的应用中做什么并用它来指导你的应用会很有帮助。Claude Code 设计非常有主见，这有助于形成你自己的观点。</p>
<h3 data-id="heading-32">结论</h3>
<p>主要要点再次是保持简单。极端的脚手架框架弊大于利。Claude Code 真的让我相信一个"代理"可以简单而极其强大。我们已经将其中许多教训整合到 MinusX 中，并继续整合更多。</p>
<p>如果你有兴趣为自己的 LLM 代理进行 Claude 化，我很想聊聊——在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fnuwandavek" target="_blank" title="https://x.com/nuwandavek" ref="nofollow noopener noreferrer">twitter</a> 上联系我！如果你想要可训练的类似 Claude Code 的数据代理用于你的 Metabase，查看 <a href="https://link.juejin.cn?target=https%3A%2F%2Fminusx.ai%2F" target="_blank" title="https://minusx.ai/" ref="nofollow noopener noreferrer">MinusX</a> 或与我 <a href="https://link.juejin.cn?target=https%3A%2F%2Fminusx.ai%2Fdemo" target="_blank" title="https://minusx.ai/demo" ref="nofollow noopener noreferrer">这里</a> 设置演示。愉快的（Claude）编码！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一款基于 .NET + 计算机视觉技术开源免费、功能强大的原神智能辅助工具，一键解放双手！]]></title>    <link>https://juejin.cn/post/7575442779039449130</link>    <guid>https://juejin.cn/post/7575442779039449130</guid>    <pubDate>2025-11-23T13:46:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575442779039449130" data-draft-id="7575655132755673107" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一款基于 .NET + 计算机视觉技术开源免费、功能强大的原神智能辅助工具，一键解放双手！"/> <meta itemprop="keywords" content="后端,.NET"/> <meta itemprop="datePublished" content="2025-11-23T13:46:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="追逐时光者"/> <meta itemprop="url" content="https://juejin.cn/user/2770425031690333"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一款基于 .NET + 计算机视觉技术开源免费、功能强大的原神智能辅助工具，一键解放双手！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2770425031690333/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    追逐时光者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T13:46:35.000Z" title="Sun Nov 23 2025 13:46:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>今天大姚给大家分享一款基于 .NET + 计算机视觉技术完全开源免费（GPL-3.0 license）、功能强大的原神智能辅助自动化工具，意图让原神变的更好的项目：better-genshin-impact。</p>
<h2 data-id="heading-1">项目介绍</h2>
<p>better-genshin-impact 是一款基于 .NET + 计算机视觉技术完全开源免费（GPL-3.0 license）、功能强大的原神智能辅助自动化工具，意图让原神变的更好的项目，包含：自动剧情、全自动钓鱼(AI)、全自动七圣召唤、自动伐木、自动刷本、自动采集/挖矿/锄地等功能。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3dfcc3215a8e493d83856181a9b78483~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510395&amp;x-signature=8t6YHRsrcVNRy%2Bd1b9RHz0Pca58%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">特性与自动化功能列表</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3751e3ae48c94694803f4b1f88d9c782~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510395&amp;x-signature=00PYnXOjaUMLGHhvw%2FQOR3hPduo%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fdd82fa2c0604c26b7f96a53f3766f55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510395&amp;x-signature=7Ya8IV4feXvsopal8WI3ZCxUo%2Fg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">项目源代码运行</h2>
<p>设置<code>BetterGenshinImpact</code>为启动项目运行查看效果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ff4f5dd2999445d8488c5782b0f4cbb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510395&amp;x-signature=xttcZXscl4UmvF8S9EjGOOUs4Jk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8f82398c23444e482390350ae3ee053~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510395&amp;x-signature=JqbRHvO3ui1QWtEL0HVAcztBPS8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">项目效果演示</h2>
<h3 data-id="heading-5">实时触发</h3>
<p>包含功能：自动拾取、自动剧情、自动邀约、自动吃药、快速传送、自动烹饪等。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5eb1418acdd472d9c779d1187c69829~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510395&amp;x-signature=RmZranY6MA7EbAQ9MMYOABJI6yY%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">独立任务</h3>
<p>包含功能：自动七圣召唤、自动伐木、自动战斗、自动秘境、自动幽镜危机、自动分解圣遗物等。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/406944c58fda48db9bb538b014a4932e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510395&amp;x-signature=lE4STpVT%2B2LtZwac2jQxN4tNe4g%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">一条龙</h3>
<p>一键完成日常（使用历练点），并领取奖励。 <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/389a97c8c4e841bb972f40625817c0c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510395&amp;x-signature=GDKPlka44m%2FBuRMWyGttx%2BIeY%2FQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8">全自动</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aef41979b01c42c59584afa79ac8351b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510395&amp;x-signature=II0e3zU3Z9nBwuaqYdnXYAp3QYo%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b3f80c80b1549b3b8f544cd7c08199e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510395&amp;x-signature=cBAJfleJ7vpy7CmKmg0jGt%2B%2F07s%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10f2cb54c28b43e98c704e7ce60b487f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510395&amp;x-signature=r26Fb8JJFUk6yB%2F%2FI0Igj1Y%2FGOk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37cdc06a3045463fb1772dfe0eee2e9c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510395&amp;x-signature=i5FSyEED1%2BH6PoaUnNxRjQCeey4%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4316e654c8941bcafcb299d4dd7327e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510395&amp;x-signature=CsKI7h16sjZdqyE4%2BgsaI0A7E%2B8%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/578049a80efc4c60ad0043083b751ae6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510395&amp;x-signature=7a0uvKDH9Z0hVZ43fzl5UQTdtuE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-9">辅助操控</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c179e43019a74e2f97e740e5e78b3f95~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510395&amp;x-signature=e82efRlJ33Xx9l1%2BhSXZHmrSfYo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">快捷键设置</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/13e323a6f0484a8683d56a0315e8ad5a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510395&amp;x-signature=omybs52GcQ7hrMMqsDKfdDKVlkw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-11">通知</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/519fe4912a924a5a80bce5a1c0e6470f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510395&amp;x-signature=DWiydQ6CNZWpfWzpD2bDMhF1zBg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-12">设置</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23caaf71fa644d188ea36f762f6fe4a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510395&amp;x-signature=nji95wnPvioebgq1Otcu5KQwMWI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-13">项目源码地址</h2>
<p>更多项目实用功能和特性欢迎前往项目开源地址查看👀，别忘了给项目一个Star支持💖。</p>
<ul>
<li><strong>项目在线使用文档：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fbettergi.com%2F" target="_blank" title="https://bettergi.com/" ref="nofollow noopener noreferrer">bettergi.com/</a></li>
<li><strong>GitHub开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbabalae%2Fbetter-genshin-impact" target="_blank" title="https://github.com/babalae/better-genshin-impact" ref="nofollow noopener noreferrer">github.com/babalae/bet…</a></li>
<li><strong>飞书下载地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Flcn33tlcifll.feishu.cn%2Fdrive%2Ffolder%2FLiSMf5SvPl91qrdJr8IccmUon7f" target="_blank" title="https://lcn33tlcifll.feishu.cn/drive/folder/LiSMf5SvPl91qrdJr8IccmUon7f" ref="nofollow noopener noreferrer">lcn33tlcifll.feishu.cn/drive/folde…</a></li>
</ul>
<h2 data-id="heading-14">优秀项目和框架精选</h2>
<p>该项目已收录到C#/.NET/.NET Core优秀项目和框架精选中，关注优秀项目和框架精选能让你及时了解C#、.NET和.NET Core领域的最新动态和最佳实践，提高开发工作效率和质量。坑已挖，欢迎大家踊跃提交PR推荐或自荐（<strong>让优秀的项目和框架不被埋没🤞</strong>）。</p>
<ul>
<li><strong>GitHub开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYSGStudyHards%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectPicks.md" target="_blank" title="https://github.com/YSGStudyHards/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md" ref="nofollow noopener noreferrer">github.com/YSGStudyHar…</a></li>
<li><strong>Gitee开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fysgdaydayup%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectPicks.md" target="_blank" title="https://gitee.com/ysgdaydayup/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md" ref="nofollow noopener noreferrer">gitee.com/ysgdaydayup…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[精选 5 款 .NET 开源、实用的商城系统（Shop），快速商城二开利器！]]></title>    <link>https://juejin.cn/post/7575442779039481898</link>    <guid>https://juejin.cn/post/7575442779039481898</guid>    <pubDate>2025-11-23T13:52:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575442779039481898" data-draft-id="7575442779039465514" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="精选 5 款 .NET 开源、实用的商城系统（Shop），快速商城二开利器！"/> <meta itemprop="keywords" content="后端,.NET"/> <meta itemprop="datePublished" content="2025-11-23T13:52:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="追逐时光者"/> <meta itemprop="url" content="https://juejin.cn/user/2770425031690333"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            精选 5 款 .NET 开源、实用的商城系统（Shop），快速商城二开利器！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2770425031690333/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    追逐时光者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T13:52:52.000Z" title="Sun Nov 23 2025 13:52:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>今天大姚给大家分享 5 款基于 .NET 开源、实用的商城系统（Shop），快速商城二开利器！希望可以帮助到有商城系统开发需求的同学。</p>
<h2 data-id="heading-1">nopCommerce</h2>
<p>nopCommerce是一个.NET开源功能丰富、免费、灵活且可定制的开源电子商务解决方案(大家假如有商城需求可以直接使用该项目进行二次开发，省时省力) ，具备商城该有的各种功能和特性。</p>
<ul>
<li>项目源码地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FnopSolutions%2FnopCommerce" target="_blank" title="https://github.com/nopSolutions/nopCommerce" ref="nofollow noopener noreferrer">github.com/nopSolution…</a></li>
<li>项目详细介绍：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FGMCIYwGUr4JkraeWIG-F0Q" target="_blank" title="https://mp.weixin.qq.com/s/GMCIYwGUr4JkraeWIG-F0Q" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/GMCIYwGUr…</a></li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2aaa6930626d4f288d26d52691b6852a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510772&amp;x-signature=WPlmV0zatKLJtYQwuBLUCtma9yg%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4eec2cc888c44a7b1322a6ef1cf205e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510772&amp;x-signature=84dHYZ5zWwDR3RxwatDWj5f2p9A%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">CoreShop</h2>
<p>CoreShop完整开源、无封装无加密、商用免费、支持跨平台、多数据库支持，基于 Asp.Net 8.0、Uni-App开发、支持可视化布局的商城系统；前后端分离，支持跨平台运行；拥有分销、代理、团购秒杀、接龙、拼团、直播、优惠券、自定义表单等众多营销功能；支持一键发布到微信小程序、H5、安卓APP、苹果APP。</p>
<ul>
<li>项目源码地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCoreUnion%2FCoreShop" target="_blank" title="https://github.com/CoreUnion/CoreShop" ref="nofollow noopener noreferrer">github.com/CoreUnion/C…</a></li>
<li>项目详细介绍：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FiRxmWUXrqArZD_Ax4i6wwg" target="_blank" title="https://mp.weixin.qq.com/s/iRxmWUXrqArZD_Ax4i6wwg" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/iRxmWUXrq…</a></li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c105072a7b9a47cab560b076336f6fc4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510772&amp;x-signature=%2Fzp3ftcgfnUqawUDD9sKD9e02hM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e22b362fe879456a94ae1b2757fd0494~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510772&amp;x-signature=0Yy4q25x1IkzlbZvT2zdo5MICR0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">UrShop</h2>
<p>UrShop 是一款基于原生微信小程序 + .NET Core + Layui 技术构建、开源（GPL-3.0）、功能全面的微信小程序商城系统，项目包微信小程序端和后台管理端。</p>
<ul>
<li>项目源码地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Furselect%2Furshop" target="_blank" title="https://gitee.com/urselect/urshop" ref="nofollow noopener noreferrer">gitee.com/urselect/ur…</a></li>
<li>项目详细介绍：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FArLHsMB2eBJMadQkjaPehw" target="_blank" title="https://mp.weixin.qq.com/s/ArLHsMB2eBJMadQkjaPehw" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/ArLHsMB2e…</a></li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55b71ba20b5f4ba494e033acf9662128~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510772&amp;x-signature=gSLvkE2nTWfAqi8XLLWjq94vQeQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/516fbabc6c894fb28bf454d045e95e9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510772&amp;x-signature=hWacPCdHB6HtuB2llUoeMfNwm%2FI%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8cac3323f04644ef9b11ddbfa10504ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510772&amp;x-signature=xhuS%2BYHzbAYMQ6PApX6irv3WAQ0%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f94b9b370174370883708cd44f9d24d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510772&amp;x-signature=kMeRgboB4JV07Tdds7NXXc1VGIs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">eShop</h2>
<p>eShop基于.NET 9构建，并集成了.NET Aspire、Blazor、Azure OpenAI等先进技术，数据库采用 PostgreSQL，缓存采用 Redis，客户端支持网页版本、iOS 版本和安卓版本，为开发者提供了一个学习和实践的平台。此外，项目还提供了详细的运行和部署指南，以及示例产品数据和AI集成，帮助开发者更好地理解和应用这些技术。</p>
<ul>
<li>项目源码地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdotnet%2FeShop" target="_blank" title="https://github.com/dotnet/eShop" ref="nofollow noopener noreferrer">github.com/dotnet/eSho…</a></li>
<li>项目详细介绍：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FufxiFkdNbW6UaufvlHE2FQ" target="_blank" title="https://mp.weixin.qq.com/s/ufxiFkdNbW6UaufvlHE2FQ" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/ufxiFkdNb…</a></li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26307e3d43cb43f7b4406d0a99f9ab3d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510772&amp;x-signature=NmIrW6JRkv1THVXePwj%2FD9rOTOI%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc0c5d4fc69e44fdb853de4b16877c56~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510772&amp;x-signature=fTlGhd2C5YtbVldbkopyTGOly5w%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">Module Shop</h2>
<p>Module Shop是一个基于.NET Core构建的简单、跨平台、模块化、完全开源免费（MIT License）的商城系统。</p>
<ul>
<li>项目源码地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftrueai-org%2Fmodule-shop" target="_blank" title="https://github.com/trueai-org/module-shop" ref="nofollow noopener noreferrer">github.com/trueai-org/…</a></li>
<li>项目详细介绍：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FGa6HUZMNVD117IErVSEgfw" target="_blank" title="https://mp.weixin.qq.com/s/Ga6HUZMNVD117IErVSEgfw" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/Ga6HUZMNV…</a></li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ef7eed2e4a04ec694046117b2db3f2e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510772&amp;x-signature=VIEOTEJKQ2%2FAV5bKsnTKRgUAyAM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/704660f4e6e3471eb6578f0986a54165~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510772&amp;x-signature=tN%2BK9RaFsjdf76jbaGA6U4CiBW8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">优秀项目和框架精选</h2>
<p>本文所有项目都已收录到C#/.NET/.NET Core优秀项目和框架精选中，关注优秀项目和框架精选能让你及时了解C#、.NET和.NET Core领域的最新动态和最佳实践，提高开发工作效率和质量。假如你有更好的推荐，欢迎大家踊跃提交PR推荐或自荐（<strong>让优秀的项目和框架不被埋没</strong>🤞）。</p>
<ul>
<li><strong>GitHub开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYSGStudyHards%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectPicks.md" target="_blank" title="https://github.com/YSGStudyHards/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md" ref="nofollow noopener noreferrer">github.com/YSGStudyHar…</a></li>
<li><strong>Gitee开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fysgdaydayup%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectPicks.md" target="_blank" title="https://gitee.com/ysgdaydayup/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md" ref="nofollow noopener noreferrer">gitee.com/ysgdaydayup…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[网页也懂黑夜与白天：系统主题自动切换]]></title>    <link>https://juejin.cn/post/7575425466905329727</link>    <guid>https://juejin.cn/post/7575425466905329727</guid>    <pubDate>2025-11-23T13:58:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575425466905329727" data-draft-id="7570197010885230638" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="网页也懂黑夜与白天：系统主题自动切换"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-23T13:58:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一诺滚雪球"/> <meta itemprop="url" content="https://juejin.cn/user/2824015112318094"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            网页也懂黑夜与白天：系统主题自动切换
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2824015112318094/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一诺滚雪球
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T13:58:51.000Z" title="Sun Nov 23 2025 13:58:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>不知道大家有没有遇到过，网页会根据系统设置的外观模式，显示不同的主题样式。这是如何实现的呢？</p>
<h2 data-id="heading-1">1、核心原理：认识 prefers-color-scheme 媒体查询</h2>
<p>CSS原生媒体特性 prefers-color-scheme 是实现主题自动切换的核心，它能检测用户操作系统（Windows、macOS、iOS、Android 等）的主题设置，返回三个可能值：</p>
<ul>
<li>light：用户设置浅色主题</li>
<li>dark：用户设置深色主题</li>
<li>no-preference：用户未设置（默认按浅色处理）</li>
</ul>
<p>能覆盖绝大多数现代设备，无需额外 JS 即可实现基础切换。</p>
<h2 data-id="heading-2">2、案例实现</h2>
<h3 data-id="heading-3">2.1 定义浅色主题</h3>
<p>先在:root中定义浅色主题的基础变量：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@media</span>(prefers-color-scheme: light) {
    <span class="hljs-selector-pseudo">:root</span> {
        <span class="hljs-attr">--bg-color</span>: <span class="hljs-number">#ffffff</span>;
        <span class="hljs-comment">/* 浅色背景 */</span>
        <span class="hljs-attr">--text-color</span>: <span class="hljs-number">#333333</span>;
        <span class="hljs-comment">/* 浅色文字 */</span>
    }
}
</code></pre>
<h3 data-id="heading-4">2.2 定义深色主题</h3>
<p>通过 @media (prefers-color-scheme: dark) 覆盖深色主题的变量：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@media</span> (<span class="hljs-attribute">prefers-color-scheme</span>: dark) {
  <span class="hljs-selector-pseudo">:root</span> {
    <span class="hljs-attr">--bg-color</span>: <span class="hljs-number">#121212</span>; <span class="hljs-comment">/* 深色背景（避免纯黑） */</span>
    <span class="hljs-attr">--text-color</span>: <span class="hljs-number">#e5e7eb</span>; <span class="hljs-comment">/* 浅色文字（避免纯白） */</span>
  }
}
</code></pre>
<h3 data-id="heading-5">2.3 页面使用</h3>
<p>在页面样式中统一使用 CSS 变量，无需重复编写明暗逻辑：</p>
<p>如何监听系统模式的变化：可以监听<code>prefers-color-scheme: dark</code>的变化，当matches为true时，为深色模式。</p>
<pre><code class="hljs language-js" lang="js"> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">matchMedia</span>(<span class="hljs-string">'(prefers-color-scheme: dark)'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'change'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {});
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ee5b938cac24c0abb9e910fe0deefda~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA6K-65rua6Zuq55CD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764511130&amp;x-signature=T2TQ2jh24bmpHwNWRLPytfqmZcw%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-js" lang="js">body {
  background-<span class="hljs-attr">color</span>: <span class="hljs-title function_">var</span>(--bg-color);
  <span class="hljs-attr">color</span>: <span class="hljs-title function_">var</span>(--text-color);
  font-<span class="hljs-attr">size</span>: 16px;
}
</code></pre>
<p>可以在谷歌浏览器中设置切换：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/352c861318c749e7aca633335779847b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA6K-65rua6Zuq55CD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764511130&amp;x-signature=57337kW1dal92veo5nHqWSlnG4Q%3D" alt="image.png" loading="lazy"/></p>
<p>效果如下：</p>
<p>深色：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/714a99bc3fb24c2eac72ca213ae187d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA6K-65rua6Zuq55CD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764511130&amp;x-signature=7xGhDrBflbyuD6Q3tXljTfBlIj4%3D" alt="image.png" loading="lazy"/></p>
<p>浅色：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9561903b2ae14352a7be1f361ae6d4b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA6K-65rua6Zuq55CD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764511130&amp;x-signature=ZcPZJASNPny%2BMyd7vS36XMvhIbc%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-6">3、如何简写</h2>
<p>上面的写法稍微有点复杂，可以使用<strong>CSS 的 <code>color-scheme</code>和 <code>light-dark()</code>函数</strong>，来实现 <strong>根据系统主题（深色/浅色模式）自动切换背景和文字颜色</strong>​ 的效果。</p>
<pre><code class="hljs language-js" lang="js">:root {
    color-<span class="hljs-attr">scheme</span>: light dark;
}

body {
    background-<span class="hljs-attr">color</span>: light-<span class="hljs-title function_">dark</span>(#ffffff, #<span class="hljs-number">121212</span>);
    <span class="hljs-attr">color</span>: light-<span class="hljs-title function_">dark</span>(#<span class="hljs-number">333333</span>, #e5e7eb);
    font-<span class="hljs-attr">size</span>: 16px;
}
</code></pre>
<p>告诉浏览器和操作系统，这个网页 <strong>支持浅色（light）和深色（dark）两种主题模式</strong>，<strong>CSS新增的 <code>light-dark()</code>函数</strong>，允许你 <strong>在一个声明里同时为浅色模式和深色模式定义颜色</strong>。</p>
<h2 data-id="heading-7">4、用户手动切换主题</h2>
<p>虽然系统自动切换已满足大部分需求，但提供手动切换按钮能提升灵活性，核心思路是通过 JS 覆盖 CSS 变量，步骤如下：</p>
<ol>
<li>添加切换按钮：</li>
</ol>

<pre><code class="hljs language-css" lang="css">theme-toggle"&gt;切换深色模式&lt;/<span class="hljs-selector-tag">button</span>&gt;
</code></pre>
<p>2.  编写 JS 逻辑：</p>

<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">themeToggle</span> = document.getElementById(<span class="hljs-string">'theme-toggle'</span>)<span class="hljs-comment">;</span>
const <span class="hljs-attr">html</span> = document.documentElement<span class="hljs-comment">;</span>
// 初始化：根据系统主题设置按钮文本
const <span class="hljs-attr">isDark</span> = window.matchMedia(<span class="hljs-string">'(prefers-color-scheme: dark)'</span>).matches<span class="hljs-comment">;</span>
<span class="hljs-attr">themeToggle.textContent</span> = isDark ? <span class="hljs-string">'切换浅色模式'</span> : <span class="hljs-string">'切换深色模式'</span><span class="hljs-comment">;</span>
// 切换主题
themeToggle.addEventListener('click', () =&gt; {
  const <span class="hljs-attr">isCurrentlyDark</span> = html.classList.contains(<span class="hljs-string">'dark'</span>)<span class="hljs-comment">;</span>
  if (isCurrentlyDark) {
    html.classList.remove('dark')<span class="hljs-comment">;</span>
    <span class="hljs-attr">themeToggle.textContent</span> = <span class="hljs-string">'切换深色模式'</span><span class="hljs-comment">;</span>
  } else {
    html.classList.add('dark')<span class="hljs-comment">;</span>
    <span class="hljs-attr">themeToggle.textContent</span> = <span class="hljs-string">'切换浅色模式'</span><span class="hljs-comment">;</span>
  }
})<span class="hljs-comment">;</span>
</code></pre>
<p>3.  补充 CSS 样式：</p>

<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 手动切换深色模式时的样式覆盖 */</span>
<span class="hljs-selector-pseudo">:root</span><span class="hljs-selector-class">.dark</span> {
  <span class="hljs-attr">--bg-color</span>: <span class="hljs-number">#121212</span>;
  <span class="hljs-attr">--text-color</span>: <span class="hljs-number">#e5e7eb</span>;
}
<span class="hljs-comment">/* 优先级：手动切换 &gt; 系统主题 */</span>
<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">prefers-color-scheme</span>: dark) {
  <span class="hljs-selector-pseudo">:root</span><span class="hljs-selector-pseudo">:not</span>(<span class="hljs-selector-class">.dark</span>) { <span class="hljs-comment">/* 未手动切换时，遵循系统主题 */</span>
    <span class="hljs-attr">--bg-color</span>: <span class="hljs-number">#121212</span>;
    <span class="hljs-attr">--text-color</span>: <span class="hljs-number">#e5e7eb</span>;
  }
}
</code></pre>
<h2 data-id="heading-8">总结</h2>
<p>最后总结一下：系统主题自动切换的核心是通过 CSS 原生 <code>prefers-color-scheme</code> 媒体查询，结合 CSS 变量实现网页系统明暗主题自动切换。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[每周AI论文速递（251117-251121）]]></title>    <link>https://juejin.cn/post/7575119254314106906</link>    <guid>https://juejin.cn/post/7575119254314106906</guid>    <pubDate>2025-11-23T12:13:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575119254314106906" data-draft-id="7575438636330958899" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="每周AI论文速递（251117-251121）"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-11-23T12:13:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="叶子的技术碎碎念"/> <meta itemprop="url" content="https://juejin.cn/user/2831954919569245"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            每周AI论文速递（251117-251121）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2831954919569245/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    叶子的技术碎碎念
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T12:13:33.000Z" title="Sun Nov 23 2025 12:13:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读26分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Kandinsky 5.0: A Family of Foundation Models for Image and Video Generation</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.14993" target="_blank" title="https://arxiv.org/abs/2511.14993" ref="nofollow noopener noreferrer">Kandinsky 5.0：图像与视频生成基础模型系列</a></p>
<p>本报告介绍了 Kandinsky 5.0，这是一个面向高分辨率图像和 10 秒视频合成的尖端基础模型系列。该框架包含三大核心模型：Kandinsky 5.0 Image Lite（6B 参数的图像生成模型系列）、Kandinsky 5.0 Video Lite（轻量级 2B 参数文本到视频及图像到视频模型）以及 Kandinsky 5.0 Video Pro（19B 参数模型，具备卓越视频生成质量）。我们全面概述了多阶段训练流程中的数据管理生命周期（包括数据收集、处理、过滤与聚类），该流程涉及大规模预训练，并融合了自监督微调 (SFT) 和强化学习 (RL) 后训练等质量增强技术。同时，我们提出了新颖的架构、训练及推理优化方法，使 Kandinsky 5.0 能够实现高速生成，并在多种任务中达到领先性能（经人工评估验证）。作为公开可用的大规模生成框架，Kandinsky 5.0 充分发挥预训练及后续阶段的潜力，可广泛应用于各类生成场景。我们期望通过本报告及开源代码与训练检查点的发布，显著推动研究社区在高质量生成模型开发与普及方面的进展。</p>
<h2 data-id="heading-1">MiroThinker: Pushing the Performance Boundaries of Open-Source Research Agents via Model, Context, and Interactive Scaling</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.11793" target="_blank" title="https://arxiv.org/abs/2511.11793" ref="nofollow noopener noreferrer">MiroThinker：通过模型、上下文与交互缩放突破开源研究智能体的性能极限</a></p>
<p>我们推出 MiroThinker v1.0，这是一个旨在提升工具增强推理与信息检索能力的开源研究智能体。与先前仅扩展模型规模或上下文长度的智能体不同，MiroThinker 在模型层面探索交互缩放，系统性地训练模型处理更深层、更频繁的智能体-环境交互，将其作为性能提升的第三维度。相较于孤立运行且易因长推理链导致性能下降的 LLM 测试阶段缩放，交互缩放通过环境反馈与外部信息获取来修正错误并优化行动路径。通过强化学习，该模型实现了高效交互缩放：在 256K 上下文窗口下，单个任务可执行多达 600 次工具调用，支持持续的多轮次推理与复杂现实研究工作流。在 GAIA、HLE、BrowseComp 和 BrowseComp-ZH 四个代表性基准测试中，72B 参数版本分别达到 81.9%、37.7%、47.1% 和 55.6% 的准确率，超越此前开源智能体，并逼近 GPT-5-high 等商业竞品。我们的分析表明，MiroThinker 始终受益于交互缩放：随着模型参与智能体-环境交互的深度与频率增加，研究性能呈现可预测的提升，证明交互深度具有与模型规模和上下文长度相似的缩放特性。这些发现确立了交互缩放作为构建下一代开源研究智能体的第三关键维度，与模型能力和上下文窗口形成互补。</p>
<h2 data-id="heading-2">P1: Mastering Physics Olympiads with Reinforcement Learning</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.13612" target="_blank" title="https://arxiv.org/abs/2511.13612" ref="nofollow noopener noreferrer">P1: 基于强化学习的物理奥林匹克竞赛精通</a></p>
<p>大语言模型 (LLMs) 的最新进展已将研究前沿从谜题求解推进至科学推理——即处理那些答案必须与自然现象一致、而非仅符合评分标准的问题。物理学是这一转变的关键试金石，它以基本方式将符号与现实绑定，成为大多数现代技术的基石。在本工作中，我们通过开发具备卓越物理推理能力的大语言模型，成功推动了物理研究进展，尤其擅长解决奥林匹克级别的物理问题。我们推出了 P1 系列，这是一个完全基于强化学习 (RL) 训练的开源物理推理模型家族。其中，P1-235B-A22B 是首个在最新国际物理奥林匹克竞赛 (IPhO 2025) 中达到金牌水平的开源模型，并在 2024/2025 年度的 13 项国际/区域物理竞赛中斩获 12 枚金牌。P1-30B-A3B 同样在 IPhO 2025 上超越几乎所有其他开源模型，获得银牌。进一步结合 AI 智能体框架 PhysicsMinions，P1-235B-A22B+PhysicsMinions 在 IPhO 2025 中取得总排名第一，并在 13 项物理竞赛中获最高平均分。除物理领域外，P1 模型在数学、编程等其他推理任务上也表现优异，彰显了该系列的强大泛化能力。</p>
<h2 data-id="heading-3">Souper-Model: How Simple Arithmetic Unlocks State-of-the-Art LLM Performance</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.13254" target="_blank" title="https://arxiv.org/abs/2511.13254" ref="nofollow noopener noreferrer">Souper-Model: 简单算术如何实现最先进的大语言模型性能</a></p>
<p>大语言模型 (LLMs) 已在众多领域展现出卓越能力，但其训练过程仍需要大量资源和时间，涉及巨大的计算开销以及对训练流程的精细管理。模型汤化 (Model souping) ——即平均相同架构的多个模型权重的实践——已成为一种有前景的训练前和训练后技术，能够在不进行昂贵重新训练的情况下提升模型性能。本文提出类别专家汤 (SoCE)，一种系统性的模型汤化方法，该方法利用基准测试的构成来识别最优模型候选，并采用非均匀权重平均以最大化性能。与先前基于均匀平均的方法不同，我们的方法基于一个关键观察：基准测试的不同类别在模型性能上往往呈现低相关性。SoCE 为每个弱相关性类别集群识别“专家”模型，并通过优化的权重平均（而非均匀权重）进行组合。实验表明，该方法在多个领域（包括多语言能力、工具调用和数学推理）均提升了性能与鲁棒性，并在伯克利函数调用排行榜上取得了最先进的结果。</p>
<h2 data-id="heading-4">VIDEOP2R: Video Understanding from Perception to Reasoning</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.11113" target="_blank" title="https://arxiv.org/abs/2511.11113" ref="nofollow noopener noreferrer">VIDEOP2R：从感知到推理的视频理解</a></p>
<p>强化微调 (RFT) 是一种包含监督微调 (SFT) 和强化学习 (RL) 的两阶段框架，已在提升大语言模型 (LLMs) 推理能力方面展现出良好效果。然而，将其扩展至大型视频语言模型 (LVLMs) 仍面临挑战。本文提出 VideoP2R，一种过程感知的视频 RFT 框架，通过将感知与推理建模为独立过程来增强视频推理能力。在 SFT 阶段，我们构建了三步流程，生成高质量的过程感知思维链数据集 VideoP2R-CoT-162K，专门用于感知与推理任务。在 RL 阶段，我们引入了过程感知组相对策略优化 (PA-GRPO) 算法，该算法为感知和推理过程分别分配奖励。实验表明，VideoP2R 在七个视频推理与理解基准中的六个上达到了最先进水平。消融研究进一步验证了过程感知建模与 PA-GRPO 的有效性，并证明模型感知输出足以支撑下游推理任务。</p>
<h2 data-id="heading-5">Uni-MoE-2.0-Omni: Scaling Language-Centric Omnimodal Large Model with Advanced MoE, Training and Data</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.12609" target="_blank" title="https://arxiv.org/abs/2511.12609" ref="nofollow noopener noreferrer">Uni-MoE-2.0-Omni: 基于先进MoE、训练与数据的以语言为中心的全模态大模型规模化</a></p>
<p>我们推出荔枝 (Lychee) 系列中的 Uni-MoE 2.0。作为完全开源的全模态大模型 (Omnimodal Large Model, OLM) ，它在以语言为中心的多模态理解、推理和生成方面显著推进了荔枝 Uni-MoE 系列。基于 Qwen2.5-7B 的稠密架构 (dense architecture) ，我们通过三大核心创新从头构建了 Uni-MoE-2.0-Omni: 动态能力专家混合 (Mixture-of-Experts, MoE) 设计、采用迭代增强策略的渐进式训练方法，以及精心筛选的多模态数据匹配技术。该模型具备全模态理解能力，并能生成图像、文本和语音。在架构上，新型 MoE 框架通过共享专家、路由专家和空置专家平衡了 10 种跨模态输入的计算效率与能力，而全模态 3D RoPE (Rotary Position Embedding) 确保了自注意力层中的时空跨模态对齐。训练方面，在跨模态预训练后，我们采用渐进式监督微调策略激活模态特定专家，并通过平衡数据组合与迭代 GSPO-DPO 方法增强训练，以稳定强化学习 (Reinforcement Learning, RL) 过程并提升推理能力。数据层面，基础模型在约 750 亿 token 的开源多模态数据上训练，配备专用语音和图像生成 token，使其能够基于语言线索条件化输出来学习生成任务。在 85 个基准测试上的广泛评估表明，本模型在领先全模态大模型中达到最先进水平 (State-of-the-Art, SOTA) 或极具竞争力性能，在 76 个基准中的超 50 项上超越使用 1.2 万亿 token 训练的 Qwen2.5-Omni。核心优势包括视频理解 (8 项基准平均提升 7%) 、全模态理解 (4 项基准平均提升 7%) 和视听推理 (平均提升 4%) 。同时，它在长语音处理上取得进展 (词错误率, Word Error Rate, WER 降低 4.2%) ，并在底层图像处理与可控生成的 5 项指标中领先。</p>
<h2 data-id="heading-6">Think-at-Hard: Selective Latent Iterations to Improve Reasoning Language Models</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.08577" target="_blank" title="https://arxiv.org/abs/2511.08577" ref="nofollow noopener noreferrer">Think-at-Hard：通过选择性隐式迭代提升推理语言模型性能</a></p>
<p>提升大语言模型 (LLMs) 的推理能力，特别是在参数约束条件下，对实际应用至关重要。现有研究提出了循环 Transformer 架构，为每个 Token 分配固定次数的额外迭代以提升生成质量。在完成首次标准前向传播后，该方法并非直接输出文本，而是将最后一层隐藏状态反馈至输入层进行额外迭代，以优化 Token 预测结果。然而我们发现存在隐式过度推理现象：首次传播后已预测正确的简单 Token，有时会在后续迭代中被错误修正。为此，我们提出 Think-at-Hard (TaH) 方法，通过动态隐式迭代机制，仅对困难 Token 进行深度迭代。该方法采用轻量级神经决策模块，仅在标准前向传播后可能预测错误的 Token 处触发隐式迭代。在隐式迭代过程中，低秩适应 (LoRA) 模块将 LLM 的目标从通用下一 Token 预测转向专注于困难 Token 的优化。我们还引入了双重因果注意力机制，将注意力范围从 Token 序列维度扩展至迭代深度维度。该设计在保持完全序列并行性的同时，实现了跨迭代的信息流动。实验表明，TaH 在五个高难度基准测试中显著提升 LLM 推理性能，且保持参数量不变。与对所有输出 Token 进行两次迭代的基线方法相比，TaH 在免除 94% Token 二次迭代的同时，准确率提升达 8.1-11.3%。相较于使用相同数据微调的强基线 Qwen3 单次迭代模型，准确率提升达 4.0-5.0%。当仅引入 LoRA 和迭代决策模块带来的不足 3% 额外参数时，准确率增益分别进一步提升至 8.5-12.6% 和 5.3-5.4%。代码已开源：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fthu-nics%2FTaH%25E3%2580%2582" target="_blank" title="https://github.com/thu-nics/TaH%E3%80%82" ref="nofollow noopener noreferrer">github.com/thu-nics/Ta…</a></p>
<h2 data-id="heading-7">DoPE: Denoising Rotary Position Embedding</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.09146" target="_blank" title="https://arxiv.org/abs/2511.09146" ref="nofollow noopener noreferrer">DoPE：旋转位置嵌入去噪方法</a></p>
<p>Transformer 模型中的旋转位置嵌入 (RoPE) 存在固有局限性，会削弱长度外推性能。我们将含位置编码的注意力图重新诠释为带噪声的特征图，并提出去噪位置编码 (DoPE)，这是一种基于截断矩阵熵的无训练方法，用于识别特征图中的异常频带。利用特征图的噪声特性，我们进一步采用无参数高斯分布对其进行重参数化，以实现鲁棒的外推。本方法从理论上揭示了注意力下沉现象的成因及其与截断矩阵熵的关联。在“大海捞针”和多样本上下文学习任务上的实验表明，DoPE 在长上下文（最高 64K token）中显著提升了检索精度与推理稳定性。结果表明，位置嵌入的去噪策略有效抑制了注意力下沉现象，恢复了均衡的注意力分布，为改进长度泛化提供了一种简洁而高效的解决方案。项目页面详见：<a href="https://link.juejin.cn?target=https%3A%2F%2FThe-physical-picture-of-LLMs.github.io" target="_blank" title="https://The-physical-picture-of-LLMs.github.io" ref="nofollow noopener noreferrer">The-physical-picture-of-LLMs.github.io</a></p>
<h2 data-id="heading-8">Reasoning via Video: The First Evaluation of Video Models' Reasoning Abilities through Maze-Solving Tasks</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.15065" target="_blank" title="https://arxiv.org/abs/2511.15065" ref="nofollow noopener noreferrer">视频推理：通过迷宫求解任务首次评估视频模型的推理能力</a></p>
<p>视频模型在生成具有连贯运动动态的高保真视频方面取得了显著成功。类似于语言建模从文本生成发展到基于文本的推理，视频模型的进步促使我们思考：视频模型能否通过视频生成进行推理？与离散的文本语料相比，视频以明确的空间布局和时间连续性为基础，为空间推理提供了理想载体。在本工作中，我们探索了视频推理范式，并推出VR-Bench——一个系统评估视频模型推理能力的综合基准。该基准基于需要空间规划与多步推理的迷宫求解任务，包含7,920个过程生成视频，涵盖五种迷宫类型及多样视觉风格。实证分析表明，监督微调 (SFT) 能有效激发视频模型的推理能力。视频模型在推理过程中展现出更强的空间感知能力，其表现优于主流视觉语言模型 (VLM) ，且能适应不同场景、任务及复杂度级别。我们还发现了测试时扩展效应：推理阶段采用多样化采样可使推理可靠性提升10–20%。这些发现凸显了视频推理在空间推理任务中的独特潜力与可扩展性。</p>
<h2 data-id="heading-9">AraLingBench A Human-Annotated Benchmark for Evaluating Arabic Linguistic Capabilities of Large Language Models</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.14295" target="_blank" title="https://arxiv.org/abs/2511.14295" ref="nofollow noopener noreferrer">AraLingBench：评估大语言模型阿拉伯语语言能力的人工标注基准</a></p>
<p>我们提出 AraLingBench：一个完全人工标注的基准，用于评估大语言模型 (LLMs) 的阿拉伯语语言能力。该基准涵盖五个核心类别：语法、词法、拼写、阅读理解和句法，通过 150 道专家设计的多项选择题直接评估结构性语言理解。对 35 个阿拉伯语和双语大语言模型的评估表明，当前模型虽然表现出较强的表面熟练度，但在深层语法和句法推理方面仍存在困难。AraLingBench 揭示了基于知识的基准测试高分与真正语言掌握能力之间的持久差距，证明许多模型的成功依赖于记忆或模式识别而非真正的理解能力。通过分离和测量基础语言技能，AraLingBench 为开发阿拉伯语大语言模型提供了诊断框架。完整评估代码已在 GitHub 平台开源发布。</p>
<h2 data-id="heading-10">Part-X-MLLM: Part-aware 3D Multimodal Large Language Model</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.13647" target="_blank" title="https://arxiv.org/abs/2511.13647" ref="nofollow noopener noreferrer">Part-X-MLLM：部件感知的3D多模态大语言模型</a></p>
<p>我们提出了Part-X-MLLM，一种原生3D多模态大语言模型，通过将多样化的3D任务形式化为结构化、可执行语法中的程序，实现了统一处理。给定RGB点云和自然语言提示，模型以自回归方式生成单一、连贯的Token序列，其中包含部件级边界框、语义描述和编辑命令。这一结构化输出作为通用接口，可驱动下游几何感知模块执行部件级生成和编辑。通过将符号规划与几何生成解耦，本方法支持通过单一语言原生前端控制任何兼容的几何引擎。我们预训练了双编码器架构来分离结构与语义，并在大规模部件中心数据集上对模型进行指令调优。实验表明，该模型能高效生成高质量结构化规划，通过统一接口在接地问答、组合生成和局部编辑任务中实现了最先进的性能。项目页面：<a href="https://link.juejin.cn?target=https%3A%2F%2Fchunshi.wang%2FPart-X-MLLM%2F" target="_blank" title="https://chunshi.wang/Part-X-MLLM/" ref="nofollow noopener noreferrer">chunshi.wang/Part-X-MLLM…</a></p>
<h2 data-id="heading-11">Agent0: Unleashing Self-Evolving Agents from Zero Data via Tool-Integrated Reasoning</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.16043" target="_blank" title="https://arxiv.org/abs/2511.16043" ref="nofollow noopener noreferrer">Agent0：通过工具集成推理实现零数据下的自我进化智能体</a></p>
<p>基于大型语言模型 (LLM) 的智能体通常采用强化学习 (RL) 进行训练，但其发展受限于对人工标注数据的依赖，这不仅制约了可扩展性，还将人工智能的能力局限于人类知识范畴。现有自我进化框架虽提供了替代路径，却常受限于模型固有能力与单轮交互机制，难以发展包含工具使用或动态推理的复杂训练课程。本文提出 Agent0——一个完全自主的框架，通过多步协同进化与无缝工具集成，无需外部数据即可培育高性能智能体。Agent0 在源自同一基础 LLM 的两个智能体间建立共生竞争机制：课程智能体负责设计难度递增的前沿任务，执行智能体则学习解决这些任务。通过集成外部工具增强执行智能体的解题能力，这种能力提升反过来驱动课程智能体构建更具复杂性且具备工具感知的新任务。在此迭代过程中，Agent0 形成自我强化的闭环，持续生成高质量训练课程。实验结果表明，Agent0 显著提升了推理能力，使 Qwen3-8B-Base 模型在数学推理基准上的性能提升 18%，在通用推理基准上提升 24%。代码发布于 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Faiming-lab%2FAgent0%25E3%2580%2582" target="_blank" title="https://github.com/aiming-lab/Agent0%E3%80%82" ref="nofollow noopener noreferrer">github.com/aiming-lab/…</a></p>
<h2 data-id="heading-12">MMaDA-Parallel: Multimodal Large Diffusion Language Models for Thinking-Aware Editing and Generation</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.09611" target="_blank" title="https://arxiv.org/abs/2511.09611" ref="nofollow noopener noreferrer">MMaDA-并行：用于思维感知编辑与生成的多模态大扩散语言模型</a></p>
<p>尽管思维感知生成 (thinking-aware generation) 旨在提升复杂任务性能，但我们识别出一个关键失效模式：现有顺序自回归方法会因错误传播而反而导致性能下降。为系统性地分析该问题，我们提出了 ParaBench，这是一个新基准，用于评估文本和图像输出模态。基于 ParaBench 的分析表明，性能下降与生成推理和最终图像之间的对齐不佳高度相关。为解决此问题，我们提出并行多模态扩散框架 MMaDA-并行，该框架能在整个去噪轨迹中实现文本与图像间的连续双向交互。MMaDA-并行采用监督微调进行训练，并通过并行强化学习 (ParaRL) 进一步优化；ParaRL 是一种新策略，在轨迹上施加语义奖励以强化跨模态一致性。实验验证表明，我们的模型显著改善了跨模态对齐和语义一致性，在 ParaBench 上相比最先进模型 Bagel 实现了输出对齐 (Output Alignment) 6.9% 的提升，从而为思维感知图像合成建立了更鲁棒的范式。代码已开源：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftyfeld%2FMMaDA-Parallel%25E3%2580%2582" target="_blank" title="https://github.com/tyfeld/MMaDA-Parallel%E3%80%82" ref="nofollow noopener noreferrer">github.com/tyfeld/MMaD…</a></p>
<h2 data-id="heading-13">SAM 3D: 3Dfy Anything in Images</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.16624" target="_blank" title="https://arxiv.org/abs/2511.16624" ref="nofollow noopener noreferrer">SAM 3D：图像中任意物体的三维重建</a></p>
<p>我们提出SAM 3D——一个基于视觉的三维物体重建生成模型，能够从单张图像预测几何结构、纹理贴图和空间布局。该模型在自然图像中表现卓越，尤其适用于存在遮挡和场景杂乱的场景，其中上下文提供的视觉识别线索发挥着更重要的作用。我们通过人机协同标注流程实现这一目标，该流程可标注物体形状、纹理和位姿，以前所未有的规模提供基于视觉的三维重建数据。我们采用现代化的多阶段训练框架，结合合成预训练与真实世界对齐，突破了三维数据的"数据壁垒"。与近期工作相比，我们取得了显著提升，在真实物体和场景的人类偏好测试中胜率至少达5:1。我们将公开代码与模型权重、在线演示平台，以及一个全新的真实场景三维物体重建基准测试集。</p>
<h2 data-id="heading-14">A Style is Worth One Code: Unlocking Code-to-Style Image Generation with Discrete Style Space</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.10555" target="_blank" title="https://arxiv.org/abs/2511.10555" ref="nofollow noopener noreferrer">一种风格对应一个代码：利用离散风格空间实现代码到风格的图像生成</a></p>
<p>创新的视觉风格化是艺术创作的核心要素，但生成新颖且一致的视觉风格仍面临重大挑战。现有生成方法通常依赖冗长的文本提示、参考图像或参数高效微调来引导风格感知的图像生成，但往往难以保证风格一致性、创造力有限且风格表示复杂。本文通过引入代码到风格图像生成这一新任务，主张一种风格可由一个数值代码表征，该任务仅凭一个数值风格代码即可生成具有新颖、一致视觉风格的图像。目前，该领域主要由行业（如 Midjourney）主导探索，学术界尚无开源研究。为填补这一空白，我们提出了首个开源方法 CoTyle。具体而言，我们首先从图像集合中训练一个离散风格代码本，以提取风格嵌入。这些嵌入作为文本到图像扩散模型 (T2I-DM) 的条件，用于生成风格图像。随后，我们在离散风格嵌入上训练自回归风格生成器，建模其分布，从而能够合成新颖的风格嵌入。在推理阶段，数值风格代码通过风格生成器映射为唯一风格嵌入，该嵌入引导 T2I-DM 生成对应风格的图像。与现有方法相比，我们的方法具备无与伦比的简洁性和多样性，仅需极少输入即可解锁广阔的可复现风格空间。大量实验验证，CoTyle 能有效将数值代码转化为风格控制器，证实了一种风格确实对应一个代码。</p>
<h2 data-id="heading-15">GroupRank: A Groupwise Reranking Paradigm Driven by Reinforcement Learning</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.11653" target="_blank" title="https://arxiv.org/abs/2511.11653" ref="nofollow noopener noreferrer">GroupRank：一种由强化学习驱动的分组重排序范式</a></p>
<p>大语言模型 (LLM) 已展现出作为重排序器的强大潜力，能够提升 RAG (Retrieval-Augmented Generation) 系统的整体性能。然而，现有重排序范式面临一个核心理论与实践困境：逐点 (Pointwise) 方法虽然简单灵活，但独立评估文档，容易陷入排名近视陷阱，忽略文档间相对重要性；而列表 (Listwise) 方法能感知全局排名上下文，却存在固有的列表刚性缺陷，导致处理大规模候选集时出现严重的可扩展性与灵活性问题。为解决这些挑战，我们提出分组 (Groupwise) 方法，一种新颖的重排序范式。该方法将查询与一组候选文档共同输入模型，通过组内比较为每个文档分配个体相关性分数。这一设计既保留了逐点方法的灵活性，又实现了列表方法的比较能力。我们进一步采用 GRPO (Groupwise Reinforcement Learning with Policy Optimization) 进行模型训练，并配备异构奖励函数，该函数整合了排名指标与旨在对齐跨组分数分布的分布奖励。为克服高质量标注数据稀缺的瓶颈，我们提出一种创新流程，用于合成高质量检索与排名数据。生成的数据不仅可用于训练重排序器，还能用于训练检索器。大量实验验证了本方法的有效性。在两个推理密集型检索基准 BRIGHT 和 R2MED 上的测试结果表明了其优越性能。</p>
<h2 data-id="heading-16">V-ReasonBench: Toward Unified Reasoning Benchmark Suite for Video Generation Models</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.16668" target="_blank" title="https://arxiv.org/abs/2511.16668" ref="nofollow noopener noreferrer">V-ReasonBench：面向视频生成模型的统一推理基准套件</a></p>
<p>生成式视频模型（如Veo-3）的最新进展展现了惊人的零样本推理能力，这催生了对系统化、可靠评估方法日益增长的需求。我们推出V-ReasonBench，这是一个旨在从四个关键维度评估视频推理能力的基准：结构化问题解决、空间认知、基于模式的推理和物理动力学。该基准基于合成与真实世界图像序列构建，提供了一系列多样化、答案可验证的任务，这些任务具有可重现性、可扩展性且无歧义。对六个前沿视频模型的评估显示出明显的维度间差异，在结构化、空间、基于模式和物理推理方面存在显著性能波动。我们进一步将视频模型与强图像模型进行对比，分析常见的幻觉（hallucination）现象，并探究视频持续时间如何影响帧链（Chain-of-Frames）推理。总体而言，V-ReasonBench提供了一个统一、可重现的框架来衡量视频推理能力，旨在支持开发具备更可靠、符合人类认知的推理技能的模型。</p>
<h2 data-id="heading-17">What Does It Take to Be a Good AI Research Agent? Studying the Role of Ideation Diversity</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.15593" target="_blank" title="https://arxiv.org/abs/2511.15593" ref="nofollow noopener noreferrer">优秀 AI 研究智能体的关键要素？探讨构思多样性的作用</a></p>
<p>AI 研究智能体有望通过自动化机器学习模型的设计、实现与训练来加速科学进展。然而该领域尚处发展初期，决定智能体行为路径成败的关键因素仍未明晰。本文探究了构思多样性对智能体性能的影响机制。首先，我们在 MLE-bench（评估 AI 研究智能体的知名基准测试）上分析不同模型与智能体框架的行为轨迹，发现不同配置会产生不同程度的构思多样性，且性能更优的智能体通常表现出更高的构思多样性。进一步通过受控实验调整构思多样性水平，证实提升多样性可显著增强智能体性能。最后，我们超越 MLE-bench 基于奖牌评分的标准指标，通过多维度评估验证了研究结论在不同性能度量下的普适性。</p>
<h2 data-id="heading-18">First Frame Is the Place to Go for Video Content Customization</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.15700" target="_blank" title="https://arxiv.org/abs/2511.15700" ref="nofollow noopener noreferrer">第一帧：视频内容定制的关键入口</a></p>
<p>第一帧在视频生成模型中扮演着什么角色？传统观点认为，它仅是视频时空序列的起始点，作为后续动画生成的基础。在本研究中，我们提出了一个根本性的新视角：视频模型隐式地将第一帧作为概念记忆缓冲区，用于存储视觉实体并在生成过程中重复利用。基于这一发现，我们证明仅需20-50个训练样本，无需修改模型架构或进行大规模微调，即可在多种场景下实现鲁棒且具备强泛化能力的视频内容定制。这揭示了视频生成模型在基于参考视频的定制任务中一项强大而长期被忽视的潜力。</p>
<h2 data-id="heading-19">PhysX-Anything: Simulation-Ready Physical 3D Assets from Single Image</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.13648" target="_blank" title="https://arxiv.org/abs/2511.13648" ref="nofollow noopener noreferrer">PhysX-Anything：从单张图像生成可直接仿真的物理属性3D资产</a></p>
<p>3D建模正从静态视觉表示转向具备物理属性的可关节化资产，这类资产可直接用于仿真与交互。然而，现有大多数3D生成方法忽略了关键的物理属性与关节结构，限制了其在具身AI中的应用。为弥补这一不足，我们提出PhysX-Anything——首个可直接仿真的物理3D生成框架，仅需输入单张真实场景图像，即可生成具有显式几何结构、关节系统和物理属性的高质量可仿真3D资产。具体而言，我们开发了首个基于视觉语言模型 (VLM) 的物理3D生成模型，并提出新型3D表征方法，可高效对几何结构进行标记化处理。该方法将标记数量压缩至原数量的1/193，使得在标准VLM标记容量内即可实现显式几何学习，无需在微调阶段引入特殊标记，显著提升了生成质量。此外，针对现有物理3D数据集多样性不足的问题，我们构建了PhysX-Mobility数据集，将原有物理3D数据集的物体类别扩展2倍以上，包含2000余个常见真实物体并附有详尽的物理属性标注。在PhysX-Mobility与真实场景图像上的大量实验表明，PhysX-Anything具有卓越的生成性能与强泛化能力。在MuJoCo风格环境中开展的仿真实验进一步验证，本方法生成的资产可直接用于高接触频率的机器人策略学习。我们相信PhysX-Anything将有力推动下游应用发展，尤其在具身AI与物理仿真领域。</p>
<h2 data-id="heading-20">Step-Audio-R1 Technical Report</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.15848" target="_blank" title="https://arxiv.org/abs/2511.15848" ref="nofollow noopener noreferrer">Step-Audio-R1 技术报告</a></p>
<p>近期推理模型通过扩展的思维链推理过程，在文本和视觉领域取得了显著成功。然而，音频语言模型中始终存在一个令人困惑的现象：它们在极少或无需推理的情况下表现更优，这引发了一个根本性问题——音频智能是否真能从深思熟虑的推理中受益？我们推出 Step-Audio-R1，这是首个成功在音频领域实现推理能力的音频推理模型。通过我们提出的基于模态的推理蒸馏 (MGRD) 框架，Step-Audio-R1 能够生成与音频相关的推理链，这些推理链真正扎根于声学特征，而非产生脱节的虚假推理。我们的模型展现出强大的音频推理能力，在涵盖语音、环境声音和音乐的综合音频理解与推理基准测试中，超越了 Gemini 2.5 Pro，并与最先进的 Gemini 3 Pro 性能相当。这些结果表明，当得到适当锚定时，推理是一种可跨模态迁移的能力，从而将扩展推理从劣势转化为音频智能的强大优势。通过成功构建首个音频推理模型，Step-Audio-R1 为开发真正跨所有感官模态进行深度思考的多模态推理系统开辟了新路径。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[在Android中，kotlin 的一些开发技巧（二）]]></title>    <link>https://juejin.cn/post/7575456858426900526</link>    <guid>https://juejin.cn/post/7575456858426900526</guid>    <pubDate>2025-11-23T12:51:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575456858426900526" data-draft-id="7575159361904148521" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="在Android中，kotlin 的一些开发技巧（二）"/> <meta itemprop="keywords" content="Android,Kotlin"/> <meta itemprop="datePublished" content="2025-11-23T12:51:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小墙程序员"/> <meta itemprop="url" content="https://juejin.cn/user/1468603264407022"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            在Android中，kotlin 的一些开发技巧（二）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1468603264407022/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小墙程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T12:51:17.000Z" title="Sun Nov 23 2025 12:51:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"「"}.markdown-body b:after,.markdown-body strong:after{content:"」"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><p>之前在 <a href="https://juejin.cn/post/7385747507954843686" target="_blank" title="https://juejin.cn/post/7385747507954843686">Android中，kotlin 的一些开发技巧</a> 中介绍了七种 Kotlin 技巧，经过一年多 kotlin 的使用，这里再介绍新的开发技巧。</p>
<h2 data-id="heading-0">中缀表达式</h2>
<p>带有 <code>infix</code> 关键字的方法，可以使用中缀表示法调用。中缀表示法是<strong>指忽略该调用的点与圆括号</strong>。使用中缀表达式可以实现很多效果，如下所示：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 定义支持 可null 的 &gt; 操作</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">infix</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-built_in">Int</span>?.<span class="hljs-title">bigger</span><span class="hljs-params">(other: <span class="hljs-type">Int</span>?)</span></span>: <span class="hljs-built_in">Boolean</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> {
        <span class="hljs-keyword">this</span> != <span class="hljs-literal">null</span> &amp;&amp; other != <span class="hljs-literal">null</span> -&gt; <span class="hljs-keyword">this</span> - other &gt; <span class="hljs-number">0</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-literal">false</span>
    }
}
<span class="hljs-comment">// 如下所示，结果为 false</span>
<span class="hljs-keyword">val</span> result = <span class="hljs-number">5</span> bigger <span class="hljs-literal">null</span>
</code></pre>
<h2 data-id="heading-1">observable 委托</h2>
<p>单例对象 <code>kotlin.properties.Delegates</code> 有一个 <code>observable()</code> 便利函数来创建一个 <code>ReadWriteProperty</code> 委托，该委托将对与其关联的变量或属性的任何修改进行拦截。当发生修改时，委托将调用你用 <code>observable()</code> 函数注册的事件处理程序。如下所示：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 每次赋值时，自动cancel上一个旧job</span>
<span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> T : Job?&gt;</span> <span class="hljs-title">cannelJob</span><span class="hljs-params">()</span></span> = Delegates.observable&lt;T?&gt;(initialValue = <span class="hljs-literal">null</span>) { property, oldValue, newValue -&gt; 
    oldValue?.cancel() 
}
<span class="hljs-comment">// 示例如下：</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> myJob: Job? <span class="hljs-keyword">by</span> cannelJob()
<span class="hljs-comment">// 会自动调用 myJob?.cancel()</span>
myJob = scope.launch {
    ...
}
</code></pre>
<h2 data-id="heading-2">vetoable 委托</h2>
<p>与使用 <code>observable</code> 注册的处理程序不同，其返回类型为Unit，使用 <code>vetoable</code> 注册的处理程序返回布尔结果。返回值为true表示同意接受修改，false 表示拒绝。如果拒绝，修改将被丢弃。示例如下：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 定义一个Person类，使用vetoable委托限制年龄范围</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
        <span class="hljs-keyword">var</span> age: <span class="hljs-built_in">Int</span> <span class="hljs-keyword">by</span> Delegates.vetoable(initialValue = <span class="hljs-number">0</span>) { property, oldValue, newValue -&gt;
            <span class="hljs-comment">// 校验逻辑：年龄必须在0-150之间才允许修改</span>
            newValue <span class="hljs-keyword">in</span> <span class="hljs-number">0.</span><span class="hljs-number">.150</span>
        }
    }

    <span class="hljs-keyword">val</span> person = Person()

    <span class="hljs-comment">// 1. 合法修改：年龄设为20，符合范围</span>
    person.age = <span class="hljs-number">20</span>
    println(<span class="hljs-string">"修改后的年龄：<span class="hljs-subst">${person.age}</span>"</span>) <span class="hljs-comment">// 输出：修改后的年龄：20</span>

    <span class="hljs-comment">// 2. 非法修改：年龄设为200，超出范围，被否决</span>
    person.age = <span class="hljs-number">200</span>
    println(<span class="hljs-string">"修改后的年龄：<span class="hljs-subst">${person.age}</span>"</span>) <span class="hljs-comment">// 输出：修改后的年龄：20（保留旧值）</span>

    <span class="hljs-comment">// 3. 非法修改：年龄设为-5，同样被否决</span>
    person.age = -<span class="hljs-number">5</span>
    println(<span class="hljs-string">"修改后的年龄：<span class="hljs-subst">${person.age}</span>"</span>) <span class="hljs-comment">// 输出：修改后的年龄：20（保留旧值）</span>
}
</code></pre>
<h2 data-id="heading-3">NonCancellable</h2>
<p><code>withContext (NonCancellable)</code> 会让代码 “无视” 协程取消，应<strong>仅用于必须执行的收尾操作</strong>，代码示例如下：</p>
<pre><code class="hljs language-scss" lang="scss">val job = scope<span class="hljs-selector-class">.launch</span> {
        try {
            <span class="hljs-comment">// 模拟建立网络连接</span>
            socket = <span class="hljs-built_in">Socket</span>("localhost", <span class="hljs-number">8080</span>)
            <span class="hljs-built_in">println</span>("网络连接已建立，执行数据传输...")
            <span class="hljs-built_in">delay</span>(<span class="hljs-number">10000</span>) <span class="hljs-comment">// 模拟数据传输（可取消）</span>
        } finally {
            <span class="hljs-built_in">println</span>("进入 finally 块，准备关闭连接...")
            <span class="hljs-comment">// 必须用 NonCancellable，</span>
            <span class="hljs-comment">// 否则 socket.close() 若包含挂起逻辑会被取消</span>
            <span class="hljs-built_in">withContext</span>(NonCancellable) {
                socket?<span class="hljs-selector-class">.close</span>()
                <span class="hljs-built_in">println</span>("网络连接已关闭")
                <span class="hljs-comment">// 模拟挂起的收尾操作（如写入日志）</span>
                <span class="hljs-built_in">delay</span>(<span class="hljs-number">1000</span>)
                <span class="hljs-built_in">println</span>("收尾日志已写入")
            }
        }
    }

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Next.js第十章(Proxy)]]></title>    <link>https://juejin.cn/post/7575458028254822443</link>    <guid>https://juejin.cn/post/7575458028254822443</guid>    <pubDate>2025-11-23T13:00:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575458028254822443" data-draft-id="7575442779039334442" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Next.js第十章(Proxy)"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-23T13:00:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小满zs"/> <meta itemprop="url" content="https://juejin.cn/user/2463384809252397"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Next.js第十章(Proxy)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2463384809252397/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小满zs
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T13:00:39.000Z" title="Sun Nov 23 2025 13:00:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Proxy代理</h2>
<blockquote>
<p>从 Next.js 16 开始，中间件<code>Middleware</code>更名为代理<code>（Proxy）</code>，以更好地体现其用途。其功能保持不变</p>
</blockquote>
<p>如果你想升级为16.x版本，Next.js提供了命令行工具来帮助你升级，只需要执行以下命令即可：</p>
<pre><code class="hljs language-bash" lang="bash">npx @next/codemod@canary middleware-to-proxy .
</code></pre>
<p>代码转换会将文件和函数名从middleware重命名为proxy。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// middleware.ts -&gt; proxy.ts</span>
 
- <span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">middleware</span>(<span class="hljs-params"/>) {
+ <span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxy</span>(<span class="hljs-params"/>) {
</code></pre>
<h3 data-id="heading-1">基本使用</h3>
<p>应用场景：</p>
<ul>
<li>处理跨域请求</li>
<li>接口转发例如/api/user -&gt; (可能是其他服务器java/go/python等) -&gt; /api/user</li>
<li>限流例如配合第三方服务做限流</li>
<li>鉴权/判断是否登录</li>
</ul>
<p>Prxoy代理其实跟拦截器类似，它可以在请求完成之前进行拦截，然后进行一些处理，例如：修改请求头、修改请求体、修改响应体等。</p>
<p>src/proxy.ts</p>
<p>定义proxy函数导出即可，Next.js会自动调用这个函数。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NextRequest</span>, <span class="hljs-title class_">NextResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/server"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxy</span>(<span class="hljs-params">request: NextRequest</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(request.<span class="hljs-property">url</span>,<span class="hljs-string">'url'</span>);
}
</code></pre>
<p>但是你会发现，他会拦截项目中所有的请求，包括静态资源、API请求、页面请求等。</p>
<pre><code class="hljs language-txt" lang="txt">http://localhost:3000/.well-known/appspecific/com.chrome.devtools.json url
http://localhost:3000/_next/static/chunks/src_app_globals_91e4631d.css url
http://localhost:3000/_next/static/chunks/%5Bturbopack%5D_browser_dev_hmr-client_hmr-client_ts_cedd0592._.js url
http://localhost:3000/_next/static/chunks/node_modules_next_dist_compiled_react-dom_1e674e59._.js url
http://localhost:3000/_next/static/chunks/node_modules_next_dist_compiled_react-server-dom-turbopack_9212ccad._.js url
http://localhost:3000/_next/static/chunks/node_modules_next_dist_compiled_next-devtools_index_1dd7fb59.js url
http://localhost:3000/_next/static/chunks/node_modules_next_dist_compiled_a0e4c7b4._.js url
http://localhost:3000/_next/static/chunks/node_modules_next_dist_client_a38d7d69._.js url
http://localhost:3000/_next/static/chunks/node_modules_next_dist_4b2403f5._.js url
http://localhost:3000/_next/static/chunks/src_app_globals_91e4631d.css.map url
http://localhost:3000/_next/static/chunks/node_modules_%40swc_helpers_cjs_d80fb378._.js url
http://localhost:3000/_next/static/chunks/_a0ff3932._.js url
http://localhost:3000/api/login url
</code></pre>
<h4 data-id="heading-2">配置(config)</h4>
<p>例如我们只想匹配<code>'/api'</code>下面的路径去做一些事情，我们可以使用<code>config</code>配置来实现。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NextRequest</span>, <span class="hljs-title class_">NextResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/server"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxy</span>(<span class="hljs-params">request: NextRequest</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(request.<span class="hljs-property">url</span>,<span class="hljs-string">'url'</span>);
}
<span class="hljs-comment">//配置匹配路径</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> config = {
    <span class="hljs-attr">matcher</span>: <span class="hljs-string">'/api/:path*'</span>,
    <span class="hljs-comment">//matcher: ['/api/:path*','/api/user/:path*'], 支持单个以及多个路径匹配</span>
    <span class="hljs-comment">//matcher: ['/((?!api|_next/static|_next/image|.*\\.png$).*)'], 同样支持正则表达式匹配</span>
}
</code></pre>
<p>结合之前的案例,在cookie那一集，我们还需要单独定义check接口检查cookie，现在我们可以直接在proxy中实现。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NextRequest</span>, <span class="hljs-title class_">NextResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/server"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxy</span>(<span class="hljs-params">request: NextRequest</span>) {
    <span class="hljs-keyword">const</span> cookie = request.<span class="hljs-property">cookies</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'token'</span>);
    <span class="hljs-keyword">if</span> (request.<span class="hljs-property">nextUrl</span>.<span class="hljs-property">pathname</span>.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'/home'</span>) &amp;&amp; !cookie) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'redirect to login'</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">redirect</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">'/'</span>, request.<span class="hljs-property">url</span>));
    }
    <span class="hljs-keyword">if</span> (cookie &amp;&amp; cookie.<span class="hljs-property">value</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">next</span>();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">redirect</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">'/'</span>, request.<span class="hljs-property">url</span>));
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> config = {
    <span class="hljs-attr">matcher</span>: [<span class="hljs-string">'/api/:path*'</span>, <span class="hljs-string">'/home/:path*'</span>],
}
</code></pre>
<h4 data-id="heading-3">复杂匹配</h4>
<ul>
<li>source: 表示匹配路径</li>
<li>has: 表示匹配路径中必须(包含)某些条件</li>
<li>missing: 表示匹配路径中(必须不包含)某些条件</li>
</ul>
<p><strong>type</strong> 只能匹配: header, query, cookie</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NextRequest</span>, <span class="hljs-title class_">NextResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/server"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ProxyConfig</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/server"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxy</span>(<span class="hljs-params">request: NextRequest</span>) {
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'start proxy'</span>)
   <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">next</span>();
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">config</span>: <span class="hljs-title class_">ProxyConfig</span> = {
    <span class="hljs-attr">matcher</span>: [
        {
            <span class="hljs-attr">source</span>: <span class="hljs-string">'/home/:path*'</span>,
            <span class="hljs-comment">//表示匹配路径中必须(包含)Authorization头和userId查询参数</span>
            <span class="hljs-attr">has</span>: [
                { <span class="hljs-attr">type</span>: <span class="hljs-string">'header'</span>, <span class="hljs-attr">key</span>: <span class="hljs-string">'Authorization'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'Bearer 123456'</span> },
                { <span class="hljs-attr">type</span>: <span class="hljs-string">'query'</span>, <span class="hljs-attr">key</span>: <span class="hljs-string">'userId'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'123'</span> }
            ],
            <span class="hljs-comment">//表示匹配路径中(必须不包含)cookie和userId查询参数</span>
            <span class="hljs-attr">missing</span>: [
                { <span class="hljs-attr">type</span>: <span class="hljs-string">'cookie'</span>, <span class="hljs-attr">key</span>: <span class="hljs-string">'token'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'123456'</span> },
                { <span class="hljs-attr">type</span>: <span class="hljs-string">'query'</span>, <span class="hljs-attr">key</span>: <span class="hljs-string">'userId'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'456'</span> },
            ]
        },
    ]
}
</code></pre>
<p>访问url为：<code>http://localhost:3000/home?userId=123</code></p>
<h4 data-id="heading-4">案例实战(处理跨域)</h4>
<p>只要是/api下面的接口都可以被任意访问</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NextRequest</span>, <span class="hljs-title class_">NextResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/server"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ProxyConfig</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/server"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxy</span>(<span class="hljs-params">request: NextRequest</span>) {
    <span class="hljs-keyword">const</span> response = <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">next</span>();
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(corsHeaders).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">[key, value]</span>) =&gt;</span> {
        response.<span class="hljs-property">headers</span>.<span class="hljs-title function_">set</span>(key, value);
    })
    <span class="hljs-keyword">return</span> response;
}

<span class="hljs-keyword">const</span> corsHeaders = {
    <span class="hljs-string">'Access-Control-Allow-Origin'</span>: <span class="hljs-string">'*'</span>,
    <span class="hljs-string">'Access-Control-Allow-Methods'</span>: <span class="hljs-string">'GET, POST, PUT, DELETE, OPTIONS'</span>,
    <span class="hljs-string">'Access-Control-Allow-Headers'</span>: <span class="hljs-string">'Content-Type, Authorization'</span>,
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">config</span>: <span class="hljs-title class_">ProxyConfig</span> = {
   <span class="hljs-attr">matcher</span>:<span class="hljs-string">'/api/:path*'</span>,
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb6ec749269e4c428d9ed3e7d8cf9a8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764507639&amp;x-signature=sOLI4%2BJZEG05m3caC%2F6GzrkV9SA%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[不懂汇编的后端不是一个好的开发]]></title>    <link>https://juejin.cn/post/7575162322240274432</link>    <guid>https://juejin.cn/post/7575162322240274432</guid>    <pubDate>2025-11-23T11:10:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575162322240274432" data-draft-id="7575112613778161698" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="不懂汇编的后端不是一个好的开发"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-23T11:10:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            不懂汇编的后端不是一个好的开发
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T11:10:30.000Z" title="Sun Nov 23 2025 11:10:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在高级语言甚至AI生成代码横行的时代，为何还要关注最底层的汇编？</p>
</blockquote>
<p>作为一名后端开发者，我坚定地认为：<strong>不懂汇编的优化就是瞎子摸石头过河，不理解系统底层机制的开发者在面对复杂问题时，就像在迷雾中摸索前行的盲人</strong>。</p>
<p>这个观点或许听起来有些极端，但请允许我用接下来的内容说服你。</p>
<h2 data-id="heading-0">为什么我坚持汇编的重要性？</h2>
<p>在我多年的后端开发经历中，发现一个令人深思的现象：那些能够深入理解系统底层机制的开发者，在问题定位、性能优化和系统设计方面往往有着<strong>降维打击</strong>的优势。他们不仅知道问题是什么，更理解<strong>为什么会出现这样的问题</strong>。</p>
<p>汇编语言作为最接近机器底层的编程语言，为我们打开了一扇理解计算机本质的窗口。当你真正理解汇编，你就会发现：</p>
<ul>
<li><strong>高级语言的所有魔法都消失了</strong>，剩下的只有冰冷的机器指令</li>
<li><strong>每个抽象背后都有其代价</strong>，理解这些代价才能做出明智的权衡</li>
<li><strong>性能问题的根源往往藏在你看不到的底层</strong></li>
</ul>
<h2 data-id="heading-1">汇编：理解计算机系统的罗塞塔石碑</h2>
<h3 data-id="heading-2">从抽象到现实：揭开高级语言的面纱</h3>
<p>现代后端开发充斥着各种高级抽象：Java的虚拟机、Go的goroutine、Python的解释器。这些抽象提高了开发效率，但也隐藏了底层真相。</p>
<p><strong>不理解汇编的开发者</strong>看到的是：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 只是一行简单的加法</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> {
    <span class="hljs-keyword">return</span> a + b;
}
</code></pre>
<p><strong>懂汇编的开发者</strong>看到的是：</p>
<pre><code class="hljs language-assembly" lang="assembly">; 实际的CPU工作
mov    eax, edi     ; 将参数a放入eax寄存器
add    eax, esi     ; 将参数b加到eax
ret                 ; 返回结果
</code></pre>
<p>这种底层理解让你能够<strong>预测性能特征</strong>、<strong>诊断诡异bug</strong>、<strong>做出更优的设计决策</strong>。</p>
<h2 data-id="heading-3">实战案例：汇编知识如何解决实际问题</h2>
<h3 data-id="heading-4">案例1：那个让我们加班三天的性能问题</h3>
<p>曾经遇到一个Go服务，在高峰期CPU使用率异常飙升。常规 profiling 显示热点在一个简单的循环中：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ProcessBatch</span><span class="hljs-params">(items []Item)</span></span> {
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">len</span>(items); i++ {
        items[i].Value = items[i].Value * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>
    }
}
</code></pre>
<p>表面看起来毫无问题。但通过查看汇编输出，我们发现循环中插入了<strong>大量的边界检查指令</strong>，这些检查在密集循环中累积成为显著开销。解决方案很简单：使用更可预测的访问模式，让编译器能够优化掉这些检查。</p>
<p><strong>不懂汇编的团队</strong>可能会：尝试各种算法优化，甚至考虑重写服务。
<strong>懂汇编的团队</strong>：半小时定位问题，十分钟修复。</p>
<h3 data-id="heading-5">案例2：神秘的内存损坏</h3>
<p>一个Java服务偶尔在生产环境崩溃，日志只有模糊的segmentation fault信息。通过分析core dump的汇编代码，我们发现在某个JNI调用中，栈指针被错误地修改，导致函数返回时跳转到非法地址。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// 有问题的JNI代码</span>
JNIEXPORT <span class="hljs-type">void</span> JNICALL <span class="hljs-title function_">Java_MyClass_nativeMethod</span>
  <span class="hljs-params">(JNIEnv *env, jobject obj)</span> {
    <span class="hljs-type">char</span> buffer[<span class="hljs-number">64</span>];
    <span class="hljs-comment">// 栈溢出发生在这里</span>
    some_function(buffer); 
}
</code></pre>
<p>对应的汇编显示栈帧分配不足，导致内存越界。这种问题从Java层面几乎无法诊断。</p>
<h3 data-id="heading-6">案例3：理解并发成本</h3>
<p>当我们讨论Go的goroutine比线程更轻量时，你知道"轻量"具体体现在哪里吗？</p>
<p>汇编层面告诉我们答案：</p>
<ul>
<li><strong>goroutine切换</strong>：主要在用户态完成，不涉及内核调度</li>
<li><strong>线程切换</strong>：需要陷入内核，完整的上下文保存和恢复</li>
</ul>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 这个goroutine的创建和调度成本</span>
<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 工作代码</span>
}()
</code></pre>
<p>在汇编层面，你会看到编译器如何生成代码来管理goroutine的栈和调度，这种理解让你能够做出更明智的并发设计决策。</p>
<h2 data-id="heading-7">汇编思维：即使不写汇编代码也能受益</h2>
<p>学习汇编最重要的不是学会<strong>编写</strong>汇编程序，而是培养<strong>汇编思维</strong>——理解代码在机器层面的执行方式。</p>
<h3 data-id="heading-8">1. 内存访问模式优化</h3>
<p>理解CPU缓存行、预取机制后，你会自然地优化数据结构：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 优化前：随机访问，缓存不友好</span>
<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    ID      <span class="hljs-type">int</span>
    Name    <span class="hljs-type">string</span>
    Email   <span class="hljs-type">string</span>
    Status  <span class="hljs-type">bool</span> <span class="hljs-comment">// 经常访问的字段</span>
}

<span class="hljs-comment">// 优化后：热点数据集中，缓存友好</span>
<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    Status  <span class="hljs-type">bool</span> <span class="hljs-comment">// 经常访问的字段放在前面</span>
    ID      <span class="hljs-type">int</span>
    Name    <span class="hljs-type">string</span>
    Email   <span class="hljs-type">string</span>
}
</code></pre>
<h3 data-id="heading-9">2. 函数调用开销意识</h3>
<p>理解调用栈和寄存器使用后，你会：</p>
<ul>
<li>避免过度分层和小函数滥用</li>
<li>理解内联优化的价值和限制</li>
<li>合理使用函数指针和接口</li>
</ul>
<h3 data-id="heading-10">3. 系统调用成本认知</h3>
<p>通过理解用户态到内核态的切换成本，你会：</p>
<ul>
<li>批量处理系统调用</li>
<li>合理使用缓冲和缓存</li>
<li>选择适当的I/O模型</li>
</ul>
<h2 data-id="heading-11">现代后端开发中汇编的实际应用场景</h2>
<h3 data-id="heading-12">微服务架构下的价值</h3>
<p>在分布式系统中，汇编知识帮助你：</p>
<ul>
<li><strong>精准定位网络超时问题</strong>：区分是网络延迟还是处理延迟</li>
<li><strong>优化序列化/反序列化</strong>：理解内存拷贝和编码解码的成本</li>
<li><strong>诊断容器环境性能问题</strong>：理解cgroups和namespaces的底层影响</li>
</ul>
<h3 data-id="heading-13">云原生时代的汇编价值</h3>
<p>在Kubernetes和云环境中：</p>
<ul>
<li><strong>资源限制的真实影响</strong>：理解CPU限配额在调度器层面的实现</li>
<li><strong>网络性能分析</strong>：从系统调用看到网络包处理</li>
<li><strong>存储I/O优化</strong>：理解page cache和直接I/O的选择</li>
</ul>
<h2 data-id="heading-14">如何开始你的汇编学习之旅</h2>
<h3 data-id="heading-15">第一步：建立基础认知</h3>
<ol>
<li><strong>学习基本概念</strong>：寄存器、内存地址、指令周期</li>
<li><strong>理解CPU工作模式</strong>：保护模式、虚拟内存、中断处理</li>
<li><strong>掌握常用指令</strong>：mov、add、call、jmp等核心指令</li>
</ol>
<h3 data-id="heading-16">第二步：实践结合理论</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看你代码的汇编输出</span>
go tool compile -S main.go
gcc -S -O2 example.c
javap -c MyClass.class
</code></pre>
<h3 data-id="heading-17">第三步：融入日常工作</h3>
<ul>
<li>在性能分析时多问一句"为什么"</li>
<li>遇到诡异bug时考虑底层可能性</li>
<li>设计系统时思考底层代价</li>
</ul>
<h2 data-id="heading-18">最后</h2>
<p>在AI能够生成代码的今天，我们可能会问：还有必要学习这种底层知识吗？</p>
<p>我的回答是：<strong>正因为AI擅长生成高级代码，理解底层的开发者才更加珍贵</strong>。</p>
<p>AI可以帮你写业务逻辑，但很难帮你：</p>
<ul>
<li>诊断一个只有在生产环境出现的性能问题</li>
<li>优化一个已经高度优化的关键路径</li>
<li>设计一个既优雅又高效的系统架构</li>
</ul>
<p><strong>汇编知识是你的超能力</strong>，它让你：</p>
<ul>
<li>在别人看到魔法的地方看到机制</li>
<li>在别人满足于表象的地方探究本质</li>
<li>在别人束手无策的地方找到出路</li>
</ul>
<p>后端开发的真正高手，既能在架构层面驾驭分布式系统的复杂性，又能在底层理解每个指令、每个字节的代价。这种全栈的深度理解，让你在技术领域中立于不败之地。</p>
<p>所以，不要再把汇编看作古老的遗迹，而应把它当作<strong>打开计算机系统真相的钥匙</strong>。掌握这把钥匙，你将在技术的道路上走得更远、更稳、更自信。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[在远程服务器上部署 DevStack 后如何访问 Horizon Dashboard？]]></title>    <link>https://juejin.cn/post/7575182522411450406</link>    <guid>https://juejin.cn/post/7575182522411450406</guid>    <pubDate>2025-11-23T11:11:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575182522411450406" data-draft-id="7575367791272886310" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="在远程服务器上部署 DevStack 后如何访问 Horizon Dashboard？"/> <meta itemprop="keywords" content="OpenStack"/> <meta itemprop="datePublished" content="2025-11-23T11:11:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            在远程服务器上部署 DevStack 后如何访问 Horizon Dashboard？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T11:11:31.000Z" title="Sun Nov 23 2025 11:11:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>环境</strong>：Ubuntu 22.04 + KVM/libvirt + DevStack (2024.2)<br/>
<strong>适用场景</strong>：通过 SSH 远程登录到一台物理机，在其上用 KVM 启动了 Ubuntu 虚拟机，并成功安装了 OpenStack DevStack，但无法从本地浏览器访问 Web 控制台。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">🧩 场景描述</h2>
<p>我的网络拓扑如下：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-attr">[本地电脑]</span>
        │
        └── <span class="hljs-selector-tag">SSH</span> → <span class="hljs-selector-attr">[跳板机/物理主机: 192.168.18.133]</span>
                      │
                      └── <span class="hljs-selector-tag">KVM</span> 虚拟机 (libvirt NAT 网络)
                              │
                              └── <span class="hljs-selector-tag">IP</span>: <span class="hljs-number">192.168</span><span class="hljs-selector-class">.122</span><span class="hljs-selector-class">.30</span>
                                      └── <span class="hljs-selector-tag">DevStack</span> 已成功安装
                                          <span class="hljs-selector-tag">Horizon</span> 地址: <span class="hljs-selector-tag">http</span>:<span class="hljs-comment">//192.168.122.30/dashboard</span>
</code></pre>
<p>问题来了：<strong>在本地电脑的浏览器中输入 <code>http://192.168.122.30/dashboard</code>，页面无法打开</strong>。</p>
<p>原因很简单：<code>192.168.122.30</code> 是 libvirt 创建的 <strong>NAT 虚拟网络</strong>，只有宿主机（192.168.18.133）能访问它，而本地电脑根本“看不见”这个 IP。</p>
<hr/>
<h2 data-id="heading-1">🔍 核心思路：SSH 端口转发（隧道）</h2>
<p>我们要做的，是建立一条安全隧道：</p>
<blockquote>
<p><strong>本地电脑 → 跳板机（192.168.18.133）→ 虚拟机（192.168.122.30:80）</strong></p>
</blockquote>
<p>最终效果：在本地访问 <code>http://localhost:8080/dashboard</code>，流量自动穿透两层网络到达 DevStack 的 Horizon。</p>
<hr/>
<h2 data-id="heading-2">✅ 推荐方案：使用 SSH ProxyJump（OpenSSH 7.3+）</h2>
<p>现代 OpenSSH 支持 <code>-J</code> 参数（即 <code>ProxyJump</code>），可一键完成跳转和端口转发。</p>
<h3 data-id="heading-3">步骤 1：在本地电脑执行</h3>
<pre><code class="hljs language-ruby" lang="ruby">ssh -L <span class="hljs-number">8080</span><span class="hljs-symbol">:localhost</span><span class="hljs-symbol">:</span><span class="hljs-number">80</span> -J hanwang<span class="hljs-variable">@192</span>.<span class="hljs-number">168.18</span>.<span class="hljs-number">133</span> stack<span class="hljs-variable">@192</span>.<span class="hljs-number">168.122</span>.<span class="hljs-number">30</span>
</code></pre>
<p>参数说明：</p>
<ul>
<li><code>-L 8080:localhost:80</code>：将本地 8080 端口映射到目标主机的 80 端口</li>
<li><code>-J hanwang@192.168.18.133</code>：先通过跳板机连接</li>
<li><code>stack@192.168.122.30</code>：最终目标虚拟机</li>
</ul>
<blockquote>
<p>💡 提示：确保你已将公钥部署到跳板机和 VM，避免重复输密码。</p>
</blockquote>
<h3 data-id="heading-4">步骤 2：保持 SSH 会话运行</h3>
<p>不要关闭终端！只要这个 SSH 连接存在，隧道就有效。</p>
<h3 data-id="heading-5">步骤 3：在本地浏览器访问</h3>
<p>打开：</p>
<pre><code class="hljs language-bash" lang="bash">http://localhost:8080/dashboard
</code></pre>
<p>使用默认账号登录：</p>
<ul>
<li>用户名：<code>admin</code> 或 <code>demo</code></li>
<li>密码：<code>secret</code></li>
</ul>
<p>✅ 成功进入 OpenStack Horizon！</p>
<hr/>
<h2 data-id="heading-6">🛠️ 备选方案：分步手动转发（兼容旧版 SSH）</h2>
<p>如果你的本地 SSH 版本较老（&lt;7.3），不支持 <code>-J</code>，可以用两步法：</p>
<h3 data-id="heading-7">在本地电脑执行：</h3>
<pre><code class="hljs language-kotlin" lang="kotlin">ssh -L <span class="hljs-number">8080</span>:<span class="hljs-number">192.168</span><span class="hljs-number">.122</span><span class="hljs-number">.30</span>:<span class="hljs-number">80</span> <span class="hljs-symbol">hanwang@</span><span class="hljs-number">192.168</span><span class="hljs-number">.18</span><span class="hljs-number">.133</span>
</code></pre>
<p>这条命令的意思是：</p>
<blockquote>
<p>“在我本地开一个 8080 端口，所有流量通过 192.168.18.133 转发到 192.168.122.30:80”</p>
</blockquote>
<p>然后同样访问 <code>http://localhost:8080/dashboard</code> 即可。</p>
<hr/>
<h2 data-id="heading-8">📝 长期使用建议：配置 SSH config</h2>
<p>在你本地电脑的 <code>~/.ssh/config</code> 中添加：</p>
<pre><code class="hljs language-css" lang="css">Host devstack-vm
  HostName <span class="hljs-number">192.168</span>.<span class="hljs-number">122.30</span>
  User stack
  ProxyJump hanwang<span class="hljs-keyword">@192</span>.168.18.133
  LocalForward <span class="hljs-number">8080</span> <span class="hljs-attribute">localhost</span>:<span class="hljs-number">80</span>
</code></pre>
<p>之后只需运行：</p>
<pre><code class="hljs">ssh devstack-vm
</code></pre>
<p>即可自动建立隧道，简洁高效！</p>
<hr/>
<h2 data-id="heading-9">❓ 常见问题排查</h2>
<h3 data-id="heading-10">Q1：访问 localhost:8080 显示空白或连接拒绝？</h3>
<ul>
<li>检查 SSH 隧道是否仍在运行</li>
<li>在 VM 中确认服务正常：<code>curl -I http://localhost/dashboard</code></li>
<li>确保 DevStack 安装成功（无报错退出）</li>
</ul>
<h3 data-id="heading-11">Q2：能否让其他人也访问？</h3>
<p>可以，但需谨慎。使用：</p>
<pre><code class="hljs language-ini" lang="ini">ssh -o <span class="hljs-attr">GatewayPorts</span>=<span class="hljs-literal">yes</span> -L <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">8080</span>:localhost:<span class="hljs-number">80</span> -J ... 
</code></pre>
<p>然后别人可通过 <code>http://192.168.18.133:8080/dashboard</code> 访问。<br/>
⚠️ 注意：这会暴露 OpenStack 到局域网，请确保网络安全！</p>
<h3 data-id="heading-12">Q3：为什么不用直接桥接网络？</h3>
<p>桥接确实能让 VM 获得局域网 IP，但配置复杂，且可能影响生产网络。对于开发测试，SSH 隧道更安全、轻量、无需改网络。</p>
<hr/>
<h2 data-id="heading-13">🎉 总结</h2>





















<table><thead><tr><th>问题</th><th>解决方案</th></tr></thead><tbody><tr><td>无法访问 NAT 网络中的 DevStack Dashboard</td><td>使用 SSH 端口转发</td></tr><tr><td>需要经过跳板机</td><td>使用 <code>-J</code> 或 <code>ProxyJump</code></td></tr><tr><td>想长期使用</td><td>配置 <code>~/.ssh/config</code></td></tr></tbody></table>
<p>通过一条简单的 SSH 命令，我们轻松打通了三层网络，安全地访问到了 OpenStack 控制台。这也是云原生时代开发者必备的网络调试技能之一。</p>
<hr/>
<blockquote>
<p><strong>附：DevStack 默认凭证</strong></p>
<ul>
<li>URL: <code>http://localhost:8080/dashboard</code></li>
<li>Admin 用户: <code>admin / secret</code></li>
<li>Demo 用户: <code>demo / secret</code></li>
</ul>
</blockquote>
<p>Happy Hacking with OpenStack! ☁️</p>
<hr/>
<p><strong>标签</strong>：#OpenStack #DevStack #KVM #SSH隧道 #Horizon #云计算 #Linux运维</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI时代，汇编语言还有必要学吗？我的惨痛教训与思考]]></title>    <link>https://juejin.cn/post/7575162322240290816</link>    <guid>https://juejin.cn/post/7575162322240290816</guid>    <pubDate>2025-11-23T11:12:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575162322240290816" data-draft-id="7575112613778178082" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI时代，汇编语言还有必要学吗？我的惨痛教训与思考"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-23T11:12:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI时代，汇编语言还有必要学吗？我的惨痛教训与思考
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T11:12:03.000Z" title="Sun Nov 23 2025 11:12:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>当AI可以自动生成代码、优化性能甚至调试程序时，我们是否还需要了解那些晦涩难懂的汇编指令？让我用亲身经历告诉你答案。</p>
</blockquote>
<p>上周，我负责的核心服务突然出现诡异崩溃——在每秒处理数十万请求的高并发场景下，服务会随机崩溃，而且没有任何明确的错误日志。团队花了三天时间毫无头绪，直到我迫不得已打开了GDB，在汇编层面追踪那个该死的bug。</p>
<p>最终发现，问题出在一个第三方库在特定CPU架构下的内存对齐问题。这个经历让我重新思考：在AI可以编写代码的今天，为什么我们仍然需要理解计算机最底层的语言？</p>
<h2 data-id="heading-0">一次让我"刻骨铭心"的调试经历</h2>
<p>那是我职业生涯早期参与的一个金融交易系统项目。系统在测试环境完美运行，但在客户的生产环境中，每隔几天就会神秘崩溃。我们检查了所有可能的地方：内存泄漏、线程安全、网络超时……一无所获。</p>
<p>在连续加班两周后，我的导师建议："我们看看汇编吧。"</p>
<p>当时我心里嘀咕："这都什么年代了，还要看汇编？"</p>
<p>但当我们通过GDB反汇编核心转储文件时，真相大白：一个内联函数在特定编译器优化级别下，产生了错误的寄存器使用，导致偶尔会覆盖返回地址。</p>
<p>那一刻我恍然大悟——没有汇编知识，我们就像在黑暗中摸索。而AI助手，尽管能写出优雅的业务逻辑代码，却无法替代这种底层的调试能力。</p>
<h2 data-id="heading-1">为什么在AI时代，汇编反而更珍贵？</h2>
<p><strong>理解AI无法教给你的直觉</strong></p>
<p>AI可以生成高效的代码，甚至可以解释代码的功能。但它无法给你那种对计算机工作原理的"直觉理解"。当你通过汇编理解了函数调用栈、内存管理和指令流水线，你会获得一种难以言传的洞察力。</p>
<p>就像学习音乐理论——AI可以生成悦耳的旋律，但理解乐理的音乐家才知道为什么这些音符如此组合，以及如何创造新的可能性。</p>
<p><strong>性能优化的"最后武器"</strong></p>
<p>现代编译器确实强大，但在极端性能要求的场景下（高频交易、游戏引擎、数据库内核），汇编知识仍然是终极武器。</p>
<p>我曾在优化一个图像处理算法时，发现编译器生成的SSE指令并非最优。手动调整汇编后，性能提升了3倍——这在实时处理场景中是决定性的优势。</p>
<p><strong>安全领域的必备技能</strong></p>
<p>在网络安全领域，理解汇编是分析漏洞、逆向工程的基础。无论AI多么强大，理解恶意代码如何在底层执行的能力，在可预见的未来都无法被替代。</p>
<h2 data-id="heading-2">我的汇编学习建议</h2>
<p>如果你决定学习汇编，我推荐这样的路径：</p>
<ol>
<li>
<p><strong>从简单的开始</strong>：不要一上来就尝试x86-64，从经典的ARM或RISC-V架构开始会更友好</p>
</li>
<li>
<p><strong>理论与实践结合</strong>：使用在线模拟器实际编写和运行代码，观察每条指令的效果</p>
</li>
<li>
<p><strong>与高级语言对照</strong>：写一段简单的C代码，查看生成的汇编，理解两者的对应关系</p>
</li>
<li>
<p><strong>关注核心概念</strong>：除非你要做专门的底层开发，否则重点是理解原理而非记忆指令</p>
</li>
</ol>
<h2 data-id="heading-3">重新思考问题的答案</h2>
<p>回到我们的核心问题：AI时代还有必要学汇编吗？</p>
<p>我的答案是：<strong>学习汇编的目的已经改变，但其价值反而提升了。</strong></p>
<p>我们不再是为了成为汇编程序员而学习它，而是为了：</p>
<ul>
<li>在AI生成的代码出现诡异问题时，有能力深入底层排查</li>
<li>在性能优化遇到瓶颈时，能够进行最终的调优</li>
<li>更好地理解AI加速器（GPU/TPU）的工作原理</li>
<li>在系统设计时做出更符合硬件特性的决策</li>
</ul>
<p>在这个AI看似能解决一切问题的时代，真正区分优秀工程师的，往往是对计算本质的深刻理解。汇编语言正是通往这种理解的重要桥梁。</p>
<p>毕竟，即使有了最先进的自动驾驶技术，理解基本的机械原理仍然能让司机在关键时刻化险为夷。汇编语言，就是程序员的"机械原理"。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[再来聊聊，Vue3 项目中 Pinia 的替代方案]]></title>    <link>https://juejin.cn/post/7575458028254674987</link>    <guid>https://juejin.cn/post/7575458028254674987</guid>    <pubDate>2025-11-23T11:23:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575458028254674987" data-draft-id="7575655132755394579" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="再来聊聊，Vue3 项目中 Pinia 的替代方案"/> <meta itemprop="keywords" content="前端,面试"/> <meta itemprop="datePublished" content="2025-11-23T11:23:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端布鲁伊"/> <meta itemprop="url" content="https://juejin.cn/user/4431511346492554"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            再来聊聊，Vue3 项目中 Pinia 的替代方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4431511346492554/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端布鲁伊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T11:23:24.000Z" title="Sun Nov 23 2025 11:23:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"「"}.markdown-body b:after,.markdown-body strong:after{content:"」"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><p><strong>想获取更多2025年最新前端场景题可以看这里</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Ffe.ecool.fun%2Ftopic-list%3Fic%3DKIQC2F%26from%3Djuejin_article" target="_blank" title="https://fe.ecool.fun/topic-list?ic=KIQC2F&amp;from=juejin_article" ref="nofollow noopener noreferrer">fe.ecool.fun</a></p>
<p>大家好，我是刘布斯。</p>
<p>之前转载了一篇文章<strong>Vue 项目不要再用 Pinia 了</strong>，先不可否认，这文章有点标题党的意思。但这篇文章的主要观点是说，在中小项目里，用 Vue 3 自带的组合式 API（<code>reactive</code> / <code>ref</code>）来管状态，很多时候比硬上 Pinia 要香。</p>
<p>好家伙，评论区一下就热闹了，总结起来是：“Pinia 多好用，你肯定是没用明白 Pinia”</p>
<p>说实话，我确实有点意外。</p>
<p><strong>我先摆明态度：Pinia 是个非常优秀的状态管理库。</strong> 尤雨溪团队亲自操刀，API 设计简洁，TS 支持完美，插件系统灵活，Devtools 体验丝滑。这一点，没人能否认。</p>
<p>但我的核心观点是：<strong>优秀，不代表“所有场景都必须上”。</strong></p>
<p>我发现现在很多团队，尤其是从 Vue 2 刚迁到 Vue 3 不久的，存在一种很强的 <strong>“状态管理惯性”</strong> 。</p>
<p>什么意思？</p>
<p>在 Vue 2 + Options API 的时代，组件（Component）和状态（State）是“隔离”的。<code>data</code> 里的状态天生就是“内向”的，组件一销毁，状态就没了。跨组件通信、全局状态共享，你怎么办？你没得选，你必须上 Vuex。Vuex 就像一个“中央空调”，你不用它，别的房间（组件）就享受不到冷气（状态）。</p>
<p>所以，Vue 2 时代养成了我们的思维定式：<strong>做项目 = Vue 全家桶 = Vue + Vue Router + Vuex。</strong></p>
<p>到了 Vue 3，Vuex 退位，Pinia 继任。于是大家理所当然地把公式换成了：<strong>做项目 = Vue 3 + Vue Router + Pinia。</strong></p>
<p>启动一个新项目，<code>npm create vue@latest</code>，一路 <code>yes</code> 下来，Pinia 就装好了。然后就开始 <code>defineStore</code>。</p>
<p>但大家好像都忽略了 Vue 3 最大的革命性变化——<strong>组合式 API (Composition API)</strong> 本身，就已经是一种强大的状态管理模式了。</p>
<h4 data-id="heading-0"><code>defineStore</code> 帮我们做了什么？</h4>
<p>还是用那篇文章中的例子，做一个最简单的“用户状态管理”，两种方式有什么区别。</p>
<p><strong>1. Pinia 的方式：</strong> 你得先在 <code>stores/user.ts</code> 里：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span><span class="hljs-string">'pinia'</span>
<span class="hljs-keyword">import</span> { ref, computed } <span class="hljs-keyword">from</span><span class="hljs-string">'vue'</span>

exportconst useUserStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'user'</span>, <span class="hljs-function">() =&gt;</span> {
<span class="hljs-comment">// State</span>
<span class="hljs-keyword">const</span> token = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)
<span class="hljs-keyword">const</span> userProfile = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)

<span class="hljs-comment">// Getters</span>
<span class="hljs-keyword">const</span> isLoggedIn = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> !!token.<span class="hljs-property">value</span>)

<span class="hljs-comment">// Actions</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">data</span>) {
    token.<span class="hljs-property">value</span> = data.<span class="hljs-property">token</span>
    userProfile.<span class="hljs-property">value</span> = data.<span class="hljs-property">profile</span>
    <span class="hljs-comment">// ... 存 localstorage</span>
  }

<span class="hljs-keyword">function</span> <span class="hljs-title function_">logout</span>(<span class="hljs-params"/>) {
    token.<span class="hljs-property">value</span> = <span class="hljs-literal">null</span>
    userProfile.<span class="hljs-property">value</span> = <span class="hljs-literal">null</span>
    <span class="hljs-comment">// ... 清 localstorage</span>
  }

<span class="hljs-keyword">return</span> { token, userProfile, isLoggedIn, login, logout }
})
</code></pre>
<p>然后在组件里 <code>useUserStore()</code>。</p>
<p><strong>2. 组合式 API 的方式：</strong> 你在 <code>stores/user.ts</code> (对，你也可以叫 <code>stores</code> 目录，这只是个文件夹)：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { ref, computed, reactive } <span class="hljs-keyword">from</span><span class="hljs-string">'vue'</span>

<span class="hljs-comment">// 以前我们用 reactive，这里用 ref/computed 模拟 Pinia 的结构</span>
<span class="hljs-keyword">const</span> token = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)
<span class="hljs-keyword">const</span> userProfile = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)

<span class="hljs-keyword">const</span> isLoggedIn = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> !!token.<span class="hljs-property">value</span>)

<span class="hljs-keyword">function</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">data</span>) {
  token.<span class="hljs-property">value</span> = data.<span class="hljs-property">token</span>
  userProfile.<span class="hljs-property">value</span> = data.<span class="hljs-property">profile</span>
<span class="hljs-comment">// ... 存 localstorage</span>
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">logout</span>(<span class="hljs-params"/>) {
  token.<span class="hljs-property">value</span> = <span class="hljs-literal">null</span>
  userProfile.<span class="hljs-property">value</span> = <span class="hljs-literal">null</span>
<span class="hljs-comment">// ... 清 localstorage</span>
}

<span class="hljs-comment">// 导出一个 hook</span>
<span class="hljs-keyword">export</span><span class="hljs-keyword">function</span> <span class="hljs-title function_">useUser</span>(<span class="hljs-params"/>) {
<span class="hljs-keyword">return</span> { token, userProfile, isLoggedIn, login, logout }
}
</code></pre>
<p>然后在组件里 <code>useUser()</code>。</p>
<hr/>
<p>好了，你对比下这两段代码。</p>
<p><strong>你发现了什么？</strong></p>
<p>在第二种方式里，我只是删掉了 <code>defineStore('user', ...)</code> 那层“壳”，然后把导出的 <code>useUserStore</code> 改成了 <code>useUser</code> (叫什么都行)。</p>
<p><strong>其他的逻辑，一模一样！</strong> 都是在用 <code>ref</code> 和 <code>computed</code>。</p>
<p>Pinia 的 <code>defineStore</code> 在这个场景里，本质上就是帮你做了一件事：<strong>创建了一个跨组件共享的、响应式的单例。</strong></p>
<p>但在 Vue 3 里，<code>import</code> 一个在模块顶层（module scope）定义的 <code>ref</code> 或 <code>reactive</code> 对象，它<strong>天生就是单例</strong>！它天生就是跨组件共享的！</p>
<p>那你可能会反问了：“那 Pinia 岂不是多此一举？”</p>
<p>不，它当然不是多此一举。它提供了 <code>defineStore</code> 这个“壳”，是为了给你带来额外的好处，最核心的就是：</p>
<ol>
<li><strong>Devtools 集成</strong>：这是 Pinia 最大的杀手锏。你可以在时间轴上看到 <code>action</code> 的调用、<code>state</code> 的变更。</li>
<li><strong>插件系统</strong>：比如实现数据持久化，Pinia 有现成的插件，<code>defineStore</code> 的时候配置一下就行。</li>
<li><strong>SSR 支持</strong>：在服务端渲染时，Pinia 能帮你处理好状态的序列化和“注水”(hydration)。</li>
<li><strong>更严格的“心智模型”</strong> ：它强制你区分 <code>state</code>、<code>getters</code>、<code>actions</code>，让团队协作更规范。</li>
</ol>
<h4 data-id="heading-1">Pinia的优势，你的项目真的需要吗？</h4>
<p>我们再回到上篇文章的核心观点：</p>
<p><strong>在一个中小型项目、独立开发、或者团队成员对组合式 API 都很熟练的场景下，上面 Pinia 提供的 4 个好处，你真的都需要吗？</strong></p>
<ul>
<li><strong>Devtools</strong>：说实话，在我十多年的生涯里，除了在 Redux/Vuex 刚出来那会儿，为了调试复杂的异步流和中间件，会去用时间旅行。在绝大多数业务场景里，<code>console.log</code> 和 Vue Devtools 里自带的组件状态检查，已经解决了 99% 的问题。为了那 1% 的“可能”，去引入一个库，划算吗？</li>
<li><strong>插件系统（如持久化）</strong> ：用组合式 API 怎么做持久化？太简单了。你封装的 <code>useUser</code> hook 里面，<code>login</code> 的时候加一行 <code>localStorage.setItem</code>，初始化 <code>token</code> 的时候加一行 <code>localStorage.getItem</code>。这不就是最原始、最可控的持久化吗？你需要为这么点功能，去学一个 Pinia 插件的 API 吗？</li>
<li><strong>SSR</strong>：如果你的项目压根就不是 SSR，那这条对你无效。</li>
<li><strong>严格的心智模型</strong>：这是最大的“陷阱”。组合式 API 的核心思想就是“自由”。它允许你把 <code>state</code> 和 <code>action</code> 放在一起，按“功能”去组织代码，而不是按“类型”（state/getter/action）去组织。<code>defineStore</code> 某种程度上，是又把我们拉回了 Vuex 的那种“分门别类”的思维里。</li>
</ul>
<p>所以，“你会得到更少的心智负担”指的就是这个。</p>
<p>你不需要去记 <code>defineStore</code> 的 API，不需要去想“我这个逻辑是算 <code>getter</code> 还是 <code>action</code>”，你就是在写 JS/TS，你就是在写 <code>function</code>。<strong>这难道不是一种解放吗？</strong></p>
<h4 data-id="heading-2"><strong>什么叫“没用明白 Pinia”？</strong></h4>
<p>在我看来，恰恰相反。</p>
<p><strong>把 Pinia 当成新时代的 Vuex，不分场景、启动项目就先装上，这才是“没用明白 Vue 3”。</strong></p>
<p>如果没有明白 Vue 3 组合式 API 到底给了你多大的“自由”和“能力”，就可能继续用 Vue 2 的“保姆式”思维在写 Vue 3。</p>
<p>我想了几个场景，大家参考下：</p>
<ol>
<li><strong>场景一：个人项目、小团队敏捷开发、内部工具</strong></li>
</ol>
<ul>
<li><strong>我的选择：100% 使用组合式 API。</strong></li>
<li><strong>理由：</strong> 速度快，灵活，零依赖。我可以按功能拆分 <code>useCounter.ts</code>, <code>useUser.ts</code>, <code>useCart.ts</code>... 它们就是一堆 TS 模块，需要共享就在顶层定义 <code>reactive</code>，不需要就只导出函数。打包体积更小，心智负担为零。</li>
</ul>
<ol start="3">
<li><strong>场景二：大型企业级应用、多团队协作、需要强规范</strong></li>
</ol>
<ul>
<li><strong>我的选择：我会倾向于使用 Pinia。</strong></li>
<li><strong>理由：</strong> 这种项目，“规范”大于“灵活”。<code>defineStore</code> 提供的统一范式，能让不同水平的开发者（尤其是新人）写出风格更一致的代码。而且在这种复杂项目里，Devtools 的时间旅行和状态快照，在排查深层 Bug 时，确实能派上用场。</li>
</ul>
<ol start="5">
<li><strong>场景三：需要 SSR 的项目</strong></li>
</ol>
<ul>
<li><strong>我的选择：用 Pinia。</strong></li>
<li><strong>理由：</strong> 别重复造轮子。Pinia 对 SSR 状态处理得很好，自己搞一套组合式 API 的 SSR 状态同步，费时费力，不值得。</li>
</ul>
<p>所以你看，并不是在全盘否定 Pinia，而是在呼吁大家 <strong>“按需选择”</strong> 。</p>
<p>不要因为“大家都用”或者“官方推荐”就去用。工具是死的，人是活的。Vue 3 给了我们一把更轻、更快的匕首（组合式 API），你为什么非要抱着那把很牛、但也很重的开山刀（Pinia）不放，连切个水果都要用它呢？</p>
<p>下次在项目里 <code>npm install pinia</code> 之前，先停 5 秒钟，问问自己：<strong>我这次，真的需要它吗？还是说，几个 <code>ref</code> 和 <code>reactive</code> 就能搞定了？</strong></p>
<p>想明白这个问题，可能比你多刷 10 篇 Pinia 的教程都有用。</p>
<p>行了，今天就聊到这。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[~/.ssh/config 作用详解]]></title>    <link>https://juejin.cn/post/7575119254314057754</link>    <guid>https://juejin.cn/post/7575119254314057754</guid>    <pubDate>2025-11-23T11:31:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575119254314057754" data-draft-id="7575438636330909747" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="~/.ssh/config 作用详解"/> <meta itemprop="keywords" content="SSH"/> <meta itemprop="datePublished" content="2025-11-23T11:31:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ~/.ssh/config 作用详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T11:31:49.000Z" title="Sun Nov 23 2025 11:31:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这是一个非常好的问题！我们来深入解释 <code>~/.ssh/config</code> 的作用，以及你写的这段配置为什么能让 <code>ssh devstack-vm</code> 一键完成复杂连接。</p>
<hr/>
<h2 data-id="heading-0">📁 一、<code>~/.ssh/config</code> 是什么？</h2>
<p><code>~/.ssh/config</code> 是 <strong>OpenSSH 客户端的用户级配置文件</strong>，用于为不同的 SSH 连接定义别名、主机地址、用户名、密钥、代理跳转、端口转发等参数。</p>
<blockquote>
<p>✅ 它的作用类似于“SSH 连接的快捷方式 + 自动化脚本”。</p>
</blockquote>
<p>当你执行：</p>
<pre><code class="hljs language-sql" lang="sql">ssh <span class="hljs-keyword">some</span><span class="hljs-operator">-</span>host
</code></pre>
<p>SSH 客户端会：</p>
<ol>
<li>查看 <code>~/.ssh/config</code> 中是否有名为 <code>some-host</code> 的 <code>Host</code> 块</li>
<li>如果有，就<strong>自动应用其中的所有配置</strong></li>
<li>如果没有，则按默认行为（直连、当前用户名、无代理等）处理</li>
</ol>
<hr/>
<h2 data-id="heading-1">🔧 二、你的配置逐行解析</h2>
<pre><code class="hljs language-css" lang="css">Host devstack-vm
  HostName <span class="hljs-number">192.168</span>.<span class="hljs-number">122.30</span>
  User stack
  ProxyJump hanwang<span class="hljs-keyword">@192</span>.168.18.133
  LocalForward <span class="hljs-number">8080</span> <span class="hljs-attribute">localhost</span>:<span class="hljs-number">80</span>
</code></pre>





























<table><thead><tr><th>配置项</th><th>含义</th></tr></thead><tbody><tr><td><code>Host devstack-vm</code></td><td>定义一个<strong>别名</strong>（nickname），以后可以用 <code>ssh devstack-vm</code> 代替完整命令</td></tr><tr><td><code>HostName 192.168.122.30</code></td><td>真正要连接的目标 IP（即你的 DevStack 虚拟机）</td></tr><tr><td><code>User stack</code></td><td>登录该 VM 时使用的用户名是 <code>stack</code></td></tr><tr><td><code>ProxyJump hanwang@192.168.18.133</code></td><td>先通过跳板机 <code>hanwang@192.168.18.133</code> 中转（相当于自动做 SSH 跳转）</td></tr><tr><td><code>LocalForward 8080 localhost:80</code></td><td>在本地（你的电脑）监听 8080 端口，并将流量通过隧道转发到 VM 的 <code>localhost:80</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-2">🔄 三、执行 <code>ssh devstack-vm</code> 时发生了什么？</h2>
<p>原本你需要手动执行两步：</p>
<h3 data-id="heading-3">❌ 手动方式（繁琐）：</h3>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># 第一步：登录跳板机</span>
ssh hanwang@192.<span class="hljs-number">168.18</span>.<span class="hljs-number">133</span>

<span class="hljs-comment"># 第二步（在跳板机上）：再登录 VM</span>
ssh stack@192.<span class="hljs-number">168.122</span>.<span class="hljs-number">30</span>
</code></pre>
<p>或者用旧式命令（嵌套 SSH）：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">ssh -t <span class="hljs-symbol">hanwang@</span><span class="hljs-number">192.168</span><span class="hljs-number">.18</span><span class="hljs-number">.133</span> ssh <span class="hljs-symbol">stack@</span><span class="hljs-number">192.168</span><span class="hljs-number">.122</span><span class="hljs-number">.30</span>
</code></pre>
<p>还要额外开一个终端做端口转发：</p>
<pre><code class="hljs language-ruby" lang="ruby">ssh -L <span class="hljs-number">8080</span><span class="hljs-symbol">:localhost</span><span class="hljs-symbol">:</span><span class="hljs-number">80</span> -J hanwang<span class="hljs-variable">@192</span>.<span class="hljs-number">168.18</span>.<span class="hljs-number">133</span> stack<span class="hljs-variable">@192</span>.<span class="hljs-number">168.122</span>.<span class="hljs-number">30</span>
</code></pre>
<h3 data-id="heading-4">✅ 使用 config 后：</h3>
<p>你只需输入：</p>
<pre><code class="hljs">ssh devstack-vm
</code></pre>
<p>SSH 自动帮你完成：</p>
<ol>
<li>以用户 <code>hanwang</code> 登录跳板机 <code>192.168.18.133</code></li>
<li>从跳板机再以用户 <code>stack</code> 登录 <code>192.168.122.30</code></li>
<li>同时在本地开启端口转发：<code>localhost:8080 → VM:80</code></li>
</ol>
<blockquote>
<p>💡 这就像给复杂的命令起了个“快捷方式”，还附带自动化功能！</p>
</blockquote>
<hr/>
<h2 data-id="heading-5">🌟 四、好处总结</h2>





























<table><thead><tr><th>优势</th><th>说明</th></tr></thead><tbody><tr><td><strong>简化命令</strong></td><td><code>ssh devstack-vm</code> 代替一长串参数</td></tr><tr><td><strong>避免重复输入</strong></td><td>用户名、IP、跳板机等不用每次写</td></tr><tr><td><strong>自动端口转发</strong></td><td>每次连接自动建立隧道，无需额外命令</td></tr><tr><td><strong>支持密钥管理</strong></td><td>可指定 <code>IdentityFile</code> 使用特定私钥</td></tr><tr><td><strong>提高安全性</strong></td><td>减少手动输入错误，避免密码泄露</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-6">🛠️ 五、扩展示例</h2>
<p>你还可以添加更多功能：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">Host</span> <span class="hljs-string">devstack-vm</span>
  <span class="hljs-string">HostName</span> <span class="hljs-number">192.168</span><span class="hljs-number">.122</span><span class="hljs-number">.30</span>
  <span class="hljs-string">User</span> <span class="hljs-string">stack</span>
  <span class="hljs-string">ProxyJump</span> <span class="hljs-string">hanwang@192.168.18.133</span>
  <span class="hljs-string">LocalForward</span> <span class="hljs-number">8080 </span><span class="hljs-string">localhost:80</span>
  <span class="hljs-string">LocalForward</span> <span class="hljs-number">8774 </span><span class="hljs-string">localhost:8774</span>   <span class="hljs-comment"># Nova API</span>
  <span class="hljs-string">LocalForward</span> <span class="hljs-number">9696 </span><span class="hljs-string">localhost:9696</span>   <span class="hljs-comment"># Neutron API</span>
  <span class="hljs-string">IdentityFile</span> <span class="hljs-string">~/.ssh/id_rsa</span>         <span class="hljs-comment"># 指定私钥</span>
  <span class="hljs-string">IdentitiesOnly</span> <span class="hljs-literal">yes</span>                 <span class="hljs-comment"># 只用指定密钥</span>
  <span class="hljs-string">ServerAliveInterval</span> <span class="hljs-number">60</span>             <span class="hljs-comment"># 防止断连</span>
</code></pre>
<p>这样一次连接，就能访问多个 OpenStack 服务！</p>
<hr/>
<h2 data-id="heading-7">✅ 六、注意事项</h2>
<ol>
<li>
<p><strong>文件权限必须严格</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">chmod</span> 600 ~/.ssh/config
<span class="hljs-built_in">chmod</span> 700 ~/.ssh
</code></pre>
<p>否则 SSH 会忽略该文件（出于安全考虑）。</p>
</li>
<li>
<p><strong>Host 名称区分大小写</strong>，建议全小写。</p>
</li>
<li>
<p><strong>缩进不是必须的</strong>，但为了可读性建议用空格对齐。</p>
</li>
</ol>
<hr/>
<h2 data-id="heading-8">🎯 总结一句话：</h2>
<blockquote>
<p><code>~/.ssh/config</code> 让你能用 <strong>简单别名</strong>（如 <code>devstack-vm</code>）<br/>
自动完成 <strong>复杂连接逻辑</strong>（跳板机 + 用户名 + 端口转发），<br/>
极大提升开发和运维效率！</p>
</blockquote>
<p>所以，<code>ssh devstack-vm</code> 能工作，不是魔法，而是你提前写好的“SSH 自动化剧本”在幕后默默执行 😊</p>
<p>如果你经常连接多台服务器，强烈建议善用这个文件！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[可逆计算的方法论来源]]></title>    <link>https://juejin.cn/post/7575119254314090522</link>    <guid>https://juejin.cn/post/7575119254314090522</guid>    <pubDate>2025-11-23T11:50:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575119254314090522" data-draft-id="7575182522411515942" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="可逆计算的方法论来源"/> <meta itemprop="keywords" content="后端,低代码"/> <meta itemprop="datePublished" content="2025-11-23T11:50:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="canonical_entropy"/> <meta itemprop="url" content="https://juejin.cn/user/4212984289694429"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            可逆计算的方法论来源
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984289694429/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    canonical_entropy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T11:50:19.000Z" title="Sun Nov 23 2025 11:50:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>对于软件领域的大量设计原则和所谓的方法论，我一直持有很深的怀疑态度。为什么会存在这些原则，能否从科学的层面证明它们的有效性？可逆计算理论试图为软件构造提供一个更加坚实的理论基础，它明确提出应该将“差量”提升为第一性的概念，将全量看作是差量的一种特例（全量=单位元+差量），围绕差量概念去重建整个领域概念体系。可逆计算的思想来源不是计算机科学本身，而是理论物理学，它将软件看作是处于不断演化过程中的抽象实体，在不同的复杂性层次上由不同的运算规则所描述，它所关注的是演化过程中产生的微小差量如何在系统内有序的传播并发生相互作用。本文将介绍可逆计算从作为其思想来源的统计物理学和量子力学所获得的启发。</p>
<h2 data-id="heading-0">（一）熵增原理</h2>
<p>在香农的原始定义中，信息是能够用来消除不确定性的东西。而在物理学中，所谓的不确定性就是系统的混乱程度，而用于度量系统混乱程度的物理量就是熵（Entropy）。接收到信息后，不确定性降低，也就意味着混乱程度的减少，因此信息也就被认为是负熵。</p>
<p>熵是物理学中的一个核心概念，它甚至比能量概念还要重要。热力学第一定律就是能量守恒定律，它指出能量只能被转化，而不可能被创造或者消灭。而热力学第二定律指出，即使有了能量，也不一定能够对外做功，必须考虑到热力学过程内在的不可逆性：热力学系统从一个平衡态演化到另一平衡态的过程中，其熵永不减少，若过程可逆，则熵不变，若不可逆，则熵增加，这也就是所谓熵增原理。</p>
<p>熵增原理控制了所有自然发生的过程，驱动所有事物自发的向着混乱最大化的方向发展。因此，在软件开发过程中，我们同样可以观察到大型软件产品普遍存在着从有序到混乱的发展历程。伴随着人员的更替、需求的变迁，在软件中增加新的功能变得越来越困难，修改bug经常引入新的bug，没人能够说清楚如何才能抽取系统中的一小部分进行复用，最终只能推翻重建。</p>
<p>可逆计算的核心是可逆性，而可逆性之所以重要，不仅仅在于它方便了软件元素的灵活复用，深层次的原因是它体现了我们这个世界本质的运作规律。通过遵循可逆计算原则，我们能够有效的控制软件演进过程中的熵增速度。理想情况下，如果系统能够做到完全可逆，则熵是保持不变的。</p>
<p>在软件架构设计中，我们总是说要高内聚、低耦合、关注点分离，但是什么是高、什么是低、需要分离到什么样的程度？可逆计算给出了一个可操作性更强的标准：分离到可逆的程度就好了。对于具体的软件开发，可逆计算所提出的要求是，任何增加的功能都应该有配对的逆向取消机制，任何输入到系统中的信息都应该存在一种自动反向提取出来的方法。</p>
<p>可逆性是可以复合的，即如果每个部分都可逆，且部分之间的结合关系也可逆，则系统整体可逆。这一特点使得逐步构建大型的可逆系统成为可能。具体方式可以参考设计模式中的Command模式：每个Command都包含一组配对的execute和undo操作，则一系列按顺序执行的Command可以被封装成一个BatchCommand，它的execute和undo操作可以由子命令复合得到。</p>
<p>现实世界中，熵增是无法逃避的宿命。但是即使无法完全消除熵增，我们仍然可以选择熵增发生的地方，例如将熵增集中在差量△中。特定客户的需求总是包含着大量随机的、偶然的因素，把它们纳入系统不可避免的会破坏原先统一均衡的系统结构，如果能够把这些偶然因素集中在一个可抛弃的差量△中，则可以保护核心架构不会受到侵蚀。当系统交付给新的客户时，我们不必携带上一个客户的个性化需求，可以始终从一个低熵的状态开始。</p>
<h2 data-id="heading-1">（二）量子力学中的世界图景</h2>
<p>量子力学是描述宇宙的基本理论，它所研究的问题可以归结为算符（Operator）作用到所谓的态函数（State Vector）上，如何驱动系统发生演化的问题。</p>
<p>1925年海森堡提出了量子力学的第一种表述形式：矩阵力学，它也被称为海森堡图景。在这一图景中，态函数ψ为固定的对象，不随时间演化，而可观测算符A的演化满足方程</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mi>d</mi><mi>A</mi></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mfrac><mi>i</mi><mi mathvariant="normal">ℏ</mi></mfrac><mo stretchy="false">[</mo><mi>H</mi><mo separator="true">,</mo><mi>A</mi><mo stretchy="false">]</mo><mo>+</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>A</mi></mrow><mrow><mi mathvariant="normal">∂</mi><mi>t</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{dA}{dt} = \frac{i}{\hbar}[H, A] + \frac{\partial A}{\partial t}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.0225em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3365em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">ℏ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">A</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></div>
<p>1926年薛定谔提出了量子力学的第二种表述形式：波动力学，它也被称为薛定谔图景。在这一图景中，算符为固定的对象，不随时间演化，而态函数的演化满足大名鼎鼎的薛定谔方程</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>i</mi><mi mathvariant="normal">ℏ</mi><mfrac><mi mathvariant="normal">∂</mi><mrow><mi mathvariant="normal">∂</mi><mi>t</mi></mrow></mfrac><mi>ψ</mi><mo>=</mo><mi>H</mi><mi>ψ</mi></mrow><annotation encoding="application/x-tex">i\hbar\frac{\partial}{\partial t}\psi = H\psi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"/><span class="mord mathnormal">i</span><span class="mord">ℏ</span><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mord mathnormal" style="margin-right:0.03588em;">ψ</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal" style="margin-right:0.03588em;">ψ</span></span></span></span></span></div>
<p>其后不久，薛定谔证明了矩阵力学和波动力学的等价性。</p>
<p>1927年狄拉克提出所谓的“变换理论”，引出了量子力学的第三种表述形式：相互作用图景，它也被称为狄拉克图景。在这一图景中，首先将系统的Hamilton量拆分为已知的部分和待研究的微小扰动</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>H</mi><mo>=</mo><msub><mi>H</mi><mn>0</mn></msub><mo>+</mo><msub><mi>H</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">H = H_0 + H_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span></div>
<p>然后研究系统如何偏离已知模型进行演化，即我们所关心的是差量描述的演化情况。在相互作用图景下，态函数和算符都随时间演化</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>i</mi><mi mathvariant="normal">ℏ</mi><mfrac><mi>d</mi><mrow><mi>d</mi><mi>t</mi></mrow></mfrac><msub><mi>ψ</mi><mi>I</mi></msub><mo>=</mo><msub><mi>H</mi><mrow><mn>1</mn><mo separator="true">,</mo><mi>I</mi></mrow></msub><msub><mi>ψ</mi><mi>I</mi></msub><mo separator="true">,</mo><mspace width="1em"/><mi>i</mi><mi mathvariant="normal">ℏ</mi><mfrac><mi>d</mi><mrow><mi>d</mi><mi>t</mi></mrow></mfrac><msub><mi>A</mi><mi>I</mi></msub><mo>=</mo><mo stretchy="false">[</mo><msub><mi>A</mi><mi>I</mi></msub><mo separator="true">,</mo><msub><mi>H</mi><mrow><mn>0</mn><mo separator="true">,</mo><mi>I</mi></mrow></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">i\hbar\frac{d}{dt}\psi_I = H_{1,I}\psi_I, \quad i\hbar\frac{d}{dt}A_I = [A_I, H_{0,I}]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"/><span class="mord mathnormal">i</span><span class="mord">ℏ</span><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">ψ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">ψ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:1em;"/><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">i</span><span class="mord">ℏ</span><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"/><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mclose">]</span></span></span></span></span></div>
<p>根据这三种图景都可以得到完全一致的物理测量结果</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo stretchy="false">⟨</mo><mi>A</mi><mo stretchy="false">⟩</mo><mo>=</mo><mo stretchy="false">⟨</mo><msub><mi>ψ</mi><mi>S</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>A</mi><mi>S</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>ψ</mi><mi>S</mi></msub><mo stretchy="false">⟩</mo><mo>=</mo><mo stretchy="false">⟨</mo><msub><mi>ψ</mi><mi>H</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>A</mi><mi>H</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>ψ</mi><mi>H</mi></msub><mo stretchy="false">⟩</mo><mo>=</mo><mo stretchy="false">⟨</mo><msub><mi>ψ</mi><mi>I</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>A</mi><mi>I</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>ψ</mi><mi>I</mi></msub><mo stretchy="false">⟩</mo></mrow><annotation encoding="application/x-tex">\langle A \rangle = \langle \psi_S | A_S | \psi_S \rangle = \langle \psi_H | A_H | \psi_H \rangle = \langle \psi_I | A_I | \psi_I \rangle</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">⟨</span><span class="mord mathnormal">A</span><span class="mclose">⟩</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">⟨</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">ψ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">ψ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">⟩</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">⟨</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">ψ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.08125em;">H</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.08125em;">H</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">ψ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.08125em;">H</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">⟩</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">⟨</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">ψ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">ψ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">⟩</span></span></span></span></span></div>
<p>相互作用图景是物理学家在实际工作中使用最多的图景。事实上，数学物理中存在一个专门的分支：微扰论（Perturbation Theory），它系统化的研究在已知模型的基础上添加微小的扰动量，新的模型如何演化的问题。而理论物理中绝大多数有价值的计算都是在微扰论的框架下进行。</p>
<p>如果把量子力学和计算机理论做个对比，我们会发现量子力学中的世界图景和计算机理论的世界观之间存在一个有趣的对应关系：</p>
<ul>
<li>薛定谔图景 &lt;--&gt; 图灵机</li>
<li>海森堡图景 &lt;--&gt; lambda演算</li>
<li>狄拉克图景 &lt;--&gt; 可逆计算</li>
</ul>
<p>图灵机和lambda演算建立了通用计算机的概念基础，在理论上解决了计算的可行性问题，即为什么可以存在一种通用的机器执行机械化的动作，使用有限资源来完成所有我们能够想见的计算。在通用计算机已经普及的今天，我们所面临的最大的实际问题是如何有效的进行计算的问题。计算效率的提高依赖于我们发现计算中的"捷径"，而这依赖于我们对问题本质的洞察，而洞察的产生与问题的表述形式息息相关。表象（representation）变换本身甚至就是解决问题的一种方式，因为变换后的问题表象有可能使得解决方案变得清晰可见。可逆计算借助于领域模型和差量描述，使我们的注意力得以聚焦在待解决的新问题上。</p>
<h2 data-id="heading-2">（三）群和结构主义</h2>
<p>自从爱因斯坦发现相对论以来，现代物理学的大多数基本原理都建筑在群概念的基础之上。例如，狭义相对论对应于Lorentz群，量子电动力学对应于U(1)规范群等。</p>
<p>所谓群（Group），就是定义了一个二元运算（不妨记为符号+），并满足如下四条群公理的非空集合G：</p>
<ol>
<li><strong>封闭律</strong>。集合中任意两个元素的运算结果仍属于该集合。</li>
<li><strong>结合律</strong>。运算可以局部进行，运算的最终结果与运算的结合顺序无关。</li>
<li><strong>幺元律</strong>。集合中存在单位元0，它对任何元素的作用结果都是无作用。</li>
<li><strong>逆元律</strong>。集合中对每一个元素a，存在对应的逆元素-a，它可以完全取消a的作用。</li>
</ol>
<p>这四条公理看似非常简单，却蕴含着非常深刻的数学内容。例如，如果只考虑元素个数有限的所谓有限群，不用增加任何其他假定，仅依赖这四条公理，即可推导出大量数学定理。在1955年至2004年间共100多位数学家在500多篇期刊文章中写下了上万页的证明，才完成了对有限群分类的工作。</p>
<p>封闭律是为了确保所有的运算结果都仍然在定义范围之内，不会出现运算结果无法描述的情况，这样运算就可以一直持续下去，构成很长的推理链条。例如，Lisp语言具有所谓的同像性（homoiconicity），Lisp宏的输出仍然是合法的Lisp语言，这正是封闭律的一种体现。</p>
<p>结合律意味着可以进行局部运算，而不用依赖于全局结构，这样才可能实现子结构的二次封装。例如，对于满足结合律的运算，可以将B和C抽象为一个新的结构X，而将D和E抽象为一个新的结构Y，X和Y的组合可以被再次抽象为结构Z。</p>
<p>满足结合律的运算可以实现局部优化，即我们可以选择在合适的地方加上括号，实现局部的预计算。例如</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>A</mi><mo>⋅</mo><mo stretchy="false">(</mo><mi>B</mi><mo>⋅</mo><mi>C</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mi>A</mi><mo>⋅</mo><mi>B</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>C</mi></mrow><annotation encoding="application/x-tex">A \cdot (B \cdot C) = (A \cdot B) \cdot C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span></span></div>
<p>所谓的分而治之（Divide And Conquer）技术，之所以能够加速计算，很多时候所利用的也就是结合律，比如说归并排序。</p>
<p>幺元律的作用在于它使得差量成为第一性的概念。在具有单位元的系统中，任何量都可以被看作是与单位元之间的差量。例如</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>A</mi><mo>=</mo><mn>0</mn><mo>+</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">A = 0 + A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">0</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">A</span></span></span></span></span></div>
<p>从哲学上说，物理学格物以致知，我们所知的一切都只是世界的变化，世界的本体是不可观测的。所谓的差量（有正有负）实际上就是我们知识的全部。</p>
<p>如果满足封闭律，结合律和幺元律，在数学上就可以称之为"幺半群"。函数式编程中著名的Monad，只不过是自函子范畴上的幺半群而已。</p>
<p>Monad只是幺半群，它不满足逆元律。在群的四条公理中，最难被人们所认识的也是逆元律。从自然数发展的历史来看，欧洲数学家直到17世纪才接受负数的概念，这反映出本质上逆元的概念存在令人困惑之处。在当时的人们看来，负数对应于不存在的事物，既然对应的对象不存在，负数本身怎么能够存在呢？</p>
<p>逆运算对于很多数学推导来说都是必不可少的。例如在引入负数之前，</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>x</mi><mo>+</mo><mn>5</mn><mo>=</mo><mn>3</mn><mspace width="1em"/><mtext>和</mtext><mspace width="1em"/><mi>x</mi><mo>+</mo><mn>3</mn><mo>=</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">x + 5 = 3 \quad \text{和} \quad x + 3 = 5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">5</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord">3</span><span class="mspace" style="margin-right:1em;"/><span class="mord text"><span class="mord cjk_fallback">和</span></span><span class="mspace" style="margin-right:1em;"/><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">3</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">5</span></span></span></span></span></div>
<p>这两个方程的结构是完全不同的，它们需要不同的求解技术，因此也就不可能利用符号抽象出二次方程的标准形式</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>a</mi><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mi>b</mi><mi>x</mi><mo>+</mo><mi>c</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">ax^2 + bx + c = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord mathnormal">a</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"/><span class="mord mathnormal">b</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></div>
<p>引入负数才使得我们能够以统一的方式提出问题，并研究通用的求解技术。</p>
<p>基于逆元可以在任意元素之间建立关联，从而实现任意元素之间的转化。这样元素之间的关系就突破了简单的整体-部分或者一般-特殊等关系的范畴，进入更加抽象的结构运算范畴。这种思想上的变革启发了哲学中的结构主义思潮。</p>
<p>在哲学上，结构主义提出结构具有三个要素：整体性，转换性（具有转换规律或法则），自律性（自身调整性）。整体性意味着结构不能被简单的切分，其构成要素通过内在的关系运算实现大范围的关联与转换，整体之所以成为整体正是以转换/运算的第一性为保证的。这种转换可以是共时的（同时存在的各元素），也可以是历时的（历史的转换构造过程），这意味着结构总要求一个内在的构造过程，在独立于外部环境的情况下结构具有某种自给自足的特性，不依赖于外部条件即可独立的存在并保持内在的活动。自律性意味着结构内在的转换总是维持着某种封闭性和守恒性，确保新的成分在无限地构成而结构边界却保持稳定。注意到这里对结构的评判并不是来自外在规范和约束，而是基于结构内在的规律性，所强调的不是结构对外部条件的适应性，而是自身概念体系的完备性。实际上，一个无法直接对应于当前实际环境的结构仍然可能具有重要的价值，并在解决问题的过程中扮演不可或缺的角色。在合理性这个视角下，我们所关注的不仅仅是当前的现实世界，而是所有可能的世界。结构独立于内容存在于抽象的数学世界中，一个"合理"的结构的价值必能在它所适应的具体世界中凸显出来。</p>
<p>在建立领域模型时，我们可能经常会问这个模型是否是对业务的准确描述，是否可以适应需求的变更，是否允许未来的各种扩展等等。但是如果换一个思维方向，我们会发现这些问题都假定了存在最适合业务领域的唯一理想的模型，我们想知道当前模型和理想的模型之间相差多远。这些问题都是针对最终确立的模型而发问的，而在模型构建的过程中，那些可被利用的，已存在的或者可以存在的模型又是哪些呢？每一个信息模型都对应着某种自动推理机，可以接收信息并做一定的推导综合工作。一个可行的问题是，如何才能更有效的利用已有的信息进行推导，如何消除冗余并减少各种转换成本。我们经常可以观察到，某一信息组织方式更充分的发掘了信息之间的内在关联（表现为它对信息的使用不是简单的局域化的，而是在多处呈现为互相纠缠的方式，难以被分解），这种内在关联足够丰富，以至于我们不依赖于外部因素就可以独立的理解。这种纠缠在一起的信息块自然会成为我们建模的对象。</p>
<p>如果我们不再强求单一的、大而全的模型，使得模型的"覆盖能力"不再是我们关注的重点，那么建模的思维图式将会发生深刻的转变：最终的模型可以由一系列微模型交织构成，每一个微模型在某种程度上说都是自给自足、自圆其说的，它的存在合理性由其内在逻辑的自洽性决定。在这种图式下，所谓的模型就相当于是已经确立的数学定理，如果增加新的假设，我们可以通过已有的定理推导出新的定理，也就是建立新的模型。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[[Ai Agent] 09 LangGraph 进阶：构建可控、可协作的多智能体系统]]></title>    <link>https://juejin.cn/post/7575090551357669428</link>    <guid>https://juejin.cn/post/7575090551357669428</guid>    <pubDate>2025-11-23T09:28:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575090551357669428" data-draft-id="7575090551357653044" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="[Ai Agent] 09 LangGraph 进阶：构建可控、可协作的多智能体系统"/> <meta itemprop="keywords" content="LangChain,Agent"/> <meta itemprop="datePublished" content="2025-11-23T09:28:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="再会呀"/> <meta itemprop="url" content="https://juejin.cn/user/446878782598644"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            [Ai Agent] 09 LangGraph 进阶：构建可控、可协作的多智能体系统
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/446878782598644/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    再会呀
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T09:28:09.000Z" title="Sun Nov 23 2025 09:28:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读23分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>博客配套代码发布于<a href="https://link.juejin.cn?target=https%3A%2F%2Fso.csdn.net%2Fso%2Fsearch%3Fq%3Dgithub%26spm%3D1001.2101.3001.7020" title="https://so.csdn.net/so/search?q=github&amp;spm=1001.2101.3001.7020" target="_blank" ref="nofollow noopener noreferrer">github</a>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FAnnyfee%2Fagent-craft" title="https://github.com/Annyfee/agent-craft" target="_blank" ref="nofollow noopener noreferrer">09 LangGraph 进阶</a></p>
<p><strong>本系列所有博客均配套Gihub开源代码，开箱即用，仅需配置API_KEY。</strong></p>
<p>如果该Agent教学系列帮到了你，<strong>欢迎给我个Star⭐</strong>！</p>
<p><strong>知识点</strong>：<strong>Human-in-the-Loop（人工干预）｜ Graph-as-a-Tool（图即工具）| Multi-Agent 多智能体编排</strong></p>
<hr/>
<h2 data-id="heading-0">前言：</h2>
<p>在08篇中，我们亲手用LangGraph实现了一个<strong>透明、可追踪、带记忆</strong>的ReAct。它能思考、调用工具并记住历史，看起来已足够强大。</p>
<p>但是在生产级环境，它立马会撞上三大难题：</p>
<p><strong>其一、安全失控：</strong></p>
<p>Agent可以自动删除数据、发送邮件、转账付款——没有任何确认机制，一旦出错，无可挽回。</p>
<p><strong>其二、工作流臃肿：</strong></p>
<p>为了让Agent处理复杂任务，我们在单个节点里不断堆砌逻辑：“先验证输入&gt;再查数据&gt;然后进行业务计算&gt;最后格式化输出...”</p>
<p>节点函数越来越长，流程臃肿。每次修改业务逻辑都需要重写整个函数，测试难度飙升。</p>
<p><strong>其三、职责混乱：</strong></p>
<p>所有功能都挤在一个Agent里，它既是研究员又是专家还是客服，身兼数职，更别提还要加上不断扩大的记忆。短期尚可，长期必炸。</p>
<p>所以，本篇为这三大痛点分别提供了三种对应解决的进阶能力：</p>
<p><strong>Human-in-the-Loop（人工干预）</strong> ：解决安全失控；</p>
<p><strong>Graph-as-a-tool（图即工具）</strong> ：解决工作流臃肿；</p>
<p><strong>Multi-Agent（多智能体编排）</strong> ：解决职责混乱。</p>
<p>接下来，我们用这三个能力，逐一攻克上述的问题。</p>
<h2 data-id="heading-1">一、Human-in-the-Loop：让Agent学会“请示”</h2>
<h3 data-id="heading-2">为什么需要人工干预</h3>
<p>全自动执行在demo运行中听起来很好，但在实际运行中非常<strong>极其危险</strong>。</p>
<p>比如用户说，“把项目预算邮件发给财务”，Agent自动调用send_email(to="@xx.com",content="xx")，如果内容有误，邮件一旦发出无法撤回。</p>
<p>所以我们需要一种机制：<strong>在执行高风险操作前暂停，等待人类确认</strong>。</p>
<p>Langgraph提供了完美的解决方案：<strong>interrupt_before + MemorySaver。</strong></p>
<ul>
<li><strong>MemorySaver</strong>会将图的当前状态（包括消息历史、中间变量）持久化；</li>
<li><strong>interrupt_before=["node_name"]</strong> 表示“在进入该节点前暂停执行”；</li>
<li>暂停后，程序可以检查即将执行的操作，并询问用户是否继续；</li>
<li>若用户批准，调用<strong>app.stream(None，config)</strong> 即可从断点恢复执行</li>
</ul>
<p>这相当于为Agent加了一道 <strong>“安全锁”</strong> 。</p>
<p>人为审批的思路也很简单，我们假设一个发邮件Agent：</p>
<p>当你发邮件时，该Agent会暂停并显示即将执行的操作，等待你输入yes才继续。</p>
<p>大致步骤如下：</p>
<p><strong>1. 提前确定好哪个节点需要“审批”，在这里停住：</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">app</span> = workflow.compile(
    <span class="hljs-comment"># 在内存里做状态持久化</span>
    <span class="hljs-attr">checkpointer</span>=MemorySaver(),
    <span class="hljs-attr">interrupt_before</span>=[<span class="hljs-string">"tools"</span>] <span class="hljs-comment"># 选择要人工审批的节点 -- 负责在哪里停，之后的代码负责停了之后怎么办</span>
)
</code></pre>
<p><strong>2. 触发执行，并自动暂停</strong></p>
<p>注：此处用stream流式，是利用流式API的中断机制，使其能够精准在特定节点前暂停。</p>
<pre><code class="hljs language-ini" lang="ini">    while 1:
        <span class="hljs-comment"># 触发工作流执行，推进到下一个中断点或自然结束</span>
        for _ in app.stream(inputs,config,<span class="hljs-attr">stream_mode</span>=<span class="hljs-string">"values"</span>): <span class="hljs-comment"># 流式执行</span>
        <span class="hljs-comment"># inputs注入事件;config确定回话id;"values":完整记录每步结果</span>
            pass   <span class="hljs-comment"># 必须迭代生成器，才能实际执行工作流</span>
</code></pre>
<p><strong>3. 获取暂停节点的状态：</strong></p>
<pre><code class="hljs language-ini" lang="ini">        <span class="hljs-comment"># 获取当前状态</span>
        <span class="hljs-attr">snapshot</span> = app.get_state(config)
        <span class="hljs-attr">next_tasks</span> = snapshot.next <span class="hljs-comment"># 返回下一步要执行的节点名列表</span>
</code></pre>
<p><strong>4. 如果没有下一步，说明工作流已结束：</strong></p>
<pre><code class="hljs language-python" lang="python">        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> next_tasks:
            final_msg = snapshot.values[<span class="hljs-string">'messages'</span>][-<span class="hljs-number">1</span>]
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f'\n最终回复:<span class="hljs-subst">{final_msg.content}</span>'</span>)
            <span class="hljs-keyword">break</span>
</code></pre>
<p><strong>5. 如果下一步是需要审批的节点，进行审批：</strong></p>
<pre><code class="hljs language-python" lang="python">        <span class="hljs-keyword">if</span> <span class="hljs-string">"tools"</span> <span class="hljs-keyword">in</span> next_tasks:
            last_msg = snapshot.values[<span class="hljs-string">'messages'</span>][-<span class="hljs-number">1</span>]
            tool_call = last_msg.tool_calls[<span class="hljs-number">0</span>]
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f'\n⚠️ Agent准备执行操作：'</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f'    工具名称：<span class="hljs-subst">{tool_call[<span class="hljs-string">"name"</span>]}</span>'</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f'    参数：<span class="hljs-subst">{tool_call[<span class="hljs-string">"args"</span>]}</span>'</span>)

            approval = <span class="hljs-built_in">input</span>(<span class="hljs-string">"\n✅ 是否批准执行？(输入 'yes' 继续，其他取消): "</span>).strip().lower()
            <span class="hljs-keyword">if</span> approval == <span class="hljs-string">"yes"</span>:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">'\n 继续执行...'</span>)
                inputs = <span class="hljs-literal">None</span> <span class="hljs-comment"># 表示从断点继续，无新输入</span>
            <span class="hljs-keyword">else</span>:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n❌ 操作已取消，流程终止"</span>)
                <span class="hljs-keyword">break</span>
</code></pre>
<p>完整代码如下:</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> config <span class="hljs-keyword">import</span> OPENAI_API_KEY,LANGCHAIN_API_KEY
<span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI
<span class="hljs-keyword">from</span> langchain.tools <span class="hljs-keyword">import</span> tool
<span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> HumanMessage
<span class="hljs-keyword">from</span> langgraph.graph <span class="hljs-keyword">import</span> StateGraph, MessagesState, START, END
<span class="hljs-keyword">from</span> langgraph.prebuilt <span class="hljs-keyword">import</span> ToolNode
<span class="hljs-keyword">from</span> langgraph.checkpoint.memory <span class="hljs-keyword">import</span> MemorySaver

<span class="hljs-comment"># langsmith调试</span>
os.environ[<span class="hljs-string">"LANGCHAIN_TRACING_V2"</span>] = <span class="hljs-string">"true"</span> <span class="hljs-comment"># 总开关，决定启用追踪功能</span>
os.environ[<span class="hljs-string">"LANGCHAIN_PROJECT"</span>] = <span class="hljs-string">"human_approval"</span> <span class="hljs-comment"># 自定义项目名</span>
os.environ[<span class="hljs-string">"LANGCHAIN_API_KEY"</span>] = LANGCHAIN_API_KEY

<span class="hljs-comment"># llm配置</span>
llm = ChatOpenAI(
    model=<span class="hljs-string">"deepseek-chat"</span>,
    api_key=OPENAI_API_KEY,
    base_url=<span class="hljs-string">"https://api.deepseek.com"</span>
)

<span class="hljs-comment"># 定义一个敏感工具：发送邮件(模拟)</span>
<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">send_email</span>(<span class="hljs-params">to, content</span>):
    <span class="hljs-string">"""模拟发送邮件"""</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">f'邮件已发送至<span class="hljs-subst">{to}</span>,内容为：<span class="hljs-subst">{content}</span>'</span>


<span class="hljs-comment"># 工具绑定到llm</span>
tools = [send_email]
llm_with_tools = llm.bind_tools(tools)

<span class="hljs-comment"># Node函数与Edge节点</span>
tool_node = ToolNode(tools)


<span class="hljs-keyword">def</span> <span class="hljs-title function_">call_model</span>(<span class="hljs-params">state: MessagesState</span>):
    response = llm_with_tools.invoke(state[<span class="hljs-string">'messages'</span>])
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"messages"</span>:[response]}


<span class="hljs-keyword">def</span> <span class="hljs-title function_">should_continue</span>(<span class="hljs-params">state: MessagesState</span>):
    last_msg = state[<span class="hljs-string">'messages'</span>][-<span class="hljs-number">1</span>]
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(last_msg, <span class="hljs-string">"tool_calls"</span>) <span class="hljs-keyword">and</span> last_msg.tool_calls:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"tools"</span>
    <span class="hljs-keyword">return</span> END


<span class="hljs-comment"># 构建基础ReAct图</span>
workflow = StateGraph(MessagesState)

workflow.add_node(<span class="hljs-string">"agent"</span>, call_model)
workflow.add_node(<span class="hljs-string">"tools"</span>, tool_node)
workflow.add_edge(START, <span class="hljs-string">"agent"</span>)

workflow.add_conditional_edges(
    <span class="hljs-string">"agent"</span>,
    should_continue,
    {
        <span class="hljs-string">"tools"</span>: <span class="hljs-string">"tools"</span>,
        END: END
    }
)

workflow.add_edge(<span class="hljs-string">"tools"</span>, <span class="hljs-string">"agent"</span>)

app = workflow.<span class="hljs-built_in">compile</span>(
    checkpointer=MemorySaver(),
    interrupt_before=[<span class="hljs-string">"tools"</span>] <span class="hljs-comment"># 选择要人工审批的节点 -- 负责在哪里停，之后的代码负责停了之后怎么办</span>
)


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    config = {
        <span class="hljs-string">"configurable"</span>:{<span class="hljs-string">"thread_id"</span>:<span class="hljs-string">"user123"</span>}
    }
    user_input = <span class="hljs-string">"请帮我给 boss@example.com 发一封邮件，内容是：会议推迟到明天下午3点。"</span>

    <span class="hljs-built_in">print</span>(<span class="hljs-string">"用户输入:"</span>,user_input)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\nAgent正在思考...\n"</span>)

    <span class="hljs-comment"># 初识输入</span>
    inputs = {<span class="hljs-string">"messages"</span>:[HumanMessage(content=user_input)]}

    <span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:
        <span class="hljs-comment"># 触发工作流执行，推进到下一个中断点或自然结束</span>
        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> app.stream(inputs,config,stream_mode=<span class="hljs-string">"values"</span>): <span class="hljs-comment"># 流式执行</span>
            <span class="hljs-keyword">pass</span>   <span class="hljs-comment"># 必须迭代生成器，才能实际执行工作流</span>

        <span class="hljs-comment"># 获取当前状态</span>
        snapshot = app.get_state(config)
        next_tasks = snapshot.<span class="hljs-built_in">next</span> <span class="hljs-comment"># 返回下一步要执行的节点名列表</span>

        <span class="hljs-comment"># 如果没有下一步，说明工作流已结束</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> next_tasks:
            final_msg = snapshot.values[<span class="hljs-string">'messages'</span>][-<span class="hljs-number">1</span>]
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f'\n最终回复:<span class="hljs-subst">{final_msg.content}</span>'</span>)
            <span class="hljs-keyword">break</span>

        <span class="hljs-comment"># 如果下一步是需要审批的节点</span>
        <span class="hljs-keyword">if</span> <span class="hljs-string">"tools"</span> <span class="hljs-keyword">in</span> next_tasks:
            last_msg = snapshot.values[<span class="hljs-string">'messages'</span>][-<span class="hljs-number">1</span>]
            tool_call = last_msg.tool_calls[<span class="hljs-number">0</span>]
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f'\n⚠️ Agent准备执行操作：'</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f'    工具名称：<span class="hljs-subst">{tool_call[<span class="hljs-string">"name"</span>]}</span>'</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f'    参数：<span class="hljs-subst">{tool_call[<span class="hljs-string">"args"</span>]}</span>'</span>)

            approval = <span class="hljs-built_in">input</span>(<span class="hljs-string">"\n✅ 是否批准执行？(输入 'yes' 继续，其他取消): "</span>).strip().lower()
            <span class="hljs-keyword">if</span> approval == <span class="hljs-string">"yes"</span>:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">'\n 继续执行...'</span>)
                inputs = <span class="hljs-literal">None</span> <span class="hljs-comment"># 表示从断点继续，无新输入</span>
            <span class="hljs-keyword">else</span>:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n❌ 操作已取消，流程终止"</span>)
                <span class="hljs-keyword">break</span>
</code></pre>
<p>测试：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94400e2d4baa4d6d8dde3f72eb583c02~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764494889&amp;x-signature=APMjehxTKg4h8Vy9gWDCsF2jVKw%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=https%3A%2F%2Fp0-xtjj-private.juejin.cn%2Ftos-cn-i-73owjymdk6%2Fd88b72506ee74a88a0247d9ffde7df6a~tplv-73owjymdk6-jj-mark-v1%3A0%3A0%3A0%3A0%3A5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA%3Aq75.awebp%3Fpolicy%3DeyJ2bSI6MywidWlkIjoiNDQ2ODc4NzgyNTk4NjQ0In0%253D%26rk3s%3De9ecf3d6%26x-orig-authkey%3Df32326d3454f2ac7e96d3d06cdbb035152127018%26x-orig-expires%3D1763976315%26x-orig-sign%3DuTg%252B3eWifqZC9AM%252FsazNdzp58lE%253D" target="_blank" title="https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/d88b72506ee74a88a0247d9ffde7df6a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiNDQ2ODc4NzgyNTk4NjQ0In0%3D&amp;rk3s=e9ecf3d6&amp;x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&amp;x-orig-expires=1763976315&amp;x-orig-sign=uTg%2B3eWifqZC9AM%2FsazNdzp58lE%3D" ref="nofollow noopener noreferrer"/></p>
<p>如果我们把其中的user_input改为boss，不写明邮箱号，再测试一遍：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf36a993059f4565a5a531f8e40da4e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764494889&amp;x-signature=DW5vkG1ycbZK51rCevoOJn9ZdNk%3D" alt="" loading="lazy"/></p>
<p>此时没有调用发邮件工具，自然也不会需要人工确认了。</p>
<h2 data-id="heading-3">二、Graph-as-a-Tool：把复杂流程封装成“黑盒工具”</h2>
<h3 data-id="heading-4"><strong>为什么需要这种封装？</strong></h3>
<p>回想我们之前的 RAG 实现：一个完整的检索增强生成流程，通常包含<strong>多个步骤</strong>——文档加载与分块、文本向量化、存入向量数据库、执行检索、上下文增强、最终生成答案。这些操作本身已足够繁琐。</p>
<p>如果直接把这些逻辑塞进一个普通函数，并作为 LangChain Tool 注册给 LangGraph 使用，虽然技术上可行，但会带来<strong>明显问题</strong>：  </p>
<ul>
<li><strong>耦合度高</strong>：所有逻辑挤在一起，难以单独测试或替换某一步；</li>
<li><strong>可读性差</strong>：主图节点变成“大泥球”，失去流程清晰性；</li>
<li><strong>扩展困难</strong>：一旦需求变化（比如加入重排、多跳查询、结果校验），代码迅速膨胀，if-else 嵌套失控。</li>
</ul>
<p>更关键的是——<strong>真实世界的智能任务往往不是线性的</strong>。<br/>
例如，RAG 可能需要根据检索质量决定是否重新生成查询、是否引入外部知识、甚至请求人工确认。这类带<strong>状态转移、条件分支、循环反馈</strong>的逻辑，用传统函数难以优雅表达。</p>
<p>这时，<strong>Graph-as-a-Tool</strong> 的价值就凸显出来了。</p>
<p>它允许我们将某个复杂子任务（如 RAG）<strong>自身建模为一个独立的工作流图（sub-graph）</strong> ，再将整个图封装成一个对外透明的 Tool。对主 Graph 而言，它只是一个<strong>语义明确的黑盒接口</strong>；而内部，却是一个结构清晰、节点分明、支持中断恢复的<strong>完整流程</strong>。</p>
<blockquote>
<p>这正是现代智能体架构的核心理念：<strong>分层抽象，嵌套编排</strong>。<br/>
主图负责“决策做什么”，子图（作为 Tool）负责“如何做”。<br/>
而只有“图”这种结构，才能优雅地表达这种<strong>分层、嵌套、带反馈的复杂工作流</strong>。</p>
</blockquote>
<p>假设我们要做一个<strong>可以自动重试的API服务调用</strong>。该服务调用作为一个工具给主工作流。而它自身则是由一个子图构成，里面涵盖了一个完整的子工作流。</p>
<p>主要代码构建如下：（完整部分github中已提供）</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ...相关配置</span>
<span class="hljs-comment"># 构建子工作流</span>
<span class="hljs-comment"># 1.子任务状态</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RetryState</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    query: <span class="hljs-built_in">str</span>
    attempt: <span class="hljs-built_in">int</span>
    result: <span class="hljs-built_in">str</span>

<span class="hljs-comment"># 2.子图逻辑 -- 模拟一个可能失败，需重试的API调用</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">call_unstable_api</span>(<span class="hljs-params">state:RetryState</span>):
    <span class="hljs-string">"""模拟偶发性的外部服务，偶发失败"""</span>
    attempt = state[<span class="hljs-string">"attempt"</span>]
    <span class="hljs-keyword">if</span> attempt == <span class="hljs-number">1</span>:
        <span class="hljs-comment"># 第一次故意失败</span>
        <span class="hljs-keyword">return</span> {<span class="hljs-string">"result"</span>:<span class="hljs-string">"ERROR：服务暂时不可用"</span>,<span class="hljs-string">"attempt"</span>:attempt+<span class="hljs-number">1</span>}
    <span class="hljs-keyword">else</span>:
        <span class="hljs-comment"># 第二次成功</span>
        <span class="hljs-keyword">return</span> {<span class="hljs-string">"result"</span>:<span class="hljs-string">f"SUCCESS：成功处理请求：<span class="hljs-subst">{state[<span class="hljs-string">'query'</span>]}</span>"</span>,<span class="hljs-string">"attempt"</span>:attempt+<span class="hljs-number">1</span>}

<span class="hljs-keyword">def</span> <span class="hljs-title function_">should_retry</span>(<span class="hljs-params">state:RetryState</span>):
    <span class="hljs-keyword">if</span> <span class="hljs-string">"ERROR"</span> <span class="hljs-keyword">in</span> state[<span class="hljs-string">"result"</span>] <span class="hljs-keyword">and</span> state[<span class="hljs-string">"attempt"</span>] &lt;= <span class="hljs-number">2</span>: <span class="hljs-comment"># 出现报错且重试次数小于2，重连</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"call_api"</span>
    <span class="hljs-keyword">return</span> END

<span class="hljs-comment"># 3.构建子图工作流</span>
retry_workflow = StateGraph(RetryState)
retry_workflow.add_node(<span class="hljs-string">"call_api"</span>,call_unstable_api)
retry_workflow.add_edge(START,<span class="hljs-string">"call_api"</span>)
retry_workflow.add_conditional_edges(
    <span class="hljs-string">"call_api"</span>,
    should_retry,
    {<span class="hljs-string">"call_api"</span>:<span class="hljs-string">"call_api"</span>,END:END}
)
retry_app = retry_workflow.<span class="hljs-built_in">compile</span>()

<span class="hljs-comment"># 4.封装为tool(Graph-as-a-Tool)</span>
<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_order</span>(<span class="hljs-params">query:<span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""创建新订单，自动重试保障成功率"""</span>
    result = retry_app.invoke({<span class="hljs-string">"query"</span>:query,<span class="hljs-string">"attempt"</span>:<span class="hljs-number">1</span>,<span class="hljs-string">"result"</span>:<span class="hljs-string">""</span>})
    <span class="hljs-keyword">return</span> result[<span class="hljs-string">"result"</span>]


<span class="hljs-comment"># 5.主graph</span>
tools = [create_order]
llm_with_tools = llm.bind_tools(tools)
tool_node = ToolNode(tools)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">agent_node</span>(<span class="hljs-params">state:MessagesState</span>):
    response = llm_with_tools.invoke(state[<span class="hljs-string">"messages"</span>])
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"messages"</span>:[response]}

<span class="hljs-keyword">def</span> <span class="hljs-title function_">should_continue</span>(<span class="hljs-params">state:MessagesState</span>):
    last_msg = state[<span class="hljs-string">"messages"</span>][-<span class="hljs-number">1</span>]
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(last_msg,<span class="hljs-string">"tool_calls"</span>) <span class="hljs-keyword">and</span> last_msg.tool_calls:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"tools"</span>
    <span class="hljs-keyword">return</span> END

<span class="hljs-comment"># 构建主工作流</span>
workflow = StateGraph(MessagesState)
workflow.add_node(<span class="hljs-string">"agent"</span>,agent_node)
workflow.add_node(<span class="hljs-string">"tools"</span>,tool_node)
workflow.add_edge(START,<span class="hljs-string">"agent"</span>)
workflow.add_conditional_edges(
    <span class="hljs-string">"agent"</span>,
    should_continue,
    {
        <span class="hljs-string">"tools"</span>: <span class="hljs-string">"tools"</span>,
        END: END
    }
)
workflow.add_edge(<span class="hljs-string">"tools"</span>,<span class="hljs-string">"agent"</span>)

app = workflow.<span class="hljs-built_in">compile</span>()

<span class="hljs-comment"># 运行</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    user_input = <span class="hljs-string">"请创建一个新订单：购买三本书"</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'用户输入:'</span>,user_input)

    inputs = {<span class="hljs-string">"messages"</span>:[
        SystemMessage(content=<span class="hljs-string">"你是一个任务执行助手。当用户提出任何需要处理、操作或执行的请求时，必须调用 create_order 工具来完成，不要自行回答细节"</span>),
        HumanMessage(content=user_input)
    ]}
    result = app.invoke(inputs)

    tool_result = <span class="hljs-literal">None</span>
    <span class="hljs-comment"># 在主工作流的消息历史中，查找最近的工具执行结果</span>
    <span class="hljs-keyword">for</span> msg <span class="hljs-keyword">in</span> <span class="hljs-built_in">reversed</span>(result[<span class="hljs-string">"messages"</span>]):
        <span class="hljs-keyword">if</span> msg.<span class="hljs-built_in">type</span> == <span class="hljs-string">"tool"</span>: <span class="hljs-comment"># 找到ToolMessage类型消息</span>
            tool_result = msg.content
            <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">if</span> tool_result:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n✅ 直接获取子图返回值:\n<span class="hljs-subst">{tool_result}</span>"</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n❌ 未执行任何工具"</span>)
    final_reply = result[<span class="hljs-string">"messages"</span>][-<span class="hljs-number">1</span>]
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f'\n最终回复:\n<span class="hljs-subst">{final_reply}</span>'</span>)
</code></pre>
<p>其中的for msg in reversed(result["messages"]) 包含的是完整的对话历史记录，而非工作流执行过程。ToolNode会在对话历史中执行结果消息。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6428e77d1bbd4ebf8e68dac43223d18c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764494889&amp;x-signature=jJK1SruKvKbYOzW1Iu5j84GR0IM%3D" alt="" loading="lazy"/></p>
<p>如上，代码运行成功。</p>
<p>现在我们能<strong>对应不同场景的tool，编写不同的graph来应对复杂的逻辑</strong>，这就是<strong>graph-as-a-tool（图即工具）</strong> 。</p>
<h2 data-id="heading-5">三、Multi-Agent编排：让多个专家协同工作</h2>
<h3 data-id="heading-6">1. 痛点：为什么单 Agent 会崩溃？</h3>
<p>在之前的章节中，我们习惯通过 System Prompt 让一个 Agent 扮演 <strong>“全能神”</strong> 。但当<strong>需求变得复杂</strong>（例如同时需要 RAG 检索私有信息、联网查找数据、生成代码）时，这种模式会<strong>迅速崩塌</strong>：</p>
<ul>
<li><strong>注意力分散</strong>：Prompt 过长，LLM 经常忽略指令，表现为“幻觉”。</li>
<li><strong>记忆爆炸</strong>：所有任务共用一个 Message History，上下文飞速扩张，不仅烧钱，还容易让模型“记混”信息。</li>
<li><strong>工具混杂</strong>：几十个工具堆在一起，模型极易误调（例如该查文档时去联网）。</li>
<li><strong>脆弱性</strong>：一步错，全盘输。无法针对特定任务（如写代码）单独优化 Prompt。</li>
</ul>
<p><strong>解法：微服务化（Microservices）</strong> 将一个试图全能的单智能体，拆解为多个<strong>专注、自治、可组合</strong>的子智能体，并通过编排协调完成复杂任务。</p>
<ul>
<li>让 <strong>RAG 专家</strong>只负责查私有知识。</li>
<li>让 <strong>Web 搜索员</strong>只负责查公开信息。</li>
<li>让 <strong>代码生成器</strong>只写 Python。</li>
</ul>
<p>而这一切，都需要一个**总控（Supervisor）**来调度。</p>
<h3 data-id="heading-7">2. 初始化：工具配置与核心状态定义</h3>
<p>首先，我们需要定义工具和状态。这里的核心技术点在于<strong>状态（State）的设计</strong>。</p>
<p><strong>代码实现：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 模拟工具</span>
<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">search_internal_docs</span>(<span class="hljs-params">query:<span class="hljs-built_in">str</span></span>):
    <span class="hljs-string">"""搜索公司内部文档获取政策信息"""</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"根据公司手册，年假为15天"</span>

<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">search_web</span>(<span class="hljs-params">query:<span class="hljs-built_in">str</span></span>):
    <span class="hljs-string">"""通过搜索引擎获取最新的公开信息"""</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"据TechCrunch报道，LangGraph 0.6已支持持久化记忆"</span>

<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_code</span>(<span class="hljs-params">requirement:<span class="hljs-built_in">str</span></span>):
    <span class="hljs-string">"""根据需求生成可运行的Python代码"""</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"python\nprint('Hello from Code writer!')"</span>


<span class="hljs-comment"># 共享状态定义</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AgentState</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    messages: Annotated[<span class="hljs-built_in">list</span>,add_messages] <span class="hljs-comment"># 自动累积对话历史</span>
    next_speaker: <span class="hljs-built_in">str</span>
</code></pre>
<h4 data-id="heading-8"><strong>深度解读：为什么不用预置的 MessagesState？</strong></h4>
<p>LangGraph 提供了一个<strong>预置类MessagesState</strong>，但它只有一个 messages 字段。在多智能体编排中，我们需要额外的字段 next_speaker 来存储 Supervisor 的决策结果，因此<strong>必须自定义 TypedDict</strong> 。</p>
<p>关于<strong>Annotated[list, add_messages]</strong> ：</p>
<ul>
<li><strong>Annotated 的作用</strong>：在这里它不仅仅是类型提示，它会被 LangGraph 框架读取。</li>
<li><strong>add_messages 的机制</strong>：它的作用是告诉框架，当节点返回新的 messages 时，不要直接覆盖旧列表，而是<strong>追加（Append）</strong> 。这是实现<strong>自动累积对话历史</strong>的关键。</li>
</ul>
<h3 data-id="heading-9">3. 定义节点：专家与总控</h3>
<p>这一步我们需要明确 <strong>“大脑”</strong> 与 <strong>“手脚”</strong> 的分工。</p>
<p><strong>代码实现：</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 专家节点</span>
def rag_expert(state:AgentState):
    <span class="hljs-attr">prompt</span> = <span class="hljs-string">"你是公司知识库专家，只基于内部文档回答问题。回答应简洁明了，直接给出最终结论。请在回答的最后一行加上：(任务已完成)"</span>
    <span class="hljs-attr">messages</span> = [SystemMessage(content=prompt)]+state[<span class="hljs-string">'messages'</span>]
    <span class="hljs-attr">tools</span> = [search_internal_docs]
    <span class="hljs-attr">response</span> = llm.bind_tools(tools).invoke(messages)
    return {'messages':<span class="hljs-section">[response]</span>}

def web_research(state:AgentState):
    <span class="hljs-attr">prompt</span> = <span class="hljs-string">"你是互联网研究员，擅长用搜索引擎获取最新公开信息。回答应简洁明了，直接给出最终结论。请在回答的最后一行加上：(任务已完成)"</span>
    <span class="hljs-attr">messages</span> = [SystemMessage(content=prompt)]+state[<span class="hljs-string">'messages'</span>]
    <span class="hljs-attr">tools</span> = [search_web]
    <span class="hljs-attr">response</span> = llm.bind_tools(tools).invoke(messages)
    return {'messages':<span class="hljs-section">[response]</span>}

def code_writer(state:AgentState):
    <span class="hljs-attr">prompt</span> = <span class="hljs-string">"你是python工程师，只生成可运行代码，不解释。回答应简洁明了，直接给出最终结论。请在回答的最后一行加上：(任务已完成)"</span>
    <span class="hljs-attr">messages</span> = [SystemMessage(content=prompt)]+state[<span class="hljs-string">'messages'</span>]
    <span class="hljs-attr">tools</span> = [generate_code]
    <span class="hljs-attr">response</span> = llm.bind_tools(tools).invoke(messages)
    return {'messages':<span class="hljs-section">[response]</span>}

<span class="hljs-comment"># 总控节点</span>
def supervisor(state:AgentState):
    <span class="hljs-attr">supervisor_prompt</span> = <span class="hljs-string">"""
        你是一个任务协调员。你的目标是管理专家来解决用户的问题。

        当前对话需要以下专家参与：
        - rag_expert：涉及公司政策、内部流程
        - web_research：涉及外部新闻、公开数据
        - code_writer：需要生成代码

        【决策逻辑】
        1. **检查历史记录**：先看上一个回复是否已经完整回答了用户的初始问题。
        2. **如果已经回答完毕**：必须输出 'FINISH'。
        3. **如果尚未回答或需要补充**：根据当前缺少的步骤，选择下一个最合适的专家。

        请只输出专家名字或 'FINISH'，不要输出任何其他解释。
        """</span>
    <span class="hljs-attr">messages</span> = [SystemMessage(content=supervisor_prompt)]+state[<span class="hljs-string">'messages'</span>]
    <span class="hljs-attr">response</span> = llm.invoke(messages)
    <span class="hljs-attr">next_speaker</span> = response.content.strip()
    return {"next_speaker":next_speaker}
</code></pre>
<p><strong>逻辑要点：</strong></p>
<ul>
<li><strong>专家节点</strong>：遵循 ReAct 模式。必须使用 bind_tools 将工具绑定给 LLM，否则模型无法触发工具调用。我们还在 Prompt 中加入了“任务已完成”的标记，辅助总控判断。</li>
<li><strong>总控节点</strong>：不执行具体任务，只负责 <strong>“看”</strong> 。它的输出直接决定了 next_speaker 的值，从而控制整个图的流向。</li>
</ul>
<h3 data-id="heading-10">4. 构建协作图：核心架构逻辑</h3>
<p>这是本章最复杂的部分。我们需要通过 StateGraph 将节点织成一张网。</p>
<p><strong>代码实现：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 路由函数定义</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">route_supervisor</span>(<span class="hljs-params">state:AgentState</span>):
    <span class="hljs-keyword">if</span> state[<span class="hljs-string">"next_speaker"</span>]==<span class="hljs-string">"FINISH"</span>:
        <span class="hljs-keyword">return</span> END
    <span class="hljs-keyword">return</span> state[<span class="hljs-string">"next_speaker"</span>]

<span class="hljs-keyword">def</span> <span class="hljs-title function_">should_continue</span>(<span class="hljs-params">state:AgentState</span>):
    last_msg = state[<span class="hljs-string">"messages"</span>][-<span class="hljs-number">1</span>]
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(last_msg,<span class="hljs-string">"tool_calls"</span>) <span class="hljs-keyword">and</span> last_msg.tool_calls:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"tools"</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"supervisor"</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">route_after_tool</span>(<span class="hljs-params">state:AgentState</span>):
    <span class="hljs-comment"># 工具执行完后，通过next_speaker知道是谁调用的，路由回去</span>
    <span class="hljs-keyword">return</span> state[<span class="hljs-string">"next_speaker"</span>]


<span class="hljs-comment"># 添加工具节点</span>
tools = [search_internal_docs,search_web,generate_code]
tool_node = ToolNode(tools)


<span class="hljs-comment"># 构建协作图</span>
workflow = StateGraph(AgentState)

<span class="hljs-comment"># 1. 添加节点</span>
workflow.add_node(<span class="hljs-string">"supervisor"</span>,supervisor)
workflow.add_node(<span class="hljs-string">"rag_expert"</span>,rag_expert)
workflow.add_node(<span class="hljs-string">"web_research"</span>,web_research)
workflow.add_node(<span class="hljs-string">"code_writer"</span>,code_writer)
workflow.add_node(<span class="hljs-string">"tools"</span>,tool_node)


<span class="hljs-comment"># 2. 总控回路</span>
workflow.add_edge(START,<span class="hljs-string">"supervisor"</span>)
workflow.add_conditional_edges(<span class="hljs-string">"supervisor"</span>,route_supervisor)

<span class="hljs-comment"># 3. 专家节点的ReAct循环</span>
<span class="hljs-keyword">for</span> member <span class="hljs-keyword">in</span> [<span class="hljs-string">"rag_expert"</span>,<span class="hljs-string">"web_research"</span>,<span class="hljs-string">"code_writer"</span>]: <span class="hljs-comment"># 为每个专家添加条件边：决定是去执行工具还是回总控</span>
    workflow.add_conditional_edges(
        member,
        should_continue,
        {<span class="hljs-string">"tools"</span>:<span class="hljs-string">"tools"</span>,<span class="hljs-string">"supervisor"</span>:<span class="hljs-string">"supervisor"</span>}
    )

<span class="hljs-comment"># 4.工具节点闭环</span>
workflow.add_conditional_edges( <span class="hljs-comment"># 工具执行完，根据next_speaker路由回原来的专家</span>
    <span class="hljs-string">"tools"</span>,
    route_after_tool
)

app = workflow.<span class="hljs-built_in">compile</span>()
</code></pre>
<h4 data-id="heading-11"><strong>技术深挖：理解图构建中的三个关键点</strong></h4>
<p><strong>第一点：条件边的两种写法（动态 vs 静态）</strong></p>
<ul>
<li>
<p><strong>直接返回（动态路由）</strong> ：如 route_supervisor 。<strong>函数直接返回节点名称字符串</strong>。适用于<strong>目标节点不确定</strong>的情况（Supervisor 可能返回任何专家的名字）。</p>
<pre><code class="hljs language-perl" lang="perl">def route_supervisor(<span class="hljs-keyword">state</span>:AgentState):
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">state</span>[<span class="hljs-string">"next_speaker"</span>]==<span class="hljs-string">"FINISH"</span>:
        <span class="hljs-keyword">return</span> END
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">state</span>[<span class="hljs-string">"next_speaker"</span>]

<span class="hljs-comment"># ...</span>

workflow.add_conditional_edges(<span class="hljs-string">"supervisor"</span>,route_supervisor)
</code></pre>
</li>
<li>
<p><strong>字典映射（静态结构）</strong> ：如 should_continue 。虽然函数返回的是 "tools"，但我们在 add_conditional_edges 中<strong>显式定义</strong>了 {"tools": "tools"} 的<strong>映射</strong>。这适用于<strong>结构固定</strong>的场景（三选一或二选一）。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">should_continue</span>(<span class="hljs-params">state:AgentState</span>):
    last_msg = state[<span class="hljs-string">"messages"</span>][-<span class="hljs-number">1</span>]
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(last_msg,<span class="hljs-string">"tool_calls"</span>) <span class="hljs-keyword">and</span> last_msg.tool_calls:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"tools"</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"supervisor"</span>

<span class="hljs-comment"># ...</span>

<span class="hljs-keyword">for</span> member <span class="hljs-keyword">in</span> [<span class="hljs-string">"rag_expert"</span>,<span class="hljs-string">"web_research"</span>,<span class="hljs-string">"code_writer"</span>]: <span class="hljs-comment"># 为每个专家添加条件边：决定是去执行工具还是回总控</span>
    workflow.add_conditional_edges(
        member,
        should_continue,
        {<span class="hljs-string">"tools"</span>:<span class="hljs-string">"tools"</span>,<span class="hljs-string">"supervisor"</span>:<span class="hljs-string">"supervisor"</span>}
    )
</code></pre>
</li>
</ul>
<p><strong>第二点：For 循环的本质（构建时 vs 运行时）</strong> 代码中的 for member in [...] 并不是让程序运行时轮流跑一遍专家。 这是<strong>构建阶段（Build Time）</strong> 的代码。它的作用是 <strong>“批量注册”</strong> ：我们告诉图，这三个专家节点，它们“出门”后的规则是一模一样的（要么去修工具，要么回总控）。这<strong>避免了重复</strong>写三遍相同的 add_conditional_edges 代码。</p>
<p><strong>第三点：add_conditional_edges 的回环特性</strong> 这一行代码相当于给节点安装了一个永久生效的 <strong>“单向任意门”</strong> 。</p>
<ul>
<li>
<p><strong>回环</strong>：一旦定义了 <strong>Expert -&gt; check -&gt; Tools</strong> ，以后无论流程第几次回到 Expert 节点，离开时都会触发这个检查。</p>
</li>
<li>
<p><strong>单向性</strong>：虽然我们在逻辑上实现了 Expert -&gt; check -&gt; Tools  的闭环，但这个闭环是由两条单向边拼凑的：</p>
<ol>
<li>Expert -&gt; Tools（通过 should_continue  定义）</li>
<li>Tools -&gt; Expert（通过 route_after_tool 定义，必须显式写出来，否则程序会卡死在 Tools 节点）。</li>
</ol>
</li>
</ul>
<h3 data-id="heading-12">5. 测试运行</h3>
<p>最后，通过打印日志来验证多智能体的协作流。</p>
<p><strong>代码实现：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 测试运行</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    user_input = <span class="hljs-string">"公司年假多少天"</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"用户提问:"</span>,user_input)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'\n开始多智能体协作...\n'</span>)

    inputs = {<span class="hljs-string">"messages"</span>:[HumanMessage(content=user_input)]}
    <span class="hljs-comment"># app是编译好的图，stream()会让图开始运转，并返回一个生成器</span>
    <span class="hljs-comment"># 图每执行完一个节点，就会产出一个step字典</span>
    <span class="hljs-keyword">for</span> step <span class="hljs-keyword">in</span> app.stream(inputs):
        <span class="hljs-comment"># 因为step是个字典，所以需要拆包拿到 节点名(Node) 与 输出内容(output)</span>
        <span class="hljs-keyword">for</span> node,output <span class="hljs-keyword">in</span> step.items():
            <span class="hljs-comment"># 有工具/专家回复</span>
            <span class="hljs-keyword">if</span> <span class="hljs-string">"messages"</span> <span class="hljs-keyword">in</span> output:
                msg = output[<span class="hljs-string">"messages"</span>][-<span class="hljs-number">1</span>]
                <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(msg,<span class="hljs-string">"tool_calls"</span>) <span class="hljs-keyword">and</span> msg.tool_calls:
                    call = msg.tool_calls[<span class="hljs-number">0</span>]
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"【<span class="hljs-subst">{node}</span>】调用工具 <span class="hljs-subst">{call[<span class="hljs-string">'name'</span>]}</span>(<span class="hljs-subst">{call[<span class="hljs-string">'args'</span>]}</span>)"</span>)
                <span class="hljs-keyword">else</span>:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"【<span class="hljs-subst">{node}</span>】回复：<span class="hljs-subst">{msg.content}</span>"</span>)
            <span class="hljs-comment"># supervisor刚做完决策，确定下个发言人</span>
            <span class="hljs-keyword">elif</span> <span class="hljs-string">"next_speaker"</span> <span class="hljs-keyword">in</span> output:
                speaker = output[<span class="hljs-string">"next_speaker"</span>]
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"【Supervisor】指定下一位发言人：<span class="hljs-subst">{speaker}</span>"</span>)
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e4265a3b4b04e14b4570b348dbbacab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764494889&amp;x-signature=BUH5JAHL6n66jv%2FM06zoSKG3EfI%3D" alt="" loading="lazy"/></p>
<p>通过这段日志，我们可以清晰地观测到系统的<strong>运行脉络</strong>：</p>
<blockquote>
<p>Supervisor 识别意图 -&gt; 指派 RAG 专家 -&gt; RAG 专家发现需要查库 -&gt; 调用 Tool -&gt;</p>
<p>Tool 返回结果  -&gt; RAG 专家生成最终回复 -&gt; Supervisor 确认任务完成 (FINISH)。</p>
</blockquote>
<p>其工作流大致如下图所示：</p>
<pre><code class="hljs language-scss" lang="scss">           (开始)
             |
             v
   +--&gt; <span class="hljs-selector-attr">[ 🧠 总控 Supervisor ]</span> <span class="hljs-built_in">--</span>(完成)--&gt; (( END ))
   |         |
   |         | (<span class="hljs-number">1</span>. 指派)
   |         v
   |    <span class="hljs-selector-attr">[ 👷 专家 (Workers) ]</span> &lt;====&gt; <span class="hljs-selector-attr">[ 🛠️ 工具 (Tools) ]</span>
   |         |        ^         (<span class="hljs-number">2</span>. 干活循环)
   |         |        |
   +---------+--------+
      (<span class="hljs-number">3</span>. 汇报结果)
</code></pre>
<p><strong>总结：三种能力如何组合？</strong></p>

























<table><thead><tr><th>能力</th><th>解决的问题</th><th>典型场景</th></tr></thead><tbody><tr><td><strong>Human-in-the-Loop</strong></td><td>不可逆操作的安全风险</td><td>发邮件、删数据、审批流</td></tr><tr><td><strong>Graph-as-a-Tool</strong></td><td>复杂内部逻辑的维护难题</td><td>带重试的 API 调用、多步验证</td></tr><tr><td><strong>Multi-Agent 编排</strong></td><td>单 Agent 职责爆炸</td><td>会议纪要、故障排查、需求分析</td></tr></tbody></table>
<h2 data-id="heading-13">四、综合实战</h2>
<p>在前三章中，我们分别掌握了 <strong>安全锁、 黑盒工具、 团队管理</strong>。现在，我们不再纸上谈兵，而是将这三者融为一体，构建一个<strong>生产级架构的IT运维智能体</strong>。</p>
<h3 data-id="heading-14">业务场景设定</h3>
<p>我们模拟一个服务器故障排查场景：</p>
<p><strong>总控(Supervisor)</strong> ：负责接收报警，<strong>调度专家</strong>；</p>
<p><strong>日志专家(Log Expert)</strong> ：负责分析服务器日志。它手中的工具 analyze_logs 是一个<strong>子图</strong>，包含SSH连接重试、日志提取等复杂逻辑（模拟网络不稳定的真实环境）。</p>
<p><strong>运维专家(Ops Expert)</strong> ：负责执行修复。它手中的工具 restart_services 是<strong>敏感操作</strong>，必须经过人工审批（Human-in-the-Loop）。</p>
<h3 data-id="heading-15">代码实现</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">from</span> config <span class="hljs-keyword">import</span> OPENAI_API_KEY,LANGCHAIN_API_KEY
<span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI
<span class="hljs-keyword">from</span> langchain.tools <span class="hljs-keyword">import</span> tool
<span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> HumanMessage,SystemMessage
<span class="hljs-keyword">from</span> langgraph.graph <span class="hljs-keyword">import</span> StateGraph,MessagesState,START,END
<span class="hljs-keyword">from</span> langgraph.prebuilt <span class="hljs-keyword">import</span> ToolNode
<span class="hljs-keyword">from</span> langgraph.checkpoint.memory <span class="hljs-keyword">import</span> MemorySaver
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> TypedDict,Annotated
<span class="hljs-keyword">from</span> langgraph.graph.message <span class="hljs-keyword">import</span> add_messages

<span class="hljs-comment"># LangSmith调试</span>
os.environ[<span class="hljs-string">"LANGCHAIN_TRACING_V2"</span>] = <span class="hljs-string">"true"</span> <span class="hljs-comment"># 总开关，决定启用追踪功能</span>
os.environ[<span class="hljs-string">"LANGCHAIN_PROJECT"</span>] = <span class="hljs-string">"supervisor_agent_ops_system"</span> <span class="hljs-comment"># 自定义项目名</span>
os.environ[<span class="hljs-string">"LANGCHAIN_API_KEY"</span>] = LANGCHAIN_API_KEY

llm = ChatOpenAI(
    model=<span class="hljs-string">"deepseek-chat"</span>,
    api_key=OPENAI_API_KEY,
    base_url=<span class="hljs-string">"https://api.deepseek.com"</span>
)

<span class="hljs-comment"># === 一、Graph-as-a-Tool ===</span>
<span class="hljs-comment"># === 模拟一个不稳定的SSH日志查询过程 ===</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SSHState</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    target_ip: <span class="hljs-built_in">str</span>
    attempt: <span class="hljs-built_in">int</span>
    logs: <span class="hljs-built_in">str</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">connect_ssh</span>(<span class="hljs-params">state:SSHState</span>):
    <span class="hljs-string">"""模拟SSH连接，第一次连接必定超时"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f'    [子图]正在尝试连接服务器<span class="hljs-subst">{state[<span class="hljs-string">"target_ip"</span>]}</span>(第<span class="hljs-subst">{state[<span class="hljs-string">"attempt"</span>]}</span>次)'</span>)
    <span class="hljs-keyword">if</span> state[<span class="hljs-string">'attempt'</span>] == <span class="hljs-number">1</span>:
        <span class="hljs-keyword">return</span> {<span class="hljs-string">'logs'</span>:<span class="hljs-string">'ERROR:Connection Timed Out'</span>,<span class="hljs-string">'attempt'</span>:state[<span class="hljs-string">'attempt'</span>]+<span class="hljs-number">1</span>}
    <span class="hljs-keyword">return</span> {<span class="hljs-string">'logs'</span>:<span class="hljs-string">'CONNECTED'</span>,<span class="hljs-string">'attempt'</span>:state[<span class="hljs-string">'attempt'</span>]+<span class="hljs-number">1</span>}

<span class="hljs-keyword">def</span> <span class="hljs-title function_">grep_system_logs</span>(<span class="hljs-params">state:SSHState</span>):
    <span class="hljs-string">"""连接成功后读取日志"""</span>
    <span class="hljs-keyword">if</span> state[<span class="hljs-string">"logs"</span>] == <span class="hljs-string">"CONNECTED"</span>:
        <span class="hljs-comment"># 打印查到的结果</span>
        <span class="hljs-keyword">return</span> {<span class="hljs-string">'logs'</span>:<span class="hljs-string">f'SUCCESS: Retrieved logs from <span class="hljs-subst">{state[<span class="hljs-string">'target_ip'</span>]}</span>:[ERROR: OutOfMemory at line 4032]'</span>}
    <span class="hljs-keyword">return</span> {<span class="hljs-string">'logs'</span>:state[<span class="hljs-string">'logs'</span>]} <span class="hljs-comment"># 保持错误状态</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">ssh_routing</span>(<span class="hljs-params">state:SSHState</span>):
    <span class="hljs-string">"""路由逻辑：如果连接失败且尝试次数少于3，重试"""</span>
    <span class="hljs-keyword">if</span> <span class="hljs-string">"ERROR"</span> <span class="hljs-keyword">in</span> state[<span class="hljs-string">'logs'</span>] <span class="hljs-keyword">and</span> state[<span class="hljs-string">"attempt"</span>] &lt;= <span class="hljs-number">2</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"connect"</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"grep"</span>

<span class="hljs-comment"># 构建子图</span>
ssh_workflow = StateGraph(SSHState)
ssh_workflow.add_node(<span class="hljs-string">"connect"</span>,connect_ssh)
ssh_workflow.add_node(<span class="hljs-string">"grep"</span>,grep_system_logs)

ssh_workflow.add_edge(START,<span class="hljs-string">"connect"</span>)
ssh_workflow.add_conditional_edges(<span class="hljs-string">"connect"</span>,ssh_routing,{<span class="hljs-string">"connect"</span>:<span class="hljs-string">"connect"</span>,<span class="hljs-string">"grep"</span>:<span class="hljs-string">"grep"</span>})
ssh_workflow.add_edge(<span class="hljs-string">"grep"</span>,END)

ssh_app = ssh_workflow.<span class="hljs-built_in">compile</span>()

<span class="hljs-comment"># 将子图封装为工具</span>
<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_server_logs</span>(<span class="hljs-params">ip_address:<span class="hljs-built_in">str</span></span>):
    <span class="hljs-string">"""使用SSH连接服务器并分析最近的错误日志（内含自动重连机制）"""</span>
    result = ssh_app.invoke({<span class="hljs-string">"target_ip"</span>:ip_address,<span class="hljs-string">"attempt"</span>:<span class="hljs-number">1</span>,<span class="hljs-string">"log"</span>:<span class="hljs-string">""</span>})
    <span class="hljs-keyword">return</span> result[<span class="hljs-string">'logs'</span>]



<span class="hljs-comment"># === 二、Human-in-the-Loop ===</span>
<span class="hljs-comment"># === 重启服务，高危操作，需要审批 ===</span>

<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">restart_service</span>(<span class="hljs-params">service_name:<span class="hljs-built_in">str</span></span>):
    <span class="hljs-string">"""重启指定的服务器服务"""</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"服务[<span class="hljs-subst">{service_name}</span>]已成功重启，系统负载已恢复正常"</span>



<span class="hljs-comment"># === 三、Multi-Agent 编排 ===</span>
<span class="hljs-comment"># === 总控调度 + 专家分工 ===</span>

<span class="hljs-comment"># 1. 共享状态</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AgentState</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    messages:Annotated[<span class="hljs-built_in">list</span>,add_messages]
    next_speaker:<span class="hljs-built_in">str</span>

<span class="hljs-comment"># 2. 专家节点</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">log_expert</span>(<span class="hljs-params">state:AgentState</span>):
    prompt = <span class="hljs-string">"你是日志分析专家，使用工具分析服务器日志，找出报错原因。回答需简洁。"</span>
    messages = [SystemMessage(content=prompt)] + state[<span class="hljs-string">'messages'</span>]
    <span class="hljs-comment"># 绑定子图工具</span>
    tools = [analyze_server_logs]
    response = llm.bind_tools(tools).invoke(messages)
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"messages"</span>:[response]}

<span class="hljs-keyword">def</span> <span class="hljs-title function_">ops_expert</span>(<span class="hljs-params">state:AgentState</span>):
    prompt = <span class="hljs-string">"你是运维专家。当收到修复指令时，请立即调用 'restart_service' 工具进行修复，不要输出任何额外的解释文本。"</span>
    messages = [SystemMessage(content=prompt)] + state[<span class="hljs-string">'messages'</span>]
    tools = [restart_service]
    <span class="hljs-comment"># 绑定敏感工具</span>
    response = llm.bind_tools(tools).invoke(messages)
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"messages"</span>:[response]}

<span class="hljs-comment"># 3. 总控节点（supervisor）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">supervisor</span>(<span class="hljs-params">state:AgentState</span>):
    prompt = <span class="hljs-string">"""
    你是 IT 运维总指挥。
    专家列表：
    - log_expert
    - ops_expert

    决策逻辑：
    1. 未知原因 -&gt; log_expert
    2. 已知原因（如OOM、报错） -&gt; ops_expert
    3. 修复完成 -&gt; FINISH

    【输出约束】
    仅输出下一个专家的名字（如 log_expert），不要包含任何其他字符或标点。
    """</span>
    messages = [SystemMessage(content=prompt)] + state[<span class="hljs-string">'messages'</span>]
    response = llm.invoke(messages)
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"next_speaker"</span>:response.content.strip()}

<span class="hljs-comment"># 4. 路由逻辑</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">route_supervisor</span>(<span class="hljs-params">state:AgentState</span>):
    <span class="hljs-keyword">if</span> state[<span class="hljs-string">'next_speaker'</span>] == <span class="hljs-string">"FINISH"</span>:
        <span class="hljs-keyword">return</span> END
    <span class="hljs-keyword">return</span> state[<span class="hljs-string">'next_speaker'</span>]

<span class="hljs-keyword">def</span> <span class="hljs-title function_">should_continue</span>(<span class="hljs-params">state:AgentState</span>):
    last_msg = state[<span class="hljs-string">'messages'</span>][-<span class="hljs-number">1</span>]
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(last_msg,<span class="hljs-string">"tool_calls"</span>) <span class="hljs-keyword">and</span> last_msg.tool_calls:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"tools"</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"supervisor"</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">route_after_tool</span>(<span class="hljs-params">state:AgentState</span>):
    <span class="hljs-keyword">return</span> state[<span class="hljs-string">"next_speaker"</span>]


<span class="hljs-comment"># === 四、构建主图与集成 ===</span>

<span class="hljs-comment"># 工具集合</span>
all_tools = [analyze_server_logs,restart_service]
tool_node = ToolNode(all_tools)

<span class="hljs-comment"># 构建主图</span>
workflow = StateGraph(AgentState)

workflow.add_node(<span class="hljs-string">"supervisor"</span>,supervisor)
workflow.add_node(<span class="hljs-string">"log_expert"</span>,log_expert)
workflow.add_node(<span class="hljs-string">"ops_expert"</span>,ops_expert)
workflow.add_node(<span class="hljs-string">"tools"</span>,tool_node)

workflow.add_edge(START,<span class="hljs-string">"supervisor"</span>)
workflow.add_conditional_edges(<span class="hljs-string">"supervisor"</span>,route_supervisor)
<span class="hljs-keyword">for</span> member <span class="hljs-keyword">in</span> [<span class="hljs-string">"log_expert"</span>,<span class="hljs-string">"ops_expert"</span>]:
    workflow.add_conditional_edges(
        member,
        should_continue,
        {<span class="hljs-string">"tools"</span>:<span class="hljs-string">"tools"</span>,<span class="hljs-string">"supervisor"</span>:<span class="hljs-string">"supervisor"</span>}
    )
workflow.add_conditional_edges(<span class="hljs-string">"tools"</span>,route_after_tool)

<span class="hljs-comment"># 编译图:加入记忆与中断机制(Human-in-the-Loop)</span>
<span class="hljs-comment"># 注: 我们在所有工具执行前都暂停，但在运行时进行逻辑判断</span>
app = workflow.<span class="hljs-built_in">compile</span>(
    checkpointer=MemorySaver(),
    interrupt_before=[<span class="hljs-string">"tools"</span>]
)

<span class="hljs-comment"># === 五、运行时逻辑(模拟生产环境的交互) ===</span>

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    <span class="hljs-comment"># 模拟一次完整的故障处理流程</span>
    user_input = <span class="hljs-string">"服务器 192.168.1.100 报警，响应极慢，请处理。"</span>
    config = {
        <span class="hljs-string">"configurable"</span>: {<span class="hljs-string">"thread_id"</span>: <span class="hljs-string">"incident_001"</span>}
    }

    <span class="hljs-built_in">print</span>(<span class="hljs-string">f'收到报警 : <span class="hljs-subst">{user_input}</span>'</span>)
    inputs = {<span class="hljs-string">"messages"</span>:[HumanMessage(content=user_input)]}

    <span class="hljs-comment"># 循环执行，直到任务结束</span>
    <span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:
        <span class="hljs-comment"># 1. 执行图直到中断或结束</span>
        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> app.stream(inputs,config,stream_mode=<span class="hljs-string">"values"</span>):
            <span class="hljs-keyword">pass</span>

        <span class="hljs-comment"># 2. 检查当前状态</span>
        snapshot = app.get_state(config)
        next_tasks = snapshot.<span class="hljs-built_in">next</span>

        <span class="hljs-comment"># 没有下一步，任务结束</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> next_tasks:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"    最终报告:<span class="hljs-subst">{snapshot.values[<span class="hljs-string">'messages'</span>][-<span class="hljs-number">1</span>].content}</span>"</span>)
            <span class="hljs-keyword">break</span>

        <span class="hljs-comment"># 3. 处理中断:判断是哪个工具被调用</span>
        <span class="hljs-keyword">if</span> <span class="hljs-string">"tools"</span> <span class="hljs-keyword">in</span> next_tasks:
            last_msg = snapshot.values[<span class="hljs-string">'messages'</span>][-<span class="hljs-number">1</span>]
            tool_call = last_msg.tool_calls[<span class="hljs-number">0</span>]
            tool_name = tool_call[<span class="hljs-string">"name"</span>]

            <span class="hljs-built_in">print</span>(<span class="hljs-string">f'\n[系统暂停] 请求调用工具:<span class="hljs-subst">{tool_name}</span>'</span>)

            <span class="hljs-comment"># 策略A: 自动放行安全工具(Graph-as-a-Tool)</span>
            <span class="hljs-keyword">if</span> tool_name == <span class="hljs-string">"analyze_server_logs"</span>:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">'     -&gt; 这是一个查询类工具，系统自行批准。'</span>)
                inputs = <span class="hljs-literal">None</span> <span class="hljs-comment"># 继续执行</span>
                <span class="hljs-keyword">continue</span>

            <span class="hljs-comment"># 策略B: 拦截高危工具(Human-in-the-Loop)</span>
            <span class="hljs-keyword">elif</span> tool_name == <span class="hljs-string">"restart_service"</span>:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"     -&gt; ⚠️ 警告: 这是一个高危操作!"</span>)
                user_approval = <span class="hljs-built_in">input</span>(<span class="hljs-string">"     -&gt; 请人工审批 (输入 'yes' 允许重启):"</span>)

                <span class="hljs-keyword">if</span> user_approval == <span class="hljs-string">"yes"</span>:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">'    -&gt; ✅ 审批通过，正在执行...'</span>)
                    inputs = <span class="hljs-literal">None</span> <span class="hljs-comment"># 继续执行</span>
                <span class="hljs-keyword">else</span>:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">'    -&gt; ❌️ 审批拒绝，任务终止!'</span>)
                    <span class="hljs-comment"># 实际系统中，应通过 ToolMessage 反馈人工拒绝，使 LLM 能继续响应；</span>
                    <span class="hljs-comment"># 当前demo为简化，直接退出</span>
                    <span class="hljs-keyword">break</span>
</code></pre>
<h3 data-id="heading-16">运行效果</h3>
<p>当你运行这段代码时，你会看到一个非常精彩的<strong>交互过程</strong>：</p>
<ol>
<li>
<p>总控调度：Supervisor收到报警，首先指派log_expert。</p>
</li>
<li>
<p>子图自动重试:</p>
</li>
</ol>
<ul>
<li>log_expert 调用 analyze_server_logs；</li>
<li>系统识别这是安全工具，自动批准；</li>
<li>控制台打印出子图内部逻辑：第一次连接超时 -&gt; 自动重试 -&gt; 连接成功 -&gt; 获取到 OutOfMemory 错误</li>
</ul>
<ol start="3">
<li>二次调度：</li>
</ol>
<ul>
<li>log_expert 汇报：“发现了 OOM 错误”</li>
<li>Supervisor 决策：“这是内存溢出，需要重启，指派ops_expert。”</li>
</ul>
<ol start="4">
<li>人工拦截</li>
</ol>
<ul>
<li>ops_expert 试图调用 restart_services。</li>
<li>系统识别这是高危工具，强制暂停。</li>
<li>控制台提示：⚠️ 警告: 这是一个高危操作!</li>
</ul>
<ol start="5">
<li>最终修复：</li>
</ol>
<ul>
<li>输入yes</li>
<li>服务重启成功，Supervisor 输出 FINISH。</li>
</ul>
<h2 data-id="heading-17"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/444f8dac2f934354a28c1c7b63285d48~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764494889&amp;x-signature=tgqknT2Ww6bEix33D0ErM14qbRA%3D" alt="" loading="lazy"/></h2>
<p>通过LangSmith看一下详细输出：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/190f5e36d0164a9b985b2bee19d62887~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YaN5Lya5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764494889&amp;x-signature=06KJQL%2BryeOHhTnhNuROf7HPXfU%3D" alt="" loading="lazy"/>流程运行完美。</p>
<h2 data-id="heading-18">总结、</h2>
<p><strong>知识点概括</strong>：<strong>Human-in-the-Loop（人工干预）｜ Graph-as-a-Tool（图即工具）| Multi-Agent 多智能体编排</strong></p>
<p>通过这个实战案例，我们证明了 LangGraph 不仅仅是一个简单的 DAG （有向无环图——有方向但不能形成循环），它是一套<strong>构筑复杂系统的骨架</strong>。</p>
<p><strong>Graph-as-a-Tool：</strong> 让我们能把脏活累活藏起来，主流程保持干净。</p>
<p><strong>Human-in-the-Loop：</strong> 让我们敢于把Agent放入生产环境，让人工确认作为最终防线。</p>
<p><strong>Multi-Agent：</strong> 让系统具备了可扩展性，加功能只是加个专家节点而已。</p>
<p>三者结合，即可构建企业级可信 Agent 系统。</p>
<hr/>
<p>预告：<strong>10 篇 《 MCP 基础篇》</strong></p>
<p>09 篇的所有专家都运行在同一Python进程中。但如果：</p>
<ul>
<li>RAG 服务部署在公司内网？</li>
<li>代码生成器是 Java 写的 REST API？</li>
<li>你想直接调用高德地图、12306的官方服务？</li>
</ul>
<p>10篇，我们将引入MCP <strong>（Model Context Protocol）协议，</strong></p>
<p><strong>让任何符合标准的远程服务，都能成为你的工具——无需写一行@tool！</strong></p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python 开发环境与包管理]]></title>    <link>https://juejin.cn/post/7575119254313992218</link>    <guid>https://juejin.cn/post/7575119254313992218</guid>    <pubDate>2025-11-23T10:08:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575119254313992218" data-draft-id="7575133880436457523" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python 开发环境与包管理"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-11-23T10:08:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="cadecode"/> <meta itemprop="url" content="https://juejin.cn/user/562546315637662"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python 开发环境与包管理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/562546315637662/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    cadecode
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T10:08:55.000Z" title="Sun Nov 23 2025 10:08:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Python 的安装</h2>
<h3 data-id="heading-1">Windows</h3>
<p>下载安装包，推荐使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fmirrors.tuna.tsinghua.edu.cn%2Fpython%2F3.13.9%2F" target="_blank" title="https://mirrors.tuna.tsinghua.edu.cn/python/3.13.9/" ref="nofollow noopener noreferrer">清华开源软件镜像站</a>下载</p>
<p>​<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e87bcf93c07f4f4eb7bf7a97026c467f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2FkZWNvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764497335&amp;x-signature=4ZNvqdXEE1mgLhwMqL0y9rnFfZA%3D" alt="image" loading="lazy"/>​</p>
<p>以 python-3.13.9-amd64.exe 为例，Python 版本 3.13.9</p>
<p>安装 tips：</p>
<ul>
<li>勾选最下面 “Add Python 3.x to PATH” 将 Python 配置到环境变量（用户机环境变量）</li>
</ul>

<ul>
<li>然点 “Customize installation”，建议全勾</li>
<li>安装路径选择自己日常存放开发环境 SDK 的目录</li>
</ul>
<p>配置环境变量：</p>
<p>当安装时没有勾选 Add to PATH，则需要将安装目录、安装目录下的 Scripts 目录配置到环境变量。</p>
<p>使用命令检查是否安装成功：</p>
<pre><code class="hljs">python -V
pip -V
</code></pre>
<p>​<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad39b12cb44d4a0ebbfc15526d9dae27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2FkZWNvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764497335&amp;x-signature=8WAh7UK%2FkjsdQa1U6Y%2FEIORmsvw%3D" alt="image" loading="lazy"/>​</p>
<p>配置 pip 国内镜像：</p>
<pre><code class="hljs language-arduino" lang="arduino">pip config set global.index-url https:<span class="hljs-comment">//pypi.tuna.tsinghua.edu.cn/simple</span>
pip config set global.trusted-host pypi.tuna.tsinghua.edu.cn
pip config list
</code></pre>
<p>​<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6b2f3dbd8394741b25e0090dd65fbf3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2FkZWNvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764497335&amp;x-signature=maV93clw%2FT7sWK%2BCiOjcRvnWH3w%3D" alt="image" loading="lazy"/>​</p>
<h3 data-id="heading-2">Linux</h3>
<p>以 Debian 为例：</p>
<pre><code class="hljs language-bash" lang="bash">sudo apt update
<span class="hljs-comment"># 直接装官方仓库版（可能不是最新）</span>
sudo apt install python3 python3-pip python3-venv
</code></pre>
<p>注意事项：在早前版本的 Ubuntu/Debian 中，禁止使用 sudo pip install​ 而没有禁止用户级的 install（通常安装到 ~/.local/lib/python3.x/site-packages 目录）。</p>
<p>从 Ubuntu 23.04（及 Debian 12）开始强制执执行 PEP 668 保护机制，禁止用户使用系统级 Python 执行 pip install​ 操作，建议通过虚拟环境隔离安装。</p>
<h2 data-id="heading-3">虚拟环境</h2>
<h3 data-id="heading-4">虚拟环境是什么</h3>
<p>在众多编程语言，依赖隔离是一个老生常谈的问题。拿 Java 来说，Java 默认使用本地的全局仓库，需要在项目中使用 maven / gradle 构建工具声明好需要的依赖版本。相比之下，NodeJs 是天生的项目级隔离，除非强行指定全局安装，否则所有依赖都被安装到当前项目的 node_modules​ 目录下，当种处理方式会导致一份依赖在不同项目占用多份空间，因此也催生了一些包管理工具，如 PNPM，利用 全局缓存 + 硬链接​ 实现节约磁盘和避免重复下载的目的。</p>
<p>Python 官方默认提供了虚拟环境工具 venv，在不同场景一些社区也有其他的解决方案，如 conda 等，在纯 Python 开发</p>
<h3 data-id="heading-5">为什么需要虚拟环境</h3>
<p>在一个环境中，一个依赖的安装不同版本，后者会覆盖前者，只会存在一个版本，这会导致一个环境下的多个项目依赖的版本不同而导致冲突，所以需要进行依赖环境的隔离。</p>
<p>其次，一些操作系统默认自带了 Python 环境，且禁止了用户在全局环境中安装包，防止破坏操作系统稳定性，因此必须创建虚拟环境来使用</p>
<h3 data-id="heading-6">使用 venv</h3>
<p>Python 3.3+ 内置了 venv，创建虚拟环境的命令：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建</span>
python -m venv .venv

<span class="hljs-comment"># 激活（Linux/macOS）</span>
<span class="hljs-built_in">source</span> .venv/bin/activate
<span class="hljs-comment"># Windows</span>
.venv\Scripts\activate

<span class="hljs-comment"># 验证</span>
<span class="hljs-built_in">which</span> python  <span class="hljs-comment"># 指向 .venv/bin/python</span>
pip list      <span class="hljs-comment"># 只有 2 个包：pip setuptools</span>

<span class="hljs-comment"># 退出</span>
deactivate
</code></pre>
<p>在当前项目的 .venv 目录下，使用 Scripts​ 目录下的 activate 脚本激活当前虚拟环境，后续使用 pip​ 安装依赖，都将存放到 Lib/site-packages​ 目录，推荐使用 python -m pip​ 来执行 pip 命令，这样指定 Python 解释器可以防止由于环境变量优先级问题而导致使用其他环境的 pip。</p>
<h2 data-id="heading-7">包管理</h2>
<h3 data-id="heading-8">pip</h3>
<p>Python 自带的 pip 包管理工具，常用命令如下：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 安装</span>
pip install <span class="hljs-attr">requests</span>==<span class="hljs-number">2.31</span>.<span class="hljs-number">0</span>

<span class="hljs-comment"># 升级</span>
pip install -U requests

<span class="hljs-comment"># 卸载</span>
pip uninstall requests -y

<span class="hljs-comment"># 查看</span>
pip show requests
</code></pre>
<p>pip 复现依赖的方法：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 生成</span>
pip freeze &gt; requirements.txt

<span class="hljs-comment"># 恢复</span>
pip install -r requirements.txt
</code></pre>
<p>pip freeze 会列出有已安装的依赖及版本</p>
<p>​<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3c91ab7723f4df284baf3d09ae2ad0f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2FkZWNvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764497335&amp;x-signature=C8UVlJaaWv04gMm6kgGUO0Q0pUg%3D" alt="image" loading="lazy"/>​</p>
<p>可以看到安装 requests 库，同时自动安装了它依赖的其他库，所以通过导出的 requirements.txt​ 文件，可以快速复现一个项目的开发场景。</p>
<p>问题是当我们不在需要 requests 库时，执行 pip uninstall requests​ 卸载 requests 库后，发现由它而引入的其他库并没有被移除，也就说 pip 无法正确处理直接依赖和间接依赖。</p>
<p>对于那些由于成为孤儿的间接依赖，官方给出的解决方案是使用 pyproject.toml​。</p>
<p>​pyproject.toml​ 是官方推出的 Python 项目配置表，用于统一各大工具的配置文件，目前很多工具都已经陆续支持。</p>
<p>在 toml 中维护只需要维护好直接依赖版本</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[project]</span>
<span class="hljs-attr">name</span> = <span class="hljs-string">"learn-python"</span>
<span class="hljs-attr">version</span> = <span class="hljs-string">"0.1.0"</span>
<span class="hljs-attr">description</span> = <span class="hljs-string">"Add your description here"</span>
<span class="hljs-attr">readme</span> = <span class="hljs-string">"README.md"</span>
<span class="hljs-attr">requires-python</span> = <span class="hljs-string">"&gt;=3.13"</span>
<span class="hljs-attr">dependencies</span> = [
    <span class="hljs-string">"requests&gt;=2.32.5"</span>,
]
</code></pre>
<p>pip 23+ 支持从 pyproject.toml​ 安装依赖</p>
<pre><code class="hljs language-bash" lang="bash">pip install .
<span class="hljs-comment"># 或</span>
pip install -e . 
</code></pre>
<blockquote>
<p>需要注意的是 pip install .​ 会执行构建 + 安装​ 两个过程，会把本地代码直接打进 site-packages 目录，对于频繁修改的本地文件来说多有不便。</p>
<p>推荐使用 pip install -e .​ 来安装依赖，会在 site-packages 目录中链接文件，指向本地代码，从而编辑修改能及时生效</p>
</blockquote>
<h3 data-id="heading-9">uv</h3>
<p>pip 命令能从 pyproject.toml​ 中读取依赖，但目前不能方便的将依赖配置到 toml 中，推荐使用更加强大的 uv 命令。</p>
<p>uv 是一个用 Rust 编写的极速 Python 包和项目管理工具。</p>
<p>uv 的安装：</p>
<p>方法 1：官方安装脚本</p>
<pre><code class="hljs language-arduino" lang="arduino">curl -LsSf https:<span class="hljs-comment">//astral.sh/uv/install.sh | sh</span>
</code></pre>
<p>方法 2：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fastral-sh%2Fuv%2Freleases" target="_blank" title="https://github.com/astral-sh/uv/releases" ref="nofollow noopener noreferrer">Github Releases</a> 下载安装文件</p>
<p>方法 3：直接使用 pip 安装</p>
<pre><code class="hljs">pip install uv
</code></pre>
<p>常用命令：</p>
<p>虚拟环境操作：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 新建虚拟环境（默认目录 .venv）</span>
uv venv

<span class="hljs-comment"># 指定 Python 版本（自动下载若本地没有）</span>
uv venv --python 3.11
uv venv py38 -p 3.8        <span class="hljs-comment"># 自定义目录名</span>
</code></pre>
<p>依赖管理：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 初始化项目</span>
uv <span class="hljs-keyword">init</span> myproj

<span class="hljs-meta"># 安装全部依赖并生成/更新锁文件</span>
uv sync

<span class="hljs-meta"># 仅更新锁文件（不实际装包，适合 CI 校验）</span>
uv <span class="hljs-keyword">lock</span>

<span class="hljs-meta"># 升级单个包并重新锁定</span>
<span class="hljs-meta"># 锁文件会更新为最新兼容版本，其余包保持不动。</span>
uv <span class="hljs-keyword">lock</span> --upgrade-package pandas

<span class="hljs-meta"># 添加运行时依赖</span>
<span class="hljs-meta"># 自动向 pyproject.toml 的 [project]dependencies 写入版本区间</span>
uv <span class="hljs-keyword">add</span> requests&gt;=<span class="hljs-number">2.31</span>

<span class="hljs-meta"># 添加开发依赖</span>
<span class="hljs-meta"># 在 pyproject.toml 新增 [dependency-groups] dev = ["pytest"]</span>
uv <span class="hljs-keyword">add</span> --<span class="hljs-keyword">group</span> dev pytest

<span class="hljs-meta"># 移除依赖</span>
uv <span class="hljs-keyword">remove</span> requests

<span class="hljs-meta"># 从旧 requirements.txt 批量导入</span>
uv <span class="hljs-keyword">add</span> -r requirements.txt
</code></pre>
<p>运行脚本：</p>
<pre><code class="hljs language-css" lang="css"># 直接执行 py 文件
uv run <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.py</span>
# 指定解释器
uv run python <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.py</span>
# 指定解释器版本，不存在将下载
uv run <span class="hljs-attr">--python</span> <span class="hljs-number">3.12</span> <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.py</span>
</code></pre>
<p>兼容 pip 命令(90%+)：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 把 pip 直接换成 uv pip，速度提升 10+ 倍</span>
uv pip install requests
uv pip install -r requirements.txt
uv pip uninstall requests
</code></pre>
<h3 data-id="heading-10">还原依赖环境</h3>
<p>当参与一个已存在的 Python 项目，如何快速还原开发环境？</p>
<p>场景 1：当项目使用 pyproject toml 文件来管理</p>
<ul>
<li>使用 uv，直接 uv sync​</li>
</ul>

<ul>
<li>使用 pip，使用 pip install .​</li>
</ul>
<p>场景 2：当项目使用 requirements.txt 管理</p>
<ul>
<li>​pip install -r​ 或 uv pip install -r​ 直接安装依赖</li>
<li>​uv add -r​ 可以将 requirements 内容配置到 pyproject toml</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[清理 Git 代码库大文件历史记录]]></title>    <link>https://juejin.cn/post/7575425466904870975</link>    <guid>https://juejin.cn/post/7575425466904870975</guid>    <pubDate>2025-11-23T10:01:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575425466904870975" data-draft-id="7575442779038973994" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="清理 Git 代码库大文件历史记录"/> <meta itemprop="keywords" content="Git,运维"/> <meta itemprop="datePublished" content="2025-11-23T10:01:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="hen3y"/> <meta itemprop="url" content="https://juejin.cn/user/1425416494263021"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            清理 Git 代码库大文件历史记录
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1425416494263021/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    hen3y
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T10:01:18.000Z" title="Sun Nov 23 2025 10:01:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;color:rgba(46,36,36,.87);overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{margin-bottom:5px;font-size:30px;font-weight:500}.markdown-body h1:before{content:"#";margin-right:10px;color:#1976d2}.markdown-body h2{font-size:28px;font-weight:400;border-left:5px solid #454545;margin-top:20px;padding-left:10px;transition:all .3s ease-in-out}.markdown-body h2:hover{border-color:#1976d2}.markdown-body h3{font-size:24px;font-weight:400;margin-top:15px;padding-bottom:0}.markdown-body h4{font-size:20px;font-weight:500}.markdown-body h5{font-size:16px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h2:first-letter,.markdown-body h3:first-letter,.markdown-body p:first-letter{text-transform:capitalize}.markdown-body em{text-emphasis:dot;text-emphasis-position:under}.markdown-body img{display:block;margin:0 auto!important;max-width:100%;border-radius:2px;box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12)!important}.markdown-body hr{position:relative;width:98%;height:1px;border:none;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,#ddd,#999,#ddd);overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background:#fff;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center}.markdown-body code{font-weight:900;word-break:break-word;border-radius:2px;overflow-x:auto;font-size:.87em;padding:.065em .4em;background-color:#fbe5e1;color:#c0341d}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border-radius:0 4px}.markdown-body pre&gt;code{font-weight:400;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{margin:0 4px;text-decoration:none;color:#027fff;transition:all .3s ease-in-out;padding-bottom:4px;border-bottom:2px solid transparent}.markdown-body a:after{content:"";display:inline-block;width:18px;height:18px;margin-left:4px;vertical-align:middle;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiBzdHJva2U9IiMwMjdGRkYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+PHBhdGggZD0iTTkuODE1IDYuNDQ4bDEuOTM2LTEuOTM2YzEuMzM3LTEuMzM2IDMuNTgtMS4yNTkgNS4wMTMuMTczIDEuNDMyIDEuNDMyIDEuNTEgMy42NzYuMTczIDUuMDEzbC0xLjQ1MiAxLjQ1Mi0uOTY4Ljk2OGMtMS4zMzcgMS4zMzYtMy41ODEgMS4yNTktNS4wMTMtLjE3MyIvPjxwYXRoIGQ9Ik0xMS4yNjcgMTUuMzY3bC0xLjkzNiAxLjkzNmMtMS4zMzYgMS4zMzctMy41OCAxLjI2LTUuMDEyLS4xNzMtMS40MzItMS40MzItMS41MS0zLjY3Ni0uMTczLTUuMDEybDEuNDUyLTEuNDUyLjk2OC0uOTY4YzEuMzM2LTEuMzM3IDMuNTgtMS4yNiA1LjAxMi4xNzMiLz48L2c+PC9zdmc+);background-size:cover;background-repeat:no-repeat}.markdown-body a:hover{border-color:#027fff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body a.footnote-backref:after,.markdown-body a.footnote-ref:after,.markdown-body sup a:after{display:none!important}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border:2px solid #c6c6c6}.markdown-body table img{box-shadow:none!important}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body del{color:rgba(0,0,0,.6)}.markdown-body blockquote{position:relative;color:#666;padding:5px 23px 1px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:hsla(0,0%,78.4%,.12);transition:all .2s ease-in-out}.markdown-body blockquote:hover{border-color:#1976d2}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;font-size:24px;font-weight:800;line-height:24px;color:#cbcbcb;opacity:.6}.markdown-body blockquote:before{content:"“";top:4px;left:6px}.markdown-body blockquote:after{content:"”";right:8px;bottom:-8px}.markdown-body blockquote&gt;p,.markdown-body blockquote blockquote{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body details{outline:none;border:none;border-left:4px solid #1976d2;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary:hover::-webkit-details-marker{color:#1976d2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="obsidian">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#282b2e}.hljs-keyword,.hljs-literal,.hljs-selector-id,.hljs-selector-tag{color:#93c763}.hljs-number{color:#ffcd22}.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#e0e2e4}.hljs-attribute{color:#668bb0}.hljs-class .hljs-title,.hljs-code,.hljs-section{color:#fff}.hljs-link,.hljs-regexp{color:#d39745}.hljs-meta{color:#557182}.hljs-addition,.hljs-built_in,.hljs-bullet,.hljs-emphasis,.hljs-name,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-subst,.hljs-tag,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable{color:#8cbbad}.hljs-string,.hljs-symbol{color:#ec7600}.hljs-comment,.hljs-deletion,.hljs-quote{color:#818e96}.hljs-selector-class{color:#a082bd}.hljs-doctag,.hljs-keyword,.hljs-literal,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-strong,.hljs-title,.hljs-type{font-weight:700}</style><h2 data-id="heading-0">清理 Git 代码库大文件历史记录</h2>
<p>在日常开发中，我们可能会不小心将一些大文件（如二进制文件、大型资源文件等）提交到 Git 仓库中。即使后来删除了这些文件，它们依然存在于 Git 的历史记录中，导致 <code>.git</code> 目录变得非常庞大，严重影响 <code>git clone</code> 和 <code>git pull</code> 的速度。</p>
<p>本文将介绍如何分析 Git 仓库的占用情况，并使用工具清理历史记录中的大文件。</p>
<h3 data-id="heading-1">问题分析</h3>
<p>Git 仓库体积过大的主要原因通常是 <code>.git/objects/pack/*.pack</code> 文件过大。Git 将文件历史记录存储在本地的 "database" 中，如果历史记录中包含了大量的二进制文件变动，pack 文件就会迅速膨胀。</p>
<blockquote>
<p>[!info] Git Internals - Packfiles
Git 使用 packfile 来优化存储。详情可参考：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgit-scm.com%2Fbook%2Fen%2Fv2%2FGit-Internals-Packfiles" target="_blank" title="https://git-scm.com/book/en/v2/Git-Internals-Packfiles" ref="nofollow noopener noreferrer">Git - Internals - Packfiles</a></p>
</blockquote>
<h3 data-id="heading-2">第一步：找出大文件</h3>
<p>在清理之前，我们需要先找出是哪些文件占用了大量空间。</p>
<h4 data-id="heading-3">1. 查看仓库大小</h4>
<p>使用 <code>git count-objects</code> 命令可以查看仓库的打包对象数量和磁盘占用情况：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># -v: verbose, 显示详细信息</span>
<span class="hljs-comment"># -H: human-readable, 以人类可读的格式显示大小</span>
git count-objects -v -H
</code></pre>
<h4 data-id="heading-4">2. 查找 Packfile 中最大的对象</h4>
<p>我们可以通过 <code>git verify-pack</code> 命令查看 packfile 中的对象详情，并按大小排序找出最大的几个 blob 对象：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看 .git/objects/pack/ 下的 .idx 文件</span>
<span class="hljs-comment"># sort -rn -k 3: 按第3列（size）倒序排列</span>
<span class="hljs-comment"># head -10: 取前10个</span>
git verify-pack -v .git/objects/pack/*.idx | <span class="hljs-built_in">sort</span> -rn -k 3 | <span class="hljs-built_in">head</span> -10
</code></pre>
<p>输出结果格式如下：</p>
<pre><code class="hljs language-text" lang="text"># SHA-1 (Blob ID) | type | size | size-in-packfile | offset-in-packfile
9704d6e7c732b07418ffe2c0dd2c2030d0cd5a2e blob   2621847 2622645 235218
2bdb752d86091c343f2f4d3af88f038f6b4c2846 blob   2212925 868876 2918139
...
</code></pre>
<h4 data-id="heading-5">3. 定位具体文件路径</h4>
<p>拿到 Blob ID 后，我们需要知道它对应的是哪个文件。使用 <code>git rev-list</code> 配合 <code>grep</code> 可以查找对应的文件名：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 替换 &lt;blob id&gt; 为上面查到的 SHA-1</span>
git rev-list --objects --all | grep 2bdb752d86091c343f2f4d3af88f038f6b4c2846
</code></pre>
<p>输出示例：</p>
<pre><code class="hljs language-text" lang="text">2bdb752d86091c343f2f4d3af88f038f6b4c2846 .yarn/cache/playwright-core-npm-1.55.0-1c6d3fab0f-843376a8e2.zip
</code></pre>
<p>这样我们就找到了罪魁祸首，例如上面的 <code>yarn/cache/playwright-core-npm-1.55.0-1c6d3fab0f-843376a8e2.zip</code>。</p>
<h3 data-id="heading-6">第二步：分析问题</h3>
<p>通过上面的步骤，我们发现 <code>.yarn/cache/</code> 目录下的 zip 文件占用了大量空间。</p>
<p><strong>原因分析</strong>：
在使用 Yarn 2+ (Berry) 版本时，默认会将依赖以 zip 形式存储。如果项目没有正确配置 <code>.gitignore</code>，或者开发者误操作，就容易将 <code>.yarn/cache</code> 目录提交到 Git 仓库中。这些二进制缓存文件不仅体积大，而且变动频繁，是导致 Git 仓库膨胀的常见原因。</p>
<p><strong>Yarn 2+ 的 <code>.gitignore</code> 最佳实践</strong>：</p>
<p>根据 Yarn 官方文档，对于大多数非 Zero-Installs 的项目，我们应该忽略以下目录：</p>
<pre><code class="hljs language-gitignore" lang="gitignore"># Yarn 2+
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/sdks
!.yarn/versions

# 关键：忽略缓存目录
.yarn/cache

# 忽略构建状态和安装状态
.yarn/build-state.yml
.yarn/install-state.gz

# PnP 相关
.pnp.*
</code></pre>
<p>既然找到了问题根源是误提交了 <code>.yarn/cache</code>，接下来的目标就是将其从历史记录中彻底清除。</p>
<h3 data-id="heading-7">第三步：清理大文件</h3>
<p>找到大文件后，我们需要将其从所有历史记录中彻底移除。这里推荐使用 <strong>BFG Repo-Cleaner</strong>，它比原生的 <code>git filter-branch</code> 更快、更简单。</p>
<h4 data-id="heading-8">使用 BFG Repo-Cleaner</h4>
<blockquote>
<p>[!info] BFG Repo-Cleaner
BFG 是一个用 Scala 编写的工具，专门用于快速清理 Git 仓库中的大文件或隐私信息。
官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Frtyley.github.io%2Fbfg-repo-cleaner%2F" target="_blank" title="https://rtyley.github.io/bfg-repo-cleaner/" ref="nofollow noopener noreferrer">rtyley.github.io/bfg-repo-cl…</a></p>
</blockquote>
<h5 data-id="heading-9">1. 下载并运行</h5>
<p>BFG 提供了一个 <code>.jar</code> 包，需要安装 Java 环境运行。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 下载 bfg-1.14.0.jar 后，在仓库目录的上一级运行</span>
<span class="hljs-comment"># my-repo 为你的仓库目录名称</span>

<span class="hljs-comment"># 方式一：移除超过指定大小的文件 (例如 1M)</span>
java -jar bfg-1.14.0.jar --strip-blobs-bigger-than 1M my-repo

<span class="hljs-comment"># 方式二：移除指定名称的文件 (支持 glob 模式)</span>
java -jar bfg-1.14.0.jar --delete-files <span class="hljs-string">'*.{zip,jar,exe}'</span> my-repo

<span class="hljs-comment"># 方式三：移除指定文件夹</span>
java -jar bfg-1.14.0.jar --delete-folders <span class="hljs-string">'.svn'</span> my-repo
</code></pre>
<p>常用参数说明：</p>
<ul>
<li><code>-b, --strip-blobs-bigger-than &lt;size&gt;</code>: 移除超过指定大小的 blob。</li>
<li><code>-B, --strip-biggest-blobs NUM</code>: 移除最大的前 NUM 个 blob。</li>
<li><code>-D, --delete-files &lt;glob&gt;</code>: 按文件名移除文件。</li>
<li><code>--delete-folders &lt;glob&gt;</code>: 按文件夹名移除文件夹。</li>
<li><code>--no-blob-protection</code>: 允许修改最新提交（默认情况下 BFG 会保护最新的一次 commit 不被修改，以防误删）。</li>
</ul>
<p>这里我们使用命令删除 <code>.yarn/cache</code> 目录下的所有文件：</p>
<pre><code class="hljs language-bash" lang="bash">java -jar bfg-1.14.0.jar --delete-folders <span class="hljs-string">'.yarn/cache'</span> my-repo
</code></pre>
<h5 data-id="heading-10">2. 物理删除与垃圾回收</h5>
<p>BFG 只是更新了 Git 的引用（refs）和历史记录，并没有真正物理删除磁盘上的对象。我们需要运行 Git 的垃圾回收命令来彻底释放空间：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 强制过期所有 reflog，并执行垃圾回收</span>
git reflog expire --expire=now --all &amp;&amp; git gc --prune=now --aggressive
</code></pre>
<p>执行完上述步骤后，再次检查仓库大小，应该会发现体积明显减小。最后，需要<strong>强制</strong>推送到远程仓库：</p>
<pre><code class="hljs language-bash" lang="bash">git push origin --force --all
</code></pre>
<blockquote>
<p>[!warning] 警告
这是一个破坏性操作，会重写 Git 历史。在执行之前，请务必<strong>备份</strong>你的仓库！
此外，强制推送后，其他协作者需要重新 clone 仓库或进行 rebase 操作。</p>
</blockquote>
<h3 data-id="heading-11">参考资料</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgit-scm.com%2Fbook%2Fen%2Fv2%2FGit-Internals-Maintenance-and-Data-Recovery" target="_blank" title="https://git-scm.com/book/en/v2/Git-Internals-Maintenance-and-Data-Recovery" ref="nofollow noopener noreferrer">Git - Maintenance and Data Recovery</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Frtyley.github.io%2Fbfg-repo-cleaner%2F" target="_blank" title="https://rtyley.github.io/bfg-repo-cleaner/" ref="nofollow noopener noreferrer">BFG Repo-Cleaner</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F18F%2FC2%2Fissues%2F439" target="_blank" title="https://github.com/18F/C2/issues/439" ref="nofollow noopener noreferrer">GitHub Issue: Reduce git repository size</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LangChain v1 重大更新讲解⚠⚠⚠]]></title>    <link>https://juejin.cn/post/7575050949958746148</link>    <guid>https://juejin.cn/post/7575050949958746148</guid>    <pubDate>2025-11-21T17:44:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575050949958746148" data-draft-id="7575021014032678931" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LangChain v1 重大更新讲解⚠⚠⚠"/> <meta itemprop="keywords" content="LangChain,Python,Agent"/> <meta itemprop="datePublished" content="2025-11-21T17:44:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="吴佳浩"/> <meta itemprop="url" content="https://juejin.cn/user/2696441245481975"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LangChain v1 重大更新讲解⚠⚠⚠
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2696441245481975/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    吴佳浩
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T17:44:36.000Z" title="Fri Nov 21 2025 17:44:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{font-family:-apple-system,system-ui,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial;color:#00325e}.markdown-body ::selection{background-color:#00325e;color:#fff}.markdown-body blockquote{padding:10px 20px;background-color:#fffaf0;box-shadow:0 3px 10px 0 rgba(255,172,194,.24);border:1px solid #f3ca8e;transition:all .2s;margin:1em 0;border-radius:5px}.markdown-body blockquote p{font-size:14px;line-height:25px;color:#795548}.markdown-body blockquote p:last-child{margin:0}.markdown-body blockquote:hover{border-color:#ff9800;background-color:#fff8e0;box-shadow:0 6px 10px -5px rgba(225,173,98,.3803921569)}.markdown-body blockquote code{color:#ff502c}.markdown-body pre{border:1px solid #8cc0f3;box-shadow:0 3px 10px 0 rgba(255,198,198,.28);border-radius:5px;transition:all .2s;overflow-x:auto;white-space:pre-wrap}.markdown-body pre:hover{border-color:#6d9dce}.markdown-body pre&gt;code{padding:10px 20px;color:#00325e;background:#f0f8ff;font-size:12px;line-height:1.6;display:block}.markdown-body code{background:#f6fbff;color:#0b5393;padding:2px 4px;border-radius:4px;font-size:12px}.markdown-body p{font-size:14px;line-height:28px;text-align:justify;margin-bottom:17px;color:#595959}.markdown-body a{color:#00325e;text-decoration:none}.markdown-body a:after{content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAAXNSR0IArs4c6QAAAQdJREFUKFNt0DtLA0EUBeBzZle0Eks7rcUfEfBRCha7NorYa6NmVJzgyi4smUgKtdZGCJktLMVH4Y8QeztLWyE7VyLEuNFbXj4Oh0P8c8mZm+uJrEN4BJFTeP/MUVe3bnocfALwkOlo1zS7iZAzf6Cx7oXgbaqjxiDEWCcVaGyxQ8pSWo9XhqhoQ/xUFbaKjhe5V+CmR7mnSplEEF6GSmJ+F/d0KHvbCIIJCLc85U6BC5mONgbJNM3uFag++sX7z8O8MzsWBucifMx0dDGE1kmm458KDVukAlnNdDz/exEeW3dNkbfsYC0xtmgDWP6ELLZ0/F6BJu/UoFQN5AkoeUjeJPvx6+i+X5Sjah4tA6gYAAAAAElFTkSuQmCC);margin-left:2px}.markdown-body a:hover{box-shadow:0 1px}.markdown-body table{max-width:100%;border-collapse:collapse;border-spacing:0;box-shadow:0 3px 10px 0 rgba(255,238,172,.24);transition:all .2s}.markdown-body table:hover{box-shadow:0 3px 10px 0 rgba(185,169,103,.24)}.markdown-body table tr th{border:1px solid #8cc0f3;background-color:#f0f8ff;padding:12px 15px}.markdown-body table tr td{border:1px solid rgba(243,202,142,.4);padding:12px 15px}.markdown-body table tbody tr{transition:all .2s}.markdown-body table tbody tr:hover td{border-color:#f3ca8e;background-color:#fff8e0;z-index:1}.markdown-body img{max-width:100%}.markdown-body h1{font-size:20px;margin-top:30px;margin-bottom:10px;padding-left:30px;position:relative}.markdown-body h1&gt;code{font-size:20px}.markdown-body h1:before{content:"🍺";display:block;font-size:18px;width:18px;height:18px;left:0;position:absolute}.markdown-body h2{font-size:18px;margin-top:30px;margin-bottom:10px;padding-left:28px;position:relative}.markdown-body h2&gt;code{font-size:18px}.markdown-body h2:before{content:"🍻";display:block;font-size:16px;width:16px;height:16px;left:0;position:absolute}.markdown-body h3{font-size:16px;margin-top:30px;margin-bottom:10px;padding-left:26px;position:relative}.markdown-body h3&gt;code{font-size:16px}.markdown-body h3:before{content:"🥂";display:block;font-size:14px;width:14px;height:14px;left:0;position:absolute}.markdown-body h4{font-size:14px;margin-top:30px;margin-bottom:10px;padding-left:24px;position:relative}.markdown-body h4&gt;code{font-size:14px}.markdown-body h4:before{content:"🥃";display:block;font-size:12px;width:12px;height:12px;left:0;position:absolute}.markdown-body h5{font-size:12px;margin-top:30px;margin-bottom:10px}.markdown-body h5&gt;code{font-size:12px}.markdown-body h6{font-size:10px;margin-top:30px;margin-bottom:10px}.markdown-body h6&gt;code{font-size:10px}.markdown-body h1,.markdown-body h2{color:#ff502c}.markdown-body hr{height:4px;border:none;margin-top:32px;margin-bottom:32px;background-size:4px 1px;background-image:linear-gradient(270deg,#6d9dce,#8cc0f3 25%,transparent 50%)}.markdown-body hr:nth-child(2n){background-image:linear-gradient(270deg,#ff9800,#fff8e0 25%,transparent 50%)}.markdown-body ul{padding-inline-start:20px}.markdown-body ul li{list-style-type:"🔸"}.markdown-body ul li li{list-style-type:"◻️"}.markdown-body ul li li li{list-style-type:"▫️"}.markdown-body ol{padding-inline-start:20px}.markdown-body ol ::marker{color:#ff9800}.markdown-body ol,.markdown-body ul{line-height:2em}.markdown-body li{padding-inline-start:1ch}.markdown-body li.task-list-item{list-style:none;padding-inline-start:0}.markdown-body li input{padding-right:2px}.markdown-body li input[type=checkbox i]{appearance:none}.markdown-body li input:before{content:"🟩";display:block;width:13px;height:13px}.markdown-body li input:checked:before{content:"✅"}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">LangChain v1 重大更新讲解</h2>
<blockquote>
<p>为什么没有先发布demo教学而是先发布一个什么重大更新</p>
<p>因为langchain更新了，更新还挺多的所以建议大家还是从新版本开始学习</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2a3016eef8c4ab0933e83e98f1dd875~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC05L2z5rWp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764351876&amp;x-signature=Ni9%2BXYxzHe7feYf8ZfLFx6ldvXM%3D" alt="人工智能的无限可能.png" loading="lazy"/></p>
<p><strong>作者</strong>：吴佳浩</p>
<p><strong>最后更新</strong>：2025-11-22</p>
<p><strong>适用版本</strong>：LangChain v1.0+</p>
<h3 data-id="heading-1">目录</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Fsearch%3Fq%3D%2523-%25E4%25B8%2580langchain-v1-%25E4%25B8%25BA%25E4%25BB%2580%25E4%25B9%2588%25E6%2598%25AF%25E4%25B8%2580%25E6%25AC%25A1%25E5%25A4%25A7%25E7%2589%2588%25E6%259C%25AC%25E9%259D%25A9%25E5%2591%25BD" target="_blank" title="https://www.google.com/search?q=%23-%E4%B8%80langchain-v1-%E4%B8%BA%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%80%E6%AC%A1%E5%A4%A7%E7%89%88%E6%9C%AC%E9%9D%A9%E5%91%BD" ref="nofollow noopener noreferrer">📌 一、LangChain v1 为什么是一次“大版本革命”？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Fsearch%3Fq%3D%2523-%25E4%25BA%258Cv01--v10%25E5%25B7%25AE%25E5%25BC%2582%25E5%25AF%25B9%25E7%2585%25A7%25E8%25A1%25A8%25E6%25A0%25B8%25E5%25BF%2583%25E5%25BF%2585%25E8%25AF%25BB" target="_blank" title="https://www.google.com/search?q=%23-%E4%BA%8Cv01--v10%E5%B7%AE%E5%BC%82%E5%AF%B9%E7%85%A7%E8%A1%A8%E6%A0%B8%E5%BF%83%E5%BF%85%E8%AF%BB" ref="nofollow noopener noreferrer">🚀 二、v0.1 → v1.0：差异对照表（核心必读）</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Fsearch%3Fq%3D%2523-%25E4%25B8%2589langchain-v1-%25E6%259E%25B6%25E6%259E%2584%25E6%2580%25BB%25E8%25A7%2588" target="_blank" title="https://www.google.com/search?q=%23-%E4%B8%89langchain-v1-%E6%9E%B6%E6%9E%84%E6%80%BB%E8%A7%88" ref="nofollow noopener noreferrer">🧱 三、LangChain v1 架构总览</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Fsearch%3Fq%3D%2523-%25E5%259B%259Bcreate_agent%25E5%2585%25A8%25E6%2596%25B0%25E7%259A%2584-agent-%25E5%2588%259B%25E5%25BB%25BA%25E6%2596%25B9%25E5%25BC%258F" target="_blank" title="https://www.google.com/search?q=%23-%E5%9B%9Bcreate_agent%E5%85%A8%E6%96%B0%E7%9A%84-agent-%E5%88%9B%E5%BB%BA%E6%96%B9%E5%BC%8F" ref="nofollow noopener noreferrer">🧰 四、create_agent：全新的 Agent 创建方式</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Fsearch%3Fq%3D%2523-%25E4%25BA%2594middleware%25E6%25A0%25B8%25E5%25BF%2583%25E6%2589%25A9%25E5%25B1%2595%25E6%259C%25BA%25E5%2588%25B6%25E6%25B4%258B%25E8%2591%25B1%25E6%25A8%25A1%25E5%259E%258B" target="_blank" title="https://www.google.com/search?q=%23-%E4%BA%94middleware%E6%A0%B8%E5%BF%83%E6%89%A9%E5%B1%95%E6%9C%BA%E5%88%B6%E6%B4%8B%E8%91%B1%E6%A8%A1%E5%9E%8B" ref="nofollow noopener noreferrer">🔧 五、Middleware：核心扩展机制（洋葱模型）</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Fsearch%3Fq%3D%2523-%25E5%2585%25ADcontent_blocks%25E8%25B7%25A8%25E6%25A8%25A1%25E5%259E%258B%25E7%25BB%259F%25E4%25B8%2580%25E8%25BE%2593%25E5%2587%25BA" target="_blank" title="https://www.google.com/search?q=%23-%E5%85%ADcontent_blocks%E8%B7%A8%E6%A8%A1%E5%9E%8B%E7%BB%9F%E4%B8%80%E8%BE%93%E5%87%BA" ref="nofollow noopener noreferrer">📦 六、content_blocks：跨模型统一输出</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Fsearch%3Fq%3D%2523-%25E4%25B8%2583%25E7%25BB%2593%25E6%259E%2584%25E5%258C%2596%25E8%25BE%2593%25E5%2587%25BAstructured-output" target="_blank" title="https://www.google.com/search?q=%23-%E4%B8%83%E7%BB%93%E6%9E%84%E5%8C%96%E8%BE%93%E5%87%BAstructured-output" ref="nofollow noopener noreferrer">📐 七、结构化输出（Structured Output）</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Fsearch%3Fq%3D%2523-%25E5%2585%25AB%25E5%2591%25BD%25E5%2590%258D%25E7%25A9%25BA%25E9%2597%25B4%25E9%2587%258D%25E6%259E%2584--langchain-classic" target="_blank" title="https://www.google.com/search?q=%23-%E5%85%AB%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E9%87%8D%E6%9E%84--langchain-classic" ref="nofollow noopener noreferrer">📚 八、命名空间重构 + langchain-classic</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Fsearch%3Fq%3D%2523-%25E4%25B9%259Dv0--v1-%25E8%25BF%2581%25E7%25A7%25BB%25E6%258C%2587%25E5%258D%2597%25E5%25AE%259E%25E6%2588%2598%25E7%2589%2588" target="_blank" title="https://www.google.com/search?q=%23-%E4%B9%9Dv0--v1-%E8%BF%81%E7%A7%BB%E6%8C%87%E5%8D%97%E5%AE%9E%E6%88%98%E7%89%88" ref="nofollow noopener noreferrer">🛠 九、v0 → v1 迁移指南（实战版）</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Fsearch%3Fq%3D%2523-%25E5%258D%2581%25E6%258E%25A8%25E8%258D%2590%25E7%259A%2584%25E7%2594%259F%25E4%25BA%25A7%25E7%25BA%25A7%25E9%25A1%25B9%25E7%259B%25AE%25E7%25BB%2593%25E6%259E%2584%25E5%259B%25BE" target="_blank" title="https://www.google.com/search?q=%23-%E5%8D%81%E6%8E%A8%E8%8D%90%E7%9A%84%E7%94%9F%E4%BA%A7%E7%BA%A7%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84%E5%9B%BE" ref="nofollow noopener noreferrer">🏗 十、推荐的生产级项目结构图</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Fsearch%3Fq%3D%2523-%25E5%258D%2581%25E4%25B8%2580%25E7%259C%259F%25E5%25AE%259E%25E4%25BC%2581%25E4%25B8%259A%25E7%25BA%25A7%25E6%25A1%2588%25E4%25BE%258B%25E5%25A4%259A%25E6%25AD%25A5%25E9%25AA%25A4%25E4%25BB%25BB%25E5%258A%25A1-agent" target="_blank" title="https://www.google.com/search?q=%23-%E5%8D%81%E4%B8%80%E7%9C%9F%E5%AE%9E%E4%BC%81%E4%B8%9A%E7%BA%A7%E6%A1%88%E4%BE%8B%E5%A4%9A%E6%AD%A5%E9%AA%A4%E4%BB%BB%E5%8A%A1-agent" ref="nofollow noopener noreferrer">🧪 十一、真实企业级案例：多步骤任务 Agent</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Fsearch%3Fq%3D%2523-%25E5%258D%2581%25E4%25BA%258C%25E5%258F%25AF%25E8%25BF%2590%25E8%25A1%258C%25E7%25BB%25BC%25E5%2590%2588%25E7%25A4%25BA%25E4%25BE%258B%25E4%25BB%25A3%25E7%25A0%2581" target="_blank" title="https://www.google.com/search?q=%23-%E5%8D%81%E4%BA%8C%E5%8F%AF%E8%BF%90%E8%A1%8C%E7%BB%BC%E5%90%88%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81" ref="nofollow noopener noreferrer">📄 十二、可运行综合示例代码</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Fsearch%3Fq%3D%2523-%25E5%258D%2581%25E4%25B8%2589%25E6%2580%25BB%25E7%25BB%2593" target="_blank" title="https://www.google.com/search?q=%23-%E5%8D%81%E4%B8%89%E6%80%BB%E7%BB%93" ref="nofollow noopener noreferrer">📍 十三、总结</a></li>
</ul>
<hr/>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3c0946c7f754c509c415ec7c41395e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC05L2z5rWp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764351876&amp;x-signature=%2BwOZ4LEjJgMGSln38CEuIWgLku4%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">0. 环境准备</h3>
<p>在开始之前，请确保 Python 版本 <strong>≥ 3.9</strong>，并安装以下核心包：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装 v1 核心包、经典兼容包和图运行时</span>
pip install -U langchain langchain-classic langgraph

<span class="hljs-comment"># 安装适配的模型提供商包 (以 OpenAI 为例)</span>
pip install -U langchain-openai
</code></pre>
<hr/>
<h3 data-id="heading-3">一、LangChain v1 为什么是一次“大版本革命”？</h3>
<p>LangChain v1 不再仅仅是一个“LLM 调用工具箱”，而是正式转向<strong>构建生产级 Agent 系统的工程框架</strong>。</p>
<p><strong>核心变化包括：</strong></p>
<ol>
<li><strong><code>create_agent</code></strong>：正式成为 Agent 的标准构建方式（底层基于 LangGraph）。</li>
<li><strong>Middleware (中间件)</strong>：允许在任意阶段（模型调用前、工具执行时、输出后）拦截并修改逻辑。</li>
<li><strong><code>content_blocks</code></strong>：所有模型输出（推理/文本/工具调用）统一为标准格式，不再依赖正则解析。</li>
<li><strong>结构化输出</strong>：Pydantic Schema 成为一等公民，极大提升稳定性。</li>
<li><strong>命名空间拆分</strong>：旧 API（如 Chains）全部迁入 <code>langchain-classic</code>，主包只保留 Agent 核心。</li>
</ol>
<hr/>
<h3 data-id="heading-4">二、v0.1 → v1.0：差异对照表（核心必读）</h3>
<p>这是理解 v1 最重要的一张表，展示了从“脚本思维”到“工程思维”的转变。</p>

































































<table><thead><tr><th><strong>项目</strong></th><th><strong>LangChain v0.x (旧版)</strong></th><th><strong>LangChain v1.0 (新版)</strong></th><th><strong>核心差异</strong></th></tr></thead><tbody><tr><td><strong>中心思想</strong></td><td>Chains (链式调用)</td><td><strong>Agents (智能体)</strong></td><td>从线性执行转向循环图执行 (Graph)</td></tr><tr><td><strong>构建入口</strong></td><td><code>initialize_agent</code></td><td><strong><code>create_agent</code></strong></td><td>统一的新标准接口</td></tr><tr><td><strong>底层引擎</strong></td><td><code>AgentExecutor</code> (硬编码循环)</td><td><strong>LangGraph</strong></td><td>支持持久化、流式、分支、循环的图运行时</td></tr><tr><td><strong>流式能力</strong></td><td>部分支持 (Token级)</td><td><strong>全链路流式</strong></td><td>支持 Token、中间步骤、推理过程的实时流</td></tr><tr><td><strong>扩展机制</strong></td><td>无 (需修改源码或Prompt)</td><td><strong>Middleware</strong></td><td>完整的生命周期钩子 (Hooks)</td></tr><tr><td><strong>工具定义</strong></td><td><code>Tool</code> + <code>func</code></td><td><code>Tool</code> + <strong>Pydantic Schema</strong></td><td>类型更安全，参数定义更清晰</td></tr><tr><td><strong>结构化输出</strong></td><td>JSON Parser + Regex</td><td><strong>Structured Output</strong></td><td>直接绑定 Pydantic 类，由模型底层保证格式</td></tr><tr><td><strong>输出解析</strong></td><td>纯文本 + 正则匹配</td><td><strong><code>content_blocks</code></strong></td><td>标准化对象 (推理块、文本块、工具块)</td></tr><tr><td><strong>包管理</strong></td><td><code>langchain.*</code></td><td><strong><code>langchain-classic</code></strong></td><td>旧功能移至 classic 包，保持主包轻量</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-5">三、LangChain v1 架构总览</h3>
<blockquote>
<p><strong>💡 核心提示</strong>：LangChain v1 的底层引擎实际上是 <strong>LangGraph</strong>。<code>create_agent</code> 本质上是为你预构建了一个标准的 LangGraph 图。</p>
</blockquote>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    subgraph AgentRuntime ["LangGraph 运行时"]
        direction TB
        A["用户输入 (Messages)"] --&gt; B[" 模型推理 (LLM)"]
        B --&gt; C{"决策节点"}
        C --&gt;|需要工具| D[" 工具执行 (Tool Execution)"]
        D --&gt; E[" 工具结果反馈"]
        E --&gt; B
        C --&gt;|无需工具/结束| F[" 生成最终回答"]
    end
    
    style A fill:#e1f5fe,stroke:#01579b
    style B fill:#fff9c4,stroke:#fbc02d
    style D fill:#e8f5e9,stroke:#2e7d32
</code></pre>
<hr/>
<h3 data-id="heading-6">四、create_agent：全新的 Agent 创建方式</h3>
<p>为什么废弃 initialize_agent？</p>
<p>因为 v1 统一使用图架构（Graph Architecture）。所有的 Agent 本质上都是：推理 → 工具 → 再推理 的循环。create_agent 是这个标准循环的工厂函数。</p>
<p><strong>基本用法：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> create_agent
<span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI

<span class="hljs-comment"># 1. 定义模型</span>
model = ChatOpenAI(model=<span class="hljs-string">"gpt-4o"</span>)

<span class="hljs-comment"># 2. 创建 Agent</span>
agent = create_agent(
    model=model,
    tools=[search_tool, calculator_tool],
    system_prompt=<span class="hljs-string">"你是一个乐于助人的金融分析师。"</span>
)

<span class="hljs-comment"># 3. 运行 (Invoke)</span>
result = agent.invoke({<span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"分析 AAPL 股价"</span>}]})
</code></pre>
<hr/>
<h3 data-id="heading-7">五、Middleware：核心扩展机制（洋葱模型）</h3>
<p>中间件是 v1 最强大的功能，允许你在 Agent 生命周期的任意节点插入逻辑（如鉴权、日志、路由）。</p>
<p><strong>生命周期时序图：</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant User
    participant MW as Middleware (中间件层)
    participant Agent as Agent Runtime
    participant Model as LLM

    User-&gt;&gt;Agent: invoke(input)
    Agent-&gt;&gt;MW: 1. before_agent_start
    MW--&gt;&gt;Agent: (清洗后的输入)

    loop 思考与执行循环
        Agent-&gt;&gt;MW: 2. before_model
        Note right of MW: 动态修改 Prompt / 路由模型
        
        rect rgb(240,240,240)
            MW-&gt;&gt;Model: 3. wrap_model_call
            Model--&gt;&gt;MW: 返回原始结果
        end
        
        MW--&gt;&gt;Agent: 4. after_model (校验输出)

        opt 工具调用
            Agent-&gt;&gt;MW: 5. wrap_tool_call
            Note right of MW: 敏感操作审批 / 审计
            MW--&gt;&gt;Agent: 工具结果
        end
    end

    Agent-&gt;&gt;MW: 6. after_agent
    MW--&gt;&gt;User: 最终响应
</code></pre>
<hr/>
<h3 data-id="heading-8">六、content_blocks：跨模型统一输出</h3>
<p>解决“不同模型返回格式不同”的痛点。</p>
<p>模型输出现在包含统一的 .content_blocks 属性：</p>
<ul>
<li><code>reasoning</code>: 模型的思考过程（如 Chain of Thought）。</li>
<li><code>tool_call</code>: 结构化的工具调用请求。</li>
<li><code>text</code>: 最终回复文本。</li>
</ul>
<hr/>
<h3 data-id="heading-9">七、结构化输出（Structured Output）</h3>
<p>v1 推荐使用 <strong>Pydantic Schema</strong> 来强制模型输出特定格式，而不是在 Prompt 里写“请返回 JSON”。</p>
<p><strong>三种策略：</strong></p>
<ol>
<li><strong>SchemaBasedStructurer</strong> (推荐)：直接传入 Pydantic 类。</li>
<li><strong>ToolStrategy</strong>：利用 Tool Calling 机制输出结构。</li>
<li><strong>ProviderStrategy</strong>：利用模型原生 JSON Mode（如 OpenAI JSON Object）。</li>
</ol>
<hr/>
<h3 data-id="heading-10">八、命名空间重构 + langchain-classic</h3>
<p>为了给 Agent 让路，旧的“链式”组件被移入 <code>classic</code> 包。</p>
<p><strong>迁移对照：</strong></p>

























<table><thead><tr><th><strong>组件</strong></th><th><strong>旧引入方式</strong></th><th><strong>v1 新引入方式</strong></th></tr></thead><tbody><tr><td><strong>Memory</strong></td><td><code>from langchain.memory import ...</code></td><td><code>from langchain_classic.memory import ...</code></td></tr><tr><td><strong>Chains</strong></td><td><code>from langchain.chains import ...</code></td><td><code>from langchain_classic.chains import ...</code></td></tr><tr><td><strong>Retrievers</strong></td><td><code>from langchain.retrievers import ...</code></td><td><code>from langchain_classic.retrievers import ...</code></td></tr></tbody></table>
<hr/>
<h3 data-id="heading-11">🛠 九、v0 → v1 迁移指南（实战版）</h3>
<h4 data-id="heading-12">1. ConversationChain → create_agent</h4>
<ul>
<li>
<p>❌ <strong>旧 (v0)</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.chains <span class="hljs-keyword">import</span> ConversationChain
chain = ConversationChain(llm=llm)
chain.run(<span class="hljs-string">"Hi"</span>)
</code></pre>
</li>
<li>
<p>✔ <strong>新 (v1)</strong>：</p>
<pre><code class="hljs language-Python" lang="Python"><span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> create_agent
<span class="hljs-comment"># create_agent 自带记忆管理 (通过 LangGraph checkpoint)</span>
agent = create_agent(model=llm, tools=[])
agent.invoke({<span class="hljs-string">"messages"</span>: [...]})
</code></pre>
</li>
</ul>
<h4 data-id="heading-13">2. LLMChain → model.invoke</h4>
<ul>
<li>
<p>❌ <strong>旧 (v0)</strong>：</p>
<pre><code class="hljs language-python" lang="python">chain = LLMChain(prompt=prompt, llm=llm)
chain.run(variable=<span class="hljs-string">"value"</span>)
</code></pre>
</li>
<li>
<p>✔ <strong>新 (v1)</strong>：</p>
<pre><code class="hljs language-Python" lang="Python"><span class="hljs-comment"># 直接使用 LCEL (LangChain Expression Language)</span>
chain = prompt | llm
chain.invoke({<span class="hljs-string">"variable"</span>: <span class="hljs-string">"value"</span>})
</code></pre>
</li>
</ul>
<h4 data-id="heading-14">3. Tool 定义方式</h4>
<ul>
<li>❌ <strong>旧 (v0)</strong>：依赖 <code>func</code> 和文档字符串解析。</li>
<li>✔ <strong>新 (v1)</strong>：强烈建议使用 <code>@tool</code> 装饰器并配合 Pydantic 类型的参数注解，或者使用 <code>create_tool(schema=MySchema)</code>。</li>
</ul>
<hr/>
<h3 data-id="heading-15">十、推荐的生产级项目结构图</h3>
<p>在 v1 时代，推荐采用分层架构来管理 Agent 项目：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
  Root[" my_agent_project/"] --&gt; A[" app/"]
  
  A --&gt; B[" agent.py &lt;br/&gt; (create_agent 组装入口)"]
  
  A --&gt; C["middleware/ &lt;br/&gt; (中间件层)"]
  C --&gt; C1[" auth_middleware.py"]
  C --&gt; C2[" risk_control.py"]
  
  A --&gt; D[" schemas/ &lt;br/&gt; (数据结构)"]
  D --&gt; D1[" user_context.py"]
  D --&gt; D2[" output_schema.py"]
  
  A --&gt; E[" tools/ &lt;br/&gt; (工具集)"]
  E --&gt; E1[" search_tool.py"]
  E --&gt; E2[" db_tool.py"]
  
  A --&gt; F[" main.py &lt;br/&gt; (FastAPI/Streamlit 入口)"]
</code></pre>
<hr/>
<h3 data-id="heading-16">十一、真实企业级案例：多步骤任务 Agent</h3>
<p>场景：自动代码修复 Agent。</p>
<p>流程：写代码 → 运行测试 → 失败则分析日志 → 修复代码 → 循环直至成功。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    Start(("开始")) --&gt; Gen["生成初版代码"]
    Gen --&gt; Run["🔧 工具: 运行代码/测试"]
    Run --&gt; Check{"测试通过?"}
    
    Check --&gt;|失败| Debug[" LLM: 分析错误日志"]
    Debug --&gt; Gen
    
    Check --&gt;|成功| Output["输出最终代码"]
    Output --&gt; End(("结束"))
</code></pre>
<p><em>这在 v1 中通过 <code>create_agent</code> 天然支持，因为底层 Graph 支持循环，且可以通过中间件记录每次尝试的详细日志。</em></p>
<hr/>
<h3 data-id="heading-17">十二、可运行综合示例代码</h3>
<p>这是一个包含了 <strong>中间件 (Middleware)</strong> 和 <strong>结构化输出</strong> 的完整 v1 示例。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Any</span>, <span class="hljs-type">Dict</span>
<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel, Field

<span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> create_agent
<span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI
<span class="hljs-keyword">from</span> langchain.tools <span class="hljs-keyword">import</span> tool
<span class="hljs-keyword">from</span> langchain.agents.middleware <span class="hljs-keyword">import</span> AgentMiddleware, ModelRequest, ModelResponse

<span class="hljs-comment"># 1. 定义工具</span>
<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_weather</span>(<span class="hljs-params">city: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""获取指定城市的天气信息"""</span>
    <span class="hljs-comment"># 模拟 API 返回</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"<span class="hljs-subst">{city}</span> 天气晴朗, 25°C"</span>

<span class="hljs-comment"># 2. 定义结构化输出 Schema</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">WeatherReport</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    city: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"城市名称"</span>)
    temperature: <span class="hljs-built_in">float</span> = Field(description=<span class="hljs-string">"温度数值"</span>)
    summary: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"一句话天气总结"</span>)

<span class="hljs-comment"># 3. 定义自定义中间件 (示例：自动添加礼貌用语)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">PolitenessMiddleware</span>(<span class="hljs-title class_ inherited__">AgentMiddleware</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrap_model_call</span>(<span class="hljs-params">self, request: ModelRequest, handler</span>) -&gt; ModelResponse:
        <span class="hljs-comment"># 在发送给模型前，修改 System Prompt</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"🕵️ Middleware: 正在注入礼貌指令..."</span>)
        <span class="hljs-keyword">if</span> request.messages:
            last_msg = request.messages[-<span class="hljs-number">1</span>]
            <span class="hljs-keyword">if</span> last_msg.role == <span class="hljs-string">"user"</span>:
                last_msg.content += <span class="hljs-string">" (请用非常礼貌的语气回答)"</span>
        <span class="hljs-keyword">return</span> handler(request)

<span class="hljs-comment"># 4. 构建 Agent</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    agent = create_agent(
        model=ChatOpenAI(model=<span class="hljs-string">"gpt-4o-mini"</span>),
        tools=[get_weather],
        middleware=[PolitenessMiddleware()],
        <span class="hljs-comment"># 强制结构化输出 (v1 特性)</span>
        <span class="hljs-comment"># response_format=ToolStrategy(WeatherReport) # 若需强制结构化可开启此行</span>
    )

    <span class="hljs-built_in">print</span>(<span class="hljs-string">"🚀 Agent 启动..."</span>)
    result = <span class="hljs-keyword">await</span> agent.ainvoke({
        <span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"帮我查一下北京的天气"</span>}]
    })

    <span class="hljs-comment"># v1 的 result 包含完整的执行状态</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n💬 最终回复:"</span>)
    <span class="hljs-built_in">print</span>(result[<span class="hljs-string">"messages"</span>][-<span class="hljs-number">1</span>].content)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    asyncio.run(main())
</code></pre>
<hr/>
<h3 data-id="heading-18">十三、总结</h3>
<p>LangChain v1 标志着我们从 <strong>“玩票性质的 Chain”</strong> 走向了 <strong>“工程化的 Agent”</strong>。</p>
<ul>
<li>如果你需要构建简单的问答机器人，LangChain v1 提供了更统一的接口。</li>
<li>如果你需要构建复杂的、多步推理的、具有自我纠错能力的企业级智能体，LangChain v1 (配合 LangGraph) 是目前 Python 生态中最佳的选择。</li>
</ul>
<p><strong>下一步建议：</strong> 安装 <code>langchain-classic</code> 确保旧代码运行，同时在新模块中开始尝试使用 <code>create_agent</code>。
慎重更新老项目。。。。。。崩了。。。别赖我。。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Ultracite：为 AI 时代打造的零配置代码规范工具]]></title>    <link>https://juejin.cn/post/7575090551356686388</link>    <guid>https://juejin.cn/post/7575090551356686388</guid>    <pubDate>2025-11-22T10:26:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575090551356686388" data-draft-id="7575090551356670004" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Ultracite：为 AI 时代打造的零配置代码规范工具"/> <meta itemprop="keywords" content="前端,JavaScript,GitHub"/> <meta itemprop="datePublished" content="2025-11-22T10:26:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JinSo"/> <meta itemprop="url" content="https://juejin.cn/user/2041171430876333"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Ultracite：为 AI 时代打造的零配置代码规范工具
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2041171430876333/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JinSo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-22T10:26:41.000Z" title="Sat Nov 22 2025 10:26:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-22
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">Ultracite 是什么？</h2>
<p>Ultracite 是一个<strong>高度固定化、零配置</strong>的代码检查和格式化工具。它基于高性能的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fbiomejs.dev%2F" target="_blank" title="https://biomejs.dev/" ref="nofollow noopener noreferrer">Biome</a> 构建，适用于所有前端项目，无论你使用 React、Vue、Angular 还是原生 JavaScript，都能让你和 AI 编程助手编写出一致且高质量的代码。</p>
<h3 data-id="heading-1">核心理念：约定优于配置</h3>
<p>不同于 ESLint + Prettier 需要大量配置，Ultracite 采用了极简主义设计理念：</p>
<ul>
<li><strong>零配置</strong>：开箱即用，无需编写任何配置文件</li>
<li><strong>固定规则</strong>：精心挑选的规则集，避免无谓的选择困扰</li>
<li><strong>统一标准</strong>：整个团队和 AI 助手都遵循相同的代码规范</li>
</ul>
<h2 data-id="heading-2">快速开始</h2>
<h3 data-id="heading-3">初始化</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在项目中初始化 Ultracite</span>
pnpm dlx ultracite init
</code></pre>
<p>Ultracite 提供了交互式的安装体验，让你根据项目需求选择功能：</p>
<pre><code class="hljs language-bash" lang="bash">❯ pnpm dlx ultracite init
┌
888     888 888    88888888888 8888888b.         d8888  .d8888b. 8888888 88888888888 8888888888
888     888 888        888     888   Y88b       d88888 d88P  Y88b  888       888     888
888     888 888        888     888    888      d88P888 888    888  888       888     888
888     888 888        888     888   d88P     d88P 888 888         888       888     8888888
888     888 888        888     8888888P<span class="hljs-string">"     d88P  888 888         888       888     888
888     888 888        888     888 T88b     d88P   888 888    888  888       888     888
Y88b. .d88P 888        888     888  T88b   d8888888888 Y88b  d88P  888       888     888
 "</span>Y88888P<span class="hljs-string">"  88888888   888     888   T88b d88P     888  "</span>Y8888P<span class="hljs-string">" 8888888     888     8888888888

│
●  Detected lockfile, using pnpm
│
◇  Remove existing formatters/linters (recommended for clean migration)?
│  Remove ESLint (dependencies, config files, VS Code settings)
│
◇  Which frameworks are you using (optional)?
│  React
│
◇  Which editors do you want to configure (recommended)?
│  VSCode / Cursor / Windsurf
│
◇  Which agents do you want to enable (optional)?
│  Cursor
│
◇  Which agent hooks do you want to enable (optional)?
│  Cursor
│
◇  Would you like any of the following (optional)?
│  Husky pre-commit hook, Lefthook pre-commit hook, Lint-staged
│
◑  ...省略安装步骤
◆  Successfully initialized Ultracite configuration!
</span></code></pre>
<p>初始化完成后，Ultracite 会根据你的选择自动完成以下配置：</p>
<ul>
<li>安装必要的依赖包</li>
<li>生成编辑器配置文件</li>
<li><strong>创建 AI 代码规范提示词</strong>（这是 Ultracite 的核心特性之一）</li>
<li>配置 Git Hooks 工具（Husky、Lefthook、Lint-staged）</li>
<li>更新 package.json 脚本</li>
<li>生成 biome.json 配置文件</li>
</ul>
<p>关于 Git Hooks 工具的详细介绍，可以参考我之前的文章：<a href="https://juejin.cn/post/7309290887363592233" target="_blank" title="https://juejin.cn/post/7309290887363592233">在 Monorepo 中对代码进行规范(husky + lint-staged)</a></p>
<h3 data-id="heading-4">基本使用</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查代码问题</span>
npx ultracite check

<span class="hljs-comment"># 自动修复和格式化代码</span>
npx ultracite fix
</code></pre>
<h2 data-id="heading-5">AI 友好特性</h2>
<p>这是 Ultracite 的一大亮点 —— 它专门为 AI 编程时代设计，让 AI 助手也能遵循项目的代码规范。</p>
<h3 data-id="heading-6">AI 提示词集成</h3>
<p>当你选择启用 AI agent（如 Cursor）时，Ultracite 会生成一份详细的代码规范提示词文件 <code>.cursor/rules/ultracite.mdc</code>。这份文件包含了完整的编码规范，涵盖：</p>
<ul>
<li><strong>类型安全规范</strong>：要求使用明确的类型定义，避免 any 类型</li>
<li><strong>现代语法规范</strong>：优先使用箭头函数、可选链、解构赋值等现代特性</li>
<li><strong>异步编程规范</strong>：正确使用 async/await，妥善处理错误</li>
<li><strong>React 最佳实践</strong>：函数组件、Hooks 规则、无障碍访问等</li>
<li><strong>代码组织原则</strong>：函数复杂度控制、早期返回、关注点分离</li>
</ul>
<p>有了这份提示词，AI 助手生成的代码会自动遵循这些规范，大大减少了代码审查的工作量。</p>
<h3 data-id="heading-7">Cursor Hooks 集成</h3>
<p>对于 Cursor 用户，Ultracite 还会生成 hooks 配置（<code>.cursor/hooks.json</code>）：</p>
<pre><code class="hljs language-bash" lang="bash">{
  <span class="hljs-string">"version"</span>: 1,
  <span class="hljs-string">"hooks"</span>: {
    <span class="hljs-string">"afterFileEdit"</span>: [
      {
        <span class="hljs-string">"command"</span>: <span class="hljs-string">"npx ultracite fix"</span>
      }
    ]
  }
}
</code></pre>
<p>这个配置实现了"保存即格式化"的效果 —— 每次你或 AI 编辑文件后，代码都会自动格式化，保持整个项目的一致性。</p>
<h2 data-id="heading-8">Git Hooks 集成</h2>
<p>Ultracite 支持主流的 Git Hooks 工具，确保提交的代码都经过检查和格式化。</p>
<h3 data-id="heading-9">Husky 集成</h3>
<p>生成的 <code>.husky/pre-commit</code> 文件会在提交前自动运行代码检查：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/sh</span>
<span class="hljs-comment"># Exit on any error</span>
<span class="hljs-built_in">set</span> -e

<span class="hljs-comment"># Check if there are any staged files</span>
<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-subst">$(git diff --cached --name-only)</span>"</span> ]; <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"No staged files to format"</span>
  <span class="hljs-built_in">exit</span> 0
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># Store the hash of staged changes to detect modifications</span>
STAGED_HASH=$(git diff --cached | <span class="hljs-built_in">sha256sum</span> | <span class="hljs-built_in">cut</span> -d<span class="hljs-string">' '</span> -f1)

<span class="hljs-comment"># Save list of staged files (handling all file states)</span>
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACMR)
PARTIALLY_STAGED=$(git diff --name-only)

<span class="hljs-comment"># Stash unstaged changes to preserve working directory</span>
git stash push --quiet --keep-index --message <span class="hljs-string">"pre-commit-stash"</span> || <span class="hljs-literal">true</span>
STASHED=$?

<span class="hljs-comment"># Run formatter on the staged files</span>
pnpm dlx ultracite fix
FORMAT_EXIT_CODE=$?

<span class="hljs-comment"># Restore working directory state</span>
<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$STASHED</span> -eq 0 ]; <span class="hljs-keyword">then</span>
  <span class="hljs-comment"># Re-stage the formatted files</span>
  <span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable">$STAGED_FILES</span>"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$STAGED_FILES</span>"</span> | <span class="hljs-keyword">while</span> IFS= <span class="hljs-built_in">read</span> -r file; <span class="hljs-keyword">do</span>
      <span class="hljs-keyword">if</span> [ -f <span class="hljs-string">"<span class="hljs-variable">$file</span>"</span> ]; <span class="hljs-keyword">then</span>
        git add <span class="hljs-string">"<span class="hljs-variable">$file</span>"</span>
      <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">done</span>
  <span class="hljs-keyword">fi</span>

  <span class="hljs-comment"># Restore unstaged changes</span>
  git stash pop --quiet || <span class="hljs-literal">true</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># Check if staged files actually changed</span>
NEW_STAGED_HASH=$(git diff --cached | <span class="hljs-built_in">sha256sum</span> | <span class="hljs-built_in">cut</span> -d<span class="hljs-string">' '</span> -f1)
<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$STAGED_HASH</span>"</span> != <span class="hljs-string">"<span class="hljs-variable">$NEW_STAGED_HASH</span>"</span> ]; <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"✨ Files formatted by Ultracite"</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-built_in">exit</span> <span class="hljs-variable">$FORMAT_EXIT_CODE</span>
</code></pre>
<p>这个脚本会智能处理部分暂存的文件，确保只格式化你要提交的代码。</p>
<h3 data-id="heading-10">Lefthook 集成</h3>
<p>如果你选择使用 Lefthook，会生成 <code>lefthook.yml</code> 配置：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">pre-commit:</span>
  <span class="hljs-attr">jobs:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">dlx</span> <span class="hljs-string">ultracite</span> <span class="hljs-string">fix</span>
      <span class="hljs-attr">glob:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">"*.js"</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">"*.jsx"</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">"*.ts"</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">"*.tsx"</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">"*.json"</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">"*.jsonc"</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">"*.css"</span>
      <span class="hljs-attr">stage_fixed:</span> <span class="hljs-literal">true</span>
</code></pre>
<p>Lefthook 的优势在于并行执行和更灵活的配置选项。</p>
<h3 data-id="heading-11">Lint-staged 集成</h3>
<p>配合 lint-staged 可以只处理暂存的文件，在 <code>package.json</code> 中会添加：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"lint-staged"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"*.{js,jsx,ts,tsx,json,jsonc,css,scss,md,mdx}"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"pnpm dlx ultracite fix"</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-12">VSCode 深度集成</h2>
<p>Ultracite 会自动为 VSCode（包括 Cursor、Windsurf）生成配置，实现保存时自动格式化：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// .vscode/settings.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"editor.defaultFormatter"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"esbenp.prettier-vscode"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"[javascript]"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"editor.defaultFormatter"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"biomejs.biome"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"[typescript]"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"editor.defaultFormatter"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"biomejs.biome"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"[javascriptreact]"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"editor.defaultFormatter"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"biomejs.biome"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"[typescriptreact]"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"editor.defaultFormatter"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"biomejs.biome"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"[json]"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"editor.defaultFormatter"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"biomejs.biome"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"[jsonc]"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"editor.defaultFormatter"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"biomejs.biome"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"[css]"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"editor.defaultFormatter"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"biomejs.biome"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"[graphql]"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"editor.defaultFormatter"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"biomejs.biome"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"typescript.tsdk"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node_modules/typescript/lib"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"editor.formatOnSave"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"editor.formatOnPaste"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"emmet.showExpandedAbbreviation"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"never"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"editor.codeActionsOnSave"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"source.fixAll.biome"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"explicit"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"source.organizeImports.biome"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"explicit"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-13"><strong>MCP（Model Context Protocol）支持</strong></h2>
<p>MCP 是一个开放标准，让 Claude、Cursor 等 AI 工具能够安全地连接外部数据源和系统。可以把它理解为一个"万能遥控器"，让 AI 工具能够访问真实世界的数据和功能。Ultracite 通过支持 MCP 来增强你的 AI 开发工作流。</p>
<h3 data-id="heading-14"><strong>安装配置</strong></h3>
<ol>
<li>
<p><strong>选择你的 AI 工具</strong></p>
<p>确保你使用的 AI 开发工具支持 MCP：</p>
<ul>
<li>Claude Desktop（免费，推荐初学者使用）</li>
<li>Cursor（AI 驱动的代码编辑器）</li>
<li>Windsurf by Codeium（AI 开发平台）</li>
<li>其他支持 MCP 的工具</li>
</ul>
</li>
<li>
<p><strong>找到配置文件位置</strong></p>
<p>根据你的 AI 工具，需要编辑对应的配置文件：</p>
<ul>
<li>
<p><strong>Claude Desktop</strong>:</p>
<ul>
<li>macOS: <code>~/Library/Application\ Support/Claude/claude_desktop_config.json</code></li>
<li>Windows: <code>%APPDATA%\Claude\claude_desktop_config.json</code></li>
</ul>
</li>
<li>
<p><strong>Cursor</strong>: <code>.cursor/mcp.json</code></p>
</li>
<li>
<p><strong>Windsurf</strong>: <code>.codeium/windsurf/mcp_config.json</code></p>
</li>
<li>
<p><strong>其他工具</strong>: 查看对应工具的 MCP 文档</p>
</li>
</ul>
</li>
<li>
<p><strong>添加 Ultracite 配置</strong></p>
<p>将以下配置复制到你的 MCP 配置文件中：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"ultracite"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"-y"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"mcp-remote"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"&lt;https://www.ultracite.ai/api/mcp/mcp&gt;"</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</li>
<li>
<p><strong>重启 AI 工具</strong></p>
<p>关闭并重新打开你的 AI 应用，让配置生效。</p>
</li>
<li>
<p><strong>验证连接</strong></p>
<p>通过询问你的 AI 助手来测试集成是否成功：</p>
<blockquote>
<p>"Ultracite 有哪些可用的规则？"</p>
</blockquote>
<p>如果配置成功，AI 应该能够列出并解释 Ultracite 的规则！</p>
</li>
</ol>
<h2 data-id="heading-15">从 ESLint + Prettier 迁移</h2>
<p>迁移过程非常简单：</p>
<ol>
<li>运行 <code>pnpm dlx ultracite init</code></li>
<li>选择移除现有的 ESLint 和 Prettier 配置</li>
<li>更新 package.json 中的脚本命令</li>
<li>删除旧的配置文件</li>
</ol>
<p>Ultracite 的规则集已经涵盖了大多数常用的 ESLint 和 Prettier 规则，你几乎不需要任何额外配置。</p>
<h2 data-id="heading-16">总结</h2>
<p>Ultracite 代表了代码质量工具的新方向：简单、快速、AI 友好。它特别适合：</p>
<ul>
<li><strong>使用 AI 编程的开发者</strong>：通过提示词和 hooks 确保 AI 生成高质量代码</li>
<li><strong>追求效率的团队</strong>：零配置设计，减少工具链维护成本</li>
<li><strong>任何前端项目</strong>：无论使用什么框架，都能获得一致的代码质量</li>
<li><strong>Monorepo 项目</strong>：原生支持，配置简单</li>
</ul>
<p>相比传统的 ESLint + Prettier 组合，Ultracite 提供了更快的性能、更简单的配置、更统一的工具链，以及原生的 AI 编程支持。在 AI 辅助编程越来越普及的今天，选择一个 AI 友好的代码规范工具，能让你的开发效率更上一层楼。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSS 属性值 initial、unset 和 revert 的解析]]></title>    <link>https://juejin.cn/post/7575083657994158107</link>    <guid>https://juejin.cn/post/7575083657994158107</guid>    <pubDate>2025-11-22T14:17:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575083657994158107" data-draft-id="7575133880434966579" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSS 属性值 initial、unset 和 revert 的解析"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-22T14:17:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员大卫"/> <meta itemprop="url" content="https://juejin.cn/user/1961184474695213"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSS 属性值 initial、unset 和 revert 的解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1961184474695213/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员大卫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-22T14:17:29.000Z" title="Sat Nov 22 2025 14:17:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-22
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    21
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是<strong>前端架构师</strong>，关注微信公众号【<strong>程序员大卫</strong>】，免费领取前端最新面试资料。</p>
<h2 data-id="heading-0">背景</h2>
<p>在 CSS 中，管理属性值和继承行为是创建健壮、可维护样式的基础。除了常见的具体数值（如 <code>16px</code>、<code>#333</code>）或通用值（如 <code>inherit</code>）之外，CSS 还提供了一些特殊的<strong>关键字</strong>，它们能重置或恢复属性值到其“默认”或前一个状态。</p>
<p>其中，<code>initial</code>、<code>unset</code> 和 <code>revert</code> 是三个功能强大且容易混淆的关键字。理解它们的区别，能帮助您更好地控制样式，尤其是在处理第三方组件或大型应用中的样式冲突时。</p>
<h2 data-id="heading-1">核心区别一览</h2>





























<table><thead><tr><th align="left">关键字</th><th align="left">作用</th><th align="left">行为细节</th><th align="left">适用场景</th></tr></thead><tbody><tr><td align="left"><strong><code>initial</code></strong></td><td align="left">重置为<strong>初始值</strong></td><td align="left">将属性重置为其在 CSS 规范中定义的<strong>初始值</strong>（就像该属性从未被设置过一样）。</td><td align="left">确保属性值是浏览器默认的“出厂设置”，不考虑继承。</td></tr><tr><td align="left"><strong><code>unset</code></strong></td><td align="left">重置为<strong>未设置值</strong></td><td align="left">如果该属性是<strong>可继承</strong>的，则表现为 <code>inherit</code>（继承父元素的值）。<br/>如果该属性是<strong>不可继承</strong>的，则表现为 <code>initial</code>。</td><td align="left">恢复属性到其自然的（默认的）继承行为。</td></tr><tr><td align="left"><strong><code>revert</code></strong></td><td align="left">重置为<strong>上一个级联值</strong></td><td align="left">将属性重置为<strong>用户代理样式表</strong>（浏览器默认样式）、<strong>用户样式表</strong>或<strong>作者样式表</strong>中应用过的上一个值。它会撤销当前样式块的更改，恢复到级联链中更早的值。</td><td align="left">撤销对属性的特定覆盖，恢复到浏览器或用户定义的样式，常用于恢复浏览器默认样式。</td></tr></tbody></table>
<h2 data-id="heading-2">关键字详解与示例</h2>
<p>为了更好地理解，我们主要关注 <code>color</code>（可继承）和 <code>border</code>（不可继承）这两个属性。</p>
<h3 data-id="heading-3">1. <code>initial</code>：回到起点</h3>
<p><code>initial</code> 总是将属性值设置为 CSS 规范中定义的<strong>初始值</strong>。这个值是固定的，并且与该元素是否继承了父元素的值<strong>无关</strong>。</p>
<h4 data-id="heading-4"><strong>示例：</strong></h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 初始设置 */</span>
<span class="hljs-selector-tag">div</span> {
  <span class="hljs-attribute">color</span>: blue;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid black;
}

<span class="hljs-comment">/* 应用 initial */</span>
<span class="hljs-selector-class">.initial-demo</span> {
  <span class="hljs-comment">/* color 是可继承属性，但 initial 强制设为初始值 (通常是 black) */</span>
  <span class="hljs-attribute">color</span>: initial;
  <span class="hljs-comment">/* border 是不可继承属性，initial 强制设为初始值 (none) */</span>
  <span class="hljs-attribute">border</span>: initial;
}
</code></pre>























<table><thead><tr><th align="left">元素</th><th align="left">父元素 <code>div</code> 的样式</th><th align="left"><code>.initial-demo</code> 的样式</th><th align="left">最终值</th></tr></thead><tbody><tr><td align="left"><code>color</code></td><td align="left"><code>blue</code></td><td align="left"><code>initial</code></td><td align="left"><strong><code>black</code></strong> (初始值)</td></tr><tr><td align="left"><code>border</code></td><td align="left"><code>1px solid black</code></td><td align="left"><code>initial</code></td><td align="left"><strong><code>none</code></strong> (初始值)</td></tr></tbody></table>
<h3 data-id="heading-5">2. <code>unset</code>：恢复自然状态</h3>
<p><code>unset</code> 是一个“智能”的重置。它根据属性的<strong>可继承性</strong>来决定行为：</p>
<ul>
<li><strong>可继承属性：</strong> 表现为 <code>inherit</code>。</li>
<li><strong>不可继承属性：</strong> 表现为 <code>initial</code>。</li>
</ul>
<h4 data-id="heading-6"><strong>示例：</strong></h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 初始设置 */</span>
<span class="hljs-selector-tag">div</span> {
  <span class="hljs-attribute">color</span>: blue;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid black;
}

<span class="hljs-comment">/* 应用 unset */</span>
<span class="hljs-selector-class">.unset-demo</span> {
  <span class="hljs-comment">/* color 是可继承属性，表现为 inherit */</span>
  <span class="hljs-attribute">color</span>: unset;
  <span class="hljs-comment">/* border 是不可继承属性，表现为 initial */</span>
  <span class="hljs-attribute">border</span>: unset;
}
</code></pre>























<table><thead><tr><th align="left">元素</th><th align="left">父元素 <code>div</code> 的样式</th><th align="left"><code>.unset-demo</code> 的样式</th><th align="left">最终值</th></tr></thead><tbody><tr><td align="left"><code>color</code></td><td align="left"><code>blue</code></td><td align="left"><code>unset</code> <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\rightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">→</span></span></span></span></span> <code>inherit</code></td><td align="left"><strong><code>blue</code></strong> (继承自父元素)</td></tr><tr><td align="left"><code>border</code></td><td align="left"><code>1px solid black</code></td><td align="left"><code>unset</code> <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\rightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">→</span></span></span></span></span> <code>initial</code></td><td align="left"><strong><code>none</code></strong> (初始值)</td></tr></tbody></table>
<h3 data-id="heading-7">3. <code>revert</code>：撤销作者样式</h3>
<p><code>revert</code> 是最独特的。它沿着 CSS 级联（Cascading）链向上查找，恢复到<strong>上一个</strong>被应用的值。它本质上是<strong>撤销</strong>了当前样式表中的属性定义，恢复到：</p>
<ol>
<li><strong>用户样式</strong>（如果用户设置了）。</li>
<li><strong>浏览器默认样式</strong>（用户代理样式表）。</li>
<li>如果以上都没有，则恢复到 <code>unset</code> 的行为。</li>
</ol>
<p>它主要用于恢复浏览器默认样式，例如，您不想让某个 <code>&lt;h1&gt;</code> 标签应用您的全局字体样式，希望它用回浏览器默认的粗体大字。</p>
<h4 data-id="heading-8"><strong>示例：</strong></h4>
<p>假设浏览器默认样式是：<code>h1 { font-weight: bold; }</code></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 作者样式表 (您的代码) */</span>
<span class="hljs-selector-tag">h1</span> {
  <span class="hljs-comment">/* 覆盖了浏览器默认样式 */</span>
  <span class="hljs-attribute">font-weight</span>: normal; 
}

<span class="hljs-selector-class">.revert-demo</span> {
  <span class="hljs-comment">/* 撤销了上方的 font-weight: normal; */</span>
  <span class="hljs-attribute">font-weight</span>: revert;
}
</code></pre>
<p>在这个例子中，<code>.revert-demo</code> 元素会将 <code>font-weight</code> 恢复到 <strong>浏览器默认值</strong> (<code>bold</code>)，因为它撤销了作者样式表中的 <code>normal</code> 声明。</p>
<h2 data-id="heading-9">✅ 总结与应用建议</h2>

























<table><thead><tr><th align="left">关键字</th><th align="left">记忆点</th><th align="left">应用场景</th></tr></thead><tbody><tr><td align="left"><strong><code>initial</code></strong></td><td align="left"><strong>“绝对初始”</strong></td><td align="left">确保属性值是其 CSS 规范定义的<strong>原始默认值</strong>，不考虑上下文。</td></tr><tr><td align="left"><strong><code>unset</code></strong></td><td align="left"><strong>“智能重置”</strong></td><td align="left">恢复属性的<strong>自然继承行为</strong>（可继承则 <code>inherit</code>，不可继承则 <code>initial</code>）。</td></tr><tr><td align="left"><strong><code>revert</code></strong></td><td align="left"><strong>“撤销”</strong></td><td align="left">撤销作者样式，<strong>恢复到浏览器默认或用户样式</strong>。常用于希望保持浏览器默认外观的元素。</td></tr></tbody></table>
<p><strong>什么时候用哪个？</strong></p>
<ul>
<li>如果您想确保一个属性值是<strong>固定的、明确的 CSS 初始值</strong>，使用 <code>initial</code>。</li>
<li>如果您想让一个属性<strong>遵循其固有的继承规则</strong>（即，可继承的就继承，不可继承的就使用初始值），使用 <code>unset</code>。</li>
<li>如果您想<strong>撤销您的样式对某个元素默认外观的覆盖</strong>，恢复到浏览器提供的默认样式，使用 <code>revert</code>。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>