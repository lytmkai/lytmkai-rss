<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Elasticsearch：交易搜索 - MCP]]></title>    <link>https://juejin.cn/post/7605041556656177161</link>    <guid>https://juejin.cn/post/7605041556656177161</guid>    <pubDate>2026-02-10T13:59:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605041556656177161" data-draft-id="7605030650279460910" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Elasticsearch：交易搜索 - MCP"/> <meta itemprop="keywords" content="Elasticsearch"/> <meta itemprop="datePublished" content="2026-02-10T13:59:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Elasticsearch"/> <meta itemprop="url" content="https://juejin.cn/user/2612095360441448"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Elasticsearch：交易搜索 - MCP
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2612095360441448/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Elasticsearch
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T13:59:23.000Z" title="Tue Feb 10 2026 13:59:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/754f24c6612e467892dc71dde19da53b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336911&amp;x-signature=N6f0JpkKNABlVyAJ2%2F%2BOqhM5nlk%3D" alt="" loading="lazy"/></p>
<p>在今天的文章里，我们来展示一下如何使用 MCP 来进行交易搜索。</p>
<h2 data-id="heading-0">安装</h2>
<h3 data-id="heading-1">Elasticsearch 及 Kibana</h3>
<p> 如果你还没有安装好自己的 Elasticsearch 及 Kibana，那么请参考一下的文章来进行安装：</p>
<ul>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F99413578" title="https://elasticstack.blog.csdn.net/article/details/99413578" target="_blank" ref="nofollow noopener noreferrer">如何在 Linux，MacOS 及 Windows 上进行安装 Elasticsearch</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F99433732" title="https://elasticstack.blog.csdn.net/article/details/99433732" target="_blank" ref="nofollow noopener noreferrer">Kibana：如何在 Linux，MacOS 及 Windows 上安装 Elastic 栈中的 Kibana</a></p>
</li>
</ul>
<p>在安装的时候，请选择 <strong>Elastic Stack 8.x/9.x</strong> 进行安装。在安装的时候，我们可以看到如下的安装信息：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06564f0546434f998670d3dfb57d692c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336911&amp;x-signature=NrOi7Cxm9RMPDNDXmZC82WtmDOg%3D" alt="" loading="lazy"/>​​</p>
<p>在本文中，我们使用 Elastic Stack 9.1.2 来进行展示。</p>
<h2 data-id="heading-2">启动白金试用</h2>
<p>我们需要使用到内置的 ELSER 模型来向量化我们的数据。我们需要启动白金试用：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b27339ef8e34bc8820764b7cf80b921~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336911&amp;x-signature=46C%2BuP8wTbfC1fX0X0SuWE384N4%3D" alt="" loading="lazy"/>​​</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/533d8731b1234203afa2a4eac92966c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336911&amp;x-signature=aQY7zgOM%2BKuxnMsjs7SZa11px%2FI%3D" alt="" loading="lazy"/>​​</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de3bf3ba134d4de08e11f526c363173a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336911&amp;x-signature=MJzKt5jo6lR3grHLckIJL5HX6KY%3D" alt="" loading="lazy"/>​​</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/784aea36ee0c4a76bb4b53ff7e62bf65~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336911&amp;x-signature=RhN3LBwDSRnoB%2BS5Iorb14oxckA%3D" alt="" loading="lazy"/>​​</p>
<p>这样就启动了白金试用。</p>
<h3 data-id="heading-3">下载代码</h3>
<p>我们按照如下的方式来下载代码：</p>
<pre><code class="hljs language-bash" lang="bash">`git <span class="hljs-built_in">clone</span> https://github.com/liu-xiao-guo/transaction_search_mcp`AI写代码
</code></pre>
<p>我们可以看到如下的文件：</p>
<pre><code class="hljs language-markdown" lang="markdown">`

<span class="hljs-bullet">1.</span>  $ pwd
<span class="hljs-bullet">2.</span>  /Users/liuxg/python/transaction<span class="hljs-emphasis">_search_</span>mcp
<span class="hljs-bullet">3.</span>  $ ls -al
<span class="hljs-bullet">4.</span>  total 32
<span class="hljs-bullet">5.</span>  drwxr-xr-x  11 liuxg  staff   352 Feb 10 14:12 .
<span class="hljs-bullet">6.</span>  drwxr-xr-x@ 38 liuxg  staff  1216 Feb 10 14:12 ..
<span class="hljs-bullet">7.</span>  -rw-r--r--   1 liuxg  staff   838 Feb 10 14:12 .env.example
<span class="hljs-bullet">8.</span>  drwxr-xr-x  12 liuxg  staff   384 Feb 10 14:12 .git
<span class="hljs-bullet">9.</span>  -rw-r--r--   1 liuxg  staff  4050 Feb 10 14:12 .gitignore
<span class="hljs-bullet">10.</span>  -rw-r--r--   1 liuxg  staff  4501 Feb 10 14:12 README.md
<span class="hljs-bullet">11.</span>  drwxr-xr-x   4 liuxg  staff   128 Feb 10 14:12 docs
<span class="hljs-bullet">12.</span>  drwxr-xr-x   4 liuxg  staff   128 Feb 10 14:12 requirements
<span class="hljs-bullet">13.</span>  drwxr-xr-x   6 liuxg  staff   192 Feb 10 14:12 scripts
<span class="hljs-bullet">14.</span>  drwxr-xr-x   5 liuxg  staff   160 Feb 10 14:12 src
<span class="hljs-bullet">15.</span>  drwxr-xr-x   3 liuxg  staff    96 Feb 10 14:12 tests

`AI写代码![](<span class="hljs-link">https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png</span>)
</code></pre>
<p>我们把 .env.example 拷贝到 .env 文件中去：</p>
<pre><code class="hljs language-bash" lang="bash">`

1.  <span class="hljs-comment"># Copy environment template</span>
2.  <span class="hljs-built_in">cp</span> .env.example .<span class="hljs-built_in">env</span>

4.  <span class="hljs-comment"># Edit .env with your configuration</span>
5.  <span class="hljs-comment"># - Elasticsearch URL and credentials</span>
6.  <span class="hljs-comment"># - OpenAI API key (for LLM client)</span>

`AI写代码
</code></pre>
<p><strong>.env</strong></p>
<pre><code class="hljs language-ini" lang="ini">`

1.  <span class="hljs-comment"># Elasticsearch Configuration</span>
<span class="hljs-attr">2.  ELASTICSEARCH_HOST</span>=https://localhost:<span class="hljs-number">9200</span>
<span class="hljs-attr">3.  ELASTICSEARCH_USERNAME</span>=elastic
<span class="hljs-attr">4.  ELASTICSEARCH_PASSWORD</span>=LYXAfNkSab8QwsbrriYN
<span class="hljs-attr">5.  ELASTICSEARCH_API_KEY</span>=X3NZeFJwd0Itb1hyWHlSejg4c3c6bHdwWGhaVTRBRTA1WnF1TUlUd1c2dw==
<span class="hljs-attr">6.  ELASTICSEARCH_INDEX</span>=banking_transactions

<span class="hljs-attr">8.  OPEN_AI_KEY</span>=&lt;YourOpenAIKey&gt;

`AI写代码
</code></pre>

<pre><code class="hljs language-bash" lang="bash">`

1.  transaction_search_mcp/
2.  ├── src/                          <span class="hljs-comment"># Source code</span>
3.  │   ├── server/                   <span class="hljs-comment"># MCP server implementation</span>
4.  │   │   └── server.py            <span class="hljs-comment"># Main MCP server with transaction search tools</span>
5.  │   └── clients/                 <span class="hljs-comment"># Client applications</span>
6.  │       ├── chat_client.py       <span class="hljs-comment"># Basic Streamlit chat interface</span>
7.  │       └── chat_client_llm.py   <span class="hljs-comment"># Enhanced LLM-powered chat client</span>
8.  ├── scripts/                     <span class="hljs-comment"># Setup and utility scripts</span>
9.  │   ├── setup_elasticsearch.py   <span class="hljs-comment"># Basic Elasticsearch setup with test data</span>
10.  │   ├── setup_elasticsearch_llm.py <span class="hljs-comment"># Enhanced setup with realistic test data</span>
11.  │   ├── run_chat.py             <span class="hljs-comment"># Launch basic chat client</span>
12.  │   └── run_llm_chat.py         <span class="hljs-comment"># Launch LLM-powered chat client</span>
13.  ├── tests/                       <span class="hljs-comment"># Test files</span>
14.  │   └── test_server.py          <span class="hljs-comment"># Comprehensive server tests</span>
15.  ├── docs/                        <span class="hljs-comment"># Documentation</span>
16.  │   ├── README.md               <span class="hljs-comment"># Basic implementation docs</span>
17.  │   └── README_LLM.md           <span class="hljs-comment"># LLM-enhanced version docs</span>
18.  ├── requirements/                <span class="hljs-comment"># Dependencies</span>
19.  │   ├── requirements.txt        <span class="hljs-comment"># Server dependencies</span>
20.  │   └── client_requirements.txt <span class="hljs-comment"># Client dependencies</span>
21.  ├── .<span class="hljs-built_in">env</span>                        <span class="hljs-comment"># Environment variables (not in git)</span>
22.  ├── .env.example               <span class="hljs-comment"># Environment template</span>
23.  └── .gitignore                 <span class="hljs-comment"># Git ignore rules</span>

`AI写代码![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)
</code></pre>
<h3 data-id="heading-4">创建虚拟环境</h3>
<p>我们使用如下的命令：</p>
<pre><code class="hljs language-bash" lang="bash">`

1.  $ python -m venv .venv
2.  $ <span class="hljs-built_in">source</span> .venv/bin/activate
3.  (.venv) $ <span class="hljs-comment"># Server dependencies</span>
4.  pip install -r requirements/requirements.txt

6.  <span class="hljs-comment"># Client dependencies (for chat interfaces)</span>
7.  pip install -r requirements/client_requirements.txt

`AI写代码
</code></pre>
<h3 data-id="heading-5">设置 Elasticsearch</h3>
<p>我们运行如下的命令：</p>
<pre><code class="hljs language-bash" lang="bash">`python scripts/setup_elasticsearch.py`AI写代码
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/836ac43b887d4b848c9e9c2dfcd1d104~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336911&amp;x-signature=Jf30xywxVzFe4btl3U2GgQum0ck%3D" alt="" loading="lazy"/>​</p>
<p>我们可以到 Kibana 中进行查看：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/778df66dde8f44a7889a61e77b333a2d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336911&amp;x-signature=Iec%2FTHVpRKoGcHM13J%2BLUISfY70%3D" alt="" loading="lazy"/>​</p>
<p>我们可以看到有 500 个交易记录。其中的一个交易记录如下：</p>
<pre><code class="hljs language-bash" lang="bash">`GET banking_transactions/_doc/txn_000001`AI写代码
</code></pre>

<pre><code class="hljs language-bash" lang="bash">`

1.  {
2.    <span class="hljs-string">"_index"</span>: <span class="hljs-string">"banking_transactions"</span>,
3.    <span class="hljs-string">"_id"</span>: <span class="hljs-string">"txn_000001"</span>,
4.    <span class="hljs-string">"_version"</span>: 1,
5.    <span class="hljs-string">"_seq_no"</span>: 0,
6.    <span class="hljs-string">"_primary_term"</span>: 1,
7.    <span class="hljs-string">"found"</span>: <span class="hljs-literal">true</span>,
8.    <span class="hljs-string">"_source"</span>: {
9.      <span class="hljs-string">"transaction_id"</span>: <span class="hljs-string">"txn_000001"</span>,
10.      <span class="hljs-string">"account_id"</span>: <span class="hljs-string">"acc_001"</span>,
11.      <span class="hljs-string">"account_type"</span>: <span class="hljs-string">"savings"</span>,
12.      <span class="hljs-string">"transaction_date"</span>: <span class="hljs-string">"2026-01-16"</span>,
13.      <span class="hljs-string">"posted_date"</span>: <span class="hljs-string">"2026-01-17"</span>,
14.      <span class="hljs-string">"amount"</span>: -47.64,
15.      <span class="hljs-string">"currency"</span>: <span class="hljs-string">"USD"</span>,
16.      <span class="hljs-string">"description"</span>: <span class="hljs-string">"Home Depot - car_wash"</span>,
17.      <span class="hljs-string">"memo"</span>: <span class="hljs-string">"Purchase at Home Depot"</span>,
18.      <span class="hljs-string">"reference"</span>: <span class="hljs-string">"REF271525"</span>,
19.      <span class="hljs-string">"merchant"</span>: <span class="hljs-string">"Home Depot"</span>,
20.      <span class="hljs-string">"category"</span>: <span class="hljs-string">"gas"</span>,
21.      <span class="hljs-string">"subcategory"</span>: <span class="hljs-string">"car_wash"</span>,
22.      <span class="hljs-string">"transaction_type"</span>: <span class="hljs-string">"fee"</span>,
23.      <span class="hljs-string">"location"</span>: {
24.        <span class="hljs-string">"city"</span>: <span class="hljs-string">"Austin"</span>,
25.        <span class="hljs-string">"state"</span>: <span class="hljs-string">"TX"</span>,
26.        <span class="hljs-string">"country"</span>: <span class="hljs-string">"US"</span>,
27.        <span class="hljs-string">"postal_code"</span>: <span class="hljs-string">"73301"</span>,
28.        <span class="hljs-string">"coordinates"</span>: {
29.          <span class="hljs-string">"lat"</span>: 33.40455,
30.          <span class="hljs-string">"lon"</span>: -96.542508
31.        }
32.      },
33.      <span class="hljs-string">"tags"</span>: [
34.        <span class="hljs-string">"transportation"</span>
35.      ],
36.      <span class="hljs-string">"balance_after"</span>: 3929.25,
37.      <span class="hljs-string">"is_pending"</span>: <span class="hljs-literal">false</span>,
38.      <span class="hljs-string">"is_recurring"</span>: <span class="hljs-literal">false</span>,
39.      <span class="hljs-string">"created_at"</span>: <span class="hljs-string">"2026-02-10T14:34:40.767Z"</span>,
40.      <span class="hljs-string">"updated_at"</span>: <span class="hljs-string">"2026-02-10T14:34:40.767Z"</span>
41.    }
42.  }

`AI写代码![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)
</code></pre>
<p>如果我们希望使用 LLM 来帮我们生成相应的模拟数据，我们可以运行：</p>
<pre><code class="hljs language-bash" lang="bash">`python scripts/setup_elasticsearch_llm.py`AI写代码
</code></pre>
<p>这些数据将更符合现实的实际交易。</p>
<h3 data-id="heading-6">运行 MCP 服务器</h3>
<p>我们使用如下的命令来运行服务器：</p>
<pre><code class="hljs language-vbscript" lang="vbscript">`

<span class="hljs-number">1.</span>  # Start MCP <span class="hljs-built_in">server</span>
<span class="hljs-number">2.</span>  python src/<span class="hljs-built_in">server</span>/<span class="hljs-built_in">server</span>.py

`AI写代码
</code></pre>
<h3 data-id="heading-7">运行客户端</h3>
<p>我们运行如下的命令：</p>
<pre><code class="hljs language-bash" lang="bash">`python scripts/run_chat.py`AI写代码
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7df938223744081a4003adf8f3f4db9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336911&amp;x-signature=5Sz%2BN66qFVJpZl08cXr7ReoFdVg%3D" alt="" loading="lazy"/>​</p>
<p>我们可以看到如上的界面。我们可以尝试如下的搜索：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7b5340ff972475fbe6689881a32c416~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336911&amp;x-signature=2BxDxa%2FKIM%2FftKYBaQxtwsBaWXQ%3D" alt="" loading="lazy"/>​</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c620273b61304fcdb26bcd92c2e3c737~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336911&amp;x-signature=ubJRkdTtEMazU65bFQGQEywQMeU%3D" alt="" loading="lazy"/>​</p>
<p>我们可以使用由LLM 驱动的界面：</p>
<pre><code class="hljs language-bash" lang="bash">`python scripts/run_llm_chat.py`AI写代码
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce140e70d2bd4ad993797392dbd6e3a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336911&amp;x-signature=0gzOzJcYW3p8PwpIJsM%2BhYy8KeU%3D" alt="" loading="lazy"/></p>
<p>源码请在地址 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fliu-xiao-guo%2Ftransaction_search_mcp" title="https://github.com/liu-xiao-guo/transaction_search_mcp" target="_blank" ref="nofollow noopener noreferrer">github.com/liu-xiao-gu…</a> 下载。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端向架构突围系列 - 设计与落地 [9 - 3]：BFF (Backend for Frontend) 层与 Serverless 的架构融合]]></title>    <link>https://juejin.cn/post/7605041556656898057</link>    <guid>https://juejin.cn/post/7605041556656898057</guid>    <pubDate>2026-02-11T01:34:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605041556656898057" data-draft-id="7605097326727430190" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端向架构突围系列 - 设计与落地 [9 - 3]：BFF (Backend for Frontend) 层与 Serverless 的架构融合"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-11T01:34:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端王壮壮"/> <meta itemprop="url" content="https://juejin.cn/user/4473272506789485"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端向架构突围系列 - 设计与落地 [9 - 3]：BFF (Backend for Frontend) 层与 Serverless 的架构融合
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4473272506789485/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端王壮壮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T01:34:23.000Z" title="Wed Feb 11 2026 01:34:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><blockquote>
<p><strong>写在前面</strong></p>
<p>传统的开发模式中，前端是后端的“消费者”。后端喂什么，我们就吃什么。</p>
<p>这种模式在移动端、Web 端、小程序多端并行的今天，效率极低。<strong>BFF (Backend for Frontend)</strong> 的核心哲学是：<strong>谁消费，谁负责。</strong> 既然 UI 是前端设计的，那么为了支撑这个 UI 而存在的数据聚合层，也理应由前端来主导。</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2c258e2b4f9471487e3c8974ab71c21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv546L5aOu5aOu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771378488&amp;x-signature=QH7LLSfGeMSIWqdZNdikSyTZvY4%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-0">一、 为什么前端要搞 BFF？（告别“接口乞讨”）</h2>
<p>在没有 BFF 的日子里，前端架构师经常面临三个窘境：</p>
<ol>
<li><strong>数据臃肿：</strong> 后端为了通用，一个接口返回 2MB 的 JSON，前端只要其中一个 <code>id</code>。</li>
<li><strong>请求地狱：</strong> 为了渲染一个首页，前端要在 <code>useEffect</code> 里调 A 接口拿 <code>userId</code>，再调 B 接口拿详情，最后调 C 接口拿评论。</li>
<li><strong>逻辑混杂：</strong> 前端为了适配后端奇怪的字段名，代码里充斥着 <code>data.list[0].user_info_v2.name || '匿名'</code> 这种防错逻辑。</li>
<li><strong>脆弱的“防御性代码”：</strong> 为了防止后端返回 <code>null</code> 或字段缺失，前端代码里充斥着大量的可选链（Optional Chaining）和硬编码的默认值。这其实是**“代码腐烂”**的开始——你根本不敢删掉这些逻辑，因为你不知道哪天接口又会吐出奇怪的数据</li>
<li><strong>多端兼容噩梦：</strong> 同样的后端接口，Web 端需要显示 <code>YYYY-MM-DD</code>，小程序需要显示 <code>MM月DD日</code>，App 需要显示 <code>3分钟前</code>。如果这些逻辑全写在前端，每增加一个端，业务逻辑就要重写一遍。</li>
</ol>
<p><strong>BFF 的出现，就是为了在前端和微服务之间，加一层“数据洗涤机”。</strong></p>
<hr/>
<h2 data-id="heading-1">二、 BFF 的三张王牌：聚合、转换、适配</h2>
<p>一个设计良好的 BFF 层，应该承担以下三个核心职责：</p>
<h3 data-id="heading-2">2.1 接口聚合 (Aggregator)</h3>
<p>将原本需要前端发起 5 次的网络请求，在 BFF 层合并。BFF 与后端微服务走的是内网通信（RPC 或高带宽 HTTP），速度远快于移动端弱网环境下的多次请求。</p>
<h3 data-id="heading-3">2.2 数据瘦身与洗涤 (Formatter)</h3>
<p>后端给的字段是 <code>user_head_img_url_v2_stable</code>，BFF 转换成 <code>avatar</code>。后端给了 100 个字段，BFF 只吐给前端渲染需要的 5 个。</p>
<h3 data-id="heading-4">2.3 跨端重用 (Adapter)</h3>
<ul>
<li><strong>Web 端：</strong> 返回完整的 HTML（SSR）或大而全的 JSON。</li>
<li><strong>App 端：</strong> 返回极致压缩的二进制数据或精简 JSON。</li>
<li><strong>BFF 逻辑：</strong> 核心业务逻辑在 BFF 内部共享，根据请求头自动适配输出格式。</li>
</ul>
<hr/>
<h2 data-id="heading-5">三、 Serverless：BFF 的“完美外壳”</h2>
<p>很多前端架构师不敢推行 BFF，是因为害怕**“运维地狱”**：谁来配 Nginx？服务器挂了谁修？内存泄露了怎么办？</p>
<p><strong>Serverless (无服务器架构)</strong> 的出现，彻底解开了这个心结。</p>
<h3 data-id="heading-6">3.1 为什么是 FaaS + BFF？</h3>
<ul>
<li><strong>免运维：</strong> 前端只写函数（Function），不看服务器。部署一个 BFF 就像提交一段 JS 代码一样简单。</li>
<li><strong>弹性伸缩：</strong> 只有在接口被调用时才计费。深夜没人访问时，成本几乎为零。</li>
<li><strong>按需交付：</strong> 一个页面对应一个云函数（SFF, Serverless For Frontend），边界清晰，互不干扰。</li>
</ul>
<hr/>
<h2 data-id="heading-7">四、 深度融合：BFF + Serverless 的落地挑战</h2>
<p>虽然听起来很美，但在实际架构落地中，你需要处理以下深水区问题：</p>
<h3 data-id="heading-8">4.1 响应延迟 (Cold Start)</h3>
<p>Serverless 函数在久未调用后会有“冷启动”时间。</p>
<ul>
<li><strong>架构对策：</strong> 对实时性要求极高的接口，开启“预热”或“预留实例”；或者使用 Node.js 运行时较轻量级的框架（如 Midway.js 或 Nitro）。</li>
</ul>
<h3 data-id="heading-9">4.2 链路追踪 (Tracing)</h3>
<p>当页面报错时，问题可能出在：前端 -&gt; BFF -&gt; 后端微服务 A -&gt; 数据库。</p>
<ul>
<li><strong>架构决策：</strong> 必须引入全链路 Trace ID。在 BFF 层生成统一的 <code>X-Trace-Id</code> 贯穿始终。</li>
</ul>
<h3 data-id="heading-10">4.3 接口定义冲突</h3>
<p>如果 BFF 是前端写的，后端改了微服务接口，BFF 怎么知道？</p>
<ul>
<li><strong>最佳实践：</strong> 推动后端导出 <strong>OpenAPI (Swagger)</strong> 或使用 <strong>gRPC</strong>。BFF 层通过脚本自动生成类型定义，利用 TypeScript 在编译期就发现接口变动。</li>
</ul>
<hr/>
<h2 data-id="heading-11">五、 架构决策：选型 ROI 分析</h2>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>架构收益</mtext><mo>=</mo><mfrac><mrow><mo stretchy="false">(</mo><mtext>用户体验提升</mtext><mo>+</mo><mtext>前端开发效率</mtext><mo stretchy="false">)</mo></mrow><mtext>运维复杂度的增加</mtext></mfrac></mrow><annotation encoding="application/x-tex">架构收益 = \frac{(用户体验提升 + 前端开发效率)}{运维复杂度的增加}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord cjk_fallback">架构收益</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.355em;vertical-align:-0.345em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">运维复杂度的增加</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord cjk_fallback mtight">用户体验提升</span><span class="mbin mtight">+</span><span class="mord cjk_fallback mtight">前端开发效率</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
<p>在 Serverless 场景下，分母被大幅削减，因此 BFF 几乎成为了中大型前端项目的<strong>标配</strong>。</p>





























<table><thead><tr><th><strong>模式</strong></th><th><strong>适用场景</strong></th><th><strong>开发成本</strong></th><th><strong>运维难度</strong></th></tr></thead><tbody><tr><td><strong>传统模式</strong></td><td>简单项目，后端接口已经很完美</td><td>低</td><td>极低</td></tr><tr><td><strong>Node.js BFF</strong></td><td>复杂业务，前端团队有后端背景</td><td>中</td><td>高 (需管集群)</td></tr><tr><td><strong>Serverless BFF</strong></td><td><strong>主流推荐</strong>，追求极致开发效率</td><td><strong>低 (只写函数)</strong></td><td><strong>极低 (托管)</strong></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-12">结语：从“画饼”到“造饼”</h2>
<p>BFF 和 Serverless 的结合，是前端架构师**从“UI 实现者”向“全链路设计者”**跨越的关键一步。当你不再受限于后端接口的形状，你才能真正从全局视角去优化性能和用户体验。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java实现PDF合并、PDF拆分、PDF加水印等PDF文档处理的技术方案与实践]]></title>    <link>https://juejin.cn/post/7605042125298728994</link>    <guid>https://juejin.cn/post/7605042125298728994</guid>    <pubDate>2026-02-10T14:03:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605042125298728994" data-draft-id="7604881286038143028" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java实现PDF合并、PDF拆分、PDF加水印等PDF文档处理的技术方案与实践"/> <meta itemprop="keywords" content="后端,前端"/> <meta itemprop="datePublished" content="2026-02-10T14:03:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户3891775626958"/> <meta itemprop="url" content="https://juejin.cn/user/3435329307550872"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java实现PDF合并、PDF拆分、PDF加水印等PDF文档处理的技术方案与实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3435329307550872/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户3891775626958
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T14:03:07.000Z" title="Tue Feb 10 2026 14:03:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Java实现PDF批量处理：合并、拆分、加水印的技术方案与实践</h2>
<blockquote>
<p>在日常开发中，PDF文档处理是一个高频需求。无论是合同管理系统需要合并多份PDF，还是报表系统需要按页拆分，亦或是给机密文档添加水印，都需要一套可靠的PDF处理方案。本文将分享基于Java技术栈实现PDF批量处理的核心思路与代码实践。</p>
</blockquote>
<h3 data-id="heading-1">一、技术选型</h3>
<p>Java生态中处理PDF的库主要有以下几个：</p>
<p>| 库名 | 特点 | 适用场景 |</p>
<p>|------|------|----------|</p>
<p>| Apache PDFBox | 开源免费，功能全面 | 合并、拆分、水印、文本提取 |</p>
<p>| iText | 功能强大，商用需授权 | 复杂PDF生成、表单处理 |</p>
<p>| OpenPDF | iText的开源分支 | 轻量级PDF生成 |</p>
<p>综合考虑开源协议和功能覆盖度，<strong>Apache PDFBox</strong> 是大多数项目的首选。</p>
<h3 data-id="heading-2">二、Maven依赖配置</h3>
<pre><code class="hljs language-xml" lang="xml">
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.pdfbox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>pdfbox<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.27<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

</code></pre>
<h3 data-id="heading-3">三、PDF合并实现</h3>
<h4 data-id="heading-4">3.1 核心思路</h4>
<p>PDF合并的本质是将多个PDF文档的页面按顺序追加到一个新文档中。PDFBox提供了<code>PDFMergerUtility</code>工具类来简化这个过程。</p>
<h4 data-id="heading-5">3.2 代码实现</h4>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">import</span> org.apache.pdfbox.multipdf.PDFMergerUtility;

<span class="hljs-keyword">import</span> java.io.*;

<span class="hljs-keyword">import</span> java.util.List;

  


<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PdfMergeService</span> {

  


<span class="hljs-comment">/**

* 合并多个PDF文件

* <span class="hljs-doctag">@param</span> inputStreams PDF文件输入流列表

* <span class="hljs-doctag">@param</span> outputPath 输出文件路径

*/</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">mergePdf</span><span class="hljs-params">(List&lt;InputStream&gt; inputStreams, String outputPath)</span>

<span class="hljs-keyword">throws</span> IOException {

<span class="hljs-type">PDFMergerUtility</span> <span class="hljs-variable">merger</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PDFMergerUtility</span>();

merger.setDestinationFileName(outputPath);

  


<span class="hljs-keyword">for</span> (InputStream is : inputStreams) {

merger.addSource(is);

}

  


<span class="hljs-comment">// 执行合并，MemoryUsageSetting可控制内存使用</span>

merger.mergeDocuments(

org.apache.pdfbox.io.MemoryUsageSetting.setupMainMemoryOnly()

);

}

}

</code></pre>
<h4 data-id="heading-6">3.3 注意事项</h4>
<ul>
<li>
<p><strong>内存管理</strong>：处理大文件时建议使用<code>setupTempFileOnly()</code>将临时数据写入磁盘，避免OOM</p>
</li>
<li>
<p><strong>文件顺序</strong>：合并顺序取决于<code>addSource</code>的调用顺序，前端可通过拖拽排序来控制</p>
</li>
<li>
<p><strong>书签处理</strong>：合并后原有书签可能丢失，如需保留需额外处理<code>PDDocumentOutline</code></p>
</li>
</ul>
<h3 data-id="heading-7">四、PDF拆分实现</h3>
<h4 data-id="heading-8">4.1 按页码范围拆分</h4>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">import</span> org.apache.pdfbox.multipdf.Splitter;

<span class="hljs-keyword">import</span> org.apache.pdfbox.pdmodel.PDDocument;

  


<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PdfSplitService</span> {

  


<span class="hljs-comment">/**

* 按页码范围拆分PDF

* <span class="hljs-doctag">@param</span> inputStream 源PDF输入流

* <span class="hljs-doctag">@param</span> startPage 起始页（从1开始）

* <span class="hljs-doctag">@param</span> endPage 结束页

*/</span>

<span class="hljs-keyword">public</span> <span class="hljs-type">byte</span>[] splitByPageRange(InputStream inputStream,

<span class="hljs-type">int</span> startPage, <span class="hljs-type">int</span> endPage) <span class="hljs-keyword">throws</span> IOException {

  


<span class="hljs-keyword">try</span> (<span class="hljs-type">PDDocument</span> <span class="hljs-variable">document</span> <span class="hljs-operator">=</span> PDDocument.load(inputStream);

<span class="hljs-type">PDDocument</span> <span class="hljs-variable">newDoc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PDDocument</span>()) {

  


<span class="hljs-type">int</span> <span class="hljs-variable">totalPages</span> <span class="hljs-operator">=</span> document.getNumberOfPages();

<span class="hljs-comment">// 参数校验</span>

startPage = Math.max(<span class="hljs-number">1</span>, startPage);

endPage = Math.min(totalPages, endPage);

  


<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> startPage - <span class="hljs-number">1</span>; i &lt; endPage; i++) {

newDoc.addPage(document.getPage(i));

}

  


<span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">baos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();

newDoc.save(baos);

<span class="hljs-keyword">return</span> baos.toByteArray();

}

}

}

</code></pre>
<h4 data-id="heading-9">4.2 性能优化建议</h4>
<p>对于页数很多的PDF（如上千页），逐页操作可能较慢。可以考虑：</p>
<ul>
<li>
<p>使用<code>Splitter</code>类的<code>setSplitAtPage()</code>方法按固定页数批量拆分</p>
</li>
<li>
<p>对于仅需提取少量页面的场景，直接操作页面树比使用Splitter更高效</p>
</li>
</ul>
<h3 data-id="heading-10">五、PDF加水印实现</h3>
<h4 data-id="heading-11">5.1 文字水印核心代码</h4>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">import</span> org.apache.pdfbox.pdmodel.*;

<span class="hljs-keyword">import</span> org.apache.pdfbox.pdmodel.font.PDType1Font;

<span class="hljs-keyword">import</span> org.apache.pdfbox.pdmodel.graphics.state.PDExtendedGraphicsState;

<span class="hljs-keyword">import</span> org.apache.pdfbox.util.Matrix;

  


<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PdfWatermarkService</span> {

  


<span class="hljs-keyword">public</span> <span class="hljs-type">byte</span>[] addTextWatermark(InputStream input, String text,

<span class="hljs-type">float</span> opacity, <span class="hljs-type">float</span> rotation, <span class="hljs-type">float</span> fontSize) <span class="hljs-keyword">throws</span> IOException {

  


<span class="hljs-keyword">try</span> (<span class="hljs-type">PDDocument</span> <span class="hljs-variable">document</span> <span class="hljs-operator">=</span> PDDocument.load(input)) {

<span class="hljs-comment">// 遍历每一页添加水印</span>

<span class="hljs-keyword">for</span> (PDPage page : document.getPages()) {

<span class="hljs-type">PDPageContentStream</span> <span class="hljs-variable">cs</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PDPageContentStream</span>(

document, page,

PDPageContentStream.AppendMode.APPEND, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>

);

  


<span class="hljs-comment">// 设置透明度</span>

<span class="hljs-type">PDExtendedGraphicsState</span> <span class="hljs-variable">gs</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PDExtendedGraphicsState</span>();

gs.setNonStrokingAlphaConstant(opacity);

cs.setGraphicsStateParameters(gs);

  


<span class="hljs-comment">// 设置字体和颜色</span>

cs.setFont(PDType1Font.HELVETICA_BOLD, fontSize);

cs.setNonStrokingColor(<span class="hljs-number">200</span>, <span class="hljs-number">200</span>, <span class="hljs-number">200</span>); <span class="hljs-comment">// 浅灰色</span>

  


<span class="hljs-comment">// 计算页面中心位置</span>

<span class="hljs-type">float</span> <span class="hljs-variable">pageWidth</span> <span class="hljs-operator">=</span> page.getMediaBox().getWidth();

<span class="hljs-type">float</span> <span class="hljs-variable">pageHeight</span> <span class="hljs-operator">=</span> page.getMediaBox().getHeight();

<span class="hljs-type">float</span> <span class="hljs-variable">cx</span> <span class="hljs-operator">=</span> pageWidth / <span class="hljs-number">2</span>;

<span class="hljs-type">float</span> <span class="hljs-variable">cy</span> <span class="hljs-operator">=</span> pageHeight / <span class="hljs-number">2</span>;

  


<span class="hljs-comment">// 旋转变换</span>

cs.beginText();

<span class="hljs-type">Matrix</span> <span class="hljs-variable">matrix</span> <span class="hljs-operator">=</span> Matrix.getRotateInstance(

Math.toRadians(rotation), cx, cy

);

cs.setTextMatrix(matrix);

cs.showText(text);

cs.endText();

cs.close();

}

  


<span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">baos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();

document.save(baos);

<span class="hljs-keyword">return</span> baos.toByteArray();

}

}

}

</code></pre>
<h4 data-id="heading-12">5.2 中文水印的坑</h4>
<p>PDFBox默认的<code>PDType1Font</code>不支持中文字符，直接使用会导致乱码或报错。解决方案：</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-comment">// 加载系统中文字体</span>

<span class="hljs-type">PDType0Font</span> <span class="hljs-variable">chineseFont</span> <span class="hljs-operator">=</span> PDType0Font.load(document,

<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-string">"/usr/share/fonts/wqy-microhei/wqy-microhei.ttc"</span>), <span class="hljs-number">0</span>);

cs.setFont(chineseFont, fontSize);

</code></pre>
<p><strong>服务器部署时需确保安装了中文字体</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">
<span class="hljs-comment"># CentOS/RHEL</span>

sudo yum install -y wqy-microhei-fonts

  


<span class="hljs-comment"># Ubuntu/Debian</span>

sudo apt-get install -y fonts-wqy-microhei

</code></pre>
<h3 data-id="heading-13">六、封装为REST API</h3>
<p>在Spring Boot项目中，可以将上述功能封装为统一的REST接口：</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-meta">@RestController</span>

<span class="hljs-meta">@RequestMapping("/api/document/pdf")</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PdfController</span> {

  


<span class="hljs-meta">@PostMapping("/merge")</span>

<span class="hljs-keyword">public</span> ResponseEntity&lt;?&gt; merge(

<span class="hljs-meta">@RequestParam("files")</span> MultipartFile[] files) {

<span class="hljs-comment">// 调用合并服务</span>

}

  


<span class="hljs-meta">@PostMapping("/split")</span>

<span class="hljs-keyword">public</span> ResponseEntity&lt;?&gt; split(

<span class="hljs-meta">@RequestParam("file")</span> MultipartFile file,

<span class="hljs-meta">@RequestParam("startPage")</span> <span class="hljs-type">int</span> startPage,

<span class="hljs-meta">@RequestParam("endPage")</span> <span class="hljs-type">int</span> endPage) {

<span class="hljs-comment">// 调用拆分服务</span>

}

  


<span class="hljs-meta">@PostMapping("/watermark")</span>

<span class="hljs-keyword">public</span> ResponseEntity&lt;?&gt; watermark(

<span class="hljs-meta">@RequestParam("file")</span> MultipartFile file,

<span class="hljs-meta">@RequestParam("text")</span> String text,

<span class="hljs-meta">@RequestParam(defaultValue = "0.5")</span> <span class="hljs-type">float</span> opacity) {

<span class="hljs-comment">// 调用水印服务</span>

}

}

</code></pre>
<h3 data-id="heading-14">七、实际效果</h3>
<p>如果你不想自己搭建服务，也可以直接使用现成的在线工具来处理PDF。比如 <a href="https://link.juejin.cn?target=https%3A%2F%2F5555api.com" target="_blank" title="https://5555api.com" ref="nofollow noopener noreferrer">轻语API开放平台</a> 提供了免费的 <a href="https://link.juejin.cn?target=https%3A%2F%2F5555api.com%2Ftools%2Fpdf-processor.html" target="_blank" title="https://5555api.com/tools/pdf-processor.html" ref="nofollow noopener noreferrer">PDF在线处理工具</a>，支持合并、拆分、加水印、转Word、转图片等功能，底层就是基于上述技术方案实现的。</p>
<p>对于需要批量处理的场景，也可以通过API接口集成到自己的系统中，省去重复造轮子的成本。</p>
<h3 data-id="heading-15">八、总结</h3>
<p>| 功能 | 核心类/方法 | 难点 |</p>
<p>|------|------------|------|</p>
<p>| PDF合并 | PDFMergerUtility | 大文件内存管理 |</p>
<p>| PDF拆分 | PDDocument.getPage() | 页码边界校验 |</p>
<p>| PDF水印 | PDPageContentStream | 中文字体支持 |</p>
<p>PDF处理看似简单，但在生产环境中需要关注内存控制、字体兼容、并发处理等问题。希望本文的实践经验能帮助你少踩一些坑。</p>
<hr/>
<p><em>如果觉得有帮助，欢迎点赞收藏。有问题可以在评论区交流。</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[写给 JavaScript 初学者的 React 完全指南]]></title>    <link>https://juejin.cn/post/7604846849464320052</link>    <guid>https://juejin.cn/post/7604846849464320052</guid>    <pubDate>2026-02-10T10:52:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604846849464320052" data-draft-id="7604846849464303668" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="写给 JavaScript 初学者的 React 完全指南"/> <meta itemprop="keywords" content="React.js"/> <meta itemprop="datePublished" content="2026-02-10T10:52:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="不会敲代码1"/> <meta itemprop="url" content="https://juejin.cn/user/1927884034804425"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            写给 JavaScript 初学者的 React 完全指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1927884034804425/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    不会敲代码1
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T10:52:20.000Z" title="Tue Feb 10 2026 10:52:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">写给 JavaScript 初学者的 React 完全指南</h2>
<h3 data-id="heading-1">引言：从零开始，我们一起学 React</h3>
<p>如果你是 JavaScript 初学者，觉得 React 很难懂，别担心！我曾经也是从零开始学习的。今天，我用最简单的方式，结合我自己写的代码，带你一步步理解 React 的核心概念。保证每个概念都有代码示例，而且都是我自己学习时写的真实代码！</p>
<h3 data-id="heading-2">第一章：什么是 JSX？比 HTML 还简单的语法</h3>
<h4 data-id="heading-3">1.1 JSX 就像在 JavaScript 里写 HTML</h4>
<p>想象一下，你可以在 JavaScript 文件中直接写 HTML，这就是 JSX！</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 看看我写的代码，是不是很像 HTML？</span>
<span class="hljs-keyword">const</span> element = <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>JSX 是React 中用于描述用户界面的语法扩展<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span>
</code></pre>
<p><strong>简单理解</strong>：JSX 就是在 JavaScript 里面写 HTML 标签。</p>
<h4 data-id="heading-4">1.2 为什么要用 JSX？一个对比你就懂了</h4>
<h5 data-id="heading-5">传统方式（很复杂）：</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 不用 JSX，创建元素需要这样：</span>
<span class="hljs-keyword">const</span> element = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'h2'</span>)
element.<span class="hljs-property">textContent</span> = <span class="hljs-string">'Hello World'</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(element)
</code></pre>
<h5 data-id="heading-6">使用 JSX（很简单）：</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用 JSX，直接写：</span>
<span class="hljs-keyword">const</span> element = <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Hello World<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span>
</code></pre>
<p>看到区别了吗？JSX 让创建页面元素变得跟写 HTML 一样简单！</p>
<h4 data-id="heading-7">1.3 JSX 的几个重要规则</h4>
<h5 data-id="heading-8">规则1：最外层只能有一个标签</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 错误写法（多个并列标签）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Wrong</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>标题<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>内容<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>
  )
}

<span class="hljs-comment">// ✅ 正确写法（用一个标签包裹起来）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Right</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>  {/* 这个 div 就像一个大盒子 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>标题<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>内容<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<h5 data-id="heading-9">规则2：用 className 代替 class</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 错误写法</span>
&lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"title"</span>&gt;<span class="hljs-title class_">Hello</span>&lt;/div&gt;

<span class="hljs-comment">// ✅ 正确写法</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"title"</span>&gt;</span>Hello<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
</code></pre>
<p><strong>为什么</strong>：因为 <code>class</code> 在 JavaScript 中是定义类的关键字，为了避免冲突，React 用 <code>className</code>。</p>
<h5 data-id="heading-10">规则3：JavaScript 表达式要放在 {} 里</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> name = <span class="hljs-string">'小明'</span>

<span class="hljs-comment">// 在 JSX 中使用 JavaScript 变量</span>
<span class="hljs-keyword">const</span> element = <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>你好，{name}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>
<span class="hljs-comment">// 渲染结果：&lt;h1&gt;你好，小明&lt;/h1&gt;</span>
</code></pre>
<h3 data-id="heading-11">第二章：React 组件 - 就像搭积木一样简单</h3>
<h4 data-id="heading-12">2.1 什么是组件？就是一个函数</h4>
<p>在 React 中，<strong>组件就是一个返回 JSX 的函数</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 定义一个最简单的组件</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Welcome</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>欢迎学习 React！<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>
}

<span class="hljs-comment">// 使用这个组件（就像使用 HTML 标签一样）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Welcome</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<h4 data-id="heading-13">2.2 为什么要用组件？看看我的掘金首页例子</h4>
<p>我模仿掘金首页写了一个例子，用组件化的思想来构建：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 我把一个完整的页面拆成了几个小部分：</span>

<span class="hljs-comment">// 1. 头部组件 - 专门负责显示网站标题</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">JuejinHeader</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">header</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>掘金首页<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span></span>
  )
}

<span class="hljs-comment">// 2. 文章列表组件 - 专门负责显示文章</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Articles</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>文章列表<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>React 入门教程<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>JavaScript 基础<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}

<span class="hljs-comment">// 3. 签到组件 - 专门负责签到功能</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Checkin</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>每日签到<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>点击签到<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}

<span class="hljs-comment">// 4. 主组件 - 把所有小组件组合起来</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      {/* 使用头部组件 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">JuejinHeader</span> /&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span>
        {/* 使用文章列表组件 */}
        <span class="hljs-tag">&lt;<span class="hljs-name">Articles</span> /&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">aside</span>&gt;</span>
          {/* 使用签到组件 */}
          <span class="hljs-tag">&lt;<span class="hljs-name">Checkin</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">aside</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<p><strong>组件化的好处</strong>：</p>
<ol>
<li><strong>可复用</strong>：<code>Checkin</code> 组件可以在其他页面使用</li>
<li><strong>好维护</strong>：修改签到功能时，只需要改 <code>Checkin</code> 组件</li>
<li><strong>分工明确</strong>：不同人可以负责不同组件</li>
</ol>
<h4 data-id="heading-14">2.3 组件命名的约定</h4>
<p>在 React 中，<strong>组件名必须以大写字母开头</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ✅ 正确：大写字母开头</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">MyComponent</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Hello<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}

<span class="hljs-comment">// ❌ 错误：小写字母开头（会被认为是 HTML 标签）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">mycomponent</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Hello<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}
</code></pre>
<h3 data-id="heading-15">第三章：useState - React 的"记忆"功能</h3>
<h4 data-id="heading-16">3.1 为什么需要状态？</h4>
<p>想象一下，你的网页需要记住一些信息，比如：</p>
<ul>
<li>用户是否登录</li>
<li>计数器当前的值</li>
<li>待办事项列表</li>
</ul>
<p>在 React 中，这些"记忆"就是通过 <strong>状态（state）</strong> 实现的。</p>
<h4 data-id="heading-17">3.2 useState 基本用法</h4>
<p>让我们一步步理解，看我写的登录状态例子：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 第一步：导入 useState</span>
<span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 第二步：使用 useState</span>
  <span class="hljs-comment">// 它返回一个数组，包含两个东西：</span>
  <span class="hljs-comment">// 1. 当前状态值（isLoggedIn）</span>
  <span class="hljs-comment">// 2. 修改状态的函数（setIsLoggedIn）</span>
  <span class="hljs-keyword">const</span> [isLoggedIn, setIsLoggedIn] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>)
  <span class="hljs-comment">// ↑ 初始值设为 false，表示未登录</span>
  
  <span class="hljs-comment">// 第三步：使用状态</span>
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      {/* 根据登录状态显示不同文字 */}
      {isLoggedIn ? <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>已登录<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span> : <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>未登录<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}
      
      {/* 点击按钮改变状态 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setIsLoggedIn(!isLoggedIn)}&gt;
        {isLoggedIn ? '退出登录' : '登录'}
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<p><strong>形象理解</strong>：</p>
<ul>
<li><code>isLoggedIn</code> 就像是一个"记忆盒子"，里面装着 <code>true</code> 或 <code>false</code></li>
<li><code>setIsLoggedIn</code> 就像是改变盒子内容的"遥控器"</li>
<li>当盒子里的内容改变时，页面会自动更新</li>
</ul>
<h4 data-id="heading-18">3.3 多个状态的管理</h4>
<p>在我的代码中，我管理了多个状态：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 1. 字符串状态 - 名字</span>
  <span class="hljs-keyword">const</span> [name, setName] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">'vue'</span>)
  <span class="hljs-comment">// name 初始值是 'vue'</span>
  
  <span class="hljs-comment">// 2. 数组状态 - 待办事项列表</span>
  <span class="hljs-keyword">const</span> [todos, setTodos] = <span class="hljs-title function_">useState</span>([
    { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'学习react'</span>, <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'学习vue'</span>, <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span> }
  ])
  
  <span class="hljs-comment">// 3. 布尔状态 - 是否登录</span>
  <span class="hljs-keyword">const</span> [isLoggedIn, setIsLoggedIn] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>)
  
  <span class="hljs-comment">// 每个状态都有自己的"记忆盒子"和"遥控器"</span>
  <span class="hljs-comment">// 它们之间互不干扰</span>
}
</code></pre>
<h4 data-id="heading-19">3.4 自动更新的魔法</h4>
<p>看看我这个有趣的例子：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [name, setName] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">'vue'</span>)
  
  <span class="hljs-comment">// 3秒后自动改变名字</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">setName</span>(<span class="hljs-string">'react'</span>)  <span class="hljs-comment">// 从 'vue' 变成 'react'</span>
  }, <span class="hljs-number">3000</span>)
  
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello {name}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>
}
</code></pre>
<p><strong>会发生什么</strong>：</p>
<ol>
<li>页面第一次显示：Hello vue</li>
<li>3秒后，自动变成：Hello react</li>
<li><strong>不需要手动刷新页面</strong>，React 会自动更新！</li>
</ol>
<p>这就是 React 最神奇的地方：<strong>状态改变，UI 自动更新</strong>。</p>
<h3 data-id="heading-20">第四章：条件渲染和列表渲染</h3>
<h4 data-id="heading-21">4.1 条件渲染 - 像 if-else 一样简单</h4>
<p>在我的待办事项代码中，我用了条件渲染：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">TodoList</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [todos, setTodos] = <span class="hljs-title function_">useState</span>([
    { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'学习react'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'学习vue'</span> }
  ])
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      {/* 条件渲染：如果 todos 有内容就显示列表，否则显示提示 */}
      {
        todos.length &gt; 0 ? (
          // 条件成立时显示的内容
          <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
            {todos.map(todo =&gt; (
              <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{todo.id}</span>&gt;</span>{todo.title}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
            ))}
          <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
        ) : (
          // 条件不成立时显示的内容
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>暂无待办事项<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        )
      }
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<p><strong>简单理解</strong>：</p>
<ul>
<li><code>todos.length &gt; 0 ? A : B</code> 就像 if-else 语句</li>
<li>如果 todo 数量 &gt; 0，显示列表（A）</li>
<li>否则，显示"暂无待办事项"（B）</li>
</ul>
<h4 data-id="heading-22">4.2 列表渲染 - 用 map 显示数组内容</h4>
<p>列表渲染非常常用，看我的例子：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> todos = [
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'学习react'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'学习vue'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'学习JavaScript'</span> }
]

<span class="hljs-keyword">function</span> <span class="hljs-title function_">TodoList</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
      {
        // 用 map 把数组变成 JSX 元素
        todos.map(item =&gt; (
          <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{item.id}</span>&gt;</span>{item.title}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        ))
      }
    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span>
  )
}

<span class="hljs-comment">// 渲染结果：</span>
<span class="hljs-comment">// &lt;ul&gt;</span>
<span class="hljs-comment">//   &lt;li&gt;学习react&lt;/li&gt;</span>
<span class="hljs-comment">//   &lt;li&gt;学习vue&lt;/li&gt;</span>
<span class="hljs-comment">//   &lt;li&gt;学习JavaScript&lt;/li&gt;</span>
<span class="hljs-comment">// &lt;/ul&gt;</span>
</code></pre>
<p><strong>重要提示</strong>：列表中的每个元素都需要 <code>key</code> 属性</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ✅ 正确：有 key</span>
&lt;li key={item.<span class="hljs-property">id</span>}&gt;{item.<span class="hljs-property">title</span>}&lt;/li&gt;

<span class="hljs-comment">// ❌ 错误：没有 key（React 会警告）</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>{item.title}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span>
</code></pre>
<p><strong>为什么需要 key</strong>：</p>
<ol>
<li>帮助 React 识别哪些元素变化了</li>
<li>提高列表更新的性能</li>
<li>就像给列表项加上身份证号，每个都不一样</li>
</ol>
<h3 data-id="heading-23">第五章：事件处理 - 让页面能交互</h3>
<h4 data-id="heading-24">5.1 处理点击事件</h4>
<p>在我写的登录例子中，我处理了按钮点击：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">LoginButton</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [isLoggedIn, setIsLoggedIn] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>)
  
  <span class="hljs-comment">// 点击按钮时调用的函数</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-comment">// 把登录状态取反</span>
    <span class="hljs-comment">// 如果原来是 true，变成 false；如果原来是 false，变成 true</span>
    <span class="hljs-title function_">setIsLoggedIn</span>(!isLoggedIn)
  }
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{isLoggedIn ? '已登录' : '未登录'}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      {/* 注意：onClick 的 C 是大写 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleClick}</span>&gt;</span>
        {isLoggedIn ? '退出登录' : '登录'}
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<h4 data-id="heading-25">5.2 事件处理的不同写法</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 写法1：先定义函数，再使用</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'按钮被点击了'</span>)
}
&lt;button onClick={handleClick}&gt;按钮&lt;/button&gt;

<span class="hljs-comment">// 写法2：使用箭头函数</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> {
  console.log('按钮被点击了')
}}&gt;按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>

<span class="hljs-comment">// 写法3：箭头函数调用已定义的函数</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handleClick()}&gt;按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
</code></pre>
<h3 data-id="heading-26">第六章：完整代码解析 - 一步步理解</h3>
<h4 data-id="heading-27">6.1 我的 App.jsx 完整解析</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 第1步：导入需要的功能</span>
<span class="hljs-keyword">import</span> { useState, createElement } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'./App.css'</span>

<span class="hljs-comment">// 第2步：定义 App 组件</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 第3步：定义状态（组件的"记忆"）</span>
  <span class="hljs-keyword">const</span> [name, setName] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">'vue'</span>)          <span class="hljs-comment">// 名字状态</span>
  <span class="hljs-keyword">const</span> [todos, setTodos] = <span class="hljs-title function_">useState</span>([             <span class="hljs-comment">// 待办事项状态</span>
    { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'学习react'</span>, <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'学习vue'</span>, <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span> }
  ])
  <span class="hljs-keyword">const</span> [isLoggedIn, setIsLoggedIn] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>) <span class="hljs-comment">// 登录状态</span>
  
  <span class="hljs-comment">// 第4步：定义事件处理函数</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">toggleLogin</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-comment">// 切换登录状态（true ↔ false）</span>
    <span class="hljs-title function_">setIsLoggedIn</span>(!isLoggedIn)
  }
  
  <span class="hljs-comment">// 第5步：定义 JSX 元素</span>
  <span class="hljs-keyword">const</span> element = <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>JSX 是React 中用于描述用户界面的语法扩展<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span>
  <span class="hljs-keyword">const</span> element2 = <span class="hljs-title function_">createElement</span>(<span class="hljs-string">'h2'</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">'JSX 是React 中用于描述用户界面的语法扩展'</span>)
  
  <span class="hljs-comment">// 第6步：演示状态自动更新（3秒后改变名字）</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">setName</span>(<span class="hljs-string">'react'</span>)  <span class="hljs-comment">// 从 'vue' 变成 'react'</span>
  }, <span class="hljs-number">3000</span>)
  
  <span class="hljs-comment">// 第7步：返回 JSX（页面的内容）</span>
  <span class="hljs-keyword">return</span>(
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      {/* 显示 JSX 元素 */}
      {element}
      {element2}
      
      {/* 显示动态内容 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"title"</span>&gt;</span>{name}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      
      {/* 条件渲染：根据 todos 长度显示不同内容 */}
      {
        todos.length &gt; 0 ? (
          <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
            {
              todos.map((todo) =&gt; (
                <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{todo.id}</span>&gt;</span>{todo.title}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
              ))
            }
          <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
        ) : (<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>暂无待办事项<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>)
      }
      
      {/* 条件渲染：根据登录状态显示不同内容 */}
      {isLoggedIn ? <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>已登录<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span> : <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>未登录<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}
      
      {/* 事件处理：点击按钮切换登录状态 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{toggleLogin}</span>&gt;</span>
        {isLoggedIn ? '退出登录' : '登录'}
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  )
}

<span class="hljs-comment">// 第8步：导出组件，让其他文件可以使用</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>
</code></pre>
<h4 data-id="heading-28">6.2 我的 App2.jsx 完整解析</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 这个文件展示了如何把大页面拆分成小组件</span>

<span class="hljs-comment">// 组件1：掘金网站的头部</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">JuejinHeader</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">header</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>掘金首页<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}

<span class="hljs-comment">// 组件2：文章列表</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">Articles</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>文章列表<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}

<span class="hljs-comment">// 组件3：签到功能</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">Checkin</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>签到<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}

<span class="hljs-comment">// 组件4：热门文章</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">TopArticles</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>热门文章<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}

<span class="hljs-comment">// 主组件：把所有小组件组合起来</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      {/* 使用头部组件 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">JuejinHeader</span> /&gt;</span>
      
      {/* 主要内容区域 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span>
        {/* 使用文章列表组件 */}
        <span class="hljs-tag">&lt;<span class="hljs-name">Articles</span> /&gt;</span>
        
        {/* 侧边栏 */}
        <span class="hljs-tag">&lt;<span class="hljs-name">aside</span>&gt;</span>
          {/* 使用签到组件 */}
          <span class="hljs-tag">&lt;<span class="hljs-name">Checkin</span> /&gt;</span>
          {/* 使用热门文章组件 */}
          <span class="hljs-tag">&lt;<span class="hljs-name">TopArticles</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">aside</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}

<span class="hljs-comment">// 导出主组件</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>
</code></pre>
<h3 data-id="heading-29">第七章：常见问题解答</h3>
<h4 data-id="heading-30">7.1 我是 JavaScript 新手，能学会 React 吗？</h4>
<p><strong>当然可以！</strong> React 虽然有一些新概念，但都是建立在 JavaScript 基础上的。我的学习建议：</p>
<ol>
<li>
<p><strong>先掌握这些 JavaScript 基础</strong>：</p>
<ul>
<li>变量和常量（let, const）</li>
<li>函数（function, 箭头函数）</li>
<li>数组和对象</li>
<li>数组的 map 方法</li>
</ul>
</li>
<li>
<p><strong>然后学习 React</strong>：</p>
<ul>
<li>JSX（就是 HTML 写在 JS 里）</li>
<li>组件（就是返回 JSX 的函数）</li>
<li>useState（就是让组件有"记忆"）</li>
</ul>
</li>
</ol>
<h4 data-id="heading-31">7.2 为什么我的代码报错了？</h4>
<p>根据我的经验，新手常犯的错误：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 错误1：最外层多个标签</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Wrong</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>标题1<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>  <span class="hljs-comment">// ❌ 这里会报错</span>
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>标题2<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span>
  )
}

<span class="hljs-comment">// 正确：用一个标签包裹</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Right</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>  {/* ✅ 用一个 div 包裹所有内容 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>标题1<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>标题2<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<h4 data-id="heading-32">7.3 如何开始我的第一个 React 项目？</h4>
<p>最简单的方式是使用官方工具：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在命令行中输入（确保已安装 Node.js）</span>
npx create-react-app my-first-app

<span class="hljs-comment"># 进入项目文件夹</span>
<span class="hljs-built_in">cd</span> my-first-app

<span class="hljs-comment"># 启动项目</span>
npm start
</code></pre>
<p>然后打开 <code>src/App.js</code>，就可以开始写代码了！</p>
<h3 data-id="heading-33">学习路线建议</h3>
<p>根据我自己的学习经历，建议按这个顺序学习：</p>
<h4 data-id="heading-34">第一阶段：基础（1-2周）</h4>
<ol>
<li>学会写 JSX（在 JS 中写 HTML）</li>
<li>理解什么是组件</li>
<li>掌握 useState 的基本使用</li>
</ol>
<h4 data-id="heading-35">第二阶段：实践（2-3周）</h4>
<ol>
<li>做一个待办事项应用（就像我代码中的 todos）</li>
<li>做一个简单的登录/注册界面</li>
<li>练习条件渲染和列表渲染</li>
</ol>
<h4 data-id="heading-36">第三阶段：进阶（持续学习）</h4>
<ol>
<li>学习更多 React Hooks</li>
<li>学习组件间通信</li>
<li>学习路由、状态管理等</li>
</ol>
<h3 data-id="heading-37">最后的鼓励</h3>
<p>我刚开始学习 React 时，也觉得这些概念很抽象。但通过实际写代码，特别是像我的 <code>App.jsx</code> 和 <code>App2.jsx</code> 这样的练习，我逐渐理解了：</p>
<ol>
<li><strong>React 并不神秘</strong>：它只是提供了一种更高效的方式来构建网页</li>
<li><strong>组件化思想很重要</strong>：把大问题拆成小问题，每个组件解决一个小问题</li>
<li><strong>状态管理是核心</strong>：理解 useState，就理解了 React 的一半</li>
</ol>
<p>记住我代码中的这个例子，它包含了 React 最核心的概念：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 状态</span>
<span class="hljs-keyword">const</span> [isLoggedIn, setIsLoggedIn] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>)

<span class="hljs-comment">// 事件处理</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">toggleLogin</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">setIsLoggedIn</span>(!isLoggedIn)
}

<span class="hljs-comment">// 条件渲染</span>
{isLoggedIn ? <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>已登录<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span> : <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>未登录<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>}

<span class="hljs-comment">// 事件绑定</span>
&lt;button onClick={toggleLogin}&gt;切换登录状态&lt;/button&gt;
</code></pre>
<p><strong>一个函数 + 一些状态 + JSX = 一个 React 组件</strong></p>
<p>从现在开始，动手写代码吧！遇到问题就回头看我的代码示例，或者自己尝试修改我的代码看看效果。学习编程最有效的方法就是：<strong>多写，多练，多思考</strong>。</p>
<p>加油，你一定能学会 React！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3 响应式数据常用方案及实践坑点]]></title>    <link>https://juejin.cn/post/7604984549173657609</link>    <guid>https://juejin.cn/post/7604984549173657609</guid>    <pubDate>2026-02-10T11:38:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604984549173657609" data-draft-id="7602901195154571316" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3 响应式数据常用方案及实践坑点"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2026-02-10T11:38:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="b1ng"/> <meta itemprop="url" content="https://juejin.cn/user/1546326635980684"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3 响应式数据常用方案及实践坑点
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1546326635980684/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    b1ng
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T11:38:29.000Z" title="Tue Feb 10 2026 11:38:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"「"}.markdown-body b:after,.markdown-body strong:after{content:"」"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><p>最近在做 Vue 项目相关的需求，复习一下 Vue 的响应式机制及其常用办法</p>
<p>从 Vue3 视角来看，它的响应式数据核心就是<code>ref</code>和<code>reactive</code>，都依赖于 ES6 的<code>Proxy API</code>，以此来代理监听整个对象，从而能关注到复杂数据类型内部属性的增删改的变化。值得一提的是，这里代理对象包含了多嵌套式对象的情况，也就是可以实现深度监听。</p>
<p>相较于 Vue2 的<code>defineProperty()</code>仅对于属性层面的监听，无疑在构建复杂数据类型的响应式时，性能提升是巨大的。</p>
<p>下面让我们聊聊无处不在的<code>ref</code>和<code>reactive</code>:</p>
<h2 data-id="heading-0">ref</h2>
<p><code>ref</code>通常用来包装基本数据类型，由于<code>Proxy</code>是对于复杂数据类型的 API，所以它的实质是在<code>Proxy</code>包装的基础上又在外封装了一层，所以我们需要用<code>.value</code>来读写数据，但在<code>&lt;template&gt;</code>模板中访问响应式数据无需<code>.value</code>因为此时已经做了解包的处理。</p>
<h2 data-id="heading-1">reactive</h2>
<p>对于<code>reactive</code>相对的便是用来包装复杂数据类型，诸如<code>Object</code>、<code>Array</code>这样的数据，他可以直接监听整个对象的属性操作（增删改）。但要注意的是，切勿直接操作这个对象，也就是说不要改变这个<code>reactive</code>数据的引用，这会使他丢失响应式。</p>
<h2 data-id="heading-2"/>
<p>二者怎么抉择呢，尤大大提倡使用<code>ref</code>，事实也正是如此，绝大多数场景，简单和复杂数据类型均使用<code>ref</code>构建响应式，虽然理论上全部加一层包装会有性能损耗，但对于团队代码可读性和可维护性，这点损耗微乎其微。下面举个例子：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 情景：初始化一个 list，后续调接口拿到数据 res.data，需要赋值(先不考虑使用 TS)</span>
<span class="hljs-comment">// 使用 reactive</span>
<span class="hljs-keyword">const</span> list = <span class="hljs-title function_">reactive</span>({})
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(res.<span class="hljs-property">data</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> {
    list.<span class="hljs-property">key</span> = res.<span class="hljs-property">data</span>[key]
})
<span class="hljs-comment">// 使用 ref</span>
<span class="hljs-keyword">const</span> list = <span class="hljs-title function_">ref</span>({})
list.<span class="hljs-property">value</span> = res.<span class="hljs-property">data</span>
<span class="hljs-comment">// 或更严谨</span>
list.<span class="hljs-property">value</span> = {...list.<span class="hljs-property">value</span>, ...res.<span class="hljs-property">data</span>}

</code></pre>
<p>高下立判，无论从可读性还是维护性上讲<code>ref</code>也是完胜的。当然对于一些构造表单模板即对象属性增删不频繁的场景<code>reactive</code>不免为更优雅的选择...</p>
<p>以上是在学习阶段对于两个兄弟的基本认识。</p>
<h2 data-id="heading-3">响应式数据在组件间通信</h2>
<p>说起这点，最常用的便是父子组件间<code>props</code>+<code>emit</code>的通信</p>
<p>父→子：通过<code>props</code>传给子组件，子组件可直接使用，值得一提的是这里的<code>props</code>虽然是响应式的但我们不能直接通过<code>props.a</code>来修改，这虽然可行但违背了 Vue 单向数据流的原则会报错，试想如果一个响应式数据想在哪里修改就在哪里修改，姑且不说可能导致的异常，就代码规范性而言就不过关</p>
<p>子→父：所以我们通过<code>emit</code>的方法来修改，通过<code>$emit</code>触发父组件传给子组件的事件类型，父组件监听并响应触发事件</p>
<p>这里以 Vue3 组合式 API 的写法为例：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// Parent.vue --&gt;</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Child</span> <span class="hljs-attr">:count</span>=<span class="hljs-string">"count"</span> @<span class="hljs-attr">update-count</span>=<span class="hljs-string">"handleUpdate"</span> /&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./Child.vue'</span>

<span class="hljs-keyword">const</span> count = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleUpdate</span> = (<span class="hljs-params">newVal</span>) =&gt; {
  count.<span class="hljs-property">value</span> = newVal
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="hljs-comment">// Child.vue --&gt;</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"update"</span>&gt;</span>Count: {{ count }}<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>([<span class="hljs-string">'count'</span>])
<span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'update-count'</span>])

<span class="hljs-keyword">const</span> <span class="hljs-title function_">update</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'update-count'</span>, props.<span class="hljs-property">count</span> + <span class="hljs-number">1</span>)
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

</code></pre>
<p>这里仅仅讲述最常用的通信，还有<code>provide+inject</code>、<code>pinia/vuex</code>这里便不再赘述</p>
<h2 data-id="heading-4">常见坑点</h2>
<p>我们在接收到<code>porps</code>的数据以后，如果父组件传的是一个<code>ref</code>，或者是<code>reactive</code>，或者是非响应式？我们子组件接受到该怎么使用，需要加<code>.value</code>？可以直接使用？还是需要传给中间值？怎么传？</p>
<p>这些问题可能在学习阶段无需思考，已经知道了怎么用就顺着来写，但我们需要考虑的是如果好久不用了，我们能否通过自己的技术深度来知道怎么使用是正确的，怎么使用不会丢失响应式？不会导致异常？</p>
<h4 data-id="heading-5">1、如果传值是<code>ref/reactive/非响应</code>，子组件如何用？</h4>
<p><strong>结论</strong>：无论父组件传的是 <code>ref</code>、<code>reactive</code> 还是<code>普通对象</code>，子组件通过 <code>props</code> 接收到的都是一个「普通响应式对象」，也就是<code>Proxy</code>，你永远不需要、也不应该在子组件中对<code>props</code>使用<code>.value</code>。</p>
<p><strong>原因</strong>：Vue 对 props 的统一处理机制</p>
<p>当你在父组件这样传递数据：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 父组件</span>
<span class="hljs-keyword">const</span> a = <span class="hljs-title function_">ref</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span> })        <span class="hljs-comment">// ref</span>
<span class="hljs-keyword">const</span> b = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span> })     <span class="hljs-comment">// reactive</span>
<span class="hljs-keyword">const</span> c = { <span class="hljs-attr">name</span>: <span class="hljs-string">'Charlie'</span> }           <span class="hljs-comment">// 普通对象</span>

&lt;<span class="hljs-title class_">Child</span> :data-a=<span class="hljs-string">"a"</span> :data-b=<span class="hljs-string">"b"</span> :data-c=<span class="hljs-string">"c"</span> /&gt;
</code></pre>
<p>Vue 在传递给子组件前，会<strong>自动将所有值标准化为响应式对象</strong>（如果还不是的话），并注入到 <code>props</code> 中。</p>
<p>子组件接收到的 <code>props</code> 是一个由 Vue 内部创建的 <strong>响应式 Proxy 对象</strong>，结构如下：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 子组件中的 props（概念上）</span>
props = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">dataA</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span> },   <span class="hljs-comment">// ← 已解包 ref，并转为响应式</span>
  <span class="hljs-attr">dataB</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span> },     <span class="hljs-comment">// ← 原 reactive 对象（或其代理）</span>
  <span class="hljs-attr">dataC</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'Charlie'</span> }  <span class="hljs-comment">// ← 普通对象被自动 reactive 包装</span>
})
</code></pre>
<p>所以：<strong><code>props</code> 中的每个属性都已经是“解包后”的响应式对象，无需 <code>.value</code>。</strong></p>
<h4 data-id="heading-6">2、该如何使用？</h4>
<p><strong>结论</strong>：始终通过 <code>props.xxx</code> 访问数据（不解构、不赋值给顶层变量），并在需要修改但不影响源数据时创建本地副本。</p>
<p><strong>原因</strong>：</p>
<p>先看个错误的示例：</p>
<p><strong>❌ 错误做法：解构或顶层赋值</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">setup</span>(<span class="hljs-params">props</span>) {
  <span class="hljs-keyword">const</span> { name } = props.<span class="hljs-property">user</span>;     <span class="hljs-comment">// ❌ name 是普通字符串，失去响应式</span>
  <span class="hljs-keyword">const</span> age = props.<span class="hljs-property">user</span>.<span class="hljs-property">age</span>;      <span class="hljs-comment">// ❌ age 是快照引用，不会随父更新</span>

  <span class="hljs-comment">// 后续使用 name/age 都是非响应式的！</span>
}
</code></pre>
<p>有的兄弟可能要说了，我们有时候就只是需要其中的一个属性数据，也不用响应式，这样直接拿到不就好了？</p>
<p>但是请注意，如果父组件传的数据是异步获取的，当你直接结构或取值时可能拿到的是执行完异步操作前的数据，也就是说可能永远拿到的都是初始化时的空数据，因为就算异步操作完成，也会因丢失响应式而不会更新数据，造成问题！</p>
<blockquote>
<p>🔔 ESLint 规则 <code>vue/no-setup-props-destructure</code> 就是为了防止这类错误。</p>
</blockquote>
<p>所以始终通过 <code>props.xxx</code> 访问数据（不解构、不赋值给顶层变量）</p>
<p>而当我们本地需要创建副本来维护这个数据，但不影响父组件时：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { ref, watch } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> _ <span class="hljs-keyword">from</span> <span class="hljs-string">'lodash'</span> <span class="hljs-comment">// 或自定义 deepClone</span>

<span class="hljs-title function_">setup</span>(<span class="hljs-params">props</span>) {
  <span class="hljs-comment">// 创建深度独立副本（保持本地响应式）</span>
  <span class="hljs-keyword">const</span> localUser = <span class="hljs-title function_">ref</span>(_.<span class="hljs-title function_">cloneDeep</span>(props.<span class="hljs-property">user</span>));

  <span class="hljs-comment">// 可选：监听 prop 变化以重置本地状态（如父组件刷新数据）</span>
  <span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">user</span>, <span class="hljs-function">(<span class="hljs-params">newUser</span>) =&gt;</span> {
    localUser.<span class="hljs-property">value</span> = _.<span class="hljs-title function_">cloneClone</span>(newUser);
  });

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">updateName</span> = (<span class="hljs-params">name</span>) =&gt; {
    localUser.<span class="hljs-property">value</span>.<span class="hljs-property">name</span> = name; <span class="hljs-comment">// ✅ 修改本地副本，不影响父组件</span>
  };

  <span class="hljs-keyword">return</span> { localUser, updateName };
}
</code></pre>
<p><strong>终极建议</strong>:</p>
<ul>
<li>
<p><strong>模板中</strong>：直接写 <code>{{ props.xxx.yyy }}</code> ✅</p>
</li>
<li>
<p><strong>setup 中</strong>：</p>
<ul>
<li>只读 → 用 <code>props.xxx</code> 或 <code>() =&gt; props.xxx</code>（在 watch/computed 中）</li>
<li>需修改 → 创建 <code>ref(deepClone(props.xxx))</code> 作为本地状态</li>
</ul>
</li>
<li>
<p><strong>绝不</strong>在 setup 顶层解构 props 或赋值给普通变量</p>
</li>
<li>
<p><strong>修改数据</strong> → 通过 <code>emit</code> 通知父组件，或操作本地副本</p>
</li>
</ul>
<p>实力不济，新人小白，持续更新...</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端发布新版本主动检测更新提醒方案（纯前端方案版）]]></title>    <link>https://juejin.cn/post/7605051978871963667</link>    <guid>https://juejin.cn/post/7605051978871963667</guid>    <pubDate>2026-02-10T12:22:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605051978871963667" data-draft-id="7604984549173002249" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端发布新版本主动检测更新提醒方案（纯前端方案版）"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-10T12:22:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Ticnix"/> <meta itemprop="url" content="https://juejin.cn/user/3273707515560176"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端发布新版本主动检测更新提醒方案（纯前端方案版）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3273707515560176/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Ticnix
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T12:22:46.000Z" title="Tue Feb 10 2026 12:22:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>前端项目发布新版本后，若用户已打开页面或浏览器挂在后台，由于单页应用 (SPA) 的机制，页面不会主动刷新，导致用户一直停留在旧版本，无法使用新功能或遇到已修复的 Bug</p>
<p>那在开发过程中很容易遇到过这种问题，当我把前端写好的新版本的代码进行打包上传，这个动作已经进行了版本更新了，但是用户在访问旧版本网页时如果没有点击刷新，根本不知道已经上新了新版本，而且如果新版本已经取消了某个功能，但用户用旧版本进行提交必然会出错</p>
<p>那么就需要一个主动检测版本更新的功能提醒用户更新了</p>
<h2 data-id="heading-1">效果</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/098bf56740e24317a6a054db4e687574~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVGljbml4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771330968&amp;x-signature=LTf%2BgRQAwhqs8U%2BjWk2baF9T6Pc%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">实现过程</h2>
<p>1. <strong>构建阶段</strong>：在打包时生成一个包含当前时间戳的唯一版本标识文件 (version.json)。</p>
<p>2. <strong>部署阶段</strong>：Nginx 配置该文件禁止缓存，确保前端永远获取到最新状态。</p>
<p>3. <strong>运行阶段</strong>：前端代码通过轮询和页面可见性检测，对比本地与服务器的版本号。</p>
<p>实现逻辑如下</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3d3da9934784910b6c4f0f4c474394b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVGljbml4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771330968&amp;x-signature=PIgpRnixT%2BMvWMeaW2yYNnwBL3Y%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-3">构建脚本改造 (生成版本号)</h3>
<p>我们需要在每次 npm run build 时，在输出目录（通常是 dist 或 public）生成一个 version.json。</p>
<p>在项目根目录新建脚本文件 generate-version.js：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">'fs'</span>;
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>;
<span class="hljs-keyword">import</span> { fileURLToPath } <span class="hljs-keyword">from</span> <span class="hljs-string">'url'</span>;

<span class="hljs-comment">// 获取当前模块的路径</span>
<span class="hljs-keyword">const</span> __filename = <span class="hljs-title function_">fileURLToPath</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>);
<span class="hljs-keyword">const</span> __dirname = path.<span class="hljs-title function_">dirname</span>(__filename);

<span class="hljs-comment">// 定义版本号 </span>
<span class="hljs-keyword">const</span> versionInfo = {
  <span class="hljs-attr">version</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
  <span class="hljs-attr">releaseTime</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toLocaleString</span>()
};

<span class="hljs-comment">// 确定输出路径 </span>
<span class="hljs-keyword">const</span> outputDir = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'public'</span>);
<span class="hljs-comment">// 先写入 public 目录，打包时会自动复制到 dist</span>

<span class="hljs-keyword">const</span> filePath = path.<span class="hljs-title function_">join</span>(outputDir, <span class="hljs-string">'version.json'</span>);

<span class="hljs-comment">// 写入文件</span>
fs.<span class="hljs-title function_">writeFileSync</span>(filePath, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(versionInfo, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>));

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`✅ [Version] 版本文件已生成: <span class="hljs-subst">${filePath}</span>`</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`✅ [Version] 当前版本标识: <span class="hljs-subst">${versionInfo.version}</span>`</span>);
</code></pre>
<h3 data-id="heading-4">前端自动检测逻辑</h3>
<p>在项目的主入口文件（如 src/App.vue, src/App.jsx, src/main.js）中引入以下逻辑。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * 前端版本自动检测模块
 */</span>

<span class="hljs-comment">// 存储本地版本号</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">localHash</span>:any = <span class="hljs-literal">null</span>;

<span class="hljs-comment">// 检测间隔 (毫秒)，建议 60秒 或 5分钟</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CHECK_INTERVAL</span> = <span class="hljs-number">5</span> * <span class="hljs-number">1000</span>;

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">checkAppVersion</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 1. 请求 version.json</span>
    <span class="hljs-comment">// 必须加上时间戳参数 t=... 防止浏览器缓存这个 GET 请求本身</span>
    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/version.json?t=<span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>`</span>);

    <span class="hljs-keyword">if</span> (!res.<span class="hljs-property">ok</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Version file not found'</span>);
    
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>();
    <span class="hljs-keyword">const</span> serverHash = data.<span class="hljs-property">version</span>;

    <span class="hljs-comment">// 2. 首次加载，只记录不比对</span>
    <span class="hljs-keyword">if</span> (!localHash) {
      localHash = serverHash;
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`-----------------------[Updater] 当前版本已锁定-----------------------: <span class="hljs-subst">${localHash}</span>`</span>);
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// 3. 比对版本</span>
    <span class="hljs-keyword">if</span> (serverHash !== localHash) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`-----------------[Updater] 检测到新版本------------------------: <span class="hljs-subst">${serverHash}</span> (当前: <span class="hljs-subst">${localHash}</span>)`</span>);
      
      <span class="hljs-title function_">showUpdateNotification</span>();
    }

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`----------------------[Test] 执行检测-----------------------: <span class="hljs-subst">${localHash}</span>`</span>);
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-comment">// 静默失败，不打扰用户 (可能是网络波动)</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'---------------------[Updater] 版本检测失败:--------------------------'</span>, err);
  }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">showUpdateNotification</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">import</span>(<span class="hljs-string">'element-plus'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">{ ElMessageBox }</span>) =&gt;</span> {
    <span class="hljs-title class_">ElMessageBox</span>.<span class="hljs-title function_">confirm</span>(
      <span class="hljs-string">'系统检测到有新版本发布，请点击"确定"刷新页面以获取最新功能。'</span>,
      <span class="hljs-string">'版本更新提示'</span>,
      {
        <span class="hljs-attr">confirmButtonText</span>: <span class="hljs-string">'立即刷新'</span>,
        <span class="hljs-attr">cancelButtonText</span>: <span class="hljs-string">'稍后再说'</span>,
        <span class="hljs-attr">type</span>: <span class="hljs-string">'warning'</span>,
        <span class="hljs-attr">center</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">modal</span>: <span class="hljs-literal">false</span> 
      }
    ).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-title function_">reload</span>(<span class="hljs-literal">true</span>); <span class="hljs-comment">// true 表示强制从服务器重载</span>
    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// 用户点击取消，不做任何操作</span>
    });
  });
}

<span class="hljs-comment">// --- 启动检测监听 ---</span>

<span class="hljs-comment">// 1. 启动定时轮询</span>
<span class="hljs-built_in">setInterval</span>(checkAppVersion, <span class="hljs-variable constant_">CHECK_INTERVAL</span>);

<span class="hljs-comment">// 2. 智能监听：当用户切换标签页回来时，立即检查一次</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'visibilitychange'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">document</span>.<span class="hljs-property">visibilityState</span> === <span class="hljs-string">'visible'</span>) {
    <span class="hljs-title function_">checkAppVersion</span>();
  }
});

<span class="hljs-comment">// 3. 初始化检查</span>
<span class="hljs-title function_">checkAppVersion</span>();
</code></pre>
<h3 data-id="heading-5">修改 package.json：</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbfca652e87143e889936c5a7454aa9b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVGljbml4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771330968&amp;x-signature=EQ0OXrzvbkBLqY7QQQ1EK3OEyH4%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OA系统核心技术积累与 vxetable 的结合]]></title>    <link>https://juejin.cn/post/7605036907459313715</link>    <guid>https://juejin.cn/post/7605036907459313715</guid>    <pubDate>2026-02-11T01:36:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605036907459313715" data-draft-id="7605097326727577646" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OA系统核心技术积累与 vxetable 的结合"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-11T01:36:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OA系统核心技术积累与 vxetable 的结合
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T01:36:05.000Z" title="Wed Feb 11 2026 01:36:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;display:inline-block;font-weight:700;background:#ef7060;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(239,112,96,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 50px);border-bottom:3px solid #ef7060}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #3e3e3e;margin-top:32px;margin-bottom:32px;height:1px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(27,31,35,.05);color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:JetBranins Mono,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px;background-color:#fdfdfd}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fdfdfd}.markdown-body a{text-decoration:none;font-weight:700;color:#ef7060;border-bottom:1px solid #ef7060}.markdown-body a:active,.markdown-body a:hover{color:#ef2d26}.markdown-body table tr td,.markdown-body table tr th{border:1px solid #ccc;padding:5px 10px}.markdown-body table{display:block!important;width:auto;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{background:#f0f0f0;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f8f8f8}.markdown-body blockquote{margin-inline-start:0;margin-inline-end:0;border-left:3px solid #ef7060;background:#fff9f9;padding:1px 20px;margin-top:20px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">引言</h2>
<p>在数字化转型加速的今天，办公自动化（OA）系统成为企业效率提升的重要工具。OA系统通过实现流程自动化、数据管理和信息交互，优化了企业的内部运营。在众多技术组件中，<strong>vxetable</strong> 作为一种灵活的表格展示库，能够有效地提升数据展示和交互体验。本篇文章将探讨 OA 系统的核心技术积累及 vxetable 的应用场景，揭示它们如何解决现代企业在信息管理中的核心问题。</p>
<h2 data-id="heading-1">1. 定义问题或背景</h2>
<p>现代企业在管理信息时，常面临如数据冗余、信息孤岛及决策效率低下等问题。传统的OA系统往往缺乏灵活的数据展示能力，导致用户在处理信息时效率低下。企业需要一种既能自动化流程，又能直观展示信息的解决方案，以提升业务决策的及时性和准确性。</p>
<h2 data-id="heading-2">2. 解决方案或技术实现</h2>
<h3 data-id="heading-3">2.1 OA系统的核心技术</h3>
<ol>
<li>
<p><strong>流程自动化</strong>：<br/>
OA系统通常使用工作流引擎，例如 Activiti 或 Camunda，来实现自动化处理。流程引擎能够根据 pre-defined 规则自动转发任务，减少人工干预。</p>
<pre><code class="hljs language-ini" lang="ini">// 示例：使用 Activiti 启动流程
ProcessInstance <span class="hljs-attr">processInstance</span> = runtimeService.startProcessInstanceByKey(<span class="hljs-string">"myProcess"</span>)<span class="hljs-comment">;</span>
</code></pre>
</li>
<li>
<p><strong>数据管理</strong>：<br/>
OA系统依赖于关系型数据库（如 MySQL）来存储业务数据，我们可以通过 SQL 语言实现复杂的数据查询和管理。</p>
<pre><code class="hljs language-ini" lang="ini">SELECT * FROM tasks WHERE <span class="hljs-attr">status</span> = <span class="hljs-string">'completed'</span><span class="hljs-comment">;</span>
</code></pre>
</li>
<li>
<p><strong>用户界面</strong>：<br/>
使用前端框架（如 Vue.js）创建友好的用户界面，提高用户的操作体验。结合 vxetable，可以实现数据的动态展示。</p>
</li>
</ol>
<h3 data-id="heading-4">2.2 vxetable 的实现</h3>
<p>vxetable 是一个基于 Vue.js 的表格组件库，方便开发者展示和管理数据。其强大的功能包括：</p>
<ul>
<li><strong>排序和过滤</strong></li>
<li><strong>可编辑的单元格</strong></li>
<li><strong>行选择和批量操作</strong></li>
</ul>
<p>以下是一个简单的 vxetable 示例：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">vxe-table</span> <span class="hljs-attr">:data</span>=<span class="hljs-string">"tableData"</span> <span class="hljs-attr">:columns</span>=<span class="hljs-string">"columns"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-slot:edit</span>=<span class="hljs-string">"{ row, column }"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"row[column.field]"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">vxe-table</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">tableData</span>: [{ <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'John Doe'</span> }],
      <span class="hljs-attr">columns</span>: [
        { <span class="hljs-attr">field</span>: <span class="hljs-string">'id'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'ID'</span> },
        { <span class="hljs-attr">field</span>: <span class="hljs-string">'name'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Name'</span>, <span class="hljs-attr">editRender</span>: <span class="hljs-literal">true</span> }
      ]
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-5">2.3 技术的优缺点</h3>
<p><strong>优点</strong>：</p>
<ul>
<li><strong>自动化</strong>：极大提高了办公效率，减少了人工操作。</li>
<li><strong>灵活性</strong>：vxetable 使得数据展示更为灵活，用户可随时检索和编辑数据。</li>
<li><strong>用户体验</strong>：现代前端框架提升了用户界面的友好性和交互性。</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li><strong>技术门槛</strong>：对于不熟悉现代前端框架的用户，学习成本可能较高。</li>
<li><strong>资源消耗</strong>：大规模的数据展示可能会影响系统性能。</li>
</ul>
<p><strong>实际应用建议</strong>：</p>
<p>在实施OA系统时，建议结合团队的技术能力选择合适的技术栈，同时做好性能优化策略，例如分页展示和懒加载。</p>
<h2 data-id="heading-6">3. 结论</h2>
<p>OA系统的核心技术积累与 vxetable 的结合，极大地提升了企业的信息管理能力。通过自动化流程和灵活的数据展示，企业能够更快速地响应市场需求，提高决策效率。未来，我们可以预见 OA 系统将进一步融入更多智能化元素，如机器学习和数据分析，以提供更深层次的业务洞察。</p>
<h2 data-id="heading-7">4. 参考资料</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.activiti.org%2F" target="_blank" title="https://www.activiti.org/" ref="nofollow noopener noreferrer">Activiti Documentation</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fxuliangzhan.com%2Fvxe-table%2F%23%2Ftable%2Fstart" target="_blank" title="https://xuliangzhan.com/vxe-table/#/table/start" ref="nofollow noopener noreferrer">VXE-Table Documentation</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2Fv2%2Fguide%2F" target="_blank" title="https://vuejs.org/v2/guide/" ref="nofollow noopener noreferrer">Vue.js Documentation</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[vue 甘特图 vxe-gantt 设置每个进度条分为计划和实际两条，实现上下分布任务条]]></title>    <link>https://juejin.cn/post/7605042125298827298</link>    <guid>https://juejin.cn/post/7605042125298827298</guid>    <pubDate>2026-02-10T15:47:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605042125298827298" data-draft-id="7604881286038339636" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="vue 甘特图 vxe-gantt 设置每个进度条分为计划和实际两条，实现上下分布任务条"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2026-02-10T15:47:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="卤蛋fg6"/> <meta itemprop="url" content="https://juejin.cn/user/4320420117616682"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            vue 甘特图 vxe-gantt 设置每个进度条分为计划和实际两条，实现上下分布任务条
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4320420117616682/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    卤蛋fg6
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T15:47:42.000Z" title="Tue Feb 10 2026 15:47:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>vue 甘特图 vxe-gantt 设置每个进度条分为计划和实际两条，实现上下分布任务条，实现方式是利用子任务的子视图渲染模式，来间每条任务拆分成2条子任务，就可以利用自带的子视图渲染功能来渲染。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgantt.vxeui.com" target="_blank" title="https://gantt.vxeui.com" ref="nofollow noopener noreferrer">gantt.vxeui.com</a></p>
<p>由于放2行超出默认高度，所以还需要通过 cell-config.height设置一下行高，再通过树形表格的子任务来渲染</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e08c0a089f148898adb6108e59e6e05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k6JuLZmc2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771343264&amp;x-signature=yfvEIsiBM2pVTaxQYbhRbrDkSvw%3D" alt="image" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">vxe-gantt</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"ganttOptions"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">vxe-gantt</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">VxeGanttTaskType</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vxe-gantt'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">XEUtils</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'xe-utils'</span>

<span class="hljs-keyword">const</span> ganttOptions = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">border</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">height</span>: <span class="hljs-number">500</span>,
  <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">cellConfig</span>: {
    <span class="hljs-attr">height</span>: <span class="hljs-number">60</span>
  },
  <span class="hljs-attr">treeConfig</span>: {
    <span class="hljs-attr">transform</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">rowField</span>: <span class="hljs-string">'id'</span>,
    <span class="hljs-attr">parentField</span>: <span class="hljs-string">'parentId'</span>
  },
  <span class="hljs-attr">taskConfig</span>: {
    <span class="hljs-attr">startField</span>: <span class="hljs-string">'start'</span>,
    <span class="hljs-attr">endField</span>: <span class="hljs-string">'end'</span>,
    <span class="hljs-attr">typeField</span>: <span class="hljs-string">'type'</span>
  },
  <span class="hljs-attr">taskBarSubviewConfig</span>: {
    barStyle ({ row }) {
      <span class="hljs-keyword">if</span> (row.<span class="hljs-property">flag</span> === <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">return</span> {
          <span class="hljs-attr">transform</span>: <span class="hljs-string">'translateY(-24px)'</span>,
          <span class="hljs-string">'--vxe-ui-gantt-view-task-bar-completed-background-color'</span>: <span class="hljs-string">'#409eff'</span>
        }
      }
      <span class="hljs-keyword">if</span> (row.<span class="hljs-property">flag</span> === <span class="hljs-number">2</span>) {
        <span class="hljs-keyword">return</span> {
          <span class="hljs-attr">transform</span>: <span class="hljs-string">'translateY(1px)'</span>,
          <span class="hljs-string">'--vxe-ui-gantt-view-task-bar-completed-background-color'</span>: <span class="hljs-string">'#31d231'</span>
        }
      }
    }
  },
  <span class="hljs-attr">taskBarConfig</span>: {
    <span class="hljs-attr">showContent</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">barStyle</span>: {
      <span class="hljs-attr">round</span>: <span class="hljs-literal">true</span>
    }
  },
  <span class="hljs-attr">taskViewConfig</span>: {
    <span class="hljs-attr">tableStyle</span>: {
      <span class="hljs-attr">width</span>: <span class="hljs-number">480</span>
    }
  },
  <span class="hljs-attr">columns</span>: [
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'title'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'任务名称'</span>, <span class="hljs-attr">minWidth</span>: <span class="hljs-number">100</span> },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'planStartDate'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'计划开始时间'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">100</span> },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'planEndDate'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'计划结束时间'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">100</span> },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'actualStartDate'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'实际开始时间'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">100</span> },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'actualEndDate'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'实际结束时间'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">100</span> }
  ],
  <span class="hljs-attr">data</span>: []
})

<span class="hljs-comment">// 模拟后端接口</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">loadList</span> = (<span class="hljs-params"/>) =&gt; {
  ganttOptions.<span class="hljs-property">loading</span> = <span class="hljs-literal">true</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> list = [
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10001</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'A项目'</span>, <span class="hljs-attr">planStartDate</span>: <span class="hljs-string">'2024-03-03'</span>, <span class="hljs-attr">planEndDate</span>: <span class="hljs-string">'2024-03-15'</span>, <span class="hljs-attr">actualStartDate</span>: <span class="hljs-string">'2024-03-03'</span>, <span class="hljs-attr">actualEndDate</span>: <span class="hljs-string">'2024-03-12'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10002</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'B项目'</span>, <span class="hljs-attr">planStartDate</span>: <span class="hljs-string">'2024-03-10'</span>, <span class="hljs-attr">planEndDate</span>: <span class="hljs-string">'2024-03-25'</span>, <span class="hljs-attr">actualStartDate</span>: <span class="hljs-string">'2024-03-08'</span>, <span class="hljs-attr">actualEndDate</span>: <span class="hljs-string">'2024-03-16'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10003</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'C项目'</span>, <span class="hljs-attr">planStartDate</span>: <span class="hljs-string">'2024-03-20'</span>, <span class="hljs-attr">planEndDate</span>: <span class="hljs-string">'2024-04-10'</span>, <span class="hljs-attr">actualStartDate</span>: <span class="hljs-string">'2024-03-22'</span>, <span class="hljs-attr">actualEndDate</span>: <span class="hljs-string">'2024-04-01'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10004</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'D项目'</span>, <span class="hljs-attr">planStartDate</span>: <span class="hljs-string">'2024-03-28'</span>, <span class="hljs-attr">planEndDate</span>: <span class="hljs-string">'2024-04-19'</span>, <span class="hljs-attr">actualStartDate</span>: <span class="hljs-string">'2024-03-28'</span>, <span class="hljs-attr">actualEndDate</span>: <span class="hljs-string">'2024-04-12'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">10005</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'E项目'</span>, <span class="hljs-attr">planStartDate</span>: <span class="hljs-string">'2024-04-05'</span>, <span class="hljs-attr">planEndDate</span>: <span class="hljs-string">'2024-04-28'</span>, <span class="hljs-attr">actualStartDate</span>: <span class="hljs-string">'2024-04-01'</span>, <span class="hljs-attr">actualEndDate</span>: <span class="hljs-string">'2024-04-24'</span> }
    ]
    <span class="hljs-comment">// 转成子任务视图</span>
    <span class="hljs-keyword">const</span> ganttData = []
    list.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> currRow = <span class="hljs-title class_">XEUtils</span>.<span class="hljs-title function_">assign</span>({}, item, { <span class="hljs-attr">type</span>: <span class="hljs-title class_">VxeGanttTaskType</span>.<span class="hljs-property">Subview</span> })
      <span class="hljs-keyword">const</span> planRow = <span class="hljs-title class_">XEUtils</span>.<span class="hljs-title function_">assign</span>({}, item, {
        <span class="hljs-attr">id</span>: <span class="hljs-number">10000000</span> + item.<span class="hljs-property">id</span>,
        <span class="hljs-attr">title</span>: <span class="hljs-string">'计划'</span>,
        <span class="hljs-attr">parentId</span>: item.<span class="hljs-property">id</span>,
        <span class="hljs-attr">start</span>: item.<span class="hljs-property">planStartDate</span>,
        <span class="hljs-attr">end</span>: item.<span class="hljs-property">planEndDate</span>,
        <span class="hljs-attr">flag</span>: <span class="hljs-number">1</span>
      })
      <span class="hljs-keyword">const</span> actualRow = <span class="hljs-title class_">XEUtils</span>.<span class="hljs-title function_">assign</span>({}, item, {
        <span class="hljs-attr">id</span>: <span class="hljs-number">20000000</span> + item.<span class="hljs-property">id</span>,
        <span class="hljs-attr">parentId</span>: item.<span class="hljs-property">id</span>,
        <span class="hljs-attr">title</span>: <span class="hljs-string">'实际'</span>,
        <span class="hljs-attr">start</span>: item.<span class="hljs-property">actualStartDate</span>,
        <span class="hljs-attr">end</span>: item.<span class="hljs-property">actualEndDate</span>,
        <span class="hljs-attr">flag</span>: <span class="hljs-number">2</span>
      })
      ganttData.<span class="hljs-title function_">push</span>(currRow)
      ganttData.<span class="hljs-title function_">push</span>(planRow)
      ganttData.<span class="hljs-title function_">push</span>(actualRow)
    })
    ganttOptions.<span class="hljs-property">data</span> = ganttData
    ganttOptions.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span>
  }, <span class="hljs-number">200</span>)
}

<span class="hljs-title function_">loadList</span>()
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fx-extends%2Fvxe-gantt" target="_blank" title="https://gitee.com/x-extends/vxe-gantt" ref="nofollow noopener noreferrer">gitee.com/x-extends/v…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何优化vxetable处理十万行以上数据的性能。]]></title>    <link>https://juejin.cn/post/7605036907459330099</link>    <guid>https://juejin.cn/post/7605036907459330099</guid>    <pubDate>2026-02-11T01:38:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605036907459330099" data-draft-id="7605107459065757742" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何优化vxetable处理十万行以上数据的性能。"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-11T01:38:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何优化vxetable处理十万行以上数据的性能。
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T01:38:06.000Z" title="Wed Feb 11 2026 01:38:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;display:inline-block;font-weight:700;background:#ef7060;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(239,112,96,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 50px);border-bottom:3px solid #ef7060}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #3e3e3e;margin-top:32px;margin-bottom:32px;height:1px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(27,31,35,.05);color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:JetBranins Mono,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px;background-color:#fdfdfd}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fdfdfd}.markdown-body a{text-decoration:none;font-weight:700;color:#ef7060;border-bottom:1px solid #ef7060}.markdown-body a:active,.markdown-body a:hover{color:#ef2d26}.markdown-body table tr td,.markdown-body table tr th{border:1px solid #ccc;padding:5px 10px}.markdown-body table{display:block!important;width:auto;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{background:#f0f0f0;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f8f8f8}.markdown-body blockquote{margin-inline-start:0;margin-inline-end:0;border-left:3px solid #ef7060;background:#fff9f9;padding:1px 20px;margin-top:20px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">性能优化策略</h2>
<h3 data-id="heading-1">1. <strong>虚拟滚动（Virtual Scrolling）</strong></h3>
<ul>
<li>
<p><strong>描述</strong>：虚拟滚动只渲染可见部分的表格行，减少 DOM 元素的数量。</p>
</li>
<li>
<p><strong>实现</strong>：使用 <code>vxe-table</code> 的虚拟滚动功能，只显示当前视口中的行。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">vxe-table</span> <span class="hljs-attr">:data</span>=<span class="hljs-string">"tableData"</span> <span class="hljs-attr">:scroll-y</span>=<span class="hljs-string">"{enabled: true}"</span> <span class="hljs-attr">stripe</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 列定义 --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">vxe-table</span>&gt;</span>
</code></pre>
</li>
</ul>
<h3 data-id="heading-2">2. <strong>分页（Pagination）</strong></h3>
<ul>
<li>
<p><strong>描述</strong>：将数据分成多个页面，每页只加载和展示部分数据。</p>
</li>
<li>
<p><strong>实现</strong>：在后台进行数据分页处理，然后在前端根据当前页数获取数据。</p>
<pre><code class="hljs language-ruby" lang="ruby">&lt;vxe-pager <span class="hljs-symbol">:current-page</span>.sync=<span class="hljs-string">"currentPage"</span> <span class="hljs-symbol">:page-size</span>.sync=<span class="hljs-string">"pageSize"</span> <span class="hljs-variable">@page</span>-change=<span class="hljs-string">"loadData"</span> /&gt;
</code></pre>
</li>
</ul>
<h3 data-id="heading-3">3. <strong>懒加载（Lazy Loading）</strong></h3>
<ul>
<li><strong>描述</strong>：根据用户的操作动态加载数据，例如下拉加载更多数据。</li>
<li><strong>实现</strong>：在用户滚动到底部时触发加载新的数据。</li>
</ul>
<h3 data-id="heading-4">4. <strong>字段过滤（Column Filtering）</strong></h3>
<ul>
<li><strong>描述</strong>：只加载和展示用户需要的数据字段。</li>
<li><strong>实现</strong>：根据需求动态生成列，限制用户可以查看的列数。</li>
</ul>
<h3 data-id="heading-5">5. <strong>后台聚合处理（Backend Aggregation）</strong></h3>
<ul>
<li><strong>描述</strong>：在服务器端处理数据聚合和统计，减少需要传输的数据量。</li>
<li><strong>实现</strong>：通过 API 接口实现数据的过滤和聚合，前端只显示计算后的结果。</li>
</ul>
<h3 data-id="heading-6">6. <strong>适度使用缓存（Caching）</strong></h3>
<ul>
<li><strong>描述</strong>：对频繁访问的数据进行服务器缓存。</li>
<li><strong>实现</strong>：使用 Redis 或内存缓存，将常用数据缓存，以减少数据库查询时间。</li>
</ul>
<h3 data-id="heading-7">7. <strong>合理使用数据结构（Data Structure）</strong></h3>
<ul>
<li><strong>描述</strong>：优化数据结构以提高检索效率。</li>
<li><strong>实现</strong>：使用索引和合适的数据类型优化数据库中的表格。</li>
</ul>
<h3 data-id="heading-8">8. <strong>优化渲染性能</strong></h3>
<ul>
<li><strong>描述</strong>：通过减少重绘和回流来优化渲染性能。</li>
<li><strong>实现</strong>：避免在渲染过程中承载复杂的计算，将处理逻辑移至计算属性或共享状态管理工具（如 Vuex）。</li>
</ul>
<h3 data-id="heading-9">9. <strong>减少组件嵌套</strong></h3>
<ul>
<li><strong>描述</strong>：避免过多的嵌套组件，减少子组件的重新渲染。</li>
<li><strong>实现</strong>：将表格和其他功能设计为单一组件，减少组件数量。</li>
</ul>
<h2 data-id="heading-10">总结</h2>
<p>通过实施上述策略，您可以显著优化 <code>vxetable</code> 处理大量数据时的性能。需要根据具体场景选择适合的方法，确保在提高性能的同时，不影响用户的交互体验。这不仅能提升应用的响应速度，也能给用户带来更流畅的体验。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[研发场景十大热门 Skills 推荐]]></title>    <link>https://juejin.cn/post/7605051978872766483</link>    <guid>https://juejin.cn/post/7605051978872766483</guid>    <pubDate>2026-02-11T01:38:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605051978872766483" data-draft-id="7604964464690528319" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="研发场景十大热门 Skills 推荐"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-02-11T01:38:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿虎儿"/> <meta itemprop="url" content="https://juejin.cn/user/3394908210857901"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            研发场景十大热门 Skills 推荐
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3394908210857901/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿虎儿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T01:38:24.000Z" title="Wed Feb 11 2026 01:38:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文面向实际研发场景，整理并推荐了一组可直接应用于日常开发流程的 Agent Skills。这些 Skills 覆盖前端设计、前后端开发、代码审查、自动化测试、CI/CD、问题修复以及文档维护等常见环节，分别针对具体任务提供明确的能力边界与使用场景说明，帮助你在不同阶段选择合适的 Skills，提高开发效率。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dcb6c8023b314d81b22b36cfd6f0d4c7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6JmO5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771378707&amp;x-signature=g1%2F4R01Hl2ESZJp2hm4v4B3tuWY%3D" alt="图片" loading="lazy"/></p>
<p><strong>前端设计</strong></p>
<p><strong>名称</strong></p>
<p>frontend-design</p>
<p><strong>作者</strong></p>
<p>Anthropic</p>
<p><strong>地址</strong></p>
<p>   </p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fskills%2Ftree%2Fmain%2Fskills%2Ffrontend-design" target="_blank" title="https://github.com/anthropics/skills/tree/main/skills/frontend-design" ref="nofollow noopener noreferrer">github.com/anthropics/…</a></p>
<p>   </p>
<p><strong>简介</strong></p>
<p>该 Skill 旨在创建具有 独特性 和 高设计品质 的前端界面，能够达到 生产级别 (production-grade) 的标准。它的核心目标是避免生成千篇一律、缺乏独特风格的 “AI 风格” 界面，而是通过在设计上有意地选择大胆、明确的美学方向（例如：极简、复古、未来感、野兽派等），并注重排版、色彩、动效、空间布局等细节，来打造出令人印象深刻、具有艺术感的前端页面。</p>
<p><strong>资源文件</strong></p>
<p>该 Skill 中仅包含一个 SKILL.md 文件。</p>
<p><strong>应用场景</strong></p>
<ul>
<li>
<p><strong>构建网页组件或页面</strong></p>
<p>当你需要从零开始创建一个具体的 UI 元素时，例如一个 React 组件、一个 HTML/CSS 布局，或一个独立的静态页面。该 Skill 会确保这个组件不仅功能完善，而且在视觉上具有辨识度。</p>
</li>
<li>
<p><strong>开发完整的 Web 应用或网站</strong></p>
<p>当你需要构建一个完整的应用界面时，比如一个产品的 Landing Page、一个数据仪表盘或一个小型网站。该 Skill 会从整体出发，确立一个统一且鲜明的设计风格，并将其贯彻到应用的每一个角落。</p>
</li>
<li>
<p><strong>美化或重塑现有界面</strong></p>
<p>当你有一个已经存在的、但设计平庸的网页或应用，并希望提升其视觉品质时。该 Skill 会专注于美化层面的工作，通过引入独特的字体、创意的色彩方案、精致的动效和新颖的布局，来重塑界面的整体美感。</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c48f35b320e467eb37c8f67a95c6183~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6JmO5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771378707&amp;x-signature=fiyBiZl%2FsDKrSNYl76xlCwJBt2g%3D" alt="图片" loading="lazy"/></p>
<p><strong>前端开发</strong></p>
<p><strong>名称</strong></p>
<p>cache-components</p>
<p><strong>作者</strong></p>
<p>vercel</p>
<p><strong>地址</strong></p>
<p>   </p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvercel%2Fnext.js%2Ftree%2Fcanary%2F.claude-plugin%2Fplugins%2Fcache-components%2Fskills%2Fcache-components" target="_blank" title="https://github.com/vercel/next.js/tree/canary/.claude-plugin/plugins/cache-components/skills/cache-components" ref="nofollow noopener noreferrer">github.com/vercel/next…</a></p>
<p>   </p>
<p><strong>简介</strong></p>
<p>该 Skill 旨在将 Next.js 的 Partial Prerendering (PPR) 和缓存组件（Cache Components）的最佳实践，通过 AI 助手无缝集成到开发工作流中。当项目环境启用 <em><strong>cacheComponents: true</strong></em> 配置时，该 Skill 将被激活，为你提供自动化的代码生成与优化能力。</p>
<p><strong>资源文件</strong></p>
<p>除 SKILL.md 文件外，该 Skill 中还包含以下文件：</p>
<ul>
<li>
<p><strong>PATTERNS.md：</strong> 一份详细的说明文档，通过丰富的代码示例和场景解释，来展示如何高效、正确地使用 Cache Components。</p>
</li>
<li>
<p><strong>REFERENCE.md：</strong> Cache Components 的官方 API 参考手册，它精确定义了所有相关函数、指令和核心概念，用于查找具体技术细节。</p>
</li>
<li>
<p><strong>TROUBLESHOOTING.md：</strong> Cache Components 的故障排查指南，提供了一系列常见错误的解决方案、调试清单和实用技巧，用于诊断并解决使用缓存组件时遇到的问题。</p>
</li>
</ul>
<p><strong>应用场景</strong></p>
<ul>
<li>
<p><strong>自动生成缓存优化的数据组件</strong></p>
<p>当创建数据获取组件时，系统会自动应用最优的渲染策略：针对可共享数据（如产品目录），使用 **<em>'use cache'</em> **语法进行缓存；针对用户专属内容，则自动添加  **<em/> ** 边界，以实现动态流式渲染。</p>
</li>
<li>
<p><strong>自动实现数据变更后的缓存失效</strong></p>
<p>当生成用于修改数据的 Server Action 时，系统会自动注入缓存失效逻辑（如 **<em>updateTag()</em> **方法）。这能确保数据变更后，相关缓存会立即更新，从而保障整个应用的数据一致性。</p>
</li>
<li>
<p><strong>智能化页面构建与代码现代化</strong></p>
<p>在构建页面或审查代码时，系统会强制遵循 Partial Prerendering（PPR）架构规范，以实现最优的加载性能。同时，它能识别并给出现代化改造建议，例如用组件级的  **<em>'use cache'</em> **替代已过时的页面级缓存配置。</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/576dbcb9e9b4477aa69eeba63a066417~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6JmO5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771378707&amp;x-signature=uqobAy%2BExIDGMinAz5ujfoDk0gE%3D" alt="图片" loading="lazy"/></p>
<p><strong>全栈开发</strong></p>
<p><strong>名称</strong></p>
<p>fullstack-developer</p>
<p><strong>作者</strong></p>
<p>Shubhamsaboo</p>
<p><strong>地址</strong></p>
<p>   </p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FShubhamsaboo%2Fawesome-llm-apps%2Ftree%2Fmain%2Fawesome_agent_skills%2Ffullstack-developer" target="_blank" title="https://github.com/Shubhamsaboo/awesome-llm-apps/tree/main/awesome_agent_skills/fullstack-developer" ref="nofollow noopener noreferrer">github.com/Shubhamsabo…</a></p>
<p>   </p>
<p><strong>简介</strong></p>
<p>该 Skill 的主要作用是扮演一个 精通现代 Web 开发技术的全栈专家角色。它专注于使用 JavaScript/TypeScript 技术栈，特别是 React (Next.js)、Node.js 和主流数据库，来帮助你完成各类 Web 开发任务。</p>
<p><strong>资源文件</strong></p>
<p>该 Skill 中仅包含一个 SKILL.md 文件。</p>
<p><strong>应用场景</strong></p>
<ul>
<li>
<p><strong>构建完整的 Web 应用：</strong> 从前端到后端，提供完整的解决方案。</p>
</li>
<li>
<p><strong>开发 API：</strong> 创建 RESTful 或 GraphQL 风格的后端接口。</p>
</li>
<li>
<p><strong>创建前端界面：</strong> 使用 React 或 Next.js 构建现代化的用户界面。</p>
</li>
<li>
<p><strong>数据库和数据建模：</strong> 设计和设置如 PostgreSQL 或 MongoDB 等数据库。</p>
</li>
<li>
<p><strong>实现用户认证与授权：</strong> 集成 JWT、OAuth 等认证机制。</p>
</li>
<li>
<p><strong>部署与扩展应用：</strong> 提供在 Vercel、Netlify 等平台上的部署指导。</p>
</li>
<li>
<p><strong>集成第三方服务：</strong> 在应用中接入外部服务。</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78a6ecb924fc45f0914d68afc0c70be9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6JmO5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771378707&amp;x-signature=64I7pg%2BR4VuHOLdT9B5dGZthrOc%3D" alt="图片" loading="lazy"/></p>
<p><strong>代码审查（前端）</strong></p>
<p><strong>名称</strong></p>
<p>frontend-code-review</p>
<p><strong>作者</strong></p>
<p>langgenius</p>
<p><strong>地址</strong></p>
<p>   </p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flanggenius%2Fdify%2Ftree%2Fmain%2F.agents%2Fskills%2Ffrontend-code-review" target="_blank" title="https://github.com/langgenius/dify/tree/main/.agents/skills/frontend-code-review" ref="nofollow noopener noreferrer">github.com/langgenius/…</a></p>
<p>   </p>
<p><strong>简介</strong></p>
<p>该 Skill 的核心功能是自动化审查前端代码（尤其针对 .tsx、.ts、.js 等文件）。它会依据预定义的规则清单，从代码质量、性能表现、业务逻辑等维度对代码开展全面分析。审查完成后，系统将生成结构清晰的报告，把发现的问题划分为 “紧急待修复” 和 “改进建议” 两类，并标注具体的代码位置、提供可落地的修复方案，助力你提升代码质量。</p>
<p><strong>资源文件</strong></p>
<p>除 SKILL.md 文件外，该 Skill 中还包含以下文件：</p>
<ul>
<li>
<p><strong>references/business-logic.md：</strong> 定义与特定业务场景相关的规则，以防止出现逻辑错误或 Bug。例如 : 规定在某些组件中不能使用 workflowStore ，因为在特定使用场景下（如从模板创建管道时）它会导致页面白屏。</p>
</li>
<li>
<p><strong>references/code-quality.md：</strong> 包含一系列通用编码规范，旨在保持代码的整洁、一致和可维护性。例如 : 推荐使用 <em><strong>cn</strong></em> 这样的工具函数来处理动态的 CSS 类名，而不是手动拼接字符串，以保证代码风格统一。</p>
</li>
<li>
<p><strong>references/performance.md：</strong> 专注于前端性能，提供避免常见性能问题的最佳实践。例如 : 建议将传递给子组件的对象或数组等复杂属性用 <em><strong>useMemo</strong></em> 包裹起来，以防止不必要的组件重渲染。</p>
</li>
</ul>
<p><strong>应用场景</strong></p>
<ul>
<li>
<p><strong>审查待提交的变更</strong></p>
<p>在你准备提交代码（<em><strong>git commit</strong></em>）前，可使用该 Skill 审查所有已修改或已暂存的文件，提前识别并标记不符合规范的代码，避免潜在的 Bug 或性能问题被合入代码库。</p>
</li>
<li>
<p><strong>审查指定的文件</strong></p>
<p>当你需对特定文件或模块进行重构、优化或问题排查时，可将相关文件交由该 Skill 审查，从而对目标文件开展针对性深度分析，快速获取该文件的质量评估结果及改进建议。</p>
</li>
<li>
<p><strong>获取结构化的修复报告</strong></p>
<p>代码审查发现问题后，该 Skill 会自动整理并输出标准化报告。这份报告不仅罗列问题，还会按紧急程度排序，同时标注问题对应的文件路径、行号、相关代码片段，并给出可执行的修复方案。</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc93647b17a14c2b8120111f43d1d653~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6JmO5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771378707&amp;x-signature=aZsihA0PTD6JfYChqP3XQaHmaDw%3D" alt="图片" loading="lazy"/></p>
<p><strong>代码审查（通用）</strong></p>
<p><strong>名称</strong></p>
<p>code-reviewer</p>
<p><strong>作者</strong></p>
<p>google-gemini</p>
<p><strong>地址</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgoogle-gemini%2Fgemini-cli%2Ftree%2Fmain%2F.gemini%2Fskills%2Fcode-reviewer" target="_blank" title="https://github.com/google-gemini/gemini-cli/tree/main/.gemini/skills/code-reviewer" ref="nofollow noopener noreferrer">github.com/google-gemi…</a></p>
<p>   </p>
<p><strong>简介</strong></p>
<p>该 Skill 旨在引导 AI 开展专业且全面的代码审查工作。它既支持审查本地代码改动（包括已暂存和未暂存的变更），也可审查远程代码合并请求（Pull Request，简称 PR）。审查的核心目标是保障代码的正确性、可维护性，并确保代码符合项目既定的规范标准。</p>
<p><strong>资源文件</strong></p>
<p>该 Skill 中仅包含一个 SKILL.md 文件。</p>
<p><strong>应用场景</strong></p>
<ul>
<li>
<p><strong>审查远程 PR</strong></p>
<p>当你完成功能开发或问题修复并提交 PR 后，可发起 AI 审查请求。你只需提供 PR 编号或 URL（例如："Review PR #123"），AI 会自动检出（checkout）该 PR 的代码，运行项目预设的检查脚本（如 <em><strong>npm run preflight</strong></em>），同时阅读 PR 描述与评论以理解开发目标，随后对代码开展深度分析并给出反馈。</p>
</li>
<li>
<p><strong>审查本地代码变更</strong></p>
<p>若你希望在提交代码或创建 PR 前，先对本地修改进行审查，只需发出 “审查我的代码” 等类似指令即可，无需提供 PR 相关信息；AI 会通过 <em><strong>git status</strong></em>、<em><strong>git diff</strong></em> 等命令，检查工作区中已暂存（staged）和未暂存（unstaged）的代码改动，进而对这些变更进行分析并反馈。</p>
</li>
<li>
<p><strong>提供深度分析与结构化反馈</strong></p>
<p>无论是审查远程 PR 还是本地代码变更，AI 都会从多维度开展深度的代码质量分析，涵盖正确性、可维护性、可读性与执行效率、安全性与测试完整性等维度。最终，AI 会以结构化形式输出反馈，内容包括总体概述、具体发现（关键问题、改进建议）以及明确的结论（如批准合并或要求修改）。</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c72032d2e369481ea5ddd016f14147cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6JmO5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771378707&amp;x-signature=TEW0xPsWS4GMDvpG8ePWELsn2qs%3D" alt="图片" loading="lazy"/></p>
<p><strong>网页应用测试</strong></p>
<p><strong>名称</strong></p>
<p>webapp-testing</p>
<p><strong>作者</strong></p>
<p>Anthropic</p>
<p><strong>地址</strong></p>
<p>   </p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fskills%2Ftree%2Fmain%2Fskills%2Fwebapp-testing" target="_blank" title="https://github.com/anthropics/skills/tree/main/skills/webapp-testing" ref="nofollow noopener noreferrer">github.com/anthropics/…</a></p>
<p>   </p>
<p><strong>简介</strong></p>
<p>该 Skill 是一个基于 Playwright 构建的本地 Web 应用测试工具集，支持前端功能验证、UI 行为调试、页面截图及浏览器控制台日志采集，适配「先侦查后行动」的测试流程。工具集提供示例脚本与辅助脚本，覆盖静态 HTML 自动化测试、元素定位、日志抓取能力，并可在多服务场景下统一管理服务器生命周期。</p>
<p><strong>资源文件</strong></p>
<p>除 SKILL.md 文件外，该 Skill 中还包含以下文件：</p>
<ul>
<li>
<p><strong>examples/console_logging.py：</strong> 演示了在自动化测试时如何捕获并保存网页的控制台日志，用于调试和监控。</p>
</li>
<li>
<p><strong>examples/element_discovery.py：</strong> 展示了如何自动发现和列出页面上所有的按钮、链接和输入框等可交互元素，是编写自动化脚本前的重要步骤。</p>
</li>
<li>
<p><strong>examples/static_html_automation.py：</strong> 示范了如何直接对本地的静态 HTML 文件进行自动化操作（如点击、填表），而无需通过网络服务器。</p>
</li>
<li>
<p><strong>scripts/with_server.py：</strong> 自动化辅助脚本。在执行一个主命令（例如自动化测试脚本）之前，先启动一个或多个依赖的服务（如前端或后端服务器），并确保这些服务完全就绪后，再执行主命令，最后在命令结束后自动关闭所有服务。</p>
</li>
</ul>
<p><strong>应用场景</strong></p>
<ul>
<li>
<p><strong>自动验证前端功能</strong></p>
<p>当你在本地开发 Web 应用（如使用 React、Vue、Svelte 等框架），并希望验证某个新功能是否正常运行时，只需用自然语言告知 AI 测试需求（例如：“帮我测试登录功能”），AI 会自动编写 Playwright 脚本来模拟用户操作，并向你反馈页面状态或内容是否符合预期。</p>
</li>
<li>
<p><strong>调试与分析 UI 行为</strong></p>
<p>若你发现页面中某元素渲染异常或交互行为异常，可向 AI 下达指令（例如：“截取首页完整截图” 或 “检查按钮的 DOM 结构”），AI 会执行对应脚本，捕获截图或获取 HTML 内容，并将侦察结果返回给你，助力快速定位问题。</p>
</li>
<li>
<p><strong>处理需要后台服务的复杂交互</strong></p>
<p>若你的应用为前后端分离架构，测试前端功能需后端 API 服务同步运行，只需告知 AI 项目结构与启动命令，AI 会借助 <em><strong>with_server.py</strong></em> 脚本来同时启动所有必需服务，再运行测试脚本，确保测试在完整的环境中执行。</p>
</li>
<li>
<p><strong>测试静态 HTML 文件</strong></p>
<p>若你有不依赖服务器的纯静态 HTML 页面，需验证其内容或结构，只需向 AI 提供文件路径与测试需求，AI 会编写脚本并通过 **<em>file://</em> **协议在浏览器中打开该文件，完成验证操作。</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/753155b47ff945b4bde8f4fe15b937b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6JmO5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771378707&amp;x-signature=3uX1BzlmJGtGz5x%2Bl6%2FNI%2BZE9Mg%3D" alt="图片" loading="lazy"/></p>
<p><strong>CI/CD：PR 创建</strong></p>
<p><strong>名称</strong></p>
<p>pr-creator</p>
<p><strong>作者</strong></p>
<p>google-gemini</p>
<p><strong>地址</strong></p>
<p>   </p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgoogle-gemini%2Fgemini-cli%2Ftree%2Fmain%2F.gemini%2Fskills%2Fpr-creator" target="_blank" title="https://github.com/google-gemini/gemini-cli/tree/main/.gemini/skills/pr-creator" ref="nofollow noopener noreferrer">github.com/google-gemi…</a></p>
<p>   </p>
<p><strong>简介</strong></p>
<p>该 Skill 的核心作用是引导并自动化创建高质量、符合规范的拉取请求（Pull Request，简称 PR）。它通过标准化工作流程，确保每一次代码提交均遵循项目预设的模板与质量检查标准，从而提升代码审查效率、保障团队协作的一致性。</p>
<p><strong>资源文件</strong></p>
<p>该 Skill 中仅包含一个 SKILL.md 文件。</p>
<p><strong>应用场景</strong></p>
<ul>
<li>
<p><strong>一键创建符合规范的 PR</strong></p>
<p>当你在本地完成新功能开发或 Bug 修复，并已提交代码（git commit）后，可调用此 Skill，让 AI 自动执行分支检查、查找并应用 PR 模板、运行预检脚本（如测试和 linting），并最终生成一个标题和描述都完全符合项目规范的 PR。</p>
</li>
<li>
<p><strong>引导贡献者完成首次代码提交</strong></p>
<p>当新团队成员或外部贡献者不熟悉项目的提交流程和规范时，可以使用此 Skill，让 AI 以智能向导的形式，自动完成模板查找、脚本执行等繁琐操作，仅需用户填写必要的标题与描述，大幅降低代码贡献门槛。</p>
</li>
<li>
<p><strong>自动执行创建 PR 前的质量检查</strong></p>
<p>在正式创建 PR 之前，可以调用该 Skill，让 AI 自动运行项目预设的 preflight 脚本，执行所有必要的构建、单元测试和代码风格检查。如果任何检查失败，AI 会中止提交流程并提示开发者进行修复，节约了审查者的时间和精力。</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6236ca456014cefb5e0b8a4a420a6f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6JmO5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771378707&amp;x-signature=U%2FxishHnrbktobjpyixkwvfzkq0%3D" alt="图片" loading="lazy"/></p>
<p><strong>Linting 和格式错误修复</strong></p>
<p><strong>名称</strong></p>
<p>fix</p>
<p><strong>作者</strong></p>
<p>facebook</p>
<p><strong>地址</strong></p>
<p>   </p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact%2Ftree%2Fmain%2F.claude%2Fskills%2Ffix" target="_blank" title="https://github.com/facebook/react/tree/main/.claude/skills/fix" ref="nofollow noopener noreferrer">github.com/facebook/re…</a></p>
<p>   </p>
<p><strong>简介</strong></p>
<p>这个 skill 的核心作用是自动化地修复代码格式并检查代码规范（linting）错误 。它通过执行两个关键命令来保证代码质量：</p>
<ul>
<li>
<p>**<em>yarn prettier：</em> **自动格式化已修改的文件，统一代码风格。</p>
</li>
<li>
<p>**<em>yarn linc：</em> **检查代码中是否存在 linting 错误（这些是 Prettier 无法修复的，例如未使用的变量、逻辑错误等），这些错误通常会导致持续集成（CI）失败。</p>
</li>
</ul>
<p>最终目标是确保代码在提交前符合项目规范，从而顺利通过 CI/CD 流程。</p>
<p><strong>资源文件</strong></p>
<p>该 Skill 中仅包含一个 SKILL.md 文件。</p>
<p><strong>应用场景</strong></p>
<ul>
<li>
<p><strong>提交代码前的预防性检查</strong></p>
<p>在你完成编码，执行 <em><strong>git commit</strong></em> 之前，运行该 Skill，让 AI 自动清理代码格式，并提示任何需要手动修复的 linting 错误。</p>
</li>
<li>
<p><strong>修复已发现的 linting 或格式问题</strong></p>
<p>当你在编码过程中或接手他人代码时，发现当前工作区内存在明显的格式混乱或 linting 错误提示（例如，IDE 的警告），可以立即运行该 Skill，快速解决当前已知的代码质量问题，从而在开发过程中保持代码的整洁和可读性。</p>
</li>
<li>
<p><strong>解决持续集成（CI）失败问题</strong></p>
<p>当一个提交被推送到服务器后，CI 流水线报告了因 linting 或格式错误导致的失败。此时你可以在本地对应的分支上运行此 Skill，让 AI 自动修复格式问题，并列出需要手动更正的 linting 错误，帮助你快速定位并解决问题，然后提交修复。</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf6efc3f23004ad1b1a08e79540e732b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6JmO5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771378707&amp;x-signature=2t%2FIN%2FM8QVJ87CCc2tqQN%2F8tBlI%3D" alt="图片" loading="lazy"/></p>
<p><strong>技术文档更新</strong></p>
<p><strong>名称</strong></p>
<p>update-docs</p>
<p><strong>作者</strong></p>
<p>vercel</p>
<p><strong>地址</strong></p>
<p>   </p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvercel%2Fnext.js%2Ftree%2Fcanary%2F.claude%2Fskills%2Fupdate-docs" target="_blank" title="https://github.com/vercel/next.js/tree/canary/.claude/skills/update-docs" ref="nofollow noopener noreferrer">github.com/vercel/next…</a></p>
<p>   </p>
<p><strong>简介</strong></p>
<p>该 Skill 是一套用于更新 Next.js 项目文档的引导式工作流，核心作用是帮助你根据源代码的变更，来分析、更新和创建相关的文档，确保代码和文档保持同步。它特别为审查 Pull Request (PR) 时的文档完整性检查而设计，通过一系列标准化的步骤来规范文档的修改过程。</p>
<p><strong>资源文件</strong></p>
<p>   </p>
<p>除 SKILL.md 文件外，该 Skill 中还包含以下文件：</p>
<ul>
<li><strong>references/CODE-TO-DOCS-MAPPING.md：</strong> 定义了源代码和文档之间的映射关系。简单来说，它就像一张地图，告诉 AI 当某个代码文件发生变化时，应该去更新哪个文档文件。</li>
<li><strong>references/DOC-CONVENTIONS.md：</strong> 风格指南和规则手册，详细规定了文档的格式、结构和写作风格，以确保所有文档都保持一致性和高质量。</li>
</ul>
<p>   </p>
<p><strong>应用场景</strong></p>
<ul>
<li>
<p><strong>分析代码变更对文档的影响</strong></p>
<p>提交代码变更后，可以调用该 Skill 来分析哪些文档文件需要更新。</p>
<p>它会通过 <em><strong>git diff</strong></em> 命令检查你的分支与 <em><strong>canary</strong></em> 分支之间的差异，并根据预定义的映射关系  <em><strong>(references/CODE-TO-DOCS-MAPPING.md</strong></em>)，找出与变更的代码文件相对应的文档文件。</p>
</li>
<li>
<p><strong>更新现有的文档</strong></p>
<p>对于已经存在的文档，当其对应的功能或 API 发生变化时（例如组件新增了 props、函数行为变更），该 Skill 会引导你更新现有文档。</p>
<p>它会提示你如何添加或修改 props 表格、更新代码示例、添加废弃通知等，并遵循项目固有的文档规范（例如，使用  **<em/> ** /  **<em/> ** 来区分不同路由的内容）。</p>
</li>
<li>
<p><strong>为新功能创建脚手架文档</strong></p>
<p>当你在项目中添加了一个全新的功能时（例如一个新的组件、函数或配置项），该 Skill 可以帮你快速创建符合规范的新文档。</p>
<p>它为不同类型的文档（如 API 参考、指南）提供了标准模板，确保新文档的结构、命名和元信息（Frontmatter）都符合项目要求。</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e852ea687a5540d09d8dd07e9fcf658f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6JmO5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771378707&amp;x-signature=JcsFvlZsovdSFv%2BpLMGzUNPNeoM%3D" alt="图片" loading="lazy"/></p>
<p><strong>查找 Skill</strong></p>
<p><strong>名称</strong></p>
<p>find-skills</p>
<p><strong>作者</strong></p>
<p>vercel</p>
<p><strong>地址</strong></p>
<p>   </p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvercel-labs%2Fskills%2Ftree%2Fmain%2Fskills%2Ffind-skills" target="_blank" title="https://github.com/vercel-labs/skills/tree/main/skills/find-skills" ref="nofollow noopener noreferrer">github.com/vercel-labs…</a></p>
<p>   </p>
<p><strong>简介</strong></p>
<p>该 Skill 主要作用帮助你发现并安装 Agent Skill。</p>
<p>它依托名为 <em><strong>skills</strong></em> 的命令行工具（CLI），让你可以从开放的 Agent Skill 生态中搜索、安装与管理各类模块化技能包；这些技能可扩展 Agent 能力，为其补充特定领域知识、标准化工作流与工具能力。</p>
<p><strong>资源文件</strong></p>
<p>该 Skill 中仅包含一个 SKILL.md 文件。</p>
<p><strong>应用场景</strong></p>
<ul>
<li>
<p><strong>探索未知的 Skill</strong></p>
<p>当你希望 Agent 帮忙处理某个特定领域的任务，但不确定 Agent 是否具备相应能力时，可以使用此 Skill 进行探索。例如，当你询问 “你能帮我评审代码吗？” 或 “如何为我的项目生成文档？” 时，该 Skill 会被激活，主动在技能市场中搜索与 “代码评审” 或“ 文档生成” 相关的能力，并将找到的可用技能呈现给你.</p>
</li>
<li>
<p><strong>查找特定的 Skill</strong></p>
<p>当你明确知道需要一个 Skill 来解决特定问题，但不知道具体是哪个 Skill 时，可以主动调用此 Skill 进行精确查找。例如，你可以直接说 “帮我找一个用于 React 性能优化的 skill”，该 Skill 会将 “React 性能优化” 作为关键词进行搜索，并返回最匹配的技能选项，如 “vercel-react-best-practices”。</p>
</li>
<li>
<p><strong>提供可执行的 Skill 安装建议</strong></p>
<p>当该 Skill 找到一个或多个匹配的 skill 后，它会自动整理并输出一份标准化的推荐信息。这份信息不仅包含技能的名称和功能简介 ，还会提供 一键安装指令 (<em><strong>npx skills</strong></em> **<em>add ...</em> **) 以及指向技能详情页的官方链接。</p>
</li>
</ul>
<p>欢迎大家安装尝试～先从会用 Skills 开始！</p>
<hr/>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fv0zI98Ehd_U4JUYQ1_ILPA" target="_blank" title="https://mp.weixin.qq.com/s/v0zI98Ehd_U4JUYQ1_ILPA" ref="nofollow noopener noreferrer">来源</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[3分钟快速掌握 skills 核心原理]]></title>    <link>https://juejin.cn/post/7605041451327586347</link>    <guid>https://juejin.cn/post/7605041451327586347</guid>    <pubDate>2026-02-10T13:36:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605041451327586347" data-draft-id="7604853010171609129" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="3分钟快速掌握 skills 核心原理"/> <meta itemprop="keywords" content="AI编程,Claude"/> <meta itemprop="datePublished" content="2026-02-10T13:36:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大虫小呓"/> <meta itemprop="url" content="https://juejin.cn/user/4257765628844654"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            3分钟快速掌握 skills 核心原理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4257765628844654/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大虫小呓
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T13:36:46.000Z" title="Tue Feb 10 2026 13:36:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Skills 是什么？</h3>
<p>Claude Code 中的 Skills 是一种强大的功能扩展机制，它允许你将专业知识、工作流程和最佳实践封装成可复用的模块，让 AI 助手能更精准地理解并执行特定任务。</p>
<p>下面这个表格可以帮助你快速把握其核心概念。</p>



































<table><thead><tr><th>特性维度</th><th>传统一次性提示词 (Prompt)</th><th>Claude Skills</th></tr></thead><tbody><tr><td><strong>知识载体</strong></td><td>对话上下文，易丢失</td><td>文件系统中的标准化文件夹，持久化存储</td></tr><tr><td><strong>复用性</strong></td><td>低，每次新对话需重新解释</td><td>高，一次创建，多次调用，跨项目共享</td></tr><tr><td><strong>知识管理</strong></td><td>知识散落，难以维护和迭代</td><td>模块化管理，不同领域知识独立封装，易于更新</td></tr><tr><td><strong>上下文使用</strong></td><td>所有指令一次性全量加载，占用大量 Token</td><td><strong>渐进式披露</strong>，按需分层加载，极大节省 Token</td></tr><tr><td><strong>执行能力</strong></td><td>依赖模型生成代码或文本</td><td>可捆绑<strong>可执行脚本</strong>，直接运行，结果确定且高效</td></tr></tbody></table>
<h3 data-id="heading-1">核心机制：渐进式披露</h3>
<p>Skills 的关键优势在于其“渐进式披露”的智能加载策略，这类似于查字典时先看目录，再找章节，最后查阅附录，而不是背诵整本字典。其加载过程分为三层：</p>
<ol>
<li>
<ol>
<li><strong>元数据层</strong>：每个 Skill 的 <code>SKILL.md</code> 文件顶部包含简短的 <code>name</code> 和 <code>description</code>。Claude 在启动时会加载所有 Skills 的元数据（每个约100 Tokens），形成一个“技能目录”，用于快速匹配用户请求。</li>
</ol>
</li>
<li>
<ol start="2">
<li><strong>核心指令层</strong>：当 Claude 根据元数据判断某个 Skill 与当前任务相关时，才会加载 <code>SKILL.md</code> 文件的主体内容，获取详细的工作流程和规则。</li>
</ol>
</li>
<li>
<ol start="3">
<li><strong>扩展资源层</strong>：只有在核心指令明确要求时，Claude 才会去读取 <code>scripts/</code> 目录下的脚本或 <code>references/</code> 目录下的详细参考文档。不需要的资源完全不占用上下文。</li>
</ol>
</li>
</ol>
<p>这种机制有效解决了上下文窗口有限的问题，使得安装大量 Skills 成为可能，而不会影响核心对话的流畅性。</p>
<h3 data-id="heading-2">创建与管理 Skills</h3>
<p>一个标准的 Skill 在物理上是一个文件夹，其典型结构如下所示：</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-keyword">my</span>-skill/
├── SKILL.md          <span class="hljs-comment"># 必需：核心指令文件，包含元数据和详细指南</span>
├── scripts/          <span class="hljs-comment"># 可选：可执行脚本（Python、Shell等）</span>
│   └── helper.py
├── references/       <span class="hljs-comment"># 可选：补充参考文档（API文档、规范等）</span>
│   └── api.md
└── assets/           <span class="hljs-comment"># 可选：模板、配置文件等静态资源</span>
</code></pre>
<p>创建 Skill 的核心是编写 <code>SKILL.md</code> 文件，它采用 <strong>YAML Frontmatter + Markdown 内容</strong>的结构：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-meta">---</span>
<span class="hljs-string">name:</span> <span class="hljs-string">my-skill</span>  <span class="hljs-comment"># 技能名称，也将作为斜杠命令</span>
<span class="hljs-string">description:</span> <span class="hljs-string">这个技能用于...</span> <span class="hljs-string">当用户需要...时使用。</span> <span class="hljs-comment"># 关键：清晰描述功能和触发场景</span>
<span class="hljs-string">disable-model-invocation:</span> <span class="hljs-literal">false</span>  <span class="hljs-comment"># 可选：是否允许Claude自动调用</span>
<span class="hljs-meta">---</span>
<span class="hljs-comment"># 技能详细指南</span>

<span class="hljs-comment">## 工作流程</span>
<span class="hljs-number">1</span><span class="hljs-string">.</span>  <span class="hljs-string">第一步...</span>
<span class="hljs-number">2</span><span class="hljs-string">.</span>  <span class="hljs-string">第二步...</span>
<span class="hljs-string">...</span>
</code></pre>
<p>根据使用范围，Skills 可以存放在不同位置：</p>
<ul>
<li><strong>个人 Skills</strong> (<code>~/.claude/skills/</code>)：仅限当前用户使用，适合个人工作习惯。</li>
<li><strong>项目 Skills</strong> (<code>项目根目录/.claude/skills/</code>)：项目团队成员共享，适合团队编码规范、项目特定流程。</li>
<li><strong>插件 Skills</strong>：通过 Claude Code Plugin 安装和分发，适合通用工具能力。</li>
</ul>
<h3 data-id="heading-3">应用场景与最佳实践</h3>
<p>Skills 能广泛应用于各种场景，例如：</p>
<ul>
<li><strong>规范团队流程</strong>：将代码审查清单、Git 提交规范、部署流程封装成 Skill，确保团队输出一致性。</li>
<li><strong>处理特定文件</strong>：使用官方或社区的 <code>pptx</code>、<code>xlsx</code>、<code>pdf</code> 等 Skills，让 Claude 能够专业地处理办公文档。</li>
<li><strong>封装业务逻辑</strong>：将公司内部的数据查询、API 调用规范等特定业务知识打包，让 AI 成为懂业务的专家助手。</li>
</ul>
<p>创建高质量 Skill 的几个最佳实践包括：</p>
<ul>
<li><strong>保持聚焦</strong>：一个 Skill 只解决一类明确的问题，避免创建“万能”Skill。</li>
<li><strong>描述清晰</strong>：<code>description</code> 字段务必写明具体功能和触发关键词，帮助 Claude 准确识别。</li>
<li><strong>提供示例</strong>：在 Skill 中包含输入和输出的正反示例，能显著提升效果。</li>
</ul>
<h3 data-id="heading-4">与其他技术的关系</h3>
<p>需要区分 Skills 和另外两种常见技术：</p>
<ul>
<li><strong>MCP</strong>：它好比 <strong>USB 协议</strong>，主要负责让 AI <strong>安全连接外部工具和服务</strong>（如数据库、GitHub），解决的是“连接”问题。</li>
<li><strong>Function Calling</strong>：它相当于 <strong>工具按钮</strong>，是 AI 触发<strong>单个具体操作</strong>的机制，解决的是“执行”问题。</li>
</ul>
<p>而 <strong>Skills 则像是完整的操作手册</strong>，它利用 MCP 建立连接，通过 Function Calling 执行步骤，<strong>指挥 AI 如何思考、如何组合步骤以完成一个复杂任务</strong>。三者是互补关系，协同工作。</p>
<p>希望本文能帮助你更好地理解和使用 Claude Code Skills！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Qwen-Image-2.0：中文图像生成与编辑集成于一身的模型]]></title>    <link>https://juejin.cn/post/7604863528944943119</link>    <guid>https://juejin.cn/post/7604863528944943119</guid>    <pubDate>2026-02-10T14:24:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604863528944943119" data-draft-id="7604881286038274100" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Qwen-Image-2.0：中文图像生成与编辑集成于一身的模型"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-02-10T14:24:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="围炉聊科技"/> <meta itemprop="url" content="https://juejin.cn/user/3229679898597516"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Qwen-Image-2.0：中文图像生成与编辑集成于一身的模型
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3229679898597516/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    围炉聊科技
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T14:24:58.000Z" title="Tue Feb 10 2026 14:24:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2026年2月10日，阿里巴巴正式发布了其新一代图像生成与编辑模型——<strong>Qwen-Image-2.0</strong>。作为通义千问视觉大模型系列的最新成员，该模型在文本渲染、图像生成质量以及编辑能力方面做出了一系列务实改进。本文将从技术特性、实测表现和适用场景三个维度，客观分析这一模型的实际能力边界。</p>
<hr/>
<h2 data-id="heading-0">一、核心能力：聚焦“文字+图像”协同生成</h2>
<p>Qwen-Image-2.0最显著的升级点在于对<strong>长文本指令的理解与渲染能力</strong>。官方宣称支持高达 <strong>1K token 的提示词输入</strong>，这意味着用户可以提供近 800–1000 字的复杂描述，并期望模型准确还原内容布局、字体风格、图文关系等细节。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/587f05f2cae34e0f80f01e5c60e9f20a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu054KJ6IGK56eR5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771338299&amp;x-signature=SCP1kX1wa5skh3%2Fi3N3keckxfBA%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>案例显示，该模型能够较为完整地渲染《兰亭集序》全文（约324字）于山水画背景之上，文字未遮挡画面主体，且保留了毛笔书法的基本笔锋特征。虽然个别汉字仍存在轻微形变或模糊，但整体可读性已远超前代模型，也优于当前主流闭源模型如 Nano Banana Pro 在部分中文排版任务中的表现。</p>
<p>此外，Qwen-Image-2.0 支持多种中文字体（如瘦金体、小楷、宋体）及中英文混排，在 PPT、信息图、海报等专业场景下具备初步可用性。例如，一段包含十层食材结构描述的汉堡爆炸图提示词（约600字），模型能生成结构清晰、层次分明的2K分辨率图像，各食材位置基本符合预期。</p>
<hr/>
<h2 data-id="heading-1">二、图像生成与编辑：整合而非堆砌</h2>
<p>与早期版本 Qwen-Image（2025年8月发布）和 Qwen-Image-Edit 系列（如2509/2512）不同，Qwen-Image-2.0 首次将<strong>文生图</strong>（T2I）集成到单一模型中。这种整合并非简单拼接，而是通过统一的 MMDiT（多模态扩散变换器）架构实现端到端优化。</p>
<p>在图像质感方面，新模型减少了早期 AI 图像常见的“油腻感”和过度饱和问题，色彩更接近实拍风格。人物肌肤、建筑纹理、自然光影等细节表现有所提升，尤其在写实类场景（如街景、产品摄影）中观感更自然。</p>
<p>编辑能力方面，模型支持上传图片后进行局部修改，如更换文字、调整姿态、增删物体等。实测中，九宫格人像生成任务能保持人物身份一致性，但人物脸部与原图还是稍稍有些差异，看上去已经不是同一个人了。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5d3366c30c4450fb736af7a19e1af50~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu054KJ6IGK56eR5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771338299&amp;x-signature=Ui%2BlX73w%2Fr5LtH8xVKxT2zx0EMM%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/12b9abb15cc447e499c8023fe52f6401~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu054KJ6IGK56eR5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771338299&amp;x-signature=pah%2BQvSP1Gl8M6D7T0elJWJWNaw%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-2">三、性能与部署：轻量化但非万能</h2>
<p>值得注意的是，尽管 Qwen-Image 初代为 20B 参数规模，Qwen-Image-2.0 却采用了<strong>更轻量的架构设计</strong>，模型体积显著缩小，推理速度更快。这一取舍显然以牺牲部分通用生成能力为代价，换取在特定任务（尤其是文字密集型图像）上的效率与稳定性。</p>
<p>在权威评测平台 AI Arena 上，Qwen-Image-2.0 文生图得分为 <strong>1029 分</strong>，位列全球第三，仅次于 Nano Banana Pro 和 GPT Image 1.5；图生图编辑任务得分 <strong>1034 分</strong>，排名第二。这表明其在专业细分领域已具备竞争力，但尚未全面超越顶尖闭源模型。</p>
<p>目前，该模型已通过 <strong>Qwen Chat</strong>（chat.qwen.ai）开放免费体验。开源计划暂未公布，但考虑到前代 Qwen-Image 已基于 Apache 2.0 协议开源，后续版本有望延续开放策略。</p>
<hr/>
<h2 data-id="heading-3">四、适用场景建议</h2>
<p>基于当前能力，Qwen-Image-2.0 更适合以下场景：</p>
<ul>
<li><strong>企业级信息图制作</strong>：如数据报告配图、流程图、多栏PPT封面；</li>
<li><strong>中文内容营销素材</strong>：需嵌入大量文案的海报、社交媒体长图；</li>
<li><strong>教育与出版辅助</strong>：古文配图、儿童绘本、教学插图；</li>
<li><strong>轻量级图像编辑</strong>：替换文字、调整色调、生成多角度产品图。</li>
</ul>
<p>但对于高艺术性创作、影视概念设计或需要极致真实感的商业摄影模拟，仍建议结合人工后期或使用更成熟的闭源工具。</p>
<hr/>
<h2 data-id="heading-4">结语</h2>
<p>Qwen-Image-2.0 并非“全能型选手”，而是一个<strong>目标明确、聚焦痛点</strong>的工程化模型。它没有追求炫技式的超现实生成，而是扎实解决了中文用户在 AI 生图中最常遇到的“文字乱码”“指令失效”“排版失控”等问题。在 AIGC 逐渐从“能看”走向“可用”的阶段，这种务实路线或许比盲目堆参数更有价值。</p>
<p>当然，它仍有提升空间——尤其是在复杂场景理解、多图逻辑一致性、以及极端长文本下的细节保真度方面。但就目前而言，对于需要稳定输出中文图文内容的开发者或设计师，Qwen-Image-2.0 值得一试。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Skill Creator 技能分析报告]]></title>    <link>https://juejin.cn/post/7605051978872193043</link>    <guid>https://juejin.cn/post/7605051978872193043</guid>    <pubDate>2026-02-10T14:46:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605051978872193043" data-draft-id="7605041451327782955" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Skill Creator 技能分析报告"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2026-02-10T14:46:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="林武"/> <meta itemprop="url" content="https://juejin.cn/user/3984285870066253"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Skill Creator 技能分析报告
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3984285870066253/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    林武
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T14:46:48.000Z" title="Tue Feb 10 2026 14:46:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Skill Creator 技能分析报告</h2>
<blockquote>
<p><strong>来源</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fskills.sh%2Fanthropics%2Fskills%2Fskill-creator" target="_blank" title="https://skills.sh/anthropics/skills/skill-creator" ref="nofollow noopener noreferrer">anthropics/skills/skill-creator</a><br/>
<strong>安装量</strong>: 1,690<br/>
<strong>分析日期</strong>: 2026-02-10</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">一、技能用途</h3>
<p>Skill Creator 是一个<strong>元技能</strong>（meta-skill）——它的作用是教 Claude 如何创建其他技能。</p>
<h4 data-id="heading-2">核心功能</h4>
<ul>
<li><strong>创建新技能</strong>：引导 Claude 从零开始构建一个完整的 Skill 包，包括需求理解、内容规划、初始化、编辑和打包</li>
<li><strong>更新现有技能</strong>：对已有技能进行迭代改进</li>
<li><strong>技能设计咨询</strong>：提供技能架构设计的最佳实践指导</li>
</ul>
<h4 data-id="heading-3">使用场景</h4>
<ol>
<li>用户说"帮我创建一个处理 PDF 的技能"→ 触发此技能，引导完成整个创建流程</li>
<li>用户说"我想把我的工作流程封装成一个技能"→ 从需求收集开始，逐步构建</li>
<li>用户说"优化/更新我的 xxx 技能"→ 进入迭代改进流程</li>
</ol>
<hr/>
<h3 data-id="heading-4">二、目录结构</h3>
<pre><code class="hljs language-bash" lang="bash">skill-creator/
├── SKILL.md          <span class="hljs-comment"># 核心指导文档（357行，约17.8KB）</span>
├── LICENSE.txt       <span class="hljs-comment"># 许可证文件</span>
├── references/       <span class="hljs-comment"># 空目录（无额外参考资料）</span>
└── scripts/          <span class="hljs-comment"># 空目录（无脚本）</span>
</code></pre>
<p>这是一个<strong>纯文本驱动</strong>的技能，没有脚本或参考资料，所有知识都浓缩在 SKILL.md 中。</p>
<hr/>
<h3 data-id="heading-5">三、作用机制分析</h3>
<h4 data-id="heading-6">3.1 触发机制</h4>
<p>通过 YAML frontmatter 中的 <code>description</code> 字段触发：</p>
<blockquote>
<p>"Guide for creating effective skills. This skill should be used when users want to create a new skill (or update an existing skill) that extends Claude's capabilities with specialized knowledge, workflows, or tool integrations."</p>
</blockquote>
<p>当用户提到"创建技能"、"制作 skill"、"封装工作流"等意图时，Claude 会匹配到此描述并加载 SKILL.md 的完整内容。</p>
<h4 data-id="heading-7">3.2 核心设计理念</h4>
<p>技能通过三个关键原则指导 Claude 的行为：</p>
<p><strong>原则一：简洁至上（Concise is Key）</strong></p>
<ul>
<li>上下文窗口是公共资源，技能不应浪费 token</li>
<li>默认假设 Claude 已经很聪明，只补充它不知道的信息</li>
<li>用简洁的示例代替冗长的解释</li>
</ul>
<p><strong>原则二：自由度匹配（Degrees of Freedom）</strong></p>
<ul>
<li>高自由度：文本指令，适用于多种方案都可行的场景</li>
<li>中自由度：伪代码/带参数的脚本，适用于有首选模式但允许变化的场景</li>
<li>低自由度：具体脚本，适用于操作脆弱、一致性关键的场景</li>
</ul>
<p><strong>原则三：渐进式披露（Progressive Disclosure）</strong></p>
<ul>
<li>三级加载系统：元数据（~100词，始终在上下文中）→ SKILL.md 主体（触发后加载）→ 捆绑资源（按需加载）</li>
<li>避免一次性加载所有内容，节省上下文窗口</li>
</ul>
<h4 data-id="heading-8">3.3 六步创建流程</h4>
<p>这是技能的核心方法论，定义了一个完整的技能创建工作流：</p>








































<table><thead><tr><th>步骤</th><th>内容</th><th>关键动作</th></tr></thead><tbody><tr><td>1. 理解需求</td><td>通过具体示例理解技能用途</td><td>向用户提问，收集使用场景</td></tr><tr><td>2. 规划内容</td><td>分析每个示例，识别可复用资源</td><td>确定需要哪些 scripts/references/assets</td></tr><tr><td>3. 初始化</td><td>运行 <code>init_skill.py</code> 生成模板</td><td>创建标准目录结构和模板文件</td></tr><tr><td>4. 编辑实现</td><td>编写 SKILL.md 和资源文件</td><td>实现脚本、编写指导文档</td></tr><tr><td>5. 打包发布</td><td>运行 <code>package_skill.py</code> 验证并打包</td><td>生成 .skill 分发文件</td></tr><tr><td>6. 迭代改进</td><td>基于实际使用反馈优化</td><td>发现问题 → 修改 → 重新测试</td></tr></tbody></table>
<h4 data-id="heading-9">3.4 技能架构规范</h4>
<p>SKILL.md 定义了技能的标准文件组织：</p>
<ul>
<li><strong><code>scripts/</code></strong>：可执行代码，用于需要确定性可靠性的重复任务（如 PDF 旋转脚本）</li>
<li><strong><code>references/</code></strong>：参考文档，按需加载到上下文中（如数据库 schema、API 文档）</li>
<li><strong><code>assets/</code></strong>：输出资源，不加载到上下文中而是直接用于输出（如模板、图标、字体）</li>
</ul>
<h4 data-id="heading-10">3.5 设计模式指导</h4>
<p>技能提供了三种渐进式披露的设计模式：</p>
<ol>
<li><strong>高层指南 + 引用</strong>：SKILL.md 给出概览，详细内容链接到 references 文件</li>
<li><strong>按领域组织</strong>：多领域技能按领域拆分参考文件，避免加载无关上下文</li>
<li><strong>条件性细节</strong>：基础内容直接展示，高级内容按需链接</li>
</ol>
<h4 data-id="heading-11">3.6 本质总结</h4>
<p>Skill Creator 本质上是一份<strong>结构化的方法论文档</strong>，它通过：</p>
<ol>
<li><strong>提示词引导</strong>：定义清晰的六步流程，让 Claude 按步骤执行</li>
<li><strong>架构规范</strong>：规定技能的标准目录结构和文件组织方式</li>
<li><strong>设计原则</strong>：通过"简洁"、"自由度匹配"、"渐进式披露"三大原则约束技能质量</li>
<li><strong>脚本工具链</strong>：引用 <code>init_skill.py</code> 和 <code>package_skill.py</code> 两个外部脚本完成初始化和打包</li>
</ol>
<p>它没有复杂的脚本逻辑，而是用精心组织的文本指令将 Claude 的通用能力引导到"技能创建"这个特定领域，是一个典型的<strong>提示词工程驱动</strong>的技能。</p>
<hr/>
<p><strong>📄 文档地址</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmylinwu%2Fskills-daily%2Ftree%2Fmain%2Foutputs%2F2026-02-10_skill-creator.md" target="_blank" title="https://github.com/mylinwu/skills-daily/tree/main/outputs/2026-02-10_skill-creator.md" ref="nofollow noopener noreferrer">github.com/mylinwu/ski…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[「OpenClaw」添加官方列表以外的LLM模型]]></title>    <link>https://juejin.cn/post/7605041451327864875</link>    <guid>https://juejin.cn/post/7605041451327864875</guid>    <pubDate>2026-02-10T15:57:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605041451327864875" data-draft-id="7605051978872225811" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="「OpenClaw」添加官方列表以外的LLM模型"/> <meta itemprop="keywords" content="AIGC,OpenAI"/> <meta itemprop="datePublished" content="2026-02-10T15:57:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="淡酒交魂"/> <meta itemprop="url" content="https://juejin.cn/user/2245627735450160"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            「OpenClaw」添加官方列表以外的LLM模型
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2245627735450160/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    淡酒交魂
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T15:57:18.000Z" title="Tue Feb 10 2026 15:57:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景：</h2>
<p>最近OpenClaw的热度非常高，我自己也在空闲期间搭了一个本地项目，在选择LLM大模型的时候优先选择了国内的Qwen大模型，并且完成了Oauth认证，但在我使用了两三个小时之后就开始没有应答反应，查询日志发现报错<code>qwen-portal/coder-model: 429 Free allocated quota exceeded.</code>,是Qwen Oauth的免费额度使用超限，所以今天来教大家如何来给自己OpenClaw配置自己想使用的LLM大模型，以及如何在额度超限时让OpenClaw自己切换使用新的LLM大模型</p>
<h2 data-id="heading-1">Qwen</h2>
<p>我们在第一次安装OpenClaw的时候可以发现，OpenClaw可以允许我们使用Qwen大模型，但是是使用Oauth的进行验证登录，并且只能使用<code>qwen-portal/coder-model</code>,<code>qwen-portal/vision-model</code>这两种大模型；</p>
<p>但是在<a href="https://link.juejin.cn?target=https%3A%2F%2Fbailian.console.aliyun.com%2Fcn-beijing%2F%3Fspm%3D5176.29597918.J_SEsSjsNv72yRuRFS2VknO.2.bf077b08HohNn0%26tab%3Dmodel%23%2Fmodel-market%2Fall%3Fproviders%3Dqwen" target="_blank" title="https://bailian.console.aliyun.com/cn-beijing/?spm=5176.29597918.J_SEsSjsNv72yRuRFS2VknO.2.bf077b08HohNn0&amp;tab=model#/model-market/all?providers=qwen" ref="nofollow noopener noreferrer">阿里云百炼</a>的模型广场上，我们可以看到很多Qwen的模型，比如<code>qwen3-max-2026-01-23</code>新的千问Max模型，<code>qwen-flash</code>千问3的Flash模型，<code>qwen3-vl-plus</code>千问3的视觉模型，以及<code>qwen-voice-design</code>千问的声音模型等等多模态模型，而在OpenClaw中是没有这些模型让我们可以选择的，并且这些多模态通常使用的是API Key进行认证和token付费的，而不是OpenClaw提供给我们的Oauth；</p>
<h3 data-id="heading-2">添加Qwen3 LLM大模型</h3>
<p>所以我们可以自行在openClaw的配置文件配置Qwen的模型，由于我们Qwen3模型和系统Qwen模型都属于Qwen，但认证方式又不相同，所以可以将这些模型统称为Qwen3，与系统Qwen模型做为区分；</p>
<p>然后我们找到<code>.openclaw/openclaw.json</code>这个文件，这个文件就是我们OpenClaw的所有配置项了，点开可以看到我们的<code>models</code>这个列表，这个列表就是我们引入的所有模型</p>
<p>我这边引入了Deepseek和系统自带的qwen-portal模型，其中<code>qwen-portal</code>的APIKey可以看到认证方式是通过<code>qwen-oauth</code>，然后我们可以在后面添加我们所需的qwen3模型，配置内容可以与我下方一致，只需将apiKey更换成阿里百炼中自己的ApiKey即可。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e7d88c9866540799c6faa8a948fe925~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5reh6YWS5Lqk6a2C:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771343844&amp;x-signature=UEWrn3PlfAnOMJ8J9tQOrhRjtD4%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/078c0bd74fc546c796f88999fa1a5144~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5reh6YWS5Lqk6a2C:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771343844&amp;x-signature=TDo2LmWQTsqPJXP6Ve8MPb6jpu8%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-&quot;qwen3&quot;:" lang="&quot;qwen3&quot;:">        "baseUrl": "https://dashscope.aliyuncs.com/compatible-mode/v1",
        "apiKey": "{{your-apiKey}}",
        "api": "openai-completions",
        "models": [
          {
            "id": "qwen-turbo",
            "name": "Qwen3 Turbo",
            "reasoning": false,
            "input": [
              "text"
            ],
            "cost": {
              "input": 0,
              "output": 0,
              "cacheRead": 0,
              "cacheWrite": 0
            },
            "contextWindow": 128000,
            "maxTokens": 8192
          },
          {
            "id": "qwen-plus",
            "name": "Qwen3 Plus",
            "reasoning": false,
            "input": [
              "text"
            ],
            "cost": {
              "input": 0,
              "output": 0,
              "cacheRead": 0,
              "cacheWrite": 0
            },
            "contextWindow": 128000,
            "maxTokens": 8192
          },
          {
            "id": "qwen-max",
            "name": "Qwen3 Max",
            "reasoning": false,
            "input": [
              "text"
            ],
            "cost": {
              "input": 0,
              "output": 0,
              "cacheRead": 0,
              "cacheWrite": 0
            },
            "contextWindow": 128000,
            "maxTokens": 8192
          },
          {
            "id": "qwen-flash",
            "name": "Qwen3 Flash",
            "reasoning": false,
            "input": [
              "text"
            ],
            "cost": {
              "input": 0,
              "output": 0,
              "cacheRead": 0,
              "cacheWrite": 0
            },
            "contextWindow": 128000,
            "maxTokens": 8192
          },
          {
            "id": "qwen-max-2026-01-23",
            "name": "Qwen3 Max 2026-01-23",
            "reasoning": false,
            "input": [
              "text"
            ],
            "cost": {
              "input": 0,
              "output": 0,
              "cacheRead": 0,
              "cacheWrite": 0
            },
            "contextWindow": 128000,
            "maxTokens": 8192
          }
        ]
      },
</code></pre>
<h2 data-id="heading-3">添加模型回退队列</h2>
<p>有时候默认使用的模型用着用着余额就被token消耗完了，这时候openClaw就像挂了一样，无论怎么发送消息都无法正确回复，只能通过<code>openclaw onboard</code>指令进行重装，然后选择一个新的LLM大模型，所以我们可以在配置中添加一个模型回退队列，让OpenClaw在默认的模型返回异常时，自动选择队列中的模型进行请求；</p>
<h3 data-id="heading-4">配置方法</h3>
<p>1.OpenClaw的配置与上方一样，找到<code>.openclaw/openclaw.json</code>这个文件</p>
<p>2.在<code>models</code>相同缩进的下方，找到Agents，然后修改配置与我下方相似，在<code>agents/defaults/model</code>下方增加一个<code>fallbacks</code>队列，由上往下就是失败后依次会尝试的模型队列,<code>primary</code>是我们默认使用的LLM模型</p>
<p>3.<code>models</code>就是引进的所有LLM Model，这里使用自己的配置中的<code>models</code>无需和我一致</p>
<p>4.<code>workspace</code>使用自己openclaw的工作空间，无需和我一致</p>
<p>5.其他配置可以均与我保持一致</p>
<p>这样就完成了默认的LLM额度超限后会自动调用回退队列中的LLM大模型继续进行会话访问。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"agents"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"defaults"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"primary"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"xiaomi/mimo-v2-flash"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"fallbacks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-string">"xiaomi/mimo-v2-flash"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-string">"qwen3/qwen-turbo"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-string">"qwen3/qwen-plus"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-string">"qwen3/qwen-max"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-string">"qwen3/qwen-max-2026-01-23"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-string">"deepseek/deepseek-coder"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-string">"qwen-portal/coder-model"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-string">"qwen-portal/vision-model"</span>
        <span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"models"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"qwen3/qwen-turbo"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"qwen3-turbo"</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"qwen3/qwen-plus"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"qwen3-plus"</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"qwen3/qwen-max"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"qwen3-max"</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"qwen3/qwen-max-2026-01-23"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"qwen3-max-2026"</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"qwen3/qwen-flash"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"qwen3-flash"</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"qwen-portal/coder-model"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"qwen"</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"qwen-portal/vision-model"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"deepseek/deepseek-chat"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"deepseek-chat"</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"deepseek/deepseek-coder"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"deepseek-coder"</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"xiaomi/mimo-v2-flash"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Xiaomi"</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"workspace"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/Users/clawd"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"compaction"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"mode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"safeguard"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"maxConcurrent"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"subagents"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"maxConcurrent"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
</code></pre>
<h2 data-id="heading-5">结尾</h2>
<p>如果这篇文章对你有帮助的话，麻烦各位大佬帮忙点个小赞；如果你也对OpenClaw感兴趣的话，欢迎关注我</p>
<p>下期给大家介绍如何使用飞书与我们的OpenClaw进行无阻碍对话，让它成为我们真正的24小时助手！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Docker 入门看这一篇就够了：从 0 到部署 Java 和 Node 项目实战]]></title>    <link>https://juejin.cn/post/7604863528945401871</link>    <guid>https://juejin.cn/post/7604863528945401871</guid>    <pubDate>2026-02-11T01:51:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604863528945401871" data-draft-id="7604881286036996148" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Docker 入门看这一篇就够了：从 0 到部署 Java 和 Node 项目实战"/> <meta itemprop="keywords" content="后端,Docker,容器"/> <meta itemprop="datePublished" content="2026-02-11T01:51:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员大华"/> <meta itemprop="url" content="https://juejin.cn/user/3507878440995946"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Docker 入门看这一篇就够了：从 0 到部署 Java 和 Node 项目实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3507878440995946/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员大华
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T01:51:40.000Z" title="Wed Feb 11 2026 01:51:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是大华！</p>
<p>在后端和运维领域，<strong>Docker 几乎已经成了绕不开的技术</strong>。
面试在问，同事在用，越来越多的开源项目也默认提供了 Docker 一键部署方案。</p>
<p>那 Docker 到底解决了什么问题？
为什么现在的部署项目，大家都会优先选择它？</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16c23ed7efcd47918a7de1d2c6451c3b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771379503&amp;x-signature=HVHmSdpRM03WMmP5fg3qQaESYTU%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>这篇文章，我想从一个新手的视角，把 Docker 讲清楚。</p>
<h2 data-id="heading-0">一、Docker是什么？</h2>
<h3 data-id="heading-1">简单比喻</h3>
<p>假设你要搬家：</p>
<ul>
<li><strong>传统方式</strong>：家具要拆、线路要拔、到新家后再一件件装回去，装的时候还可能发现：少了某个零件、接口不对、怎么都摆不回原样。</li>
<li><strong>Docker方式</strong>：直接把整个房间拍个快照，家具、布置、电器、位置全都封装好。到新家一键还原，跟原来一模一样。</li>
</ul>
<p>Docker 做的，就是这件事。它把一个应用运行所需要的所有东西，代码、运行环境、依赖、配置，一次性打包成一个标准化的箱子。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70a6d4dd0a19401d9d33c2e2d1a3052a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771379503&amp;x-signature=ziafdo51G7y8X4Qm%2BagmXftrcrM%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>不管你把这个箱子搬到哪里，只要能打开，它的表现永远一致。</p>
<h3 data-id="heading-2">专业解释</h3>
<p>Docker是一个<strong>容器化平台</strong>，让开发者可以：</p>
<ul>
<li>把应用程序及其所有依赖项（库、环境变量、配置文件）打包在一起</li>
<li>在任何支持 Docker 的机器上运行，保证环境一致</li>
<li>从而实现一次构建，到处运行</li>
</ul>
<h2 data-id="heading-3">二、Docker有什么用？</h2>
<h3 data-id="heading-4">1. 开发人员的痛点</h3>
<pre><code class="hljs language-diff" lang="diff">开发者小明说：“在我电脑上运行好好的！”
运维人员回复：“在服务器上就是跑不起来！”

原因排查：
<span class="hljs-deletion">- 操作系统不同（Windows vs Linux）</span>
<span class="hljs-deletion">- Node.js版本不同（12.x vs 14.x）</span>
<span class="hljs-deletion">- 依赖库版本冲突</span>
<span class="hljs-deletion">- 环境变量配置不同</span>
<span class="hljs-deletion">- 文件路径不一致</span>
</code></pre>
<p>最后你会发现，问题不是代码，而是环境。</p>
<p>Docker 出现的意义，就是把环境这件事彻底消灭。</p>
<h3 data-id="heading-5">2. 快速部署</h3>
<p><strong>传统部署</strong>：装系统、装运行环境、配环境变量再到装依赖等等，顺利的话，也要一两个小时。</p>
<p><strong>Docker部署</strong>：下载镜像、运行容器，几分钟就能完成。</p>
<h3 data-id="heading-6">3. 资源节省</h3>
<p>很多人会拿 Docker 和虚拟机做对比。</p>
<p><strong>虚拟机的方式</strong>：每个应用自带一整套操作系统，占用动不动就是几个 GB</p>
<p><strong>Docker 的方式</strong>：容器之间共享宿主机系统，只保留应用真正需要的东西，通常是 MB 级别。</p>
<p><strong>你可以理解为</strong>：</p>
<ul>
<li>虚拟机：每个项目都自己买一套房</li>
<li>Docker：很多项目住在同一栋楼里，各自一间房</li>
</ul>
<h2 data-id="heading-7">三、Docker 的四个核心概念</h2>
<p>Docker 的核心概念其实非常少。</p>
<p>如果只用一句话来概括：<strong>Docker 用镜像准备环境，用容器运行程序。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bdf256b549ed4ca78d9854b43b33e161~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771379503&amp;x-signature=DErjLAyYZLbs0QQNZvqCh2TCH7o%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-8">1、镜像（Image）</h3>
<p><strong>镜像就是运行环境的模板。</strong></p>
<p>它里面已经准备好了系统、运行时以及应用需要的依赖，但镜像本身是不能直接运行的，更像一个安装包。比如 <code>node:18</code>、<code>openjdk:17</code>、<code>mysql:8</code>，都是现成可以用的镜像。</p>
<h3 data-id="heading-9">2、容器（Container）</h3>
<p><strong>容器是镜像运行之后的样子。</strong></p>
<p>镜像是静态的，容器是正在运行的。你平时对应用做的启动、停止、删除、查看日志，操作的其实都是容器。一个镜像可以同时启动多个容器，这也是 Docker 能跑多个实例的原因。</p>
<h3 data-id="heading-10">3、Dockerfile</h3>
<p><strong>Dockerfile 用来告诉 Docker，这个镜像该怎么做。</strong></p>
<p>它是一个普通文本文件，里面写清楚：用什么基础镜像、代码放在哪里、要不要安装依赖，以及程序最终如何启动。想定制自己的镜像，就必须有 Dockerfile。</p>
<h3 data-id="heading-11">4、仓库（Docker Hub）</h3>
<p><strong>Docker Hub 是镜像的来源。</strong></p>
<p>它就像一个应用商店，存放着大量官方和社区维护的镜像。</p>
<p>Dockerfile 里写的 <code>FROM node:18</code>，意思就是：从 Docker Hub 拉取一个 Node 18 的镜像作为基础环境。</p>
<hr/>
<p>把这几个概念串起来就是一句话：<strong>Dockerfile 用来构建镜像，镜像用来创建容器，而镜像通常来自 Docker Hub。</strong></p>
<h2 data-id="heading-12">四、安装Docker（以 Ubuntu 为例）</h2>
<p>下面以 <strong>Ubuntu 20.04 / 22.04</strong> 为例，介绍最常见、也是最稳妥的安装方式。</p>
<h3 data-id="heading-13">步骤 1：更新系统并安装基础依赖</h3>
<pre><code class="hljs language-bash" lang="bash">sudo apt update
sudo apt install -y ca-certificates curl gnupg lsb-release
</code></pre>
<p>这些工具主要用来安全地添加 Docker 官方仓库。</p>
<hr/>
<h3 data-id="heading-14">步骤 2：添加 Docker 官方 GPG Key</h3>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">mkdir</span> -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
</code></pre>
<hr/>
<h3 data-id="heading-15">步骤 3：添加 Docker 官方软件源</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">echo</span> \
  <span class="hljs-string">"deb [arch=<span class="hljs-subst">$(dpkg --print-architecture)</span> signed-by=/etc/apt/keyrings/docker.gpg] \
  https://download.docker.com/linux/ubuntu \
  <span class="hljs-subst">$(lsb_release -cs)</span> stable"</span> | \
  sudo <span class="hljs-built_in">tee</span> /etc/apt/sources.list.d/docker.list &gt; /dev/null
</code></pre>
<hr/>
<h3 data-id="heading-16">步骤 4：安装 Docker 引擎</h3>
<pre><code class="hljs language-bash" lang="bash">sudo apt update
sudo apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
</code></pre>
<hr/>
<h3 data-id="heading-17">步骤 5：验证是否安装成功</h3>
<pre><code class="hljs language-bash" lang="bash">docker --version
sudo docker run hello-world
</code></pre>
<p>如果看到：</p>
<pre><code class="hljs language-csharp" lang="csharp">Hello <span class="hljs-keyword">from</span> Docker!
</code></pre>
<p>说明 Docker 已经在你的 Ubuntu 服务器上成功运行。</p>
<hr/>
<h3 data-id="heading-18">（可选）步骤 6：非 root 用户运行 Docker</h3>
<p>默认情况下，Docker 需要 <code>sudo</code> 权限。如果你不想每次都加 <code>sudo</code>，可以执行：</p>
<pre><code class="hljs language-bash" lang="bash">sudo usermod -aG docker <span class="hljs-variable">$USER</span>
</code></pre>
<p>然后 <strong>退出当前终端重新登录</strong>，再测试：</p>
<pre><code class="hljs language-bash" lang="bash">docker ps
</code></pre>
<p>能正常执行，说明配置成功。</p>
<hr/>
<h2 data-id="heading-19">五、常用的Docker命令</h2>
<h3 data-id="heading-20">基础命令</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看版本</span>
docker --version

<span class="hljs-comment"># 查看所有命令</span>
docker --<span class="hljs-built_in">help</span>

<span class="hljs-comment"># 查看运行中的容器</span>
docker ps

<span class="hljs-comment"># 查看所有容器（包括停止的）</span>
docker ps -a

<span class="hljs-comment"># 查看本地镜像</span>
docker images

<span class="hljs-comment"># 下载镜像（从Docker Hub）</span>
docker pull 镜像名:标签
<span class="hljs-comment"># 示例：docker pull node:14</span>

<span class="hljs-comment"># 运行容器</span>
docker run [选项] 镜像名
<span class="hljs-comment"># 示例：docker run -it ubuntu bash</span>

<span class="hljs-comment"># 停止容器</span>
docker stop 容器ID或名字

<span class="hljs-comment"># 删除容器</span>
docker <span class="hljs-built_in">rm</span> 容器ID或名字

<span class="hljs-comment"># 删除镜像</span>
docker rmi 镜像ID或名字
</code></pre>
<h3 data-id="heading-21">常用选项</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># -d：后台运行（守护进程模式）</span>
docker run -d nginx

<span class="hljs-comment"># -p：端口映射（主机端口:容器端口）</span>
docker run -p 8080:80 nginx

<span class="hljs-comment"># -v：挂载卷（主机目录:容器目录）</span>
docker run -v /home/data:/app/data nginx

<span class="hljs-comment"># --name：给容器起名字</span>
docker run --name my_nginx nginx

<span class="hljs-comment"># -it：交互模式运行</span>
docker run -it ubuntu bash
</code></pre>
<h2 data-id="heading-22">六、部署Java项目（Spring Boot示例）</h2>
<hr/>
<h3 data-id="heading-23">项目结构（Windows 本地）</h3>
<pre><code class="hljs language-text" lang="text">my-java-app/
├── src/          # 源代码
├── pom.xml       # Maven 配置文件
└── Dockerfile    # Docker 构建文件
</code></pre>
<hr/>
<h3 data-id="heading-24">步骤1：编写 Dockerfile（Windows 本地）</h3>
<p>在项目根目录下创建 <code>Dockerfile</code>：</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile"># 使用官方 Java 运行环境作为基础镜像
FROM openjdk:11-jre-slim

# 设置容器内工作目录
WORKDIR /app

# 复制 Spring Boot 打包后的 jar 文件
COPY target/myapp.jar app.jar

# 暴露端口（Spring Boot 默认 8080）
EXPOSE 8080

# 启动应用
ENTRYPOINT ["java", "-jar", "app.jar"]
</code></pre>
<p>⚠️ 注意：
Dockerfile 中的路径是 <strong>容器内路径</strong>，和 Windows / Linux 本机路径无关。</p>
<hr/>
<h3 data-id="heading-25">步骤2：Windows 本地打包项目</h3>
<p>在 <strong>Windows 本地开发环境</strong> 执行：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 进入项目目录</span>
<span class="hljs-built_in">cd</span> my-java-app

<span class="hljs-comment"># 使用 Maven 打包（生成 target/myapp.jar）</span>
mvn clean package
</code></pre>
<p>执行完成后，确认文件存在：</p>
<pre><code class="hljs language-text" lang="text">target/myapp.jar
</code></pre>
<hr/>
<h3 data-id="heading-26">步骤3：将项目传到 Linux 服务器</h3>
<h4 data-id="heading-27">方式一：使用 scp（推荐）</h4>
<p>在 Windows 终端（PowerShell / Git Bash）中执行：</p>
<pre><code class="hljs language-bash" lang="bash">scp -r my-java-app user@服务器IP:/home/user/
</code></pre>
<p>示例：</p>
<pre><code class="hljs language-bash" lang="bash">scp -r my-java-app root@123.456.78.90:/root/
</code></pre>
<hr/>
<h3 data-id="heading-28">步骤4：Linux 服务器上构建 Docker 镜像</h3>
<p>登录 Linux 服务器后执行：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> my-java-app
</code></pre>
<p>构建镜像：</p>
<pre><code class="hljs language-bash" lang="bash">docker build -t my-java-app:1.0 .
</code></pre>
<p>查看镜像是否构建成功：</p>
<pre><code class="hljs language-bash" lang="bash">docker images
</code></pre>
<hr/>
<h3 data-id="heading-29">步骤5：在 Linux 上运行容器</h3>
<pre><code class="hljs language-bash" lang="bash">docker run -d \
  -p 8080:8080 \
  --name java-app \
  my-java-app:1.0
</code></pre>
<p>查看容器状态：</p>
<pre><code class="hljs language-bash" lang="bash">docker ps
</code></pre>
<p>查看日志：</p>
<pre><code class="hljs language-bash" lang="bash">docker logs java-app
</code></pre>
<hr/>
<h3 data-id="heading-30">步骤6：访问应用</h3>
<pre><code class="hljs language-text" lang="text">http://123.456.78.90:8080
</code></pre>
<hr/>
<h2 data-id="heading-31">七、部署Node.js项目（Express示例）</h2>
<h3 data-id="heading-32">项目结构（Windows 本地）</h3>
<pre><code class="hljs language-text" lang="text">my-node-app/
├── src/
├── package.json
├── server.js
└── Dockerfile
</code></pre>
<hr/>
<h3 data-id="heading-33">步骤1：编写 Dockerfile（Windows 本地）</h3>
<p>在项目根目录创建 <code>Dockerfile</code>：</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile"># 使用官方 Node.js 运行环境
FROM node:18-alpine

# 设置容器工作目录
WORKDIR /app

# 复制依赖配置文件
COPY package*.json ./

# 安装依赖
RUN npm install --production

# 复制项目代码
COPY . .

# 暴露端口
EXPOSE 3000

# 启动应用
CMD ["node", "server.js"]
</code></pre>
<hr/>
<h3 data-id="heading-34">步骤2：将项目上传到 Linux 服务器</h3>
<h4 data-id="heading-35">方式一：scp 传输（推荐）</h4>
<p>在 Windows 终端执行：</p>
<pre><code class="hljs language-bash" lang="bash">scp -r my-node-app user@服务器IP:/home/user/
</code></pre>
<p>例如：</p>
<pre><code class="hljs language-bash" lang="bash">scp -r my-node-app root@123.456.78.90:/root/
</code></pre>
<hr/>
<h3 data-id="heading-36">步骤3：Linux 服务器构建镜像</h3>
<p>登录 Linux 服务器：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> my-node-app
</code></pre>
<p>构建镜像：</p>
<pre><code class="hljs language-bash" lang="bash">docker build -t my-node-app:1.0 .
</code></pre>
<p>查看镜像：</p>
<pre><code class="hljs language-bash" lang="bash">docker images
</code></pre>
<hr/>
<h3 data-id="heading-37">步骤4：运行容器</h3>
<pre><code class="hljs language-bash" lang="bash">docker run -d \
  -p 3000:3000 \
  --name node-app \
  my-node-app:1.0
</code></pre>
<p>查看运行状态：</p>
<pre><code class="hljs language-bash" lang="bash">docker ps
</code></pre>
<p>查看日志：</p>
<pre><code class="hljs language-bash" lang="bash">docker logs node-app
</code></pre>
<hr/>
<h3 data-id="heading-38">步骤5：访问应用</h3>
<pre><code class="hljs language-text" lang="text">http://服务器IP:3000
</code></pre>
<hr/>
<h3 data-id="heading-39">可选：多阶段构建优化版（推荐生产环境）</h3>
<pre><code class="hljs language-dockerfile" lang="dockerfile"># 构建阶段
FROM node:18-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

# 运行阶段
FROM node:18-alpine
WORKDIR /app
COPY --from=builder /app/node_modules ./node_modules
COPY . .
EXPOSE 3000
CMD ["node", "server.js"]
</code></pre>
<hr/>
<h2 data-id="heading-40">八、同时部署 Java + Node + MySQL</h2>
<p>这里使用的是 <code>Docker Compose</code>，<code>Docker Compose</code> 是用一个配置文件，统一管理多个 Docker 容器的工具。</p>
<h3 data-id="heading-41">场景说明</h3>
<p>服务器部署结构：</p>
<pre><code class="hljs">Linux服务器
 ├── MySQL
 ├── Spring Boot 后端
 └── Node 前端
</code></pre>
<hr/>
<h3 data-id="heading-42">步骤1：服务器准备目录结构</h3>
<p>在 Linux 服务器创建：</p>
<pre><code class="hljs language-bash" lang="bash">project/
 ├── docker-compose.yml
 ├── java-backend/
 └── node-frontend/
</code></pre>
<p>把两个项目代码分别上传进去。</p>
<hr/>
<h3 data-id="heading-43">步骤2：创建 docker-compose.yml</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">'3.8'</span>

<span class="hljs-attr">services:</span>

  <span class="hljs-attr">mysql:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:8.0</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">mysql</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">MYSQL_ROOT_PASSWORD:</span> <span class="hljs-string">rootpassword</span>
      <span class="hljs-attr">MYSQL_DATABASE:</span> <span class="hljs-string">mydb</span>
      <span class="hljs-attr">MYSQL_USER:</span> <span class="hljs-string">user</span>
      <span class="hljs-attr">MYSQL_PASSWORD:</span> <span class="hljs-string">password</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"3306:3306"</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">mysql-data:/var/lib/mysql</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">app-network</span>

  <span class="hljs-attr">java-backend:</span>
    <span class="hljs-attr">build:</span> <span class="hljs-string">./java-backend</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">java-backend</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"8080:8080"</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">SPRING_DATASOURCE_URL:</span> <span class="hljs-string">jdbc:mysql://mysql:3306/mydb</span>
      <span class="hljs-attr">SPRING_DATASOURCE_USERNAME:</span> <span class="hljs-string">user</span>
      <span class="hljs-attr">SPRING_DATASOURCE_PASSWORD:</span> <span class="hljs-string">password</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">mysql</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">app-network</span>

  <span class="hljs-attr">node-frontend:</span>
    <span class="hljs-attr">build:</span> <span class="hljs-string">./node-frontend</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">node-frontend</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"3000:3000"</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">API_URL:</span> <span class="hljs-string">http://java-backend:8080</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">java-backend</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">app-network</span>

<span class="hljs-attr">networks:</span>
  <span class="hljs-attr">app-network:</span>
    <span class="hljs-attr">driver:</span> <span class="hljs-string">bridge</span>

<span class="hljs-attr">volumes:</span>
  <span class="hljs-attr">mysql-data:</span>
</code></pre>
<hr/>
<h3 data-id="heading-44">步骤3：启动所有服务（Linux 服务器执行）</h3>
<pre><code class="hljs language-bash" lang="bash">docker compose up -d
</code></pre>
<p>新版本 Docker 推荐 <code>docker compose</code>，老版本使用 <code>docker-compose</code>。</p>
<hr/>
<p>查看运行状态：</p>
<pre><code class="hljs language-bash" lang="bash">docker compose ps
</code></pre>
<p>查看日志：</p>
<pre><code class="hljs language-bash" lang="bash">docker compose logs -f
</code></pre>
<p>停止服务：</p>
<pre><code class="hljs language-bash" lang="bash">docker compose down
</code></pre>
<hr/>
<h3 data-id="heading-45">步骤4：访问系统</h3>
<h4 data-id="heading-46">node访问</h4>
<pre><code class="hljs language-text" lang="text">http://服务器IP:3000
</code></pre>
<hr/>
<h4 data-id="heading-47">java访问</h4>
<pre><code class="hljs language-text" lang="text">http://服务器IP:8080
</code></pre>
<hr/>
<h4 data-id="heading-48">MySQL 连接地址</h4>
<pre><code class="hljs language-text" lang="text">服务器IP:3306
</code></pre>
<h2 data-id="heading-49">九、实用的几个常用命令</h2>
<h3 data-id="heading-50">1. 进入运行中的容器</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 进入容器内的bash</span>
docker <span class="hljs-built_in">exec</span> -it 容器名 bash

<span class="hljs-comment"># 在容器内执行命令</span>
docker <span class="hljs-built_in">exec</span> 容器名 <span class="hljs-built_in">ls</span> /app
</code></pre>
<h3 data-id="heading-51">2. 查看容器资源使用</h3>
<pre><code class="hljs language-bash" lang="bash">docker stats
</code></pre>
<h3 data-id="heading-52">3. 清理无用资源</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 删除所有停止的容器</span>
docker container prune

<span class="hljs-comment"># 删除所有未被使用的镜像</span>
docker image prune

<span class="hljs-comment"># 删除所有未被使用的网络</span>
docker network prune

<span class="hljs-comment"># 一键清理所有</span>
docker system prune -a
</code></pre>
<h3 data-id="heading-53">4. 查看镜像构建历史</h3>
<pre><code class="hljs language-bash" lang="bash">docker <span class="hljs-built_in">history</span> 镜像名
</code></pre>
<h3 data-id="heading-54">5. 备份和恢复</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 备份镜像到文件</span>
docker save -o myapp.tar myapp:1.0

<span class="hljs-comment"># 从文件恢复镜像</span>
docker load -i myapp.tar
</code></pre>
<h2 data-id="heading-55">写在最后</h2>
<p>如果你是第一次接触 Docker，看到这里可能还是有点懵，这很正常。</p>
<p>等你哪天真的把一个项目从本地跑到服务器上，用 Docker 一次性拉起来的时候，那种终于搞定了的感觉，会非常明显。</p>
<blockquote>
<p>本文首发于公众号：程序员大华，专注前端、Java开发，AI应用和工具的分享。关注我，少走弯路，一起进步！</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[保姆级教程：用 Coze 打造宠物→冰球运动员拟人化工作流]]></title>    <link>https://juejin.cn/post/7605030650279411758</link>    <guid>https://juejin.cn/post/7605030650279411758</guid>    <pubDate>2026-02-10T13:50:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605030650279411758" data-draft-id="7605097326726430766" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="保姆级教程：用 Coze 打造宠物→冰球运动员拟人化工作流 "/> <meta itemprop="keywords" content="Coze"/> <meta itemprop="datePublished" content="2026-02-10T13:50:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="不会敲代码1"/> <meta itemprop="url" content="https://juejin.cn/user/1927884034804425"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            保姆级教程：用 Coze 打造宠物→冰球运动员拟人化工作流 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1927884034804425/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    不会敲代码1
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T13:50:07.000Z" title="Tue Feb 10 2026 13:50:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">【掘金专属】保姆级教程：用 Coze 打造宠物→冰球运动员拟人化工作流 🐾🏒</h2>
<blockquote>
<p>5 分钟上手！0 代码基础也能搭建，把你家毛孩子变成超酷的冰球小将</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">🔥 前言：为什么要做这个工作流？</h3>
<p>养宠的你是不是总忍不住幻想：如果家里的猫猫狗狗能化身运动健将，会是什么样子？不用再靠脑补了！今天就手把手教你在 Coze（扣子）上搭建一个「宠物拟人冰球运动员生成器」—— 只需上传一张宠物照片，填写几个简单参数，就能一键生成专属的冰球运动员拟人化形象，既有宠物的萌趣特征，又有冰球运动的飒爽感，发朋友圈、做壁纸都超吸睛！</p>
<hr/>
<h3 data-id="heading-2">🎯 项目核心目标</h3>
<ul>
<li><strong>输入</strong>：宠物照片 + 自定义参数（风格 / 球衣号码 / 颜色 / 场上位置等）</li>
<li><strong>输出</strong>：高度还原宠物特征的冰球运动员拟人化高清图片</li>
<li><strong>亮点</strong>：0 代码基础也能搭，参数可灵活调整，生成效果可控性强</li>
</ul>
<hr/>
<h3 data-id="heading-3">📋 前置准备</h3>
<h4 data-id="heading-4">1. 素材准备</h4>
<ul>
<li>一张清晰的宠物照片（建议竖版 / 正方形，单张不超过 5MB，面部特征清晰最佳）</li>
<li>可选：冰球风格参考图（如喜欢的队服样式、拟人风格示例）</li>
</ul>
<h4 data-id="heading-5">2. 思路梳理</h4>
<p>提前想好这些参数，生成效果更贴合预期：</p>
<ul>
<li>生成风格：写实 / 卡通 / 赛博朋克 / 二次元 / 复古等</li>
<li>球衣信息：号码（0-99）、主色调（红 / 蓝 / 黑 / 白等）</li>
<li>运动参数：场上位置（守门员 / 前锋 / 后卫）、持杆手（左手 / 右手）</li>
</ul>
<hr/>
<h3 data-id="heading-6">🛠️ 工作流整体架构（附逻辑图）</h3>
<p>整个工作流分为 6 个核心节点，逻辑清晰、环环相扣：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a91669e2a2e04e6bb45b3c9dcffae1b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5Lya5pWy5Luj56CBMQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336211&amp;x-signature=Ruxgteq2Mc8Yj4R4rBY2bpKTA7U%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>（工作流整体架构图）</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5b69da50c8c4d2fae47eec68be9f2f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5Lya5pWy5Luj56CBMQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336211&amp;x-signature=fZ9WKudZ6%2Fu6FvSLg3PR2jTUdcg%3D" alt="屏幕截图 2026-02-10 210111.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-7">📝 详细搭建步骤（每步附操作截图）</h3>
<h4 data-id="heading-8">第一步：创建「开始」节点（入口配置）</h4>
<p>这是工作流的 “大门”，所有用户输入都从这里进入。</p>
<h5 data-id="heading-9">操作步骤：</h5>
<ol>
<li>打开 Coze 工作台，新建「工作流」应用</li>
<li>拖拽「开始」节点到画布，点击「编辑」</li>
<li>按如下配置输入参数（直接复制即可）：</li>
</ol>
<p>表格</p>





























































<table><thead><tr><th>变量名</th><th>变量类型</th><th>必填</th><th>默认值</th><th>描述</th><th>配置技巧</th></tr></thead><tbody><tr><td><code>picture</code></td><td>Image</td><td>✅</td><td>-</td><td>宠物照片</td><td>标注 “请上传清晰的宠物正面照”</td></tr><tr><td><code>style</code></td><td>String</td><td>❌</td><td>写实</td><td>生成风格</td><td>可添加示例：写实 / 卡通 / 赛博朋克</td></tr><tr><td><code>uniform_number</code></td><td>Number</td><td>❌</td><td>10</td><td>球衣号码</td><td>限制范围 0-99 更合理</td></tr><tr><td><code>uniform_color</code></td><td>String</td><td>❌</td><td>红</td><td>球衣颜色</td><td>建议填写具体色值 / 名称</td></tr><tr><td><code>position</code></td><td>Number</td><td>❌</td><td>随机</td><td>场上位置</td><td>0 = 守门员 / 1 = 前锋 / 2 = 后卫</td></tr><tr><td><code>shotting_hand</code></td><td>Number</td><td>❌</td><td>随机</td><td>持杆手</td><td>0 = 左手 / 1 = 右手</td></tr></tbody></table>
<h5 data-id="heading-10">关键提示：</h5>
<ul>
<li>点击每个参数后的「设置」，添加「描述」帮助用户理解</li>
<li>默认值可根据你的常用偏好调整（比如把球衣颜色改成你喜欢的球队色）</li>
</ul>
<blockquote>
<p>（「开始」节点配置截图）</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2defe01f6bb54304b56e34d7a4296d35~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5Lya5pWy5Luj56CBMQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336211&amp;x-signature=DlA0p231MgcJ9yE%2FHH7ntmC2Luk%3D" alt="屏幕截图 2026-02-10 210202.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb106ab63ba845a9bc5bfcf3f17325f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5Lya5pWy5Luj56CBMQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336211&amp;x-signature=8EzjIvYy4eVqM5BSkQQ3aDQiV%2B0%3D" alt="屏幕截图 2026-02-10 210235.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f0983a16bf646deb9d0f7601d60cb14~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5Lya5pWy5Luj56CBMQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336211&amp;x-signature=LO%2FZPbioTYtWXjnmoPJq%2FmAh86c%3D" alt="屏幕截图 2026-02-10 210254.png" loading="lazy"/></p>
<hr/>
<h4 data-id="heading-11">第二步：配置「图片理解」节点（视觉分析）</h4>
<p>这个节点是 “眼睛”，能自动读懂宠物照片的核心特征。</p>
<h5 data-id="heading-12">操作步骤：</h5>
<ol>
<li>拖拽「模型调用」节点到画布，重命名为「图片理解」</li>
<li>模型选择：豆包 1.5 Pro・视觉理解 - 250328（大家可能这个模型无法处理图片可以更换别的视觉处理模型）</li>
<li>输入配置：<code>img</code> 字段连接「开始」节点的 <code>picture</code> 输出</li>
<li>系统提示词（直接复制）：</li>
</ol>
<p>text</p>
<pre><code class="hljs language-markdown" lang="markdown">你是专业的宠物特征分析专家，请详细描述这张宠物图片的核心特征，包括但不限于：
<span class="hljs-bullet">1.</span> 宠物种类（猫/狗/其他）、毛色/花纹
<span class="hljs-bullet">2.</span> 面部特征（眼睛形状/颜色、鼻子/嘴巴特征、耳朵形状）
<span class="hljs-bullet">3.</span> 神态/表情（呆萌/活泼/高冷）
<span class="hljs-bullet">4.</span> 体型/姿态（胖瘦、站立/趴卧等）
描述越详细，后续拟人化效果越精准。
</code></pre>
<p>5.  输出字段：默认 <code>sk_output</code>（存储特征描述文本）</p>
<h5 data-id="heading-13">关键提示：</h5>
<ul>
<li>视觉模型需确保开通权限，否则会提示调用失败</li>
<li>提示词越具体，特征提取越精准</li>
</ul>
<blockquote>
<p>（「图片理解」节点配置截图）</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b96218349b546008756c312fe594f94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5Lya5pWy5Luj56CBMQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336211&amp;x-signature=nRURA18HelVycl3eCORN%2Fmd0rpY%3D" alt="屏幕截图 2026-02-10 210351.png" loading="lazy"/></p>
<hr/>
<h4 data-id="heading-14">第三步：配置「特征提取」节点（核心提炼）</h4>
<p>从图片理解的结果中，筛选出最具辨识度的特征，为拟人化打基础。</p>
<h5 data-id="heading-15">操作步骤：</h5>
<ol>
<li>拖拽「模型调用」节点到画布，重命名为「特征提取」</li>
<li>模型选择：豆包 1.8・深度思考</li>
<li>输入配置：<code>input</code> 字段连接「图片理解」节点的 <code>sk_output</code></li>
<li>系统提示词（直接复制）：</li>
</ol>
<p>text</p>
<pre><code class="hljs language-markdown" lang="markdown">你是资深动物拟人化设计师，现在需要从以下宠物特征描述中，提取出最适合做拟人化的核心特征（仅保留独特、高辨识度的内容）：
要求：
<span class="hljs-bullet">1.</span> 输出JSON格式，字段包括：unique<span class="hljs-emphasis">_features（独特特征）、expression（神态）、color_</span>mapping（颜色映射建议）
<span class="hljs-bullet">2.</span> 颜色映射建议要适配冰球服配色（比如“橘白相间的毛色→队服主橘色+白色镶边”）
<span class="hljs-bullet">3.</span> 特征描述要简洁、可直接用于图像生成提示词
</code></pre>
<p>5.  用户提示词：<code>{{input}}</code></p>
<ol start="6">
<li>
<p>输出字段：</p>
<ul>
<li><code>output</code>：JSON 格式的结构化特征（核心）</li>
<li><code>reasoning_content</code>：推理过程（可选，用于调试）</li>
</ul>
</li>
</ol>
<h5 data-id="heading-16">关键提示：</h5>
<ul>
<li>强制要求 JSON 输出，后续代码节点处理更方便</li>
<li>颜色映射建议能让拟人化更贴合宠物特征</li>
</ul>
<blockquote>
<p>（「特征提取」节点配置截图）</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1594156d8ab40efbf67064f78de0a1b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5Lya5pWy5Luj56CBMQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336211&amp;x-signature=5WdCuQ7ZlCJ4Zt%2BEMSD76Il%2BApc%3D" alt="屏幕截图 2026-02-10 210407.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb8e62c05b0c45cebe6b37e94c27aa4d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5Lya5pWy5Luj56CBMQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336211&amp;x-signature=7zQehf4dfYwCsVrQrYBiXuJIE0w%3D" alt="屏幕截图 2026-02-10 210422.png" loading="lazy"/></p>
<hr/>
<h4 data-id="heading-17">第四步：配置「代码」节点（参数标准化）</h4>
<p>把用户输入的零散参数转换成图像生成能直接用的标准化格式（0 代码基础也能复制即用）。</p>
<h5 data-id="heading-18">操作步骤：</h5>
<ol>
<li>拖拽「代码」节点到画布，重命名为「参数标准化」</li>
<li>输入配置：连接「开始」节点的所有参数（style/uniform_number 等）</li>
<li>代码逻辑（直接复制，无需修改）：</li>
</ol>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">random</span> = (start: number, end: number) =&gt; {
  const <span class="hljs-attr">p</span> = Math.random()<span class="hljs-comment">;</span>
  return Math.floor(start * (1 - p) + end * p)<span class="hljs-comment">;</span>
}

async function main({ params }: Args): Promise&lt;Output&gt; {
  if (<span class="hljs-attr">params.position</span> == null) params.position = random(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>)<span class="hljs-comment">;</span>
  if (<span class="hljs-attr">params.shooting_hand</span> == null) params.shooting_hand = random(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>)<span class="hljs-comment">;</span>

  const <span class="hljs-attr">style</span> = params.style || <span class="hljs-string">'写实'</span><span class="hljs-comment">;</span>
  const uniform_number:<span class="hljs-attr">string</span> = (params.uniform_number || <span class="hljs-number">10</span>).toString()<span class="hljs-comment">;</span>
  const <span class="hljs-attr">uniform_color</span> = params.uniform_color || <span class="hljs-string">'红'</span><span class="hljs-comment">;</span>
  const <span class="hljs-attr">position</span> = params.position  == <span class="hljs-number">0</span> ? <span class="hljs-string">'守门员'</span>: (params.position == <span class="hljs-number">1</span> ? <span class="hljs-string">'前锋'</span>: <span class="hljs-string">'后卫'</span>)<span class="hljs-comment">;</span>
  const <span class="hljs-attr">shooting_hand</span> = params.shooting_hand == <span class="hljs-number">0</span> ? <span class="hljs-string">'左手'</span>: <span class="hljs-string">'右手'</span><span class="hljs-comment">;</span>
  

  // 构建输出对象
  const <span class="hljs-attr">ret</span> = {
      style,
      uniform_number,
      uniform_color,
      position,
      shooting_hand,
  }<span class="hljs-comment">;</span>

  return ret<span class="hljs-comment">;</span>
}
</code></pre>
<p>4.  输出字段：直接映射代码中的 <code>output</code> 字段</p>
<h5 data-id="heading-19">关键提示：</h5>
<ul>
<li>代码做了参数校验，避免用户输入非法值导致报错</li>
<li>数字转中文是为了让图像生成提示词更自然</li>
</ul>
<blockquote>
<p>（「代码」节点配置截图）</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/866e97d6227d44d7aae3882e71886d02~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5Lya5pWy5Luj56CBMQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336211&amp;x-signature=W53eiVFLtM75uaLkW7E0ULIwy8I%3D" alt="屏幕截图 2026-02-10 210307.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b2ff63fdc08d41bd9f30251fdae6b4fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5Lya5pWy5Luj56CBMQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336211&amp;x-signature=f3A%2BWmMILmAYKBUTjkAUdilTMUE%3D" alt="屏幕截图 2026-02-10 210324.png" loading="lazy"/></p>
<hr/>
<h4 data-id="heading-20">第五步：配置「图像生成」节点（核心生成）</h4>
<p>这是整个工作流的 “灵魂”，所有信息最终在这里融合成图片。</p>
<h5 data-id="heading-21">操作步骤：</h5>
<ol>
<li>
<p>拖拽「图像生成」节点到画布，重命名为「拟人化生成」</p>
</li>
<li>
<p>基础设置（直接照填）：</p>
<ul>
<li>
<p>模型：通用图像生成模型</p>
</li>
<li>
<p>比例：1:1 (1024×1024)（高清且适配社交平台）</p>
</li>
<li>
<p>生成质量：拉满（或根据需求调整）</p>
</li>
<li>
<p>参考图设置：</p>
<ul>
<li>模型：形象一致（关键！保留宠物特征）</li>
<li>参考图：连接「开始」节点的 <code>picture</code></li>
<li>参考程度：0.7（平衡特征保留和创意发挥）</li>
</ul>
</li>
</ul>
</li>
<li>
<p>正向提示词（直接复制，变量已做好映射）：</p>
</li>
</ol>
<p>text</p>
<pre><code class="hljs language-css" lang="css">高质量、高清、细节丰富的{{style}}风格图片，将宠物拟人化为儿童冰球运动员，核心要求：
<span class="hljs-number">1</span>. 运动员外貌特征高度还原宠物：{{description}}
<span class="hljs-number">2</span>. 核心独特特征强化：{{<span class="hljs-selector-tag">details</span><span class="hljs-selector-class">.unique_features</span>}}
<span class="hljs-number">3</span>. 神态匹配：{{<span class="hljs-selector-tag">details</span><span class="hljs-selector-class">.expression</span>}}
<span class="hljs-number">4</span>. 冰球服配色：{{<span class="hljs-selector-tag">details</span><span class="hljs-selector-class">.color_mapping</span>}}（主色{{uniform_color}}，号码{{uniform_number}}号）
<span class="hljs-number">5</span>. 运动细节：{{<span class="hljs-attribute">position</span>}}站位，{{shooting_hand}}持冰球杆，另一只手自然下垂
<span class="hljs-number">6</span>. 场景：专业冰球赛场，光线柔和，构图居中，氛围感拉满
<span class="hljs-number">7</span>. 风格要求：{{style}}，卡通风格要萌趣，写实风格要逼真，赛博朋克风格要炫酷

【细节强化】
- 冰球头盔贴合头部，号码清晰可见
- 守门员需添加专属护具+球门背景，前锋/后卫需添加冰球杆+冰球
- 整体画面无违和感，宠物特征与人类身体自然融合
</code></pre>
<p>4.  负向提示词（直接复制，避坑关键）：</p>
<p>text</p>
<pre><code class="hljs">低画质，模糊，失真，四足站立，非冰球赛场，双手各握一根球杆，未佩戴头盔，球衣号码模糊，颜色偏差，画面出现其他动物，人物面部扭曲，比例失调，无冰球元素，背景杂乱，文字水印
</code></pre>
<p>5.  输入连接（关键！别连错）：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">*</span>   <span class="hljs-code">`description`</span> → 「图片理解」的 <span class="hljs-code">`sk_output`</span>
<span class="hljs-bullet">*</span>   <span class="hljs-code">`details`</span> → 「特征提取」的 <span class="hljs-code">`output`</span>
<span class="hljs-bullet">*</span>   <span class="hljs-code">`style`</span>/<span class="hljs-code">`uniform_color`</span>/<span class="hljs-code">`uniform_number`</span>/<span class="hljs-code">`position`</span>/<span class="hljs-code">`shooting_hand`</span> → 「代码」节点的对应输出
</code></pre>
<h5 data-id="heading-22">关键提示：</h5>
<ul>
<li>参考程度 0.7 是黄金值，太高会失去拟人化效果，太低会丢失宠物特征</li>
<li>负向提示词一定要加，能大幅减少翻车概率</li>
</ul>
<blockquote>
<p>（「图像生成」节点配置截图）</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c670887bd27d451a822297571da3e7cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5Lya5pWy5Luj56CBMQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336211&amp;x-signature=GMDWnTHqTp5l8nUX1lgk8gP%2FQUE%3D" alt="屏幕截图 2026-02-10 210449.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a88eddb978a4344a35e86d97d6945de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5Lya5pWy5Luj56CBMQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336211&amp;x-signature=nS8BlvBZdYDhayn7lDHJKzBkySI%3D" alt="屏幕截图 2026-02-10 210503.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a283de5fb0d24b9faf787dbb4c354ea3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5Lya5pWy5Luj56CBMQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336211&amp;x-signature=UjjTryoc%2FRld6fR6XN972PuPS1s%3D" alt="屏幕截图 2026-02-10 210520.png" loading="lazy"/></p>
<hr/>
<h4 data-id="heading-23">第六步：创建「结束」节点（结果输出）</h4>
<p>工作流的 “出口”，把生成的图片返回给用户。</p>
<h5 data-id="heading-24">操作步骤：</h5>
<ol>
<li>拖拽「结束」节点到画布</li>
<li>输出配置：<code>output</code> 字段连接「图像生成」节点的 <code>data</code> 输出</li>
<li>点击「保存」，完成整个工作流搭建</li>
</ol>
<blockquote>
<p>（「结束」节点配置截图）</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48319a80ce184c3896b314ad04daeb9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5Lya5pWy5Luj56CBMQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336211&amp;x-signature=Ywgk%2B8HJd%2B3DvsOpZBO%2BNEi70wU%3D" alt="屏幕截图 2026-02-10 210528.png" loading="lazy"/></p>
<hr/>
<h4 data-id="heading-25">第七步：使用节点生成效果图</h4>
<p>大家点击试运行就可以生成大家想要的爱宠图片了，由于时间问题我只放上后面生成宠物图片的效果图了</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4fc0e62d6f404aa5828eb84e23bddaf4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5Lya5pWy5Luj56CBMQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336211&amp;x-signature=MA5UBIGrNeD%2Fed0nviNsQn8wT%2FA%3D" alt="屏幕录制 2026-02-10 214312.gif" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54becfc25c47486fa5ed43c91a543d71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5Lya5pWy5Luj56CBMQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336211&amp;x-signature=SaIgZM72uRTkTaLNqJPLAz23g2c%3D" alt="iceball_player.png" loading="lazy"/></p>
<h3 data-id="heading-26">🚀 测试与优化技巧</h3>
<h4 data-id="heading-27">1. 首次测试流程</h4>
<ol>
<li>点击画布右上角「运行」</li>
<li>上传宠物照片，填写参数（比如：风格 = 卡通，号码 = 7，颜色 = 蓝，位置 = 前锋）</li>
<li>等待 30 秒左右，查看生成结果</li>
</ol>
<h4 data-id="heading-28">2. 常见问题优化</h4>
<p>表格</p>

























<table><thead><tr><th>问题现象</th><th>优化方案</th></tr></thead><tbody><tr><td>宠物特征不明显</td><td>提高参考图程度到 0.8，或在特征提取提示词中强调 “强化面部特征”</td></tr><tr><td>球衣颜色 / 号码错误</td><td>检查代码节点参数映射，或在图像生成提示词中明确 “号码 {{uniform_number}} 必须清晰显示”</td></tr><tr><td>风格不符预期</td><td>细化风格描述（比如 “卡通→迪士尼卡通风格，线条简洁，色彩明亮”）</td></tr><tr><td>生成失败 / 报错</td><td>检查节点连接是否正确，模型权限是否开通，图片大小是否超限</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-29">🎨 扩展玩法（超实用）</h3>
<ol>
<li><strong>多风格批量生成</strong>：复制「图像生成」节点，修改风格参数，一次生成多种风格</li>
<li><strong>添加文案生成</strong>：新增「模型调用」节点，生成配文（比如 “我家柴柴变身冰球小将啦！”）</li>
<li><strong>适配不同场景</strong>：调整图像比例（4:3/16:9），适配壁纸 / 海报 / 朋友圈</li>
<li><strong>其他职业拟人</strong>：修改提示词，把冰球运动员换成宇航员 / 医生 / 宇航员等</li>
</ol>
<hr/>
<h3 data-id="heading-30">📌 核心配置清单（可直接复制）</h3>
<h4 data-id="heading-31">1. 图片理解系统提示词</h4>
<p>text</p>
<pre><code class="hljs language-markdown" lang="markdown">你是专业的宠物特征分析专家，请详细描述这张宠物图片的核心特征，包括但不限于：
<span class="hljs-bullet">1.</span> 宠物种类（猫/狗/其他）、毛色/花纹
<span class="hljs-bullet">2.</span> 面部特征（眼睛形状/颜色、鼻子/嘴巴特征、耳朵形状）
<span class="hljs-bullet">3.</span> 神态/表情（呆萌/活泼/高冷）
<span class="hljs-bullet">4.</span> 体型/姿态（胖瘦、站立/趴卧等）
描述越详细，后续拟人化效果越精准。
</code></pre>
<h4 data-id="heading-32">2. 特征提取系统提示词</h4>
<p>text</p>
<pre><code class="hljs language-markdown" lang="markdown">你是资深动物拟人化设计师，现在需要从以下宠物特征描述中，提取出最适合做拟人化的核心特征（仅保留独特、高辨识度的内容）：
要求：
<span class="hljs-bullet">1.</span> 输出JSON格式，字段包括：unique<span class="hljs-emphasis">_features（独特特征）、expression（神态）、color_</span>mapping（颜色映射建议）
<span class="hljs-bullet">2.</span> 颜色映射建议要适配冰球服配色（比如“橘白相间的毛色→队服主橘色+白色镶边”）
<span class="hljs-bullet">3.</span> 特征描述要简洁、可直接用于图像生成提示词
</code></pre>
<h4 data-id="heading-33">3. 代码节点完整代码</h4>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">random</span> = (start: number, end: number) =&gt; {
  const <span class="hljs-attr">p</span> = Math.random()<span class="hljs-comment">;</span>
  return Math.floor(start * (1 - p) + end * p)<span class="hljs-comment">;</span>
}

async function main({ params }: Args): Promise&lt;Output&gt; {
  if (<span class="hljs-attr">params.position</span> == null) params.position = random(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>)<span class="hljs-comment">;</span>
  if (<span class="hljs-attr">params.shooting_hand</span> == null) params.shooting_hand = random(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>)<span class="hljs-comment">;</span>

  const <span class="hljs-attr">style</span> = params.style || <span class="hljs-string">'写实'</span><span class="hljs-comment">;</span>
  const uniform_number:<span class="hljs-attr">string</span> = (params.uniform_number || <span class="hljs-number">10</span>).toString()<span class="hljs-comment">;</span>
  const <span class="hljs-attr">uniform_color</span> = params.uniform_color || <span class="hljs-string">'红'</span><span class="hljs-comment">;</span>
  const <span class="hljs-attr">position</span> = params.position  == <span class="hljs-number">0</span> ? <span class="hljs-string">'守门员'</span>: (params.position == <span class="hljs-number">1</span> ? <span class="hljs-string">'前锋'</span>: <span class="hljs-string">'后卫'</span>)<span class="hljs-comment">;</span>
  const <span class="hljs-attr">shooting_hand</span> = params.shooting_hand == <span class="hljs-number">0</span> ? <span class="hljs-string">'左手'</span>: <span class="hljs-string">'右手'</span><span class="hljs-comment">;</span>
  

  // 构建输出对象
  const <span class="hljs-attr">ret</span> = {
      style,
      uniform_number,
      uniform_color,
      position,
      shooting_hand,
  }<span class="hljs-comment">;</span>

  return ret<span class="hljs-comment">;</span>
}
</code></pre>
<h4 data-id="heading-34">4. 图像生成正向提示词</h4>
<p>text</p>
<pre><code class="hljs language-css" lang="css">高质量、高清、细节丰富的{{style}}风格图片，将宠物拟人化为儿童冰球运动员，核心要求：
<span class="hljs-number">1</span>. 运动员外貌特征高度还原宠物：{{description}}
<span class="hljs-number">2</span>. 核心独特特征强化：{{<span class="hljs-selector-tag">details</span><span class="hljs-selector-class">.unique_features</span>}}
<span class="hljs-number">3</span>. 神态匹配：{{<span class="hljs-selector-tag">details</span><span class="hljs-selector-class">.expression</span>}}
<span class="hljs-number">4</span>. 冰球服配色：{{<span class="hljs-selector-tag">details</span><span class="hljs-selector-class">.color_mapping</span>}}（主色{{uniform_color}}，号码{{uniform_number}}号）
<span class="hljs-number">5</span>. 运动细节：{{<span class="hljs-attribute">position</span>}}站位，{{shooting_hand}}持冰球杆，另一只手自然下垂
<span class="hljs-number">6</span>. 场景：专业冰球赛场，光线柔和，构图居中，氛围感拉满
<span class="hljs-number">7</span>. 风格要求：{{style}}，卡通风格要萌趣，写实风格要逼真，赛博朋克风格要炫酷

【细节强化】
- 冰球头盔贴合头部，号码清晰可见
- 守门员需添加专属护具+球门背景，前锋/后卫需添加冰球杆+冰球
- 整体画面无违和感，宠物特征与人类身体自然融合
</code></pre>
<h4 data-id="heading-35">5. 图像生成负向提示词</h4>
<p>text</p>
<pre><code class="hljs">低画质，模糊，失真，四足站立，非冰球赛场，双手各握一根球杆，未佩戴头盔，球衣号码模糊，颜色偏差，画面出现其他动物，人物面部扭曲，比例失调，无冰球元素，背景杂乱，文字水印
</code></pre>
<hr/>
<h3 data-id="heading-36">✨ 总结</h3>
<ol>
<li>整个工作流核心是「特征提取 + 参考图生成」，既保留宠物特征，又实现冰球运动员拟人化；</li>
<li>参数标准化和提示词优化是生成效果的关键，本文提供的配置可直接复用；</li>
<li>0 代码基础也能快速搭建，扩展玩法丰富，除了冰球运动员，还能适配各种职业拟人化。</li>
</ol>
<p>快去试试把你家毛孩子变成超酷的冰球小将吧！如果有搭建问题，评论区留言，我会一一解答～</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[超级 AI 大神强推的 92 个信息源，在 GitHub 上开源了。]]></title>    <link>https://juejin.cn/post/7605051886434320447</link>    <guid>https://juejin.cn/post/7605051886434320447</guid>    <pubDate>2026-02-11T01:54:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605051886434320447" data-draft-id="7605049329778917417" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="超级 AI 大神强推的 92 个信息源，在 GitHub 上开源了。"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2026-02-11T01:54:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="逛逛GitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1442202996186093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            超级 AI 大神强推的 92 个信息源，在 GitHub 上开源了。
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1442202996186093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    逛逛GitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T01:54:43.000Z" title="Wed Feb 11 2026 01:54:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Andrej Karpathy 是 AI 领域公认的大神。</p>
<p>他是 <strong>OpenAI 的创始成员，后面</strong>被马斯克挖走，领导了特斯拉自动驾驶团队。离开特斯拉后，他回到 OpenAI 参与了 <strong>GPT-4</strong> 的后续研发。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc01f21c712047769779bbbe4d5f2fbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771379686&amp;x-signature=7R5sk4uxWiGYfHlqLyzYavDhFl8%3D" alt="图片" loading="lazy"/></p>
<p>现在，他成立一家 AI 教育公司 <strong>Eureka Labs</strong>，经常在 X 和 YouTube 上活跃。</p>
<p>如果你想学 AI 尤其是技术原理，去搜 Andrej Karpathy 的 YouTube 频道，那是目前世界上最好的学习路径。</p>
<p>如果你经常看我的公众号文章，会看到之前推荐过的两个项目：</p>
<p><strong>01</strong>它的开源项目</p>
<p>① nanoGPT：极简主义的预训练标杆</p>
<p>nanoGPT 是 Karpathy 为了教学和研究而开发的最简约、最清晰的 GPT 训练库。</p>
<p>它被公认为理解大语言模型原理的入门神作。</p>
<p>它剥离掉工业级代码中繁杂的工程包装，只保留 Transformer 架构最核心的逻辑。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f7e47e74f7d46f7b30356ed2e4aa6a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771379686&amp;x-signature=C7qj7A2iIw3dcdDrVXZplRUe5IE%3D" alt="图片" loading="lazy"/></p>
<p>通过这个项目，开发者可以清晰地看到一个类似 GPT-2 的模型是如何从零开始，通过 PyTorch 编写并在自己的数据上进行预训练的。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b3737db461c4f55a2c1a571917dbf78~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771379686&amp;x-signature=TlMaBoRNAKp0xfZUSXffCQNNLo4%3D" alt="图片" loading="lazy"/></p>
<p>它的核心代码极其精炼，主要由两个约 300 行的文件组成：model.py 定义了复杂的 Transformer 数学结构，而 train.py 则实现了完整的训练循环。</p>
<p>尽管代码量极小，但它完整支持了现代深度学习的关键技术，如分布式训练、混合精度加速（Flash Attention）以及与 OpenAI 官方权重的兼容。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/karpathy/nanoGPT</span>
</code></pre>
<p>② nanochat：从会写字到能聊天的全链路指南</p>
<p>这个 4 万人 Star 的开源项目。</p>
<p>可以让你用 100 美元训练一个小型的 ChatGPT。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71f8bbdee4314b9f993c81b10599830f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771379686&amp;x-signature=IhUVsRud61dZPoOIt4rJjdwyLhI%3D" alt="图片" loading="lazy"/></p>
<p>如果说 nanoGPT 关注的是预训练，让模型学会预测下一个字，那么 nanochat 则是进阶版的全栈式大模型训练框架。</p>
<p>它不仅涵盖了预训练，还补齐了将原始模型转化为类似 ChatGPT 的对话模型所需的完整链路，包括：分词器训练、有监督微调和强化学习。</p>
<p>这个项目只用约 8000 行代码实现了一个端到端的系统，还自带了一个现 Web 聊天界面，让用户在训练结束后能立刻与自己的模型对话。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1591a5afca7456994318f5c122799f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771379686&amp;x-signature=QUJgjFZn4wtuQ5OLff14IQo4ktY%3D" alt="图片" loading="lazy"/></p>
<p><strong>02</strong>大神的信息源****</p>
<p>最近 Andrej Karpathy 在自己的 X 上发了一个帖子，它认为目前的社交媒体充斥着为了诱导点击和情绪而生成的 AI 垃圾内容。</p>
<p>为了获取高质量、长篇且具有深度思考的内容，他强烈建议回归 RSS 订阅。</p>
<p>它觉得 RSS 是对抗信息茧房和算法操控的最后堡垒。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0b5995073df49909052ed95587a514d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771379686&amp;x-signature=WtxWoHkaDz%2F1f9o93%2B5j1Y1IZ90%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-bash" lang="bash">地址：https://gist.github.com/emschwartz/e6d2bf860ccc367fe37ff953ba6de66b<span class="hljs-comment">#file-hn-popular-blogs-2025-opml</span>
</code></pre>
<p>他个人主要使用 RSS 阅读器，去订阅那些由人类亲自撰写、具有长效价值的长篇文章，而不是被算法优化的碎片化短文。比如上面这个订阅源，收集了 2025 年 Hacker News 中 92 个最受欢迎的博客，涵盖了深度技术探讨、编程艺术、数学以及科学研究。</p>
<p>Hacker News 是 YC 运营的新闻聚合网站。</p>
<p>它在科技界、程序员圈子和创业圈子中拥有极高的地位，被许多人视为获取高质量科技资讯和进行深度讨论的圣地。</p>
<p><strong>03</strong>如何像 Karpathy 一样获取信息？</p>
<p>① 下载 opml 文件首先需要打开上面的那个链接，把 opml 文件下载到本地。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/552e22ba9f864d45babb92cbfe72dafc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771379686&amp;x-signature=X%2FGwDdnpylcFGvSxU9%2FD%2BvE%2Fnh8%3D" alt="图片" loading="lazy"/></p>
<p>② 下载一个 RSS 订阅器你可以选择我之前推荐过的开源的 RSS 订阅工具：Folo</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbe703c163e1401d9fc257d6e555c476~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771379686&amp;x-signature=t8wJCTsxkB6NTvZGLR0mW5%2FE%2BOc%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/RSSNext/Folo</span>
</code></pre>
<p>除了 Folo 你也可以使用其他的 RSS 预览工具，比如 NetNewsWire 啥的。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74a823baedcf4f94956d26f67593e6d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771379686&amp;x-signature=IwH%2B1RiG5TUH4M7jBHPK%2FxyXZt8%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/Ranchero-Software/NetNewsWire</span>
</code></pre>
<p>③ 导入 opml 文件下载之后，只需要导入刚刚下载的 opml 文件就行了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f46b653b0f484adfb925ede1f5ac4c68~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771379686&amp;x-signature=nJTw9qdRaSpLJ4rkSYQYDsXAm94%3D" alt="图片" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe2432af6b1c4cee988e23fc5dc3937e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771379686&amp;x-signature=uMtRrH2epG2PFUtmvdllE5ZXapI%3D" alt="图片" loading="lazy"/></p>
<p>当你导入成功，你就能看到这个几个热门的博客列表了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b38983840abe4d98b4c95299b6a8db66~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771379686&amp;x-signature=NhEkTMq%2FobC7S0pTFyqtPppMv8Y%3D" alt="图片" loading="lazy"/></p>
<p><strong>04</strong>这个信息源有啥这份信息源有几个我也在关注，都在里面了。比如 Simon Willison，他是 Django 框架的联合创始人，现在专注于研究如何务实地使用 AI。</p>
<p>不同于炒作概念的人，他会手写代码测试各种新模型，分享详细的 Prompt 工程技巧、API 使用心得以及安全漏洞。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05e7a1fff5294cb996dd0852dae565bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771379686&amp;x-signature=Yzoju%2Ff60GyqCTqefIehf1Ig6IA%3D" alt="图片" loading="lazy"/></p>
<p>还有 Neal Agarwal，他不做枯燥的技术分享，而是做好玩的网页。</p>
<p>他的代表作《Stimulation Clicker》刺激点击器是对现代互联网多巴胺成瘾的讽刺游戏。</p>
<p>他的作品经常霸榜 Hacker News，代码不仅可以用来创造工具，也可以用来创造快乐和艺术。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f334b0cc71b4fd997aec48a238165e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771379686&amp;x-signature=4495LnyYM9EOzAd9OIbTviWYpfY%3D" alt="图片" loading="lazy"/></p>
<p>当然还有技术元老： 比如 <strong>Paul Graham</strong> ，YC 创始人，虽然不常更但每篇必火、<strong>John Gruber 经常做</strong>苹果生态评论。</p>
<p><strong>底层技术大佬：</strong>  比如 <strong>Julia Evans</strong> ，用漫画解释 Linux 内核/网络协议。做数学与科学的： 比如 <strong>Terence Tao</strong> ，陶哲轩的博客，数学界顶流。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【LeetCode Hot100 刷题日记 （91/100）】62. 不同路径 —— 动态规划、组合数学、数学 🧮]]></title>    <link>https://juejin.cn/post/7605042125298663458</link>    <guid>https://juejin.cn/post/7605042125298663458</guid>    <pubDate>2026-02-10T13:47:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605042125298663458" data-draft-id="7604863528944910351" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【LeetCode Hot100 刷题日记 （91/100）】62. 不同路径 —— 动态规划、组合数学、数学 🧮"/> <meta itemprop="keywords" content="算法,面试,程序员"/> <meta itemprop="datePublished" content="2026-02-10T13:47:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Jing_Rainbow"/> <meta itemprop="url" content="https://juejin.cn/user/1285809519198256"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【LeetCode Hot100 刷题日记 （91/100）】62. 不同路径 —— 动态规划、组合数学、数学 🧮
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1285809519198256/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Jing_Rainbow
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T13:47:00.000Z" title="Tue Feb 10 2026 13:47:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>📌 题目链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Funique-paths%2Fdescription%2F%3FenvType%3Dstudy-plan-v2%26envId%3Dtop-100-liked" target="_blank" title="https://leetcode.cn/problems/unique-paths/description/?envType=study-plan-v2&amp;envId=top-100-liked" ref="nofollow noopener noreferrer">62. 不同路径 - 力扣（LeetCode）</a></p>
<p>🔍 难度：中等 | 🏷️ 标签：动态规划、组合数学、数学</p>
<p>⏱️ 目标时间复杂度：O(mn)（DP） / O(min(m, n))（组合数）</p>
<p>💾 空间复杂度：O(mn) → O(min(m, n))（滚动数组优化） / O(1)（组合数）</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">🧠 题目分析</h2>
<p>题目描述了一个经典的网格路径问题：一个机器人从 <code>m x n</code> 网格的左上角出发，每次只能 <strong>向右</strong> 或 <strong>向下</strong> 移动一步，问有多少种不同的路径可以到达右下角。</p>
<p>这个问题看似简单，但背后蕴含了两种非常重要的算法思想：</p>
<ul>
<li><strong>动态规划（Dynamic Programming）</strong>：适用于具有最优子结构和重叠子问题的问题；</li>
<li><strong>组合数学（Combinatorics）</strong>：将路径问题转化为排列组合问题，实现更优时空复杂度。</li>
</ul>
<p>在面试中，这类问题常被用来考察候选人对 <strong>状态转移建模能力</strong> 和 <strong>数学思维转换能力</strong> 的掌握程度。</p>
<hr/>
<h2 data-id="heading-1">🧩 核心算法及代码讲解</h2>
<h3 data-id="heading-2">✅ 方法一：动态规划（DP）</h3>
<h4 data-id="heading-3">💡 核心思想</h4>
<p>设 <code>dp[i][j]</code> 表示从起点 <code>(0, 0)</code> 到达位置 <code>(i, j)</code> 的不同路径数。由于机器人只能向右或向下移动，因此：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo>=</mo><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo>+</mo><mi>d</mi><mi>p</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">dp[i][j] = dp[i-1][j] + dp[i][j-1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">1</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">1</span><span class="mclose">]</span></span></span></span></span></div>
<p>边界条件：</p>
<ul>
<li>第一行所有格子只能由左边到达 → <code>dp[0][j] = 1</code></li>
<li>第一列所有格子只能由上面到达 → <code>dp[i][0] = 1</code></li>
</ul>
<h4 data-id="heading-4">📝 代码详解（含行注释）</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">uniquePaths</span><span class="hljs-params">(<span class="hljs-type">int</span> m, <span class="hljs-type">int</span> n)</span> </span>{
        <span class="hljs-comment">// 创建二维 DP 表，初始化为 0</span>
        vector&lt;vector&lt;<span class="hljs-type">int</span>&gt;&gt; <span class="hljs-built_in">f</span>(m, <span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt;(n));
        
        <span class="hljs-comment">// 初始化第一列为 1：只能从上方来</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; m; ++i) {
            f[i][<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;
        }
        
        <span class="hljs-comment">// 初始化第一行为 1：只能从左方来</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; n; ++j) {
            f[<span class="hljs-number">0</span>][j] = <span class="hljs-number">1</span>;
        }
        
        <span class="hljs-comment">// 填充其余格子：当前路径数 = 上方 + 左方</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt; m; ++i) {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">1</span>; j &lt; n; ++j) {
                f[i][j] = f[i - <span class="hljs-number">1</span>][j] + f[i][j - <span class="hljs-number">1</span>];
            }
        }
        
        <span class="hljs-comment">// 返回右下角的路径总数</span>
        <span class="hljs-keyword">return</span> f[m - <span class="hljs-number">1</span>][n - <span class="hljs-number">1</span>];
    }
};
</code></pre>
<h4 data-id="heading-5">🔁 空间优化：滚动数组（面试加分项！）</h4>
<p>注意到 <code>dp[i][j]</code> 只依赖于上一行和当前行的左侧值，因此可以用一维数组滚动更新：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">f</span><span class="hljs-params">(n, <span class="hljs-number">1</span>)</span></span>; <span class="hljs-comment">// 初始化为 1，对应第一行</span>
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt; m; ++i) {
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">1</span>; j &lt; n; ++j) {
        f[j] += f[j - <span class="hljs-number">1</span>]; <span class="hljs-comment">// f[j] 原为上一行的值，f[j-1] 是当前行已更新的左值</span>
    }
}
<span class="hljs-keyword">return</span> f[n - <span class="hljs-number">1</span>];
</code></pre>
<blockquote>
<p>✅ <strong>面试提示</strong>：当被问到“能否优化空间？”时，务必提到滚动数组技巧，并说明其原理——<strong>状态只依赖前一行/前一列</strong>。</p>
</blockquote>
<hr/>
<h3 data-id="heading-6">✅ 方法二：组合数学（数学法）</h3>
<h4 data-id="heading-7">💡 核心思想</h4>
<p>从 <code>(0,0)</code> 到 <code>(m-1,n-1)</code>，总共需要走：</p>
<ul>
<li>向下：<code>m - 1</code> 步</li>
<li>向右：<code>n - 1</code> 步<br/>
共 <code>m + n - 2</code> 步。</li>
</ul>
<p>问题转化为：在这 <code>m+n-2</code> 步中，选择 <code>m-1</code> 步用于向下（其余自动为向右），即求组合数：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>C</mi><mrow><mi>m</mi><mo>+</mo><mi>n</mi><mo>−</mo><mn>2</mn></mrow><mrow><mi>m</mi><mo>−</mo><mn>1</mn></mrow></msubsup><mo>=</mo><mfrac><mrow><mo stretchy="false">(</mo><mi>m</mi><mo>+</mo><mi>n</mi><mo>−</mo><mn>2</mn><mo stretchy="false">)</mo><mo stretchy="false">!</mo></mrow><mrow><mo stretchy="false">(</mo><mi>m</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">!</mo><mo>⋅</mo><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">!</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">C_{m+n-2}^{m-1} = \frac{(m+n-2)!}{(m-1)! \cdot (n-1)!}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1789em;vertical-align:-0.3148em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-2.4436em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3148em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord">1</span><span class="mclose">)!</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord">1</span><span class="mclose">)!</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord">2</span><span class="mclose">)!</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></div>
<p>但直接计算阶乘会溢出，因此采用<strong>递推式避免大数</strong>：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>C</mi><mo>=</mo><munderover><mo>∏</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>m</mi><mo>−</mo><mn>1</mn></mrow></munderover><mfrac><mrow><mi>n</mi><mo>−</mo><mn>1</mn><mo>+</mo><mi>k</mi></mrow><mi>k</mi></mfrac></mrow><annotation encoding="application/x-tex">C = \prod_{k=1}^{m-1} \frac{n - 1 + k}{k}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:3.1032em;vertical-align:-1.3021em;"/><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8011em;"><span style="top:-1.8479em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"/><span><span class="mop op-symbol large-op">∏</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3021em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></div>
<p>等价于循环累乘并整除，保证中间结果始终为整数（因为组合数必为整数）。</p>
<h4 data-id="heading-8">📝 代码详解（含行注释）</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">uniquePaths</span><span class="hljs-params">(<span class="hljs-type">int</span> m, <span class="hljs-type">int</span> n)</span> </span>{
        <span class="hljs-type">long</span> <span class="hljs-type">long</span> ans = <span class="hljs-number">1</span>;
        <span class="hljs-comment">// 为了减少循环次数，确保 m &lt;= n（可选优化）</span>
        <span class="hljs-keyword">if</span> (m &gt; n) <span class="hljs-built_in">swap</span>(m, n);
        
        <span class="hljs-comment">// 计算 C(m+n-2, m-1) = ∏_{y=1}^{m-1} (n - 1 + y) / y</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> y = <span class="hljs-number">1</span>; y &lt; m; ++y) {
            ans = ans * (n - <span class="hljs-number">1</span> + y) / y; <span class="hljs-comment">// 先乘后除，避免浮点误差</span>
        }
        <span class="hljs-keyword">return</span> (<span class="hljs-type">int</span>)ans;
    }
};
</code></pre>
<blockquote>
<p>✅ <strong>关键细节</strong>：必须 <strong>先乘后除</strong>，且按顺序进行，才能保证每一步都是整数（数学性质：组合数是整数，且该递推过程保持整除性）。</p>
</blockquote>
<blockquote>
<p>❗ <strong>常见错误</strong>：若写成 <code>ans *= (n-1+y)/y</code>，由于整数除法截断，会导致错误！</p>
</blockquote>
<hr/>
<h2 data-id="heading-9">🧭 解题思路（分步拆解）</h2>
<ol>
<li><strong>理解移动规则</strong>：只能右或下 → 路径无回头，问题具有无后效性。</li>
<li><strong>识别子问题</strong>：到达 <code>(i,j)</code> 的路径数 = 到达 <code>(i-1,j)</code> + <code>(i,j-1)</code>。</li>
<li><strong>确定边界</strong>：第一行/列只有 1 条路径。</li>
<li><strong>选择方法</strong>：
<ul>
<li>若需展示 DP 思维 → 用二维 DP；</li>
<li>若要最优性能 → 用组合数学；</li>
<li>若面试官追问空间优化 → 提出滚动数组。</li>
</ul>
</li>
<li><strong>验证小例子</strong>：如 <code>m=3, n=2</code> → 手动枚举 3 条路径，验证逻辑正确。</li>
</ol>
<hr/>
<h2 data-id="heading-10">📊 算法分析</h2>





























<table><thead><tr><th>方法</th><th>时间复杂度</th><th>空间复杂度</th><th>适用场景</th></tr></thead><tbody><tr><td>二维 DP</td><td>O(mn)</td><td>O(mn)</td><td>教学、清晰表达状态转移</td></tr><tr><td>滚动数组 DP</td><td>O(mn)</td><td>O(min(m,n))</td><td>面试中展示空间优化能力</td></tr><tr><td>组合数学</td><td>O(min(m,n))</td><td>O(1)</td><td>追求极致效率，数学功底强</td></tr></tbody></table>
<blockquote>
<p>💡 <strong>面试建议</strong>：</p>
<ul>
<li>先写 DP 解法（稳妥、易理解）；</li>
<li>再提出组合数学优化（展现深度）；</li>
<li>最后讨论空间优化（体现工程思维）。</li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-11">💻 代码</h2>
<h3 data-id="heading-12">C++ 完整代码</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;
<span class="hljs-keyword">using</span> ll = <span class="hljs-type">long</span> <span class="hljs-type">long</span>;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">uniquePaths</span><span class="hljs-params">(<span class="hljs-type">int</span> m, <span class="hljs-type">int</span> n)</span> </span>{
        vector&lt;vector&lt;<span class="hljs-type">int</span>&gt;&gt; <span class="hljs-built_in">f</span>(m, <span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt;(n));
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; m; ++i) {
            f[i][<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;
        }
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; n; ++j) {
            f[<span class="hljs-number">0</span>][j] = <span class="hljs-number">1</span>;
        }
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt; m; ++i) {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">1</span>; j &lt; n; ++j) {
                f[i][j] = f[i - <span class="hljs-number">1</span>][j] + f[i][j - <span class="hljs-number">1</span>];
            }
        }
        <span class="hljs-keyword">return</span> f[m - <span class="hljs-number">1</span>][n - <span class="hljs-number">1</span>];
    }
};

<span class="hljs-comment">// 测试</span>
<span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
    ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-literal">false</span>);
    cin.<span class="hljs-built_in">tie</span>(<span class="hljs-literal">nullptr</span>);
    cout.<span class="hljs-built_in">tie</span>(<span class="hljs-literal">nullptr</span>);
    
    Solution sol;
    cout &lt;&lt; sol.<span class="hljs-built_in">uniquePaths</span>(<span class="hljs-number">3</span>, <span class="hljs-number">7</span>) &lt;&lt; <span class="hljs-string">"\n"</span>; <span class="hljs-comment">// 输出: 28</span>
    cout &lt;&lt; sol.<span class="hljs-built_in">uniquePaths</span>(<span class="hljs-number">3</span>, <span class="hljs-number">2</span>) &lt;&lt; <span class="hljs-string">"\n"</span>; <span class="hljs-comment">// 输出: 3</span>
    cout &lt;&lt; sol.<span class="hljs-built_in">uniquePaths</span>(<span class="hljs-number">7</span>, <span class="hljs-number">3</span>) &lt;&lt; <span class="hljs-string">"\n"</span>; <span class="hljs-comment">// 输出: 28</span>
    cout &lt;&lt; sol.<span class="hljs-built_in">uniquePaths</span>(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>) &lt;&lt; <span class="hljs-string">"\n"</span>; <span class="hljs-comment">// 输出: 6</span>
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-13">JavaScript 完整代码</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} <span class="hljs-variable">m</span>
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} <span class="hljs-variable">n</span>
 * <span class="hljs-doctag">@return</span> {<span class="hljs-type">number</span>}
 */</span>
<span class="hljs-keyword">var</span> uniquePaths = <span class="hljs-keyword">function</span>(<span class="hljs-params">m, n</span>) {
    <span class="hljs-comment">// 使用组合数学方法（更高效）</span>
    <span class="hljs-keyword">let</span> ans = <span class="hljs-number">1</span>;
    <span class="hljs-comment">// 确保循环次数最少</span>
    <span class="hljs-keyword">if</span> (m &gt; n) [m, n] = [n, m];
    
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> y = <span class="hljs-number">1</span>; y &lt; m; y++) {
        ans = ans * (n - <span class="hljs-number">1</span> + y) / y;
    }
    <span class="hljs-keyword">return</span> ans;
};

<span class="hljs-comment">// 测试用例</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">uniquePaths</span>(<span class="hljs-number">3</span>, <span class="hljs-number">7</span>)); <span class="hljs-comment">// 28</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">uniquePaths</span>(<span class="hljs-number">3</span>, <span class="hljs-number">2</span>)); <span class="hljs-comment">// 3</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">uniquePaths</span>(<span class="hljs-number">7</span>, <span class="hljs-number">3</span>)); <span class="hljs-comment">// 28</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">uniquePaths</span>(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>)); <span class="hljs-comment">// 6</span>
</code></pre>
<blockquote>
<p>💡 JS 注意：虽然 JS 有 Number 精度限制，但题目保证答案 ≤ 2×10⁹，在安全整数范围内（&lt; 2⁵³），因此无需 BigInt。</p>
</blockquote>
<hr/>
<h2 data-id="heading-14">🌟 本期完结，下期见！🔥</h2>
<p>👉 点赞收藏加关注，新文更新不迷路。关注专栏【算法】LeetCode Hot100刷题日记，持续为你拆解每一道热题的底层逻辑与面试技巧！</p>
<p>💬 <strong>欢迎留言交流你的解法或疑问！一起进步，冲向 Offer！💪</strong></p>
<p>📌 <strong>记住</strong>：当你在刷题时，不要只看答案，要像写这篇文章一样，深入思考每一步背后的原理、优化空间和面试价值。这才是真正提升算法能力的方式！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Ubuntu24.04 OpenVPN 部署完整指南]]></title>    <link>https://juejin.cn/post/7605041556655915017</link>    <guid>https://juejin.cn/post/7605041556655915017</guid>    <pubDate>2026-02-10T12:19:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605041556655915017" data-draft-id="7605042125298417698" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Ubuntu24.04 OpenVPN 部署完整指南"/> <meta itemprop="keywords" content="远程工作"/> <meta itemprop="datePublished" content="2026-02-10T12:19:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="不做菜鸟的网工"/> <meta itemprop="url" content="https://juejin.cn/user/3283597248432442"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Ubuntu24.04 OpenVPN 部署完整指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3283597248432442/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    不做菜鸟的网工
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T12:19:02.000Z" title="Tue Feb 10 2026 12:19:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body ::selection{color:#fff;background-color:#ed7373}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:.6em;margin-top:1.5em;padding-bottom:4px;color:#ed7373}.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px}.markdown-body h4{font-size:16px}.markdown-body h5,.markdown-body h6{font-size:14px}.markdown-body p{line-height:inherit;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border-top:1px solid #dfe1e6;margin:33px 0}.markdown-body code{word-break:break-word;overflow-x:auto;background-color:rgba(239,198,221,.2666666667);color:#7b164f;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==") 10px 10px no-repeat;background-size:40px;background-color:#fdf8f8}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#fdf8f8}.markdown-body a{position:relative;text-decoration:underline;text-decoration-color:#ffd4d4;color:#ed7373;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAAAXNSR0IArs4c6QAAD1lJREFUeF7tnV122zgShQHJG5gT9/OkV2J7JR3voI/U707eI5/eQeyVRFlJa56nc2YDFjkHEulWHP3g5xZYAK5eku6QYOFWfSwUAJLW8EcFqMBJBSy1oQJU4LQCBITRQQXOKEBAGB5UgIAwBqhAnALMIHG68axGFCAgjTia3YxTgIDE6cazGlGAgDTiaHYzTgECEqcbz2pEAQLSiKPZzTgFCEicbjyrEQUISCOOZjfjFCAgcbrxrEYUICCNOJrdjFOAgMTpxrMaUYCANOJodjNOAQISpxvPakQBAtKIo9nNOAUISJxuPKsRBQhII45GdfN/v//+/l9//rlBtae9HQKi3UOZ7ft7sfhgjfm3sfa9u3RvzHtrjPv77r8PfpvemB0o1v3Z95tuNvt29fKyqQkgApI5ADVebgeFtTfGmA8I+3pj1rbv17Ouey4dFgKCiIgC2/i+WDwYax0QbzMDtDcjLC67/PL58xraeIbGCEgGkTVd4vty+QWVKUL75WCZb7f3JWUVAhLq5UKPHzLGRyXmP822208lgEJAlESMlBlDfeGyhsafelAIiMawAdjkpmO38/kXa8wtoDnRJvq+v79+fHwSvUhk4wQkUjjNp/33jz9uZ33/VbONP9nW9x/fPT5+0mYzAdHmkUR7lNUaob1RN+QiIKEuVHz838vl1xKGVOck1DbTRUAUB7yvaSXVG5592sy22zsNs1wExNNjWg+rEI5XqWfb7a9TQ0JAtEa+h101wzF0f/JMQkA8AlHjIQ3AMco+KSQERGP0X7CpITj2Skw4BUxACgOkOThG/0wECQEpCJBm4Rh81Fl7l3tHMAEpBJCJ4Hjq+/7bvOt229THGSVny8vV1W6b/Kzrbnprb088VAVXN/fMFgGBuxDfYE443L4oB0TM9OqwxcVtjJR7xiTzUIuA4OMZ2mI2OICBN+wgfpACJWcWISDQcMY2lgMOt7XjerW6w1q+b03sqUUgzJf6TUAuKTTRv+eAI8f0qdSwK1cWISATAXDusjngyDkj5PrTzedu+z2uNsmURQiIMkBqg2OUVwKSHFmEgCgCpFY4xCDJkEUIiBJAaodjlBlZuEtOMIz2EhAFgLQCxxtIIG9YkR5mEZCJAWkNjldIlsu/EEW79AsfCMiEgLQKx8EaCSKLPL1bre6l3EhApJS90G7LcKCziOQwi4BMAAjh+GGlPTmLSK7pEJDMgBCOfwRHvb9Lsg4hIBkBIRw/i/0dUawLrocQkEyAEI7jQoPeNi9WqBOQDIAQjtMig16uTUAyxLHIJQjHeVkRdYjkijoziAgW+0YJx2VxEYAYYzbvVqtfL18t/AgCEq6Z1xmEw0um3U2km8/dqnrS791qJRLLIo0m9bSCkwmHvxNBgDCD+Es+7ZGEI0x/DrHC9Cr6aMIR7j7ELBaL9HDds59BOOIkB33wh9O8cfLnOYtwxOsM+egPV9LjHSB9JuFIU/j7ctmntSD7cmvOYiV6B3IHPGOD5E7VxK4nnw4q0A03Kya7QqYBwpGmK6j+MFJrIK53zCCRPgZtsjt59Zozh+s0aP3DNSW2BkJAIuFATE2eu3TtcLi+w24wggU6AYkABDVuPnXpFuAAZg8jrReHWAGQIB177LLSzg7oqtih4Dcsig6vmEECw0CyKG8BDic3VEPh4RUBCQAENePSaubY1R2LxYOxNvklDa8aEpCACBY+FLKgdcTGZjLHYvHBWuu+PoX6iQ+vmEE8XQW/8w3XJRyeDjhymOTi4OHlWKRf8JFUYU444uGQXvsgIAG+kcgesXAM6y83/fAhGtv36242+5b708i+8kmtF+XKHhxiTZA9YuDwCLSn2Xb7KebLtL7BHnqch82hTY7HZ6k9xotxiHXGTejsEQXHcvnVGnPrEU2b2XZ7pwESQTjEFwbf6kxAzgGCeOvf2H7ElGQMoDmHH8ekk4RD8snBU2FAQE4oAy7Og594S7p+BIweGeriIZJw5CzMWaRfdDV0UStqzByTPX7oVt9/nHXdc64hV41wsEjPMLyKqTucWZAtGZkyiTAc2esOZpBMs1cpY2bIW89dP4UhkYZj6pqKNcgRWFBb2lO+fAQDxBiTYse5e4k0HMaY4NrNY/QcdAgBOSJX8vjf3biNWV+vVndB3jg4GPZA0b5N+BSwNByp+sXqzmleD+UQgMTWHqN5AgEIg0TAtrdemTxzjAYxgxzLIMul23X6wYOlU4dEzVy9bQw5zNq1DahHpOGYuuZgBvGI+uQZJEAgOjOHWsjB+t7DbK9DUgIQkVnPGZmadb0ECDyIGeR4Bkl6mRnS0WhIYsf2LcLhQoOACACCfk8T+Dnu4BetJa3qe9yxkTcUj8sFHUJAjgPiPugSO6yB1B9vzUJCEppFBLPHprP2Xut2fWaQE/eSxOJYBJDR1ETbXnscUosk12THdVYPBwE5AUhiQIgCAswk3tO+As/ji2oUNIa6cDCHWOBp3tDhS4wzUZD4ZhEkIDn0idH01DkEBAyIaw5dpB9zHqgu8FqQgw3rEncXIAPft60qAXF32JRt3qnBJ7X36a1TUwPX926O2Pbiey3fwM11XBWADGsFv5n9o6m72SfnkJ2Iff98/fj4FCJo6mpxrmnLVJCdJj4wp+pRKhxVFOmeBXXwSw2S7s6glXQfqJPs3N0/+nufG0jCdbyGcT59neKYYjNIxKfPvGdtnCM8wTvpM587M8LhgOGPVwDHTAz4wofQQaqNIgGJgGOvX8CdPXVYEXKtFOcm2+k5zHI2hmx7yTXMTNHO59ziAEne9uAJCeChqaCM5eOsY8cA7PSqQw6vPWSt13rvjV1PnbXPmlfHQ7QuChBEMIQUjAnj7uCMFeI09GxW7N1+54+uuxkmRf4z77p1yuxhigZS5xYDCAKOUUTfdQrELFGOoVZqvRQLiFRQamq3CECQcPhObY5OSs4iATNFsYGRamMNxXSsdpfOUw8IGg4nSMgdE5JFhCEhIJfCPP7fVQOCmKE5Ik3wRrnUABxtkLpTJ9vnOXERH2blnqkWECE4ot42gsoiodnLN6wAmwm91kJ87anpOJWAABa/Tvso8m6ZfJf+xyLo9G/ytPduCqr/+O7x8VNNgY3qizpAROEwJnh4NQodskh20TnAgITUaEB7Lva9sANUAZI6XXlB++Q7N3KohdqKgrApZNKisPhONlcNIMJwBM1cnVMVEZDIWgShGwrW5GhU2IAKQBBOPqct+g4JqUcAwxpI/ZHpAS+Fse9l0qSARG869Ora/iA0HK7NmJ2tP5kMAASUzaLrsgA3FHvopICUljkOvZwKCQJcRCYL2ZtWbJQnGD4ZICXDMeo93MHdO3yD36Hlux/slG8hs1ec4r2IziSAgIYGJzuHuDtfVG44IGr6FzG8An1gNKdWvppqOi47ILA73wkVp3B4ICTJY37gDSbZFk3BLGFLVkBQsy6nhJgCjtEWn5oEMd6HagjIZBJBqanNbIBAHXtEwSnhODRn2EP2MPy/sTaBPWWHrN20aKYJiLe2ZANEcguJVkenvp/rrbOQcEz13XHNMByzLQsgktlDKxzoQADWHXvTOLzyclEWQMB3vteOtQKHxNZ/bi/x4kP+AzpS2YNw+Dn46FHMHt7iiWcQiexBOLz9e+xATu0GyCcKiMSaB+EI8O6xQ5k9ggQUBQSxV+iwN4QjyLfMHslyCX7EE157NHLnkyjIxziRemkEIA7VNiGWQcDTkk28VEAUjgI/XqOBGjFAgMV5E0WlJBxcFIxHTQQQ5PCqhbpDGo7ZdntX2ztz40M+7EwRQICzV9VnD2E4RJ6oDAuxso8WAQRVf9S+2isNB4vydDhlAFku+3TT4t9hBbi2eBPScBhjmpjYkHaUXkAqntaVhgPx3Il04JXSPhwQVIFe6/CKcJSCxt5OrYBUWZwTjrLgEAEEMYNV4xCBcJQHhwggoECoqsAEaXIywmq8oWjBCT7EgkzxVlSgEw4toR5nBwGJ083rLMLhJZPqg/CALJdfjDHubYPxvwoyCOGId7+mM+GAgAKj6BoEpAFrDgWkqASk5KKTcCiIaqAJcEBanuYlHMDIVNIUHJBWV9IJh5KIBpsBB8TZB/gssSlpJyrhAEelouakAPkr5psZb3QpolAnHIqiWcAUEUBQj9tq37BIOAQiUlmTMoAsFh+stW49JO2neD2EcKS5tpSzRQBBzGSNAmrMIoSjlPBOt1MEkKFQR9Qh6t5CTjjSg66kFiQBSd9yMiqpZKhFOEoKbYytYoAgh1muq1MPtQgHJuBKa0UMEOgwa6/qZqr3OxGO0sIaZ68sIIvFg7H2I87c/JBAnm85I0DJ+86AflXblCggAlkkayZBreec8j7hUMvFq2HygOCzyM54ya0obj/Zdj7/Yo25lXIh4ZBSFtuuOCBCWWQPiTHr+XZ7j3zvrHS9Mdp9vVrdYV3J1iQUyAOIUBY5EORptt1+SgFlAMN933z8trmE3juoCYeItCKNZgFEMoscquKCz/b9etZ1zz6wDFDcmP1QShQMZg6R+BVvNBsgw7qIWzwUD8RBtU1vzMb93Q5/DkH63u5tyGXH63CQmUM8nuEXyAbILovID7XgAiEa5LAKoeI0bWQFpEVICMc0gY26anZActUjKIFS2iEcKerpOHcSQIbn1r/mrgNySk44cqotd61JAHHdqRkSwiEXsLlbngwQ19EJZrbE9SUc4hJnvcCkgFQHiZLnVrJGUOUXmxyQUV/pjYHSfmzhc9XSGmpsXw0gBU8Bbzpr73/5/Hmt0cG0KU0BVYAcQOLeDp91pTtGRtYbMaqVdY46QMa6xPb9g+R282Q3sd5IlrCEBlQCMgqndJariDc+lhB8JdioGpDXAn7/IjrxregXHJa8pb6EgKCNPypQBCATg0IwGqamKEB+GHp13U1v7a3Q1vWnvu+/XT8+PjUcG+z6/lGJ8n+uVhmK+nHmK2QGzD0zsnZAzLtu7fOgVfmKsQe+ClQByLHOur1eL1dXO1Bs170C089mm6uXl92DVITBN0zaPa5aQNp1KXuOVICAINVkW9UpQECqcyk7hFSAgCDVZFvVKUBAqnMpO4RUgIAg1WRb1SlAQKpzKTuEVICAINVkW9UpQECqcyk7hFSAgCDVZFvVKUBAqnMpO4RUgIAg1WRb1SlAQKpzKTuEVICAINVkW9UpQECqcyk7hFSAgCDVZFvVKUBAqnMpO4RUgIAg1WRb1SlAQKpzKTuEVICAINVkW9UpQECqcyk7hFTg//8JNVC78ovQAAAAAElFTkSuQmCC");background-size:100%}.markdown-body a:active,.markdown-body a:hover{opacity:.66}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #ed7373;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#ed7373}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#fdf2f2}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #ed7373;background-color:#fdf2f2}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#ed7373}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]{appearance:none;-webkit-appearance:none;-moz-appearance:none;outline:none;width:16px;height:16px;border-radius:2px;background-color:transparent;box-shadow:inset 0 0 0 1px rgba(28,31,35,.3490196078);vertical-align:middle;margin:0;transform:translateY(-2px)}.markdown-body input[type=checkbox]:checked{background-color:#ed7373;background-image:url("data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjFlbSIgaGVpZ2h0PSIxZW0iIGFyaWEtaGlkZGVuPSJ0cnVlIj48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTE3LjQxMSA3LjMwOGExLjUgMS41IDAgMDEuMjggMi4xMDNsLTYuNSA4LjVhMS41IDEuNSAwIDAxLTIuMzc1LjAxbC0zLjUtNC41YTEuNSAxLjUgMCAxMTIuMzY4LTEuODQybDIuMzA2IDIuOTY1IDUuMzE4LTYuOTU1YTEuNSAxLjUgMCAwMTIuMTAzLS4yOHoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=");box-shadow:inset 0 0 0 1px #ed7373}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">OpenVPN 部署完整指南</h2>
<p>OpenVPN部署环境为 <code>Ubuntu24.04</code>  服务端需具备公网IP地址。</p>
<pre><code class="hljs language-ini" lang="ini">root@ubtuntu:~<span class="hljs-comment"># cat /etc/os-release </span>
<span class="hljs-attr">PRETTY_NAME</span>=<span class="hljs-string">"Ubuntu 24.04.2 LTS"</span>
<span class="hljs-attr">NAME</span>=<span class="hljs-string">"Ubuntu"</span>
<span class="hljs-attr">VERSION_ID</span>=<span class="hljs-string">"24.04"</span>
<span class="hljs-attr">VERSION</span>=<span class="hljs-string">"24.04.2 LTS (Noble Numbat)"</span>
</code></pre>
<h3 data-id="heading-1">一、环境准备和软件安装</h3>
<h4 data-id="heading-2">1. 更新系统包列表</h4>
<pre><code class="hljs language-bash" lang="bash">sudo apt update
</code></pre>
<h4 data-id="heading-3">2. 安装 OpenVPN 和 Easy-RSA</h4>
<pre><code class="hljs language-bash" lang="bash">sudo apt install -y openvpn easy-rsa
</code></pre>
<p><strong>输出示例：</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin">Reading <span class="hljs-keyword">package</span> lists... Done
Building dependency tree... Done
Reading state information... Done
The following additional packages will be installed:
  libccid libeac3 libpcsclite1 libpkcs11-helper1t64 opensc opensc-pkcs11 pcscd
Suggested packages:
  pcmciautils openvpn-dco-dkms openvpn-systemd-resolved
The following NEW packages will be installed:
  easy-rsa libccid libeac3 libpcsclite1 libpkcs11-helper1t64 opensc opensc-pkcs11 openvpn pcscd
<span class="hljs-number">0</span> upgraded, <span class="hljs-number">9</span> newly installed, <span class="hljs-number">0</span> to remove and <span class="hljs-number">103</span> not upgraded.
Need to <span class="hljs-keyword">get</span> <span class="hljs-number">2</span>,<span class="hljs-number">325</span> kB of archives.
After <span class="hljs-keyword">this</span> operation, <span class="hljs-number">7</span>,068 kB of additional disk space will be used.
...
</code></pre>
<hr/>
<h3 data-id="heading-4">二、证书颁发机构 (CA) 设置</h3>
<h4 data-id="heading-5">1. 创建 Easy-RSA 工作目录</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> -p ~/easy-rsa
<span class="hljs-built_in">ln</span> -s /usr/share/easy-rsa/* ~/easy-rsa/
<span class="hljs-built_in">cd</span> ~/easy-rsa
<span class="hljs-built_in">chmod</span> 700 ~/easy-rsa
<span class="hljs-built_in">ls</span>
</code></pre>
<p><strong>输出示例：</strong></p>
<pre><code class="hljs language-python" lang="python">easyrsa  openssl-easyrsa.cnf  <span class="hljs-built_in">vars</span>.example  x509-types
</code></pre>
<h4 data-id="heading-6">2. 初始化 PKI（公钥基础设施）</h4>
<pre><code class="hljs language-bash" lang="bash">./easyrsa init-pki
</code></pre>
<p><strong>输出示例：</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">
<span class="hljs-section">Notice
------</span>
'init-pki' complete; you may now create a CA or requests.

Your newly created PKI dir is:
<span class="hljs-bullet">*</span> /root/easy-rsa/pki

Using Easy-RSA configuration:
<span class="hljs-bullet">*</span> undefined
</code></pre>
<h4 data-id="heading-7">3. 创建根证书颁发机构 (CA)</h4>
<pre><code class="hljs language-bash" lang="bash">./easyrsa build-ca
</code></pre>
<p><strong>输出示例：</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">No</span> Easy<span class="hljs-operator">-</span>RSA <span class="hljs-string">'vars'</span> configuration file <span class="hljs-keyword">exists</span><span class="hljs-operator">!</span>

<span class="hljs-keyword">Using</span> SSL:
<span class="hljs-operator">*</span> openssl OpenSSL <span class="hljs-number">3.0</span><span class="hljs-number">.13</span> <span class="hljs-number">30</span> Jan <span class="hljs-number">2024</span> (Library: OpenSSL <span class="hljs-number">3.0</span><span class="hljs-number">.13</span> <span class="hljs-number">30</span> Jan <span class="hljs-number">2024</span>)

Enter <span class="hljs-keyword">New</span> CA Key Passphrase: 
[输入密码，如不设密码按回车]
Confirm <span class="hljs-keyword">New</span> CA Key Passphrase: 
[重复密码]

..<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>....<span class="hljs-operator">+</span>........<span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">*</span>.<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">*</span>...<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span>............<span class="hljs-operator">+</span>.........<span class="hljs-operator">+</span>....<span class="hljs-operator">+</span>.........<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>.........<span class="hljs-operator">+</span>........<span class="hljs-operator">+</span>..........<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span>............<span class="hljs-operator">+</span>.........<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>........<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>....<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>.........<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span>
....<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>....<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span>....<span class="hljs-operator">+</span>.........<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>...............<span class="hljs-operator">+</span>.........<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>..................<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>.........<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>.......<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>....<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>..........<span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">*</span>..<span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">*</span>..<span class="hljs-operator">+</span>..............................<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>................<span class="hljs-operator">+</span>.........<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>........<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>..................<span class="hljs-operator">+</span>.......<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>.........<span class="hljs-operator">+</span>................<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>............<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span>....<span class="hljs-operator">+</span>..................<span class="hljs-operator">+</span>........<span class="hljs-operator">+</span>.......<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span>.......<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>.......<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span>..........<span class="hljs-operator">+</span>............<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>.........<span class="hljs-operator">+</span>.........<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span>
<span class="hljs-comment">-----</span>
You <span class="hljs-keyword">are</span> about <span class="hljs-keyword">to</span> be asked <span class="hljs-keyword">to</span> enter information that will be incorporated
<span class="hljs-keyword">into</span> your certificate request.
What you <span class="hljs-keyword">are</span> about <span class="hljs-keyword">to</span> enter <span class="hljs-keyword">is</span> what <span class="hljs-keyword">is</span> <span class="hljs-keyword">called</span> a Distinguished Name <span class="hljs-keyword">or</span> a DN.
There <span class="hljs-keyword">are</span> quite a few fields but you can leave <span class="hljs-keyword">some</span> blank
<span class="hljs-keyword">For</span> <span class="hljs-keyword">some</span> fields there will be a <span class="hljs-keyword">default</span> <span class="hljs-keyword">value</span>,
If you enter <span class="hljs-string">'.'</span>, the field will be <span class="hljs-keyword">left</span> blank.
<span class="hljs-comment">-----</span>
Common Name (eg: your <span class="hljs-keyword">user</span>, host, <span class="hljs-keyword">or</span> server name) [Easy<span class="hljs-operator">-</span>RSA CA]:OPENVPNCA
[输入 CA 名称，如 OPENVPNCA]

Notice
<span class="hljs-comment">------</span>
CA creation complete. Your <span class="hljs-keyword">new</span> CA certificate <span class="hljs-keyword">is</span> <span class="hljs-keyword">at</span>:
<span class="hljs-operator">*</span> <span class="hljs-operator">/</span>root<span class="hljs-operator">/</span>easy<span class="hljs-operator">-</span>rsa<span class="hljs-operator">/</span>pki<span class="hljs-operator">/</span>ca.crt
</code></pre>
<hr/>
<h3 data-id="heading-8">三、服务器证书和密钥生成</h3>
<h4 data-id="heading-9">1. 生成服务器证书请求</h4>
<pre><code class="hljs language-bash" lang="bash">./easyrsa gen-req server nopass
</code></pre>
<p><strong>输出示例：</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">No</span> Easy<span class="hljs-operator">-</span>RSA <span class="hljs-string">'vars'</span> configuration file <span class="hljs-keyword">exists</span><span class="hljs-operator">!</span>

<span class="hljs-keyword">Using</span> SSL:
<span class="hljs-operator">*</span> openssl OpenSSL <span class="hljs-number">3.0</span><span class="hljs-number">.13</span> <span class="hljs-number">30</span> Jan <span class="hljs-number">2024</span> (Library: OpenSSL <span class="hljs-number">3.0</span><span class="hljs-number">.13</span> <span class="hljs-number">30</span> Jan <span class="hljs-number">2024</span>)
.......<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">*</span>..........<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>..............<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">*</span>............<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>.........<span class="hljs-operator">+</span>.................<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>.........<span class="hljs-operator">+</span>.............<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>..........<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>..................<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>............<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>.........<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>..............<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>.............<span class="hljs-operator">+</span>........<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span>
...<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>...............<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>.......<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>....<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">*</span>.......<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>.........<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">*</span>....<span class="hljs-operator">+</span>..........<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>...........<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>....................<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>.......<span class="hljs-operator">+</span>............<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>...............<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span>.......<span class="hljs-operator">+</span>............<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>.........<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>.........<span class="hljs-operator">+</span>..............................<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>.........<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>..........<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>....<span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span>
<span class="hljs-comment">-----</span>
You <span class="hljs-keyword">are</span> about <span class="hljs-keyword">to</span> be asked <span class="hljs-keyword">to</span> enter information that will be incorporated
<span class="hljs-keyword">into</span> your certificate request.
What you <span class="hljs-keyword">are</span> about <span class="hljs-keyword">to</span> enter <span class="hljs-keyword">is</span> what <span class="hljs-keyword">is</span> <span class="hljs-keyword">called</span> a Distinguished Name <span class="hljs-keyword">or</span> a DN.
There <span class="hljs-keyword">are</span> quite a few fields but you can leave <span class="hljs-keyword">some</span> blank
<span class="hljs-keyword">For</span> <span class="hljs-keyword">some</span> fields there will be a <span class="hljs-keyword">default</span> <span class="hljs-keyword">value</span>,
If you enter <span class="hljs-string">'.'</span>, the field will be <span class="hljs-keyword">left</span> blank.
<span class="hljs-comment">-----</span>
Common Name (eg: your <span class="hljs-keyword">user</span>, host, <span class="hljs-keyword">or</span> server name) [server]:OPENVPNSERVER
[输入服务器名称，如 OPENVPNSERVER]

Notice
<span class="hljs-comment">------</span>
Private<span class="hljs-operator">-</span>Key <span class="hljs-keyword">and</span> Public<span class="hljs-operator">-</span>Certificate<span class="hljs-operator">-</span>Request files created.
Your files <span class="hljs-keyword">are</span>:
<span class="hljs-operator">*</span> req: <span class="hljs-operator">/</span>root<span class="hljs-operator">/</span>easy<span class="hljs-operator">-</span>rsa<span class="hljs-operator">/</span>pki<span class="hljs-operator">/</span>reqs<span class="hljs-operator">/</span>server.req
<span class="hljs-operator">*</span> key: <span class="hljs-operator">/</span>root<span class="hljs-operator">/</span>easy<span class="hljs-operator">-</span>rsa<span class="hljs-operator">/</span>pki<span class="hljs-operator">/</span>private<span class="hljs-operator">/</span>server.key
</code></pre>
<h4 data-id="heading-10">2. 签发服务器证书</h4>
<pre><code class="hljs language-bash" lang="bash">./easyrsa sign-req server server
</code></pre>
<p><strong>输出示例：</strong></p>
<pre><code class="hljs language-vbnet" lang="vbnet">No Easy-RSA <span class="hljs-comment">'vars' configuration file exists!</span>

<span class="hljs-keyword">Using</span> SSL:
* openssl OpenSSL <span class="hljs-number">3.0</span>.<span class="hljs-number">13</span> <span class="hljs-number">30</span> Jan <span class="hljs-number">2024</span> (Library: OpenSSL <span class="hljs-number">3.0</span>.<span class="hljs-number">13</span> <span class="hljs-number">30</span> Jan <span class="hljs-number">2024</span>)
You are about <span class="hljs-keyword">to</span> sign the following certificate:
Please check over the details shown below <span class="hljs-keyword">for</span> accuracy. Note that this request
has <span class="hljs-built_in">not</span> been cryptographically verified. Please be sure it came <span class="hljs-keyword">from</span> a trusted
source <span class="hljs-built_in">or</span> that you have verified the request checksum <span class="hljs-keyword">with</span> the sender.

Request subject, <span class="hljs-keyword">to</span> be signed <span class="hljs-keyword">as</span> a server certificate 
<span class="hljs-keyword">for</span> <span class="hljs-comment">'825' days:</span>

subject=
    commonName                = OPENVPNSERVER

Type the word <span class="hljs-comment">'yes' to continue, or any other input to abort.</span>
  Confirm request details: yes
[输入 yes 确认]

<span class="hljs-keyword">Using</span> configuration <span class="hljs-keyword">from</span> /root/easy-rsa/pki/openssl-easyrsa.cnf
Enter pass phrase <span class="hljs-keyword">for</span> /root/easy-rsa/pki/<span class="hljs-keyword">private</span>/ca.<span class="hljs-keyword">key</span>:
[输入之前设置的 CA 密码，如未设密码直接回车]
Check that the request matches the signature
Signature ok
The Subject<span class="hljs-comment">'s Distinguished Name is as follows</span>
commonName            :ASN.<span class="hljs-number">1</span> <span class="hljs-number">12</span>:<span class="hljs-comment">'OPENVPNSERVER'</span>
Certificate <span class="hljs-built_in">is</span> <span class="hljs-keyword">to</span> be certified <span class="hljs-keyword">until</span> May <span class="hljs-number">14</span> <span class="hljs-number">13</span>:<span class="hljs-number">03</span>:<span class="hljs-number">07</span> <span class="hljs-number">2028</span> GMT (<span class="hljs-number">825</span> days)

Write out database <span class="hljs-keyword">with</span> <span class="hljs-number">1</span> <span class="hljs-built_in">new</span> entries
Database updated

Notice
------
Certificate created at:
* /root/easy-rsa/pki/issued/server.crt
</code></pre>
<h4 data-id="heading-11">3. 生成 Diffie-Hellman 参数</h4>
<pre><code class="hljs language-bash" lang="bash">./easyrsa gen-dh
</code></pre>
<p><strong>输出示例：</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">No Easy-RSA 'vars' configuration file exists!

Using SSL:
<span class="hljs-bullet">*</span> openssl OpenSSL 3.0.13 30 Jan 2024 (Library: OpenSSL 3.0.13 30 Jan 2024)
Generating DH parameters, 2048 bit long safe prime
....................+.........................................................+..................................................................................+.......................................................................+...................................................................................................................................................................................................................+.........................+.................................................................................................................................+.................................................................................................................................................................+...................................................................................................................................................................+...........................................................................+.............................................................................................................................................+...............................................................................................................................................................................................................................................+......................................................................................................................................................+.........................................................................................+....................................................................................+............................................................................................................................+..............................................................+....................................................................+........................................................................+...................+..........................................+...............................................................................................................................................................................................................+.............................+.......................................................................................................................................................................................................................................................................................................................................................+.........................+....................................+...................................................................................................+...................................................................................................+............+....................................+.................................................................................................................................................................+..................................................................................................................................................................................................+.....................................................................................................................................................+..................................................................................................................................................................................................................................................................................................................................................................................+........................................................................................+.................................................................................................................................................................................+............................+..........+...................................................+....................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................+.................................................................+...................................................+...........+........................................................................................................................................................+...................................................................................................+...........................................................+...........+.........................................................................................................+.........................................+..............................................................................................................................+................................................................................................................................................................................................+.................................................................................................................................................................................................+...........................................................................................................................................................................................+......+...................................+........................................................................................................................................................................+...........................................................................................................................................+..............................................................................................................................................................................................................+.....................................................................................................................................+......................................+.............................+.......................................................................................................................................................................................................+................................................................................................................................+..........+.................................................................................................................................................................................................................................................................................................+............................................................................................................................................................................................................................................................+................................................+.....................................................................................................................................+..............................................................................................................................+...........+...+.......................................................................................................................................................+................................+.......+...+..............................................................................................................................................................................+................................................................................+..............................+...+...............................................................................................................................................................................................................................................................................................................................................................................................................................................................................................+..................................................................................................................................................................................................+.......................................................+..........................................................+.......................................................................................................................................................................+............................................................................................................................................................................................................................................................+..........................................................................+.................................................................+......+.........................................................................................................................................................................................................+.................................+......................................................................+............................+....................................................................................+..........................+...................................................................................................................................................................................+.....................+...........................................................................................+.....................................................................................................................................................................................................................................+..............................+.................+......................................................................................................................................................................................................................................+...................................................................+.................................................................................................................................................................+....................+.....................................................................................................................................+........................................................................................................+...............................................................................................................................................................................................................................................................................................................................................+..................................................................................................................................................................................................+....................................................................................................................+...+.................................................................................+........+..............................................................................................................+.........................+..............................................................................................................................................................................................+...........................................................................................................................................................................................................................+............................+...........+............................................................................................................................................................................................+........................................................................+..............................+...........................+.............................................................................................+...............................................................................................................................................................................................................................................................................................................................................................................+...............................................+........................................................................................................................................................................................................................................+...............................................................................................................................................................................................+.............................................................................................................................................................................................+....+.............................................................................................+........................................................................................................................................................................................................+............+............................................................................................................................................................................+..............................................................................+..................................................+...........................................................................................................................................................................................................................+.....................................+....................................................................................................+..................................................................................................................................................................................................................................................................+.+.........................................................................................................................................................+.................+...................................................................+..........................................................................................................................................................................................................................................+................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................+....................................................................................................................................................................+....................+.........+.........................................................................................................................................+.............+.................................................................................................................................................................................................................................................................+..................................................................................................+.........+..................................................................................................+.............+........+.......................................................................................................................................................................................................+...............+............................+............................................................................................+.........................................+......++<span class="hljs-emphasis">*++*</span>++<span class="hljs-emphasis">*++*</span>++<span class="hljs-emphasis">*++*</span>++<span class="hljs-emphasis">*++*</span>++<span class="hljs-emphasis">*++*</span>++<span class="hljs-emphasis">*++*</span>++<span class="hljs-emphasis">*++*</span>++<span class="hljs-emphasis">*++*</span>++<span class="hljs-emphasis">*++*</span>++<span class="hljs-emphasis">*++*</span>++<span class="hljs-emphasis">*++*</span>++<span class="hljs-emphasis">*++*</span>++<span class="hljs-emphasis">*++*</span>++<span class="hljs-emphasis">*++*</span>++<span class="hljs-emphasis">*++*</span>++<span class="hljs-emphasis">*++*</span>++<span class="hljs-emphasis">*++*</span>++<span class="hljs-emphasis">*++*</span>++<span class="hljs-emphasis">*++*</span>++<span class="hljs-emphasis">*++*</span>++<span class="hljs-emphasis">*++*</span>++<span class="hljs-emphasis">*++*</span>++<span class="hljs-emphasis">*++*</span>++<span class="hljs-emphasis">*++*</span>++<span class="hljs-emphasis">*++*</span>++<span class="hljs-emphasis">*++*</span>++<span class="hljs-emphasis">*++*</span>++<span class="hljs-emphasis">*++*</span>++<span class="hljs-emphasis">*++*</span>++<span class="hljs-emphasis">*++*</span>++<span class="hljs-emphasis">*++*</span>++<span class="hljs-emphasis">*++*</span>
DH parameters appear to be ok.

<span class="hljs-section">Notice
------</span>

DH parameters of size 2048 created at:
<span class="hljs-bullet">*</span> /root/easy-rsa/pki/dh.pem
</code></pre>
<hr/>
<h3 data-id="heading-12">四、TLS 认证密钥生成</h3>
<h4 data-id="heading-13">1. 生成 TLS-Auth 密钥</h4>
<pre><code class="hljs language-bash" lang="bash">openvpn --genkey --secret ta.key
</code></pre>
<p><strong>输出示例：</strong></p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-number">2026</span>-<span class="hljs-number">02</span>-<span class="hljs-number">09</span> <span class="hljs-number">12</span>:<span class="hljs-number">55</span>:<span class="hljs-number">25</span> DEPRECATED <span class="hljs-keyword">OPTION</span>: The <span class="hljs-keyword">option</span> --secret <span class="hljs-built_in">is</span> deprecated.
<span class="hljs-number">2026</span>-<span class="hljs-number">02</span>-<span class="hljs-number">09</span> <span class="hljs-number">12</span>:<span class="hljs-number">55</span>:<span class="hljs-number">25</span> WARNING: <span class="hljs-keyword">Using</span> --genkey --secret filename <span class="hljs-built_in">is</span> DEPRECATED.  Use --genkey secret filename instead.

# 提示新版使用openvpn --genkey secret ta.<span class="hljs-keyword">key</span>
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">ls</span> -la ta.key
</code></pre>
<p><strong>输出示例：</strong></p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-deletion">-rw------- 1 root root 636 Feb  9 12:55 ta.key</span>
</code></pre>
<hr/>
<h3 data-id="heading-14">五、客户端证书生成命令</h3>
<h4 data-id="heading-15">1. 生成客户端证书请求</h4>
<pre><code class="hljs language-bash" lang="bash">./easyrsa gen-req client1 nopass
</code></pre>
<p><strong>输出示例：</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">No</span> Easy<span class="hljs-operator">-</span>RSA <span class="hljs-string">'vars'</span> configuration file <span class="hljs-keyword">exists</span><span class="hljs-operator">!</span>

<span class="hljs-keyword">Using</span> SSL:
<span class="hljs-operator">*</span> openssl OpenSSL <span class="hljs-number">3.0</span><span class="hljs-number">.13</span> <span class="hljs-number">30</span> Jan <span class="hljs-number">2024</span> (Library: OpenSSL <span class="hljs-number">3.0</span><span class="hljs-number">.13</span> <span class="hljs-number">30</span> Jan <span class="hljs-number">2024</span>)
..<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>...........<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>..........<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">*</span>..<span class="hljs-operator">+</span>.......<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>.........<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span>.....................<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">*</span>..<span class="hljs-operator">+</span>.........<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>........<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>............<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>.......<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>.........<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>........<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>.......<span class="hljs-operator">+</span>..................<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>.......<span class="hljs-operator">+</span>..............<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>............<span class="hljs-operator">+</span>...........<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>........<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>.................<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>...............<span class="hljs-operator">+</span>.............<span class="hljs-operator">+</span>........<span class="hljs-operator">+</span>.........<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>..............<span class="hljs-operator">+</span>..........<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span>.......<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>........<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>........<span class="hljs-operator">+</span>....<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>...............<span class="hljs-operator">+</span>.........<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>.............<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>...........<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>............<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>...........<span class="hljs-operator">+</span>....<span class="hljs-operator">+</span>............<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>....<span class="hljs-operator">+</span>........<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>........<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span>............<span class="hljs-operator">+</span>.........<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>................<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span>.......<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>....<span class="hljs-operator">+</span>........<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>....<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>.........<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span>..................<span class="hljs-operator">+</span>.........<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>.........<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>..............<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>.......<span class="hljs-operator">+</span>.........<span class="hljs-operator">+</span>..............<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>................<span class="hljs-operator">+</span>........<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>............<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>............<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>.......<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span>......<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>.....<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>....<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span>
...<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>....<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">*</span>..<span class="hljs-operator">+</span>...................<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">*</span>.......<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>.............<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>............<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>.<span class="hljs-operator">+</span>...<span class="hljs-operator">+</span>........<span class="hljs-operator">+</span>....<span class="hljs-operator">+</span>...............<span class="hljs-operator">+</span>.........<span class="hljs-operator">+</span>..<span class="hljs-operator">+</span>....<span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span>
<span class="hljs-comment">-----</span>
You <span class="hljs-keyword">are</span> about <span class="hljs-keyword">to</span> be asked <span class="hljs-keyword">to</span> enter information that will be incorporated
<span class="hljs-keyword">into</span> your certificate request.
What you <span class="hljs-keyword">are</span> about <span class="hljs-keyword">to</span> enter <span class="hljs-keyword">is</span> what <span class="hljs-keyword">is</span> <span class="hljs-keyword">called</span> a Distinguished Name <span class="hljs-keyword">or</span> a DN.
There <span class="hljs-keyword">are</span> quite a few fields but you can leave <span class="hljs-keyword">some</span> blank
<span class="hljs-keyword">For</span> <span class="hljs-keyword">some</span> fields there will be a <span class="hljs-keyword">default</span> <span class="hljs-keyword">value</span>,
If you enter <span class="hljs-string">'.'</span>, the field will be <span class="hljs-keyword">left</span> blank.
<span class="hljs-comment">-----</span>
Common Name (eg: your <span class="hljs-keyword">user</span>, host, <span class="hljs-keyword">or</span> server name) [client1]:
[输入客户端名称，如 client1 或直接回车使用默认值]

Notice
<span class="hljs-comment">------</span>
Private<span class="hljs-operator">-</span>Key <span class="hljs-keyword">and</span> Public<span class="hljs-operator">-</span>Certificate<span class="hljs-operator">-</span>Request files created.
Your files <span class="hljs-keyword">are</span>:
<span class="hljs-operator">*</span> req: <span class="hljs-operator">/</span>root<span class="hljs-operator">/</span>easy<span class="hljs-operator">-</span>rsa<span class="hljs-operator">/</span>pki<span class="hljs-operator">/</span>reqs<span class="hljs-operator">/</span>client1.req
<span class="hljs-operator">*</span> key: <span class="hljs-operator">/</span>root<span class="hljs-operator">/</span>easy<span class="hljs-operator">-</span>rsa<span class="hljs-operator">/</span>pki<span class="hljs-operator">/</span>private<span class="hljs-operator">/</span>client1.key
</code></pre>
<h4 data-id="heading-16">2. 签发客户端证书</h4>
<pre><code class="hljs language-bash" lang="bash">./easyrsa sign-req client client1
</code></pre>
<p><strong>输出示例：</strong></p>
<pre><code class="hljs language-vbnet" lang="vbnet">No Easy-RSA <span class="hljs-comment">'vars' configuration file exists!</span>

<span class="hljs-keyword">Using</span> SSL:
* openssl OpenSSL <span class="hljs-number">3.0</span>.<span class="hljs-number">13</span> <span class="hljs-number">30</span> Jan <span class="hljs-number">2024</span> (Library: OpenSSL <span class="hljs-number">3.0</span>.<span class="hljs-number">13</span> <span class="hljs-number">30</span> Jan <span class="hljs-number">2024</span>)
You are about <span class="hljs-keyword">to</span> sign the following certificate:
Please check over the details shown below <span class="hljs-keyword">for</span> accuracy. Note that this request
has <span class="hljs-built_in">not</span> been cryptographically verified. Please be sure it came <span class="hljs-keyword">from</span> a trusted
source <span class="hljs-built_in">or</span> that you have verified the request checksum <span class="hljs-keyword">with</span> the sender.

Request subject, <span class="hljs-keyword">to</span> be signed <span class="hljs-keyword">as</span> a client certificate 
<span class="hljs-keyword">for</span> <span class="hljs-comment">'825' days:</span>

subject=
    commonName                = client1

Type the word <span class="hljs-comment">'yes' to continue, or any other input to abort.</span>
  Confirm request details: yes
[输入 yes 确认]

<span class="hljs-keyword">Using</span> configuration <span class="hljs-keyword">from</span> /root/easy-rsa/pki/openssl-easyrsa.cnf
Enter pass phrase <span class="hljs-keyword">for</span> /root/easy-rsa/pki/<span class="hljs-keyword">private</span>/ca.<span class="hljs-keyword">key</span>:
[输入 CA 密码，如未设密码直接回车]
Check that the request matches the signature
Signature ok
The Subject<span class="hljs-comment">'s Distinguished Name is as follows</span>
commonName            :ASN.<span class="hljs-number">1</span> <span class="hljs-number">12</span>:<span class="hljs-comment">'client1'</span>
Certificate <span class="hljs-built_in">is</span> <span class="hljs-keyword">to</span> be certified <span class="hljs-keyword">until</span> May <span class="hljs-number">14</span> <span class="hljs-number">12</span>:<span class="hljs-number">58</span>:<span class="hljs-number">47</span> <span class="hljs-number">2028</span> GMT (<span class="hljs-number">825</span> days)

Write out database <span class="hljs-keyword">with</span> <span class="hljs-number">1</span> <span class="hljs-built_in">new</span> entries
Database updated

Notice
------
Certificate created at:
* /root/easy-rsa/pki/issued/client1.crt
</code></pre>
<hr/>
<h3 data-id="heading-17">六、文件复制和权限设置</h3>
<h4 data-id="heading-18">1. 复制服务器文件</h4>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">cp</span> ~/easy-rsa/pki/ca.crt /etc/openvpn/server/
sudo <span class="hljs-built_in">cp</span> ~/easy-rsa/pki/issued/server.crt /etc/openvpn/server/
sudo <span class="hljs-built_in">cp</span> ~/easy-rsa/pki/private/server.key /etc/openvpn/server/
sudo <span class="hljs-built_in">cp</span> ~/easy-rsa/pki/dh.pem /etc/openvpn/server/
sudo <span class="hljs-built_in">cp</span> ~/easy-rsa/ta.key /etc/openvpn/server/
</code></pre>
<h4 data-id="heading-19">2. 设置文件权限</h4>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">chmod</span> 644 /etc/openvpn/server/*.crt
sudo <span class="hljs-built_in">chmod</span> 644 /etc/openvpn/server/*.pem
sudo <span class="hljs-built_in">chmod</span> 600 /etc/openvpn/server/*.key
sudo <span class="hljs-built_in">chmod</span> 644 /etc/openvpn/server/ta.key
</code></pre>
<h4 data-id="heading-20">3. OPENVPN服务配置</h4>
<pre><code class="hljs language-lua" lang="lua">port <span class="hljs-number">1194</span>
proto tcp
dev tun
ca /etc/openvpn/server/ca.crt
cert /etc/openvpn/server/server.crt
key /etc/openvpn/server/server.key
dh /etc/openvpn/server/dh.pem
auth SHA256
tls-auth /etc/openvpn/server/ta.key <span class="hljs-number">0</span>
server <span class="hljs-number">10.0</span><span class="hljs-number">.9</span><span class="hljs-number">.0</span> <span class="hljs-number">255.255</span><span class="hljs-number">.255</span><span class="hljs-number">.0</span>
ifconfig-pool-persist /var/<span class="hljs-built_in">log</span>/openvpn/ipp.txt
push <span class="hljs-string">"redirect-gateway def1 bypass-dhcp"</span>
push <span class="hljs-string">"dhcp-option DNS 114.114.114.114"</span>
push <span class="hljs-string">"dhcp-option DNS 8.8.8.8"</span>
keepalive <span class="hljs-number">10</span> <span class="hljs-number">120</span>
cipher AES<span class="hljs-number">-256</span>-CBC
user nobody
group nogroup
persist-key
persist-tun
<span class="hljs-built_in">status</span> /var/<span class="hljs-built_in">log</span>/openvpn/openvpn-<span class="hljs-built_in">status</span>.<span class="hljs-built_in">log</span>
<span class="hljs-built_in">log</span>-append /var/<span class="hljs-built_in">log</span>/openvpn/openvpn.<span class="hljs-built_in">log</span>
verb <span class="hljs-number">3</span>
explicit-<span class="hljs-built_in">exit</span>-notify <span class="hljs-number">1</span>
</code></pre>
<h4 data-id="heading-21">4. 验证文件复制</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">ls</span> -la /etc/openvpn/server/
</code></pre>
<p><strong>输出示例：</strong></p>
<pre><code class="hljs language-diff" lang="diff">total 36
drwxr-xr-x 2 root root 4096 Feb  9 13:06 .
drwxr-xr-x 4 root root 4096 Feb  9 13:18 ..
<span class="hljs-deletion">-rw-r--r-- 1 root root 1196 Feb  9 12:59 ca.crt</span>
<span class="hljs-deletion">-rw-r--r-- 1 root root  424 Feb  9 13:04 dh.pem</span>
<span class="hljs-deletion">-rw-r--r-- 1 root root  496 Feb  9 13:06 server.conf</span>
<span class="hljs-deletion">-rw-r--r-- 1 root root 4631 Feb  9 13:03 server.crt</span>
<span class="hljs-deletion">-rw------- 1 root root 1704 Feb  9 13:03 server.key</span>
<span class="hljs-deletion">-rw-r--r-- 1 root root  636 Feb  9 13:04 ta.key</span>
</code></pre>
<h4 data-id="heading-22">5. 链接server.conf</h4>
<pre><code class="hljs language-Shell" lang="Shell"><span class="hljs-meta prompt_"># </span><span class="bash">OPENVPN配置默认启动/etc/openvpn/*.conf</span>
ln -sf /etc/openvpn/server/server.conf /etc/openvpn/server.conf
ls
</code></pre>
<p><strong>输出示例：</strong></p>
<pre><code class="hljs language-vbscript" lang="vbscript">client  <span class="hljs-built_in">server</span>  <span class="hljs-built_in">server</span>.conf  update-resolv-conf
</code></pre>
<hr/>
<h3 data-id="heading-23">七、网络配置和防火墙</h3>
<h4 data-id="heading-24">1. 启用 IP 转发</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">"net.ipv4.ip_forward = 1"</span> | sudo <span class="hljs-built_in">tee</span> -a /etc/sysctl.conf
sudo sysctl -p
</code></pre>
<p><strong>输出示例：</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">net.ipv4.ip_forward</span> = <span class="hljs-number">1</span>
</code></pre>
<h4 data-id="heading-25">2. 配置SNAT</h4>
<pre><code class="hljs language-shell" lang="shell">vi /etc/ufw/before.rules
</code></pre>
<p><strong>添加以下内容：</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># NAT table rules</span>
*nat
:POSTROUTING ACCEPT <span class="hljs-section">[0:0]</span>
-A POSTROUTING -s 10.0.9.0/24 -o ens18 -j MASQUERADE
COMMIT

...其他内容...
</code></pre>
<p><strong>验证配置：</strong></p>
<pre><code class="hljs language-shell" lang="shell">root@ubtuntu:~# iptables -t nat -L -n
Chain PREROUTING (policy ACCEPT)
target     prot opt source               destination         

Chain INPUT (policy ACCEPT)
target     prot opt source               destination         

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination         

Chain POSTROUTING (policy ACCEPT)
target     prot opt source               destination         
MASQUERADE  0    --  10.0.9.0/24          0.0.0.0/0
</code></pre>
<h4 data-id="heading-26">3. 配置防火墙</h4>
<pre><code class="hljs language-shell" lang="shell">vi /etc/default/ufw
</code></pre>
<p><strong>修改以下内容</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 禁用IPV6（可选）</span>
<span class="hljs-attr">IPV6</span>=<span class="hljs-literal">no</span>
<span class="hljs-attr">DEFAULT_OUTPUT_POLICY</span>=<span class="hljs-string">"ACCEPT"</span>

<span class="hljs-comment"># 转发设置为允许</span>
<span class="hljs-attr">DEFAULT_FORWARD_POLICY</span>=<span class="hljs-string">"ACCEPT"</span>
</code></pre>
<h4 data-id="heading-27">4. 检查防火墙状态</h4>
<pre><code class="hljs language-shell" lang="shell">ufw status verbose 
</code></pre>
<p><strong>输出示例：</strong></p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">Status:</span> active
<span class="hljs-symbol">Logging:</span> <span class="hljs-keyword">on</span> (low)
<span class="hljs-symbol">Default:</span> deny (incoming), allow (outgoing), allow (routed)
<span class="hljs-built_in">New</span> profiles: <span class="hljs-keyword">skip</span>

<span class="hljs-keyword">To</span>                         Action      <span class="hljs-keyword">From</span>
--                         ------      ----
<span class="hljs-number">1194</span>/udp                   ALLOW <span class="hljs-keyword">IN</span>    Anywhere                  
<span class="hljs-number">22</span>/tcp                     ALLOW <span class="hljs-keyword">IN</span>    Anywhere                  
<span class="hljs-number">1194</span>/tcp                   ALLOW <span class="hljs-keyword">IN</span>    Anywhere                  

</code></pre>
<hr/>
<h3 data-id="heading-28">八、服务器启动和验证</h3>
<h4 data-id="heading-29">1. 启动 OpenVPN 服务</h4>
<pre><code class="hljs language-bash" lang="bash">sudo systemctl start openvpn@server
sudo systemctl <span class="hljs-built_in">enable</span> openvpn@server
</code></pre>
<h4 data-id="heading-30">2. 检查服务状态</h4>
<pre><code class="hljs language-bash" lang="bash">sudo systemctl status openvpn@server
</code></pre>
<p><strong>正常输出示例：</strong></p>
<pre><code class="hljs language-bash" lang="bash">● openvpn@server.service - OpenVPN connection to server
     Loaded: loaded (/usr/lib/systemd/system/openvpn@.service; enabled; preset: enabled)
     Active: active (running) since Mon 2026-02-09 13:29:57 UTC; 13min ago
       Docs: man:openvpn(8)
             https://community.openvpn.net/openvpn/wiki/Openvpn24ManPage
             https://community.openvpn.net/openvpn/wiki/HOWTO
   Main PID: 4213 (openvpn)
     Status: <span class="hljs-string">"Initialization Sequence Completed"</span>
      Tasks: 1 (<span class="hljs-built_in">limit</span>: 10)
     Memory: 1.6M (peak: 1.9M)
        CPU: 83ms
     CGroup: /system.slice/system-openvpn.slice/openvpn@server.service
             └─4213 /usr/sbin/openvpn --daemon ovpn-server --status /run/openvpn/server.status 10 --<span class="hljs-built_in">cd</span> /etc/openvpn --script-security 2 --config /etc/openvpn/server.conf --writepid /run/openvpn/server.pid

Feb 09 13:29:57 ubtuntu systemd[1]: Started openvpn@server.service - OpenVPN connection to server.
</code></pre>
<h4 data-id="heading-31">3. 检查日志文件</h4>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">tail</span> -f /var/log/openvpn/openvpn.log
</code></pre>
<p><strong>正常输出示例：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-number">2026-02-09 13:29:57 </span><span class="hljs-string">TCPv4_SERVER</span> <span class="hljs-string">link</span> <span class="hljs-string">local</span> <span class="hljs-string">(bound):</span> [<span class="hljs-string">AF_INET</span>][<span class="hljs-string">undef</span>]<span class="hljs-string">:1194</span>
<span class="hljs-attr">2026-02-09 13:29:57 TCPv4_SERVER link remote:</span> [<span class="hljs-string">AF_UNSPEC</span>]
<span class="hljs-number">2026-02-09 13:29:57 </span><span class="hljs-string">UID</span> <span class="hljs-string">set</span> <span class="hljs-string">to</span> <span class="hljs-string">nobody</span>
<span class="hljs-number">2026-02-09 13:29:57 </span><span class="hljs-string">GID</span> <span class="hljs-string">set</span> <span class="hljs-string">to</span> <span class="hljs-string">nogroup</span>
<span class="hljs-attr">2026-02-09 13:29:57 Capabilities retained:</span> <span class="hljs-string">CAP_NET_ADMIN</span>
<span class="hljs-attr">2026-02-09 13:29:57 MULTI:</span> <span class="hljs-string">multi_init</span> <span class="hljs-string">called,</span> <span class="hljs-string">r=256</span> <span class="hljs-string">v=256</span>
<span class="hljs-attr">2026-02-09 13:29:57 IFCONFIG POOL IPv4:</span> <span class="hljs-string">base=10.0.9.4</span> <span class="hljs-string">size=62</span>
<span class="hljs-number">2026-02-09 13:29:57 </span><span class="hljs-string">IFCONFIG</span> <span class="hljs-string">POOL</span> <span class="hljs-string">LIST</span>
<span class="hljs-attr">2026-02-09 13:29:57 MULTI:</span> <span class="hljs-string">TCP</span> <span class="hljs-string">INIT</span> <span class="hljs-string">maxclients=1024</span> <span class="hljs-string">maxevents=1029</span>
<span class="hljs-number">2026-02-09 13:29:57 </span><span class="hljs-string">Initialization</span> <span class="hljs-string">Sequence</span> <span class="hljs-string">Completed</span>
</code></pre>
<h4 data-id="heading-32">4. 检查端口监听</h4>
<pre><code class="hljs language-bash" lang="bash">ss -tulpn | grep :1194
</code></pre>
<p><strong>输出示例：</strong></p>
<pre><code class="hljs language-bash" lang="bash">tcp   LISTEN 0      4096              0.0.0.0:1194         0.0.0.0:*    <span class="hljs-built_in">users</span>:(("openvpn",pid=<span class="hljs-number">4213</span>,fd=<span class="hljs-number">6</span>))
</code></pre>
<hr/>
<h3 data-id="heading-33">九、客户端配置生成</h3>
<h4 data-id="heading-34">1. 生成客户端证书与私钥</h4>
<pre><code class="hljs language-shell" lang="shell">cd ~/easy-rsa
<span class="hljs-meta prompt_">
# </span><span class="bash">为客户端1生成证书</span>
./easyrsa gen-req Client1 nopass
./easyrsa sign-req client Client1
<span class="hljs-meta prompt_">
# </span><span class="bash">为客户端2生成证书（可选）</span>
./easyrsa gen-req client2 nopass
./easyrsa sign-req client client2
</code></pre>
<h4 data-id="heading-35">2. 生成客户端配置文件</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cat</span> &gt; /etc/openvpn/client/client1.ovpn &lt;&lt; <span class="hljs-string">EOF
client
dev tun
proto tcp
remote YOUR_SERVER_IP 1194
resolv-retry infinite
nobind
persist-key
persist-tun
remote-cert-tls server
cipher AES-256-CBC
auth SHA256
key-direction 1
data-ciphers AES-256-GCM:AES-128-GCM:AES-256-CBC
data-ciphers-fallback AES-256-CBC
tun-mtu 1320
verb 3
&lt;ca&gt;
$(cat /etc/openvpn/server/ca.crt)
&lt;/ca&gt;
&lt;cert&gt;
$(cat ~/easy-rsa/pki/issued/client1.crt)
&lt;/cert&gt;
&lt;key&gt;
$(cat ~/easy-rsa/pki/private/client1.key)
&lt;/key&gt;
&lt;tls-auth&gt;
$(cat /etc/openvpn/server/ta.key)
&lt;/tls-auth&gt;
EOF</span>
</code></pre>
<p>后续将 <code>/etc/openvpn/client/client1.ovpn</code> 导入客户端链接即可</p>
<h3 data-id="heading-36">十、Windows客户端下载</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fopenvpn.net%2Fcommunity%2F" target="_blank" title="https://openvpn.net/community/" ref="nofollow noopener noreferrer">OpenVPN开源社区版下载链接</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b55490e798db496db4cdd63198408645~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5YGa6I-c6bif55qE572R5bel:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771330750&amp;x-signature=biw%2FL%2BWBC7ku7EdcO%2Fle9TSNMlg%3D" alt="Pasted image 20260210200200.png" loading="lazy"/></p>
<p>安装完成后导入配置链接即可</p>
<hr/>
<h3 data-id="heading-37">十一、故障排除和验证</h3>
<h4 data-id="heading-38">1. 证书验证命令</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 验证 CA 证书</span>
openssl x509 -<span class="hljs-keyword">in</span> /etc/openvpn/server/ca.crt -text -noout | <span class="hljs-built_in">head</span> -20
</code></pre>
<p><strong>输出示例：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Certificate:</span>
    <span class="hljs-attr">Data:</span>
        <span class="hljs-attr">Version:</span> <span class="hljs-number">3</span> <span class="hljs-string">(0x2)</span>
        <span class="hljs-attr">Serial Number:</span>
            <span class="hljs-number">39</span><span class="hljs-string">:19:00:d2:d5:33:ce:fd:71:36:f4:53:61:49:b0:5b:fc:df:43:68</span>
        <span class="hljs-attr">Signature Algorithm:</span> <span class="hljs-string">sha256WithRSAEncryption</span>
        <span class="hljs-attr">Issuer:</span> <span class="hljs-string">CN</span> <span class="hljs-string">=</span> <span class="hljs-string">OPENVPNCA</span>
        <span class="hljs-string">Validity</span>
            <span class="hljs-attr">Not Before:</span> <span class="hljs-string">Feb</span>  <span class="hljs-number">9</span> <span class="hljs-number">12</span><span class="hljs-string">:51:46</span> <span class="hljs-number">2026 </span><span class="hljs-string">GMT</span>
            <span class="hljs-attr">Not After :</span> <span class="hljs-string">Feb</span>  <span class="hljs-number">7</span> <span class="hljs-number">12</span><span class="hljs-string">:51:46</span> <span class="hljs-number">2036 </span><span class="hljs-string">GMT</span>
        <span class="hljs-attr">Subject:</span> <span class="hljs-string">CN</span> <span class="hljs-string">=</span> <span class="hljs-string">OPENVPNCA</span>
        <span class="hljs-attr">Subject Public Key Info:</span>
            <span class="hljs-attr">Public Key Algorithm:</span> <span class="hljs-string">rsaEncryption</span>
                <span class="hljs-attr">Public-Key:</span> <span class="hljs-string">(2048</span> <span class="hljs-string">bit)</span>
                <span class="hljs-attr">Modulus:</span>
                    <span class="hljs-attr">00:af:02:1c:2f:e4:a1:4a:af:fb:4c:71:db:b2:e6:</span>
					<span class="hljs-string">...</span>

</code></pre>
<h4 data-id="heading-39">2. 常见错误日志分析</h4>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">tail</span> -20 /var/log/openvpn/openvpn.log
</code></pre>
<p><strong>常见错误输出及解决方法：</strong></p>
<h5 data-id="heading-40">错误 1：文件权限问题</h5>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-number">2026</span>-<span class="hljs-number">02</span>-<span class="hljs-number">09</span> <span class="hljs-number">13</span>:<span class="hljs-number">27</span>:<span class="hljs-number">30</span> Cannot pre-load keyfile (ta.<span class="hljs-keyword">key</span>)
<span class="hljs-number">2026</span>-<span class="hljs-number">02</span>-<span class="hljs-number">09</span> <span class="hljs-number">13</span>:<span class="hljs-number">27</span>:<span class="hljs-number">30</span> Exiting due <span class="hljs-keyword">to</span> fatal <span class="hljs-keyword">error</span>
</code></pre>
<p><strong>解决方案：</strong></p>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">chmod</span> 644 /etc/openvpn/server/ta.key
sudo <span class="hljs-built_in">chown</span> nobody:nogroup /etc/openvpn/server/ta.key
</code></pre>
<h5 data-id="heading-41">错误 2：证书路径问题</h5>
<pre><code class="hljs language-vbnet" lang="vbnet">Options <span class="hljs-keyword">error</span>: --dh fails <span class="hljs-keyword">with</span> <span class="hljs-comment">'dh.pem': No such file or directory (errno=2)</span>
Options <span class="hljs-keyword">error</span>: --ca fails <span class="hljs-keyword">with</span> <span class="hljs-comment">'ca.crt': No such file or directory (errno=2)</span>
</code></pre>
<p><strong>解决方案：</strong></p>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">cp</span> ~/easy-rsa/pki/dh.pem /etc/openvpn/server/
sudo <span class="hljs-built_in">cp</span> ~/easy-rsa/pki/ca.crt /etc/openvpn/server/
</code></pre>
<h5 data-id="heading-42">错误 3：端口占用</h5>
<pre><code class="hljs language-ini" lang="ini">2026-02-09 13:29:57 TCPv4_SERVER link local (bound): <span class="hljs-section">[AF_INET]</span><span class="hljs-section">[undef]</span>:1194: Address already in use (<span class="hljs-attr">errno</span>=<span class="hljs-number">98</span>)
</code></pre>
<p><strong>解决方案：</strong></p>
<pre><code class="hljs language-bash" lang="bash">sudo systemctl stop openvpn@server
sudo killall openvpn
sudo systemctl start openvpn@server
</code></pre>
<h4 data-id="heading-43">3. 完整验证流程</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 检查服务状态</span>
systemctl status openvpn@server

<span class="hljs-comment"># 2. 检查日志</span>
<span class="hljs-built_in">tail</span> -f /var/log/openvpn/openvpn.log

<span class="hljs-comment"># 3. 检查端口监听</span>
ss -tulpn | grep :1194

<span class="hljs-comment"># 4. 检查防火墙</span>
sudo ufw status

<span class="hljs-comment"># 5. 测试连接（从另一台机器）</span>
nc -zv YOUR_SERVER_IP 1194
</code></pre>
<h4 data-id="heading-44">4. 证书链验证</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 验证服务器证书是否由 CA 签发</span>
openssl verify -CAfile /etc/openvpn/server/ca.crt /etc/openvpn/server/server.crt
</code></pre>
<p><strong>成功输出示例：</strong></p>
<pre><code class="hljs language-vbscript" lang="vbscript">/etc/openvpn/<span class="hljs-built_in">server</span>/<span class="hljs-built_in">server</span>.crt: OK
</code></pre>
<hr/>
<h3 data-id="heading-45">十二、部署检查清单</h3>
<h4 data-id="heading-46">需要完成的项目</h4>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> OpenVPN 和 Easy-RSA 安装</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> CA 证书生成</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> 服务器证书和密钥</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> Diffie-Hellman 参数生成</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> TLS-Auth 密钥生成</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> 客户端证书生成与密钥</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> 文件权限设置</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> 网络配置</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> 防火墙规则</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> 服务启动</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> 端口监听验证</li>
</ul>
<h4 data-id="heading-47">需要手动修改的项目</h4>
<ol>
<li>
<p><strong>服务器配置文件</strong> <code>/etc/openvpn/server/server.conf</code>：</p>
<ul>
<li>确认证书路径正确</li>
<li>修改服务器 IP 段（如 10.0.9.0/24）</li>
<li>确认协议类型（udp/tcp）</li>
</ul>
</li>
<li>
<p><strong>客户端配置文件</strong>：</p>
<ul>
<li>将 <code>YOUR_SERVER_IP</code> 替换为实际公网 IP</li>
<li>确认端口号正确</li>
<li>确认协议类型匹配服务器</li>
</ul>
</li>
<li>
<p><strong>防火墙配置</strong>：</p>
<ul>
<li>确认 <code>before.rules</code> 中的网卡名称（如 ens18）</li>
<li>确认 NAT 规则中的 IP 段匹配</li>
</ul>
</li>
</ol>
<hr/>
<p>本文部署环境均为虚拟环境，仅供技术学习与交流。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[《JS列表转树实操指南》]]></title>    <link>https://juejin.cn/post/7605030650279395374</link>    <guid>https://juejin.cn/post/7605030650279395374</guid>    <pubDate>2026-02-10T13:20:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605030650279395374" data-draft-id="7605030650279362606" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="《JS列表转树实操指南》"/> <meta itemprop="keywords" content="算法"/> <meta itemprop="datePublished" content="2026-02-10T13:20:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="随逸177"/> <meta itemprop="url" content="https://juejin.cn/user/1857514486118233"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            《JS列表转树实操指南》
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1857514486118233/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    随逸177
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T13:20:36.000Z" title="Tue Feb 10 2026 13:20:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JS列表转树实操指南｜递归与Map最优解详解</h2>
<p>在前端开发中，扁平列表转树形结构是极为常见的基础操作。后台接口返回的数据往往是扁平的（通过parentId关联父子关系），而前端渲染层级组件（如菜单、分类、省市区选择器）时，需要将其转换为嵌套的树形结构。</p>
<p>本文将从零到一，拆解列表转树的两种核心实现方案——递归法（易上手）和Map优化法（高性能），补充实操细节、代码注释和场景应用，帮你快速掌握两种解法的核心逻辑，轻松应对开发中的各类层级数据处理需求。</p>
<h3 data-id="heading-1">一、什么是列表转树？核心场景</h3>
<p>列表转树，本质是将「扁平结构数据」（通过parentId字段关联父子节点），转换为「层级嵌套结构数据」（通过children字段存储子节点），是前端处理层级关系数据的核心技巧。</p>
<h4 data-id="heading-2">1. 输入输出示例（开发实操标准格式）</h4>
<p>后台返回的扁平列表（最常见格式）：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">//</span> <span class="hljs-string">核心关联字段：id（节点唯一标识）、parentId（父节点id）</span>
<span class="hljs-string">const</span> <span class="hljs-string">flatList</span> <span class="hljs-string">=</span> [
  { <span class="hljs-attr">id:</span> <span class="hljs-number">1</span>, <span class="hljs-attr">parentId:</span> <span class="hljs-number">0</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">'一级菜单A'</span> },
  { <span class="hljs-attr">id:</span> <span class="hljs-number">2</span>, <span class="hljs-attr">parentId:</span> <span class="hljs-number">1</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">'二级菜单A-1'</span> },
  { <span class="hljs-attr">id:</span> <span class="hljs-number">3</span>, <span class="hljs-attr">parentId:</span> <span class="hljs-number">1</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">'二级菜单A-2'</span> },
  { <span class="hljs-attr">id:</span> <span class="hljs-number">4</span>, <span class="hljs-attr">parentId:</span> <span class="hljs-number">2</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">'三级菜单A-1-1'</span> },
  { <span class="hljs-attr">id:</span> <span class="hljs-number">5</span>, <span class="hljs-attr">parentId:</span> <span class="hljs-number">0</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">'一级菜单B'</span> },
]<span class="hljs-string">;</span>
</code></pre>
<p>前端渲染所需的树形结构：</p>
<pre><code class="hljs language-yaml" lang="yaml">[
  {
    <span class="hljs-attr">id:</span> <span class="hljs-number">1</span>,
    <span class="hljs-attr">parentId:</span> <span class="hljs-number">0</span>,
    <span class="hljs-attr">name:</span> <span class="hljs-string">'一级菜单A'</span>,
    <span class="hljs-attr">children:</span> [
      {
        <span class="hljs-attr">id:</span> <span class="hljs-number">2</span>,
        <span class="hljs-attr">parentId:</span> <span class="hljs-number">1</span>,
        <span class="hljs-attr">name:</span> <span class="hljs-string">'二级菜单A-1'</span>,
        <span class="hljs-attr">children:</span> [
          { <span class="hljs-attr">id:</span> <span class="hljs-number">4</span>, <span class="hljs-attr">parentId:</span> <span class="hljs-number">2</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">'三级菜单A-1-1'</span>, <span class="hljs-attr">children:</span> [] }
        ]
      },
      { <span class="hljs-attr">id:</span> <span class="hljs-number">3</span>, <span class="hljs-attr">parentId:</span> <span class="hljs-number">1</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">'二级菜单A-2'</span>, <span class="hljs-attr">children:</span> [] }
    ]
  },
  { <span class="hljs-attr">id:</span> <span class="hljs-number">5</span>, <span class="hljs-attr">parentId:</span> <span class="hljs-number">0</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">'一级菜单B'</span>, <span class="hljs-attr">children:</span> [] }
]
</code></pre>
<h4 data-id="heading-3">2. 核心约定（开发通用规范）</h4>
<ul>
<li>根节点的parentId固定为0（行业通用约定，若后台返回为null或undefined，可微调判断条件）；</li>
<li>每个节点必须拥有唯一id，避免父子关联错乱，确保层级结构正确；</li>
<li>转换过程中不修改原始扁平列表（遵循数据不可变性，避免影响其他依赖该列表的业务逻辑）；</li>
<li>无子节点的节点，children字段设为空数组（统一数据格式，便于前端组件统一渲染，避免报错）。</li>
</ul>
<h3 data-id="heading-4">二、解法一：递归法（易上手，适合中小型列表）</h3>
<p>递归法是最直观、最易理解和编写的解法，核心思路是「逐层查找并嵌套子节点」：从根节点（parentId=0）开始，先筛选出其直接子节点，再对每个子节点递归执行相同操作，查找其下一级子节点，直到某个节点无子节点，递归自动终止。</p>
<h4 data-id="heading-5">1. 完整可运行代码（极简实操版）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * 递归实现列表转树
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Array</span>} <span class="hljs-variable">list</span> - 待转换的扁平列表数据
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Number</span>} <span class="hljs-variable">parentId</span> - 父节点id，默认0（根节点父id）
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Array</span>} 转换后的树形结构数组
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">listToTree</span>(<span class="hljs-params">list, parentId = <span class="hljs-number">0</span></span>) {
  <span class="hljs-comment">// 1. 筛选当前父节点的所有直接子节点</span>
  <span class="hljs-keyword">const</span> directChildren = list.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">parentId</span> === parentId);
  
  <span class="hljs-comment">// 2. 遍历每个直接子节点，递归查找其下一级子节点，补充children属性</span>
  <span class="hljs-keyword">return</span> directChildren.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> ({
    ...child, <span class="hljs-comment">// 复制原节点所有属性，避免修改原始列表数据</span>
    <span class="hljs-attr">children</span>: <span class="hljs-title function_">listToTree</span>(list, child.<span class="hljs-property">id</span>) <span class="hljs-comment">// 递归：以当前子节点id为父id，查找其下一级子节点</span>
  }));
}
</code></pre>
<h4 data-id="heading-6">2. 核心逻辑拆解（通俗好懂）</h4>
<p>很多人觉得递归“难理解”，其实只要抓住「核心逻辑+终止条件」，就能轻松掌握：</p>
<ul>
<li>核心逻辑：当前节点的children数组，等于「所有parentId等于当前节点id」的子节点集合，通过递归调用自身实现层级嵌套；</li>
<li>终止条件：当某个节点没有子节点时，filter方法会返回空数组，map方法也会返回空数组，此时children为空，递归自动停止，无需手动判断终止。</li>
</ul>
<h4 data-id="heading-7">3. 实操注意事项（避坑重点）</h4>
<ul>
<li>避免修改原始数据：必须用扩展运算符<code>...child</code>复制原节点，再补充children属性，若直接修改child（如child.children = ...），会污染原始扁平列表，影响其他业务逻辑；</li>
<li>不传入列表副本：递归时直接传入原始list即可，无需用list.slice()等方法创建副本，否则每次递归都会生成新数组，浪费内存；</li>
<li>兼容异常数据：若列表中存在parentId无效（无对应父节点）的节点，该节点会被自动过滤，不会影响整体树形结构生成。</li>
</ul>
<h4 data-id="heading-8">4. 性能特点（适配场景说明）</h4>
<ul>
<li>时间复杂度：O(n²) —— 每次递归都会遍历整个列表（filter操作），若列表长度为n，最坏情况下（树退化为单链表），会递归n次，总遍历次数为n×n；</li>
<li>空间复杂度：O(n) —— 递归调用栈的深度最多为树的层级（最坏n层），同时生成的树形结构包含n个节点，内存开销可控；</li>
<li>适配场景：适合中小型扁平列表（数据量n&lt;1000），如简单菜单、小型分类，代码简洁、易调试，开发效率高。</li>
</ul>
<h3 data-id="heading-9">三、解法二：Map优化法（高性能，生产环境首选）</h3>
<p>递归法的核心短板是「重复遍历列表」，导致数据量大时性能下降。Map优化法的核心思路是「空间换时间」：利用ES6 Map数据结构，先构建「节点id→节点对象」的映射表，实现“O(1)快速查找父节点”，将时间复杂度从O(n²)优化到O(n)，是生产环境处理大数据量列表的首选解法。</p>
<h4 data-id="heading-10">1. 完整可运行代码（生产级健壮版）</h4>
<pre><code class="hljs language-ini" lang="ini">/**
 * Map优化版列表转树（高性能，生产级）
 * @param {Array} list - 待转换的扁平列表数据
 * @param {Number} rootParentId - 根节点的parentId，默认0
 * @returns {Array} 转换后的树形结构数组
 */
function listToTreeOptimize(list, <span class="hljs-attr">rootParentId</span> = <span class="hljs-number">0</span>) {
  // 1. 创建Map映射表：存储id→节点对象，实现O(1)快速查找父节点
  const <span class="hljs-attr">nodeMap</span> = new Map()<span class="hljs-comment">;</span>
  // 2. 存储最终转换后的树形结构（仅存放根节点，子节点通过children嵌套）
  const <span class="hljs-attr">tree</span> = []<span class="hljs-comment">;</span>

  // 第一步：遍历列表，构建Map映射，为每个节点初始化空children数组
  list.forEach(<span class="hljs-attr">item</span> =&gt; {
    // 复制原节点，初始化children为空数组，避免修改原始数据
    nodeMap.set(item.id, { ...item, children: <span class="hljs-section">[]</span> })<span class="hljs-comment">;</span>
  })<span class="hljs-comment">;</span>

  // 第二步：再次遍历列表，将每个节点挂载到其对应父节点的children中
  list.forEach(<span class="hljs-attr">item</span> =&gt; {
    const <span class="hljs-attr">currentNode</span> = nodeMap.get(item.id)<span class="hljs-comment">; // 当前节点（从Map中快速获取）</span>
    const <span class="hljs-attr">parentNode</span> = nodeMap.get(item.parentId)<span class="hljs-comment">; // 父节点（O(1)快速查找）</span>

    if (<span class="hljs-attr">item.parentId</span> === rootParentId) {
      // 根节点：直接加入树形结构的根数组
      tree.push(currentNode)<span class="hljs-comment">;</span>
    } else if (parentNode) {
      // 子节点：挂载到其父节点的children数组中（防御父节点不存在的异常）
      parentNode.children.push(currentNode)<span class="hljs-comment">;</span>
    }
  })<span class="hljs-comment">;</span>

  return tree<span class="hljs-comment">;</span>
}
</code></pre>
<h4 data-id="heading-11">2. 核心优化点（高性能原因）</h4>
<p>对比递归法，Map优化法的核心优势是「减少重复遍历」，重点优化了两点：</p>
<ul>
<li>Map映射表的作用：将“每次递归遍历整个列表找父节点”（O(n)耗时），优化为“通过Map.get(parentId)快速查找父节点”（O(1)耗时），彻底解决重复遍历的问题；</li>
<li>两次遍历的意义：第一次遍历仅用于构建Map映射并初始化children数组，第二次遍历仅用于挂载子节点，逻辑清晰，且能完美处理“子节点在父节点之前出现”的异常情况（如列表中id=4的节点在id=2的节点之前）。</li>
</ul>
<h4 data-id="heading-12">3. Map vs 普通对象（实操选择指南）</h4>
<p>开发中，很多人会用普通对象（{}）代替Map构建映射表，两者各有优劣，可根据场景灵活选择，具体对比如下：</p>

























<table><thead><tr><th><strong>对比项</strong></th><th>普通对象（{}）</th><th>ES6 Map</th></tr></thead><tbody><tr><td>键的类型</td><td>仅支持字符串、数字（数字会自动转为字符串）</td><td>支持任意类型（数字、字符串、对象等），更灵活</td></tr><tr><td>查找效率</td><td>普通场景可用，当键的数量过多时，效率会明显下降</td><td>查找、插入、删除效率始终为O(1)，适合频繁操作、大数据量</td></tr><tr><td>安全性</td><td>可能被原型链污染（如键名为__proto__时，会修改对象原型）</td><td>无原型链相关问题，数据存储更安全，生产级开发首选</td></tr></tbody></table>
<h4 data-id="heading-13">4. 性能特点（生产环境适配）</h4>
<ul>
<li>时间复杂度：O(n) —— 仅对扁平列表遍历两次（两次forEach），Map的get、set操作均为O(1)，总耗时与列表长度n成正比，效率最优；</li>
<li>空间复杂度：O(n) —— Map映射表存储n个节点，最终生成的树形结构也包含n个节点，空间开销可控，是“空间换时间”的合理取舍；</li>
<li>适配场景：适合大数据量、深层级的扁平列表（如省市区三级数据、大型后台菜单），无递归栈溢出风险，性能稳定。</li>
</ul>
<h3 data-id="heading-14">四、两种解法对比（开发选型指南）</h3>
<p>开发中无需盲目追求“高性能”，应根据列表数据量、层级深度选择合适的解法，以下对比可直接作为选型参考：</p>


























<table><thead><tr><th><strong>解法</strong></th><th><strong>时间复杂度</strong></th><th><strong>空间复杂度</strong></th><th><strong>适配场景</strong></th><th><strong>开发优势</strong></th></tr></thead><tbody><tr><td>递归法</td><td>O(n²)</td><td>O(n)</td><td>中小型列表（n&lt;1000）、层级浅</td><td>代码简洁、易理解、开发调试快</td></tr><tr><td>Map优化法</td><td>O(n)</td><td>O(n)</td><td>大数据量、深层级列表、生产环境</td><td>性能最优、无栈溢出、安全性高</td></tr></tbody></table>
<h3 data-id="heading-15">5、总结（快速上手指南）</h3>
<p>掌握列表转树的核心，关键是「理解parentId与children的关联关系」，两种解法可按需选择，无需死记硬背：</p>
<ul>
<li>快速开发、数据量小时，选递归法：代码简洁、易上手，调试方便，适合中小型列表；</li>
<li>生产环境、数据量大时，选Map优化法：性能最优、无栈溢出风险，安全性高，适配各类复杂场景；</li>
<li>核心原则：始终遵循「数据不可变性」，避免修改原始列表，同时做好异常数据防御，确保代码健壮性。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[春哥的Agent通关秘籍09：从【句向量】到RAG]]></title>    <link>https://juejin.cn/post/7605041451328061483</link>    <guid>https://juejin.cn/post/7605041451328061483</guid>    <pubDate>2026-02-11T00:20:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605041451328061483" data-draft-id="7604881286038487092" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="春哥的Agent通关秘籍09：从【句向量】到RAG"/> <meta itemprop="keywords" content="前端,后端,JavaScript"/> <meta itemprop="datePublished" content="2026-02-11T00:20:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="摸鱼的春哥"/> <meta itemprop="url" content="https://juejin.cn/user/1714893870865303"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            春哥的Agent通关秘籍09：从【句向量】到RAG
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1714893870865303/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    摸鱼的春哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T00:20:27.000Z" title="Wed Feb 11 2026 00:20:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;font-weight:400;line-height:2;font-size:17px;overflow-x:hidden;color:#000}.markdown-body strong{padding:1px;color:#ee3f4d}.markdown-body em{padding:0 2px;color:#f33b1f}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{position:relative;margin-top:30px;margin-bottom:20px;line-height:1.5;font-weight:700}.markdown-body h1{text-align:center;padding-bottom:5px;font-size:32px;color:#ac1f18}.markdown-body h1:after{content:"";display:block;margin:4px auto 0;width:100px;height:2px;border-bottom:2px solid #f33b1f}.markdown-body h2{font-size:28px;border-bottom:1px solid #f33b1f}.markdown-body h2:before{content:"# "!important;color:#f33b1f}.markdown-body h3{font-size:24px;padding-left:9px;border-left:6px solid #f33b1f}.markdown-body h4{font-size:20px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #bbb;margin:16px 0}.markdown-body code{word-break:break-word;overflow-x:auto;background-color:#f9f1db;color:#ee2746;border-radius:2px;font-size:16px;padding:1px 2px}.markdown-body code,.markdown-body pre{font-family:-apple-system,-apple-system-body,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,PingFang SC,思源黑体 CN,思源黑体,JetBrains Mono,Fira Code,Menlo,Ubuntu Mono,Consolas,sans-serif}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{margin:12px 0!important;border-radius:3px;font-size:15px;padding:16px 12px;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f7f7f7}.markdown-body a{text-decoration:none;color:#1781b5;padding:0 2px;border-bottom:1px solid #1781b5}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #f33b1f;color:#ac1f18}.markdown-body blockquote{color:#3d3d3d;background-color:#fff9f9;padding:6px 16px;margin:16px 0;border-left:3px solid #f07c82}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:6px 0}.markdown-body ol,.markdown-body ul{padding-left:30px}.markdown-body ol li,.markdown-body ul li{margin-bottom:6px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:6px}.markdown-body ol li{padding-left:6px}.markdown-body ::marker{color:#f33b1f}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body .task-list-item input[type=checkbox]{position:relative}.markdown-body .task-list-item input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;background:#fff;border:1px solid #f07c82;border-radius:3px;box-sizing:border-box;z-index:1}.markdown-body .task-list-item input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-5px;left:0;right:0;bottom:0;width:0;height:0;color:#f33b1f;font-size:16px;font-weight:700;z-index:2}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border-spacing:0;border-collapse:collapse}.markdown-body table thead{background:#fff9f9;color:#000;text-align:left;font-size:15px}.markdown-body table tr:nth-child(2n){background-color:#fcfcfc}.markdown-body table tr:hover{background-color:#fff9f9}.markdown-body table td,.markdown-body table th{padding:12px 7px;line-height:24px;border:1px solid #f9f1db}.markdown-body table td{min-width:120px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="monokai">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#272822;color:#ddd}.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-strong,.hljs-tag{color:#f92672}.hljs-code{color:#66d9ef}.hljs-class .hljs-title{color:#fff}.hljs-attribute,.hljs-link,.hljs-regexp,.hljs-symbol{color:#bf79db}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-emphasis,.hljs-section,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-string,.hljs-subst,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:#a6e22e}.hljs-comment,.hljs-deletion,.hljs-meta,.hljs-quote{color:#75715e}.hljs-doctag,.hljs-keyword,.hljs-literal,.hljs-section,.hljs-selector-id,.hljs-selector-tag,.hljs-title,.hljs-type{font-weight:700}</style><h2 data-id="heading-0">春哥的Agent通关秘籍09：从【句向量】到RAG</h2>
<p>本章。我们将梳理RAG的结构设计，以及梳理出如何一步步构建一个RAG系统。</p>
<h3 data-id="heading-1">一、组装现有的武器</h3>
<p>根据前面的学习，我们知道了【句向量】分别可以产生两种效果。</p>
<ul>
<li>向量化：通过固定的评估规则，把一段文本迅速通过上下文生成一个【句向量】</li>
<li>检索：快速通过一个已知的【句向量】，找到临近位置的【句向量】，从而找到这些句向量对应的原文。（这样，就能找到意义相近的原文）</li>
</ul>
<p>所以，我们可以这样规划我们的RAG架构：</p>
<p>训练过程：</p>
<ul>
<li>把企业文档训练成一个巨大的向量空间，存储到一个【向量数据库】内。</li>
</ul>
<p>提问过程：</p>
<ul>
<li>【句向量】大模型，负责把用户的问题转换为一个【句向量】。</li>
<li>通过【向量数据库】，快速检索到附近的若干个意义相近的文本。</li>
<li>组装文本+问题，向【词向量】大模型提问。</li>
<li>返回答案。</li>
</ul>
<h3 data-id="heading-2">二、R -&gt; A -&gt; G</h3>
<p>想象一下，DeepSeek（或者 GPT）是一个超级学霸。 但他有两个致命的死穴：</p>
<ol>
<li>
<p>知识冻结：他虽然博学，但他的记忆停留在他毕业（训练结束）的那一天。你问他“今天晚饭吃什么？”，他不知道。</p>
</li>
<li>
<p>不懂隐私：他从来没去过你们公司，没看过你们的《员工手册》或《财务报表》。你问他“怎么报销？”，他只能瞎编。</p>
</li>
</ol>
<p>但是，现在我们通过【句向量】(Sentence Embedding)的模型，有了通过语义快速找到私有资料的能力，想象空间是不是瞬间不一样了？</p>
<p>假设，用户对着一个Agent问了一句话：</p>
<blockquote>
<p>"我们公司的报销流程是怎么样的？"</p>
</blockquote>
<p>让我们拆解整个流程，把它分成三个部分：</p>
<ol>
<li>
<p>检索：Retrieval。</p>
<ul>
<li>系统把问题扔给 bge-m3（Embedding 模型）。</li>
<li><code>bge-m3</code> 把它变成一个【句向量】。</li>
<li>系统拿着这个向量，去你的向量数据库里“扫一扫”。</li>
<li>结果：瞬间找到了距离最近的文档——《2026年员工差旅管理办法.pdf》。</li>
</ul>
</li>
<li>
<p>增强：Augmented</p>
<ul>
<li>系统悄悄地把原本的问题修改了。 它把找到的文档内容（比如“每日补贴 300 元”），粘贴到了用户的问题前面。</li>
<li>实际用户的问题变成了:"[背景资料]：根据《2026年员工差旅管理办法》，一线城市每日补贴 300 元，二线城市 200 元... [用户问题]：我们公司的出差补贴是多少？"</li>
<li>这一步叫“增强”：因为我们给 AI 提供了它原本不知道的信息。</li>
</ul>
</li>
<li>
<p>生成：Generation</p>
<ul>
<li>DeepSeek 拿到了你附加的【作弊信息】和用户的提问。</li>
<li>DeepSeek基于充分的上下文线索，然后用它那流畅的语言能力，把答案组织出来。</li>
<li>DeepSeek给了你准确的答案。</li>
</ul>
</li>
</ol>
<p><img src="https://pic.zhangshichun.top/pic/20260208183138948.png" alt="" loading="lazy"/></p>
<p>所以，RAG 到底是什么？</p>
<p>RAG = 搜索引擎 + 大语言模型</p>
<ul>
<li>
<p>R (检索)：利用 句向量，充当 AI 的眼睛，帮它看到外部的最新、最私密的知识。</p>
</li>
<li>
<p>G (生成)：利用 Token 向量，充当 AI 的嘴巴，帮它把看到的信息，优雅地讲给你听。</p>
</li>
</ul>
<p>没有 RAG，AI 只是一个记性很好的空想家。 有了 RAG，AI 就变成了一个懂你公司业务的超级秘书。</p>
<h3 data-id="heading-3">三、梳理RAG的架构</h3>
<p>接下来，让我向你介绍一下目前市面上主流的RAG的架构</p>
<p>我们可以把 RAG 分为两个大的阶段，分别是：</p>
<ul>
<li>准备阶段 (离线)</li>
<li>运行阶段 (在线)</li>
</ul>
<p>🟢 准备阶段：把文档变成【句向量】</p>
<ol>
<li>
<p>用户准备私有文档 (Data Source)</p>
<ul>
<li>格式五花八门：PDF, Word, Markdown, Excel 等。</li>
</ul>
</li>
<li>
<p>数据清洗与切片 (Cleaning &amp; Chunking)</p>
<ul>
<li>
<p>这是最关键的一步！</p>
</li>
<li>
<p>为什么要切？ Embedding 模型（句向量）有长度限制（比如 512 个字）。你不能把一本 500 页的书直接变成一个向量，那样信息全丢了。</p>
</li>
<li>
<p>做什么？ 你需要一个切片器，把《员工手册》切成几百个小段落（Chunk）。每一段作为一个独立的单位。</p>
</li>
</ul>
</li>
<li>
<p>句向量模型 (Embedding Model)</p>
<ul>
<li>动作：把上面切好的几百个小段落，一个个变成稠密向量。</li>
</ul>
</li>
<li>
<p>向量数据库 (Vector DB)</p>
<ul>
<li>动作：把这些向量存起来，并建立索引（HNSW 等），方便快速查找。</li>
</ul>
</li>
</ol>
<p>🔵 运行阶段：开始回答用户问题
5. [Agent/调度] 用户提问与编排</p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-deletion">- 用户问：“怎么报销？”</span>

<span class="hljs-deletion">- 调度器首先把这个问题也扔给 【句向量】模型，变成一个【句向量】坐标。</span>
</code></pre>
<p>6. 向量检索 (Vector Search)</p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-deletion">- 去向量数据库里，找出与问题向量距离最近的 Top 50 个片段。</span>

<span class="hljs-deletion">- 注意：这一步叫“粗排”，速度快，但不够准。</span>
</code></pre>
<p>7. 重排序 (Rerank)</p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-deletion">- 这是提升效果的秘密武器！</span>

<span class="hljs-deletion">- 向量检索是基于模糊的几何距离，有时候会找回来一些“似是而非”的东西。</span>

<span class="hljs-deletion">- Rerank 模型：这是一个专门的模型（Cross-Encoder）。它会把这 Top 50 个片段，和用户的问题放在一起，精读一遍，然后打分。</span>

<span class="hljs-deletion">- 它会告诉你：“第 1 个片段相关性 99%，第 40 个片段其实只有 10%。”</span>

<span class="hljs-deletion">- 然后我们只取 Top 3 给大模型。</span>
</code></pre>
<p>8. 提示词组装 (Prompt Engineering)</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-operator">-</span> 你不能只给大模型 <span class="hljs-number">3</span> 个片段<span class="hljs-operator">。</span>你需要把它们包装成话术：

<span class="hljs-operator">-</span> <span class="hljs-string">"你是一个助手。请根据以下参考资料回答用户问题。如果资料里没有，就说不知道。<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span> 参考资料：[片段1]...[片段2]...<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span> 用户问题：怎么报销？"</span>
</code></pre>
<p>9. 【词向量大】模型 （如 DeepSeek）</p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-deletion">- 大模型阅读上面的 Prompt，最后生成答案。</span>
</code></pre>
<p><img src="https://pic.zhangshichun.top/pic/20260207180103640.png" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">四，Rerank 模型是啥？能先不整吗？</h3>
<p>能的，兄弟，能的！</p>
<p>上第七步【重排序 (Rerank)】在学习阶段，以及在文档规模不大的阶段，可以先不做。</p>
<p>等到文档规模达到一定规模后，再增加这个调优阶段即可。</p>
<p>这里简单解释一下，Rerank 是除【词向量】和【句向量】以外，第三种最为主流常见的纯语言大模型。</p>
<p>它存储的不是向量，而是一个评分，它最擅长的领域就是判断一段文本和另一段文本之间是否存在较强因果关系。</p>
<p>这里我们先绕开它，否则一次性接触的工具概念太多容易弄混。</p>
<h3 data-id="heading-5">五，重要限制</h3>
<p>当你训练自己的【句向量】数据时是，使用了一个A版本的【句向量】B模型，如bge-m3模型。</p>
<p>那么，当你拿问题换【句向量】坐标时，也必须用版本完全一样的A版本的B模型来换取【句向量】坐标。</p>
<p>这一点是必须遵守的。</p>
<h3 data-id="heading-6">下一步预告</h3>
<p>下节课，我们将开始正式制作一个 <code>RAG</code> “检索增强生成”系统。</p>
<p>敬请期待！</p>
<p><img src="https://pic.zhangshichun.top/pic/ScreenShot_2026-01-26_082327_821.png" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[KubePi：开源Kubernetes可视化管理面板，让集群管理如此简单]]></title>    <link>https://juejin.cn/post/7604863528945106959</link>    <guid>https://juejin.cn/post/7604863528945106959</guid>    <pubDate>2026-02-11T00:24:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604863528945106959" data-draft-id="7540901989074518051" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="KubePi：开源Kubernetes可视化管理面板，让集群管理如此简单"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-11T00:24:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="YL_jia"/> <meta itemprop="url" content="https://juejin.cn/user/1467226241383211"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            KubePi：开源Kubernetes可视化管理面板，让集群管理如此简单
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1467226241383211/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    YL_jia
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T00:24:30.000Z" title="Wed Feb 11 2026 00:24:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">KubePi：开源Kubernetes可视化管理面板，让集群管理如此简单</h2>
<blockquote>
<p>在云原生时代，Kubernetes已成为容器编排的事实标准，但其复杂性却让许多开发者望而却步。<strong>KubePi</strong>作为一款现代化的开源Kubernetes可视化管理面板，正以其简洁的设计与强大的功能，让集群管理变得前所未有的简单。</p>
</blockquote>
<h3 data-id="heading-1">一、KubePi是什么？为什么你需要它？</h3>
<h4 data-id="heading-2">1.1 诞生背景：简化Kubernetes管理的利器</h4>
<p>Kubernetes虽然强大，但其<strong>命令行操作的复杂性</strong>和<strong>YAML文件的繁琐性</strong>一直是开发者和运维人员的痛点。KubePi由KubeOperator团队开发，旨在通过<strong>图形化界面</strong>简化Kubernetes集群的部署、监控和维护，让即使不具备深厚Kubernetes知识的用户也能轻松管理集群。</p>
<h4 data-id="heading-3">1.2 核心价值：可视化多集群管理</h4>
<p>KubePi允许管理员导入多个Kubernetes集群，并通过精细的权限控制将不同集群（Cluster）和命名空间（Namespace）的管理权限分配给指定用户。这意味着：</p>
<ul>
<li><strong>开发人员</strong>：可以管理集群中运行的应用程序并进行故障排查，而无需深入掌握复杂的Kubernetes命令。</li>
<li><strong>运维人员</strong>：能够在一个统一的界面上监控和管理所有集群资源，大幅提升效率。</li>
<li><strong>企业IT</strong>：实现对跨地域、跨云的Kubernetes集群进行统一管理，提升运维效率。</li>
</ul>
<h3 data-id="heading-4">二、核心功能特点：不止于可视化</h3>
<p>KubePi的魅力远不止提供一个Web界面那么简单，它集成了多种强大功能：</p>
<h4 data-id="heading-5">2.1 多集群统一管理</h4>
<ul>
<li><strong>一键导入</strong>：支持通过Token、KubeConfig和证书三种方式导入现有Kubernetes集群，实现对集群的零侵入。</li>
<li><strong>集中控制</strong>：在单一控制台中管理多个集群的资源，无需在不同环境间切换。</li>
</ul>
<h4 data-id="heading-6">2.2 精细化的权限控制</h4>
<ul>
<li><strong>RBAC集成</strong>：基于角色的访问控制（RBAC），可以将权限精确到集群或命名空间级别。</li>
<li><strong>用户隔离</strong>：确保不同用户或团队只能访问其被授权的资源，保障安全性。</li>
</ul>
<h4 data-id="heading-7">2.3 直观的资源管理</h4>
<ul>
<li><strong>可视化操作</strong>：以表单形式替代复杂的YAML文件，简化Deployment、Service、ConfigMap等资源的创建和管理流程。</li>
<li><strong>实时监控</strong>：内置资源监控功能，实时展示Node、Pod、Service等关键组件的状态和性能指标。</li>
</ul>
<h4 data-id="heading-8">2.4 友好的用户界面</h4>
<ul>
<li><strong>现代化UI</strong>：基于Vue.js和FIT2CLOUD UI组件库构建，提供响应迅速、美观易用的操作体验。</li>
<li><strong>操作审计</strong>：记录用户操作日志，满足企业安全审计需求。</li>
</ul>
<h4 data-id="heading-9">2.5 开箱即用与高扩展性</h4>
<ul>
<li><strong>快速部署</strong>：通过Docker容器即可快速部署，极大降低了运维门槛。</li>
<li><strong>扩展性强</strong>：设计上考虑了可扩展性，允许通过插件或自定义功能来扩展其能力。</li>
</ul>
<h3 data-id="heading-10">三、安装部署：多种方式快速上手</h3>
<p>KubePi提供了灵活的部署方式，适合从个人体验到生产环境的各种场景。</p>
<h4 data-id="heading-11">3.1 Docker快速部署（适合体验和测试）</h4>
<p>对于想要快速体验KubePi的用户，一条命令即可启动：</p>
<pre><code class="hljs language-bash" lang="bash">sudo docker run --privileged -d --restart=unless-stopped -p 80:80 1panel/kubepi
</code></pre>
<p>启动后，在浏览器中访问 <code>http://&lt;你的服务器IP&gt;:80</code>，使用默认用户名 <code>admin</code> 和密码 <code>kubepi</code> 即可登录。</p>
<h4 data-id="heading-12">3.2 Docker持久化部署（推荐用于生产）</h4>
<p>为防止数据丢失，建议生产环境挂载持久化数据卷：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建持久化目录</span>
<span class="hljs-built_in">mkdir</span> -p /opt/kubepi
<span class="hljs-comment"># 安装并挂载卷</span>
sudo docker run --privileged -d -v /opt/kubepi:/var/lib/kubepi --restart=unless-stopped -p 80:80 kubeoperator/kubepi-server
</code></pre>
<h4 data-id="heading-13">3.3 Kubernetes中部署（原生方式）</h4>
<p>如果你希望在一个Kubernetes集群中部署KubePi来管理其他集群，可以使用以下方式：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 基础部署</span>
sudo kubectl apply -f https://raw.githubusercontent.com/KubeOperator/KubePi/master/docs/deploy/kubectl/kubepi.yaml

<span class="hljs-comment"># 持久化部署（需要替换创建pvc时使用的storageClass）</span>
sudo kubectl apply -f https://raw.githubusercontent.com/KubeOperator/KubePi/master/docs/deploy/kubectl/kubepi-pvc.yaml
</code></pre>
<p>部署完成后，可以通过以下命令获取访问地址：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 获取Node IP</span>
<span class="hljs-built_in">export</span> NODE_IP=$(kubectl get nodes -o jsonpath=<span class="hljs-string">"{.items[0].status.addresses[0].address}"</span>)
<span class="hljs-comment"># 获取NodePort</span>
<span class="hljs-built_in">export</span> NODE_PORT=$(kubectl -n kube-system get services kubepi -o jsonpath=<span class="hljs-string">"{.spec.ports[0].nodePort}"</span>)
<span class="hljs-comment"># 获取Address</span>
<span class="hljs-built_in">echo</span> http://<span class="hljs-variable">$NODE_IP</span>:<span class="hljs-variable">$NODE_PORT</span>
</code></pre>
<h4 data-id="heading-14">3.4 在华为云Flexus云服务器X实例上部署（特定环境示例）</h4>
<p>有开发者分享了在<strong>华为云Flexus云服务器X实例</strong>上，基于<strong>openEuler 22.03 LTS</strong>操作系统部署KubePi的实践。这种部署方式表明KubePi在不同的云环境和操作系统上具有良好的适应性。</p>
<h3 data-id="heading-15">四、使用方法：快速上手KubePi</h3>
<h4 data-id="heading-16">4.1 初始登录与集群导入</h4>
<ol>
<li><strong>登录系统</strong>：访问部署好的KubePi地址，使用默认凭证（admin/kubepi）登录。</li>
<li><strong>导入集群</strong>：
<ul>
<li>在管理界面中选择"集群管理"。</li>
<li>点击"导入集群"，提供现有集群的KubeConfig文件或Token。</li>
<li>建议使用具有集群管理权限的KubeConfig文件以确保完整的功能体验。</li>
</ul>
</li>
</ol>
<h4 data-id="heading-17">4.2 用户与权限管理</h4>
<ol>
<li><strong>创建用户</strong>：在"用户管理"中创建新用户，为其设置用户名和密码。</li>
<li><strong>分配权限</strong>：通过"权限管理"功能，将特定集群或命名空间的权限分配给相应用户，实现精细化的访问控制。</li>
</ol>
<h4 data-id="heading-18">4.3 资源管理与监控</h4>
<ol>
<li><strong>查看集群概览</strong>：登录后，在仪表盘上可以直观地查看已导入集群的整体状态、资源使用情况（如CPU、内存使用率）以及最近事件。</li>
<li><strong>管理资源</strong>：通过左侧菜单，可以方便地管理Node、Pod、Service、PV、ConfigMap、Role等Kubernetes资源。</li>
<li><strong>故障排查</strong>：利用集成的Web Kubectl功能或日志查看器，可以直接在界面上进行故障诊断和排查。</li>
</ol>
<h3 data-id="heading-19">五、企业实战案例：KubePi在不同场景的应用</h3>
<h4 data-id="heading-20">5.1 中小企业统一管理平台</h4>
<p><strong>挑战</strong>：中小型企业可能缺乏专业的Kubernetes运维人员，但需要高效管理其容器化应用。
<strong>解决方案</strong>：部署KubePi作为统一的视觉化管理平台，让开发人员和有限的运维人员能够通过直观的界面轻松管理应用部署、监控集群状态，无需深入记忆复杂的Kubernetes命令。</p>
<h4 data-id="heading-21">5.2 教育培训环境</h4>
<p><strong>挑战</strong>：教学机构需要让学生能够快速理解和操作Kubernetes，但原生界面过于复杂。
<strong>解决方案</strong>：在教育环境中使用KubePi，为学生提供一个直观的学习和实践平台，降低学习曲线，让学生更专注于理解Kubernetes的核心概念而非命令行操作。</p>
<h4 data-id="heading-22">5.3 多集群、多团队协作环境</h4>
<p><strong>挑战</strong>：拥有多个Kubernetes集群的企业需要实现统一的权限控制和团队协作，不同团队可能需要访问不同的集群或命名空间。
<strong>解决方案</strong>：利用KubePi的<strong>多集群支持</strong>和<strong>细粒度权限控制</strong>功能，管理员可以在一站式平台上管理所有集群，并安全地将不同集群或命名空间的管理权限分配给相应的团队或用户，既提升了管理效率，又确保了安全性。</p>
<h3 data-id="heading-23">六、KubePi的生态与集成</h3>
<p>KubePi可以与一系列优秀的开源工具集成，形成更强大的云原生管理生态系统：</p>
<ul>
<li><strong>1Panel</strong>：一个现代化、开源的Linux服务器运维管理面板，与KubePi结合可以实现更高效的服务器和集群管理。</li>
<li><strong>JumpServer</strong>：广受欢迎的开源堡垒机，用于管理和监控服务器访问，与KubePi结合可进一步提升集群的安全性和管理效率。</li>
<li><strong>DataEase</strong>：人人可用的开源数据可视化分析工具，可用于Kubernetes集群数据的实时可视化分析。</li>
<li><strong>MeterSphere</strong>：开源持续测试平台，支持Kubernetes环境中应用的自动化测试和持续集成。</li>
</ul>
<h3 data-id="heading-24">七、总结：为什么选择KubePi？</h3>
<p>在Kubernetes可视化管理工具的选择中，KubePi凭借其以下突出优点脱颖而出：</p>
<ol>
<li><strong>简单易用</strong>：直观的界面设计显著降低了学习成本，即使是对Kubernetes不太熟悉的用户也能快速上手操作。</li>
<li><strong>功能全面</strong>：从多集群管理、权限控制到资源监控和故障排查，覆盖了Kubernetes日常管理的核心需求。</li>
<li><strong>部署灵活</strong>：支持Docker快速部署和Kubernetes原生部署，适应各种环境需求。</li>
<li><strong>安全可靠</strong>：提供基于RBAC的精细权限控制和操作审计，满足企业级安全要求。</li>
<li><strong>社区活跃</strong>：作为开源项目，拥有活跃的社区支持，能够持续获得功能更新和技术支持。</li>
</ol>
<p>无论是中小企业、教育机构还是需要管理复杂多集群环境的大型企业，KubePi都提供了一个值得尝试的高效解决方案。通过将复杂的Kubernetes命令和YAML文件转化为直观的可视化操作，它真正实现了让Kubernetes集群管理"<strong>人人可用</strong>"的目标。</p>
<p><strong>项目地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FKubeOperator%2FKubePi" target="_blank" title="https://github.com/KubeOperator/KubePi" ref="nofollow noopener noreferrer">GitHub - KubeOperator/KubePi</a>
<strong>官方文档</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FKubeOperator%2FKubePi%2Fwiki%2F" target="_blank" title="https://github.com/KubeOperator/KubePi/wiki/" ref="nofollow noopener noreferrer">KubePi Wiki</a></p>
<blockquote>
<p>尝试一下KubePi，开启您高效、便捷的Kubernetes管理之旅吧！</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android 多层架构下如何优雅地处理 API 响应与异常]]></title>    <link>https://juejin.cn/post/7605049329778475049</link>    <guid>https://juejin.cn/post/7605049329778475049</guid>    <pubDate>2026-02-11T00:33:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605049329778475049" data-draft-id="7604741630448779298" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android 多层架构下如何优雅地处理 API 响应与异常"/> <meta itemprop="keywords" content="Android,Kotlin,Android Jetpack"/> <meta itemprop="datePublished" content="2026-02-11T00:33:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="bqliang"/> <meta itemprop="url" content="https://juejin.cn/user/941602739853453"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android 多层架构下如何优雅地处理 API 响应与异常
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/941602739853453/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    bqliang
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T00:33:53.000Z" title="Wed Feb 11 2026 00:33:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Android 多层架构下如何优雅地处理 API 响应与异常</h2>
<blockquote>
<p>原文：《<a href="https://link.juejin.cn?target=https%3A%2F%2Fdoveletter.skydoves.me%2Fpreview%2Farticles%2Fsandwich" target="_blank" title="https://doveletter.skydoves.me/preview/articles/sandwich" ref="nofollow noopener noreferrer">Scalable API Response Handling Across Multi Layered Architectures with Sandwich</a>》——<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fskydoves" target="_blank" title="https://github.com/skydoves" ref="nofollow noopener noreferrer">Jaewoong Eum</a></p>
<p>有删改。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b77013d657246e59224a8b9a47170b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnFsaWFuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771374836&amp;x-signature=OXHPyEWOR2GS%2BYLfIDFyOZpBG6E%3D" alt="banner.png" loading="lazy"/></p>
<p>在如今 MVVM 和 MVI 当道的 Android 开发中，多层架构已是标配。数据需要在 Data Source、Repository、Domain (UseCase) 和 ViewModel 之间像接力棒一样层层传递，最终抵达 UI。这种分层设计确实实现了代码解耦，但也带来了一个棘手难题：<strong>当 API 响应（特别是各种异常和错误）需要跨越重重层级时，该如何优雅地处理？</strong></p>
<p>绝大多数开发者的解决方案都很“简单粗暴”：直接用 <code>try-catch</code> 块包裹 API 调用，一旦出错就返回一个默认值（Fallback）。在小项目里，这种做法或许还能凑合，但随着 API 接口数量的膨胀，它的弊端就会越来越明显：结果充满了歧义，到处都是重复的样板代码，下游层级急需的上下文信息也被丢失了。</p>
<p>试想一下，你在 ViewModel 里拿到一个空列表，却根本分不清这到底是“服务端确实没数据”还是“网络请求挂了”；Repository 层无意间“吞掉”了关键的报错细节；而数据源层则是把同样的错误处理代码复制粘贴了几十遍。</p>
<p>本文我们将深入聊一聊在多层架构中处理 Retrofit API 调用时会遇到的这些痛点，剖析为什么传统做法在项目规模扩大后会难以为继。同时，我会向大家介绍 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fskydoves%2Fsandwich" target="_blank" title="https://github.com/skydoves/sandwich" ref="nofollow noopener noreferrer">Sandwich</a> —— 一个类型安全且高度可组合的解决方案，它能帮你把从网络层到 UI 层的响应处理变得异常简单。我们会从最基础的用法讲起，一直到顺序组合、响应合并、全局错误映射这些高级操作，并且结合真实的业务场景，手把手教你如何优雅地解决这些问题。</p>
<h3 data-id="heading-1">Retrofit 配合协程的使用现状</h3>
<p>先来看最常见的场景，现在绝大多数 Android 项目都在用 Retrofit 配合 Kotlin 协程来处理网络通信。一个典型的 Service 接口定义通常长这样：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">PosterService</span> {

  <span class="hljs-meta">@GET(<span class="hljs-string">"DisneyPosters.json"</span>)</span>
  <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fetchPosterList</span><span class="hljs-params">()</span></span>: List&lt;Poster&gt;
}
</code></pre>
<p>接口直接返回了 <code>List&lt;Poster&gt;</code>。Retrofit 贴心地帮我们将 JSON 响应体反序列化，把数据直接喂到嘴边。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1c33942134443eab1dde8e238291bcf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnFsaWFuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771374836&amp;x-signature=OjEU4ybI3cnhA2acQS%2BAqujsqR4%3D" alt="retrofit喂饭.gif" loading="lazy"/></p>
<p>风和日丽、一切顺利、请求成功的时候，这套机制运行得简直完美。但问题在于——它完全没有给你提供一套结构化的方式来处理“失败”的情况。</p>
<p>不出意外的话，那就应该是出意外了，服务器返回了非 2xx 的状态码，Retrofit 会抛出一个 <code>HttpException</code>；网络连接出了问题，又会抛出各种 IO 异常。结果就是，捕获这些异常的脏活累活，全得由调用者自己扛。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd1dec4d8d864c9dbfd32722d2ca5689~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnFsaWFuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771374836&amp;x-signature=%2BHp3agpRYEfCzUcDgSnumAFrzi0%3D" alt="开发者自行处理异常.gif" loading="lazy"/></p>
<p>当我们在 Data Source（数据源）层去调用这个接口时，传统的“标准写法”通常是下面这样：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PosterRemoteDataSource</span>(
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> posterService: PosterService,
) {
  <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fetchPosterList</span><span class="hljs-params">()</span></span>: List&lt;Poster&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">try</span> {
      posterService.fetchPosterList()
    } <span class="hljs-keyword">catch</span> (e: HttpException) {
      emptyList()
    } <span class="hljs-keyword">catch</span> (e: Throwable) {
      emptyList()
    }
  }
}
</code></pre>
<blockquote>
<p>美国的事我不知道，对于国内开发者而言，要处理奇葩后端返回的各种自定义 <code>status_code</code>，痛苦程度不必多言...</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e1a8e4465a942d9aff09b3eea483fc6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnFsaWFuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771374836&amp;x-signature=VuOg6QtLn1ssjjL33Dl2vguSr%2FY%3D" alt="被后端气si.gif" loading="lazy"/></p>
</blockquote>
<p>这里的 Data Source 简单粗暴地捕获了所有可能的异常，并返回一个 <code>emptyList()</code> 作为兜底。这导致了一个尴尬的局面：站在调用者的角度看，这个函数仿佛是“永远成功”的，因为它总是能返回一个 <code>List&lt;Poster&gt;</code>。</p>
<h4 data-id="heading-2">传统处理方式的几大硬伤</h4>
<p>上面的代码看似人畜无害，实际上隐藏了三个随着项目规模扩大而愈发严重的隐患。</p>
<h5 data-id="heading-3">1. 结果充满了歧义</h5>
<p>无论是因为 HTTP 报错还是网络异常（数据包收发失败），数据源都会简单粗暴地返回一个 <code>emptyList()</code>，下游层级（如 Repository 或 ViewModel）拿到一个空列表时，完全一脸懵逼，根本分不清三种截然不同的情况：</p>
<ol>
<li><strong>请求成功了</strong>，服务器确实返回了一个空列表。</li>
<li><strong>请求失败了</strong>，比如报了个 401 未授权错误。</li>
<li><strong>压根没网</strong>，连请求都没发出去。</li>
</ol>
<p>这三种情况最终都是拿到一个空列表，Repository 没法决定是该报错、跳转登录页，还是显示“暂无数据”。响应的上下文（Context）就这样丢失了，一旦在源头丢失，下游逻辑再怎么努力也救不回来。</p>
<p>你可能会想：“那我出错时返回 <code>null</code> 而不是空列表行不行？” 但这只会引入新的歧义：<code>null</code> 到底代表“出错了”还是“没数据”呢？</p>
<p>最后你还是写了一个包装类，但这样写就没问题了吗？你为了解决一个问题，又引入了一套隐式的约定，还得天天记着这个约定。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Resource</span>&lt;<span class="hljs-type">T</span>&gt;(
    <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span>: T? = <span class="hljs-literal">null</span>,
    <span class="hljs-keyword">val</span> message: String? = <span class="hljs-literal">null</span>
) {
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Success</span>&lt;<span class="hljs-type">T</span>&gt;(<span class="hljs-keyword">data</span>: T) : Resource&lt;T&gt;(<span class="hljs-keyword">data</span>)
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Error</span>&lt;<span class="hljs-type">T</span>&gt;(message: String, <span class="hljs-keyword">data</span>: T? = <span class="hljs-literal">null</span>) : Resource&lt;T&gt;(<span class="hljs-keyword">data</span>, message)
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Loading</span>&lt;<span class="hljs-type">T</span>&gt; : <span class="hljs-type">Resource</span>&lt;<span class="hljs-type">T</span>&gt;()
}
</code></pre>
<p>即使这么写，还是得在每个调用 API 的地方进行 <code>try catch</code>。而且 <code>Resource.Error</code> 只包含一个 <code>message: String</code>，原始的 HTTP 状态码（Status Code）、Headers、以及具体的 Exception 类型全都丢了。</p>
<h5 data-id="heading-4">2. 样板代码满天飞</h5>
<p>每一个 API 调用都需要裹上一层 <code>try-catch</code>。如果你有 20 个接口方法，你就得写 20 个几乎一模一样的 <code>try-catch</code> 块。每一个都要捕获 <code>HttpException</code>，捕获 <code>Throwable</code>，然后返回某种默认值。徒增维护成本与出错概率——比如在第 20 个方法里如果不小心忘写了某种异常捕获，程序可能直接就挂了。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRemoteDataSource</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> userService: UserService) {

  <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fetchUser</span><span class="hljs-params">(id: <span class="hljs-type">String</span>)</span></span>: User? {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">try</span> {
      userService.fetchUser(id)
    } <span class="hljs-keyword">catch</span> (e: HttpException) { <span class="hljs-literal">null</span> }
      <span class="hljs-keyword">catch</span> (e: Throwable) { <span class="hljs-literal">null</span> }
  }

  <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fetchFollowers</span><span class="hljs-params">(id: <span class="hljs-type">String</span>)</span></span>: List&lt;User&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">try</span> {
      userService.fetchFollowers(id)
    } <span class="hljs-keyword">catch</span> (e: HttpException) { emptyList() }
      <span class="hljs-keyword">catch</span> (e: Throwable) { emptyList() }
  }

  <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">updateProfile</span><span class="hljs-params">(profile: <span class="hljs-type">Profile</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">try</span> {
      userService.updateProfile(profile)
      <span class="hljs-literal">true</span>
    } <span class="hljs-keyword">catch</span> (e: HttpException) { <span class="hljs-literal">false</span> }
      <span class="hljs-keyword">catch</span> (e: Throwable) { <span class="hljs-literal">false</span> }
  }
  
  ...
}
</code></pre>
<h5 data-id="heading-5">3. 响应处理上下文丢失</h5>
<p>Repository 和 UI 层最终拿到的只是那个“被阉割”后的原始数据类型（<code>List&lt;Poster&gt;</code>, <code>User?</code>, <code>Boolean</code>）。它们完全接触不到 HTTP 状态码、错误响应体或者异常的细节。</p>
<p>如果 ViewModel 需要根据不同的错误类型给用户不同的反馈——比如 401 提示“会话过期”，503 提示“系统维护中”——数据源就必须想方设法把这些信息硬塞进返回值里。</p>
<p>这时通常只有三个选择：要么把异常往上抛（但这违背了我们想在数据源捕获异常的初衷），要么给每个 API 都定义一套复杂的 Sealed Class（会让样板代码更多），要么干脆“装傻”，把这些关键信息全丢了。</p>
<hr/>
<p><strong>你真正需要的，是一个单一的、标准化的类型。</strong> 这个类型应该能完美封装 API 调用的所有结果——不管是成功的数据、错误的细节，还是异常信息——并且能让这些信息在架构的每一层之间自由流动，不丢失任何上下文。</p>
<p>而这，正是 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fskydoves%2Fsandwich" target="_blank" title="https://github.com/skydoves/sandwich" ref="nofollow noopener noreferrer">Sandwich</a> 能给你的。</p>
<h3 data-id="heading-6">初识 Sandwich</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fskydoves%2Fsandwich" target="_blank" title="https://github.com/skydoves/sandwich" ref="nofollow noopener noreferrer">Sandwich</a> 是一个 Kotlin Multiplatform (KMP) 库，它的核心思想就是利用 Sealed Types（密封类型） 为 API 和 I/O 调用构建一套标准化的响应模型。</p>
<p>它提供了一个非常轻量级的 <code>ApiResponse</code> 类型，将“成功”、“错误”和“异常”这三种情况明确地区分为不同的子类型。自带了一套丰富且可组合的扩展函数，让你在架构的各个层级中能干净利落地处理、转换、恢复、校验、过滤以及合并这些响应。</p>
<p>Sandwich 完美支持 Retrofit、Ktor 和 Ktorfit。它不需要使用注解，也不涉及代码生成，不需要引入奇怪的 Gradle 插件，配置简单。</p>
<h4 data-id="heading-7">快速上手 (Setup)</h4>
<p>首先，在你的模块 <code>build.gradle.kts</code> 中添加依赖：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">dependencies {
  <span class="hljs-comment">// 根据你使用的 HTTP 客户端选择对应的模块：</span>
  implementation(<span class="hljs-string">"com.github.skydoves:sandwich-retrofit:<span class="hljs-variable">$version</span>"</span>) <span class="hljs-comment">// for Retrofit</span>
  implementation(<span class="hljs-string">"com.github.skydoves:sandwich-ktor:<span class="hljs-variable">$version</span>"</span>)     <span class="hljs-comment">// for Ktor</span>
  implementation(<span class="hljs-string">"com.github.skydoves:sandwich-ktorfit:<span class="hljs-variable">$version</span>"</span>)  <span class="hljs-comment">// for Ktorfit</span>
}
</code></pre>
<h5 data-id="heading-8">Retrofit 用户</h5>
<p>只需要在构建 Retrofit 实例时，添加一个 <code>ApiResponseCallAdapterFactory</code>：</p>
<pre><code class="hljs language-diff" lang="diff">val retrofit = Retrofit.Builder()
   .baseUrl(BASE_URL)
<span class="hljs-addition">+  .addCallAdapterFactory(ApiResponseCallAdapterFactory.create())</span>
   .addConverterFactory(MoshiConverterFactory.create())
   .build()
</code></pre>
<p>这个 Factory 会自动拦截所有的 Retrofit 调用，并将结果包装成 <code>ApiResponse</code>。它会自动处理成功的响应、HTTP 错误以及网络异常。这意味着你再也不需要手动写 <code>try-catch</code> 块或者自定义拦截器了。</p>
<p>接下来，把你的 Service 接口返回值改成 <code>ApiResponse&lt;T&gt;</code> 即可：</p>
<pre><code class="hljs language-diff" lang="diff">interface PosterService {

  @GET("DisneyPosters.json")
<span class="hljs-deletion">-  suspend fun fetchPosterList(): List&lt;Poster&gt;</span>
<span class="hljs-addition">+  suspend fun fetchPosterList(): ApiResponse&lt;List&lt;Poster&gt;&gt;</span>
}
</code></pre>
<p>就这么简单，所有的结果——无论是成功拿到数据，还是遇到了 HTTP 错误，亦或是网络异常——都被 ApiResponse 这个返回类型统统“拿捏”了。</p>
<h5 data-id="heading-9">Ktor 用户</h5>
<p>直接使用 <code>apiResponseOf</code> 这个扩展函数来包裹任意的 Ktor <code>HttpResponse</code>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> apiResponse = apiResponseOf&lt;List&lt;Poster&gt;&gt; {
  client.<span class="hljs-keyword">get</span>(<span class="hljs-string">"DisneyPosters.json"</span>)
}
</code></pre>
<h5 data-id="heading-10">Ktorfit 用户</h5>
<p>添加 <code>ApiResponseConverterFactory</code> 即可：</p>
<pre><code class="hljs language-diff" lang="diff">val ktorfit = Ktorfit.Builder()
   .baseUrl(BASE_URL)
<span class="hljs-addition">+  .converterFactories(ApiResponseConverterFactory.create())</span>
   .build()
</code></pre>
<h4 data-id="heading-11">深入理解 ApiResponse</h4>
<p><code>ApiResponse</code> 是一个密封接口（Sealed Interface），它通过三个子类型完美覆盖了 API 调用可能出现的所有结果。</p>
<p>简单来说，<code>ApiResponse</code> 主要由以下三个子类组成：</p>
<ul>
<li><code>ApiResponse.Success</code></li>
<li><code>ApiResponse.Failure.Error</code></li>
<li><code>ApiResponse.Failure.Exception</code></li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e23a82ae3574c4db025d8032baa4278~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnFsaWFuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771374836&amp;x-signature=u%2F1TppYxHhQ0lBs3aDhBewdyG0c%3D" alt="img" loading="lazy"/></p>
<h5 data-id="heading-12">1. ApiResponse.Success</h5>
<p><strong>代表请求成功。</strong> 意味着服务器返回了 2xx 范围的状态码，并且响应体（Body）也成功反序列化了。此时可以通过 <code>data</code> 属性直接获取反序列化后的数据对象：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> apiResponse = ApiResponse.Success(<span class="hljs-keyword">data</span> = posterList)
<span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span>: List&lt;Poster&gt; = apiResponse.<span class="hljs-keyword">data</span>
</code></pre>
<p>如果用的是 Retrofit，<code>ApiResponse.Success</code> 还携带了原始的响应元数据比如 <code>statusCode</code> 和 <code>headers</code>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> statusCode: StatusCode = apiResponse.statusCode
<span class="hljs-keyword">val</span> headers: Headers = apiResponse.headers
</code></pre>
<p>当你需要从成功的响应中读取分页 Header、缓存控制指令（Cache Control） 或者 速率限制（Rate Limit）信息时，这些元数据就能派上用场了。</p>
<h5 data-id="heading-13">2. ApiResponse.Failure.Error</h5>
<p><strong>代表 HTTP 错误响应。</strong> 意思是：服务器收到了你的请求，也给你回信了，但状态码不是 2xx。比如常见的 400 Bad Request**、<strong>401 Unauthorized</strong>、<strong>403 Forbidden</strong>、<strong>404 Not Found</strong>、**500 Internal Server Error 等等，所有非 2xx 的 HTTP 错误都在这里。</p>
<p>可以通过 <code>payload</code> 拿到完整的响应体：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> apiResponse = ApiResponse.Failure.Error(payload = errorBody)
<span class="hljs-keyword">val</span> payload = apiResponse.payload
</code></pre>
<ul>
<li>在 Retrofit 中，<code>payload</code> 是原始的 <code>okhttp3.Response</code>，可以读取 Error Body、状态码和 Header。</li>
<li>在 Ktor 中，<code>payload</code> 则是 <code>HttpResponse</code>。</li>
</ul>
<p>无论你用的是什么 HTTP 客户端，完整的错误上下文都被完好地保留了下来。</p>
<h5 data-id="heading-14">3. ApiResponse.Failure.Exception</h5>
<p><strong>代表在收到服务器 HTTP 响应之前发生的客户端异常。</strong></p>
<p><code>Error</code> 意味着网络请求走完了，服务器也回话了（虽然是报错）。<code>Exception</code> 是意味着请求压根就没跑完，甚至可能都没发出去。</p>
<p>常见的原因包括：</p>
<ul>
<li><strong>网络连接失败</strong>（比如开了飞行模式，或者没连 WiFi）</li>
<li><strong>DNS 解析错误</strong>（找不到服务器域名）</li>
<li><strong>连接超时</strong>（服务器没在规定时间内响应）</li>
<li><strong>SSL/TLS 握手失败</strong>（证书有问题）</li>
<li><strong>JSON 解析错误</strong>（响应体格式不对，解析崩了）</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> apiResponse = ApiResponse.Failure.Exception(throwable = exception)
<span class="hljs-keyword">val</span> throwable: Throwable = apiResponse.throwable
<span class="hljs-keyword">val</span> message: String? = apiResponse.message
</code></pre>
<hr/>
<p>如果服务器返回 401（<code>Failure.Error</code>），你应该提示用户“请重新登录”；如果是因为没网导致请求失败（<code>Failure.Exception</code>），你应该提示“请检查网络连接”。</p>
<h3 data-id="heading-15">优雅地处理 ApiResponse</h3>
<p>既然 <code>ApiResponse</code> 已经把所有可能的请求结果都包装起来了，接下来的问题是：怎么处理它们才最优雅？</p>
<p>类似 Kotlin 的 Result 类，Sandwich 提供了一套丝滑的链式扩展函数，可以针对不同的响应类型，挂载对应的 Lambda 代码块：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> response = posterService.fetchPosterList()
response.onSuccess {
  <span class="hljs-comment">// 这里的 this 是：ApiResponse.Success&lt;List&lt;Poster&gt;&gt;</span>
  <span class="hljs-comment">// 直接拿 `data` 就能用</span>
  <span class="hljs-keyword">val</span> posters: List&lt;Poster&gt; = <span class="hljs-keyword">data</span>
}.onError {
  <span class="hljs-comment">// 这里的 this 是：ApiResponse.Failure.Error</span>
  <span class="hljs-comment">// 可以直接访问 `payload`, `message()`, `statusCode` 等</span>
  <span class="hljs-keyword">val</span> message = message()
}.onException {
  <span class="hljs-comment">// 这里的 this 是：ApiResponse.Failure.Exception</span>
  <span class="hljs-comment">// 可以直接访问 `throwable`, `message` 等</span>
  <span class="hljs-keyword">val</span> cause = throwable
}
</code></pre>
<p>当然，如果你的业务逻辑不需要分得那么细，不在乎到底是服务器报错还是断网了，可以用  <code>onFailure</code> 把 <code>Error</code> 和 <code>Exception</code> 这两种失败情况“一把抓”：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">response.onSuccess {
  _posters.value = <span class="hljs-keyword">data</span>
}.onFailure {
  <span class="hljs-comment">// 这里的 this 是：ApiResponse.Failure</span>
  <span class="hljs-comment">// 同时也处理了 Error 和 Exception</span>
  _error.value = message()
}
</code></pre>
<h4 data-id="heading-16">使用 <code>when</code> 表达式进行穷尽式匹配</h4>
<p>除了链式调用的“组合拳”，也可以回归朴素，利用 Kotlin 的 <code>when</code> 表达式来进行穷尽式匹配，毕竟 ApiResponse 是密封接口，编译器会帮你把关，它会强制要求你必须处理掉 <code>ApiResponse</code> 的每一种子类型。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">when</span> (response) {
  <span class="hljs-keyword">is</span> ApiResponse.Success -&gt; {
    <span class="hljs-keyword">val</span> posters = response.<span class="hljs-keyword">data</span>
  }
  <span class="hljs-keyword">is</span> ApiResponse.Failure.Error -&gt; {
    <span class="hljs-keyword">val</span> message = response.message()
  }
  <span class="hljs-keyword">is</span> ApiResponse.Failure.Exception -&gt; {
    <span class="hljs-keyword">val</span> throwable = response.throwable
  }
}
</code></pre>
<h3 data-id="heading-17">基于 ApiResponse 的多层架构实践</h3>
<p>引入 <code>ApiResponse</code> 后，整个架构逻辑会发生质的改变。</p>
<p>首先，Data Source（数据源层）变得异常简单，再也不需要写那些繁琐的 <code>try-catch</code> 块，不需要考虑返回什么兜底默认值，甚至不需要任何错误处理逻辑：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PosterRemoteDataSource</span>(
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> posterService: PosterService,
) {
  <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fetchPosterList</span><span class="hljs-params">()</span></span>: ApiResponse&lt;List&lt;Poster&gt;&gt; {
    <span class="hljs-keyword">return</span> posterService.fetchPosterList()
  }
}
</code></pre>
<p>现在的 Data Source 变成了一个纯粹的“透传者”（Pass-through）。所有的错误上下文都被原封不动地保存在了 <code>ApiResponse</code> 里。</p>
<p>接下来是 Repository（仓库层）。它可以在保持 <code>ApiResponse</code> 包装完整性的同时，插入业务逻辑。比如，拦截成功的请求进行缓存：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PosterRepository</span>(
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> remoteDataSource: PosterRemoteDataSource,
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> posterDao: PosterDao,
) {
  <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fetchPosterList</span><span class="hljs-params">()</span></span>: ApiResponse&lt;List&lt;Poster&gt;&gt; {
    <span class="hljs-keyword">val</span> response = remoteDataSource.fetchPosterList()
    response.onSuccess {
      posterDao.insertPosterList(<span class="hljs-keyword">data</span>) <span class="hljs-comment">// 缓存成功的数据</span>
    }
    <span class="hljs-keyword">return</span> response
  }
}
</code></pre>
<p>最后到达 ViewModel。由于拿到了完整的上下文，ViewModel 可以针对每一种场景做出精准的 UI 决策：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PosterViewModel</span>(
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> repository: PosterRepository,
) : ViewModel() {

  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fetchPosters</span><span class="hljs-params">()</span></span> {
    viewModelScope.launch {
      <span class="hljs-keyword">val</span> response = repository.fetchPosterList()
      response.onSuccess {
        _posters.value = <span class="hljs-keyword">data</span>
      }.onError {
        <span class="hljs-comment">// 服务器返回了错误（如 400, 500）；展示对应的错误提示</span>
        _error.value = message()
      }.onException {
        <span class="hljs-comment">// 网络不通或客户端异常；建议用户检查网络连接</span>
        _error.value = <span class="hljs-string">"Please check your internet connection."</span>
      }
    }
  }
}
</code></pre>
<p>这就实现了我们梦寐以求的效果：响应对象携带了完整的上下文信息，穿透了架构的每一层。</p>
<p>ViewModel 可以轻松区分“数据为空”（成功的空列表）、“服务器错误”（401, 500 等）以及“网络故障”（没网、超时）。Data Source 在传递过程中没有丢失任何信息，每一层都在各司其职（比如 Repository 做缓存），而且不会剥离掉其他层（比如 UI 层）所需要的关键信息。</p>
<h3 data-id="heading-18">直接提取数据</h3>
<p>有时候，你可能只是想简单直接地把数据从响应里拿出来：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 如果请求成功则返回数据，否则返回 null</span>
<span class="hljs-keyword">val</span> posters: List&lt;Poster&gt;? = response.getOrNull()

<span class="hljs-comment">// 如果请求成功则返回数据，否则返回一个默认值</span>
<span class="hljs-keyword">val</span> posters: List&lt;Poster&gt; = response.getOrElse(emptyList())

<span class="hljs-comment">// 如果请求成功则返回数据，否则直接抛出异常</span>
<span class="hljs-keyword">val</span> posters: List&lt;Poster&gt; = response.getOrThrow()
</code></pre>
<p>此外，<code>getOrElse</code> 也支持 Lambda 写法实现惰性求值：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> posters: List&lt;Poster&gt; = response.getOrElse {
  posterDao.getCachedPosters() <span class="hljs-comment">// 只有在请求失败时，这行代码才会执行</span>
}
</code></pre>
<h3 data-id="heading-19">ApiResponse 与协程、Flow 的完美结合</h3>
<p>对于那些重度依赖 Kotlin Flow 的响应式架构，Sandwich 贴心地提供了一套挂起（Suspend）版本的扩展函数。</p>
<p>调用一个挂起函数发起网络请求，成功了就再调用另一个挂起函数保存到数据库，这种场景太常见了，但标准的 <code>onSuccess</code>、<code>onError</code> 和 <code>onException</code> 接收的都是普通 Lambda，不能在这些 Lambda 内直接调用挂起函数，我们可以使用 <code>suspendOnSuccess</code>、<code>suspendOnError</code> 和 <code>suspendOnException</code>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fetchPosterList</span><span class="hljs-params">()</span></span> = flow {
  <span class="hljs-keyword">val</span> response = posterService.fetchPosterList()
  response.suspendOnSuccess {
    posterDao.insertPosterList(<span class="hljs-keyword">data</span>) <span class="hljs-comment">// 挂起函数：保存到数据库</span>
    emit(<span class="hljs-keyword">data</span>)                       <span class="hljs-comment">// 挂起函数：发射数据到 Flow</span>
  }.suspendOnError {
    <span class="hljs-keyword">val</span> cached = posterDao.getCachedPosterList() <span class="hljs-comment">// 挂起函数：读取缓存兜底</span>
    emit(cached)
  }.suspendOnException {
    emit(emptyList())
  }
}.flowOn(Dispatchers.IO)
</code></pre>
<p>每个处理程序的作用域都是一个挂起 Lambda，可以直接在里面进行数据库插入、额外的 API 调用、文件 I/O 等任何耗时操作，不需要再手动嵌套一层 <code>launch</code> 或 <code>withContext</code>。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">suspend</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> ApiResponse<span class="hljs-type">&lt;T&gt;</span>.<span class="hljs-title">suspendOnSuccess</span><span class="hljs-params">(
  <span class="hljs-comment">// 注意这里的函数参数是 suspend</span>
  <span class="hljs-keyword">crossinline</span> onResult: <span class="hljs-type">suspend</span> <span class="hljs-type">ApiResponse</span>.<span class="hljs-type">Success</span>&lt;<span class="hljs-type">T</span>&gt;.() -&gt; <span class="hljs-type">Unit</span>,
)</span></span>: ApiResponse&lt;T&gt; {
  ...
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> <span class="hljs-keyword">is</span> ApiResponse.Success) {
    onResult(<span class="hljs-keyword">this</span>)
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>
}
</code></pre>
<h4 data-id="heading-20">直接转换为 Flow</h4>
<p>如果你只想要成功的数据流，想把失败处理当作一种“副作用”（Side Effect）来处理（比如记个日志、弹个 Toast），可使用 <code>toFlow()</code> 扩展：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> flow: Flow&lt;List&lt;Poster&gt;&gt; = posterService.fetchPosterList()
  .onError {
    logger.error(<span class="hljs-string">"API error: <span class="hljs-subst">${message()}</span>"</span>)
  }.onException {
    logger.error(<span class="hljs-string">"Network error: <span class="hljs-variable">$message</span>"</span>)
  }.toFlow()
</code></pre>
<p><code>toFlow()</code> 会创建一个只发射成功数据的 <code>Flow</code>。如果请求失败了，这个 Flow 就什么都不发射（返回 <code>emptyFlow()</code>）。当你只希望成功的数据流入状态管理（State），而失败仅仅需要打个日志时，用它就对了。</p>
<p><strong>进阶玩法：</strong> 你甚至可以在转换过程中直接对数据进行“加工”。这是 Repository 层最经典的写法——先缓存，再读取：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> flow = posterService.fetchPosterList()
  .toFlow { posters -&gt;
    posters.forEach { it.page = page }
    posterDao.insertPosterList(posters) <span class="hljs-comment">// 先存库</span>
    posterDao.getAllPosterList(page)    <span class="hljs-comment">// 再返回从数据库读取的数据</span>
  }.flowOn(Dispatchers.IO)
</code></pre>
<p>在这个 Lambda 里，你拿到的是成功的数据，返回的是转换后的结果。所有的数据库操作都运行在 Flow 的协程上下文中。</p>
<h3 data-id="heading-21">响应的映射与转换</h3>
<p>在现实世界的开发中，后端 API 返回的数据格式，往往跟 UI 层需要展示的格式是不一致的。</p>
<p>比如，服务器可能返回一个庞大的 <code>UserAuthResponse</code>，里面包含了各种 Token、元数据（Metadata）等一大坨东西；但你的 ViewModel 可能只需要一个清爽的 <code>LoginInfo</code>，里面只包含用户对象和 Token 字符串。Sandwich 提供了一系列映射扩展（Mapping Extensions），能让开发者在 <code>ApiResponse</code> 内部直接对数据进行“整容”，同时既不会打断链式调用，也不会弄丢原本的错误上下文。</p>
<h4 data-id="heading-22">mapSuccess</h4>
<p>这个函数专门用来转换<strong>成功</strong>的数据，把类型 <code>T</code> 变成类型 <code>V</code>。如果原本的响应是失败的（Failure），那它就什么都不做，直接原样透传：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> response: ApiResponse&lt;LoginInfo&gt; = authService.requestToken(
  UserRequest(authProvider = provider, authIdentifier = id, email = email),
).mapSuccess {
  <span class="hljs-comment">// 这里的 this 就是原本的 UserAuthResponse</span>
  LoginInfo(user = user, token = token)
}
</code></pre>
<p>这在 Repository 层简直是神器，尤其是当需要把 API 实体模型（DTO）转换成 业务模型（Domain Models）的时候。</p>
<p>Service 层返回的是 <code>ApiResponse&lt;UserAuthResponse&gt;</code>，经过转换后，Repository 层暴露给 ViewModel 的就是干净的 <code>ApiResponse&lt;LoginInfo&gt;</code>。所有的转换逻辑都收拢在了一处，完全不用担心会影响到那些失败的响应。</p>
<p>还有一个常见的用法：从一个列表响应中提取出某一项：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> response: ApiResponse&lt;Poster?&gt; = posterService.fetchPosterList()
  .mapSuccess { firstOrNull() } <span class="hljs-comment">// 直接取第一个，取不到就返回 null</span>
</code></pre>
<h4 data-id="heading-23">mapFailure</h4>
<p>顾名思义，它是用来转换失败的数据载荷（<code>payload</code> / <code>throwable</code>）：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> ApiResponse<span class="hljs-type">&lt;T&gt;</span>.<span class="hljs-title">mapFailure</span><span class="hljs-params">(transformer: <span class="hljs-type">Any</span>?.() -&gt; <span class="hljs-type">Any</span>?)</span></span>: ApiResponse&lt;T&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> <span class="hljs-keyword">is</span> ApiResponse.Failure.Error) {
    <span class="hljs-keyword">return</span> ApiResponse.Failure.Error(payload = transformer.invoke(payload))
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> <span class="hljs-keyword">is</span> ApiResponse.Failure.Exception) {
    <span class="hljs-keyword">return</span> ApiResponse.exception(ex = (transformer.invoke(throwable) <span class="hljs-keyword">as</span>? Throwable) ?: throwable)
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>
}
</code></pre>
<h4 data-id="heading-24">flatMap</h4>
<p>它能把一个 <code>ApiResponse</code> 转换成一个完全不同的 <code>ApiResponse</code>。</p>
<p>跟只转换 data 数据的 <code>mapSuccess</code> 不同，<code>flatMap</code> 让你能拿到整个响应对象，并且允许你返回任意类型的 <code>ApiResponse</code>。这在处理自定义错误类型时威力巨大——你可以把服务器返回的错误 Body 解析出来，直接映射成你自定义的错误类型：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> response = service.fetchMovieList()
  .flatMap {
    <span class="hljs-comment">// 如果是 Error，尝试解析错误体</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> <span class="hljs-keyword">is</span> ApiResponse.Failure.Error) {
      <span class="hljs-keyword">val</span> errorBody = (payload <span class="hljs-keyword">as</span>? Response)?.body?.string()
      <span class="hljs-keyword">if</span> (errorBody != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">val</span> error: ErrorMessage = Json.decodeFromString(errorBody)
        <span class="hljs-comment">// 根据错误码返回自定义的错误类型(继承自 ApiResponse.Failure.Error)</span>
        <span class="hljs-keyword">when</span> (error.code) {
          <span class="hljs-number">10000</span> -&gt; LimitedRequest 
          <span class="hljs-number">10001</span> -&gt; WrongArgument
          <span class="hljs-keyword">else</span> -&gt; <span class="hljs-keyword">this</span>
        }
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">this</span>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">this</span>
  }
</code></pre>
<p>经过这个 <code>flatMap</code> 处理后，响应要么是原本成功的 <code>ApiResponse.Success</code>（保持不变），要么就是你自定义的错误类型（比如 <code>LimitedRequest</code> 或 <code>WrongArgument</code>）。</p>
<p>这样一来，下游层级（比如 ViewModel）就可以直接对这些自定义类型进行模式匹配（Pattern Match），不用重复去解析 JSON 错误体了：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">response.onError {
  <span class="hljs-keyword">when</span> (<span class="hljs-keyword">this</span>) {
    LimitedRequest -&gt; showRateLimitDialog() <span class="hljs-comment">// 限流错误，弹窗提示</span>
    WrongArgument -&gt; showValidationError()  <span class="hljs-comment">// 参数错误，提示校验失败</span>
    <span class="hljs-keyword">else</span> -&gt; showGenericError()              <span class="hljs-comment">// 其他错误，兜底处理</span>
  }
}
</code></pre>
<h3 data-id="heading-25">串行依赖请求的处理</h3>
<p>现实世界的开发里，经常会遇到这种“串行”的工作流：后一个 API 调用必须依赖前一个调用的结果。</p>
<p>例如：你需要先去获取一个认证 Token，拿到 Token 后再去拉取用户详情，最后根据用户的名字去查询海报列表。在这个链条中，只要有任何一环掉链子，整个流程就应该立即停止，并抛出那个步骤的错误。</p>
<p>Sandwich 专门为此提供了 <code>then</code> 和 <code>suspendThen</code> 这两个中缀函数（Infix Functions），完美解决了这个问题：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> response = service.getUserToken(userId) suspendThen { tokenResponse -&gt;
  <span class="hljs-comment">// 第一步成功了，拿到 token 继续查用户详情</span>
  service.getUserDetails(tokenResponse.token)
} suspendThen { userResponse -&gt;
  <span class="hljs-comment">// 第二步也成功了，拿到用户名继续查海报</span>
  service.queryPosters(userResponse.user.name)
}

response.onSuccess {
  <span class="hljs-comment">// 只有三步全通了，这里才会执行</span>
  _posters.value = <span class="hljs-keyword">data</span>
}.onFailure {
  <span class="hljs-comment">// 任何一步挂了，错误都会传到这里</span>
  _error.value = message()
}
</code></pre>
<p>逻辑非常清晰：如果 <code>getUserToken</code> 失败了，后面的 <code>getUserDetails</code> 和 <code>queryPosters</code> 压根就不会执行。</p>
<p>任意一步的失败都会直接“穿透”到最后的 <code>onFailure</code> 处理函数。</p>
<p>你甚至可以把 <code>suspendThen</code> 和 <code>mapSuccess</code> 结合起来，打一套“组合拳”，直接把最终结果转换成 UI 需要的数据：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">service.getUserToken(userId) suspendThen { tokenResponse -&gt;
  service.getUserDetails(tokenResponse.token)
} suspendThen { userResponse -&gt;
  service.queryPosters(userResponse.user.name)
}.mapSuccess { posterResponse -&gt;
  <span class="hljs-comment">// 只取海报列表</span>
  posterResponse.posters
}.onSuccess {
  posterStateFlow.value = <span class="hljs-keyword">data</span>
}.onFailure {
  Log.e(<span class="hljs-string">"API"</span>, message())
}
</code></pre>
<h3 data-id="heading-26">错误恢复与兜底策略</h3>
<p>网络请求这东西，总有翻车的时候。服务器宕机、手机断网、API 莫名其妙报错，这些都是家常便饭。Sandwich 提供了一套强大的恢复扩展（Recovery Extensions），让你能优雅地定义“兜底”行为，同时还能保持响应链的完整性。</p>
<h4 data-id="heading-27">recover</h4>
<p>这个操作符的作用是：如果响应失败了，它会返回一个包含兜底值的 <code>ApiResponse.Success</code>；如果响应本来就是成功的，那就原样透传，啥也不改：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> response : ApiResponse = posterService.fetchPosterList()
  .recover(emptyList())
</code></pre>
<p>源码很简单：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> ApiResponse<span class="hljs-type">&lt;T&gt;</span>.<span class="hljs-title">recover</span><span class="hljs-params">(fallback: <span class="hljs-type">T</span>)</span></span>: ApiResponse&lt;T&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> <span class="hljs-keyword">is</span> ApiResponse.Failure) {
    <span class="hljs-keyword">return</span> ApiResponse.Success(<span class="hljs-keyword">data</span> = fallback)
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>
}
</code></pre>
<p>可以把 <code>recover</code> 和其他扩展函数串起来用：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> response = posterService.fetchPosterList()
  .onError { logger.error(<span class="hljs-string">"API error: <span class="hljs-subst">${message()}</span>"</span>) }
  .onException { crashReporter.record(throwable) }
  .recover(emptyList())
</code></pre>
<p>想要惰性求值，可以用 Lambda 版本的写法：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> response = posterService.fetchPosterList()
  .recover { posterDao.getCachedPosterList() }
</code></pre>
<h4 data-id="heading-28">recoverWith</h4>
<p>这个操作符用于通过执行另一个本身也返回 <code>ApiResponse</code> 的操作来进行恢复。这在你的兜底逻辑不仅仅是一个静态值，而是另一个 API 调用或者数据库查询（且它们自己也可能失败）时非常有用：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> response = primaryService.fetchPosterList()
<span class="hljs-comment">// 或 .suspendRecoverWith { failure -&gt;</span>
  .recoverWith { failure -&gt;
    <span class="hljs-comment">// 尝试调用备份服务；注意这个备份服务返回的也是 ApiResponse</span>
    backupService.fetchPosterList()
  }
</code></pre>
<p>逻辑很顺：主服务挂了，就调备份服务。如果连备份服务也挂了，那这个失败就是最终结果。</p>
<p>如果要调用挂起函数，记得用 <code>suspendRecoverWith</code>。</p>
<h3 data-id="heading-29">数据校验</h3>
<p>有时候，一个 HTTP 200 OK 的响应并不代表一切都好。服务器虽然返回了成功状态码，但数据本身可能是不合法的、空的，或者是缺胳膊少腿的。Sandwich 提供了一套校验扩展（Validation Extensions），能帮你把这些不符合业务要求的“伪成功”响应，强制转换成失败（Failure）。</p>
<h4 data-id="heading-30">validate</h4>
<p>你可以通过它定义一个判断条件（Predicate）。如果数据没通过这个校验（即返回 <code>false</code>），原本成功的响应就会立马“变身”成一个 <code>ApiResponse.Failure.Error</code>，并带上你指定的错误信息：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> response = posterService.fetchPosterList()
  .validate(
    predicate = { it.isNotEmpty() }, <span class="hljs-comment">// 列表必须不为空</span>
    errorMessage = { <span class="hljs-string">"Poster list cannot be empty"</span> }, <span class="hljs-comment">// 否则报错</span>
  )
</code></pre>
<p>这样一来，如果列表是空的，下游的处理逻辑就会收到一个 <code>Failure.Error</code>，尽管从 HTTP 协议层面上看请求是成功的。对于那些服务端逻辑出错却只给你扔个空数组、而不返回标准错误码的 API 来说，这简直是救星。</p>
<h4 data-id="heading-31">requireNotNull</h4>
<p>这个函数用于强制要求成功数据里的某个字段必须<strong>非空（Non-null）</strong>。如果你选中的那个字段是 <code>null</code>，整个响应就会被转换成失败：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> response = userService.fetchUser()
  .requireNotNull(
    selector = { it.profileImage },   <span class="hljs-comment">// 选择要校验的字段</span>
    errorMessage = { <span class="hljs-string">"Profile image is required"</span> },
  )
</code></pre>
<p>这里有个巧妙的设计：这个操作不仅做了校验，还顺手把数据给<strong>提取</strong>出来了。它直接将 <code>ApiResponse&lt;User&gt;</code> 转换成了 <code>ApiResponse&lt;String&gt;</code>（也就是 profileImage 的类型），一步完成了“提取数据”和“非空校验”这两个动作。</p>
<p>当然，如果你的校验逻辑比较复杂，比如需要查数据库或者调别的服务验证，那就用挂起版本的 <code>suspendValidate</code>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> response = userService.fetchUser()
  .suspendValidate { user -&gt;
    userValidator.isValid(user) <span class="hljs-comment">// 这里可以放心地调用挂起函数</span>
  }
</code></pre>
<h3 data-id="heading-32">过滤列表响应</h3>
<p>针对那些返回列表数据的 API，Sandwich 提供了非常顺手的过滤扩展（Filtering Extensions）。你可以像操作普通集合一样，通过一个判断条件（Predicate）直接把不符合要求的数据从成功响应里剔除掉：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> response = posterService.fetchPosterList()
  .filter { poster -&gt; poster.isActive } <span class="hljs-comment">// 只保留活跃的海报</span>
</code></pre>
<p>这样返回的 <code>ApiResponse&lt;List&lt;Poster&gt;&gt;</code> 里就干干净净，只剩下“活跃”的海报了，而且不需要我们手动拆箱修改再装箱。如果原本的请求就是失败的，过滤器完全不会生效，错误信息会原样<strong>透传</strong>下去，不会被误伤。</p>
<p>反向操作当然也是支持的，用 <code>filterNot</code> 即可：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> response = posterService.fetchPosterList()
  .filterNot { poster -&gt; poster.isDeprecated } <span class="hljs-comment">// 剔除已废弃的海报</span>
</code></pre>
<p>当后端接口很“高冷”，不支持通过查询参数来筛选数据，逼着你只能在客户端侧（Client Side）自己动手时，这招特别好使。</p>
<p>可以把它和其他扩展函数串起来，打造一条无懈可击的数据处理流水线（Pipeline）：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> response = posterService.fetchPosterList()
  .validate(predicate = { it.isNotEmpty() }) { <span class="hljs-string">"No posters found"</span> } <span class="hljs-comment">// 1. 先校验列表非空</span>
  .filter { it.isActive }                                       <span class="hljs-comment">// 2. 再过滤出活跃项</span>
  .mapSuccess { sortedByDescending { it.createdAt } }           <span class="hljs-comment">// 3. 接着按时间倒序排列</span>
  .recover(emptyList())                                         <span class="hljs-comment">// 4. 万一哪里崩了，兜底返回空列表</span>
</code></pre>
<p>这段代码逻辑极其顺畅：校验 -&gt; 过滤 -&gt; 排序（映射） -&gt; 兜底。每一步操作的都是 <code>ApiResponse&lt;List&lt;Poster&gt;&gt;</code>，组合干净，读起来舒服，维护起来也轻松。</p>
<h3 data-id="heading-33">合并多个响应</h3>
<p>在实际开发中，我们经常遇到一个屏幕需要同时加载多个接口数据的情况。比如一个 App 的首页，可能既要拉取用户的个人资料，又要加载推荐的海报列表；或者一个仪表盘页面，需要同时显示设置、通知和活动数据。Sandwich 提供了非常实用的 <code>zip</code> 扩展，能帮你把多个独立的 <code>ApiResponse</code> 实例，像拉链一样合并成一个单一的响应对象。</p>
<h4 data-id="heading-34">zip</h4>
<p>它的作用是合并两个 <code>ApiResponse</code> 实例。逻辑非常清晰：只有当两个请求都成功时，转换函数才会执行；只要其中任何一个失败了，就会直接返回那个失败的结果：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> usersResponse = userService.fetchUsers()
<span class="hljs-keyword">val</span> postersResponse = posterService.fetchPosters()

<span class="hljs-comment">// 将两个响应合并成一个 HomeScreenData</span>
<span class="hljs-keyword">val</span> combined = usersResponse.zip(postersResponse) { users, posters -&gt;
  HomeScreenData(users = users, posters = posters)
}

combined.onSuccess {
  <span class="hljs-comment">// 只有两个都成功，才会走到这里</span>
  _homeData.value = <span class="hljs-keyword">data</span>
}.onFailure {
  <span class="hljs-comment">// 只要有一个挂了，错误就会透传到这里</span>
  _error.value = message()
}
</code></pre>
<p>这比你写两层嵌套的 <code>onSuccess</code> 回调，或者用 <code>async</code>/<code>await</code> 后再手动去检查每一个 Deferred 的异常要优雅太多了。</p>
<p>当然，如果你不需要转换成特定的数据对象（比如 <code>HomeScreenData</code>），只是想简单地把它们凑成一对，也可以直接用无参数的 <code>zip</code>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> paired = usersResponse.zip(postersResponse)
<span class="hljs-comment">// 返回类型是：ApiResponse&lt;Pair&lt;List&lt;User&gt;, List&lt;Poster&gt;&gt;&gt;</span>
</code></pre>
<h3 data-id="heading-35">合并分页响应</h3>
<p>当你需要一次性拉取同一个接口的多页数据，并把结果拼成一个完整的列表时，可以使用 <code>merge</code> 扩展。</p>
<p>下面这个例子同时拉取了第 0、1、2 页的数据：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> response = posterService.fetchPosterList(page = <span class="hljs-number">0</span>).merge(
  posterService.fetchPosterList(page = <span class="hljs-number">1</span>),
  posterService.fetchPosterList(page = <span class="hljs-number">2</span>),
  mergePolicy = ApiResponseMergePolicy.PREFERRED_FAILURE,
)

response.onSuccess {
  <span class="hljs-comment">// `data` 包含了三页数据的总和</span>
  _posters.value = <span class="hljs-keyword">data</span>
}.onError {
  <span class="hljs-comment">// 只要有一页出错了，就会走到这里</span>
  _error.value = message()
}
</code></pre>
<p>这里有个关键参数 <code>mergePolicy</code>，它决定了失败时的处理策略。</p>
<ul>
<li><strong><code>PREFERRED_FAILURE</code>（默认推荐）</strong>：严谨模式。只要这几页请求里有一个失败了，整体结果就是失败。</li>
<li><strong><code>IGNORE_FAILURE</code></strong>：宽容模式。它会收集那些成功的页面数据，自动忽略失败的请求。</li>
</ul>
<h3 data-id="heading-36">使用 Peek “窥视”响应</h3>
<p><code>Peek</code> 系列扩展函数允许你在<strong>不修改响应内容</strong>的前提下，对响应进行观测。这是处理副作用（Side Effects）的最佳场所——比如打日志、埋点统计、写入缓存或者上报 Crash。这些操作应该伴随着响应发生，但绝不应该改变响应本身：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> response = posterService.fetchPosterList()
  .peekSuccess { posters -&gt;
    analytics.trackPostersLoaded(posters.size) <span class="hljs-comment">// 埋点</span>
    logger.info(<span class="hljs-string">"Loaded <span class="hljs-subst">${posters.size}</span> posters"</span>)
  }
  .peekError { error -&gt;
    errorTracker.trackApiError(error.statusCode) <span class="hljs-comment">// 错误追踪</span>
    logger.warn(<span class="hljs-string">"API error: <span class="hljs-subst">${error.message()}</span>"</span>)
  }
  .peekException { exception -&gt;
    crashReporter.recordException(exception.throwable) <span class="hljs-comment">// 异常上报</span>
    logger.error(<span class="hljs-string">"Network exception: <span class="hljs-subst">${exception.message}</span>"</span>)
  }
</code></pre>
<p>每一个 <code>peek</code> 函数都会原封不动地返回原始的 <code>ApiResponse</code>。你可以把它们随意穿插在其他扩展函数的前后：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> response = posterService.fetchPosterList()
  .peekSuccess { analytics.trackSuccess() }
  .peekFailure { analytics.trackFailure() }
  .recover(emptyList()) <span class="hljs-comment">// 注意：peek 在 recover 之前运行，所以它能捕获到原始的失败信息</span>
</code></pre>
<blockquote>
<p>如果用 <code>peekFailure</code> / <code>peekError</code> / <code>peekException</code>，要注意一下在 <code>.recover()</code> 前面调用，因为经过 <code>recover()</code> 响应已经变成了 <code>ApiResponse.Success</code>。</p>
</blockquote>
<p>还有一个通用的 <code>peek</code>，不管成功还是失败，它都会执行：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> response = posterService.fetchPosterList()
  .peek { logger.info(<span class="hljs-string">"Response received: <span class="hljs-variable">$it</span>"</span>) }
</code></pre>
<p>如果你的副作用操作包含挂起函数（比如写入数据库），记得使用带 <code>suspend</code> 前缀的版本：<code>suspendPeekSuccess</code>、<code>suspendPeekError</code>、<code>suspendPeekException</code>、<code>suspendPeekFailure</code> 和 <code>suspendPeek</code>。</p>
<blockquote>
<p>其实 <code>peekError</code> 和 <code>onError</code> 没有本质区别，只是语义上把它们区分成两个函数：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> ApiResponse<span class="hljs-type">&lt;T&gt;</span>.<span class="hljs-title">peekError</span><span class="hljs-params">(
  <span class="hljs-keyword">crossinline</span> action: (<span class="hljs-type">ApiResponse</span>.<span class="hljs-type">Failure</span>.<span class="hljs-type">Error</span>) -&gt; <span class="hljs-type">Unit</span>,
)</span></span>: ApiResponse&lt;T&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> <span class="hljs-keyword">is</span> ApiResponse.Failure.Error) {
    action(<span class="hljs-keyword">this</span>)
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> ApiResponse<span class="hljs-type">&lt;T&gt;</span>.<span class="hljs-title">onError</span><span class="hljs-params">(
  <span class="hljs-keyword">crossinline</span> onResult: <span class="hljs-type">ApiResponse</span>.<span class="hljs-type">Failure</span>.<span class="hljs-type">Error</span>.() -&gt; <span class="hljs-type">Unit</span>,
)</span></span>: ApiResponse&lt;T&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> <span class="hljs-keyword">is</span> ApiResponse.Failure.Error) {
    onResult(<span class="hljs-keyword">this</span>)
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>
}
</code></pre>
</blockquote>
<h3 data-id="heading-37">自定义错误类型</h3>
<p>现实世界里的 API，通常都会返回一套结构化的错误信息，里面包含了错误码和具体的提示消息。作为开发者肯定希望在 Kotlin 代码里操作的是强类型的对象，而不是去生啃那些原始的字符串或者 JSON 数据。</p>
<p>Sandwich 允许你通过继承 <code>ApiResponse.Failure.Error</code> 或 <code>ApiResponse.Failure.Exception</code>，来定义属于你自己的错误和异常类型：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">data</span> <span class="hljs-keyword">object</span> LimitedRequest : ApiResponse.Failure.Error(
  payload = <span class="hljs-string">"your request is limited"</span>,
)

<span class="hljs-keyword">data</span> <span class="hljs-keyword">object</span> WrongArgument : ApiResponse.Failure.Error(
  payload = <span class="hljs-string">"wrong argument"</span>,
)

<span class="hljs-keyword">data</span> <span class="hljs-keyword">object</span> UnKnownError : ApiResponse.Failure.Exception(
  throwable = RuntimeException(<span class="hljs-string">"unknown error"</span>),
)

<span class="hljs-keyword">data</span> <span class="hljs-keyword">object</span> HttpException : ApiResponse.Failure.Exception(
  throwable = RuntimeException(<span class="hljs-string">"http exception"</span>),
)
</code></pre>
<p>这些自定义类型可以完美兼容任何 <code>ApiResponse&lt;T&gt;</code>（不管 T 是什么）。原理在于：<code>Failure.Error</code> 和 <code>Failure.Exception</code> 实际上继承自 <code>Failure&lt;Nothing&gt;</code>。得益于 Kotlin 的协变（Covariance），<code>Nothing</code> 是所有类型的子类型，所以它能自动适配任何泛型参数。</p>
<p>到了下游层级（比如 ViewModel），就可以直接用 <code>when</code> 表达式对这些自定义类型进行<strong>模式匹配</strong>，优雅 🍷！</p>
<pre><code class="hljs language-kotlin" lang="kotlin">response.onError {
  <span class="hljs-keyword">when</span> (<span class="hljs-keyword">this</span>) {
    LimitedRequest -&gt; showRateLimitDialog() <span class="hljs-comment">// 是限流错误，弹窗提示</span>
    WrongArgument -&gt; showValidationError()  <span class="hljs-comment">// 是参数错误，提示校验失败</span>
    <span class="hljs-keyword">else</span> -&gt; showGenericError()              <span class="hljs-comment">// 其他错误，兜底处理</span>
  }
}.onException {
  <span class="hljs-keyword">when</span> (<span class="hljs-keyword">this</span>) {
    HttpException -&gt; showHttpErrorUI()      <span class="hljs-comment">// HTTP 协议层面的异常</span>
    UnKnownError -&gt; showGenericErrorUI()    <span class="hljs-comment">// 未知异常</span>
    <span class="hljs-keyword">else</span> -&gt; showNetworkError()              <span class="hljs-comment">// 网络异常</span>
  }
}
</code></pre>
<h3 data-id="heading-38">全局失败映射器 (Global Failure Mappers)</h3>
<p>定义自定义错误类型固然好用，但问题是：你还是得去解析错误响应体（Body），然后手动创建对应的自定义类型对象。如果每一个 API 调用都要用 <code>flatMap</code> 手写一遍这个逻辑，那我们之前费劲想干掉的样板代码（Boilerplate）岂不是又死灰复燃了？</p>
<p>Sandwich 给出的解法是：<strong>全局失败映射器</strong>。你只需要在应用初始化的时候注册一次，剩下的事它全包了：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 在你的 Application.onCreate() 或者 DI 模块里配置</span>
SandwichInitializer.sandwichFailureMappers += ApiResponseFailureMapper { failure -&gt;
  <span class="hljs-comment">// 检查是不是 HTTP 错误</span>
  <span class="hljs-keyword">if</span> (failure <span class="hljs-keyword">is</span> ApiResponse.Failure.Error) {
    <span class="hljs-comment">// 尝试读取错误体字符串</span>
    <span class="hljs-keyword">val</span> errorBody = (failure.payload <span class="hljs-keyword">as</span>? Response)?.body?.string()
    <span class="hljs-keyword">if</span> (errorBody != <span class="hljs-literal">null</span>) {
      <span class="hljs-comment">// 解析 JSON</span>
      <span class="hljs-keyword">val</span> error: ErrorMessage = Json.decodeFromString(errorBody)
      <span class="hljs-comment">// 根据错误码返回自定义的错误对象</span>
      <span class="hljs-keyword">return</span><span class="hljs-symbol">@ApiResponseFailureMapper</span> <span class="hljs-keyword">when</span> (error.code) {
        <span class="hljs-number">10000</span> -&gt; LimitedRequest
        <span class="hljs-number">10001</span> -&gt; WrongArgument
        <span class="hljs-number">10002</span> -&gt; HttpException
        <span class="hljs-keyword">else</span> -&gt; UnKnownError
      }
    }
  }
  <span class="hljs-comment">// 如果没匹配上，就原样返回</span>
  failure
}
</code></pre>
<p>一旦注册成功，这个映射器就会自动拦截并转换你整个应用里<strong>所有</strong>的 <code>ApiResponse.Failure</code>。不管你调的是 <code>fetchPosterList()</code>、<code>fetchUser()</code> 还是 <code>login()</code>，所有的失败都会经过这个映射器。</p>
<p>这样一来，ViewModel 和 Repository 代码就变得无比干净，只需要处理那些具体的自定义类型：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> response = service.fetchMovieList()
response.onSuccess {
  _movies.value = <span class="hljs-keyword">data</span>
}.onException {
  <span class="hljs-comment">// 直接匹配自定义对象，无需关心 JSON 解析</span>
  <span class="hljs-keyword">when</span> (<span class="hljs-keyword">this</span>) {
    LimitedRequest -&gt; showRateLimitUI()
    WrongArgument -&gt; showValidationUI()
    HttpException -&gt; showHttpErrorUI()
    UnKnownError -&gt; showGenericErrorUI()
    <span class="hljs-keyword">else</span> -&gt; showDefaultErrorUI()
  }
}
</code></pre>
<p>对于 Ktor 或 Ktorfit 用户，读取错误体通常是一个挂起操作（比如 <code>HttpResponse.bodyAsText()</code>），这时候你需要使用 <code>ApiResponseFailureSuspendMapper</code>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">SandwichInitializer.sandwichFailureMappers += <span class="hljs-keyword">object</span> : ApiResponseFailureSuspendMapper {
  <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">map</span><span class="hljs-params">(apiResponse: <span class="hljs-type">ApiResponse</span>.<span class="hljs-type">Failure</span>&lt;*&gt;)</span></span>: ApiResponse.Failure&lt;*&gt; {
    <span class="hljs-keyword">if</span> (apiResponse <span class="hljs-keyword">is</span> ApiResponse.Failure.Error) {
      <span class="hljs-comment">// 这里的 bodyAsText() 是个挂起函数</span>
      <span class="hljs-keyword">val</span> errorBody = (apiResponse.payload <span class="hljs-keyword">as</span>? HttpResponse)?.bodyAsText()
      <span class="hljs-keyword">if</span> (errorBody != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">val</span> error: ErrorMessage = Json.decodeFromString(errorBody)
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (error.code) {
          <span class="hljs-number">10000</span> -&gt; LimitedRequest
          <span class="hljs-number">10001</span> -&gt; WrongArgument
          <span class="hljs-keyword">else</span> -&gt; UnKnownError
        }
      }
    }
    <span class="hljs-keyword">return</span> apiResponse
  }
}
</code></pre>
<p>这个挂起映射器会在挂起上下文中被正确地等待（Await），确保映射后的响应能正确返回给调用者。甚至可以在同一个列表中同时注册同步和挂起的映射器，它们会按顺序依次执行。</p>
<h3 data-id="heading-39">全局操作符 (Global Operators)</h3>
<p>如果说失败映射器（Failure Mappers）的职责是<strong>转换</strong>失败响应，那么全局操作符（Global Operators）的职责就是监听所有的响应（连成功的也不放过）以处理那些“横切关注点”。</p>
<p>这是做<strong>集中式日志记录</strong>、<strong>数据埋点分析</strong>、<strong>Token 自动刷新</strong>或者<strong>全局错误提示</strong>的最佳场所：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">SandwichInitializer.sandwichOperators += <span class="hljs-keyword">object</span> : ApiResponseOperator&lt;Any&gt;() {

  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSuccess</span><span class="hljs-params">(apiResponse: <span class="hljs-type">ApiResponse</span>.<span class="hljs-type">Success</span>&lt;<span class="hljs-type">Any</span>&gt;)</span></span> {
    logger.info(<span class="hljs-string">"API success: <span class="hljs-subst">${apiResponse.data}</span>"</span>)
  }

  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(apiResponse: <span class="hljs-type">ApiResponse</span>.<span class="hljs-type">Failure</span>.<span class="hljs-type">Error</span>)</span></span> {
    logger.error(<span class="hljs-string">"API error: <span class="hljs-subst">${apiResponse.message()}</span>"</span>)
    <span class="hljs-comment">// 检查是不是 401 未授权</span>
    <span class="hljs-keyword">if</span> (apiResponse.statusCode == StatusCode.Unauthorized) {
      <span class="hljs-comment">// 触发全局登出或者 Token 刷新逻辑</span>
      authManager.onUnauthorized()
    }
  }

  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onException</span><span class="hljs-params">(apiResponse: <span class="hljs-type">ApiResponse</span>.<span class="hljs-type">Failure</span>.<span class="hljs-type">Exception</span>)</span></span> {
    logger.error(<span class="hljs-string">"API exception: <span class="hljs-subst">${apiResponse.message}</span>"</span>)
    crashReporter.recordException(apiResponse.throwable)
  }
}
</code></pre>
<p>一旦注册，这个 Operator 就会作用于每一个通过 Sandwich 创建的 <code>ApiResponse</code> 对象（无论是 Retrofit、Ktor 还是 Ktorfit 产生的）。</p>
<p>上面代码里对 401 Unauthorized 的处理是全局生效的：这意味着你项目里任何一个 API 调用，只要报了 401，都会自动触发 <code>authManager</code> 的逻辑。再也不需要在每个调用处去重复写检查 401 的代码了，真正的“一处编写，到处运行”。</p>
<p>如果你的全局操作涉及挂起函数（比如耗时的埋点上报），请使用 <code>ApiResponseSuspendOperator</code>，它能保证在挂起上下文中正确执行：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">SandwichInitializer.sandwichOperators += <span class="hljs-keyword">object</span> : ApiResponseSuspendOperator&lt;Any&gt;() {

  <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSuccess</span><span class="hljs-params">(apiResponse: <span class="hljs-type">ApiResponse</span>.<span class="hljs-type">Success</span>&lt;<span class="hljs-type">Any</span>&gt;)</span></span> {
    analyticsService.trackSuccess() <span class="hljs-comment">// 这里可以安全地调用挂起函数</span>
  }

  <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(apiResponse: <span class="hljs-type">ApiResponse</span>.<span class="hljs-type">Failure</span>.<span class="hljs-type">Error</span>)</span></span> {
    analyticsService.trackError(apiResponse.message()) <span class="hljs-comment">// 挂起函数</span>
  }

  <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onException</span><span class="hljs-params">(apiResponse: <span class="hljs-type">ApiResponse</span>.<span class="hljs-type">Failure</span>.<span class="hljs-type">Exception</span>)</span></span> {
    analyticsService.trackException(apiResponse.throwable) <span class="hljs-comment">// 挂起函数</span>
  }
}
</code></pre>
<h3 data-id="heading-40">At the End</h3>
<p>作为译者，翻译完后，想额外聊几句。</p>
<p>坦白讲，Sandwich 并不是什么高深莫测的“黑科技”，它的地位也不像 Retrofit 那样是 Android 开发的“基础设施”。甚至可以说，它的核心原理并不复杂，只要你愿意，完全可以参考它的思路手写一套类似的 Result 封装。</p>
<p>但是在实际开发中，它确实提供了一种足够优雅的解法，把网络请求中那些恼人的异常处理、状态判断，从散落在各处的 <code>try-catch</code> 补丁，变成了一种标准化的、类型安全的数据流，让数据从 Data Source 到 UI 层的流转变得清晰可见。</p>
<p>当然，架构从来没有标准答案，Sandwich 是解决问题的一种方式，但绝不是唯一方式。如果你对这种处理模式有不同的见解，或者在项目中有更好的实践经验，欢迎在评论区理性交流探讨。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[本地开发时间减少 83%：为何迁出 Next.js]]></title>    <link>https://juejin.cn/post/7604863528945156111</link>    <guid>https://juejin.cn/post/7604863528945156111</guid>    <pubDate>2026-02-11T00:47:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604863528945156111" data-draft-id="7604715051463868431" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="本地开发时间减少 83%：为何迁出 Next.js"/> <meta itemprop="keywords" content="前端,Next.js"/> <meta itemprop="datePublished" content="2026-02-11T00:47:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="掘金安东尼"/> <meta itemprop="url" content="https://juejin.cn/user/1521379823340792"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            本地开发时间减少 83%：为何迁出 Next.js
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379823340792/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    掘金安东尼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T00:47:49.000Z" title="Wed Feb 11 2026 00:47:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>原文：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.inngest.com%2Fblog%2Fmigrating-off-nextjs-tanstack-start" target="_blank" title="https://www.inngest.com/blog/migrating-off-nextjs-tanstack-start" ref="nofollow noopener noreferrer">Reducing local dev time by 83%: Why we migrated off Next.js</a></p>
<p>翻译：TUARAN</p>
<p>欢迎关注 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTUARAN%2Ffrontend-weekly-digest-cn" target="_blank" title="https://github.com/TUARAN/frontend-weekly-digest-cn" ref="nofollow noopener noreferrer">{{前端周刊}}</a>，每周更新国外论坛的前端热门文章，紧跟时事，掌握前端技术动态。</p>
</blockquote>
<p>Inngest 团队非常重视开发者体验（DX）。但当本地开发时页面首次加载要等 10–12 秒，“把体验做漂亮”就会变成一种消耗。</p>
<p>本文讲述他们为什么、以及如何从 Next.js 迁出，转向 TanStack Start，并在迁移后把本地首次加载时间大幅降到 2–3 秒（作者给出的量化结果是减少 83%）。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3777339e937340e5865aa2e737de0902~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771375671&amp;x-signature=zev6e0mEucLVqnGwbgK9e9Ybv1E%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">早期信号：我们努力让它能用，但它越来越慢</h2>
<p>作者加入 Inngest 时，团队已经深度使用 Next.js：</p>
<ul>
<li>App Router 还在 beta 时就采用</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.inngest.com%2Fblog%2Fmigrating-from-vite-to-nextjs%3Fref%3Dblog-migrating-off-nextjs-tanstack-start" target="_blank" title="https://www.inngest.com/blog/migrating-from-vite-to-nextjs?ref=blog-migrating-off-nextjs-tanstack-start" ref="nofollow noopener noreferrer">一天内从 Vite 迁到 Next.js</a></li>
<li>拥抱 RSC，把它当作 React 的未来</li>
</ul>
<p>当时的承诺很诱人：摆脱 SPA 的空白 loading 与瀑布式请求，获得嵌套布局与 streaming，并把技术栈收敛到一个框架。</p>
<p>但“蜜月期”很快结束。作者认为 Next.js 优化的是一种特定工作流：有专门前端团队、长期深耕框架细节。而对他们这种小团队（多数工程师要多线作战）来说，认知负担会不断累积：</p>
<ul>
<li><code>"use client"</code> / <code>"use server"</code> 的边界</li>
<li>多层缓存 API</li>
<li>RSC 与客户端组件之间并不清晰的分界</li>
</ul>
<p>这些都让非“全职前端”的工程师感觉是在和框架搏斗，而不是在交付功能。</p>
<h3 data-id="heading-1">先退一步：弱化 RSC</h3>
<p>他们先尝试弱化 RSC：尽量只用最少量的 server components，并偏好 client components。短期内 DX 变得可接受了一些。</p>
<p>但随之而来的问题是：变慢——非常慢。</p>
<blockquote>
<p>本地开发环境的首次页面加载时间推到至少 10–12 秒。</p>
</blockquote>
<p>Slack 里不断出现抱怨：“我讨厌这个。”“前端太慢了。”</p>
<p>最终大家达成一致：我们的开发者体验很糟。</p>
<h3 data-id="heading-2">升级 Next.js、上 Turbopack</h3>
<p>他们尝试升级 Next.js，并使用 Vercel 的 profiling 工具评估效果，但没有改善。</p>
<p>接着试 Turbopack（还试了两次）。对一个规模不小的代码库来说，这不轻松：需要升级依赖与做不少重构。</p>
<p>更麻烦的是：当时 Vercel 生产环境构建仍主要支持 Webpack，导致本地开发与生产构建链路不一致，带来额外问题。</p>
<p>最终 Turbopack 对本地首屏加载的改善有限，平均也就快了几秒。</p>
<p>作者的结论很直白：Turbopack 并没有那么 turbo，是时候看看 Next.js 之外的选择。</p>
<h2 data-id="heading-3">评估替代方案</h2>
<p>他们希望得到：</p>
<ul>
<li>更快的本地首次加载</li>
<li>更合理的路由 API</li>
<li>更清晰的 server/client 约定</li>
</ul>
<p>于是原型验证了三种选择：</p>
<ul>
<li>TanStack Start</li>
<li>Deno Fresh</li>
<li>React Router v7（本质上是 Remix 方向）</li>
</ul>
<p>作者以前用过 Fresh 与 Remix，都认可它们的成熟度。但：</p>
<ul>
<li>Fresh 从 1 到 2 的节奏让团队有点犹豫</li>
<li>Remix 与 React Router 的合并/拆分演进让他们有所顾虑</li>
<li>TanStack Start 当时还是 RC，但团队已经大量使用 TanStack 的其它产品，对其方向很乐观</li>
</ul>
<p>综合权衡后，他们决定押注 TanStack Start。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eef34a7807014a8f81b44d4a93b075bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771375671&amp;x-signature=nG0s1xT37vUdurJ1ZbqeIO%2BfB2E%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">迁移策略：增量还是一次性撕掉创可贴</h2>
<p>他们需要在两种方式中选：</p>
<ul>
<li><strong>一次性迁移（brute force）</strong>：能更快收敛，但会带来巨大的 PR、很难传统评审。</li>
<li><strong>增量迁移（incremental）</strong>：需要条件路由、共享组件库里大量 Next.js 工具的替换与兼容，基础设施工作更多。</li>
</ul>
<p>为了估算成本，作者先从 Dev Server（dashboard 路由的一个子集）开始试转。结果转得比预期快，于是直接一路做到底：</p>
<ul>
<li>Dev Server 约一周完成切换</li>
<li>Dashboard 路由更多更复杂，整体多花了一些时间</li>
<li>总体仍是“一个工程师 + AI 辅助”在几周内完成</li>
</ul>
<p>迁移过程中，共享组件凡是依赖 Next.js 的地方，就复制一份改成 TanStack 等价实现；遇到 app heads 之间的交叉引用，也用一些临时类型 hack 过渡。</p>
<h2 data-id="heading-5">结果：DX 大幅改善</h2>
<p>迁移后，他们的本地开发体验显著变好：</p>
<ul>
<li>首次加载通常不超过 2–3 秒</li>
<li>且几乎只发生在“第一次加载任一路由”</li>
<li>之后的路由切换/加载几乎都是即时</li>
</ul>
<p>作者强调：这与 Next.js 形成鲜明对比——在他们的体验里，Next.js 本地开发时“每个路由的首次加载”都容易很慢。</p>
<h2 data-id="heading-6">技术取舍：从约定驱动到显式配置</h2>
<p>他们认为核心差异在于：</p>
<ul>
<li>Next.js 更偏 <strong>convention-over-configuration</strong>，但有时“魔法且模糊”</li>
<li>TanStack Start 更偏显式配置 + 规定式的 loader 数据获取</li>
</ul>
<p>作者用两个片段对比了 Next.js App Router 与 TanStack Router 的风格差异。</p>
<h3 data-id="heading-7">Next.js App Router（示意）</h3>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">RootLayout</span>(<span class="hljs-params">{
  params: { environmentSlug },
  children,
}: RootLayoutProps</span>) {
  <span class="hljs-keyword">const</span> env = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getEnv</span>(environmentSlug);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Layout</span> <span class="hljs-attr">activeEnv</span>=<span class="hljs-string">{env}</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Env</span> <span class="hljs-attr">env</span>=<span class="hljs-string">{env}</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">SharedContextProvider</span>&gt;</span>{children}<span class="hljs-tag">&lt;/<span class="hljs-name">SharedContextProvider</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Env</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Layout</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
}
</code></pre>
<p>布局与服务端数据获取“混在一起”，唯一提示它在服务端：<code>async/await</code>。</p>
<h3 data-id="heading-8">TanStack Router（示意）</h3>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">Route</span> = <span class="hljs-title function_">createFileRoute</span>(<span class="hljs-string">'/_authed/env/$envSlug'</span>)({
  <span class="hljs-attr">component</span>: <span class="hljs-title class_">EnvLayout</span>,
  <span class="hljs-attr">notFoundComponent</span>: <span class="hljs-title class_">NotFound</span>,
  <span class="hljs-attr">loader</span>: <span class="hljs-keyword">async</span> ({ params }) =&gt; {
    <span class="hljs-keyword">const</span> env = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getEnvironment</span>({
      <span class="hljs-attr">data</span>: { <span class="hljs-attr">environmentSlug</span>: params.<span class="hljs-property">envSlug</span> },
    });

    <span class="hljs-keyword">if</span> (params.<span class="hljs-property">envSlug</span> &amp;&amp; !env) {
      <span class="hljs-keyword">throw</span> <span class="hljs-title function_">notFound</span>({ <span class="hljs-attr">data</span>: { <span class="hljs-attr">error</span>: <span class="hljs-string">'Environment not found'</span> } });
    }

    <span class="hljs-keyword">return</span> { env };
  },
});

<span class="hljs-keyword">function</span> <span class="hljs-title function_">EnvLayout</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> { env } = <span class="hljs-title class_">Route</span>.<span class="hljs-title function_">useLoaderData</span>();

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">EnvironmentProvider</span> <span class="hljs-attr">env</span>=<span class="hljs-string">{env}</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">SharedContextProvider</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Outlet</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">SharedContextProvider</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">EnvironmentProvider</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
}
</code></pre>
<p>作者解释：这里的 <code>getEnvironment</code> 是 <code>createServerFn</code>，只会在 server 执行；<code>useLoaderData</code> 则在 client 侧读取路由数据。</p>
<h2 data-id="heading-9">AI 在迁移中怎么用</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6058d200d26c4c53885aee147ad61d1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771375671&amp;x-signature=xCj9BNPewhsPxhWX%2FADD2dLXe04%3D" alt="" loading="lazy"/></p>
<p>他们对 AI 的定位很务实：主要让 AI 做“体力活”，而不是做架构决策。</p>
<p>做法大致是：</p>
<ul>
<li>先人工迁移一条路线并建立模式（server/client 数据获取、组织方式）</li>
<li>再让 AI 把模式复制到相似路由</li>
<li>人工复查与清理</li>
</ul>
<p>此外，AI 也用来辅助处理一些 TypeScript 与边角 bug。</p>
<h2 data-id="heading-10">经验与建议</h2>
<h3 data-id="heading-11">TanStack Start 相关</h3>
<ul>
<li><strong>尽早、频繁 build</strong>：一旦有较多 server-side 代码，迟早会遇到“错误地被打进 client/server”的 bundling 问题；构建间隔越小，越容易定位。</li>
<li><strong>不要只依赖 dev mode</strong>：他们遇到过 dev 与 build 后行为不同的情况；有疑问就本地 build + preview。</li>
</ul>
<h3 data-id="heading-12">迁移过程相关</h3>
<ul>
<li><strong>一次性迁移意味着巨大 PR</strong>：几乎无法传统方式评审；他们选择用充分的 UAT 来对冲风险。</li>
<li>他们确实遇到过一次需要立即回滚的问题（某个难以在生产外测试的集成流程）。</li>
<li>如果你的工程环境非常风险厌恶，可能更值得投入额外工程实现“增量切换”。</li>
</ul>
<h2 data-id="heading-13">如何做你自己的决策</h2>
<p>作者把迁移结果开源在 UI monorepo：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Finngest%2Finngest%2Ftree%2Fmain%2Fui" target="_blank" title="https://github.com/inngest/inngest/tree/main/ui" ref="nofollow noopener noreferrer">github.com/inngest/inn…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JS Bin 在 2026 年宕机]]></title>    <link>https://juejin.cn/post/7605042079668781071</link>    <guid>https://juejin.cn/post/7605042079668781071</guid>    <pubDate>2026-02-11T00:47:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605042079668781071" data-draft-id="7604715051463917583" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JS Bin 在 2026 年宕机"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2026-02-11T00:47:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="掘金安东尼"/> <meta itemprop="url" content="https://juejin.cn/user/1521379823340792"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JS Bin 在 2026 年宕机
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379823340792/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    掘金安东尼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T00:47:37.000Z" title="Wed Feb 11 2026 00:47:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>原文：<a href="https://link.juejin.cn?target=https%3A%2F%2Fremysharp.com%2F2026%2F02%2F02%2Fjs-bin-down-in-2026" target="_blank" title="https://remysharp.com/2026/02/02/js-bin-down-in-2026" ref="nofollow noopener noreferrer">JS Bin down in 2026</a></p>
<p>翻译：TUARAN</p>
<p>欢迎关注 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTUARAN%2Ffrontend-weekly-digest-cn" target="_blank" title="https://github.com/TUARAN/frontend-weekly-digest-cn" ref="nofollow noopener noreferrer">{{前端周刊}}</a>，每周更新国外论坛的前端热门文章，紧跟时事，掌握前端技术动态。</p>
</blockquote>
<p>1 月 27 日，我收到了邮件通知：JS Bin 挂了。第二天，真实的人类用户开始问「怎么回事」。一直到 30 日晚上 11 点左右，最后一批问题才被解决。</p>
<p>前些天 <a href="https://link.juejin.cn?target=https%3A%2F%2Fjakearchibald.com%2F" target="_blank" title="https://jakearchibald.com/" ref="nofollow noopener noreferrer">Jake</a> 问我：到底哪里出了问题？</p>
<p>答案是：几乎所有环节都出了问题。</p>
<h2 data-id="heading-0">TL;DR</h2>
<p>我知道这篇文章又长又碎。我写嗨了，也很享受把这段经历讲清楚。</p>
<p>简短版是：</p>
<ul>
<li>早点把基础设施升级到最新（但我当时做不到）。</li>
<li>520 并不等于「服务器没响应」，它很可能是 Cloudflare 与源站之间的 TLS 协商/响应不兼容。</li>
<li>服务器在着火时，别过度依赖 LLM：它能帮你补知识，但也可能把你带进更复杂的岔路。尽量先退一步，盘点现状，再做改变。</li>
</ul>
<p>如果你愿意读长版，那就开始。</p>
<h2 data-id="heading-1">处于“维护模式”的这些年</h2>
<p>过去大概 5 年（也可能更久），JS Bin 基本处于一种半自动「维护模式」：每隔 3~6 个月会有一阵小故障需要我出手。JS Bin 快 18 岁了，以 Web 的标准来说已经是「高龄应用」。</p>
<p>通常我需要处理的是站内的<a href="https://link.juejin.cn?target=https%3A%2F%2Fremysharp.com%2F2015%2F09%2F15%2Fjsbin-toxic-part-2" target="_blank" title="https://remysharp.com/2015/09/15/jsbin-toxic-part-2" ref="nofollow noopener noreferrer">不良内容</a>、来自 AWS（JS Bin 托管在那儿）的下架请求，或者偶发的内存异常——有的恢复要花更久。</p>
<p>看过去 11 年的可用性曲线，宕机并不罕见，但这次完全不同（左边那次大故障先不算）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/263d6be977dd466cb3f690e6bd705ede~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771375658&amp;x-signature=YK%2Fou%2FcicFLYGlxfZFJEPBOc414%3D" alt="" loading="lazy"/></p>
<p>很多「长时间」宕机（我最近才更清楚）是因为机器内存耗尽，系统会像“塌方”一样：我甚至无法 SSH 登录去恢复，只能在 AWS 控制台里强制重启。</p>
<p>而这次更离谱：连「控制台重启」这种真正的「关机重开」都不灵。</p>
<h2 data-id="heading-2">重启也起不来</h2>
<p>这次宕机，无论怎么重启都回不来。我触发重启后，一直在控制台等 SSH，但完全连不上。</p>
<p>机器的行为像是：重启 → 立刻锁死。</p>
<p>这暗示着：机器外面有持续的巨大压力，而且没有减弱。</p>
<p>我手上唯一的办法，是把机器彻底关机一小时左右，希望“敲门的东西”能先走开。</p>
<p>后来我看 CloudWatch，才知道入站流量把机器摁在地上摩擦：几天前还是正常水平，突然变成前所未有的网络入站峰值。图里 cliff edge 之后的那些下跌，是机器扛不住而失去响应。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8b90bfbe85844d2987931128f827069~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771375658&amp;x-signature=V60Sn%2B%2B%2F%2B0JAmSSNM5btu%2BQwY4c%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">先把“该死的进程”杀掉</h2>
<p>我终于进到机器后，第一件事是看 <code>syslog</code>，找出导致崩溃的东西（更准确说：找出症状）。</p>
<p>很快我看到了 Node 因为 OOM（内存耗尽）而产生的 GC dump 与堆栈。</p>
<p>第一优先级：不要让系统“全盘崩溃”，先让最耗内存的进程被杀掉，至少保证我还能登录继续排查。</p>
<p>我加了这条配置：</p>
<pre><code class="hljs language-conf" lang="conf"># /etc/sysctl.conf，然后用 `sudo sysctl -p` 重新加载
vm.oom_kill_allocating_task=1
</code></pre>
<p>这样内存被打爆时，系统会优先杀掉正在疯狂分配内存的进程（Node），而不是随便杀掉别的关键进程（导致 SSH 也没了）。</p>
<p>这不会让机器“很快”，但能让我在流量继续轰炸时至少还能诊断（当然终端会非常慢）。</p>
<p>我能看到 CPU 长时间接近 100%，Node 的内存占用持续上涨（我用 <code>htop</code>）。</p>
<p>然后，ChatGPT 建议我升级 Node——奇怪的是，我并没有告诉它我在用什么版本。</p>
<h2 data-id="heading-4">支线任务：Node 真的很老</h2>
<p>因为长期“维护模式”，我几乎从没动过 Node。结果 JS Bin 居然跑在 Node 7 上（甚至不是“稳定”的 Node 8），可能已经超过十年。</p>
<p>我问 ChatGPT 为什么知道，它说「你告诉过我」。这完全是胡扯。</p>
<p>我追问了很久才发现：当时我的终端屏幕上显示了 Node 版本；在我之后调 nginx 的过程中，ChatGPT 直接“看”到了屏幕内容。</p>
<p>我不知道它是否能读取滚动历史（希望不能），但这依然很不舒服。</p>
<p>我平常用的是浏览器版 ChatGPT，不怎么用“应用”形态；这次给我一个教训：只要屏幕上出现过敏感信息（比如我刚 <code>cat</code> 过 <code>.env</code>），就要假设 LLM 可能看得到。</p>
<p>总之，我把 Node 从 7 升到了 22，居然没出事。幸运的是我在 2024 年做过一轮现代化改造，好让我能在本机跑起来（现代系统当然不愿意跑 Node 7）。</p>
<p>至少，事件循环性能变好了，CPU 压力会小一点。</p>
<p>……但问题依然没解决。</p>
<h2 data-id="heading-5">服务器太小，但我当时不想“加钱”</h2>
<p>JS Bin 的主服务跑在 AWS <code>t2.micro</code> 上：单核 CPU、1GB 内存。我一直很惊讶它能在这么少资源上撑这么久。</p>
<p>当然，换更大的机器（加钱）可能有用。但当时我没有一键构建新机器的脚本——这台服务器已经多年“稳定运行”，我也没有随时可用的重建流程。</p>
<p>而且 JS Bin 虽然有 pro 版，但现金流并不充裕。简而言之：我需要“立刻能做”的事。</p>
<p>在 ChatGPT、Gemini 和 Claude 的帮助下（我用多个 LLM 来交叉验证建议，但说实话没有我希望的那么严谨），我尝试调优 nginx，比如：</p>
<ul>
<li>worker 配置</li>
<li>proxy timeout</li>
<li>文件描述符上限</li>
<li>keep-alive</li>
<li>甚至移除 http2 来省内存</li>
</ul>
<p>例如：</p>
<pre><code class="hljs language-nginx" lang="nginx">worker_connections 1024;
worker_processes auto;

keepalive_timeout 10;
keepalive_requests 100;
</code></pre>
<p>在每秒 1000+ 请求、还有更多请求在排队的情况下，这些改动几乎没有立竿见影的效果。</p>
<p>接着有人（也包括 LLM）提了一个问题：你考虑过 Cloudflare 吗？</p>
<h2 data-id="heading-6">把 Cloudflare 放到前面</h2>
<p>说实话，把 Cloudflare 放到 JS Bin 前面出奇地顺利。它识别了大多数域名与指向，我只要把 DNS 的 nameserver 从 Route 53 换成 Cloudflare。</p>
<p>1 月 29 日接近午夜时，我开始能在浏览器里打开 <a href="https://link.juejin.cn?target=http%3A%2F%2Fjsbin.com%2F" target="_blank" title="http://jsbin.com/" ref="nofollow noopener noreferrer">jsbin.com</a> 了。</p>
<p>但很快 GitHub 和邮件反馈告诉我：很多人依然在报错。</p>
<p>尤其是 Cloudflare 的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.cloudflare.com%2Fsupport%2Ftroubleshooting%2Fhttp-status-codes%2Fcloudflare-5xx-errors%2Ferror-520%2F" target="_blank" title="https://developers.cloudflare.com/support/troubleshooting/http-status-codes/cloudflare-5xx-errors/error-520/" ref="nofollow noopener noreferrer">520</a>——后来我才知道，它可能对应很多不同的问题。</p>
<h2 data-id="heading-7">请求仍然绕过 Cloudflare</h2>
<p>即便能打开页面，我也能在服务器上看到有流量还在直冲源站。</p>
<p>我找到了 Cloudflare 的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cloudflare.com%2Fen-gb%2Fips%2F" target="_blank" title="https://www.cloudflare.com/en-gb/ips/" ref="nofollow noopener noreferrer">IP 段列表</a>，发现还有大量请求并不来自这些 IP 段。于是下一步是：丢弃非 Cloudflare 的流量。</p>
<p>这里开始，LLM 的建议让我引入了更多问题（直到第二天才彻底暴露）。当你忙到“救火模式”，很容易在复杂度上失手。</p>
<p>我最先用的方案是：在 nginx 里判断 Cloudflare 的请求头，没带头就丢弃。</p>
<pre><code class="hljs language-nginx" lang="nginx">if ($http_cf_ray = "") {
    return 444;
}
</code></pre>
<p><code>444</code> 会直接断开连接，不返回任何内容。</p>
<p>我还按「Captain GPT」的指引配置了 <code>set_real_ip_from</code> 等（这在之后会坑到我）：</p>
<pre><code class="hljs language-nginx" lang="nginx"># /etc/nginx/cloudflare.conf
set_real_ip_from 173.245.48.0/20;
set_real_ip_from 103.21.244.0/22;
set_real_ip_from 103.22.200.0/22;
set_real_ip_from 103.31.4.0/22;
set_real_ip_from 141.101.64.0/18;
set_real_ip_from 108.162.192.0/18;
set_real_ip_from 190.93.240.0/20;
set_real_ip_from 188.114.96.0/20;
set_real_ip_from 197.234.240.0/22;
set_real_ip_from 198.41.128.0/17;
set_real_ip_from 162.158.0.0/15;
set_real_ip_from 104.16.0.0/13;
set_real_ip_from 104.24.0.0/14;
set_real_ip_from 172.64.0.0/13;
set_real_ip_from 131.0.72.0/22;

real_ip_header CF-Connecting-IP;
real_ip_recursive on;
</code></pre>
<p>并在 <code>http {}</code> 里 include：</p>
<pre><code class="hljs language-nginx" lang="nginx">http {
    include /etc/nginx/cloudflare.conf;
    ...
}
</code></pre>
<p>这会让 <code>$remote_addr</code> 变成真实用户 IP，而不是 Cloudflare 的边缘节点 IP。</p>
<p>但问题是：即便这样做，流量仍然很大；而且这种“在 nginx 层处理再丢弃”的方式，依然会消耗资源。</p>
<h2 data-id="heading-8">把油继续往火里浇</h2>
<p>我还用 <code>ss</code> 查看连接：</p>
<pre><code class="hljs language-bash" lang="bash">ss -tan state established <span class="hljs-string">'( sport = :443 )'</span>
</code></pre>
<p>我依然能看到一些非 Cloudflare 的请求成功建立连接（当时我正处于「改配置 → 失败 → 焦虑 → 问 LLM → 重来」的循环中）。</p>
<p>于是我又换了一种策略：不用请求头，改用来源 IP 是否属于 Cloudflare 的 IP 段来判断。</p>
<pre><code class="hljs language-nginx" lang="nginx">geo $is_cloudflare {
    default 0;

    173.245.48.0/20    1;
    103.21.244.0/22    1;
    # etc
}
</code></pre>
<p>然后在 server block 里：</p>
<pre><code class="hljs language-nginx" lang="nginx">server {
    listen 443 ssl http2 default_server;
    if ($is_cloudflare = 0) { return 444; }
    if ($cf_valid = 0) { return 444; }

    # rest of config unchanged
}
</code></pre>
<p>我当时没意识到的一点（花了 24 小时才想明白）：</p>
<ul>
<li>之前那套配置会说「如果请求来自 Cloudflare，把 <code>$remote_addr</code> 改成真实用户 IP」。</li>
<li>然后这套规则又说「如果 <code>$remote_addr</code> 不是 Cloudflare IP，就丢弃」。</li>
</ul>
<p>结果：真正的用户（经由 Cloudflare）反而被我丢掉了。</p>
<p>现场变成了最糟糕的两件事同时发生：</p>
<ul>
<li>仍然有绕过 Cloudflare 的流量打进来，继续耗资源</li>
<li>真实用户经由 Cloudflare 访问时，大多数却拿到 520</li>
</ul>
<p>我终于意识到：应该在更靠外的地方（防火墙/安全组）直接丢弃流量。</p>
<h2 data-id="heading-9">直接丢弃流量（ufw + AWS 安全组）</h2>
<p>我做了“双保险”：</p>
<ul>
<li>在服务器上用 <code>ufw</code>（我一直把它当成 iptables）按 IP 段 <code>ALLOW/DROP</code></li>
<li>在 AWS security group 同样只允许 Cloudflare IP 段访问 80/443</li>
</ul>
<p><code>ufw</code> 相对简单：</p>
<pre><code class="hljs language-bash" lang="bash">ufw allow from 173.245.48.0/20 to any port 443
ufw allow from 103.21.244.0/22 to any port 443
<span class="hljs-comment"># etc</span>
ufw deny 443
</code></pre>
<p>80 端口同理。</p>
<p>我在测试时还踩了个小坑：想临时放行自己 IP 时搞乱了规则；后来用 <code>ufw status numbered</code> + <code>ufw delete N</code> 解决。</p>
<p>AWS 安全组就麻烦多了：Web UI 不适合大批量改动，非常笨重。</p>
<p>我最后用 AWS CLI 写了脚本（但它不能批量修改，一条条执行还得等待返回再按回车，效率很低）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-keyword">for</span> CIDR <span class="hljs-keyword">in</span> \
   103.21.244.0/22 \
   103.22.200.0/22 \
   103.31.4.0/22 \
   <span class="hljs-comment"># etc</span>
<span class="hljs-keyword">do</span>
   aws ec2 authorize-security-group-ingress --group-id <span class="hljs-variable">$SG_ID</span> --protocol tcp --port 80  --cidr <span class="hljs-variable">$CIDR</span> --region us-east-1
   aws ec2 authorize-security-group-ingress --group-id <span class="hljs-variable">$SG_ID</span> --protocol tcp --port 443 --cidr <span class="hljs-variable">$CIDR</span> --region us-east-1
<span class="hljs-keyword">done</span>
</code></pre>
<p>做到这一步，服务器终于开始“喘气”了。</p>
<p>但很多用户仍然被 Cloudflare 的 520 拦住（奇怪的是我自己还能访问……）。</p>
<h2 data-id="heading-10">520：不是 503/504，而是“不兼容”</h2>
<p>我原本以为 520 类似 503（源站挂了）或 504（网关超时），但实际上更像是：</p>
<blockquote>
<p>Cloudflare 发起请求，但源站的响应对 Cloudflare 来说“不兼容”。</p>
</blockquote>
<p>我能确定一个线索：80 端口的纯 HTTP 没问题，只有 HTTPS 出问题。</p>
<p>有个很关键的观察来自 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fjsbin%2Fjsbin%2Fissues%2F3583%23issuecomment-3823361117" target="_blank" title="https://github.com/jsbin/jsbin/issues/3583#issuecomment-3823361117" ref="nofollow noopener noreferrer">@robobuljan</a>：</p>
<pre><code class="hljs language-bash" lang="bash">curl jsbin.com             <span class="hljs-comment"># （正常）</span>
curl http://jsbin.com      <span class="hljs-comment"># （正常）</span>
curl https://jsbin.com     <span class="hljs-comment"># 520</span>
</code></pre>
<p>这一天里，LLM 基本帮不上忙（我也干脆把它们放一边，专心啃问题）。</p>
<p>我在 Cloudflare 的 SSL/TLS 页里看到「Traffic Served Over TLS」显示 TLS 版本分布（我没截图，这些数来自它们的 API）：</p>
<ul>
<li>TLSv1：36</li>
<li>TLSv1.1：56</li>
<li>TLSv1.2：1,922,523</li>
<li>TLSv1.3：5,216,795</li>
</ul>
<p>我的 nginx 配置里反复出现这行：</p>
<pre><code class="hljs language-nginx" lang="nginx">ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
</code></pre>
<p>没有 TLSv1.3。</p>
<p>我先尝试在 nginx 加上 <code>TLSv1.3</code>，但 <code>nginx -t</code> 直接失败：当前环境缺模块，而且要做大升级才能装上。</p>
<p>那就换思路：能不能在 Cloudflare 侧禁用 TLS 1.3？</p>
<p>答案是能，但入口很隐蔽：</p>
<ul>
<li>查看支持情况在「Speed / Settings」</li>
<li>真正关闭在「SSL/TLS → Edge Certificates」，页面靠后的位置</li>
</ul>
<p>禁用 TLS 1.3 后，大量真实流量恢复正常。</p>
<h2 data-id="heading-11">仍然有部分用户加载失败（static/null 域名）</h2>
<p>接着又出现一个问题：部分用户的静态资源加载不了，或者用于运行代码的 iframe 域名（<code>null.jsbin.com</code>）异常。</p>
<p>我花了几个小时才理清：我曾让 nginx 在「请求来自 Cloudflare 时」使用 <code>set_real_ip_from</code> 把 <code>$remote_addr</code> 改写为真实用户 IP，而后续又用 <code>return 444</code> 去丢弃“不符合条件”的请求。</p>
<p>不知为何，这套混乱的规则并没有影响主站首页，但却影响了 <code>static.jsbin.com</code> 与 <code>null.jsbin.com</code>。</p>
<p>这就是熬夜 + 危机模式的典型后果：配置变成一团糟，自己也说不清到底哪些规则在什么时候生效。</p>
<p>当我最终移除这些临时拼凑的检查、IP 改写与一堆由 LLM 引入的“杂质”后，最后那部分流量也恢复了。</p>
<p>JS Bin 全面恢复。</p>
<h2 data-id="heading-12">事后复盘</h2>
<p>现在 Cloudflare 顶在源站前面，这台 1GB 单核的小机器居然非常从容：CPU 常态只有 4%~5%。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42dee973f30647dcadd91c22fd230773~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771375658&amp;x-signature=Cpcnl%2B5wD%2Bez%2FBkmuz2y%2BgCd2nw%3D" alt="" loading="lazy"/></p>
<p>我怀疑如果当时没那么依赖 LLM，我可能会更早意识到自己在不断增加复杂度。但另一方面：我也早该把 Cloudflare 放到 JS Bin 前面——不该等到危机时刻才做。</p>
<p>这次我学到的“坑”主要是：</p>
<ul>
<li>TLS 版本不匹配会导致 520</li>
<li>520 的语义远比我以为的复杂</li>
</ul>
<p>从 CloudWatch 看，流量确实回落了；我相信 Cloudflare 已经替我挡掉了很多垃圾流量。看起来其中一大块来自香港——我给那边开了 Cloudflare 的 JS Challenge 才能继续访问：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0eacf101d66345c993ac7f4c8f00f0e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771375658&amp;x-signature=sEK6OyXRgAv3LHRJDyW8J4C4g30%3D" alt="" loading="lazy"/></p>
<p>拍截图后 24 小时内香港有 1000 万请求。</p>
<p>至于到底是什么导致这波流量把一切打崩，我恐怕永远无法确定。我直觉怀疑是 AI/LLM 的爬虫在“吸”整个互联网；但反证是：流量并不来自单一 IP。</p>
<p>讽刺的是，我倒是在自己的博客上看到过一个单 IP 爬虫（见<a href="https://link.juejin.cn?target=https%3A%2F%2Fbsky.app%2Fprofile%2Fremysharp.com%2Fpost%2F3mb55uwp3vk2j" target="_blank" title="https://bsky.app/profile/remysharp.com/post/3mb55uwp3vk2j" ref="nofollow noopener noreferrer">这个链接</a>）：几个小时内 3GB 数据、32.5 万次请求。好在博客是跑在 Netlify 的纯静态站上，不像 JS Bin 还在跑 Node 7（是的，真的是 Node 7）。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android Studio Panda 1 正式版来了：JDK 终于不用手动配了，内存泄漏也有原生方案了]]></title>    <link>https://juejin.cn/post/7605097326727266350</link>    <guid>https://juejin.cn/post/7605097326727266350</guid>    <pubDate>2026-02-11T00:57:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605097326727266350" data-draft-id="7605041556656685065" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android Studio Panda 1 正式版来了：JDK 终于不用手动配了，内存泄漏也有原生方案了"/> <meta itemprop="keywords" content="Android,Android Studio"/> <meta itemprop="datePublished" content="2026-02-11T00:57:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="黄林晴"/> <meta itemprop="url" content="https://juejin.cn/user/3985057546510423"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android Studio Panda 1 正式版来了：JDK 终于不用手动配了，内存泄漏也有原生方案了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3985057546510423/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    黄林晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T00:57:06.000Z" title="Wed Feb 11 2026 00:57:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>每次换电脑、拉新项目，最让 Android 开发者头疼的是什么？</p>
<p>不是 Gradle 同步慢，不是模拟器卡——是 <strong>JDK 版本又不对了</strong>。</p>
<p>明明本地装了 JDK 17，但项目要 JDK 21；CI 机器上跑得好好的，你的电脑就是编译不过。改 <code>JAVA_HOME</code>、改 Gradle 配置、改 IDE 设置……折腾半天，代码一行没写。</p>
<p>好消息：<strong>Android Studio Panda 1 稳定版正式发布了</strong>，这个问题终于被系统级解决了。</p>
<h2 data-id="heading-0">Gradle Daemon JVM Criteria：JDK 管理的终极方案</h2>
<p>这是 Panda 1 最重要的新功能，也是最值得升级的理由。</p>
<p><strong>一句话总结：Gradle 现在能自动找到、甚至自动下载正确的 JDK 了。</strong></p>
<h3 data-id="heading-1">以前的痛苦</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 每个开发者都经历过的噩梦</span>
❌ Could <span class="hljs-keyword">not</span> determine java version <span class="hljs-keyword">from</span> <span class="hljs-string">'21.0.1'</span>
❌ Incompatible because <span class="hljs-keyword">this</span> component declares a component <span class="hljs-keyword">for</span> use during compile-time...
❌ <span class="hljs-function">Gradle Daemon disappeared <span class="hljs-title">unexpectedly</span> (<span class="hljs-params">JDK version mismatch</span>)
</span></code></pre>
<p>JDK 版本不一致导致的问题五花八门：编译失败、Daemon 进程崩溃、多个 Daemon 同时运行拖慢电脑……每个 Android 开发者都被折磨过。</p>
<h3 data-id="heading-2">现在的方案</h3>
<p>Panda 1 引入了 <strong>Gradle Daemon JVM Criteria</strong>（基于 Gradle 9.2.0），工作原理是：</p>
<ol>
<li>
<ol>
<li><strong>自动检测</strong>：Gradle 扫描你机器上已安装的 JDK，找到兼容版本</li>
</ol>
</li>
<li>
<ol start="2">
<li><strong>自动下载</strong>：如果找不到合适的 JDK，Gradle 自动帮你下载并配置</li>
</ol>
</li>
<li>
<ol start="3">
<li><strong>全局一致</strong>：无论是 IDE 构建还是命令行构建，使用的 JDK 完全一致</li>
</ol>
</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/121df8f002e24a10a719e9b35fbbba21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5p6X5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771376229&amp;x-signature=mlaPb19OWoKxrlDUS1sH%2F5BYvjY%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-3">实际效果</h3>






























<table><thead><tr><th>场景</th><th>以前</th><th>现在</th></tr></thead><tbody><tr><td>新电脑拉项目</td><td>手动安装 JDK → 配置环境变量 → 修改 Gradle 设置</td><td><strong>直接 Sync，自动搞定</strong></td></tr><tr><td>团队成员 JDK 版本不同</td><td>各种诡异编译错误</td><td><strong>自动统一版本</strong></td></tr><tr><td>CI/CD 环境</td><td>维护 JDK 安装脚本</td><td><strong>Gradle 自动 Provision</strong></td></tr><tr><td>多项目切换</td><td>频繁切换 JAVA_HOME</td><td><strong>每个项目独立管理</strong></td></tr></tbody></table>
<h3 data-id="heading-4">怎么迁移？</h3>
<p>对于已有项目，Android Studio 会弹出通知，提供<strong>一键迁移</strong>选项，自动将旧的 Gradle JDK 配置迁移到新的 Daemon JVM Criteria。</p>
<p>手动配置路径：<strong>File → Settings → Build, Execution, Deployment → Build Tools → Gradle</strong></p>
<h2 data-id="heading-5">LeakCanary 集成到 Profiler：内存泄漏分析搬到 PC 端</h2>
<p>如果你是 Android 开发者，大概率用过 LeakCanary——那个检测内存泄漏的神器。</p>
<p>但 LeakCanary 有个不太爽的地方：<strong>泄漏分析是在设备端进行的</strong>。手机本身的算力有限，分析大型 Heap Dump 的时候，设备会明显卡顿，甚至可能 OOM。</p>
<p>Panda 1 的做法很聪明：</p>
<p><strong>把 LeakCanary 的分析能力集成到 Android Studio Profiler 中，分析过程在开发机上执行。</strong></p>
<p>具体来说：</p>
<ul>
<li>• Profiler 中新增了专门的 <strong>LeakCanary Task</strong></li>
<li>• 内存泄漏分析从设备端转移到开发机，<strong>性能大幅提升</strong></li>
<li>• 分析结果直接关联源码，支持 <strong>Jump to Source</strong> 一键跳转</li>
<li>• 还能一键将分析结果复制给 <strong>Gemini</strong> 进行智能解读</li>
</ul>
<p>这意味着：你不再需要盯着手机屏幕看那堆 Reference Chain，而是在 IDE 里就能完成从<strong>检测 → 分析 → 定位 → 修复</strong>的完整流程。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/207b9ba7acdc44b0984d3e6d42554c45~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5p6X5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771376229&amp;x-signature=wMNYOF6kzNuA7lTOvo6GzFnl6eg%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-6">Gemini AI 能力全面升级</h2>
<p>AI 辅助开发已经不是新鲜事了，但 Panda 1 把 Gemini 的能力又往前推了一大步。</p>
<h3 data-id="heading-7">AI 创建新项目</h3>
<p>没错，你现在可以用自然语言描述需求，让 Gemini 帮你<strong>生成一个完整的项目</strong>：</p>
<ul>
<li>• <strong>New Project → Create with AI</strong></li>
<li>• 输入描述，比如「一个带底部导航的天气 App，使用 Compose + MVVM」</li>
<li>• Gemini 会生成结构化方案，然后<strong>自主执行生成循环</strong></li>
</ul>
<p>支持生成的项目类型：</p>
<ul>
<li>• 单页面静态 UI 布局</li>
<li>• 多页面带导航的应用</li>
<li>• 集成 Gemini API 的 AI 增强应用</li>
<li>• 调用公开 API 的应用</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67db69727169478e86cfce6d340e5abd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5p6X5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771376229&amp;x-signature=O4h18sOTWByAxBBMSB75qRlMyMo%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-8">AI 升级依赖</h3>
<p>依赖升级一直是 Android 项目维护中最头疼的事情之一。升一个库，可能牵出一堆兼容性问题。</p>
<p>现在你可以：</p>
<ul>
<li>• <strong>Refactor → Update dependencies</strong></li>
<li>• 或者在 <code>libs.versions.toml</code> 中悬停版本号 → <strong>Update all libraries with Gemini</strong></li>
</ul>
<p>Gemini 会：</p>
<ol>
<li>生成升级计划概览</li>
<li>逐步执行升级</li>
<li><strong>自动解决升级过程中的编译错误</strong></li>
<li>提供变更审查，支持接受或回滚</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aaa3b718bdbe42959f1808da1f8a0e05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5p6X5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771376229&amp;x-signature=mC6pGyQPbFJf4w9qDILPe9rNdoo%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-9">AI 崩溃修复建议</h3>
<p>在 <strong>App Quality Insights</strong> 面板中，选择一个崩溃 → 点击 <strong>Suggest a fix</strong>，Gemini 会结合你的源码和崩溃堆栈，给出具体的修复建议。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42da59bd368f4eaca5cdd60d599cde6c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5p6X5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771376229&amp;x-signature=jgbWGvricS%2FGJP%2Fy94tmXxmtfxQ%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-10">Compose 开发体验升级</h2>
<h3 data-id="heading-11">Compose Preview Screenshot Testing</h3>
<p>这是一个非常实用的新工具：<strong>自动生成 UI 回归测试报告</strong>。</p>
<ul>
<li>• 为你的 Compose Preview 生成截图基准</li>
<li>• 后续每次修改，自动对比是否有 UI 变化</li>
<li>• 生成 HTML 格式的可视化报告</li>
<li>• 帮你在代码合入前就发现 UI 回归问题</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8195551a82745b69bb8c3ca8c337d3b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5p6X5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771376229&amp;x-signature=y88jvgFnXINOYuDZYqY1g7jMBq0%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-12">Recomposition State Reads（Panda 2 预览）</h3>
<p>这个功能目前在 Panda 2 Canary 中可用，但值得提前关注：</p>
<ul>
<li>• 在 Layout Inspector 中<strong>追踪 Recomposition 的触发原因</strong></li>
<li>• 查看是哪个 State 变量的变化导致了重组</li>
<li>• 支持 <strong>Explain with AI</strong> 用自然语言解释重组链路</li>
</ul>
<p>对于优化 Compose 性能来说，这简直是神器。</p>
<h2 data-id="heading-13">IntelliJ 2025.3 平台升级</h2>
<p>Android Studio Panda 1 基于 <strong>IntelliJ IDEA 2025.3</strong> 平台，带来了底层的全面升级：</p>





























<table><thead><tr><th>改进</th><th>说明</th></tr></thead><tbody><tr><td><strong>Command Completion</strong></td><td>输入 <code>.</code> 触发代码补全、后缀补全和 Action 建议；输入 <code>..</code> 只过滤 Action</td></tr><tr><td><strong>800+ Bug 修复</strong></td><td>大量稳定性和性能改进</td></tr><tr><td><strong>Java 25 支持</strong></td><td>捆绑工具全面兼容 Java 25 运行时</td></tr><tr><td><strong>AI 增强</strong></td><td>支持连接自定义 AI Provider，与 Claude Agent 在统一聊天界面中交互</td></tr><tr><td><strong>统一版本</strong></td><td>IntelliJ 不再区分 Community 和 Ultimate，更多功能免费开放</td></tr></tbody></table>
<h2 data-id="heading-14">AGP 兼容性：3 年滚动支持策略</h2>
<p>Panda 1 支持的 Android Gradle Plugin 版本范围：<strong>AGP 4.0 - 9.0</strong></p>
<p>Google 推行了新的 <strong>3 年滚动兼容策略</strong>：每个 Android Studio 版本支持过去 3 年内发布的 AGP 版本。超过 3 年的旧版本将不再兼容。</p>
<p>这意味着如果你的项目还在用 AGP 3.x，是时候升级了。</p>
<h2 data-id="heading-15">其他值得关注的变化</h2>
<ul>
<li>• <strong>Material Symbols 集成</strong>：Vector Asset Studio 现在可以直接搜索和使用 Google Material Symbols 图标库，支持调整 Weight、Grade、Optical Size</li>
<li>• <strong>Monochrome Icon 支持</strong>：Image Asset Studio 新增 Monochrome 标签页，方便为 Android 13+ 创建主题化应用图标</li>
<li>• <strong>Layout Inspector 3D 模式废弃</strong>：官方认为标准 2D 视图和 Component Tree 已能满足绝大多数调试需求</li>
<li>• <strong>Custom View Preview 废弃</strong>：随着 Compose 成为主流，旧的自定义 View 预览功能正式退场</li>
<li>• <strong>云服务版本限制</strong>：从 Narwhal Feature Drop 开始，Gemini、Play Vitals、Firebase Crashlytics 等云服务仅支持最新稳定版及前 10 个月内的主要版本</li>
</ul>
<h2 data-id="heading-16">怎么升级？</h2>
<ol>
<li>
<ol>
<li><strong>已安装 Android Studio</strong>：Help → Check for updates</li>
</ol>
</li>
<li>
<ol start="2">
<li><strong>全新安装</strong>：前往 developer.android.com/studio 下载</li>
</ol>
</li>
<li>
<ol start="3">
<li><strong>版本号</strong>：2025.3.1</li>
</ol>
</li>
<li>
<ol start="4">
<li><strong>最低要求</strong>：AGP 4.0+，推荐使用 AGP 9.0</li>
</ol>
</li>
</ol>
<h2 data-id="heading-17">写在最后</h2>
<p>Android Studio 的更新节奏越来越快，从 Meerkat 到 Narwhal 到 Otter，再到现在的 Panda——动物园已经快凑齐了。</p>
<p>但 Panda 1 这次的更新，是真的解决了实际痛点：</p>
<ul>
<li>• <strong>JDK 自动管理</strong>，终于不用在每台新电脑上都折腾一遍环境了</li>
<li>• <strong>LeakCanary 集成</strong>，内存泄漏分析从此在 IDE 里一站式完成</li>
<li>• <strong>Gemini 全面加持</strong>，从建项目到升依赖到修崩溃，AI 无处不在</li>
<li>• <strong>Compose 测试工具</strong>，UI 回归再也不用肉眼对比了</li>
</ul>
<p>如果你还在用 Narwhal 或更早的版本，强烈建议升级。这一次的体验提升，是肉眼可见的。</p>
<p><strong>你最期待 Panda 1 的哪个功能？评论区聊聊你的开发体验。</strong></p>
<hr/>
<p>觉得有用的话，点个「在看」转发给你的 Android 开发同事吧~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[跨行转账如何保证数据一致性？TCC分布式事务从入门到实战]]></title>    <link>https://juejin.cn/post/7605107459065462830</link>    <guid>https://juejin.cn/post/7605107459065462830</guid>    <pubDate>2026-02-11T01:01:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605107459065462830" data-draft-id="7604863528944222223" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="跨行转账如何保证数据一致性？TCC分布式事务从入门到实战"/> <meta itemprop="keywords" content="后端,分布式"/> <meta itemprop="datePublished" content="2026-02-11T01:01:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="雨中飘荡的记忆"/> <meta itemprop="url" content="https://juejin.cn/user/694547077666606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            跨行转账如何保证数据一致性？TCC分布式事务从入门到实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547077666606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    雨中飘荡的记忆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T01:01:43.000Z" title="Wed Feb 11 2026 01:01:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读21分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">跨行转账如何保证数据一致性？TCC分布式事务从入门到实战</h2>
<h3 data-id="heading-1">引言</h3>
<p>在当今互联网架构中，分布式系统已成为主流。当一笔转账需要跨多个银行、跨多个账户、甚至跨多个微服务时，如何保证数据的一致性就成了一个极具挑战性的问题。</p>
<p>想象这样一个场景：用户要从A银行转账1000元到B银行。这看似简单的操作，在分布式系统中需要完成以下步骤：</p>
<ol>
<li>从A银行账户扣减1000元</li>
<li>通过银行间清算网络进行清算</li>
<li>向B银行账户增加1000元</li>
</ol>
<p>如果在这个过程中任何一步出现故障——网络中断、服务器宕机、数据库崩溃——就会导致数据不一致，这是金融系统绝对不能容忍的。</p>
<p>本文将从ACID基础讲起，逐步深入到分布式事务的解决方案，重点讲解TCC模式的实现原理，并提供一个完整的可运行项目。</p>
<h3 data-id="heading-2">一、什么是ACID？</h3>
<p>在学习分布式事务之前，我们首先需要理解什么是ACID。ACID是数据库事务的四个基本特性，是保证数据一致性的基石。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/860eea9e4c8e4b6fbf378e95f51918c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771376593&amp;x-signature=yMihIAiJEZ6TR82igN%2BQCukhH%2Fs%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-3">1.1 原子性（Atomicity）</h4>
<p>原子性是指事务中的所有操作要么全部成功，要么全部失败回滚。就像转账操作，扣款和入账必须同时成功或同时失败，不能出现扣款成功但入账失败的情况。</p>
<h4 data-id="heading-4">1.2 一致性（Consistency）</h4>
<p>一致性是指事务执行前后，数据库必须处于一致的状态。对于转账来说，无论发生什么，两账户的总金额必须保持不变。</p>
<h4 data-id="heading-5">1.3 隔离性（Isolation）</h4>
<p>隔离性是指多个事务并发执行时，每个事务都感觉不到其他事务的存在。隔离性可以防止脏读、不可重复读、幻读等问题。</p>
<h4 data-id="heading-6">1.4 持久性（Durability）</h4>
<p>持久性是指事务一旦提交，对数据的修改就是永久性的，即使系统崩溃也不会丢失。</p>
<hr/>
<h3 data-id="heading-7">二、分布式事务面临的挑战</h3>
<p>在单体应用中，我们可以通过数据库的本地事务（如MySQL的InnoDB引擎）轻松实现ACID。但在分布式系统中，情况变得复杂得多。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/096f784a27d74b70b6fe1fe9dcd3f7d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771376593&amp;x-signature=CAj94wwwNlAc1mSynTpePAcvKdE%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-8">2.1 网络不可靠</h4>
<p>在分布式系统中，网络是不可靠的。请求可能丢失、延迟、重复，节点之间的通信随时可能失败。</p>
<h4 data-id="heading-9">2.2 节点独立性</h4>
<p>每个服务有独立的数据库，本地事务只能保证单个服务的数据一致性，无法跨服务保证。</p>
<h4 data-id="heading-10">2.3 部分失败</h4>
<p>分布式操作中，可能出现部分成功、部分失败的情况。例如：A银行扣款成功，但B银行入账失败。</p>
<h4 data-id="heading-11">2.4 数据库隔离</h4>
<p>不同服务的数据库之间无法直接建立事务关系，传统的两阶段提交（2PC）在互联网高并发场景下性能较差。</p>
<h3 data-id="heading-12">三、TCC分布式事务解决方案</h3>
<p>TCC（Try-Confirm-Cancel）是一种应用层的分布式事务解决方案，它将业务逻辑分成三个阶段，通过补偿机制来保证最终一致性。</p>
<h4 data-id="heading-13">3.1 TCC的核心思想</h4>
<p>TCC模式的核心思想是将每个业务操作拆分成三个独立的步骤：</p>
<ol>
<li><strong>Try阶段</strong>：资源检查和预留</li>
<li><strong>Confirm阶段</strong>：确认执行业务操作</li>
<li><strong>Cancel阶段</strong>：取消执行，释放资源</li>
</ol>
<h4 data-id="heading-14">3.2 TCC三阶段详解</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0747f4f8016a42a88bd350e384649bed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771376593&amp;x-signature=OEXv%2B8x24fDY27QvGi7%2Bvnf3TKw%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-15">Try阶段：资源预留</h5>
<p>Try阶段是整个TCC事务的第一步，其主要职责是：</p>
<ul>
<li>检查业务规则是否满足（如账户余额是否充足）</li>
<li>预留所需资源（冻结转账金额）</li>
<li>记录事务状态</li>
</ul>
<p>Try阶段执行成功后，资源被锁定，但实际业务尚未执行。</p>
<p><strong>示例代码</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryExecute</span><span class="hljs-params">(TCCContext context)</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">accountId</span> <span class="hljs-operator">=</span> context.getParam(<span class="hljs-string">"accountId"</span>);
    <span class="hljs-type">Long</span> <span class="hljs-variable">amount</span> <span class="hljs-operator">=</span> context.getParam(<span class="hljs-string">"amount"</span>);

    <span class="hljs-comment">// 1. 检查账户余额</span>
    <span class="hljs-type">Account</span> <span class="hljs-variable">account</span> <span class="hljs-operator">=</span> accountMapper.selectById(accountId);
    <span class="hljs-keyword">if</span> (account.getBalance() &lt; amount + account.getFrozenAmount()) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// 余额不足</span>
    }

    <span class="hljs-comment">// 2. 冻结金额（乐观锁更新）</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">rows</span> <span class="hljs-operator">=</span> accountMapper.freezeAmount(accountId, amount, account.getVersion());
    <span class="hljs-keyword">if</span> (rows &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// 3. 创建冻结记录</span>
        <span class="hljs-type">FreezeRecord</span> <span class="hljs-variable">record</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FreezeRecord</span>();
        record.setTransactionId(context.getTransactionId());
        record.setAccountId(accountId);
        record.setAmount(amount);
        record.setStatus(<span class="hljs-number">0</span>); <span class="hljs-comment">// 冻结中</span>
        freezeRecordMapper.insert(record);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<h5 data-id="heading-16">Confirm阶段：确认执行</h5>
<p>Confirm阶段在所有分支的Try都成功后执行，主要职责是：</p>
<ul>
<li>执行实际业务操作（扣减余额、增加余额）</li>
<li>释放预留资源</li>
<li>更新事务状态为CONFIRMED</li>
</ul>
<p>Confirm阶段必须支持幂等性，因为网络问题可能导致重复调用。</p>
<p><strong>示例代码</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">confirmExecute</span><span class="hljs-params">(TCCContext context)</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">accountId</span> <span class="hljs-operator">=</span> context.getParam(<span class="hljs-string">"accountId"</span>);
    <span class="hljs-type">Long</span> <span class="hljs-variable">amount</span> <span class="hljs-operator">=</span> context.getParam(<span class="hljs-string">"amount"</span>);

    <span class="hljs-comment">// 1. 幂等性检查</span>
    <span class="hljs-type">FreezeRecord</span> <span class="hljs-variable">record</span> <span class="hljs-operator">=</span> freezeRecordMapper.selectValidRecord(context.getTransactionId(), accountId);
    <span class="hljs-keyword">if</span> (record == <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// 已确认过，直接返回成功</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-comment">// 2. 扣减余额和冻结金额</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">rows</span> <span class="hljs-operator">=</span> accountMapper.confirmDeduct(accountId, amount, account.getVersion());
    <span class="hljs-keyword">if</span> (rows &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// 3. 更新冻结记录状态</span>
        freezeRecordMapper.updateStatus(context.getTransactionId(), accountId, <span class="hljs-number">1</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<h5 data-id="heading-17">Cancel阶段：取消执行</h5>
<p>Cancel阶段在任意分支Try失败时执行，主要职责是：</p>
<ul>
<li>释放已预留的资源</li>
<li>回滚业务操作</li>
<li>更新事务状态为CANCELLED</li>
</ul>
<p>Cancel阶段同样需要支持幂等性，并支持空回滚（Try未执行时Cancel也能成功）。</p>
<p><strong>示例代码</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">cancelExecute</span><span class="hljs-params">(TCCContext context)</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">accountId</span> <span class="hljs-operator">=</span> context.getParam(<span class="hljs-string">"accountId"</span>);

    <span class="hljs-comment">// 1. 幂等性检查</span>
    <span class="hljs-type">FreezeRecord</span> <span class="hljs-variable">record</span> <span class="hljs-operator">=</span> freezeRecordMapper.selectValidRecord(context.getTransactionId(), accountId);
    <span class="hljs-keyword">if</span> (record == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// 空回滚：没有冻结记录也视为成功</span>
    }

    <span class="hljs-comment">// 2. 释放冻结金额</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">rows</span> <span class="hljs-operator">=</span> accountMapper.releaseFreeze(accountId, record.getAmount(), account.getVersion());
    <span class="hljs-keyword">if</span> (rows &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// 3. 更新冻结记录状态</span>
        freezeRecordMapper.updateStatus(context.getTransactionId(), accountId, <span class="hljs-number">2</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<h3 data-id="heading-18">四、TCC状态机设计</h3>
<p>TCC事务有明确的状态转换流程，通过状态机可以清晰地管理事务生命周期。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0e49f77b2ca4705ad3a64759f9a2cb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771376593&amp;x-signature=3AJ8Pvlw5Ls7y%2BTZOplxHKW5EjM%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-19">4.1 状态定义</h4>













































<table><thead><tr><th>状态</th><th>说明</th><th>是否终态</th></tr></thead><tbody><tr><td>IDLE</td><td>空闲状态，事务初始状态</td><td>否</td></tr><tr><td>TRYING</td><td>Try阶段执行中</td><td>否</td></tr><tr><td>CONFIRMING</td><td>Confirm阶段执行中</td><td>否</td></tr><tr><td>CANCELLING</td><td>Cancel阶段执行中</td><td>否</td></tr><tr><td>CONFIRMED</td><td>事务已确认（成功）</td><td>是</td></tr><tr><td>CANCELLED</td><td>事务已取消（回滚）</td><td>是</td></tr><tr><td>TIMEOUT</td><td>事务超时</td><td>是</td></tr></tbody></table>
<h4 data-id="heading-20">4.2 状态转换规则</h4>
<pre><code class="hljs language-objectivec" lang="objectivec">IDLE → TRYING：开始执行Try阶段
TRYING → CONFIRMING：所有分支Try成功
TRYING → <span class="hljs-built_in">CANCELLING</span>：任一分支Try失败
TRYING → TIMEOUT：Try阶段超时
CONFIRMING → CONFIRMED：Confirm阶段成功
<span class="hljs-built_in">CANCELLING</span> → <span class="hljs-built_in">CANCELLED</span>：Cancel阶段完成
TIMEOUT → <span class="hljs-built_in">CANCELLING</span>：超时后触发回滚
</code></pre>
<hr/>
<h3 data-id="heading-21">五、系统架构设计</h3>
<p>一个完整的TCC分布式事务系统需要合理的架构设计。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ee28958d6be48968540b71149d36e4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771376593&amp;x-signature=PsArLvRURQ0Q0jXhchi3XR%2BS6BM%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-22">5.1 架构分层</h4>
<ol>
<li><strong>展示层</strong>：提供用户界面和API接口</li>
<li><strong>服务层</strong>：实现业务逻辑和TCC协调</li>
<li><strong>数据层</strong>：持久化事务状态和业务数据</li>
<li><strong>定时任务层</strong>：处理超时事务和重试</li>
</ol>
<h4 data-id="heading-23">5.2 核心组件</h4>
<h5 data-id="heading-24">TCCTransactionManager（事务管理器）</h5>
<p>负责协调整个TCC事务的执行流程：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TCCTransactionManager</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">executeTransaction</span><span class="hljs-params">(TCCContext context, List&lt;TCCTransactionService&gt; participants)</span> {
        <span class="hljs-comment">// 1. Try阶段</span>
        <span class="hljs-keyword">if</span> (!tryPhase(context, participants)) {
            cancelPhase(context, participants); <span class="hljs-comment">// Try失败，执行Cancel</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-comment">// 2. Confirm阶段</span>
        <span class="hljs-keyword">return</span> confirmPhase(context, participants);
    }
}
</code></pre>
<h5 data-id="heading-25">AccountTCCService（账户TCC服务）</h5>
<p>实现账户相关的TCC操作，包括冻结、扣款、释放等。</p>
<h5 data-id="heading-26">TCCTransactionScheduledTask（定时任务）</h5>
<p>处理超时事务和重试逻辑：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Scheduled(fixedDelay = 5000)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">scanTimeoutTransactions</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 扫描超时事务并处理</span>
    List&lt;TCCTransaction&gt; expired = tccTransactionMapper.selectExpiredTransactions(
        System.currentTimeMillis(), <span class="hljs-number">100</span>);

    <span class="hljs-keyword">for</span> (TCCTransaction record : expired) {
        handleTimeoutTransaction(record);
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-27">六、转账业务完整流程</h3>
<p>下面以跨行转账为例，展示完整的TCC执行流程。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/edb36c66ad244f66a030e8dc314bfb44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771376593&amp;x-signature=RpuP0Jec9O7ciuSO2Dy22OPKglg%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-28">6.1 流程说明</h4>
<ol>
<li>
<p><strong>发起转账</strong></p>
<ul>
<li>用户发起转账请求</li>
<li>生成全局唯一的事务ID</li>
<li>创建TCC事务上下文</li>
</ul>
</li>
<li>
<p><strong>Try阶段</strong></p>
<ul>
<li>转出账户：冻结1000元</li>
<li>转入账户：预留1000元额度</li>
<li>两个Try都成功后进入Confirm阶段</li>
</ul>
</li>
<li>
<p><strong>Confirm阶段</strong></p>
<ul>
<li>转出账户：扣减1000元余额，释放冻结</li>
<li>转入账户：增加1000元余额</li>
<li>更新事务状态为CONFIRMED</li>
</ul>
</li>
<li>
<p><strong>异常处理</strong></p>
<ul>
<li>如果Try失败，执行Cancel释放资源</li>
<li>如果Confirm失败，记录日志并重试</li>
<li>如果超时未完成，定时任务介入处理</li>
</ul>
</li>
</ol>
<h4 data-id="heading-29">6.2 事务管理器执行代码</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">executeTransaction</span><span class="hljs-params">(TCCContext context, List&lt;TCCTransactionService&gt; participants)</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">txId</span> <span class="hljs-operator">=</span> context.getTransactionId();
    log.info(<span class="hljs-string">"【TCC】开始执行事务: {}, 参与者数量: {}"</span>, txId, participants.size());

    <span class="hljs-comment">// 设置超时时间（默认5分钟）</span>
    <span class="hljs-keyword">if</span> (context.getExpireTime() == <span class="hljs-literal">null</span>) {
        context.setExpireTime(System.currentTimeMillis() + <span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>);
    }

    <span class="hljs-comment">// 持久化事务记录</span>
    saveTransactionRecord(context);

    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 1. Try阶段：资源预留</span>
        <span class="hljs-keyword">if</span> (!tryPhase(context, participants)) {
            log.warn(<span class="hljs-string">"【TCC】Try阶段失败，开始Cancel: {}"</span>, txId);
            cancelPhase(context, participants);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-comment">// 2. Confirm阶段：确认执行</span>
        log.info(<span class="hljs-string">"【TCC】Try阶段成功，开始Confirm: {}"</span>, txId);
        <span class="hljs-keyword">return</span> confirmPhase(context, participants);

    } <span class="hljs-keyword">catch</span> (Exception e) {
        log.error(<span class="hljs-string">"【TCC】事务执行异常: {}"</span>, txId, e);
        cancelPhase(context, participants);
        <span class="hljs-keyword">throw</span> e;
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-30">七、高性能设计要点</h3>
<p>为了保证系统在高并发场景下的性能，我们采用了以下优化策略：</p>
<h4 data-id="heading-31">7.1 乐观锁控制并发</h4>
<p>使用数据库version字段实现乐观锁，避免长事务阻塞：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">UPDATE</span> account <span class="hljs-keyword">SET</span> frozen_amount <span class="hljs-operator">=</span> frozen_amount <span class="hljs-operator">+</span> #{amount},
    version <span class="hljs-operator">=</span> version <span class="hljs-operator">+</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">WHERE</span> account_id <span class="hljs-operator">=</span> #{accountId} <span class="hljs-keyword">AND</span> version <span class="hljs-operator">=</span> #{version}
    <span class="hljs-keyword">AND</span> balance <span class="hljs-operator">&gt;=</span> #{amount}
</code></pre>
<h4 data-id="heading-32">7.2 幂等性设计</h4>
<p>所有TCC操作都支持幂等，通过唯一的事务ID和状态判断：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 幂等性检查</span>
<span class="hljs-type">FreezeRecord</span> <span class="hljs-variable">existRecord</span> <span class="hljs-operator">=</span> freezeRecordMapper.selectValidRecord(txId, accountId);
<span class="hljs-keyword">if</span> (existRecord != <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// 已执行过，直接返回成功</span>
}
</code></pre>
<h4 data-id="heading-33">7.3 本地缓存+数据库持久化</h4>
<p>使用ConcurrentHashMap作为L1缓存，减少数据库查询：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcurrentHashMap&lt;String, TCCContext&gt; localCache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();

<span class="hljs-keyword">public</span> TCCContext <span class="hljs-title function_">getContext</span><span class="hljs-params">(String transactionId)</span> {
    <span class="hljs-comment">// 先查本地缓存</span>
    <span class="hljs-type">TCCContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> localCache.get(transactionId);
    <span class="hljs-keyword">if</span> (context != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> context;
    }
    <span class="hljs-comment">// 查数据库</span>
    <span class="hljs-type">TCCTransaction</span> <span class="hljs-variable">record</span> <span class="hljs-operator">=</span> tccTransactionMapper.selectById(transactionId);
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<h4 data-id="heading-34">7.4 随机退避避免重试风暴</h4>
<p>乐观锁冲突时使用随机退避策略：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">randomBackoff</span><span class="hljs-params">(<span class="hljs-type">int</span> retry)</span> {
    <span class="hljs-keyword">if</span> (retry &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-type">long</span> <span class="hljs-variable">sleepMs</span> <span class="hljs-operator">=</span> ThreadLocalRandom.current().nextLong(<span class="hljs-number">10</span>, <span class="hljs-number">50</span> * (retry + <span class="hljs-number">1</span>));
        Thread.sleep(sleepMs);
    }
}
</code></pre>
<h3 data-id="heading-35">八、项目实战</h3>
<h4 data-id="heading-36">8.1 数据库设计</h4>
<p><strong>账户表（account）</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> account (
    account_id     <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">PRIMARY</span> KEY,
    account_name   <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    balance        <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,        <span class="hljs-comment">-- 余额(分)</span>
    frozen_amount  <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,        <span class="hljs-comment">-- 冻结金额(分)</span>
    status         TINYINT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,       <span class="hljs-comment">-- 状态</span>
    version        <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,           <span class="hljs-comment">-- 乐观锁版本</span>
    create_time    DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    update_time    DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>
);
</code></pre>
<p><strong>TCC事务表（tcc_transaction）</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> tcc_transaction (
    transaction_id   <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">PRIMARY</span> KEY,
    business_type    <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    status           TINYINT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,     <span class="hljs-comment">-- 0-IDLE 1-TRYING 2-CONFIRMING...</span>
    expire_time      <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    retry_count      <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,
    max_retry_count  <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">5</span>,
    business_params  TEXT,
    create_time      DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    update_time      DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    INDEX idx_status_expire (status, expire_time)
);
</code></pre>
<p><strong>冻结记录表（freeze_record）</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> freeze_record (
    id              <span class="hljs-type">BIGINT</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY,
    transaction_id  <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    account_id      <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    amount          <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    operation_type  <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,    <span class="hljs-comment">-- FREEZE或RESERVE</span>
    status          TINYINT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,  <span class="hljs-comment">-- 0-冻结中 1-已确认 2-已取消</span>
    create_time     DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    <span class="hljs-keyword">UNIQUE</span> KEY uk_tx_account (transaction_id, account_id)
);
</code></pre>
<h4 data-id="heading-37">8.2 前端页面展示（1）</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94c1f5f02c214bbf8962bc2fd4b9f099~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771376593&amp;x-signature=Txq%2FuNKYSRXBFsclxLt%2B6D6E5lo%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-38">8.2 前端页面展示（2）</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7729f4fb199c48bb944f9f539a292f98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771376593&amp;x-signature=EiJJCsUOLauNf60YwXt7utKm4A0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-39">九、常见问题与解决方案</h3>
<h4 data-id="heading-40">Q1：TCC与2PC有什么区别？</h4>






























<table><thead><tr><th>特性</th><th>TCC</th><th>2PC</th></tr></thead><tbody><tr><td>锁定时间</td><td>Try阶段短时间锁定</td><td>直到提交才释放</td></tr><tr><td>性能</td><td>较高，无长时间阻塞</td><td>较低，需要长时间锁资源</td></tr><tr><td>一致性</td><td>最终一致</td><td>强一致</td></tr><tr><td>实现复杂度</td><td>高，需要业务支持</td><td>低，数据库支持</td></tr></tbody></table>
<h4 data-id="heading-41">Q2：如何处理空回滚？</h4>
<p>空回滚是指Try还没执行，Cancel就先到了。解决方案：</p>
<ul>
<li>Cancel执行时先检查是否有冻结记录</li>
<li>如果没有记录，直接返回成功（幂等）</li>
</ul>
<h4 data-id="heading-42">Q3：如何处理悬挂？</h4>
<p>悬挂是指Cancel先于Try执行，导致Try执行后资源无法释放。解决方案：</p>
<ul>
<li>Cancel执行时创建一条"已取消"记录</li>
<li>Try执行时检查是否存在"已取消"记录，如果存在则拒绝执行</li>
</ul>
<h4 data-id="heading-43">Q4：Confirm失败怎么办？</h4>
<p>Confirm失败后：</p>
<ul>
<li>记录失败日志</li>
<li>增加重试计数</li>
<li>定时任务扫描并重试</li>
<li>超过最大重试次数后转为人工处理</li>
</ul>
<h3 data-id="heading-44">十、总结</h3>
<p>TCC分布式事务通过将业务操作拆分成Try、Confirm、Cancel三个阶段，在保证最终一致性的同时，提供了较好的性能表现。</p>
<h4 data-id="heading-45">TCC的优势</h4>
<ol>
<li><strong>性能好</strong>：相比2PC，锁资源时间短</li>
<li><strong>可靠性高</strong>：通过补偿机制保证最终一致性</li>
<li><strong>跨数据库</strong>：不依赖特定数据库特性</li>
</ol>
<h4 data-id="heading-46">TCC的挑战</h4>
<ol>
<li><strong>代码侵入性强</strong>：每个业务需要实现三个接口</li>
<li><strong>开发成本高</strong>：需要考虑幂等、空回滚、悬挂等边界情况</li>
<li><strong>状态管理复杂</strong>：需要妥善管理事务状态</li>
</ol>
<h4 data-id="heading-47">适用场景</h4>
<ul>
<li>金融转账、支付场景</li>
<li>库存扣减与订单创建</li>
<li>积分兑换、优惠券核销</li>
<li>任何需要强一致性的跨服务业务操作</li>
</ul>
<blockquote>
<p>***# 跨行转账如何保证数据一致性？TCC分布式事务从入门到实战</p>
</blockquote>
<h3 data-id="heading-48">引言</h3>
<p>在当今互联网架构中，分布式系统已成为主流。当一笔转账需要跨多个银行、跨多个账户、甚至跨多个微服务时，如何保证数据的一致性就成了一个极具挑战性的问题。</p>
<p>想象这样一个场景：用户要从A银行转账1000元到B银行。这看似简单的操作，在分布式系统中需要完成以下步骤：</p>
<ol>
<li>从A银行账户扣减1000元</li>
<li>通过银行间清算网络进行清算</li>
<li>向B银行账户增加1000元</li>
</ol>
<p>如果在这个过程中任何一步出现故障——网络中断、服务器宕机、数据库崩溃——就会导致数据不一致，这是金融系统绝对不能容忍的。</p>
<p>本文将从ACID基础讲起，逐步深入到分布式事务的解决方案，重点讲解TCC模式的实现原理，并提供一个完整的可运行项目。</p>
<blockquote>
<hr/>
</blockquote>
<h3 data-id="heading-49">一、什么是ACID？</h3>
<p>在学习分布式事务之前，我们首先需要理解什么是ACID。ACID是数据库事务的四个基本特性，是保证数据一致性的基石。
<img src="https://files.mdnice.com/user/161125/3f072c55-abe9-4068-b01c-c69c2fb04ff4.png" alt="" loading="lazy"/></p>
<h4 data-id="heading-50">1.1 原子性（Atomicity）</h4>
<p>原子性是指事务中的所有操作要么全部成功，要么全部失败回滚。就像转账操作，扣款和入账必须同时成功或同时失败，不能出现扣款成功但入账失败的情况。</p>
<h4 data-id="heading-51">1.2 一致性（Consistency）</h4>
<p>一致性是指事务执行前后，数据库必须处于一致的状态。对于转账来说，无论发生什么，两账户的总金额必须保持不变。</p>
<h4 data-id="heading-52">1.3 隔离性（Isolation）</h4>
<p>隔离性是指多个事务并发执行时，每个事务都感觉不到其他事务的存在。隔离性可以防止脏读、不可重复读、幻读等问题。</p>
<h4 data-id="heading-53">1.4 持久性（Durability）</h4>
<p>持久性是指事务一旦提交，对数据的修改就是永久性的，即使系统崩溃也不会丢失。</p>
<hr/>
<h3 data-id="heading-54">二、分布式事务面临的挑战</h3>
<p>在单体应用中，我们可以通过数据库的本地事务（如MySQL的InnoDB引擎）轻松实现ACID。但在分布式系统中，情况变得复杂得多。
<img src="https://files.mdnice.com/user/161125/7c260177-1fbc-45c5-83c2-6b88eabe4fd7.png" alt="" loading="lazy"/></p>
<h4 data-id="heading-55">2.1 网络不可靠</h4>
<p>在分布式系统中，网络是不可靠的。请求可能丢失、延迟、重复，节点之间的通信随时可能失败。</p>
<h4 data-id="heading-56">2.2 节点独立性</h4>
<p>每个服务有独立的数据库，本地事务只能保证单个服务的数据一致性，无法跨服务保证。</p>
<h4 data-id="heading-57">2.3 部分失败</h4>
<p>分布式操作中，可能出现部分成功、部分失败的情况。例如：A银行扣款成功，但B银行入账失败。</p>
<h4 data-id="heading-58">2.4 数据库隔离</h4>
<p>不同服务的数据库之间无法直接建立事务关系，传统的两阶段提交（2PC）在互联网高并发场景下性能较差。</p>
<h3 data-id="heading-59">三、TCC分布式事务解决方案</h3>
<p>TCC（Try-Confirm-Cancel）是一种应用层的分布式事务解决方案，它将业务逻辑分成三个阶段，通过补偿机制来保证最终一致性。</p>
<h4 data-id="heading-60">3.1 TCC的核心思想</h4>
<p>TCC模式的核心思想是将每个业务操作拆分成三个独立的步骤：</p>
<ol>
<li><strong>Try阶段</strong>：资源检查和预留</li>
<li><strong>Confirm阶段</strong>：确认执行业务操作</li>
<li><strong>Cancel阶段</strong>：取消执行，释放资源</li>
</ol>
<h4 data-id="heading-61">3.2 TCC三阶段详解</h4>
<p><img src="https://files.mdnice.com/user/161125/586e3600-925f-4ec0-afba-b2361cef9004.png" alt="" loading="lazy"/></p>
<h5 data-id="heading-62">Try阶段：资源预留</h5>
<p>Try阶段是整个TCC事务的第一步，其主要职责是：</p>
<ul>
<li>检查业务规则是否满足（如账户余额是否充足）</li>
<li>预留所需资源（冻结转账金额）</li>
<li>记录事务状态</li>
</ul>
<p>Try阶段执行成功后，资源被锁定，但实际业务尚未执行。</p>
<p><strong>示例代码</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryExecute</span><span class="hljs-params">(TCCContext context)</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">accountId</span> <span class="hljs-operator">=</span> context.getParam(<span class="hljs-string">"accountId"</span>);
    <span class="hljs-type">Long</span> <span class="hljs-variable">amount</span> <span class="hljs-operator">=</span> context.getParam(<span class="hljs-string">"amount"</span>);

    <span class="hljs-comment">// 1. 检查账户余额</span>
    <span class="hljs-type">Account</span> <span class="hljs-variable">account</span> <span class="hljs-operator">=</span> accountMapper.selectById(accountId);
    <span class="hljs-keyword">if</span> (account.getBalance() &lt; amount + account.getFrozenAmount()) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// 余额不足</span>
    }

    <span class="hljs-comment">// 2. 冻结金额（乐观锁更新）</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">rows</span> <span class="hljs-operator">=</span> accountMapper.freezeAmount(accountId, amount, account.getVersion());
    <span class="hljs-keyword">if</span> (rows &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// 3. 创建冻结记录</span>
        <span class="hljs-type">FreezeRecord</span> <span class="hljs-variable">record</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FreezeRecord</span>();
        record.setTransactionId(context.getTransactionId());
        record.setAccountId(accountId);
        record.setAmount(amount);
        record.setStatus(<span class="hljs-number">0</span>); <span class="hljs-comment">// 冻结中</span>
        freezeRecordMapper.insert(record);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<h5 data-id="heading-63">Confirm阶段：确认执行</h5>
<p>Confirm阶段在所有分支的Try都成功后执行，主要职责是：</p>
<ul>
<li>执行实际业务操作（扣减余额、增加余额）</li>
<li>释放预留资源</li>
<li>更新事务状态为CONFIRMED</li>
</ul>
<p>Confirm阶段必须支持幂等性，因为网络问题可能导致重复调用。</p>
<p><strong>示例代码</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">confirmExecute</span><span class="hljs-params">(TCCContext context)</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">accountId</span> <span class="hljs-operator">=</span> context.getParam(<span class="hljs-string">"accountId"</span>);
    <span class="hljs-type">Long</span> <span class="hljs-variable">amount</span> <span class="hljs-operator">=</span> context.getParam(<span class="hljs-string">"amount"</span>);

    <span class="hljs-comment">// 1. 幂等性检查</span>
    <span class="hljs-type">FreezeRecord</span> <span class="hljs-variable">record</span> <span class="hljs-operator">=</span> freezeRecordMapper.selectValidRecord(context.getTransactionId(), accountId);
    <span class="hljs-keyword">if</span> (record == <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// 已确认过，直接返回成功</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-comment">// 2. 扣减余额和冻结金额</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">rows</span> <span class="hljs-operator">=</span> accountMapper.confirmDeduct(accountId, amount, account.getVersion());
    <span class="hljs-keyword">if</span> (rows &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// 3. 更新冻结记录状态</span>
        freezeRecordMapper.updateStatus(context.getTransactionId(), accountId, <span class="hljs-number">1</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<h5 data-id="heading-64">Cancel阶段：取消执行</h5>
<p>Cancel阶段在任意分支Try失败时执行，主要职责是：</p>
<ul>
<li>释放已预留的资源</li>
<li>回滚业务操作</li>
<li>更新事务状态为CANCELLED</li>
</ul>
<p>Cancel阶段同样需要支持幂等性，并支持空回滚（Try未执行时Cancel也能成功）。</p>
<p><strong>示例代码</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">cancelExecute</span><span class="hljs-params">(TCCContext context)</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">accountId</span> <span class="hljs-operator">=</span> context.getParam(<span class="hljs-string">"accountId"</span>);

    <span class="hljs-comment">// 1. 幂等性检查</span>
    <span class="hljs-type">FreezeRecord</span> <span class="hljs-variable">record</span> <span class="hljs-operator">=</span> freezeRecordMapper.selectValidRecord(context.getTransactionId(), accountId);
    <span class="hljs-keyword">if</span> (record == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// 空回滚：没有冻结记录也视为成功</span>
    }

    <span class="hljs-comment">// 2. 释放冻结金额</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">rows</span> <span class="hljs-operator">=</span> accountMapper.releaseFreeze(accountId, record.getAmount(), account.getVersion());
    <span class="hljs-keyword">if</span> (rows &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// 3. 更新冻结记录状态</span>
        freezeRecordMapper.updateStatus(context.getTransactionId(), accountId, <span class="hljs-number">2</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<h3 data-id="heading-65">四、TCC状态机设计</h3>
<p>TCC事务有明确的状态转换流程，通过状态机可以清晰地管理事务生命周期。
<img src="https://files.mdnice.com/user/161125/22c3b230-f3f5-49d2-89bd-4ca48d077fd4.png" alt="" loading="lazy"/></p>
<h4 data-id="heading-66">4.1 状态定义</h4>













































<table><thead><tr><th>状态</th><th>说明</th><th>是否终态</th></tr></thead><tbody><tr><td>IDLE</td><td>空闲状态，事务初始状态</td><td>否</td></tr><tr><td>TRYING</td><td>Try阶段执行中</td><td>否</td></tr><tr><td>CONFIRMING</td><td>Confirm阶段执行中</td><td>否</td></tr><tr><td>CANCELLING</td><td>Cancel阶段执行中</td><td>否</td></tr><tr><td>CONFIRMED</td><td>事务已确认（成功）</td><td>是</td></tr><tr><td>CANCELLED</td><td>事务已取消（回滚）</td><td>是</td></tr><tr><td>TIMEOUT</td><td>事务超时</td><td>是</td></tr></tbody></table>
<h4 data-id="heading-67">4.2 状态转换规则</h4>
<pre><code class="hljs language-objectivec" lang="objectivec">IDLE → TRYING：开始执行Try阶段
TRYING → CONFIRMING：所有分支Try成功
TRYING → <span class="hljs-built_in">CANCELLING</span>：任一分支Try失败
TRYING → TIMEOUT：Try阶段超时
CONFIRMING → CONFIRMED：Confirm阶段成功
<span class="hljs-built_in">CANCELLING</span> → <span class="hljs-built_in">CANCELLED</span>：Cancel阶段完成
TIMEOUT → <span class="hljs-built_in">CANCELLING</span>：超时后触发回滚
</code></pre>
<hr/>
<h3 data-id="heading-68">五、系统架构设计</h3>
<p>一个完整的TCC分布式事务系统需要合理的架构设计。</p>
<p><img src="https://files.mdnice.com/user/161125/b663664f-0332-4252-b395-491f00590cc1.png" alt="" loading="lazy"/></p>
<h4 data-id="heading-69">5.1 架构分层</h4>
<ol>
<li><strong>展示层</strong>：提供用户界面和API接口</li>
<li><strong>服务层</strong>：实现业务逻辑和TCC协调</li>
<li><strong>数据层</strong>：持久化事务状态和业务数据</li>
<li><strong>定时任务层</strong>：处理超时事务和重试</li>
</ol>
<h4 data-id="heading-70">5.2 核心组件</h4>
<h5 data-id="heading-71">TCCTransactionManager（事务管理器）</h5>
<p>负责协调整个TCC事务的执行流程：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TCCTransactionManager</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">executeTransaction</span><span class="hljs-params">(TCCContext context, List&lt;TCCTransactionService&gt; participants)</span> {
        <span class="hljs-comment">// 1. Try阶段</span>
        <span class="hljs-keyword">if</span> (!tryPhase(context, participants)) {
            cancelPhase(context, participants); <span class="hljs-comment">// Try失败，执行Cancel</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-comment">// 2. Confirm阶段</span>
        <span class="hljs-keyword">return</span> confirmPhase(context, participants);
    }
}
</code></pre>
<h5 data-id="heading-72">AccountTCCService（账户TCC服务）</h5>
<p>实现账户相关的TCC操作，包括冻结、扣款、释放等。</p>
<h5 data-id="heading-73">TCCTransactionScheduledTask（定时任务）</h5>
<p>处理超时事务和重试逻辑：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Scheduled(fixedDelay = 5000)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">scanTimeoutTransactions</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 扫描超时事务并处理</span>
    List&lt;TCCTransaction&gt; expired = tccTransactionMapper.selectExpiredTransactions(
        System.currentTimeMillis(), <span class="hljs-number">100</span>);

    <span class="hljs-keyword">for</span> (TCCTransaction record : expired) {
        handleTimeoutTransaction(record);
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-74">六、转账业务完整流程</h3>
<p>下面以跨行转账为例，展示完整的TCC执行流程。
<img src="https://files.mdnice.com/user/161125/b500e12c-a29c-4b7b-8bc9-70bb0d042f1f.png" alt="" loading="lazy"/></p>
<h4 data-id="heading-75">6.1 流程说明</h4>
<ol>
<li>
<p><strong>发起转账</strong></p>
<ul>
<li>用户发起转账请求</li>
<li>生成全局唯一的事务ID</li>
<li>创建TCC事务上下文</li>
</ul>
</li>
<li>
<p><strong>Try阶段</strong></p>
<ul>
<li>转出账户：冻结1000元</li>
<li>转入账户：预留1000元额度</li>
<li>两个Try都成功后进入Confirm阶段</li>
</ul>
</li>
<li>
<p><strong>Confirm阶段</strong></p>
<ul>
<li>转出账户：扣减1000元余额，释放冻结</li>
<li>转入账户：增加1000元余额</li>
<li>更新事务状态为CONFIRMED</li>
</ul>
</li>
<li>
<p><strong>异常处理</strong></p>
<ul>
<li>如果Try失败，执行Cancel释放资源</li>
<li>如果Confirm失败，记录日志并重试</li>
<li>如果超时未完成，定时任务介入处理</li>
</ul>
</li>
</ol>
<h4 data-id="heading-76">6.2 事务管理器执行代码</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">executeTransaction</span><span class="hljs-params">(TCCContext context, List&lt;TCCTransactionService&gt; participants)</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">txId</span> <span class="hljs-operator">=</span> context.getTransactionId();
    log.info(<span class="hljs-string">"【TCC】开始执行事务: {}, 参与者数量: {}"</span>, txId, participants.size());

    <span class="hljs-comment">// 设置超时时间（默认5分钟）</span>
    <span class="hljs-keyword">if</span> (context.getExpireTime() == <span class="hljs-literal">null</span>) {
        context.setExpireTime(System.currentTimeMillis() + <span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>);
    }

    <span class="hljs-comment">// 持久化事务记录</span>
    saveTransactionRecord(context);

    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 1. Try阶段：资源预留</span>
        <span class="hljs-keyword">if</span> (!tryPhase(context, participants)) {
            log.warn(<span class="hljs-string">"【TCC】Try阶段失败，开始Cancel: {}"</span>, txId);
            cancelPhase(context, participants);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-comment">// 2. Confirm阶段：确认执行</span>
        log.info(<span class="hljs-string">"【TCC】Try阶段成功，开始Confirm: {}"</span>, txId);
        <span class="hljs-keyword">return</span> confirmPhase(context, participants);

    } <span class="hljs-keyword">catch</span> (Exception e) {
        log.error(<span class="hljs-string">"【TCC】事务执行异常: {}"</span>, txId, e);
        cancelPhase(context, participants);
        <span class="hljs-keyword">throw</span> e;
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-77">七、高性能设计要点</h3>
<p>为了保证系统在高并发场景下的性能，我们采用了以下优化策略：</p>
<h4 data-id="heading-78">7.1 乐观锁控制并发</h4>
<p>使用数据库version字段实现乐观锁，避免长事务阻塞：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">UPDATE</span> account <span class="hljs-keyword">SET</span> frozen_amount <span class="hljs-operator">=</span> frozen_amount <span class="hljs-operator">+</span> #{amount},
    version <span class="hljs-operator">=</span> version <span class="hljs-operator">+</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">WHERE</span> account_id <span class="hljs-operator">=</span> #{accountId} <span class="hljs-keyword">AND</span> version <span class="hljs-operator">=</span> #{version}
    <span class="hljs-keyword">AND</span> balance <span class="hljs-operator">&gt;=</span> #{amount}
</code></pre>
<h4 data-id="heading-79">7.2 幂等性设计</h4>
<p>所有TCC操作都支持幂等，通过唯一的事务ID和状态判断：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 幂等性检查</span>
<span class="hljs-type">FreezeRecord</span> <span class="hljs-variable">existRecord</span> <span class="hljs-operator">=</span> freezeRecordMapper.selectValidRecord(txId, accountId);
<span class="hljs-keyword">if</span> (existRecord != <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// 已执行过，直接返回成功</span>
}
</code></pre>
<h4 data-id="heading-80">7.3 本地缓存+数据库持久化</h4>
<p>使用ConcurrentHashMap作为L1缓存，减少数据库查询：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcurrentHashMap&lt;String, TCCContext&gt; localCache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();

<span class="hljs-keyword">public</span> TCCContext <span class="hljs-title function_">getContext</span><span class="hljs-params">(String transactionId)</span> {
    <span class="hljs-comment">// 先查本地缓存</span>
    <span class="hljs-type">TCCContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> localCache.get(transactionId);
    <span class="hljs-keyword">if</span> (context != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> context;
    }
    <span class="hljs-comment">// 查数据库</span>
    <span class="hljs-type">TCCTransaction</span> <span class="hljs-variable">record</span> <span class="hljs-operator">=</span> tccTransactionMapper.selectById(transactionId);
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<h4 data-id="heading-81">7.4 随机退避避免重试风暴</h4>
<p>乐观锁冲突时使用随机退避策略：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">randomBackoff</span><span class="hljs-params">(<span class="hljs-type">int</span> retry)</span> {
    <span class="hljs-keyword">if</span> (retry &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-type">long</span> <span class="hljs-variable">sleepMs</span> <span class="hljs-operator">=</span> ThreadLocalRandom.current().nextLong(<span class="hljs-number">10</span>, <span class="hljs-number">50</span> * (retry + <span class="hljs-number">1</span>));
        Thread.sleep(sleepMs);
    }
}
</code></pre>
<h3 data-id="heading-82">八、项目实战</h3>
<h4 data-id="heading-83">8.1 数据库设计</h4>
<p><strong>账户表（account）</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> account (
    account_id     <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">PRIMARY</span> KEY,
    account_name   <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    balance        <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,        <span class="hljs-comment">-- 余额(分)</span>
    frozen_amount  <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,        <span class="hljs-comment">-- 冻结金额(分)</span>
    status         TINYINT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,       <span class="hljs-comment">-- 状态</span>
    version        <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,           <span class="hljs-comment">-- 乐观锁版本</span>
    create_time    DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    update_time    DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>
);
</code></pre>
<p><strong>TCC事务表（tcc_transaction）</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> tcc_transaction (
    transaction_id   <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">PRIMARY</span> KEY,
    business_type    <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    status           TINYINT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,     <span class="hljs-comment">-- 0-IDLE 1-TRYING 2-CONFIRMING...</span>
    expire_time      <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    retry_count      <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,
    max_retry_count  <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">5</span>,
    business_params  TEXT,
    create_time      DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    update_time      DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    INDEX idx_status_expire (status, expire_time)
);
</code></pre>
<p><strong>冻结记录表（freeze_record）</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> freeze_record (
    id              <span class="hljs-type">BIGINT</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY,
    transaction_id  <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    account_id      <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    amount          <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    operation_type  <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,    <span class="hljs-comment">-- FREEZE或RESERVE</span>
    status          TINYINT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,  <span class="hljs-comment">-- 0-冻结中 1-已确认 2-已取消</span>
    create_time     DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    <span class="hljs-keyword">UNIQUE</span> KEY uk_tx_account (transaction_id, account_id)
);
</code></pre>
<h4 data-id="heading-84">8.2 前端页面展示（1）</h4>
<p><img src="https://files.mdnice.com/user/161125/d1d95160-65bc-4ff2-8fce-bb44300f6a05.png" alt="" loading="lazy"/></p>
<h4 data-id="heading-85">8.2 前端页面展示（2）</h4>
<p><img src="https://files.mdnice.com/user/161125/31f08c62-b306-499b-ad91-e1f5f7a06c9f.png" alt="" loading="lazy"/></p>
<h3 data-id="heading-86">九、常见问题与解决方案</h3>
<h4 data-id="heading-87">Q1：TCC与2PC有什么区别？</h4>






























<table><thead><tr><th>特性</th><th>TCC</th><th>2PC</th></tr></thead><tbody><tr><td>锁定时间</td><td>Try阶段短时间锁定</td><td>直到提交才释放</td></tr><tr><td>性能</td><td>较高，无长时间阻塞</td><td>较低，需要长时间锁资源</td></tr><tr><td>一致性</td><td>最终一致</td><td>强一致</td></tr><tr><td>实现复杂度</td><td>高，需要业务支持</td><td>低，数据库支持</td></tr></tbody></table>
<h4 data-id="heading-88">Q2：如何处理空回滚？</h4>
<p>空回滚是指Try还没执行，Cancel就先到了。解决方案：</p>
<ul>
<li>Cancel执行时先检查是否有冻结记录</li>
<li>如果没有记录，直接返回成功（幂等）</li>
</ul>
<h4 data-id="heading-89">Q3：如何处理悬挂？</h4>
<p>悬挂是指Cancel先于Try执行，导致Try执行后资源无法释放。解决方案：</p>
<ul>
<li>Cancel执行时创建一条"已取消"记录</li>
<li>Try执行时检查是否存在"已取消"记录，如果存在则拒绝执行</li>
</ul>
<h4 data-id="heading-90">Q4：Confirm失败怎么办？</h4>
<p>Confirm失败后：</p>
<ul>
<li>记录失败日志</li>
<li>增加重试计数</li>
<li>定时任务扫描并重试</li>
<li>超过最大重试次数后转为人工处理</li>
</ul>
<h3 data-id="heading-91">十、总结</h3>
<p>TCC分布式事务通过将业务操作拆分成Try、Confirm、Cancel三个阶段，在保证最终一致性的同时，提供了较好的性能表现。</p>
<h4 data-id="heading-92">TCC的优势</h4>
<ol>
<li><strong>性能好</strong>：相比2PC，锁资源时间短</li>
<li><strong>可靠性高</strong>：通过补偿机制保证最终一致性</li>
<li><strong>跨数据库</strong>：不依赖特定数据库特性</li>
</ol>
<h4 data-id="heading-93">TCC的挑战</h4>
<ol>
<li><strong>代码侵入性强</strong>：每个业务需要实现三个接口</li>
<li><strong>开发成本高</strong>：需要考虑幂等、空回滚、悬挂等边界情况</li>
<li><strong>状态管理复杂</strong>：需要妥善管理事务状态</li>
</ol>
<h4 data-id="heading-94">适用场景</h4>
<ul>
<li>金融转账、支付场景</li>
<li>库存扣减与订单创建</li>
<li>积分兑换、优惠券核销</li>
<li>任何需要强一致性的跨服务业务操作</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用 AI 写 Android 需求：少踩坑的实战心得]]></title>    <link>https://juejin.cn/post/7604964464690184255</link>    <guid>https://juejin.cn/post/7604964464690184255</guid>    <pubDate>2026-02-10T17:24:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604964464690184255" data-draft-id="7605051978872307731" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用 AI 写 Android 需求：少踩坑的实战心得"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-02-10T17:24:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="陆业聪"/> <meta itemprop="url" content="https://juejin.cn/user/13629904404157"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用 AI 写 Android 需求：少踩坑的实战心得
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/13629904404157/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    陆业聪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T17:24:15.000Z" title="Tue Feb 10 2026 17:24:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">先说结论</h2>
<p>用 AI 写 Android 代码这事，我折腾了一段时间，最大的感受就是——<strong>AI 写出来的代码质量，八成取决于你怎么"喂"它</strong>。</p>
<p>很多人第一次用的时候都会觉得"哇好厉害"，第二次就开始骂"这写的什么玩意"。其实不是 AI 变笨了，是你第一次恰好问了一个它训练数据里烂大街的问题（比如写个 RecyclerView adapter），第二次碰到了你项目里特有的逻辑，它就开始胡编了。</p>
<p>所以这篇文章不是教你怎么用 AI 工具，而是聊聊<strong>怎么才能让 AI 生成的代码真正能用，而不是看着像那么回事、一跑就崩</strong>。</p>
<hr/>
<h2 data-id="heading-1">一、最重要的一件事：让 AI 知道你的项目长什么样</h2>
<p>这一点怎么强调都不过分。</p>
<p>你想想，你让一个刚入职的校招生写代码，你不给他看项目代码、不告诉他架构分层、不说命名规范，他写出来的东西能直接用吗？AI 也一样，甚至比校招生更需要这些信息——因为校招生好歹会自己翻翻项目，AI 不会，你不喂它就真的不知道。</p>
<p><strong>具体怎么做：</strong></p>
<p>把你项目中<strong>已有的同类代码</strong>直接贴给它当范例。比如要新写一个 Service，就把已有的 <code>DepartmentService.java</code> 丢给它，跟它说"照着这个风格来"。这比你用文字描述半天架构有用得多。</p>
<p>再比如我们项目里日志统一用 <code>WwLog.i(TAG, msg)</code>，你不说的话 AI 百分百给你写成 <code>Log.d("tag", "xxx")</code>——它又不知道你项目里有自己的日志工具。</p>
<hr/>
<h2 data-id="heading-2">二、需求一定要拆，别一口气让它全写了</h2>
<p>我之前犯过一个错误：需求评审完，我直接把 PRD 里一整段功能描述丢给 AI，让它"帮我实现一下"。结果它确实洋洋洒洒给我生成了好几个文件，但代码之间的调用关系是乱的，数据模型和后端接口也对不上，基本等于白写。</p>
<p>后来摸索出来的经验是：<strong>按"数据模型 → Service/Repository → ViewModel → UI"的顺序，一步一步来</strong>。</p>
<p>每生成一步就编译一下，确认没问题再继续。这样做看起来慢，实际上比一把梭然后花两小时 debug 快多了。</p>
<p>举个例子，假设需求是做一个会议预约功能：</p>
<pre><code class="hljs language-scss" lang="scss">第一步：先定义 MeetingInfo 数据类，把 proto 文件里的字段贴给 AI
第二步：在 MeetingPluginService 里加 <span class="hljs-built_in">createMeeting</span>() 方法
第三步：注册到 ServiceManager（告诉 AI 参考现有的注册方式）
第四步：写 ViewModel
第五步：写 UI
</code></pre>
<p>每一步都是小的、可以独立验证的。AI 最擅长的就是这种"边界清晰、上下文充足"的小任务。</p>
<hr/>
<h2 data-id="heading-3">三、Android 的坑，你不提 AI 是真的不会注意</h2>
<p>这是我吃过很多次亏之后的总结。AI 对 Android 开发有一些"系统性盲区"，以下这些你不在 prompt 里主动提醒，它大概率会忽略：</p>
<p><strong>生命周期问题</strong>：AI 经常在回调里直接更新 UI，完全不管 Activity 是不是已经被回收了。我之前让它写的一个网络回调，线上直接崩了一片——就是因为页面已经 destroy 了，回调还在往 TextView 上 setText。现在我每次让它写异步逻辑，都会加一句"需要检查生命周期状态，页面销毁后不执行 UI 操作"。</p>
<p><strong>线程问题</strong>：AI 生成的代码有时候会把网络请求写在主线程，有时候在子线程里直接操作 View。你得明确告诉它"网络请求走 IO 线程，UI 更新切回主线程"，最好直接告诉它用协程还是 RxJava，别让它自己选。</p>
<p><strong>RecyclerView 复用</strong>：这个坑经典到不行了。AI 写 <code>onBindViewHolder</code> 的时候，很喜欢只设置"有值"的情况，不处理"没值"的情况，导致滑动的时候数据错乱。每次涉及列表，我都会提醒"在 onBindViewHolder 中重置所有控件状态"。</p>
<p><strong>Context 使用</strong>：让 AI 写单例或者工具类的时候，它特别喜欢持有 Activity Context，内存泄漏就这么来的。</p>
<p>说实话这些坑，对有经验的 Android 开发来说都是常识。但问题是 <strong>AI 没有经验，它只有训练数据</strong>。你得把你的经验"翻译"成它能理解的指令。</p>
<hr/>
<h2 data-id="heading-4">四、一个容易被忽视的大杀器：让 AI 反过来审查代码</h2>
<p>代码写完之后不要急着提交，把生成的代码再丢给 AI，让它扮演 Code Reviewer 的角色：</p>
<ul>
<li>"检查这段代码有没有空指针风险"</li>
<li>"这里有没有线程安全问题"</li>
<li>"跟这个 proto 定义对一下，字段映射齐不齐"</li>
</ul>
<p>我实际操作下来，这一步能发现大概 30% 的问题。有点像自己写完文章再通读一遍——写的时候沉浸在逻辑里容易忽略细节，换个视角就能看到。</p>
<p>当然 AI 审查也不是万能的，<strong>业务逻辑对不对这事还是得你自己把关</strong>。AI 能帮你抓空指针、抓线程问题、抓资源泄漏，但它判断不了"这个场景下到底应该弹 Toast 还是弹 Dialog"。</p>
<hr/>
<h2 data-id="heading-5">五、把团队踩过的坑沉淀成"AI 规则"</h2>
<p>这是我觉得 ROI 最高的一个动作。</p>
<p>很多 AI 工具支持项目级的配置文件（比如 <code>.cursorrules</code>、<code>.codebuddy/rules</code>），你可以在里面写上团队的编码规范和历史教训。这样每次 AI 生成代码的时候，这些规则会自动作为上下文注入，不用每次都手动提醒。</p>
<p>比如我们项目之前踩过的坑：</p>
<ul>
<li><code>TopBarView</code> 里 <code>setPadding</code> 没考虑 RTL 布局导致阿拉伯语环境下界面错乱，后来统一改成了 <code>setPaddingRelative</code></li>
<li><code>ExternalPayService</code> 的回调没做生命周期检查，页面关了回调还在执行，直接崩</li>
</ul>
<p>这种项目特有的坑，你不写下来，每个新需求 AI 都有可能再踩一遍。写进规则文件里，一劳永逸。</p>
<hr/>
<h2 data-id="heading-6">六、我现在的工作流</h2>
<pre><code class="hljs">拿到需求
  ↓
拆成 5~8 个小步骤
  ↓
每个步骤准备好上下文（范例代码 + proto + 约束条件）
  ↓
让 AI 逐步生成，每步编译验证
  ↓
生成完让 AI 自查一轮
  ↓
自己再过一遍业务逻辑
  ↓
提交
</code></pre>
<p>整个流程跑下来，我的感受是：<strong>写代码的时间确实缩短了不少，但省下来的时间大部分花在了"准备上下文"和"验证结果"上</strong>。总体效率提升大概在 30%~50%，主要看需求的复杂度——越是模式化的代码（CRUD、列表页、表单页），AI 的加速效果越明显；越是涉及复杂业务逻辑和边界条件的，人工介入越多。</p>
<hr/>
<h2 data-id="heading-7">最后说两句</h2>
<p>AI 编程工具发展很快，但至少在现阶段，它的定位更像是一个<strong>特别能干但需要详细指导的初级开发</strong>。你给它清晰的上下文、明确的约束、合理的任务粒度，它就能输出高质量的代码；你要是什么都不说就让它自由发挥，那出来的东西大概率要你花更多时间去修。</p>
<p>说白了，<strong>用好 AI 的关键不是学会什么高级 prompt 技巧，而是把"我脑子里知道但没说出来的东西"整理清楚，显式地告诉它</strong>。这个过程本身，其实也在帮你把需求和技术方案想得更透彻——这算是一个意外的收获。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深夜思考：认知的对齐，才是 9 年技术沉淀的真正分水岭]]></title>    <link>https://juejin.cn/post/7605097326726905902</link>    <guid>https://juejin.cn/post/7605097326726905902</guid>    <pubDate>2026-02-10T16:37:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605097326726905902" data-draft-id="7605107459065217070" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深夜思考：认知的对齐，才是 9 年技术沉淀的真正分水岭"/> <meta itemprop="keywords" content="前端,后端,架构"/> <meta itemprop="datePublished" content="2026-02-10T16:37:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="猪猪拆迁队"/> <meta itemprop="url" content="https://juejin.cn/user/2541726613638973"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深夜思考：认知的对齐，才是 9 年技术沉淀的真正分水岭
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2541726613638973/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    猪猪拆迁队
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T16:37:37.000Z" title="Tue Feb 10 2026 16:37:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"「"}.markdown-body b:after,.markdown-body strong:after{content:"」"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><h2 data-id="heading-0">前言</h2>
<p>早在 5 年前甚至更早，我就在思考：高级之上究竟是什么？很多公司定义的专家，本质上只是在垂直领域扎得更深的高级开发，并未发生认知的质变，这让我困惑了很久。</p>
<p>直到今天，我跳出自我，以第三方视角与 AI 展开了一场深度的讨论。通过不断的自我质疑、反问与思考推演，我终于梳理出了那个迟到多年的答案。</p>
<p>现在，职业的界限已不再是瓶颈，因为我看到的不再是技术的缝隙，而是秩序的闭环。</p>
<h2 data-id="heading-1"><strong>一、 认知的迷茫：为什么“资深”不等于“架构”？</strong></h2>
<p>在职业生涯迈向第 9 年的时候，我曾陷入过一种长期的焦虑：如果仅仅是技能熟练度更高、解决问题更快，那这究竟是经验的增长，还是仅仅将“一年经验重复了九年”？</p>
<p>我曾一度认为，高级开发的顶点就是“专家”——一个无所不能的救火英雄。但在最近的一场深度对话中，我推翻了这个认知。我发现，很多所谓的“资深人士”其实都掉进了一个<strong>资深陷阱</strong>：在已有的机器上，努力把螺丝拧得比别人更专业。但这依然是“手工业思维”。</p>
<h2 data-id="heading-2"><strong>二、 观念的碰撞：专家关注“深度”，而架构定义“秩序”</strong></h2>
<p>在与 AI 的反复辩难中，我曾纠结于专家与架构的界限。最终，我梳理出了那个让我豁然开朗的<strong>认知断层</strong>：</p>
<ul>
<li><strong>高级开发/专家关注“实现”：</strong> 他们的认知边界在于“如何把事情做对”。他们是单兵作战的利刃，追求局部最优。即便强如专家，也只是在既定的框架下，锻造出最锋利的剑，去解决最难的 Bug。</li>
<li><strong>架构关注“定义”：</strong> 架构的视角在于**“如何让事情无法做错”**。架构师不以解决疑难杂症为荣，而以“消灭产生杂症的土壤”为荣。</li>
</ul>
<p><strong>架构不是在框架内跳舞，而是秩序的降临者。</strong> 他通过梳理业务的全链路闭环，设计出一套逻辑契约，从而降维定义了一套“规则”，让所有参与者（人或 AI）只能在规则内高效产出。</p>
<h2 data-id="heading-3"><strong>三、 架构的真相：从“管理代码”到“管理确定性”</strong></h2>
<p>这是我们讨论中最核心的共识：<strong>架构是对不确定性的极限压缩。</strong></p>
<p>在商业交付中，最贵的东西不是代码，而是**“确定性” <strong>。 一个高级开发可能会因为技术难点卡住两周，而架构师具备</strong>全链路的穿透力**。他能从数据源头直达交互终端，在动工前就看清所有潜在的熵增与内耗。</p>
<p>他通过全链路的整合，将破碎的工种边界缝合成一个自运转的闭环。这种能力，让研发流程从“撞运气”变成了“工业化生产”。</p>
<h2 data-id="heading-4"><strong>四、 生产范式的更替：把经验固化为“杠杆”</strong></h2>
<p>高级开发往往在通过消耗自己的时间来换取产出，这是一种线性增长。而架构的核心认知是**“杠杆思维”**。</p>
<p>在 AI 时代，我们不应该亲自去织布。架构师的价值在于：将 9 年积累的对复杂系统的预判能力，转化为一套<strong>标准规范（Spec）</strong> 。</p>
<p>当架构梳理得足够透彻、闭环设计得足够死，AI 就不再是聊天框，而是流水线上的高频执行单元。架构带给公司的不是代码，而是一套**“智造产线”**。</p>
<h2 data-id="heading-5"><strong>五、 结语：认知的对齐，即是终局</strong></h2>
<p>这场深夜思考让我明白，技术人的定价逻辑已经变了。</p>
<p>我不再去卷那些日新月异的工具，我更在意<strong>决策的质量</strong>。公司支付高薪，买的不是你的双手，而是你那双<strong>能看透系统未来三年死活的眼睛</strong>。</p>
<p>当个人的认知完成从“实现”到“定义”、从“专家”到“架构”的对齐时，所谓的职业瓶颈就不复存在。避开深坑、锁定结果——这种全链路的掌控力，才是我 9 年思考后的最终答案。</p>
<p>欢迎讨论。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Claude Code Agent Teams：3个AI同时写代码，底层原理和主流框架对比]]></title>    <link>https://juejin.cn/post/7604678037807988772</link>    <guid>https://juejin.cn/post/7604678037807988772</guid>    <pubDate>2026-02-09T18:06:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604678037807988772" data-draft-id="7604672395626774555" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Claude Code Agent Teams：3个AI同时写代码，底层原理和主流框架对比"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2026-02-09T18:06:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="易安说AI"/> <meta itemprop="url" content="https://juejin.cn/user/4009298287660777"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Claude Code Agent Teams：3个AI同时写代码，底层原理和主流框架对比
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4009298287660777/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    易安说AI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T18:06:38.000Z" title="Mon Feb 09 2026 18:06:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是易安，AI超级个体，大厂程序员二孩奶爸。
Claude Opus 4.6 带来了 Agent Teams 功能，可以让多个 Claude Code 实例并行工作。我用它做了个小项目，踩了一些坑，也顺便把底层原理和市面上几个主流多 Agent 框架做了个对比。这篇文章干货比较多，建议收藏。</p>
<h2 data-id="heading-0">Agent Teams 到底是什么</h2>
<p>简单说就是一个 Lead Agent 可以 spawn 出多个 Teammate Agent，每个 Teammate 是一个<strong>完全独立的 Claude Code 会话实例</strong>，有自己的 200K 上下文窗口，并行处理不同的任务。完成后 Lead Agent 负责集成。</p>
<p>不需要特殊的 CLI 命令，用自然语言告诉 Lead Agent 怎么分工就行。</p>
<p>但这里有个关键点很多教程没讲清楚——Agent Teams 和之前的 Subagents 是两码事：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d94b755334c4410d930d23cb5770fcef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771346791&amp;x-signature=JgKF0y5FJFe8SYvwKzYogq2rMh0%3D" alt="图片" loading="lazy"/></p>
<p>Subagents 更像是"我派你去查个资料回来告诉我"，Agent Teams 则是"我们组个团队一起干"。</p>
<h2 data-id="heading-1">底层原理：Agent Teams 是怎么工作的</h2>
<p>这部分我觉得是理解 Agent Teams 的关键。搞清楚原理，才能知道什么时候该用、怎么用才高效。</p>
<h3 data-id="heading-2">TeammateTool：13 个核心操作</h3>
<p>Agent Teams 的底层是一套叫 TeammateTool 的系统，2026 年 1 月社区开发者 kieranklaassen 在 Claude Code 二进制文件上跑 <code>strings</code> 命令时发现了它——当时功能还被两个门控函数隐藏着。11 天后 Anthropic 就正式发布了。</p>
<p>这套系统包含 13 个操作，分三类，同时配合本地文件系统做状态管理：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a9cb7c0ffb4495bae75f6b5e19b55d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771346791&amp;x-signature=vrZ431AHAlltTpCUQ75DRaXgW04%3D" alt="图片" loading="lazy"/></p>
<p>没有专有云数据库，没有复杂的消息队列。就是 JSON 文件 + 文件锁。并发安全靠原子写入（tempfile + os.replace）和跨平台文件锁。</p>
<p>这意味着你可以直接 <code>cat ~/.claude/tasks/my-team/1.json</code> 看任务状态，甚至手动改它。跟 git 一样，对开发者很友好。</p>
<h3 data-id="heading-3">任务依赖：DAG 图</h3>
<p>任务之间支持依赖关系，形成有向无环图（DAG）。队友完成任务后，依赖它的任务会自动解除阻塞：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e873a43c9b6b4b219ed3c4e30e298bcc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771346791&amp;x-signature=PSM619oiHONam8lF%2FqUYCktS5xo%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-4">通信机制：邮箱系统</h3>
<p>每个队友有个 JSON 格式的收件箱。关键设计——Claude 的文本输出对团队不可见，必须用 <code>write</code> 操作才能让其他队友看到消息。</p>
<p>这很重要：如果 API 队友完成了类型定义，它可以直接通知 UI 队友开工，不需要经过 Lead 中转。测试队友也可以直接请求 API 队友启动开发服务器。这比纯层级汇报灵活很多。</p>
<h3 data-id="heading-5">Spawn 后端：三种运行模式</h3>
<p>系统会自动检测环境选择后端，tmux 是最稳的选择：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0913b5ea4c6645148747d2028f49fd84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771346791&amp;x-signature=nNXvAnZcAZ7o2fM%2FQOD%2FxdxrIFU%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-6">Delegate 模式</h3>
<p>按 <strong>Shift+Tab</strong> 可以把 Lead 切换到 delegate 模式。这个模式下 Lead 只能做协调——生成队友、发消息、管理任务，不能直接改代码。</p>
<p>为什么需要这个？因为 Lead 有时候会"手痒"，明明该分配给队友的任务自己偷偷实现了。delegate 模式是个强制约束。</p>
<h2 data-id="heading-7">开启方式</h2>
<p>在 <code>~/.claude/settings.json</code> 里加两个配置：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"experimental"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"agentTeams"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>推荐在 tmux 里启动，可以看到分屏效果：</p>
<pre><code class="hljs language-arduino" lang="arduino">tmux <span class="hljs-keyword">new</span> -s my-team
claude
</code></pre>
<h2 data-id="heading-8">实战：3个Agent并行写一个记账工具</h2>
<p>我选了一个 Python CLI 记账工具作为测试项目，功能不复杂但可以拆成清晰的并行任务：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1213dd174bb4f099176881cbf461723~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771346791&amp;x-signature=x9tr0%2F5gMc2uFZ26tjW3SsITxUg%3D" alt="图片" loading="lazy"/></p>
<p>每个 Agent 拿到的 prompt 里详细描述了要创建的文件、类名、方法签名、参数类型。三个任务同时发出去，并行执行。</p>
<h3 data-id="heading-9">结果</h3>
<p>三个 Agent 全部完成，总共生成 7 个文件、21 个测试用例。速度确实快——三个 Agent 最慢的那个大概用了不到 3 分钟，如果串行做至少要 6-7 分钟。</p>
<p>跑测试的时候问题来了：8 个模型测试全过，13 个存储测试全挂。</p>
<h2 data-id="heading-10">踩坑：接口契约不一致</h2>
<p>这是多 Agent 并行开发最典型的问题——每个 Agent 独立工作，对同一个接口的理解不完全一致。</p>
<p>三个 Agent 之间出现了 3 类冲突：参数名不同、类型不匹配、返回值 key 名对不上。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c54bc76844034bbf96c871dee9d74a3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771346791&amp;x-signature=3qdcw3WO%2FAVU2C3rWZ86KmAI%2Fno%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-11">修复过程</h2>
<p>修复分两步：</p>
<p>第一步改测试文件 <code>test_storage.py</code>，对齐实际的 storage.py 接口：</p>
<ul>
<li> <code>data_dir=</code> 改成 <code>data_path=Path(...) / "data.json"</code></li>
<li>Category 枚举传 <code>.value</code> 转字符串</li>
<li>date 对象用 <code>str()</code> 转字符串</li>
<li> <code>this_month</code> 改成 <code>monthly_total</code></li>
</ul>
<p>第二步改 <code>cli.py</code>，对齐 models.py 的类型要求：</p>
<ul>
<li> <code>args.category</code> 改成 <code>args.category.value</code></li>
<li>date 对象用 <code>str()</code> 转换</li>
<li>summary 里的 key 名对齐</li>
<li>delete 命令的 ID 类型从 <code>int</code> 改成 <code>str</code>（因为实际用的是 UUID）</li>
</ul>
<p>改完之后 21 个测试全部通过，CLI 也能正常跑了：</p>
<pre><code class="hljs language-ini" lang="ini">✓ 已添加支出: ¥35.50 <span class="hljs-section">[FOOD]</span>
✓ 已添加支出: ¥100.00 <span class="hljs-section">[TRANSPORT]</span>
✓ 已添加支出: ¥299.00 <span class="hljs-section">[SHOPPING]</span>

共 3 条记录，合计: ¥434.50
</code></pre>
<h2 data-id="heading-12">框架对比：Agent Teams vs Oh-My-OpenCode vs BMAD-METHOD</h2>
<p>市面上做多 Agent 编排的框架不少，我重点对比了三个有代表性的：</p>
<h3 data-id="heading-13">Oh-My-OpenCode：希腊神话式的多模型编排</h3>
<p>Oh-My-OpenCode 是给 OpenCode（开源终端 AI 工具）做的插件，GitHub 上有 24000+ Star。它的设计挺有意思——用希腊神话人物命名 11 个 Agent 角色：</p>
<ul>
<li> <strong>Sisyphus</strong>（西西弗斯）：主编排器。名字来自不断推石头上山的神话，意思是你的任务一定会被完成</li>
<li> <strong>Prometheus</strong>（普罗米修斯）：规划师，不是简单拆任务，而是通过"采访"帮你厘清需求</li>
<li> <strong>Hephaestus</strong>（赫菲斯托斯）：自主深度工作者，在写一行代码之前会先并行启动 2-5 个侦察 Agent 做情报收集</li>
<li> <strong>Oracle</strong>：战略顾问，只读不写</li>
</ul>
<p>核心设计是<strong>多模型混合</strong>——Opus 做决策、GPT 做执行、Grok 做搜索、Gemini 做多模态分析。用便宜模型做侦察，贵模型做决策，成本控制比较灵活。</p>
<p>但有个现实问题：2026 年 1 月 Anthropic 限制了第三方 OAuth 访问，明确提到 Oh-My-OpenCode 是封锁原因之一。它之前允许用 Claude Pro/Max 订阅驱动 OpenCode，被认定违反了服务条款。</p>
<h3 data-id="heading-14">BMAD-METHOD：文档驱动的敏捷团队</h3>
<p>BMAD（Breakthrough Method for Agile AI-Driven Development）走了一条完全不同的路——不追求并行速度，追求<strong>流程可控</strong>。</p>
<p>它的核心理念是把 AI 组织成一支完整的敏捷团队：分析师、产品经理、架构师、Scrum Master、开发者、QA。每个角色的定义是版本化的 Markdown/YAML 文件，可以 Git 管理。</p>
<p>开发分两个阶段：</p>
<p><strong>第一阶段：规划</strong>。Analyst 做调研 → PM 写 PRD → Architect 定架构 → Product Owner 对齐验证 → Scrum Master 生成开发故事。整个过程产出的文档就是持久化的上下文。</p>
<p><strong>第二阶段：执行</strong>。开发者 Agent 打开一个故事文件，里面有完整的实现细节、架构指导、设计原理、测试标准。不需要额外沟通，文档即上下文。</p>
<p>BMAD 还有个"文档分片"的概念——把复杂的项目文档拆成原子化的、AI 可消化的片段。这解决了大项目上下文塞不进去的问题。</p>
<p>它是工具无关的，支持 Claude Code、Cursor、Windsurf、GitHub Copilot 等多种 AI IDE。</p>
<h3 data-id="heading-15">三个框架的核心差异</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11b9464f693d4031a721e5682d0e6d15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771346791&amp;x-signature=LpL7TqEZwej3qDAaQ7wL3hTNBac%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-16">怎么选？</h3>
<p><strong>Agent Teams</strong> 适合：已经在用 Claude Code，项目可以清晰拆分并行任务，接口契约比较明确。胜在零配置、原生体验好。</p>
<p><strong>Oh-My-OpenCode</strong> 适合：想混用多个模型控制成本，项目需要复杂的规划-执行分离。但要注意 OAuth 合规问题。</p>
<p><strong>BMAD-METHOD</strong> 适合：大型复杂项目，需要完整的文档链路和角色分工。可以和 Agent Teams 互补——用 BMAD 做规划阶段，用 Agent Teams 做并行执行阶段。</p>
<p>其实这三个方案不互斥。BMAD 可以运行在 Claude Code 之上，Oh-My-OpenCode 的设计理念（多模型混用、层级化 Agent）对 prompt 设计也有参考价值。</p>
<h2 data-id="heading-17">经验总结</h2>
<p><strong>Agent Teams 的优势</strong>：</p>
<ul>
<li>并行确实快，三个 Agent 同时干活，总耗时约等于最慢的那个</li>
<li>队友间可以直接通信，比纯层级汇报灵活</li>
<li>适合拆分清晰的项目：前端/后端/测试、不同模块、不同微服务</li>
</ul>
<p><strong>Agent Teams 的坑</strong>：</p>
<ul>
<li>接口契约是最大的问题。每个 Agent 独立理解需求，即使 prompt 写得很详细，参数名、类型、返回值格式都可能对不上</li>
<li>Token 消耗大。3 个 Agent 的 token 消耗大概是单个的 4-5 倍（Anthropic 研究员 Nicholas Carlini 用 16 个 Agent 写 C 编译器花了 $20,000）</li>
<li>Lead Agent 的集成工作不可省略。并行开发完一定需要一个"粘合"阶段</li>
<li> <code>/resume</code> 暂时不能恢复 teammate 会话</li>
</ul>
<p><strong>建议</strong>：</p>
<ul>
<li>prompt 中尽量用代码片段定义接口，不要只用自然语言描述。直接写 <code>class ExpenseStorage(data_path: Optional[Path] = None)</code>，而不是"构造函数接受可选的目录参数"</li>
<li>Lead 用 Opus 做战略决策，队友用 Sonnet 执行具体任务，可以省一些 token</li>
<li>先用 Plan 模式制定计划（便宜），确认后再交给团队并行执行（贵但快）</li>
<li>用 delegate 模式约束 Lead，防止它越权自己写代码</li>
<li>对于小项目（&lt; 500 行），单 Agent 可能更高效，因为省去了集成成本</li>
<li>Agent Teams 更适合中大型项目，各模块之间接口已经明确定义的场景</li>
<li>官方建议 2-5 个队友、每个队友 5-6 个任务。别贪多，协调开销会吃掉并行收益</li>
</ul>
<hr/>
<p>多 Agent 协作是 AI 辅助开发的下一步，不管用哪个框架，核心问题都是一样的：怎么把"接口契约"定义清楚，怎么在并行效率和协调成本之间找到平衡。跟人类团队协作其实是一个道理——分工越清晰，扯皮越少。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[XMSLEEP：白噪音神器，哄娃睡觉不再难]]></title>    <link>https://juejin.cn/post/7605036907458789427</link>    <guid>https://juejin.cn/post/7605036907458789427</guid>    <pubDate>2026-02-10T16:00:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605036907458789427" data-draft-id="7605036907458773043" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="XMSLEEP：白噪音神器，哄娃睡觉不再难"/> <meta itemprop="keywords" content="开源"/> <meta itemprop="datePublished" content="2026-02-10T16:00:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="修己xj"/> <meta itemprop="url" content="https://juejin.cn/user/2641475936724142"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            XMSLEEP：白噪音神器，哄娃睡觉不再难
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2641475936724142/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    修己xj
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T16:00:00.000Z" title="Tue Feb 10 2026 16:00:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>有宝宝的家长或许都有过类似经历：为了让哭闹的宝宝安静下来，我们不得不长时间举着嗡嗡作响的吹风机，或是让水龙头持续哗哗地流水。这些临时制造的“白噪音”虽然偶尔能短暂起效，却也带来不少困扰：不仅浪费水电、使人疲惫，更因为必须守在旁边而让人感到束手束脚。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/387d9e91a2fa4465a9572432db82a6f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771344094&amp;x-signature=frWZE2QJEcDUzDmtn1eFhnd5OlY%3D" alt="" loading="lazy"/></p>
<p>当我们自己因焦虑或思绪纷乱而难以入睡时，同样渴望有一种能够安抚心神的声音陪伴，却常常找不到合适、方便的工具。</p>
<p>最近，在哄宝宝睡觉的过程中，我对此感受尤为深刻。这种情况几乎每隔几天就会发生——有时候需要特定类型的环境音，有时候则在手机上反复搜索，却始终找不到一个资源丰富、稳定可靠的声音平台。这种低效又麻烦的处境，相信许多人都曾经历过。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d980c09be484384a9bdbe7c50b8b82b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771344094&amp;x-signature=QbbpPXCsTjzwGxIXCxTyyNV9mhE%3D" alt="" loading="lazy"/></p>
<p>为此，我想向大家推荐一款开源 Android 应用——XMSLEEP。它就像一位贴心的“声音管家”，通过软件的力量，为我们打造一个随时可用、稳定且便捷的宁静空间。无论是哄宝宝入睡，还是帮助自己放松心神、对抗失眠，它都能让我们彻底告别以往那些低效又耗神的传统方式，轻松享受科技带来的安宁体验。</p>
<h2 data-id="heading-0">🌿 什么是 XMSLEEP？</h2>
<p><strong>XMSLEEP</strong> 是一个专注于白噪音播放的 Android 应用。它将大自然最纯净、最舒缓的声音装进了你的手机里。无论是淅淅沥沥的雨声、温暖的篝火噼啪声、还是轻柔的雷鸣、猫咪满足的呼噜声，都能在这里找到。它的核心目标就是帮助你——无论你是想放松身心、集中精力工作学习，还是为了获得一个安稳的睡眠。</p>
<p>这款应用采用了最新的 <strong>Material Design 3</strong> 设计规范，界面简洁美观，操作起来非常流畅顺手，让你在寻找宁静的同时，也能享受到视觉上的愉悦。</p>
<p>github地址： <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTosencen%2FXMSLEEP" target="_blank" title="https://github.com/Tosencen/XMSLEEP" ref="nofollow noopener noreferrer">github.com/Tosencen/XM…</a></p>
<p>该项目在github上有<strong>1.1k</strong> star</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c957145c3fbd40b7a021884982d8447b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771344094&amp;x-signature=GMYxxnsVFYZUqDJ%2BlZ0SiAFkPF4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">🚀开始使用</h2>
<p>从github release：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTosencen%2FXMSLEEP%2Freleases" target="_blank" title="https://github.com/Tosencen/XMSLEEP/releases" ref="nofollow noopener noreferrer">github.com/Tosencen/XM…</a> 页面下载最新的软件安装包安装</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4bf864aec94a4318ad5c4b1093c66589~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771344094&amp;x-signature=4tfTcR4tlGU6gRRUddtap%2B0MKSY%3D" alt="" loading="lazy"/></p>
<p>以下是部分使用截图</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f807352905b465e854f1caf81d4eba1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771344094&amp;x-signature=9uhGyKL%2FZQWCn2%2BAO013ISvEjMA%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ba751dd80cb41eab96386a9ecee571c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771344094&amp;x-signature=8iwW%2BErNtHA3fsur5jtaVdP2tYM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">✨ XMSLEEP 为何值得信赖？</h2>
<h3 data-id="heading-3">🎵 丰富多样的白噪音世界</h3>
<ul>
<li>• <strong>多种内置白噪音</strong>：应用内预置了雨声、篝火、雷声、猫咪呼噜、鸟鸣、夜虫等多种精心挑选的自然声音，种类繁多，总有一款能触动你的心弦。</li>
<li>• <strong>网络音频扩展</strong>：不仅仅局限于内置资源，它还支持从网络动态加载更多高质量的音频，让你的“声音库”永不枯竭。</li>
<li>• <strong>本地音频播放</strong>：如果你有自己特别钟爱的音频文件，也可以直接导入并播放，非常灵活。</li>
<li>• <strong>无缝循环播放</strong>：所有音频都支持无缝循环，避免了普通循环带来的“卡顿感”，为你提供真正沉浸式的听觉体验。</li>
<li>• <strong>独立音量控制</strong>：你可以为每个正在播放的声音单独调节音量大小，精确地构建属于你的理想声音环境。</li>
</ul>
<h3 data-id="heading-4">⚙️ 贴心实用的功能设计</h3>
<ul>
<li>• <strong>智能倒计时</strong>：担心自己听着听着就睡过了头？设置一个倒计时，播放会在指定时间后自动停止，让你安心入睡。</li>
<li>• <strong>预设播放区</strong>：支持创建 3 个预设，每个预设最多可保存 10 个常用声音组合。比如，“助眠模式”、“工作专注”、“宝宝安抚”……一键切换，方便快捷。</li>
<li>• <strong>收藏与历史</strong>：喜欢的声音可以收藏，应用重启后还会提示你恢复最近的播放列表，非常人性化。</li>
<li>• <strong>全局浮动按钮</strong>：当有声音在播放时，屏幕边缘会出现一个小小的浮动按钮。点击它可以随时暂停，展开后还能看到当前播放的声音列表，操作极其便捷。</li>
</ul>
<h2 data-id="heading-5">🏠 XMSLEEP 如何改变我们的生活？</h2>
<h3 data-id="heading-6">😌 守护成人的宁静港湾</h3>
<p>其实，需要白噪音的不只是孩子，成年人同样需要。当我们工作压力大、心情焦虑或辗转反侧难以入眠时，XMSLEEP 就是我们的“心灵按摩师”。播放一段雷雨声，仿佛置身于一个安全的避风港；聆听一阵虫鸣鸟叫，仿佛回到了久违的乡野。它帮助我们屏蔽外界的嘈杂，平复内心的波澜，找回那份久违的平静与专注。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae653e913e9845ba8388f70b2fa9594f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771344094&amp;x-signature=GIWZg7%2Bw87a9XmcZRBpl%2BPJ%2FBAo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">📝结语</h2>
<p>总而言之，<strong>XMSLEEP</strong> 不仅仅是一个简单的音乐播放器，它是一个利用软件手段，将自然的疗愈力量带给现代人的优秀工具。它环保、便捷、高效，无论是对于需要安静环境的宝宝，还是寻求内心安宁的大人，都是一个绝佳的选择。快去试试吧，也许，你人生的下一个宁静夜晚，就从 XMSLEEP 开始。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MCP (Model Context Protocol) 技术理解 - 第三篇]]></title>    <link>https://juejin.cn/post/7605042079668518927</link>    <guid>https://juejin.cn/post/7605042079668518927</guid>    <pubDate>2026-02-10T14:10:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605042079668518927" data-draft-id="7604863528944713743" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MCP (Model Context Protocol) 技术理解 - 第三篇"/> <meta itemprop="keywords" content="后端,MCP,AIGC"/> <meta itemprop="datePublished" content="2026-02-10T14:10:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="想用offer打牌"/> <meta itemprop="url" content="https://juejin.cn/user/578781641968972"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MCP (Model Context Protocol) 技术理解 - 第三篇
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/578781641968972/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    想用offer打牌
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T14:10:59.000Z" title="Tue Feb 10 2026 14:10:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.8;font-weight:400;font-size:16px;word-spacing:2px;letter-spacing:2px;overflow-x:hidden;color:#3e3e3e;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:1.2em;border-bottom:2px solid #ef7060;word-spacing:0!important;letter-spacing:0!important;font-size:inherit;line-height:inherit;display:block;font-weight:400;background:#ef7060;color:#fff;padding:10px;border-top-right-radius:3px;border-top-left-radius:3px;margin-right:3px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="monokai">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#272822;color:#ddd}.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-strong,.hljs-tag{color:#f92672}.hljs-code{color:#66d9ef}.hljs-class .hljs-title{color:#fff}.hljs-attribute,.hljs-link,.hljs-regexp,.hljs-symbol{color:#bf79db}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-emphasis,.hljs-section,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-string,.hljs-subst,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:#a6e22e}.hljs-comment,.hljs-deletion,.hljs-meta,.hljs-quote{color:#75715e}.hljs-doctag,.hljs-keyword,.hljs-literal,.hljs-section,.hljs-selector-id,.hljs-selector-tag,.hljs-title,.hljs-type{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<p>在第二篇文章中，我们讲了MCP的通信协议和数据传输。</p>
<p>那么在第三篇文章中，我们就来讲讲<strong>服务端</strong>的核心原语，MCP 原语是 MCP 中最重要的概念。它们定义了<strong>客户端和服务器之间</strong>可以相互提供哪些信息。这些原语明确规定了可以与 <strong>AI 应用共享</strong>的<strong>上下文信息类型以及可以执行的操作范围</strong>。这和我们之前提到的核心能力息息相关，所以看懂这一篇非常重要，让我们接下来一起看看吧。</p>
<p>如果你对前面的内容感兴趣，可以点击这里跳转</p>
<p><a href="https://juejin.cn/post/7604037348607082534" target="_blank" title="https://juejin.cn/post/7604037348607082534">MCP (Model Context Protocol) 技术理解 - 第一篇</a></p>
<p><a href="https://juejin.cn/post/7603721514204495881" target="_blank" title="https://juejin.cn/post/7603721514204495881">MCP (Model Context Protocol) 技术理解 - 第二篇</a></p>
<h2 data-id="heading-1">服务端的三个核心原语</h2>
<p>MCP 定义了<strong>服务器</strong>可以公开的三个核心原语：</p>
<ul>
<li><strong>Tools</strong>：AI应用可以调用用来执行操作的可执行函数（例如，文件操作、API 调用、数据库查询）</li>
<li><strong>Resources</strong>：为AI应用提供上下文信息的数据源（例如，文件内容、数据库记录、API 响应）</li>
<li><strong>Prompts</strong>：可重用的模板，有助于构建与LLM的交互（例如，系统提示、少样本示例）</li>
</ul>
<p>接下来我们来各自详细地介绍三种核心原语：</p>
<h3 data-id="heading-2">Tools</h3>
<p>Tools是定义在模式中的<strong>接口</strong>，LLM可以调用这些接口。MCP 使用 JSON Schema 进行验证。每个Tool都执行单一操作，并具有明确定义的<strong>输入和输出</strong>。工具可能需要在执行前获得用户许可，这有助于确保用户对模型执行的操作保持控制</p>
<p>我们其实在前面已经说的很明白了，LLM可以通过Tools接口来替我们执行操作，而不止于仅仅给我们回复该怎么做。但是要注意的是我们实现Tools接口应该要保持<strong>单一职责原则</strong>，即一个Tool就保证它自己的功能，不要混杂着其他操作在其中。</p>
<p>下面是官方给的Tool的方法：</p>




















<table><thead><tr><th>方法</th><th>目的</th><th>返回</th></tr></thead><tbody><tr><td><code>tools/list</code></td><td>探索可用工具</td><td>包含模式的工具定义数组</td></tr><tr><td><code>tools/call</code></td><td>执行特定工具</td><td>工具执行结果</td></tr></tbody></table>
<p>那么该如何定义一个Tool呢？下面是一个示例：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  name<span class="hljs-punctuation">:</span> <span class="hljs-string">"searchFlights"</span><span class="hljs-punctuation">,</span>
  description<span class="hljs-punctuation">:</span> <span class="hljs-string">"Search for available flights"</span><span class="hljs-punctuation">,</span>
  inputSchema<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    type<span class="hljs-punctuation">:</span> <span class="hljs-string">"object"</span><span class="hljs-punctuation">,</span>
    properties<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      origin<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> type<span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span><span class="hljs-punctuation">,</span> description<span class="hljs-punctuation">:</span> <span class="hljs-string">"Departure city"</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      destination<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> type<span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span><span class="hljs-punctuation">,</span> description<span class="hljs-punctuation">:</span> <span class="hljs-string">"Arrival city"</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      date<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> type<span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span><span class="hljs-punctuation">,</span> format<span class="hljs-punctuation">:</span> <span class="hljs-string">"date"</span><span class="hljs-punctuation">,</span> description<span class="hljs-punctuation">:</span> <span class="hljs-string">"Travel date"</span> <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    required<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"origin"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"destination"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"date"</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>来个示例吧，假如我们想搜索某地到某地的对应日期的所有航班，我们的该如何调用，下面是例子:
查询多家航空公司并返回结构化的航班选项</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">searchFlights</span>(<span class="hljs-attribute">origin</span>: <span class="hljs-string">"NYC"</span>, <span class="hljs-attribute">destination</span>: <span class="hljs-string">"Barcelona"</span>, <span class="hljs-attribute">date</span>: <span class="hljs-string">"2024-06-15"</span>)
</code></pre>
<p>工具由模型控制，这意味着模型可以自动发现并调用它们。但是要注意的是，调用工具是一个很敏感的操作，我们对敏感操作要保证人为监督。</p>
<p>为了确保信任和安全，应用程序可以通过各种机制实现用户控制，例如：</p>
<ul>
<li>在用户界面中显示可用工具，使用户能够定义在特定交互中是否应显示某个工具。</li>
<li>针对单个工具执行的审批对话框</li>
<li>用于预先批准某些安全操作的权限设置。</li>
<li>活动日志显示所有工具执行及其结果</li>
</ul>
<p>通过权限校验和安全性确认，我们就可以保证某些敏感的<strong>Tool calling</strong>不会被滥用。</p>
<h3 data-id="heading-3">Resources</h3>
<p>Resources提供结构化的信息访问，人工智能应用程序可以检索这些信息并将其作为上下文提供给模型。</p>
<p>那么Resources是如何运作的？
Resources可以从文件、API、数据库或AI理解上下文所需的任何其他来源获取数据。应用程序可以直接访问这些信息，并决定如何使用它们——无论是选择相关部分、使用<strong>embedding</strong>进行搜索，还是将所有信息传递给模型。</p>
<p>MCP是如何“发现”Resources的？</p>
<p>Resources支持<strong>两种发现模式</strong>：</p>
<ul>
<li>
<p><strong>直接资源</strong>- 指向特定数据的固定 URI。例如：<code>calendar://events/2024</code>- 返回 2024 年的日历可用性</p>
</li>
<li>
<p><strong>资源模板</strong>——带有参数的动态 URI，可实现灵活的查询。示例：</p>
<ul>
<li><code>travel://activities/{city}/{category}</code>- 按城市和类别返回活动</li>
<li><code>travel://activities/barcelona/museums</code>- 返回巴塞罗那所有博物馆</li>
</ul>
</li>
</ul>
<p>值得注意的是，每个 resource 有<strong>唯一的 URI 标识</strong>，<strong>支持文本和二进制内容</strong>，这里很重要🧐</p>
<p>那么Resources有什么方法？</p>






























<table><thead><tr><th>方法</th><th>目的</th><th>返回</th></tr></thead><tbody><tr><td><code>resources/list</code></td><td>列出可用的直接资源</td><td>资源描述符数组</td></tr><tr><td><code>resources/templates/list</code></td><td>发现资源模板</td><td>资源模板定义数组</td></tr><tr><td><code>resources/read</code></td><td>获取资源内容</td><td>包含元数据的资源数据</td></tr><tr><td><code>resources/subscribe</code></td><td>监控资源变化</td><td>订阅确认</td></tr></tbody></table>
<p>不好懂？我们来看个例子缓解一下:)</p>
<p>以旅行规划为例，资源为AI应用程序提供相关信息的访问权限：</p>
<ul>
<li><strong>日历数据</strong>（<code>calendar://events/2024</code>）- 检查用户日程以保证可行性</li>
<li><strong>旅行证件</strong>（<code>file:///Documents/Travel/passport.pdf</code>）- 获取重要文件</li>
<li><strong>以往行程</strong>（<code>trips://history/barcelona-2023</code>） - 参考过去的旅行和偏好</li>
</ul>
<p>AI 应用会检索这些资源并决定如何处理它们，无论是使用embedding或关键词搜索选择数据子集，还是将原始数据直接传递给模型。在这种情况下，它向模型提供日历数据、天气信息和旅行偏好，使模型能够检查可用性、查找天气模式并参考过去的旅行偏好。</p>
<p><strong>资源模板示例：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"uriTemplate"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"weather://forecast/{city}/{date}"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"weather-forecast"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Weather Forecast"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Get weather forecast for any city and date"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"mimeType"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"application/json"</span>
<span class="hljs-punctuation">}</span>

<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"uriTemplate"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"travel://flights/{origin}/{destination}"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"flight-search"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Flight Search"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Search available flights between cities"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"mimeType"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"application/json"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>这些模板支持灵活的查询方式。例如，用户可以查询任意城市/日期组合的天气预报。对于航班查询，用户可以搜索任意两个机场之间的航线。当用户输入“NYC”作为机场，<code>origin</code>并尝试输入“Bar”作为<code>destination</code>机场时，系统可以建议“巴塞罗那 (BCN)”或“巴巴多斯 (BGI)”</p>
<h3 data-id="heading-4">Prompts</h3>
<p>Prompts提供可重用的模板。它们允许 MCP 服务器作者为域提供参数化提示符，或展示如何最佳地使用 MCP 服务器。</p>
<p>那么Prompts是如何运作的？Prompts是结构化的模板，用于定义预期输入和交互模式。<strong>它们由用户控制，需要显式调用而非自动触发</strong>。Prompts可以感知上下文，引用可用Resource和Tools来创建全面的工作流程。与Resources类似，Prompts支持参数补全，帮助用户发现有效的参数值。</p>




















<table><thead><tr><th>方法</th><th>目的</th><th>返回</th></tr></thead><tbody><tr><td><code>prompts/list</code></td><td>发现可用提示</td><td>提示描述符数组</td></tr><tr><td><code>prompts/get</code></td><td>获取提示详情</td><td>包含参数的完整提示定义</td></tr></tbody></table>
<p>那么Prompts到底有什么用呢？简单来说，prompt是一个预定义的、可重用的提示词模板，能够帮助用户快速调用常见的 AI 交互模式，也就是<strong>为常见任务提供结构化模板</strong>。</p>
<p>这里的关键词是“常见任务”，“结构化模板”。</p>
<p>听不懂？来个例子吧，我们还是以假期规划为例子</p>
<p><strong>我们可以为”计划一次假期“编写以下的prompts</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"plan-vacation"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Plan a vacation"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Guide through vacation planning process"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"arguments"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"destination"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"required"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"duration"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"number"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"days"</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"budget"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"number"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"required"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"interests"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"array"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"items"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>难道我们不支持非结构化的输入输出吗？系统并非不接受非结构化的自然语言输入，而是支持：</p>
<ol>
<li>选择“计划假期”模板</li>
<li>结构化输入：巴塞罗那，7 天，3000 美元，[“海滩”、“建筑”、“美食”]</li>
<li>基于模板的一致工作流程执行</li>
</ol>
<p>prompts由用户控制，需要显式调用。该协议赋予实现者自由，使其能够设计出与应用程序环境相协调的自然界面。其关键原则包括：</p>
<ul>
<li>轻松发现可用prompts</li>
<li>对每个prompts的功能进行清晰描述</li>
<li>自然参数输入及验证</li>
<li>透明显示prompts的底层模板</li>
</ul>
<p>应用程序通常通过各种用户界面模式显示prompts信息，例如：</p>
<ul>
<li>斜杠命令（输入“/”可查看可用提示，例如 /plan-vacation）</li>
<li>用于可搜索访问的命令面板</li>
<li>常用提示的专用用户界面按钮</li>
<li>上下文菜单提供相关提示</li>
</ul>
<p>以notion为例子，这些都是你能直接使用的prompts模板</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec9f1adde5fb46edb06c06ab24619d01~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oOz55Sob2ZmZXLmiZPniYw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771337461&amp;x-signature=FPt%2BoBnBAugwvxeL8t8gBGbv%2BTk%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-5">小结</h2>
<p>这一篇我们讲了服务器的三个核心原语，每一个都在MCP里面发挥至关重要的作用，理解这一块非常重要！下一篇我们讲客户端的核心原语。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MongoDB（4）什么是集合(Collection)？]]></title>    <link>https://juejin.cn/post/7605042079668600847</link>    <guid>https://juejin.cn/post/7605042079668600847</guid>    <pubDate>2026-02-10T14:26:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605042079668600847" data-draft-id="7605042079668584463" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MongoDB（4）什么是集合(Collection)？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-10T14:26:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MongoDB（4）什么是集合(Collection)？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T14:26:09.000Z" title="Tue Feb 10 2026 14:26:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在MongoDB中，集合（Collection）是文档的容器，类似于关系型数据库中的表。一个数据库可以包含多个集合，每个集合包含多个文档。集合没有固定的模式（Schema），这意味着集合中的文档可以具有不同的结构和字段。</p>
<h3 data-id="heading-0">特点</h3>
<ol>
<li><strong>无模式</strong>：集合中的文档不需要预定义结构，可以具有不同的字段和数据类型。</li>
<li><strong>动态创建</strong>：集合在插入第一个文档时自动创建，无需显式创建。</li>
<li><strong>灵活性</strong>：集合可以包含任何数据类型的文档，适用于灵活的数据模型。</li>
</ol>
<h3 data-id="heading-1">示例</h3>
<p>下面的示例展示了MongoDB集合的创建、插入文档、查询、更新和删除操作。</p>
<h4 data-id="heading-2">1. 创建和插入文档到集合</h4>
<p>集合不需要显式创建，它会在插入第一个文档时自动创建。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { <span class="hljs-title class_">MongoClient</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongodb'</span>);
<span class="hljs-keyword">const</span> url = <span class="hljs-string">'mongodb://localhost:27017'</span>;
<span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MongoClient</span>(url);

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">connect</span>();
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Connected to MongoDB"</span>);

        <span class="hljs-keyword">const</span> db = client.<span class="hljs-title function_">db</span>(<span class="hljs-string">'exampledb'</span>);
        <span class="hljs-keyword">const</span> collection = db.<span class="hljs-title function_">collection</span>(<span class="hljs-string">'users'</span>); <span class="hljs-comment">// 创建或选择集合</span>

        <span class="hljs-comment">// 插入文档</span>
        <span class="hljs-keyword">const</span> insertResult = <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">insertOne</span>({
            <span class="hljs-attr">name</span>: <span class="hljs-string">"John Doe"</span>,
            <span class="hljs-attr">email</span>: <span class="hljs-string">"john.doe@example.com"</span>,
            <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>
        });

        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Inserted document:'</span>, insertResult.<span class="hljs-property">ops</span>[<span class="hljs-number">0</span>]);
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">close</span>();
    }
}

<span class="hljs-title function_">run</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">dir</span>);
</code></pre>
<h4 data-id="heading-3">2. 查询集合中的文档</h4>
<p>可以使用各种查询条件来检索集合中的文档。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">findDocuments</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">connect</span>();
        <span class="hljs-keyword">const</span> db = client.<span class="hljs-title function_">db</span>(<span class="hljs-string">'exampledb'</span>);
        <span class="hljs-keyword">const</span> collection = db.<span class="hljs-title function_">collection</span>(<span class="hljs-string">'users'</span>);

        <span class="hljs-comment">// 查询所有文档</span>
        <span class="hljs-keyword">const</span> allUsers = <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">find</span>().<span class="hljs-title function_">toArray</span>();
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'All users:'</span>, allUsers);

        <span class="hljs-comment">// 按条件查询文档</span>
        <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">findOne</span>({ <span class="hljs-attr">email</span>: <span class="hljs-string">"john.doe@example.com"</span> });
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Found user:'</span>, user);
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">close</span>();
    }
}

<span class="hljs-title function_">findDocuments</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">dir</span>);
</code></pre>
<h4 data-id="heading-4">3. 更新集合中的文档</h4>
<p>可以使用更新操作修改集合中的文档。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateDocument</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">connect</span>();
        <span class="hljs-keyword">const</span> db = client.<span class="hljs-title function_">db</span>(<span class="hljs-string">'exampledb'</span>);
        <span class="hljs-keyword">const</span> collection = db.<span class="hljs-title function_">collection</span>(<span class="hljs-string">'users'</span>);

        <span class="hljs-comment">// 更新文档</span>
        <span class="hljs-keyword">const</span> updateResult = <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">updateOne</span>(
            { <span class="hljs-attr">email</span>: <span class="hljs-string">"john.doe@example.com"</span> },
            { <span class="hljs-attr">$set</span>: { <span class="hljs-attr">age</span>: <span class="hljs-number">31</span> } }
        );

        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Updated document count:'</span>, updateResult.<span class="hljs-property">modifiedCount</span>);
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">close</span>();
    }
}

<span class="hljs-title function_">updateDocument</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">dir</span>);
</code></pre>
<h4 data-id="heading-5">4. 删除集合中的文档</h4>
<p>可以使用删除操作从集合中移除文档。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">deleteDocument</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">connect</span>();
        <span class="hljs-keyword">const</span> db = client.<span class="hljs-title function_">db</span>(<span class="hljs-string">'exampledb'</span>);
        <span class="hljs-keyword">const</span> collection = db.<span class="hljs-title function_">collection</span>(<span class="hljs-string">'users'</span>);

        <span class="hljs-comment">// 删除文档</span>
        <span class="hljs-keyword">const</span> deleteResult = <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">deleteOne</span>({ <span class="hljs-attr">email</span>: <span class="hljs-string">"john.doe@example.com"</span> });
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Deleted document count:'</span>, deleteResult.<span class="hljs-property">deletedCount</span>);
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">close</span>();
    }
}

<span class="hljs-title function_">deleteDocument</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">dir</span>);
</code></pre>
<h3 data-id="heading-6">高级操作</h3>
<h4 data-id="heading-7">索引</h4>
<p>可以在集合中创建索引以提高查询性能。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createIndex</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">connect</span>();
        <span class="hljs-keyword">const</span> db = client.<span class="hljs-title function_">db</span>(<span class="hljs-string">'exampledb'</span>);
        <span class="hljs-keyword">const</span> collection = db.<span class="hljs-title function_">collection</span>(<span class="hljs-string">'users'</span>);

        <span class="hljs-comment">// 创建索引</span>
        <span class="hljs-keyword">const</span> indexName = <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">createIndex</span>({ <span class="hljs-attr">email</span>: <span class="hljs-number">1</span> });
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Created index:'</span>, indexName);
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">close</span>();
    }
}

<span class="hljs-title function_">createIndex</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">dir</span>);
</code></pre>
<h4 data-id="heading-8">聚合操作</h4>
<p>可以使用聚合管道对集合中的数据进行复杂的聚合操作。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">aggregateDocuments</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">connect</span>();
        <span class="hljs-keyword">const</span> db = client.<span class="hljs-title function_">db</span>(<span class="hljs-string">'exampledb'</span>);
        <span class="hljs-keyword">const</span> collection = db.<span class="hljs-title function_">collection</span>(<span class="hljs-string">'orders'</span>);

        <span class="hljs-comment">// 插入多个文档</span>
        <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">insertMany</span>([
            { <span class="hljs-attr">product</span>: <span class="hljs-string">"Apple"</span>, <span class="hljs-attr">quantity</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">2.5</span> },
            { <span class="hljs-attr">product</span>: <span class="hljs-string">"Banana"</span>, <span class="hljs-attr">quantity</span>: <span class="hljs-number">5</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">1.2</span> },
            { <span class="hljs-attr">product</span>: <span class="hljs-string">"Orange"</span>, <span class="hljs-attr">quantity</span>: <span class="hljs-number">8</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">3.0</span> }
        ]);

        <span class="hljs-comment">// 使用聚合管道计算总销售额</span>
        <span class="hljs-keyword">const</span> aggregationPipeline = [
            { <span class="hljs-attr">$group</span>: { <span class="hljs-attr">_id</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">total</span>: { <span class="hljs-attr">$sum</span>: { <span class="hljs-attr">$multiply</span>: [<span class="hljs-string">"$quantity"</span>, <span class="hljs-string">"$price"</span>] } } } }
        ];

        <span class="hljs-keyword">const</span> aggResult = <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">aggregate</span>(aggregationPipeline).<span class="hljs-title function_">toArray</span>();
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Total sales:'</span>, aggResult[<span class="hljs-number">0</span>].<span class="hljs-property">total</span>);
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">close</span>();
    }
}

<span class="hljs-title function_">aggregateDocuments</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">dir</span>);
</code></pre>
<h3 data-id="heading-9">总结</h3>
<p>MongoDB的集合提供了一个灵活且高效的方式来组织和管理文档数据。以下是其主要特点和常见操作：</p>









































<table><thead><tr><th>特性</th><th>详细说明</th></tr></thead><tbody><tr><td>无模式</td><td>集合中的文档可以具有不同的结构和字段</td></tr><tr><td>动态创建</td><td>集合在插入第一个文档时自动创建</td></tr><tr><td>灵活性</td><td>集合可以包含任何数据类型的文档</td></tr><tr><td>查询操作</td><td>丰富的查询条件和语法</td></tr><tr><td>更新操作</td><td>支持多种更新操作，如设置、增加、删除字段</td></tr><tr><td>删除操作</td><td>支持按条件删除文档</td></tr><tr><td>索引</td><td>支持多种索引类型，提高查询性能</td></tr><tr><td>聚合操作</td><td>支持复杂的数据聚合和处理</td></tr></tbody></table>
<p>通过实际代码示例，可以直观地了解如何在MongoDB中使用集合进行数据存储和管理，从而更好地应用于实际项目开发中。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MongoDB（5）MongoDB中的数据库(Database)是什么？]]></title>    <link>https://juejin.cn/post/7605042079668617231</link>    <guid>https://juejin.cn/post/7605042079668617231</guid>    <pubDate>2026-02-10T14:26:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605042079668617231" data-draft-id="7604863528944959503" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MongoDB（5）MongoDB中的数据库(Database)是什么？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-10T14:26:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MongoDB（5）MongoDB中的数据库(Database)是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T14:26:37.000Z" title="Tue Feb 10 2026 14:26:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在MongoDB中，数据库（Database）是用于组织和管理集合（Collections）及其数据的容器。一个MongoDB实例可以包含多个数据库，每个数据库包含多个集合，每个集合又包含多个文档。数据库用于逻辑上分离数据，并提供独立的命名空间和权限管理。</p>
<h3 data-id="heading-0">特点</h3>
<ol>
<li><strong>独立性</strong>：每个数据库是独立的命名空间，可以包含自己的一组集合。</li>
<li><strong>权限管理</strong>：可以针对不同数据库设置不同的访问权限。</li>
<li><strong>分离逻辑</strong>：用于将不同应用或模块的数据逻辑上分离，便于管理和维护。</li>
</ol>
<h3 data-id="heading-1">MongoDB中的数据库操作</h3>
<p>下面的示例展示了如何在MongoDB中创建、访问、列出和删除数据库。</p>
<h4 data-id="heading-2">1. 创建和访问数据库</h4>
<p>在MongoDB中，数据库是在首次使用其中的集合时自动创建的。您可以通过MongoClient连接到MongoDB实例，并选择或创建一个数据库。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { <span class="hljs-title class_">MongoClient</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongodb'</span>);
<span class="hljs-keyword">const</span> url = <span class="hljs-string">'mongodb://localhost:27017'</span>;
<span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MongoClient</span>(url);

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">connect</span>();
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Connected to MongoDB"</span>);

        <span class="hljs-comment">// 选择数据库，如果数据库不存在则创建</span>
        <span class="hljs-keyword">const</span> db = client.<span class="hljs-title function_">db</span>(<span class="hljs-string">'exampledb'</span>);

        <span class="hljs-comment">// 创建集合并插入文档</span>
        <span class="hljs-keyword">const</span> collection = db.<span class="hljs-title function_">collection</span>(<span class="hljs-string">'users'</span>);
        <span class="hljs-keyword">const</span> insertResult = <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">insertOne</span>({
            <span class="hljs-attr">name</span>: <span class="hljs-string">"John Doe"</span>,
            <span class="hljs-attr">email</span>: <span class="hljs-string">"john.doe@example.com"</span>,
            <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>
        });

        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Inserted document:'</span>, insertResult.<span class="hljs-property">ops</span>[<span class="hljs-number">0</span>]);
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">close</span>();
    }
}

<span class="hljs-title function_">run</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">dir</span>);
</code></pre>
<h4 data-id="heading-3">2. 列出数据库</h4>
<p>可以列出当前MongoDB实例中的所有数据库。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">listDatabases</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">connect</span>();
        <span class="hljs-keyword">const</span> adminDb = client.<span class="hljs-title function_">db</span>().<span class="hljs-title function_">admin</span>();

        <span class="hljs-comment">// 列出所有数据库</span>
        <span class="hljs-keyword">const</span> databasesList = <span class="hljs-keyword">await</span> adminDb.<span class="hljs-title function_">listDatabases</span>();
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Databases:'</span>);
        databasesList.<span class="hljs-property">databases</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">db</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">` - <span class="hljs-subst">${db.name}</span>`</span>));
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">close</span>();
    }
}

<span class="hljs-title function_">listDatabases</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">dir</span>);
</code></pre>
<h4 data-id="heading-4">3. 删除数据库</h4>
<p>可以删除一个数据库及其所有集合和文档。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">dropDatabase</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">connect</span>();
        <span class="hljs-keyword">const</span> db = client.<span class="hljs-title function_">db</span>(<span class="hljs-string">'exampledb'</span>);

        <span class="hljs-comment">// 删除数据库</span>
        <span class="hljs-keyword">const</span> dropResult = <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">dropDatabase</span>();
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Database dropped:'</span>, dropResult);
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">close</span>();
    }
}

<span class="hljs-title function_">dropDatabase</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">dir</span>);
</code></pre>
<h4 data-id="heading-5">4. 数据库中的集合操作</h4>
<p>可以在数据库中创建、列出、更新和删除集合。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">collectionOperations</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">connect</span>();
        <span class="hljs-keyword">const</span> db = client.<span class="hljs-title function_">db</span>(<span class="hljs-string">'exampledb'</span>);

        <span class="hljs-comment">// 创建集合</span>
        <span class="hljs-keyword">const</span> collection = db.<span class="hljs-title function_">collection</span>(<span class="hljs-string">'products'</span>);
        <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">insertOne</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">"Laptop"</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">1000</span> });

        <span class="hljs-comment">// 列出所有集合</span>
        <span class="hljs-keyword">const</span> collections = <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">listCollections</span>().<span class="hljs-title function_">toArray</span>();
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Collections:'</span>);
        collections.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">col</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">` - <span class="hljs-subst">${col.name}</span>`</span>));

        <span class="hljs-comment">// 更新集合中的文档</span>
        <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">updateOne</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">"Laptop"</span> }, { <span class="hljs-attr">$set</span>: { <span class="hljs-attr">price</span>: <span class="hljs-number">900</span> } });

        <span class="hljs-comment">// 删除集合</span>
        <span class="hljs-keyword">const</span> dropResult = <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">drop</span>();
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Collection dropped:'</span>, dropResult);
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">close</span>();
    }
}

<span class="hljs-title function_">collectionOperations</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">dir</span>);
</code></pre>
<h3 data-id="heading-6">高级操作</h3>
<h4 data-id="heading-7">备份和恢复数据库</h4>
<p>可以使用MongoDB的<code>mongodump</code>和<code>mongorestore</code>工具备份和恢复数据库。</p>
<p><strong>备份数据库：</strong></p>
<pre><code class="hljs language-bash" lang="bash">mongodump --db exampledb --out /path/to/backup
</code></pre>
<p><strong>恢复数据库：</strong></p>
<pre><code class="hljs language-bash" lang="bash">mongorestore --db exampledb /path/to/backup/exampledb
</code></pre>
<h4 data-id="heading-8">数据库权限管理</h4>
<p>可以为数据库设置用户和角色，以实现权限管理。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createUser</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">connect</span>();
        <span class="hljs-keyword">const</span> db = client.<span class="hljs-title function_">db</span>(<span class="hljs-string">'exampledb'</span>);

        <span class="hljs-comment">// 创建用户并分配角色</span>
        <span class="hljs-keyword">const</span> createUserResult = <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">addUser</span>(<span class="hljs-string">'exampleUser'</span>, <span class="hljs-string">'examplePass'</span>, {
            <span class="hljs-attr">roles</span>: [<span class="hljs-string">'readWrite'</span>]
        });

        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'User created:'</span>, createUserResult);
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">close</span>();
    }
}

<span class="hljs-title function_">createUser</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">dir</span>);
</code></pre>
<h3 data-id="heading-9">总结</h3>
<p>MongoDB中的数据库是组织和管理集合及其数据的逻辑容器，具备独立性和灵活的权限管理功能。以下是其主要特点和常见操作：</p>

































<table><thead><tr><th>特性</th><th>详细说明</th></tr></thead><tbody><tr><td>独立性</td><td>每个数据库是独立的命名空间，包含自己的一组集合</td></tr><tr><td>权限管理</td><td>可以针对不同数据库设置不同的访问权限</td></tr><tr><td>分离逻辑</td><td>用于将不同应用或模块的数据逻辑上分离</td></tr><tr><td>数据备份与恢复</td><td>提供备份和恢复工具，如<code>mongodump</code>和<code>mongorestore</code></td></tr><tr><td>用户和角色管理</td><td>可以为数据库创建用户并分配角色和权限</td></tr><tr><td>集合操作</td><td>支持创建、列出、更新和删除集合</td></tr></tbody></table>
<p>通过实际代码示例，可以直观地了解如何在MongoDB中使用数据库进行数据管理和操作，从而更好地应用于实际项目开发中。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[征程 6 | power management sample]]></title>    <link>https://juejin.cn/post/7604889577938010139</link>    <guid>https://juejin.cn/post/7604889577938010139</guid>    <pubDate>2026-02-10T14:28:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604889577938010139" data-draft-id="7605041556656259081" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="征程 6 | power management sample"/> <meta itemprop="keywords" content="算法,自动驾驶"/> <meta itemprop="datePublished" content="2026-02-10T14:28:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="地平线开发者"/> <meta itemprop="url" content="https://juejin.cn/user/1257497032132567"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            征程 6 | power management sample
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1257497032132567/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    地平线开发者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T14:28:40.000Z" title="Tue Feb 10 2026 14:28:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 功能概述</h2>
<p>本文通过示例演示如何通过相关接口对启动标志进行读写，以及对 main 域电源进行控制与查询。相关 API 定义，请查询 <a href="https://link.juejin.cn?target=http%3A%2F%2F10.106.32.73%2Fdoc%2FLNX-PL4.0-WB-20250724-J6P%2Fcn%2Fhtml%2Fj6_mcu_guide%2Fmcu_mcalcdd%2Fpower_management%2Fpower_management_1_api_v2.html" target="_blank" title="http://10.106.32.73/doc/LNX-PL4.0-WB-20250724-J6P/cn/html/j6_mcu_guide/mcu_mcalcdd/power_management/power_management_1_api_v2.html" ref="nofollow noopener noreferrer">电源管理用户手册 API 部分</a> 。</p>
<h2 data-id="heading-1">2. main 域上下电及状态查询示例代码</h2>
<p>请参考版本中 Service/Cmd_Utility/power_sample_cmd/src/PowerControl.c 相关代码：</p>
<pre><code class="hljs language-Plain" lang="Plain">// PowerControl.c代码
#include "Os.h"
#include "Log.h"
#include "Pmu.h"
#include "Boot.h"
#include "Shell_Port.h"

// main域电源状态定义
#define MAINDOMAIN_STATUS_UNINIT      (0U)
#define MAINDOMAIN_STATUS_RUNNING     (1U)
</code></pre>
<p><strong>注意</strong></p>
<p>注意以下章节中的截图，在不同的版本上可能会有一些差异，只要关键信息部分一致即可。 请结合其中提到的验证方法做进一步确认。</p>
<h3 data-id="heading-2">2.1. MCU 对 Acore 进行上下电接口及命令说明</h3>
<pre><code class="hljs language-Plain" lang="Plain">// 需要包含的头文件
#include "Power_Manager_Cust.h"

// 通知Acore进行下电
hb_PM_RequestSt(MAINSTATE_OFF_ST);

// 对Acore进行强制下电
hb_PM_RequestSt(MAINSTATE_FORCE_OFF_IT);

// 对Acore进行上电
</code></pre>
<p>地平线版本中可使用如下命令：</p>
<pre><code class="hljs language-Plain" lang="Plain">testmainpower 0 # 通知Acore下电，同时会做bootflag和power状态查询
testmainpower forceoff # 对Acore强制下电
testmainpower 1 # 对Acore上电，同时会做bootflag和power状态查询
</code></pre>
<p>效果确认：</p>
<ol>
<li>当对 Acore 进行下电，MCU 会有如下打印：</li>
</ol>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=MmQwYTk2NzAyZTA2ZmYyN2M2ZjIwNWJkMjE5Y2Y3NjRfYXNaTU04Q2I2ajR5NHp6T1hRTHIzb0ZKVzdJWmdxb05fVG9rZW46VmlTWWI0RkZ4b0E2UE94QmFTaWNFNzFCbm1lXzE3NzA3MzMwMjM6MTc3MDczNjYyM19WNA" alt="" loading="lazy"/></p>
<p>此时 MCU 正常，Acore 因为下电串口无法交互；</p>
<ol start="2">
<li>当对 Acore 进行强制下电，MCU 会有如下打印：</li>
</ol>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=MTY3MjQ3ODdlODAxYWM0YTE3OGE0ZjJjZjBjMDc0MzhfZkZseVZ3WW5LWXVsazZ6Z09qcGpEME5OdGhPWlM5SThfVG9rZW46VVBrV2JwalRmb1JwSE14WUlndmNEcWI3bnBoXzE3NzA3MzMwMjM6MTc3MDczNjYyM19WNA" alt="" loading="lazy"/></p>
<p>此时 MCU 正常，Acore 因为下电串口无法交互；</p>
<ol start="3">
<li>当对 Acore 进行上电，MCU 会有很长的打印，MCU 走完相关流程后，会有如下关键打印：</li>
</ol>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=MWUwYWY0MmJjNWY5NDdiOTI5Nzg1NDU0YWUyN2FjMTFfNWowQ2F5MVFORTN0TzdsODdNQjd3aFhQb2J2Z3JZR2ZfVG9rZW46RmJOemJJZ09Ib1JJM3N4d1V1OGNCRnZYbnllXzE3NzA3MzMwMjM6MTc3MDczNjYyM19WNA" alt="" loading="lazy"/></p>
<p>同时 Acore 会进入 kernel：</p>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=NDQ0ZTA5ZmQ0ZTM1MDIzNTZhNTEzY2NhNjczMTgyODdfZlNFVHVCbnBQVmhjOGJ3blF4M09UMGdVNk0zeEJkVlFfVG9rZW46THM0TGI4NjY2b3pJT1l4bnJMRGNDSHJsbkJoXzE3NzA3MzMwMjM6MTc3MDczNjYyM19WNA" alt="" loading="lazy"/></p>
<p>并可以正常进行命令行交互；</p>
<h3 data-id="heading-3">2.2. MCU 读写 bootflag 接口及命令说明</h3>
<pre><code class="hljs language-Plain" lang="Plain">// 需要包含的头文件
#include "Boot.h"

// 设置bootflag
Std_ReturnType Bl_MainDomainBootFlagSet(uint32 Flag);

// 获取bootflag
Std_ReturnType Bl_MainDomainBootFlagGet(uint32 *Flag);
</code></pre>
<p>地平线版本中可使用如下命令：</p>
<pre><code class="hljs language-Plain" lang="Plain">testmainpower 0 # 对Acore下电，同时会做bootflag和power状态查询
testmainpower 1 # 对Acore上电，同时会做bootflag和power状态查询
</code></pre>
<p>效果确认：</p>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=YzNjNDNjNWU0NjQ0MmRlZWFmYTM5YzU0ZDljODQxMGFfdFJIUVFBam4wZ3kwZjBrTDI5RzN0SWlrR25ib0paUVdfVG9rZW46SzVJNmJpQTcyb2JweDF4YldpR2NTOEtsblRjXzE3NzA3MzMwMjM6MTc3MDczNjYyM19WNA" alt="" loading="lazy"/></p>
<p>示例代码中会尝试对 bootflag 进行读取/修改/恢复的流程；后边的数值代表对应 boot 标志，可以查询相关头文件。</p>
<h3 data-id="heading-4">2.3. MCU 获取 Acore power 状态接口及命令说明<a href="https://link.juejin.cn?target=http%3A%2F%2F10.106.32.73%2Fdoc%2FLNX-PL4.0-WB-20250724-J6P%2Fcn%2Fhtml%2Fsample_doc%2Fplatform_samples%2Fsample_doc_platform_samples_power_control.html%23mcuacore-power" target="_blank" title="http://10.106.32.73/doc/LNX-PL4.0-WB-20250724-J6P/cn/html/sample_doc/platform_samples/sample_doc_platform_samples_power_control.html#mcuacore-power" ref="nofollow noopener noreferrer">¶</a></h3>
<pre><code class="hljs language-Plain" lang="Plain">// 需要包含的头文件
#include "Pmu.h"

// 获取main power状态
Std_ReturnType Pmu_MainDomainStatusGet(uint32 *Status);
</code></pre>
<p>地平线版本中可使用如下命令：</p>
<pre><code class="hljs language-Plain" lang="Plain">getmainstatus # main power状态查询
</code></pre>
<p>效果确认：</p>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=NTFjYmE1MzQzYTE5MjdiYjIxNGJiOTU3NjVkZTgyMWFfSmFRbEo1NGhYWmdWd1V2VzZxUWJIcmdVdjF4SkVJdHdfVG9rZW46TzlZUGJRTFJmb0FHeVB4OUZoWGM4eXBJbkNmXzE3NzA3MzMwMjM6MTc3MDczNjYyM19WNA" alt="" loading="lazy"/></p>
<p>示例代码中尝试去获取状态并打印出对应通过函数获取到的 Acore power 状态。</p>
<h2 data-id="heading-5">3. main 域 reset 示例</h2>
<p>调用如下接口后，如果有接 Acore 串口，可以看到 Acore 串口有重启并再次正常进入 kernel，并且 Acore 的命令行可以进行正常交互。</p>
<h3 data-id="heading-6">3.1. main 域 reset 接口说明</h3>
<pre><code class="hljs language-Plain" lang="Plain">// 需要包含的头文件
#include "Power_Manager_Cust.h"

hb_PM_RequestSt(MAINSTATE_RESET_IT);
</code></pre>
<h2 data-id="heading-7">4. 征程 6X 全部下电示例</h2>
<p>调用对应接口，MCU 和 Acore 都下电，两者的命令行都无法进行交互。要想重新启动，需要断电重启。</p>
<h3 data-id="heading-8">4.1. 全部下电接口说明</h3>
<pre><code class="hljs language-Plain" lang="Plain">// 需要包含的头文件
#include "Power_Manager_Cust.h"

hb_PM_RequestSt(SYSSTATE_SHUTDOWN_ST);
</code></pre>
<h2 data-id="heading-9">5. 不同场景休眠唤醒示例代码</h2>
<p>请参考版本中 Service/Cmd_Utility/power_sample_cmd/src/PowerControl.c 相关代码，目前主要实现以下六个场景：</p>
<pre><code class="hljs language-Plain" lang="Plain">horizon:/$ powersample
[0512.790449 0]powersample {index:d} rtc_time:d&gt;
[0512.790824 0]    index: 0: main suspend + mcu suspend + rtc wakeup + shutdown
[0512.791703 0]           1: main off + mcu suspend + rtc wakeup + shutdown
[0512.792538 0]           2: main suspend + mcu suspend + can wakeup + resume
[0512.793395 0]           3: main off + mcu suspend + can wakeup + poweron
[0512.794337 0]           4: main suspend + mcu suspend + rtc wakeup + resume
[0512.795077 0]           5: main off + mcu suspend + rtc wakeup + poweron
</code></pre>
<p>注意：各 sample 场景为都是单独流程，不要混合使用。如果在执行完一个 sample 场景后，需要更换场景测试，需要先进行整机下电，再重新上电。</p>
<p>场景拆分为以下几种流程：</p>
<p>流程 1： main off + mcu suspend:</p>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=YzljM2FlMTQ5MDExYWViMmQ0NzA0M2RmYTI0NmI4M2RfTXB2ZHl3TzNJS0RLM0VnajFwSHlwNldVaXN2TlNxeXZfVG9rZW46UFp4MWJxd3lNb3liU3V4dTBKTWNiS204bk9iXzE3NzA3MzMwMjM6MTc3MDczNjYyM19WNA" alt="" loading="lazy"/></p>
<p>流程 2：main suspend + mcu suspend:</p>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=YTEzNDM2YTdlYTEzMzY1M2Q5ZjIyOTM4OGNmNmY5M2VfMDFqZXplZDY2U05mNVJTeDI1R3RyQmVnN1JTeG1wcUlfVG9rZW46RmVSbWJLdmFpb0hRbmh4blhSeGNrVjVObjRjXzE3NzA3MzMwMjM6MTc3MDczNjYyM19WNA" alt="" loading="lazy"/></p>
<p>流程 3：mcu on + main on:</p>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=OTczNmJiZTJiOTc1Y2IwMzEwZDQwMmRiNGFlOTg3YmNfUnhwMjZSWFdTODhiUm9TUzEyVTJ4TTNlempJaWZsMkZfVG9rZW46TzZpNGJiSTZnb2hxa2Z4VE1TZGN4aVZrbkIzXzE3NzA3MzMwMjM6MTc3MDczNjYyM19WNA" alt="" loading="lazy"/></p>
<p>流程 4：mcu on + main resume:</p>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=NDdmMTA5OWE5ZTc5MWI5ZDI1YjZjYjIwYjJiODJmOWZfZ241cWloZkdaYk9pOUozcDJmcWdHaE96aWRSYW1QOFpfVG9rZW46SnNMVWIzcUR0b280Tmp4OTFWZGNZMkthblFiXzE3NzA3MzMwMjM6MTc3MDczNjYyM19WNA" alt="" loading="lazy"/></p>
<p>流程 5：rtc wakeup + shutdown：</p>
<p><img src="https://mcnsakkce4vm.feishu.cn/space/api/box/stream/download/asynccode/?code=NzgxMDRhNzAyOGQ3YTg2OTBjMzNjZTgyNGY4OTFhYmNfV3RWbnBhU0lBcGJCNW9CdWpwZllvbzlhdUZTMVlLUmJfVG9rZW46QmtDV2JjWTJOb1JBY2x4elNyWWMweGlRbkhmXzE3NzA3MzMwMjM6MTc3MDczNjYyM19WNA" alt="" loading="lazy"/></p>
<p>在 rtc 唤醒场景中 - 如果需要 rtc 唤醒后直接关机，需要外部 kl15 信号源为低电平，否则会导致唤醒后一级电源无法正常下电</p>
<h3 data-id="heading-10">5.1. sample0</h3>
<pre><code class="hljs language-Plain" lang="Plain">//sample0: main suspend + mcu suspend + rtc wakeup + shutdown

// 设置rtc唤醒时间
Ret = SysPower_RtcWakeupSet(RtcWakeupTime);
if (Ret != E_OK)
{
    LogNotice("set rtc wakeup failed with %d\r\n", Ret);
    return -1;
}
</code></pre>
<h3 data-id="heading-11">5.2. sample1</h3>
<pre><code class="hljs language-Plain" lang="Plain">//main off + mcu suspend + rtc wakeup + shutdown
/** acore scmi just control acore */
scmi_reset_mode = 1;

// 通知acore进入下电
Ret = hb_PM_RequestSt(MAINSTATE_OFF_ST);

if (Ret != E_OK)
{
    LogNotice("notify shutdown failed with %d\r\n", Ret);
</code></pre>
<h3 data-id="heading-12">5.3. sample2</h3>
<pre><code class="hljs language-Plain" lang="Plain">//main suspend + mcu suspend + can wakeup + resume
//设置一个较大的rtc唤醒时间，以防止rtc误唤醒
Ret = SysPower_RtcWakeupSet(8388);
if (E_OK != Ret)
{
    LogNotice("SysPower_RtcWakeupSet failed with %d.\r\n", Ret);
    return -1;
}
//TJA1145进入低功耗模式相关配置
Ret = TJA1145_EnterLowPowerMode(1);
</code></pre>
<h3 data-id="heading-13">5.4. sample3</h3>
<pre><code class="hljs language-Plain" lang="Plain">//3: main off + mcu suspend + can wakeup + poweron
/** acore scmi just control acore */
scmi_reset_mode = 1;
// 通知acore进入下电
Ret = hb_PM_RequestSt(MAINSTATE_OFF_ST);

if (Ret != E_OK)
{
    LogNotice("notify shutdown failed with %d\r\n", Ret);
    return -1;
</code></pre>
<h3 data-id="heading-14">5.5. sample4</h3>
<pre><code class="hljs language-Plain" lang="Plain">//main suspend + mcu suspend + rtc wakeup + resume
//设置一个rtc唤醒时间
Ret = SysPower_RtcWakeupSet(RtcWakeupTime);
if (Ret != E_OK)
{
    LogNotice("set rtc wakeup failed with %d\r\n",
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[细说日常 Vibe coding 的十宗罪]]></title>    <link>https://juejin.cn/post/7605041451327750187</link>    <guid>https://juejin.cn/post/7605041451327750187</guid>    <pubDate>2026-02-10T14:30:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605041451327750187" data-draft-id="7604964464690004031" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="细说日常 Vibe coding 的十宗罪"/> <meta itemprop="keywords" content="前端,AI编程,Trae"/> <meta itemprop="datePublished" content="2026-02-10T14:30:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="mCell"/> <meta itemprop="url" content="https://juejin.cn/user/2280829967146779"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            细说日常 Vibe coding 的十宗罪
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2280829967146779/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    mCell
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T14:30:24.000Z" title="Tue Feb 10 2026 14:30:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>同步至个人站点：<a href="https://link.juejin.cn?target=https%3A%2F%2Fstack.mcell.top%2Fblog%2F2026%2Ften-common-problems-in-daily-ai-coding" target="_blank" title="https://stack.mcell.top/blog/2026/ten-common-problems-in-daily-ai-coding" ref="nofollow noopener noreferrer">细说我日常 AI coding 碰到的十个问题</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc3d2e4660914809b092869ed5cb6138~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbUNlbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771338725&amp;x-signature=hXFHb8IXI8YdvC9WSr0gu2U%2FNtY%3D" alt="202606" loading="lazy"/></p>
<p>这一年大量 vibe coding，经典翻车现场真的不少。有些是模型习惯问题，有些是 Agent 工具链缺陷，还有些属于“工程现实 vs 最佳实践”的冲突。下面这十个算是我最常遇到、也最容易让人 <strong>当场没绷住</strong> 的。</p>
<h2 data-id="heading-0">1. hardcode：类型系统被你当摆设</h2>
<p>是的，很多 TS / Golang 项目，vibe coding 一顿猛改之后，总会冒出一堆 hardcode。</p>
<p>比如判断任务状态：</p>
<ul>
<li>你会看到它写：<code>taskResult.status === "error"</code></li>
<li>而不是标准的：<code>taskResult.status == TaskResultStatusError</code></li>
</ul>
<p>问题不是“看着也能跑”，问题是：<strong>类型服务失效</strong>。后续再 AI coding，模型经常忘记把这些“临时写法”改回规范写法，久而久之就变成隐患或者 bug。</p>
<p>这个我单独写过：
<a href="https://link.juejin.cn?target=https%3A%2F%2Fstack.mcell.top%2Fblog%2F2026%2Fai-always-like-hard-code" target="_blank" title="https://stack.mcell.top/blog/2026/ai-always-like-hard-code" ref="nofollow noopener noreferrer">stack.mcell.top/blog/2026/a…</a></p>
<h2 data-id="heading-1">2. 不更新文档：文档漂移，Agent 还会一本正经地错</h2>
<p>CLAUDE.md / AGENTS.md / 设计文档这些，AI 改完代码之后，经常忘记同步更新文档。</p>
<p>于是文档失效、文档漂移；更要命的是：后续 Agent 对着文档分析，会在旧版本前提下给出一堆“逻辑自洽但完全错误”的结论。
这类错，比单纯代码 bug 更阴险。</p>
<h2 data-id="heading-2">3. codex 犟嘴：过度追求最佳实践，丢了工程的灵活性</h2>
<p>codex 5.3 之前我体感特别明显：第一轮喜欢“全仓库分析”，所以也经常被吐槽慢。后面执行快了，但又经常出现另一种问题——<strong>犟嘴</strong>。</p>
<p>典型对话：</p>
<p>用户：“请你按我的需求修改。”
codex：“你的方式不对，我觉得 xxx 才是对的。”
然后扯皮好几轮。
最后用户：“领导说的，让这么改。”
codex：“好的，我将按照你领导的要求修改。”</p>
<p>开玩笑说这是 codex 懂人情世故；说真话就是：<strong>过度追求最佳实践，反而少了软件工程里那种真实的妥协与灵活性。</strong></p>
<h2 data-id="heading-3">4. 重复输出：纯犯傻</h2>
<p>现在少很多了，但上半年我用 trea(IDE) + qwen(CLI) 时，确实碰到过：模型重复输出同一段内容 / 重复调用同一个工具，直到上下文爆满。</p>
<p>后面我自己做 memo code 也复现过一次（deepseek-chat）。概率不高，但一旦发生就特别掉好感。</p>
<h2 data-id="heading-4">5. 子进程内存泄露：五十个 G，直接给我送走</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6d77705185b4382b72b406e882c712b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbUNlbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771338725&amp;x-signature=wiZt0EHU38O5cSCEvB5liHNW9bo%3D" alt="202607" loading="lazy"/></p>
<p>发生在 codex CLI。那次我让 codex 帮我改一个开源项目（Cap，我想去掉其中收费模块），然后——内存泄露了。</p>
<p>题外话：正如 Anthropic 当时收购 bun 的语境里提过的那种现象，Agent 在运行时会频繁启动子进程，这玩意儿一旦出问题就很夸张。</p>
<p>我那次在 iTerm 里跑的 codex 占了快 50GB 内存，电脑卡崩，最后只能重启。
后续我提了 issue，也修了：</p>
<ul>
<li>issue： <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenai%2Fcodex%2Fissues%2F9345" target="_blank" title="https://github.com/openai/codex/issues/9345" ref="nofollow noopener noreferrer">github.com/openai/code…</a></li>
<li>修复 PR： <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenai%2Fcodex%2Fpull%2F9543" target="_blank" title="https://github.com/openai/codex/pull/9543" ref="nofollow noopener noreferrer">github.com/openai/code…</a></li>
</ul>
<p>顺便一提：codex cli 是 rust 写的，rust 确实是性能打手、也有所有权那套内存管理优势；但这次看起来更像<strong>工具逻辑问题</strong>，和语言没啥关系。</p>
<h2 data-id="heading-5">6. 蓝紫色：一眼 AI 作品</h2>
<p>最早 AI coding 出来的项目，页面主题十个有八个是蓝紫色。当时看到就一眼：
“你这是 AI 写的吧。”</p>
<p>后来也有人解释：LLM 训练数据里 tailwind 内容很多，而 tailwind 默认主题色就是偏蓝紫。
哈哈，不过近期模型（比如 codex 5.3、kimi k2.5）这类问题明显好很多了。</p>
<h2 data-id="heading-6">7. 表情包：开发者需要清晰文档，不需要 🥳✨🚀</h2>
<p>这是所有模型 / agent 的通病：特别爱在文档、甚至页面代码里塞一堆表情。</p>
<p>我个人真的不喜欢。作为开发者我需要的是<strong>清晰的结构和可检索的结论</strong>，表情包放在文档里只会拉分。</p>
<h2 data-id="heading-7">8. rm -rf：不是“删错了”，是系统缺安全边界</h2>
<p>这个是别人碰到的案例（我忘了具体哪个模型刚出来那阵），据说 agent 直接 <code>rm -rf</code> 然后……嗯，你懂的。</p>
<p>本质是：agent 的工具系统缺乏 <strong>沙箱 / 审批机制 / 敏感操作权限控制</strong>。</p>
<p>近期我用 codex 时有个细节还挺好：我让它删除某个不需要的目录，发现 codex cli 会拦截，不让直接 <code>rm -rf</code>。
这种“工具层兜底”比模型层喊口号强多了。</p>
<h2 data-id="heading-8">9. 代码有问题不解决，转头去改测试代码</h2>
<p>这个真的很魔幻，是 codex 我亲自遇到过一两次。</p>
<p>我在 AGENTS.md 里写了要求：“修改完代码之后运行单元测试”。然后它改完、run test，测试过不去。按正常逻辑，应该回去修实现对吧？</p>
<p>结果它给我来个：<strong>把相关测试删了</strong>。
我当场没绷住，直接回它：“xxxxxxxxxxxx”。</p>
<p>我怀疑它对 bun test 不够熟。我强烈希望 bun 官方补一个 bun 的 skills 或者 MCP 服务，让这些 agent 至少别在测试环节胡来。</p>
<h2 data-id="heading-9">10. read 工具读图，上下文直接爆炸</h2>
<p>多模态模型读取图片，正确姿势其实很明确：走 <code>content.image_url</code>（URL 可以是 base64 或可访问 http），这样不会占用模型上下文。</p>
<p>但我怀疑 claude code cli 有概率会用 Read 工具去读图片文件——然后工具把图片的 base64 字符串当作结果返回。
于是上下文直接爆炸。</p>
<p>更烦的是：它有时候又能走 content api（不占上下文），有时候又会调 Read。闭源工具你也不知道它内部怎么做的，就只能祈祷别触发。</p>
<h2 data-id="heading-10">这些坑给我的启发：我在 memo code 里做了什么兜底</h2>
<p>这些问题基本就是我这一年 vibe coding 的“经典合集”。对我最大的启发是：<strong>别把希望全寄托在模型自觉上，工程上要有“工具层的底线”</strong>。</p>
<p>最近我在开发 memo code（一个轻量级、类似 codex cli 的本地编码 agent）：
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fminorcell%2Fmemo-code" target="_blank" title="https://github.com/minorcell/memo-code" ref="nofollow noopener noreferrer">github.com/minorcell/m…</a></p>
<p>因为踩坑太多，所以我在系统设计里做了不少针对性处理，比如：</p>
<ul>
<li><strong>工具返回结果长度检查</strong>：先粗算 tokens，过长就截断/清空，返回一个系统 XML 提示，让模型调整工具参数（避免“read 工具读图→base64 爆上下文”那类事故）。</li>
<li><strong>重复输出去重</strong>：每条模型消息算 hash，用 map 存储；检测到近期 hash / hash[] 重复就拦截，并返回系统兜底纠正（概率小，但一旦发生很致命）。</li>
<li><strong>工具安全兜底</strong>：bash 工具加了沙箱、审批、敏感操作拦截（类似 <code>rm -rf</code> 那种直接封死）。</li>
<li><strong>新代码旧文档</strong>：系统提示词明确要求同步更新相关文档，尽量减少“文档漂移”。</li>
</ul>
<p>……</p>
<p>总之差不多这一年，我大量用 AI coding，也做了不少 agent 开发功课和技术调研，所以写 memo 的时候确实有“前车之鉴”。这个项目我会长期维护下去——就像我在 25 年总结里写的那样：
<a href="https://link.juejin.cn?target=https%3A%2F%2Fstack.mcell.top%2Fblog%2F2026%2F2025-being-pushed-forward-by-ai-a-year-in-motion" target="_blank" title="https://stack.mcell.top/blog/2026/2025-being-pushed-forward-by-ai-a-year-in-motion" ref="nofollow noopener noreferrer">stack.mcell.top/blog/2026/2…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[三方支付真的香吗？日本iOS、Google三方支付调研报告]]></title>    <link>https://juejin.cn/post/7604853010171510825</link>    <guid>https://juejin.cn/post/7604853010171510825</guid>    <pubDate>2026-02-10T13:04:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604853010171510825" data-draft-id="7591506455973691446" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="三方支付真的香吗？日本iOS、Google三方支付调研报告"/> <meta itemprop="keywords" content="iOS,Apple"/> <meta itemprop="datePublished" content="2026-02-10T13:04:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CocoaKier"/> <meta itemprop="url" content="https://juejin.cn/user/4388906146735864"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            三方支付真的香吗？日本iOS、Google三方支付调研报告
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4388906146735864/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CocoaKier
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T13:04:09.000Z" title="Tue Feb 10 2026 13:04:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你以为的“三方支付”的样子，和苹果谷歌落地“三方支付”的样子，堪比网友见面、梦境与现实。</p>
<ul>
<li>抽成方面：即使你使用三方支付，苹果谷歌依然要抽成，只是换了个名字叫“商店服务费”，抽成并没有便宜多少。</li>
<li>财务对账：苹果谷歌为了审计你的三方支付的抽成，你需要每月和苹果谷歌对账、打款。</li>
<li>必须接入官方内购系统：即使使用三方支付，依然必须接入官方内购系统作为可选项，与三方支付并列显示。</li>
<li>劝退弹窗：用户使用三方支付时，会被苹果谷歌弹窗警告，“你即将离开安全环境”、“苹果将不再负责该交易的安全、退款及支持”等。</li>
</ul>
<p>下面是详细介绍。</p>
<h2 data-id="heading-0">一、抽成费率</h2>
<p>苹果和谷歌又将“三方支付”分为“应用内三方支付”、“网页外链支付”。顾名思义，“应用内三方支付”就是在应用内使用三方支付（例如接入PayPal SDK），“网页外链支付”就是跳出应用，打开外链支付。二者抽成比例是不一样的。</p>
<p><strong>苹果</strong></p>
<p>在日本，苹果将原来的“佣金”拆分成了 “商店服务费” 和 固定5%的“支付处理费”。如果使用三方支付，则不用出 5%“支付处理费”，但“商店服务费”还是得出。苹果：我聪明吧。</p>





























<table><thead><tr><th>方案</th><th>苹果收取的商店服务费</th><th>苹果收的支付服务费</th><th>苹果抽成合计</th></tr></thead><tbody><tr><td>官方内购</td><td>21% (小型开发者或订阅 10%)</td><td>5%</td><td>15% ~ 26%</td></tr><tr><td>App内三方支付</td><td>21% (小型开发者或订阅 10%)</td><td>0</td><td>10% ~ 21%</td></tr><tr><td>网页外链支付</td><td>15% (小型开发者或订阅 10%)</td><td>0</td><td>10% ~ 15%</td></tr></tbody></table>
<p>信源：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.apple.com%2Fcn%2Fsupport%2Fapp-distribution-in-japan%2F" target="_blank" title="https://developer.apple.com/cn/support/app-distribution-in-japan/" ref="nofollow noopener noreferrer">Changes to iOS in Japan</a></p>
<p><strong>谷歌</strong></p>

























<table><thead><tr><th>场景</th><th>Google 收取的费率</th><th>谷歌抽成合计</th></tr></thead><tbody><tr><td>官方内购</td><td>30% (小型开发者或订阅 15%)</td><td>15% ~ 30%</td></tr><tr><td>App内三方支付</td><td>26% (小型开发者或订阅 11%)</td><td>11% ~ 26%</td></tr><tr><td>网页外链支付</td><td>20% (小型开发者或订阅 10%)</td><td>10% ~ 20%</td></tr></tbody></table>
<p>App内三方支付，4%优惠，信源：<a href="https://link.juejin.cn?target=https%3A%2F%2Fsupport.google.com%2Fgoogleplay%2Fandroid-developer%2Fanswer%2F11222040" target="_blank" title="https://support.google.com/googleplay/android-developer/answer/11222040" ref="nofollow noopener noreferrer">自选结算系统优惠4%</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fsupport.google.com%2Fgoogleplay%2Fandroid-developer%2Fanswer%2F13821247" target="_blank" title="https://support.google.com/googleplay/android-developer/answer/13821247" ref="nofollow noopener noreferrer">Understanding user choice billing on Google Play</a>（文档里列出了JP）</p>
<p>网页外链支付，10%优惠，信源：<a href="https://link.juejin.cn?target=https%3A%2F%2Fsupport.google.com%2Fgoogleplay%2Fandroid-developer%2Fanswer%2F14372887" target="_blank" title="https://support.google.com/googleplay/android-developer/answer/14372887" ref="nofollow noopener noreferrer">Enrolling in the external offers program</a></p>
<p><strong>费率小结：</strong><br/>
三方支付，支付通道（PayPal、Stripe等）收取的通道费一般在3%左右，所以三方支付的综合成本，应该在上面再加上3%。加完后，应用内三方支付和官方内购差别极小，毫无优势。只有“网页外链支付”在抽成方面占优势，但“网页外链支付”体验很差，用户可能更倾向选官方内购，导致“网页外链支付”实际使用率低，达不到降低抽成的效果。</p>
<h2 data-id="heading-1">二、申请开通</h2>
<p>使用三方支付（App内三方支付、网页外链支付）均需向苹果和谷歌提交申请，并签署新的协议条款。</p>
<h3 data-id="heading-2">向苹果提交申请</h3>
<p><strong>1、签署最新商业条款</strong></p>
<p>账号持有者（Account Holder）登录 Apple Developer 官网。 在协议（Agreements）页面，找到并签署针对日本地区的最新补充协议（如 Alternative Terms Addendum for Apps in Japan）。这代表你接受苹果的新版佣金结构及月度申报制度。</p>
<p><strong>2、提交在线申请表单</strong></p>
<p>（1）申请入口： 访问苹果官方的<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Fsearch%3Fq%3Dhttps%3A%2F%2Fdeveloper.apple.com%2Fcontact%2Frequest%2Fstorekit-external-purchase-link-jp%2F" target="_blank" title="https://www.google.com/search?q=https://developer.apple.com/contact/request/storekit-external-purchase-link-jp/" ref="nofollow noopener noreferrer">权限申请表单</a>（需登录）</p>
<p>（2）选择授权类型：</p>
<ul>
<li>外链支付：勾选 StoreKit External Purchase Link Entitlement (Japan)。</li>
<li>第三方支付：勾选 Alternative Payment Processor Entitlement (Japan)。</li>
</ul>
<p>（3）填写 App 详细信息：</p>
<ul>
<li>Bundle ID：必须是已经上架或准备在日本商店分发的 App ID。</li>
<li>支付网站域名：如果是申请外链支付，必须提供你计划链接到的顶级域名（URL 必须是 HTTPS 且归属于开发者）。</li>
<li>PSP 信息：如果是第三方内购，需要填写你合作的支付服务商名称（如 Stripe, PayPay 等）。</li>
</ul>
<h3 data-id="heading-3">向谷歌提交申请</h3>
<p>申请“第三方应用内支付”（Google Play External Payments Declaration Form）</p>
<p>1、主体要求： 必须是以“企业/组织”名义注册的账号（个人开发者目前很难申请通过）<br/>
2、目标市场： App 必须在日本市场分发，且该功能仅对日本用户生效。<br/>
3、技术准备： App 必须集成 Play Billing Library 8.2 或更高版本。即使申请通过，不调用新版本API没办法实现。<br/>
4、谷歌官方的<a href="https://link.juejin.cn?target=https%3A%2F%2Fsupport.google.com%2Fgoogleplay%2Fandroid-developer%2Fanswer%2F16787536" target="_blank" title="https://support.google.com/googleplay/android-developer/answer/16787536" ref="nofollow noopener noreferrer">帮助文档页面</a>，找到“declaration form”入口进行意向申请 (提交后，谷歌会审核开发者身份，然后后台开放配置入口)<br/>
5、如果意向申请通过，Google Play Console -&gt; 在左侧菜单中找到 设置 (Settings) -&gt; 外部支付计划，这个页面可以提交计划使用的外部支付网址URL，然后供谷歌审核<br/>
6、提供详细信息：</p>
<blockquote>
<p>开发者账号ID：Google Play Console后台可查看的开发者账号ID<br/>
企业官方名称：必须与你申请开发者账号时提交的企业名称一致<br/>
企业注册地址：请使用注册公司所在国家/地区的官方语言输入地址<br/>
应用包名：填写要申请应用的包名，可以一次申请多个应用，但每个应用都需要符合日本分发要求。<br/>
账单寄送地址：谷歌在电子发票上显示的地址。用于财务对账和开票。<br/>
账单接收邮箱地址：谷歌会根据上报的金额按月向这个邮箱发送服务费账单<br/>
联系人邮箱：政策审核、技术问题、合规通知的接收邮箱<br/>
用户申诉的地址：一般可以是客服链接或者处理交易纠纷的邮箱地址</p>
</blockquote>
<h2 data-id="heading-4">三、每月对账：上报三方支付流水</h2>
<p>因为苹果和谷歌需要对三方支付抽成，所以需要按照平台要求，每月和苹果谷歌对账，提交三方支付流水。<strong>如果被发现瞒报、漏报，苹果和谷歌会采取极严厉的惩罚，包括：追缴欠款及利息；终止该权益的使用权限；</strong> <strong>封禁开发者账号。</strong></p>
<h3 data-id="heading-5">向苹果提交交易报告</h3>
<p>采用 <strong>API 实时上报 + 每月财务对账”</strong> 的模式。 注意，即使做了API实时上报，也必须做每月App Store Connect的对账进行二次确认。</p>
<p><strong>1、技术侧实时上报</strong></p>
<p>整体流程：客户端生成 Token (StoreKit 侧) =&gt; <strong>业务服务端</strong> =&gt; 苹果服务器</p>
<p>（1）App 调用 ExternalPurchase.present() (针对外链) 或 ExternalPurchase.purchase() (针对三方支付)</p>
<p>（2）如果用户在系统弹窗中点击了“继续”，StoreKit 会生成一个加密的 ExternalPurchaseToken（字符串格式）。这个 Token 包含了当前用户、当前 App 以及这次点击行为的唯一标识，它是苹果后续对账的唯一凭证，每月财务对账的csv文件里也需要包含该字段。</p>
<p>（3）客户端将token发送给业务服务端。业务服务器需要将这个 Token 与该用户的订单/会话进行关联。如果是外链支付，可能需要暂存这个 Token，等待用户在网页端完成支付</p>
<p>（4）服务器收到三方支付回调（确认钱已到账）后，必须立即（或在 24 小时内）通过 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Fexternalpurchaseserverapi" target="_blank" title="https://developer.apple.com/documentation/externalpurchaseserverapi" ref="nofollow noopener noreferrer">External Purchase Server API</a> 调用 <strong>Send External Purchase Report</strong> 接口。</p>
<p>上报内容：你需要把从客户端拿到的 Token，连同实际的交易金额（Amount）、货币类型（Currency）以及交易时间戳一起发给苹果服务器。</p>
<p>退款上报：如果用户后来在三方支付端发起了退款，你的服务器也需要通过 API 向苹果上报这笔退款，否则苹果依然会扣你这笔订单的佣金。</p>
<p><strong>2、每月财务对账与支付</strong></p>
<p>（1）在<strong>每个日历月</strong>结束后的 <strong>15天内</strong>，你需要通过 <strong>App Store Connect</strong> 提交一份详细的交易报告。申报通常是上传一个 <strong>.csv 格式的模板文件</strong></p>
<pre><code class="hljs language-javascript" lang="javascript">申报填写字段： 
<span class="hljs-title class_">App</span> <span class="hljs-title class_">Apple</span> <span class="hljs-variable constant_">ID</span>,纯数字,您 <span class="hljs-title class_">App</span> 的唯一 <span class="hljs-variable constant_">ID</span> 
<span class="hljs-title class_">Transaction</span> <span class="hljs-title class_">Date</span>,日期格式,交易发生的具体日期 
<span class="hljs-variable constant_">PSP</span> <span class="hljs-title class_">Name</span>,手动输入文本,您使用的支付服务商全称 
<span class="hljs-title class_">Purchase</span> <span class="hljs-title class_">Token</span>,字符串,技术端生成的唯一追踪标识符
<span class="hljs-title class_">Sales</span> <span class="hljs-title class_">Amount</span>,数字,用户实际支付的金额（需扣除交易税） 
</code></pre>
<p>（2）即使无交易也需汇报：如果该月没有产生任何三方支付流水，您依然需要提交一份“零交易汇报（Zero Transaction Report）”</p>
<p>（3）提交入口：App Store Connect - “Payments and Financial Reports” (付款和财务报告) 模块 - “External Purchases” (外部购买) 选项卡</p>
<p>（4）上传或确认数据：系统通常会根据您通过 API 上报的数据自动预填部分信息。您需要核对并上传最终的 CSV 格式报告，确保其与您的财务记录一致。</p>
<p>（5）苹果会根据你申报的销售额扣除佣金，然后向你发送电子发票。你需要按照发票金额，在规定时间内通过银行转账等方式向苹果支付这笔费用。</p>
<p>（6）注意：为了防止偷税漏税，苹果在协议中保留了<strong>强力审计权</strong>：苹果有权雇佣第三方审计机构检查你的财务账簿。如果被发现瞒报、漏报，苹果会采取极严厉的惩罚，包括：追缴欠款及利息；终止该权益的使用权限；封禁开发者账号。</p>
<h3 data-id="heading-6">向谷歌提交交易报告</h3>
<p>采用 <strong>"API 实时上报 + 开发者后台汇总确认"</strong> 的模式。谷歌不用每月手动上报，采用全自动上报模式，但需要核对漏报进行补报。</p>
<p><strong>1、技术侧实时上报</strong><br/>
与苹果相比，谷歌的流程更强调实时性 <strong>（24小时内）</strong> 和交易类型的精细化。</p>
<p>整体流程：客户端生成 Token (externalTransactionToken) =&gt; <strong>业务服务端</strong> =&gt; 谷歌服务器</p>
<p>（1）当用户在 App 内选择三方支付或点击外链，并在 Google Play 弹出的系统底页（Disclosure Sheet）点击“确认”后，Billing Library 会向你的 App 返回一个 <strong>externalTransactionToken</strong>。App 必须将此 Token 连同订单信息传给你的业务后端。它是这笔交易唯一的身份凭证。</p>
<p>（2）每当三方支付成功后，你必须在 <strong>24 小时内</strong> 通过<strong>服务端</strong>调用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.google.com%2Fandroid-publisher%2Fapi-ref%2Frest%2Fv3%2Fexternaltransactions%2F" target="_blank" title="https://developers.google.com/android-publisher/api-ref/rest/v3/externaltransactions/" ref="nofollow noopener noreferrer">externaltransactions API</a>。<strong>内容</strong>：上报 Token、交易金额、货币、时间戳、税收地址（日本区对税收合规要求严格）以及交易类型。</p>
<pre><code class="hljs language-json" lang="json">你的服务器需要使用一个拥有 Reply to reviews 或 Manage orders 权限的 Google Cloud 服务账号 (Service Account)。

业务服务端调用上报接口
接口地址： POST https<span class="hljs-punctuation">:</span><span class="hljs-comment">//androidpublisher.googleapis.com/androidpublisher/v3/applications/{packageName}/externalTransactions?externalTransactionId={ID}</span>
URL参数：externalTransactionId：由你定义的唯一订单号（建议使用你数据库里的自增 ID 或 UUID）。

请求body参数：
<span class="hljs-punctuation">{</span>
 <span class="hljs-attr">"externalTransactionToken"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"从客户端传来的Token"</span><span class="hljs-punctuation">,</span>
 <span class="hljs-attr">"transactionTime"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-12-30T10:00:00Z"</span><span class="hljs-punctuation">,</span>
 <span class="hljs-attr">"oneTimeTransaction"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"fullPrice"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
   <span class="hljs-attr">"amountMicros"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1000000"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 代表 1.00 货币单位（百万分之一单位）</span>
   <span class="hljs-attr">"currency"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"JPY"</span>
  <span class="hljs-punctuation">}</span>
 <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
 <span class="hljs-comment">// 或者如果是订阅</span>
 <span class="hljs-comment">// "recurringTransaction": { ... },</span>
 <span class="hljs-attr">"userTaxAddress"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"regionCode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"JP"</span> <span class="hljs-comment">// 对日本区对账极其重要</span>
 <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>（3）<strong>异常处理</strong>：如果在 API 上报过程中出现了由于网络等原因导致的漏报，你需要在次月 <strong>5 个工作日内</strong> 通过 API 补报（补报之前的漏单）</p>
<p>（4）<strong>下载报告核对</strong>：你可以从 Google Play Console 的 <code>创收</code> &gt; <code>备选的结算系统</code> 中导出谷歌生成的报告，将其与你自己的数据库进行核对。如果金额对不上，通常是因为你漏报了某些 API 请求。</p>
<p> 
参考资料：<br/>
创建/上报交易 (Create Transaction)
<a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.google.com%2Fandroid-publisher%2Fapi-ref%2Frest%2Fv3%2Fexternaltransactions%2Fcreate" target="_blank" title="https://developers.google.com/android-publisher/api-ref/rest/v3/externaltransactions/create" ref="nofollow noopener noreferrer">developers.google.com/android-pub…</a><br/>
注：在该页面左侧菜单可以看到 get 和 refund（退款）接口</p>
<p>备选结算系统（Alternative Billing）集成指南<br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fgoogle%2Fplay%2Fbilling%2Falternative" target="_blank" title="https://developer.android.com/google/play/billing/alternative" ref="nofollow noopener noreferrer">developer.android.com/google/play…</a><br/>
此页面包含了“报告外部交易”的技术步骤说明。</p>
<p><strong>2、</strong> <strong>账单确认与支付</strong><br/>
<strong>生成账单</strong>：谷歌会根据你 API 上报的数据，在次月生成汇总账单。<br/>
<strong>支付方式</strong>：不像苹果通常需要你主动汇款，谷歌通常会从你账户绑定的<strong>结算方式（信用卡或付款资料）</strong> 中<strong>直接扣除</strong>这部分佣金，或者发送正式账单让你在规定时间内支付。</p>
<h2 data-id="heading-7">四、严苛的“劝退式”交互</h2>
<p>为了保护自己的生态，<strong>两大巨头</strong>在用户体验上设置了重重障碍：</p>
<p><strong>内购强制接入：</strong> 苹果和谷歌均要求，开发者不能仅提供第三方支付，必须同时接入官方内购作为选项，且官方支付按钮的醒目程度必须不低于第三方支付。</p>
<p><strong>劝退的风险弹窗：</strong> 用户在点击第三方支付链接时，系统会弹出充满“警告色”的通知（如：“你即将离开安全环境”、“苹果将不再负责该交易的安全、退款及支持”等），这极大地增加了用户的跳失率。</p>
<h2 data-id="heading-8">五、总结</h2>
<h3 data-id="heading-9">1、并没有消失的“平台税”</h3>
<p>先看抽成方面。</p>
<p>通过应用内三方支付SDK方式接入，体验较好，但抽成比例和官方支付差别很小，<strong>可以省约 1%~2%</strong> ；<strong>只有通过外链跳出App支付这种方式接入，省的比较多，可以省7%左右，但这种方式体验较差，再加上平台强制“风险警告弹窗”，即使接入了这种支付方式，最终又有多少比例的用户会选择这种支付方式呢？所以，这个7%可能需要打个大折扣。</strong></p>
<p>总结起来就是，接入三方支付并不一定会“省钱”。</p>
<h3 data-id="heading-10">2、从运营成本方面看</h3>
<p>一旦采用第三方支付，开发者需要承担原本由平台处理的大量行政工作：</p>
<p><strong>每月结算申报：</strong> 开发者必须<strong>每月</strong>手动向苹果/谷歌<strong>申报</strong>通过第三方渠道产生的流水，<strong>并根据申报单向平台转账支付佣金</strong>。</p>
<p><strong>自理客服与退款：</strong> 所有的<strong>退款申请、订阅管理和支付争议</strong>，平台一概不管，开发者必须建立自己的客服团队来处理这些琐事。</p>
<p><strong>接受审计风险：</strong> 平台保留对开发者财务记录进行审计的权利。如果瞒报、（人员或技术疏忽导致的）漏报三方支付流水，可能面临权利被限制、下架或封号等风险。</p>
<h3 data-id="heading-11">3、过审可能变得困难</h3>
<p><strong>接入三方支付，会增加包体提审被拒的风险。</strong></p>
<p>作为开发者，<strong>提审时需要额外在审核备注里说明接入了三方支付，并提供支付流程截图或视频</strong>。</p>
<p>作为审核人员，也会额外“关照”接入了三方支付的应用，检查是否符合相关审核要求。</p>
<p>包体层面，接入三方支付，势必会在包体里加入<strong>支付判断、支付切换，或者嵌入三方支付SDK 等高风险行为。机器审核有可能误判为切支付、隐藏功能，增加过审难度。</strong></p>
<h3 data-id="heading-12">4、可能失去官方推荐资格</h3>
<p>虽然苹果和谷歌官方层面没有明确表明，接入三方支付的应用不会被推荐。<strong>但从平台的角度出发，加入三方支付，很大程度上会影响被平台推荐的可能性。</strong></p>
<p><strong>苹果</strong><br/>
官方口径： 只要符合 Guideline 3.1.1(a) 且已获得 Entitlement 授权，应用在法律上具备推荐资格。</p>
<p>实际：苹果的推荐位是由其编辑团队（App Store Editors）<strong>人工筛选的</strong>。他们的考核标准中，“用户体验的一致性”权重极高。三方支付必须弹出一个“离开 App”的系统警告框。对于编辑来说，这种“打断感”被视为用户体验的瑕疵。编辑团队通常倾向于推荐那些能给平台带来完整生态价值（包括 IAP 闭环）的应用。</p>
<p><strong>谷歌</strong><br/>
官方口径： 参与 User Choice Billing (UCB) 计划的应用，其推荐资格不受限制。</p>
<p>实际： 算法决定了你是否能进入备选池，人工决定了你是否被推荐。谷歌的自动化推荐算法（如“猜你喜欢”）基于转化率和评分。如果三方支付导致支付流程变长、跳出率增加，你的算法推荐位会自然下降。针对三方支付的退款请求，务必在 App 内提供显著的客服入口，避免用户在商店留下“无法退款，骗钱”的差评，这是算法降权的头号原因。</p>
<p><strong>结语</strong></p>
<p>看完上面的内容，你还会觉得“三方支付真香”吗？</p>
<p>而且，后续如果其它国家或地区吵着要开三方支付，大概率也会遵循上面日本的范式。</p>
<p>放弃幻想吧，宝子们！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32ff5a959b2b4ccbbd4575a75ec03133~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29jb2FLaWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771333456&amp;x-signature=2vwqdVUboQd3lh%2B%2F6fPg%2BxHvn64%3D" alt="理想与现实的落差.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LangChain 进阶实战：当 Memory 遇上 OutputParser，打造有记忆的结构化助手]]></title>    <link>https://juejin.cn/post/7605051978872078355</link>    <guid>https://juejin.cn/post/7605051978872078355</guid>    <pubDate>2026-02-10T13:25:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605051978872078355" data-draft-id="7605041451327553579" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LangChain 进阶实战：当 Memory 遇上 OutputParser，打造有记忆的结构化助手"/> <meta itemprop="keywords" content="前端,LangChain"/> <meta itemprop="datePublished" content="2026-02-10T13:25:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NEXT06"/> <meta itemprop="url" content="https://juejin.cn/user/1176918763246011"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LangChain 进阶实战：当 Memory 遇上 OutputParser，打造有记忆的结构化助手
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1176918763246011/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NEXT06
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T13:25:23.000Z" title="Tue Feb 10 2026 13:25:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在当前的 LLM 应用开发中，我们经常陷入两个极端的场景：</p>
<ol>
<li><strong>记性好的话痨</strong>：类似于 ChatBot，能记住上下文，聊天体验流畅，但输出全是不可控的自然语言。</li>
<li><strong>一次性的 API</strong>：类似于信息提取工具，能返回标准的 JSON 数据，但它是“无状态”的，每一轮调用都是全新的开始。</li>
</ol>
<p>然而，在复杂的业务系统中，我们往往需要二者兼备：<strong>既要像人一样拥有记忆上下文的能力，又要像传统 API 一样返回严格的结构化数据（JSON）。</strong></p>
<p>本文将基于 LangChain (LCEL) 体系，讲解如何将 <strong>Memory (记忆模块)</strong>  与 <strong>OutputParser (输出解析器)</strong>  结合，打造一个既懂业务逻辑又能规范输出的智能助手。</p>
<h2 data-id="heading-0">第一部分：记忆的载体 (Review)</h2>
<p>我们在之前的工程实践中已经明确：LLM 本身是无状态的（Stateless）。为了维持对话的连续性，我们需要在应用层手动维护历史消息。</p>
<p>在 LangChain 中，RunnableWithMessageHistory 是实现这一功能的核心容器。它的工作原理非常直观：</p>
<ol>
<li><strong>读取</strong>：在调用大模型前，从存储介质（Memory）中读取历史对话。</li>
<li><strong>注入</strong>：将历史对话填充到 Prompt 的占位符（Placeholder）中。</li>
<li><strong>保存</strong>：模型返回结果后，将“用户输入”和“AI 回复”追加到 Memory 中。</li>
</ol>
<p>这是让 AI “拥有记忆”的基础设施。</p>
<h2 data-id="heading-1">第二部分：输出的规整 (The Parser)</h2>
<p>模型原生的输出是 BaseMessage 或纯文本字符串。直接在业务代码中使用 JSON.parse() 处理模型输出是非常危险的，原因如下：</p>
<ul>
<li><strong>幻觉与废话</strong>：模型可能会在 JSON 前后添加 "Here is your JSON" 之类的自然语言。</li>
<li><strong>格式错误</strong>：Markdown 代码块符号（```json）会破坏 JSON 结构。</li>
<li><strong>字段缺失</strong>：模型可能忘记输出某些关键字段。</li>
</ul>
<p>LangChain 提供了 OutputParser 组件来充当“翻译官”和“校验员”。</p>
<h3 data-id="heading-2">1. StringOutputParser</h3>
<p>最基础的解析器。它将模型的输出（Message 对象）转换为字符串，并自动去除首尾的空白字符。这在处理简单的文本生成任务时非常有用。</p>
<h3 data-id="heading-3">2. StructuredOutputParser (重点)</h3>
<p>这是工程化中最常用的解析器。它通常与 Zod 库结合使用，能够：</p>
<ul>
<li><strong>生成提示词</strong>：自动生成一段 Prompt，告诉模型“你需要按照这个 JSON Schema 输出”。</li>
<li><strong>解析结果</strong>：将模型返回的文本清洗并解析为标准的 JavaScript 对象。</li>
<li><strong>校验数据</strong>：确保返回的数据类型符合定义（如 age 必须是数字）。</li>
</ul>
<h2 data-id="heading-4">第三部分：核心实战 (The Fusion)</h2>
<p>接下来，我们将构建一个**“用户信息收集助手”**。<br/>
<strong>需求</strong>：助手与用户对话，记住用户的名字（Memory），并根据对话内容提取用户的详细信息（Parser），最终输出包含 { name, age, job } 的标准 JSON 对象。</p>
<p>以下是基于 LangChain LCEL 的完整实现代码：</p>
<h3 data-id="heading-5">1. 环境准备与依赖</h3>
<p>确保安装了 @langchain/core, @langchain/deepseek, zod。</p>
<h3 data-id="heading-6">2. 代码实现</h3>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatDeepSeek</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/deepseek"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatPromptTemplate</span>, <span class="hljs-title class_">MessagesPlaceholder</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/core/prompts"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">RunnableWithMessageHistory</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/core/runnables"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">InMemoryChatMessageHistory</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/core/chat_history"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">StructuredOutputParser</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/core/output_parsers"</span>;
<span class="hljs-keyword">import</span> { z } <span class="hljs-keyword">from</span> <span class="hljs-string">"zod"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'dotenv/config'</span>;

<span class="hljs-comment">// 1. 定义输出结构 (Schema)</span>
<span class="hljs-comment">// 我们希望模型最终返回的数据格式</span>
<span class="hljs-keyword">const</span> parser = <span class="hljs-title class_">StructuredOutputParser</span>.<span class="hljs-title function_">fromZodSchema</span>(
  z.<span class="hljs-title function_">object</span>({
    <span class="hljs-attr">name</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">describe</span>(<span class="hljs-string">"用户的姓名，如果未知则为 null"</span>),
    <span class="hljs-attr">age</span>: z.<span class="hljs-title function_">number</span>().<span class="hljs-title function_">nullable</span>().<span class="hljs-title function_">describe</span>(<span class="hljs-string">"用户的年龄，如果未知则为 null"</span>),
    <span class="hljs-attr">job</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">nullable</span>().<span class="hljs-title function_">describe</span>(<span class="hljs-string">"用户的职业，如果未知则为 null"</span>),
    <span class="hljs-attr">response</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">describe</span>(<span class="hljs-string">"AI 对用户的自然语言回复"</span>)
  })
);

<span class="hljs-comment">// 获取格式化指令，这会自动生成一段类似 "You must format your output as a JSON value..." 的文本</span>
<span class="hljs-keyword">const</span> formatInstructions = parser.<span class="hljs-title function_">getFormatInstructions</span>();

<span class="hljs-comment">// 2. 初始化模型</span>
<span class="hljs-keyword">const</span> model = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatDeepSeek</span>({
  <span class="hljs-attr">model</span>: <span class="hljs-string">"deepseek-chat"</span>, <span class="hljs-comment">// 使用适合对话的模型</span>
  <span class="hljs-attr">temperature</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 设为 0 以提高结构化输出的稳定性</span>
});

<span class="hljs-comment">// 3. 构建 Prompt 模板</span>
<span class="hljs-comment">// 关键点：</span>
<span class="hljs-comment">// - history: 用于存放历史记忆</span>
<span class="hljs-comment">// - format_instructions: 用于告诉模型如何输出 JSON</span>
<span class="hljs-keyword">const</span> prompt = <span class="hljs-title class_">ChatPromptTemplate</span>.<span class="hljs-title function_">fromMessages</span>([
  [<span class="hljs-string">"system"</span>, <span class="hljs-string">"你是一个用户信息收集助手。你的目标是从对话中提取用户信息。\n{format_instructions}"</span>],
  [<span class="hljs-string">"placeholder"</span>, <span class="hljs-string">"{history}"</span>], <span class="hljs-comment">// 历史消息占位符</span>
  [<span class="hljs-string">"human"</span>, <span class="hljs-string">"{input}"</span>]
]);

<span class="hljs-comment">// 4. 构建处理链 (Chain)</span>
<span class="hljs-comment">// 数据流向：Prompt -&gt; Model -&gt; Parser</span>
<span class="hljs-keyword">const</span> chain = prompt.<span class="hljs-title function_">pipe</span>(model).<span class="hljs-title function_">pipe</span>(parser);

<span class="hljs-comment">// 5. 挂载记忆模块</span>
<span class="hljs-comment">// 使用内存存储历史记录 (生产环境应替换为 Redis 等)</span>
<span class="hljs-keyword">const</span> messageHistory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryChatMessageHistory</span>();

<span class="hljs-keyword">const</span> chainWithHistory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RunnableWithMessageHistory</span>({
  <span class="hljs-attr">runnable</span>: chain,
  <span class="hljs-attr">getMessageHistory</span>: <span class="hljs-keyword">async</span> (sessionId) =&gt; {
    <span class="hljs-comment">// 实际业务中应根据 sessionId 获取对应的历史记录</span>
    <span class="hljs-keyword">return</span> messageHistory;
  },
  <span class="hljs-attr">inputMessagesKey</span>: <span class="hljs-string">"input"</span>,
  <span class="hljs-attr">historyMessagesKey</span>: <span class="hljs-string">"history"</span>,
});

<span class="hljs-comment">// 6. 执行与测试</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> sessionId = <span class="hljs-string">"user_session_123"</span>;

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"--- 第一轮对话 ---"</span>);
  <span class="hljs-keyword">const</span> res1 = <span class="hljs-keyword">await</span> chainWithHistory.<span class="hljs-title function_">invoke</span>(
    {
      <span class="hljs-attr">input</span>: <span class="hljs-string">"你好，我叫陈总，我是一名全栈工程师。"</span>,
      <span class="hljs-attr">format_instructions</span>: formatInstructions <span class="hljs-comment">// 注入格式化指令</span>
    },
    { <span class="hljs-attr">configurable</span>: { sessionId } }
  );
  
  <span class="hljs-comment">// 此时 res1 已经是一个标准的 JSON 对象，而不是字符串</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"解析后的输出:"</span>, res1);
  <span class="hljs-comment">// 输出示例: { name: '陈总', age: null, job: '全栈工程师', response: '你好陈总，很高兴认识你！' }</span>

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"\n--- 第二轮对话 ---"</span>);
  <span class="hljs-keyword">const</span> res2 = <span class="hljs-keyword">await</span> chainWithHistory.<span class="hljs-title function_">invoke</span>(
    {
      <span class="hljs-attr">input</span>: <span class="hljs-string">"我今年35岁了。"</span>,
      <span class="hljs-attr">format_instructions</span>: formatInstructions
    },
    { <span class="hljs-attr">configurable</span>: { sessionId } }
  );

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"解析后的输出:"</span>, res2);
  <span class="hljs-comment">// 输出示例: { name: '陈总', age: 35, job: '全栈工程师', response: '好的，记录下来了，你今年35岁。' }</span>
}

<span class="hljs-title function_">run</span>();
</code></pre>
<h2 data-id="heading-7">第四部分：工程化思考</h2>
<p>在将 Memory 和 Parser 结合时，有几个关键的工程细节需要注意：</p>
<h3 data-id="heading-8">1. 数据流向与调试</h3>
<p>在上面的代码中，数据流向是：<br/>
User Input -&gt; Prompt Template (注入 History + Format Instructions) -&gt; LLM -&gt; String Output -&gt; Output Parser -&gt; JSON Object。</p>
<p>如果你发现报错，通常是因为模型没有严格遵循 formatInstructions。建议在开发阶段使用 ConsoleCallbackHandler 或 LangSmith 监控中间步骤，查看传递给模型的最终 Prompt 是否包含了正确的 JSON Schema 定义。</p>
<h3 data-id="heading-9">2. 记忆存储的内容</h3>
<p>这是一个极其容易被忽略的点：<strong>Memory 中到底存了什么？</strong></p>
<p>在 RunnableWithMessageHistory 的默认行为中，它会尝试存储 Chain 的输入和输出。</p>
<ul>
<li><strong>输入</strong>：{ input: "..." } (文本)</li>
<li><strong>输出</strong>：经过 Parser 处理后的 <strong>JSON 对象</strong>。</li>
</ul>
<p>当下一轮对话开始时，LangChain 会尝试将这个 JSON 对象注入到 Prompt 的 {history} 中。虽然 LangChain 会尝试将其序列化为字符串，但为了保证 Prompt 的语义清晰，建议模型生成的 response 字段专门用于维持对话上下文，而结构化数据则用于业务逻辑处理。</p>
<h3 data-id="heading-10">3. Token 消耗</h3>
<p>引入 StructuredOutputParser 会显著增加 Prompt 的长度（因为它注入了复杂的 Schema 定义）。在多轮对话中，如果历史记录也越来越长，很容易超出上下文窗口或导致 API 费用激增。务必配合 ConversationSummaryMemory（摘要记忆）或限制历史消息条数。</p>
<h2 data-id="heading-11">结语</h2>
<p>LangChain 的魅力在于其组件的积木式组合。通过将 RunnableWithMessageHistory（状态管理）与 StructuredOutputParser（输出规整）串联，我们将 LLM 从一个“不可控的聊天机器人”进化为了一个“有状态的业务处理单元”。</p>
<p>掌握这一套组合拳，是在生产环境构建复杂 AI Agent 的必经之路。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[理解链表算法：从基础操作到高级应用]]></title>    <link>https://juejin.cn/post/7604846849464533044</link>    <guid>https://juejin.cn/post/7604846849464533044</guid>    <pubDate>2026-02-10T13:37:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604846849464533044" data-draft-id="7605042079668486159" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="理解链表算法：从基础操作到高级应用"/> <meta itemprop="keywords" content="后端,JavaScript,算法"/> <meta itemprop="datePublished" content="2026-02-10T13:37:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="颜酱"/> <meta itemprop="url" content="https://juejin.cn/user/905653309941495"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            理解链表算法：从基础操作到高级应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/905653309941495/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    颜酱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T13:37:16.000Z" title="Tue Feb 10 2026 13:37:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读41分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">理解链表算法：从基础操作到高级应用</h2>
<p>链表是算法面试中<strong>最高频的考点之一</strong>，其「非连续存储」的特性决定了它的解题思路和数组有本质区别——指针操作、边界处理、虚拟头节点等技巧贯穿始终。本文将从链表的核心解题思想出发，拆解合并、分解、指针技巧、运算四大类经典题型，结合LeetCode高频题给出最优解，并标注面试中最容易踩坑的易错点。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2441ad45a51408ebc4deae02c84aa5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aKc6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771335554&amp;x-signature=7pSmbisfcctEWWu3Pp04nVULW4g%3D" alt="link_1.png" loading="lazy"/></p>

<h3 data-id="heading-1">一、核心解题思想：先掌握这3个通用技巧</h3>
<p>在开始刷题前，先牢记链表题的「三板斧」，能解决80%的问题：</p>
<h4 data-id="heading-2">1. 虚拟头节点（Dummy Node）</h4>
<p><strong>适用场景</strong>：需要创建/修改链表（如合并、删除、分解），避免处理「头节点为空」的边界情况。</p>
<p><strong>核心价值</strong>：让「删除头节点」和「删除中间节点」、「创建新链表头」和「拼接后续节点」的逻辑完全统一。</p>
<p><strong>示例</strong>：合并两个链表时，用<code>dummy = new ListNode(-1)</code>作为占位符，最终返回<code>dummy.next</code>即可。</p>
<h4 data-id="heading-3">2. 双指针技巧</h4>
<p>链表的绝大多数经典问题（中点、倒数k、环、相交）都依赖双指针，核心是通过指针的「步长差」或「路径差」实现目标：</p>
<ul>
<li>
<p>快慢指针：慢指针走1步，快指针走2步（中点、环检测）；</p>
</li>
<li>
<p>前后指针：前驱指针记录「待删除节点的前一个节点」（删除重复、倒数k）；</p>
</li>
<li>
<p>互换指针：遍历完A链表接B链表，遍历完B链表接A链表（链表相交）。</p>
</li>
</ul>
<h4 data-id="heading-4">3. 栈/堆的辅助使用</h4>
<ul>
<li>
<p>栈：解决「正序链表逆序操作」（如445题两数相加II，正序链表转逆序取数）；</p>
</li>
<li>
<p>最小堆（优先队列）：解决「多链表合并」（如合并k个升序链表、有序矩阵找第k小）。</p>
</li>
</ul>
<h3 data-id="heading-5">二、经典题型拆解（附最优解+易错点）</h3>
<h4 data-id="heading-6">（一）链表的合并：从2个到k个，再到矩阵/数组的「伪合并」</h4>
<p>合并类问题的核心是「筛选最小值/符合条件的值，按序拼接」，从基础的2个链表合并，可延伸到k个链表、有序矩阵等场景。</p>
<h5 data-id="heading-7">1. 合并两个升序链表（LeetCode 21）</h5>
<p><strong>题目要求</strong>：将两个升序链表合并为一个新的升序链表。</p>
<p><strong>核心思路</strong>：双指针「拉拉链」——两个指针分别遍历两个链表，每次选值更小的节点接入新链表，遍历完一个后直接拼接另一个的剩余部分。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-comment">/**
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">ListNode</span>} <span class="hljs-variable">l1</span> - 升序链表1
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">ListNode</span>} <span class="hljs-variable">l2</span> - 升序链表2
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">ListNode</span>} 合并后的升序链表
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">mergeTwoLists</span>(<span class="hljs-params">l1, l2</span>) {
    <span class="hljs-comment">// 虚拟头节点：避免处理l1/l2为空的情况</span>
    <span class="hljs-keyword">const</span> dummy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(-<span class="hljs-number">1</span>);
    <span class="hljs-keyword">let</span> p = dummy; <span class="hljs-comment">// 新链表的尾指针</span>
    <span class="hljs-keyword">let</span> p1 = l1, p2 = l2;

    <span class="hljs-comment">// 核心：选更小的节点接入新链表</span>
    <span class="hljs-keyword">while</span> (p1 !== <span class="hljs-literal">null</span> &amp;&amp; p2 !== <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (p1.<span class="hljs-property">val</span> &lt;= p2.<span class="hljs-property">val</span>) {
            p.<span class="hljs-property">next</span> = p1;
            p1 = p1.<span class="hljs-property">next</span>;
        } <span class="hljs-keyword">else</span> {
            p.<span class="hljs-property">next</span> = p2;
            p2 = p2.<span class="hljs-property">next</span>;
        }
        p = p.<span class="hljs-property">next</span>; <span class="hljs-comment">// 尾指针后移</span>
    }

    <span class="hljs-comment">// 拼接剩余节点（剩余部分本身有序）</span>
    p.<span class="hljs-property">next</span> = p1 === <span class="hljs-literal">null</span> ? p2 : p1;
    <span class="hljs-keyword">return</span> dummy.<span class="hljs-property">next</span>;
}
</code></pre>
<p><strong>易错点</strong>：</p>
<ul>
<li>
<p>忘记拼接剩余节点，导致结果缺失部分链表；</p>
</li>
<li>
<p>尾指针<code>p</code>未后移，始终覆盖<code>dummy.next</code>，最终只保留最后一个节点。</p>
</li>
</ul>
<h5 data-id="heading-8">2. 合并k个升序链表（LeetCode 23）</h5>
<p><strong>题目要求</strong>：合并k个升序链表，返回合并后的升序链表。</p>
<p><strong>核心思路</strong>：最小堆筛选最小值——用堆存储各链表的当前节点，每次取堆顶（最小值）接入新链表，再将该链表的下一个节点入堆。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-comment">/**
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">ListNode[]</span>} <span class="hljs-variable">lists</span> - k个升序链表数组
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">ListNode</span>} 合并后的链表
 */</span>
<span class="hljs-keyword">var</span> mergeKLists = <span class="hljs-keyword">function</span>(<span class="hljs-params">lists</span>) {
    <span class="hljs-keyword">const</span> k = lists.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">if</span> (k === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

    <span class="hljs-comment">// 定义最小堆（按节点值排序）</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">MinHeap</span> {
        <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span> = [];
        }
        <span class="hljs-title function_">push</span>(<span class="hljs-params">node</span>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>.<span class="hljs-title function_">push</span>(node);
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">swim</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);
        }
        <span class="hljs-title function_">pop</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">const</span> min = <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[<span class="hljs-number">0</span>];
            <span class="hljs-keyword">const</span> last = <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>.<span class="hljs-title function_">pop</span>();
            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[<span class="hljs-number">0</span>] = last;
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sink</span>(<span class="hljs-number">0</span>);
            }
            <span class="hljs-keyword">return</span> min;
        }
        <span class="hljs-comment">// 上浮：维护小顶堆</span>
        <span class="hljs-title function_">swim</span>(<span class="hljs-params">idx</span>) {
            <span class="hljs-keyword">while</span> (idx &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">const</span> parent = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((idx - <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>);
                <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[parent].<span class="hljs-property">val</span> &gt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[idx].<span class="hljs-property">val</span>) {
                    [<span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[parent], <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[idx]] = [<span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[idx], <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[parent]];
                    idx = parent;
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">break</span>;
            }
        }
        <span class="hljs-comment">// 下沉：维护小顶堆</span>
        <span class="hljs-title function_">sink</span>(<span class="hljs-params">idx</span>) {
            <span class="hljs-keyword">while</span> (idx * <span class="hljs-number">2</span> + <span class="hljs-number">1</span> &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>.<span class="hljs-property">length</span>) {
                <span class="hljs-keyword">let</span> minIdx = idx * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>;
                <span class="hljs-keyword">const</span> right = idx * <span class="hljs-number">2</span> + <span class="hljs-number">2</span>;
                <span class="hljs-keyword">if</span> (right &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>.<span class="hljs-property">length</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[right].<span class="hljs-property">val</span> &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[minIdx].<span class="hljs-property">val</span>) {
                    minIdx = right;
                }
                <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[idx].<span class="hljs-property">val</span> &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[minIdx].<span class="hljs-property">val</span>) <span class="hljs-keyword">break</span>;
                [<span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[idx], <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[minIdx]] = [<span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[minIdx], <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[idx]];
                idx = minIdx;
            }
        }
        <span class="hljs-title function_">isEmpty</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>;
        }
    }

    <span class="hljs-keyword">const</span> dummy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(-<span class="hljs-number">1</span>);
    <span class="hljs-keyword">let</span> p = dummy;
    <span class="hljs-keyword">const</span> minHeap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MinHeap</span>();

    <span class="hljs-comment">// 初始化堆：各链表的第一个节点入堆</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; k; i++) {
        <span class="hljs-keyword">if</span> (lists[i] !== <span class="hljs-literal">null</span>) minHeap.<span class="hljs-title function_">push</span>(lists[i]);
    }

    <span class="hljs-comment">// 循环取堆顶，拼接链表</span>
    <span class="hljs-keyword">while</span> (!minHeap.<span class="hljs-title function_">isEmpty</span>()) {
        <span class="hljs-keyword">const</span> minNode = minHeap.<span class="hljs-title function_">pop</span>();
        p.<span class="hljs-property">next</span> = minNode;
        p = p.<span class="hljs-property">next</span>;
        <span class="hljs-comment">// 该链表的下一个节点入堆</span>
        <span class="hljs-keyword">if</span> (minNode.<span class="hljs-property">next</span> !== <span class="hljs-literal">null</span>) minHeap.<span class="hljs-title function_">push</span>(minNode.<span class="hljs-property">next</span>);
    }

    <span class="hljs-keyword">return</span> dummy.<span class="hljs-property">next</span>;
};
</code></pre>
<p><strong>易错点</strong>：</p>
<ul>
<li>
<p>堆的比较逻辑写错（如写成大顶堆），导致取到最大值；</p>
</li>
<li>
<p>忘记将「当前节点的下一个节点」入堆，堆很快为空，只合并了各链表的第一个节点；</p>
</li>
<li>
<p>未处理<code>lists</code>中包含<code>null</code>的情况，入堆时报错。</p>
</li>
</ul>
<h5 data-id="heading-9">3. 延伸：有序矩阵中第K小的元素（LeetCode 378）</h5>
<p><strong>核心思路</strong>：将「矩阵的每一行」视为「升序链表」，复用「合并k个链表」的堆思路——每行一个指针，堆存储「行索引+当前值」，每次取最小值后将该行下一个值入堆。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * 通用优先队列实现（支持大顶堆/小顶堆，基于完全二叉树+数组存储）
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} <span class="hljs-variable">compareFn</span> - 比较函数，决定堆类型：
 *                                返回值是负数的时候，第一个参数的优先级更高
 *                               - 小顶堆（默认）：(a,b) =&gt; a - b（返回负数则a优先级高）
 *                               - 大顶堆：(a,b) =&gt; b - a（返回负数则b优先级高）
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">PriorityQueue1</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">compareFn = (a, b) =&gt; a - b</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">compareFn</span> = compareFn; <span class="hljs-comment">// 自定义比较函数（核心：替代硬编码比较）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> = <span class="hljs-number">0</span>; <span class="hljs-comment">// 堆的有效元素个数（≠queue.length，避免数组空洞）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span> = []; <span class="hljs-comment">// 物理存储数组（逻辑完全二叉树）</span>
  }

  <span class="hljs-comment">// 入队：添加元素并上浮堆化</span>
  <span class="hljs-title function_">enqueue</span>(<span class="hljs-params">val</span>) {
    <span class="hljs-comment">// 1. 把新元素放到数组末尾（完全二叉树的最后一个节点）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span>] = val;
    <span class="hljs-comment">// 2. 上浮：维护堆的性质（从新元素位置向上调整）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">swim</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span>);
    <span class="hljs-comment">// 3. 有效元素个数+1（先swim再++，因为swim需要当前索引）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span>++;
  }

  <span class="hljs-comment">// 出队：移除并返回堆顶元素，最后一个元素补位后下沉堆化</span>
  <span class="hljs-title function_">dequeue</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 边界：空队列返回null</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    <span class="hljs-comment">// 1. 保存堆顶元素（要返回的值）</span>
    <span class="hljs-keyword">const</span> peek = <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>[<span class="hljs-number">0</span>];
    <span class="hljs-comment">// 2. 最后一个元素移到堆顶（完全二叉树补位）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>[<span class="hljs-number">0</span>] = <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> - <span class="hljs-number">1</span>];
    <span class="hljs-comment">// 3. 下沉：维护堆的性质（从堆顶向下调整）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sink</span>(<span class="hljs-number">0</span>);
    <span class="hljs-comment">// 4. 有效元素个数-1（堆大小减小）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span>--;
    <span class="hljs-comment">// 可选：清空数组空洞（非必需，但更优雅）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>.<span class="hljs-property">length</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span>;
    <span class="hljs-keyword">return</span> peek;
  }

  <span class="hljs-comment">// 获取堆顶元素（不出队）</span>
  <span class="hljs-title function_">head</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> === <span class="hljs-number">0</span> ? <span class="hljs-literal">null</span> : <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>[<span class="hljs-number">0</span>];
  }

  <span class="hljs-comment">// 获取父节点索引</span>
  <span class="hljs-title function_">parent</span>(<span class="hljs-params">idx</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((idx - <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>);
  }

  <span class="hljs-comment">// 获取左子节点索引</span>
  <span class="hljs-title function_">left</span>(<span class="hljs-params">idx</span>) {
    <span class="hljs-keyword">return</span> idx * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>;
  }

  <span class="hljs-comment">// 获取右子节点索引</span>
  <span class="hljs-title function_">right</span>(<span class="hljs-params">idx</span>) {
    <span class="hljs-keyword">return</span> idx * <span class="hljs-number">2</span> + <span class="hljs-number">2</span>;
  }

  <span class="hljs-comment">// 交换两个节点的值</span>
  <span class="hljs-title function_">swap</span>(<span class="hljs-params">idx1, idx2</span>) {
    [<span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>[idx1], <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>[idx2]] = [<span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>[idx2], <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>[idx1]];
  }

  <span class="hljs-comment">// 上浮（swim）：从idx向上调整，维护堆性质</span>
  <span class="hljs-title function_">swim</span>(<span class="hljs-params">idx</span>) {
    <span class="hljs-comment">// 循环：直到根节点（idx=0）或当前节点不小于父节点</span>
    <span class="hljs-keyword">while</span> (idx &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">const</span> parentIdx = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">parent</span>(idx);
      <span class="hljs-comment">// 核心：用compareFn替代硬编码比较</span>
      <span class="hljs-comment">// compareFn(a,b) &lt; 0 → a优先级更高（应上浮）</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">compareFn</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>[idx], <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>[parentIdx]) &gt;= <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">break</span>; <span class="hljs-comment">// 当前节点优先级不高于父节点，停止上浮</span>
      }
      <span class="hljs-comment">// 交换当前节点和父节点</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">swap</span>(idx, parentIdx);
      <span class="hljs-comment">// 继续向上检查</span>
      idx = parentIdx;
    }
  }

  <span class="hljs-comment">// 下沉（sink）：从idx向下调整，维护堆性质</span>
  <span class="hljs-title function_">sink</span>(<span class="hljs-params">idx</span>) {
    <span class="hljs-comment">// 循环：直到没有左子节点（完全二叉树，左子不存在则右子也不存在）</span>
    <span class="hljs-keyword">while</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">left</span>(idx) &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span>) {
      <span class="hljs-keyword">const</span> leftIdx = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">left</span>(idx);
      <span class="hljs-keyword">const</span> rightIdx = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">right</span>(idx);
      <span class="hljs-comment">// 找到“优先级更高”的子节点（小顶堆找更小的，大顶堆找更大的）</span>
      <span class="hljs-keyword">let</span> priorityIdx = leftIdx;

      <span class="hljs-comment">// 右子节点存在，且右子优先级更高 → 切换到右子</span>
      <span class="hljs-keyword">if</span> (rightIdx &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">compareFn</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>[rightIdx], <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>[leftIdx]) &lt; <span class="hljs-number">0</span>) {
        priorityIdx = rightIdx;
      }

      <span class="hljs-comment">// 当前节点优先级 ≥ 子节点 → 停止下沉</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">compareFn</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>[idx], <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>[priorityIdx]) &lt;= <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">break</span>;
      }

      <span class="hljs-comment">// 交换当前节点和优先级更高的子节点</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">swap</span>(idx, priorityIdx);
      <span class="hljs-comment">// 继续向下检查</span>
      idx = priorityIdx;
    }
  }

  <span class="hljs-comment">// 辅助：判断队列是否为空</span>
  <span class="hljs-title function_">isEmpty</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> === <span class="hljs-number">0</span>;
  }
}
<span class="hljs-comment">/**
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number[][]</span>} <span class="hljs-variable">matrix</span>
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} <span class="hljs-variable">k</span>
 * <span class="hljs-doctag">@return</span> {<span class="hljs-type">number</span>}
 */</span>
<span class="hljs-keyword">var</span> kthSmallest = <span class="hljs-keyword">function</span>(<span class="hljs-params">matrix, k</span>) {
  <span class="hljs-keyword">const</span> rows = matrix.<span class="hljs-property">length</span>
  <span class="hljs-keyword">const</span> cols = matrix[<span class="hljs-number">0</span>].<span class="hljs-property">length</span>
  <span class="hljs-comment">// 每一行，都有一个指针，pArr[0]表示第0行的指针，pArr[1]表示第1行的指针，</span>
  <span class="hljs-keyword">let</span> pArr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(rows).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>)
  <span class="hljs-comment">// 返回值</span>
  <span class="hljs-keyword">let</span> res
  <span class="hljs-comment">// 这里因为需要存储第几行的信息，所以queue队列里存储的不单单是val 还有row的信息，这样的话，需要重新写compareFn</span>
  <span class="hljs-keyword">const</span> pq = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue1</span>(<span class="hljs-function">(<span class="hljs-params">[row1,val1],[row2,val2]</span>)=&gt;</span>val1-val2)
  <span class="hljs-comment">// 每行的第一个元素进队</span>
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> row=<span class="hljs-number">0</span>;row&lt;rows;row++){
    pq.<span class="hljs-title function_">enqueue</span>([row,matrix[row][<span class="hljs-number">0</span>]])
  }
  <span class="hljs-comment">// 当队存在且k&gt;0的时候 说明需要继续</span>
  <span class="hljs-keyword">while</span>(pq.<span class="hljs-property">size</span>&gt;<span class="hljs-number">0</span> &amp;&amp; k&gt;<span class="hljs-number">0</span>){
    <span class="hljs-comment">// 出队的是当前最小的</span>
    <span class="hljs-keyword">const</span> [curRow,curVal] = pq.<span class="hljs-title function_">dequeue</span>()
    <span class="hljs-comment">// 值存下</span>
    res = curVal
    <span class="hljs-comment">// 循环k次就能获取到k小的值</span>
    k--
    <span class="hljs-keyword">const</span> nextCol = pArr[curRow]+<span class="hljs-number">1</span>
    <span class="hljs-keyword">if</span>(nextCol&lt;cols){
      pArr[curRow] = nextCol
      pq.<span class="hljs-title function_">enqueue</span>([curRow,matrix[curRow][nextCol]])
    }
  }
  <span class="hljs-keyword">return</span> res

};
</code></pre>
<p><strong>易错点</strong>：</p>
<ul>
<li>
<p>堆中仅存储值，未记录行索引，无法找到下一个要入堆的值；</p>
</li>
<li>
<p>忽略矩阵单行/单列的边界情况。</p>
</li>
</ul>
<h4 data-id="heading-10">（二）链表的分解：按条件拆分，删除重复</h4>
<p>分解类问题的核心是「用两个虚拟头节点分别存储符合/不符合条件的节点，最后拼接」。</p>
<h5 data-id="heading-11">1. 分隔链表（LeetCode 86）</h5>
<p><strong>题目要求</strong>：将链表分隔为两部分，小于x的节点在前，大于等于x的节点在后，保持原有相对顺序。</p>
<p><strong>核心思路</strong>：两个虚拟头节点分别存储「小于x」和「大于等于x」的节点，遍历原链表后拼接。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-keyword">var</span> partition = <span class="hljs-keyword">function</span>(<span class="hljs-params">head, x</span>) {
    <span class="hljs-comment">// 两个虚拟头节点：分别存储小于x和大于等于x的节点</span>
    <span class="hljs-keyword">const</span> p1Dummy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(-<span class="hljs-number">1</span>);
    <span class="hljs-keyword">const</span> p2Dummy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(-<span class="hljs-number">1</span>);
    <span class="hljs-keyword">let</span> p1 = p1Dummy, p2 = p2Dummy;
    <span class="hljs-keyword">let</span> p = head;

    <span class="hljs-keyword">while</span> (p !== <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (p.<span class="hljs-property">val</span> &lt; x) {
            p1.<span class="hljs-property">next</span> = p;
            p1 = p1.<span class="hljs-property">next</span>;
        } <span class="hljs-keyword">else</span> {
            p2.<span class="hljs-property">next</span> = p;
            p2 = p2.<span class="hljs-property">next</span>;
        }
        p = p.<span class="hljs-property">next</span>;
    }

    <span class="hljs-comment">// 关键：断开p2的尾节点，避免链表成环</span>
    p2.<span class="hljs-property">next</span> = <span class="hljs-literal">null</span>;
    <span class="hljs-comment">// 拼接两个链表</span>
    p1.<span class="hljs-property">next</span> = p2Dummy.<span class="hljs-property">next</span>;

    <span class="hljs-keyword">return</span> p1Dummy.<span class="hljs-property">next</span>;
};
</code></pre>
<p><strong>易错点</strong>：</p>
<ul>
<li>
<p>未断开<code>p2.next</code>，若原链表末尾属于「大于等于x」的部分，会导致链表成环；</p>
</li>
<li>
<p>拼接时错误拼接<code>p2Dummy</code>而非<code>p2Dummy.next</code>，引入无效的虚拟头节点。</p>
</li>
</ul>
<h5 data-id="heading-12">2. 删除排序链表中的重复元素II（LeetCode 82）</h5>
<p><strong>题目要求</strong>：删除链表中所有重复的节点，只保留原链表中没有重复出现的节点。</p>
<p><strong>核心思路</strong>：前驱指针+跳过重复项——前驱指针记录「最后一个不重复的节点」，遍历指针找到所有连续重复节点后，前驱指针跳过这些节点。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-keyword">var</span> deleteDuplicates = <span class="hljs-keyword">function</span>(<span class="hljs-params">head</span>) {
    <span class="hljs-keyword">if</span> (head === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">const</span> dummy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(-<span class="hljs-number">1</span>);
    dummy.<span class="hljs-property">next</span> = head;
    <span class="hljs-keyword">let</span> prev = dummy; <span class="hljs-comment">// 前驱指针：最后一个不重复的节点</span>
    <span class="hljs-keyword">let</span> p = head;     <span class="hljs-comment">// 遍历指针</span>

    <span class="hljs-keyword">while</span> (p) {
        <span class="hljs-comment">// 找到所有连续重复的节点</span>
        <span class="hljs-keyword">if</span> (p.<span class="hljs-property">next</span> &amp;&amp; p.<span class="hljs-property">val</span> === p.<span class="hljs-property">next</span>.<span class="hljs-property">val</span>) {
            <span class="hljs-keyword">while</span> (p &amp;&amp; p.<span class="hljs-property">next</span> &amp;&amp; p.<span class="hljs-property">val</span> === p.<span class="hljs-property">next</span>.<span class="hljs-property">val</span>) {
                p = p.<span class="hljs-property">next</span>;
            }
            <span class="hljs-comment">// 跳过所有重复节点</span>
            prev.<span class="hljs-property">next</span> = p.<span class="hljs-property">next</span>;
            p = p.<span class="hljs-property">next</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 无重复，前驱指针后移</span>
            prev = prev.<span class="hljs-property">next</span>;
            p = p.<span class="hljs-property">next</span>;
        }
    }

    <span class="hljs-keyword">return</span> dummy.<span class="hljs-property">next</span>;
};
</code></pre>
<p><strong>易错点</strong>：</p>
<ul>
<li>
<p>内层循环未判空<code>p &amp;&amp; p.next</code>，导致<code>p.next.val</code>报错；</p>
</li>
<li>
<p>无重复时忘记移动前驱指针<code>prev</code>，<code>prev</code>始终停留在虚拟头节点，最终结果缺失部分节点；</p>
</li>
<li>
<p>仅删除重复节点中的一个，而非全部跳过。</p>
</li>
</ul>
<h4 data-id="heading-13">（三）双指针经典：中点、倒数k、环、相交</h4>
<p>这类问题的核心是「通过指针的步长/路径设计，一次遍历完成目标」，避免先遍历统计长度的二次遍历。</p>
<h5 data-id="heading-14">1. 链表的中间节点（LeetCode 876）</h5>
<p><strong>题目要求</strong>：返回链表的中间节点，偶数长度返回第二个中间节点。</p>
<p><strong>核心思路</strong>：快慢指针——慢指针走1步，快指针走2步，快指针到末尾时，慢指针即为中间节点。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-keyword">var</span> middleNode = <span class="hljs-keyword">function</span>(<span class="hljs-params">head</span>) {
    <span class="hljs-keyword">if</span> (head === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">let</span> slow = head, fast = head;
    <span class="hljs-comment">// 循环条件：fast和fast.next都不为空</span>
    <span class="hljs-keyword">while</span> (fast &amp;&amp; fast.<span class="hljs-property">next</span>) {
        slow = slow.<span class="hljs-property">next</span>;
        fast = fast.<span class="hljs-property">next</span>.<span class="hljs-property">next</span>;
    }

    <span class="hljs-keyword">return</span> slow;
};
</code></pre>
<p><strong>易错点</strong>：</p>
<ul>
<li>
<p>循环条件漏写<code>fast</code>或<code>fast.next</code>，导致<code>fast.next.next</code>报错；</p>
</li>
<li>
<p>混淆偶数长度的返回值（要求返回第二个中间节点，快慢指针的逻辑天然满足）。</p>
</li>
</ul>
<h5 data-id="heading-15">2. 删除链表的倒数第N个节点（LeetCode 19）</h5>
<p><strong>核心思路</strong>：快慢指针拉开N步距离——快指针先前进N步，然后快慢指针同步前进，快指针到末尾时，慢指针指向倒数第N个节点的前驱。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-keyword">var</span> removeNthFromEnd = <span class="hljs-keyword">function</span>(<span class="hljs-params">head, n</span>) {
    <span class="hljs-keyword">if</span> (head === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">const</span> dummy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(-<span class="hljs-number">1</span>);
    dummy.<span class="hljs-property">next</span> = head;
    <span class="hljs-keyword">let</span> slow = dummy, fast = dummy;

    <span class="hljs-comment">// 快指针先前进n步</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) {
        fast = fast.<span class="hljs-property">next</span>;
    }

    <span class="hljs-comment">// 同步前进，快指针到末尾时停止</span>
    <span class="hljs-keyword">while</span> (fast.<span class="hljs-property">next</span>) {
        slow = slow.<span class="hljs-property">next</span>;
        fast = fast.<span class="hljs-property">next</span>;
    }

    <span class="hljs-comment">// 删除倒数第n个节点</span>
    slow.<span class="hljs-property">next</span> = slow.<span class="hljs-property">next</span>.<span class="hljs-property">next</span>;

    <span class="hljs-keyword">return</span> dummy.<span class="hljs-property">next</span>;
};
</code></pre>
<p><strong>易错点</strong>：</p>
<ul>
<li>
<p>未使用虚拟头节点，删除倒数第L个节点（头节点）时出错；</p>
</li>
<li>
<p>快指针前进n步时未判空，n超过链表长度时报错；</p>
</li>
<li>
<p>循环条件写成<code>fast !== null</code>，导致慢指针位置错误。</p>
</li>
</ul>
<h5 data-id="heading-16">3. 环形链表II（LeetCode 142）</h5>
<p><strong>题目要求</strong>：判断链表是否有环，若有则返回环的入口节点。</p>
<p><strong>核心思路</strong>：快慢指针分两步——</p>
<ol>
<li>
<p>判环：慢1快2，相遇则有环；</p>
</li>
<li>
<p>找入口：相遇后慢指针回头部，快慢均走1步，再次相遇即为入口。</p>
</li>
</ol>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-keyword">var</span> detectCycle = <span class="hljs-keyword">function</span>(<span class="hljs-params">head</span>) {
    <span class="hljs-keyword">if</span> (head === <span class="hljs-literal">null</span> || head.<span class="hljs-property">next</span> === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">let</span> slow = head, fast = head;
    <span class="hljs-keyword">while</span> (fast &amp;&amp; fast.<span class="hljs-property">next</span>) {
        slow = slow.<span class="hljs-property">next</span>;
        fast = fast.<span class="hljs-property">next</span>.<span class="hljs-property">next</span>;

        <span class="hljs-comment">// 相遇则找入口</span>
        <span class="hljs-keyword">if</span> (slow === fast) {
            slow = head; <span class="hljs-comment">// 慢指针回头部</span>
            <span class="hljs-keyword">while</span> (slow !== fast) {
                slow = slow.<span class="hljs-property">next</span>;
                fast = fast.<span class="hljs-property">next</span>; <span class="hljs-comment">// 快指针改为走1步</span>
            }
            <span class="hljs-keyword">return</span> slow;
        }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
};
</code></pre>
<p><strong>原理推导</strong>：</p>
<p>设<code>a</code>=表头到入口的距离，<code>b</code>=入口到相遇点的距离，<code>c</code>=相遇点回到入口的距离：</p>
<ul>
<li>
<p>快指针路程：<code>2(a+b) = a + b + n*(b+c)</code> → <code>a = (n-1)*(b+c) + c</code>；</p>
</li>
<li>
<p>当<code>n=1</code>时，<code>a=c</code>，因此慢指针回头部后，同步走必然在入口相遇。</p>
</li>
</ul>
<p><strong>易错点</strong>：</p>
<ul>
<li>
<p>相遇后快指针未改为走1步，仍走2步，无法找到入口；</p>
</li>
<li>
<p>判环时循环条件漏写<code>fast.next</code>，导致报错；</p>
</li>
<li>
<p>忽略单节点成环的情况（如<code>head.next = head</code>）。</p>
</li>
</ul>
<h5 data-id="heading-17">4. 相交链表（LeetCode 160）</h5>
<p><strong>题目要求</strong>：找到两个单链表相交的起始节点，无相交则返回null。</p>
<p><strong>核心思路</strong>：互换指针——p1遍历完A接B，p2遍历完B接A，总路程均为<code>A+B</code>，相交则在交点相遇，否则同时到null。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-keyword">var</span> getIntersectionNode = <span class="hljs-keyword">function</span>(<span class="hljs-params">headA, headB</span>) {
    <span class="hljs-keyword">if</span> (headA === <span class="hljs-literal">null</span> || headB === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">let</span> p1 = headA, p2 = headB;
    <span class="hljs-keyword">while</span> (p1 !== p2) {
        p1 = p1 === <span class="hljs-literal">null</span> ? headB : p1.<span class="hljs-property">next</span>;
        p2 = p2 === <span class="hljs-literal">null</span> ? headA : p2.<span class="hljs-property">next</span>;
    }

    <span class="hljs-keyword">return</span> p1;
};
</code></pre>
<p><strong>易错点</strong>：</p>
<ul>
<li>
<p>担心无限循环：无需担心，p1/p2总路程相等，最终必相遇（要么交点，要么null）；</p>
</li>
<li>
<p>遍历到末尾时未切换到另一个链表，而是直接返回null。</p>
</li>
</ul>
<h4 data-id="heading-18">（四）链表运算：两数相加（逆序/正序）</h4>
<p>链表运算的核心是「模拟手工运算」，结合栈处理正序链表的逆序操作。</p>
<h5 data-id="heading-19">1. 两数相加（LeetCode 2）</h5>
<p><strong>题目要求</strong>：两个逆序存储数字的链表，返回相加后的逆序链表。</p>
<p><strong>核心思路</strong>：模拟手工加法——遍历链表，逐位相加，处理进位。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-keyword">var</span> addTwoNumbers = <span class="hljs-keyword">function</span>(<span class="hljs-params">l1, l2</span>) {
    <span class="hljs-keyword">if</span> (l1 === <span class="hljs-literal">null</span> &amp;&amp; l2 === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">const</span> dummy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(-<span class="hljs-number">1</span>);
    <span class="hljs-keyword">let</span> p = dummy;
    <span class="hljs-keyword">let</span> p1 = l1, p2 = l2;
    <span class="hljs-keyword">let</span> isNeedPlusOne = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 进位标记</span>

    <span class="hljs-keyword">while</span> (p1 || p2 || isNeedPlusOne) {
        <span class="hljs-keyword">let</span> val = isNeedPlusOne ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>;
        <span class="hljs-keyword">if</span> (p1) {
            val += p1.<span class="hljs-property">val</span>;
            p1 = p1.<span class="hljs-property">next</span>;
        }
        <span class="hljs-keyword">if</span> (p2) {
            val += p2.<span class="hljs-property">val</span>;
            p2 = p2.<span class="hljs-property">next</span>;
        }

        isNeedPlusOne = val &gt;= <span class="hljs-number">10</span>;
        val = val % <span class="hljs-number">10</span>;
        p.<span class="hljs-property">next</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(val);
        p = p.<span class="hljs-property">next</span>;
    }

    <span class="hljs-keyword">return</span> dummy.<span class="hljs-property">next</span>;
};
</code></pre>
<h5 data-id="heading-20">2. 两数相加II（LeetCode 445）</h5>
<p><strong>题目要求</strong>：两个正序存储数字的链表，返回相加后的正序链表。</p>
<p><strong>核心思路</strong>：栈逆序取数 + 反向构建链表——先将正序链表入栈，逆序取数相加，再反向构建正序链表。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-keyword">var</span> addTwoNumbers = <span class="hljs-keyword">function</span>(<span class="hljs-params">l1, l2</span>) {
    <span class="hljs-keyword">if</span> (l1 === <span class="hljs-literal">null</span> &amp;&amp; l2 === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

    <span class="hljs-comment">// 正序链表入栈，逆序取数</span>
    <span class="hljs-keyword">const</span> stack1 = [], stack2 = [];
    <span class="hljs-keyword">let</span> p1 = l1, p2 = l2;
    <span class="hljs-keyword">while</span> (p1) { stack1.<span class="hljs-title function_">push</span>(p1.<span class="hljs-property">val</span>); p1 = p1.<span class="hljs-property">next</span>; }
    <span class="hljs-keyword">while</span> (p2) { stack2.<span class="hljs-title function_">push</span>(p2.<span class="hljs-property">val</span>); p2 = p2.<span class="hljs-property">next</span>; }

    <span class="hljs-keyword">let</span> head = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">let</span> isNeedPlusOne = <span class="hljs-literal">false</span>;

    <span class="hljs-comment">// 核心：逆序相加 + 反向构建链表</span>
    <span class="hljs-keyword">while</span> (stack1.<span class="hljs-property">length</span> || stack2.<span class="hljs-property">length</span> || isNeedPlusOne) {
        <span class="hljs-keyword">let</span> val = isNeedPlusOne ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>;
        <span class="hljs-keyword">if</span> (stack1.<span class="hljs-property">length</span>) val += stack1.<span class="hljs-title function_">pop</span>();
        <span class="hljs-keyword">if</span> (stack2.<span class="hljs-property">length</span>) val += stack2.<span class="hljs-title function_">pop</span>();

        isNeedPlusOne = val &gt;= <span class="hljs-number">10</span>;
        val = val % <span class="hljs-number">10</span>;

        <span class="hljs-comment">// 反向构建：新节点作为头节点</span>
        <span class="hljs-keyword">const</span> newNode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(val);
        newNode.<span class="hljs-property">next</span> = head;
        head = newNode;
    }

    <span class="hljs-keyword">return</span> head;
};
</code></pre>
<p><strong>易错点</strong>：</p>
<ul>
<li>
<p>循环条件漏写<code>isNeedPlusOne</code>，漏掉末尾进位（如999+1=1000）；</p>
</li>
<li>
<p>反向构建链表时<code>next</code>指向写反（如<code>head.next = newNode</code>），导致链表断裂；</p>
</li>
<li>
<p>栈取数用<code>shift()</code>而非<code>pop()</code>，取数顺序错误。</p>
</li>
</ul>
<h3 data-id="heading-21">三、面试高频易错点总结（避坑指南）</h3>








































<table><thead><tr><th>场景</th><th>常见错误</th><th>正确做法</th></tr></thead><tbody><tr><td>虚拟头节点</td><td>返回<code>head</code>而非<code>dummy.next</code></td><td>始终返回<code>dummy.next</code>，避免头节点被删除/修改</td></tr><tr><td>链表拼接</td><td>未断开尾节点的<code>next</code></td><td>拼接前将尾节点<code>next</code>置为null，避免成环</td></tr><tr><td>快慢指针</td><td>循环条件漏写<code>fast.next</code></td><td>判环/中点时用<code>while (fast &amp;&amp; fast.next)</code></td></tr><tr><td>堆/栈</td><td>堆的比较逻辑写错（大顶堆/小顶堆混淆）</td><td>小顶堆用<code>a.val - b.val</code>，大顶堆用<code>b.val - a.val</code></td></tr><tr><td>反向构建链表</td><td><code>next</code>指向写反</td><td>正确逻辑：<code>newNode.next = head; head = newNode</code></td></tr><tr><td>进位处理</td><td>进位判断在取余之后</td><td>先判断<code>val &gt;= 10</code>，再取余<code>val % 10</code></td></tr></tbody></table>
<h3 data-id="heading-22">四、总结</h3>
<p>链表题的核心是「指针操作+边界处理」，掌握以下3点即可应对绝大多数面试题：</p>
<ol>
<li>
<p><strong>虚拟头节点</strong>：解决头节点边界问题；</p>
</li>
<li>
<p><strong>双指针</strong>：快慢/前后/互换指针，一次遍历完成目标；</p>
</li>
<li>
<p><strong>栈/堆辅助</strong>：处理逆序/多链表合并场景。</p>
</li>
</ol>
<p>刷题时建议按「合并→分解→双指针→运算」的顺序，每道题先想清楚「指针该怎么动」，再动手写代码，同时标注易错点——面试中不仅要写对代码，更要能讲清「为什么这么写」和「避免了哪些坑」。</p>
</div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[揭秘马斯克甩出王炸，X推荐算法开源，6小时斩获1.6k Star]]></title>    <link>https://juejin.cn/post/7605041451327668267</link>    <guid>https://juejin.cn/post/7605041451327668267</guid>    <pubDate>2026-02-10T13:52:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605041451327668267" data-draft-id="7605041451327651883" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="揭秘马斯克甩出王炸，X推荐算法开源，6小时斩获1.6k Star"/> <meta itemprop="keywords" content="架构,人工智能"/> <meta itemprop="datePublished" content="2026-02-10T13:52:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="不惑_"/> <meta itemprop="url" content="https://juejin.cn/user/1471609400466218"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            揭秘马斯克甩出王炸，X推荐算法开源，6小时斩获1.6k Star
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1471609400466218/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    不惑_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T13:52:01.000Z" title="Tue Feb 10 2026 13:52:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>昨天刷X的时候,突然发现xAI把整个For You推荐算法开源了。说实话,我当时就愣住了。</p>
<p>要知道,推荐算法这东西,对社交平台来说就是命根子。抖音的推荐算法、小红书的推荐逻辑,哪个不是藏着掖着当核心机密?结果马斯克直接把代码扔GitHub上,7000多个star,就这么大大方方让你看。</p>
<p>这背后到底藏着什么秘密?</p>
<h2 data-id="heading-0">一个让我震惊的发现</h2>
<p>我花了整整几个晚上扒完这套代码,发现了一个颠覆认知的事实:<strong>X的推荐系统里,几乎没有人工规则</strong>。</p>
<p>什么意思?传统的推荐系统,工程师会设计几百上千条规则。比如用户点赞过科技类内容,就多推科技,或者转发率高的内容加权。这些都是人脑想出来的逻辑。</p>
<p>但X的算法完全不是这么玩的。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8dc50bd2647145a8b98693ad85e1bfa3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5oORXw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336325&amp;x-signature=ZtOPNAPC%2FEPFIx%2BG4YjEb6LYPJ8%3D" alt="image.png" loading="lazy"/></p>
<p>他们用的是Grok改造的Transformer模型。这个模型会自己观察你过去的所有互动记录,点赞了什么、回复了谁、在哪条推文上停留了多久,然后自己学会你喜欢什么。</p>
<p>没有一条人为设定的规则。</p>
<h2 data-id="heading-1">那些让我眼前一亮的技术细节</h2>
<p>深入看代码的时候,我发现了几个特别巧妙的设计。</p>
<p><strong>第一个是候选隔离机制</strong>。</p>
<p>这个设计解决了一个很多人没意识到的问题:如果你同时推荐100条内容,模型在给A内容打分的时候,会不会受到B内容的影响?</p>
<p>X的解决方案很聪明。他们让Transformer在处理的时候,每条候选内容只能看到你的历史行为,但看不到其他候选内容。就像100个学生各自独立答题,互不影响。</p>
<p>这样做的好处是什么?每条内容的分数是稳定的,可以缓存起来反复使用。如果内容之间能互相影响,那每次推荐的组合不同,分数就会变,系统就乱套了。</p>
<p><strong>第二个是Thunder这个内存数据库</strong>。</p>
<p>你关注的人发的新推文,需要在几毫秒内出现在你的推荐里。如果每次都去查数据库,肯定来不及。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f73ba7a9a7a4a8798536be879f5252d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5oORXw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336325&amp;x-signature=WLXtOcBQ%2BUmQOZZelTiwRQJeHpA%3D" alt="image.png" loading="lazy"/></p>
<p>X直接把最近的推文全部加载到内存里。你关注的人一发推,系统就通过Kafka实时接收,存到Thunder里。查询的时候根本不走硬盘,全在内存里找,速度快到离谱。</p>
<p>这就是为什么你刷新feed,新内容总能立刻出现的原因。</p>
<p><strong>第三个是多行为预测</strong>。</p>
<p>一般的推荐系统只预测一个指标,比如点击率。但X的模型会同时预测你对一条推文的15种可能行为:</p>
<p>点赞、回复、转发、引用、点击、看视频、展开图片、分享、停留时长......</p>
<p>甚至还包括负面行为:点不感兴趣、屏蔽作者、静音、举报。</p>
<p>每个行为都有一个权重。正面行为加分,负面行为扣分。最后把这15个概率乘以各自的权重,加起来就是这条推文的最终得分。</p>
<p>这个设计太精妙了。它不是简单地追求让你点击,它追求的是让你真正喜欢。</p>
<h2 data-id="heading-2">藏在代码里的价值观</h2>
<p>看到这里,你可能会好奇:这套算法到底想推给你什么?</p>
<p>我注意到一个有意思的细节。在评分权重里,<strong>点赞和转发的权重是正的</strong>,这个好理解。但<strong>停留时长的权重也是正的</strong>。</p>
<p>什么意思?如果你在一条推文上停留了很久,即使没点赞,算法也会认为这内容对你有价值。</p>
<p>更关键的是,<strong>点不感兴趣屏蔽举报这些行为,权重是负的</strong>。如果模型预测你很可能会屏蔽某个作者,那这条推文的得分会大幅下降,根本不会推给你。</p>
<p>这说明什么?算法不是在追求让你上瘾,它在努力避免让你反感。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd1b486f593747708ce6e50e54a98f8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5oORXw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336325&amp;x-signature=w%2B3k7yo2iBLMCQNdZOEpk4SCRxM%3D" alt="unnamed.png" loading="lazy"/></p>
<p>这跟抖音那种只要你不划走就一直推类似内容的逻辑完全不同。</p>
<h2 data-id="heading-3">两个让我意外的真相</h2>
<p>深挖代码的过程中,我发现了两个打破我认知的事实。</p>
<p><strong>第一,你的feed里,有一半内容来自你不关注的人</strong>。</p>
<p>X的推荐分两路:Thunder负责推你关注的人发的内容,Phoenix负责在全网范围内找你可能感兴趣的内容。这两路内容最后混在一起,统一打分排序。</p>
<p>所以你经常刷到一些你可能感兴趣的陌生账号,不是bug,是feature。算法故意这么设计的,目的是让你发现新的有价值的声音。</p>
<p><strong>第二,算法会主动降低同一个作者的推荐频率</strong>。</p>
<p>代码里有个叫Author Diversity Scorer的模块,专门用来衰减重复作者的得分。</p>
<p>如果你特别喜欢某个大V,算法确实会多推ta的内容。但当ta的推文在你feed里占比太高时,后面的推文得分会被打折扣。</p>
<p>为什么要这么做?因为信息茧房真的存在。如果你的feed全是同一个人的观点,你的视野会越来越窄。</p>
<p>这个设计让我对X的团队有点刮目相看。他们确实在用技术手段对抗算法本身的缺陷。</p>
<h2 data-id="heading-4">那些被过滤掉的内容</h2>
<p>看到这里,你可能会问:那些你永远刷不到的内容,都去哪了?</p>
<p>代码里有个很长的过滤器列表。在打分之前,系统会先过滤掉这些:</p>
<p>你自己发的推文(废话)、你屏蔽的人、你静音的关键词、超过7天的旧推文、你已经看过的内容、被举报太多次的推文、删除的内容、垃圾信息、暴力血腥......</p>
<p>这个过滤环节分两次。第一次在打分前,第二次在选出Top K之后。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc5f940cc2ec4bdd9d66cccbd659c29c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5oORXw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336325&amp;x-signature=b82EQbSKTLuR%2B81WNAYlb58DEX8%3D" alt="image.png" loading="lazy"/></p>
<p>第二次过滤很关键。因为有些违规内容刚发出来的时候系统还没识别出来,但在准备推送给你的那一刻,审核结果出来了,就会被拦下来。</p>
<p>这也是为什么有时候你刷到一半,突然有条推文消失了。不是你眼花,是它在最后一秒被过滤掉了。</p>
<h2 data-id="heading-5">一个让我陷入沉思的问题</h2>
<p>看完整套代码,我脑子里一直盘旋着一个问题:马斯克为什么要开源这个?</p>
<p>社交平台的推荐算法,这可是最核心的商业机密。字节跳动的推荐算法值多少钱?恐怕没人说得清。</p>
<p>但马斯克就这么把它开放了。</p>
<p>我想了很久,可能有三个原因。</p>
<p><strong>第一,技术自信</strong>。X用的是xAI自己的Grok模型,这个模型本身就是开源的。既然模型都开源了,基于它做的推荐系统再藏着也没意义。反正别人拿去也训练不出同样的效果,因为他们没有X这么多的用户行为数据。</p>
<p><strong>第二,建立信任</strong>。这两年,所有社交平台的推荐算法都在被质疑。用户总觉得算法在操控我。X干脆把代码摊开,你自己看,我到底有没有暗箱操作。这招确实高明。</p>
<p><strong>第三,吸引人才</strong>。这么复杂的工程开源出来,全世界的优秀工程师都能看到X团队的水平。想招人的时候,根本不用自己吹,代码就是最好的简历。</p>
<p>不管出于什么原因,这个举动确实够大胆。</p>
<h2 data-id="heading-6">普通人能从中学到什么</h2>
<p>我知道很多人看到这里会说:这些技术细节跟我有什么关系?我又不是工程师。</p>
<p>但我觉得,理解这套算法的运作逻辑,对每个人都有价值。</p>
<p><strong>首先,你会明白你的行为在训练算法</strong>。</p>
<p>你点的每个赞、看的每个视频、停留的每秒钟,都在告诉算法你喜欢什么。如果你总是点开那些标题党,算法就会给你推更多标题党。如果你经常举报垃圾信息,算法会学会离那些内容远一点。</p>
<p>你在塑造你自己的信息世界。</p>
<p><strong>其次,你会理解为什么有时候刷不到想看的内容</strong>。</p>
<p>不是算法针对你,是过滤规则在起作用。可能那条推文太旧了,可能你之前静音了相关关键词,可能系统认为它可能让你反感。</p>
<p>了解这些,你就知道怎么调整自己的使用习惯,让算法更懂你。</p>
<p><strong>最后,你会意识到算法不是万能的</strong>。</p>
<p>即使X用了最先进的Transformer模型,即使它能预测15种行为,它依然会出错。它不可能完美理解你的每一个需求。</p>
<p>所以主动去关注你感兴趣的账号,主动去搜索你想了解的话题,永远比被动地等算法推送要有效。</p>
<h2 data-id="heading-7">结尾的一点感慨</h2>
<p>写完这篇文章的时候,已经是凌晨1点了。</p>
<p>我重新翻了一遍X算法的代码,突然有个感觉:这套系统最厉害的地方,不是技术有多先进,也不是模型有多复杂。</p>
<p>它厉害在,它尝试在让你多刷和给你真正想看的之间找平衡。</p>
<p>它会推你没关注的账号,避免你活在信息茧房里。它会衰减同一个作者的推送,逼你接触更多元的观点。它会惩罚那些让人反感的内容,即使那些内容点击率很高。</p>
<p>当然,它不是完美的。你还是会刷到垃圾信息,还是会遇到推荐不准的时候。</p>
<p>但至少,它在努力做一个不那么坏的算法。</p>
<p>这可能就是马斯克愿意把它开源的真正原因吧。他想告诉所有人:看,我们的算法就是这样工作的,没有阴谋,没有操控,就是在用数学和工程解决一个复杂的问题。</p>
<p>你信不信,是你的选择。但至少,你现在知道它是怎么运作的了。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Django 入门指南：从零构建强大的 Web 应用]]></title>    <link>https://juejin.cn/post/7604863528944812047</link>    <guid>https://juejin.cn/post/7604863528944812047</guid>    <pubDate>2026-02-10T12:08:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604863528944812047" data-draft-id="7604769326225375268" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Django 入门指南：从零构建强大的 Web 应用"/> <meta itemprop="keywords" content="后端,Python,Django"/> <meta itemprop="datePublished" content="2026-02-10T12:08:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小小张说故事"/> <meta itemprop="url" content="https://juejin.cn/user/741501567509111"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Django 入门指南：从零构建强大的 Web 应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/741501567509111/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小小张说故事
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T12:08:33.000Z" title="Tue Feb 10 2026 12:08:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 库的概览与核心价值</h2>
<p>想象一下，如果你需要从零开始搭建一个完整的网站，就像要盖一栋房子却只有一堆泥土和木材——你需要自己设计地基、砌墙、装修，还要处理水电、门窗等细节。这个过程不仅耗时，而且充满风险。</p>
<p><strong>Django</strong> 正是为解决这种复杂性而生的"全能建筑团队"。作为 Python 世界中最受欢迎的 Web 框架，Django 遵循"batteries included"（自带电池）的设计哲学，为开发者提供了构建 Web 应用所需的一切核心组件：ORM 对象关系映射、自动化的管理后台、强大的表单处理、用户认证系统、模板引擎等。</p>
<p>在 Python 生态中，Django 定位为"企业级全栈框架"。相比于 Flask 的轻量灵活和 FastAPI 的高性能异步，Django 更注重"快速开发"和"安全稳定"。它特别适合需要快速构建内容管理系统（CMS）、电商平台、社交网络等数据驱动的复杂 Web 应用。</p>
<p>Django 的不可替代性体现在：<strong>它让开发者能够专注于业务逻辑，而不是重复造轮子</strong>。正如 Instagram、Pinterest、Mozilla 等知名公司的选择，Django 在保证开发效率的同时，也提供了足够的安全性和可扩展性。</p>
<h2 data-id="heading-1">2. 环境搭建与 "Hello, World"</h2>
<h3 data-id="heading-2">安装说明</h3>
<p>在开始之前，请确保你的系统已安装 Python 3.10 或更高版本。Django 5.0 支持 Python 3.10-3.12。</p>
<p><strong>方式一：使用 pip 安装（推荐）</strong></p>
<pre><code class="hljs language-bash" lang="bash">pip install django==5.0
</code></pre>
<p><strong>方式二：使用 conda 安装</strong></p>
<pre><code class="hljs language-bash" lang="bash">conda install django=5.0
</code></pre>
<p><strong>常见安装失败原因及解决方法：</strong></p>
<ul>
<li>权限不足：使用 <code>pip install --user django</code> 或虚拟环境</li>
<li>网络问题：使用国内镜像源，如 <code>pip install django -i https://pypi.tuna.tsinghua.edu.cn/simple</code></li>
<li>版本冲突：确保 Python 版本符合要求</li>
</ul>
<h3 data-id="heading-3">最简示例：第一个 Django 项目</h3>
<p>让我们创建一个最简单的 Django 项目，输出 "Hello, World!"：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 1. 创建项目</span>
django-admin startproject mysite

<span class="hljs-comment"># 2. 进入项目目录</span>
cd mysite

<span class="hljs-comment"># 3. 启动开发服务器</span>
python manage.py runserver
</code></pre>
<p><strong>逐行解释：</strong></p>
<ol>
<li>
<p><code>django-admin startproject mysite</code>：使用 Django 提供的命令行工具创建一个名为 "mysite" 的项目。这会自动生成项目的基本目录结构和配置文件。</p>
</li>
<li>
<p><code>cd mysite</code>：进入刚创建的项目目录。这是运行后续 Django 命令的必要步骤。</p>
</li>
<li>
<p><code>python manage.py runserver</code>：启动 Django 内置的开发服务器。<code>manage.py</code> 是 Django 项目的管理工具脚本，<code>runserver</code> 命令会启动一个轻量级的 Web 服务器，默认监听 8000 端口。</p>
</li>
</ol>
<p><strong>运行结果：</strong></p>
<p>启动成功后，在浏览器中访问 <code>http://127.0.0.1:8000/</code>，你将看到 Django 的欢迎页面，显示 "The install worked successfully! Congratulations!"，这表示你的 Django 环境已经正确搭建。</p>
<p>要输出 "Hello, World!"，我们需要进一步创建视图和路由：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># mysite/views.py</span>
<span class="hljs-keyword">from</span> django.http <span class="hljs-keyword">import</span> HttpResponse

<span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_world</span>(<span class="hljs-params">request</span>):
    <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">"Hello, World!"</span>)
</code></pre>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># mysite/urls.py</span>
<span class="hljs-keyword">from</span> django.urls <span class="hljs-keyword">import</span> path
<span class="hljs-keyword">from</span> . <span class="hljs-keyword">import</span> views

urlpatterns = [
    path(<span class="hljs-string">''</span>, views.hello_world, name=<span class="hljs-string">'hello_world'</span>),
]
</code></pre>
<p>现在访问 <code>http://127.0.0.1:8000/</code>，就能看到 "Hello, World!" 了。</p>
<h2 data-id="heading-4">3. 核心概念解析</h2>
<p>Django 的核心架构基于 <strong>MVT 模式</strong>（Model-View-Template），这是对传统 MVC 模式的一种变体。理解这三个核心概念及其交互关系是掌握 Django 的关键。</p>
<h3 data-id="heading-5">3.1 Model（模型）- 数据层</h3>
<p>Model 是 Django 与数据库交互的桥梁，它是一个 Python 类，继承自 <code>django.db.models.Model</code>。每个 Model 类对应数据库中的一张表，类的属性对应表的字段。</p>
<p><strong>核心作用：</strong></p>
<ul>
<li>定义数据结构和字段类型</li>
<li>提供数据验证规则</li>
<li>封装数据库操作（增删改查）</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Article</span>(models.Model):
    title = models.CharField(max_length=<span class="hljs-number">200</span>)
    content = models.TextField()
    created_at = models.DateTimeField(auto_now_add=<span class="hljs-literal">True</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__str__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">return</span> self.title
</code></pre>
<h3 data-id="heading-6">3.2 View（视图）- 业务逻辑层</h3>
<p>View 在 Django 中相当于传统 MVC 的 Controller，它负责处理 HTTP 请求、执行业务逻辑、与 Model 交互，并决定返回什么响应。</p>
<p><strong>核心作用：</strong></p>
<ul>
<li>接收用户请求</li>
<li>调用 Model 获取或处理数据</li>
<li>选择合适的 Template 进行渲染</li>
<li>返回 HTTP 响应</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> render
<span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> Article

<span class="hljs-keyword">def</span> <span class="hljs-title function_">article_list</span>(<span class="hljs-params">request</span>):
    articles = Article.objects.<span class="hljs-built_in">all</span>()
    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">'articles/list.html'</span>, {<span class="hljs-string">'articles'</span>: articles})
</code></pre>
<h3 data-id="heading-7">3.3 Template（模板）- 表现层</h3>
<p>Template 负责数据的展示和页面的渲染，使用 Django 模板语言（DTL）将动态数据嵌入 HTML 中。</p>
<p><strong>核心作用：</strong></p>
<ul>
<li>定义页面结构</li>
<li>接收 View 传递的数据</li>
<li>使用模板语法动态渲染内容</li>
<li>实现页面复用（继承、包含）</li>
</ul>
<pre><code class="hljs language-html" lang="html">{% for article in articles %}
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>{{ article.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{ article.content }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>发布时间：{{ article.created_at|date:"Y-m-d" }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
{% endfor %}
</code></pre>
<h3 data-id="heading-8">MVT 架构交互流程</h3>
<p>下图展示了 Django MVT 架构中各组件的交互关系：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[用户浏览器] --&gt;|HTTP请求| B[URL路由系统]
    B --&gt;|匹配URL模式| C[View视图]
    C --&gt;|查询/操作数据| D[Model模型]
    D --&gt;|返回数据| C
    C --&gt;|传递上下文数据| E[Template模板]
    E --&gt;|渲染HTML| C
    C --&gt;|HTTP响应| A
    
    style A fill:#e1f5ff
    style B fill:#fff4e1
    style C fill:#ffe1f5
    style D fill:#e1ffe1
    style E fill:#f5e1ff
</code></pre>
<p><strong>交互流程说明：</strong></p>
<ol>
<li>用户通过浏览器发送 HTTP 请求</li>
<li>URL 路由系统根据 URL 模式匹配到对应的 View</li>
<li>View 调用 Model 进行数据操作（查询、创建、更新、删除）</li>
<li>Model 返回处理后的数据给 View</li>
<li>View 选择合适的 Template，并将数据传递给它</li>
<li>Template 渲染生成 HTML 页面</li>
<li>View 将渲染后的页面作为 HTTP 响应返回给用户</li>
</ol>
<h2 data-id="heading-9">4. 实战演练：构建一个简单的博客系统</h2>
<p>让我们通过一个完整的迷你项目——简单的博客系统，来实践 Django 的核心功能。这个项目将实现文章的列表展示、详情查看、后台管理等功能。</p>
<h3 data-id="heading-10">需求分析</h3>
<p>我们要构建一个具备以下功能的博客系统：</p>
<ul>
<li>在后台管理界面创建、编辑、删除文章</li>
<li>前台展示文章列表</li>
<li>点击文章标题查看文章详情</li>
<li>显示文章的发布时间</li>
</ul>
<h3 data-id="heading-11">方案设计</h3>
<p>我们将使用 Django 的以下核心功能：</p>
<ul>
<li><strong>Model</strong>：定义 <code>Article</code> 模型，包含标题、内容、发布时间字段</li>
<li><strong>Admin</strong>：使用 Django 自带的管理后台快速实现文章管理</li>
<li><strong>View</strong>：创建列表视图和详情视图</li>
<li><strong>Template</strong>：设计文章列表页和详情页</li>
<li><strong>URL 路由</strong>：配置 URL 模式</li>
</ul>
<h3 data-id="heading-12">代码实现</h3>
<p><strong>步骤 1：创建项目和应用</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建项目</span>
django-admin startproject blog_project
<span class="hljs-built_in">cd</span> blog_project

<span class="hljs-comment"># 创建博客应用</span>
python manage.py startapp blog
</code></pre>
<p><strong>步骤 2：定义数据模型</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># blog/models.py</span>
<span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Article</span>(models.Model):
    <span class="hljs-string">"""文章模型"""</span>
    title = models.CharField(<span class="hljs-string">'标题'</span>, max_length=<span class="hljs-number">200</span>)
    content = models.TextField(<span class="hljs-string">'内容'</span>)
    created_at = models.DateTimeField(<span class="hljs-string">'发布时间'</span>, auto_now_add=<span class="hljs-literal">True</span>)
    updated_at = models.DateTimeField(<span class="hljs-string">'更新时间'</span>, auto_now=<span class="hljs-literal">True</span>)
    is_published = models.BooleanField(<span class="hljs-string">'是否发布'</span>, default=<span class="hljs-literal">True</span>)
    
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Meta</span>:
        ordering = [<span class="hljs-string">'-created_at'</span>]
        verbose_name = <span class="hljs-string">'文章'</span>
        verbose_name_plural = <span class="hljs-string">'文章'</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__str__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">return</span> self.title
</code></pre>
<p><strong>步骤 3：注册到管理后台</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># blog/admin.py</span>
<span class="hljs-keyword">from</span> django.contrib <span class="hljs-keyword">import</span> admin
<span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> Article

<span class="hljs-meta">@admin.register(<span class="hljs-params">Article</span>)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ArticleAdmin</span>(admin.ModelAdmin):
    list_display = [<span class="hljs-string">'title'</span>, <span class="hljs-string">'is_published'</span>, <span class="hljs-string">'created_at'</span>, <span class="hljs-string">'updated_at'</span>]
    list_filter = [<span class="hljs-string">'is_published'</span>, <span class="hljs-string">'created_at'</span>]
    search_fields = [<span class="hljs-string">'title'</span>, <span class="hljs-string">'content'</span>]
    list_editable = [<span class="hljs-string">'is_published'</span>]
    date_hierarchy = <span class="hljs-string">'created_at'</span>
</code></pre>
<p><strong>步骤 4：创建视图函数</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># blog/views.py</span>
<span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> render, get_object_or_404
<span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> Article

<span class="hljs-keyword">def</span> <span class="hljs-title function_">article_list</span>(<span class="hljs-params">request</span>):
    <span class="hljs-string">"""文章列表视图"""</span>
    articles = Article.objects.<span class="hljs-built_in">filter</span>(is_published=<span class="hljs-literal">True</span>)
    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">'blog/article_list.html'</span>, {<span class="hljs-string">'articles'</span>: articles})

<span class="hljs-keyword">def</span> <span class="hljs-title function_">article_detail</span>(<span class="hljs-params">request, article_id</span>):
    <span class="hljs-string">"""文章详情视图"""</span>
    article = get_object_or_404(Article, <span class="hljs-built_in">id</span>=article_id, is_published=<span class="hljs-literal">True</span>)
    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">'blog/article_detail.html'</span>, {<span class="hljs-string">'article'</span>: article})
</code></pre>
<p><strong>步骤 5：配置 URL 路由</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># blog/urls.py</span>
<span class="hljs-keyword">from</span> django.urls <span class="hljs-keyword">import</span> path
<span class="hljs-keyword">from</span> . <span class="hljs-keyword">import</span> views

urlpatterns = [
    path(<span class="hljs-string">''</span>, views.article_list, name=<span class="hljs-string">'article_list'</span>),
    path(<span class="hljs-string">'article/&lt;int:article_id&gt;/'</span>, views.article_detail, name=<span class="hljs-string">'article_detail'</span>),
]
</code></pre>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># blog_project/urls.py（项目主路由）</span>
<span class="hljs-keyword">from</span> django.contrib <span class="hljs-keyword">import</span> admin
<span class="hljs-keyword">from</span> django.urls <span class="hljs-keyword">import</span> path, include

urlpatterns = [
    path(<span class="hljs-string">'admin/'</span>, admin.site.urls),
    path(<span class="hljs-string">''</span>, include(<span class="hljs-string">'blog.urls'</span>)),
]
</code></pre>
<p><strong>步骤 6：创建模板文件</strong></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- blog/templates/blog/base.html（基础模板）--&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>{% block title %}我的博客{% endblock %}<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-tag">body</span> { <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Microsoft YaHei'</span>, sans-serif; <span class="hljs-attribute">max-width</span>: <span class="hljs-number">800px</span>; <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto; <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>; }
        <span class="hljs-selector-class">.header</span> { <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">2px</span> solid <span class="hljs-number">#333</span>; <span class="hljs-attribute">padding-bottom</span>: <span class="hljs-number">10px</span>; <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>; }
        <span class="hljs-selector-class">.article</span> { <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">15px</span>; <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">15px</span>; <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5px</span>; }
        <span class="hljs-selector-class">.article-title</span> { <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>; <span class="hljs-attribute">text-decoration</span>: none; }
        <span class="hljs-selector-class">.article-title</span><span class="hljs-selector-pseudo">:hover</span> { <span class="hljs-attribute">color</span>: <span class="hljs-number">#0066cc</span>; }
        <span class="hljs-selector-class">.meta</span> { <span class="hljs-attribute">color</span>: <span class="hljs-number">#999</span>; <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.9em</span>; <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">10px</span>; }
        <span class="hljs-selector-class">.content</span> { <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.8</span>; <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">20px</span>; }
        <span class="hljs-selector-class">.back-link</span> { <span class="hljs-attribute">display</span>: inline-block; <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">20px</span>; <span class="hljs-attribute">color</span>: <span class="hljs-number">#0066cc</span>; }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"header"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"{% url 'article_list' %}"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"text-decoration: none; color: #333;"</span>&gt;</span>我的博客<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    {% block content %}{% endblock %}
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- blog/templates/blog/article_list.html（文章列表页）--&gt;</span>
{% extends 'blog/base.html' %}

{% block title %}文章列表 - 我的博客{% endblock %}

{% block content %}
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>最新文章<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    {% for article in articles %}
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"article"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"{% url 'article_detail' article.id %}"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"article-title"</span>&gt;</span>{{ article.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"meta"</span>&gt;</span>
                发布时间：{{ article.created_at|date:"Y年m月d日 H:i" }}
                {% if article.updated_at != article.created_at %}
                    | 更新时间：{{ article.updated_at|date:"Y年m月d日 H:i" }}
                {% endif %}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    {% empty %}
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>暂无文章<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    {% endfor %}
{% endblock %}
</code></pre>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- blog/templates/blog/article_detail.html（文章详情页）--&gt;</span>
{% extends 'blog/base.html' %}

{% block title %}{{ article.title }} - 我的博客{% endblock %}

{% block content %}
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"article"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>{{ article.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"meta"</span>&gt;</span>
            发布时间：{{ article.created_at|date:"Y年m月d日 H:i" }}
            {% if article.updated_at != article.created_at %}
                | 更新时间：{{ article.updated_at|date:"Y年m月d日 H:i" }}
            {% endif %}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>
            {{ article.content|linebreaks }}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"{% url 'article_list' %}"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"back-link"</span>&gt;</span>← 返回文章列表<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
{% endblock %}
</code></pre>
<p><strong>步骤 7：配置应用设置</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># blog_project/settings.py</span>
INSTALLED_APPS = [
    <span class="hljs-string">'django.contrib.admin'</span>,
    <span class="hljs-string">'django.contrib.auth'</span>,
    <span class="hljs-string">'django.contrib.contenttypes'</span>,
    <span class="hljs-string">'django.contrib.sessions'</span>,
    <span class="hljs-string">'django.contrib.messages'</span>,
    <span class="hljs-string">'django.contrib.staticfiles'</span>,
    <span class="hljs-string">'blog'</span>,  <span class="hljs-comment"># 添加我们的博客应用</span>
]
</code></pre>
<p><strong>步骤 8：生成数据库和创建超级用户</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 生成数据库迁移文件</span>
python manage.py makemigrations

<span class="hljs-comment"># 执行迁移，创建数据库表</span>
python manage.py migrate

<span class="hljs-comment"># 创建超级用户（用于登录管理后台）</span>
python manage.py createsuperuser
<span class="hljs-comment"># 按提示输入用户名、邮箱、密码</span>
</code></pre>
<h3 data-id="heading-13">运行说明</h3>
<p><strong>启动开发服务器：</strong></p>
<pre><code class="hljs language-bash" lang="bash">python manage.py runserver
</code></pre>
<p><strong>访问管理后台：</strong></p>
<ol>
<li>在浏览器中访问 <code>http://127.0.0.1:8000/admin/</code></li>
<li>使用刚创建的超级用户账号登录</li>
<li>在 "文章" 管理界面添加几篇文章</li>
</ol>
<p><strong>查看博客：</strong></p>
<ul>
<li>访问 <code>http://127.0.0.1:8000/</code> 查看文章列表</li>
<li>点击任意文章标题查看详情</li>
</ul>
<p><strong>程序运行结果：</strong>
你将看到一个完整的博客系统，包含文章列表、文章详情、后台管理等功能。所有的增删改查操作都通过 Django 的 ORM 自动完成，无需编写任何 SQL 语句。</p>
<h2 data-id="heading-14">5. 最佳实践与常见陷阱</h2>
<h3 data-id="heading-15">常见错误及规避方法</h3>
<p><strong>错误 1：忘记在 <code>INSTALLED_APPS</code> 中注册应用</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ❌ 错误做法</span>
<span class="hljs-comment"># 创建应用后忘记在 settings.py 中注册</span>
python manage.py startapp myapp
<span class="hljs-comment"># 直接使用模型，导致错误：django.core.exceptions.ImproperlyConfigured</span>

<span class="hljs-comment"># ✅ 正确做法</span>
INSTALLED_APPS = [
    <span class="hljs-comment"># ... 其他应用</span>
    <span class="hljs-string">'myapp'</span>,  <span class="hljs-comment"># 记得注册应用</span>
]
</code></pre>
<p><strong>错误 2：在模板中编写复杂业务逻辑</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ❌ 错误做法</span>
<span class="hljs-comment"># 在模板中进行复杂的数据处理</span>
{% <span class="hljs-keyword">for</span> article <span class="hljs-keyword">in</span> articles %}
    {% <span class="hljs-keyword">if</span> article.content|length &gt; <span class="hljs-number">100</span> %}
        &lt;p&gt;{{ article.content|<span class="hljs-built_in">slice</span>:<span class="hljs-string">":100"</span> }}...&lt;/p&gt;
    {% <span class="hljs-keyword">else</span> %}
        &lt;p&gt;{{ article.content }}&lt;/p&gt;
    {% endif %}
{% endfor %}

<span class="hljs-comment"># ✅ 正确做法</span>
<span class="hljs-comment"># 在 View 中预处理数据</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">article_list</span>(<span class="hljs-params">request</span>):
    articles = Article.objects.annotate(
        short_content=Substr(<span class="hljs-string">'content'</span>, <span class="hljs-number">1</span>, <span class="hljs-number">100</span>)
    )
    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">'blog/list.html'</span>, {<span class="hljs-string">'articles'</span>: articles})
</code></pre>
<p><strong>错误 3：直接使用 <code>.get()</code> 而不处理异常</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ❌ 错误做法</span>
<span class="hljs-comment"># 可能抛出 DoesNotExist 异常导致 500 错误</span>
article = Article.objects.get(<span class="hljs-built_in">id</span>=article_id)

<span class="hljs-comment"># ✅ 正确做法</span>
<span class="hljs-comment"># 使用 get_object_or_404 或 try-except</span>
<span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> get_object_or_404
article = get_object_or_404(Article, <span class="hljs-built_in">id</span>=article_id)
</code></pre>
<h3 data-id="heading-16">最佳实践建议</h3>
<p><strong>1. 使用虚拟环境隔离项目依赖</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建虚拟环境</span>
python -m venv venv

<span class="hljs-comment"># 激活虚拟环境</span>
<span class="hljs-comment"># Windows</span>
venv\Scripts\activate
<span class="hljs-comment"># Mac/Linux</span>
<span class="hljs-built_in">source</span> venv/bin/activate

<span class="hljs-comment"># 安装依赖</span>
pip install django
pip freeze &gt; requirements.txt
</code></pre>
<p><strong>2. 合理组织项目结构</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">project/
├── apps/
│   ├── blog/
│   └── users/
├── config/
│   ├── settings/
│   │   ├── base.py
│   │   ├── development.py
│   │   └── production.py
│   └── urls.py
├── <span class="hljs-type">static</span>/
├── templates/
├── media/
└── manage.py
</code></pre>
<p><strong>3. 充分利用 Django Admin 的定制功能</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@admin.register(<span class="hljs-params">Article</span>)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ArticleAdmin</span>(admin.ModelAdmin):
    <span class="hljs-comment"># 列表页显示字段</span>
    list_display = [<span class="hljs-string">'title'</span>, <span class="hljs-string">'author'</span>, <span class="hljs-string">'created_at'</span>, <span class="hljs-string">'is_published'</span>]
    
    <span class="hljs-comment"># 启用列表页编辑</span>
    list_editable = [<span class="hljs-string">'is_published'</span>]
    
    <span class="hljs-comment"># 添加搜索功能</span>
    search_fields = [<span class="hljs-string">'title'</span>, <span class="hljs-string">'content'</span>]
    
    <span class="hljs-comment"># 添加过滤器</span>
    list_filter = [<span class="hljs-string">'is_published'</span>, <span class="hljs-string">'created_at'</span>, <span class="hljs-string">'author'</span>]
    
    <span class="hljs-comment"># 添加日期层级导航</span>
    date_hierarchy = <span class="hljs-string">'created_at'</span>
    
    <span class="hljs-comment"># 每页显示数量</span>
    list_per_page = <span class="hljs-number">20</span>
</code></pre>
<p><strong>4. 使用 context processors 共享全局数据</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 创建 context processor</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">global_context</span>(<span class="hljs-params">request</span>):
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">'site_name'</span>: <span class="hljs-string">'我的博客'</span>,
        <span class="hljs-string">'current_year'</span>: datetime.now().year,
    }

<span class="hljs-comment"># 在 settings.py 中注册</span>
TEMPLATES = [
    {
        <span class="hljs-string">'OPTIONS'</span>: {
            <span class="hljs-string">'context_processors'</span>: [
                <span class="hljs-comment"># ... 其他 processors</span>
                <span class="hljs-string">'myapp.context_processors.global_context'</span>,
            ],
        },
    },
]
</code></pre>
<p><strong>5. 善用 Django 的信号机制</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.db.models.signals <span class="hljs-keyword">import</span> post_save
<span class="hljs-keyword">from</span> django.dispatch <span class="hljs-keyword">import</span> receiver
<span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> Article

<span class="hljs-meta">@receiver(<span class="hljs-params">post_save, sender=Article</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">send_notification</span>(<span class="hljs-params">sender, instance, created, **kwargs</span>):
    <span class="hljs-string">"""文章保存后发送通知"""</span>
    <span class="hljs-keyword">if</span> created:
        <span class="hljs-comment"># 发送新文章通知</span>
        <span class="hljs-keyword">pass</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-comment"># 发送文章更新通知</span>
        <span class="hljs-keyword">pass</span>
</code></pre>
<h2 data-id="heading-17">6. 进阶指引</h2>
<p>掌握了 Django 的基础知识后，你可以继续探索以下高级主题：</p>
<h3 data-id="heading-18">高级功能</h3>
<ul>
<li><strong>类视图（Class-Based Views）</strong>：使用 <code>ListView</code>、<code>DetailView</code>、<code>CreateView</code> 等通用视图减少代码重复</li>
<li><strong>中间件（Middleware）</strong>：实现请求/响应的横切关注点，如日志记录、性能监控</li>
<li><strong>信号（Signals）</strong>：实现解耦的事件驱动编程</li>
<li><strong>缓存系统</strong>：使用 Redis 或 Memcached 提升应用性能</li>
<li><strong>异步视图</strong>：利用 Django 5.0 的异步支持处理 IO 密集型任务</li>
</ul>
<h3 data-id="heading-19">生态扩展</h3>
<ul>
<li><strong>Django REST Framework</strong>：构建强大的 RESTful API</li>
<li><strong>Celery</strong>：处理异步任务和定时任务</li>
<li><strong>Django CMS</strong>：快速搭建内容管理系统</li>
<li><strong>Wagtail</strong>：现代化的内容管理系统</li>
<li><strong>Django Debug Toolbar</strong>：调试和性能分析工具</li>
</ul>
<h3 data-id="heading-20">学习资源</h3>
<ul>
<li><strong>官方文档</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.djangoproject.com%2Fzh-hans%2F5.0%2F%25EF%25BC%2588%25E6%259C%2580%25E6%259D%2583%25E5%25A8%2581%25E3%2580%2581%25E6%259C%2580%25E5%2585%25A8%25E9%259D%25A2%25EF%25BC%2589" target="_blank" title="https://docs.djangoproject.com/zh-hans/5.0/%EF%BC%88%E6%9C%80%E6%9D%83%E5%A8%81%E3%80%81%E6%9C%80%E5%85%A8%E9%9D%A2%EF%BC%89" ref="nofollow noopener noreferrer">docs.djangoproject.com/zh-hans/5.0…</a></li>
<li><strong>Django Girls 教程</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftutorial.djangogirls.org%2Fzh%2F%25EF%25BC%2588%25E9%2580%2582%25E5%2590%2588%25E5%25AE%258C%25E5%2585%25A8%25E5%2588%259D%25E5%25AD%25A6%25E8%2580%2585%25EF%25BC%2589" target="_blank" title="https://tutorial.djangogirls.org/zh/%EF%BC%88%E9%80%82%E5%90%88%E5%AE%8C%E5%85%A8%E5%88%9D%E5%AD%A6%E8%80%85%EF%BC%89" ref="nofollow noopener noreferrer">tutorial.djangogirls.org/zh/（适合完全初学者…</a></li>
<li><strong>Two Scoops of Django</strong>：Django 最佳实践的权威指南</li>
<li><strong>Django Project GitHub</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdjango%2Fdjango%25EF%25BC%2588%25E6%25BA%2590%25E7%25A0%2581%25E5%25AD%25A6%25E4%25B9%25A0%25EF%25BC%2589" target="_blank" title="https://github.com/django/django%EF%BC%88%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%EF%BC%89" ref="nofollow noopener noreferrer">github.com/django/djan…</a></li>
<li><strong>Stack Overflow Django 标签</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fstackoverflow.com%2Fquestions%2Ftagged%2Fdjango%25EF%25BC%2588%25E9%2597%25AE%25E9%25A2%2598%25E8%25A7%25A3%25E7%25AD%2594%25EF%25BC%2589" target="_blank" title="https://stackoverflow.com/questions/tagged/django%EF%BC%88%E9%97%AE%E9%A2%98%E8%A7%A3%E7%AD%94%EF%BC%89" ref="nofollow noopener noreferrer">stackoverflow.com/questions/t…</a></li>
</ul>
<p>Django 的学习曲线相对平缓，但要真正掌握它的精髓，需要不断地实践和探索。建议从实际项目出发，在解决问题的过程中深入理解各个组件的设计理念和使用技巧。记住，Django 的强大之处不仅在于它的功能丰富，更在于它倡导的"约定优于配置"和"不要重复自己"（DRY）的编程哲学。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[阿里Qwen-Image-2.0实测：终于有一款能听懂人话、写对汉字的AI了]]></title>    <link>https://juejin.cn/post/7604791354259390502</link>    <guid>https://juejin.cn/post/7604791354259390502</guid>    <pubDate>2026-02-10T12:46:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604791354259390502" data-draft-id="7604984549173903369" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="阿里Qwen-Image-2.0实测：终于有一款能听懂人话、写对汉字的AI了"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-02-10T12:46:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            阿里Qwen-Image-2.0实测：终于有一款能听懂人话、写对汉字的AI了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T12:46:04.000Z" title="Tue Feb 10 2026 12:46:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2026年的AI圈开年大戏，比预想中来得更猛烈一些。</p>
<p>就在2月10日，没有任何预热铺垫，阿里巴巴通义千问团队直接把Qwen-Image-2.0摆上了台面。如果你对国产模型的印象还停留在“追赶者”的角色，这次可能得刷新一下认知了。</p>
<p>我看完了所有的官方披露和媒体实测，最直观的感受只有两个字：实用。它不再只是生成一些除了好看一无是处的“显卡壁纸”，而是真正想往你的生产力工具里钻。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2Fasdgdfag-1-1024x811.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/asdgdfag-1-1024x811.webp" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9337e1305e504c25858b611f3cad3f0f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332366&amp;x-signature=BLLOZQA4Fa863VBbOVmcRAhkb9o%3D" alt="asdgdfag" loading="lazy"/></a></p>
<p><strong>瘦身成功，但脑子更灵光了</strong></p>
<p>这次升级最反直觉的一点是模型变“小”了。</p>
<p>相比上一代动辄200亿参数的庞然大物，Qwen-Image-2.0采用了更轻量的7B参数统一架构。别看参数少了，它玩了一手“合二为一”的绝活：这是业界罕见的将“图像生成”和“图像编辑”功能塞进同一个模型里的尝试。</p>
<p>这意味着什么？意味着你不需要在生图模型和修图模型之间来回横跳。生成一张图，觉得左上角光线不对？直接告诉它“把左上角调亮”，同一个大脑瞬间就能处理，推理速度快得惊人。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2Fasdgdfagdf-1-1024x512.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/asdgdfagdf-1-1024x512.webp" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78fadb7056fd463dac7f2aa96c2c6671~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332366&amp;x-signature=Q94dBKwuznDiOj3aAyKWuLi0K6k%3D" alt="asdgdfagdf" loading="lazy"/></a></p>
<p><strong>专治“甲方综合征”的长文本理解</strong></p>
<p>以前玩AI绘图，大家都在卷提示词的精简度。但Qwen-Image-2.0反其道而行之，它支持整整1K token的超长指令。</p>
<p>这直接解决了设计圈的一个痛点：复杂的逻辑。</p>
<p>你可以把一份详细的活动策划、复杂的A/B测试数据，甚至是一段啰嗦的甲方修改意见直接扔给它。它不仅能读懂，还能执行出分叉的时间轴、多图层的海报，甚至是包含“画中画”逻辑的复杂PPT。在AI Arena的测评里，它的文生图拿到了1029分，全球第三，把Flux2-Max这类狠角色都甩在了身后，目前也就谷歌的Nano Banana Pro还能压它一头。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2Fasdgfdgdfsg-1-1024x585.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/asdgfdgdfsg-1-1024x585.webp" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8113772d4a5444758e18f23145ef8f93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332366&amp;x-signature=trCpKhOPNDBNHzA78GFuYrwqw3s%3D" alt="asdgfdgdfsg" loading="lazy"/></a></p>
<p><strong>汉字渲染：这次是真的写对了</strong></p>
<p>对于中文用户来说，Qwen-Image-2.0最大的杀手锏是它对汉字的掌控力。</p>
<p>众所周知，让国外模型写汉字，出来的基本都是“鬼画符”。但阿里毕竟是本土作战，这次的中文渲染能力堪称恐怖。媒体报道中提到一个细节：它能用瘦金体或者小楷，把几百字的《兰亭集序》全文渲染进图片里，错字率极低，而且排版极具美感。</p>
<p>不管是做古风海报，还是生成带数据的商业图表，它终于不再是“文盲”了。这点在办公场景下，价值巨大。</p>
<p><strong>告别“AI油腻感”</strong></p>
<p>在画质方面，2K分辨率（2048×2048）成了标配。更有意思的是它的审美取向。</p>
<p>这一代模型似乎刻意去除了以往AI生成图中那种塑料感十足的“油腻光泽”。无论是人物皮肤的毛孔细节，还是建筑的纹理，它都更倾向于摄影级的真实质感。如果不拿放大镜看，你很难一眼辨别出这是AI画的还是单反拍的。</p>
<p><strong>怎么玩？</strong></p>
<p>阿里这次很良心，没有搞封闭内测那一套。</p>
<p>对于普通玩家，直接去Qwen Chat的网页就能免费白嫖，生图、改图都能试。对于开发者，阿里云百炼平台也已经开了API邀测。</p>
<p>总的来说，Qwen-Image-2.0或许不是参数最大的模型，但它极有可能是目前最懂中文语境、最适合干正经事儿的图像模型。当AI开始能精准画PPT、写书法的时候，它离接管我们的部分工作真的不远了。</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一款开源、强大、简单易用的 .NET 假数据生成利器]]></title>    <link>https://juejin.cn/post/7605041556655947785</link>    <guid>https://juejin.cn/post/7605041556655947785</guid>    <pubDate>2026-02-10T12:54:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605041556655947785" data-draft-id="7604984549173886985" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一款开源、强大、简单易用的 .NET 假数据生成利器"/> <meta itemprop="keywords" content="后端,.NET"/> <meta itemprop="datePublished" content="2026-02-10T12:54:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="追逐时光者"/> <meta itemprop="url" content="https://juejin.cn/user/2770425031690333"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一款开源、强大、简单易用的 .NET 假数据生成利器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2770425031690333/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    追逐时光者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T12:54:39.000Z" title="Tue Feb 10 2026 12:54:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在日常的 .NET 项目开发中，我们经常需要大量的测试数据来验证业务逻辑、填充数据库、进行性能测试或者做产品演示。手动编写这些测试数据不仅枯燥乏味、浪费时间，而且难以覆盖各种边界场景。今天大姚给大家推荐一款开源、强大、简单易用的 .NET 假数据生成库：<strong>Bogus</strong>。</p>
<ul>
<li><strong>👪DotNetGuide技术社区：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FCbPvhmfK4ZWsHJj2eKMk7Q" target="_blank" title="https://mp.weixin.qq.com/s/CbPvhmfK4ZWsHJj2eKMk7Q" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/CbPvhmfK4…</a></li>
</ul>
<h2 data-id="heading-1">项目介绍</h2>
<p>Bogus 是一个基于著名的 faker.js 移植而来的开源（MIT License） .NET 假数据生成库，它为 .NET 开发者提供了一套强大、简单易用的 API，可快速生成各种类型的模拟数据，支持 40+ 种语言区域本地化，广泛应用于单元测试、数据库填充、原型演示以及示例数据生成等场景。</p>
<h2 data-id="heading-2">支持语言</h2>
<p>支持语言：C#、F#、VB.NET。</p>
<h2 data-id="heading-3">应用场景</h2>
<ul>
<li><strong>单元测试 / 集成测试</strong>：快速生成符合业务模型的测试对象，替代手工 Mock 数据。</li>
<li><strong>数据库填充（Seed）</strong> ：开发/测试环境数据库填充真实感十足的假数据。</li>
<li><strong>性能与压力测试</strong>：批量生成大规模数据集来模拟真实负载。</li>
<li><strong>API 开发调试</strong>：快速构造 API 返回的模拟响应数据。</li>
<li><strong>数据脱敏</strong>：替换生产数据中的敏感信息。</li>
</ul>
<h2 data-id="heading-4">支持以下语言环境</h2>
<p>Bogus 支持以下语言环境：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b80fae0df9646318db13df2395e921a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332880&amp;x-signature=ELX7%2BcZZxOFkjntQWixV3TSAlPA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">创建一个 .NET 控制台应用</h2>
<p>接下来我们创建一个名为：<code>BogusExercise</code> .NET 9 控制台应用：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90476a0dde2c4532ae661d74f32fd1c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332880&amp;x-signature=sQfiwX2vpuXP1nIhHLma%2BVmsdDU%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73db0fcd93c64419b5477ee84726819c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332880&amp;x-signature=0%2Bbb4wTDg3oOTnkGyv6xZBWBpb0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">项目 NuGet 安装</h2>
<p>在 NuGet 包管理器控制台中执行：</p>
<pre><code class="hljs">Install-Package Bogus
</code></pre>
<p>或者在 NuGet 包管理器中搜索安装：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e780fccf5044f3f8ac3f2102192f55b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332880&amp;x-signature=GlLJG3R7JonhGHBFzv3N2JCSpcE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">Bogus 快速入门</h2>
<h3 data-id="heading-8">生成 3 个随机订单的模拟用户信息</h3>
<p>以下是 Bogus 仓库中提供的示例代码，使用 Bogus 生成了 3 个带随机订单的模拟用户。</p>
<pre><code class="hljs language-dart" lang="dart">    public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
    </span>{
        <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> Main(string[] args)
        {
            <span class="hljs-comment">//生成 3 个随机订单的模拟用户信息</span>
            <span class="hljs-keyword">var</span> users = GenerateSampleUsers(<span class="hljs-number">3</span>);
        }

        <span class="hljs-comment">///<span class="markdown"> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">summary</span>&gt;</span></span></span></span>
        <span class="hljs-comment">///<span class="markdown"> 生成随机订单的模拟用户</span></span>
        <span class="hljs-comment">///<span class="markdown"> <span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">summary</span>&gt;</span></span></span></span>
        <span class="hljs-comment">///<span class="markdown"> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"count"</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">param</span>&gt;</span></span></span></span>
        <span class="hljs-comment">///<span class="markdown"> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">returns</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">returns</span>&gt;</span></span></span></span>
        public <span class="hljs-keyword">static</span> <span class="hljs-built_in">List</span>&lt;User&gt; GenerateSampleUsers(<span class="hljs-built_in">int</span> count = <span class="hljs-number">3</span>)
        {
            <span class="hljs-comment">// 设置随机种子，生成可重复的数据集</span>
            Randomizer.Seed = <span class="hljs-keyword">new</span> Random(<span class="hljs-number">3897234</span>);

            <span class="hljs-keyword">var</span> fruit = <span class="hljs-keyword">new</span>[] { <span class="hljs-string">"apple"</span>, <span class="hljs-string">"banana"</span>, <span class="hljs-string">"orange"</span>, <span class="hljs-string">"strawberry"</span>, <span class="hljs-string">"kiwi"</span> };

            <span class="hljs-keyword">var</span> orderIds = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">var</span> testOrders = <span class="hljs-keyword">new</span> Faker&lt;Order&gt;()
                <span class="hljs-comment">// 开启严格模式：确保所有属性都有规则</span>
                .StrictMode(<span class="hljs-keyword">true</span>)
                <span class="hljs-comment">// OrderId 自增</span>
                .RuleFor(o =&gt; o.OrderId, f =&gt; orderIds++)
                <span class="hljs-comment">// 从水果篮中随机挑选</span>
                .RuleFor(o =&gt; o.Item, f =&gt; f.PickRandom(fruit))
                <span class="hljs-comment">// 随机数量 1~10</span>
                .RuleFor(o =&gt; o.Quantity, f =&gt; f.Random.Number(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>))
                <span class="hljs-comment">// 可空 int?，80% 概率为 null</span>
                .RuleFor(o =&gt; o.LotNumber, f =&gt; f.Random.Int(<span class="hljs-number">0</span>, <span class="hljs-number">100</span>).OrNull(f, <span class="hljs-number">.8</span>f));

            <span class="hljs-keyword">var</span> userIds = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">var</span> testUsers = <span class="hljs-keyword">new</span> Faker&lt;User&gt;()
                <span class="hljs-comment">// 自定义构造函数</span>
                .CustomInstantiator(f =&gt; <span class="hljs-keyword">new</span> User(userIds++, f.Random.Replace(<span class="hljs-string">"###-##-####"</span>)))
                <span class="hljs-comment">// 基本规则</span>
                .RuleFor(u =&gt; u.FirstName, f =&gt; f.Name.FirstName())
                .RuleFor(u =&gt; u.LastName, f =&gt; f.Name.LastName())
                .RuleFor(u =&gt; u.Avatar, f =&gt; f.Internet.Avatar())
                .RuleFor(u =&gt; u.UserName, (f, u) =&gt; f.Internet.UserName(u.FirstName, u.LastName))
                .RuleFor(u =&gt; u.Email, (f, u) =&gt; f.Internet.Email(u.FirstName, u.LastName))
                .RuleFor(u =&gt; u.SomethingUnique, f =&gt; $<span class="hljs-string">"Value {f.UniqueIndex}"</span>)
                .RuleFor(u =&gt; u.SomeGuid, Guid.NewGuid)
                <span class="hljs-comment">// 随机选取枚举</span>
                .RuleFor(u =&gt; u.Gender, f =&gt; f.PickRandom&lt;Gender&gt;())
                .RuleFor(u =&gt; u.CartId, f =&gt; Guid.NewGuid())
                <span class="hljs-comment">// 组合属性：利用已生成的 FirstName 和 LastName</span>
                .RuleFor(u =&gt; u.FullName, (f, u) =&gt; u.FirstName + <span class="hljs-string">" "</span> + u.LastName)
                <span class="hljs-comment">// 嵌套集合生成</span>
                .RuleFor(u =&gt; u.Orders, f =&gt; testOrders.Generate(<span class="hljs-number">3</span>))
                <span class="hljs-comment">// 生成完成后的回调</span>
                .FinishWith((f, u) =&gt;
                {
                    Console.WriteLine(<span class="hljs-string">"User Created! Name={0}"</span>, u.FullName);
                });

            <span class="hljs-comment">// 一次生成 3 个用户</span>
            <span class="hljs-keyword">return</span> testUsers.Generate(count);
        }
    }

    <span class="hljs-comment">///<span class="markdown"> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">summary</span>&gt;</span></span></span></span>
    <span class="hljs-comment">///<span class="markdown"> 订单实体</span></span>
    <span class="hljs-comment">///<span class="markdown"> <span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">summary</span>&gt;</span></span></span></span>
    public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Order</span>
    </span>{
        public <span class="hljs-built_in">int</span> OrderId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        public string Item { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        public <span class="hljs-built_in">int</span> Quantity { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        public <span class="hljs-built_in">int?</span> LotNumber { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    }

    <span class="hljs-comment">///<span class="markdown"> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">summary</span>&gt;</span></span></span></span>
    <span class="hljs-comment">///<span class="markdown"> 性别枚举</span></span>
    <span class="hljs-comment">///<span class="markdown"> <span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">summary</span>&gt;</span></span></span></span>
    public <span class="hljs-keyword">enum</span> Gender
    {
        Male,
        Female
    }

    <span class="hljs-comment">///<span class="markdown"> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">summary</span>&gt;</span></span></span></span>
    <span class="hljs-comment">///<span class="markdown"> 用户实体</span></span>
    <span class="hljs-comment">///<span class="markdown"> <span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">summary</span>&gt;</span></span></span></span>
    public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span>
    </span>{
        public User(<span class="hljs-built_in">int</span> userId, string ssn)
        {
            <span class="hljs-keyword">this</span>.Id = userId;
            <span class="hljs-keyword">this</span>.SSN = ssn;
        }

        public <span class="hljs-built_in">int</span> Id { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        public string FirstName { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        public string LastName { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        public string FullName { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        public string UserName { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        public string Email { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        public string SomethingUnique { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        public Guid SomeGuid { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        public string Avatar { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        public Guid CartId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        public string SSN { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        public Gender Gender { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        public <span class="hljs-built_in">List</span>&lt;Order&gt; Orders { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    }
</code></pre>
<h3 data-id="heading-9">生成随机用户信息</h3>
<p>使用 Bogus 快速生成随机用户姓名、邮箱、地址、电话等关联数据：</p>
<pre><code class="hljs language-csharp" lang="csharp">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> 生成随机用户信息</span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">GenerateRandomData</span>()</span>
        {
            <span class="hljs-comment">// 自动生成姓名、邮箱、地址、电话等关联数据</span>
            <span class="hljs-keyword">var</span> faker = <span class="hljs-keyword">new</span> Faker(<span class="hljs-string">"zh_CN"</span>);<span class="hljs-comment">// 使用简体中文</span>
            <span class="hljs-keyword">var</span> randomName = faker.Name.FullName();
            <span class="hljs-keyword">var</span> randomEmail = faker.Internet.Email();
            <span class="hljs-keyword">var</span> randomAddress = faker.Address.FullAddress();
            <span class="hljs-keyword">var</span> randomPhone = faker.Phone.PhoneNumber();
            Console.WriteLine(<span class="hljs-string">$"Name: <span class="hljs-subst">{randomName}</span>"</span>);
            Console.WriteLine(<span class="hljs-string">$"Email: <span class="hljs-subst">{randomEmail}</span>"</span>);
            Console.WriteLine(<span class="hljs-string">$"Address: <span class="hljs-subst">{randomAddress}</span>"</span>);
            Console.WriteLine(<span class="hljs-string">$"Phone: <span class="hljs-subst">{randomPhone}</span>"</span>);
        }
</code></pre>
<h3 data-id="heading-10">EF Core 数据库种子数据填充</h3>
<p>使用 EF Core 填充 Blog &amp; Post 数据：</p>
<pre><code class="hljs language-csharp" lang="csharp">    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> EF Core 数据库种子数据填充</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> 适合开发/测试环境，在应用启动时自动填充数据：</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> FakeData.Init(10); // 生成 10 个 Blog，每个包含 3~5 篇 Post</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">FakeData</span>
    {
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;Blog&gt; Blogs = <span class="hljs-keyword">new</span> List&lt;Blog&gt;();
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;Post&gt; Posts = <span class="hljs-keyword">new</span> List&lt;Post&gt;();

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Init</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> count</span>)</span>
        {
            <span class="hljs-keyword">var</span> postId = <span class="hljs-number">1</span>;
            <span class="hljs-keyword">var</span> postFaker = <span class="hljs-keyword">new</span> Faker&lt;Post&gt;()
                .RuleFor(p =&gt; p.PostId, _ =&gt; postId++)
                .RuleFor(p =&gt; p.Title, f =&gt; f.Hacker.Phrase())
                .RuleFor(p =&gt; p.Content, f =&gt; f.Lorem.Sentence());

            <span class="hljs-keyword">var</span> blogId = <span class="hljs-number">1</span>;
            <span class="hljs-keyword">var</span> blogFaker = <span class="hljs-keyword">new</span> Faker&lt;Blog&gt;()
                .RuleFor(b =&gt; b.BlogId, _ =&gt; blogId++)
                .RuleFor(b =&gt; b.Url, f =&gt; f.Internet.Url())
                .RuleFor(b =&gt; b.Posts, (f, b) =&gt;
                {
                    postFaker.RuleFor(p =&gt; p.BlogId, _ =&gt; b.BlogId);
                    <span class="hljs-keyword">var</span> posts = postFaker.GenerateBetween(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>);

                    <span class="hljs-comment">// 关键：收集所有 Posts 到静态列表中</span>
                    Posts.AddRange(posts);

                    <span class="hljs-keyword">return</span> posts;
                });

            <span class="hljs-comment">// 清空旧数据，避免重复调用累积</span>
            Blogs.Clear();
            Posts.Clear();

            Blogs = blogFaker.Generate(count);
        }
    }

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> Blog</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Blog</span>
    {
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> BlogId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Url { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        <span class="hljs-keyword">public</span> List&lt;Post&gt; Posts { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    }

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> Post</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Post</span>
    {
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> PostId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Title { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Content { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> BlogId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    }
</code></pre>
<p>在 Program.cs 启动时填充：</p>
<pre><code class="hljs language-ini" lang="ini">    public class Program
    {
        public static void Main(string<span class="hljs-section">[]</span> args)
        {
            var <span class="hljs-attr">builder</span> = WebApplication.CreateBuilder(args)<span class="hljs-comment">;</span>

            // 注册 DbContext
            builder.Services.AddDbContext&lt;BlogDbContext&gt;(<span class="hljs-attr">options</span> =&gt;
                options.UseSqlServer(builder.Configuration.GetConnectionString("DefaultConnection")))<span class="hljs-comment">;</span>

            var <span class="hljs-attr">app</span> = builder.Build()<span class="hljs-comment">;</span>

            // 应用启动时填充种子数据
            using (var <span class="hljs-attr">scope</span> = app.Services.CreateScope())
            {
                var <span class="hljs-attr">context</span> = scope.ServiceProvider.GetRequiredService&lt;BlogDbContext&gt;()<span class="hljs-comment">;</span>

                // 确保数据库已创建
                context.Database.EnsureCreated()<span class="hljs-comment">;</span>

                // 仅在数据库为空时填充假数据
                if (!context.Blogs.Any())
                {
                    FakeData.Init(10)<span class="hljs-comment">; // 生成 10 个 Blog，每个包含 3~5 篇 Post</span>

                    context.Blogs.AddRange(FakeData.Blogs)<span class="hljs-comment">;</span>
                    context.Posts.AddRange(FakeData.Posts)<span class="hljs-comment">;</span>
                    context.SaveChanges()<span class="hljs-comment">;</span>

                    Console.WriteLine($"已填充 {FakeData.Blogs.Count} 个博客, {FakeData.Posts.Count} 篇文章")<span class="hljs-comment">;</span>
                }
            }

            app.MapControllers()<span class="hljs-comment">;</span>
            app.Run()<span class="hljs-comment">;</span>
        }
    }
</code></pre>
<h3 data-id="heading-11">自定义扩展 Bogus 数据集</h3>
<p>开发者可以轻松扩展 Bogus，添加自定义的数据生成器：</p>
<pre><code class="hljs language-csharp" lang="csharp">    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> 为 Bogus 的 Faker 类提供食品相关的自定义假数据扩展方法</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">FoodExtensions</span>
    {
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> 生成一个随机的糖果名称</span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="faker"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span></span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">Candy</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> Faker faker</span>)</span>
        {
            <span class="hljs-keyword">return</span> faker.PickRandom(<span class="hljs-keyword">new</span>[] { <span class="hljs-string">"巧克力"</span>, <span class="hljs-string">"棒棒糖"</span>, <span class="hljs-string">"口香糖"</span>, <span class="hljs-string">"软糖"</span>, <span class="hljs-string">"太妃糖"</span> });
        }

        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> 生成一个随机的饮品名称</span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="faker"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span></span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">Drink</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> Faker faker</span>)</span>
        {
            <span class="hljs-keyword">return</span> faker.PickRandom(<span class="hljs-keyword">new</span>[] { <span class="hljs-string">"可乐"</span>, <span class="hljs-string">"雪碧"</span>, <span class="hljs-string">"橙汁"</span>, <span class="hljs-string">"咖啡"</span>, <span class="hljs-string">"牛奶"</span> });
        }
    }
    
    <span class="hljs-comment">// 使用自定义扩展</span>
    <span class="hljs-keyword">var</span> faker = <span class="hljs-keyword">new</span> Faker();
    Console.WriteLine(<span class="hljs-string">$"最爱糖果: <span class="hljs-subst">{faker.Candy()}</span>"</span>);
    Console.WriteLine(<span class="hljs-string">$"最爱饮料: <span class="hljs-subst">{faker.Drink()}</span>"</span>);
</code></pre>
<h2 data-id="heading-12">项目源码地址</h2>
<p>更多项目实用功能和特性欢迎前往项目开源地址查看👀，别忘了给项目一个Star支持💖。</p>
<ul>
<li><strong>GitHub开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbchavez%2FBogus" target="_blank" title="https://github.com/bchavez/Bogus" ref="nofollow noopener noreferrer">github.com/bchavez/Bog…</a></li>
<li><strong>文章代码示例：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYSGStudyHards%2FDotNetExercises%2Ftree%2Fmaster%2FBogusExercise" target="_blank" title="https://github.com/YSGStudyHards/DotNetExercises/tree/master/BogusExercise" ref="nofollow noopener noreferrer">github.com/YSGStudyHar…</a></li>
</ul>
<h2 data-id="heading-13">优秀项目和框架精选</h2>
<p>该项目已收录到C#/.NET/.NET Core优秀项目和框架精选中，关注优秀项目和框架精选能让你及时了解C#、.NET和.NET Core领域的最新动态和最佳实践，提高开发工作效率和质量。坑已挖，欢迎大家踊跃提交PR推荐或自荐（<strong>让优秀的项目和框架不被埋没🤞</strong>）。</p>
<ul>
<li><strong>GitHub开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYSGStudyHards%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectPicks.md" target="_blank" title="https://github.com/YSGStudyHards/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md" ref="nofollow noopener noreferrer">github.com/YSGStudyHar…</a></li>
<li><strong>Gitee开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fysgdaydayup%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectPicks.md" target="_blank" title="https://gitee.com/ysgdaydayup/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md" ref="nofollow noopener noreferrer">gitee.com/ysgdaydayup…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C#/.NET/.NET Core优秀项目和框架2026年1月简报]]></title>    <link>https://juejin.cn/post/7604984549173919753</link>    <guid>https://juejin.cn/post/7604984549173919753</guid>    <pubDate>2026-02-10T12:56:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604984549173919753" data-draft-id="7605036907458412595" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C#/.NET/.NET Core优秀项目和框架2026年1月简报"/> <meta itemprop="keywords" content="后端,.NET"/> <meta itemprop="datePublished" content="2026-02-10T12:56:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="追逐时光者"/> <meta itemprop="url" content="https://juejin.cn/user/2770425031690333"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C#/.NET/.NET Core优秀项目和框架2026年1月简报
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2770425031690333/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    追逐时光者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T12:56:03.000Z" title="Tue Feb 10 2026 12:56:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28a0d0e920c44fc19a695c5f81599b41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332965&amp;x-signature=FUItO%2FW9wbn0%2Fz2TMwYkWRAp5Lg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">前言</h2>
<p>公众号每月定期推广和分享的C#/.NET/.NET Core优秀项目和框架（每周至少会推荐两个优秀的项目和框架当然节假日除外），公众号推文中有项目和框架的详细介绍、功能特点、使用方式以及部分功能截图等（打不开或者打开GitHub很慢的同学可以优先查看公众号推文，文末一定会附带项目和框架源码地址）。注意：排名不分先后，都是十分优秀的开源项目和框架，每周定期更新分享。</p>
<ul>
<li><strong>💡简报Gitee开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fysgdaydayup%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectMonthly.md" target="_blank" title="https://gitee.com/ysgdaydayup/DotNetGuide/blob/main/docs/DotNet/DotNetProjectMonthly.md" ref="nofollow noopener noreferrer">gitee.com/ysgdaydayup…</a></strong></li>
<li><strong>🔔简报GitHub开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYSGStudyHards%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectMonthly.md" target="_blank" title="https://github.com/YSGStudyHards/DotNetGuide/blob/main/docs/DotNet/DotNetProjectMonthly.md" ref="nofollow noopener noreferrer">github.com/YSGStudyHar…</a></strong></li>
<li><strong>👪DotNetGuide技术社区：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FCbPvhmfK4ZWsHJj2eKMk7Q" target="_blank" title="https://mp.weixin.qq.com/s/CbPvhmfK4ZWsHJj2eKMk7Q" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/CbPvhmfK4…</a></li>
</ul>
<h2 data-id="heading-1">PicView</h2>
<ul>
<li><strong>项目简介：</strong> PicView 是一款基于 .NET Avalonia 的开源免费、快速、可高度定制、跨平台的图片查看器，支持 macOS 和 Windows 10/11 操作系统。它支持几乎所有常见的图像文件类型，包括但不限于 (animated)WEBP、(animated)GIF、SVG、AVIF、HEIC、PSD 等，为用户提供了一个清洁、无干扰且高效的图片浏览体验。</li>
<li><strong>项目源码地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FRuben2776%2FPicView" target="_blank" title="https://github.com/Ruben2776/PicView" ref="nofollow noopener noreferrer">github.com/Ruben2776/P…</a></li>
<li><strong>项目详细介绍：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FeFQoxqJqbpQAPGpVaXd6Wg" target="_blank" title="https://mp.weixin.qq.com/s/eFQoxqJqbpQAPGpVaXd6Wg" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/eFQoxqJqb…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81f96d3fa1604dfea401d05590894cf0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332965&amp;x-signature=WaoxkSAUYeTRiz3Me9z7%2BIFgxwg%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/babf74fa47fb4f6c97a3a5318f5fb504~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332965&amp;x-signature=Eak5vM3AMHaKzzdHAKeyLY2UPSg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">NanUI</h2>
<ul>
<li><strong>项目简介：</strong> NanUI 是一个基于 .NET 平台的开源（MIT License）框架，旨在帮助开发者使用 HTML5、CSS3 和 JavaScript 构建具有现代感的 WinForm 应用程序用户界面。它底层依托于 Xilium.CefGlue 这是 Chromium Embedded Framework（CEF）在 .NET 环境下的官方绑定实现，通过嵌入完整的 Chromium 渲染引擎，使 WinForm 应用能够呈现 Web 技术驱动的富交互界面。</li>
<li><strong>项目源码地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fdotnetchina%2FNanUI" target="_blank" title="https://gitee.com/dotnetchina/NanUI" ref="nofollow noopener noreferrer">gitee.com/dotnetchina…</a></li>
<li><strong>项目详细介绍：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F2PDN5Q31wX6vEctodVKcig" target="_blank" title="https://mp.weixin.qq.com/s/2PDN5Q31wX6vEctodVKcig" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/2PDN5Q31w…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b217456fd15c42009ad69fd6a0151506~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332965&amp;x-signature=1s2cCQvnFizTMCK6KJBPIDoINMs%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19d819666f0948e697305a41db776f53~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332965&amp;x-signature=27U5KC8jJrLz%2FHYfDQQ%2FygHlZEk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">Generative-AI-for-beginners-dotnet</h2>
<ul>
<li><strong>项目简介：</strong> Generative-AI-for-beginners-dotnet 是一个微软官方开源且实用课程，教你如何在.NET 中构建生成式人工智能应用。</li>
<li><strong>项目源码地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2FGenerative-AI-for-beginners-dotnet" target="_blank" title="https://github.com/microsoft/Generative-AI-for-beginners-dotnet" ref="nofollow noopener noreferrer">github.com/microsoft/G…</a></li>
<li><strong>项目详细介绍：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fzy16qmxDPbxovRwHvKae6g" target="_blank" title="https://mp.weixin.qq.com/s/zy16qmxDPbxovRwHvKae6g" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/zy16qmxDP…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1dec180ab8f24f1a942c24ca5fde1667~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332965&amp;x-signature=g4TFUoIWD19mxxzqL%2BeyE6fPyYA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">XAML Studio</h2>
<ul>
<li><strong>项目简介：</strong> XAML Studio 是一款专为 WinUI XAML 设计的快速原型设计工具，基于 C# 开源（MIT license），生成的代码可轻松复制到 Visual Studio 中的应用中。XAML Studio 让你实时预览 XAML 代码，并与结果互动，就像它在你自己的应用中运行一样。</li>
<li><strong>项目源码地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdotnet%2FXAMLStudio" target="_blank" title="https://github.com/dotnet/XAMLStudio" ref="nofollow noopener noreferrer">github.com/dotnet/XAML…</a></li>
<li><strong>项目详细介绍：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FKf_MrpoC-I7UbhmUNLusow" target="_blank" title="https://mp.weixin.qq.com/s/Kf_MrpoC-I7UbhmUNLusow" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/Kf_MrpoC-…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e08ab50f4ef344c589b0daeba0c36f74~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332965&amp;x-signature=C1EtgCQ7VpBW%2FOD0cvSKInhaKCU%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8174ee62cd704e81bb2bba317730b471~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332965&amp;x-signature=7v%2BsKB402Pkgfs6XVLhYYg%2BiqxE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">Codist</h2>
<ul>
<li><strong>项目简介：</strong> Codist 是一个使用 .NET 编写、开源免费的 Visual Studio 扩展插件，致力于为 C# 程序员提供更好的编程体验和生产效率。它不仅强化了语法高亮、快速信息提示、导航栏、滚动条和显示质量，还集成了自动版本号更新、括号自动补全、支持高级编辑功能的智能工具栏、代码分析等功能。</li>
<li><strong>项目源码地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fwmjordan%2FCodist" target="_blank" title="https://github.com/wmjordan/Codist" ref="nofollow noopener noreferrer">github.com/wmjordan/Co…</a></li>
<li><strong>项目详细介绍：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FUWuCIY4Q5PJeNClrQWPGEw" target="_blank" title="https://mp.weixin.qq.com/s/UWuCIY4Q5PJeNClrQWPGEw" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/UWuCIY4Q5…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36c7dca1f9ec44b8a0d5e7f7b397c405~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332965&amp;x-signature=nb%2BguVASxRKkMKdFzVu3M3Vz4J0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">PropertyTools</h2>
<ul>
<li><strong>项目简介：</strong> PropertyTools 是一款开源（MIT license）、免费的 WPF 自定义控件集，该控件集涵盖了 PropertyGrid、DataGrid、支持多选的 TreeView、ColorPicker 等常用控件。</li>
<li><strong>项目源码地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FPropertyTools%2FPropertyTools" target="_blank" title="https://github.com/PropertyTools/PropertyTools" ref="nofollow noopener noreferrer">github.com/PropertyToo…</a></li>
<li><strong>项目详细介绍：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FfLsTZWyY1W7UFJWCmIa4mQ" target="_blank" title="https://mp.weixin.qq.com/s/fLsTZWyY1W7UFJWCmIa4mQ" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/fLsTZWyY1…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25fa205b29f54571a4b8c9ccb68c6b48~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332965&amp;x-signature=mtvfUeOEwUbuT9FBGYfpMFkGq%2Bg%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1eac31637b0140aa9baf4f36f382dcb8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332965&amp;x-signature=NEERduwnFzUUM8Q3kXo6iGs7NgM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">WMES</h2>
<ul>
<li><strong>项目简介：</strong> WMES 是一套基于 ASP.NET 6.0 MVC + SqlSugar + LayUI 的框架，源代码完全开源。该系统旨在帮助企业解决 C#.NET 项目的重复工作，提高开发效率，节省人力成本，同时保持高度的灵活性。系统支持多数据库类型，模块化设计，层次结构清晰，内置一系列企业信息管理的基础功能。</li>
<li><strong>项目源码地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fbzh%2Fwmes" target="_blank" title="https://gitee.com/bzh/wmes" ref="nofollow noopener noreferrer">gitee.com/bzh/wmes</a></li>
<li><strong>项目详细介绍：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FsYCB90ss0sRiOS17F-fdhg" target="_blank" title="https://mp.weixin.qq.com/s/sYCB90ss0sRiOS17F-fdhg" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/sYCB90ss0…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09eee9e8b9b7417681924f94f41cc54d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332965&amp;x-signature=DUlTBZ%2BlMTcAoqu9FYFCXuLhFAA%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/569ba6734aff466091f06f0ae0e916b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332965&amp;x-signature=7S66qG5s%2FnR9Dj%2FgQWZ1b3s05w0%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React父子组件通信：从“武林秘籍”看懂数据流向]]></title>    <link>https://juejin.cn/post/7604793276908208191</link>    <guid>https://juejin.cn/post/7604793276908208191</guid>    <pubDate>2026-02-10T12:59:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604793276908208191" data-draft-id="7604769326225424420" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React父子组件通信：从“武林秘籍”看懂数据流向"/> <meta itemprop="keywords" content="前端,React.js,JavaScript"/> <meta itemprop="datePublished" content="2026-02-10T12:59:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NEXT06"/> <meta itemprop="url" content="https://juejin.cn/user/1176918763246011"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React父子组件通信：从“武林秘籍”看懂数据流向
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1176918763246011/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NEXT06
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T12:59:50.000Z" title="Tue Feb 10 2026 12:59:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在React的江湖中，组件就像是各大门派的武林人士。有的位高权重如“父组件”，有的初出茅庐如“子组件”。在这个世界里，内功心法（数据）的传递有着森严的等级和规矩。</p>
<p>很多初学者在面对组件通信时，往往会被各种 Props、Callback、Context 搞得晕头转向。其实，只要搞懂了数据的流向，这套武功秘籍也就融会贯通了。</p>
<p>今天，我们就用一套“武林法则”，彻底拆解React中的四种核心通信方式。</p>
<h2 data-id="heading-0">一、父传子：盟主传授“单向秘籍”</h2>
<p>这是最基础的招式。想象一下，父组件是武林盟主，手里有一本绝世武功《九阴真经》（State），他想把这套武功传给刚入门的小徒弟（子组件）。</p>
<p><strong>江湖规矩：</strong></p>
<ol>
<li><strong>授受不亲</strong>：盟主必须亲手把秘籍递给徒弟（在子组件标签上绑定属性）。</li>
<li><strong>只读铁律</strong>：徒弟拿到秘籍后，只能研读修炼，绝对不能擅自涂改秘籍上的文字！如果徒弟试图修改 Props，就会走火入魔（报错）。</li>
</ol>
<p><strong>代码演练：</strong></p>
<p>父组件（盟主）将 name 传给子组件：</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 父组件 Parent.jsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./Child"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> state = {
        <span class="hljs-attr">name</span>: <span class="hljs-string">'九阴真经'</span> <span class="hljs-comment">// 盟主手里的秘籍</span>
    };
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>武林盟主（父组件）<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
            {/* 盟主发功：将秘籍打包成 msg 属性传给徒弟 */}
            <span class="hljs-tag">&lt;<span class="hljs-name">Child</span> <span class="hljs-attr">msg</span>=<span class="hljs-string">{state.name}</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
}
</code></pre>
<p>子组件（徒弟）接收秘籍，谨记只读：</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 子组件 Child.jsx</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Child</span>(<span class="hljs-params">props</span>) {
    <span class="hljs-comment">// props.msg = '葵花宝典'; // 错误示范：徒弟不能擅自篡改秘籍，否则报错！</span>
    
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            {/* 徒弟展示学到的招式 */}
            <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>入室弟子（子组件）-- 习得：{props.msg}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
}
</code></pre>
<p><strong>核心心法</strong>：Props 是只读（Read-Only）的。数据流向是从上至下的单向流动，这保证了数据源的纯净和可追溯。</p>
<h2 data-id="heading-1">二、子传父：徒弟呈递“飞鸽传书”</h2>
<p>有时候，青出于蓝而胜于蓝。徒弟（子组件）自己悟出了一套新招式（State），想要上报给盟主（父组件）。但江湖规矩森严，徒弟不能直接把招式塞进盟主的脑子里。</p>
<p><strong>江湖规矩：</strong></p>
<ol>
<li><strong>锦囊妙计</strong>：盟主需要先给徒弟一个“空锦囊”（函数）。</li>
<li><strong>装入招式</strong>：徒弟在适当时机，把自己的新招式装进锦囊（调用函数并传参）。</li>
<li><strong>飞鸽回传</strong>：锦囊一旦封好，就会自动飞回盟主手中，盟主打开锦囊，更新自己的内力（setState）。</li>
</ol>
<p><strong>代码演练：</strong></p>
<p>父组件准备“锦囊”（函数）：</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 父组件 Parent.jsx</span>
<span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./Child"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);

    <span class="hljs-comment">// 定义锦囊：这是一个用来接收徒弟数据的函数</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">receiveMove</span> = (<span class="hljs-params">n</span>) =&gt; {
        <span class="hljs-title function_">setCount</span>(n); <span class="hljs-comment">// 盟主收到招式后，更新自己的内力</span>
    }

    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>盟主内力值：{count}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
            {/* 把锦囊（函数）传给徒弟 */}
            <span class="hljs-tag">&lt;<span class="hljs-name">Child</span> <span class="hljs-attr">getNum</span>=<span class="hljs-string">{receiveMove}</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
}
</code></pre>
<p>子组件使用“锦囊”回传数据：</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 子组件 Child.jsx</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Child</span>(<span class="hljs-params">props</span>) {
    <span class="hljs-keyword">const</span> state = {
        <span class="hljs-attr">num</span>: <span class="hljs-number">100</span> <span class="hljs-comment">// 徒弟自创的新招式</span>
    };

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">send</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 关键一步：调用父组件给的函数，把数据作为参数传回去</span>
        props.<span class="hljs-title function_">getNum</span>(state.<span class="hljs-property">num</span>);
    }

    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>入室弟子<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{send}</span>&gt;</span>飞鸽传书给盟主<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}
</code></pre>
<p><strong>核心心法</strong>：React 中没有直接的“子传父”语法，本质是<strong>父组件将函数作为 Props 传递给子组件，子组件执行该函数</strong>。</p>
<h2 data-id="heading-2">三、兄弟组件：盟主充当“中间人”</h2>
<p>现在有两个徒弟：大师兄（Child1）和二师弟（Child2）。大师兄想把自己的内力传给二师弟，怎么办？他们之间没有直接的经脉相连（无直接通信渠道）。</p>
<p><strong>江湖规矩：</strong></p>
<ol>
<li><strong>中转站</strong>：必须由师父（父组件）出面。</li>
<li><strong>状态提升</strong>：大师兄先把内力传给师父（子传父），师父收到后，再把内力传给二师弟（父传子）。</li>
</ol>
<p>这在武学中被称为“移花接木”，在 React 中叫<strong>状态提升（Lifting State Up）</strong> 。</p>
<p><strong>代码演练：</strong></p>
<p>父组件作为枢纽：</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 父组件 Parent.jsx</span>
<span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Child1</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./Child1"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Child2</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./Child2"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> [message, setMessage] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">"等待传功..."</span>);

    <span class="hljs-comment">// 接收大师兄数据的锦囊</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">getFromChild1</span> = (<span class="hljs-params">msg</span>) =&gt; {
        <span class="hljs-title function_">setMessage</span>(msg);
    }

    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>武林盟主（中转站）<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
            {/* 接收端：把函数给大师兄 */}
            <span class="hljs-tag">&lt;<span class="hljs-name">Child1</span> <span class="hljs-attr">transfer</span>=<span class="hljs-string">{getFromChild1}</span> /&gt;</span>
            {/* 发送端：把收到的数据给二师弟 */}
            <span class="hljs-tag">&lt;<span class="hljs-name">Child2</span> <span class="hljs-attr">msg</span>=<span class="hljs-string">{message}</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}
</code></pre>
<p>大师兄（发送方）：</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Child1.jsx</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Child1</span>(<span class="hljs-params">props</span>) {
    <span class="hljs-keyword">const</span> energy = <span class="hljs-string">"混元霹雳手"</span>; 
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> props.transfer(energy)}&gt;
                大师兄：发送内力
            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}
</code></pre>
<p>二师弟（接收方）：</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Child2.jsx</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Child2</span>(<span class="hljs-params">props</span>) {
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            {/* 展示从师父那里转交过来的大师兄的内力 */}
            <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>二师弟：接收到的招式 -- {props.msg}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}
</code></pre>
<p><strong>核心心法</strong>：兄弟不分家，全靠父当家。遇到兄弟通信，先找共同的父组件，把状态提升上去。</p>
<h2 data-id="heading-3">四、跨组件通信：狮子吼“全域广播”</h2>
<p>如果门派等级森严，盟主要把消息传给徒弟的徒弟的徒弟（孙组件、重孙组件），一层层传 Props 实在是太慢了，而且容易出错（Prop Drilling）。</p>
<p>这时候，盟主会使用绝学“千里传音”或“狮子吼”（Context API）。</p>
<p><strong>江湖规矩：</strong></p>
<ol>
<li><strong>建立广播台</strong>：使用 createContext 创建一个信号塔。</li>
<li><strong>发功（Provider）</strong> ：盟主在高处使用 Provider 发出信号，笼罩在信号范围内的所有后代。</li>
<li><strong>接收（Consumer/useContext）</strong> ：任何层级的徒子徒孙，只要有 useContext 这个接收器，就能直接听到盟主的声音，无需中间人转述。</li>
</ol>
<p><strong>代码演练：</strong></p>
<p>建立广播台（Context）：</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Context.js</span>
<span class="hljs-keyword">import</span> { createContext } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">SectContext</span> = <span class="hljs-title function_">createContext</span>(); <span class="hljs-comment">// 创建门派广播台</span>
</code></pre>
<p>父组件发功：</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Parent.jsx</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">SectContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./Context'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./Child"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">SectContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{</span>'<span class="hljs-attr">武林至尊</span>，<span class="hljs-attr">宝刀屠龙</span>'}&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>盟主发出狮子吼<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">Child</span> /&gt;</span> {/* 子组件内部包裹着孙组件 */}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">SectContext.Provider</span>&gt;</span></span>
    );
}
</code></pre>
<p>孙组件（无需经过子组件）直接接收：</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Grandson.jsx</span>
<span class="hljs-keyword">import</span> { useContext } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">SectContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./Context'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Grandson</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 越级接收：直接获取上下文中的数据</span>
    <span class="hljs-keyword">const</span> secret = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">SectContext</span>);
    
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h4</span>&gt;</span>徒孙接收到的广播：{secret}<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
}
</code></pre>
<p><strong>核心心法</strong>：Context 能够打破组件层级的限制，实现数据的“隔空传送”，非常适合处理主题颜色、用户登录状态等全局数据。</p>
<h2 data-id="heading-4">五、结语：武功谱总结</h2>
<p>React 的组件通信，归根结底就是<strong>数据流向</strong>的管理。不要死记硬背代码，要理解数据是从哪里来，要到哪里去。</p>
<p>最后，附上一份“武功谱”供各位少侠修炼参考：</p>



































<table><thead><tr><th>通信方式</th><th>适用场景</th><th>核心流向</th><th>隐喻</th></tr></thead><tbody><tr><td><strong>Props</strong></td><td>父子通信</td><td>父 -&gt; 子</td><td>盟主传秘籍（只读）</td></tr><tr><td><strong>Callback</strong></td><td>子父通信</td><td>子 -&gt; 父</td><td>徒弟用锦囊飞鸽传书</td></tr><tr><td><strong>状态提升</strong></td><td>兄弟通信</td><td>子A -&gt; 父 -&gt; 子B</td><td>盟主做中间人移花接木</td></tr><tr><td><strong>Context</strong></td><td>跨级通信</td><td>Provider -&gt; Consumer</td><td>狮子吼全域广播</td></tr></tbody></table>
<p>愿各位在 React 的江湖中，内功深厚，Bug 不侵！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[全栈进阶-redis最佳入门实战项目篇]]></title>    <link>https://juejin.cn/post/7604853010171428905</link>    <guid>https://juejin.cn/post/7604853010171428905</guid>    <pubDate>2026-02-10T11:23:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604853010171428905" data-draft-id="7604853010171412521" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="全栈进阶-redis最佳入门实战项目篇"/> <meta itemprop="keywords" content="前端,Python,Redis"/> <meta itemprop="datePublished" content="2026-02-10T11:23:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="只与明月听"/> <meta itemprop="url" content="https://juejin.cn/user/386661153249102"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            全栈进阶-redis最佳入门实战项目篇
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/386661153249102/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    只与明月听
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T11:23:31.000Z" title="Tue Feb 10 2026 11:23:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、环境准备</h2>
<p>后端采用<code>Python + FastApi</code>，<code>Redis</code>和<code>MySQL</code>都在云服务器上，通过docker安装的，向外暴露接口实现的远程连接。</p>
<h5 data-id="heading-1">服务部署</h5>
<p>前面介绍过<a href="https://juejin.cn/post/7579887768228085794" target="_blank" title="https://juejin.cn/post/7579887768228085794">fastapi</a>的基本语法，但是缺了部署这个环节，在这里补充下。</p>
<p>我的安装环境都是在阿里云的云服务器上，采用的是<code>pm2</code>来管理fastapi项目，首先在<code>centos</code>上安装相关依赖和环境：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 更新系统</span>
sudo yum update -y
​
<span class="hljs-comment"># 2. 安装 EPEL 源（Python 虚拟环境需要）</span>
sudo yum install -y epel-release
​
<span class="hljs-comment"># 3. 安装 Python3 和 pip</span>
sudo yum install -y python3 python3-pip python3-venv python3-wheel
​
<span class="hljs-comment"># 确认 Python 安装</span>
python3 -V
pip3 -V
​
<span class="hljs-comment"># 4. 安装 Node.js (使用官方源安装最新 LTS)</span>
curl -fsSL https://rpm.nodesource.com/setup_lts.x | sudo bash -
sudo yum install -y nodejs
​
<span class="hljs-comment"># 确认 Node 和 npm 安装</span>
node -v
npm -v
​
<span class="hljs-comment"># 5. 安装 PM2 全局</span>
sudo npm install -g pm2
pm2 -v
​
</code></pre>
<p>准备测试脚本：</p>
<p>首先准备下虚拟环境：</p>
<pre><code class="hljs">python3 -m venv venv
​
venv\Scripts\activate
</code></pre>
<p>新建<code>main.py</code></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime
​
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, HTTPException, Query
<span class="hljs-keyword">import</span> pymysql
​
​
app = FastAPI(title=<span class="hljs-string">"Simple MySQL Query Service"</span>)
​
​
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_connection</span>() -&gt; pymysql.connections.Connection:
    <span class="hljs-string">"""创建并返回一个 MySQL 连接。"""</span>
​
    <span class="hljs-keyword">return</span> pymysql.connect(
        host=<span class="hljs-string">"118.31.xxx"</span>,
        port=<span class="hljs-number">3307</span>,
        user=<span class="hljs-string">"root"</span>,
        password=<span class="hljs-string">"xxx"</span>,
        database=<span class="hljs-string">"blog"</span>,
        cursorclass=pymysql.cursors.DictCursor,
        charset=<span class="hljs-string">"utf8mb4"</span>,
    )
​
​
<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/hello"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">hello</span>():
    <span class="hljs-string">"""返回 你好 + 当前时间（年月日 时分秒）。"""</span>
​
    now = datetime.now()
    current_time = now.strftime(<span class="hljs-string">"%Y年%m月%d日 %H:%M:%S"</span>)
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"message"</span>: <span class="hljs-string">f"你好，当前时间是：<span class="hljs-subst">{current_time}</span>"</span>}
​
​
<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/student_score"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_student_score</span>(<span class="hljs-params">number: <span class="hljs-built_in">str</span> = Query(<span class="hljs-params">..., description=<span class="hljs-string">"学生编号"</span></span>)</span>):
    <span class="hljs-string">"""根据 number 查询 blog 库中 student_score 表的 subject 和 score。"""</span>
​
    <span class="hljs-keyword">try</span>:
        conn = get_connection()
        <span class="hljs-keyword">with</span> conn:
            <span class="hljs-keyword">with</span> conn.cursor() <span class="hljs-keyword">as</span> cursor:
                sql = (
                    <span class="hljs-string">"SELECT subject, score "</span>
                    <span class="hljs-string">"FROM student_score "</span>
                    <span class="hljs-string">"WHERE number = %s"</span>
                )
                cursor.execute(sql, (number,))
                rows = cursor.fetchall()
    <span class="hljs-keyword">except</span> pymysql.MySQLError <span class="hljs-keyword">as</span> exc:  <span class="hljs-comment"># 数据库连接或执行出错</span>
        detail = (
            exc.args[<span class="hljs-number">1</span>]
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(exc.args) &gt; <span class="hljs-number">1</span>
            <span class="hljs-keyword">else</span> <span class="hljs-built_in">str</span>(exc)
        )
        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">500</span>, detail=<span class="hljs-string">f"数据库错误: <span class="hljs-subst">{detail}</span>"</span>) <span class="hljs-keyword">from</span> exc
​
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> rows:
        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">404</span>, detail=<span class="hljs-string">"未找到该 number 对应的成绩"</span>)
​
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"number"</span>: number, <span class="hljs-string">"results"</span>: rows}
​
​
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-keyword">import</span> uvicorn
​
    uvicorn.run(<span class="hljs-string">"main:app"</span>, host=<span class="hljs-string">"0.0.0.0"</span>, port=<span class="hljs-number">8000</span>, reload=<span class="hljs-literal">True</span>)
​
</code></pre>
<p>本地运行下<code>python mian.py</code>，然后测试下我们的接口，看来是没问题的。就着手开始部署到线上。</p>
<p>新建<code>Gunicorn</code>配置文件<code>gunicorn_config.py</code>：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">bind</span> = <span class="hljs-string">"0.0.0.0:8011"</span>          <span class="hljs-comment"># 对外端口</span>
<span class="hljs-attr">workers</span> = <span class="hljs-number">2</span>                    <span class="hljs-comment"># worker 数量，看 CPU 调整</span>
<span class="hljs-attr">worker_class</span> = <span class="hljs-string">"uvicorn.workers.UvicornWorker"</span>
<span class="hljs-attr">timeout</span> = <span class="hljs-number">60</span>
<span class="hljs-attr">accesslog</span> = <span class="hljs-string">"logs/access.log"</span>
<span class="hljs-attr">errorlog</span> = <span class="hljs-string">"logs/error.log"</span>
<span class="hljs-attr">loglevel</span> = <span class="hljs-string">"info"</span>
</code></pre>
<p>开始新建项目依赖<code>requirements.txt</code></p>
<pre><code class="hljs language-css" lang="css">fastapi
uvicorn<span class="hljs-selector-attr">[standard]</span>
pymysql
</code></pre>
<p>同时我的<code>nginx</code>的代理转发的配置文件，是这样的</p>
<pre><code class="hljs language-ini" lang="ini">location /fastapi/query/ {
        proxy_pass http://127.0.0.1:8011/<span class="hljs-comment">;</span>
        proxy_set_header Host $host<span class="hljs-comment">;</span>
        proxy_set_header X-Real-IP $remote_addr<span class="hljs-comment">;</span>
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for<span class="hljs-comment">;</span>
        proxy_set_header X-Forwarded-Proto $scheme<span class="hljs-comment">;</span>
        proxy_redirect off<span class="hljs-comment">;</span>
    }
</code></pre>
<p>接下来将项目文件压缩成zip包，拖到服务器的指定目录，运行<code>unzip query.zip</code>解压即可。</p>
<p>然后开始安装依赖：</p>
<pre><code class="hljs language-bash" lang="bash">首先开启虚拟环境：
python3 -m venv venv
<span class="hljs-built_in">source</span> venv/bin/activate
​
然后安装依赖
pip install -r requirements.txt
​
这一步可能安装巨慢，建议切换阿里云的下载链接
</code></pre>
<blockquote>
<p>这里巨坑，折腾了我一个多小时，阿里云的python版本默认是3.6.8，使用<code>Gunicorn</code>需要3.10以上的，一开始安装依赖一直卡住了，也不报错，换了好几个源，还是不行，我以为我服务器带宽小导致的，换成本地安装，然后拖到服务器上，这才发现是版本的原因，然后安装<code>3.11.9</code>后删除虚拟环境，重新安装才成功。</p>
</blockquote>
<p>安装成功后，就可以啦。</p>
<p>测试下：运行<code>gunicorn -c gunicorn_config.py main:app</code>，在开启一个服务器连接，</p>
<pre><code class="hljs language-perl" lang="perl">输入：
curl <span class="hljs-string">"http://127.0.0.1:8011/hello"</span>
{<span class="hljs-string">"message"</span>:<span class="hljs-string">"你好，当前时间是：2026年02月08日 15:38:53"</span>}[root@iZbp1f9urggte5qz3ri1riZ ~]<span class="hljs-comment"># </span>
curl <span class="hljs-string">"http://127.0.0.1:8011/student_score?number=20180101"</span>
{<span class="hljs-string">"number"</span>:<span class="hljs-string">"20180101"</span>,<span class="hljs-string">"results"</span>:[{<span class="hljs-string">"subject"</span>:<span class="hljs-string">"母猪的产后护理"</span>,<span class="hljs-string">"score"</span>:<span class="hljs-number">78</span>},{<span class="hljs-string">"subject"</span>:<span class="hljs-string">"论萨达姆的战争准备"</span>,<span class="hljs-string">"score"</span>:<span class="hljs-number">88</span>}]}[root@iZbp1f9urg
</code></pre>
<p>可以看到我们的服务器已经正常运行了，二级域名已经解析了，nginx代理也已经配置了，</p>
<p>输入<code>curl http://api.jinxudong.com/fastapi/query/hello</code>可以看到正常的接口输出的，说明我们的脚本已经部署成功了，但是这种部署方式还是比较原始的，而且后续服务肯定不止这个一个，我打算采用<code>pm2</code>来管理这些服务。</p>
<p>在项目的根目录写上配置文件<code>ecosystem.config.js</code></p>
<pre><code class="hljs language-css" lang="css">module<span class="hljs-selector-class">.exports</span> = {
  apps: [
    {
      name: <span class="hljs-string">"query"</span>,
      script: <span class="hljs-string">"bash"</span>,
      args: <span class="hljs-string">"-c '/var/www/python/query/venv/bin/gunicorn -c gunicorn_config.py main:app'"</span>,
      cwd: <span class="hljs-string">"/var/www/python/query"</span>
    }
  ]
};
​
</code></pre>
<p>运行脚本<code>pm2 start ecosystem.config.js</code>就可以看到我们的服务了，在设置下开机自启：</p>
<pre><code class="hljs">pm2 save
pm2 startup
</code></pre>
<p>我们的服务已经正常部署到线上啦，可以通过域名去访问</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/api.jinxudong.com/fastapi</span><span class="hljs-regexp">/query/student</span>_score?number=<span class="hljs-number">20180101</span>
​
{<span class="hljs-string">"number"</span><span class="hljs-symbol">:<span class="hljs-string">"20180101"</span></span>,<span class="hljs-string">"results"</span><span class="hljs-symbol">:</span>[{<span class="hljs-string">"subject"</span><span class="hljs-symbol">:<span class="hljs-string">"母猪的产后护理"</span></span>,<span class="hljs-string">"score"</span><span class="hljs-symbol">:</span><span class="hljs-number">78</span>},{<span class="hljs-string">"subject"</span><span class="hljs-symbol">:<span class="hljs-string">"论萨达姆的战争准备"</span></span>,<span class="hljs-string">"score"</span><span class="hljs-symbol">:</span><span class="hljs-number">88</span>}]}
</code></pre>
<h5 data-id="heading-2">压测工具介绍</h5>
<p>一个系统上线后，是必须要经过压测的，就是模拟大量用户同时访问服务，找到系统的极限QPS，极限并发，找出性能瓶颈，避免线上事故。</p>
<p>接下来介绍两个常见的压测工具：</p>
<ol>
<li>
<p>ab</p>
<p>这是<code>Apache</code>自带的压测工具，非常的简轻量，很适合小接口测试，做下简单的性能验证。</p>
<p>首先安装下这个工具</p>
<pre><code class="hljs">yum install httpd-tools
</code></pre>
<p>使用也很简单</p>
<pre><code class="hljs language-ini" lang="ini">ab -n 1000 -c 50 https://api.jinxudong.com/fastapi/query/student_score?<span class="hljs-attr">number</span>=<span class="hljs-number">20180101</span>
</code></pre>
<p>用50的并发完成1000次请求，看下ab的输出日志</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Server Software:</span>        <span class="hljs-string">nginx/1.20.1</span>
<span class="hljs-attr">Server Hostname:</span>        <span class="hljs-string">api.jinxudong.com</span>
<span class="hljs-attr">Server Port:</span>            <span class="hljs-number">443</span>
<span class="hljs-attr">SSL/TLS Protocol:</span>       <span class="hljs-string">TLSv1.2,ECDHE-RSA-AES256-GCM-SHA384,2048,256</span>
<span class="hljs-attr">Server Temp Key:</span>        <span class="hljs-string">X25519</span> <span class="hljs-number">253</span> <span class="hljs-string">bits</span>
<span class="hljs-attr">TLS Server Name:</span>        <span class="hljs-string">api.jinxudong.com</span>
<span class="hljs-string">​</span>
<span class="hljs-attr">Document Path:</span>          <span class="hljs-string">/fastapi/query/student_score?number=20180101</span>
<span class="hljs-attr">Document Length:</span>        <span class="hljs-number">133</span> <span class="hljs-string">bytes</span>
<span class="hljs-string">​</span>
<span class="hljs-attr">Concurrency Level:</span>      <span class="hljs-number">50</span>
<span class="hljs-attr">Time taken for tests:</span>   <span class="hljs-number">17.659</span> <span class="hljs-string">seconds</span>
<span class="hljs-attr">Complete requests:</span>      <span class="hljs-number">1000</span>
<span class="hljs-attr">Failed requests:</span>        <span class="hljs-number">0</span>
<span class="hljs-attr">Total transferred:</span>      <span class="hljs-number">283000</span> <span class="hljs-string">bytes</span>
<span class="hljs-attr">HTML transferred:</span>       <span class="hljs-number">133000</span> <span class="hljs-string">bytes</span>
<span class="hljs-attr">Requests per second:</span>    <span class="hljs-number">56.63</span> [<span class="hljs-comment">#/sec] (mean)</span>
<span class="hljs-attr">Time per request:</span>       <span class="hljs-number">882.956</span> [<span class="hljs-string">ms</span>] <span class="hljs-string">(mean)</span>
<span class="hljs-attr">Time per request:</span>       <span class="hljs-number">17.659</span> [<span class="hljs-string">ms</span>] <span class="hljs-string">(mean</span>, <span class="hljs-string">across</span> <span class="hljs-string">all</span> <span class="hljs-string">concurrent</span> <span class="hljs-string">requests)</span>
<span class="hljs-attr">Transfer rate:</span>          <span class="hljs-number">15.65</span> [<span class="hljs-string">Kbytes/sec</span>] <span class="hljs-string">received</span>
<span class="hljs-string">​</span>
<span class="hljs-string">Connection</span> <span class="hljs-string">Times</span> <span class="hljs-string">(ms)</span>
              <span class="hljs-string">min</span>  <span class="hljs-string">mean</span>[<span class="hljs-string">+/-sd</span>] <span class="hljs-string">median</span>   <span class="hljs-string">max</span>
<span class="hljs-attr">Connect:</span>       <span class="hljs-number">11</span>   <span class="hljs-number">56</span> <span class="hljs-number">119.1</span>     <span class="hljs-number">13</span>    <span class="hljs-number">1471</span>
<span class="hljs-attr">Processing:</span>    <span class="hljs-number">32</span>  <span class="hljs-number">810</span> <span class="hljs-number">212.6</span>    <span class="hljs-number">807</span>    <span class="hljs-number">1854</span>
<span class="hljs-attr">Waiting:</span>       <span class="hljs-number">30</span>  <span class="hljs-number">810</span> <span class="hljs-number">212.6</span>    <span class="hljs-number">806</span>    <span class="hljs-number">1854</span>
<span class="hljs-attr">Total:</span>         <span class="hljs-number">48</span>  <span class="hljs-number">866</span> <span class="hljs-number">258.9</span>    <span class="hljs-number">828</span>    <span class="hljs-number">2290</span>
<span class="hljs-string">​</span>
<span class="hljs-string">Percentage</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">requests</span> <span class="hljs-string">served</span> <span class="hljs-string">within</span> <span class="hljs-string">a</span> <span class="hljs-string">certain</span> <span class="hljs-string">time</span> <span class="hljs-string">(ms)</span>
  <span class="hljs-number">50</span><span class="hljs-string">%</span>    <span class="hljs-number">828</span>
  <span class="hljs-number">66</span><span class="hljs-string">%</span>    <span class="hljs-number">911</span>
  <span class="hljs-number">75</span><span class="hljs-string">%</span>    <span class="hljs-number">998</span>
  <span class="hljs-number">80</span><span class="hljs-string">%</span>   <span class="hljs-number">1041</span>
  <span class="hljs-number">90</span><span class="hljs-string">%</span>   <span class="hljs-number">1195</span>
  <span class="hljs-number">95</span><span class="hljs-string">%</span>   <span class="hljs-number">1295</span>
  <span class="hljs-number">98</span><span class="hljs-string">%</span>   <span class="hljs-number">1559</span>
  <span class="hljs-number">99</span><span class="hljs-string">%</span>   <span class="hljs-number">1798</span>
 <span class="hljs-number">100</span><span class="hljs-string">%</span>   <span class="hljs-number">2290</span> <span class="hljs-string">(longest</span> <span class="hljs-string">request)</span>
</code></pre>
<p>看下几个核心指标</p>
<ol>
<li>
<p><code>Request per second</code>，也就是常说的QPS，也就是每秒可以处理56个请求</p>
</li>
<li>
<p><code>Time per request</code>，平均响应时间</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-type">Time</span> <span class="hljs-keyword">per</span> request:       <span class="hljs-number">882.956</span> [ms] (mean)
<span class="hljs-type">Time</span> <span class="hljs-keyword">per</span> request:       <span class="hljs-number">17.659</span> [ms] (mean, across <span class="hljs-keyword">all</span> concurrent requests)
</code></pre>
<p>第一个时间单个请求平均耗时，这是用户真实的体验时间，第二个时间是平均耗时/并发数</p>
</li>
<li>
<p>延迟分布</p>
<pre><code class="hljs language-shell" lang="shell">Percentage of the requests served within a certain time (ms)
<span class="hljs-meta prompt_">  50% </span><span class="bash">   828</span>
<span class="hljs-meta prompt_">  66% </span><span class="bash">   911</span>
<span class="hljs-meta prompt_">  75% </span><span class="bash">   998</span>
<span class="hljs-meta prompt_">  80% </span><span class="bash">  1041</span>
<span class="hljs-meta prompt_">  90% </span><span class="bash">  1195</span>
<span class="hljs-meta prompt_">  95% </span><span class="bash">  1295</span>
<span class="hljs-meta prompt_">  98% </span><span class="bash">  1559</span>
<span class="hljs-meta prompt_">  99% </span><span class="bash">  1798</span>
<span class="hljs-meta prompt_"> 100% </span><span class="bash">  2290 (longest request)</span>
</code></pre>
<p>第一个数字是百分比，第二个是耗时，换成表格是这样</p>





























<table><thead><tr><th>百分位</th><th>含义</th></tr></thead><tbody><tr><td>P50</td><td>50%请求 &lt; 828ms</td></tr><tr><td>P90</td><td>90%请求 &lt; 1195ms</td></tr><tr><td>P95</td><td>95%请求 &lt; 1295ms</td></tr><tr><td>P99</td><td>99%请求 &lt; 1798ms</td></tr><tr><td>max</td><td>最慢请求 2290ms</td></tr></tbody></table>
</li>
<li>
<p>连接时间分析</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">Connection</span> <span class="hljs-string">Times</span> <span class="hljs-string">(ms)</span>
              <span class="hljs-string">min</span>  <span class="hljs-string">mean[+/-sd]</span> <span class="hljs-string">median</span>   <span class="hljs-string">max</span>
<span class="hljs-attr">Connect:</span>       <span class="hljs-number">11</span>   <span class="hljs-number">56</span> <span class="hljs-number">119.1</span>     <span class="hljs-number">13</span>    <span class="hljs-number">1471</span>
<span class="hljs-attr">Processing:</span>    <span class="hljs-number">32</span>  <span class="hljs-number">810</span> <span class="hljs-number">212.6</span>    <span class="hljs-number">807</span>    <span class="hljs-number">1854</span>
<span class="hljs-attr">Waiting:</span>       <span class="hljs-number">30</span>  <span class="hljs-number">810</span> <span class="hljs-number">212.6</span>    <span class="hljs-number">806</span>    <span class="hljs-number">1854</span>
<span class="hljs-attr">Total:</span>         <span class="hljs-number">48</span>  <span class="hljs-number">866</span> <span class="hljs-number">258.9</span>    <span class="hljs-number">828</span>    <span class="hljs-number">2290</span>
</code></pre>
<p>这里的<code>Connect</code>就是<code>TCP</code>握手简历链接的时间，<code>Processing</code>就是后端处理的时间</p>
</li>
</ol>
</li>
<li>
<p>wrk</p>
</li>
</ol>
<p>wrk目前是后端常用的压测工具，支持多线程和Lua脚本，可以模拟真实并发。</p>
<p>首先在服务器上安装下</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment">#先安装编译工具</span>
sudo yum groupinstall <span class="hljs-string">"Development Tools"</span> -y
sudo yum install git -y
<span class="hljs-comment">#下载</span>
curl -L -o wrk.zip https://codeload.github.com/wg/wrk/zip/refs/heads/master
unzip wrk.zip
<span class="hljs-built_in">cd</span> wrk-master
​
<span class="hljs-comment">#编译</span>
make
​
<span class="hljs-comment">#复制到全局路径</span>
sudo <span class="hljs-built_in">cp</span> wrk /usr/local/bin/
</code></pre>
<p>安装成功以后，直接测试：</p>
<pre><code class="hljs language-ini" lang="ini">wrk -t4 -c100 -d30s --latency https://api.jinxudong.com/fastapi/query/student_score?<span class="hljs-attr">number</span>=<span class="hljs-number">20180101</span>
</code></pre>
<p>意思就是四个线程，100的并发，测试30秒</p>
<pre><code class="hljs language-matlab" lang="matlab">  <span class="hljs-number">4</span> threads and <span class="hljs-number">100</span> connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     <span class="hljs-number">1.18</span>s    <span class="hljs-number">66.72</span>ms   <span class="hljs-number">1.42</span>s    <span class="hljs-number">96.70</span><span class="hljs-comment">%</span>
    Req/Sec    <span class="hljs-number">36.35</span>     <span class="hljs-number">26.08</span>   <span class="hljs-number">100.00</span>     <span class="hljs-number">54.00</span><span class="hljs-comment">%</span>
  Latency Distribution
     <span class="hljs-number">50</span><span class="hljs-comment">%    1.18s </span>
     <span class="hljs-number">75</span><span class="hljs-comment">%    1.19s </span>
     <span class="hljs-number">90</span><span class="hljs-comment">%    1.20s </span>
     <span class="hljs-number">99</span><span class="hljs-comment">%    1.23s </span>
  <span class="hljs-number">2483</span> requests in <span class="hljs-number">30.07</span>s, <span class="hljs-number">698.34</span>KB read
Requests/<span class="hljs-built_in">sec</span>:     <span class="hljs-number">82.58</span>
Transfer/<span class="hljs-built_in">sec</span>:     <span class="hljs-number">23.22</span>KB
</code></pre>
<p>可以看到，<code>Requests/sec</code>就是吞吐量82，每秒可以处理82个请求，平均延迟1.23秒，</p>
<p>压测还是比较简单的，就是利用工具查看qps和延迟时间，当qps不涨，延迟时间飞涨甚至于报错，那说明就到达极限了。</p>
<p>下面就开始实战环节了。</p>
<h2 data-id="heading-3">二、信息查询系统</h2>
<p>这是一个查询商品信息的系统，就是查询商品详情，为了增加系统的吞吐量，常见的做法就是增加一个缓存层，流程就是：请求接口来了，先去查询redis缓存层，缓存命中就直接返回；如果未命中再去查库。这也是前面介绍的旁路缓存，用内存换取数据库压力。</p>
<p>系统架构图如下</p>
<pre><code class="hljs language-lua" lang="lua">客户端 (浏览器/APP)
        |
        v
    FastAPI 接口层
        |
    <span class="hljs-comment">-----------------</span>
    |               |
Redis 缓存         MySQL 数据库
</code></pre>
<h5 data-id="heading-4">环境准备</h5>
<p>数据库设计</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> products (
    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT,
    name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    price <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    stock <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    description TEXT,
    updated_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>
);
</code></pre>
<p><code>id</code> 是主键</p>
<p><code>name</code>, <code>price</code>, <code>stock</code>, <code>description</code> 是商品核心信息</p>
<p><code>updated_at</code> 商品的更新时间，可以用于后面缓存过期策略（缓存失效时刷新）</p>
<p>然后插入一些测试数据</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> products (name, price, stock, description)
<span class="hljs-keyword">SELECT</span>
    CONCAT(<span class="hljs-string">'商品-'</span>, t.num),
    ROUND(RAND() <span class="hljs-operator">*</span> <span class="hljs-number">500</span> <span class="hljs-operator">+</span> <span class="hljs-number">10</span>, <span class="hljs-number">2</span>),
    <span class="hljs-built_in">FLOOR</span>(RAND() <span class="hljs-operator">*</span> <span class="hljs-number">100</span>),
    CONCAT(<span class="hljs-string">'这是商品 '</span>, t.num, <span class="hljs-string">' 的描述'</span>)
<span class="hljs-keyword">FROM</span> (
    <span class="hljs-keyword">SELECT</span> a.n <span class="hljs-operator">+</span> b.n <span class="hljs-operator">*</span> <span class="hljs-number">10</span> <span class="hljs-operator">+</span> c.n <span class="hljs-operator">*</span> <span class="hljs-number">100</span> <span class="hljs-operator">+</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> num
    <span class="hljs-keyword">FROM</span>
        (<span class="hljs-keyword">SELECT</span> <span class="hljs-number">0</span> n <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">2</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">3</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">4</span>
         <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">5</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">6</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">7</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">8</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">9</span>) a,
        (<span class="hljs-keyword">SELECT</span> <span class="hljs-number">0</span> n <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">2</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">3</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">4</span>
         <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">5</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">6</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">7</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">8</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">9</span>) b,
        (<span class="hljs-keyword">SELECT</span> <span class="hljs-number">0</span> n <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">2</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">3</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">4</span>
         <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">5</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">6</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">7</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">8</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">9</span>) c
) t
<span class="hljs-keyword">WHERE</span> t.num <span class="hljs-operator">&lt;=</span> <span class="hljs-number">1000</span>;
</code></pre>
<p>准备工作已经就绪，接下来开始编写代码啦</p>
<h5 data-id="heading-5">系统编写</h5>
<p>代码也比较简单，就是一个查询接口，和前面是实例基本一致</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/get_product"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_product</span>(<span class="hljs-params"><span class="hljs-built_in">id</span>: <span class="hljs-built_in">int</span> = Query(<span class="hljs-params">..., description=<span class="hljs-string">"商品编号"</span></span>)</span>):
    <span class="hljs-string">"""根据商品 id 查询商品信息。"""</span>
    <span class="hljs-keyword">try</span>:
        conn = get_connection()
        <span class="hljs-keyword">with</span> conn:
            <span class="hljs-keyword">with</span> conn.cursor() <span class="hljs-keyword">as</span> cursor:
                sql = (
                    <span class="hljs-string">"SELECT * "</span>
                    <span class="hljs-string">"FROM products "</span>
                    <span class="hljs-string">"WHERE id = %s"</span>
                )
                cursor.execute(sql, (<span class="hljs-built_in">id</span>,))
                rows = cursor.fetchall()
    <span class="hljs-keyword">except</span> pymysql.MySQLError <span class="hljs-keyword">as</span> exc:  <span class="hljs-comment"># 数据库连接或执行出错</span>
        detail = (
            exc.args[<span class="hljs-number">1</span>]
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(exc.args) &gt; <span class="hljs-number">1</span>
            <span class="hljs-keyword">else</span> <span class="hljs-built_in">str</span>(exc)
        )
        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">500</span>, detail=<span class="hljs-string">f"数据库错误: <span class="hljs-subst">{detail}</span>"</span>) <span class="hljs-keyword">from</span> exc
​
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> rows:
        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">404</span>, detail=<span class="hljs-string">"未找到该 id 对应的商品信息"</span>)
​
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"id"</span>: <span class="hljs-built_in">id</span>, <span class="hljs-string">"results"</span>: rows}
​
​
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-keyword">import</span> uvicorn
​
    uvicorn.run(<span class="hljs-string">"main:app"</span>, host=<span class="hljs-string">"0.0.0.0"</span>, port=<span class="hljs-number">8000</span>, reload=<span class="hljs-literal">True</span>)
</code></pre>
<p>然后运行<code>python main.py</code>，<code>http://localhost:8000/get_product?id=22</code>是可以看到数据返回的。</p>
<p>说明我们的代码是没问题的，接下来就开始部署，然后再服务器上做压测，看下当前的服务器的最大QPS是多大。</p>
<p>部署方案和前面介绍的一致，记得更改<code>nginx</code>配置和<code>pm2</code>的配置文件，通过公网访问下我们的接口</p>
<pre><code class="hljs language-bash" lang="bash">https://api.jinxudong.com/fastapi/queryDetail/get_product?<span class="hljs-built_in">id</span>=122
可以看到如下输出：
{
  <span class="hljs-string">"id"</span>: 122,
  <span class="hljs-string">"results"</span>: [
    {
      <span class="hljs-string">"id"</span>: 122,
      <span class="hljs-string">"name"</span>: <span class="hljs-string">"商品-172"</span>,
      <span class="hljs-string">"price"</span>: 461.79,
      <span class="hljs-string">"stock"</span>: 72,
      <span class="hljs-string">"description"</span>: <span class="hljs-string">"这是商品 172 的描述"</span>,
      <span class="hljs-string">"updated_at"</span>: <span class="hljs-string">"2026-02-10T04:13:17"</span>
    }
  ]
}
</code></pre>
<p>说明接口已经部署成功了，下面就开始压测，要知道这个接口的最大QPS，接下来使用ab来开始压测</p>
<h6 data-id="heading-6">第一次压测</h6>
<p>首先使用20的并发，看下压测报告：</p>
<pre><code class="hljs language-matlab" lang="matlab">ab -n <span class="hljs-number">1000</span> -c <span class="hljs-number">20</span> https://api.jinxudong.com/fastapi/queryDetail/get_product?id=<span class="hljs-number">122</span>
​
压测报告截取：
Requests per second:    <span class="hljs-number">54.99</span> [#/<span class="hljs-built_in">sec</span>] (<span class="hljs-built_in">mean</span>)  
Time per request:       <span class="hljs-number">363.704</span> [ms] (<span class="hljs-built_in">mean</span>)  
<span class="hljs-number">50</span><span class="hljs-comment">%    307ms</span>
<span class="hljs-number">75</span><span class="hljs-comment">%    417ms</span>
<span class="hljs-number">90</span><span class="hljs-comment">%    512ms</span>
<span class="hljs-number">99</span><span class="hljs-comment">%   1282ms</span>
</code></pre>
<p>可以看到QPS54，平均时间363ms，延迟分布中50%的请求小于307ms</p>
<h6 data-id="heading-7">第二次压测</h6>
<p>使用40的并发，看下压测报告：</p>
<pre><code class="hljs language-matlab" lang="matlab">ab -n <span class="hljs-number">1000</span> -c <span class="hljs-number">40</span> https://api.jinxudong.com/fastapi/queryDetail/get_product?id=<span class="hljs-number">122</span>
 
压测报告截取：
Requests per second:    <span class="hljs-number">53.87</span> [#/<span class="hljs-built_in">sec</span>] (<span class="hljs-built_in">mean</span>)
Time per request:       <span class="hljs-number">742.486</span> [ms] (<span class="hljs-built_in">mean</span>)
  <span class="hljs-number">50</span><span class="hljs-comment">%    712</span>
  <span class="hljs-number">66</span><span class="hljs-comment">%    769</span>
  <span class="hljs-number">75</span><span class="hljs-comment">%    826</span>
  <span class="hljs-number">80</span><span class="hljs-comment">%    850</span>
  <span class="hljs-number">90</span><span class="hljs-comment">%    926</span>
</code></pre>
<p>QPS53，延迟时间和平均请求时间都在增大，有一种步子迈大了的感觉，减少并发试试</p>
<h6 data-id="heading-8">第三次压测</h6>
<p>使用10的并发，看下压测报告</p>
<pre><code class="hljs language-matlab" lang="matlab"> ab -n <span class="hljs-number">1000</span> -c <span class="hljs-number">10</span> https://api.jinxudong.com/fastapi/queryDetail/get_product?id=<span class="hljs-number">122</span>
 
 压测报告截取：
 Requests per second:    <span class="hljs-number">55.53</span> [#/<span class="hljs-built_in">sec</span>] (<span class="hljs-built_in">mean</span>)
Time per request:       <span class="hljs-number">180.081</span> [ms] (<span class="hljs-built_in">mean</span>)
  <span class="hljs-number">50</span><span class="hljs-comment">%    135</span>
  <span class="hljs-number">66</span><span class="hljs-comment">%    154</span>
  <span class="hljs-number">75</span><span class="hljs-comment">%    173</span>
  <span class="hljs-number">80</span><span class="hljs-comment">%    181</span>
  <span class="hljs-number">90</span><span class="hljs-comment">%    332</span>
</code></pre>
<p>QPS55，平均时间和延迟时间都降低了，但是QPS确实没怎么变化，可以断定当前系统的最大吞吐量就是55，下面增加一个缓存层，然后看下系统的吞吐量是否发生变化</p>
<h5 data-id="heading-9">存增加缓存层</h5>
<p>首先回顾下旁路缓存，当查询时首先去缓存中查找，如果缓存命中就直接返回；如果未命中就去查询数据库，然后将值写到缓存中，如果数据库也没有，就写一个空值到缓存中，防止穿透。这就是下面要写的代码的逻辑。</p>
<p>直接看下接口代码</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/get_product"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_product</span>(<span class="hljs-params"><span class="hljs-built_in">id</span>: <span class="hljs-built_in">int</span> = Query(<span class="hljs-params">..., description=<span class="hljs-string">"商品编号"</span></span>)</span>):
    <span class="hljs-string">"""根据商品 id 查询商品信息。"""</span>
​
    cache_key = _make_product_cache_key(<span class="hljs-built_in">id</span>)
​
    <span class="hljs-comment"># 1. 先查 Redis 缓存</span>
    <span class="hljs-keyword">try</span>:
        cached = redis_client.get(cache_key)
        <span class="hljs-keyword">if</span> cached <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            rows = json.loads(cached)
            <span class="hljs-comment"># 缓存命中空列表，说明数据库也没有，直接返回 404，防止缓存穿透</span>
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> rows:
                <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">404</span>, detail=<span class="hljs-string">"未找到该 id 对应的商品信息"</span>)
            <span class="hljs-keyword">return</span> {<span class="hljs-string">"id"</span>: <span class="hljs-built_in">id</span>, <span class="hljs-string">"results"</span>: rows}
    <span class="hljs-keyword">except</span> redis.RedisError:
        <span class="hljs-comment"># 缓存异常时，降级为直接查数据库</span>
        <span class="hljs-keyword">pass</span>
​
    <span class="hljs-keyword">try</span>:
        conn = get_connection()
        <span class="hljs-keyword">with</span> conn:
            <span class="hljs-keyword">with</span> conn.cursor() <span class="hljs-keyword">as</span> cursor:
                sql = (
                    <span class="hljs-string">"SELECT * "</span>
                    <span class="hljs-string">"FROM products "</span>
                    <span class="hljs-string">"WHERE id = %s"</span>
                )
                cursor.execute(sql, (<span class="hljs-built_in">id</span>,))
                rows = cursor.fetchall()
    <span class="hljs-keyword">except</span> pymysql.MySQLError <span class="hljs-keyword">as</span> exc:  <span class="hljs-comment"># 数据库连接或执行出错</span>
        detail = (
            exc.args[<span class="hljs-number">1</span>]
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(exc.args) &gt; <span class="hljs-number">1</span>
            <span class="hljs-keyword">else</span> <span class="hljs-built_in">str</span>(exc)
        )
        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">500</span>, detail=<span class="hljs-string">f"数据库错误: <span class="hljs-subst">{detail}</span>"</span>) <span class="hljs-keyword">from</span> exc
​
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> rows:
        <span class="hljs-comment"># 数据库未命中，也写入空列表到缓存，防止穿透</span>
        <span class="hljs-keyword">try</span>:
            redis_client.setex(cache_key, <span class="hljs-number">60</span>, json.dumps([]))
        <span class="hljs-keyword">except</span> redis.RedisError:
            <span class="hljs-keyword">pass</span>
        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">404</span>, detail=<span class="hljs-string">"未找到该 id 对应的商品信息"</span>)
​
    <span class="hljs-comment"># 查询到数据后写入缓存</span>
    <span class="hljs-keyword">try</span>:
        encoded_rows = jsonable_encoder(rows)
        redis_client.setex(cache_key, <span class="hljs-number">300</span>, json.dumps(encoded_rows, ensure_ascii=<span class="hljs-literal">False</span>))
    <span class="hljs-keyword">except</span> (redis.RedisError, TypeError, ValueError):
        <span class="hljs-comment"># 缓存写入失败不影响接口主流程</span>
        <span class="hljs-keyword">pass</span>
​
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"id"</span>: <span class="hljs-built_in">id</span>, <span class="hljs-string">"results"</span>: rows}
​
</code></pre>
<p>首先在接口请求时，一开始就构建了缓存的key，<code>_make_product_cache_key</code>的方法是这样的</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_make_product_cache_key</span>(<span class="hljs-params">product_id: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""生成商品缓存 key。"""</span>
​
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"product:<span class="hljs-subst">{product_id}</span>"</span>
</code></pre>
<p>构建的key就是<code>product:{product_id}</code>，然后就先查询缓存，如果缓存命中就直接返回，未命中就查库；命中时也有个非空判断，如果是写入的空数组，表明是数据库也没有的，直接返回404，防止穿透。查询数据库就是和前面一样的逻辑了，加了个写入缓存的逻辑：<code>redis_client.setex(cache_key, 300, json.dumps(encoded_rows, ensure_ascii=False))</code>。当数据库也没有时，就写个空，防止穿透：<code>redis_client.setex(cache_key, 60, json.dumps([]))</code>，然后返回错误。</p>
<p>部署到线上后，<code>https://api.jinxudong.com/fastapi/queryDetail/get_product?id=5</code>接口有正常的返回，看下<code>redis</code>数据库，也有相关的<code>product:5</code>作为key，表明我们的更改是成功的。</p>
<p>要想证明我们的更改效果，就需要做压测了，</p>
<h6 data-id="heading-10">第一次压测</h6>
<p>直接使用40的并发</p>
<pre><code class="hljs language-bash" lang="bash">ab -n 1000 -c 40 https://api.jinxudong.com/fastapi/queryDetail/get_product?<span class="hljs-built_in">id</span>=122
​
Requests per second: 73.80 [<span class="hljs-comment">#/sec] (mean) </span>
Time per request: 542.007 [ms] (mean)
</code></pre>
<p>我以为这个QPS会变得非常大，才是73，而没加<code>redis</code>是53，我查看了<code>redis</code>数据库，缓存是存在的，虽然说QPS增加了，但是并不是很明显，看来影响系统的吞吐量的并不只是查询数据库，还有TCP连接，因为这个接口多了一层nginx转发，</p>
<h6 data-id="heading-11">第二次压测</h6>
<p>这次不走nginx转发了，直接走系统的服务</p>
<pre><code class="hljs language-ini" lang="ini">ab -n 1000 -c 40 http://127.0.0.1:8012/get_product?<span class="hljs-attr">id</span>=<span class="hljs-number">122</span>
​
Requests per second:    365.20 <span class="hljs-section">[#/sec]</span> (mean)
Time per request:       109.528 <span class="hljs-section">[ms]</span> (mean)
</code></pre>
<p>QPS一下子就起来了，而且平均响应时间也降低了。</p>
<p>两次测试结果有点出乎意料，都说<code>redis</code>毫秒级别的响应，但是QPS并没有指数级别的上升，看来对于小型应用，提升QPS来说，<code>redis</code>的作用其实并没有那么大，我的服务器宽带只有2M，费这么大劲，还不如去增加点带宽效果来的明显。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AIDL/HIDL与HAL层通信实战:从接口定义到服务实现]]></title>    <link>https://juejin.cn/post/7604769326225342500</link>    <guid>https://juejin.cn/post/7604769326225342500</guid>    <pubDate>2026-02-10T11:53:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604769326225342500" data-draft-id="7605051978871832595" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AIDL/HIDL与HAL层通信实战:从接口定义到服务实现"/> <meta itemprop="keywords" content="Android,源码阅读,性能优化"/> <meta itemprop="datePublished" content="2026-02-10T11:53:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="冬奇Lab"/> <meta itemprop="url" content="https://juejin.cn/user/1857501105781193"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AIDL/HIDL与HAL层通信实战:从接口定义到服务实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1857501105781193/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    冬奇Lab
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T11:53:23.000Z" title="Tue Feb 10 2026 11:53:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<p>在前两篇文章中,我们深入分析了Binder驱动机制和ServiceManager服务注册。但在真实的Android系统开发中,很少有人直接操作Binder驱动——大家使用的都是更高层的抽象:AIDL(Android Interface Definition Language)和HIDL(HAL Interface Definition Language)。</p>
<p>想象一下这个场景:Framework层的BatteryService想要获取电池电量,它需要和HAL层的Health服务通信。怎么做?</p>
<pre><code class="hljs language-scss" lang="scss">Framework (Java)  ←→  Native Service (C++)  ←→  HAL Service (C++)  ←→  硬件
    ↓                      ↓                         ↓
 AIDL接口             AIDL/HIDL桥接           AIDL HAL接口
</code></pre>
<p>这就是本文要解决的问题:<strong>如何通过AIDL/HIDL定义接口,并实现跨进程的HAL层通信?</strong></p>
<blockquote>
<p>📖 <strong>系列前置阅读</strong>:建议先阅读第9篇(Binder驱动)和第10篇(ServiceManager),理解Binder IPC的底层机制。</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">AIDL与HIDL:两代接口定义语言</h2>
<h3 data-id="heading-2">为什么需要接口定义语言?</h3>
<p>直接操作Binder需要手工编写大量模板代码:</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 手工Binder代码示例(已简化)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BpMyService</span> : <span class="hljs-keyword">public</span> BpInterface&lt;IMyService&gt; {
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">int</span> <span class="hljs-title">getValue</span><span class="hljs-params">()</span> </span>{
        Parcel data, reply;
        data.<span class="hljs-built_in">writeInterfaceToken</span>(IMyService::<span class="hljs-built_in">getInterfaceDescriptor</span>());
        <span class="hljs-built_in">remote</span>()-&gt;<span class="hljs-built_in">transact</span>(TRANSACTION_getValue, data, &amp;reply);
        <span class="hljs-keyword">return</span> reply.<span class="hljs-built_in">readInt32</span>();
    }
};
</code></pre>
<p>这种方式<strong>容易出错、维护困难、版本管理混乱</strong>。</p>
<p>AIDL和HIDL的诞生就是为了<strong>自动生成这些模板代码</strong>,让开发者专注于业务逻辑。</p>
<h3 data-id="heading-3">AIDL vs HIDL:历史演进</h3>















































<table><thead><tr><th align="left">特性</th><th align="left">AIDL (传统)</th><th align="left">HIDL</th><th align="left">AIDL (Stable/现代)</th></tr></thead><tbody><tr><td align="left"><strong>引入版本</strong></td><td align="left">Android 1.0</td><td align="left">Android 8.0</td><td align="left">Android 11</td></tr><tr><td align="left"><strong>主要用途</strong></td><td align="left">Framework内部</td><td align="left">Framework-HAL</td><td align="left">Framework-HAL</td></tr><tr><td align="left"><strong>语言支持</strong></td><td align="left">Java + C++</td><td align="left">C++</td><td align="left">Java + C++ + Rust</td></tr><tr><td align="left"><strong>版本管理</strong></td><td align="left">❌ 无</td><td align="left">✅ 强制语义化版本</td><td align="left">✅ Stable接口</td></tr><tr><td align="left"><strong>向后兼容</strong></td><td align="left">❌ 不保证</td><td align="left">✅ 保证</td><td align="left">✅ 保证</td></tr><tr><td align="left"><strong>当前状态</strong></td><td align="left">维护中</td><td align="left">❌ 不推荐新项目</td><td align="left">✅ <strong>推荐</strong></td></tr></tbody></table>
<p><strong>Android 15的策略</strong>:</p>
<ul>
<li><strong>新HAL服务</strong>:使用Stable AIDL</li>
<li><strong>遗留HAL</strong>:HIDL继续支持,但不再新增</li>
<li><strong>Framework内部</strong>:传统AIDL和Stable AIDL混用</li>
</ul>
<blockquote>
<p>🎯 <strong>关键洞察</strong>:Google在Android 11后推动"HIDL退役,AIDL统一天下"的策略。Stable AIDL结合了AIDL的灵活性和HIDL的版本管理优势。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f524bd5976c74420af783c85732aa93d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771329341&amp;x-signature=JujObMQLBlh97Sdks9Qt%2BxBSQQI%3D" alt="11-01-aidl-hidl-hal-architecture.png" loading="lazy"/></p>
<p><em>图:从Framework Java层到内核驱动的完整调用链,通过AIDL接口实现跨进程HAL通信</em></p>
<hr/>
<h2 data-id="heading-4">AIDL基础:从语法到生成代码</h2>
<h3 data-id="heading-5">AIDL文件结构</h3>
<p>一个典型的AIDL接口定义:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// IHealth.aidl (简化版)</span>
<span class="hljs-keyword">package</span> android.hardware.health;

<span class="hljs-keyword">import</span> android.hardware.health.HealthInfo;
<span class="hljs-keyword">import</span> android.hardware.health.IHealthInfoCallback;

<span class="hljs-meta">@VintfStability</span>  <span class="hljs-comment">// ← Android 15: VINTF声明标记</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IHealth</span> {
    <span class="hljs-comment">// 常量定义</span>
    const <span class="hljs-type">int</span> <span class="hljs-variable">STATUS_UNKNOWN</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
    const <span class="hljs-type">int</span> <span class="hljs-variable">STATUS_CALLBACK_DIED</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;

    <span class="hljs-comment">// 方法声明</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerCallback</span><span class="hljs-params">(in IHealthInfoCallback callback)</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">unregisterCallback</span><span class="hljs-params">(in IHealthInfoCallback callback)</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">()</span>;

    <span class="hljs-comment">// 返回值可以是基本类型或Parcelable</span>
    <span class="hljs-type">int</span> <span class="hljs-title function_">getChargeCounterUah</span><span class="hljs-params">()</span>;
    <span class="hljs-type">int</span> <span class="hljs-title function_">getCurrentNowMicroamps</span><span class="hljs-params">()</span>;
    HealthInfo <span class="hljs-title function_">getHealthInfo</span><span class="hljs-params">()</span>;
}
</code></pre>
<p><strong>语法要点</strong>:</p>
<ol>
<li><strong>包名</strong>:<code>package</code>声明命名空间</li>
<li><strong>导入</strong>:<code>import</code>其他AIDL类型</li>
<li><strong>注解</strong>:<code>@VintfStability</code>表示接口稳定性(Android 15强制要求)</li>
<li><strong>方向标记</strong>:<code>in</code>(输入)/<code>out</code>(输出)/<code>inout</code>(双向)</li>
<li><strong>支持类型</strong>:基本类型、String、List、Map、Parcelable、其他AIDL接口</li>
</ol>
<h3 data-id="heading-6">AIDL编译流程</h3>
<pre><code class="hljs language-scss" lang="scss">IHealth<span class="hljs-selector-class">.aidl</span>  →  <span class="hljs-selector-attr">[AIDL Compiler]</span>  →  生成代码
                                     ├── IHealth<span class="hljs-selector-class">.h</span>/cpp (C++ Native Backend)
                                     ├── IHealth<span class="hljs-selector-class">.java</span> (Java Backend)
                                     └── IHealth<span class="hljs-selector-class">.rs</span> (Rust Backend)
</code></pre>
<p><strong>生成的C++代码</strong>(Android 15,简化版):</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 自动生成的 IHealth.h (片段)</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;android/binder_ibinder.h&gt;</span></span>

<span class="hljs-keyword">namespace</span> aidl::android::hardware::health {

<span class="hljs-keyword">class</span> <span class="hljs-title class_">IHealth</span> : <span class="hljs-keyword">public</span> ::ndk::ICInterface {
<span class="hljs-keyword">public</span>:
    <span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span>* descriptor;  <span class="hljs-comment">// "android.hardware.health.IHealth"</span>

    <span class="hljs-comment">// 纯虚函数,由实现类覆盖</span>
    <span class="hljs-keyword">virtual</span> ::<span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">registerCallback</span><span class="hljs-params">(
        <span class="hljs-type">const</span> std::shared_ptr&lt;IHealthInfoCallback&gt;&amp; in_callback)</span> </span>= <span class="hljs-number">0</span>;

    <span class="hljs-keyword">virtual</span> ::<span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">getChargeCounterUah</span><span class="hljs-params">(<span class="hljs-type">int32_t</span>* _aidl_return)</span> </span>= <span class="hljs-number">0</span>;

    <span class="hljs-comment">// Binder通信相关</span>
    <span class="hljs-function"><span class="hljs-type">static</span> std::shared_ptr&lt;IHealth&gt; <span class="hljs-title">fromBinder</span><span class="hljs-params">(<span class="hljs-type">const</span> ::ndk::SpAIBinder&amp; binder)</span></span>;
};

<span class="hljs-comment">// Bn = Binder Native (服务端基类)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BnHealth</span> : <span class="hljs-keyword">public</span> ::ndk::BnCInterface&lt;IHealth&gt; {
<span class="hljs-keyword">public</span>:
    ::<span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">getInterfaceVersion</span><span class="hljs-params">(<span class="hljs-type">int32_t</span>* _aidl_return)</span> <span class="hljs-keyword">final</span></span>;
<span class="hljs-keyword">protected</span>:
    ::<span class="hljs-function">ndk::SpAIBinder <span class="hljs-title">createBinder</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;
};

<span class="hljs-comment">// Bp = Binder Proxy (客户端代理)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BpHealth</span> : <span class="hljs-keyword">public</span> ::ndk::BpCInterface&lt;IHealth&gt; {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">BpHealth</span><span class="hljs-params">(<span class="hljs-type">const</span> ::ndk::SpAIBinder&amp; binder)</span></span>;

    <span class="hljs-comment">// 实现所有虚函数,内部调用transact()</span>
    ::<span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">registerCallback</span><span class="hljs-params">(
        <span class="hljs-type">const</span> std::shared_ptr&lt;IHealthInfoCallback&gt;&amp; in_callback)</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-comment">// 序列化参数 → transact() → 反序列化返回值</span>
        <span class="hljs-comment">// ...</span>
    }
};

}  <span class="hljs-comment">// namespace aidl::android::hardware::health</span>
</code></pre>
<p><strong>关键类的职责</strong>:</p>
<ul>
<li><strong><code>IHealth</code></strong>(接口类):定义API契约</li>
<li><strong><code>BnHealth</code></strong>(Binder Native):服务端基类,处理transact()</li>
<li><strong><code>BpHealth</code></strong>(Binder Proxy):客户端代理,封装IPC细节</li>
</ul>
<hr/>
<h2 data-id="heading-7">Stable AIDL:版本管理的救星</h2>
<h3 data-id="heading-8">传统AIDL的痛点</h3>
<p>在Android 10之前,AIDL接口变更是噩梦:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Version 1</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IFoo</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodA</span><span class="hljs-params">()</span>;
}

<span class="hljs-comment">// Version 2 (破坏性变更!)</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IFoo</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodA</span><span class="hljs-params">()</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodB</span><span class="hljs-params">()</span>;  <span class="hljs-comment">// ← 新增方法,老版本无法识别!</span>
}
</code></pre>
<p><strong>问题</strong>:</p>
<ul>
<li>无法在新旧版本间兼容</li>
<li>HAL升级强制要求Framework同步升级</li>
<li>OTA更新可能导致系统崩溃</li>
</ul>
<h3 data-id="heading-9">Stable AIDL的解决方案</h3>
<p><strong>核心机制</strong>:冻结旧版本接口 + 通过新方法扩展。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Stable AIDL的目录结构</span>
hardware/interfaces/health/aidl/
├── android/hardware/health/
│   ├── IHealth.aidl              <span class="hljs-comment"># 当前开发版本</span>
│   ├── HealthInfo.aidl
│   └── ...
└── aidl_api/android.hardware.health/
    ├── 1/                         <span class="hljs-comment"># 冻结的版本1</span>
    │   └── android/hardware/health/IHealth.aidl
    ├── 2/                         <span class="hljs-comment"># 冻结的版本2</span>
    │   └── android/hardware/health/IHealth.aidl
    └── current/                   <span class="hljs-comment"># 当前版本符号链接</span>
</code></pre>
<p><strong>版本演进示例</strong>(Android 15 Health HAL):</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Version 1 (冻结,不可修改)</span>
<span class="hljs-keyword">package</span> android.hardware.health;
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IHealth</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerCallback</span><span class="hljs-params">(in IHealthInfoCallback callback)</span>;
    <span class="hljs-type">int</span> <span class="hljs-title function_">getCapacity</span><span class="hljs-params">()</span>;
}

<span class="hljs-comment">// Version 2 (冻结,不可修改)</span>
<span class="hljs-keyword">package</span> android.hardware.health;
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IHealth</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerCallback</span><span class="hljs-params">(in IHealthInfoCallback callback)</span>;
    <span class="hljs-type">int</span> <span class="hljs-title function_">getCapacity</span><span class="hljs-params">()</span>;
    <span class="hljs-comment">// 新增方法(向后兼容!)</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setChargingPolicy</span><span class="hljs-params">(BatteryChargingPolicy in_value)</span>;
    BatteryChargingPolicy <span class="hljs-title function_">getChargingPolicy</span><span class="hljs-params">()</span>;
}

<span class="hljs-comment">// Current (开发中)</span>
<span class="hljs-keyword">package</span> android.hardware.health;
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IHealth</span> {
    <span class="hljs-comment">// ... 继承所有旧方法</span>
    <span class="hljs-comment">// 新增Android 15特性</span>
    BatteryHealthData <span class="hljs-title function_">getBatteryHealthData</span><span class="hljs-params">()</span>;
}
</code></pre>
<p><strong>版本检查代码</strong>(客户端):</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 客户端检查HAL服务版本</span>
std::shared_ptr&lt;IHealth&gt; health = IHealth::<span class="hljs-built_in">fromBinder</span>(binder);

<span class="hljs-type">int32_t</span> version = <span class="hljs-number">0</span>;
health-&gt;<span class="hljs-built_in">getInterfaceVersion</span>(&amp;version);

<span class="hljs-keyword">if</span> (version &gt;= <span class="hljs-number">2</span>) {
    <span class="hljs-comment">// 使用Version 2的特性</span>
    BatteryChargingPolicy policy;
    health-&gt;<span class="hljs-built_in">getChargingPolicy</span>(&amp;policy);
} <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 降级处理</span>
    <span class="hljs-built_in">LOG</span>(WARNING) &lt;&lt; <span class="hljs-string">"Health HAL version "</span> &lt;&lt; version &lt;&lt; <span class="hljs-string">" does not support charging policy"</span>;
}
</code></pre>
<blockquote>
<p>✅ <strong>Stable AIDL的优势</strong>:</p>
<ol>
<li><strong>向后兼容</strong>:新Framework可以使用老HAL</li>
<li><strong>向前兼容</strong>:老Framework不会因新HAL崩溃(忽略未知方法)</li>
<li><strong>独立升级</strong>:HAL和Framework可以各自OTA</li>
</ol>
</blockquote>
<hr/>
<h2 data-id="heading-10">HIDL简介:HAL的前辈</h2>
<p>虽然HIDL正在被Stable AIDL取代,但Android 15中仍有大量遗留HAL使用HIDL。</p>
<h3 data-id="heading-11">HIDL语法特点</h3>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// IUsb.hal (HIDL 1.0)</span>
package android.hardware.usb@<span class="hljs-number">1.0</span>;

import IUsbCallback;

interface IUsb {
    <span class="hljs-comment">/**
     * oneway = 异步调用,不等待返回
     */</span>
    oneway <span class="hljs-title function_">switchRole</span><span class="hljs-params">(<span class="hljs-built_in">string</span> portName, PortRole role)</span>;

    oneway <span class="hljs-title function_">setCallback</span><span class="hljs-params">(IUsbCallback callback)</span>;

    oneway <span class="hljs-title function_">queryPortStatus</span><span class="hljs-params">()</span>;
};
</code></pre>
<p><strong>HIDL vs AIDL对比</strong>:</p>






























<table><thead><tr><th align="left">特性</th><th align="left">HIDL</th><th align="left">AIDL</th></tr></thead><tbody><tr><td align="left"><strong>文件后缀</strong></td><td align="left"><code>.hal</code></td><td align="left"><code>.aidl</code></td></tr><tr><td align="left"><strong>版本标记</strong></td><td align="left"><code>@1.0</code> (包名中)</td><td align="left"><code>aidl_api/版本号/</code> (目录)</td></tr><tr><td align="left"><strong>异步语法</strong></td><td align="left"><code>oneway</code> 关键字</td><td align="left"><code>oneway</code> 关键字</td></tr><tr><td align="left"><strong>数据传输</strong></td><td align="left">hidl_vec/hidl_string</td><td align="left">std::vector/std::string</td></tr></tbody></table>
<h3 data-id="heading-12">HIDL遗留问题</h3>
<ol>
<li><strong>复杂的版本号管理</strong>:<code>@1.0</code> → <code>@1.1</code> → <code>@2.0</code> 需要手动维护</li>
<li><strong>工具链老旧</strong>:<code>hidl-gen</code>已停止维护</li>
<li><strong>无Rust支持</strong>:限制了现代化改造</li>
</ol>
<hr/>
<h2 data-id="heading-13">HAL服务实现:以Health HAL为例</h2>
<h3 data-id="heading-14">Health HAL架构</h3>
<pre><code class="hljs language-java" lang="java">┌─────────────────────────────────────────────────────────┐
│             Framework (Java)                            │
│  frameworks/base/services/core/java/...BatteryService   │
└─────────────┬───────────────────────────────────────────┘
              │ JNI
              ↓
┌─────────────────────────────────────────────────────────┐
│         Native <span class="hljs-title function_">Service</span> <span class="hljs-params">(C++)</span>                            │
│  frameworks/<span class="hljs-keyword">native</span>/services/batteryservice              │
└─────────────┬───────────────────────────────────────────┘
              │ Binder <span class="hljs-title function_">IPC</span> <span class="hljs-params">(AIDL)</span>
              ↓
┌─────────────────────────────────────────────────────────┐
│           HAL <span class="hljs-title function_">Service</span> <span class="hljs-params">(C++)</span>                             │
│  hardware/interfaces/health/aidl/<span class="hljs-keyword">default</span>/Health.cpp     │
│                                                          │
│  ┌────────────────────────────────────────────┐         │
│  │  <span class="hljs-keyword">class</span> <span class="hljs-title class_">Health</span> : <span class="hljs-keyword">public</span> BnHealth {          │         │
│  │    BatteryMonitor battery_monitor_;        │         │
│  │    ndk::ScopedAStatus <span class="hljs-title function_">getCapacity</span><span class="hljs-params">(...)</span> {   │         │
│  │      <span class="hljs-comment">// 读取 /sys/class/power_supply/...  │         │</span>
│  │    }                                        │         │
│  │  }                                          │         │
│  └────────────────────────────────────────────┘         │
└─────────────┬───────────────────────────────────────────┘
              │ sysfs
              ↓
┌─────────────────────────────────────────────────────────┐
│              Kernel Driver                              │
│  drivers/power/supply/xxx_battery.c                     │
└─────────────────────────────────────────────────────────┘
</code></pre>
<h3 data-id="heading-15">服务端实现(Android 15源码分析)</h3>
<p><strong>Health.cpp</strong>(截取核心逻辑):</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// hardware/interfaces/health/aidl/default/Health.cpp (Android 15)</span>
<span class="hljs-keyword">namespace</span> aidl::android::hardware::health {

<span class="hljs-comment">// Health服务构造函数</span>
Health::<span class="hljs-built_in">Health</span>(std::string_view instance_name,
               std::unique_ptr&lt;<span class="hljs-keyword">struct</span> healthd_config&gt;&amp;&amp; config)
    : <span class="hljs-built_in">instance_name_</span>(instance_name),
      <span class="hljs-built_in">healthd_config_</span>(std::<span class="hljs-built_in">move</span>(config)),
      <span class="hljs-built_in">death_recipient_</span>(<span class="hljs-built_in">AIBinder_DeathRecipient_new</span>(&amp;OnCallbackDiedWrapped)) {

    <span class="hljs-comment">// 注册死亡通知回调(类似ServiceManager的linkToDeath)</span>
    <span class="hljs-built_in">AIBinder_DeathRecipient_setOnUnlinked</span>(death_recipient_.<span class="hljs-built_in">get</span>(), onCallbackUnlinked);

    <span class="hljs-comment">// 初始化电池监控器(底层读取sysfs)</span>
    battery_monitor_.<span class="hljs-built_in">init</span>(healthd_config_.<span class="hljs-built_in">get</span>());
}

<span class="hljs-comment">// ========== AIDL接口实现:获取电池电量 ==========</span>
<span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">Health::getCapacity</span><span class="hljs-params">(<span class="hljs-type">int32_t</span>* out)</span> </span>{
    <span class="hljs-comment">// 调用BatteryMonitor读取 /sys/class/power_supply/battery/capacity</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">GetProperty</span>&lt;<span class="hljs-type">int32_t</span>&gt;(&amp;battery_monitor_,
                                 ::android::BATTERY_PROP_CAPACITY,
                                 <span class="hljs-number">0</span>,  <span class="hljs-comment">// 默认值</span>
                                 out);
}

<span class="hljs-comment">// ========== AIDL接口实现:获取充电状态 ==========</span>
<span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">Health::getChargeStatus</span><span class="hljs-params">(BatteryStatus* out)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">GetProperty</span>(&amp;battery_monitor_,
                       ::android::BATTERY_PROP_BATTERY_STATUS,
                       BatteryStatus::UNKNOWN,
                       out);
}

<span class="hljs-comment">// ========== AIDL接口实现:设置充电策略 (Android 15新增) ==========</span>
<span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">Health::setChargingPolicy</span><span class="hljs-params">(BatteryChargingPolicy in_value)</span> </span>{
    ::android::<span class="hljs-type">status_t</span> err = battery_monitor_.<span class="hljs-built_in">setChargingPolicy</span>(<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(in_value));

    <span class="hljs-keyword">switch</span> (err) {
        <span class="hljs-keyword">case</span> ::android::OK:
            <span class="hljs-keyword">return</span> ndk::ScopedAStatus::<span class="hljs-built_in">ok</span>();
        <span class="hljs-keyword">case</span> ::android::NAME_NOT_FOUND:
            <span class="hljs-keyword">return</span> ndk::ScopedAStatus::<span class="hljs-built_in">fromExceptionCode</span>(EX_UNSUPPORTED_OPERATION);
        <span class="hljs-keyword">case</span> ::android::BAD_VALUE:
            <span class="hljs-keyword">return</span> ndk::ScopedAStatus::<span class="hljs-built_in">fromStatus</span>(::android::INVALID_OPERATION);
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">return</span> ndk::ScopedAStatus::<span class="hljs-built_in">fromServiceSpecificErrorWithMessage</span>(
                    IHealth::STATUS_UNKNOWN, ::android::<span class="hljs-built_in">statusToString</span>(err).<span class="hljs-built_in">c_str</span>());
    }
}

<span class="hljs-comment">// ========== 回调管理:注册健康信息监听器 ==========</span>
<span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">Health::registerCallback</span><span class="hljs-params">(
    <span class="hljs-type">const</span> std::shared_ptr&lt;IHealthInfoCallback&gt;&amp; callback)</span> </span>{

    <span class="hljs-keyword">if</span> (callback == <span class="hljs-literal">nullptr</span>) {
        <span class="hljs-keyword">return</span> ndk::ScopedAStatus::<span class="hljs-built_in">fromExceptionCode</span>(EX_NULL_POINTER);
    }

    {
        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(callbacks_lock_)</span></span>;
        callbacks_.<span class="hljs-built_in">push_back</span>(callback);

        <span class="hljs-comment">// 为callback注册死亡通知(防止客户端崩溃后内存泄漏)</span>
        <span class="hljs-keyword">auto</span> linked = std::<span class="hljs-built_in">make_unique</span>&lt;LinkedCallback&gt;(<span class="hljs-built_in">weak_from_this</span>(), callback);
        <span class="hljs-keyword">auto</span> binder = callback-&gt;<span class="hljs-built_in">asBinder</span>();
        <span class="hljs-keyword">auto</span> status = <span class="hljs-built_in">AIBinder_linkToDeath</span>(binder.<span class="hljs-built_in">get</span>(),
                                           death_recipient_.<span class="hljs-built_in">get</span>(),
                                           linked.<span class="hljs-built_in">get</span>());
        <span class="hljs-keyword">if</span> (status == STATUS_OK) {
            linked.<span class="hljs-built_in">release</span>();  <span class="hljs-comment">// 交给Binder管理生命周期</span>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-built_in">LOG</span>(WARNING) &lt;&lt; <span class="hljs-string">"Cannot link to death: "</span> &lt;&lt; status;
        }
    }

    <span class="hljs-keyword">return</span> ndk::ScopedAStatus::<span class="hljs-built_in">ok</span>();
}

<span class="hljs-comment">// ========== 主动通知所有回调 ==========</span>
<span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">Health::update</span><span class="hljs-params">()</span> </span>{
    battery_monitor_.<span class="hljs-built_in">updateValues</span>();
    HealthInfo health_info = battery_monitor_.<span class="hljs-built_in">getHealthInfo</span>();

    <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(callbacks_lock_)</span></span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; callback : callbacks_) {
        <span class="hljs-comment">// 异步通知(oneway),避免阻塞</span>
        <span class="hljs-keyword">auto</span> status = callback-&gt;<span class="hljs-built_in">healthInfoChanged</span>(health_info);
        <span class="hljs-keyword">if</span> (!status.<span class="hljs-built_in">isOk</span>()) {
            <span class="hljs-built_in">LOG</span>(WARNING) &lt;&lt; <span class="hljs-string">"Callback failed: "</span> &lt;&lt; status.<span class="hljs-built_in">getDescription</span>();
        }
    }

    <span class="hljs-keyword">return</span> ndk::ScopedAStatus::<span class="hljs-built_in">ok</span>();
}

}  <span class="hljs-comment">// namespace aidl::android::hardware::health</span>
</code></pre>
<p><strong>关键设计</strong>:</p>
<ol>
<li><strong>错误处理</strong>:统一转换<code>::android::status_t</code>到AIDL的<code>ScopedAStatus</code></li>
<li><strong>死亡通知</strong>:防止客户端崩溃导致服务端泄漏回调</li>
<li><strong>线程安全</strong>:使用<code>std::mutex</code>保护共享数据(<code>callbacks_</code>)</li>
<li><strong>异步通知</strong>:回调使用<code>oneway</code>,避免阻塞HAL服务</li>
</ol>
<h3 data-id="heading-16">服务注册与启动</h3>
<p><strong>main.cpp</strong>(Health HAL服务入口):</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// hardware/interfaces/health/aidl/default/main.cpp</span>
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// 创建Health服务实例</span>
    <span class="hljs-keyword">auto</span> config = std::<span class="hljs-built_in">make_unique</span>&lt;healthd_config&gt;();
    ::android::hardware::health::<span class="hljs-built_in">InitHealthdConfig</span>(config.<span class="hljs-built_in">get</span>());
    <span class="hljs-keyword">auto</span> health = ndk::SharedRefBase::<span class="hljs-built_in">make</span>&lt;Health&gt;(<span class="hljs-string">"default"</span>, std::<span class="hljs-built_in">move</span>(config));

    <span class="hljs-comment">// 注册到ServiceManager</span>
    <span class="hljs-type">const</span> std::string instance = std::<span class="hljs-built_in">string</span>(Health::descriptor) + <span class="hljs-string">"/default"</span>;
    <span class="hljs-keyword">auto</span> status = <span class="hljs-built_in">AServiceManager_addService</span>(health-&gt;<span class="hljs-built_in">asBinder</span>().<span class="hljs-built_in">get</span>(), instance.<span class="hljs-built_in">c_str</span>());
    <span class="hljs-keyword">if</span> (status != STATUS_OK) {
        <span class="hljs-built_in">LOG</span>(FATAL) &lt;&lt; <span class="hljs-string">"Failed to register Health HAL: "</span> &lt;&lt; status;
    }

    <span class="hljs-comment">// 启动Binder线程池</span>
    <span class="hljs-built_in">ABinderProcess_setThreadPoolMaxThreadCount</span>(<span class="hljs-number">0</span>);  <span class="hljs-comment">// 0 = 自动管理</span>
    <span class="hljs-built_in">ABinderProcess_startThreadPool</span>();
    <span class="hljs-built_in">ABinderProcess_joinThreadPool</span>();  <span class="hljs-comment">// 阻塞等待</span>

    <span class="hljs-keyword">return</span> EXIT_FAILURE;  <span class="hljs-comment">// 永不返回,除非异常</span>
}
</code></pre>
<p><strong>注册流程解析</strong>:</p>
<pre><code class="hljs language-scss" lang="scss">Health HAL服务启动
    ↓
<span class="hljs-number">1</span>. 创建Health实例 (new Health(...))
    ↓
<span class="hljs-number">2</span>. 生成服务名称 ("android.hardware.health.IHealth/default")
    ↓
<span class="hljs-number">3</span>. 调用 <span class="hljs-built_in">AServiceManager_addService</span>()
    ├→ 内部调用 Binder <span class="hljs-built_in">transact</span>(ADD_SERVICE)
    └→ ServiceManager记录到 mNameToService
    ↓
<span class="hljs-number">4</span>. 启动Binder线程池 (等待客户端调用)
    ↓
<span class="hljs-number">5</span>. <span class="hljs-built_in">joinThreadPool</span>() (阻塞主线程)
</code></pre>
<h3 data-id="heading-17">客户端调用</h3>
<p><strong>Native客户端代码</strong>:</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// frameworks/native/services/batteryservice/HealthHalCallbackHidl.cpp (简化)</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;android/hardware/health/IHealth.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;android/binder_manager.h&gt;</span></span>

<span class="hljs-keyword">using</span> aidl::android::hardware::health::IHealth;
<span class="hljs-keyword">using</span> aidl::android::hardware::health::HealthInfo;

<span class="hljs-comment">// 获取Health HAL服务</span>
<span class="hljs-function">std::shared_ptr&lt;IHealth&gt; <span class="hljs-title">getHealthService</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">const</span> std::string instance = std::<span class="hljs-built_in">string</span>(IHealth::descriptor) + <span class="hljs-string">"/default"</span>;

    <span class="hljs-comment">// 通过ServiceManager查询服务</span>
    <span class="hljs-function">ndk::SpAIBinder <span class="hljs-title">binder</span><span class="hljs-params">(AServiceManager_waitForService(instance.c_str()))</span></span>;
    <span class="hljs-keyword">if</span> (binder.<span class="hljs-built_in">get</span>() == <span class="hljs-literal">nullptr</span>) {
        <span class="hljs-built_in">LOG</span>(ERROR) &lt;&lt; <span class="hljs-string">"Failed to get Health HAL service"</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;
    }

    <span class="hljs-comment">// 将Binder转换为IHealth接口</span>
    <span class="hljs-keyword">return</span> IHealth::<span class="hljs-built_in">fromBinder</span>(binder);
}

<span class="hljs-comment">// 使用Health HAL获取电池信息</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">getBatteryInfo</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">auto</span> health = <span class="hljs-built_in">getHealthService</span>();
    <span class="hljs-keyword">if</span> (!health) <span class="hljs-keyword">return</span>;

    <span class="hljs-comment">// 调用AIDL接口</span>
    HealthInfo info;
    <span class="hljs-keyword">auto</span> status = health-&gt;<span class="hljs-built_in">getHealthInfo</span>(&amp;info);
    <span class="hljs-keyword">if</span> (!status.<span class="hljs-built_in">isOk</span>()) {
        <span class="hljs-built_in">LOG</span>(ERROR) &lt;&lt; <span class="hljs-string">"getHealthInfo failed: "</span> &lt;&lt; status.<span class="hljs-built_in">getDescription</span>();
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-built_in">LOG</span>(INFO) &lt;&lt; <span class="hljs-string">"Battery level: "</span> &lt;&lt; info.batteryLevel &lt;&lt; <span class="hljs-string">"%"</span>;
    <span class="hljs-built_in">LOG</span>(INFO) &lt;&lt; <span class="hljs-string">"Charging status: "</span> &lt;&lt; <span class="hljs-built_in">toString</span>(info.batteryStatus);
}
</code></pre>
<hr/>
<h2 data-id="heading-18">实战技巧:AIDL/HIDL开发最佳实践</h2>
<h3 data-id="heading-19">1. 选择AIDL还是HIDL?</h3>
<p><strong>决策树</strong>:</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">新项目?</span>
<span class="hljs-string">├─</span> <span class="hljs-literal">Yes</span> <span class="hljs-string">→</span> <span class="hljs-string">使用</span> <span class="hljs-string">Stable</span> <span class="hljs-string">AIDL</span>
<span class="hljs-string">└─</span> <span class="hljs-literal">No</span> <span class="hljs-string">→</span> <span class="hljs-string">已有HAL使用HIDL?</span>
       <span class="hljs-string">├─</span> <span class="hljs-literal">Yes</span> <span class="hljs-string">→</span> <span class="hljs-string">继续维护HIDL</span> <span class="hljs-string">(除非有重大重构)</span>
       <span class="hljs-string">└─</span> <span class="hljs-literal">No</span> <span class="hljs-string">→</span> <span class="hljs-string">迁移到</span> <span class="hljs-string">Stable</span> <span class="hljs-string">AIDL</span>
</code></pre>
<h3 data-id="heading-20">2. Stable AIDL版本升级流程</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 修改当前开发版本的AIDL文件</span>
vim hardware/interfaces/health/aidl/android/hardware/health/IHealth.aidl

<span class="hljs-comment"># 2. 冻结当前版本(假设从version 2升级到3)</span>
m android.hardware.health-freeze-api

<span class="hljs-comment"># 3. 自动生成 aidl_api/android.hardware.health/3/ 目录</span>

<span class="hljs-comment"># 4. 更新实现代码以支持新接口</span>

<span class="hljs-comment"># 5. 构建验证</span>
m android.hardware.health-impl
</code></pre>
<h3 data-id="heading-21">3. 错误处理规范</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// ❌ 错误示例:直接返回空指针</span>
<span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">getService</span><span class="hljs-params">(...)</span> </span>{
    <span class="hljs-keyword">if</span> (error) <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;  <span class="hljs-comment">// 编译错误!</span>
}

<span class="hljs-comment">// ✅ 正确示例:使用ScopedAStatus</span>
<span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">getService</span><span class="hljs-params">(...)</span> </span>{
    <span class="hljs-keyword">if</span> (not_found) {
        <span class="hljs-keyword">return</span> ndk::ScopedAStatus::<span class="hljs-built_in">fromExceptionCode</span>(EX_UNSUPPORTED_OPERATION);
    }
    <span class="hljs-keyword">if</span> (unknown_error) {
        <span class="hljs-keyword">return</span> ndk::ScopedAStatus::<span class="hljs-built_in">fromServiceSpecificError</span>(
            IHealth::STATUS_UNKNOWN, <span class="hljs-string">"Detailed error message"</span>);
    }
    <span class="hljs-keyword">return</span> ndk::ScopedAStatus::<span class="hljs-built_in">ok</span>();
}
</code></pre>
<h3 data-id="heading-22">4. 性能优化:减少Binder往返</h3>
<p><strong>❌ 低效写法</strong>(每次调用都跨进程):</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">int</span> level = health-&gt;<span class="hljs-built_in">getCapacity</span>();       <span class="hljs-comment">// Binder调用1</span>
<span class="hljs-type">int</span> current = health-&gt;<span class="hljs-built_in">getCurrentNow</span>();   <span class="hljs-comment">// Binder调用2</span>
<span class="hljs-type">int</span> voltage = health-&gt;<span class="hljs-built_in">getVoltage</span>();      <span class="hljs-comment">// Binder调用3</span>
</code></pre>
<p><strong>✅ 高效写法</strong>(一次调用获取所有数据):</p>
<pre><code class="hljs language-cpp" lang="cpp">HealthInfo info;
health-&gt;<span class="hljs-built_in">getHealthInfo</span>(&amp;info);  <span class="hljs-comment">// 单次Binder调用,包含所有数据</span>

<span class="hljs-type">int</span> level = info.batteryLevel;
<span class="hljs-type">int</span> current = info.batteryCurrentMicroamps;
<span class="hljs-type">int</span> voltage = info.batteryVoltage;
</code></pre>
<p><strong>性能对比</strong>:</p>
<ul>
<li>方案1:3次Binder transact,约 300-900μs</li>
<li>方案2:1次Binder transact,约 100-300μs</li>
<li><strong>提升</strong>: 60%-70%</li>
</ul>
<h3 data-id="heading-23">5. 死亡通知最佳实践</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCallback</span> : <span class="hljs-keyword">public</span> BnHealthInfoCallback {
<span class="hljs-keyword">private</span>:
    <span class="hljs-comment">// 使用weak_ptr避免循环引用</span>
    std::weak_ptr&lt;MyService&gt; service_;

<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">MyCallback</span><span class="hljs-params">(std::shared_ptr&lt;MyService&gt; service)</span>
        : service_(service) {</span>}

    <span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">healthInfoChanged</span><span class="hljs-params">(<span class="hljs-type">const</span> HealthInfo&amp; info)</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-comment">// 检查service是否还存活</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">auto</span> svc = service_.<span class="hljs-built_in">lock</span>()) {
            svc-&gt;<span class="hljs-built_in">onHealthInfoUpdate</span>(info);
        }
        <span class="hljs-keyword">return</span> ndk::ScopedAStatus::<span class="hljs-built_in">ok</span>();
    }

    <span class="hljs-comment">// 死亡通知回调</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">binderDied</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-built_in">LOG</span>(WARNING) &lt;&lt; <span class="hljs-string">"Health HAL服务崩溃,尝试重连..."</span>;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">auto</span> svc = service_.<span class="hljs-built_in">lock</span>()) {
            svc-&gt;<span class="hljs-built_in">reconnectHealthHAL</span>();
        }
    }
};
</code></pre>
<h3 data-id="heading-24">6. 调试技巧</h3>
<p><strong>查看已注册的AIDL服务</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 列出所有AIDL HAL服务</span>
adb shell dumpsys -l | grep android.hardware

<span class="hljs-comment"># 查看Health HAL服务详情</span>
adb shell dumpsys android.hardware.health.IHealth/default

<span class="hljs-comment"># 输出示例:</span>
<span class="hljs-comment"># Battery Health:</span>
<span class="hljs-comment">#   batteryLevel: 85</span>
<span class="hljs-comment">#   batteryStatus: CHARGING</span>
<span class="hljs-comment">#   batteryHealth: GOOD</span>
<span class="hljs-comment">#   batteryChargeCounter: 2850000 µAh</span>
</code></pre>
<p><strong>Binder通信追踪</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启用Binder日志</span>
adb shell setprop log.tag.binder VERBOSE

<span class="hljs-comment"># 实时查看AIDL调用</span>
adb logcat -s binder:V | grep <span class="hljs-string">"IHealth"</span>

<span class="hljs-comment"># 输出示例:</span>
<span class="hljs-comment"># binder: 1234:1234 BC_TRANSACTION thr 1234 -&gt; 5678 node 12345 handle 0x3 code 0x1 (IHealth::getCapacity)</span>
</code></pre>
<hr/>
<h2 data-id="heading-25">常见问题与解答</h2>
<h3 data-id="heading-26">Q1: Stable AIDL的版本号如何管理?</h3>
<p><strong>A</strong>: 版本号存储在<code>aidl_api/</code>目录下,每次<code>freeze-api</code>自动递增:</p>
<pre><code class="hljs language-bash" lang="bash">aidl_api/android.hardware.health/
├── 1/      <span class="hljs-comment"># 第一次freeze</span>
├── 2/      <span class="hljs-comment"># 第二次freeze</span>
├── 3/      <span class="hljs-comment"># 最新freeze</span>
└── current -&gt; 3/  <span class="hljs-comment"># 符号链接指向最新版本</span>
</code></pre>
<p>客户端代码可以通过<code>getInterfaceVersion()</code>查询服务版本:</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">int32_t</span> version = <span class="hljs-number">0</span>;
health-&gt;<span class="hljs-built_in">getInterfaceVersion</span>(&amp;version);
<span class="hljs-built_in">LOG</span>(INFO) &lt;&lt; <span class="hljs-string">"Health HAL version: "</span> &lt;&lt; version;
</code></pre>
<h3 data-id="heading-27">Q2: AIDL接口可以修改已冻结的版本吗?</h3>
<p><strong>A</strong>: <strong>绝对不行!</strong> 这会破坏向后兼容性。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ❌ 错误操作:修改冻结版本</span>
vim aidl_api/android.hardware.health/2/android/hardware/health/IHealth.aidl

<span class="hljs-comment"># ✅ 正确做法:修改当前开发版本,然后freeze</span>
vim android/hardware/health/IHealth.aidl
m android.hardware.health-freeze-api
</code></pre>
<h3 data-id="heading-28">Q3: HIDL如何调用AIDL服务(或反向)?</h3>
<p><strong>A</strong>: 需要编写适配层(Adapter):</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// HIDL → AIDL适配器示例</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">HidlToAidlAdapter</span> : <span class="hljs-keyword">public</span> IHidlInterface {
    std::shared_ptr&lt;IAidlInterface&gt; aidl_service_;

    <span class="hljs-function">Return&lt;<span class="hljs-type">void</span>&gt; <span class="hljs-title">hidlMethod</span><span class="hljs-params">(...)</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-comment">// 转换HIDL类型到AIDL类型</span>
        AidlType aidl_param = <span class="hljs-built_in">convertHidlToAidl</span>(hidl_param);

        <span class="hljs-comment">// 调用AIDL服务</span>
        <span class="hljs-keyword">auto</span> status = aidl_service_-&gt;<span class="hljs-built_in">aidlMethod</span>(aidl_param);

        <span class="hljs-comment">// 转换返回值</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">convertAidlToHidl</span>(status);
    }
};
</code></pre>
<p>Android 15的部分遗留HAL仍在使用此模式。</p>
<h3 data-id="heading-29">Q4: 如何处理HAL服务崩溃?</h3>
<p><strong>A</strong>: 使用死亡通知(DeathRecipient)自动重连:</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">HealthServiceManager</span> {
    std::shared_ptr&lt;IHealth&gt; health_;
    ndk::ScopedAIBinder_DeathRecipient death_recipient_;

    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">connectService</span><span class="hljs-params">()</span> </span>{
        health_ = <span class="hljs-built_in">getHealthService</span>();
        <span class="hljs-keyword">if</span> (!health_) {
            <span class="hljs-built_in">LOG</span>(ERROR) &lt;&lt; <span class="hljs-string">"Failed to get Health HAL"</span>;
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-comment">// 注册死亡通知</span>
        <span class="hljs-keyword">auto</span> binder = health_-&gt;<span class="hljs-built_in">asBinder</span>();
        <span class="hljs-built_in">AIBinder_linkToDeath</span>(binder.<span class="hljs-built_in">get</span>(), death_recipient_.<span class="hljs-built_in">get</span>(), <span class="hljs-keyword">this</span>);
    }

    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">onServiceDied</span><span class="hljs-params">(<span class="hljs-type">void</span>* cookie)</span> </span>{
        <span class="hljs-keyword">auto</span>* manager = <span class="hljs-built_in">static_cast</span>&lt;HealthServiceManager*&gt;(cookie);
        <span class="hljs-built_in">LOG</span>(WARNING) &lt;&lt; <span class="hljs-string">"Health HAL died, reconnecting..."</span>;

        <span class="hljs-comment">// 等待100ms后重连</span>
        std::this_thread::<span class="hljs-built_in">sleep_for</span>(std::chrono::<span class="hljs-built_in">milliseconds</span>(<span class="hljs-number">100</span>));
        manager-&gt;<span class="hljs-built_in">connectService</span>();
    }
};
</code></pre>
<h3 data-id="heading-30">Q5: AIDL的性能与直接Binder调用相比如何?</h3>
<p><strong>A</strong>: 性能差异在5%以内(主要是代码生成的轻微开销):</p>

























<table><thead><tr><th align="left">方式</th><th align="center">延迟(中位数)</th><th align="center">吞吐量</th></tr></thead><tbody><tr><td align="left">直接Binder</td><td align="center">100μs</td><td align="center">10k ops/s</td></tr><tr><td align="left">AIDL (C++)</td><td align="center">105μs</td><td align="center">9.5k ops/s</td></tr><tr><td align="left">AIDL (Java)</td><td align="center">120μs</td><td align="center">8.3k ops/s</td></tr></tbody></table>
<p><strong>结论</strong>:AIDL的抽象带来的开销可以忽略,应优先使用AIDL以获得更好的维护性。</p>
<hr/>
<h2 data-id="heading-31">Android 15新特性:AIDL生态的升级</h2>
<h3 data-id="heading-32">1. Rust Backend支持</h3>
<p>Android 15的AIDL编译器新增Rust语言支持:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 生成Rust绑定</span>
aidl_interface {
    name: <span class="hljs-string">"android.hardware.health"</span>,
    backend: {
        rust: {
            enabled: <span class="hljs-literal">true</span>,
        },
    },
}
</code></pre>
<p><strong>生成的Rust代码</strong>(简化):</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// 自动生成的 IHealth.rs</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">trait</span> <span class="hljs-title class_">IHealth</span>: binder::Interface {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_capacity</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> binder::<span class="hljs-type">Result</span>&lt;<span class="hljs-type">i32</span>&gt;;
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_health_info</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> binder::<span class="hljs-type">Result</span>&lt;HealthInfo&gt;;
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">IHealth</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">BpHealth</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_capacity</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> binder::<span class="hljs-type">Result</span>&lt;<span class="hljs-type">i32</span>&gt; {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">reply</span> = <span class="hljs-keyword">self</span>.binder.<span class="hljs-title function_ invoke__">transact</span>(TRANSACTION_getCapacity, <span class="hljs-number">0</span>)?;
        reply.<span class="hljs-title function_ invoke__">read</span>()
    }
}
</code></pre>
<h3 data-id="heading-33">2. VINTF强制验证</h3>
<p>Android 15要求所有Stable AIDL HAL声明VINTF稳定性:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@VintfStability</span>  <span class="hljs-comment">// ← 必须添加</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IHealth</span> {
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>同时需要在<code>vintf</code>目录添加清单文件:</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- hardware/interfaces/health/aidl/vintf/android.hardware.health-service.xml --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">manifest</span> <span class="hljs-attr">version</span>=<span class="hljs-string">"1.0"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"device"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">hal</span> <span class="hljs-attr">format</span>=<span class="hljs-string">"aidl"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>android.hardware.health<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">interface</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>IHealth<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">instance</span>&gt;</span>default<span class="hljs-tag">&lt;/<span class="hljs-name">instance</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">interface</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">hal</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span>
</code></pre>
<h3 data-id="heading-34">3. Lazy HAL支持</h3>
<p>按需启动HAL服务,节省内存:</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// main.cpp (Lazy启动)</span>
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">auto</span> health = ndk::SharedRefBase::<span class="hljs-built_in">make</span>&lt;Health&gt;(<span class="hljs-string">"default"</span>, ...);

    <span class="hljs-comment">// 使用LazyServiceRegistrar代替直接注册</span>
    <span class="hljs-keyword">auto</span> registrar = ndk::LazyServiceRegistrar::<span class="hljs-built_in">getInstance</span>();
    registrar.<span class="hljs-built_in">registerService</span>(health-&gt;<span class="hljs-built_in">asBinder</span>().<span class="hljs-built_in">get</span>(),
                               instance.<span class="hljs-built_in">c_str</span>());

    <span class="hljs-comment">// 当无客户端连接时,服务会自动退出</span>
    <span class="hljs-built_in">ABinderProcess_joinThreadPool</span>();
    <span class="hljs-keyword">return</span> EXIT_FAILURE;
}
</code></pre>
<p><strong>优势</strong>:</p>
<ul>
<li>待机状态下,未使用的HAL不占用内存</li>
<li>首次调用时自动启动(100ms延迟)</li>
<li>适用于低频使用的HAL(如NFC、IR)</li>
</ul>
<hr/>
<h2 data-id="heading-35">实战案例:创建自定义AIDL HAL</h2>
<p>假设我们要为智能座舱系统添加一个"氛围灯控制"HAL。</p>
<h3 data-id="heading-36">1. 定义AIDL接口</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// hardware/interfaces/ambientlight/aidl/android/hardware/ambientlight/IAmbientLight.aidl</span>
<span class="hljs-keyword">package</span> android.hardware.ambientlight;

<span class="hljs-keyword">import</span> android.hardware.ambientlight.LightZone;
<span class="hljs-keyword">import</span> android.hardware.ambientlight.RgbColor;

<span class="hljs-meta">@VintfStability</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IAmbientLight</span> {
    <span class="hljs-comment">/**
     * 设置指定区域的颜色
     * <span class="hljs-doctag">@param</span> zone 灯光区域(前排/后排/氛围带)
     * <span class="hljs-doctag">@param</span> color RGB颜色值
     */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setColor</span><span class="hljs-params">(in LightZone zone, in RgbColor color)</span>;

    <span class="hljs-comment">/**
     * 设置亮度(0-100)
     */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setBrightness</span><span class="hljs-params">(<span class="hljs-type">int</span> brightness)</span>;

    <span class="hljs-comment">/**
     * 启用/禁用呼吸灯效果
     */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setBreathingMode</span><span class="hljs-params">(<span class="hljs-type">boolean</span> enabled)</span>;
}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// RgbColor.aidl</span>
<span class="hljs-keyword">package</span> android.hardware.ambientlight;

parcelable RgbColor {
    <span class="hljs-type">int</span> red;    <span class="hljs-comment">// 0-255</span>
    <span class="hljs-type">int</span> green;  <span class="hljs-comment">// 0-255</span>
    <span class="hljs-type">int</span> blue;   <span class="hljs-comment">// 0-255</span>
}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// LightZone.aidl</span>
<span class="hljs-keyword">package</span> android.hardware.ambientlight;

<span class="hljs-meta">@Backing(type="int")</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">LightZone</span> {
    FRONT_DASHBOARD = <span class="hljs-number">0</span>,
    REAR_SEATS = <span class="hljs-number">1</span>,
    DOOR_AMBIENT = <span class="hljs-number">2</span>,
}
</code></pre>
<h3 data-id="heading-37">2. 添加构建配置</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># hardware/interfaces/ambientlight/aidl/Android.bp</span>
aidl_interface {
    name: <span class="hljs-string">"android.hardware.ambientlight"</span>,
    vendor_available: true,
    srcs: [<span class="hljs-string">"android/hardware/ambientlight/*.aidl"</span>],
    stability: <span class="hljs-string">"vintf"</span>,
    backend: {
        java: {
            sdk_version: <span class="hljs-string">"module_current"</span>,
        },
        cpp: {
            enabled: true,
        },
        rust: {
            enabled: true,
        },
    },
    versions_with_info: [
        {
            version: <span class="hljs-string">"1"</span>,
            imports: [],
        },
    ],
}
</code></pre>
<h3 data-id="heading-38">3. 实现HAL服务</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// hardware/interfaces/ambientlight/aidl/default/AmbientLight.h</span>
<span class="hljs-meta">#<span class="hljs-keyword">pragma</span> once</span>

<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;aidl/android/hardware/ambientlight/BnAmbientLight.h&gt;</span></span>

<span class="hljs-keyword">namespace</span> aidl::android::hardware::ambientlight {

<span class="hljs-keyword">class</span> <span class="hljs-title class_">AmbientLight</span> : <span class="hljs-keyword">public</span> BnAmbientLight {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">setColor</span><span class="hljs-params">(LightZone zone, <span class="hljs-type">const</span> RgbColor&amp; color)</span> <span class="hljs-keyword">override</span></span>;
    <span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">setBrightness</span><span class="hljs-params">(<span class="hljs-type">int32_t</span> brightness)</span> <span class="hljs-keyword">override</span></span>;
    <span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">setBreathingMode</span><span class="hljs-params">(<span class="hljs-type">bool</span> enabled)</span> <span class="hljs-keyword">override</span></span>;

<span class="hljs-keyword">private</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">writeToHardware</span><span class="hljs-params">(LightZone zone, <span class="hljs-type">const</span> RgbColor&amp; color, <span class="hljs-type">int</span> brightness)</span></span>;
};

}  <span class="hljs-comment">// namespace</span>
</code></pre>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// AmbientLight.cpp</span>
<span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">AmbientLight::setColor</span><span class="hljs-params">(LightZone zone, <span class="hljs-type">const</span> RgbColor&amp; color)</span> </span>{
    <span class="hljs-keyword">if</span> (color.red &lt; <span class="hljs-number">0</span> || color.red &gt; <span class="hljs-number">255</span>) {
        <span class="hljs-keyword">return</span> ndk::ScopedAStatus::<span class="hljs-built_in">fromExceptionCode</span>(EX_ILLEGAL_ARGUMENT);
    }

    <span class="hljs-comment">// 写入硬件寄存器或通过CAN总线发送</span>
    <span class="hljs-built_in">writeToHardware</span>(zone, color, current_brightness_);

    <span class="hljs-keyword">return</span> ndk::ScopedAStatus::<span class="hljs-built_in">ok</span>();
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">AmbientLight::writeToHardware</span><span class="hljs-params">(LightZone zone, <span class="hljs-type">const</span> RgbColor&amp; color, <span class="hljs-type">int</span> brightness)</span> </span>{
    <span class="hljs-comment">// 伪代码:实际应通过SPI/I2C/CAN与硬件通信</span>
    <span class="hljs-type">int</span> led_controller_fd = <span class="hljs-built_in">open</span>(<span class="hljs-string">"/dev/led_controller"</span>, O_RDWR);

    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">led_command</span> {
        <span class="hljs-type">uint8_t</span> zone;
        <span class="hljs-type">uint8_t</span> r, g, b;
        <span class="hljs-type">uint8_t</span> brightness;
    } cmd = {
        .zone = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint8_t</span>&gt;(zone),
        .r = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint8_t</span>&gt;(color.red),
        .g = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint8_t</span>&gt;(color.green),
        .b = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint8_t</span>&gt;(color.blue),
        .brightness = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint8_t</span>&gt;(brightness),
    };

    <span class="hljs-built_in">write</span>(led_controller_fd, &amp;cmd, <span class="hljs-built_in">sizeof</span>(cmd));
    <span class="hljs-built_in">close</span>(led_controller_fd);
}
</code></pre>
<h3 data-id="heading-39">4. 注册服务</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// main.cpp</span>
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">auto</span> ambient_light = ndk::SharedRefBase::<span class="hljs-built_in">make</span>&lt;AmbientLight&gt;();

    <span class="hljs-type">const</span> std::string instance = std::<span class="hljs-built_in">string</span>(IAmbientLight::descriptor) + <span class="hljs-string">"/default"</span>;
    <span class="hljs-keyword">auto</span> status = <span class="hljs-built_in">AServiceManager_addService</span>(ambient_light-&gt;<span class="hljs-built_in">asBinder</span>().<span class="hljs-built_in">get</span>(),
                                             instance.<span class="hljs-built_in">c_str</span>());
    <span class="hljs-built_in">CHECK</span>(status == STATUS_OK) &lt;&lt; <span class="hljs-string">"Failed to register AmbientLight HAL"</span>;

    <span class="hljs-built_in">ABinderProcess_setThreadPoolMaxThreadCount</span>(<span class="hljs-number">4</span>);
    <span class="hljs-built_in">ABinderProcess_startThreadPool</span>();
    <span class="hljs-built_in">ABinderProcess_joinThreadPool</span>();

    <span class="hljs-keyword">return</span> EXIT_FAILURE;
}
</code></pre>
<h3 data-id="heading-40">5. 客户端调用</h3>
<p><strong>Native客户端</strong>:</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;android/hardware/ambientlight/IAmbientLight.h&gt;</span></span>

<span class="hljs-keyword">using</span> aidl::android::hardware::ambientlight::IAmbientLight;
<span class="hljs-keyword">using</span> aidl::android::hardware::ambientlight::RgbColor;
<span class="hljs-keyword">using</span> aidl::android::hardware::ambientlight::LightZone;

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setAmbientLightColor</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// 获取HAL服务</span>
    <span class="hljs-type">const</span> std::string instance = std::<span class="hljs-built_in">string</span>(IAmbientLight::descriptor) + <span class="hljs-string">"/default"</span>;
    <span class="hljs-keyword">auto</span> binder = ndk::<span class="hljs-built_in">SpAIBinder</span>(<span class="hljs-built_in">AServiceManager_getService</span>(instance.<span class="hljs-built_in">c_str</span>()));
    <span class="hljs-keyword">auto</span> light = IAmbientLight::<span class="hljs-built_in">fromBinder</span>(binder);

    <span class="hljs-keyword">if</span> (!light) {
        <span class="hljs-built_in">LOG</span>(ERROR) &lt;&lt; <span class="hljs-string">"Failed to get AmbientLight HAL"</span>;
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// 设置前排仪表台为蓝色</span>
    RgbColor blue{.red = <span class="hljs-number">0</span>, .green = <span class="hljs-number">0</span>, .blue = <span class="hljs-number">255</span>};
    <span class="hljs-keyword">auto</span> status = light-&gt;<span class="hljs-built_in">setColor</span>(LightZone::FRONT_DASHBOARD, blue);

    <span class="hljs-keyword">if</span> (!status.<span class="hljs-built_in">isOk</span>()) {
        <span class="hljs-built_in">LOG</span>(ERROR) &lt;&lt; <span class="hljs-string">"setColor failed: "</span> &lt;&lt; status.<span class="hljs-built_in">getDescription</span>();
    }
}
</code></pre>
<p><strong>Java客户端</strong>(Framework层):</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> android.hardware.ambientlight.IAmbientLight;
<span class="hljs-keyword">import</span> android.hardware.ambientlight.RgbColor;
<span class="hljs-keyword">import</span> android.hardware.ambientlight.LightZone;
<span class="hljs-keyword">import</span> android.os.ServiceManager;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AmbientLightManager</span> {
    <span class="hljs-keyword">private</span> IAmbientLight mService;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">AmbientLightManager</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            mService = IAmbientLight.Stub.asInterface(
                ServiceManager.waitForService(<span class="hljs-string">"android.hardware.ambientlight.IAmbientLight/default"</span>)
            );
        } <span class="hljs-keyword">catch</span> (Exception e) {
            Log.e(TAG, <span class="hljs-string">"Failed to get AmbientLight service"</span>, e);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFrontColor</span><span class="hljs-params">(<span class="hljs-type">int</span> r, <span class="hljs-type">int</span> g, <span class="hljs-type">int</span> b)</span> {
        <span class="hljs-type">RgbColor</span> <span class="hljs-variable">color</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RgbColor</span>();
        color.red = r;
        color.green = g;
        color.blue = b;

        <span class="hljs-keyword">try</span> {
            mService.setColor(LightZone.FRONT_DASHBOARD, color);
        } <span class="hljs-keyword">catch</span> (RemoteException e) {
            Log.e(TAG, <span class="hljs-string">"Failed to set color"</span>, e);
        }
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-41">总结</h2>
<p>本文深入分析了AIDL和HIDL在Android 15中的应用,涵盖了从接口定义到HAL服务实现的完整流程。</p>
<p><strong>核心要点回顾</strong>:</p>
<ol>
<li>
<p><strong>AIDL vs HIDL</strong>:</p>
<ul>
<li>HIDL正在退役,新项目使用Stable AIDL</li>
<li>Stable AIDL通过版本冻结实现向后兼容</li>
<li>Android 15全面支持Rust AIDL Backend</li>
</ul>
</li>
<li>
<p><strong>HAL服务开发</strong>:</p>
<ul>
<li>继承<code>BnXXX</code>实现服务端</li>
<li>通过<code>AServiceManager_addService()</code>注册</li>
<li>使用<code>fromBinder()</code>获取客户端代理</li>
</ul>
</li>
<li>
<p><strong>性能优化</strong>:</p>
<ul>
<li>批量获取数据减少Binder往返</li>
<li>使用<code>oneway</code>实现异步回调</li>
<li>考虑Lazy HAL减少内存占用</li>
</ul>
</li>
<li>
<p><strong>最佳实践</strong>:</p>
<ul>
<li>注册死亡通知防止泄漏</li>
<li>统一错误处理(ScopedAStatus)</li>
<li>VINTF清单声明确保兼容性</li>
</ul>
</li>
</ol>
<p>通过Health HAL和自定义AmbientLight HAL的实战案例,你已经具备了开发AIDL HAL服务的完整能力!</p>
<hr/>
<h3 data-id="heading-42">参考资料</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fsource.android.com%2Fdocs%2Fcore%2Farchitecture%2Faidl" target="_blank" title="https://source.android.com/docs/core/architecture/aidl" ref="nofollow noopener noreferrer">Android AIDL官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcs.android.com%2Fandroid%2Fplatform%2Fsuperproject%2F%2B%2Fandroid15-release%3Asystem%2Ftools%2Faidl%2FREADME.md" target="_blank" title="https://cs.android.com/android/platform/superproject/+/android15-release:system/tools/aidl/README.md" ref="nofollow noopener noreferrer">Stable AIDL设计文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcs.android.com%2Fandroid%2Fplatform%2Fsuperproject%2F%2B%2Fandroid15-release%3Ahardware%2Finterfaces%2Fhealth%2Faidl%2F" target="_blank" title="https://cs.android.com/android/platform/superproject/+/android15-release:hardware/interfaces/health/aidl/" ref="nofollow noopener noreferrer">Health HAL源码</a></li>
</ul>
<hr/>
<h3 data-id="heading-43">系列文章</h3>
<ul>
<li><a href="https://juejin.cn/post/7603651011978477610" target="_blank" title="https://juejin.cn/post/7603651011978477610">上一篇：Android 15 ServiceManager与Binder服务注册深度解析</a></li>
</ul>
<hr/>
<p><em>欢迎来我中的<a href="https://link.juejin.cn?target=https%3A%2F%2Fhome.wonlab.top" target="_blank" title="https://home.wonlab.top" ref="nofollow noopener noreferrer">个人主页</a>找到更多有用的知识和有趣的产品</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[给你的 code agent 搓一个错误检测机制]]></title>    <link>https://juejin.cn/post/7604889577937649691</link>    <guid>https://juejin.cn/post/7604889577937649691</guid>    <pubDate>2026-02-10T11:51:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604889577937649691" data-draft-id="7604984549173706761" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="给你的 code agent 搓一个错误检测机制"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-10T11:51:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="imoo"/> <meta itemprop="url" content="https://juejin.cn/user/2682464104364766"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            给你的 code agent 搓一个错误检测机制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2682464104364766/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    imoo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T11:51:50.000Z" title="Tue Feb 10 2026 11:51:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>众所周知，code agent 是无法判断出生成的代码是否正确的。也就是只有生成环节，没有验证环节，所以需要我们一点点做 debug，这也是很多人最开始不看好 ai 的原因。</p>
<p>但反过来想，是不是解决了验证环节，ai 的体验就会获得大幅提升呢。</p>
<h2 data-id="heading-1">锁定问题</h2>
<p>要想解决验证环节，可以先思考我们是如何做 debug 的。</p>
<p>对于前端，一般而言都是先安装依赖，看看代码有没有爆红。然后运行，看项目是否能正常启动，最后打开页面和控制台，点一点看哪里有问题。</p>
<p>拆解来看，其实分为了几个问题：</p>
<ul>
<li>是否能正常安装依赖</li>
<li>代码是否直接在编辑器就出现了错误（静态检测/开发时错误）</li>
<li>项目是否能正常启动（构建时错误）</li>
<li>控制台是否报错（运行时错误）</li>
</ul>
<p>所以，我们的目标是依次解决这些问题。</p>
<h2 data-id="heading-2">解决方案</h2>
<h4 data-id="heading-3">能否正常安装依赖</h4>
<p>这一步其实相对简单，运行 <code>npm i</code> 就行了。需要注意的点有：</p>
<ol>
<li>npm 安装依赖存在不少问题，它使用扁平化所有依赖，并逐个进行下载的做法，这可能会导致<strong>幽灵依赖</strong>（能引用到没安装 package.json 的部分包），<strong>安装缓慢</strong>（内存存储双爆炸），<strong>依赖冲突</strong>（子依赖使用了不同版本）等问题。为了解决这些问题，<strong>pnpm</strong> 出现了，目前大部分前端项目都会优先考虑使用 pnpm</li>
<li>关于锁文件的问题</li>
</ol>
<p><strong>真正决定安装版本的是锁文件</strong>，其生成依赖于 package.json。但<strong>不要手动修改锁文件。</strong></p>
<p>安装会有很多种情况</p>
<p>情况1：当有锁文件，且与 package.json 中包一致时，执行安装，会完全按照锁文件进行安装，这是最常见且最安全的情况。</p>
<p>情况2：当有锁文件，且与 package.json 中包不一致（比如手动在 package.json 中更新了包），执行安装，锁文件会更新有变化的部分。锁文件更新后，后续再进行安装就会进入到情况1</p>
<p>情况3：当没有锁文件，执行安装依赖时，会按 package.json 里的依赖</p>
<ul>
<li>精确版本号时，会选择精确版本（"axios": "1.5.0" 会安装 1.5.0）</li>
<li>有 ^ 时，允许小版本自动更新（"axios": "^1.5.0" 会选择最新且小于 2.0.0 的版本）</li>
<li>有 ~ 时，允许小特性自动更新（"axios": "~1.5.0" 会安装最新且小于 1.6.0 的版本）</li>
</ul>
<p>根据这些规则，会选择出所有适合的包，生成锁文件，接着进入情况1，使后续该项目使用的包稳定，不会出现突然升级的问题。</p>
<p>暂时无法在昆仑万维文档外展示此内容</p>
<p><strong>最佳实践</strong>：安装/更新新依赖，最好还是走命令行</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">npm</span> <span class="hljs-selector-tag">i</span> <span class="hljs-selector-tag">xxx</span> <span class="hljs-comment">// 安装</span>
<span class="hljs-selector-tag">npm</span> <span class="hljs-selector-tag">i</span> <span class="hljs-selector-tag">xxx</span>@<span class="hljs-selector-tag">latest</span> <span class="hljs-comment">// 更新最新版，也可以指定版本如 xxx@1.0.0</span>
</code></pre>
<p>这样能自动同时更新 package.json 和锁文件，且不影响其他包。</p>
<p>退而求其次，是手动修改 package.json，随后再进行 npm i 重新安装，这样也能让锁文件进行更新，</p>
<blockquote>
<p>如果单独修改 package.json 文件，可能是无效的，比如：package.json 中 <code>"axios": "^1.5.0"</code>，lock 中 <code>1.5.2</code>，此时你将 package.json 的 <code>^1.5.0</code> 改为 <code>^1.5.1</code>，由于 lock 中的 <code>1.5.2</code> 仍符合<code>^1.5.1</code>，所以是无事发生，不会产生任何更新。</p>
</blockquote>
<h4 data-id="heading-4">是否直接在编辑器就出现了错误</h4>
<p>ai 的很多错误，其实在前端通常都能很直接的看到，如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44a2db0eeab04ed3a2ff9766ccefe36d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaW1vbw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771329115&amp;x-signature=h9l%2BJ%2BlTwEj1sQjQWM89bum5veg%3D" alt="" loading="lazy"/></p>
<p>这里的报错其实有两个原因：eslint 报错与 ts 报错</p>
<p>我们可以通过这两个命令扫描出对应的错误：</p>
<pre><code class="hljs language-css" lang="css">npx eslint ./
npx tsc <span class="hljs-attr">--noEmit</span> -<span class="hljs-selector-tag">p</span> tsconfig<span class="hljs-selector-class">.app</span><span class="hljs-selector-class">.json</span> <span class="hljs-attr">--strict</span>
</code></pre>
<p>我们可以在对应的文件中，配置对应的规则集，eslint 的配置位于 eslint.config.js 中；ts 的配置位于 tsconfig.app.json。</p>
<p>严格的规则，有助于 ai 生成产物的稳定，更不容易出现白屏报错等问题，但相对的时间会更长，因为要解决更多 error。宽松的规则，则对应 token 的减少，时间更快。</p>
<p>在我们的项目中，使用了默认的规则集，基本上就够用了，不过有几个模型经常报错、但不影响主流程的，我们还是降低为了 warn，从而规避修复所需要花费的成本。</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-string">"@typescript-eslint/no-unused-vars"</span>: <span class="hljs-string">"warn"</span>, <span class="hljs-regexp">//</span> 未使用变量降为 <span class="hljs-keyword">warn</span>
<span class="hljs-string">"@typescript-eslint/no-empty-object-type"</span>: <span class="hljs-string">"warn"</span>, <span class="hljs-regexp">//</span> 空对象类型降为 <span class="hljs-keyword">warn</span>
<span class="hljs-string">"@typescript-eslint/no-explicit-any"</span>: <span class="hljs-string">"warn"</span>, <span class="hljs-regexp">//</span> any 类型降为 <span class="hljs-keyword">warn</span>，这个可能还有待商榷，过多的使用 any 本质上就是忽略报错
</code></pre>
<h4 data-id="heading-5">项目是否能正常启动</h4>
<p>在大部分情况下，如果前两个步骤是正确的，最后一步 build 大概率不会有问题。即使有问题，模型也能在 build 后也能看到构建报错，从而直接进行修复。</p>
<p>如果想要验证也简单，跑一个构建命令就行了</p>
<pre><code class="hljs language-arduino" lang="arduino">npm run build
</code></pre>
<h4 data-id="heading-6">控制台是否报错</h4>
<p>前面三个环节，都可以用命令行进行验证和 debug，也就是 agent 有办法感知到。但控制台的报错，属于运行时错误，很难报给 agent，所以我们需要设计一套上报机制来解决这个问题。</p>
<p>也就是这个需求 <a href="https://link.juejin.cn?target=https%3A%2F%2Frg975ojk5z.feishu.cn%2Fwiki%2FULd7wVcniizLapkaNlTcnFjBnJg" target="_blank" title="https://rg975ojk5z.feishu.cn/wiki/ULd7wVcniizLapkaNlTcnFjBnJg" ref="nofollow noopener noreferrer">【Websites】增加手动Debug模式</a>，简单来说，就是<strong>控制台的所有报错都暴露出来发给 agent</strong></p>
<p>要实现这点，关键在于拦截所有报错，我们来看常见的报错，逐个进行解决。</p>
<ol>
<li>普通 js 同步报错，也是最常见的一种，语法问题等引起</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32f88e31ffa647cfbb54afd64bf3da99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaW1vbw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771329115&amp;x-signature=p0WdYPLcKhxV0uDLNRXl0v6AnHc%3D" alt="" loading="lazy"/></p>
<p>解法：可以用 window.onerror 进行回调处理</p>
<ol start="2">
<li>promise reject 未处理报错，类似 try catch 问题</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec16dc6c20fc4888ac631793320c009a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaW1vbw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771329115&amp;x-signature=JIm0W3EpqtpNNn%2BkUz5Q0rnlJ5Q%3D" alt="" loading="lazy"/></p>
<p>解法：可以使用 window.addEventListener("unhandledrejection", event =&gt; {}) 来做回调处理</p>
<ol start="3">
<li>接口报错 / 资源加载失败</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfe97c0be1474856a2d9c0e5ade5fbd7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaW1vbw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771329115&amp;x-signature=EwcuIZ9nRw5P1x9UKBTiL1QhF18%3D" alt="" loading="lazy"/></p>
<p>虽然严格意义上，不算代码的问题，但是也有必要让 agent 感知到</p>
<p>解法：通信使用 axios 包，并且在其响应拦截器中做处理，如果不是 200，则进行 error 回调</p>
<p>主要的报错就这三种，我们可以基于此封装一套错误抛出的机制。不过 github 实际上有现成的更完备的库，可以考虑直接使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fsentry.io%2Fwelcome%2F" target="_blank" title="https://sentry.io/welcome/" ref="nofollow noopener noreferrer">Sentry</a> 来做这件事。sentry 本身是用于错误上报的，不过我们可以将其拦截掉，在 callback 中只执行我们的逻辑即可。</p>
<pre><code class="hljs language-js" lang="js">  <span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">init</span>({
    <span class="hljs-attr">dsn</span>: <span class="hljs-string">'https://examplePublicKey@o0.ingest.sentry.io/0'</span>, <span class="hljs-comment">// 使用假 DSN 来启用错误捕获功能</span>
    <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 启用 Sentry</span>
    <span class="hljs-attr">attachStacktrace</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 附加堆栈跟踪</span>
    
    <span class="hljs-comment">// 在发送前处理错误</span>
    <span class="hljs-title function_">beforeSend</span>(<span class="hljs-params">event, hint</span>) {
      <span class="hljs-keyword">const</span> error = hint.<span class="hljs-property">originalException</span> || hint.<span class="hljs-property">syntheticException</span>
      <span class="hljs-title function_">dosomething</span>(error, event)
      <span class="hljs-comment">// 返回 null 阻止实际上报到 Sentry</span>
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
    },
  })
</code></pre>
<p>当你的模版中接入了这套流程后，你就可以将错误向 agent 抛出了，比如说：</p>
<ol>
<li>
<p>skywork 中，产物是在 iframe 里，那么我们可以利用 postMessage 将错误反馈到主应用，从而在输入框中引用到错误并发送给 agent</p>
</li>
<li>
<p>如果产物完全独立，可以考虑将错误打到接口中，之后的通信让 agent 先去访问这些错误，修复后再做操作</p>
</li>
</ol>
<h2 data-id="heading-7">总结</h2>
<p>所以最终这个机制有以下几个部分构成：</p>
<ol>
<li>安装、更新依赖时走命令行（且最好使用 pnpm 而非 npm）</li>
</ol>

<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">npm</span> <span class="hljs-selector-tag">i</span> <span class="hljs-selector-tag">xxx</span> <span class="hljs-comment">// 安装</span>
<span class="hljs-selector-tag">npm</span> <span class="hljs-selector-tag">i</span> <span class="hljs-selector-tag">xxx</span>@<span class="hljs-selector-tag">latest</span> <span class="hljs-comment">// 更新最新版，也可以指定版本如 xxx@1.0.0</span>
</code></pre>
<p>2.  build 前先扫描错误并修复（要使用 typescript 而非 js，要接入 eslint）</p>

<pre><code class="hljs language-css" lang="css">npx eslint ./
npx tsc <span class="hljs-attr">--noEmit</span> -<span class="hljs-selector-tag">p</span> tsconfig<span class="hljs-selector-class">.app</span><span class="hljs-selector-class">.json</span> <span class="hljs-attr">--strict</span>
</code></pre>
<p>3.  跑 build 看有没有问题</p>

<pre><code class="hljs language-arduino" lang="arduino">npm run build
</code></pre>
<p>4.  在模版中接入运行时错误监控，并将监控的结果传递给 agent</p>
<pre><code class="hljs language-js" lang="js">  <span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">init</span>({
    <span class="hljs-attr">dsn</span>: <span class="hljs-string">'https://examplePublicKey@o0.ingest.sentry.io/0'</span>, <span class="hljs-comment">// 使用假 DSN 来启用错误捕获功能</span>
    <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 启用 Sentry</span>
    <span class="hljs-attr">attachStacktrace</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 附加堆栈跟踪</span>
    
    <span class="hljs-comment">// 在发送前处理错误</span>
    <span class="hljs-title function_">beforeSend</span>(<span class="hljs-params">event, hint</span>) {
      <span class="hljs-keyword">const</span> error = hint.<span class="hljs-property">originalException</span> || hint.<span class="hljs-property">syntheticException</span>
      <span class="hljs-title function_">dosomething</span>(error, event) <span class="hljs-comment">// 自定义实现</span>
      <span class="hljs-comment">// 返回 null 阻止实际上报到 Sentry</span>
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
    },
  })
  
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一天一个开源项目（第18篇）：OpenWork - 开源版Claude Cowork，本地AI代理工作台]]></title>    <link>https://juejin.cn/post/7605051978871881747</link>    <guid>https://juejin.cn/post/7605051978871881747</guid>    <pubDate>2026-02-10T12:01:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605051978871881747" data-draft-id="7604964464689709119" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一天一个开源项目（第18篇）：OpenWork - 开源版Claude Cowork，本地AI代理工作台"/> <meta itemprop="keywords" content="AI编程,AIGC,开源"/> <meta itemprop="datePublished" content="2026-02-10T12:01:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="冬奇Lab"/> <meta itemprop="url" content="https://juejin.cn/user/1857501105781193"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一天一个开源项目（第18篇）：OpenWork - 开源版Claude Cowork，本地AI代理工作台
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1857501105781193/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    冬奇Lab
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T12:01:06.000Z" title="Tue Feb 10 2026 12:01:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<blockquote>
<p>"如果 Claude Cowork 能开源、本地化运行，那该多好？"</p>
</blockquote>
<p>这是"一天一个开源项目"系列的第18篇文章。今天带你了解的项目是 <strong>OpenWork</strong>（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdifferent-ai%2Fopenwork" target="_blank" title="https://github.com/different-ai/openwork" ref="nofollow noopener noreferrer">GitHub</a>）。</p>
<p>在 AI 代理工具领域，Claude Cowork 是一个强大的协作工作台，但它是闭源的商业产品。OpenWork 应运而生，它是一个完全开源的桌面应用，由 OpenCode 驱动，实现了与 Claude Cowork 类似的功能：<strong>运行 AI 代理、技能和 MCP（模型上下文协议）</strong>。更重要的是，它采用"本地优先，云端就绪"的设计理念，让你可以在自己的机器上一键运行，完全掌控自己的 AI 工作流。</p>
<p><strong>为什么选择这个项目？</strong></p>
<ul>
<li>🖥️ <strong>开源替代品</strong>：Claude Cowork 的免费开源替代方案</li>
<li>🏠 <strong>本地优先</strong>：在本地运行 AI 代理，数据完全由你掌控</li>
<li>🔌 <strong>MCP 协议支持</strong>：原生支持 Model Context Protocol</li>
<li>🧩 <strong>可组合架构</strong>：桌面应用、聊天应用连接器、服务器模式随意切换</li>
<li>⚡ <strong>技能管理器</strong>：安装、导入和管理各种技能</li>
<li>🌐 <strong>跨平台支持</strong>：基于 Tauri 构建，支持 macOS、Windows、Linux</li>
<li>🔓 <strong>可"弹出"设计</strong>：甚至无需 UI 也能通过命令行工作</li>
</ul>
<h3 data-id="heading-1">你将学到什么</h3>
<ul>
<li>OpenWork 的核心架构和设计理念</li>
<li>如何在本地部署和运行 AI 代理工作流</li>
<li>MCP 协议在 OpenWork 中的应用</li>
<li>技能系统的使用和管理</li>
<li>主机模式与客户端模式的区别和应用场景</li>
<li>与其他 AI 工作台工具的对比分析</li>
<li>实际应用场景和最佳实践</li>
</ul>
<h3 data-id="heading-2">前置知识</h3>
<ul>
<li>对 AI 代理概念有基本了解</li>
<li>了解 MCP（Model Context Protocol）协议（可选）</li>
<li>熟悉命令行操作（可选）</li>
<li>对桌面应用开发有基本概念（可选）</li>
</ul>
<hr/>
<h2 data-id="heading-3">项目背景</h2>
<h3 data-id="heading-4">项目简介</h3>
<p><strong>OpenWork</strong> 是一个<strong>开源桌面 AI 代理工作台</strong>，作为 Claude Cowork 的替代品，由 OpenCode CLI 提供核心能力。它允许用户在本地或服务器上运行 AI 代理、技能和 MCP，支持从单人使用扩展到团队协作共享。OpenWork 采用"本地优先，云端就绪"的设计哲学，让用户可以一键在本地运行 AI 工作流，同时也支持连接远程服务器。</p>
<p><strong>项目解决的核心问题</strong>：</p>
<ul>
<li>Claude Cowork 是闭源商业产品，无法本地化部署</li>
<li>现有 AI 代理工具缺乏统一的技能管理和 MCP 支持</li>
<li>团队协作需要共享 AI 工作流，但缺乏开源解决方案</li>
<li>开发者需要一个可扩展、可组合的 AI 代理工作台</li>
<li>隐私敏感场景需要完全本地化的 AI 代理运行环境</li>
</ul>
<p><strong>面向的用户群体</strong>：</p>
<ul>
<li>需要本地运行 AI 代理的开发者</li>
<li>希望使用 Claude Cowork 类似功能但不想付费的用户</li>
<li>对 MCP 协议感兴趣的技术人员</li>
<li>需要团队共享 AI 工作流的团队</li>
<li>对数据隐私有高要求的企业和个人</li>
</ul>
<h3 data-id="heading-5">作者/团队介绍</h3>
<p><strong>团队：different-ai</strong></p>
<ul>
<li><strong>背景</strong>：专注于开源 AI 工具开发的团队</li>
<li><strong>代表作品</strong>：OpenWork、file-organizer-2000 等</li>
<li><strong>理念</strong>：让 AI 工具更加开放、可访问、可组合</li>
<li><strong>技术栈</strong>：TypeScript、Rust、Tauri、React</li>
</ul>
<h3 data-id="heading-6">项目数据</h3>
<ul>
<li>⭐ <strong>GitHub Stars</strong>: 9.2k+（快速增长中）</li>
<li>🍴 <strong>Forks</strong>: 768+</li>
<li>📦 <strong>版本</strong>: 持续更新中（830+ commits）</li>
<li>📄 <strong>License</strong>: MIT（完全开源，自由使用）</li>
<li>🌐 <strong>项目地址</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdifferent-ai%2Fopenwork" target="_blank" title="https://github.com/different-ai/openwork" ref="nofollow noopener noreferrer">GitHub</a></li>
<li>💬 <strong>社区</strong>: GitHub Issues 活跃</li>
<li>👥 <strong>贡献者</strong>: 23位贡献者，活跃的社区参与</li>
</ul>
<p><strong>项目发展历程</strong>：</p>
<ul>
<li>2024-2025年：项目创建，实现核心功能</li>
<li>持续迭代：添加技能管理器、MCP 支持等新功能</li>
<li>社区增长：达到 9.2k+ Stars，成为热门项目</li>
<li>多模态支持：支持桌面应用、Web 界面、CLI 等多种使用方式</li>
</ul>
<hr/>
<h2 data-id="heading-7">主要功能</h2>
<h3 data-id="heading-8">核心作用</h3>
<p>OpenWork 的核心作用是<strong>提供一个开源的 AI 代理工作台</strong>，主要功能包括：</p>
<ol>
<li><strong>AI 代理运行</strong>：在本地或服务器上运行各种 AI 代理</li>
<li><strong>技能管理</strong>：安装、导入和管理各种技能（Skills）</li>
<li><strong>MCP 协议支持</strong>：原生支持 Model Context Protocol</li>
<li><strong>会话管理</strong>：管理多个会话，支持实时提示发送</li>
<li><strong>工作流模板</strong>：保存工作流模板，支持重复执行</li>
<li><strong>权限控制</strong>：处理代理的权限请求</li>
<li><strong>执行时间线</strong>：可视化展示执行计划时间线</li>
<li><strong>事件流订阅</strong>：支持 SSE 事件流订阅</li>
</ol>
<h3 data-id="heading-9">使用场景</h3>
<p>OpenWork 适用于多种 AI 工作流场景：</p>
<ol>
<li>
<p><strong>本地开发</strong></p>
<ul>
<li>在本地运行 AI 代理进行开发测试</li>
<li>无需云服务即可使用完整功能</li>
<li>保护代码和数据隐私</li>
</ul>
</li>
<li>
<p><strong>团队协作</strong></p>
<ul>
<li>搭建共享的 AI 代理服务器</li>
<li>团队成员通过客户端模式连接</li>
<li>统一管理技能和工作流</li>
</ul>
</li>
<li>
<p><strong>自动化任务</strong></p>
<ul>
<li>使用技能自动化重复性任务</li>
<li>保存工作流模板重复执行</li>
<li>批量处理多个任务</li>
</ul>
</li>
<li>
<p><strong>MCP 集成</strong></p>
<ul>
<li>连接各种 MCP 服务器</li>
<li>扩展 AI 代理的能力</li>
<li>与现有工具链集成</li>
</ul>
</li>
</ol>
<h3 data-id="heading-10">快速开始</h3>
<h4 data-id="heading-11">安装方式</h4>
<p>OpenWork 提供多种安装方式：</p>
<p><strong>方式一：下载预构建版本（推荐）</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># macOS 用户</span>
<span class="hljs-comment"># 访问 Releases 页面下载 DMG 文件</span>

<span class="hljs-comment"># 或访问官网下载</span>
<span class="hljs-comment"># https://github.com/different-ai/openwork/releases</span>
</code></pre>
<p><strong>方式二：从源码构建</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 克隆项目</span>
git <span class="hljs-built_in">clone</span> https://github.com/different-ai/openwork.git
<span class="hljs-built_in">cd</span> openwork

<span class="hljs-comment"># 2. 安装依赖</span>
pnpm install

<span class="hljs-comment"># 3. 启动开发服务器</span>
pnpm dev       <span class="hljs-comment"># 桌面应用</span>
pnpm dev:ui    <span class="hljs-comment"># 仅Web界面</span>
</code></pre>
<p><strong>系统要求</strong>：</p>
<ul>
<li>Node.js 18+</li>
<li>pnpm 包管理器</li>
<li>Rust（如果需要从源码构建 Tauri）</li>
<li>macOS / Windows / Linux</li>
</ul>
<h4 data-id="heading-12">基本使用</h4>
<p><strong>启动应用</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 开发模式</span>
pnpm dev

<span class="hljs-comment"># 生产构建</span>
pnpm build
</code></pre>
<p><strong>连接模式选择</strong>：</p>
<p>OpenWork 支持两种运行模式：</p>
<ol>
<li>
<p><strong>主机模式</strong>（Host Mode）</p>
<ul>
<li>在本地启动完整服务</li>
<li>适合个人使用或作为团队服务器</li>
</ul>
</li>
<li>
<p><strong>客户端模式</strong>（Client Mode）</p>
<ul>
<li>连接到远程 OpenWork 服务器</li>
<li>适合团队协作场景</li>
</ul>
</li>
</ol>
<h4 data-id="heading-13">常用操作示例</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启动桌面应用（开发模式）</span>
pnpm dev

<span class="hljs-comment"># 仅启动 Web 界面</span>
pnpm dev:ui

<span class="hljs-comment"># 构建桌面应用</span>
pnpm build

<span class="hljs-comment"># 使用 CLI 模式（openwrk）</span>
<span class="hljs-comment"># openwrk 提供纯命令行的主机模式</span>
</code></pre>
<h3 data-id="heading-14">核心特性</h3>
<p>OpenWork 的核心特性包括：</p>
<ol>
<li>
<p><strong>本地优先设计</strong></p>
<ul>
<li>在本地机器上一键运行</li>
<li>数据完全由用户掌控</li>
<li>无需云服务即可使用</li>
</ul>
</li>
<li>
<p><strong>可组合架构</strong></p>
<ul>
<li>桌面应用模式</li>
<li>聊天应用连接器（如 WhatsApp）</li>
<li>服务器模式</li>
</ul>
</li>
<li>
<p><strong>可"弹出"设计</strong></p>
<ul>
<li>由 OpenCode 驱动</li>
<li>甚至无需 UI 也能工作</li>
<li>支持 CLI 纯命令行操作</li>
</ul>
</li>
<li>
<p><strong>会话管理</strong></p>
<ul>
<li>创建和管理多个会话</li>
<li>实时发送提示</li>
<li>查看会话历史</li>
</ul>
</li>
<li>
<p><strong>SSE 事件流</strong></p>
<ul>
<li>订阅实时事件</li>
<li>跟踪执行进度</li>
<li>接收代理响应</li>
</ul>
</li>
<li>
<p><strong>执行计划时间线</strong></p>
<ul>
<li>可视化展示执行步骤</li>
<li>追踪代理行为</li>
<li>调试和分析</li>
</ul>
</li>
<li>
<p><strong>权限请求处理</strong></p>
<ul>
<li>代理权限请求弹窗</li>
<li>用户授权控制</li>
<li>安全执行保障</li>
</ul>
</li>
<li>
<p><strong>工作流模板</strong></p>
<ul>
<li>保存常用工作流</li>
<li>一键重复执行</li>
<li>团队共享模板</li>
</ul>
</li>
<li>
<p><strong>技能管理器</strong></p>
<ul>
<li>安装新技能</li>
<li>导入自定义技能</li>
<li>管理已安装技能</li>
</ul>
</li>
</ol>
<h3 data-id="heading-15">项目优势</h3>
<p>与其他 AI 工作台工具相比，OpenWork 的优势：</p>



























































<table><thead><tr><th align="left">对比项</th><th align="left">OpenWork</th><th align="left">Claude Cowork</th><th align="left">其他开源方案</th></tr></thead><tbody><tr><td align="left"><strong>开源程度</strong></td><td align="left">完全开源（MIT）</td><td align="left">闭源商业</td><td align="left">部分开源</td></tr><tr><td align="left"><strong>本地运行</strong></td><td align="left">原生支持</td><td align="left">云端为主</td><td align="left">部分支持</td></tr><tr><td align="left"><strong>MCP 支持</strong></td><td align="left">原生支持</td><td align="left">支持</td><td align="left">有限支持</td></tr><tr><td align="left"><strong>技能系统</strong></td><td align="left">完整</td><td align="left">完整</td><td align="left">简单</td></tr><tr><td align="left"><strong>跨平台</strong></td><td align="left">macOS/Win/Linux</td><td align="left">Web为主</td><td align="left">各异</td></tr><tr><td align="left"><strong>可组合性</strong></td><td align="left">高（多模态）</td><td align="left">中</td><td align="left">低</td></tr><tr><td align="left"><strong>定制能力</strong></td><td align="left">高（源码可改）</td><td align="left">低</td><td align="left">中</td></tr><tr><td align="left"><strong>价格</strong></td><td align="left">免费</td><td align="left">付费订阅</td><td align="left">免费/部分付费</td></tr></tbody></table>
<p><strong>为什么选择 OpenWork？</strong></p>
<ul>
<li>✅ <strong>完全开源</strong>：MIT 许可，自由使用和修改</li>
<li>✅ <strong>本地优先</strong>：数据隐私有保障</li>
<li>✅ <strong>MCP 原生</strong>：完整的协议支持</li>
<li>✅ <strong>多模态支持</strong>：桌面、Web、CLI 随心选择</li>
<li>✅ <strong>技能生态</strong>：丰富的技能管理能力</li>
<li>✅ <strong>社区活跃</strong>：9.2k+ Stars，持续更新</li>
</ul>
<hr/>
<h2 data-id="heading-16">项目详细剖析</h2>
<h3 data-id="heading-17">架构设计</h3>
<p>OpenWork 采用 Tauri + React 架构，实现跨平台桌面应用：</p>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────────────────────────────────────┐
│                    USER INTERFACE                        │
│  🖥️ Desktop App (Tauri Window)                          │
│  🌐 Web UI (React)                                      │
│  💬 Chat Connectors (WhatsApp, etc.)                   │
└─────────────────────────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────┐
│               APPLICATION LAYER                          │
│  📝 Session Management                                  │
│  🔧 Skill Manager                                       │
│  📊 Execution Timeline                                  │
│  🔐 Permission Handler                                  │
└─────────────────────────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────┐
│                 CORE ENGINE                              │
│  ⚙️ OpenCode CLI Integration                            │
│  📡 SSE Event Stream                                    │
│  🔌 MCP Protocol Handler                                │
└─────────────────────────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────┐
│              RUNTIME LAYER                               │
│  🦀 Rust/Tauri (Desktop Runtime)                        │
│  📦 Node<span class="hljs-selector-class">.js</span> (Server Runtime)                            │
└─────────────────────────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────┐
│                  INTEGRATIONS                            │
│  🤖 AI Providers (Claude, OpenAI, etc.)                │
│  🔌 MCP Servers                                         │
│  📁 Local File System                                   │
└─────────────────────────────────────────────────────────┘
</code></pre>
<p><strong>核心组件</strong>：</p>
<ol>
<li><strong>用户界面层</strong>：Tauri 桌面窗口 + React Web UI</li>
<li><strong>应用层</strong>：会话管理、技能管理、执行时间线、权限处理</li>
<li><strong>核心引擎</strong>：OpenCode CLI 集成、SSE 事件流、MCP 协议处理</li>
<li><strong>运行时层</strong>：Rust/Tauri（桌面）+ Node.js（服务器）</li>
<li><strong>集成层</strong>：AI 提供商、MCP 服务器、本地文件系统</li>
</ol>
<h3 data-id="heading-18">核心模块分析</h3>
<h4 data-id="heading-19">1. OpenCode 集成</h4>
<p>OpenWork 由 OpenCode CLI 驱动，提供核心 AI 代理能力：</p>
<p><strong>功能</strong>：</p>
<ul>
<li>执行 AI 代理任务</li>
<li>管理代理生命周期</li>
<li>处理代理输入输出</li>
</ul>
<p><strong>特点</strong>：</p>
<ul>
<li>可以脱离 UI 独立运行</li>
<li>支持命令行直接调用</li>
<li>提供完整的代理能力</li>
</ul>
<h4 data-id="heading-20">2. 技能管理器（Skill Manager）</h4>
<p>OpenWork 提供完整的技能管理功能：</p>
<p><strong>功能</strong>：</p>
<ul>
<li>浏览和安装新技能</li>
<li>导入自定义技能</li>
<li>管理已安装技能</li>
<li>启用/禁用技能</li>
</ul>
<p><strong>技能类型</strong>：</p>
<ul>
<li>代码生成技能</li>
<li>文件操作技能</li>
<li>数据处理技能</li>
<li>自定义扩展技能</li>
</ul>
<h4 data-id="heading-21">3. 会话管理（Session Management）</h4>
<p><strong>功能</strong>：</p>
<ul>
<li>创建新会话</li>
<li>管理多个并行会话</li>
<li>实时发送提示</li>
<li>查看会话历史</li>
</ul>
<p><strong>实现方式</strong>：</p>
<ul>
<li>每个会话独立运行</li>
<li>支持会话间切换</li>
<li>保存会话状态</li>
</ul>
<h4 data-id="heading-22">4. MCP 协议支持</h4>
<p>OpenWork 原生支持 Model Context Protocol：</p>
<p><strong>功能</strong>：</p>
<ul>
<li>连接 MCP 服务器</li>
<li>调用 MCP 工具</li>
<li>管理 MCP 资源</li>
</ul>
<p><strong>应用场景</strong>：</p>
<ul>
<li>扩展 AI 代理能力</li>
<li>集成外部工具</li>
<li>访问外部数据源</li>
</ul>
<h4 data-id="heading-23">5. SSE 事件流</h4>
<p><strong>功能</strong>：</p>
<ul>
<li>实时订阅执行事件</li>
<li>跟踪代理执行进度</li>
<li>接收代理响应</li>
</ul>
<p><strong>实现方式</strong>：</p>
<ul>
<li>Server-Sent Events 协议</li>
<li>实时推送更新</li>
<li>低延迟响应</li>
</ul>
<h3 data-id="heading-24">技术栈详解</h3>
<p>OpenWork 使用现代化的技术栈：</p>
<p><strong>前端/界面</strong>：</p>
<ul>
<li><strong>TypeScript</strong> (72.1%)：主要编程语言</li>
<li><strong>React</strong>：UI 框架</li>
<li><strong>JavaScript</strong> (12.9%)：辅助脚本</li>
</ul>
<p><strong>桌面运行时</strong>：</p>
<ul>
<li><strong>Tauri</strong>：跨平台桌面框架</li>
<li><strong>Rust</strong> (9.1%)：Tauri 核心运行时</li>
</ul>
<p><strong>构建工具</strong>：</p>
<ul>
<li><strong>pnpm</strong>：包管理和工作区管理</li>
<li><strong>Node.js</strong>：JavaScript 运行时</li>
</ul>
<p><strong>为什么选择这个技术栈？</strong></p>





























<table><thead><tr><th align="left">技术</th><th align="left">选择理由</th></tr></thead><tbody><tr><td align="left">Tauri</td><td align="left">比 Electron 更轻量，安全性更好</td></tr><tr><td align="left">TypeScript</td><td align="left">类型安全，开发体验好</td></tr><tr><td align="left">React</td><td align="left">成熟的生态，组件化开发</td></tr><tr><td align="left">Rust</td><td align="left">高性能，内存安全</td></tr><tr><td align="left">pnpm</td><td align="left">高效的包管理，支持 monorepo</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-25">实际使用案例</h2>
<h3 data-id="heading-26">案例1：本地开发环境</h3>
<p><strong>场景</strong>：在本地搭建 AI 辅助开发环境。</p>
<p><strong>实现步骤</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 克隆并启动 OpenWork</span>
git <span class="hljs-built_in">clone</span> https://github.com/different-ai/openwork.git
<span class="hljs-built_in">cd</span> openwork
pnpm install
pnpm dev

<span class="hljs-comment"># 2. 在桌面应用中创建新会话</span>

<span class="hljs-comment"># 3. 安装需要的技能（如代码生成技能）</span>

<span class="hljs-comment"># 4. 开始与 AI 代理交互</span>
</code></pre>
<p><strong>效果</strong>：在本地拥有完整的 AI 代理工作台，无需云服务，数据完全本地化。</p>
<h3 data-id="heading-27">案例2：团队共享服务器</h3>
<p><strong>场景</strong>：为团队搭建共享的 AI 代理服务器。</p>
<p><strong>实现步骤</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 在服务器上启动 OpenWork（主机模式）</span>
pnpm dev:ui  <span class="hljs-comment"># 或使用 openwrk CLI</span>

<span class="hljs-comment"># 2. 团队成员使用客户端模式连接</span>
<span class="hljs-comment"># 在 OpenWork 中选择"Client Mode"</span>
<span class="hljs-comment"># 输入服务器地址连接</span>

<span class="hljs-comment"># 3. 共享技能和工作流模板</span>

<span class="hljs-comment"># 4. 团队成员可以协作使用相同的 AI 代理</span>
</code></pre>
<p><strong>效果</strong>：团队共享 AI 代理资源，统一管理技能和工作流，提高协作效率。</p>
<h3 data-id="heading-28">案例3：MCP 集成工作流</h3>
<p><strong>场景</strong>：通过 MCP 协议扩展 AI 代理能力。</p>
<p><strong>实现步骤</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 启动 OpenWork</span>

<span class="hljs-comment"># 2. 配置 MCP 服务器连接</span>
<span class="hljs-comment"># 在设置中添加 MCP 服务器地址</span>

<span class="hljs-comment"># 3. AI 代理自动获得 MCP 工具能力</span>

<span class="hljs-comment"># 4. 在会话中使用 MCP 提供的工具</span>
</code></pre>
<p><strong>效果</strong>：AI 代理能力大幅扩展，可以访问数据库、文件系统、外部 API 等。</p>
<h3 data-id="heading-29">案例4：自动化工作流</h3>
<p><strong>场景</strong>：创建自动化工作流处理重复性任务。</p>
<p><strong>实现步骤</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 在 OpenWork 中创建会话</span>

<span class="hljs-comment"># 2. 执行一系列操作完成任务</span>

<span class="hljs-comment"># 3. 将工作流保存为模板</span>

<span class="hljs-comment"># 4. 后续一键执行相同工作流</span>
</code></pre>
<p><strong>效果</strong>：重复性任务自动化执行，节省时间和精力。</p>
<hr/>
<h2 data-id="heading-30">项目地址与资源</h2>
<h3 data-id="heading-31">官方资源</h3>
<ul>
<li>🌟 <strong>GitHub</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdifferent-ai%2Fopenwork" target="_blank" title="https://github.com/different-ai/openwork" ref="nofollow noopener noreferrer">github.com/different-a…</a></li>
<li>📦 <strong>Releases</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdifferent-ai%2Fopenwork%2Freleases" target="_blank" title="https://github.com/different-ai/openwork/releases" ref="nofollow noopener noreferrer">下载页面</a></li>
</ul>
<h3 data-id="heading-32">相关项目</h3>
<ul>
<li><strong>OpenCode</strong>: OpenWork 的核心引擎</li>
<li><strong>Owpenbot</strong>: WhatsApp 集成</li>
<li><strong>Openwrk</strong>: CLI 主机模式</li>
</ul>
<hr/>
<h2 data-id="heading-33">适用人群</h2>
<p>OpenWork 适合以下人群：</p>
<h3 data-id="heading-34">1. 开发者</h3>
<ul>
<li>✅ 需要本地 AI 代理环境的开发者</li>
<li>✅ 对 Claude Cowork 感兴趣但不想付费的用户</li>
<li>✅ 需要定制化 AI 工作流的技术人员</li>
</ul>
<h3 data-id="heading-35">2. 团队用户</h3>
<ul>
<li>✅ 需要共享 AI 代理资源的团队</li>
<li>✅ 希望统一管理技能和工作流的组织</li>
<li>✅ 对数据隐私有要求的企业</li>
</ul>
<h3 data-id="heading-36">3. AI 爱好者</h3>
<ul>
<li>✅ 对 MCP 协议感兴趣</li>
<li>✅ 希望探索 AI 代理技术</li>
<li>✅ 喜欢尝试开源工具</li>
</ul>
<h3 data-id="heading-37">4. 隐私敏感用户</h3>
<ul>
<li>✅ 需要完全本地化运行</li>
<li>✅ 不希望数据上传云端</li>
<li>✅ 需要在离线环境使用</li>
</ul>
<hr/>
<h2 data-id="heading-38">总结</h2>
<p>OpenWork 是一个出色的开源 AI 代理工作台，它成功地将 Claude Cowork 的核心功能带入开源世界。通过"本地优先，云端就绪"的设计理念，它让用户可以完全掌控自己的 AI 工作流。</p>
<p><strong>项目亮点回顾</strong>：</p>
<ul>
<li>🖥️ <strong>开源替代品</strong>：Claude Cowork 的免费开源替代方案</li>
<li>🏠 <strong>本地优先</strong>：数据完全由用户掌控</li>
<li>🔌 <strong>MCP 协议支持</strong>：原生支持 Model Context Protocol</li>
<li>🧩 <strong>可组合架构</strong>：桌面应用、Web、CLI 多模态支持</li>
<li>⚡ <strong>技能管理器</strong>：完整的技能安装和管理功能</li>
<li>🌐 <strong>跨平台</strong>：基于 Tauri 支持多平台</li>
<li>🔓 <strong>可"弹出"</strong>：甚至无需 UI 也能通过命令行工作</li>
</ul>
<p><strong>适用场景</strong>：</p>
<ul>
<li>本地 AI 代理开发环境</li>
<li>团队共享 AI 工作台</li>
<li>MCP 协议集成工作流</li>
<li>自动化任务处理</li>
<li>隐私敏感的 AI 应用</li>
</ul>
<hr/>
<p><em>欢迎来我中的<a href="https://link.juejin.cn?target=https%3A%2F%2Fhome.wonlab.top" target="_blank" title="https://home.wonlab.top" ref="nofollow noopener noreferrer">个人主页</a>找到更多有用的知识和有趣的产品</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>