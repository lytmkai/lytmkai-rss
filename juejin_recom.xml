<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[å‘Šåˆ«ç¹ç XMLï¼šç”¨ mybatis-dynamic å®ç°åŠ¨æ€æ•°æ®å»ºæ¨¡]]></title>    <link>https://juejin.cn/post/7603653885601759282</link>    <guid>https://juejin.cn/post/7603653885601759282</guid>    <pubDate>2026-02-07T08:01:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603653885601759282" data-draft-id="7603649945977241619" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‘Šåˆ«ç¹ç XMLï¼šç”¨ mybatis-dynamic å®ç°åŠ¨æ€æ•°æ®å»ºæ¨¡&#10;&#10;"/> <meta itemprop="keywords" content="MyBatis"/> <meta itemprop="datePublished" content="2026-02-07T08:01:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·959240767618"/> <meta itemprop="url" content="https://juejin.cn/user/4373206256326539"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‘Šåˆ«ç¹ç XMLï¼šç”¨ mybatis-dynamic å®ç°åŠ¨æ€æ•°æ®å»ºæ¨¡


            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4373206256326539/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·959240767618
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T08:01:16.000Z" title="Sat Feb 07 2026 08:01:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>ä½œä¸º Java å¼€å‘è€…ï¼Œä½ ä¸€å®šç»å†è¿‡è¿™æ ·çš„åœºæ™¯ï¼š</p>
<ul>
<li>äº§å“è¯´"åŠ ä¸ªå­—æ®µ"ï¼Œä½ è¦æ”¹å®ä½“ç±»ã€æ”¹ Mapper XMLã€å†™ migration è„šæœ¬ã€é‡æ–°éƒ¨ç½²...</li>
<li>æƒ³å¿«é€Ÿæ­ä¸ªåŸå‹éªŒè¯æƒ³æ³•ï¼Œå´è¢« ORM é…ç½®è€—å»åŠå¤©</li>
<li>åšä½ä»£ç å¹³å°ï¼Œç”¨æˆ·è¦åŠ¨æ€å»ºè¡¨ï¼Œä¼ ç»Ÿ ORM ç›´æ¥"æŠ•é™"</li>
</ul>
<p>MyBatis çµæ´»ï¼Œä½† XML é…ç½®ç¹çï¼›JPA è‡ªåŠ¨åŒ–ï¼Œä½†ä¸å¤Ÿçµæ´»ã€‚æœ‰æ²¡æœ‰ä¸€ç§æ–¹æ¡ˆï¼Œæ—¢èƒ½äº«å—"ä»£ç å³æ¨¡å‹"çš„ä¾¿åˆ©ï¼Œåˆä¿ç•™ MyBatis çš„çµæ´»æ€§ï¼Ÿ</p>
<p><strong>mybatis-dynamic</strong> å°±æ˜¯è¿™æ ·ä¸€ä¸ªå°è¯•â€”â€”åŸºäº MyBatis æ„å»ºçš„åŠ¨æ€ ORM æ¡†æ¶ï¼Œè®©ä½ ç”¨ Java ä»£ç å®šä¹‰æ•°æ®æ¨¡å‹ï¼Œæ¡†æ¶è‡ªåŠ¨å¤„ç†å»ºè¡¨ã€æ”¹è¡¨ã€æŸ¥è¯¢ï¼Œç”šè‡³ç›´æ¥æš´éœ² REST APIã€‚</p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€mybatis-dynamic æ˜¯ä»€ä¹ˆ</h2>
<p>mybatis-dynamic çš„æ ¸å¿ƒç†å¿µæ˜¯ <strong>"æ¨¡å‹å³çœŸç›¸"ï¼ˆModel as Truthï¼‰</strong>ï¼š</p>
<ul>
<li>ä½ ç”¨ Java ç±»å®šä¹‰æ•°æ®æ¨¡å‹</li>
<li>æ¡†æ¶è‡ªåŠ¨ç”Ÿæˆå’Œç»´æŠ¤æ•°æ®åº“è¡¨ç»“æ„</li>
<li>è¿è¡Œæ—¶å¯ä»¥åŠ¨æ€ä¿®æ”¹æ¨¡å‹</li>
<li>å†…ç½® Fluent APIï¼Œå‘Šåˆ« XML å’Œå­—ç¬¦ä¸²æ‹¼æ¥</li>
</ul>
<p>å®ƒä¸æ˜¯è¦å–ä»£ MyBatisï¼Œè€Œæ˜¯åœ¨ MyBatis ä¹‹ä¸Šæä¾›ä¸€å±‚åŠ¨æ€èƒ½åŠ›ã€‚é€‚åˆå¿«é€ŸåŸå‹ã€åŠ¨æ€ä¸šåŠ¡ã€ä½ä»£ç å¹³å°ç­‰åœºæ™¯ã€‚</p>
<p><strong>é¡¹ç›®ç»“æ„ï¼š</strong></p>
<pre><code class="hljs language-csharp" lang="csharp">mybatis-<span class="hljs-built_in">dynamic</span>
â”œâ”€â”€ core      <span class="hljs-meta"># æ ¸å¿ƒå¼•æ“ï¼Œå¯ç‹¬ç«‹ä½¿ç”¨</span>
â”œâ”€â”€ spring    <span class="hljs-meta"># Spring Boot Starter</span>
â”œâ”€â”€ draw      <span class="hljs-meta"># å¯è§†åŒ–æ¨¡å—</span>
â””â”€â”€ sample    <span class="hljs-meta"># ç¤ºä¾‹é¡¹ç›®</span>
</code></pre>
<hr/>
<h2 data-id="heading-2">äºŒã€5 åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹</h2>
<h3 data-id="heading-3">2.1 æ·»åŠ ä¾èµ–</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.github.myacelw<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-dynamic-spring<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.1.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-comment">&lt;!-- æ•°æ®åº“é©±åŠ¨ï¼Œä»¥ H2 ä¸ºä¾‹ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.h2database<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>h2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 data-id="heading-4">2.2 é…ç½®</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">org.h2.Driver</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:h2:./test;MODE=MySQL</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">sa</span>
    <span class="hljs-attr">password:</span>

<span class="hljs-attr">mybatis-dynamic:</span>
  <span class="hljs-attr">update-model:</span> <span class="hljs-literal">true</span>   <span class="hljs-comment"># å¯åŠ¨æ—¶è‡ªåŠ¨åŒæ­¥è¡¨ç»“æ„</span>
  <span class="hljs-attr">table-prefix:</span> <span class="hljs-string">t_</span>     <span class="hljs-comment"># è¡¨åå‰ç¼€</span>
</code></pre>
<h3 data-id="heading-5">2.3 å®šä¹‰æ¨¡å‹</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Data</span>
<span class="hljs-meta">@FieldNameConstants</span>
<span class="hljs-meta">@Model(comment = "ç”¨æˆ·è¡¨")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {

    <span class="hljs-meta">@IdField</span>
    <span class="hljs-keyword">private</span> Integer id;

    <span class="hljs-meta">@BasicField(ddlComment = "ç”¨æˆ·å", ddlNotNull = true)</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@BasicField(ddlComment = "å¹´é¾„")</span>
    <span class="hljs-keyword">private</span> Integer age;
}
</code></pre>
<h3 data-id="heading-6">2.4 å¯ç”¨æ‰«æ</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@EnableModelScan(basePackages = "com.example.demo.model")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Application</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        SpringApplication.run(Application.class, args);
    }
}
</code></pre>
<h3 data-id="heading-7">2.5 ç›´æ¥ä½¿ç”¨</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/users")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> BaseService&lt;Integer, User&gt; userService;

    <span class="hljs-meta">@PostMapping</span>
    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">create</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> User user)</span> {
        <span class="hljs-keyword">return</span> userService.insert(user);
    }

    <span class="hljs-meta">@GetMapping</span>
    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">list</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> userService.query()
                .where(c -&gt; c.gt(User.Fields.age, <span class="hljs-number">18</span>))
                .exec();
    }
}
</code></pre>
<p><strong>æ³¨æ„åˆ°äº†å—ï¼Ÿ</strong></p>
<ul>
<li>æ²¡æœ‰ Mapper XML</li>
<li>æ²¡æœ‰æ‰‹å†™ DDL</li>
<li>æ²¡æœ‰ <code>@Repository</code></li>
<li><code>BaseService</code> è‡ªåŠ¨æ³¨å…¥</li>
</ul>
<p>å¯åŠ¨åº”ç”¨ï¼Œè¡¨è‡ªåŠ¨åˆ›å»ºï¼Œæ¥å£ç›´æ¥å¯ç”¨ã€‚</p>
<hr/>
<h2 data-id="heading-8">ä¸‰ã€æ ¸å¿ƒç‰¹æ€§è§£æ</h2>
<h3 data-id="heading-9">3.1 åŠ¨æ€ DDLï¼šæ¨¡å‹å˜äº†ï¼Œè¡¨è·Ÿç€å˜</h3>
<p>è¿™æ˜¯ mybatis-dynamic æœ€æ ¸å¿ƒçš„èƒ½åŠ›ã€‚è®¾ç½® <code>update-model: true</code> åï¼š</p>
<ul>
<li><strong>åŠ å­—æ®µ</strong>ï¼šåœ¨ Java ç±»é‡ŒåŠ ä¸ªå±æ€§ï¼Œé‡å¯ï¼Œæ•°æ®åº“è‡ªåŠ¨åŠ åˆ—</li>
<li><strong>åŠ ç´¢å¼•</strong>ï¼šæ³¨è§£é‡ŒåŠ  <code>ddlIndex = true</code>ï¼Œé‡å¯ï¼Œç´¢å¼•è‡ªåŠ¨åˆ›å»º</li>
<li><strong>æ”¹æ³¨é‡Š</strong>ï¼šä¿®æ”¹ <code>ddlComment</code>ï¼Œé‡å¯ï¼Œå­—æ®µæ³¨é‡ŠåŒæ­¥æ›´æ–°</li>
</ul>
<p>å¯¹æ¯”ä¼ ç»Ÿæ–¹å¼ï¼š</p>

























<table><thead><tr><th>æ“ä½œ</th><th>ä¼ ç»Ÿæ–¹å¼</th><th>mybatis-dynamic</th></tr></thead><tbody><tr><td>åŠ å­—æ®µ</td><td>æ”¹å®ä½“ â†’ å†™ migration â†’ éƒ¨ç½²</td><td>æ”¹å®ä½“ â†’ é‡å¯</td></tr><tr><td>åŠ ç´¢å¼•</td><td>å†™ DDL è„šæœ¬ â†’ æ‰‹åŠ¨æ‰§è¡Œ</td><td>åŠ æ³¨è§£ â†’ é‡å¯</td></tr><tr><td>å¼€å‘ç¯å¢ƒåŒæ­¥</td><td>Flyway/Liquibase é…ç½®</td><td>å¼€ç®±å³ç”¨</td></tr></tbody></table>
<p>å½“ç„¶ï¼Œç”Ÿäº§ç¯å¢ƒä»å»ºè®®é…åˆæ•°æ®åº“ç‰ˆæœ¬ç®¡ç†å·¥å…·ä½¿ç”¨ï¼Œä½†å¼€å‘é˜¶æ®µçš„æ•ˆç‡æå‡æ˜¯å®æ‰“å®çš„ã€‚</p>
<h3 data-id="heading-10">3.2 Fluent Query APIï¼šå†™æŸ¥è¯¢åƒå†™è‹±è¯­</h3>
<p>å‘Šåˆ«å­—ç¬¦ä¸²æ‹¼ SQL çš„å™©æ¢¦ï¼š</p>
<pre><code class="hljs language-java" lang="java">userService.query()
    .select(<span class="hljs-string">"id"</span>, <span class="hljs-string">"name"</span>, <span class="hljs-string">"department.name"</span>)  <span class="hljs-comment">// è‡ªåŠ¨ JOIN</span>
    .where(c -&gt; c.eq(<span class="hljs-string">"status"</span>, <span class="hljs-number">1</span>)
                 .and(sub -&gt; sub.gt(<span class="hljs-string">"age"</span>, <span class="hljs-number">18</span>)
                                .or()
                                .eq(<span class="hljs-string">"vip"</span>, <span class="hljs-literal">true</span>)))
    .orderByDesc(<span class="hljs-string">"createdAt"</span>)
    .limit(<span class="hljs-number">10</span>)
    .exec();
</code></pre>
<p><strong>äº®ç‚¹ï¼š</strong></p>
<ul>
<li><strong>è‡ªåŠ¨å¤„ç†ä¼˜å…ˆçº§</strong>ï¼š<code>AND</code> ä¼˜å…ˆäº <code>OR</code>ï¼Œä¸ç”¨æ‰‹åŠ¨åŠ æ‹¬å·</li>
<li><strong>è‡ªåŠ¨ JOIN</strong>ï¼šé€‰æ‹©å…³è”å­—æ®µæ—¶è‡ªåŠ¨è§¦å‘ LEFT JOIN</li>
<li><strong>ç±»å‹å®‰å…¨</strong>ï¼šé…åˆ Lombok çš„ <code>@FieldNameConstants</code>ï¼Œå‘Šåˆ«é­”æ³•å­—ç¬¦ä¸²</li>
<li><strong>Optional æ¡ä»¶</strong>ï¼š<code>eqOptional("name", name)</code> å½“ name ä¸ºç©ºæ—¶è‡ªåŠ¨å¿½ç•¥</li>
</ul>
<h3 data-id="heading-11">3.3 å…³ç³»æ˜ å°„ï¼š@ToOne / @ToMany</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Model</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Order</span> {
    <span class="hljs-meta">@IdField</span>
    <span class="hljs-keyword">private</span> Integer id;
    
    <span class="hljs-comment">// éœ€è¦æ˜¾å¼å®šä¹‰å¤–é”®å­—æ®µ</span>
    <span class="hljs-meta">@BasicField</span>
    <span class="hljs-keyword">private</span> Integer userId;

    <span class="hljs-meta">@ToOne</span>
    <span class="hljs-keyword">private</span> User user;  <span class="hljs-comment">// è‡ªåŠ¨è¯†åˆ« userId ä½œä¸ºå¤–é”®</span>
    
    <span class="hljs-meta">@ToMany</span>
    <span class="hljs-keyword">private</span> List&lt;OrderItem&gt; items;  <span class="hljs-comment">// è‡ªåŠ¨è¯†åˆ« orderId</span>
}
</code></pre>
<p>æŸ¥è¯¢æ—¶è‡ªåŠ¨å¤„ç†å…³è”ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è‡ªåŠ¨å…³è”</span>
orderService.query()
    .select(<span class="hljs-string">"id"</span>, <span class="hljs-string">"user.name"</span>, <span class="hljs-string">"items.productName"</span>)
    .exec();

<span class="hljs-comment">// æ˜¾å¼å…³è” (v0.1.1+)</span>
orderService.query()
    .joins(
        Join.inner(<span class="hljs-string">"user"</span>)
            .on(c -&gt; c.eq(<span class="hljs-string">"active"</span>, <span class="hljs-literal">true</span>))
    )
    .exec();
</code></pre>
<p>è¿˜æ”¯æŒï¼š</p>
<ul>
<li>å¤šå¯¹å¤šï¼ˆé€šè¿‡ä¸­é—´è¡¨ï¼‰</li>
<li>é€’å½’å…³ç³»ï¼ˆæ ‘å½¢ç»“æ„ï¼‰</li>
<li>è‡ªå®šä¹‰ JOIN æ¡ä»¶</li>
</ul>
<h3 data-id="heading-12">3.4 é›¶ä»£ç  REST API</h3>
<p>å¯åŠ¨å³æ‹¥æœ‰å®Œæ•´ CRUD æ¥å£ï¼š</p>





























<table><thead><tr><th>ç«¯ç‚¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>GET /api/dynamic/{model}</code></td><td>åˆ†é¡µæŸ¥è¯¢ï¼Œæ”¯æŒ <code>?name=John&amp;page=1&amp;size=10</code></td></tr><tr><td><code>GET /api/dynamic/{model}/{id}</code></td><td>æŒ‰ ID æŸ¥è¯¢</td></tr><tr><td><code>POST /api/dynamic/{model}</code></td><td>æ–°å¢</td></tr><tr><td><code>PUT /api/dynamic/{model}</code></td><td>æ›´æ–°</td></tr><tr><td><code>DELETE /api/dynamic/{model}/{id}</code></td><td>åˆ é™¤</td></tr></tbody></table>
<p>é€‚åˆï¼š</p>
<ul>
<li>å¿«é€ŸåŸå‹éªŒè¯</li>
<li>ç®¡ç†åå°</li>
<li>ä½ä»£ç å¹³å°åç«¯</li>
</ul>
<p>ä¸éœ€è¦å¯ä»¥å…³é—­ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">mybatis-dynamic:</span>
  <span class="hljs-attr">rest:</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span>
</code></pre>
<h3 data-id="heading-13">3.5 è¿è¡Œæ—¶åŠ¨æ€æ‰©å±•å­—æ®µ</h3>
<p>è¿™æ˜¯æ€æ‰‹çº§ç‰¹æ€§ï¼Œè®©å®ä½“å®ç° <code>ExtBean</code> æ¥å£ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Model</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ExtBean</span> {
    <span class="hljs-meta">@IdField</span>
    <span class="hljs-keyword">private</span> String id;
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@IgnoreField</span>
    <span class="hljs-keyword">private</span> Map&lt;String, Object&gt; ext = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title function_">getExt</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> ext;
    }
}
</code></pre>
<p>ç„¶åå¯ä»¥åœ¨è¿è¡Œæ—¶æ·»åŠ å­—æ®µï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. è·å–æ¨¡å‹å®šä¹‰</span>
<span class="hljs-type">Model</span> <span class="hljs-variable">userModel</span> <span class="hljs-operator">=</span> modelService.getModelForClass(User.class);

<span class="hljs-comment">// 2. æ·»åŠ æ–°å­—æ®µ</span>
userModel.getFields().add(Field.string(<span class="hljs-string">"phone"</span>, <span class="hljs-number">100</span>));
modelService.updateAndRegister(userModel);  <span class="hljs-comment">// è‡ªåŠ¨æ‰§è¡Œ ALTER TABLE å¹¶æ³¨å†Œ</span>

<span class="hljs-comment">// 3. ä½¿ç”¨æ–°å­—æ®µ</span>
<span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
user.getExt().put(<span class="hljs-string">"phone"</span>, <span class="hljs-string">"13800138000"</span>);
userService.insert(user);

<span class="hljs-comment">// 4. æŸ¥è¯¢ä¹Ÿæ²¡é—®é¢˜</span>
List&lt;User&gt; users = userService.query()
    .where(c -&gt; c.eq(<span class="hljs-string">"phone"</span>, <span class="hljs-string">"13800138000"</span>))
    .exec();
</code></pre>
<p>è¿™å¯¹ SaaS å¤šç§Ÿæˆ·ã€åŠ¨æ€è¡¨å•ç­‰åœºæ™¯æ˜¯æ•‘å‘½ç¨»è‰ã€‚</p>
<h3 data-id="heading-14">3.6 å¯è§†åŒ–æ¨¡å‹è®¾è®¡ (Draw)</h3>
<p>ä¸ä»…æ˜¯ä»£ç ï¼Œmybatis-dynamic è¿˜å†…ç½®äº† <strong>Draw</strong> æ¨¡å—ï¼Œèƒ½å®æ—¶å°†ä½ çš„ Java æ¨¡å‹ä»£ç æ¸²æŸ“ä¸ºäº¤äº’å¼ ER å›¾ã€‚</p>
<p><strong>ä¾èµ–å¼•å…¥ï¼š</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.github.myacelw<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-dynamic-draw<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.1.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>å¯åŠ¨åº”ç”¨åè®¿é—® <code>/draw/index.html</code>ï¼Œå³å¯çœ‹åˆ°å½“å‰ç³»ç»Ÿçš„å…¨é‡æ•°æ®æ¨¡å‹å…³ç³»å›¾ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb54e27ca1e047c3919cdf7837fac7eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTU5MjQwNzY3NjE4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771056077&amp;x-signature=jV%2F8eU7nNWyi00oFd0iyKKvdSZI%3D" alt="draw-preview.png" loading="lazy"/></p>
<p>è¿™å¯¹æ¢³ç†å¤æ‚ä¸šåŠ¡å…³ç³»ã€ç”Ÿæˆè®¾è®¡æ–‡æ¡£éå¸¸æœ‰å¸®åŠ©ï¼Œä¸”å®Œå…¨æ— éœ€é¢å¤–ç»´æŠ¤ï¼Œä»£ç å³å›¾è¡¨ã€‚</p>
<h3 data-id="heading-15">3.7 ä¼ä¸šçº§æƒé™æ§åˆ¶ (Row/Column Level Security)</h3>
<p>åœ¨ B ç«¯ç³»ç»Ÿä¸­ï¼Œæ•°æ®æƒé™å¾€å¾€æ¯”åŠŸèƒ½æƒé™æ›´å¤æ‚ã€‚mybatis-dynamic å†…ç½®äº†<strong>è¡Œçº§</strong>å’Œ<strong>åˆ—çº§</strong>æƒé™æ§åˆ¶æ¥å£ï¼Œä¸”å¯¹ä¸šåŠ¡ä»£ç å®Œå…¨é€æ˜ã€‚</p>
<p>åªéœ€å®ç° <code>PermissionGetter</code> æ¥å£å¹¶æ³¨å…¥ Spring å®¹å™¨ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyPermissionGetter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PermissionGetter</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Permission <span class="hljs-title function_">getPermission</span><span class="hljs-params">(Model model)</span> {
        <span class="hljs-comment">// 1. åˆ—æƒé™ï¼šåªå…è®¸æŸ¥çœ‹éƒ¨åˆ†å­—æ®µ (e.g. éšè—æ‰‹æœºå·ã€è–ªèµ„)</span>
        List&lt;String&gt; allowedFields = Arrays.asList(<span class="hljs-string">"id"</span>, <span class="hljs-string">"name"</span>, <span class="hljs-string">"department"</span>);
        
        <span class="hljs-comment">// 2. è¡Œæƒé™ï¼šåªèƒ½æŸ¥çœ‹è‡ªå·±éƒ¨é—¨çš„æ•°æ®</span>
        <span class="hljs-type">Condition</span> <span class="hljs-variable">dataScope</span> <span class="hljs-operator">=</span> Condition.builder()
                .eq(<span class="hljs-string">"department_id"</span>, CurrentUser.getDeptId())
                .build();
                
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Permission</span>(allowedFields, dataScope);
    }
}
</code></pre>
<p>é…ç½®ç”Ÿæ•ˆåï¼š</p>
<ul>
<li><strong>æŸ¥è¯¢æ—¶</strong>ï¼šè‡ªåŠ¨åœ¨ SQL ä¸­æ³¨å…¥ <code>AND department_id = ?</code> æ¡ä»¶ï¼Œä¸” <code>SELECT</code> å­å¥è‡ªåŠ¨è¿‡æ»¤æœªæˆæƒå­—æ®µã€‚</li>
<li><strong>æ›´æ–°æ—¶</strong>ï¼šåŒæ ·å—è¡Œçº§æƒé™çº¦æŸï¼Œé˜²æ­¢è¶Šæƒä¿®æ”¹ã€‚</li>
<li><strong>å‰ç«¯é€‚é…</strong>ï¼šAPI è¿”å›çš„æ•°æ®ç»“æ„ä¼šè‡ªåŠ¨å‰”é™¤æ— æƒé™å­—æ®µï¼Œå‰ç«¯æ— éœ€ç‰¹æ®Šå¤„ç†ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-16">å››ã€é€‚ç”¨åœºæ™¯ä¸è¾¹ç•Œ</h2>
<h3 data-id="heading-17">âœ… æ¨èåœºæ™¯</h3>
<ol>
<li><strong>å¿«é€ŸåŸå‹å¼€å‘</strong>ï¼šå‡ åˆ†é’Ÿæ­å»ºä¸€ä¸ªå¯ç”¨çš„åç«¯</li>
<li><strong>å†…éƒ¨ç®¡ç†ç³»ç»Ÿ</strong>ï¼šä¸éœ€è¦æè‡´æ€§èƒ½ï¼Œéœ€è¦å¿«é€Ÿè¿­ä»£</li>
<li><strong>ä½ä»£ç /åŠ¨æ€è¡¨å•å¹³å°</strong>ï¼šè¿è¡Œæ—¶æ‰©å±•å­—æ®µèƒ½åŠ›æ˜¯åˆšéœ€</li>
<li><strong>å¤šç§Ÿæˆ· SaaS</strong>ï¼šæ¯ä¸ªç§Ÿæˆ·å¯ä»¥æœ‰è‡ªå®šä¹‰å­—æ®µ</li>
</ol>
<h3 data-id="heading-18">âš ï¸ éœ€è¦æƒè¡¡</h3>
<ol>
<li><strong>è¶…é«˜å¹¶å‘æ ¸å¿ƒç³»ç»Ÿ</strong>ï¼šåŠ¨æ€èƒ½åŠ›æœ‰è¿è¡Œæ—¶å¼€é”€ï¼Œå»ºè®®é…åˆç¼“å­˜</li>
<li><strong>å·²æœ‰æˆç†Ÿ MyBatis é¡¹ç›®</strong>ï¼šè¿ç§»éœ€è¦è¯„ä¼°æˆæœ¬</li>
<li><strong>éœ€è¦æè‡´ SQL æ§åˆ¶</strong>ï¼šå¤æ‚æŠ¥è¡¨æŸ¥è¯¢å¯èƒ½è¿˜æ˜¯æ‰‹å†™ SQL æ›´åˆé€‚</li>
</ol>
<h3 data-id="heading-19">ä¸ MyBatis-Plus çš„å®šä½å·®å¼‚</h3>








































<table><thead><tr><th>ç»´åº¦</th><th>MyBatis-Plus</th><th>mybatis-dynamic</th></tr></thead><tbody><tr><td>å®šä½</td><td>MyBatis å¢å¼ºå·¥å…·</td><td>åŠ¨æ€ ORM æ¡†æ¶</td></tr><tr><td>åŠ¨æ€å»ºæ¨¡</td><td>âŒ</td><td>âœ…</td></tr><tr><td>è¿è¡Œæ—¶æ”¹è¡¨</td><td>âŒ</td><td>âœ…</td></tr><tr><td>é›¶ä»£ç  REST</td><td>âŒ</td><td>âœ…</td></tr><tr><td>ä»£ç ç”Ÿæˆ</td><td>âœ…ï¼ˆéœ€è¦å…ˆå»ºè¡¨ï¼‰</td><td>âŒï¼ˆä¸éœ€è¦ï¼‰</td></tr><tr><td>ç”Ÿæ€æˆç†Ÿåº¦</td><td>â­â­â­â­â­</td><td>â­â­ï¼ˆæˆé•¿ä¸­ï¼‰</td></tr></tbody></table>
<p>ä¸¤è€…ä¸æ˜¯æ›¿ä»£å…³ç³»ï¼Œè€Œæ˜¯äº’è¡¥ã€‚mybatis-dynamic é€‚åˆ"ä»ä»£ç åˆ°è¡¨"çš„åœºæ™¯ï¼ŒMyBatis-Plus é€‚åˆ"è¡¨å·²å­˜åœ¨"çš„åœºæ™¯ã€‚</p>
<hr/>
<h2 data-id="heading-20">äº”ã€æœªæ¥è§„åˆ’</h2>
<p>é¡¹ç›®è¿˜åœ¨ç§¯æè¿­ä»£ï¼Œè®¡åˆ’ä¸­çš„ç‰¹æ€§åŒ…æ‹¬ï¼š</p>
<ul>
<li>ğŸ”„ æä¾› Agent SKILL</li>
<li>ğŸ—„ï¸ æ›´å¤šæ•°æ®åº“æ–¹è¨€ï¼ˆç›®å‰å·²æ”¯æŒ MySQLã€PostgreSQLã€Oracleã€OceanBaseã€H2ï¼‰</li>
<li>ğŸ¨ å¯è§†åŒ–æ¨¡å‹è®¾è®¡å™¨</li>
<li>ğŸ”Œ ä¸ä¸»æµä½ä»£ç å¹³å°é›†æˆ</li>
</ul>
<hr/>
<h2 data-id="heading-21">ç»“è¯­</h2>
<p>mybatis-dynamic ä¸æ˜¯é“¶å¼¹ï¼Œå®ƒè§£å†³çš„æ˜¯ç‰¹å®šåœºæ™¯ä¸‹çš„ç‰¹å®šç—›ç‚¹ï¼š<strong>å½“ä½ éœ€è¦æ•°æ®æ¨¡å‹å…·å¤‡åŠ¨æ€èƒ½åŠ›æ—¶ï¼Œä¼ ç»Ÿ ORM çš„åƒµåŒ–å°±æˆäº†ç»Šè„šçŸ³</strong>ã€‚</p>
<p>å¦‚æœä½ æ­£åœ¨åšéœ€è¦åŠ¨æ€æ‰©å±•çš„ç³»ç»Ÿï¼Œæˆ–è€…åŒå€¦äº†æ¯æ¬¡åŠ å­—æ®µéƒ½è¦æ”¹ä¸€å †æ–‡ä»¶ï¼Œä¸å¦¨è¯•è¯•ã€‚é¡¹ç›®å¼€æºåœ¨ GitHubï¼Œæ¬¢è¿ Starã€Issue å’Œ PRï¼š</p>
<p>ğŸ‘‰ <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmyacelw%2Fmybatis-dynamic" target="_blank" title="https://github.com/myacelw/mybatis-dynamic" ref="nofollow noopener noreferrer">github.com/myacelw/mybâ€¦</a></strong></p>
<hr/>
<p><em>ä½œè€…ç®€ä»‹ï¼šåˆ˜ä¼Ÿï¼Œèµ„æ·± Java å¼€å‘è€…ï¼Œä¸“æ³¨äºä¼ä¸šçº§åº”ç”¨æ¶æ„ã€‚mybatis-dynamic é¡¹ç›®ä½œè€…ã€‚</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯æ¯›ç»ç’ƒç»„ä»¶çš„ä½ç½®/å°ºå¯¸åŠ¨æ€å˜åŒ–äº§ç”Ÿçš„é—ªçƒé—®é¢˜åŠè§£å†³æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7603563360330465322</link>    <guid>https://juejin.cn/post/7603563360330465322</guid>    <pubDate>2026-02-07T07:52:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603563360330465322" data-draft-id="7603561363572441151" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯æ¯›ç»ç’ƒç»„ä»¶çš„ä½ç½®/å°ºå¯¸åŠ¨æ€å˜åŒ–äº§ç”Ÿçš„é—ªçƒé—®é¢˜åŠè§£å†³æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-07T07:52:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‘æ˜æœˆ"/> <meta itemprop="url" content="https://juejin.cn/user/2928754707930126"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯æ¯›ç»ç’ƒç»„ä»¶çš„ä½ç½®/å°ºå¯¸åŠ¨æ€å˜åŒ–äº§ç”Ÿçš„é—ªçƒé—®é¢˜åŠè§£å†³æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2928754707930126/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‘æ˜æœˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T07:52:46.000Z" title="Sat Feb 07 2026 07:52:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>å½“ CSS <code>backdrop-filter</code> é‡ä¸ŠåŠ¨æ€å°ºå¯¸å˜åŒ–ï¼Œä¸€ä¸ªè‚‰çœ¼çœ‹ä¸è§çš„ Bug å¦‚ä½•åœ¨å½•å±æ—¶æš´éœ²æ— é—ï¼Ÿ</p>
</blockquote>
<h2 data-id="heading-0">å‰è¨€</h2>
<p>CSS <code>backdrop-filter</code> æ˜¯å®ç°æ¯›ç»ç’ƒï¼ˆFrosted Glassï¼‰æ•ˆæœçš„æ ‡å‡†æ–¹æ¡ˆï¼Œè¢«å¹¿æ³›åº”ç”¨äºæ¨¡æ€æ¡†ã€ä¾§è¾¹æ ã€å¡ç‰‡ç­‰ UI ç»„ä»¶ä¸­ã€‚å½“æ¯›ç»ç’ƒå…ƒç´ çš„å°ºå¯¸å›ºå®šæ—¶ï¼Œä¸€åˆ‡éƒ½å¾ˆç¾å¥½ã€‚ä½†å½“ä½ éœ€è¦è®©æ¯›ç»ç’ƒèƒŒæ™¯<strong>åŠ¨æ€å˜åŒ–å°ºå¯¸</strong>ï¼ˆæ¯”å¦‚éšç€å†…å®¹é«˜åº¦è‡ªåŠ¨å¢é•¿ï¼‰ï¼Œä¸€ä¸ªè¯¡å¼‚çš„é—®é¢˜å°±ä¼šå‡ºç°ï¼š</p>
<p><strong>æ­£å¸¸ä½¿ç”¨æ—¶çœ‹ç€è¿˜è¡Œï¼Œä½†ä¸€æ—¦ç”¨å½•å±è½¯ä»¶å½•åˆ¶GIFæˆ–è§†é¢‘ï¼Œå°±ä¼šå‡ºç°æ˜æ˜¾çš„é—ªçƒã€‚</strong></p>
<p>è¿™ç¯‡æ–‡ç« å°†æ·±å…¥åˆ†æè¿™ä¸ªé—®é¢˜çš„æ ¹æœ¬åŸå› ï¼Œä»¥åŠå¦‚ä½•ä¼˜é›…åœ°è§£å†³å®ƒã€‚</p>
<p><strong>ç›¸å…³é¡¹ç›®ï¼š</strong></p>
<ul>
<li>åœ¨çº¿åº”ç”¨æ¼”ç¤ºï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fai-island.boat2moon.com%2F" target="_blank" title="https://ai-island.boat2moon.com/" ref="nofollow noopener noreferrer">AI Island Demo</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.rumuai.top%2F" target="_blank" title="https://www.rumuai.top/" ref="nofollow noopener noreferrer">RumuAI</a></li>
<li>å¼€æºä»£ç ä»“åº“ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fboat2moon%2FRobotPrinter" target="_blank" title="https://github.com/boat2moon/RobotPrinter" ref="nofollow noopener noreferrer">GitHub - RobotPrinter</a></li>
</ul>
<hr/>
<h2 data-id="heading-1">é—®é¢˜æè¿°</h2>
<h3 data-id="heading-2">å…¸å‹åœºæ™¯</h3>
<p>å‡è®¾ä½ æœ‰ä¸€ä¸ªå¸¦æ¯›ç»ç’ƒæ•ˆæœçš„å®¹å™¨ï¼Œå®ƒçš„é«˜åº¦éœ€è¦æ ¹æ®å†…å®¹åŠ¨æ€å˜åŒ–ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.glass-container</span> {
  backdrop-<span class="hljs-attribute">filter</span>: <span class="hljs-built_in">blur</span>(<span class="hljs-number">20px</span>);
  -webkit-backdrop-<span class="hljs-attribute">filter</span>: <span class="hljs-built_in">blur</span>(<span class="hljs-number">20px</span>);
  <span class="hljs-attribute">height</span>: auto; <span class="hljs-comment">/* æˆ–è€…é€šè¿‡ JS åŠ¨æ€è®¾ç½® */</span>
  <span class="hljs-attribute">transition</span>: height <span class="hljs-number">0.1s</span>;
}
</code></pre>
<h3 data-id="heading-3">é—®é¢˜ç°è±¡</h3>
<p>æ­£å¸¸ä½¿ç”¨æ—¶çš„æ•ˆæœï¼Œå³ä½¿åŠ¨æ€æ”¹å˜è¯¥åŒºåŸŸçš„ä½ç½®å’Œå°ºå¯¸ï¼Œè‚‰çœ¼çœ‹èµ·æ¥ä¹Ÿæ¯”è¾ƒæµç•…ï¼Œæ¯›ç»ç’ƒèƒŒæ™¯éšå†…å®¹é«˜åº¦å˜åŒ–å¹³æ»‘è¿‡æ¸¡ã€‚ä½†å½“ä½¿ç”¨ ShareXã€OBSã€Loom æˆ–å…¶ä»–å½•å±è½¯ä»¶å½•åˆ¶æ—¶ï¼Œæ¯›ç»ç’ƒåŒºåŸŸåœ¨ä½ç½®æˆ–é«˜åº¦å˜åŒ–è¿‡ç¨‹ä¸­ä¼šå‡ºç°<strong>ä¸æ€ä¹ˆè§„å¾‹çš„é—ªçƒ</strong>ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31390d24271b4338a55a7d026ee4b854~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCR5piO5pyI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771055565&amp;x-signature=pSXYBB5njiEM8x0Xrfn9WsKIZNk%3D" alt="GIF1.gif" loading="lazy"/></p>
<p><strong>å…³é”®ç‰¹å¾ï¼š</strong></p>





























<table><thead><tr><th>ç‰¹å¾</th><th>æè¿°</th></tr></thead><tbody><tr><td>é—ªçƒè§„å¾‹</td><td>ä¸è§„å¾‹ï¼Œéå›ºå®šé¢‘ç‡</td></tr><tr><td>è‚‰çœ¼å¯è§æ€§</td><td>å®Œå…¨çœ‹ä¸è§ï¼ˆåˆ·æ–°ç‡å¤ªå¿«ï¼‰</td></tr><tr><td>æµè§ˆå™¨</td><td>Chromeã€Edge å‡å—å½±å“ï¼ˆChromium å†…æ ¸ï¼‰</td></tr><tr><td>è§¦å‘æ¡ä»¶</td><td>å…ƒç´ å°ºå¯¸å˜åŒ–æ—¶</td></tr><tr><td>å¯¹ç…§å®éªŒ</td><td>ç§»é™¤ <code>backdrop-filter</code> åé—®é¢˜æ¶ˆå¤±</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-4">æ ¹æœ¬åŸå› åˆ†æ</h2>
<h3 data-id="heading-5">backdrop-filter çš„å·¥ä½œåŸç†</h3>
<p><code>backdrop-filter</code> ä¸æ™®é€šçš„ <code>filter</code> ä¸åŒï¼Œå®ƒä¸æ˜¯å¯¹å…ƒç´ æœ¬èº«åº”ç”¨æ»¤é•œï¼Œè€Œæ˜¯å¯¹<strong>å…ƒç´ èƒŒåçš„å†…å®¹</strong>å®æ—¶é‡‡æ ·å¹¶åº”ç”¨æ»¤é•œã€‚</p>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         é¡µé¢èƒŒæ™¯å†…å®¹             â”‚
â”‚    (æ–‡å­—ã€å›¾ç‰‡ã€å…¶ä»–å…ƒç´ )         â”‚
â”‚                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚    â”‚  backdrop-<span class="hljs-attribute">filter</span>    â”‚      â”‚
â”‚    â”‚  <span class="hljs-built_in">blur</span>(<span class="hljs-number">20px</span>)         â”‚ â†â”€â”€ å®æ—¶é‡‡æ ·è¿™ä¸ªåŒºåŸŸèƒŒåçš„åƒç´ å¹¶æ¨¡ç³Š
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-6">å°ºå¯¸å˜åŒ–æ—¶å‘ç”Ÿäº†ä»€ä¹ˆ</h3>
<p>å½“å¸¦æœ‰ <code>backdrop-filter</code> çš„å…ƒç´ å°ºå¯¸æ”¹å˜æ—¶ï¼Œæµè§ˆå™¨éœ€è¦ï¼š</p>
<ol>
<li><strong>é‡æ–°è®¡ç®—é‡‡æ ·åŒºåŸŸ</strong> - å…ƒç´ å˜å¤§äº†ï¼Œéœ€è¦é‡‡æ ·æ›´å¤šåƒç´ </li>
<li><strong>é‡æ–°åº”ç”¨æ¨¡ç³Šæ»¤é•œ</strong> - å¯¹æ–°çš„é‡‡æ ·åŒºåŸŸé‡æ–°è®¡ç®—æ¨¡ç³Š</li>
<li><strong>åˆæˆæ¸²æŸ“ç»“æœ</strong> - å°†æ¨¡ç³Šåçš„ç»“æœä¸å…¶ä»–å›¾å±‚åˆæˆ</li>
</ol>
<p>è¿™ä¸ªè¿‡ç¨‹ä¼šäº§ç”Ÿ<strong>ä¸­é—´çŠ¶æ€</strong>â€”â€”å¯èƒ½æ˜¯è¿˜æ²¡æ¨¡ç³Šå®Œæˆçš„å¸§ï¼Œæˆ–è€…æ˜¯å°ºå¯¸è®¡ç®—è¿˜æ²¡åŒæ­¥çš„å¸§ã€‚</p>
<h3 data-id="heading-7">ä¸ºä»€ä¹ˆè‚‰çœ¼çœ‹ä¸è§ä½†å½•å±èƒ½æ•è·</h3>
<p>ç°ä»£æ˜¾ç¤ºå™¨åˆ·æ–°ç‡é€šå¸¸æ˜¯ 60Hz æˆ–æ›´é«˜ï¼Œäººçœ¼å¾ˆéš¾æ•æ‰åˆ°æŒç»­æ—¶é—´ä»…å‡ æ¯«ç§’çš„ä¸­é—´çŠ¶æ€ã€‚ä½†å½•å±è½¯ä»¶æ˜¯<strong>é€å¸§æ•è·</strong>çš„ï¼Œå®ƒä¼šå¿ å®åœ°è®°å½•æ¯ä¸€å¸§çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬é‚£äº›è½¬ç¬å³é€çš„å¼‚å¸¸å¸§ã€‚</p>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆï¼š</p>
<ul>
<li>âœ… è‚‰çœ¼çœ‹ï¼šå®Œç¾æµç•…</li>
<li>âŒ å½•å±çœ‹ï¼šæ˜æ˜¾é—ªçƒ</li>
</ul>
<hr/>
<h2 data-id="heading-8">å¤±è´¥çš„å°è¯•</h2>
<p>åœ¨æ‰¾åˆ°æ­£ç¡®æ–¹æ¡ˆä¹‹å‰ï¼Œæˆ‘å°è¯•äº†å¤šç§å¸¸è§çš„æ€§èƒ½ä¼˜åŒ–æ–¹æ³•ï¼Œä½†éƒ½å¤±è´¥äº†ã€‚è®°å½•è¿™äº›å¤±è´¥çš„å°è¯•åŒæ ·é‡è¦ã€‚</p>
<h3 data-id="heading-9">å°è¯• 1ï¼šCSS ç¡¬ä»¶åŠ é€Ÿ</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.glass-container</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateZ</span>(<span class="hljs-number">0</span>);
  <span class="hljs-attribute">will-change</span>: width, height, opacity;
  <span class="hljs-attribute">backface-visibility</span>: hidden;
}
</code></pre>
<p><strong>ç»“æœï¼šâŒ å¤±è´¥</strong> â€” ç¡¬ä»¶åŠ é€Ÿåªä¼˜åŒ–äº†åˆæˆé˜¶æ®µï¼Œä½† <code>backdrop-filter</code> çš„é‡‡æ ·å’Œæ¨¡ç³Šè®¡ç®—ä»ç„¶éœ€è¦æ‰§è¡Œã€‚</p>
<h3 data-id="heading-10">å°è¯• 2ï¼šä½¿ç”¨ requestAnimationFrame åŒæ­¥æ›´æ–°</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">updateHeight</span> = height =&gt; {
  <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
    element.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.round(height)}</span>px`</span>;
  });
};

<span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResizeObserver</span>(<span class="hljs-function"><span class="hljs-params">entries</span> =&gt;</span> {
  <span class="hljs-title function_">updateHeight</span>(entries[<span class="hljs-number">0</span>].<span class="hljs-property">contentRect</span>.<span class="hljs-property">height</span>);
});
</code></pre>
<p><strong>ç»“æœï¼šâŒ å¤±è´¥</strong> â€” rAF ç¡®ä¿äº†æ›´æ–°åœ¨æ­£ç¡®çš„æ—¶æœºå‘ç”Ÿï¼Œä½†æ— æ³•é˜»æ­¢ <code>backdrop-filter</code> æœ¬èº«çš„é‡è®¡ç®—ã€‚</p>
<h3 data-id="heading-11">å°è¯• 3ï¼šç»•è¿‡ React æ¸²æŸ“å‘¨æœŸ</h3>
<p>å¦‚æœæ˜¯ React é¡¹ç›®ï¼Œä½ å¯èƒ½ä¼šå°è¯•ç”¨ ref ç›´æ¥æ“ä½œ DOM æ¥é¿å…é‡æ¸²æŸ“ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç›´æ¥æ“ä½œ CSS å˜é‡ï¼Œä¸è§¦å‘ React é‡æ¸²æŸ“</span>
backdropRef.<span class="hljs-property">current</span>.<span class="hljs-property">style</span>.<span class="hljs-title function_">setProperty</span>(<span class="hljs-string">'--height'</span>, <span class="hljs-string">`<span class="hljs-subst">${height}</span>px`</span>);
</code></pre>
<p><strong>ç»“æœï¼šâŒ å¤±è´¥</strong> â€” é—®é¢˜ä¸åœ¨ Reactï¼Œè€Œåœ¨æµè§ˆå™¨çš„æ¸²æŸ“ç®¡çº¿ã€‚</p>
<hr/>
<h2 data-id="heading-12">è§£å†³æ–¹æ¡ˆï¼šåŒå±‚è£å‰ªç»“æ„</h2>
<h3 data-id="heading-13">æ ¸å¿ƒæ€æƒ³</h3>
<p>å”‰ï¼ŒæŠ˜è…¾åŠå¤©è¿˜å¾—æ˜¯æ›²çº¿æ•‘å›½â€”â€”æ—¢ç„¶é—®é¢˜æ˜¯ <code>backdrop-filter</code> å…ƒç´ <strong>å°ºå¯¸å˜åŒ–</strong>è§¦å‘äº†æ¨¡ç³Šé‡ç®—ï¼Œé‚£è§£å†³æ–¹æ¡ˆå°±æ˜¯ï¼š</p>
<blockquote>
<p><strong>è®©å¸¦æœ‰ <code>backdrop-filter</code> çš„å…ƒç´ æ°¸ä¸æ”¹å˜å°ºå¯¸ã€‚</strong></p>
</blockquote>
<h3 data-id="heading-14">å®ç°æ–¹å¼</h3>
<p>ä½¿ç”¨"å¤–å±‚è£å‰ªå®¹å™¨ + å†…å±‚å›ºå®šå°ºå¯¸"çš„åŒå±‚ç»“æ„ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- å¤–å±‚ï¼šè´Ÿè´£åŠ¨æ€å°ºå¯¸ï¼Œè®¾ç½® overflow: hidden è£å‰ª --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"glass-clipper"</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- å†…å±‚ï¼šå›ºå®šå¤§å°ºå¯¸ï¼Œåº”ç”¨ backdrop-filter --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"glass-inner"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h3 data-id="heading-15">CSS å®ç°</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* å¤–å±‚è£å‰ªå®¹å™¨ */</span>
<span class="hljs-selector-class">.glass-clipper</span> {
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">height</span>: <span class="hljs-built_in">var</span>(--dynamic-height, <span class="hljs-number">200px</span>); <span class="hljs-comment">/* åŠ¨æ€å˜åŒ– */</span>
  <span class="hljs-attribute">overflow</span>: hidden; <span class="hljs-comment">/* å…³é”®ï¼šè£å‰ªè¶…å‡ºéƒ¨åˆ† */</span>
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.3</span>);

  <span class="hljs-comment">/* âš ï¸ é‡è¦ï¼šä¸è¦ä½¿ç”¨ä»¥ä¸‹å±æ€§ */</span>
  <span class="hljs-comment">/* transform: translateZ(0); */</span>
  <span class="hljs-comment">/* will-change: ...; */</span>
}

<span class="hljs-comment">/* å†…å±‚æ¯›ç»ç’ƒ */</span>
<span class="hljs-selector-class">.glass-inner</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">1000px</span>; <span class="hljs-comment">/* å›ºå®šå¤§å°ºå¯¸ï¼Œè¦†ç›–æ‰€æœ‰å¯èƒ½çš„æ˜¾ç¤ºåŒºåŸŸ */</span>
  <span class="hljs-attribute">height</span>: <span class="hljs-number">1000px</span>;
  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>; <span class="hljs-comment">/* æ ¹æ®ä½ çš„å¸ƒå±€è°ƒæ•´é”šç‚¹ */</span>

  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.1</span>);
  backdrop-<span class="hljs-attribute">filter</span>: <span class="hljs-built_in">blur</span>(<span class="hljs-number">20px</span>) <span class="hljs-built_in">saturate</span>(<span class="hljs-number">180%</span>);
  -webkit-backdrop-<span class="hljs-attribute">filter</span>: <span class="hljs-built_in">blur</span>(<span class="hljs-number">20px</span>) <span class="hljs-built_in">saturate</span>(<span class="hljs-number">180%</span>);
}
</code></pre>
<h3 data-id="heading-16">å·¥ä½œåŸç†å›¾è§£</h3>
<pre><code class="hljs language-python" lang="python">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å¤–å±‚å®¹å™¨ (åŠ¨æ€é«˜åº¦)            â”‚
â”‚           overflow: hidden              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                 â”‚    â”‚
â”‚  â”‚         å¯è§åŒºåŸŸ                 â”‚    â”‚  â† ç”¨æˆ·çœ‹åˆ°çš„åŒºåŸŸ
â”‚  â”‚                                 â”‚    â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚   â”‚                          â”‚  â”‚    â”‚
â”‚  â”‚   â”‚    å†…å±‚ (1000x1000)      â”‚  â”‚    â”‚
â”‚  â”‚   â”‚    backdrop-<span class="hljs-built_in">filter</span>       â”‚  â”‚    â”‚
â”‚  â”‚   â”‚                          â”‚  â”‚    â”‚
â”‚  â””â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”˜    â”‚
â”‚      â”‚                          â”‚       â”‚
â”‚      â”‚   (è¢«è£å‰ªéšè—çš„éƒ¨åˆ†)      â”‚       â”‚
â”‚      â”‚                          â”‚       â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å½“é«˜åº¦å¢åŠ æ—¶ï¼š
âœ… å¤–å±‚å®¹å™¨é«˜åº¦å¢åŠ 
âœ… æ›´å¤šå†…å±‚åŒºåŸŸå˜å¾—å¯è§
âŒ å†…å±‚å°ºå¯¸ä¸å˜ â†’ backdrop-<span class="hljs-built_in">filter</span> ä¸é‡ç®—
</code></pre>
<hr/>
<h2 data-id="heading-17">é‡è¦æ³¨æ„äº‹é¡¹</h2>
<h3 data-id="heading-18">1. è¾¹æ¡†å¿…é¡»æ”¾åœ¨å¤–å±‚</h3>
<p>å¦‚æœæŠŠè¾¹æ¡†æ”¾åœ¨å†…å±‚ï¼Œä¼šå‡ºç°è¾¹æ¡†ä¸å®Œæ•´çš„é—®é¢˜ï¼ˆéƒ¨åˆ†è¾¹æ¡†è¢«è£æ‰ï¼‰ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">IMAGE_PLACEHOLDER: border-issue.png</span>]
å¤‡æ³¨ï¼šå¦‚æœè¾¹æ¡†æ”¾åœ¨å†…å±‚ï¼Œä¼šå‡ºç°ä¸Šä¸‹å·¦å³è¾¹æ¡†ä¸ä¸€è‡´çš„é—®é¢˜ã€‚
</code></pre>
<h3 data-id="heading-19">2. å¤–å±‚ä¸èƒ½ä½¿ç”¨ transform/will-change</h3>
<p>è¿™æ˜¯<strong>æœ€å®¹æ˜“è¸©çš„å‘</strong>ã€‚ä»¥ä¸‹å±æ€§ä¼šåˆ›å»ºéš”ç¦»çš„å±‚å ä¸Šä¸‹æ–‡ (Stacking Context)ï¼š</p>
<ul>
<li><code>transform: translateZ(0)</code> / <code>transform: translate3d(...)</code></li>
<li><code>will-change: transform</code> / <code>will-change: opacity</code> ç­‰</li>
<li><code>filter: ...</code></li>
<li><code>isolation: isolate</code></li>
</ul>
<p>å½“å¤–å±‚åˆ›å»ºäº†éš”ç¦»çš„å±‚å ä¸Šä¸‹æ–‡ï¼Œå†…å±‚çš„ <code>backdrop-filter</code> å°±åªèƒ½"çœ‹åˆ°"å¤–å±‚å®¹å™¨çš„èƒŒæ™¯ï¼Œè€Œçœ‹ä¸åˆ°é¡µé¢ä¸ŠçœŸæ­£çš„èƒŒæ™¯å†…å®¹ï¼Œ<strong>æ¯›ç»ç’ƒæ•ˆæœä¼šå®Œå…¨å¤±æ•ˆ</strong>ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58dd3f4a90134b29b33b16107c2d3a5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCR5piO5pyI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771055565&amp;x-signature=UG6YKyRjujL3pzOzGtlIZPHc%2FWg%3D" alt="chrome_RXSOrpd2Nl.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/255f8e7a46a8416594b3ae5b0219512f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCR5piO5pyI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771055565&amp;x-signature=C%2F19%2F%2FgW9dPETiNbUZf%2BJm4NMzk%3D" alt="chrome_R0yzXsL8ZM.png" loading="lazy"/></p>
<h3 data-id="heading-20">3. å†…å±‚å°ºå¯¸è¦è¶³å¤Ÿå¤§</h3>
<p>å†…å±‚çš„å›ºå®šå°ºå¯¸éœ€è¦è¦†ç›–å¤–å±‚å¯èƒ½è¾¾åˆ°çš„æœ€å¤§å°ºå¯¸ã€‚å¦‚æœå†…å±‚å¤ªå°ï¼Œå½“å¤–å±‚æ‰©å±•è¶…è¿‡å†…å±‚æ—¶ï¼Œä¼šå‡ºç°æ¯›ç»ç’ƒè¦†ç›–ä¸å…¨çš„é—®é¢˜ã€‚</p>
<h3 data-id="heading-21">4. é”šç‚¹ä½ç½®æ ¹æ®å¸ƒå±€è°ƒæ•´</h3>
<p>ç¤ºä¾‹ä¸­ä½¿ç”¨ <code>bottom: 0; right: 0;</code> å°†å†…å±‚é”šå®šåˆ°å³ä¸‹è§’ã€‚æ ¹æ®ä½ çš„å®é™…å¸ƒå±€ï¼Œå¯èƒ½éœ€è¦è°ƒæ•´ä¸ºï¼š</p>
<ul>
<li><code>top: 0; left: 0;</code> - é”šå®šå·¦ä¸Šè§’</li>
<li><code>top: 0; right: 0;</code> - é”šå®šå³ä¸Šè§’</li>
<li>ç­‰ç­‰</li>
</ul>
<hr/>
<h2 data-id="heading-22">æœ€ç»ˆæ•ˆæœ</h2>
<h2 data-id="heading-23"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d4f6c1059bd4eaea00352f5faa8ce8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCR5piO5pyI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771055565&amp;x-signature=hhe97n0jMHEixsv1n6lzjanHbZ8%3D" alt="GIF2.gif" loading="lazy"/></h2>
<h2 data-id="heading-24">æ€»ç»“</h2>
<h3 data-id="heading-25">é—®é¢˜æœ¬è´¨</h3>





















<table><thead><tr><th>é¡¹ç›®</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æ ¹æœ¬åŸå› </strong></td><td><code>backdrop-filter</code> åœ¨å…ƒç´ å°ºå¯¸å˜åŒ–æ—¶éœ€è¦é‡æ–°é‡‡æ ·å’Œè®¡ç®—æ¨¡ç³Š</td></tr><tr><td><strong>å¯è§æ€§</strong></td><td>ä¸­é—´çŠ¶æ€æŒç»­æ—¶é—´æçŸ­ï¼Œè‚‰çœ¼ä¸å¯è§ï¼Œä½†å½•å±å¯æ•è·</td></tr><tr><td><strong>å½±å“èŒƒå›´</strong></td><td>Chromium å†…æ ¸æµè§ˆå™¨ï¼ˆChromeã€Edgeã€Opera ç­‰ï¼‰</td></tr></tbody></table>
<h3 data-id="heading-26">è§£å†³æ–¹æ¡ˆ</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[å¤–å±‚å®¹å™¨ - åŠ¨æ€å°ºå¯¸, overflow:hidden]</span>
  â””â”€â”€ <span class="hljs-selector-attr">[å†…å±‚ - å›ºå®šå¤§å°ºå¯¸, backdrop-filter]</span>
</code></pre>
<h3 data-id="heading-27">è°ƒè¯• Checklist</h3>
<p>å¦‚æœä½ é‡åˆ°äº†ç±»ä¼¼é—®é¢˜ï¼ŒæŒ‰ä»¥ä¸‹æ­¥éª¤æ’æŸ¥ï¼š</p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <strong>ç¡®è®¤è§¦å‘æ¡ä»¶</strong>ï¼šä¸´æ—¶ç§»é™¤ <code>backdrop-filter</code>ï¼Œé—ªçƒæ˜¯å¦æ¶ˆå¤±ï¼Ÿ</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <strong>æ£€æŸ¥å°ºå¯¸å˜åŒ–</strong>ï¼šå…ƒç´ å°ºå¯¸æ˜¯å¦åœ¨åŠ¨æ€å˜åŒ–ï¼Ÿå¦‚æœå›ºå®šï¼Œå¯èƒ½æ˜¯å…¶ä»–é—®é¢˜</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <strong>æ£€æŸ¥å±‚å ä¸Šä¸‹æ–‡</strong>ï¼šå¤–å±‚æ˜¯å¦æœ‰ <code>transform</code>ã€<code>will-change</code>ã€<code>filter</code> ç­‰å±æ€§ï¼Ÿ</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <strong>å°è¯•åŒå±‚ç»“æ„</strong>ï¼šä½¿ç”¨æœ¬æ–‡çš„å¤–å±‚è£å‰ª + å†…å±‚å›ºå®šæ–¹æ¡ˆ</li>
</ul>
<h3 data-id="heading-28">é€‚ç”¨åœºæ™¯</h3>
<ul>
<li>âœ… é«˜åº¦/å®½åº¦åŠ¨æ€å˜åŒ–çš„æ¯›ç»ç’ƒå®¹å™¨</li>
<li>âœ… å†…å®¹é©±åŠ¨å°ºå¯¸çš„å¯¹è¯æ¡†ã€ä¾§è¾¹æ </li>
<li>âœ… å¸¦ <code>backdrop-filter</code> çš„å¯æŠ˜å /å±•å¼€ç»„ä»¶</li>
<li>âŒ å›ºå®šå°ºå¯¸å’Œä½ç½®çš„æ¯›ç»ç’ƒå…ƒç´ ï¼ˆä¸éœ€è¦æ­¤æ–¹æ¡ˆï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-29">å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FCSS%2Fbackdrop-filter" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/CSS/backdrop-filter" ref="nofollow noopener noreferrer">MDN - backdrop-filter</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcsstriggers.com%2F" target="_blank" title="https://csstriggers.com/" ref="nofollow noopener noreferrer">CSS Triggers - å“ªäº› CSS å±æ€§ä¼šè§¦å‘ layout/paint/composite</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FCSS%2FCSS_positioned_layout%2FUnderstanding_z-index%2FStacking_context" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_positioned_layout/Understanding_z-index/Stacking_context" ref="nofollow noopener noreferrer">Understanding CSS Stacking Context</a></li>
</ul>
<hr/>
<p><em>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿åˆ†äº«ç»™å…¶ä»–å¼€å‘è€…ï¼Œä¸€èµ·é¿å‘ï¼</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»åˆ›æ„åˆ°è§†è§‰ï¼šåŸºäº302.aiæ‰“é€ æ™ºèƒ½Logoç”Ÿæˆå™¨]]></title>    <link>https://juejin.cn/post/7603653885601792050</link>    <guid>https://juejin.cn/post/7603653885601792050</guid>    <pubDate>2026-02-07T08:15:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603653885601792050" data-draft-id="7603595309232750602" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" ä»åˆ›æ„åˆ°è§†è§‰ï¼šåŸºäº302.aiæ‰“é€ æ™ºèƒ½Logoç”Ÿæˆå™¨"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2026-02-07T08:15:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Leeå·"/> <meta itemprop="url" content="https://juejin.cn/user/2402874087453658"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             ä»åˆ›æ„åˆ°è§†è§‰ï¼šåŸºäº302.aiæ‰“é€ æ™ºèƒ½Logoç”Ÿæˆå™¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2402874087453658/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Leeå·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T08:15:59.000Z" title="Sat Feb 07 2026 08:15:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä»åˆ›æ„åˆ°è§†è§‰ï¼šåŸºäº302.aiæ‰“é€ æ™ºèƒ½Logoç”Ÿæˆå™¨</h2>
<p>åœ¨AIæµªæ½®å¸­å·è®¾è®¡é¢†åŸŸçš„ä»Šå¤©ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦ç­‰å¾…è®¾è®¡å¸ˆæ•°æ—¥çš„æ„æ€ä¸ä¿®æ”¹ã€‚å€ŸåŠ©å¤§è¯­è¨€æ¨¡å‹å’Œå›¾åƒç”ŸæˆæŠ€æœ¯ï¼Œä¸€ä¸ªç®€å•çš„è¡¨å•å°±èƒ½å°†æŠ½è±¡çš„æè¿°ç¬é—´è½¬åŒ–ä¸ºç²¾ç¾çš„è§†è§‰æ ‡è¯†ã€‚æœ¬æ–‡å°†æ·±å…¥è§£æä¸€ä¸ªåŸºäº302.aiå›¾åƒç”ŸæˆAPIçš„æ™ºèƒ½Logoç”Ÿæˆå™¨é¡¹ç›®ï¼Œæ¢è®¨å…¶ä»å‰ç«¯äº¤äº’åˆ°AIè°ƒç”¨çš„å®Œæ•´æŠ€æœ¯é“¾æ¡ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€é¡¹ç›®æ„æ€ï¼šå½“ç»å…¸è¡¨å•é‡è§AIé­”æ³•</h3>
<p>è¯¥é¡¹ç›®å·§å¦™åœ°å°†ä¼ ç»Ÿçš„Webè¡¨å•ä¸å‰æ²¿çš„AIGCæŠ€æœ¯ç›¸ç»“åˆã€‚æ ¸å¿ƒé€»è¾‘æä¸ºæ¸…æ™°ï¼šç”¨æˆ·åªéœ€è¾“å…¥åº”ç”¨åç§°å’Œæè¿°ï¼Œç³»ç»Ÿä¾¿è‡ªåŠ¨æ„é€ ä¸“ä¸šçš„å›¾åƒç”ŸæˆæŒ‡ä»¤ï¼Œè°ƒç”¨å¤§æ¨¡å‹APIï¼Œå¹¶å°†ç”Ÿæˆçš„é«˜è´¨é‡Logoå®æ—¶å‘ˆç°åœ¨é¡µé¢ä¸Šã€‚è¿™ç§â€œæè¿°å³æ‰€å¾—â€çš„äº¤äº’æ¨¡å¼ï¼Œæå¤§åœ°é™ä½äº†ä¸“ä¸šè®¾è®¡çš„é—¨æ§›ã€‚</p>
<h3 data-id="heading-2">äºŒã€å‰ç«¯æ¶æ„ï¼šBootstrapæ„å»ºçš„åšå›ºéª¨æ¶</h3>
<p>é¡¹ç›®é‡‡ç”¨äº†ç»å…¸çš„Bootstrap 3æ¡†æ¶æ„å»ºç”¨æˆ·ç•Œé¢ï¼Œç¡®ä¿äº†å“åº”å¼å¸ƒå±€å’Œç®€æ´çš„è§†è§‰é£æ ¼ã€‚<code>index.html</code>æ–‡ä»¶çš„ç»“æ„æ¸…æ™°åœ°ä½“ç°äº†è¿™ä¸€ç‚¹ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-6"</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- è¡¨å•åŒºåŸŸ --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"logo"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- å›¾ç‰‡åŠ¨æ€æ’å…¥åŒºåŸŸ --&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>è¿™é‡Œï¼Œ<code>.container</code>ç±»å®ç°äº†é¡µé¢å†…å®¹çš„å±…ä¸­å¸ƒå±€ï¼Œ<code>.row</code>å’Œ<code>.col-md-6</code>æ„å»ºäº†æ …æ ¼ç³»ç»Ÿï¼Œå°†è¡¨å•é™åˆ¶åœ¨é€‚ä¸­çš„å®½åº¦ã€‚ç‰¹åˆ«å€¼å¾—æ³¨æ„çš„æ˜¯é¢„ç•™çš„<code>&lt;div id="logo"&gt;</code>ï¼Œå®ƒä½œä¸ºå›¾ç‰‡çš„åŠ¨æ€â€œç”»å¸ƒâ€ï¼Œç­‰å¾…JavaScriptå°†AIçš„åˆ›ä½œæˆæœâ€œæŒ‚è½½â€äºæ­¤ã€‚</p>
<h3 data-id="heading-3">ä¸‰ã€è¡¨å•è‰ºæœ¯ï¼šHTML5çš„ä¼˜é›…å®è·µ</h3>
<p>è¡¨å•æ˜¯ç”¨æˆ·ä¸AIäº¤äº’çš„ç›´æ¥æ¡¥æ¢ï¼Œæœ¬é¡¹ç›®çš„è¡¨å•è®¾è®¡å……åˆ†è¿ç”¨äº†HTML5çš„ç‰¹æ€§æ¥æå‡ç”¨æˆ·ä½“éªŒä¸æ•°æ®å¯é æ€§ã€‚</p>
<p><strong>1. è¯­ä¹‰åŒ–ä¸å¯è®¿é—®æ€§</strong></p>
<p>é€šè¿‡<code>&lt;label&gt;</code>æ ‡ç­¾çš„<code>for</code>å±æ€§ä¸<code>&lt;input&gt;</code>çš„<code>id</code>ç²¾ç¡®å…³è”ï¼Œå®ç°äº†ç‚¹å‡»æ ‡ç­¾æ–‡å­—å³å¯èšç„¦è¾“å…¥æ¡†çš„åŠŸèƒ½ï¼Œè¿™ä¸ä»…æ˜¯è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒè®¾è®¡ï¼Œæ›´æ˜¯å¯¹å±å¹•é˜…è¯»å™¨ç­‰è¾…åŠ©æŠ€æœ¯çš„å‹å¥½æ”¯æŒã€‚</p>
<p><strong>2. å³æ—¶å¼•å¯¼ä¸æ•°æ®éªŒè¯</strong></p>
<p><code>placeholder</code>å±æ€§åœ¨è¾“å…¥æ¡†å†…æä¾›æ¸©å’Œçš„æç¤ºï¼Œå¼•å¯¼ç”¨æˆ·è¾“å…¥æ­£ç¡®æ ¼å¼çš„å†…å®¹ã€‚<code>required</code>å±æ€§åˆ™ä¸ºâ€œåº”ç”¨åç§°â€å­—æ®µåŠ ä¸Šäº†æµè§ˆå™¨åŸç”Ÿçš„éç©ºéªŒè¯ï¼Œåœ¨æ•°æ®æäº¤è‡³æœåŠ¡å™¨å‰å®Œæˆç¬¬ä¸€é“è´¨é‡å…³å¡ã€‚</p>
<p><strong>3. ç»“æ„åŒ–æ ·å¼</strong></p>
<p>Bootstrapçš„<code>.form-group</code>ç±»å°†æ¯ä¸ªæ ‡ç­¾å’Œå…¶å¯¹åº”çš„è¡¨å•æ§ä»¶åŒ…è£…æˆä¸€ä¸ªè§†è§‰å•å…ƒï¼Œå¹¶è‡ªåŠ¨æä¾›åˆé€‚çš„å‚ç›´é—´è·ï¼Œä½¿å¾—è¡¨å•ç»“æ„æ¸…æ™°ã€å±‚æ¬¡åˆ†æ˜ã€‚</p>
<h3 data-id="heading-4">å››ã€æ ¸å¿ƒé€»è¾‘ï¼šJavaScripté©±åŠ¨AIä¹‹ç¬”</h3>
<p>é¡¹ç›®çš„çµé­‚åœ¨äº<code>&lt;script&gt;</code>æ ‡ç­¾å†…çš„JavaScriptä»£ç ã€‚å®ƒå¦‚åŒä¸€ä½å†·é™çš„æŒ‡æŒ¥å®¶ï¼Œç²¾å‡†åœ°è°ƒåº¦ç€ç”¨æˆ·è¾“å…¥ã€AIæ¥å£å’Œé¡µé¢æ¸²æŸ“ã€‚</p>
<p><strong>1. é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œæ¥ç®¡æµç¨‹</strong></p>
<p>è¡¨å•çš„é»˜è®¤æäº¤è¡Œä¸ºä¼šå¯¼è‡´é¡µé¢è·³è½¬ï¼Œè¿™æ˜¾ç„¶ä¸é€‚åˆéœ€è¦åŸåœ°å±•ç¤ºå›¾ç‰‡çš„AIåº”ç”¨ã€‚å› æ­¤ï¼Œä»£ç åœ¨è¡¨å•çš„<code>submit</code>äº‹ä»¶ç›‘å¬å™¨ä¸­ï¼Œé¦–å½“å…¶å†²åœ°è°ƒç”¨äº†<code>event.preventDefault()</code>ï¼Œæœæ–­â€œåŠ«æŒâ€äº†è¡¨å•çš„åŸå§‹æäº¤æµç¨‹ï¼Œä¸ºåç»­çš„å¼‚æ­¥AIè°ƒç”¨é“ºå¹³é“è·¯ã€‚</p>
<p><strong>2. åŠ¨æ€æ„é€ â€œé­”æ³•æŒ‡ä»¤â€ï¼ˆPrompt Engineeringï¼‰</strong></p>
<p>AIç»˜ç”»çš„è´¨é‡æå¤§ç¨‹åº¦ä¸Šå–å†³äºæç¤ºè¯ï¼ˆPromptï¼‰çš„ä¼˜åŠ£ã€‚æœ¬é¡¹ç›®æ²¡æœ‰ä½¿ç”¨å›ºå®šæç¤ºè¯ï¼Œè€Œæ˜¯é‡‡ç”¨äº†å·§å¦™çš„<strong>æ¨¡æ¿å­—ç¬¦ä¸²</strong>æŠ€æœ¯ï¼Œå°†ç”¨æˆ·è¾“å…¥åŠ¨æ€ç¼–ç»‡æˆä¸“ä¸šçš„æŒ‡ä»¤ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> prompt = <span class="hljs-string">`
ä½ æ˜¯ä¸€ä¸ªäº’è”ç½‘å¤§å‚çš„è®¾è®¡å¸ˆï¼Œéœ€è¦è®¾è®¡ä¸€ä¸ªç§»åŠ¨åº”ç”¨çš„logoã€‚
åº”ç”¨åç§°ä¸º<span class="hljs-subst">${appName}</span>,
æè¿°ä¸º<span class="hljs-subst">${appDesc}</span>ã€‚
è®¾è®¡ä¸€ä¸ªé«˜ç«¯ã€å¤§æ°”ã€ä¸Šæ¡£æ¬¡çš„logoã€‚
è¯·ç¡®ä¿è®¾è®¡æ–¹æ¡ˆé€‚ç”¨äºç§»åŠ¨åº”ç”¨å›¾æ ‡ (App Icon)ã€‚
`</span>
</code></pre>
<p>è¿™æ®µä»£ç å ªç§°â€œç‚¹ç›ä¹‹ç¬”â€ã€‚å®ƒé€šè¿‡åå¼•å·ï¼ˆ<code>ï¼‰å®šä¹‰çš„æ¨¡æ¿å­—ç¬¦ä¸²ï¼Œå°†å˜é‡</code>appName<code>å’Œ</code>appDesc`æ— ç¼åµŒå…¥åˆ°ä¸€æ®µé¢„è®¾çš„è§’è‰²æŒ‡ä»¤ä¸­ã€‚è¿™ä¸ä»…ä»…æ˜¯å°†å…³é”®è¯æ‰”ç»™AIï¼Œæ›´æ˜¯ä¸ºAIè®¾å®šäº†ä¸€ä¸ªæ˜ç¡®çš„èº«ä»½ï¼ˆäº’è”ç½‘å¤§å‚è®¾è®¡å¸ˆï¼‰å’Œå…·ä½“çš„ä»»åŠ¡ç›®æ ‡ï¼ˆè®¾è®¡é€‚ç”¨äºApp Iconçš„é«˜ç«¯Logoï¼‰ï¼Œæå¤§åœ°æå‡äº†è¾“å‡ºç»“æœçš„ä¸“ä¸šæ€§å’Œå¯ç”¨æ€§ã€‚</p>
<p><strong>3. ä¸AIæ¡æ‰‹ï¼šFetch APIçš„ç°ä»£åº”ç”¨</strong></p>
<p>ä¸302.aiæœåŠ¡çš„é€šä¿¡ï¼Œä½¿ç”¨äº†ç°ä»£ã€å¼ºå¤§çš„Fetch APIï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-built_in">fetch</span>(<span class="hljs-string">'https://api.302.ai/v1/images/generations'</span>, {
    method: <span class="hljs-string">'POST'</span>,
    headers: {
        <span class="hljs-string">'Authorization'</span>: <span class="hljs-string">'Bearer sk-...'</span>, <span class="hljs-comment">// APIå¯†é’¥</span>
        <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>
    },
    body: JSON.<span class="hljs-built_in">stringify</span>({
        model: <span class="hljs-string">"dall-e-3"</span>, <span class="hljs-comment">// æŒ‡å®šä½¿ç”¨DALL-E 3æ¨¡å‹</span>
        prompt,           <span class="hljs-comment">// ä¼ å…¥æ„é€ å¥½çš„æç¤ºè¯</span>
        n: <span class="hljs-number">1</span>,             <span class="hljs-comment">// ç”Ÿæˆ1å¼ å›¾ç‰‡</span>
        size: <span class="hljs-string">"1024x1024"</span> <span class="hljs-comment">// å›¾ç‰‡åˆ†è¾¨ç‡</span>
    })
})
</code></pre>
<p>è¿™æ®µä»£ç æ¸…æ™°åœ°å±•ç¤ºäº†ä¸AIGC APIäº¤äº’çš„æ ‡å‡†èŒƒå¼ï¼šæŒ‡å®šç«¯ç‚¹ã€ä½¿ç”¨POSTæ–¹æ³•ã€åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦èº«ä»½éªŒè¯çš„<code>Authorization</code>å­—æ®µå’Œå£°æ˜æ•°æ®æ ¼å¼çš„<code>Content-Type</code>ï¼Œæœ€åå°†åŒ…å«æ¨¡å‹å‚æ•°å’Œæ ¸å¿ƒæç¤ºè¯çš„é…ç½®åºåˆ—åŒ–ä¸ºJSONå­—ç¬¦ä¸²æ”¾å…¥è¯·æ±‚ä½“ã€‚</p>
<p><strong>4. å¼‚æ­¥äº¤å“ï¼šPromiseé“¾å¤„ç†å“åº”</strong></p>
<p>Fetch APIè¿”å›çš„æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œä»£ç é€šè¿‡<code>.then()</code>é“¾å¼è°ƒç”¨æ¥ä¼˜é›…åœ°å¤„ç†å¼‚æ­¥å“åº”ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">.then(<span class="hljs-attr">response</span> =&gt; response.json())
.then(<span class="hljs-attr">data</span> =&gt; {
    console.log(data)<span class="hljs-comment">;</span>
    const <span class="hljs-attr">img</span> = document.createElement(<span class="hljs-string">'img'</span>)<span class="hljs-comment">;</span>
    <span class="hljs-attr">img.src</span> = data.data[<span class="hljs-number">0</span>].url<span class="hljs-comment">;</span>
    <span class="hljs-attr">img.onload</span> = function() {
      document.getElementById('logo').appendChild(img)<span class="hljs-comment">;</span>
    }
})
.catch((error) =&gt; {
    console.error('Error:', error)<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
</code></pre>
<p>ç¬¬ä¸€ä¸ª<code>.then(response =&gt; response.json())</code>è´Ÿè´£å°†åŸå§‹çš„HTTPå“åº”æµè§£æä¸ºJavaScriptå¯¹è±¡ã€‚ç¬¬äºŒä¸ª<code>.then()</code>åˆ™å¤„ç†è§£æåçš„æ•°æ®ï¼šé¦–å…ˆå°†å®Œæ•´çš„å“åº”æ•°æ®<code>console.log</code>è¾“å‡ºï¼Œè¿™å¯¹äºè°ƒè¯•è‡³å…³é‡è¦ï¼›ç„¶åï¼Œå®ƒä»å“åº”ç»“æ„<code>data.data[0].url</code>ä¸­æå–å‡ºå›¾ç‰‡çš„URLåœ°å€ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªå…³é”®çš„æŠ€æœ¯ç»†èŠ‚ï¼šå®ƒåœ¨åˆ›å»º<code>&lt;img&gt;</code>å…ƒç´ å¹¶è®¾ç½®<code>src</code>å±æ€§åï¼Œ<strong>å¹¶æœªç«‹å³å°†å…¶æ’å…¥DOM</strong>ï¼Œè€Œæ˜¯<strong>ç­‰å¾…<code>onload</code>äº‹ä»¶è§¦å‘</strong>ã€‚è¿™ç¡®ä¿äº†åªåœ¨å›¾ç‰‡å®Œå…¨åŠ è½½æˆåŠŸåï¼Œæ‰æ‰§è¡Œ<code>appendChild</code>æ“ä½œï¼Œé¿å…äº†å› å›¾ç‰‡åŠ è½½ç¼“æ…¢æˆ–å¤±è´¥å¯¼è‡´çš„é¡µé¢å¸ƒå±€é—®é¢˜æˆ–æ˜¾ç¤ºä¸å…¨ï¼Œä½“ç°äº†å¥å£®çš„ç¼–ç¨‹æ€æƒ³ã€‚æœ€åçš„<code>.catch()</code>åˆ™ç»Ÿä¸€æ•è·å¹¶å¤„ç†æ•´ä¸ªæµç¨‹ä¸­å¯èƒ½å‡ºç°çš„ä»»ä½•ç½‘ç»œæˆ–é€»è¾‘é”™è¯¯ã€‚</p>
<h3 data-id="heading-5">äº”ã€æ€è€ƒä¸å‰ç»</h3>
<p>è¿™ä¸ªé¡¹ç›®è™½ç„¶ä½“é‡ä¸å¤§ï¼Œå´å®Œæ•´åœ°æ¼”ç¤ºäº†å°†AIGCèƒ½åŠ›äº§å“åŒ–çš„æ ¸å¿ƒè·¯å¾„ï¼š<strong>å‹å¥½çš„å‰ç«¯äº¤äº’ -&gt; ç²¾å¿ƒæ„é€ çš„æŒ‡ä»¤å·¥ç¨‹ -&gt; ç¨³å®šçš„APIè°ƒç”¨ -&gt; æµç•…çš„ç»“æœå‘ˆç°</strong>ã€‚å®ƒä¸ä»…æ˜¯è°ƒç”¨ä¸€ä¸ªAPIï¼Œæ›´æ˜¯ä¸€æ¬¡å®Œæ•´çš„äººæœºååŒåˆ›ä½œä½“éªŒã€‚</p>
<p>å±•æœ›æœªæ¥ï¼Œå¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šå¢åŠ æ›´å¤šå¢å¼ºåŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šè®©ç”¨æˆ·é€‰æ‹©ä¸åŒçš„è®¾è®¡é£æ ¼ï¼ˆæç®€ã€å¡é€šã€3Dç­‰ï¼‰ã€æä¾›å¤šç§å®½é«˜æ¯”é€‰é¡¹ã€æ·»åŠ å†å²è®°å½•åŠŸèƒ½ï¼Œç”šè‡³é›†æˆæ›´å¤æ‚çš„å›¾åƒç¼–è¾‘èƒ½åŠ›ã€‚æœ¬é¡¹ç›®å·²ç»æˆåŠŸæ­å»ºäº†ä»æ–‡å­—æè¿°åˆ°è§†è§‰äº§å‡ºçš„â€œç¬¬ä¸€åº§æ¡¥æ¢â€ï¼Œä¸ºæ¢ç´¢AIåœ¨åˆ›æ„é¢†åŸŸçš„æ— é™å¯èƒ½æ‰“å¼€äº†ä¸€æ‰‡æ˜äº®çš„æŠ€æœ¯ä¹‹çª—ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[[homebrew]brew services list(è¯¦è§£)]]></title>    <link>https://juejin.cn/post/7603591775392415771</link>    <guid>https://juejin.cn/post/7603591775392415771</guid>    <pubDate>2026-02-07T05:43:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603591775392415771" data-draft-id="7603567912593211419" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="[homebrew]brew services list(è¯¦è§£)"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-07T05:43:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="import_random"/> <meta itemprop="url" content="https://juejin.cn/user/2013961033882312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            [homebrew]brew services list(è¯¦è§£)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2013961033882312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    import_random
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T05:43:29.000Z" title="Sat Feb 07 2026 05:43:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><code>brew services list</code> çš„ä½œç”¨å°±æ˜¯<strong>åˆ—å‡ºæ‰€æœ‰é€šè¿‡ Homebrew å®‰è£…, å¹¶ä¸”å¯ç”± Homebrew Services ç®¡ç†çš„æœåŠ¡çŠ¶æ€</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-0">è¯¦ç»†ä½œç”¨è¯´æ˜ï¼š</h2>
<ol>
<li>
<p><strong>åˆ—å‡ºæ‰€æœ‰ç›¸å…³æœåŠ¡</strong>ï¼š</p>
<ul>
<li>æ˜¾ç¤ºé€šè¿‡ <code>brew install</code> å®‰è£…çš„ã€æ”¯æŒæœåŠ¡ç®¡ç†çš„è½¯ä»¶åŒ…</li>
<li>åŒ…æ‹¬æ­£åœ¨è¿è¡Œçš„å’Œå·²åœæ­¢çš„æœåŠ¡</li>
</ul>
</li>
<li>
<p><strong>æ˜¾ç¤ºå…³é”®ä¿¡æ¯</strong>ï¼š</p>
<ul>
<li><strong>æœåŠ¡åç§°</strong>ï¼ˆNameï¼‰ï¼šè½¯ä»¶åŒ…åç§°ï¼Œå¦‚ nginxã€mysqlã€redis ç­‰</li>
<li><strong>è¿è¡ŒçŠ¶æ€</strong>ï¼ˆStatusï¼‰ï¼š
<ul>
<li><code>started</code> - æœåŠ¡æ­£åœ¨è¿è¡Œ</li>
<li><code>stopped</code> - æœåŠ¡å·²åœæ­¢</li>
<li><code>error</code> - æœåŠ¡å¯åŠ¨å‡ºé”™</li>
<li><code>none</code> - ä»æœªå¯åŠ¨è¿‡</li>
</ul>
</li>
<li><strong>å¯åŠ¨ç”¨æˆ·</strong>ï¼ˆUserï¼‰ï¼šæœåŠ¡ä»¥å“ªä¸ªç”¨æˆ·èº«ä»½è¿è¡Œ</li>
<li><strong>å¯åŠ¨é…ç½®æ–‡ä»¶</strong>ï¼ˆPlistï¼‰ï¼šæœåŠ¡çš„ launchctl plist æ–‡ä»¶è·¯å¾„</li>
</ul>
</li>
<li>
<p><strong>åŒºåˆ†å¯åŠ¨çº§åˆ«</strong>ï¼š</p>
<ul>
<li>é€šè¿‡ plist æ–‡ä»¶è·¯å¾„å¯ä»¥åŒºåˆ†ï¼š
<ul>
<li><code>/Library/LaunchDaemons/</code> - ç³»ç»Ÿçº§å¯åŠ¨ï¼ˆå¼€æœºè‡ªå¯ï¼Œéœ€ç®¡ç†å‘˜æƒé™ï¼‰</li>
<li><code>~/Library/LaunchAgents/</code> - ç”¨æˆ·çº§å¯åŠ¨ï¼ˆç™»å½•åå¯åŠ¨ï¼‰</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 data-id="heading-1">ç¤ºä¾‹è¾“å‡ºï¼š</h2>
<pre><code class="hljs language-bash" lang="bash">$ brew services list
Name    Status  User   Plist
nginx   started root   /Library/LaunchDaemons/homebrew.mxcl.nginx.plist
mysql   stopped
redis   started alice  /Users/alice/Library/LaunchAgents/homebrew.mxcl.redis.plist
postgresql error
</code></pre>
<h2 data-id="heading-2">ç›¸å…³å¸¸ç”¨å‘½ä»¤ï¼š</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¯åŠ¨æœåŠ¡</span>
brew services start &lt;æœåŠ¡å&gt;

<span class="hljs-comment"># åœæ­¢æœåŠ¡</span>
brew services stop &lt;æœåŠ¡å&gt;

<span class="hljs-comment"># é‡å¯æœåŠ¡</span>
brew services restart &lt;æœåŠ¡å&gt;

<span class="hljs-comment"># åˆ—å‡ºæ‰€æœ‰æœåŠ¡çš„çŠ¶æ€</span>
brew services list 

<span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰å‘½ä»¤å¸®åŠ©</span>
brew services --<span class="hljs-built_in">help</span>
</code></pre>
<h2 data-id="heading-3">æ³¨æ„äº‹é¡¹ï¼š</h2>
<ul>
<li>åªæœ‰é€šè¿‡ Homebrew å®‰è£…ä¸”æ”¯æŒæœåŠ¡ç®¡ç†çš„è½¯ä»¶æ‰ä¼šæ˜¾ç¤º</li>
<li>ç›´æ¥é€šè¿‡å…¶ä»–æ–¹å¼ï¼ˆå¦‚æ‰‹åŠ¨å¯åŠ¨ï¼‰è¿è¡Œçš„æœåŠ¡ä¸ä¼šå‡ºç°åœ¨æ­¤åˆ—è¡¨ä¸­</li>
<li>è¿™æ˜¯ç®¡ç† macOS ä¸Š Homebrew æœåŠ¡çš„æ ‡å‡†æ–¹å¼ï¼Œåº•å±‚ä½¿ç”¨ macOS çš„ <code>launchctl</code> ç³»ç»Ÿ</li>
</ul>
<p>è¿™ä¸ªå‘½ä»¤ç‰¹åˆ«é€‚åˆç®¡ç†å¼€å‘ç¯å¢ƒä¸­å¸¸ç”¨çš„æ•°æ®åº“ã€Web æœåŠ¡å™¨ã€ç¼“å­˜ç­‰æœåŠ¡ï¼Œè®©ä½ ä¸€ç›®äº†ç„¶åœ°æŒæ¡æ‰€æœ‰æœåŠ¡çš„çŠ¶æ€ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸€å¤©ä¸€ä¸ªPythonåº“ï¼šjinja2 - å¼ºå¤§çµæ´»çš„Pythonæ¨¡æ¿å¼•æ“]]></title>    <link>https://juejin.cn/post/7603627478020358154</link>    <guid>https://juejin.cn/post/7603627478020358154</guid>    <pubDate>2026-02-07T06:19:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603627478020358154" data-draft-id="7603595309232488458" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸€å¤©ä¸€ä¸ªPythonåº“ï¼šjinja2 - å¼ºå¤§çµæ´»çš„Pythonæ¨¡æ¿å¼•æ“"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-02-07T06:19:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ•ç¼–ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/2579909358396288"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸€å¤©ä¸€ä¸ªPythonåº“ï¼šjinja2 - å¼ºå¤§çµæ´»çš„Pythonæ¨¡æ¿å¼•æ“
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2579909358396288/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ•ç¼–ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T06:19:48.000Z" title="Sat Feb 07 2026 06:19:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">jinja2 - å¼ºå¤§çµæ´»çš„Pythonæ¨¡æ¿å¼•æ“</h2>
<h3 data-id="heading-1">ä¸€ã€ä»€ä¹ˆæ˜¯jinja2ï¼Ÿ</h3>
<p><strong>jinja2</strong> æ˜¯ä¸€ä¸ªç”¨äºç”ŸæˆåŠ¨æ€å†…å®¹çš„ Python åº“ã€‚
å®ƒå¯ä»¥å¸®åŠ©ä½ ï¼š</p>
<ul>
<li><strong>åˆ†ç¦»é€»è¾‘ä¸è§†å›¾</strong>: å°† Python ä»£ç å’Œ HTMLï¼ˆæˆ–å…¶ä»–æ–‡æœ¬ï¼‰ç»“æ„åˆ†ç¦»ï¼Œä½¿ä»£ç æ›´æ•´æ´ï¼Œè§†å›¾æ›´æ˜“ç»´æŠ¤ã€‚</li>
<li><strong>å¿«é€Ÿç”Ÿæˆå„ç§æ–‡æœ¬</strong>: ä¸ä»…é™äºHTMLï¼Œè¿˜å¯ä»¥ç”ŸæˆXMLã€CSSã€JavaScriptã€é…ç½®æ–‡ä»¶ç­‰ä»»ä½•åŸºäºæ–‡æœ¬çš„å†…å®¹ã€‚</li>
<li><strong>æ”¯æŒå¤æ‚çš„æ¨¡æ¿ç»“æ„</strong>: æä¾›å¾ªç¯ã€æ¡ä»¶è¯­å¥ã€å®ã€ç»§æ‰¿ç­‰é«˜çº§åŠŸèƒ½ï¼Œè®©æ¨¡æ¿ç¼–å†™æ›´çµæ´»é«˜æ•ˆã€‚</li>
</ul>
<h3 data-id="heading-2">äºŒã€åº”ç”¨åœºæ™¯</h3>
<p><strong>jinja2</strong> å¹¿æ³›åº”ç”¨äºä»¥ä¸‹å®é™…åœºæ™¯ï¼š</p>
<ul>
<li><strong>Webå¼€å‘</strong>: ç»“åˆFlaskã€Sanicç­‰Python Webæ¡†æ¶ï¼Œæ¸²æŸ“HTMLé¡µé¢ï¼Œå±•ç¤ºåŠ¨æ€æ•°æ®ã€‚</li>
<li><strong>ä»£ç ç”Ÿæˆ</strong>: æ ¹æ®æ¨¡æ¿è‡ªåŠ¨ç”Ÿæˆé‡å¤æ€§é«˜çš„ä»£ç æ–‡ä»¶ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚</li>
<li><strong>é…ç½®ç®¡ç†</strong>: åŸºäºå˜é‡å’Œæ¨¡æ¿ï¼Œç”Ÿæˆå¤æ‚çš„é…ç½®æ–‡ä»¶ï¼Œå®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚</li>
<li><strong>ç”µå­é‚®ä»¶æ¨¡æ¿</strong>: æ‰¹é‡ç”Ÿæˆä¸ªæ€§åŒ–çš„HTMLæˆ–çº¯æ–‡æœ¬é‚®ä»¶å†…å®¹ã€‚</li>
</ul>
<h3 data-id="heading-3">ä¸‰ã€å¦‚ä½•å®‰è£…</h3>
<ol>
<li>ä½¿ç”¨ pip å®‰è£…</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">pip install jinja2

<span class="hljs-comment"># å¦‚æœå®‰è£…æ…¢çš„è¯ï¼Œæ¨èä½¿ç”¨å›½å†…é•œåƒæº</span>
pip install jinja2 -i https://www.python64.cn/pypi/simple/
</code></pre>
<ol start="2">
<li>ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.min2k.com%2Ftools%2Fpython-run%2F" target="_blank" title="https://www.min2k.com/tools/python-run/" ref="nofollow noopener noreferrer">PythonRun</a> åœ¨çº¿è¿è¡Œä»£ç ï¼ˆæ— éœ€æœ¬åœ°å®‰è£…ï¼‰</li>
</ol>
<h3 data-id="heading-4">å››ã€ç¤ºä¾‹ä»£ç </h3>
<p>æ ¹æ®ç”¨æˆ·è§’è‰²ç”Ÿæˆä¸ªæ€§åŒ–æ¬¢è¿ä¿¡æ¯</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> jinja2 <span class="hljs-keyword">import</span> Template

<span class="hljs-comment"># å‡è®¾æœ‰ä¸€äº›ç”¨æˆ·æ•°æ®</span>
user_data = {
    <span class="hljs-string">'name'</span>: <span class="hljs-string">'Alice'</span>,
    <span class="hljs-string">'is_admin'</span>: <span class="hljs-literal">True</span>,
    <span class="hljs-string">'points'</span>: <span class="hljs-number">150</span>
}

<span class="hljs-comment"># å®šä¹‰ä¸€ä¸ª Jinja2 æ¨¡æ¿å­—ç¬¦ä¸²</span>
template_string = <span class="hljs-string">"""
{% if user.is_admin %}
Hello, Admin {{ user.name }}! You have special access.
{% elif user.points &gt; 100 %}
Welcome back, {{ user.name }}! You are a valued member.
{% else %}
Hello, {{ user.name }}. Please explore our features.
{% endif %}
Your current points: {{ user.points }}
"""</span>

<span class="hljs-comment"># åˆ›å»ºæ¨¡æ¿å¯¹è±¡</span>
template = Template(template_string)

<span class="hljs-comment"># æ¸²æŸ“æ¨¡æ¿ï¼Œä¼ å…¥ç”¨æˆ·æ•°æ®</span>
rendered_output = template.render(user=user_data)

<span class="hljs-comment"># æ‰“å°æ¸²æŸ“ç»“æœ</span>
<span class="hljs-built_in">print</span>(rendered_output)

<span class="hljs-comment"># å°è¯•ä¸€ä¸ªæ™®é€šç”¨æˆ·</span>
user_data_standard = {
    <span class="hljs-string">'name'</span>: <span class="hljs-string">'Bob'</span>,
    <span class="hljs-string">'is_admin'</span>: <span class="hljs-literal">False</span>,
    <span class="hljs-string">'points'</span>: <span class="hljs-number">75</span>
}
rendered_output_standard = template.render(user=user_data_standard)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"\n--- Standard User ---"</span>)
<span class="hljs-built_in">print</span>(rendered_output_standard)

<span class="hljs-comment"># å°è¯•ä¸€ä¸ªé«˜ç§¯åˆ†ç”¨æˆ·</span>
user_data_valued = {
    <span class="hljs-string">'name'</span>: <span class="hljs-string">'Charlie'</span>,
    <span class="hljs-string">'is_admin'</span>: <span class="hljs-literal">False</span>,
    <span class="hljs-string">'points'</span>: <span class="hljs-number">120</span>
}
rendered_output_valued = template.render(user=user_data_valued)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"\n--- Valued User ---"</span>)
<span class="hljs-built_in">print</span>(rendered_output_valued)
</code></pre>
<p>ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.min2k.com%2Ftools%2Fpython-run%2F%3Fcode%3Dfrom%2520jinja2%2520import%2520Template%250A%250A%2523%2520%25E5%2581%2587%25E8%25AE%25BE%25E6%259C%2589%25E4%25B8%2580%25E4%25BA%259B%25E7%2594%25A8%25E6%2588%25B7%25E6%2595%25B0%25E6%258D%25AE%250Auser_data%2520%253D%2520%257B%250A%2520%2520%2520%2520'name'%253A%2520'Alice'%252C%250A%2520%2520%2520%2520'is_admin'%253A%2520True%252C%250A%2520%2520%2520%2520'points'%253A%2520150%250A%257D%250A%250A%2523%2520%25E5%25AE%259A%25E4%25B9%2589%25E4%25B8%2580%25E4%25B8%25AA%2520Jinja2%2520%25E6%25A8%25A1%25E6%259D%25BF%25E5%25AD%2597%25E7%25AC%25A6%25E4%25B8%25B2%250Atemplate_string%2520%253D%2520%2522%2522%2522%250A%257B%2525%2520if%2520user.is_admin%2520%2525%257D%250AHello%252C%2520Admin%2520%257B%257B%2520user.name%2520%257D%257D!%2520You%2520have%2520special%2520access.%250A%257B%2525%2520elif%2520user.points%2520%253E%2520100%2520%2525%257D%250AWelcome%2520back%252C%2520%257B%257B%2520user.name%2520%257D%257D!%2520You%2520are%2520a%2520valued%2520member.%250A%257B%2525%2520else%2520%2525%257D%250AHello%252C%2520%257B%257B%2520user.name%2520%257D%257D.%2520Please%2520explore%2520our%2520features.%250A%257B%2525%2520endif%2520%2525%257D%250AYour%2520current%2520points%253A%2520%257B%257B%2520user.points%2520%257D%257D%250A%2522%2522%2522%250A%250A%2523%2520%25E5%2588%259B%25E5%25BB%25BA%25E6%25A8%25A1%25E6%259D%25BF%25E5%25AF%25B9%25E8%25B1%25A1%250Atemplate%2520%253D%2520Template%2528template_string%2529%250A%250A%2523%2520%25E6%25B8%25B2%25E6%259F%2593%25E6%25A8%25A1%25E6%259D%25BF%25EF%25BC%258C%25E4%25BC%25A0%25E5%2585%25A5%25E7%2594%25A8%25E6%2588%25B7%25E6%2595%25B0%25E6%258D%25AE%250Arendered_output%2520%253D%2520template.render%2528user%253Duser_data%2529%250A%250A%2523%2520%25E6%2589%2593%25E5%258D%25B0%25E6%25B8%25B2%25E6%259F%2593%25E7%25BB%2593%25E6%259E%259C%250Aprint%2528rendered_output%2529%250A%250A%2523%2520%25E5%25B0%259D%25E8%25AF%2595%25E4%25B8%2580%25E4%25B8%25AA%25E6%2599%25AE%25E9%2580%259A%25E7%2594%25A8%25E6%2588%25B7%250Auser_data_standard%2520%253D%2520%257B%250A%2520%2520%2520%2520'name'%253A%2520'Bob'%252C%250A%2520%2520%2520%2520'is_admin'%253A%2520False%252C%250A%2520%2520%2520%2520'points'%253A%252075%250A%257D%250Arendered_output_standard%2520%253D%2520template.render%2528user%253Duser_data_standard%2529%250Aprint%2528%2522%255Cn---%2520Standard%2520User%2520---%2522%2529%250Aprint%2528rendered_output_standard%2529%250A%250A%2523%2520%25E5%25B0%259D%25E8%25AF%2595%25E4%25B8%2580%25E4%25B8%25AA%25E9%25AB%2598%25E7%25A7%25AF%25E5%2588%2586%25E7%2594%25A8%25E6%2588%25B7%250Auser_data_valued%2520%253D%2520%257B%250A%2520%2520%2520%2520'name'%253A%2520'Charlie'%252C%250A%2520%2520%2520%2520'is_admin'%253A%2520False%252C%250A%2520%2520%2520%2520'points'%253A%2520120%250A%257D%250Arendered_output_valued%2520%253D%2520template.render%2528user%253Duser_data_valued%2529%250Aprint%2528%2522%255Cn---%2520Valued%2520User%2520---%2522%2529%250Aprint%2528rendered_output_valued%2529" target="_blank" title="https://www.min2k.com/tools/python-run/?code=from%20jinja2%20import%20Template%0A%0A%23%20%E5%81%87%E8%AE%BE%E6%9C%89%E4%B8%80%E4%BA%9B%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE%0Auser_data%20%3D%20%7B%0A%20%20%20%20'name'%3A%20'Alice'%2C%0A%20%20%20%20'is_admin'%3A%20True%2C%0A%20%20%20%20'points'%3A%20150%0A%7D%0A%0A%23%20%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%20Jinja2%20%E6%A8%A1%E6%9D%BF%E5%AD%97%E7%AC%A6%E4%B8%B2%0Atemplate_string%20%3D%20%22%22%22%0A%7B%25%20if%20user.is_admin%20%25%7D%0AHello%2C%20Admin%20%7B%7B%20user.name%20%7D%7D!%20You%20have%20special%20access.%0A%7B%25%20elif%20user.points%20%3E%20100%20%25%7D%0AWelcome%20back%2C%20%7B%7B%20user.name%20%7D%7D!%20You%20are%20a%20valued%20member.%0A%7B%25%20else%20%25%7D%0AHello%2C%20%7B%7B%20user.name%20%7D%7D.%20Please%20explore%20our%20features.%0A%7B%25%20endif%20%25%7D%0AYour%20current%20points%3A%20%7B%7B%20user.points%20%7D%7D%0A%22%22%22%0A%0A%23%20%E5%88%9B%E5%BB%BA%E6%A8%A1%E6%9D%BF%E5%AF%B9%E8%B1%A1%0Atemplate%20%3D%20Template%28template_string%29%0A%0A%23%20%E6%B8%B2%E6%9F%93%E6%A8%A1%E6%9D%BF%EF%BC%8C%E4%BC%A0%E5%85%A5%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE%0Arendered_output%20%3D%20template.render%28user%3Duser_data%29%0A%0A%23%20%E6%89%93%E5%8D%B0%E6%B8%B2%E6%9F%93%E7%BB%93%E6%9E%9C%0Aprint%28rendered_output%29%0A%0A%23%20%E5%B0%9D%E8%AF%95%E4%B8%80%E4%B8%AA%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7%0Auser_data_standard%20%3D%20%7B%0A%20%20%20%20'name'%3A%20'Bob'%2C%0A%20%20%20%20'is_admin'%3A%20False%2C%0A%20%20%20%20'points'%3A%2075%0A%7D%0Arendered_output_standard%20%3D%20template.render%28user%3Duser_data_standard%29%0Aprint%28%22%5Cn---%20Standard%20User%20---%22%29%0Aprint%28rendered_output_standard%29%0A%0A%23%20%E5%B0%9D%E8%AF%95%E4%B8%80%E4%B8%AA%E9%AB%98%E7%A7%AF%E5%88%86%E7%94%A8%E6%88%B7%0Auser_data_valued%20%3D%20%7B%0A%20%20%20%20'name'%3A%20'Charlie'%2C%0A%20%20%20%20'is_admin'%3A%20False%2C%0A%20%20%20%20'points'%3A%20120%0A%7D%0Arendered_output_valued%20%3D%20template.render%28user%3Duser_data_valued%29%0Aprint%28%22%5Cn---%20Valued%20User%20---%22%29%0Aprint%28rendered_output_valued%29" ref="nofollow noopener noreferrer">PythonRun</a> åœ¨çº¿è¿è¡Œè¿™æ®µä»£ç ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-text" lang="text">Hello, Admin Alice! You have special access.

Your current points: 150

--- Standard User ---


Hello, Bob. Please explore our features.

Your current points: 75

--- Valued User ---


Welcome back, Charlie! You are a valued member.

Your current points: 120
</code></pre>
<p>ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.min2k.com%2Ftools%2Fmermaid%2F%3Fcode%3Dflowchart%2520TD%250A%2520%2520A%255B%25E5%25BC%2580%25E5%25A7%258B%255D%2520--%253E%2520B%257B%25E5%2588%259B%25E5%25BB%25BA%25E7%2594%25A8%25E6%2588%25B7%25E6%2595%25B0%25E6%258D%25AE%257D%253B%250A%2520%2520B%2520--%253E%2520C%257B%25E5%25AE%259A%25E4%25B9%2589Jinja2%25E6%25A8%25A1%25E6%259D%25BF%25E5%25AD%2597%25E7%25AC%25A6%25E4%25B8%25B2%257D%253B%250A%2520%2520C%2520--%253E%2520D%255B%25E5%2588%259B%25E5%25BB%25BATemplate%25E5%25AF%25B9%25E8%25B1%25A1%255D%253B%250A%2520%2520D%2520--%253E%2520E%257B%25E4%25BC%25A0%25E5%2585%25A5%25E7%2594%25A8%25E6%2588%25B7%25E6%2595%25B0%25E6%258D%25AE%25E5%25B9%25B6%25E6%25B8%25B2%25E6%259F%2593%25E6%25A8%25A1%25E6%259D%25BF%257D%253B%250A%2520%2520E%2520--%253E%2520F%257B%25E6%2589%2593%25E5%258D%25B0%25E6%25B8%25B2%25E6%259F%2593%25E7%25BB%2593%25E6%259E%259C%257D%253B%250A%2520%2520F%2520--%253E%2520G%257B%25E5%2588%25A4%25E6%2596%25AD%25E7%2594%25A8%25E6%2588%25B7%25E6%2598%25AF%25E5%2590%25A6%25E4%25B8%25BA%25E7%25AE%25A1%25E7%2590%2586%25E5%2591%2598%253F%257D%253B%250A%2520%2520G%2520--%2520%25E6%2598%25AF%2520--%253E%2520H%255B%25E7%2594%259F%25E6%2588%2590%25E7%25AE%25A1%25E7%2590%2586%25E5%2591%2598%25E6%25AC%25A2%25E8%25BF%258E%25E8%25AF%25AD%255D%253B%250A%2520%2520G%2520--%2520%25E5%2590%25A6%2520--%253E%2520I%257B%25E7%2594%25A8%25E6%2588%25B7%25E7%25A7%25AF%25E5%2588%2586%25E6%2598%25AF%25E5%2590%25A6%25E5%25A4%25A7%25E4%25BA%258E100%253F%257D%253B%250A%2520%2520I%2520--%2520%25E6%2598%25AF%2520--%253E%2520J%255B%25E7%2594%259F%25E6%2588%2590%25E9%25AB%2598%25E7%25A7%25AF%25E5%2588%2586%25E4%25BC%259A%25E5%2591%2598%25E6%25AC%25A2%25E8%25BF%258E%25E8%25AF%25AD%255D%253B%250A%2520%2520I%2520--%2520%25E5%2590%25A6%2520--%253E%2520K%255B%25E7%2594%259F%25E6%2588%2590%25E6%2599%25AE%25E9%2580%259A%25E7%2594%25A8%25E6%2588%25B7%25E6%25AC%25A2%25E8%25BF%258E%25E8%25AF%25AD%255D%253B%250A%2520%2520H%2520--%253E%2520L%255B%25E8%25BE%2593%25E5%2587%25BA%25E7%25A7%25AF%25E5%2588%2586%255D%253B%250A%2520%2520J%2520--%253E%2520L%253B%250A%2520%2520K%2520--%253E%2520L%253B%250A%2520%2520L%2520--%253E%2520M%255B%25E7%25BB%2593%25E6%259D%259F%255D%253B" target="_blank" title="https://www.min2k.com/tools/mermaid/?code=flowchart%20TD%0A%20%20A%5B%E5%BC%80%E5%A7%8B%5D%20--%3E%20B%7B%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE%7D%3B%0A%20%20B%20--%3E%20C%7B%E5%AE%9A%E4%B9%89Jinja2%E6%A8%A1%E6%9D%BF%E5%AD%97%E7%AC%A6%E4%B8%B2%7D%3B%0A%20%20C%20--%3E%20D%5B%E5%88%9B%E5%BB%BATemplate%E5%AF%B9%E8%B1%A1%5D%3B%0A%20%20D%20--%3E%20E%7B%E4%BC%A0%E5%85%A5%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE%E5%B9%B6%E6%B8%B2%E6%9F%93%E6%A8%A1%E6%9D%BF%7D%3B%0A%20%20E%20--%3E%20F%7B%E6%89%93%E5%8D%B0%E6%B8%B2%E6%9F%93%E7%BB%93%E6%9E%9C%7D%3B%0A%20%20F%20--%3E%20G%7B%E5%88%A4%E6%96%AD%E7%94%A8%E6%88%B7%E6%98%AF%E5%90%A6%E4%B8%BA%E7%AE%A1%E7%90%86%E5%91%98%3F%7D%3B%0A%20%20G%20--%20%E6%98%AF%20--%3E%20H%5B%E7%94%9F%E6%88%90%E7%AE%A1%E7%90%86%E5%91%98%E6%AC%A2%E8%BF%8E%E8%AF%AD%5D%3B%0A%20%20G%20--%20%E5%90%A6%20--%3E%20I%7B%E7%94%A8%E6%88%B7%E7%A7%AF%E5%88%86%E6%98%AF%E5%90%A6%E5%A4%A7%E4%BA%8E100%3F%7D%3B%0A%20%20I%20--%20%E6%98%AF%20--%3E%20J%5B%E7%94%9F%E6%88%90%E9%AB%98%E7%A7%AF%E5%88%86%E4%BC%9A%E5%91%98%E6%AC%A2%E8%BF%8E%E8%AF%AD%5D%3B%0A%20%20I%20--%20%E5%90%A6%20--%3E%20K%5B%E7%94%9F%E6%88%90%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7%E6%AC%A2%E8%BF%8E%E8%AF%AD%5D%3B%0A%20%20H%20--%3E%20L%5B%E8%BE%93%E5%87%BA%E7%A7%AF%E5%88%86%5D%3B%0A%20%20J%20--%3E%20L%3B%0A%20%20K%20--%3E%20L%3B%0A%20%20L%20--%3E%20M%5B%E7%BB%93%E6%9D%9F%5D%3B" ref="nofollow noopener noreferrer">MermaidGo</a> ç»˜åˆ¶ç¤ºä¾‹ä»£ç çš„æµç¨‹å›¾ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3066279c154949c4ab0e2a16958f1fe9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWP57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771049987&amp;x-signature=9nQie5DGhV005PydnMhQgWfEMiQ%3D" alt="MermerGoçš„jinja2æµç¨‹å›¾" loading="lazy"/></p>
<h3 data-id="heading-5">äº”ã€å­¦ä¹ èµ„æº</h3>
<ol>
<li>å¼€æºé¡¹ç›®ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpallets%2Fjinja" target="_blank" title="https://github.com/pallets/jinja" ref="nofollow noopener noreferrer">jinja2</a></li>
<li>ä¸­æ–‡è‡ªè¿°ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.python64.cn%2Freadme%2Fjinja2%2F" target="_blank" title="https://www.python64.cn/readme/jinja2/" ref="nofollow noopener noreferrer">REMDME</a></li>
<li>åœ¨çº¿è¿è¡Œï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.min2k.com%2Ftools%2Fpython-run%2F" target="_blank" title="https://www.min2k.com/tools/python-run/" ref="nofollow noopener noreferrer">PythonRun</a></li>
</ol>
<blockquote>
<p>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµã€æ”¶è—ã€è½¬å‘ï¼<br/>
å­¦ä¹ è¿‡ç¨‹ä¸­æœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€äº¤æµï½</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java åŸºäºxmlé…ç½®çš„å±æ€§æ˜ å°„å·¥å…·ï¼Œå¯ç”¨äºæŠ¥æ–‡è½¬æ¢é€‚é…ã€‚]]></title>    <link>https://juejin.cn/post/7603575763787431962</link>    <guid>https://juejin.cn/post/7603575763787431962</guid>    <pubDate>2026-02-07T06:57:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603575763787431962" data-draft-id="7603595309232537610" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java åŸºäºxmlé…ç½®çš„å±æ€§æ˜ å°„å·¥å…·ï¼Œå¯ç”¨äºæŠ¥æ–‡è½¬æ¢é€‚é…ã€‚"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-07T06:57:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·31827414958"/> <meta itemprop="url" content="https://juejin.cn/user/4325944384039072"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java åŸºäºxmlé…ç½®çš„å±æ€§æ˜ å°„å·¥å…·ï¼Œå¯ç”¨äºæŠ¥æ–‡è½¬æ¢é€‚é…ã€‚
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4325944384039072/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·31827414958
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T06:57:13.000Z" title="Sat Feb 07 2026 06:57:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€é¡¹ç›®ä»‹ç»</h2>
<h3 data-id="heading-1">1.1 é¡¹ç›®æ¦‚è¿°</h3>
<p>Bean Transfer æ˜¯ä¸€ä¸ªåŸºäº XML é…ç½®çš„å¯¹è±¡åˆ°å¯¹è±¡æ˜ å°„å·¥å…·ï¼Œä¸“ä¸ºå¤æ‚æŠ¥æ–‡è½¬æ¢åœºæ™¯è®¾è®¡ã€‚è¯¥æ¡†æ¶é€šè¿‡å£°æ˜å¼çš„ XML é…ç½®å®ç°å¯¹è±¡æ˜ å°„ï¼Œæ— éœ€ä¿®æ”¹å®ä½“ç±»å³å¯å®Œæˆå¤æ‚çš„è½¬æ¢é€»è¾‘ã€‚</p>
<p>é¡¹ç›®åœ°å€: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fjjjxxx%2Fbean-transfer" target="_blank" title="https://gitee.com/jjjxxx/bean-transfer" ref="nofollow noopener noreferrer">bean-transfer: åŸºäºé…ç½®æ–‡ä»¶å®ç°å±æ€§å¤åˆ¶ï¼ŒåŸºäºSPEL,æ”¯æŒå¤æ‚è¡¨è¾¾å¼ã€‚</a></p>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>æŠ¥æ–‡è½¬æ¢ï¼ˆå¦‚ HTTP è¯·æ±‚/å“åº”è½¬æ¢ï¼‰</li>
<li>å¼‚æ„ç³»ç»Ÿä¹‹é—´çš„æ•°æ®å¯¹æ¥</li>
<li>éœ€è¦é¢‘ç¹å˜åŒ–çš„å­—æ®µæ˜ å°„å…³ç³»</li>
<li>è·¨å±‚çº§ã€åµŒå¥—å¯¹è±¡çš„å¤æ‚æ˜ å°„</li>
</ul>
<p><strong>ä¸é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>ç®€å•çš„ Bean å±æ€§å¤åˆ¶ï¼ˆæ¨èä½¿ç”¨ BeanUtilsã€MapStruct ç­‰å·¥å…·ï¼‰</li>
<li>æ€§èƒ½æ•æ„Ÿçš„åœºæ™¯ï¼ˆåå°„æœºåˆ¶æœ‰ä¸€å®šæ€§èƒ½å¼€é”€ï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-2">äºŒã€æ ¸å¿ƒç‰¹æ€§</h2>
<h3 data-id="heading-3">2.1 ä¸»è¦åŠŸèƒ½</h3>
<p>âœ… <strong>XML é…ç½®é©±åŠ¨</strong>ï¼šé€šè¿‡ XML æ–‡ä»¶å®šä¹‰æ˜ å°„è§„åˆ™ï¼Œé›¶ä¾µå…¥å®ä½“ç±»
âœ… <strong>å¤æ‚çš„è·¯å¾„è§£æ</strong>ï¼šæ”¯æŒ SpEL è¡¨è¾¾å¼ã€å¤šå±‚åµŒå¥—è·¯å¾„è®¿é—®
âœ… <strong>ä¸Šä¸‹æ–‡å˜é‡</strong>ï¼šæ”¯æŒ <code>current</code> å’Œ <code>_</code> ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå®ç°è·¨å±‚çº§è®¿é—®
âœ… <strong>çµæ´»çš„å€¼å¤„ç†</strong>ï¼šæ”¯æŒå›ºå®šå€¼ã€å˜é‡å¼•ç”¨ã€SpEL è¡¨è¾¾å¼
âœ… <strong>è‡ªå®šä¹‰è½¬æ¢å™¨</strong>ï¼šæä¾›æ‰©å±•ç‚¹ï¼Œæ”¯æŒè‡ªå®šä¹‰è½¬æ¢é€»è¾‘
âœ… <strong>Spring é›†æˆ</strong>ï¼šæä¾› Spring Boot Starterï¼Œå¼€ç®±å³ç”¨
âœ… <strong>ç±»å‹å®‰å…¨</strong>ï¼šæ”¯æŒç±»å‹è½¬æ¢å’ŒéªŒè¯
âœ… <strong>é›†åˆæ˜ å°„</strong>ï¼šæ”¯æŒæ•°ç»„ã€Listã€Set ç­‰é›†åˆç±»å‹çš„æ˜ å°„</p>
<hr/>
<h2 data-id="heading-4">ä¸‰ã€å¿«é€Ÿå¼€å§‹</h2>
<h3 data-id="heading-5">3.1 Maven ä¾èµ–</h3>
<h4 data-id="heading-6">Spring Boot é¡¹ç›®ï¼ˆæ¨èï¼‰</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.hongri<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>bean-transfer-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.2-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h4 data-id="heading-7">æ™®é€š Spring é¡¹ç›®</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.hongri<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>bean-transfer-spring<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.2-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h4 data-id="heading-8">ç‹¬ç«‹ä½¿ç”¨</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.hongri<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>bean-transfer-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.2-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 data-id="heading-9">3.2 é…ç½®æ–‡ä»¶ä½ç½®</h3>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¡†æ¶ä¼šä» <code>classpath:mappingConfiguration/</code> ç›®å½•ä¸‹åŠ è½½ XML é…ç½®æ–‡ä»¶ã€‚</p>
<p>å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ä½ç½®ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomLoaderConfig</span> {
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> MappingConfigurationLoader <span class="hljs-title function_">mappingConfigurationLoader</span><span class="hljs-params">(
            MappingConfigurationParser parser)</span> {
        <span class="hljs-comment">// è‡ªå®šä¹‰é…ç½®æ–‡ä»¶è·¯å¾„</span>
        List&lt;String&gt; basePackages = Arrays.asList(
            <span class="hljs-string">"mappingConfiguration"</span>,
            <span class="hljs-string">"customMappingConfig"</span>
        );
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XmlMappingConfigurationLoader</span>(parser, basePackages);
    }
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> MappingConfigurationFactory <span class="hljs-title function_">mappingConfigurationFactory</span><span class="hljs-params">(
            MappingConfigurationLoader loader)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">DefaultMappingConfigurationFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span>
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultMappingConfigurationFactory</span>(loader);
        factory.loadConfiguration(); <span class="hljs-comment">// åŠ è½½æ‰€æœ‰é…ç½®</span>
        <span class="hljs-keyword">return</span> factory;
    }
}
</code></pre>
<h3 data-id="heading-10">3.3 Hello World ç¤ºä¾‹</h3>
<h4 data-id="heading-11">æ­¥éª¤ 1ï¼šå®šä¹‰å®ä½“ç±»</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æºå¯¹è±¡</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDTO</span> {
    <span class="hljs-keyword">private</span> String userName;
    <span class="hljs-keyword">private</span> Integer userAge;
    <span class="hljs-keyword">private</span> String userAddress;

    <span class="hljs-comment">// getters and setters</span>
}

<span class="hljs-comment">// ç›®æ ‡å¯¹è±¡</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserVO</span> {
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> Integer age;
    <span class="hljs-keyword">private</span> String address;

    <span class="hljs-comment">// getters and setters</span>
}
</code></pre>
<h4 data-id="heading-12">æ­¥éª¤ 2ï¼šåˆ›å»ºæ˜ å°„é…ç½®</h4>
<p>å°†ä»¥ä¸‹å†…å®¹ä¿å­˜åˆ° <code>src/main/resources/mappingConfiguration/user-mapping.xml</code>ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mappingConfiguration</span>
    <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"https://hongri.com.cn/mapping"</span>
    <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.UserVO"</span>
    <span class="hljs-attr">namespace</span>=<span class="hljs-string">"user-mapping"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"userName"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"age"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"userAge"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"address"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"userAddress"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mappingConfiguration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-13">æ­¥éª¤ 3ï¼šä½¿ç”¨è½¬æ¢å™¨</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> ConfigurationObjectTransferBuilder transferBuilder;

<span class="hljs-keyword">public</span> UserVO <span class="hljs-title function_">convertUser</span><span class="hljs-params">(UserDTO dto)</span> {
    ObjectTransfer&lt;Object, Object&gt; transfer =
        transferBuilder.buildObjectTransfer(<span class="hljs-string">"user-mapping"</span>);
    <span class="hljs-keyword">return</span> (UserVO) transfer.transfer(dto);
}
</code></pre>
<hr/>
<h2 data-id="heading-14">å››ã€é…ç½®è¯´æ˜</h2>
<h3 data-id="heading-15">4.1 é…ç½®æ–‡ä»¶ç»“æ„</h3>
<h4 data-id="heading-16">å®Œæ•´é…ç½®ç¤ºä¾‹</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mappingConfiguration</span> 
    <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"https://hongri.com.cn/mapping"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.TargetClass"</span>
    <span class="hljs-attr">namespace</span>=<span class="hljs-string">"unique-namespace"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"https://hongri.com.cn/mapping https://hongri.com.cn/path/to/mapping.xsd"</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- å­—æ®µæ˜ å°„ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> 
        <span class="hljs-attr">target</span>=<span class="hljs-string">"targetField"</span> 
        <span class="hljs-attr">source</span>=<span class="hljs-string">"sourceField"</span> 
        <span class="hljs-attr">value</span>=<span class="hljs-string">"fixedValue"</span> 
        <span class="hljs-attr">escape-class</span>=<span class="hljs-string">"com.example.EscapeHandler"</span>
        <span class="hljs-attr">converter-class</span>=<span class="hljs-string">"com.example.Converter"</span>/&gt;</span>
    
    <span class="hljs-comment">&lt;!-- å¯¹è±¡æ˜ å°„ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">object-mapping</span> 
        <span class="hljs-attr">target</span>=<span class="hljs-string">"targetObject"</span> 
        <span class="hljs-attr">source</span>=<span class="hljs-string">"sourceObject"</span>
        <span class="hljs-attr">target-class</span>=<span class="hljs-string">"com.example.NestedClass"</span>
        <span class="hljs-attr">converter-class</span>=<span class="hljs-string">"com.example.Converter"</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- åµŒå¥—æ˜ å°„ --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">object-mapping</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- æ•°ç»„æ˜ å°„ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">array-mapping</span> 
        <span class="hljs-attr">target</span>=<span class="hljs-string">"targetArray"</span> 
        <span class="hljs-attr">source</span>=<span class="hljs-string">"sourceArray"</span> 
        <span class="hljs-attr">item-class</span>=<span class="hljs-string">"com.example.ItemClass"</span>
        <span class="hljs-attr">target-class</span>=<span class="hljs-string">"com.example.TargetArrayClass"</span>
        <span class="hljs-attr">converter-class</span>=<span class="hljs-string">"com.example.Converter"</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- æ•°ç»„é¡¹æ˜ å°„ --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">array-mapping</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mappingConfiguration</span>&gt;</span>
</code></pre>
<h3 data-id="heading-17">4.2 é…ç½®æ ‡ç­¾è¯¦è§£</h3>
<h4 data-id="heading-18">mappingConfigurationï¼ˆæ ¹æ ‡ç­¾ï¼‰</h4>




















<table><thead><tr><th>å±æ€§</th><th>å¿…å¡«</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>class</code></td><td>æ˜¯</td><td>ç›®æ ‡å®ä½“ç±»çš„å…¨é™å®šåæˆ–ç®€å†™ï¼ˆå¦‚ <code>map</code>ï¼‰</td></tr><tr><td><code>namespace</code></td><td>æ˜¯</td><td>å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºåŠ è½½å’Œç®¡ç†é…ç½®</td></tr></tbody></table>
<h4 data-id="heading-19">field-mappingï¼ˆå­—æ®µæ˜ å°„ï¼‰</h4>















































<table><thead><tr><th>å±æ€§</th><th>å¿…å¡«</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>target</code></td><td>æ˜¯</td><td>ç›®æ ‡å­—æ®µè·¯å¾„ï¼Œæ”¯æŒ SpEL</td><td><code>userInfo.name</code></td></tr><tr><td><code>source</code></td><td>å¦</td><td>æºå­—æ®µè·¯å¾„ï¼Œæ”¯æŒ SpEL</td><td><code>data.user.name</code></td></tr><tr><td><code>value</code></td><td>å¦</td><td>å›ºå®šå€¼ï¼Œæ”¯æŒ <code>${}</code> å˜é‡</td><td><code>${requestId}</code></td></tr><tr><td><code>escape-class</code></td><td>å¦</td><td>å€¼è½¬ä¹‰å¤„ç†ç±»å…¨é™å®šå</td><td><code>com.example.EscapeHandler</code></td></tr><tr><td><code>target-class</code></td><td>å¦</td><td>ç›®æ ‡å­—æ®µç±»å‹ï¼Œé€šå¸¸ä¸éœ€è¦å¡«å†™</td><td><code>java.lang.String</code></td></tr><tr><td><code>converter-class</code></td><td>å¦</td><td>è‡ªå®šä¹‰è½¬æ¢å™¨ç±»</td><td><code>com.example.CustomConverter</code></td></tr></tbody></table>
<h4 data-id="heading-20">object-mappingï¼ˆå¯¹è±¡æ˜ å°„ï¼‰</h4>






























<table><thead><tr><th>å±æ€§</th><th>å¿…å¡«</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>target</code></td><td>æ˜¯</td><td>ç›®æ ‡å¯¹è±¡å­—æ®µè·¯å¾„</td></tr><tr><td><code>source</code></td><td>æ˜¯</td><td>æºå¯¹è±¡å­—æ®µè·¯å¾„</td></tr><tr><td><code>target-class</code></td><td>å¦</td><td>ç›®æ ‡å¯¹è±¡ç±»å‹</td></tr><tr><td><code>converter-class</code></td><td>å¦</td><td>è‡ªå®šä¹‰è½¬æ¢å™¨ç±»</td></tr></tbody></table>
<h4 data-id="heading-21">array-mappingï¼ˆæ•°ç»„æ˜ å°„ï¼‰</h4>



































<table><thead><tr><th>å±æ€§</th><th>å¿…å¡«</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>target</code></td><td>æ˜¯</td><td>ç›®æ ‡é›†åˆå­—æ®µè·¯å¾„</td></tr><tr><td><code>source</code></td><td>æ˜¯</td><td>æºé›†åˆå­—æ®µè·¯å¾„</td></tr><tr><td><code>item-class</code></td><td>æ˜¯</td><td>é›†åˆå…ƒç´ ç±»å‹</td></tr><tr><td><code>target-class</code></td><td>å¦</td><td>ç›®æ ‡å¯¹è±¡ç±»å‹</td></tr><tr><td><code>converter-class</code></td><td>å¦</td><td>è‡ªå®šä¹‰è½¬æ¢å™¨ç±»</td></tr></tbody></table>
<h3 data-id="heading-22">4.3 å…³é”®æ¦‚å¿µè¯´æ˜</h3>
<h4 data-id="heading-23">ä¸Šä¸‹æ–‡å¯¹è±¡</h4>
<p>åœ¨æ˜ å°„è¿‡ç¨‹ä¸­ï¼Œæ¡†æ¶æä¾›äº†ä¸¤ä¸ªç‰¹æ®Šçš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼š</p>
<p><strong><code>current</code></strong>ï¼šå½“å‰æ­£åœ¨å¤„ç†çš„å¤–å±‚å¯¹è±¡</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- ç¤ºä¾‹ï¼šå°†æ•´ä¸ªä¸Šçº§å¯¹è±¡ä¼ é€’ç»™åµŒå¥—å¯¹è±¡ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">object-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"hotelInfo"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"hotelInfo"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"current.name"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">object-mapping</span>&gt;</span>
</code></pre>
<p><strong><code>_</code></strong>ï¼šå½“å‰å¤„ç†å¯¹è±¡çš„ä¸Šçº§å¯¹è±¡</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- ç¤ºä¾‹ï¼šè·¨å±‚çº§è®¿é—®çˆ¶çº§å±æ€§ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">object-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"data"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"data"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">object-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"hotelInfo"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"hotelInfo"</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- è®¿é—®çˆ¶çº§ data å¯¹è±¡çš„ hotelId --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"hotelId"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"_.hotelId"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">object-mapping</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">object-mapping</span>&gt;</span>
</code></pre>
<h4 data-id="heading-24">è·¯å¾„è§£æç¤ºä¾‹</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- è§£æçˆ¶çº§å¯¹è±¡çš„çˆ¶çº§å¯¹è±¡çš„ hotelId --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">object-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"data"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"data"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">object-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"hotelInfo"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"hotelInfo"</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- _.hotelId = data.hotelIdï¼Œ_ å³ data --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"hotelId"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"_.hotelId"</span>/&gt;</span>
        <span class="hljs-comment">&lt;!-- current.name = name = hotelInfo.nameï¼Œcurrent å³ hotelInfo --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"current.name"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">object-mapping</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">object-mapping</span>&gt;</span>
</code></pre>
<h4 data-id="heading-25">åŠ¨æ€å€¼å¤„ç†</h4>
<p><strong>SpEL è¡¨è¾¾å¼ï¼š</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- æ¡ä»¶åˆ¤æ–­ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"isAvailable"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"stock &gt; 0"</span>/&gt;</span>
<span class="hljs-comment">&lt;!-- å­—ç¬¦ä¸²æ‹¼æ¥ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"fullName"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"firstName + ' ' + lastName"</span>/&gt;</span>
<span class="hljs-comment">&lt;!-- ä¸‰å…ƒè¡¨è¾¾å¼ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"statusText"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"status == 1 ? 'æ¿€æ´»' : 'æœªæ¿€æ´»'"</span>/&gt;</span>
</code></pre>
<p><strong>å›ºå®šå€¼ï¼š</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"currency"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"CNY"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"version"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"1.0"</span>/&gt;</span>
</code></pre>
<p><strong>å˜é‡å¼•ç”¨ï¼š</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- ä½¿ç”¨ä¸Šä¸‹æ–‡å˜é‡ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"requestId"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"${requestId}"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"timestamp"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"${currentTime}"</span>/&gt;</span>
</code></pre>
<p><strong>å¤æ‚é›†åˆå¤„ç†ï¼š</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- ä½¿ç”¨ flatMap å±•å¹³åµŒå¥—æ•°ç»„ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">array-mapping</span> 
    <span class="hljs-attr">target</span>=<span class="hljs-string">"amenities"</span> 
    <span class="hljs-attr">source</span>=<span class="hljs-string">"#flatMap(features?.![amenities])"</span>
    <span class="hljs-attr">item-class</span>=<span class="hljs-string">"com.example.Amenity"</span>/&gt;</span>
</code></pre>
<h4 data-id="heading-26">ç±»åç®€å†™</h4>
<p>ä¸ºç®€åŒ–é…ç½®ï¼Œæ”¯æŒä»¥ä¸‹ç±»åç®€å†™ï¼š</p>

























<table><thead><tr><th>ç®€å†™</th><th>å®é™…ç±»å</th></tr></thead><tbody><tr><td><code>map</code></td><td><code>java.util.LinkedHashMap</code></td></tr><tr><td><code>hmap</code></td><td><code>java.util.HashMap</code></td></tr><tr><td><code>list</code></td><td><code>java.util.ArrayList</code></td></tr><tr><td><code>set</code></td><td><code>java.util.HashSet</code></td></tr></tbody></table>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- ä½¿ç”¨ç®€å†™ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mappingConfiguration</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"map"</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"example"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">object-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"data"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"response"</span> <span class="hljs-attr">target-class</span>=<span class="hljs-string">"map"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mappingConfiguration</span>&gt;</span>
</code></pre>
<hr/>
<h2 data-id="heading-27">äº”ã€ä½¿ç”¨æŒ‡å—</h2>
<h3 data-id="heading-28">5.1 Spring Boot é›†æˆ</h3>
<h4 data-id="heading-29">è‡ªåŠ¨é…ç½®</h4>
<p>å¼•å…¥ <code>bean-transfer-starter</code> åï¼Œæ¡†æ¶ä¼šè‡ªåŠ¨é…ç½®ä»¥ä¸‹ Beanï¼š</p>
<ul>
<li><code>MappingConfigurationParser</code>ï¼šXML é…ç½®è§£æå™¨</li>
<li><code>MappingConfigurationLoader</code>ï¼šé…ç½®åŠ è½½å™¨</li>
<li><code>MappingConfigurationFactory</code>ï¼šé…ç½®å·¥å‚</li>
<li><code>BeanCopierConfiguration</code>ï¼šå…¨å±€é…ç½®</li>
<li><code>ConfigurationObjectTransferBuilder</code>ï¼šè½¬æ¢å™¨æ„å»ºå™¨</li>
</ul>
<h4 data-id="heading-30">é…ç½®æ–‡ä»¶ä½ç½®</h4>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒXML é…ç½®æ–‡ä»¶åº”æ”¾ç½®åœ¨ <code>classpath:mappingConfiguration/</code> ç›®å½•ä¸‹ã€‚</p>
<h4 data-id="heading-31">è‡ªå®šä¹‰é…ç½®</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomCopierConfig</span> {
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> CustomFunctionProvider <span class="hljs-title function_">customFunctionProvider</span><span class="hljs-params">()</span> {
        Map&lt;String, Object&gt; functions = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        functions.put(<span class="hljs-string">"formatDate"</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">DateFormatter</span>());
        <span class="hljs-keyword">return</span> () -&gt; functions;
    }
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> TypeConverter <span class="hljs-title function_">customTypeConverter</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyCustomConverter</span>();
    }
}
</code></pre>
<h3 data-id="heading-32">5.2 åŸºæœ¬ä½¿ç”¨</h3>
<h4 data-id="heading-33">æ„å»º ObjectTransfer</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> ConfigurationObjectTransferBuilder transferBuilder;

<span class="hljs-comment">// æ–¹å¼ 1ï¼šä½¿ç”¨ namespace æ„å»º</span>
ObjectTransfer&lt;Object, Object&gt; transfer =
    transferBuilder.buildObjectTransfer(<span class="hljs-string">"namespace-name"</span>);

<span class="hljs-comment">// æ–¹å¼ 2ï¼šå¸¦ä¸Šä¸‹æ–‡æ„å»º</span>
Map&lt;String, Object&gt; context = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
context.put(<span class="hljs-string">"requestId"</span>, <span class="hljs-string">"123456"</span>);
ObjectTransfer&lt;Object, Object&gt; transfer =
    transferBuilder.buildObjectTransfer(<span class="hljs-string">"namespace-name"</span>, context);

<span class="hljs-comment">// æ–¹å¼ 3ï¼šä½¿ç”¨è‡ªå®šä¹‰ EvaluationContext</span>
<span class="hljs-type">EvaluationContext</span> <span class="hljs-variable">evaluationContext</span> <span class="hljs-operator">=</span> ...;
ObjectTransfer&lt;Object, Object&gt; transfer =
    transferBuilder.buildObjectTransfer(<span class="hljs-string">"namespace-name"</span>, context, evaluationContext);
</code></pre>
<h4 data-id="heading-34">æ‰§è¡Œè½¬æ¢</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç®€å•è½¬æ¢</span>
<span class="hljs-type">SourceObject</span> <span class="hljs-variable">source</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SourceObject</span>();
<span class="hljs-type">TargetObject</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> (TargetObject) transfer.transfer(source);

<span class="hljs-comment">// å¸¦ Map ä¸Šä¸‹æ–‡çš„è½¬æ¢</span>
Map&lt;String, Object&gt; contextMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
contextMap.put(<span class="hljs-string">"userId"</span>, <span class="hljs-string">"user001"</span>);
contextMap.put(<span class="hljs-string">"requestId"</span>, UUID.randomUUID().toString());

<span class="hljs-type">SourceObject</span> <span class="hljs-variable">source</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SourceObject</span>();
<span class="hljs-type">TargetObject</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> (TargetObject) transfer.transfer(source);
</code></pre>
<h3 data-id="heading-35">5.3 è‡ªå®šä¹‰è½¬æ¢å™¨</h3>
<h4 data-id="heading-36">å®ç° TypeConverter æ¥å£</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCustomConverter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TypeConverter</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supports</span><span class="hljs-params">(Class&lt;?&gt; sourceType, Class&lt;?&gt; targetType)</span> {
        <span class="hljs-keyword">return</span> targetType == CustomType.class;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">convert</span><span class="hljs-params">(Object source, Class&lt;?&gt; targetType)</span> {
        <span class="hljs-keyword">if</span> (source == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        <span class="hljs-comment">// è‡ªå®šä¹‰è½¬æ¢é€»è¾‘</span>
        <span class="hljs-keyword">return</span> convertToCustomType(source);
    }
}
</code></pre>
<h4 data-id="heading-37">æ³¨å†Œè‡ªå®šä¹‰è½¬æ¢å™¨</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConverterConfig</span> {
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> TypeConverterFactory <span class="hljs-title function_">customTypeConverterFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-type">DefaultTypeConverterFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultTypeConverterFactory</span>();
        factory.registerConverter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyCustomConverter</span>());
        <span class="hljs-keyword">return</span> factory;
    }
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> BeanCopierConfiguration <span class="hljs-title function_">beanCopierConfiguration</span><span class="hljs-params">(
            TypeConverterFactory factory)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanCopierConfiguration</span>.Builder()
            .typeConverterFactory(factory)
            .build();
    }
}
</code></pre>
<h3 data-id="heading-38">5.4 è‡ªå®šä¹‰å‡½æ•°</h3>
<h4 data-id="heading-39">å®šä¹‰è‡ªå®šä¹‰å‡½æ•°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DateFormatter</span> {
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">format</span><span class="hljs-params">(Object date, String pattern)</span> {
        <span class="hljs-keyword">if</span> (date == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        <span class="hljs-type">SimpleDateFormat</span> <span class="hljs-variable">sdf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(pattern);
        <span class="hljs-keyword">return</span> sdf.format(date);
    }
}
</code></pre>
<h4 data-id="heading-40">æ³¨å†Œè‡ªå®šä¹‰å‡½æ•°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> CustomFunctionProvider <span class="hljs-title function_">customFunctionProvider</span><span class="hljs-params">()</span> {
    Map&lt;String, Object&gt; functions = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    functions.put(<span class="hljs-string">"formatDate"</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">DateFormatter</span>());
    functions.put(<span class="hljs-string">"encrypt"</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">EncryptFunction</span>());
    <span class="hljs-keyword">return</span> () -&gt; functions;
}
</code></pre>
<h4 data-id="heading-41">åœ¨ XML ä¸­ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•° --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> 
    <span class="hljs-attr">target</span>=<span class="hljs-string">"formattedDate"</span> 
    <span class="hljs-attr">source</span>=<span class="hljs-string">"#formatDate(birthday, 'yyyy-MM-dd')"</span>/&gt;</span>
</code></pre>
<h3 data-id="heading-42">5.5 è‡ªå®šä¹‰è½¬ä¹‰å¤„ç†å™¨</h3>
<h4 data-id="heading-43">å®ç° EscapeHandler</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">XssEscapeHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">EscapeHandler</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">escape</span><span class="hljs-params">(Object value)</span> {
        <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> String) {
            <span class="hljs-keyword">return</span> escapeHtml((String) value);
        }
        <span class="hljs-keyword">return</span> value;
    }
    
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">escapeHtml</span><span class="hljs-params">(String html)</span> {
        <span class="hljs-comment">// HTML è½¬ä¹‰é€»è¾‘</span>
        <span class="hljs-keyword">return</span> html.replace(<span class="hljs-string">"&lt;"</span>, <span class="hljs-string">"&amp;lt;"</span>)
                  .replace(<span class="hljs-string">"&gt;"</span>, <span class="hljs-string">"&amp;gt;"</span>);
    }
}
</code></pre>
<h4 data-id="heading-44">åœ¨ XML ä¸­ä½¿ç”¨</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> 
    <span class="hljs-attr">target</span>=<span class="hljs-string">"content"</span> 
    <span class="hljs-attr">source</span>=<span class="hljs-string">"rawContent"</span> 
    <span class="hljs-attr">escape-class</span>=<span class="hljs-string">"com.example.XssEscapeHandler"</span>/&gt;</span>
</code></pre>
<hr/>
<h2 data-id="heading-45">å…­ã€å®æˆ˜æ¡ˆä¾‹</h2>
<h3 data-id="heading-46">6.1 æ¡ˆä¾‹ 1ï¼šHTTP è¯·æ±‚å‚æ•°è½¬æ¢</h3>
<h4 data-id="heading-47">åœºæ™¯</h4>
<p>å°†å‰ç«¯ JSON è¯·æ±‚è½¬æ¢ä¸ºåç«¯ API è¯·æ±‚å¯¹è±¡ã€‚</p>
<h4 data-id="heading-48">æºå¯¹è±¡</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FrontendHotelRequest</span> {
    <span class="hljs-keyword">private</span> String hotelId;
    <span class="hljs-keyword">private</span> String startDate;
    <span class="hljs-keyword">private</span> String endDate;
    <span class="hljs-keyword">private</span> Integer guestCount;
    <span class="hljs-keyword">private</span> List&lt;String&gt; roomTypes;
    
    <span class="hljs-comment">// getters and setters</span>
}
</code></pre>
<h4 data-id="heading-49">ç›®æ ‡å¯¹è±¡</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BackendHotelRequest</span> {
    <span class="hljs-keyword">private</span> String hotelCode;
    <span class="hljs-keyword">private</span> Date checkInTime;
    <span class="hljs-keyword">private</span> Date checkOutTime;
    <span class="hljs-keyword">private</span> Integer numberOfGuests;
    <span class="hljs-keyword">private</span> List&lt;RoomTypeRequest&gt; rooms;
    
    <span class="hljs-comment">// getters and setters</span>
}
</code></pre>
<h4 data-id="heading-50">æ˜ å°„é…ç½®</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mappingConfiguration</span> 
    <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"https://hongri.com.cn/mapping"</span>
    <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.BackendHotelRequest"</span>
    <span class="hljs-attr">namespace</span>=<span class="hljs-string">"hotel-request-mapping"</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"hotelCode"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"hotelId"</span>/&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> 
        <span class="hljs-attr">target</span>=<span class="hljs-string">"checkInTime"</span> 
        <span class="hljs-attr">source</span>=<span class="hljs-string">"#parseDate(startDate, 'yyyy-MM-dd')"</span>/&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> 
        <span class="hljs-attr">target</span>=<span class="hljs-string">"checkOutTime"</span> 
        <span class="hljs-attr">source</span>=<span class="hljs-string">"#parseDate(endDate, 'yyyy-MM-dd')"</span>/&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"numberOfGuests"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"guestCount"</span>/&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">array-mapping</span> 
        <span class="hljs-attr">target</span>=<span class="hljs-string">"rooms"</span> 
        <span class="hljs-attr">source</span>=<span class="hljs-string">"roomTypes"</span> 
        <span class="hljs-attr">item-class</span>=<span class="hljs-string">"com.example.RoomTypeRequest"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"roomType"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"current"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"quantity"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"1"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">array-mapping</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mappingConfiguration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-51">ä½¿ç”¨ä»£ç </h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HotelService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ConfigurationObjectTransferBuilder transferBuilder;

    <span class="hljs-keyword">public</span> BackendHotelRequest <span class="hljs-title function_">convertRequest</span><span class="hljs-params">(FrontendHotelRequest frontendRequest)</span> {
        ObjectTransfer&lt;Object, Object&gt; transfer =
            transferBuilder.buildObjectTransfer(<span class="hljs-string">"hotel-request-mapping"</span>);
        <span class="hljs-keyword">return</span> (BackendHotelRequest) transfer.transfer(frontendRequest);
    }
}
</code></pre>
<h3 data-id="heading-52">6.2 æ¡ˆä¾‹ 2ï¼šå¤æ‚æŠ¥æ–‡å“åº”è½¬æ¢</h3>
<h4 data-id="heading-53">åœºæ™¯</h4>
<p>å°†ç¬¬ä¸‰æ–¹ API å“åº”è½¬æ¢ä¸ºå†…éƒ¨ç»Ÿä¸€çš„å“åº”æ ¼å¼ã€‚</p>
<h4 data-id="heading-54">ç¬¬ä¸‰æ–¹å“åº”</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThirdPartyResponse</span> {
    <span class="hljs-keyword">private</span> Integer returnCode;
    <span class="hljs-keyword">private</span> String returnMsg;
    <span class="hljs-keyword">private</span> ResponseData response;
    
    <span class="hljs-comment">// getters and setters</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ResponseData</span> {
        <span class="hljs-keyword">private</span> List&lt;HotelInfo&gt; hotels;
        <span class="hljs-keyword">private</span> Integer totalCount;
        <span class="hljs-keyword">private</span> PageInfo pagination;
        
        <span class="hljs-comment">// getters and setters</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HotelInfo</span> {
        <span class="hljs-keyword">private</span> String id;
        <span class="hljs-keyword">private</span> String name;
        <span class="hljs-keyword">private</span> Double lat;
        <span class="hljs-keyword">private</span> Double lng;
        <span class="hljs-keyword">private</span> Location location;
        <span class="hljs-keyword">private</span> Integer stock;
        <span class="hljs-keyword">private</span> BigDecimal price;
        
        <span class="hljs-comment">// getters and setters</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Location</span> {
        <span class="hljs-keyword">private</span> String city;
        <span class="hljs-keyword">private</span> String province;
        <span class="hljs-keyword">private</span> String country;
        
        <span class="hljs-comment">// getters and setters</span>
    }
}
</code></pre>
<h4 data-id="heading-55">å†…éƒ¨å“åº”</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HotelDetailResponse</span> {
    <span class="hljs-keyword">private</span> Integer code;
    <span class="hljs-keyword">private</span> String message;
    <span class="hljs-keyword">private</span> HotelData data;
    
    <span class="hljs-comment">// getters and setters</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HotelData</span> {
        <span class="hljs-keyword">private</span> List&lt;HotelInfoDTO&gt; hotels;
        <span class="hljs-keyword">private</span> Integer total;
        <span class="hljs-keyword">private</span> PageInfoDTO page;
        
        <span class="hljs-comment">// getters and setters</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HotelInfoDTO</span> {
        <span class="hljs-keyword">private</span> String hotelId;
        <span class="hljs-keyword">private</span> String hotelName;
        <span class="hljs-keyword">private</span> Address address;
        <span class="hljs-keyword">private</span> Boolean isAvailable;
        <span class="hljs-keyword">private</span> String price;
        
        <span class="hljs-comment">// getters and setters</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Address</span> {
        <span class="hljs-keyword">private</span> String city;
        <span class="hljs-keyword">private</span> Coordinates coordinates;
        
        <span class="hljs-comment">// getters and setters</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Coordinates</span> {
        <span class="hljs-keyword">private</span> Double latitude;
        <span class="hljs-keyword">private</span> Double longitude;
        
        <span class="hljs-comment">// getters and setters</span>
    }
}
</code></pre>
<h4 data-id="heading-56">æ˜ å°„é…ç½®</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mappingConfiguration</span> 
    <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"https://hongri.com.cn/mapping"</span>
    <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.HotelDetailResponse"</span>
    <span class="hljs-attr">namespace</span>=<span class="hljs-string">"hotel-response-mapping"</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- åŸºç¡€å­—æ®µæ˜ å°„ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"code"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"returnCode"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"message"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"returnMsg"</span>/&gt;</span>
    
    <span class="hljs-comment">&lt;!-- åµŒå¥—å¯¹è±¡æ˜ å°„ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">object-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"data"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"response"</span> <span class="hljs-attr">target-class</span>=<span class="hljs-string">"com.example.HotelDetailResponse.HotelData"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"total"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"totalCount"</span>/&gt;</span>
        
        <span class="hljs-comment">&lt;!-- æ•°ç»„æ˜ å°„ --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">array-mapping</span> 
            <span class="hljs-attr">target</span>=<span class="hljs-string">"hotels"</span> 
            <span class="hljs-attr">source</span>=<span class="hljs-string">"hotels"</span> 
            <span class="hljs-attr">item-class</span>=<span class="hljs-string">"com.example.HotelDetailResponse.HotelInfoDTO"</span>&gt;</span>
            
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"hotelId"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"id"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"hotelName"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"name"</span>/&gt;</span>
            
            <span class="hljs-comment">&lt;!-- æ¡ä»¶åˆ¤æ–­ --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"isAvailable"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"stock &gt; 0"</span>/&gt;</span>
            
            <span class="hljs-comment">&lt;!-- ä»·æ ¼æ ¼å¼åŒ– --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"price"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"#formatPrice(price)"</span>/&gt;</span>
            
            <span class="hljs-comment">&lt;!-- åµŒå¥—å¯¹è±¡æ˜ å°„ --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">object-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"address"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"current"</span> <span class="hljs-attr">target-class</span>=<span class="hljs-string">"com.example.HotelDetailResponse.Address"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"city"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"location.city"</span>/&gt;</span>
                
                <span class="hljs-comment">&lt;!-- åæ ‡æ˜ å°„ --&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">object-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"coordinates"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"current"</span> <span class="hljs-attr">target-class</span>=<span class="hljs-string">"com.example.HotelDetailResponse.Coordinates"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"latitude"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"lat"</span>/&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"longitude"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"lng"</span>/&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">object-mapping</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">object-mapping</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">array-mapping</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">object-mapping</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mappingConfiguration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-57">ä½¿ç”¨ä»£ç </h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HotelIntegrationService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ConfigurationObjectTransferBuilder transferBuilder;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ThirdPartyApiClient apiClient;
    
    <span class="hljs-keyword">public</span> HotelDetailResponse <span class="hljs-title function_">getHotelDetails</span><span class="hljs-params">(String hotelId)</span> {
        <span class="hljs-comment">// è°ƒç”¨ç¬¬ä¸‰æ–¹ API</span>
        <span class="hljs-type">ThirdPartyResponse</span> <span class="hljs-variable">thirdPartyResponse</span> <span class="hljs-operator">=</span> apiClient.queryHotel(hotelId);

        <span class="hljs-comment">// è½¬æ¢å“åº”</span>
        ObjectTransfer&lt;Object, Object&gt; transfer =
            transferBuilder.buildObjectTransfer(<span class="hljs-string">"hotel-response-mapping"</span>);
        <span class="hljs-keyword">return</span> (HotelDetailResponse) transfer.transfer(thirdPartyResponse);
    }
}
</code></pre>
<h3 data-id="heading-58">6.3 æ¡ˆä¾‹ 3ï¼šè®¢å•æŠ¥æ–‡è½¬æ¢</h3>
<h4 data-id="heading-59">åœºæ™¯</h4>
<p>å°†ä¸šåŠ¡ç³»ç»Ÿè®¢å•å“åº”è½¬æ¢ä¸ºå‰ç«¯å±•ç¤ºçš„è®¢å•è¯¦æƒ…ã€‚</p>
<h4 data-id="heading-60">é…ç½®æ–‡ä»¶</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mappingConfiguration</span> 
    <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"https://hongri.com.cn/mapping"</span>
    <span class="hljs-attr">class</span>=<span class="hljs-string">"com.citicbank.btsphs.laas.api.tmc.dto.order.detail.OrderDetailResponse"</span>
    <span class="hljs-attr">namespace</span>=<span class="hljs-string">"order-detail-mapping"</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">object-mapping</span> 
        <span class="hljs-attr">source</span>=<span class="hljs-string">"bussinessResponse"</span> 
        <span class="hljs-attr">target</span>=<span class="hljs-string">"data"</span> 
        <span class="hljs-attr">target-class</span>=<span class="hljs-string">"com.citicbank.btsphs.laas.api.tmc.dto.order.detail.OrderDetailResult"</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- åŸºç¡€ä¿¡æ¯ --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">object-mapping</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"current"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"baseInfo"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"coOrderCode"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"orderId"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"fcOrderCode"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"distributorOrderId"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"totalAmount"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"totalPrice"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"orderStatus"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"orderStatus"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">object-mapping</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- é¢„çº¦ä¿¡æ¯ --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">object-mapping</span> 
            <span class="hljs-attr">source</span>=<span class="hljs-string">"current"</span> 
            <span class="hljs-attr">target</span>=<span class="hljs-string">"aptInfo"</span> 
            <span class="hljs-attr">target-class</span>=<span class="hljs-string">"com.citicbank.btsphs.laas.api.tmc.dto.order.detail.OrderAptInfo"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"coOrderCode"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"orderId"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"checkInDate"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"checkinTime"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"checkOutDate"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"checkoutTime"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"arriveTime"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"arriveTime"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"roomName"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"roomName"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"roomId"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"realRoomId"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"roomNum"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"roomCount"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"hotelId"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"hotelId"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"hotelName"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"hotelName"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"linkMan"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"personNames"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"linkMan"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"contactName"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"linkPhone"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"contactPhone"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">object-mapping</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- æˆ¿æ™šä¿¡æ¯ --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">array-mapping</span> 
            <span class="hljs-attr">item-class</span>=<span class="hljs-string">"com.citicbank.btsphs.laas.api.tmc.dto.order.detail.RoomNightInfo"</span> 
            <span class="hljs-attr">source</span>=<span class="hljs-string">"priceItems"</span> 
            <span class="hljs-attr">target</span>=<span class="hljs-string">"roomNights"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"saleDate"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"bizDate"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"salePrice"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"sellPrice"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">array-mapping</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">object-mapping</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mappingConfiguration</span>&gt;</span>
</code></pre>
<h3 data-id="heading-61">6.4 æ¡ˆä¾‹ 4ï¼šè¯·æ±‚æŠ¥æ–‡ç”Ÿæˆï¼ˆMap è½¬æ¢ï¼‰</h3>
<h4 data-id="heading-62">åœºæ™¯</h4>
<p>å°†å‰ç«¯è¯·æ±‚å¯¹è±¡è½¬æ¢ä¸ºåç«¯ API éœ€è¦çš„ Map æ ¼å¼ã€‚</p>
<h4 data-id="heading-63">é…ç½®æ–‡ä»¶</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mappingConfiguration</span> 
    <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"https://hongri.com.cn/mapping"</span>
    <span class="hljs-attr">class</span>=<span class="hljs-string">"map"</span>
    <span class="hljs-attr">namespace</span>=<span class="hljs-string">"hotel-query-request"</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">object-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"businessRequest"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"current"</span> <span class="hljs-attr">target-class</span>=<span class="hljs-string">"map"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"hotelIds"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"hotelIds"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> 
            <span class="hljs-attr">target</span>=<span class="hljs-string">"settings"</span> 
            <span class="hljs-attr">source</span>=<span class="hljs-string">"include?:{'hotelFacilityNew','hotelPolicysNew','breakfast','importantNotices','parking'}"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">object-mapping</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">object-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"header"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"current"</span> <span class="hljs-attr">target-class</span>=<span class="hljs-string">"map"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"partnerCode"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"P10000001"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"requestType"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"createOrder"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"signature"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"${signature}"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"timestamp"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"${currentTime}"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"gzip"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"0"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">object-mapping</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mappingConfiguration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-64">ä½¿ç”¨ä»£ç </h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HotelQueryService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ConfigurationObjectTransferBuilder transferBuilder;
    
    <span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title function_">buildQueryRequest</span><span class="hljs-params">(HotelQueryDTO query)</span> {
        <span class="hljs-comment">// å‡†å¤‡ä¸Šä¸‹æ–‡å˜é‡</span>
        Map&lt;String, Object&gt; context = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        context.put(<span class="hljs-string">"signature"</span>, generateSignature(query));
        context.put(<span class="hljs-string">"currentTime"</span>, System.currentTimeMillis());

        <span class="hljs-comment">// æ‰§è¡Œè½¬æ¢</span>
        ObjectTransfer&lt;Object, Object&gt; transfer =
            transferBuilder.buildObjectTransfer(<span class="hljs-string">"hotel-query-request"</span>, context);
        <span class="hljs-keyword">return</span> (Map&lt;String, Object&gt;) transfer.transfer(query);
    }
    
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">generateSignature</span><span class="hljs-params">(HotelQueryDTO query)</span> {
        <span class="hljs-comment">// ç­¾åé€»è¾‘</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"generated-signature"</span>;
    }
}
</code></pre>
<h3 data-id="heading-65">6.5 æ¡ˆä¾‹ 5ï¼šå¤æ‚åµŒå¥—å’Œæ•°ç»„å±•å¹³</h3>
<h4 data-id="heading-66">åœºæ™¯</h4>
<p>å°†å¤æ‚çš„ç¬¬ä¸‰æ–¹é…’åº—å“åº”è½¬æ¢ä¸ºå†…éƒ¨æ ¼å¼ï¼Œå±•ç¤ºæ·±å±‚åµŒå¥—å¯¹è±¡æ˜ å°„ã€æ•°ç»„ç´¢å¼•è®¿é—®ã€å¤æ‚ SpEL è¡¨è¾¾å¼ç­‰é«˜çº§ç”¨æ³•ã€‚</p>
<h4 data-id="heading-67">é…ç½®æ–‡ä»¶ï¼ˆåŸºäºå®é™…é¡¹ç›® qcc.xmlï¼‰</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mappingConfiguration</span> 
    <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"https://hongri.com.cn/mapping"</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hljs-attr">class</span>=<span class="hljs-string">"com.citicbank.btsphs.laas.api.tmc.dto.hotel.detail.HotelDetailResponse"</span>
    <span class="hljs-attr">namespace</span>=<span class="hljs-string">"hotel-complex-mapping"</span>
    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"https://hongri.com.cn/mapping https://hongri.com.cn/path/to/mapping.xsd"</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- é€šç”¨ä¿¡æ¯å“åº” --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"code"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"returnCode"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"message"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"returnMsg"</span>/&gt;</span>
    
    <span class="hljs-comment">&lt;!-- é…’åº—ä¿¡æ¯æ•°ç»„ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">array-mapping</span> 
        <span class="hljs-attr">target</span>=<span class="hljs-string">"data"</span> 
        <span class="hljs-attr">source</span>=<span class="hljs-string">"bussinessResponse.hotelInfos"</span> 
        <span class="hljs-attr">item-class</span>=<span class="hljs-string">"com.citicbank.btsphs.laas.api.tmc.dto.hotel.detail.HotelDetailResult"</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- é…’åº—ID --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"hotelId"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"hotelId"</span>/&gt;</span>
        
        <span class="hljs-comment">&lt;!-- åŸºç¡€ä¿¡æ¯å¯¹è±¡ --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">object-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"baseInfo"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"current"</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- é…’åº—åç§° --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"hotelName"</span>/&gt;</span>
            <span class="hljs-comment">&lt;!-- é…’åº—è‹±æ–‡åç§° --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"nameEn"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"hotelEngName"</span>/&gt;</span>
            <span class="hljs-comment">&lt;!-- é…’åº—ç”µè¯ --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"phone"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"telephone"</span>/&gt;</span>
            <span class="hljs-comment">&lt;!-- æ˜¯å¦å¯é¢„å®š - ä½¿ç”¨å›ºå®šå€¼ --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"bookable"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"true"</span>/&gt;</span>
            
            <span class="hljs-comment">&lt;!-- åœ°å€ä¿¡æ¯ - å¤šå±‚åµŒå¥—å¯¹è±¡ --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"address.country.code"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"countryCode"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"address.city.code"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"city"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"address.city.name"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"cityName"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"address.area.code"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"city"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"address.area.name"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"cityName"</span>/&gt;</span>
            
            <span class="hljs-comment">&lt;!-- ä½¿ç”¨ current ä¼ é€’å½“å‰å¯¹è±¡ --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"address.addressLine.name"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"cityName"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"address.addressLine.nameEn"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"cityName"</span>/&gt;</span>
            
            <span class="hljs-comment">&lt;!-- å•†åœˆä¿¡æ¯ - ä½¿ç”¨æ•°ç»„ç´¢å¼• --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"address.businessDistricts[0].code"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"business"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"address.businessDistricts[0].name"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"businessName"</span>/&gt;</span>
            
            <span class="hljs-comment">&lt;!-- åæ ‡ä¿¡æ¯ - æ•°ç»„ç´¢å¼• --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"address.coordinates[0].longitude"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"longitude"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"address.coordinates[0].latitude"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"latitude"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">object-mapping</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- è¯¦ç»†ä¿¡æ¯å¯¹è±¡ --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">object-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"detailInfo"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"current"</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- å¼€ä¸šæ—¶é—´ - å›ºå®šå€¼ --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"openDate"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"2011/01"</span>/&gt;</span>
            <span class="hljs-comment">&lt;!-- è£…ä¿®æ—¶é—´ - å›ºå®šå€¼ --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"decorationDate"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"2020/05"</span>/&gt;</span>
            
            <span class="hljs-comment">&lt;!-- é…’åº—ä»‹ç» --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"description"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"hotelIntroduce"</span>/&gt;</span>
            
            <span class="hljs-comment">&lt;!-- ç»Ÿè®¡ä¿¡æ¯ - ä½¿ç”¨æ•°ç»„ç´¢å¼• --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"statistics[0].type"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"FLOOR_COUNT"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"statistics[0].value"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"4"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"statistics[1].type"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"ROOM_COUNT"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"statistics[1].value"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"4"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"statistics[2].type"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"MEETING_ROOM_COUNT"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"statistics[2].value"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"4"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"statistics[3].type"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"RESTAURANT_COUNT"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"statistics[3].value"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"4"</span>/&gt;</span>
            
            <span class="hljs-comment">&lt;!-- è¯„åˆ†ä¿¡æ¯ - ä½¿ç”¨æ•°ç»„ç´¢å¼• --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"ratings[0].type"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"AVG_SCORE"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"ratings[0].value"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"47"</span>/&gt;</span>
            
            <span class="hljs-comment">&lt;!-- è¥ä¸šæ—¶é—´ --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"openHours"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"1"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">object-mapping</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- æˆ¿é—´ä¿¡æ¯æ•°ç»„ --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">array-mapping</span> 
            <span class="hljs-attr">target</span>=<span class="hljs-string">"roomInfos"</span> 
            <span class="hljs-attr">source</span>=<span class="hljs-string">"current.roomInfos"</span> 
            <span class="hljs-attr">item-class</span>=<span class="hljs-string">"com.citicbank.btsphs.laas.api.tmc.dto.hotel.detail.RoomInfo"</span>&gt;</span>
            
            <span class="hljs-comment">&lt;!-- ä½¿ç”¨ _ è®¿é—®çˆ¶çº§çš„çˆ¶çº§å¯¹è±¡çš„ hotelId --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"hotelId"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"_._.hotelId"</span>/&gt;</span>
            
            <span class="hljs-comment">&lt;!-- æˆ¿é—´åŸºæœ¬ä¿¡æ¯ --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"realRoomId"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"roomId"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"roomName"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"nameEn"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"roomEngName"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"useAbleArea"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"roomAcreage"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"floor"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"roomFloor"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"status"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"1"</span>/&gt;</span>
            
            <span class="hljs-comment">&lt;!-- æ˜¯å¦å…è®¸åŠ åºŠ - ä½¿ç”¨ SpEL è¡¨è¾¾å¼ --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"allowExtraBed"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"addBedflag &gt; 0"</span>/&gt;</span>
            
            <span class="hljs-comment">&lt;!-- ç½‘ç»œç±»å‹ - å›ºå®šå€¼ --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"internetAccess"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"3"</span>/&gt;</span>
            
            <span class="hljs-comment">&lt;!-- æˆ¿é—´å®¹çº³äººæ•° --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"occupancy"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"maxPerson"</span>/&gt;</span>
            
            <span class="hljs-comment">&lt;!-- 
                åºŠç»„ä¿¡æ¯ - å¤æ‚çš„ SpEL è¡¨è¾¾å¼
                ä½¿ç”¨ flatMap å¤šå±‚å±•å¹³åµŒå¥—æ•°ç»„
            --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">array-mapping</span> 
                <span class="hljs-attr">target</span>=<span class="hljs-string">"bedGroups"</span> 
                <span class="hljs-attr">source</span>=<span class="hljs-string">"#flatMap((#flatMap(#flatMap(roomBedTypeInfos.roomBeds.![bedGroups]))).![bedInfos])"</span> 
                <span class="hljs-attr">item-class</span>=<span class="hljs-string">"com.citicbank.btsphs.laas.api.tmc.dto.hotel.detail.BedGroup"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"type"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"bedName"</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"description"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"bedWidth"</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"count"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"bedNum"</span>/&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">array-mapping</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">array-mapping</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">array-mapping</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mappingConfiguration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-68">å…³é”®æŠ€æœ¯ç‚¹è¯´æ˜</h4>
<p><strong>1. å¤šå±‚åµŒå¥—å¯¹è±¡æ˜ å°„</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"address.country.code"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"countryCode"</span>/&gt;</span>
</code></pre>
<p>æ”¯æŒç›´æ¥ä½¿ç”¨ç‚¹å·åˆ†éš”çš„è·¯å¾„æ¥è®¿é—®å¤šå±‚åµŒå¥—å¯¹è±¡ã€‚</p>
<p><strong>2. æ•°ç»„ç´¢å¼•è®¿é—®</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"address.businessDistricts[0].code"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"business"</span>/&gt;</span>
</code></pre>
<p>å¯ä»¥ç›´æ¥è®¿é—®æ•°ç»„æˆ– List çš„æŒ‡å®šç´¢å¼•å…ƒç´ ã€‚</p>
<p><strong>3. è·¨å±‚çº§è®¿é—®ï¼ˆä½¿ç”¨ <code>_</code>ï¼‰</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"hotelId"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"_._.hotelId"</span>/&gt;</span>
</code></pre>
<p><code>_</code> è¡¨ç¤ºå½“å‰å¯¹è±¡çš„çˆ¶çº§å¯¹è±¡ï¼Œ<code>_._</code> è¡¨ç¤ºçˆ¶çº§çš„çˆ¶çº§å¯¹è±¡ã€‚</p>
<p><strong>4. å½“å‰å¯¹è±¡å¼•ç”¨ï¼ˆä½¿ç”¨ <code>current</code>ï¼‰</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">object-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"baseInfo"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"current"</span>&gt;</span>
</code></pre>
<p><code>current</code> è¡¨ç¤ºå½“å‰æ­£åœ¨å¤„ç†çš„å¤–å±‚å¯¹è±¡ã€‚</p>
<p><strong>5. å¤æ‚ SpEL è¡¨è¾¾å¼ - flatMap</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">array-mapping</span> 
    <span class="hljs-attr">target</span>=<span class="hljs-string">"bedGroups"</span> 
    <span class="hljs-attr">source</span>=<span class="hljs-string">"#flatMap((#flatMap(#flatMap(roomBedTypeInfos.roomBeds.![bedGroups]))).![bedInfos])"</span> 
    <span class="hljs-attr">item-class</span>=<span class="hljs-string">"com.example.BedGroup"</span>&gt;</span>
</code></pre>
<p>ä½¿ç”¨ SpEL çš„ <code>flatMap</code> å’ŒæŠ•å½±æ“ä½œç¬¦ <code>![...]</code> æ¥å±•å¹³å¤æ‚çš„åµŒå¥—æ•°ç»„ç»“æ„ã€‚</p>
<p><strong>6. æ¡ä»¶è¡¨è¾¾å¼</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"allowExtraBed"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"addBedflag &gt; 0"</span>/&gt;</span>
</code></pre>
<p>ä½¿ç”¨ SpEL è¡¨è¾¾å¼è¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼Œè¿”å›å¸ƒå°”å€¼ã€‚</p>
<hr/>
<h2 data-id="heading-69">ä¸ƒã€æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-70">7.1 é…ç½®æ–‡ä»¶ç»„ç»‡</h3>
<h4 data-id="heading-71">æ¨èçš„ç›®å½•ç»“æ„</h4>
<pre><code class="hljs language-bash" lang="bash">src/main/resources/
â””â”€â”€ mappingConfiguration/
    â”œâ”€â”€ hotel/                          <span class="hljs-comment"># é…’åº—ç›¸å…³é…ç½®</span>
    â”‚   â”œâ”€â”€ hotel-request-req.xml      <span class="hljs-comment"># é…’åº—æŸ¥è¯¢è¯·æ±‚</span>
    â”‚   â”œâ”€â”€ hotel-detail-res.xml       <span class="hljs-comment"># é…’åº—è¯¦æƒ…å“åº”</span>
    â”‚   â””â”€â”€ hotel-search-res.xml       <span class="hljs-comment"># é…’åº—æœç´¢å“åº”</span>
    â”œâ”€â”€ order/                          <span class="hljs-comment"># è®¢å•ç›¸å…³é…ç½®</span>
    â”‚   â”œâ”€â”€ order-create-req.xml
    â”‚   â”œâ”€â”€ order-detail-res.xml
    â”‚   â””â”€â”€ order-list-res.xml
    â””â”€â”€ common/                         <span class="hljs-comment"># é€šç”¨é…ç½®</span>
        â””â”€â”€ common-mapping.xml
</code></pre>
<h4 data-id="heading-72">å‘½åè§„èŒƒ</h4>
<ul>
<li><strong>è¯·æ±‚é…ç½®</strong>ï¼š<code>{service}-{method}-req.xml</code></li>
<li><strong>å“åº”é…ç½®</strong>ï¼š<code>{service}-{method}-res.xml</code></li>
<li><strong>Namespace</strong>ï¼š<code>{service}@{method}@{type}</code>ï¼ˆtype ä¸º req/resï¼‰</li>
</ul>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">mappingConfiguration</span> 
    <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.HotelDetailResponse"</span>
    <span class="hljs-attr">namespace</span>=<span class="hljs-string">"hotelService@getDetail@res"</span>&gt;</span>
    ...
<span class="hljs-tag">&lt;/<span class="hljs-name">mappingConfiguration</span>&gt;</span>
</code></pre>
<h3 data-id="heading-73">7.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3>
<h4 data-id="heading-74">1. é¿å…æ·±å±‚åµŒå¥—</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- ä¸æ¨èï¼šè¿‡æ·±çš„åµŒå¥— --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">object-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"a"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">object-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"b"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">object-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"c"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">object-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"d"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"value"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"source"</span>/&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">object-mapping</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">object-mapping</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">object-mapping</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">object-mapping</span>&gt;</span>

<span class="hljs-comment">&lt;!-- æ¨èï¼šä½¿ç”¨è·¯å¾„ç›´æ¥è®¿é—® --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"a.b.c.d.value"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"source"</span>/&gt;</span>
</code></pre>
<h4 data-id="heading-75">2. ç®€åŒ– SpEL è¡¨è¾¾å¼</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- ä¸æ¨èï¼šå¤æ‚çš„ SpEL --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> 
    <span class="hljs-attr">target</span>=<span class="hljs-string">"status"</span> 
    <span class="hljs-attr">source</span>=<span class="hljs-string">"(orderStatus == 1 and paymentStatus == 2 and stock &gt; 0) ? 'å¯é¢„è®¢' : 'ä¸å¯é¢„è®¢'"</span>/&gt;</span>

<span class="hljs-comment">&lt;!-- æ¨èï¼šæ‹†åˆ†ä¸ºå¤šä¸ªç®€å•è¡¨è¾¾å¼æˆ–ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•° --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"status"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"#determineBookingStatus(orderStatus, paymentStatus, stock)"</span>/&gt;</span>
</code></pre>
<h4 data-id="heading-76">3. ä½¿ç”¨ Map ä½œä¸ºä¸­é—´å¯¹è±¡</h4>
<p>å½“è¿”å›å¯¹è±¡éå¸¸å¤æ‚æ—¶ï¼Œå¯ä»¥å°†å“åº”è½¬æ¢ä¸º Map ä»¥æé«˜æ€§èƒ½ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">mappingConfiguration</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"map"</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"complex-response"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"field1"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"data.field1"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"field2"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">"data.field2"</span>/&gt;</span>
    <span class="hljs-comment">&lt;!-- ... --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mappingConfiguration</span>&gt;</span>
</code></pre>
<p>ç¨‹åºä¼šè‡ªåŠ¨å°† Map å¤åˆ¶åˆ°å¯¹åº”çš„å®ä½“ç±»ä¸Šã€‚</p>
<h4 data-id="heading-77">4. ç¼“å­˜ ObjectTransfer å®ä¾‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ConfigurationObjectTransferBuilder transferBuilder;
    
    <span class="hljs-comment">// ç¼“å­˜ ObjectTransfer å®ä¾‹</span>
    <span class="hljs-keyword">private</span> ObjectTransfer&lt;Object, Object&gt; orderDetailTransfer;
    
    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> {
        orderDetailTransfer = transferBuilder.buildObjectTransfer(<span class="hljs-string">"order-detail-mapping"</span>);
    }
    
    <span class="hljs-keyword">public</span> OrderDetailVO <span class="hljs-title function_">getOrderDetail</span><span class="hljs-params">(String orderId)</span> {
        <span class="hljs-comment">// ç›´æ¥ä½¿ç”¨ç¼“å­˜çš„å®ä¾‹</span>
        <span class="hljs-keyword">return</span> (OrderDetailVO) orderDetailTransfer.transfer(...);
    }
}
</code></pre>
<h3 data-id="heading-78">7.3 é”™è¯¯å¤„ç†</h3>
<h4 data-id="heading-79">1. åœ¨è½¬æ¢å™¨ä¸­æ•è·å¼‚å¸¸</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeTypeConverter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TypeConverter</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">convert</span><span class="hljs-params">(Object source, Class&lt;?&gt; targetType)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// è½¬æ¢é€»è¾‘</span>
            <span class="hljs-keyword">return</span> doConvert(source, targetType);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"ç±»å‹è½¬æ¢å¤±è´¥: source={}, target={}"</span>, source, targetType, e);
            <span class="hljs-comment">// è¿”å›é»˜è®¤å€¼æˆ– null</span>
            <span class="hljs-keyword">return</span> getDefaultValue(targetType);
        }
    }
}
</code></pre>
<h2 data-id="heading-80">å…«ã€é«˜çº§åŠŸèƒ½</h2>
<h3 data-id="heading-81">8.1 ä½¿ç”¨é…ç½®ç”Ÿæˆå™¨</h3>
<p>æ¡†æ¶æä¾›äº†é…ç½®ç”Ÿæˆå™¨ï¼Œå¯ä»¥æ ¹æ®ç›®æ ‡ç±»è‡ªåŠ¨ç”Ÿæˆ XML é…ç½®æ¨¡æ¿ã€‚</p>
<h4 data-id="heading-82">ClassMappingConfigGenerator</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigGeneratorExample</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// ç”Ÿæˆé…ç½®</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> ClassMappingConfigGenerator.generateConfig(
            HotelDetailResponse.class, 
            <span class="hljs-string">"hotel-detail-auto"</span>
        );
        
        <span class="hljs-comment">// ä¿å­˜åˆ°æ–‡ä»¶</span>
        <span class="hljs-type">Path</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> Paths.get(<span class="hljs-string">"src/main/resources/mappingConfiguration/hotel-detail-auto.xml"</span>);
        Files.write(path, config.getBytes(StandardCharsets.UTF_8));
        
        System.out.println(<span class="hljs-string">"é…ç½®æ–‡ä»¶å·²ç”Ÿæˆ: "</span> + path);
    }
}
</code></pre>
<p>ç”Ÿæˆçš„é…ç½®ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mappingConfiguration</span> 
    <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"https://hongri.com.cn/mapping"</span>
    <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.HotelDetailResponse"</span>
    <span class="hljs-attr">namespace</span>=<span class="hljs-string">"hotel-detail-auto"</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">object-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"code"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">""</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">object-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"message"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">""</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">object-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"data"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">""</span> <span class="hljs-attr">target-class</span>=<span class="hljs-string">"com.example.HotelData"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">array-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"hotels"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">""</span> <span class="hljs-attr">item-class</span>=<span class="hljs-string">"com.example.HotelInfo"</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- è‡ªåŠ¨ç”Ÿæˆçš„å­—æ®µæ˜ å°„ --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"hotelId"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">""</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field-mapping</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"hotelName"</span> <span class="hljs-attr">source</span>=<span class="hljs-string">""</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">array-mapping</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">object-mapping</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mappingConfiguration</span>&gt;</span>
</code></pre>
<hr/>
<h2 data-id="heading-83">ä¹ã€å¸¸è§é—®é¢˜</h2>
<h3 data-id="heading-84">9.1 é…ç½®æ–‡ä»¶åŠ è½½å¤±è´¥</h3>
<p><strong>é—®é¢˜ï¼š</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">Caused by: com.hongri.copier.exception.MappingConfigurationException: 
Cannot find mapping configuration: <span class="hljs-keyword">namespace</span>-name
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ol>
<li>ç¡®è®¤ XML æ–‡ä»¶åœ¨ <code>classpath:mappingConfiguration/</code> ç›®å½•ä¸‹</li>
<li>ç¡®è®¤ <code>namespace</code> å±æ€§å€¼ä¸ä»£ç ä¸­ä½¿ç”¨çš„ä¸€è‡´</li>
<li>æ£€æŸ¥ XML æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®</li>
</ol>
<h3 data-id="heading-85">9.2 ç±»å‹è½¬æ¢é”™è¯¯</h3>
<p><strong>é—®é¢˜ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini">Caused by: com.hongri.copier.exception.BeanCopierException: 
Type conversion failed: <span class="hljs-attr">source</span>=xxx, target=yyy
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ol>
<li>å®ç°è‡ªå®šä¹‰ <code>TypeConverter</code> å¤„ç†ç‰¹æ®Šç±»å‹è½¬æ¢</li>
<li>åœ¨ XML ä¸­æŒ‡å®š <code>converter-class</code> å±æ€§</li>
<li>æ£€æŸ¥æºå€¼å’Œç›®æ ‡ç±»å‹æ˜¯å¦å…¼å®¹</li>
</ol>
<h3 data-id="heading-86">9.3 SpEL è¡¨è¾¾å¼è§£æå¤±è´¥</h3>
<p><strong>é—®é¢˜ï¼š</strong></p>
<pre><code class="hljs language-sql" lang="sql">org.springframework.expression.spel.SpelParseException: 
Expression cannot <span class="hljs-keyword">start</span> <span class="hljs-keyword">with</span> <span class="hljs-string">'#'</span> <span class="hljs-keyword">at</span> position <span class="hljs-number">0</span>
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ol>
<li>SpEL è¡¨è¾¾å¼åº”è¯¥æ”¾åœ¨ <code>source</code> å±æ€§ä¸­ï¼Œè€Œé <code>value</code></li>
<li>ç¡®ä¿è¡¨è¾¾å¼è¯­æ³•æ­£ç¡®</li>
<li>ä½¿ç”¨ <code>#</code> å‰ç¼€æ ‡è¯† SpEL è¡¨è¾¾å¼</li>
</ol>
<h3 data-id="heading-87">9.4 åµŒå¥—å¯¹è±¡ä¸º null</h3>
<p><strong>é—®é¢˜ï¼š</strong>
è½¬æ¢è¿‡ç¨‹ä¸­ï¼ŒåµŒå¥—å¯¹è±¡çš„å­—æ®µæ²¡æœ‰è¢«èµ‹å€¼ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ol>
<li>ç¡®è®¤æºå¯¹è±¡ä¸­åµŒå¥—å¯¹è±¡ä¸ä¸º null</li>
<li>ä½¿ç”¨ <code>?:</code> æ“ä½œç¬¦æä¾›é»˜è®¤å€¼ï¼š<code>source="data?.name"</code></li>
<li>åœ¨ XML é…ç½®ä¸­æ˜¾å¼åˆ›å»ºåµŒå¥—å¯¹è±¡</li>
</ol>
<h3 data-id="heading-88">9.5 æ€§èƒ½é—®é¢˜</h3>
<p><strong>é—®é¢˜ï¼š</strong>
å¯¹è±¡è½¬æ¢é€Ÿåº¦æ…¢ï¼Œå½±å“ç³»ç»Ÿæ€§èƒ½ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ol>
<li>ç¼“å­˜ <code>ObjectTransfer</code> å®ä¾‹ï¼Œé¿å…é‡å¤åˆ›å»º</li>
<li>å‡å°‘æ·±å±‚åµŒå¥—ï¼Œä½¿ç”¨è·¯å¾„ç›´æ¥è®¿é—®</li>
<li>ç®€åŒ– SpEL è¡¨è¾¾å¼</li>
<li>å¯¹äºå¤æ‚å¯¹è±¡ï¼Œè€ƒè™‘è½¬æ¢ä¸º Map ä¸­é—´æ ¼å¼</li>
<li>è°ƒæ•´ ReflectASM çš„ç¼“å­˜ç­–ç•¥</li>
</ol>
<h3 data-id="heading-89">9.6 é›†åˆæ˜ å°„é—®é¢˜</h3>
<p><strong>é—®é¢˜ï¼š</strong>
é›†åˆæ˜ å°„åå…ƒç´ ä¸¢å¤±æˆ–é¡ºåºé”™è¯¯ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ol>
<li>ç¡®è®¤ <code>item-class</code> å±æ€§æ­£ç¡®</li>
<li>æ£€æŸ¥æºé›†åˆæ˜¯å¦ä¸º null</li>
<li>ä½¿ç”¨ <code>?:</code> æä¾›é»˜è®¤ç©ºé›†åˆï¼š<code>source="items?:#{}"</code></li>
<li>ç¡®è®¤ç›®æ ‡é›†åˆç±»å‹æ”¯æŒï¼ˆListã€Setã€æ•°ç»„ï¼‰</li>
</ol>
<h3 data-id="heading-90">9.7 Spring Boot é›†æˆé—®é¢˜</h3>
<p><strong>é—®é¢˜ï¼š</strong>
<code>ConfigurationObjectTransferBuilder</code> æ— æ³•è‡ªåŠ¨æ³¨å…¥ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ol>
<li>ç¡®è®¤å¼•å…¥äº† <code>bean-transfer-starter</code> ä¾èµ–</li>
<li>æ£€æŸ¥ <code>@SpringBootApplication</code> çš„æ‰«æèŒƒå›´</li>
<li>ç¡®è®¤é…ç½®æ–‡ä»¶åœ¨ classpath ä¸­</li>
<li>æ‰‹åŠ¨åˆ›å»º Beanï¼š</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ManualConfig</span> {
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> ConfigurationObjectTransferBuilder <span class="hljs-title function_">transferBuilder</span><span class="hljs-params">(
            BeanCopierConfiguration config,
            MappingConfigurationFactory factory)</span> {
        <span class="hljs-type">ConfigurationObjectTransferBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> 
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigurationObjectTransferBuilder</span>();
        builder.setBeanCopierConfiguration(config);
        builder.setMappingConfigurationFactory(factory);
        <span class="hljs-keyword">return</span> builder;
    }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸ºä»€ä¹ˆChatGPTèƒ½"æ‰“å­—"ç»™ä½ çœ‹ï¼Ÿä»Bufferç†è§£AIæµå¼è¾“å‡º]]></title>    <link>https://juejin.cn/post/7603653885601808434</link>    <guid>https://juejin.cn/post/7603653885601808434</guid>    <pubDate>2026-02-07T08:18:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603653885601808434" data-draft-id="7603575763787579418" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸ºä»€ä¹ˆChatGPTèƒ½&quot;æ‰“å­—&quot;ç»™ä½ çœ‹ï¼Ÿä»Bufferç†è§£AIæµå¼è¾“å‡º"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2026-02-07T08:18:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸ä¼šæ•²ä»£ç 1"/> <meta itemprop="url" content="https://juejin.cn/user/1927884034804425"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸ºä»€ä¹ˆChatGPTèƒ½"æ‰“å­—"ç»™ä½ çœ‹ï¼Ÿä»Bufferç†è§£AIæµå¼è¾“å‡º
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1927884034804425/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸ä¼šæ•²ä»£ç 1
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T08:18:58.000Z" title="Sat Feb 07 2026 08:18:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä»€ä¹ˆæ˜¯Bufferï¼Ÿ</h2>
<p>Bufferï¼ˆç¼“å†²åŒºï¼‰æ˜¯è®¡ç®—æœºå†…å­˜ä¸­ç”¨äºä¸´æ—¶å­˜å‚¨æ•°æ®çš„ä¸€å—åŒºåŸŸã€‚æƒ³è±¡ä¸€ä¸‹ä½ æ­£åœ¨ç”¨æ¯å­æ¥æ°´é¾™å¤´çš„æ°´ï¼šæ°´é¾™å¤´ç›´æ¥æµåˆ°æ¯å­é‡Œï¼Œå¦‚æœæ°´æµå¤ªå¿«ï¼Œæ¯å­å¯èƒ½ä¼šæº¢å‡ºã€‚ä½†å¦‚æœä½ åœ¨ä¸­é—´æ”¾ä¸€ä¸ªæ°´å£¶ï¼ˆç¼“å†²åŒºï¼‰ï¼Œæ°´å…ˆæµåˆ°æ°´å£¶é‡Œï¼Œå†ä»æ°´å£¶å€’åˆ°æ¯å­é‡Œï¼Œæ•´ä¸ªè¿‡ç¨‹å°±æ›´åŠ å¯æ§äº†ã€‚</p>
<p>åœ¨JavaScriptä¸­ï¼ŒBufferå°±æ˜¯é‚£ä¸ª"æ°´å£¶"â€”â€”å®ƒå¸®åŠ©æˆ‘ä»¬åœ¨å¤„ç†äºŒè¿›åˆ¶æ•°æ®ï¼ˆå¦‚å›¾ç‰‡ã€éŸ³é¢‘ã€ç½‘ç»œä¼ è¾“ç­‰ï¼‰æ—¶æ›´åŠ é«˜æ•ˆå’Œå¯æ§ã€‚</p>
<h2 data-id="heading-1">ä¸ºä»€ä¹ˆéœ€è¦Bufferï¼Ÿ</h2>
<h3 data-id="heading-2">1. æ–‡æœ¬ vs äºŒè¿›åˆ¶</h3>
<p>è®¡ç®—æœºä¸­ä¸€åˆ‡æ•°æ®æœ€ç»ˆéƒ½ä»¥äºŒè¿›åˆ¶å½¢å¼å­˜å‚¨ï¼Œä½†æˆ‘ä»¬åœ¨ç¼–ç¨‹æ—¶é€šå¸¸å¤„ç†çš„æ˜¯æ–‡æœ¬ï¼ˆå­—ç¬¦ä¸²ï¼‰ã€‚å½“éœ€è¦å¤„ç†éæ–‡æœ¬æ•°æ®æ—¶ï¼Œå°±éœ€è¦Bufferã€‚</p>
<p><strong>ç”Ÿæ´»æ¯”å–»</strong>ï¼šå°±åƒå¿«é€’è¿è¾“ï¼Œæ–‡æœ¬æ•°æ®å°±åƒæ˜ä¿¡ç‰‡ï¼Œå†…å®¹ç›´æ¥å¯è§ï¼›äºŒè¿›åˆ¶æ•°æ®å°±åƒå¯†å°çš„åŒ…è£¹ï¼Œä½ éœ€è¦ä¸“é—¨çš„å·¥å…·ï¼ˆBufferï¼‰æ¥æŸ¥çœ‹å’Œå¤„ç†é‡Œé¢çš„å†…å®¹ã€‚</p>
<h3 data-id="heading-3">2. æ•ˆç‡é—®é¢˜</h3>
<p>ç›´æ¥æ“ä½œäºŒè¿›åˆ¶æ•°æ®æ¯”æ“ä½œå­—ç¬¦ä¸²æ›´é«˜æ•ˆï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶ã€‚</p>
<h2 data-id="heading-4">HTML5ä¸­çš„Bufferæ“ä½œ</h2>
<h3 data-id="heading-5">1. TextEncoder å’Œ TextDecoder</h3>
<p>è¿™æ˜¯HTML5æä¾›çš„ç¼–ç /è§£ç å·¥å…·ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç¼–ç ï¼šå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°æ®</span>
<span class="hljs-keyword">const</span> encoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextEncoder</span>();
<span class="hljs-keyword">const</span> myBuffer = encoder.<span class="hljs-title function_">encode</span>(<span class="hljs-string">'ä½ å¥½ HTML5'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myBuffer); <span class="hljs-comment">// Uint8Array(10) [228, 189, 160, 229, 165, 189, 32, 72, 84, 77, ...]</span>

<span class="hljs-comment">// è§£ç ï¼šå°†äºŒè¿›åˆ¶æ•°æ®è½¬æ¢å›å­—ç¬¦ä¸²</span>
<span class="hljs-keyword">const</span> decoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>();
<span class="hljs-keyword">const</span> originalText = decoder.<span class="hljs-title function_">decode</span>(myBuffer);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(originalText); <span class="hljs-comment">// "ä½ å¥½ HTML5"</span>
</code></pre>
<p><strong>æ³¨æ„</strong>ï¼šä¸­æ–‡å­—ç¬¦é€šå¸¸å ç”¨3ä¸ªå­—èŠ‚ï¼Œè‹±æ–‡å­—ç¬¦å ç”¨1ä¸ªå­—èŠ‚ï¼Œç©ºæ ¼ä¹Ÿæ˜¯1ä¸ªå­—èŠ‚ã€‚</p>
<h3 data-id="heading-6">2. ArrayBuffer - åŸå§‹çš„äºŒè¿›åˆ¶ç¼“å†²åŒº</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åˆ›å»ºä¸€ä¸ª12å­—èŠ‚çš„ç¼“å†²åŒºï¼ˆå°±åƒç”³è¯·ä¸€å—12æ ¼çš„å†…å­˜ç©ºé—´ï¼‰</span>
<span class="hljs-keyword">const</span> buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">12</span>);

<span class="hljs-comment">// ä½†ArrayBufferæœ¬èº«ä¸èƒ½ç›´æ¥æ“ä½œï¼Œéœ€è¦è§†å›¾ï¼ˆViewï¼‰æ¥è¯»å†™</span>
</code></pre>
<h3 data-id="heading-7">3. è§†å›¾ï¼ˆTypedArrayï¼‰- æ“ä½œç¼“å†²åŒºçš„"çœ¼é•œ"</h3>
<p>ArrayBufferå°±åƒä¸€å—ç©ºç™½ç”»å¸ƒï¼Œè€ŒTypedArrayå°±æ˜¯ä¸åŒé¢œè‰²çš„ç”»ç¬”ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">16</span>); <span class="hljs-comment">// 16å­—èŠ‚çš„ç¼“å†²åŒº</span>

<span class="hljs-comment">// ä¸åŒçš„è§†å›¾ç±»å‹ï¼Œç”¨ä¸åŒçš„æ–¹å¼"çœ‹å¾…"åŒä¸€å—å†…å­˜</span>
<span class="hljs-keyword">const</span> uint8View = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer);   <span class="hljs-comment">// è§†ä¸º8ä½æ— ç¬¦å·æ•´æ•°ï¼ˆ0-255ï¼‰</span>
<span class="hljs-keyword">const</span> uint16View = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint16Array</span>(buffer); <span class="hljs-comment">// è§†ä¸º16ä½æ— ç¬¦å·æ•´æ•°</span>
<span class="hljs-keyword">const</span> int32View = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Int32Array</span>(buffer);   <span class="hljs-comment">// è§†ä¸º32ä½æœ‰ç¬¦å·æ•´æ•°</span>

<span class="hljs-comment">// ä½¿ç”¨Uint8Arrayè§†å›¾æ“ä½œæ•°æ®</span>
<span class="hljs-keyword">const</span> view = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer);
<span class="hljs-keyword">const</span> encoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextEncoder</span>();
<span class="hljs-keyword">const</span> data = encoder.<span class="hljs-title function_">encode</span>(<span class="hljs-string">'Hello'</span>);

<span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; data.<span class="hljs-property">length</span>; i++) {
    view[i] = data[i]; <span class="hljs-comment">// å°†æ•°æ®å¤åˆ¶åˆ°ç¼“å†²åŒº</span>
}
</code></pre>
<h2 data-id="heading-8">å®é™…åº”ç”¨åœºæ™¯</h2>
<h3 data-id="heading-9">1. æµå¼æ•°æ®å¤„ç†ï¼ˆAIå“åº”ç¤ºä¾‹ï¼‰</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ¨¡æ‹ŸAIæµå¼è¾“å‡º</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">simulateAIStreaming</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> responses = [<span class="hljs-string">"æ€è€ƒ"</span>, <span class="hljs-string">"ä¸­"</span>, <span class="hljs-string">"è¯·"</span>, <span class="hljs-string">"ç¨"</span>, <span class="hljs-string">"å€™"</span>];
    <span class="hljs-keyword">const</span> buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">100</span>);
    <span class="hljs-keyword">const</span> view = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer);
    <span class="hljs-keyword">const</span> decoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>();
    
    <span class="hljs-keyword">let</span> position = <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> word <span class="hljs-keyword">of</span> responses) {
        <span class="hljs-comment">// æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ</span>
        <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">500</span>));
        
        <span class="hljs-comment">// å°†æ¯ä¸ªè¯ç¼–ç å¹¶æ·»åŠ åˆ°ç¼“å†²åŒº</span>
        <span class="hljs-keyword">const</span> encoded = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextEncoder</span>().<span class="hljs-title function_">encode</span>(word);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; encoded.<span class="hljs-property">length</span>; i++) {
            view[position++] = encoded[i];
        }
        
        <span class="hljs-comment">// å®æ—¶è§£ç å·²æ¥æ”¶çš„éƒ¨åˆ†</span>
        <span class="hljs-keyword">const</span> receivedSoFar = decoder.<span class="hljs-title function_">decode</span>(view.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, position));
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`å·²æ¥æ”¶: <span class="hljs-subst">${receivedSoFar}</span>`</span>);
    }
}

<span class="hljs-comment">// è¿™å°±æ˜¯streaming:trueçš„æ•ˆæœâ€”â€”è¾¹ç”Ÿæˆè¾¹æ˜¾ç¤º</span>
</code></pre>
<h3 data-id="heading-10">2. æ–‡ä»¶å¤„ç†</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è¯»å–å›¾ç‰‡æ–‡ä»¶å¹¶è·å–å…¶äºŒè¿›åˆ¶æ•°æ®</span>
fileInput.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'change'</span>, <span class="hljs-keyword">async</span> (event) =&gt; {
    <span class="hljs-keyword">const</span> file = event.<span class="hljs-property">target</span>.<span class="hljs-property">files</span>[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">const</span> buffer = <span class="hljs-keyword">await</span> file.<span class="hljs-title function_">arrayBuffer</span>(); <span class="hljs-comment">// è·å–æ–‡ä»¶çš„äºŒè¿›åˆ¶æ•°æ®</span>
    
    <span class="hljs-comment">// ç°åœ¨å¯ä»¥æ“ä½œè¿™ä¸ªbuffer</span>
    <span class="hljs-keyword">const</span> view = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ–‡ä»¶å¤§å°: <span class="hljs-subst">${buffer.byteLength}</span> å­—èŠ‚`</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`å‰10ä¸ªå­—èŠ‚: <span class="hljs-subst">${view.slice(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>)}</span>`</span>);
});
</code></pre>
<h2 data-id="heading-11">å…³é”®æ¦‚å¿µå¯¹æ¯”</h2>



































<table><thead><tr><th>æ¦‚å¿µ</th><th>æ¯”å–»</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>ArrayBuffer</td><td>ç©ºç™½çš„å†…å­˜ç©ºé—´</td><td>åˆ†é…ä¸€å—åŸå§‹äºŒè¿›åˆ¶å†…å­˜</td></tr><tr><td>TypedArray</td><td>æœ‰åˆ»åº¦çš„é‡æ¯</td><td>ä»¥ç‰¹å®šæ ¼å¼ï¼ˆå¦‚æ•´æ•°ã€æµ®ç‚¹æ•°ï¼‰è¯»å–/å†™å…¥æ•°æ®</td></tr><tr><td>DataView</td><td>å¤šåŠŸèƒ½æµ‹é‡å·¥å…·</td><td>æ›´çµæ´»åœ°è¯»å†™ä¸åŒæ ¼å¼çš„æ•°æ®</td></tr><tr><td>TextEncoder</td><td>æ‰“åŒ…æœº</td><td>å°†æ–‡æœ¬æ‰“åŒ…æˆäºŒè¿›åˆ¶</td></tr><tr><td>TextDecoder</td><td>æ‹†åŒ…æœº</td><td>å°†äºŒè¿›åˆ¶è§£åŒ…æˆæ–‡æœ¬</td></tr></tbody></table>
<h2 data-id="heading-12">å¸¸è§TypedArrayç±»å‹</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¸åŒ"çœ¼é•œ"çœ‹åŒä¸€æ•°æ®çš„ä¸åŒæ•ˆæœ</span>
<span class="hljs-keyword">const</span> buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">16</span>);
<span class="hljs-keyword">const</span> data = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];

<span class="hljs-comment">// ä½¿ç”¨Uint8Arrayï¼šæ¯ä¸ªæ•°å­—å 1å­—èŠ‚</span>
<span class="hljs-keyword">const</span> uint8 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer);
uint8.<span class="hljs-title function_">set</span>(data);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(uint8); <span class="hljs-comment">// [1, 2, 3, 4, 0, 0, ...]</span>

<span class="hljs-comment">// ä½¿ç”¨Uint16Arrayï¼šæ¯ä¸ªæ•°å­—å 2å­—èŠ‚</span>
<span class="hljs-keyword">const</span> uint16 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint16Array</span>(buffer);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(uint16); <span class="hljs-comment">// [513, 1027, 0, 0, ...] </span>
<span class="hljs-comment">// ä¸ºä»€ä¹ˆæ˜¯513ï¼Ÿå› ä¸º1+2*256=513ï¼ˆå°ç«¯åºå­˜å‚¨ï¼‰</span>
</code></pre>
<h2 data-id="heading-13">æ€§èƒ½ä¼˜åŒ–æŠ€å·§</h2>
<ol>
<li><strong>å¤ç”¨Buffer</strong>ï¼šé¿å…é¢‘ç¹åˆ›å»ºå’Œé”€æ¯Buffer</li>
<li><strong>æ‰¹é‡æ“ä½œ</strong>ï¼šä½¿ç”¨<code>set()</code>æ–¹æ³•è€Œä¸æ˜¯å¾ªç¯èµ‹å€¼</li>
<li><strong>é€‚å½“å¤§å°</strong>ï¼šä¸è¦åˆ†é…è¿‡å¤§çš„Bufferï¼Œä¼šæµªè´¹å†…å­˜</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¼˜åŒ–ç¤ºä¾‹ï¼šæ‰¹é‡æ“ä½œ</span>
<span class="hljs-keyword">const</span> source = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]);
<span class="hljs-keyword">const</span> targetBuffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">10</span>);
<span class="hljs-keyword">const</span> targetView = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(targetBuffer);

<span class="hljs-comment">// å¥½ï¼šæ‰¹é‡å¤åˆ¶</span>
targetView.<span class="hljs-title function_">set</span>(source);

<span class="hljs-comment">// ä¸å¥½ï¼šé€ä¸ªå¤åˆ¶</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; source.<span class="hljs-property">length</span>; i++) {
    targetView[i] = source[i];
}
</code></pre>
<h2 data-id="heading-14">æ€»ç»“</h2>
<p>Bufferæ˜¯JavaScriptå¤„ç†äºŒè¿›åˆ¶æ•°æ®çš„æ ¸å¿ƒå·¥å…·ï¼Œç‰¹åˆ«æ˜¯åœ¨ï¼š</p>
<ul>
<li>ç½‘ç»œé€šä¿¡ï¼ˆæµå¼ä¼ è¾“ï¼‰</li>
<li>æ–‡ä»¶æ“ä½œï¼ˆå›¾ç‰‡ã€éŸ³é¢‘å¤„ç†ï¼‰</li>
<li>åŠ å¯†ç®—æ³•</li>
<li>ä¸WebGLã€Web Audioç­‰APIäº¤äº’</li>
</ul>
<p><strong>è®°ä½è¿™ä¸ªæµç¨‹</strong>ï¼š
æ–‡æœ¬ â†’ TextEncoder â†’ äºŒè¿›åˆ¶ â†’ ArrayBuffer â†’ TypedArrayæ“ä½œ â†’ TextDecoder â†’ æ–‡æœ¬</p>
<p>å°±åƒå¿«é€’ç³»ç»Ÿï¼šå•†å“ï¼ˆæ•°æ®ï¼‰è¢«åŒ…è£…ï¼ˆç¼–ç ï¼‰â†’ è¿è¾“ï¼ˆäºŒè¿›åˆ¶ä¼ è¾“ï¼‰â†’ æ‹†åŒ…ï¼ˆè§£ç ï¼‰â†’ ä½¿ç”¨ã€‚</p>
<p>æŒæ¡Bufferæ“ä½œï¼Œä½ å°±æ‰“å¼€äº†JavaScriptå¤„ç†äºŒè¿›åˆ¶ä¸–ç•Œçš„å¤§é—¨ï¼</p>
<hr/>
<p><strong>å»¶ä¼¸å­¦ä¹ </strong>ï¼š</p>
<ol>
<li><code>Blob</code>å¯¹è±¡ï¼šæ–‡ä»¶ç›¸å…³çš„äºŒè¿›åˆ¶æ“ä½œ</li>
<li><code>Streams API</code>ï¼šæ›´é«˜çº§çš„æµå¼æ•°æ®å¤„ç†</li>
<li><code>WebSocket.binaryType</code>ï¼šç½‘ç»œé€šä¿¡ä¸­çš„äºŒè¿›åˆ¶ä¼ è¾“</li>
<li><code>Canvas</code>å›¾åƒæ•°æ®å¤„ç†ï¼š<code>getImageData()</code>è¿”å›çš„å°±æ˜¯Uint8ClampedArray</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[[mongodb]pythonæ“ä½œmongodb]]></title>    <link>https://juejin.cn/post/7603567912593489947</link>    <guid>https://juejin.cn/post/7603567912593489947</guid>    <pubDate>2026-02-07T07:53:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603567912593489947" data-draft-id="7603567912593473563" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="[mongodb]pythonæ“ä½œmongodb"/> <meta itemprop="keywords" content="NoSQL"/> <meta itemprop="datePublished" content="2026-02-07T07:53:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="import_random"/> <meta itemprop="url" content="https://juejin.cn/user/2013961033882312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            [mongodb]pythonæ“ä½œmongodb
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2013961033882312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    import_random
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T07:53:41.000Z" title="Sat Feb 07 2026 07:53:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æˆ‘æ¥æä¾›ä¸€ä¸ªå®Œæ•´çš„Pythonè¿æ¥æœ¬åœ°MongoDBçš„ç¤ºä¾‹ä»£ç ï¼ŒåŒ…å«åŸºæœ¬çš„CRUDæ“ä½œã€‚</p>
<h2 data-id="heading-0">1. é¦–å…ˆå®‰è£…å¿…è¦çš„åº“</h2>
<pre><code class="hljs language-bash" lang="bash">pip install pymongo
</code></pre>
<h2 data-id="heading-1">2. å®Œæ•´ç¤ºä¾‹ä»£ç </h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pymongo
<span class="hljs-keyword">from</span> pymongo <span class="hljs-keyword">import</span> MongoClient
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime
<span class="hljs-keyword">from</span> bson <span class="hljs-keyword">import</span> ObjectId
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Dict</span>, <span class="hljs-type">Any</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MongoDBManager</span>:
    <span class="hljs-string">"""MongoDBç®¡ç†ç±»"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, host=<span class="hljs-string">'localhost'</span>, port=<span class="hljs-number">27017</span>, username=<span class="hljs-literal">None</span>, password=<span class="hljs-literal">None</span>, database_name=<span class="hljs-string">'mydatabase'</span></span>):
        <span class="hljs-string">"""
        åˆå§‹åŒ–MongoDBè¿æ¥
        
        Args:
            host: MongoDBä¸»æœºåœ°å€ï¼Œé»˜è®¤ä¸ºlocalhost
            port: MongoDBç«¯å£ï¼Œé»˜è®¤ä¸º27017
            username: ç”¨æˆ·åï¼ˆå¦‚æœæœ‰è®¤è¯ï¼‰
            password: å¯†ç ï¼ˆå¦‚æœæœ‰è®¤è¯ï¼‰
            database_name: æ•°æ®åº“åç§°
        """</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># æ„å»ºè¿æ¥å­—ç¬¦ä¸²</span>
            <span class="hljs-keyword">if</span> username <span class="hljs-keyword">and</span> password:
                <span class="hljs-comment"># æœ‰è®¤è¯çš„è¿æ¥</span>
                connection_string = <span class="hljs-string">f"mongodb://<span class="hljs-subst">{username}</span>:<span class="hljs-subst">{password}</span>@<span class="hljs-subst">{host}</span>:<span class="hljs-subst">{port}</span>/"</span>
                self.client = MongoClient(connection_string)
            <span class="hljs-keyword">else</span>:
                <span class="hljs-comment"># æ— è®¤è¯çš„è¿æ¥ï¼ˆæœ¬åœ°å¼€å‘å¸¸ç”¨ï¼‰</span>
                self.client = MongoClient(host, port)
            
            <span class="hljs-comment"># æµ‹è¯•è¿æ¥</span>
            self.client.admin.command(<span class="hljs-string">'ping'</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"âœ… MongoDBè¿æ¥æˆåŠŸï¼"</span>)
            
            <span class="hljs-comment"># é€‰æ‹©æ•°æ®åº“</span>
            self.db = self.client[database_name]
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ğŸ“ å·²é€‰æ‹©æ•°æ®åº“: <span class="hljs-subst">{database_name}</span>"</span>)
            
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âŒ MongoDBè¿æ¥å¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">raise</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">list_databases</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""åˆ—å‡ºæ‰€æœ‰æ•°æ®åº“"""</span>
        databases = self.client.list_database_names()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ“š æ‰€æœ‰æ•°æ®åº“:"</span>)
        <span class="hljs-keyword">for</span> db <span class="hljs-keyword">in</span> databases:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  - <span class="hljs-subst">{db}</span>"</span>)
        <span class="hljs-keyword">return</span> databases
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">list_collections</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""åˆ—å‡ºå½“å‰æ•°æ®åº“çš„æ‰€æœ‰é›†åˆ"""</span>
        collections = self.db.list_collection_names()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ğŸ“‹ æ•°æ®åº“ '<span class="hljs-subst">{self.db.name}</span>' ä¸­çš„é›†åˆ:"</span>)
        <span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> collections:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  - <span class="hljs-subst">{col}</span>"</span>)
        <span class="hljs-keyword">return</span> collections
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">insert_one</span>(<span class="hljs-params">self, collection_name: <span class="hljs-built_in">str</span>, document: <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]</span>):
        <span class="hljs-string">"""
        æ’å…¥å•ä¸ªæ–‡æ¡£
        
        Args:
            collection_name: é›†åˆåç§°
            document: è¦æ’å…¥çš„æ–‡æ¡£
            
        Returns:
            æ’å…¥çš„æ–‡æ¡£ID
        """</span>
        <span class="hljs-keyword">try</span>:
            collection = self.db[collection_name]
            result = collection.insert_one(document)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âœ… æ–‡æ¡£æ’å…¥æˆåŠŸï¼ŒID: <span class="hljs-subst">{result.inserted_id}</span>"</span>)
            <span class="hljs-keyword">return</span> result.inserted_id
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âŒ æ’å…¥å¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">insert_many</span>(<span class="hljs-params">self, collection_name: <span class="hljs-built_in">str</span>, documents: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]]</span>):
        <span class="hljs-string">"""
        æ’å…¥å¤šä¸ªæ–‡æ¡£
        
        Args:
            collection_name: é›†åˆåç§°
            documents: è¦æ’å…¥çš„æ–‡æ¡£åˆ—è¡¨
            
        Returns:
            æ’å…¥çš„æ–‡æ¡£IDåˆ—è¡¨
        """</span>
        <span class="hljs-keyword">try</span>:
            collection = self.db[collection_name]
            result = collection.insert_many(documents)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âœ… æ‰¹é‡æ’å…¥æˆåŠŸï¼Œå…± <span class="hljs-subst">{<span class="hljs-built_in">len</span>(result.inserted_ids)}</span> ä¸ªæ–‡æ¡£"</span>)
            <span class="hljs-keyword">return</span> result.inserted_ids
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âŒ æ‰¹é‡æ’å…¥å¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">return</span> []
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">find_all</span>(<span class="hljs-params">self, collection_name: <span class="hljs-built_in">str</span></span>):
        <span class="hljs-string">"""
        æŸ¥è¯¢é›†åˆä¸­çš„æ‰€æœ‰æ–‡æ¡£
        
        Args:
            collection_name: é›†åˆåç§°
            
        Returns:
            æ–‡æ¡£åˆ—è¡¨
        """</span>
        <span class="hljs-keyword">try</span>:
            collection = self.db[collection_name]
            documents = <span class="hljs-built_in">list</span>(collection.find())
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âœ… æŸ¥è¯¢åˆ° <span class="hljs-subst">{<span class="hljs-built_in">len</span>(documents)}</span> ä¸ªæ–‡æ¡£"</span>)
            <span class="hljs-keyword">return</span> documents
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âŒ æŸ¥è¯¢å¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">return</span> []
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">find_with_filter</span>(<span class="hljs-params">self, collection_name: <span class="hljs-built_in">str</span>, filter_query: <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]</span>):
        <span class="hljs-string">"""
        æ ¹æ®æ¡ä»¶æŸ¥è¯¢æ–‡æ¡£
        
        Args:
            collection_name: é›†åˆåç§°
            filter_query: æŸ¥è¯¢æ¡ä»¶
            
        Returns:
            åŒ¹é…çš„æ–‡æ¡£åˆ—è¡¨
        """</span>
        <span class="hljs-keyword">try</span>:
            collection = self.db[collection_name]
            documents = <span class="hljs-built_in">list</span>(collection.find(filter_query))
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âœ… æŸ¥è¯¢åˆ° <span class="hljs-subst">{<span class="hljs-built_in">len</span>(documents)}</span> ä¸ªåŒ¹é…çš„æ–‡æ¡£"</span>)
            <span class="hljs-keyword">return</span> documents
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âŒ æ¡ä»¶æŸ¥è¯¢å¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">return</span> []
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">find_one</span>(<span class="hljs-params">self, collection_name: <span class="hljs-built_in">str</span>, filter_query: <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]</span>):
        <span class="hljs-string">"""
        æŸ¥è¯¢å•ä¸ªæ–‡æ¡£
        
        Args:
            collection_name: é›†åˆåç§°
            filter_query: æŸ¥è¯¢æ¡ä»¶
            
        Returns:
            å•ä¸ªæ–‡æ¡£æˆ–None
        """</span>
        <span class="hljs-keyword">try</span>:
            collection = self.db[collection_name]
            document = collection.find_one(filter_query)
            <span class="hljs-keyword">if</span> document:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"âœ… æ‰¾åˆ°åŒ¹é…çš„æ–‡æ¡£"</span>)
            <span class="hljs-keyword">else</span>:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"âš ï¸  æœªæ‰¾åˆ°åŒ¹é…çš„æ–‡æ¡£"</span>)
            <span class="hljs-keyword">return</span> document
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âŒ æŸ¥è¯¢å•ä¸ªæ–‡æ¡£å¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_one</span>(<span class="hljs-params">self, collection_name: <span class="hljs-built_in">str</span>, filter_query: <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>], update_data: <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]</span>):
        <span class="hljs-string">"""
        æ›´æ–°å•ä¸ªæ–‡æ¡£
        
        Args:
            collection_name: é›†åˆåç§°
            filter_query: æŸ¥è¯¢æ¡ä»¶
            update_data: æ›´æ–°æ•°æ®
            
        Returns:
            æ›´æ–°ç»“æœ
        """</span>
        <span class="hljs-keyword">try</span>:
            collection = self.db[collection_name]
            <span class="hljs-comment"># ä½¿ç”¨ $set æ“ä½œç¬¦æ›´æ–°æŒ‡å®šå­—æ®µ</span>
            result = collection.update_one(filter_query, {<span class="hljs-string">"$set"</span>: update_data})
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âœ… æ›´æ–°æˆåŠŸï¼ŒåŒ¹é…åˆ° <span class="hljs-subst">{result.matched_count}</span> ä¸ªæ–‡æ¡£ï¼Œä¿®æ”¹äº† <span class="hljs-subst">{result.modified_count}</span> ä¸ªæ–‡æ¡£"</span>)
            <span class="hljs-keyword">return</span> result
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âŒ æ›´æ–°å¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">delete_one</span>(<span class="hljs-params">self, collection_name: <span class="hljs-built_in">str</span>, filter_query: <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]</span>):
        <span class="hljs-string">"""
        åˆ é™¤å•ä¸ªæ–‡æ¡£
        
        Args:
            collection_name: é›†åˆåç§°
            filter_query: æŸ¥è¯¢æ¡ä»¶
            
        Returns:
            åˆ é™¤ç»“æœ
        """</span>
        <span class="hljs-keyword">try</span>:
            collection = self.db[collection_name]
            result = collection.delete_one(filter_query)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âœ… åˆ é™¤æˆåŠŸï¼Œåˆ é™¤äº† <span class="hljs-subst">{result.deleted_count}</span> ä¸ªæ–‡æ¡£"</span>)
            <span class="hljs-keyword">return</span> result
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âŒ åˆ é™¤å¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">delete_many</span>(<span class="hljs-params">self, collection_name: <span class="hljs-built_in">str</span>, filter_query: <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]</span>):
        <span class="hljs-string">"""
        åˆ é™¤å¤šä¸ªæ–‡æ¡£
        
        Args:
            collection_name: é›†åˆåç§°
            filter_query: æŸ¥è¯¢æ¡ä»¶
            
        Returns:
            åˆ é™¤ç»“æœ
        """</span>
        <span class="hljs-keyword">try</span>:
            collection = self.db[collection_name]
            result = collection.delete_many(filter_query)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âœ… æ‰¹é‡åˆ é™¤æˆåŠŸï¼Œåˆ é™¤äº† <span class="hljs-subst">{result.deleted_count}</span> ä¸ªæ–‡æ¡£"</span>)
            <span class="hljs-keyword">return</span> result
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âŒ æ‰¹é‡åˆ é™¤å¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_index</span>(<span class="hljs-params">self, collection_name: <span class="hljs-built_in">str</span>, field: <span class="hljs-built_in">str</span>, unique=<span class="hljs-literal">False</span></span>):
        <span class="hljs-string">"""
        åˆ›å»ºç´¢å¼•
        
        Args:
            collection_name: é›†åˆåç§°
            field: ç´¢å¼•å­—æ®µ
            unique: æ˜¯å¦å”¯ä¸€ç´¢å¼•
            
        Returns:
            ç´¢å¼•åç§°
        """</span>
        <span class="hljs-keyword">try</span>:
            collection = self.db[collection_name]
            index_result = collection.create_index([(field, pymongo.ASCENDING)], unique=unique)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âœ… ç´¢å¼•åˆ›å»ºæˆåŠŸ: <span class="hljs-subst">{index_result}</span>"</span>)
            <span class="hljs-keyword">return</span> index_result
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âŒ åˆ›å»ºç´¢å¼•å¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">count_documents</span>(<span class="hljs-params">self, collection_name: <span class="hljs-built_in">str</span>, filter_query: <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>] = <span class="hljs-literal">None</span></span>):
        <span class="hljs-string">"""
        ç»Ÿè®¡æ–‡æ¡£æ•°é‡
        
        Args:
            collection_name: é›†åˆåç§°
            filter_query: æŸ¥è¯¢æ¡ä»¶ï¼ˆå¯é€‰ï¼‰
            
        Returns:
            æ–‡æ¡£æ•°é‡
        """</span>
        <span class="hljs-keyword">try</span>:
            collection = self.db[collection_name]
            <span class="hljs-keyword">if</span> filter_query:
                count = collection.count_documents(filter_query)
            <span class="hljs-keyword">else</span>:
                count = collection.count_documents({})
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ğŸ“Š æ–‡æ¡£æ•°é‡: <span class="hljs-subst">{count}</span>"</span>)
            <span class="hljs-keyword">return</span> count
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âŒ ç»Ÿè®¡å¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">drop_collection</span>(<span class="hljs-params">self, collection_name: <span class="hljs-built_in">str</span></span>):
        <span class="hljs-string">"""
        åˆ é™¤é›†åˆ
        
        Args:
            collection_name: é›†åˆåç§°
            
        Returns:
            True if successful, False otherwise
        """</span>
        <span class="hljs-keyword">try</span>:
            collection = self.db[collection_name]
            collection.drop()
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ğŸ—‘ï¸  é›†åˆ '<span class="hljs-subst">{collection_name}</span>' å·²åˆ é™¤"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âŒ åˆ é™¤é›†åˆå¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">close_connection</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""å…³é—­æ•°æ®åº“è¿æ¥"""</span>
        self.client.close()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ”Œ MongoDBè¿æ¥å·²å…³é—­"</span>)
    
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">pretty_print</span>(<span class="hljs-params">documents: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]]</span>):
        <span class="hljs-string">"""ç¾åŒ–æ‰“å°æ–‡æ¡£"""</span>
        <span class="hljs-keyword">for</span> i, doc <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(documents):
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\nğŸ“„ æ–‡æ¡£ <span class="hljs-subst">{i+<span class="hljs-number">1</span>}</span>:"</span>)
            <span class="hljs-comment"># å¤„ç†ObjectIdä½¿å…¶å¯åºåˆ—åŒ–</span>
            doc_copy = doc.copy()
            <span class="hljs-keyword">if</span> <span class="hljs-string">'_id'</span> <span class="hljs-keyword">in</span> doc_copy:
                doc_copy[<span class="hljs-string">'_id'</span>] = <span class="hljs-built_in">str</span>(doc_copy[<span class="hljs-string">'_id'</span>])
            <span class="hljs-built_in">print</span>(json.dumps(doc_copy, indent=<span class="hljs-number">2</span>, ensure_ascii=<span class="hljs-literal">False</span>))


<span class="hljs-comment"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    <span class="hljs-comment"># 1. åˆ›å»ºMongoDBç®¡ç†å™¨å®ä¾‹ï¼ˆè¿æ¥æœ¬åœ°MongoDBï¼‰</span>
    mongo = MongoDBManager(
        host=<span class="hljs-string">'localhost'</span>,
        port=<span class="hljs-number">27017</span>,
        database_name=<span class="hljs-string">'testdb'</span>  <span class="hljs-comment"># æ•°æ®åº“åç§°</span>
    )
    
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># 2. åˆ—å‡ºæ‰€æœ‰æ•°æ®åº“å’Œé›†åˆ</span>
        mongo.list_databases()
        
        <span class="hljs-comment"># 3. ç¤ºä¾‹æ•°æ®ï¼šç”¨æˆ·ä¿¡æ¯</span>
        users_collection = <span class="hljs-string">'users'</span>
        
        <span class="hljs-comment"># 4. æ’å…¥å•ä¸ªæ–‡æ¡£</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n1. æ’å…¥å•ä¸ªç”¨æˆ·:"</span>)
        user1 = {
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"å¼ ä¸‰"</span>,
            <span class="hljs-string">"age"</span>: <span class="hljs-number">25</span>,
            <span class="hljs-string">"email"</span>: <span class="hljs-string">"zhangsan@example.com"</span>,
            <span class="hljs-string">"city"</span>: <span class="hljs-string">"åŒ—äº¬"</span>,
            <span class="hljs-string">"hobbies"</span>: [<span class="hljs-string">"è¯»ä¹¦"</span>, <span class="hljs-string">"æ¸¸æ³³"</span>, <span class="hljs-string">"ç¼–ç¨‹"</span>],
            <span class="hljs-string">"created_at"</span>: datetime.now(),
            <span class="hljs-string">"is_active"</span>: <span class="hljs-literal">True</span>
        }
        user1_id = mongo.insert_one(users_collection, user1)
        
        <span class="hljs-comment"># 5. æ’å…¥å¤šä¸ªæ–‡æ¡£</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n2. æ‰¹é‡æ’å…¥ç”¨æˆ·:"</span>)
        users = [
            {
                <span class="hljs-string">"name"</span>: <span class="hljs-string">"æå››"</span>,
                <span class="hljs-string">"age"</span>: <span class="hljs-number">30</span>,
                <span class="hljs-string">"email"</span>: <span class="hljs-string">"lisi@example.com"</span>,
                <span class="hljs-string">"city"</span>: <span class="hljs-string">"ä¸Šæµ·"</span>,
                <span class="hljs-string">"hobbies"</span>: [<span class="hljs-string">"æ—…æ¸¸"</span>, <span class="hljs-string">"æ‘„å½±"</span>],
                <span class="hljs-string">"created_at"</span>: datetime.now(),
                <span class="hljs-string">"is_active"</span>: <span class="hljs-literal">True</span>
            },
            {
                <span class="hljs-string">"name"</span>: <span class="hljs-string">"ç‹äº”"</span>,
                <span class="hljs-string">"age"</span>: <span class="hljs-number">28</span>,
                <span class="hljs-string">"email"</span>: <span class="hljs-string">"wangwu@example.com"</span>,
                <span class="hljs-string">"city"</span>: <span class="hljs-string">"å¹¿å·"</span>,
                <span class="hljs-string">"hobbies"</span>: [<span class="hljs-string">"ç¯®çƒ"</span>, <span class="hljs-string">"éŸ³ä¹"</span>],
                <span class="hljs-string">"created_at"</span>: datetime.now(),
                <span class="hljs-string">"is_active"</span>: <span class="hljs-literal">True</span>
            },
            {
                <span class="hljs-string">"name"</span>: <span class="hljs-string">"èµµå…­"</span>,
                <span class="hljs-string">"age"</span>: <span class="hljs-number">35</span>,
                <span class="hljs-string">"email"</span>: <span class="hljs-string">"zhaoliu@example.com"</span>,
                <span class="hljs-string">"city"</span>: <span class="hljs-string">"åŒ—äº¬"</span>,
                <span class="hljs-string">"hobbies"</span>: [<span class="hljs-string">"çƒ¹é¥ª"</span>, <span class="hljs-string">"ç”µå½±"</span>],
                <span class="hljs-string">"created_at"</span>: datetime.now(),
                <span class="hljs-string">"is_active"</span>: <span class="hljs-literal">False</span>
            }
        ]
        user_ids = mongo.insert_many(users_collection, users)
        
        <span class="hljs-comment"># 6. æŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n3. æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·:"</span>)
        all_users = mongo.find_all(users_collection)
        mongo.pretty_print(all_users)
        
        <span class="hljs-comment"># 7. æ¡ä»¶æŸ¥è¯¢</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n4. æŸ¥è¯¢åŒ—äº¬çš„ç”¨æˆ·:"</span>)
        beijing_users = mongo.find_with_filter(users_collection, {<span class="hljs-string">"city"</span>: <span class="hljs-string">"åŒ—äº¬"</span>})
        mongo.pretty_print(beijing_users)
        
        <span class="hljs-comment"># 8. æŸ¥è¯¢å•ä¸ªæ–‡æ¡£</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n5. æŸ¥è¯¢å¹´é¾„å¤§äº30çš„ç”¨æˆ·:"</span>)
        older_user = mongo.find_one(users_collection, {<span class="hljs-string">"age"</span>: {<span class="hljs-string">"$gt"</span>: <span class="hljs-number">30</span>}})
        <span class="hljs-keyword">if</span> older_user:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ‰¾åˆ°ç”¨æˆ·: <span class="hljs-subst">{older_user[<span class="hljs-string">'name'</span>]}</span>, å¹´é¾„: <span class="hljs-subst">{older_user[<span class="hljs-string">'age'</span>]}</span>"</span>)
        
        <span class="hljs-comment"># 9. æ›´æ–°æ–‡æ¡£</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n6. æ›´æ–°ç”¨æˆ·ä¿¡æ¯:"</span>)
        mongo.update_one(
            users_collection,
            {<span class="hljs-string">"name"</span>: <span class="hljs-string">"å¼ ä¸‰"</span>},
            {<span class="hljs-string">"age"</span>: <span class="hljs-number">26</span>, <span class="hljs-string">"email"</span>: <span class="hljs-string">"zhangsan_new@example.com"</span>}
        )
        
        <span class="hljs-comment"># 10. éªŒè¯æ›´æ–°</span>
        updated_user = mongo.find_one(users_collection, {<span class="hljs-string">"name"</span>: <span class="hljs-string">"å¼ ä¸‰"</span>})
        <span class="hljs-keyword">if</span> updated_user:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ›´æ–°åçš„ç”¨æˆ·: <span class="hljs-subst">{updated_user[<span class="hljs-string">'name'</span>]}</span>, å¹´é¾„: <span class="hljs-subst">{updated_user[<span class="hljs-string">'age'</span>]}</span>, é‚®ç®±: <span class="hljs-subst">{updated_user[<span class="hljs-string">'email'</span>]}</span>"</span>)
        
        <span class="hljs-comment"># 11. ç»Ÿè®¡æ–‡æ¡£</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n7. ç»Ÿè®¡æ´»è·ƒç”¨æˆ·:"</span>)
        active_count = mongo.count_documents(users_collection, {<span class="hljs-string">"is_active"</span>: <span class="hljs-literal">True</span>})
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ´»è·ƒç”¨æˆ·æ•°é‡: <span class="hljs-subst">{active_count}</span>"</span>)
        
        <span class="hljs-comment"># 12. åˆ é™¤æ–‡æ¡£</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n8. åˆ é™¤éæ´»è·ƒç”¨æˆ·:"</span>)
        mongo.delete_many(users_collection, {<span class="hljs-string">"is_active"</span>: <span class="hljs-literal">False</span>})
        
        <span class="hljs-comment"># 13. å†æ¬¡ç»Ÿè®¡</span>
        remaining_count = mongo.count_documents(users_collection)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å‰©ä½™ç”¨æˆ·æ•°é‡: <span class="hljs-subst">{remaining_count}</span>"</span>)
        
        <span class="hljs-comment"># 14. åˆ›å»ºç´¢å¼•</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n9. åˆ›å»ºç´¢å¼•:"</span>)
        mongo.create_index(users_collection, <span class="hljs-string">"email"</span>, unique=<span class="hljs-literal">True</span>)
        
        <span class="hljs-comment"># 15. åˆ—å‡ºæ‰€æœ‰é›†åˆ</span>
        mongo.list_collections()
        
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç¨‹åºæ‰§è¡Œå‡ºé”™: <span class="hljs-subst">{e}</span>"</span>)
    <span class="hljs-keyword">finally</span>:
        <span class="hljs-comment"># 16. å…³é—­è¿æ¥</span>
        mongo.close_connection()


<span class="hljs-comment"># é«˜çº§ç”¨æ³•ç¤ºä¾‹ï¼šä½¿ç”¨èšåˆç®¡é“</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">advanced_example</span>():
    <span class="hljs-string">"""é«˜çº§æŸ¥è¯¢ç¤ºä¾‹ï¼šä½¿ç”¨èšåˆç®¡é“"""</span>
    mongo = MongoDBManager(database_name=<span class="hljs-string">'testdb'</span>)
    
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># åˆ›å»ºè®¢å•æ•°æ®</span>
        orders_collection = <span class="hljs-string">'orders'</span>
        
        <span class="hljs-comment"># æ’å…¥ä¸€äº›è®¢å•æ•°æ®</span>
        orders = [
            {<span class="hljs-string">"customer"</span>: <span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-string">"amount"</span>: <span class="hljs-number">150</span>, <span class="hljs-string">"status"</span>: <span class="hljs-string">"completed"</span>, <span class="hljs-string">"date"</span>: datetime(<span class="hljs-number">2024</span>, <span class="hljs-number">1</span>, <span class="hljs-number">15</span>)},
            {<span class="hljs-string">"customer"</span>: <span class="hljs-string">"æå››"</span>, <span class="hljs-string">"amount"</span>: <span class="hljs-number">200</span>, <span class="hljs-string">"status"</span>: <span class="hljs-string">"completed"</span>, <span class="hljs-string">"date"</span>: datetime(<span class="hljs-number">2024</span>, <span class="hljs-number">1</span>, <span class="hljs-number">16</span>)},
            {<span class="hljs-string">"customer"</span>: <span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-string">"amount"</span>: <span class="hljs-number">300</span>, <span class="hljs-string">"status"</span>: <span class="hljs-string">"pending"</span>, <span class="hljs-string">"date"</span>: datetime(<span class="hljs-number">2024</span>, <span class="hljs-number">1</span>, <span class="hljs-number">17</span>)},
            {<span class="hljs-string">"customer"</span>: <span class="hljs-string">"ç‹äº”"</span>, <span class="hljs-string">"amount"</span>: <span class="hljs-number">100</span>, <span class="hljs-string">"status"</span>: <span class="hljs-string">"completed"</span>, <span class="hljs-string">"date"</span>: datetime(<span class="hljs-number">2024</span>, <span class="hljs-number">1</span>, <span class="hljs-number">18</span>)},
            {<span class="hljs-string">"customer"</span>: <span class="hljs-string">"æå››"</span>, <span class="hljs-string">"amount"</span>: <span class="hljs-number">250</span>, <span class="hljs-string">"status"</span>: <span class="hljs-string">"completed"</span>, <span class="hljs-string">"date"</span>: datetime(<span class="hljs-number">2024</span>, <span class="hljs-number">1</span>, <span class="hljs-number">19</span>)}
        ]
        
        mongo.insert_many(orders_collection, orders)
        
        <span class="hljs-comment"># ä½¿ç”¨èšåˆç®¡é“ï¼šæŒ‰å®¢æˆ·åˆ†ç»„ï¼Œè®¡ç®—æ€»é‡‘é¢</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\nğŸ” èšåˆæŸ¥è¯¢ï¼šæ¯ä¸ªå®¢æˆ·çš„æ€»è®¢å•é‡‘é¢"</span>)
        pipeline = [
            {<span class="hljs-string">"$match"</span>: {<span class="hljs-string">"status"</span>: <span class="hljs-string">"completed"</span>}},  <span class="hljs-comment"># åªé€‰æ‹©å·²å®Œæˆçš„è®¢å•</span>
            {<span class="hljs-string">"$group"</span>: {
                <span class="hljs-string">"_id"</span>: <span class="hljs-string">"$customer"</span>,  <span class="hljs-comment"># æŒ‰å®¢æˆ·åˆ†ç»„</span>
                <span class="hljs-string">"total_amount"</span>: {<span class="hljs-string">"$sum"</span>: <span class="hljs-string">"$amount"</span>},  <span class="hljs-comment"># è®¡ç®—æ€»é‡‘é¢</span>
                <span class="hljs-string">"order_count"</span>: {<span class="hljs-string">"$sum"</span>: <span class="hljs-number">1</span>}  <span class="hljs-comment"># è®¡ç®—è®¢å•æ•°é‡</span>
            }},
            {<span class="hljs-string">"$sort"</span>: {<span class="hljs-string">"total_amount"</span>: -<span class="hljs-number">1</span>}}  <span class="hljs-comment"># æŒ‰æ€»é‡‘é¢é™åºæ’åº</span>
        ]
        
        collection = mongo.db[orders_collection]
        results = <span class="hljs-built_in">list</span>(collection.aggregate(pipeline))
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"å®¢æˆ·æ¶ˆè´¹ç»Ÿè®¡:"</span>)
        <span class="hljs-keyword">for</span> result <span class="hljs-keyword">in</span> results:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  å®¢æˆ·: <span class="hljs-subst">{result[<span class="hljs-string">'_id'</span>]}</span>, æ€»é‡‘é¢: Â¥<span class="hljs-subst">{result[<span class="hljs-string">'total_amount'</span>]}</span>, è®¢å•æ•°: <span class="hljs-subst">{result[<span class="hljs-string">'order_count'</span>]}</span>"</span>)
            
    <span class="hljs-keyword">finally</span>:
        mongo.close_connection()


<span class="hljs-comment"># ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼ˆæ¨èæ–¹å¼ï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">with_context_manager</span>():
    <span class="hljs-string">"""ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨ç®¡ç†è¿æ¥"""</span>
    <span class="hljs-keyword">from</span> contextlib <span class="hljs-keyword">import</span> contextmanager
    
<span class="hljs-meta">    @contextmanager</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_mongo_connection</span>():
        <span class="hljs-string">"""è·å–MongoDBè¿æ¥çš„ä¸Šä¸‹æ–‡ç®¡ç†å™¨"""</span>
        mongo = <span class="hljs-literal">None</span>
        <span class="hljs-keyword">try</span>:
            mongo = MongoDBManager(database_name=<span class="hljs-string">'testdb'</span>)
            <span class="hljs-keyword">yield</span> mongo
        <span class="hljs-keyword">finally</span>:
            <span class="hljs-keyword">if</span> mongo:
                mongo.close_connection()
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\nğŸ¯ ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨ç¤ºä¾‹:"</span>)
    <span class="hljs-keyword">with</span> get_mongo_connection() <span class="hljs-keyword">as</span> mongo:
        <span class="hljs-comment"># åœ¨è¿™é‡Œæ‰§è¡Œæ•°æ®åº“æ“ä½œ</span>
        users = mongo.find_all(<span class="hljs-string">'users'</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å½“å‰æœ‰ <span class="hljs-subst">{<span class="hljs-built_in">len</span>(users)}</span> ä¸ªç”¨æˆ·"</span>)


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"MongoDB CRUD æ“ä½œç¤ºä¾‹"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
    
    <span class="hljs-comment"># è¿è¡ŒåŸºæœ¬ç¤ºä¾‹</span>
    main()
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"é«˜çº§æŸ¥è¯¢ç¤ºä¾‹"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
    
    <span class="hljs-comment"># è¿è¡Œé«˜çº§ç¤ºä¾‹</span>
    advanced_example()
    
    <span class="hljs-comment"># è¿è¡Œä¸Šä¸‹æ–‡ç®¡ç†å™¨ç¤ºä¾‹</span>
    with_context_manager()
</code></pre>
<h2 data-id="heading-2">3. ç®€åŒ–çš„å¿«é€Ÿä½¿ç”¨ç‰ˆæœ¬</h2>
<p>å¦‚æœä½ éœ€è¦ä¸€ä¸ªæ›´ç®€æ´çš„ç‰ˆæœ¬ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> pymongo <span class="hljs-keyword">import</span> MongoClient
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime

<span class="hljs-comment"># 1. è¿æ¥MongoDB</span>
client = MongoClient(<span class="hljs-string">'localhost'</span>, <span class="hljs-number">27017</span>)  <span class="hljs-comment"># é»˜è®¤é…ç½®</span>

<span class="hljs-comment"># 2. é€‰æ‹©æ•°æ®åº“</span>
db = client[<span class="hljs-string">'mydatabase'</span>]

<span class="hljs-comment"># 3. é€‰æ‹©é›†åˆï¼ˆç±»ä¼¼äºSQLçš„è¡¨ï¼‰</span>
collection = db[<span class="hljs-string">'users'</span>]

<span class="hljs-comment"># 4. æ’å…¥æ•°æ®</span>
user_data = {
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"å¼ ä¸‰"</span>,
    <span class="hljs-string">"age"</span>: <span class="hljs-number">25</span>,
    <span class="hljs-string">"email"</span>: <span class="hljs-string">"zhangsan@example.com"</span>,
    <span class="hljs-string">"created_at"</span>: datetime.now()
}
result = collection.insert_one(user_data)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ’å…¥æˆåŠŸï¼ŒID: <span class="hljs-subst">{result.inserted_id}</span>"</span>)

<span class="hljs-comment"># 5. æŸ¥è¯¢æ•°æ®</span>
<span class="hljs-comment"># æŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£</span>
all_users = collection.find()
<span class="hljs-keyword">for</span> user <span class="hljs-keyword">in</span> all_users:
    <span class="hljs-built_in">print</span>(user)

<span class="hljs-comment"># æ¡ä»¶æŸ¥è¯¢</span>
query = {<span class="hljs-string">"age"</span>: {<span class="hljs-string">"$gt"</span>: <span class="hljs-number">20</span>}}  <span class="hljs-comment"># å¹´é¾„å¤§äº20</span>
users = collection.find(query)
<span class="hljs-keyword">for</span> user <span class="hljs-keyword">in</span> users:
    <span class="hljs-built_in">print</span>(user)

<span class="hljs-comment"># æŸ¥è¯¢å•ä¸ªæ–‡æ¡£</span>
user = collection.find_one({<span class="hljs-string">"name"</span>: <span class="hljs-string">"å¼ ä¸‰"</span>})
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ‰¾åˆ°ç”¨æˆ·: <span class="hljs-subst">{user}</span>"</span>)

<span class="hljs-comment"># 6. æ›´æ–°æ•°æ®</span>
collection.update_one(
    {<span class="hljs-string">"name"</span>: <span class="hljs-string">"å¼ ä¸‰"</span>},
    {<span class="hljs-string">"$set"</span>: {<span class="hljs-string">"age"</span>: <span class="hljs-number">26</span>, <span class="hljs-string">"updated_at"</span>: datetime.now()}}
)

<span class="hljs-comment"># 7. åˆ é™¤æ•°æ®</span>
collection.delete_one({<span class="hljs-string">"name"</span>: <span class="hljs-string">"å¼ ä¸‰"</span>})

<span class="hljs-comment"># 8. å…³é—­è¿æ¥</span>
client.close()
</code></pre>
<h2 data-id="heading-3">4. ç¯å¢ƒé…ç½®å»ºè®®</h2>
<p>åˆ›å»º <code>config.py</code> æ–‡ä»¶ç®¡ç†é…ç½®ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># config.py</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MongoDBConfig</span>:
    HOST = <span class="hljs-string">'localhost'</span>
    PORT = <span class="hljs-number">27017</span>
    USERNAME = <span class="hljs-literal">None</span>
    PASSWORD = <span class="hljs-literal">None</span>
    DATABASE = <span class="hljs-string">'mydatabase'</span>
    
    <span class="hljs-comment"># è¿æ¥å­—ç¬¦ä¸²</span>
<span class="hljs-meta">    @classmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_connection_string</span>(<span class="hljs-params">cls</span>):
        <span class="hljs-keyword">if</span> cls.USERNAME <span class="hljs-keyword">and</span> cls.PASSWORD:
            <span class="hljs-keyword">return</span> <span class="hljs-string">f"mongodb://<span class="hljs-subst">{cls.USERNAME}</span>:<span class="hljs-subst">{cls.PASSWORD}</span>@<span class="hljs-subst">{cls.HOST}</span>:<span class="hljs-subst">{cls.PORT}</span>/"</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"mongodb://<span class="hljs-subst">{cls.HOST}</span>:<span class="hljs-subst">{cls.PORT}</span>/"</span>
</code></pre>
<h2 data-id="heading-4">5. å¸¸è§æŸ¥è¯¢æ“ä½œç¬¦</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å¸¸ç”¨æŸ¥è¯¢æ“ä½œç¬¦ç¤ºä¾‹</span>
query_examples = {
    <span class="hljs-comment"># ç­‰äº</span>
    <span class="hljs-string">"ç­‰äº"</span>: {<span class="hljs-string">"name"</span>: <span class="hljs-string">"å¼ ä¸‰"</span>},
    
    <span class="hljs-comment"># å¤§äº</span>
    <span class="hljs-string">"å¤§äº"</span>: {<span class="hljs-string">"age"</span>: {<span class="hljs-string">"$gt"</span>: <span class="hljs-number">20</span>}},
    
    <span class="hljs-comment"># å°äº</span>
    <span class="hljs-string">"å°äº"</span>: {<span class="hljs-string">"age"</span>: {<span class="hljs-string">"$lt"</span>: <span class="hljs-number">30</span>}},
    
    <span class="hljs-comment"># èŒƒå›´</span>
    <span class="hljs-string">"èŒƒå›´"</span>: {<span class="hljs-string">"age"</span>: {<span class="hljs-string">"$gte"</span>: <span class="hljs-number">20</span>, <span class="hljs-string">"$lte"</span>: <span class="hljs-number">30</span>}},
    
    <span class="hljs-comment"># åŒ…å«åœ¨æ•°ç»„ä¸­</span>
    <span class="hljs-string">"åŒ…å«"</span>: {<span class="hljs-string">"hobbies"</span>: {<span class="hljs-string">"$in"</span>: [<span class="hljs-string">"è¯»ä¹¦"</span>, <span class="hljs-string">"æ¸¸æ³³"</span>]}},
    
    <span class="hljs-comment"># ä¸åŒ…å«</span>
    <span class="hljs-string">"ä¸åŒ…å«"</span>: {<span class="hljs-string">"hobbies"</span>: {<span class="hljs-string">"$nin"</span>: [<span class="hljs-string">"æ¸¸æˆ"</span>]}},
    
    <span class="hljs-comment"># å­˜åœ¨å­—æ®µ</span>
    <span class="hljs-string">"å­˜åœ¨å­—æ®µ"</span>: {<span class="hljs-string">"email"</span>: {<span class="hljs-string">"$exists"</span>: <span class="hljs-literal">True</span>}},
    
    <span class="hljs-comment"># æ­£åˆ™åŒ¹é…</span>
    <span class="hljs-string">"æ­£åˆ™"</span>: {<span class="hljs-string">"name"</span>: {<span class="hljs-string">"$regex"</span>: <span class="hljs-string">"^å¼ "</span>}},  <span class="hljs-comment"># å§“å¼ çš„</span>
    
    <span class="hljs-comment"># é€»è¾‘AND</span>
    <span class="hljs-string">"AND"</span>: {<span class="hljs-string">"$and"</span>: [{<span class="hljs-string">"age"</span>: {<span class="hljs-string">"$gt"</span>: <span class="hljs-number">20</span>}}, {<span class="hljs-string">"city"</span>: <span class="hljs-string">"åŒ—äº¬"</span>}]},
    
    <span class="hljs-comment"># é€»è¾‘OR</span>
    <span class="hljs-string">"OR"</span>: {<span class="hljs-string">"$or"</span>: [{<span class="hljs-string">"city"</span>: <span class="hljs-string">"åŒ—äº¬"</span>}, {<span class="hljs-string">"city"</span>: <span class="hljs-string">"ä¸Šæµ·"</span>}]},
}
</code></pre>
<h2 data-id="heading-5">6. å¯åŠ¨MongoDBæœåŠ¡</h2>
<p>åœ¨è¿è¡Œä»£ç å‰ï¼Œç¡®ä¿MongoDBæœåŠ¡å·²å¯åŠ¨ï¼š</p>
<p><strong>Windows:</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¯åŠ¨MongoDBæœåŠ¡</span>
net start MongoDB
</code></pre>
<p><strong>macOS:</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨Homebrewå®‰è£…åå¯åŠ¨</span>
brew services start mongodb-community
</code></pre>
<p><strong>Linux:</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Ubuntu/Debian</span>
sudo systemctl start mongod

<span class="hljs-comment"># æ£€æŸ¥çŠ¶æ€</span>
sudo systemctl status mongod
</code></pre>
<p>è¿™ä¸ªå®Œæ•´ç¤ºä¾‹æ¶µç›–äº†MongoDBçš„åŸºæœ¬æ“ä½œï¼ŒåŒ…æ‹¬è¿æ¥ã€CRUDæ“ä½œã€èšåˆæŸ¥è¯¢ç­‰ã€‚ä½ å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´å’Œæ‰©å±•è¿™äº›ä»£ç ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è¯´ç‚¹ä¸ä¸€æ ·çš„ã€‚GPT-5.3 ä¸ Claude Opus 4.6 åŒæ—¶ç‚¸åœºï¼Œå‰ç«¯å˜å¤©äº†ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7603308967124762624</link>    <guid>https://juejin.cn/post/7603308967124762624</guid>    <pubDate>2026-02-06T04:21:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603308967124762624" data-draft-id="7603238967291789364" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è¯´ç‚¹ä¸ä¸€æ ·çš„ã€‚GPT-5.3 ä¸ Claude Opus 4.6 åŒæ—¶ç‚¸åœºï¼Œå‰ç«¯å˜å¤©äº†ï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-02-06T04:21:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜Sunday"/> <meta itemprop="url" content="https://juejin.cn/user/2963939078980712"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è¯´ç‚¹ä¸ä¸€æ ·çš„ã€‚GPT-5.3 ä¸ Claude Opus 4.6 åŒæ—¶ç‚¸åœºï¼Œå‰ç«¯å˜å¤©äº†ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2963939078980712/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜Sunday
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T04:21:34.000Z" title="Fri Feb 06 2026 04:21:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.7;font-weight:400;font-size:16px;overflow-x:hidden;color:#2c3e50;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;font-weight:600;margin-top:35px;margin-bottom:8px;padding-bottom:5px}.markdown-body h1 :before,.markdown-body h2 :before,.markdown-body h3 :before,.markdown-body h4 :before,.markdown-body h5 :before,.markdown-body h6 :before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{padding-bottom:8px;margin-top:50px;font-size:24px;border-bottom:1px solid #eaecef}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #eaecef;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;font-weight:400;background-color:rgba(27,31,35,.05);color:#476582;margin:0;font-size:.85em;border-radius:3px;font-size:.87em;padding:.165em .5em}.markdown-body code,.markdown-body pre{font-family:source-code-pro,Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.6;padding:20px 24px;background-color:#282c34;border-radius:6px}.markdown-body pre&gt;code{font-size:14px;padding:0;margin:0;word-break:normal;display:block;overflow-x:auto;color:#fff}.markdown-body a{text-decoration:none;color:#3eaf7c;font-weight:500}.markdown-body a:active,.markdown-body a:hover{color:#42b983;border-bottom:1px solid #42b983}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;margin:16px 0;border-collapse:collapse}.markdown-body thead{background:#f6f6f6;background:#3eaf7c;color:#000;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f6f8fa}.markdown-body td,.markdown-body th{border:1px solid #dfe2e5;padding:10px 16px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{font-size:14px;padding:6px 23px;margin:22px 0;border-left:6px solid #42b983;background-color:#f3f5f7;font-weight:400}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body p,.markdown-body ul{line-height:1.7}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="base16/tomorrow-night">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ Sundayã€‚</p>
<p>æ—©ä¸Šä¸€èµ·æ¥ï¼Œæ‰‹æœºå°±è¢«åˆ·å±äº†...å„å¤§å·ä¸»éƒ½åœ¨å†™ OpenAI å’Œ Anthropic åœ¨æ˜¨å¤©æ™šä¸Šå‘å¸ƒçš„æœ€æ–°æ¨¡å‹ <code>GPT-5.3-Codex</code> å’Œ <code>Claude Opus 4.6</code></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab23ff67b58240a0b3ce0860c416b475~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYU3VuZGF5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770956519&amp;x-signature=QNwiTb%2BjMsZFVGXRbWfbI3SVNrM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4283959c7f514c6fb3c7a670e40f4b70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYU3VuZGF5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770956519&amp;x-signature=yDA0dOKoMCYuV8XfbZv3jUZXwtA%3D" alt="" loading="lazy"/></p>
<p>æˆ‘çœ‹äº†ä¸€çœ¼å„å¤§å·ä¸»çš„æ–‡ç« ï¼Œå‘ç°å¤§å®¶éƒ½åœ¨ç‹‚æ¬¢ï¼ˆçœŸå‡ä¸é‡è¦ï¼Œè‡³å°‘æ–‡ç« ä¸­éƒ½åœ¨ç‹‚æ¬¢ï¼‰ï¼Œéƒ½åœ¨å‘è·‘åˆ†æˆªå›¾ã€‚æœ‰çš„è¯´ Claude çš„ <strong>ä¸€ç™¾ä¸‡ï¼ˆ1Mï¼‰ä¸Šä¸‹æ–‡æ— æ•Œ</strong> äº†ï¼Œæœ‰çš„è¯´ GPT-5.3 çš„ <code>OSWorld</code> åˆ†æ•°å¤ªå“äººã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dda35edd5b5141c78f79f6f932aa1138~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYU3VuZGF5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770956519&amp;x-signature=smqLn3FjeqgqN5YVs4zQ0tZfw%2BA%3D" alt="Claude æä¾›ç™¾ä¸‡ä¸Šä¸‹æ–‡" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89807ffa3c95481ea04f8fe01f70aef0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYU3VuZGF5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770956519&amp;x-signature=LfGRmrCsAFiIAY0HQB5QOrg5B3s%3D" alt="GPT-5.3 çš„ OSWorld è·‘åˆ†" loading="lazy"/></p>
<p>ä½†æ˜¯ï¼ŒSunday ä½œä¸ºä¸€ä¸ªå†™äº†åå‡ å¹´ä»£ç ã€ç°åœ¨å¤©å¤©ç¢ç£¨æ€ä¹ˆç”¨ AI ææ•ˆçš„â€œè€å‰ç«¯â€ã€‚çœ‹äº†è¿™ä¸¤ç¯‡é•¿è¾¾æ•°ä¸‡å­—çš„æŠ€æœ¯æ–‡æ¡£ä¹‹åï¼Œå´å¹¶æ²¡æœ‰å…¶ä»–åšä¸»ååº”çš„é‚£ä¹ˆå…´å¥‹ã€‚</p>
<p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>å› ä¸ºï¼ŒSunday å‘ç°åœ¨è¿™ä¸¤ç¯‡æ–‡ç« ä¸­ï¼Œé¡¶çº§ AI æ¨¡å‹ç›®å‰äº‰è®ºçš„ç„¦ç‚¹ï¼Œå·²ç»å®Œå…¨ä¸æ˜¯â€œè°å†™çš„ä»£ç  Bug å°‘â€è¿™ä¹ˆç®€å•äº†ï¼Œ<strong>ä»–ä»¬æ­£åœ¨é‡æ–°å®šä¹‰ä»€ä¹ˆæ˜¯â€œå†™ä»£ç â€ï¼Ÿ</strong></p>
<p>æ‰€ä»¥ï¼Œä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼ŒSunday å°±æˆ‘ä¸å¸¦å¤§å®¶åƒçœ‹çƒ­é—¹ä¸€æ ·å»æ¯”é‚£äº›è™šæ— ç¼¥ç¼ˆçš„è·‘åˆ†ï¼ˆè™½ç„¶è·‘åˆ†éƒ½å¾ˆé«˜ï¼‰ï¼Œæˆ‘æƒ³å¸¦å¤§å®¶ä»å¦å¤–ä¸€ä¸ªè§’åº¦ï¼Œæ¥çœ‹çœ‹è¿™æ¬¡æ›´æ–°çš„æ ¸å¿ƒå†…å®¹ã€‚æˆ–è®¸å¤§å®¶çœ‹å®Œä¹‹åï¼Œèƒ½æœ‰ä¸ä¸€æ ·çš„æ”¶è·ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€ Claude Opus 4.6</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2d7ddfd08204f67b67ab0df3169c04e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYU3VuZGF5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770956519&amp;x-signature=O27f42zhiIbVfL3%2FxUGh0k4V7yA%3D" alt="" loading="lazy"/></p>
<p>å…ˆè¯´ Anthropic çš„ <code>Claude Opus 4.6</code>ã€‚</p>
<p>å¤§å®¶éƒ½åœ¨å¹ <strong>100 ä¸‡ Token ä¸Šä¸‹æ–‡ï¼ˆ1M Contextï¼‰</strong>ã€‚</p>
<p>å¾ˆå¤šäººå¯¹è¿™ä¸ªæ•°å­—æ²¡æ¦‚å¿µï¼Œè§‰å¾—ä¸å°±æ˜¯ï¼šâ€œå¯ä»¥æŠŠä¸€ä¸ªè¶…çº§å¤§çš„æ–‡æ¡£æ‰”ç»™ Claude è®©ä»–å¤„ç†äº†å—ï¼Ÿâ€</p>
<p>é”™ã€‚å¤§é”™ç‰¹é”™ã€‚</p>
<p>æƒ³è¦æ˜ç™½è¿™ä¸ªï¼Œæˆ‘ä»¬éœ€è¦å…ˆçŸ¥é“ <strong>AI å†™ä»£ç åˆ°åº•æ˜¯æ€ä¹ˆå»å†™çš„ï¼</strong></p>
<p>åœ¨ Opus 4.6 ä¹‹å‰ï¼Œæˆ‘ä»¬ç”¨ AI å†™ä»£ç æ˜¯ <strong>â€œåˆ‡ç‰‡å¼â€</strong> çš„ã€‚</p>
<p>ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p>
<p>æ¯”å¦‚ï¼šä½ çš„é¡¹ç›®å¯èƒ½æœ‰ 500 ä¸ªæ–‡ä»¶ï¼Œä½†ä½ æ¯æ¬¡åªèƒ½å¤åˆ¶ç²˜è´´é‚£ 3 ä¸ªç›¸å…³çš„æ–‡ä»¶ç»™ AIã€‚ AI æ¯æ¬¡ä¹Ÿåªæ˜¯è¯»å–å…¶ä¸­çš„éƒ¨åˆ†æ–‡ä»¶çš„éƒ¨åˆ†ä»£ç ã€‚ç®€å•ç†è§£å°±æ˜¯ï¼š<strong>AI æ˜¯çœ‹ä¸è§çš„å…¨å±€æ¶æ„è®¾è®¡çš„</strong>ã€‚å®ƒçœ‹ä¸è§ä½ çš„éšè—ä¾èµ–ã€æ¶æ„è®¾è®¡æ–¹æ¡ˆã€æ›´ä¸äº†è§£ä½  CSS ä¸­å¯èƒ½ä¼šå­˜åœ¨çš„å…¨å±€æ±¡æŸ“é—®é¢˜ã€‚</p>
<p>æ‰€ä»¥ï¼ŒAI ç»å¸¸ä¼šå†™å‡ºé‚£ç§ â€œ<strong>å±€éƒ¨å®Œç¾ï¼Œå…¨å±€å´©ç›˜</strong>â€ çš„ä»£ç ã€‚</p>
<p>ä¹‹å‰æˆ‘ä»¬çš„å¤„ç†æ–¹å¼éƒ½æ˜¯ï¼šå…ˆè®© AI è¿›è¡Œé€»è¾‘æ‹†è§£ï¼Œç„¶åæ ¹æ®å…·ä½“çš„æ­¥éª¤åœ¨ä¸€æ­¥æ­¥æ‰§è¡Œï¼Œè¿™æ ·ä¼šå¥½å¾ˆå¤šã€‚</p>
<p>ä½†æ˜¯ç°åœ¨ä¸ä¸€æ ·äº†ï¼Œ100 ä¸‡ Token ä¸Šä¸‹æ–‡å·²ç»è¶³å¤Ÿæˆ‘ä»¬å»ç†è§£éå¸¸å¤§çš„é¡¹ç›®ä»£ç ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼ŒClaude è¿˜æä¾›äº†ä¸€ä¸ªå«åš <code>Context Compactionï¼ˆä¸Šä¸‹æ–‡å‹ç¼©ï¼‰</code> çš„æŠ€æœ¯ï¼Œè¿™ä¸ªæŠ€æœ¯ä¼šä¼šè‡ªåŠ¨æ€»ç»“å¹¶æ›¿æ¢æ—§çš„ä¸Šä¸‹æ–‡ï¼Œè®© Claude èƒ½å¤Ÿæ‰§è¡Œæ›´é•¿æ—¶é—´çš„ä»»åŠ¡è€Œä¸ä¼šè¾¾åˆ°é™åˆ¶ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f87d476db6c44a7e82fba9054c136463~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYU3VuZGF5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770956519&amp;x-signature=4VSrEx8DX8NjIqKa5qpS6EqdVXk%3D" alt="" loading="lazy"/></p>
<p>è¿™æ„å‘³ç€ä»€ä¹ˆï¼Ÿ</p>
<p>è¿™æ„å‘³ç€ï¼šä½ å¯ä»¥æŠŠ <strong>æ•´ä¸ª</strong> å‰ç«¯é¡¹ç›®ï¼ˆsrc ç›®å½• + é…ç½® + æ–‡æ¡£ï¼‰ä¸€æ¬¡æ€§æ‰”ç»™ Claudeï¼Œä»–ä»¬é€šè¿‡ä¸Šä¸‹æ–‡å‹ç¼©æ–¹æ¡ˆï¼Œæ¥é€æ­¥å¤„ç†ä½ çš„æ‰€æœ‰æºä»£ç ã€‚</p>
<p>é™¤äº†è¿™ä¸ªä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå«åš <code>Agent Teamsï¼ˆä»£ç†å›¢é˜Ÿï¼‰</code> çš„ä¸œè¥¿ã€‚è¿™ä¸ªå’Œ Sunday ä¹‹å‰å†™çš„ä¸€ç¯‡æ–‡ç« æœ‰ç‚¹ç›¸ä¼¼ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥çœ‹çœ‹ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FqrTSRe_yfrqKI25ALZu3lg" target="_blank" title="https://mp.weixin.qq.com/s/qrTSRe_yfrqKI25ALZu3lg" ref="nofollow noopener noreferrer">æˆ‘åˆ›å»ºäº†ä¸€ä¸ªå…¨ AI å‘˜å·¥çš„ä¸€äººå…¬å¸</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc1456759ae743c5906e191ceb54580b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYU3VuZGF5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770956519&amp;x-signature=nsmsVl0xQn%2F6r2Ht%2Ft8aPBn5w%2Fs%3D" alt="" loading="lazy"/></p>
<p>è¿™ç©æ„æ˜¯å•¥æ„æ€å‘¢ï¼Ÿ</p>
<p>ç®€å•æ¥è¯´å°±æ˜¯ï¼š<strong>ä»¥å‰æˆ‘ä»¬ç”¨ Claude Codeï¼Œæ˜¯ä¸€å¯¹ä¸€ã€‚ç°åœ¨ï¼Œä»–å¯ä»¥ç›´æ¥åˆ›å»ºå‡ºä¸€ä¸ª Claude Code çš„å›¢é˜Ÿã€‚</strong> å›¢é˜Ÿä¸­æ¯ä¸ªäººï¼ˆAgentï¼‰å„å¸å…¶äº‹ï¼Œå„è‡ªç‹¬ç«‹ï¼Œå¹¶è¿˜å¯ä»¥ç›¸äº’å†™ä½œï¼Œç›¸äº’åµæ¶ã€‚</p>
<ul>
<li><strong>Agent Aï¼ˆæ¶æ„å¸ˆï¼‰</strong>ï¼šè´Ÿè´£æ‹†è§£éœ€æ±‚ï¼Œä¸å†™ä»£ç ã€‚</li>
<li><strong>Agent Bï¼ˆå¼€å‘ï¼‰</strong>ï¼šè´Ÿè´£å…·ä½“å®ç°ã€‚</li>
<li><strong>Agent Cï¼ˆæµ‹è¯•ï¼‰</strong>ï¼šè´Ÿè´£å†™å•å…ƒæµ‹è¯•ï¼Œå¹¶è¯•å›¾ä¸ºäº† Agent B çš„ä»£ç æ‰¾èŒ¬ã€‚</li>
</ul>
<p>å°±åƒ <code>claude</code> çš„æ›´æ–°å…¬å‘Šåœ¨ç»“å°¾æ‰€å±•ç¤ºçš„ä¸€æ ·ï¼š<strong>è¿™æ¬¡æ›´æ–°æ˜¯è§£é”äº†æ–°çš„é•¿æœŸä»»åŠ¡çš„å¼€å§‹</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73885d7c9ed1423daf1eeece27b25002~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYU3VuZGF5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770956519&amp;x-signature=Fjt1chEoAdXwpdtsRIBK6%2BVJpMg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">äºŒã€ GPT-5.3 Codex</h2>
<p>å¦‚æœè¯´ Claude æ˜¯åœ¨æ¨ªå‘æ‰©å±•ï¼ˆå®¹é‡ï¼‰ï¼Œé‚£ OpenAI çš„ <strong>GPT-5.3 Codex</strong> å°±æ˜¯åœ¨çºµå‘é’»å­”ï¼ˆæ·±åº¦ï¼‰ã€‚</p>
<p>è¿™ç¯‡åšå®¢é‡Œæœ€è®©æˆ‘èµ·é¸¡çš®ç–™ç˜©çš„ä¸€å¥è¯æ˜¯ï¼š</p>
<blockquote>
<p><strong>"GPT-5.3 Codex is the first model to play a key role in its own development."</strong> ï¼ˆGPT-5.3 Codex æ˜¯ç¬¬ä¸€ä¸ªåœ¨è‡ªèº«å¼€å‘è¿‡ç¨‹ä¸­å‘æŒ¥å…³é”®ä½œç”¨çš„æ¨¡å‹ã€‚ï¼‰</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a93bb9d5c87d470d85c28b49fb961373~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYU3VuZGF5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770956519&amp;x-signature=94fpO%2BaCK3Ur5Ioj4YYZOA%2BXUGQ%3D" alt="" loading="lazy"/></p>
<p>å…„å¼Ÿä»¬ï¼Œè¿™å‰§æœ¬æˆ‘çœ‹è¿‡ï¼Œè¿™å°±å«â€œå·¦è„šè¸©å³è„šä¸Šå¤©â€ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f91d3fab8444f9f9385122ac596e313~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYU3VuZGF5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770956519&amp;x-signature=VFobsjGI3epG3YfmacSvz5xKO94%3D" alt="" loading="lazy"/></p>
<p>åœ¨ OpenAI çš„ç¨‹åºå‘˜ç°åœ¨å·²ç»å¼€å§‹ä½¿ç”¨ GPT æ¥å¼€å‘æ–°çš„ GPT äº†....</p>
<p>è¿™æ„å‘³ç€ï¼š ç›®å‰çš„  AI æ¨¡å‹å·²ç»å®Œå…¨å¯ä»¥åº”ç”¨åœ¨å¤æ‚çš„å•†ä¸šé¡¹ç›®ä¸­ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/709f3bb17cfb46ebacbc373f9e0e05c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYU3VuZGF5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770956519&amp;x-signature=tV4wgPp0ynw57I15dqG5A%2FHuzV4%3D" alt="" loading="lazy"/></p>
<p>è€Œåœ¨çœ‹å®Œæ•´ä¸ª GPT 5.3 çš„æ›´æ–°å…¬å‘Šä¹‹åï¼ŒSunday å‘ç°å…¶ä¸­æœ‰ä¸¤ä¸ªç‚¹æ˜¯æœ€é‡è¦çš„ï¼š</p>
<h3 data-id="heading-2">1. â€œäº¤äº’å¼â€çº åï¼ˆInteractive Collaborationï¼‰</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfcdac1f88454e1396256735301aba13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYU3VuZGF5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770956519&amp;x-signature=36%2B6FPJf5M%2BnvTiLPN6OropeLAI%3D" alt="" loading="lazy"/></p>
<p>ä»¥å‰ç”¨ Agent å†™ä»£ç ï¼Œå¤§å®¶æœ€å®³æ€•çš„æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>æœ€æ€•çš„æ˜¯å®ƒ â€œä¸€æ¡é“èµ°åˆ°é»‘â€ï¼</p>
<p>ä½ ç»™ä¸ªéœ€æ±‚ï¼Œå®ƒè·‘äº†åŠå°æ—¶ï¼Œæœ€åç»™ä½ ä¸€å¨è·‘ä¸é€šçš„ä»£ç ï¼Œä½ è¿˜ä¸çŸ¥é“å®ƒæ˜¯å“ªä¸€æ­¥æ­ªçš„ã€‚</p>
<p>GPT-5.3 Codex å¼•å…¥äº† <strong>â€œäººæœºä»‹å…¥â€</strong> æœºåˆ¶ã€‚</p>
<p>å½“å®ƒåœ¨æ„å»ºä¸€ä¸ªå¤æ‚çš„ Web æ¸¸æˆï¼ˆæ¯”å¦‚åšå®¢é‡Œå±•ç¤ºçš„é‚£ä¸ªèµ›è½¦æ¸¸æˆï¼‰æ—¶</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e628d555a4242868111f64bdce0fac6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYU3VuZGF5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770956519&amp;x-signature=AetUDIzR%2BRLX%2BcW%2BshRKvWCmfAU%3D" alt="" loading="lazy"/></p>
<p>å¦‚æœå®ƒå¡ä½äº†ï¼Œæˆ–è€…æ–¹å‘åäº†ï¼Œä½ å¯ä»¥<strong>å®æ—¶</strong>æš‚åœå®ƒï¼Œç»™å®ƒå–‚ä¸€å¥åé¦ˆï¼Œå®ƒèƒ½æ— ç¼æ¥ä½ä½ çš„æ€è·¯ç»§ç»­å¹²ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5c5c849f7174f92866acff1a5e85fd7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYU3VuZGF5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770956519&amp;x-signature=6Nr7tGLn9kjjYDXZmEy6MEcOlzc%3D" alt="" loading="lazy"/></p>
<p>è¿™è§£å†³äº† Agent è½åœ°æœ€å¤§çš„ç—›ç‚¹ï¼š<strong>ä¸å¯æ§æ€§</strong>ã€‚</p>
<h3 data-id="heading-3">2. çœŸæ­£çš„ GUI æ“ä½œèƒ½åŠ›ï¼ˆOSWorld 64.7%ï¼‰</h3>
<p><code>OSWorld</code> æ˜¯ AI æ¨¡å‹ä¸­çš„ä¸€ä¸ªä¸“ä¸šå±äºï¼Œä»–è¡¨ç¤ºçš„æ˜¯ <code>å¯¹è§†è§‰ä»»åŠ¡çš„è¯†åˆ«ç¨‹åº¦</code>ã€‚</p>
<p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæ™®é€šäººçš„ <code>OSWorld</code> å¤§çº¦æ˜¯åœ¨ <code>72%</code> å·¦å³ã€‚</p>
<p>ä½†æ˜¯ï¼Œè¿™æ¬¡ GPT 5.3 çš„æ›´æ–° OSWorld åˆ†æ•°é£™åˆ°äº† <code>64.7%</code>ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6ff7704d880422c8b1efdecda228ed9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYU3VuZGF5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770956519&amp;x-signature=Q1PGdD3pPiCsqIV85dqFVUABd7o%3D" alt="" loading="lazy"/></p>
<p>è¿™æ„å‘³ç€ï¼ŒGPT ç°åœ¨ä¸åªæ˜¯åªèƒ½åœ¨ç»ˆç«¯é‡Œé¢è·‘å‘½ä»¤è¡Œäº†ã€‚ä»–ç°åœ¨å¯ä»¥åƒäººä¸€æ ·ï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œæ‰“å¼€ Chrome DevToolsï¼Œç‚¹å‡»é‚£ä¸ªæŠ¥é”™çš„æŒ‰é’®ï¼ŒæŸ¥çœ‹ Network é¢æ¿ï¼Œç„¶ååˆ‡å›ç¼–è¾‘å™¨æ”¹ä»£ç ã€‚</p>
<p>è¿™ä¸‹æ„Ÿè§‰ â€œæµ‹è¯•è¦å¤±ä¸šäº†...â€ã€‚ä¹‹å‰å’±ä»¬è¿˜å¾—å†™ä¸ªæµ‹è¯•ä»£ç å•¥çš„ï¼Œç°åœ¨éƒ½å·²ç»ä¸éœ€è¦äº†ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç›´æ¥å‘Šè¯‰ GPT-5.3ï¼šâ€œå»æŠŠé‚£ä¸ªä¸‹å•æµç¨‹æµ‹ä¸€éï¼Œå¦‚æœæ”¯ä»˜å¤±è´¥äº†ï¼Œæˆªä¸ªå›¾å‘æˆ‘ã€‚â€</p>
<p>å®ƒç°åœ¨å®Œå…¨å¯ä»¥åšåˆ°äº†ï¼</p>
<h2 data-id="heading-4">ä¸‰ã€ æ€è€ƒæ€»ç»“</h2>
<p>ä¸çŸ¥é“å¤§å®¶çœ‹å®Œè¿™äº›å‡çº§ä¹‹åæ˜¯ä»€ä¹ˆæ„Ÿè§‰ï¼Ÿ</p>
<p>Sunday ä¸ªäººçš„æ„Ÿè§‰æ˜¯ï¼šâ€œå‰ç«¯åˆè¦å¤±ä¸šäº†â€ã€‚æ¯•ç«Ÿ <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F9uQw97RJ1VzA_vp2RHwd3w" target="_blank" title="https://mp.weixin.qq.com/s/9uQw97RJ1VzA_vp2RHwd3w" ref="nofollow noopener noreferrer">2025 å¹´å‰ç«¯ä¸€å¹´å°±æ­»äº† 10 æ¬¡...</a></p>
<p>æ²¡é‚£ä¹ˆä¸¥é‡ï¼</p>
<p>ä¸è¿‡ï¼Œå¤§å®¶éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<strong>å¦‚æœä½ è¿˜æ˜¯æŠŠè‡ªå·±å®šä¹‰ä¸º â€œåˆ‡å›¾ä»”â€ æˆ–è€… â€œAPI è°ƒåŒ…ä¾ â€ ï¼Œé‚£æ˜¯çœŸå®Œäº†</strong></p>
<p>ä½†æ˜¯ï¼Œå¦‚æœä½ æŠŠè‡ªå·±å®šä¹‰ä¸º <strong>â€œäº§å“å·¥ç¨‹å¸ˆâ€</strong> ï¼é‚£ä¹ˆå±äºä½ çš„é»„é‡‘æ—¶ä»£æ‰åˆšåˆšå¼€å§‹ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Ÿ</p>
<h3 data-id="heading-5">1. æŠ€æœ¯çš„â€œå¹³æƒâ€</h3>
<p>ä»¥å‰ï¼Œæˆ‘ä»¬è¦æƒ³åšä¸€ä¸ªå…¨æ ˆåº”ç”¨ï¼Œé—¨æ§›å¤ªé«˜äº†ã€‚ä½ è¦æ‡‚ Dockerï¼Œè¦æ‡‚ K8sï¼Œè¦æ‡‚æ•°æ®åº“è°ƒä¼˜ã€‚</p>
<p>ç°åœ¨ï¼ŒGPT-5.3 Codex è¿è‡ªå·±çš„è®­ç»ƒé›†ç¾¤éƒ½èƒ½ç®¡ç†ã€‚ä½ åªè¦æœ‰<strong>ç³»ç»Ÿè®¾è®¡</strong>çš„èƒ½åŠ›ï¼Œä½ ä¸€ä¸ªäººå°±æ˜¯ä¸€ä¸ªå›¢é˜Ÿï¼ˆAI è™½ç„¶ä¸ä¾¿å®œï¼Œä½†æ˜¯æ¯”è¯·äººå¯ä¾¿å®œå¤šäº†ï¼‰ã€‚</p>
<p>å‰ç«¯å¼€å‘è€…ï¼Œå‡­å€Ÿå¯¹ <strong>ç”¨æˆ·ä½“éªŒï¼ˆUXï¼‰</strong> çš„æ•æ„Ÿåº¦ï¼ŒåŠ ä¸Š AI å¼ºå¤§çš„åç«¯å¡«è¡¥èƒ½åŠ›ï¼Œå°†æˆä¸ºæœ€å®¹æ˜“è½¬å‹ä¸ºâ€œç‹¬ç«‹å¼€å‘è€…â€æˆ–â€œè¶…çº§ä¸ªä½“â€çš„äººç¾¤ã€‚</p>
<h3 data-id="heading-6">2. ä» â€œæ€ä¹ˆå®ç°â€ åˆ° â€œå¦‚ä½•è§£å†³é—®é¢˜â€</h3>
<p>åœ¨ä»¥å‰ï¼Œæˆ‘ä»¬è¿™äº›ç¨‹åºå‘˜ 80% çš„æ—¶é—´åœ¨ç ”ç©¶ "å¦‚ä½•å»å®ç°æŸä¸€ä¸ªåŠŸèƒ½"ï¼ˆè¿™ä¸ªæ•ˆæœæ€ä¹ˆç”¨ CSS å®ç°ï¼Ÿè¿™ä¸ªçŠ¶æ€æ€ä¹ˆç®¡ç†ï¼Ÿï¼‰ã€‚</p>
<p>ä½†æ˜¯ç°åœ¨ï¼Œä¸éœ€è¦äº†ã€‚</p>
<p>ç°åœ¨ï¼Œæ— è®ºæ˜¯ Claude è¿˜æ˜¯ GPT éƒ½å¯ä»¥å¸®åŠ©æˆ‘ä»¬å»è§£å†³å¦‚ä½•å®ç°åŠŸèƒ½çš„é—®é¢˜ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æŠŠé‡ç‚¹æ”¹ä¸ºï¼š<strong>æˆ‘ä»¬è¦è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿç”¨æˆ·çš„ç—›ç‚¹åœ¨å“ªé‡Œï¼Ÿç³»ç»Ÿçš„æ•°æ®æµæ€ä¹ˆè®¾è®¡æ‰åˆç†ï¼Ÿ</strong></p>
<p>åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œ<strong>å¯¹ç”¨æˆ·å’Œéœ€æ±‚çš„æ„ŸçŸ¥åŠ›</strong> æ­£å˜çš„è¶Šæ¥è¶Šé‡è¦ã€‚</p>
<p><strong>æœ€åï¼Œæˆ‘æƒ³é—®å¤§å®¶ä¸€ä¸ªé—®é¢˜ï¼š</strong></p>
<blockquote>
<p>å¦‚æœæ˜å¤©ï¼Œä½ ä¸éœ€è¦å†å†™ä¸€è¡Œå…·ä½“çš„ä¸šåŠ¡ä»£ç ï¼Œåªéœ€è¦å®¡æ ¸ Agent æäº¤çš„ PRï¼Œä½ ä¼šæŠŠä½ çœä¸‹æ¥çš„è¿™ 8 ä¸ªå°æ—¶ï¼Œç”¨æ¥å¹²ä»€ä¹ˆï¼Ÿ</p>
</blockquote>
<p><strong>æ˜¯å»å­¦æ–°çš„æŠ€æœ¯ï¼Ÿè¿˜æ˜¯å»æ·±å…¥ç†è§£ä¸šåŠ¡ï¼Ÿæˆ–è€…ï¼Œå»åˆ›é€ ä¸€ä¸ªå±äºä½ è‡ªå·±çš„äº§å“ï¼Ÿ</strong></p>
<p>è¿™æ‰æ˜¯ <strong>2026 æˆ‘ä»¬æ€è€ƒçš„äº‹æƒ…</strong></p>
<p>åˆ«å…‰çœ‹ç€è·‘åˆ†æ¿€åŠ¨äº†ã€‚è¡ŒåŠ¨èµ·æ¥ï¼Œå»ç”³è¯· APIï¼Œå»æŠŠä½ çš„ IDE æ¢æˆ Cursor æˆ–è€… Windsurfï¼Œå»æ„Ÿå—ä¸€ä¸‹è¿™ç§ <strong>â€œä¸ç¡…åŸºç”Ÿç‰©ç»“å¯¹ç¼–ç¨‹â€</strong> çš„æ„Ÿè§‰ã€‚</p>
<p>æˆ‘æ˜¯ Sundayã€‚å¦‚æœä½ åœ¨ç”¨è¿™ä¸¤ä¸ªæ¨¡å‹çš„è¿‡ç¨‹ä¸­é‡åˆ°äº†ä»€ä¹ˆå‘ï¼Œæˆ–è€…å‘ç°äº†ä»€ä¹ˆæ–°ç©æ³•ï¼Œéšæ—¶åœ¨è¯„è®ºåŒºæˆ–è€…ç¾¤é‡Œå‘Šè¯‰æˆ‘ã€‚æˆ‘ä»¬ä¸€èµ·ç ”ç©¶ï¼Œç»ä¸æ‰é˜Ÿã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»é›¶å¼€å§‹å­¦Flinkï¼šFlink SQL æç®€å…¥é—¨]]></title>    <link>https://juejin.cn/post/7603393977476497434</link>    <guid>https://juejin.cn/post/7603393977476497434</guid>    <pubDate>2026-02-06T06:59:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603393977476497434" data-draft-id="7603321550246510642" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»é›¶å¼€å§‹å­¦Flinkï¼šFlink SQL æç®€å…¥é—¨"/> <meta itemprop="keywords" content="Flink,å¤§æ•°æ®,SQL"/> <meta itemprop="datePublished" content="2026-02-06T06:59:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä»£ç åŒ å¿ƒ"/> <meta itemprop="url" content="https://juejin.cn/user/1697301684826952"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»é›¶å¼€å§‹å­¦Flinkï¼šFlink SQL æç®€å…¥é—¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1697301684826952/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä»£ç åŒ å¿ƒ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T06:59:43.000Z" title="Fri Feb 06 2026 06:59:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    25
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Flink SQL æ˜¯ Apache Flink çš„æ ¸å¿ƒæ¨¡å—ä¹‹ä¸€ï¼Œå®ƒè®©å¼€å‘è€…å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ SQL è¯­æ³•æ¥ç¼–å†™æµå¤„ç†å’Œæ‰¹å¤„ç†ä½œä¸šã€‚å¯¹äºä¸æƒ³æ·±ç©¶ Java/Scala å¤æ‚ API çš„â€œå°ç™½â€æ¥è¯´ï¼ŒFlink SQL æ˜¯è¿›å…¥å®æ—¶è®¡ç®—é¢†åŸŸçš„æœ€ä½³æ•²é—¨ç –ã€‚</p>
<p>æœ¬æ–‡å°†åŸºäº <strong>Flink 1.20.1</strong> ç‰ˆæœ¬ï¼Œæ‰‹æŠŠæ‰‹æ•™ä½ åœ¨ WSL2 (Ubuntu) ç¯å¢ƒä¸‹æ­å»ºç¯å¢ƒï¼Œå¹¶è¿è¡Œä½ çš„ç¬¬ä¸€ä¸ª Flink SQL ä»»åŠ¡ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€ä¸ºä»€ä¹ˆé€‰æ‹© Flink SQLï¼Ÿ</h2>
<ol>
<li><strong>ä½é—¨æ§›</strong>ï¼šä¼šå†™ SQL å°±èƒ½å¼€å‘å®æ—¶ä»»åŠ¡ã€‚</li>
<li><strong>ç»Ÿä¸€æ€§</strong>ï¼šæ‰¹æµä¸€ä½“ï¼ŒåŒä¸€å¥— SQL æ—¢å¯ä»¥è·‘å†å²æ•°æ®ï¼ˆæ‰¹ï¼‰ï¼Œä¹Ÿå¯ä»¥è·‘å®æ—¶æ•°æ®ï¼ˆæµï¼‰ã€‚</li>
<li><strong>ç”Ÿæ€ä¸°å¯Œ</strong>ï¼šå†…ç½®äº†å¤§é‡çš„ Connectorï¼ˆè¿æ¥å™¨ï¼‰ï¼Œè½»æ¾è¿æ¥ Kafkaã€MySQLã€Hive ç­‰ä¸»æµç»„ä»¶ã€‚</li>
</ol>
<p><img src="https://pic-1258258471.cos.ap-nanjing.myqcloud.com/img/fKaLmuiLB.jpeg" alt="Flink SQL æ¶æ„å›¾" loading="lazy"/>
<em>(å›¾ï¼šFlink SQL æ¶æ„ç¤ºæ„å›¾ï¼Œå±•ç¤º SQL è§£æã€ä¼˜åŒ–åˆ°æ‰§è¡Œçš„è¿‡ç¨‹)</em></p>
<h2 data-id="heading-1">äºŒã€ç¯å¢ƒå‡†å¤‡ (WSL2 Ubuntu)</h2>
<p>æœ¬æ•™ç¨‹æ¼”ç¤ºç¯å¢ƒä¸º Windows ä¸‹çš„ WSL2 (Ubuntu 20.04/22.04)ï¼Œè¿™æ˜¯ç›®å‰ Windows ç”¨æˆ·ä½“éªŒ Linux å¼€å‘ç¯å¢ƒçš„æœ€ä½³å§¿åŠ¿ã€‚
å‚è€ƒä»¥å‰å†™çš„æ–‡ç« <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F2_d434kpSeKrSh-krRgvsQ" target="_blank" title="https://mp.weixin.qq.com/s/2_d434kpSeKrSh-krRgvsQ" ref="nofollow noopener noreferrer">ä»é›¶å¼€å§‹å­¦Flinkï¼šæ­å¼€å®æ—¶è®¡ç®—çš„ç¥ç§˜é¢çº±</a>ï¼Œæ­å»ºå¥½ Flink ç¯å¢ƒã€‚</p>
<h2 data-id="heading-2">ä¸‰ã€ä½“éªŒ Flink SQL Client</h2>
<p>Flink æä¾›äº†ä¸€ä¸ªäº¤äº’å¼çš„å‘½ä»¤è¡Œå·¥å…·ï¼š<strong>SQL Client</strong>ã€‚å®ƒå…è®¸ä½ ç›´æ¥åœ¨ç»ˆç«¯ç¼–å†™å’Œæäº¤ SQL ä»»åŠ¡ã€‚</p>
<h3 data-id="heading-3">1. å¯åŠ¨ SQL Client</h3>
<p>å¦‚æœæ²¡æœ‰å¯åŠ¨Flinké›†ç¾¤,åˆ™å…ˆå¯åŠ¨flinké›†ç¾¤:</p>
<pre><code class="hljs language-bash" lang="bash">./bin/start-cluster.sh
</code></pre>
<p>,ç„¶ååœ¨ Flink ç›®å½•ä¸‹æ‰§è¡Œï¼š</p>
<pre><code class="hljs language-bash" lang="bash">./bin/sql-client.sh
</code></pre>
<p>ä½ å°†çœ‹åˆ°é‚£åªè‘—åçš„æ¾é¼  LOGOï¼š</p>
<p><img src="https://pic-1258258471.cos.ap-nanjing.myqcloud.com/img/20260206133223512.png" alt="SQLClientå¯åŠ¨ç•Œé¢" loading="lazy"/>
<em>(å›¾ï¼šSQL Client å¯åŠ¨æ¬¢è¿ç•Œé¢)</em></p>
<h3 data-id="heading-4">2. Hello Worldï¼šæ•°æ®ç”Ÿæˆä¸æ‰“å°</h3>
<p>æˆ‘ä»¬ä¸ä¾èµ–ä»»ä½•å¤–éƒ¨ç»„ä»¶ï¼ˆå¦‚ Kafkaï¼‰ï¼Œç›´æ¥ä½¿ç”¨ Flink å†…ç½®çš„ <code>datagen</code> è¿æ¥å™¨ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®ï¼Œå¹¶ç”¨ <code>print</code> è¿æ¥å™¨æ‰“å°ç»“æœã€‚</p>
<p><strong>ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæºè¡¨ (Source Table)</strong></p>
<p>å¤åˆ¶ä»¥ä¸‹ SQL åˆ° SQL Client ä¸­æ‰§è¡Œï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> source_table (
    id <span class="hljs-type">INT</span>,
    name STRING,
    ts <span class="hljs-type">TIMESTAMP</span>(<span class="hljs-number">3</span>),
    WATERMARK <span class="hljs-keyword">FOR</span> ts <span class="hljs-keyword">AS</span> ts <span class="hljs-operator">-</span> <span class="hljs-type">INTERVAL</span> <span class="hljs-string">'5'</span> <span class="hljs-keyword">SECOND</span>
) <span class="hljs-keyword">WITH</span> (
    <span class="hljs-string">'connector'</span> <span class="hljs-operator">=</span> <span class="hljs-string">'datagen'</span>,       <span class="hljs-comment">-- ä½¿ç”¨æ•°æ®ç”Ÿæˆå™¨</span>
    <span class="hljs-string">'rows-per-second'</span> <span class="hljs-operator">=</span> <span class="hljs-string">'1'</span>,       <span class="hljs-comment">-- æ¯ç§’ç”Ÿæˆ1æ¡æ•°æ®</span>
    <span class="hljs-string">'fields.id.kind'</span> <span class="hljs-operator">=</span> <span class="hljs-string">'sequence'</span>, <span class="hljs-comment">-- id å­—æ®µä¸ºåºåˆ—</span>
    <span class="hljs-string">'fields.id.start'</span> <span class="hljs-operator">=</span> <span class="hljs-string">'1'</span>,       <span class="hljs-comment">-- id ä»1å¼€å§‹</span>
    <span class="hljs-string">'fields.id.end'</span> <span class="hljs-operator">=</span> <span class="hljs-string">'100'</span>        <span class="hljs-comment">-- id åˆ°100ç»“æŸ</span>
);
</code></pre>
<p>æ‰§è¡Œåæ˜¾ç¤º <code>[INFO] Execute statement succeed.</code>ã€‚</p>
<p><strong>ç¬¬äºŒæ­¥ï¼šåˆ›å»ºç»“æœè¡¨ (Sink Table)</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> print_table (
    id <span class="hljs-type">INT</span>,
    name STRING,
    ts <span class="hljs-type">TIMESTAMP</span>(<span class="hljs-number">3</span>)
) <span class="hljs-keyword">WITH</span> (
    <span class="hljs-string">'connector'</span> <span class="hljs-operator">=</span> <span class="hljs-string">'print'</span>          <span class="hljs-comment">-- ä½¿ç”¨æ§åˆ¶å°æ‰“å°è¿æ¥å™¨</span>
);
</code></pre>
<p><strong>ç¬¬ä¸‰æ­¥ï¼šæäº¤ä»»åŠ¡</strong></p>
<p>å°†æºè¡¨çš„æ•°æ®æ’å…¥åˆ°ç»“æœè¡¨ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> print_table <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> source_table;
</code></pre>
<p>æ­¤æ—¶ï¼ŒSQL Client ä¼šæäº¤ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡åˆ°é›†ç¾¤ã€‚ä½ ä¼šçœ‹åˆ°ç±»ä¼¼ Job ID çš„è¾“å‡ºã€‚</p>
<h3 data-id="heading-5">3. æŸ¥çœ‹è¿è¡Œç»“æœ</h3>
<p>ç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ <code>print</code> è¿æ¥å™¨ï¼Œåœ¨ Standalone æ¨¡å¼ä¸‹ï¼Œè¾“å‡ºä¼šæ‰“å°åˆ° TaskManager çš„æ—¥å¿—æ–‡ä»¶ä¸­ã€‚</p>
<p>æ‰“å¼€ä¸€ä¸ªæ–°çš„ WSL2 ç»ˆç«¯çª—å£ï¼Œè¿›å…¥ Flink ç›®å½•æŸ¥çœ‹æ—¥å¿—ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è¿›å…¥ log ç›®å½•</span>
<span class="hljs-built_in">cd</span> <span class="hljs-built_in">log</span>

<span class="hljs-comment"># æŸ¥çœ‹æœ€æ–°çš„ .out æ–‡ä»¶ (æ–‡ä»¶ååŒ…å« taskexecutor)</span>
<span class="hljs-built_in">tail</span> -f flink-*-taskexecutor-*.out
</code></pre>
<p>ä½ åº”è¯¥èƒ½çœ‹åˆ°å±å¹•ä¸Šä¸æ–­è·³åŠ¨çš„æ•°æ®æµï¼š</p>
<p><img src="https://pic-1258258471.cos.ap-nanjing.myqcloud.com/img/20260206134253149.png" alt="è¿è¡Œç»“æœæ—¥å¿—æˆªå›¾ä½ç½®" loading="lazy"/>
<em>(å›¾ï¼šç»ˆç«¯ tail -f å‘½ä»¤çœ‹åˆ°çš„å®æ—¶æ•°æ®è¾“å‡º)</em></p>
<h2 data-id="heading-6">å››ã€å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥</h2>
<p>åœ¨ SQL Client ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<ul>
<li><code>HELP</code>: æŸ¥çœ‹å¸®åŠ©ã€‚</li>
<li><code>SHOW TABLES</code>: æŸ¥çœ‹å½“å‰åˆ›å»ºçš„è¡¨ã€‚</li>
<li><code>SHOW JOBS</code>: æŸ¥çœ‹è¿è¡Œä¸­çš„ä½œä¸šã€‚</li>
<li><code>DESCRIBE table_name</code>: æŸ¥çœ‹è¡¨ç»“æ„ã€‚</li>
<li><code>QUIT</code>: é€€å‡º SQL Clientã€‚</li>
</ul>
<h2 data-id="heading-7">äº”ã€æ€»ç»“</h2>
<p>æ­å–œä½ ï¼ä½ å·²ç»æˆåŠŸè¿è¡Œäº†äººç”Ÿä¸­ç¬¬ä¸€ä¸ª Flink SQL ä»»åŠ¡ã€‚</p>
<p>é€šè¿‡æœ¬æ–‡ï¼Œæˆ‘ä»¬å®Œæˆäº†ï¼š</p>
<ol>
<li>WSL2 ä¸‹ Java å’Œ Flink 1.20.1 çš„å®‰è£…ã€‚</li>
<li>å¯åŠ¨äº† Flink æœ¬åœ°é›†ç¾¤ã€‚</li>
<li>ä½¿ç”¨ SQL Client åˆ›å»ºäº† Source å’Œ Sink è¡¨ï¼Œå¹¶è·‘é€šäº†æ•°æ®æµã€‚</li>
</ol>
<p>ä¸‹ä¸€ç¯‡ï¼Œæˆ‘ä»¬å°†æ·±å…¥è®²è§£ Flink SQL ä¸­çš„**çª—å£ï¼ˆWindowï¼‰**æ“ä½œï¼Œçœ‹çœ‹å¦‚ä½•å¤„ç†â€œè¿‡å»5åˆ†é’Ÿçš„è®¢å•æ€»é¢â€è¿™ç±»ç»å…¸éœ€æ±‚ã€‚</p>
<hr/>
<p><strong>å‚è€ƒèµ„æ–™</strong>ï¼š</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnightlies.apache.org%2Fflink%2Fflink-docs-release-1.20%2F" target="_blank" title="https://nightlies.apache.org/flink/flink-docs-release-1.20/" ref="nofollow noopener noreferrer">Flink å®˜æ–¹æ–‡æ¡£</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»é›¶åˆ°ä¸€ï¼šåŸºäº micro-app çš„ä¼ä¸šçº§å¾®å‰ç«¯æ¨¡æ¿å®Œæ•´å®ç°æŒ‡å—]]></title>    <link>https://juejin.cn/post/7603567912593424411</link>    <guid>https://juejin.cn/post/7603567912593424411</guid>    <pubDate>2026-02-07T07:39:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603567912593424411" data-draft-id="7603567912593391643" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»é›¶åˆ°ä¸€ï¼šåŸºäº micro-app çš„ä¼ä¸šçº§å¾®å‰ç«¯æ¨¡æ¿å®Œæ•´å®ç°æŒ‡å—"/> <meta itemprop="keywords" content="æ¶æ„,å‰ç«¯,å¾®æœåŠ¡"/> <meta itemprop="datePublished" content="2026-02-07T07:39:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RemHusband"/> <meta itemprop="url" content="https://juejin.cn/user/1425415102792237"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»é›¶åˆ°ä¸€ï¼šåŸºäº micro-app çš„ä¼ä¸šçº§å¾®å‰ç«¯æ¨¡æ¿å®Œæ•´å®ç°æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1425415102792237/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RemHusband
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T07:39:18.000Z" title="Sat Feb 07 2026 07:39:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»15åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>æœ¬æ–‡æ˜¯ä¸€ç¯‡å®Œæ•´çš„æŠ€æœ¯å®è·µæ–‡ç« ï¼Œè®°å½•äº†å¦‚ä½•ä»é›¶å¼€å§‹æ„å»ºä¸€ä¸ªä¼ä¸šçº§ micro-app å¾®å‰ç«¯æ¨¡æ¿é¡¹ç›®ã€‚æ–‡ç« åŒ…å«å®Œæ•´çš„æŠ€æœ¯é€‰å‹ã€æ¶æ„è®¾è®¡ã€æ ¸å¿ƒä»£ç å®ç°ã€è¸©å‘ç»éªŒä»¥åŠæœ€ä½³å®è·µï¼Œé€‚åˆæœ‰ä¸€å®šå‰ç«¯åŸºç¡€çš„å¼€å‘è€…æ·±å…¥å­¦ä¹ ã€‚</strong></p>
</blockquote>
<h2 data-id="heading-0">ğŸ“‹ æ–‡ç« æ‘˜è¦</h2>
<p>æœ¬æ–‡è¯¦ç»†è®°å½•äº†åŸºäº <strong>micro-app</strong> æ¡†æ¶æ„å»ºä¼ä¸šçº§å¾®å‰ç«¯æ¨¡æ¿çš„å®Œæ•´å®ç°è¿‡ç¨‹ã€‚é¡¹ç›®é‡‡ç”¨ <strong>Vue 3 + TypeScript + Vite</strong> æŠ€æœ¯æ ˆï¼Œå®ç°äº†å®Œæ•´çš„ä¸»å­åº”ç”¨é€šä¿¡ã€è·¯ç”±åŒæ­¥ã€ç‹¬ç«‹è¿è¡Œç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚æ–‡ç« ä¸ä»…åŒ…å«æŠ€æœ¯é€‰å‹åˆ†æã€æ¶æ„è®¾è®¡æ€è·¯ï¼Œè¿˜æä¾›äº†å¤§é‡å¯ç›´æ¥ä½¿ç”¨çš„ä»£ç ç¤ºä¾‹å’Œå®æˆ˜ç»éªŒï¼Œå¸®åŠ©è¯»è€…å¿«é€ŸæŒæ¡å¾®å‰ç«¯å¼€å‘çš„æ ¸å¿ƒæŠ€èƒ½ã€‚</p>
<h3 data-id="heading-1">ğŸ¯ ä½ å°†å­¦åˆ°ä»€ä¹ˆ</h3>
<ul>
<li>âœ… micro-app æ¡†æ¶çš„æ ¸å¿ƒç‰¹æ€§å’Œä½¿ç”¨æŠ€å·§</li>
<li>âœ… å¾®å‰ç«¯æ¶æ„è®¾è®¡æ€è·¯å’Œæœ€ä½³å®è·µ</li>
<li>âœ… ä¸»å­åº”ç”¨åŒå‘é€šä¿¡çš„å®Œæ•´å®ç°æ–¹æ¡ˆ</li>
<li>âœ… è·¯ç”±åŒæ­¥å’Œè·¨åº”ç”¨å¯¼èˆªçš„å®ç°ç»†èŠ‚</li>
<li>âœ… TypeScript ç±»å‹å®‰å…¨çš„å¾®å‰ç«¯å¼€å‘å®è·µ</li>
<li>âœ… äº‹ä»¶æ€»çº¿è§£è€¦å’Œä»£ç ç»„ç»‡æŠ€å·§</li>
<li>âœ… å¼€å‘/ç”Ÿäº§ç¯å¢ƒé…ç½®ç®¡ç†æ–¹æ¡ˆ</li>
<li>âœ… å¸¸è§é—®é¢˜çš„è§£å†³æ–¹æ¡ˆå’Œè¸©å‘ç»éªŒ</li>
</ul>
<h3 data-id="heading-2">ğŸ’ é¡¹ç›®äº®ç‚¹</h3>
<ul>
<li>ğŸš€ <strong>å¼€ç®±å³ç”¨</strong>ï¼šå®Œæ•´çš„é¡¹ç›®æ¨¡æ¿ï¼Œå¯ç›´æ¥ç”¨äºç”Ÿäº§ç¯å¢ƒ</li>
<li>ğŸ”’ <strong>ç±»å‹å®‰å…¨</strong>ï¼šå®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰ï¼Œé›¶ <code>@ts-ignore</code>ï¼Œé›¶ <code>any</code></li>
<li>ğŸ¨ <strong>ä¼ä¸šçº§å®è·µ</strong>ï¼šå¯æ”¯æ’‘çœŸå®ä¼ä¸šé¡¹ç›®</li>
<li>ğŸ“¦ <strong>ç‹¬ç«‹è¿è¡Œ</strong>ï¼šå­åº”ç”¨æ”¯æŒç‹¬ç«‹å¼€å‘å’Œè°ƒè¯•</li>
<li>ğŸ”„ <strong>æ™ºèƒ½é€šä¿¡</strong>ï¼šç­–ç•¥æ¨¡å¼å¤„ç†ä¸åŒç±»å‹äº‹ä»¶ï¼Œä»£ç æ¸…æ™°æ˜“ç»´æŠ¤</li>
<li>ğŸ› ï¸ <strong>ä¸€é”®å¯åŠ¨</strong>ï¼šå¹¶è¡Œå¯åŠ¨æ‰€æœ‰åº”ç”¨ï¼Œæå‡å¼€å‘æ•ˆç‡</li>
</ul>
<h3 data-id="heading-3">ğŸ‰ å¼€æºåœ°å€</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fecho-52hz%2Fmicro-app-front-end" target="_blank" title="https://gitee.com/echo-52hz/micro-app-front-end" ref="nofollow noopener noreferrer">micro-app-front-end</a></p>
<hr/>
<h2 data-id="heading-4">ğŸ“‘ ç›®å½•</h2>
<ul>
<li><a href="#%E4%B8%80%E9%A1%B9%E7%9B%AE%E8%83%8C%E6%99%AF%E4%B8%8E%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90" title="#%E4%B8%80%E9%A1%B9%E7%9B%AE%E8%83%8C%E6%99%AF%E4%B8%8E%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90">ä¸€ã€é¡¹ç›®èƒŒæ™¯ä¸éœ€æ±‚åˆ†æ</a></li>
<li><a href="#%E4%BA%8C%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B%E4%B8%8E%E5%AF%B9%E6%AF%94%E5%88%86%E6%9E%90" title="#%E4%BA%8C%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B%E4%B8%8E%E5%AF%B9%E6%AF%94%E5%88%86%E6%9E%90">äºŒã€æŠ€æœ¯é€‰å‹ä¸å¯¹æ¯”åˆ†æ</a></li>
<li><a href="#%E4%B8%89%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E8%AF%A6%E8%A7%A3" title="#%E4%B8%89%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E8%AF%A6%E8%A7%A3">ä¸‰ã€æ¶æ„è®¾è®¡è¯¦è§£</a></li>
<li><a href="#%E5%9B%9B%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0" title="#%E5%9B%9B%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0">å››ã€æ ¸å¿ƒåŠŸèƒ½å®ç°</a>
<ul>
<li><a href="#41-%E4%B8%BB%E5%BA%94%E7%94%A8%E9%80%9A%E4%BF%A1%E6%A8%A1%E5%9D%97" title="#41-%E4%B8%BB%E5%BA%94%E7%94%A8%E9%80%9A%E4%BF%A1%E6%A8%A1%E5%9D%97">4.1 ä¸»åº”ç”¨é€šä¿¡æ¨¡å—</a></li>
<li><a href="#42-%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BF%E6%A8%A1%E5%9D%97" title="#42-%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BF%E6%A8%A1%E5%9D%97">4.2 äº‹ä»¶æ€»çº¿æ¨¡å—</a></li>
<li><a href="#43-%E5%AD%90%E5%BA%94%E7%94%A8%E9%80%9A%E4%BF%A1%E6%9C%8D%E5%8A%A1" title="#43-%E5%AD%90%E5%BA%94%E7%94%A8%E9%80%9A%E4%BF%A1%E6%9C%8D%E5%8A%A1">4.3 å­åº”ç”¨é€šä¿¡æœåŠ¡</a></li>
</ul>
</li>
<li><a href="#%E4%BA%94%E5%85%B3%E9%94%AE%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82" title="#%E4%BA%94%E5%85%B3%E9%94%AE%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82">äº”ã€å…³é”®å®ç°ç»†èŠ‚</a></li>
<li><a href="#%E5%85%AD%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E4%B8%8E%E4%BC%98%E5%8C%96" title="#%E5%85%AD%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E4%B8%8E%E4%BC%98%E5%8C%96">å…­ã€æœ€ä½³å®è·µä¸ä¼˜åŒ–</a></li>
<li><a href="#%E4%B8%83%E8%B8%A9%E5%9D%91%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93" title="#%E4%B8%83%E8%B8%A9%E5%9D%91%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93">ä¸ƒã€è¸©å‘ç»éªŒæ€»ç»“</a></li>
<li><a href="#%E5%85%AB%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93%E4%B8%8E%E5%B1%95%E6%9C%9B" title="#%E5%85%AB%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93%E4%B8%8E%E5%B1%95%E6%9C%9B">å…«ã€é¡¹ç›®æ€»ç»“ä¸å±•æœ›</a></li>
</ul>
<hr/>
<h2 data-id="heading-5">ä¸€ã€é¡¹ç›®èƒŒæ™¯ä¸éœ€æ±‚åˆ†æ</h2>
<h3 data-id="heading-6">1.1 ä¸ºä»€ä¹ˆé€‰æ‹©å¾®å‰ç«¯ï¼Ÿ</h3>
<p>éšç€å‰ç«¯åº”ç”¨è§„æ¨¡çš„ä¸æ–­å¢é•¿ï¼Œä¼ ç»Ÿçš„å•ä½“åº”ç”¨æ¶æ„é¢ä¸´è¯¸å¤šæŒ‘æˆ˜ï¼š</p>
<ul>
<li><strong>å›¢é˜Ÿåä½œå›°éš¾</strong>ï¼šå¤šä¸ªå›¢é˜Ÿç»´æŠ¤åŒä¸€ä¸ªä»£ç åº“ï¼Œå®¹æ˜“äº§ç”Ÿå†²çª</li>
<li><strong>æŠ€æœ¯æ ˆé™åˆ¶</strong>ï¼šéš¾ä»¥å¼•å…¥æ–°æŠ€æœ¯ï¼Œå‡çº§æˆæœ¬é«˜</li>
<li><strong>éƒ¨ç½²æ•ˆç‡ä½</strong>ï¼šä»»ä½•å°æ”¹åŠ¨éƒ½éœ€è¦æ•´ä½“å‘å¸ƒ</li>
<li><strong>æ€§èƒ½é—®é¢˜</strong>ï¼šåº”ç”¨ä½“ç§¯è¿‡å¤§ï¼Œé¦–å±åŠ è½½æ…¢</li>
</ul>
<p>å¾®å‰ç«¯æ¶æ„é€šè¿‡å°†å¤§å‹åº”ç”¨æ‹†åˆ†ä¸ºå¤šä¸ªç‹¬ç«‹çš„å°åº”ç”¨ï¼Œæ¯ä¸ªåº”ç”¨å¯ä»¥ç‹¬ç«‹å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²ï¼Œæœ‰æ•ˆè§£å†³äº†ä¸Šè¿°é—®é¢˜ã€‚</p>
<h3 data-id="heading-7">1.2 é¡¹ç›®éœ€æ±‚</h3>
<p>åŸºäºä¼ä¸šçº§å¾®å‰ç«¯é¡¹ç›®å®è·µï¼Œæˆ‘ä»¬éœ€è¦æ„å»ºä¸€ä¸ªå¼€ç®±å³ç”¨çš„ micro-app å¾®å‰ç«¯æ¨¡æ¿ï¼Œå…·å¤‡ä»¥ä¸‹æ ¸å¿ƒç‰¹æ€§ï¼š</p>
<ol>
<li><strong>å®Œæ•´çš„é€šä¿¡æœºåˆ¶</strong>ï¼šä¸»å­åº”ç”¨ä¹‹é—´çš„åŒå‘æ•°æ®é€šä¿¡ï¼Œæ”¯æŒå¤šç§äº‹ä»¶ç±»å‹</li>
<li><strong>è·¯ç”±åŒæ­¥</strong>ï¼šè‡ªåŠ¨å¤„ç†è·¯ç”±åŒæ­¥ï¼Œæ”¯æŒæµè§ˆå™¨å‰è¿›åé€€ï¼Œç”¨æˆ·ä½“éªŒæµç•…</li>
<li><strong>ç‹¬ç«‹è¿è¡Œ</strong>ï¼šå­åº”ç”¨æ”¯æŒç‹¬ç«‹å¼€å‘å’Œè°ƒè¯•ï¼Œæå‡å¼€å‘æ•ˆç‡</li>
<li><strong>ç±»å‹å®‰å…¨</strong>ï¼šå®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰ï¼Œé¿å…è¿è¡Œæ—¶é”™è¯¯</li>
<li><strong>ç¯å¢ƒé€‚é…</strong>ï¼šæ”¯æŒå¼€å‘/ç”Ÿäº§ç¯å¢ƒï¼ŒåŒåŸŸ/è·¨åŸŸéƒ¨ç½²</li>
<li><strong>é”™è¯¯å¤„ç†</strong>ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†å’Œé™çº§æ–¹æ¡ˆï¼Œæé«˜ç³»ç»Ÿç¨³å®šæ€§</li>
</ol>
<h3 data-id="heading-8">1.3 é¡¹ç›®ç›®æ ‡</h3>
<ul>
<li>âœ… æä¾›å¯ç›´æ¥ç”¨äºç”Ÿäº§ç¯å¢ƒçš„å®Œæ•´æ¨¡æ¿</li>
<li>âœ… ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•</li>
<li>âœ… å®Œæ•´çš„æ–‡æ¡£å’Œæœ€ä½³å®è·µæŒ‡å—</li>
<li>âœ… è§£å†³å¸¸è§é—®é¢˜ï¼Œé¿å…é‡å¤è¸©å‘</li>
</ul>
<hr/>
<h2 data-id="heading-9">æŠ€æœ¯é€‰å‹</h2>
<h3 data-id="heading-10">å¾®å‰ç«¯æ¡†æ¶: micro-app</h3>
<p><strong>é€‰æ‹©ç†ç”±</strong>:</p>
<ol>
<li><strong>åŸºäº WebComponent</strong>: å¤©ç„¶å®ç°æ ·å¼éš”ç¦»</li>
<li><strong>åŸç”Ÿè·¯ç”±æ¨¡å¼</strong>: å­åº”ç”¨ä½¿ç”¨ <code>createWebHistory</code>ï¼Œæ¡†æ¶è‡ªåŠ¨åŠ«æŒè·¯ç”±</li>
<li><strong>å†…ç½®é€šä¿¡æœºåˆ¶</strong>: æ— éœ€é¢å¤–é…ç½®ï¼Œå¼€ç®±å³ç”¨</li>
<li><strong>è½»é‡çº§</strong>: ç›¸æ¯” qiankun æ›´è½»é‡ï¼Œæ€§èƒ½æ›´å¥½</li>
</ol>
<p><strong>ç‰ˆæœ¬</strong>: <code>@micro-zoe/micro-app@1.0.0-rc.28</code></p>
<h3 data-id="heading-11">å‰ç«¯æ¡†æ¶: Vue 3 + TypeScript</h3>
<p><strong>é€‰æ‹©ç†ç”±</strong>:</p>
<ol>
<li><strong>ç»„åˆå¼ API</strong>: æ›´å¥½çš„é€»è¾‘å¤ç”¨å’Œç±»å‹æ¨å¯¼</li>
<li><strong>TypeScript æ”¯æŒ</strong>: å®Œæ•´çš„ç±»å‹å®‰å…¨</li>
<li><strong>ç”Ÿæ€æˆç†Ÿ</strong>: ä¸°å¯Œçš„æ’ä»¶å’Œå·¥å…·é“¾</li>
</ol>
<h3 data-id="heading-12">æ„å»ºå·¥å…·: Vite</h3>
<p><strong>é€‰æ‹©ç†ç”±</strong>:</p>
<ol>
<li><strong>æé€Ÿå¼€å‘ä½“éªŒ</strong>: HMR é€Ÿåº¦å¿«</li>
<li><strong>åŸç”Ÿ ES æ¨¡å—</strong>: æ›´å¥½çš„å¼€å‘ä½“éªŒ</li>
<li><strong>é…ç½®ç®€å•</strong>: å¼€ç®±å³ç”¨</li>
</ol>
<p><strong>æ³¨æ„</strong>: Vite ä½œä¸ºå­åº”ç”¨æ—¶ï¼Œå¿…é¡»ä½¿ç”¨ iframe æ²™ç®±æ¨¡å¼</p>
<hr/>
<h2 data-id="heading-13">ä¸‰ã€æ¶æ„è®¾è®¡è¯¦è§£</h2>
<h3 data-id="heading-14">3.1 é¡¹ç›®ç»“æ„</h3>
<pre><code class="hljs language-bash" lang="bash">micro-app/
â”œâ”€â”€ main-app/              <span class="hljs-comment"># ä¸»åº”ç”¨ï¼ˆåŸºåº§åº”ç”¨ï¼‰</span>
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/    <span class="hljs-comment"># ç»„ä»¶ç›®å½•</span>
â”‚   â”‚   â”‚   â””â”€â”€ MicroAppContainer.vue  <span class="hljs-comment"># å­åº”ç”¨å®¹å™¨ç»„ä»¶</span>
â”‚   â”‚   â”œâ”€â”€ config/        <span class="hljs-comment"># é…ç½®æ–‡ä»¶</span>
â”‚   â”‚   â”‚   â””â”€â”€ microApps.ts  <span class="hljs-comment"># å­åº”ç”¨é…ç½®ç®¡ç†</span>
â”‚   â”‚   â”œâ”€â”€ router/        <span class="hljs-comment"># è·¯ç”±é…ç½®</span>
â”‚   â”‚   â”œâ”€â”€ types/         <span class="hljs-comment"># TypeScript ç±»å‹å®šä¹‰</span>
â”‚   â”‚   â”‚   â””â”€â”€ micro-app.ts  <span class="hljs-comment"># å¾®å‰ç«¯ç›¸å…³ç±»å‹</span>
â”‚   â”‚   â”œâ”€â”€ utils/         <span class="hljs-comment"># å·¥å…·å‡½æ•°</span>
â”‚   â”‚   â”‚   â”œâ”€â”€ microAppCommunication.ts  <span class="hljs-comment"># é€šä¿¡å·¥å…·</span>
â”‚   â”‚   â”‚   â””â”€â”€ microAppEventBus.ts  <span class="hljs-comment"># äº‹ä»¶æ€»çº¿</span>
â”‚   â”‚   â”œâ”€â”€ views/         <span class="hljs-comment"># é¡µé¢ç»„ä»¶</span>
â”‚   â”‚   â”œâ”€â”€ App.vue        <span class="hljs-comment"># æ ¹ç»„ä»¶</span>
â”‚   â”‚   â””â”€â”€ main.ts        <span class="hljs-comment"># å…¥å£æ–‡ä»¶</span>
â”‚   â”œâ”€â”€ vite.config.ts     <span class="hljs-comment"># Vite é…ç½®</span>
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ sub-app-1/             <span class="hljs-comment"># å­åº”ç”¨ 1</span>
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ plugins/       <span class="hljs-comment"># æ’ä»¶ç›®å½•</span>
â”‚   â”‚   â”‚   â””â”€â”€ micro-app.ts  <span class="hljs-comment"># MicroAppService é€šä¿¡æœåŠ¡</span>
â”‚   â”‚   â”œâ”€â”€ router/        <span class="hljs-comment"># è·¯ç”±é…ç½®</span>
â”‚   â”‚   â”œâ”€â”€ utils/         <span class="hljs-comment"># å·¥å…·å‡½æ•°</span>
â”‚   â”‚   â”‚   â”œâ”€â”€ env.ts     <span class="hljs-comment"># ç¯å¢ƒæ£€æµ‹</span>
â”‚   â”‚   â”‚   â””â”€â”€ navigation.ts  <span class="hljs-comment"># å¯¼èˆªå·¥å…·</span>
â”‚   â”‚   â”œâ”€â”€ types/         <span class="hljs-comment"># ç±»å‹å®šä¹‰</span>
â”‚   â”‚   â”œâ”€â”€ views/         <span class="hljs-comment"># é¡µé¢ç»„ä»¶</span>
â”‚   â”‚   â”œâ”€â”€ App.vue        <span class="hljs-comment"># æ ¹ç»„ä»¶</span>
â”‚   â”‚   â””â”€â”€ main.ts        <span class="hljs-comment"># å…¥å£æ–‡ä»¶ï¼ˆæ”¯æŒç‹¬ç«‹è¿è¡Œï¼‰</span>
â”‚   â”œâ”€â”€ vite.config.ts     <span class="hljs-comment"># Vite é…ç½®</span>
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ sub-app-2/             <span class="hljs-comment"># å­åº”ç”¨ 2ï¼ˆç»“æ„åŒ sub-app-1ï¼‰</span>
â”œâ”€â”€ sub-app-3/             <span class="hljs-comment"># å­åº”ç”¨ 3ï¼ˆç»“æ„åŒ sub-app-1ï¼‰</span>
â”œâ”€â”€ docs/                  <span class="hljs-comment"># æ–‡æ¡£ç›®å½•</span>
â”‚   â”œâ”€â”€ TROUBLESHOOTING.md  <span class="hljs-comment"># è¸©å‘è®°å½•</span>
â”‚   â”œâ”€â”€ IMPLEMENTATION_LOG.md  <span class="hljs-comment"># å®ç°è¿‡ç¨‹è®°å½•</span>
â”‚   â””â”€â”€ FAQ.md             <span class="hljs-comment"># å¸¸è§é—®é¢˜</span>
â”œâ”€â”€ package.json           <span class="hljs-comment"># æ ¹ç›®å½•é…ç½®ï¼ˆä¸€é”®å¯åŠ¨è„šæœ¬ï¼‰</span>
â””â”€â”€ README.md              <span class="hljs-comment"># é¡¹ç›®è¯´æ˜æ–‡æ¡£</span>
</code></pre>
<h3 data-id="heading-15">3.2 æ ¸å¿ƒæ¨¡å—è®¾è®¡</h3>
<h4 data-id="heading-16">3.2.1 ä¸»åº”ç”¨é€šä¿¡æ¨¡å— (<code>microAppCommunication.ts</code>)</h4>
<p><strong>è®¾è®¡æ€è·¯</strong>ï¼š</p>
<p>ä¸»åº”ç”¨é€šä¿¡æ¨¡å—æ˜¯æ•´ä¸ªå¾®å‰ç«¯æ¶æ„çš„æ ¸å¿ƒï¼Œè´Ÿè´£ä¸»å­åº”ç”¨ä¹‹é—´çš„æ•°æ®é€šä¿¡ã€‚æˆ‘ä»¬é‡‡ç”¨<strong>ç­–ç•¥æ¨¡å¼</strong>å¤„ç†ä¸åŒç±»å‹çš„äº‹ä»¶ï¼Œä½¿ä»£ç ç»“æ„æ¸…æ™°ã€æ˜“äºæ‰©å±•ã€‚</p>
<p><strong>æ ¸å¿ƒåŠŸèƒ½</strong>ï¼š</p>
<ol>
<li>
<p><strong>å‘å­åº”ç”¨å‘é€æ•°æ®</strong>ï¼š<code>microAppSetData()</code></p>
<ul>
<li>è‡ªåŠ¨æ·»åŠ æ—¶é—´æˆ³ï¼Œç¡®ä¿æ•°æ®å˜åŒ–è¢«æ£€æµ‹</li>
<li>è‡ªåŠ¨æ·»åŠ æ¥æºæ ‡è¯†ï¼Œä¾¿äºè°ƒè¯•</li>
</ul>
</li>
<li>
<p><strong>è·¨åº”ç”¨è·¯ç”±è·³è½¬</strong>ï¼š<code>microAppTarget()</code></p>
<ul>
<li>æ™ºèƒ½åŒºåˆ†åŒåº”ç”¨å†…è·³è½¬å’Œè·¨åº”ç”¨è·³è½¬</li>
<li>åŒåº”ç”¨å†…ï¼šé€šè¿‡é€šä¿¡è®©å­åº”ç”¨è‡ªå·±è·³è½¬</li>
<li>è·¨åº”ç”¨ï¼šé€šè¿‡ä¸»åº”ç”¨è·¯ç”±è·³è½¬</li>
</ul>
</li>
<li>
<p><strong>ç»Ÿä¸€çš„æ•°æ®ç›‘å¬å¤„ç†å™¨</strong>ï¼š<code>microAppDataListener()</code></p>
<ul>
<li>ä½¿ç”¨ç­–ç•¥æ¨¡å¼å¤„ç†ä¸åŒç±»å‹çš„äº‹ä»¶</li>
<li>æ”¯æŒæ‰©å±•æ–°çš„äº‹ä»¶ç±»å‹</li>
</ul>
</li>
</ol>
<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * å‘æŒ‡å®šå­åº”ç”¨å‘é€æ•°æ®
 * è‡ªåŠ¨æ·»åŠ æ—¶é—´æˆ³ï¼Œç¡®ä¿æ•°æ®å˜åŒ–è¢«æ£€æµ‹åˆ°
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> microAppSetData = (<span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">data</span>: <span class="hljs-title class_">Partial</span>&lt;<span class="hljs-title class_">MicroData</span>&gt;): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> targetName = name || <span class="hljs-title function_">getServiceName</span>();

  <span class="hljs-keyword">if</span> (!targetName) {
    <span class="hljs-title function_">devWarn</span>(<span class="hljs-string">"æ— æ³•å‘é€æ•°æ®ï¼šæœªæŒ‡å®šå­åº”ç”¨åç§°"</span>);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">// è‡ªåŠ¨æ·»åŠ æ—¶é—´æˆ³ï¼Œç¡®ä¿æ•°æ®å˜åŒ–</span>
  <span class="hljs-keyword">const</span> <span class="hljs-attr">dataWithTimestamp</span>: <span class="hljs-title class_">MicroData</span> = {
    ...data,
    <span class="hljs-attr">t</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
    <span class="hljs-attr">source</span>: <span class="hljs-title function_">getServiceName</span>(),
  };

  <span class="hljs-keyword">try</span> {
    microApp.<span class="hljs-title function_">setData</span>(targetName, dataWithTimestamp);
    <span class="hljs-title function_">devLog</span>(<span class="hljs-string">`å‘ <span class="hljs-subst">${targetName}</span> å‘é€æ•°æ®`</span>, dataWithTimestamp);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`[ä¸»åº”ç”¨é€šä¿¡] å‘é€æ•°æ®å¤±è´¥:`</span>, error);
  }
};
</code></pre>
<blockquote>
<p><strong>ğŸ’¡ å®Œæ•´ä»£ç </strong>ï¼šä»£ç ä»“åº“ä¸­åŒ…å«å®Œæ•´çš„é€šä¿¡æ¨¡å—å®ç°ï¼ŒåŒ…å«æ‰€æœ‰äº‹ä»¶ç±»å‹çš„å¤„ç†é€»è¾‘ã€‚</p>
</blockquote>
<h4 data-id="heading-17">3.2.2 äº‹ä»¶æ€»çº¿æ¨¡å— (<code>microAppEventBus.ts</code>)</h4>
<p><strong>è®¾è®¡æ€è·¯</strong>ï¼š</p>
<p>äº‹ä»¶æ€»çº¿æ¨¡å—ç”¨äºè§£è€¦ç”Ÿå‘½å‘¨æœŸé’©å­å’Œä¸šåŠ¡é€»è¾‘ã€‚å½“å­åº”ç”¨ç”Ÿå‘½å‘¨æœŸå‘ç”Ÿå˜åŒ–æ—¶ï¼Œé€šè¿‡äº‹ä»¶æ€»çº¿é€šçŸ¥ä¸šåŠ¡ä»£ç ï¼Œè€Œä¸æ˜¯ç›´æ¥åœ¨ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­å¤„ç†ä¸šåŠ¡é€»è¾‘ã€‚</p>
<p><strong>æ ¸å¿ƒç‰¹æ€§</strong>ï¼š</p>
<ul>
<li>âœ… æ”¯æŒä¸€æ¬¡æ€§ç›‘å¬ (<code>once</code>)</li>
<li>âœ… æ”¯æŒé™é»˜æ¨¡å¼ï¼ˆé¿å…æ— ç›‘å¬å™¨è­¦å‘Šï¼‰</li>
<li>âœ… å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰</li>
<li>âœ… æ”¯æŒç§»é™¤ç›‘å¬å™¨</li>
</ul>
<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * äº‹ä»¶æ€»çº¿ç±»
 * ç”¨äºè§£è€¦ç”Ÿå‘½å‘¨æœŸé’©å­å’Œä¸šåŠ¡é€»è¾‘
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">EventBus</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">listeners</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">EventListener</span>[]&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
  <span class="hljs-keyword">private</span> <span class="hljs-attr">silent</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>; <span class="hljs-comment">// é»˜è®¤é™é»˜æ¨¡å¼</span>

  <span class="hljs-comment">/**
   * ç›‘å¬äº‹ä»¶
   */</span>
  on&lt;T = <span class="hljs-built_in">any</span>&gt;(<span class="hljs-attr">event</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">callback</span>: <span class="hljs-title class_">EventCallback</span>&lt;T&gt;, once = <span class="hljs-literal">false</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">has</span>(event)) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">set</span>(event, []);
    }

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">get</span>(event)!.<span class="hljs-title function_">push</span>({ callback, once });
  }

  <span class="hljs-comment">/**
   * è§¦å‘äº‹ä»¶
   */</span>
  emit&lt;T = <span class="hljs-built_in">any</span>&gt;(<span class="hljs-attr">event</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">data</span>: T): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">const</span> listeners = <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">get</span>(event);

    <span class="hljs-keyword">if</span> (!listeners || listeners.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">silent</span>) {
        <span class="hljs-title function_">devWarn</span>(<span class="hljs-string">`äº‹ä»¶ <span class="hljs-subst">${event}</span> æ²¡æœ‰ç›‘å¬å™¨`</span>);
      }
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// æ‰§è¡Œç›‘å¬å™¨ï¼Œå¹¶ç§»é™¤ä¸€æ¬¡æ€§ç›‘å¬å™¨</span>
    listeners.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">listener, index</span>) =&gt;</span> {
      listener.<span class="hljs-title function_">callback</span>(data);
      <span class="hljs-keyword">if</span> (listener.<span class="hljs-property">once</span>) {
        listeners.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);
      }
    });
  }
}
</code></pre>
<blockquote>
<p><strong>ğŸ’¡ å®Œæ•´å®ç°</strong>ï¼šä»£ç ä»“åº“ä¸­åŒ…å«å®Œæ•´çš„äº‹ä»¶æ€»çº¿å®ç°ï¼ŒåŒ…å«æ‰€æœ‰æ–¹æ³•å’Œç±»å‹å®šä¹‰ã€‚</p>
</blockquote>
<h4 data-id="heading-18">3.2.3 å­åº”ç”¨é€šä¿¡æœåŠ¡ (<code>MicroAppService</code>)</h4>
<p><strong>è®¾è®¡æ€è·¯</strong>ï¼š</p>
<p>å­åº”ç”¨é€šä¿¡æœåŠ¡æ˜¯ä¸€ä¸ªç±»ï¼Œè´Ÿè´£åˆå§‹åŒ–æ•°æ®ç›‘å¬å™¨ã€å¤„ç†ä¸»åº”ç”¨å‘é€çš„æ•°æ®ã€å‘ä¸»åº”ç”¨å‘é€æ•°æ®ä»¥åŠæ¸…ç†èµ„æºã€‚é‡‡ç”¨<strong>ç­–ç•¥æ¨¡å¼</strong>å¤„ç†ä¸åŒç±»å‹çš„äº‹ä»¶ï¼Œä½¿ä»£ç ç»“æ„æ¸…æ™°ã€‚</p>
<p><strong>æ ¸å¿ƒæ–¹æ³•</strong>ï¼š</p>
<ol>
<li><code>init()</code>: åˆå§‹åŒ–æ•°æ®ç›‘å¬å™¨</li>
<li><code>handleData()</code>: å¤„ç†ä¸»åº”ç”¨æ•°æ®ï¼ˆç­–ç•¥æ¨¡å¼ï¼‰</li>
<li><code>sendData()</code>: å‘ä¸»åº”ç”¨å‘é€æ•°æ®</li>
<li><code>destroy()</code>: æ¸…ç†ç›‘å¬å™¨</li>
</ol>
<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * å­åº”ç”¨é€šä¿¡æœåŠ¡ç±»
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MicroAppService</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">serviceName</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataListener</span>: (<span class="hljs-function">(<span class="hljs-params">data: MicroData</span>) =&gt;</span> <span class="hljs-built_in">void</span>) | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">serviceName</span> = <span class="hljs-title function_">getServiceName</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>();
  }

  <span class="hljs-comment">/**
   * åˆå§‹åŒ–æ•°æ®ç›‘å¬å™¨
   */</span>
  <span class="hljs-keyword">public</span> <span class="hljs-title function_">init</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isMicroAppEnvironment</span>()) {
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">const</span> microApp = (<span class="hljs-variable language_">window</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-property">microApp</span>;
    <span class="hljs-keyword">if</span> (!microApp) {
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// åˆ›å»ºæ•°æ®ç›‘å¬å™¨</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataListener</span> = <span class="hljs-function">(<span class="hljs-params">data: MicroData</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleData</span>(data);
    };

    <span class="hljs-comment">// æ·»åŠ æ•°æ®ç›‘å¬å™¨</span>
    microApp.<span class="hljs-title function_">addDataListener</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataListener</span>);
  }

  <span class="hljs-comment">/**
   * å¤„ç†ä¸»åº”ç”¨å‘é€çš„æ•°æ®ï¼ˆç­–ç•¥æ¨¡å¼ï¼‰
   */</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">handleData</span>(<span class="hljs-attr">data</span>: <span class="hljs-title class_">MicroData</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">switch</span> (data.<span class="hljs-property">type</span>) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">"target"</span>:
        <span class="hljs-comment">// å¤„ç†è·¯ç”±è·³è½¬</span>
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">"menuCollapse"</span>:
        <span class="hljs-comment">// å¤„ç†èœå•æŠ˜å </span>
        <span class="hljs-keyword">break</span>;
      <span class="hljs-comment">// ... å…¶ä»–äº‹ä»¶ç±»å‹</span>
    }
  }
}
</code></pre>
<blockquote>
<p><strong>ğŸ’¡ å®Œæ•´å®ç°</strong>ï¼šä»£ç ä»“åº“ä¸­åŒ…å«å®Œæ•´çš„ MicroAppService å®ç°ï¼ŒåŒ…å«æ‰€æœ‰äº‹ä»¶ç±»å‹çš„å¤„ç†é€»è¾‘ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-19">å››ã€æ ¸å¿ƒåŠŸèƒ½å®ç°</h2>
<h3 data-id="heading-20">4.1 ä¸»åº”ç”¨é€šä¿¡æ¨¡å—</h3>
<h4 data-id="heading-21">4.1.1 æ•°æ®å‘é€åŠŸèƒ½</h4>
<p>ä¸»åº”ç”¨å‘å­åº”ç”¨å‘é€æ•°æ®æ—¶ï¼Œéœ€è¦è‡ªåŠ¨æ·»åŠ æ—¶é—´æˆ³ï¼Œç¡®ä¿ micro-app èƒ½æ£€æµ‹åˆ°æ•°æ®å˜åŒ–ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * å‘æŒ‡å®šå­åº”ç”¨å‘é€æ•°æ®
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> microAppSetData = (<span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">data</span>: <span class="hljs-title class_">Partial</span>&lt;<span class="hljs-title class_">MicroData</span>&gt;): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> <span class="hljs-attr">dataWithTimestamp</span>: <span class="hljs-title class_">MicroData</span> = {
    ...data,
    <span class="hljs-attr">t</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),  <span class="hljs-comment">// è‡ªåŠ¨æ·»åŠ æ—¶é—´æˆ³</span>
    <span class="hljs-attr">source</span>: <span class="hljs-title function_">getServiceName</span>(),  <span class="hljs-comment">// è‡ªåŠ¨æ·»åŠ æ¥æº</span>
  };

  <span class="hljs-keyword">try</span> {
    microApp.<span class="hljs-title function_">setData</span>(name, dataWithTimestamp);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`[ä¸»åº”ç”¨é€šä¿¡] å‘é€æ•°æ®å¤±è´¥:`</span>, error);
  }
};
</code></pre>
<h4 data-id="heading-22">4.1.2 è·¨åº”ç”¨è·¯ç”±è·³è½¬</h4>
<p>æ™ºèƒ½åŒºåˆ†åŒåº”ç”¨å†…è·³è½¬å’Œè·¨åº”ç”¨è·³è½¬ï¼Œæä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * è·¨åº”ç”¨è·¯ç”±è·³è½¬
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> microAppTarget = (
  <span class="hljs-attr">service</span>: <span class="hljs-built_in">string</span>,
  <span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span>
): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> currentService = <span class="hljs-title function_">getServiceName</span>();

  <span class="hljs-comment">// åŒåº”ç”¨å†…ï¼šé€šè¿‡é€šä¿¡è®©å­åº”ç”¨è‡ªå·±è·³è½¬</span>
  <span class="hljs-keyword">if</span> (currentService === service) {
    <span class="hljs-title function_">microAppSetData</span>(service, { <span class="hljs-attr">type</span>: <span class="hljs-string">"target"</span>, <span class="hljs-attr">path</span>: url });
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">// è·¨åº”ç”¨ï¼šé€šè¿‡ä¸»åº”ç”¨è·¯ç”±è·³è½¬</span>
  <span class="hljs-keyword">const</span> routeMapping = routeMappings.<span class="hljs-title function_">find</span>(<span class="hljs-function">(<span class="hljs-params">m</span>) =&gt;</span> m.<span class="hljs-property">appName</span> === service);
  <span class="hljs-keyword">if</span> (routeMapping) {
    <span class="hljs-keyword">const</span> fullPath = <span class="hljs-string">`<span class="hljs-subst">${routeMapping.basePath}</span><span class="hljs-subst">${url}</span>`</span>;
    router.<span class="hljs-title function_">push</span>(fullPath).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`[ä¸»åº”ç”¨é€šä¿¡] è·¯ç”±è·³è½¬å¤±è´¥:`</span>, error);
    });
  }
};
</code></pre>
<h4 data-id="heading-23">4.1.3 ç»Ÿä¸€çš„æ•°æ®ç›‘å¬å¤„ç†å™¨</h4>
<p>ä½¿ç”¨ç­–ç•¥æ¨¡å¼å¤„ç†ä¸åŒç±»å‹çš„äº‹ä»¶ï¼Œä»£ç ç»“æ„æ¸…æ™°ã€æ˜“äºæ‰©å±•ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * ç»Ÿä¸€çš„æ•°æ®ç›‘å¬å¤„ç†å™¨ï¼ˆç­–ç•¥æ¨¡å¼ï¼‰
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> microAppDataListener = (<span class="hljs-attr">params</span>: <span class="hljs-title class_">DataListenerParams</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> { service, data } = params;

  <span class="hljs-keyword">if</span> (!data || !data.<span class="hljs-property">type</span>) {
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">// ä½¿ç”¨ç­–ç•¥æ¨¡å¼å¤„ç†ä¸åŒç±»å‹çš„äº‹ä»¶</span>
  <span class="hljs-keyword">const</span> <span class="hljs-attr">eventHandlers</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-title class_">MicroAppEventType</span>, <span class="hljs-function">(<span class="hljs-params">data: MicroData</span>) =&gt;</span> <span class="hljs-built_in">void</span>&gt; = {
    <span class="hljs-attr">target</span>: <span class="hljs-function">(<span class="hljs-params">eventData</span>) =&gt;</span> {
      <span class="hljs-comment">// å¤„ç†è·¯ç”±è·³è½¬</span>
      <span class="hljs-keyword">const</span> targetService = eventData.<span class="hljs-property">service</span> || eventData.<span class="hljs-property">data</span>?.<span class="hljs-property">service</span>;
      <span class="hljs-keyword">const</span> targetUrl = eventData.<span class="hljs-property">url</span> || eventData.<span class="hljs-property">path</span> || <span class="hljs-string">""</span>;
      <span class="hljs-keyword">if</span> (targetService &amp;&amp; targetUrl) {
        <span class="hljs-title function_">microAppTarget</span>(targetService, targetUrl);
      }
    },
    <span class="hljs-attr">navigate</span>: <span class="hljs-function">(<span class="hljs-params">eventData</span>) =&gt;</span> {
      <span class="hljs-comment">// å¤„ç†è·¨åº”ç”¨å¯¼èˆª</span>
      <span class="hljs-comment">// ...</span>
    },
    <span class="hljs-attr">logout</span>: <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// å¤„ç†é€€å‡ºç™»å½•</span>
      <span class="hljs-comment">// ...</span>
    },
    <span class="hljs-comment">// ... å…¶ä»–äº‹ä»¶ç±»å‹</span>
  };

  <span class="hljs-keyword">const</span> handler = eventHandlers[data.<span class="hljs-property">type</span>];
  <span class="hljs-keyword">if</span> (handler) {
    <span class="hljs-title function_">handler</span>(data);
  }
};
</code></pre>
<h3 data-id="heading-24">4.2 äº‹ä»¶æ€»çº¿æ¨¡å—</h3>
<p>äº‹ä»¶æ€»çº¿ç”¨äºè§£è€¦ç”Ÿå‘½å‘¨æœŸé’©å­å’Œä¸šåŠ¡é€»è¾‘ï¼Œä½¿ä»£ç æ›´æ˜“ç»´æŠ¤ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * ç›‘å¬ç”Ÿå‘½å‘¨æœŸäº‹ä»¶
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> onLifecycle = (
  <span class="hljs-attr">event</span>: <span class="hljs-title class_">LifecycleEventType</span>,
  <span class="hljs-attr">callback</span>: <span class="hljs-function">(<span class="hljs-params">data: LifecycleEventData</span>) =&gt;</span> <span class="hljs-built_in">void</span>,
  once = <span class="hljs-literal">false</span>
): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
  eventBus.<span class="hljs-title function_">on</span>(event, callback, once);
};

<span class="hljs-comment">/**
 * è§¦å‘ç”Ÿå‘½å‘¨æœŸäº‹ä»¶
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> emitLifecycle = (
  <span class="hljs-attr">event</span>: <span class="hljs-title class_">LifecycleEventType</span>,
  <span class="hljs-attr">data</span>: <span class="hljs-title class_">LifecycleEventData</span>
): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
  eventBus.<span class="hljs-title function_">emit</span>(event, data);
};
</code></pre>
<h3 data-id="heading-25">4.3 å­åº”ç”¨é€šä¿¡æœåŠ¡</h3>
<p>å­åº”ç”¨é€šè¿‡ <code>MicroAppService</code> ç±»ç®¡ç†é€šä¿¡é€»è¾‘ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * å­åº”ç”¨é€šä¿¡æœåŠ¡ç±»
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MicroAppService</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">serviceName</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataListener</span>: (<span class="hljs-function">(<span class="hljs-params">data: MicroData</span>) =&gt;</span> <span class="hljs-built_in">void</span>) | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">serviceName</span> = <span class="hljs-title function_">getServiceName</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>();
  }

  <span class="hljs-comment">/**
   * å¤„ç†ä¸»åº”ç”¨å‘é€çš„æ•°æ®ï¼ˆç­–ç•¥æ¨¡å¼ï¼‰
   */</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">handleData</span>(<span class="hljs-attr">data</span>: <span class="hljs-title class_">MicroData</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">switch</span> (data.<span class="hljs-property">type</span>) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">"target"</span>: {
        <span class="hljs-comment">// è·¯ç”±è·³è½¬</span>
        <span class="hljs-keyword">const</span> path = data.<span class="hljs-property">path</span> || data.<span class="hljs-property">data</span>?.<span class="hljs-property">path</span> || <span class="hljs-string">""</span>;
        <span class="hljs-keyword">if</span> (path &amp;&amp; path !== router.<span class="hljs-property">currentRoute</span>.<span class="hljs-property">value</span>.<span class="hljs-property">path</span>) {
          router.<span class="hljs-title function_">push</span>(path);
        }
        <span class="hljs-keyword">break</span>;
      }
      <span class="hljs-keyword">case</span> <span class="hljs-string">"menuCollapse"</span>: {
        <span class="hljs-comment">// èœå•æŠ˜å </span>
        <span class="hljs-keyword">const</span> collapse = data.<span class="hljs-property">data</span>?.<span class="hljs-property">collapse</span> ?? <span class="hljs-literal">false</span>;
        <span class="hljs-comment">// å¤„ç†èœå•æŠ˜å é€»è¾‘</span>
        <span class="hljs-keyword">break</span>;
      }
      <span class="hljs-comment">// ... å…¶ä»–äº‹ä»¶ç±»å‹</span>
    }
  }

  <span class="hljs-comment">/**
   * å‘ä¸»åº”ç”¨å‘é€æ•°æ®
   */</span>
  <span class="hljs-keyword">public</span> <span class="hljs-title function_">sendData</span>(<span class="hljs-attr">data</span>: <span class="hljs-title class_">Partial</span>&lt;<span class="hljs-title class_">MicroData</span>&gt;): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isMicroAppEnvironment</span>()) {
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">const</span> microApp = (<span class="hljs-variable language_">window</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-property">microApp</span>;
    <span class="hljs-keyword">if</span> (!microApp || <span class="hljs-keyword">typeof</span> microApp.<span class="hljs-property">dispatch</span> !== <span class="hljs-string">"function"</span>) {
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">const</span> <span class="hljs-attr">dataWithTimestamp</span>: <span class="hljs-title class_">MicroData</span> = {
      ...data,
      <span class="hljs-attr">t</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
      <span class="hljs-attr">source</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">serviceName</span>,
    };

    microApp.<span class="hljs-title function_">dispatch</span>(dataWithTimestamp);
  }

  <span class="hljs-comment">/**
   * æ¸…ç†ç›‘å¬å™¨
   */</span>
  <span class="hljs-keyword">public</span> <span class="hljs-title function_">destroy</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataListener</span>) {
      <span class="hljs-keyword">const</span> microApp = (<span class="hljs-variable language_">window</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-property">microApp</span>;
      <span class="hljs-keyword">if</span> (microApp &amp;&amp; <span class="hljs-keyword">typeof</span> microApp.<span class="hljs-property">removeDataListener</span> === <span class="hljs-string">"function"</span>) {
        microApp.<span class="hljs-title function_">removeDataListener</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataListener</span>);
      }
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataListener</span> = <span class="hljs-literal">null</span>;
    }
  }
}
</code></pre>
<blockquote>
<p><strong>ğŸ’¡ å®Œæ•´ä»£ç </strong>ï¼šä»£ç ä»“åº“ä¸­åŒ…å«æ‰€æœ‰æ ¸å¿ƒæ¨¡å—çš„å®Œæ•´å®ç°ï¼ŒåŒ…å«è¯¦ç»†çš„æ³¨é‡Šå’Œç±»å‹å®šä¹‰ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-26">äº”ã€å…³é”®å®ç°ç»†èŠ‚</h2>
<h3 data-id="heading-27">5.1 ç±»å‹å®‰å…¨ä¼˜å…ˆ</h3>
<h4 data-id="heading-28">å†³ç­–èƒŒæ™¯</h4>
<p>åœ¨å¾®å‰ç«¯é¡¹ç›®ä¸­ï¼Œç±»å‹å®‰å…¨å°¤ä¸ºé‡è¦ã€‚ä¸»å­åº”ç”¨ä¹‹é—´çš„é€šä¿¡å¦‚æœæ²¡æœ‰ç±»å‹çº¦æŸï¼Œå¾ˆå®¹æ˜“å‡ºç°è¿è¡Œæ—¶é”™è¯¯ã€‚</p>
<h4 data-id="heading-29">å®ç°æ–¹æ¡ˆ</h4>
<p><strong>1. å…¨å±€ç±»å‹å£°æ˜</strong></p>
<p>ä¸º <code>window.microApp</code> æ·»åŠ å…¨å±€ç±»å‹å£°æ˜ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// types/micro-app.d.ts</span>
<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">global</span> {
  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Window</span> {
    microApp?: {
      <span class="hljs-attr">setData</span>: <span class="hljs-function">(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, data: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
      <span class="hljs-attr">getData</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">any</span>;
      <span class="hljs-attr">addDataListener</span>: <span class="hljs-function">(<span class="hljs-params">listener: (data: <span class="hljs-built_in">any</span>) =&gt; <span class="hljs-built_in">void</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
      <span class="hljs-attr">removeDataListener</span>: <span class="hljs-function">(<span class="hljs-params">listener: (data: <span class="hljs-built_in">any</span>) =&gt; <span class="hljs-built_in">void</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
      <span class="hljs-attr">dispatch</span>: <span class="hljs-function">(<span class="hljs-params">data: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
    };
    __MICRO_APP_ENVIRONMENT__?: <span class="hljs-built_in">boolean</span>;
    __MICRO_APP_BASE_ROUTE__?: <span class="hljs-built_in">string</span>;
    __MICRO_APP_NAME__?: <span class="hljs-built_in">string</span>;
  }
}
</code></pre>
<p><strong>2. å®Œæ•´çš„ç±»å‹å®šä¹‰</strong></p>
<p>å®šä¹‰æ‰€æœ‰é€šä¿¡æ•°æ®çš„ç±»å‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * å¾®å‰ç«¯é€šä¿¡æ•°æ®ç±»å‹
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MicroData</span> {
  <span class="hljs-comment">/** äº‹ä»¶ç±»å‹ï¼ˆå¿…å¡«ï¼‰ */</span>
  <span class="hljs-attr">type</span>: <span class="hljs-title class_">MicroAppEventType</span>;
  <span class="hljs-comment">/** äº‹ä»¶æ•°æ® */</span>
  data?: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;;
  <span class="hljs-comment">/** æ—¶é—´æˆ³ï¼ˆç¡®ä¿æ•°æ®å˜åŒ–ï¼‰ */</span>
  t?: <span class="hljs-built_in">number</span>;
  <span class="hljs-comment">/** æ¥æºåº”ç”¨ */</span>
  source?: <span class="hljs-built_in">string</span>;
  <span class="hljs-comment">/** è·¯å¾„ï¼ˆç”¨äºè·¯ç”±è·³è½¬ï¼‰ */</span>
  path?: <span class="hljs-built_in">string</span>;
  <span class="hljs-comment">/** ç›®æ ‡æœåŠ¡ï¼ˆç”¨äºè·¨åº”ç”¨è·³è½¬ï¼‰ */</span>
  service?: <span class="hljs-built_in">string</span>;
  <span class="hljs-comment">/** ç›®æ ‡URLï¼ˆç”¨äºè·¨åº”ç”¨è·³è½¬ï¼‰ */</span>
  url?: <span class="hljs-built_in">string</span>;
}
</code></pre>
<p><strong>3. ç±»å‹å®ˆå«</strong></p>
<p>ä½¿ç”¨ç±»å‹å®ˆå«ç¡®ä¿ç±»å‹å®‰å…¨ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">isMicroAppEnvironment</span>(<span class="hljs-params"/>): <span class="hljs-built_in">boolean</span> {
  <span class="hljs-keyword">return</span> !!<span class="hljs-variable language_">window</span>.<span class="hljs-property">__MICRO_APP_ENVIRONMENT__</span>;
}
</code></pre>
<h4 data-id="heading-30">æ”¶ç›Š</h4>
<ul>
<li>âœ… æ›´å¥½çš„ IDE æç¤ºå’Œè‡ªåŠ¨è¡¥å…¨</li>
<li>âœ… ç¼–è¯‘æ—¶é”™è¯¯æ£€æŸ¥ï¼Œé¿å…è¿è¡Œæ—¶é”™è¯¯</li>
<li>âœ… ä»£ç å¯ç»´æŠ¤æ€§æ˜¾è‘—æå‡</li>
<li>âœ… é‡æ„æ›´å®‰å…¨ï¼Œç±»å‹ç³»ç»Ÿä¼šæç¤ºæ‰€æœ‰éœ€è¦ä¿®æ”¹çš„åœ°æ–¹</li>
</ul>
<h3 data-id="heading-31">5.2 äº‹ä»¶æ€»çº¿è§£è€¦</h3>
<h4 data-id="heading-32">å†³ç­–èƒŒæ™¯</h4>
<p>åœ¨å¾®å‰ç«¯é¡¹ç›®ä¸­ï¼Œå­åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸé’©å­éœ€è¦è§¦å‘å„ç§ä¸šåŠ¡é€»è¾‘ã€‚å¦‚æœç›´æ¥åœ¨ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œä¼šå¯¼è‡´ä»£ç è€¦åˆåº¦é«˜ï¼Œéš¾ä»¥ç»´æŠ¤ã€‚</p>
<h4 data-id="heading-33">å®ç°æ–¹æ¡ˆ</h4>
<p><strong>1. äº‹ä»¶æ€»çº¿è®¾è®¡</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">EventBus</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">listeners</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">EventListener</span>[]&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
  <span class="hljs-keyword">private</span> <span class="hljs-attr">silent</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>;

  on&lt;T = <span class="hljs-built_in">any</span>&gt;(<span class="hljs-attr">event</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">callback</span>: <span class="hljs-title class_">EventCallback</span>&lt;T&gt;, once = <span class="hljs-literal">false</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-comment">// æ·»åŠ ç›‘å¬å™¨</span>
  }

  emit&lt;T = <span class="hljs-built_in">any</span>&gt;(<span class="hljs-attr">event</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">data</span>: T): <span class="hljs-built_in">void</span> {
    <span class="hljs-comment">// è§¦å‘äº‹ä»¶</span>
  }

  <span class="hljs-title function_">off</span>(<span class="hljs-attr">event</span>: <span class="hljs-built_in">string</span>, callback?: <span class="hljs-title class_">EventCallback</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-comment">// ç§»é™¤ç›‘å¬å™¨</span>
  }
}
</code></pre>
<p><strong>2. ç”Ÿå‘½å‘¨æœŸé’©å­è§¦å‘äº‹ä»¶</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­è§¦å‘äº‹ä»¶</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">onMounted</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">emitLifecycle</span>(<span class="hljs-string">"mounted"</span>, { <span class="hljs-attr">name</span>: props.<span class="hljs-property">name</span> });
};
</code></pre>
<p><strong>3. ä¸šåŠ¡ä»£ç ç›‘å¬äº‹ä»¶</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ä¸šåŠ¡ä»£ç ä¸­ç›‘å¬äº‹ä»¶</span>
<span class="hljs-title function_">onLifecycle</span>(<span class="hljs-string">"mounted"</span>, <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
  <span class="hljs-comment">// å¤„ç†ä¸šåŠ¡é€»è¾‘</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`å­åº”ç”¨ <span class="hljs-subst">${data.name}</span> å·²æŒ‚è½½`</span>);
});
</code></pre>
<h4 data-id="heading-34">æ”¶ç›Š</h4>
<ul>
<li>âœ… ä»£ç è§£è€¦ï¼Œç”Ÿå‘½å‘¨æœŸé’©å­å’Œä¸šåŠ¡é€»è¾‘åˆ†ç¦»</li>
<li>âœ… ä¸šåŠ¡é€»è¾‘å¯ä»¥ç‹¬ç«‹æµ‹è¯•</li>
<li>âœ… æ”¯æŒå¤šä¸ªç›‘å¬å™¨ï¼Œæ‰©å±•æ€§å¼º</li>
<li>âœ… ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤</li>
</ul>
<h3 data-id="heading-35">5.3 æ—¥å¿—ç³»ç»Ÿä¼˜åŒ–</h3>
<h4 data-id="heading-36">å†³ç­–èƒŒæ™¯</h4>
<p>åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œè¯¦ç»†çš„æ—¥å¿—æœ‰åŠ©äºè°ƒè¯•ã€‚ä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿‡å¤šçš„æ—¥å¿—ä¼šå½±å“æ€§èƒ½ï¼Œè¿˜å¯èƒ½æ³„éœ²æ•æ„Ÿä¿¡æ¯ã€‚</p>
<h4 data-id="heading-37">å®ç°æ–¹æ¡ˆ</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> isDev = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">DEV</span>;

<span class="hljs-comment">/**
 * å¼€å‘ç¯å¢ƒæ—¥å¿—è¾“å‡º
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">devLog</span> = (<span class="hljs-params">message: <span class="hljs-built_in">string</span>, ...args: <span class="hljs-built_in">any</span>[]</span>) =&gt; {
  <span class="hljs-keyword">if</span> (isDev) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`%c[æ ‡ç­¾] <span class="hljs-subst">${message}</span>`</span>, <span class="hljs-string">"color: #1890ff"</span>, ...args);
  }
};

<span class="hljs-comment">/**
 * å¼€å‘ç¯å¢ƒè­¦å‘Šè¾“å‡º
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">devWarn</span> = (<span class="hljs-params">message: <span class="hljs-built_in">string</span>, ...args: <span class="hljs-built_in">any</span>[]</span>) =&gt; {
  <span class="hljs-keyword">if</span> (isDev) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">`%c[æ ‡ç­¾] <span class="hljs-subst">${message}</span>`</span>, <span class="hljs-string">"color: #faad14"</span>, ...args);
  }
};

<span class="hljs-comment">/**
 * é”™è¯¯æ—¥å¿—ï¼ˆå§‹ç»ˆè¾“å‡ºï¼‰
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">errorLog</span> = (<span class="hljs-params">message: <span class="hljs-built_in">string</span>, ...args: <span class="hljs-built_in">any</span>[]</span>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`[æ ‡ç­¾] <span class="hljs-subst">${message}</span>`</span>, ...args);
};
</code></pre>
<h4 data-id="heading-38">æ”¶ç›Š</h4>
<ul>
<li>âœ… ç”Ÿäº§ç¯å¢ƒæ€§èƒ½æ›´å¥½ï¼Œæ— æ—¥å¿—å¼€é”€</li>
<li>âœ… å¼€å‘ç¯å¢ƒè°ƒè¯•æ›´æ–¹ä¾¿ï¼Œå½©è‰²æ—¥å¿—æ˜“äºè¯†åˆ«</li>
<li>âœ… é¿å…æ•æ„Ÿä¿¡æ¯æ³„éœ²</li>
<li>âœ… é”™è¯¯æ—¥å¿—å§‹ç»ˆè¾“å‡ºï¼Œä¾¿äºé—®é¢˜æ’æŸ¥</li>
</ul>
<h3 data-id="heading-39">5.4 Vite å­åº”ç”¨ iframe æ²™ç®±</h3>
<h4 data-id="heading-40">å†³ç­–èƒŒæ™¯</h4>
<p>æ ¹æ® micro-app å®˜æ–¹æ–‡æ¡£ï¼Œ<strong>Vite ä½œä¸ºå­åº”ç”¨æ—¶ï¼Œå¿…é¡»ä½¿ç”¨ iframe æ²™ç®±æ¨¡å¼</strong>ï¼Œå¦åˆ™ä¼šå‡ºç°è„šæœ¬æ‰§è¡Œé”™è¯¯ã€‚</p>
<h4 data-id="heading-41">å®ç°æ–¹æ¡ˆ</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;micro-app
  :name="name"
  :url="url"
  router-mode="native"
  iframe  &lt;!-- å¿…é¡»æ·»åŠ æ­¤å±æ€§ --&gt;
/&gt;
</code></pre>
<h4 data-id="heading-42">æ”¶ç›Š</h4>
<ul>
<li>âœ… è§£å†³ Vite å¼€å‘è„šæœ¬æ‰§è¡Œé”™è¯¯</li>
<li>âœ… æ›´å¥½çš„éš”ç¦»æ€§ï¼Œæ ·å¼å’Œè„šæœ¬å®Œå…¨éš”ç¦»</li>
<li>âœ… ç¬¦åˆå®˜æ–¹æœ€ä½³å®è·µ</li>
</ul>
<hr/>
<h2 data-id="heading-43">å…­ã€æœ€ä½³å®è·µä¸ä¼˜åŒ–</h2>
<h3 data-id="heading-44">6.1 ç»Ÿä¸€é…ç½®ç®¡ç†</h3>
<p>ä½¿ç”¨é…ç½®æ–‡ä»¶ç»Ÿä¸€ç®¡ç†æ‰€æœ‰å­åº”ç”¨åœ°å€ï¼Œæ”¯æŒç¯å¢ƒæ„ŸçŸ¥ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// config/microApps.ts</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">envConfigs</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">EnvConfig</span>&gt; = {
  <span class="hljs-string">"sub-app-1"</span>: {
    <span class="hljs-attr">dev</span>: <span class="hljs-string">"http://localhost:3000"</span>,
    <span class="hljs-attr">prod</span>: <span class="hljs-string">"//your-domain.com/sub-app-1"</span>,
    <span class="hljs-attr">envKey</span>: <span class="hljs-string">"VITE_SUB_APP_1_ENTRY"</span>,
  },
  <span class="hljs-comment">// ...</span>
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getEntry</span>(<span class="hljs-params">appName: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span> {
  <span class="hljs-keyword">const</span> config = envConfigs[appName];

  <span class="hljs-comment">// ä¼˜å…ˆçº§ 1: ç¯å¢ƒå˜é‡è¦†ç›–</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>[config.<span class="hljs-property">envKey</span>]) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>[config.<span class="hljs-property">envKey</span>];
  }

  <span class="hljs-comment">// ä¼˜å…ˆçº§ 2: æ ¹æ®ç¯å¢ƒé€‰æ‹©é…ç½®</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">DEV</span>) {
    <span class="hljs-keyword">return</span> config.<span class="hljs-property">dev</span>;
  }

  <span class="hljs-comment">// ç”Ÿäº§ç¯å¢ƒæ ¹æ®éƒ¨ç½²æ¨¡å¼é€‰æ‹©</span>
  <span class="hljs-keyword">const</span> deployMode = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">VITE_DEPLOY_MODE</span> || <span class="hljs-string">"same-origin"</span>;
  <span class="hljs-keyword">return</span> deployMode === <span class="hljs-string">"same-origin"</span>
    ? <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">window</span>.location.origin}</span>/<span class="hljs-subst">${appName}</span>`</span>
    : config.<span class="hljs-property">prod</span>;
}
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>âœ… é…ç½®é›†ä¸­ç®¡ç†ï¼Œæ˜“äºç»´æŠ¤</li>
<li>âœ… è‡ªåŠ¨é€‚é…å¼€å‘/ç”Ÿäº§ç¯å¢ƒ</li>
<li>âœ… æ”¯æŒç¯å¢ƒå˜é‡è¦†ç›–</li>
<li>âœ… æ”¯æŒåŒåŸŸ/è·¨åŸŸéƒ¨ç½²</li>
</ul>
<h3 data-id="heading-45">6.2 è‡ªåŠ¨æ·»åŠ æ—¶é—´æˆ³</h3>
<p>å‘é€æ•°æ®æ—¶è‡ªåŠ¨æ·»åŠ æ—¶é—´æˆ³ï¼Œç¡®ä¿ micro-app èƒ½æ£€æµ‹åˆ°æ•°æ®å˜åŒ–ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-attr">dataWithTimestamp</span>: <span class="hljs-title class_">MicroData</span> = {
  ...data,
  <span class="hljs-attr">t</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),  <span class="hljs-comment">// è‡ªåŠ¨æ·»åŠ æ—¶é—´æˆ³</span>
  <span class="hljs-attr">source</span>: <span class="hljs-title function_">getServiceName</span>(),  <span class="hljs-comment">// è‡ªåŠ¨æ·»åŠ æ¥æº</span>
};
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>âœ… ç¡®ä¿ micro-app èƒ½æ£€æµ‹åˆ°æ•°æ®å˜åŒ–</li>
<li>âœ… é¿å…æ•°æ®æœªæ›´æ–°çš„é—®é¢˜</li>
<li>âœ… ä¾¿äºè°ƒè¯•ï¼Œå¯ä»¥çœ‹åˆ°æ•°æ®æ¥æº</li>
</ul>
<h3 data-id="heading-46">6.3 æ™ºèƒ½è·¯ç”±è·³è½¬</h3>
<p>åŒºåˆ†åŒåº”ç”¨å†…è·³è½¬å’Œè·¨åº”ç”¨è·³è½¬ï¼Œæä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// åŒåº”ç”¨å†…ï¼šé€šè¿‡é€šä¿¡è®©å­åº”ç”¨è‡ªå·±è·³è½¬</span>
<span class="hljs-comment">// è·¨åº”ç”¨ï¼šé€šè¿‡ä¸»åº”ç”¨è·¯ç”±è·³è½¬</span>
<span class="hljs-keyword">if</span> (currentService === service) {
  <span class="hljs-title function_">microAppSetData</span>(service, { <span class="hljs-attr">type</span>: <span class="hljs-string">"target"</span>, <span class="hljs-attr">path</span>: url });
} <span class="hljs-keyword">else</span> {
  router.<span class="hljs-title function_">push</span>(fullPath);
}
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>âœ… é¿å…è·¯ç”±è®°å½•æ··ä¹±</li>
<li>âœ… æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ</li>
<li>âœ… æ”¯æŒæµè§ˆå™¨å‰è¿›åé€€</li>
</ul>
<h3 data-id="heading-47">6.4 å®Œå–„çš„é”™è¯¯å¤„ç†</h3>
<p>æ‰€æœ‰å…³é”®æ“ä½œéƒ½ä½¿ç”¨ try-catchï¼Œæä¾›é™çº§æ–¹æ¡ˆï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">try</span> {
  microApp.<span class="hljs-title function_">setData</span>(targetName, dataWithTimestamp);
} <span class="hljs-keyword">catch</span> (error) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`[ä¸»åº”ç”¨é€šä¿¡] å‘é€æ•°æ®å¤±è´¥:`</span>, error);
  <span class="hljs-comment">// é™çº§å¤„ç†</span>
}
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>âœ… æé«˜ç³»ç»Ÿç¨³å®šæ€§</li>
<li>âœ… æ›´å¥½çš„é”™è¯¯æç¤º</li>
<li>âœ… ä¾¿äºé—®é¢˜æ’æŸ¥</li>
</ul>
<h3 data-id="heading-48">6.5 å­åº”ç”¨ç‹¬ç«‹è¿è¡Œ</h3>
<p>å­åº”ç”¨æ”¯æŒç‹¬ç«‹è¿è¡Œï¼Œä¾¿äºå¼€å‘è°ƒè¯•ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// main.ts</span>
<span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isMicroAppEnvironment</span>()) {
  <span class="hljs-comment">// ç‹¬ç«‹è¿è¡Œæ—¶ç›´æ¥æŒ‚è½½</span>
  <span class="hljs-title function_">render</span>();
} <span class="hljs-keyword">else</span> {
  <span class="hljs-comment">// å¾®å‰ç«¯ç¯å¢ƒå¯¼å‡ºç”Ÿå‘½å‘¨æœŸå‡½æ•°</span>
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">mount</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">render</span>();
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">unmount</span> = <span class="hljs-function">() =&gt;</span> app.<span class="hljs-title function_">unmount</span>();
}
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>âœ… æå‡å¼€å‘æ•ˆç‡</li>
<li>âœ… ä¾¿äºç‹¬ç«‹è°ƒè¯•</li>
<li>âœ… æ”¯æŒç‹¬ç«‹éƒ¨ç½²</li>
</ul>
<hr/>
<h2 data-id="heading-49">ä¸ƒã€è¸©å‘ç»éªŒæ€»ç»“</h2>
<p>åœ¨å®ç°è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é‡åˆ°äº†è®¸å¤šé—®é¢˜ï¼Œä»¥ä¸‹æ˜¯ä¸»è¦é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼š</p>
<h3 data-id="heading-50">7.1 Vue æ— æ³•è¯†åˆ« micro-app è‡ªå®šä¹‰å…ƒç´ </h3>
<p><strong>é—®é¢˜</strong>ï¼šVue 3 é»˜è®¤ä¼šå°†æ‰€æœ‰æ ‡ç­¾å½“ä½œ Vue ç»„ä»¶å¤„ç†ï¼Œä½† <code>micro-app</code> æ˜¯ WebComponent è‡ªå®šä¹‰å…ƒç´ ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šåœ¨ <code>vite.config.ts</code> ä¸­é…ç½® <code>isCustomElement</code>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">vue</span>({
  <span class="hljs-attr">template</span>: {
    <span class="hljs-attr">compilerOptions</span>: {
      <span class="hljs-attr">isCustomElement</span>: <span class="hljs-function">(<span class="hljs-params">tag</span>) =&gt;</span> tag === <span class="hljs-string">"micro-app"</span>,
    },
  },
})
</code></pre>
<h3 data-id="heading-51">7.2 Vite å­åº”ç”¨å¿…é¡»ä½¿ç”¨ iframe æ²™ç®±</h3>
<p><strong>é—®é¢˜</strong>ï¼šVite ä½œä¸ºå­åº”ç”¨æ—¶ï¼Œå¦‚æœä¸ä½¿ç”¨ iframe æ²™ç®±ï¼Œä¼šå‡ºç°è„šæœ¬æ‰§è¡Œé”™è¯¯ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šåœ¨ <code>MicroAppContainer</code> ç»„ä»¶ä¸­æ·»åŠ  <code>iframe</code> å±æ€§ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;micro-app
  :name="name"
  :url="url"
  router-mode="native"
  iframe  &lt;!-- å¿…é¡»æ·»åŠ  --&gt;
/&gt;
</code></pre>
<h3 data-id="heading-52">7.3 é€šä¿¡æ•°æ®æœªæ¥æ”¶</h3>
<p><strong>é—®é¢˜</strong>ï¼šå‘é€æ•°æ®åï¼Œå­åº”ç”¨æœªæ¥æ”¶åˆ°æ•°æ®ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ol>
<li>ç¡®ä¿æ·»åŠ äº†æ—¶é—´æˆ³ï¼Œç¡®ä¿æ•°æ®å˜åŒ–è¢«æ£€æµ‹</li>
<li>ä½¿ç”¨ <code>forceDispatch</code> å¼ºåˆ¶å‘é€æ•°æ®</li>
<li>æ£€æŸ¥ç›‘å¬å™¨æ˜¯å¦æ­£ç¡®æ³¨å†Œ</li>
</ol>
<h3 data-id="heading-53">7.4 è·¯ç”±ä¸åŒæ­¥</h3>
<p><strong>é—®é¢˜</strong>ï¼šå­åº”ç”¨è·¯ç”±å˜åŒ–æ—¶ï¼Œæµè§ˆå™¨åœ°å€æ æœªæ›´æ–°ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ol>
<li>ç¡®ä¿ä¸»åº”ç”¨ä½¿ç”¨ <code>router-mode="native"</code></li>
<li>ç¡®ä¿å­åº”ç”¨ä½¿ç”¨ <code>createWebHistory</code></li>
<li>æ£€æŸ¥åŸºç¡€è·¯ç”±é…ç½®æ˜¯å¦æ­£ç¡®</li>
</ol>
<blockquote>
<p><strong>ğŸ’¡ æ›´å¤šè¸©å‘è®°å½•</strong>ï¼šä»£ç ä»“åº“ä¸­åŒ…å«å®Œæ•´çš„è¸©å‘è®°å½•æ–‡æ¡£ï¼ˆ<code>docs/TROUBLESHOOTING.md</code>ï¼‰ï¼ŒåŒ…å«æ‰€æœ‰é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-54">å…«ã€é¡¹ç›®æ€»ç»“ä¸å±•æœ›</h2>
<h3 data-id="heading-55">8.1 å·²å®ŒæˆåŠŸèƒ½</h3>
<p>âœ… <strong>å®Œæ•´çš„é€šä¿¡æœºåˆ¶</strong>ï¼šä¸»å­åº”ç”¨åŒå‘é€šä¿¡ï¼Œæ”¯æŒå¤šç§äº‹ä»¶ç±»å‹
âœ… <strong>è·¯ç”±åŒæ­¥</strong>ï¼šè‡ªåŠ¨å¤„ç†è·¯ç”±åŒæ­¥ï¼Œæ”¯æŒæµè§ˆå™¨å‰è¿›åé€€
âœ… <strong>ç‹¬ç«‹è¿è¡Œ</strong>ï¼šå­åº”ç”¨æ”¯æŒç‹¬ç«‹å¼€å‘å’Œè°ƒè¯•
âœ… <strong>ç±»å‹å®‰å…¨</strong>ï¼šå®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰ï¼Œé›¶ <code>@ts-ignore</code>ï¼Œé›¶ <code>any</code>
âœ… <strong>äº‹ä»¶æ€»çº¿</strong>ï¼šè§£è€¦ç”Ÿå‘½å‘¨æœŸå’Œä¸šåŠ¡é€»è¾‘
âœ… <strong>ä¸€é”®å¯åŠ¨</strong>ï¼šå¹¶è¡Œå¯åŠ¨æ‰€æœ‰åº”ç”¨ï¼Œæå‡å¼€å‘æ•ˆç‡
âœ… <strong>é”™è¯¯å¤„ç†</strong>ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†å’Œé™çº§æ–¹æ¡ˆ
âœ… <strong>æ—¥å¿—ä¼˜åŒ–</strong>ï¼šå¼€å‘/ç”Ÿäº§ç¯å¢ƒåŒºåˆ†ï¼Œæ€§èƒ½ä¼˜åŒ–
âœ… <strong>ç¯å¢ƒé€‚é…</strong>ï¼šæ”¯æŒå¼€å‘/ç”Ÿäº§ç¯å¢ƒï¼ŒåŒåŸŸ/è·¨åŸŸéƒ¨ç½²</p>
<h3 data-id="heading-56">8.2 æŠ€æœ¯äº®ç‚¹</h3>
<ol>
<li><strong>ç±»å‹å®‰å…¨ä¼˜å…ˆ</strong>ï¼šå®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰ï¼Œé¿å…è¿è¡Œæ—¶é”™è¯¯</li>
<li><strong>ä¼ä¸šçº§å®è·µ</strong>ï¼šå‚è€ƒçœŸå®ä¼ä¸šé¡¹ç›®ï¼Œä½†æ”¹è¿›å…¶ä¸è¶³</li>
<li><strong>å¼€ç®±å³ç”¨</strong>ï¼šå®Œæ•´çš„é…ç½®å’Œæ–‡æ¡£ï¼Œå¿«é€Ÿä¸Šæ‰‹</li>
<li><strong>æœ€ä½³å®è·µ</strong>ï¼šéµå¾ª micro-app å®˜æ–¹æ¨èå®è·µ</li>
<li><strong>ä»£ç è´¨é‡</strong>ï¼šæ¸…æ™°çš„ä»£ç ç»“æ„ï¼Œå®Œå–„çš„æ³¨é‡Š</li>
<li><strong>å¯ç»´æŠ¤æ€§</strong>ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•</li>
</ol>
<h3 data-id="heading-57">8.3 é¡¹ç›®ä»·å€¼</h3>
<ul>
<li>ğŸ¯ <strong>å­¦ä¹ ä»·å€¼</strong>ï¼šå®Œæ•´çš„å¾®å‰ç«¯å®ç°ç¤ºä¾‹ï¼Œé€‚åˆæ·±å…¥å­¦ä¹ </li>
<li>ğŸš€ <strong>å®ç”¨ä»·å€¼</strong>ï¼šå¯ç›´æ¥ç”¨äºç”Ÿäº§ç¯å¢ƒï¼ŒèŠ‚çœå¼€å‘æ—¶é—´</li>
<li>ğŸ“š <strong>å‚è€ƒä»·å€¼</strong>ï¼šæœ€ä½³å®è·µå’Œè¸©å‘ç»éªŒï¼Œé¿å…é‡å¤è¸©å‘</li>
</ul>
<hr/>
<h2 data-id="heading-58">ğŸ“š å‚è€ƒèµ„æº</h2>
<h3 data-id="heading-59">å®˜æ–¹æ–‡æ¡£</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fjd-opensource.github.io%2Fmicro-app%2Fdocs.html%23%2F" target="_blank" title="https://jd-opensource.github.io/micro-app/docs.html#/" ref="nofollow noopener noreferrer">micro-app å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.vuejs.org%2F" target="_blank" title="https://cn.vuejs.org/" ref="nofollow noopener noreferrer">Vue 3 æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.vitejs.dev%2F" target="_blank" title="https://cn.vitejs.dev/" ref="nofollow noopener noreferrer">Vite æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Frouter.vuejs.org%2Fzh%2F" target="_blank" title="https://router.vuejs.org/zh/" ref="nofollow noopener noreferrer">Vue Router æ–‡æ¡£</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Arthas å¸¸ç”¨å‘½ä»¤]]></title>    <link>https://juejin.cn/post/7603567912593326107</link>    <guid>https://juejin.cn/post/7603567912593326107</guid>    <pubDate>2026-02-07T06:52:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603567912593326107" data-draft-id="7603591775392595995" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Arthas å¸¸ç”¨å‘½ä»¤"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-07T06:52:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="éª‘ç€bugçš„coder"/> <meta itemprop="url" content="https://juejin.cn/user/1922418579089566"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Arthas å¸¸ç”¨å‘½ä»¤
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1922418579089566/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    éª‘ç€bugçš„coder
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T06:52:24.000Z" title="Sat Feb 07 2026 06:52:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">1. å¯åŠ¨ä¸åŸºç¡€</h3>
<ul>
<li><strong>å¯åŠ¨ï¼š</strong> <code>java -jar arthas-boot.jar</code></li>
<li><strong>é€€å‡ºå®¢æˆ·ç«¯ï¼ˆä¸å…³æœåŠ¡ï¼‰ï¼š</strong> <code>quit</code> æˆ– <code>exit</code></li>
<li><strong>å½»åº•å…³é—­ Arthas æœåŠ¡ï¼š</strong> <code>stop</code> (ä¸€å®šè¦è®°å¾—å…³ï¼Œå¦åˆ™ä¸‹æ¬¡è¿å¯èƒ½æŠ¥é”™)</li>
</ul>
<h3 data-id="heading-1">2. å…¨å±€ç›‘æ§Â </h3>
<ul>
<li>
<p><strong><code>dashboard</code></strong></p>
<ul>
<li><strong>ä½œç”¨ï¼š</strong> çœ‹æ¿ã€‚ä¸€çœ¼çœ‹åˆ° çº¿ç¨‹ã€å†…å­˜ã€GCã€Runtime ä¿¡æ¯ã€‚</li>
<li><strong>åœºæ™¯ï¼š</strong> åˆšè¿ä¸ŠæœåŠ¡ï¼Œç¡®è®¤ç³»ç»Ÿæ•´ä½“æ°´ä½ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>thread</code></strong></p>
<ul>
<li><code>thread -n 3</code>ï¼šæŸ¥çœ‹æœ€å¿™çš„å‰ 3 ä¸ªçº¿ç¨‹ï¼ˆ<strong>æ’æŸ¥ CPU é£™é«˜ç¥å™¨</strong>ï¼‰ã€‚</li>
<li><code>thread -b</code>ï¼šæ‰¾å‡ºå½“å‰é˜»å¡å…¶ä»–çº¿ç¨‹çš„çº¿ç¨‹ï¼ˆ<strong>æ’æŸ¥æ­»é”</strong>ï¼‰ã€‚</li>
<li><code>thread &lt;id&gt;</code>ï¼šæŸ¥çœ‹æŒ‡å®šçº¿ç¨‹çš„å †æ ˆã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-2">3. ä»£ç ä¸ç±»æ£€æŸ¥ (æˆ‘å‘çš„åŒ…ç”Ÿæ•ˆäº†å—ï¼Ÿ)</h3>
<ul>
<li>
<p><strong><code>jad</code></strong> (åç¼–è¯‘)</p>
<ul>
<li><code>jad com.example.DemoController</code>ï¼šåç¼–è¯‘æ•´ä¸ªç±»ã€‚</li>
<li><code>jad com.example.DemoController testMethod</code>ï¼šåªåç¼–è¯‘æŸä¸ªæ–¹æ³•ï¼ˆæ¨èï¼Œçœå±ï¼‰ã€‚</li>
<li><strong>åœºæ™¯ï¼š</strong> æ€€ç–‘ä»£ç æ²¡å‘ä¸Šå»ï¼Œæˆ–è€…åˆ†æ”¯åˆé”™äº†ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>sc</code></strong> (Search Class)</p>
<ul>
<li><code>sc -d com.example.DemoController</code>ï¼šæ‰“å°ç±»çš„è¯¦ç»†ä¿¡æ¯ï¼ˆç±»åŠ è½½å™¨ã€Jar åŒ…æ¥æºï¼‰ã€‚</li>
<li><strong>åœºæ™¯ï¼š</strong> é‡åˆ° <code>ClassNotFoundException</code> æˆ– <code>NoClassDefFoundError</code> æ—¶æ£€æŸ¥ç±»åŠ è½½å™¨ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>sm</code></strong> (Search Method)</p>
<ul>
<li><code>sm -d com.example.DemoController testMethod</code>ï¼šæŸ¥çœ‹æ–¹æ³•çš„è¯¦ç»†ä¿¡æ¯ï¼ˆå…¥å‚ç±»å‹ã€ä¿®é¥°ç¬¦ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-3">4. æ–¹æ³•çº§ç›‘æ§ (æ ¸å¿ƒä¸­çš„æ ¸å¿ƒ)</h3>
<p><strong>æ³¨æ„ï¼š</strong> ä»¥ä¸‹å‘½ä»¤éƒ½æ”¯æŒ <code>-n</code> (æ‰§è¡Œæ¬¡æ•°) å’Œ <code>-x</code> (å¯¹è±¡éå†æ·±åº¦)ã€‚</p>
<ul>
<li>
<p><strong><code>watch</code></strong> (è§‚æµ‹å…¥å‚ã€è¿”å›å€¼ã€å¼‚å¸¸) â€”â€” <strong>æœ€å¼ºå‘½ä»¤</strong></p>
<ul>
<li>
<p><strong>çœ‹å…¥å‚å’Œè¿”å›å€¼ï¼š</strong></p>
<p>Bash</p>
<pre><code class="hljs language-arduino" lang="arduino">watch com.example.DemoController testMethod <span class="hljs-string">"{params, returnObj}"</span> -x <span class="hljs-number">2</span>
</code></pre>
</li>
<li>
<p><strong>çœ‹å¼‚å¸¸ï¼ˆåªåœ¨æŠ›å¼‚å¸¸æ—¶æ‰“å°ï¼‰ï¼š</strong></p>
<p>Bash</p>
<pre><code class="hljs language-arduino" lang="arduino">watch com.example.DemoController testMethod <span class="hljs-string">"{params, throwExp}"</span> -e -x <span class="hljs-number">2</span>
</code></pre>
</li>
<li>
<p><strong>æ¡ä»¶è¿‡æ»¤ï¼ˆåªçœ‹ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ "user1" çš„è¯·æ±‚ï¼‰ï¼š</strong></p>
<p>Bash</p>
<pre><code class="hljs language-arduino" lang="arduino">watch com.example.DemoController testMethod <span class="hljs-string">"{params, returnObj}"</span> <span class="hljs-string">"params[0]=='user1'"</span> -x <span class="hljs-number">2</span>
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong><code>trace</code></strong> (æ–¹æ³•å†…éƒ¨è°ƒç”¨è€—æ—¶) â€”â€” <strong>æ’æŸ¥æ…¢æ¥å£ç¥å™¨</strong></p>
<ul>
<li>
<p><strong>åŸºæœ¬ç”¨æ³•ï¼š</strong></p>
<p>Bash</p>
<pre><code class="hljs">trace com.example.DemoController testMethod
</code></pre>
</li>
<li>
<p><strong>å¸¦æ¡ä»¶ï¼ˆåªè¿½è¸ªè€—æ—¶ &gt; 100ms çš„è¯·æ±‚ï¼‰ï¼š</strong></p>
<p>Bash</p>
<pre><code class="hljs language-arduino" lang="arduino">trace com.example.DemoController testMethod <span class="hljs-string">'#cost &gt; 100'</span>
</code></pre>
</li>
<li>
<p><strong>æ•ˆæœï¼š</strong> ä¼šæ‰“å°å‡ºæ–¹æ³•å†…éƒ¨æ¯ä¸€è¡Œä»£ç ï¼ˆæˆ–å…¶ä»–æ–¹æ³•è°ƒç”¨ï¼‰çš„è€—æ—¶ï¼Œçº¢è‰²çš„å°±æ˜¯ç“¶é¢ˆã€‚</p>
</li>
</ul>
</li>
<li>
<p><strong><code>tt</code></strong> (Time Tunnel æ—¶å…‰éš§é“) â€”â€” <strong>é‡æ”¾è¯·æ±‚</strong></p>
<ul>
<li><strong>è®°å½•ä¸‹æ¥ä¸‹æ¥çš„è¯·æ±‚ï¼š</strong> <code>tt -t com.example.DemoController testMethod</code></li>
<li><strong>åˆ—å‡ºè®°å½•ï¼š</strong> <code>tt -l</code></li>
<li><strong>é‡æ”¾æŸä¸ªè¯·æ±‚ï¼ˆindex=1000ï¼‰ï¼š</strong> <code>tt -i 1000 -p</code></li>
<li><strong>åœºæ™¯ï¼š</strong> æµ‹è¯•ç¯å¢ƒå¤ç°éš¾ï¼ŒæŠ“åˆ°ä¸€ä¸ªç°åœºåï¼Œåå¤é‡æ”¾æ¥è°ƒè¯•ï¼Œä¸ç”¨æ±‚å‰ç«¯å†ç‚¹ä¸€æ¬¡ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-4">5. çƒ­æ›´æ–° (Hot Swap)</h3>
<p><strong>æ…ç”¨ï¼Œä»…é™ç´§æ€¥æ•‘ç«ã€‚</strong></p>
<ol>
<li>
<p><strong>åç¼–è¯‘ä»£ç åˆ°æœ¬åœ°ï¼š</strong></p>
<p><code>jad --source-only com.example.User &gt; /tmp/User.java</code></p>
</li>
<li>
<p><strong>æœ¬åœ°ä¿®æ”¹ <code>/tmp/User.java</code> (æ¯”å¦‚åŠ ä¸€è¡Œæ—¥å¿—)ã€‚</strong></p>
</li>
<li>
<p><strong>å†…å­˜ç¼–è¯‘ï¼š</strong></p>
<p><code>mc /tmp/User.java -d /tmp</code></p>
</li>
<li>
<p><strong>é‡æ–°åŠ è½½ç±»ï¼š</strong></p>
<p><code>retransform /tmp/com/example/User.class</code></p>
</li>
</ol>
<h3 data-id="heading-5">6. æ€§èƒ½åˆ†æ (ç«ç„°å›¾)</h3>
<ul>
<li><strong><code>profiler start</code></strong>ï¼šå¼€å§‹é‡‡æ · CPUï¼ˆç”Ÿæˆç«ç„°å›¾ï¼‰ã€‚</li>
<li><strong><code>profiler stop</code></strong>ï¼šåœæ­¢é‡‡æ ·å¹¶è¾“å‡º SVG è·¯å¾„ã€‚</li>
<li><strong>åœºæ™¯ï¼š</strong> ä¹Ÿå°±æ˜¯ä½ ä»¥å‰ç”¨ JProfiler åšçš„é‚£äº›äº‹ï¼Œç°åœ¨å¯ä»¥ç›´æ¥ç”Ÿæˆ SVG å¯ä»¥åœ¨æµè§ˆå™¨çœ‹å“ªé‡Œåƒ CPUã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-6">é™„ï¼šå¿…é¡»è¦æ‡‚çš„å‚æ•° (OGNL è¡¨è¾¾å¼)</h3>
<p>åœ¨ <code>watch</code>ã€<code>trace</code> ç­‰å‘½ä»¤ä¸­ï¼ŒèŠ±æ‹¬å· <code>{}</code> é‡Œå’Œæ¡ä»¶è¡¨è¾¾å¼é‡Œç»å¸¸ç”¨åˆ°è¿™äº›å˜é‡ï¼š</p>



































<table><thead><tr><th><strong>å˜é‡å</strong></th><th><strong>å«ä¹‰</strong></th><th><strong>å¸¸ç”¨åœºæ™¯</strong></th></tr></thead><tbody><tr><td><strong><code>params</code></strong></td><td>æ–¹æ³•å…¥å‚</td><td><code>params[0]</code> (ç¬¬ä¸€ä¸ªå‚æ•°), <code>params.length</code></td></tr><tr><td><strong><code>returnObj</code></strong></td><td>è¿”å›å€¼</td><td>æŸ¥çœ‹æ¥å£è¿”å›äº†ä»€ä¹ˆ</td></tr><tr><td><strong><code>throwExp</code></strong></td><td>å¼‚å¸¸å¯¹è±¡</td><td>æŸ¥çœ‹æŠ›å‡ºäº†ä»€ä¹ˆé”™</td></tr><tr><td><strong><code>target</code></strong></td><td>å½“å‰å¯¹è±¡</td><td><code>target.field</code> (æŸ¥çœ‹å½“å‰ç±»çš„æˆå‘˜å˜é‡å€¼)</td></tr><tr><td><strong><code>#cost</code></strong></td><td>æ–¹æ³•è€—æ—¶(ms)</td><td>ç”¨äºè¿‡æ»¤æ…¢è¯·æ±‚ <code>'#cost &gt; 100'</code></td></tr></tbody></table>
<p><strong>é€šç”¨å‚æ•°ï¼š</strong></p>
<ul>
<li><strong><code>-n 5</code></strong>ï¼šé™åˆ¶æ•è· 5 æ¬¡ï¼ˆé˜²æ­¢åˆ·å±å¡æ­»ï¼‰ã€‚</li>
<li><strong><code>-x 3</code></strong>ï¼šå¯¹è±¡å±•å¼€æ·±åº¦ 3 å±‚ï¼ˆé»˜è®¤æ˜¯ 1ï¼Œåªèƒ½çœ‹åˆ°å¯¹è±¡åœ°å€ï¼Œçœ‹ä¸åˆ°é‡Œé¢å±æ€§ï¼Œå»ºè®®è®¾ä¸º 2 æˆ– 3ï¼‰ã€‚</li>
<li><strong><code>-e</code></strong>ï¼šåªæ•è·å¼‚å¸¸è¯·æ±‚ã€‚</li>
</ul>
<p><strong>æ€»ç»“ï¼š</strong></p>
<p>å¹³æ—¶ 90% çš„æƒ…å†µï¼Œåªéœ€è¦ï¼š<strong><code>dashboard</code> çœ‹çŠ¶æ€ -&gt; <code>thread -n 3</code> æŸ¥ CPU -&gt; <code>jad</code> æŸ¥ä»£ç  -&gt; <code>watch</code> æŸ¥å‚æ•°è¿”å›å€¼ -&gt; <code>trace</code> æŸ¥æ…¢æ¥å£ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Rustå…³äºå¹¶å‘å®‰å…¨çš„ç†å¿µ]]></title>    <link>https://juejin.cn/post/7603575763787415578</link>    <guid>https://juejin.cn/post/7603575763787415578</guid>    <pubDate>2026-02-07T06:54:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603575763787415578" data-draft-id="7603575763787399194" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Rustå…³äºå¹¶å‘å®‰å…¨çš„ç†å¿µ"/> <meta itemprop="keywords" content="Rust"/> <meta itemprop="datePublished" content="2026-02-07T06:54:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·935726200103"/> <meta itemprop="url" content="https://juejin.cn/user/3212121986310793"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Rustå…³äºå¹¶å‘å®‰å…¨çš„ç†å¿µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3212121986310793/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·935726200103
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T06:54:59.000Z" title="Sat Feb 07 2026 06:54:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Rustå…³äºå¹¶å‘å®‰å…¨çš„ç†å¿µ</h2>
<h3 data-id="heading-1">ä¸€ä¸ªå¹¶å‘åœºæ™¯</h3>
<p>æˆ‘ä»¬åœ¨ä½¿ç”¨rustæ—¶å¯èƒ½ä¼šé‡åˆ°è¿™æ ·ä¸€ç§ä½¿ç”¨åœºæ™¯ï¼šä¸€ä»½æ•°æ®è¦è¢«å¤šä¸ªçº¿ç¨‹å…±äº«å¹¶ä¸”ä¿®æ”¹ï¼Œä¸”åœ¨æ­¤æ•°æ®ä½¿ç”¨å®Œæ¯•åéœ€è¦è‡ªåŠ¨é‡Šæ”¾å†…å­˜ç©ºé—´ã€‚æˆ‘ä»¬èƒ½æƒ³åˆ°çš„ç¬¬ä¸€ä¸ªå·¥å…·å¯èƒ½æ˜¯Arcï¼ˆAtomic reference countingï¼‰ã€‚Arcç”¨äºçº¿ç¨‹å®‰å…¨åœ°ç»´æŠ¤ä¸€ä»½æ•°æ®çš„<strong>å¼•ç”¨æ¬¡æ•°</strong>ï¼Œåœ¨å…¶æ‰€æœ‰å¼•ç”¨éƒ½ç¦»å¼€ä½œç”¨åŸŸä¹‹åï¼ŒArcæ‰€ç®¡ç†/æŒ‡å‘çš„å †æ•°æ®å°†ä¼šè¢«å›æ”¶ã€‚åªç”¨Arcï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼ˆ<strong>é”™è¯¯å®ç°</strong>ï¼‰ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">use std::{sync::Arc, thread::{sleep, spawn}, time::Duration}<span class="hljs-comment">;</span>

fn main() {
    let <span class="hljs-attr">data</span> = Arc::new(<span class="hljs-number">5</span>)<span class="hljs-comment">;</span>
    {
        let mut <span class="hljs-attr">data</span> = data.clone()<span class="hljs-comment">;</span>
        spawn(move || {
            let <span class="hljs-attr">mut_data</span> = Arc::get_mut(&amp;mut data).unwrap()<span class="hljs-comment">;</span>
            *mut_data += 1<span class="hljs-comment">;</span>
        })<span class="hljs-comment">;</span>
    }
    {
        let mut <span class="hljs-attr">data</span> = data.clone()<span class="hljs-comment">;</span>
        spawn(move || {
            let <span class="hljs-attr">mut_data</span> = Arc::get_mut(&amp;mut data).unwrap()<span class="hljs-comment">;</span>
            *mut_data += 1<span class="hljs-comment">;</span>
        })<span class="hljs-comment">;</span>
    }
    sleep(Duration::from_millis(1000))<span class="hljs-comment">;</span>
    println!("Final data: {}", data)<span class="hljs-comment">;</span>
}
</code></pre>
<p>è¿™æ®µç¨‹åºä¼španicï¼ŒArc get_mutéœ€è¦æœ‰å”¯ä¸€å¼•ç”¨ï¼Œå¦‚æœå·²æœ‰ä¸€ä¸ªå¼•ç”¨çš„è¯ï¼ˆlet data = Arc::new(5)ï¼‰ï¼Œget_mutä¼šè¿”å›Option::Noneï¼Œè¿›è€Œå¯¼è‡´unwrap() panicã€‚</p>
<blockquote>
<p>æç¤ºï¼šç”Ÿäº§ç¯å¢ƒä¸è¦ä½¿ç”¨unwrap()ï¼Œä½¿ç”¨matchè¯­å¥å®‰å…¨åœ°å¤„ç†æ‰€æœ‰æƒ…å†µï¼Œé¿å…panicå¯¼è‡´ç¨‹åºç»ˆæ­¢ã€‚</p>
</blockquote>
<p>é‚£ä¹ˆå¦‚ä½•åšåˆ°å¹¶å‘ä¿®æ”¹æ•°æ®å‘¢ï¼Ÿå¦‚ä½•è·å–åˆ°Arcå†…æ•°æ®çš„å¯å˜å¼•ç”¨å‘¢ï¼Ÿæˆ‘ä»¬å¯èƒ½ä¼šæƒ³åˆ°RefCellï¼ˆé”™è¯¯å®ç°ï¼‰ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">use std::{cell::RefCell, sync::Arc, thread::{sleep, spawn}, time::Duration}<span class="hljs-comment">;</span>

fn main() {
    let <span class="hljs-attr">data</span> = Arc::new(RefCell::new(<span class="hljs-number">5</span>))<span class="hljs-comment">;</span>
    {
        let <span class="hljs-attr">data</span> = data.clone()<span class="hljs-comment">;</span>
        // ä¸èƒ½ç¼–è¯‘
        spawn(move || {
            let mut <span class="hljs-attr">mut_data</span> = data.borrow_mut()<span class="hljs-comment">; // try_borrow_mutè¿”å›Resultæ›´å¥½ï¼Œé¿å…panic</span>
            *mut_data += 1<span class="hljs-comment">;</span>
        })<span class="hljs-comment">;</span>
    }
    {
        let <span class="hljs-attr">data</span> = data.clone()<span class="hljs-comment">;</span>
        spawn(move || {
            let mut <span class="hljs-attr">mut_data</span> = data.borrow_mut()<span class="hljs-comment">;</span>
            *mut_data += 1<span class="hljs-comment">;</span>
        })<span class="hljs-comment">;</span>
    }
    sleep(Duration::from_millis(1000))<span class="hljs-comment">;</span>
    println!("Final data: {}", data.borrow())<span class="hljs-comment">;</span>
}
</code></pre>
<p>ä»¥ä¸Šä»£ç åœ¨ç¼–è¯‘æœŸä¼šæŠ¥é”™ï¼š</p>
<pre><code class="hljs language-rust" lang="rust">`RefCell&lt;<span class="hljs-type">i32</span>&gt;` cannot be shared between threads safely
the <span class="hljs-keyword">trait</span> `<span class="hljs-built_in">Sync</span>` is not implemented <span class="hljs-keyword">for</span> `RefCell&lt;<span class="hljs-type">i32</span>&gt;`
<span class="hljs-keyword">if</span> you want to <span class="hljs-keyword">do</span> aliasing and mutation between multiple threads, <span class="hljs-keyword">use</span> `std::sync::RwLock` instead
required <span class="hljs-keyword">for</span> `Arc&lt;RefCell&lt;<span class="hljs-type">i32</span>&gt;&gt;` to implement `<span class="hljs-built_in">Send</span>`
</code></pre>
<p>æç¤ºRefCellä¸èƒ½è¢«å®‰å…¨åœ°åœ¨çº¿ç¨‹é—´å…±äº«ä»¥åŠRefCellæœªå®ç°Sync traitã€‚é‚£ä¹ˆåˆ°åº•è¯¥å¦‚ä½•å®ç°å¤šçº¿ç¨‹å¹¶å‘ä¿®æ”¹å…±äº«æ•°æ®å‘¢ï¼Ÿ</p>
<h3 data-id="heading-2">æ­£ç¡®ä½¿ç”¨æ–¹å¼</h3>
<p>rustæœ€ä¼˜ç§€ä¹Ÿæ˜¯æœ€çªå‡ºçš„ä¸€ç‚¹å°±æ˜¯å®ƒçš„ç¼–è¯‘å™¨ï¼Œå®ƒèƒ½å¤Ÿç»™äºˆæˆ‘ä»¬è®¸å¤šæœ‰ç”¨çš„ä¿¡æ¯ã€‚åœ¨ä¸Šä¸€èŠ‚çš„æœ€åä¸€æ¬¡å°è¯•åï¼Œç¼–è¯‘å™¨æç¤ºæˆ‘ä»¬ä½¿ç”¨std::sync::RwLockï¼š</p>
<pre><code class="hljs language-ini" lang="ini">use std::{sync::{Arc, RwLock}, thread::{sleep, spawn}, time::Duration}<span class="hljs-comment">;</span>

fn main() {
    let <span class="hljs-attr">data</span> = Arc::new(RwLock::new(<span class="hljs-number">5</span>))<span class="hljs-comment">;</span>
    {
        let <span class="hljs-attr">data</span> = data.clone()<span class="hljs-comment">;</span>
        spawn(move || {
            let mut <span class="hljs-attr">mut_data</span> = data.write().unwrap()<span class="hljs-comment">;</span>
            *mut_data += 1<span class="hljs-comment">;</span>
        })<span class="hljs-comment">;</span>
    }
    {
        let <span class="hljs-attr">data</span> = data.clone()<span class="hljs-comment">;</span>
        spawn(move || {
            let mut <span class="hljs-attr">mut_data</span> = data.write().unwrap()<span class="hljs-comment">;</span>
            *mut_data += 1<span class="hljs-comment">;</span>
        })<span class="hljs-comment">;</span>
    }
    sleep(Duration::from_millis(1000))<span class="hljs-comment">;</span>
    println!("Final data: {}", data.read().unwrap())<span class="hljs-comment">;</span>
}
</code></pre>
<p>è¿™æ¬¡ç»ˆäºæ²¡æœ‰äº†panicå’Œç¼–è¯‘æŠ¥é”™ï¼Œå¾—åˆ°äº†ç¬¦åˆé¢„æœŸçš„ç»“æœï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin">Final <span class="hljs-keyword">data</span>: <span class="hljs-number">7</span>
</code></pre>
<h3 data-id="heading-3">Rustå…³äºå¹¶å‘å®‰å…¨çš„ç†å¿µ</h3>
<p>Ruståœ¨ç¼–è¯‘æœŸé—´ä¿è¯ä¸€ä¸ªæ•°æ®ä»»ä¸€æ—¶åˆ»åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹ï¼Œä¸èƒ½æœ‰ä»»ä½•å…¶å®ƒçº¿ç¨‹åœ¨è¯»å–æˆ–å†™å…¥ã€‚æˆ‘ä»¬è¦åšçš„å°±æ˜¯æ»¡è¶³æ‰€æœ‰Rustç¼–è¯‘å™¨çš„â€œè¦æ±‚â€ï¼Œä¾¿èƒ½æå¤§åœ°å‡å°‘å¹¶å‘å®‰å…¨é—®é¢˜ï¼ˆå¹¶éå…¨éƒ¨ï¼‰ã€‚</p>
<h3 data-id="heading-4">é™„1ï¼šSendå’ŒSync traitæ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>Sendå’ŒSyncæ˜¯ä¸€ç§æ ‡è®°traitï¼Œæ ‡è®°traitçš„æ„ä¹‰å¤§å¤šç”¨æ¥æŒ‡ç¤ºç¼–è¯‘å™¨è¿›è¡Œå®‰å…¨æ£€æŸ¥ã€‚é‚£ä¹ˆSendå’ŒSyncä¿è¯ä»€ä¹ˆå®‰å…¨å‘¢ï¼Ÿå½“ä¸€ä¸ªå†…å­˜æ•°æ®ï¼Œè¢«å¤šä¸ªå¼•ç”¨æŒ‡å‘å¹¶æƒ³è¦ä¿®æ”¹å®ƒæ—¶ï¼Œå¿…é¡»æœ‰æŸç§åŒæ­¥æœºåˆ¶ï¼Œå¯ä»¥ä¿è¯æ‰€æœ‰çš„ä¿®æ”¹ï¼Œéƒ½èƒ½å¤ŸåŒæ­¥åœ°è¢«æ‰€æœ‰å¼•ç”¨çŸ¥æ™“ï¼Œrusté€šè¿‡Sendå’ŒSyncæ¥è¡¨è¾¾æŸä¸ªæ•°æ®ç±»å‹å…·æœ‰è¿™ç§æœºåˆ¶ã€‚</p>
<p>å¤§å¤šæ•°çš„åŸå§‹ç±»å‹éƒ½æ˜¯Sendå’ŒSyncçš„ï¼Œä¾‹å¦‚æ•´å½¢ï¼Œæµ®ç‚¹å‹ï¼Œå¸ƒå°”ï¼Œå­—ç¬¦ç­‰ã€‚è€Œä¸”Sendå’ŒSyncæ˜¯å¯ä»¥è‡ªåŠ¨è¢«ç¼–è¯‘å™¨å®ç°çš„ï¼Œå³å½“ç»“æ„ä½“åŒ…å«çš„æ‰€æœ‰å­—æ®µéƒ½æ˜¯Sendæˆ–Syncæ—¶ï¼Œé‚£ä¹ˆè¿™ä¸ªç»“æ„ä½“ä¹Ÿæ˜¯Sendæˆ–Syncçš„ã€‚</p>
<h3 data-id="heading-5">é™„2ï¼šRefCellæœ‰ä½•æ„ä¹‰ï¼Ÿ</h3>
<p>RefCellå…·æœ‰Interior mutableçš„å±æ€§ã€‚å³ä½¿æ˜¯RefCellç±»å‹çš„å¸¸é‡ï¼Œå…¶å†…éƒ¨ä¿å­˜çš„æ•°æ®ä¹Ÿå¯ä¿®æ”¹ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::cell::RefCell;

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">data</span> = RefCell::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-number">0</span>);
    *data.<span class="hljs-title function_ invoke__">borrow_mut</span>() += <span class="hljs-number">1</span>;
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"Data: {}"</span>, data.<span class="hljs-title function_ invoke__">borrow</span>());
}
</code></pre>
<p>è¾“å‡ºï¼š</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">Data: 1</span>
</code></pre>
<p>è¿™åœ¨mockæµ‹è¯•åœºæ™¯ä¸­å¯èƒ½æœ‰ä»·å€¼ã€‚ä¾‹å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªæ•°æ®Repositoryç‰¹æ€§ï¼Œå…¶æ–¹æ³•å®šä¹‰ä¸ºfn save(&amp;self, value: &amp;T)ï¼Œä¹‹åæˆ‘ä»¬æƒ³è¦mockè¿™ä¸ªRepositoryç‰¹æ€§ä½œéš”ç¦»æµ‹è¯•ï¼Œåœ¨mockå®ç°ä¸­å°†æ•°æ®ä¿å­˜è‡³mockç»“æ„ä¸­çš„æŸä¸ªâ€œå†…å­˜æ•°æ®åº“â€ä¸­ã€‚ä½†ç‰¹æ€§æ˜¯&amp;selfå¼•ç”¨ç±»å‹ï¼ˆè®¾è®¡åˆè¡·ä¸å¸Œæœ›æ¥å£çš„ç”¨æˆ·æ”¹å˜ç»“æ„å†…çš„å­—æ®µå€¼ï¼Œæˆ–æ²¡æœ‰å¿…è¦ä¿®æ”¹ï¼‰ï¼Œæ„å‘³ç€å…¶å†…éƒ¨æ•°æ®å…¨éƒ¨ä¸å¯å˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•å®ç°å¯¹mockç»“æ„ä¸­çš„æ•°æ®çš„ä¿®æ”¹å‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨RefCellï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::cell::RefCell;

<span class="hljs-keyword">trait</span> <span class="hljs-title class_">Repository</span>&lt;T&gt; {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">save</span>(&amp;<span class="hljs-keyword">self</span>, value: T);
}

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">InMemoryRepository</span>&lt;T&gt; {
    data: RefCell&lt;<span class="hljs-type">Option</span>&lt;T&gt;&gt;,
}

<span class="hljs-keyword">impl</span>&lt;T&gt; Repository&lt;T&gt; <span class="hljs-keyword">for</span> <span class="hljs-title class_">InMemoryRepository</span>&lt;T&gt; {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">save</span>(&amp;<span class="hljs-keyword">self</span>, value: T) {
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Ok</span>(<span class="hljs-keyword">mut</span> data) = <span class="hljs-keyword">self</span>.data.<span class="hljs-title function_ invoke__">try_borrow_mut</span>() {
            *data = <span class="hljs-title function_ invoke__">Some</span>(value);
        }
    }
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">repo</span>: InMemoryRepository&lt;<span class="hljs-type">i32</span>&gt; = InMemoryRepository {
        data: RefCell::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-literal">None</span>),
    };

    repo.<span class="hljs-title function_ invoke__">save</span>(<span class="hljs-number">42</span>);

    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"Value saved in repository: {:?}"</span>, repo.data.<span class="hljs-title function_ invoke__">borrow</span>());
}
</code></pre>
<p>è¾“å‡ºï¼š</p>
<pre><code class="hljs language-css" lang="css">Value saved in repository: <span class="hljs-built_in">Some</span>(<span class="hljs-number">42</span>)
</code></pre>
<p>å®ƒå¯ä»¥å°†å€Ÿç”¨æ£€æŸ¥ä»ç¼–è¯‘å™¨æ¨è¿Ÿåˆ°è¿è¡ŒæœŸï¼Œä½†ä¸å»ºè®®çº¯ç²¹ä»¥æ­¤ä¸ºç›®çš„ä½¿ç”¨ã€‚</p>
<p>æœ‰äº›è¯»è€…æ­¤æ—¶å¯èƒ½ä¼šéå¸¸ç–‘æƒ‘ï¼Œé‚£ä¹ˆè¿™ä¸æ˜¯ä¸€ç§ä¸å®‰å…¨çš„å®ç°å—ï¼Ÿçš„ç¡®æ˜¯ï¼ŒRefCellæ˜¯ä¸€ç§å¦¥åï¼Œå¯¹å€Ÿç”¨æ£€æŸ¥çš„â€œå¼±åŒ–â€ã€‚æœ‰äº›æ—¶å€™ç¼–è¯‘å™¨å¯¹äºå€Ÿç”¨çš„è¦æ±‚è¿‡äºä¸¥æ ¼ï¼Œä»£ç ç¼–å†™èµ·æ¥å°±ä¼šéå¸¸å›°éš¾ã€‚ç†è®ºä¸Šåœ¨ç¨‹åºå‘˜å®Œå…¨ç›¸ä¿¡è‡ªå·±çš„ä»£ç ç¬¦åˆå€Ÿç”¨è§„åˆ™çš„æƒ…å†µä¸‹ï¼Œæ‰åº”è¯¥ä½¿ç”¨RefCellæ¥å‡è½»â€œç—›è‹¦â€ã€‚æˆ–è€…æœªæ¥çš„æŸå¤©ï¼Œrustç¼–è¯‘å™¨è¿›åŒ–ï¼Œå€Ÿç”¨æ£€æŸ¥å¯ä»¥è¦†ç›–æ‰€æœ‰çš„æƒ…å†µï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ï¼ŒRefCellå°±å¯ä»¥é€€ä¼‘äº†ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[micro-app å¾®å‰ç«¯é¡¹ç›®éƒ¨ç½²æŒ‡å—]]></title>    <link>https://juejin.cn/post/7603567912593440795</link>    <guid>https://juejin.cn/post/7603567912593440795</guid>    <pubDate>2026-02-07T07:41:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603567912593440795" data-draft-id="7603653885601660978" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="micro-app å¾®å‰ç«¯é¡¹ç›®éƒ¨ç½²æŒ‡å—"/> <meta itemprop="keywords" content="å‰ç«¯,Nginx,å¾®æœåŠ¡"/> <meta itemprop="datePublished" content="2026-02-07T07:41:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RemHusband"/> <meta itemprop="url" content="https://juejin.cn/user/1425415102792237"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            micro-app å¾®å‰ç«¯é¡¹ç›®éƒ¨ç½²æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1425415102792237/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RemHusband
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T07:41:42.000Z" title="Sat Feb 07 2026 07:41:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">éƒ¨ç½²æŒ‡å—</h2>
<p>æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•å°† <a href="https://juejin.cn/post/7603567912593424411" target="_blank" title="https://juejin.cn/post/7603567912593424411">micro-app å¾®å‰ç«¯é¡¹ç›®</a>éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚</p>
<h3 data-id="heading-1">ç›®å½•</h3>
<ul>
<li><a href="#%E9%83%A8%E7%BD%B2%E6%96%B9%E5%BC%8F" title="#%E9%83%A8%E7%BD%B2%E6%96%B9%E5%BC%8F">éƒ¨ç½²æ–¹å¼</a></li>
<li><a href="#%E5%90%8C%E5%9F%9F%E9%83%A8%E7%BD%B2" title="#%E5%90%8C%E5%9F%9F%E9%83%A8%E7%BD%B2">åŒåŸŸéƒ¨ç½²</a></li>
<li><a href="#%E8%B7%A8%E5%9F%9F%E9%83%A8%E7%BD%B2" title="#%E8%B7%A8%E5%9F%9F%E9%83%A8%E7%BD%B2">è·¨åŸŸéƒ¨ç½²</a></li>
<li><a href="#nginx-%E9%85%8D%E7%BD%AE" title="#nginx-%E9%85%8D%E7%BD%AE">Nginx é…ç½®</a></li>
<li><a href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE" title="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE">ç¯å¢ƒå˜é‡é…ç½®</a></li>
<li><a href="#%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2%E6%AD%A5%E9%AA%A4" title="#%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2%E6%AD%A5%E9%AA%A4">æ„å»ºå’Œéƒ¨ç½²æ­¥éª¤</a></li>
<li><a href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98" title="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98">å¸¸è§é—®é¢˜</a></li>
</ul>
<hr/>
<h3 data-id="heading-2">éƒ¨ç½²æ–¹å¼</h3>
<p>micro-app å¾®å‰ç«¯é¡¹ç›®æ”¯æŒä¸¤ç§éƒ¨ç½²æ–¹å¼ï¼š</p>
<ol>
<li>
<p><strong>åŒåŸŸéƒ¨ç½²</strong>ï¼šä¸»åº”ç”¨å’Œæ‰€æœ‰å­åº”ç”¨éƒ¨ç½²åœ¨åŒä¸€åŸŸåä¸‹</p>
<ul>
<li>ä¼˜ç‚¹ï¼šæ— éœ€é…ç½® CORSï¼Œéƒ¨ç½²ç®€å•</li>
<li>ç¼ºç‚¹ï¼šæ‰€æœ‰åº”ç”¨å¿…é¡»éƒ¨ç½²åœ¨åŒä¸€æœåŠ¡å™¨</li>
</ul>
</li>
<li>
<p><strong>è·¨åŸŸéƒ¨ç½²</strong>ï¼šä¸»åº”ç”¨å’Œå­åº”ç”¨éƒ¨ç½²åœ¨ä¸åŒåŸŸå</p>
<ul>
<li>ä¼˜ç‚¹ï¼šå¯ä»¥ç‹¬ç«‹éƒ¨ç½²å’Œæ‰©å±•</li>
<li>ç¼ºç‚¹ï¼šéœ€è¦é…ç½® CORSï¼Œé…ç½®ç›¸å¯¹å¤æ‚</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-3">åŒåŸŸéƒ¨ç½²</h3>
<h4 data-id="heading-4">ç›®å½•ç»“æ„</h4>
<pre><code class="hljs language-bash" lang="bash">/usr/share/nginx/html/
â”œâ”€â”€ main-app/
â”‚   â””â”€â”€ dist/          <span class="hljs-comment"># ä¸»åº”ç”¨æ„å»ºäº§ç‰©</span>
â”œâ”€â”€ sub-app-1/
â”‚   â””â”€â”€ dist/          <span class="hljs-comment"># å­åº”ç”¨ 1 æ„å»ºäº§ç‰©</span>
â”œâ”€â”€ sub-app-2/
â”‚   â””â”€â”€ dist/          <span class="hljs-comment"># å­åº”ç”¨ 2 æ„å»ºäº§ç‰©</span>
â””â”€â”€ sub-app-3/
    â””â”€â”€ dist/          <span class="hljs-comment"># å­åº”ç”¨ 3 æ„å»ºäº§ç‰©</span>
</code></pre>
<h4 data-id="heading-5">URL æ˜ å°„</h4>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">https:</span>//example.com/              â†’ ä¸»åº”ç”¨
<span class="hljs-symbol">https:</span>//example.com/<span class="hljs-keyword">sub</span>-app-<span class="hljs-number">1</span>/    â†’ å­åº”ç”¨ <span class="hljs-number">1</span>
<span class="hljs-symbol">https:</span>//example.com/<span class="hljs-keyword">sub</span>-app-<span class="hljs-number">2</span>/    â†’ å­åº”ç”¨ <span class="hljs-number">2</span>
<span class="hljs-symbol">https:</span>//example.com/<span class="hljs-keyword">sub</span>-app-<span class="hljs-number">3</span>/    â†’ å­åº”ç”¨ <span class="hljs-number">3</span>
</code></pre>
<h4 data-id="heading-6">Nginx é…ç½®</h4>
<p>ä½¿ç”¨ <code>nginx/main-app.conf</code> é…ç½®æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¤åˆ¶é…ç½®æ–‡ä»¶</span>
sudo <span class="hljs-built_in">cp</span> nginx/main-app.conf /etc/nginx/sites-available/micro-app

<span class="hljs-comment"># åˆ›å»ºç¬¦å·é“¾æ¥</span>
sudo <span class="hljs-built_in">ln</span> -s /etc/nginx/sites-available/micro-app /etc/nginx/sites-enabled/

<span class="hljs-comment"># ä¿®æ”¹é…ç½®ä¸­çš„è·¯å¾„å’ŒåŸŸå</span>
sudo nano /etc/nginx/sites-available/micro-app

<span class="hljs-comment"># æµ‹è¯•é…ç½®</span>
sudo nginx -t

<span class="hljs-comment"># é‡è½½é…ç½®</span>
sudo nginx -s reload
</code></pre>
<h4 data-id="heading-7">ç¯å¢ƒå˜é‡é…ç½®</h4>
<p><strong>ä¸»åº”ç”¨ <code>.env.production</code></strong>:</p>
<pre><code class="hljs language-env" lang="env"># åŒåŸŸéƒ¨ç½²ä¸éœ€è¦é…ç½®ï¼Œè‡ªåŠ¨ä½¿ç”¨ window.location.origin
# VITE_DEPLOY_MODE=same-origin  # é»˜è®¤å€¼ï¼Œå¯çœç•¥
</code></pre>
<hr/>
<h3 data-id="heading-8">è·¨åŸŸéƒ¨ç½²</h3>
<h4 data-id="heading-9">ç›®å½•ç»“æ„</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¸»åº”ç”¨æœåŠ¡å™¨</span>
/usr/share/nginx/html/main-app/dist/

<span class="hljs-comment"># å­åº”ç”¨ 1 æœåŠ¡å™¨</span>
/usr/share/nginx/html/sub-app-1/dist/

<span class="hljs-comment"># å­åº”ç”¨ 2 æœåŠ¡å™¨</span>
/usr/share/nginx/html/sub-app-2/dist/

<span class="hljs-comment"># å­åº”ç”¨ 3 æœåŠ¡å™¨</span>
/usr/share/nginx/html/sub-app-3/dist/
</code></pre>
<h4 data-id="heading-10">URL æ˜ å°„</h4>
<pre><code class="hljs language-arduino" lang="arduino">https:<span class="hljs-comment">//main.example.com/        â†’ ä¸»åº”ç”¨</span>
https:<span class="hljs-comment">//sub1.example.com/         â†’ å­åº”ç”¨ 1</span>
https:<span class="hljs-comment">//sub2.example.com/         â†’ å­åº”ç”¨ 2</span>
https:<span class="hljs-comment">//sub3.example.com/         â†’ å­åº”ç”¨ 3</span>
</code></pre>
<h4 data-id="heading-11">Nginx é…ç½®</h4>
<p><strong>ä¸»åº”ç”¨æœåŠ¡å™¨</strong>ï¼šä½¿ç”¨ <code>nginx/main-app.conf</code>ï¼ˆä»…é…ç½®ä¸»åº”ç”¨éƒ¨åˆ†ï¼‰</p>
<p><strong>å­åº”ç”¨æœåŠ¡å™¨</strong>ï¼šæ¯ä¸ªå­åº”ç”¨ä½¿ç”¨ <code>nginx/sub-app.conf</code>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¸ºæ¯ä¸ªå­åº”ç”¨å¤åˆ¶é…ç½®æ–‡ä»¶</span>
sudo <span class="hljs-built_in">cp</span> nginx/sub-app.conf /etc/nginx/sites-available/sub-app-1
sudo <span class="hljs-built_in">cp</span> nginx/sub-app.conf /etc/nginx/sites-available/sub-app-2
sudo <span class="hljs-built_in">cp</span> nginx/sub-app.conf /etc/nginx/sites-available/sub-app-3

<span class="hljs-comment"># åˆ›å»ºç¬¦å·é“¾æ¥</span>
sudo <span class="hljs-built_in">ln</span> -s /etc/nginx/sites-available/sub-app-1 /etc/nginx/sites-enabled/
sudo <span class="hljs-built_in">ln</span> -s /etc/nginx/sites-available/sub-app-2 /etc/nginx/sites-enabled/
sudo <span class="hljs-built_in">ln</span> -s /etc/nginx/sites-available/sub-app-3 /etc/nginx/sites-enabled/

<span class="hljs-comment"># ä¿®æ”¹æ¯ä¸ªé…ç½®æ–‡ä»¶ä¸­çš„ server_name å’Œè·¯å¾„</span>
sudo nano /etc/nginx/sites-available/sub-app-1
sudo nano /etc/nginx/sites-available/sub-app-2
sudo nano /etc/nginx/sites-available/sub-app-3

<span class="hljs-comment"># æµ‹è¯•é…ç½®</span>
sudo nginx -t

<span class="hljs-comment"># é‡è½½é…ç½®</span>
sudo nginx -s reload
</code></pre>
<p><strong>é‡è¦</strong>ï¼šå­åº”ç”¨å¿…é¡»é…ç½® CORS å¤´ï¼Œå¦åˆ™ micro-app æ— æ³•åŠ è½½ã€‚</p>
<h4 data-id="heading-12">ç¯å¢ƒå˜é‡é…ç½®</h4>
<p><strong>ä¸»åº”ç”¨ <code>.env.production</code></strong>:</p>
<pre><code class="hljs language-env" lang="env"># è·¨åŸŸéƒ¨ç½²æ¨¡å¼
VITE_DEPLOY_MODE=cross-origin

# å­åº”ç”¨å…¥å£åœ°å€
VITE_SUB_APP_1_ENTRY=https://sub1.example.com
VITE_SUB_APP_2_ENTRY=https://sub2.example.com
VITE_SUB_APP_3_ENTRY=https://sub3.example.com
</code></pre>
<hr/>
<h3 data-id="heading-13">Nginx é…ç½®</h3>
<h4 data-id="heading-14">ä¸»åº”ç”¨é…ç½®</h4>
<p>å‚è€ƒ <code>nginx/main-app.conf</code>ï¼Œä¸»è¦é…ç½®ï¼š</p>
<ol>
<li><strong>æ ¹è·¯å¾„</strong>ï¼šä¸»åº”ç”¨éƒ¨ç½²åœ¨æ ¹è·¯å¾„ <code>/</code></li>
<li><strong>å­åº”ç”¨è·¯å¾„</strong>ï¼šæ¯ä¸ªå­åº”ç”¨éƒ¨ç½²åœ¨ <code>/sub-app-X/</code> è·¯å¾„ä¸‹</li>
<li><strong>è·¯ç”±å›é€€</strong>ï¼šä½¿ç”¨ <code>try_files</code> ç¡®ä¿ SPA è·¯ç”±æ­£å¸¸å·¥ä½œ</li>
<li><strong>é™æ€èµ„æºç¼“å­˜</strong>ï¼šé…ç½®é•¿æœŸç¼“å­˜ç­–ç•¥</li>
</ol>
<h4 data-id="heading-15">å­åº”ç”¨é…ç½®</h4>
<p>å‚è€ƒ <code>nginx/sub-app.conf</code>ï¼Œä¸»è¦é…ç½®ï¼š</p>
<ol>
<li><strong>CORS å¤´</strong>ï¼šå¿…é¡»é…ç½®ï¼Œmicro-app éœ€è¦è·¨åŸŸæ”¯æŒ</li>
<li><strong>OPTIONS é¢„æ£€</strong>ï¼šå¤„ç†è·¨åŸŸé¢„æ£€è¯·æ±‚</li>
<li><strong>è·¯ç”±å›é€€</strong>ï¼šä½¿ç”¨ <code>try_files</code> ç¡®ä¿ SPA è·¯ç”±æ­£å¸¸å·¥ä½œ</li>
<li><strong>é™æ€èµ„æºç¼“å­˜</strong>ï¼šé…ç½®é•¿æœŸç¼“å­˜ç­–ç•¥</li>
</ol>
<h4 data-id="heading-16">å…³é”®é…ç½®è¯´æ˜</h4>
<p><strong>CORS é…ç½®ï¼ˆå­åº”ç”¨å¿…é¡»ï¼‰</strong>:</p>
<pre><code class="hljs language-nginx" lang="nginx">add_header Access-Control-Allow-Origin * always;
add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS, PUT, DELETE' always;
add_header Access-Control-Allow-Headers 'Content-Type, Authorization, X-Requested-With' always;
</code></pre>
<p><strong>è·¯ç”±å›é€€ï¼ˆSPA å¿…éœ€ï¼‰</strong>:</p>
<pre><code class="hljs language-nginx" lang="nginx">location / {
    try_files $uri $uri/ /index.html;
}
</code></pre>
<p><strong>é™æ€èµ„æºç¼“å­˜</strong>:</p>
<pre><code class="hljs language-nginx" lang="nginx">location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}
</code></pre>
<hr/>
<h3 data-id="heading-17">ç¯å¢ƒå˜é‡é…ç½®</h3>
<h4 data-id="heading-18">å¼€å‘ç¯å¢ƒ</h4>
<p><strong>ä¸»åº”ç”¨ <code>.env.development</code></strong>:</p>
<pre><code class="hljs language-env" lang="env"># é€šå¸¸ä¸éœ€è¦ä¿®æ”¹ï¼Œä½¿ç”¨é»˜è®¤çš„ localhost åœ°å€
</code></pre>
<p><strong>å­åº”ç”¨ <code>.env.development</code></strong>:</p>
<pre><code class="hljs language-env" lang="env"># æ ¹æ®å®é™…éœ€æ±‚é…ç½®
# VITE_API_BASE_URL=http://localhost:8080/api
</code></pre>
<h4 data-id="heading-19">ç”Ÿäº§ç¯å¢ƒ</h4>
<p><strong>åŒåŸŸéƒ¨ç½²</strong>:</p>
<p><strong>ä¸»åº”ç”¨ <code>.env.production</code></strong>:</p>
<pre><code class="hljs language-env" lang="env"># ä¸éœ€è¦é…ç½®ï¼Œè‡ªåŠ¨ä½¿ç”¨ window.location.origin
</code></pre>
<p><strong>è·¨åŸŸéƒ¨ç½²</strong>:</p>
<p><strong>ä¸»åº”ç”¨ <code>.env.production</code></strong>:</p>
<pre><code class="hljs language-env" lang="env">VITE_DEPLOY_MODE=cross-origin
VITE_SUB_APP_1_ENTRY=https://sub1.example.com
VITE_SUB_APP_2_ENTRY=https://sub2.example.com
VITE_SUB_APP_3_ENTRY=https://sub3.example.com
</code></pre>
<p><strong>å­åº”ç”¨ <code>.env.production</code></strong>:</p>
<pre><code class="hljs language-env" lang="env"># æ ¹æ®å®é™…éœ€æ±‚é…ç½®
# VITE_API_BASE_URL=https://api.example.com
</code></pre>
<hr/>
<h3 data-id="heading-20">æ„å»ºå’Œéƒ¨ç½²æ­¥éª¤</h3>
<h4 data-id="heading-21">1. æ„å»ºæ‰€æœ‰åº”ç”¨</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ</span>
pnpm run build
</code></pre>
<p>æ„å»ºäº§ç‰©ä¼šç”Ÿæˆåœ¨ï¼š</p>
<ul>
<li><code>main-app/dist/</code></li>
<li><code>sub-app-1/dist/</code></li>
<li><code>sub-app-2/dist/</code></li>
<li><code>sub-app-3/dist/</code></li>
</ul>
<h4 data-id="heading-22">2. é…ç½®ç¯å¢ƒå˜é‡</h4>
<p>æ ¹æ®éƒ¨ç½²æ–¹å¼é…ç½® <code>.env.production</code> æ–‡ä»¶ï¼ˆè§ä¸Šæ–‡ï¼‰ã€‚</p>
<h4 data-id="heading-23">3. ä¸Šä¼ æ„å»ºäº§ç‰©</h4>
<p><strong>åŒåŸŸéƒ¨ç½²</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¸Šä¼ æ‰€æœ‰æ„å»ºäº§ç‰©åˆ°åŒä¸€æœåŠ¡å™¨</span>
scp -r main-app/dist/* user@server:/usr/share/nginx/html/main-app/dist/
scp -r sub-app-1/dist/* user@server:/usr/share/nginx/html/sub-app-1/dist/
scp -r sub-app-2/dist/* user@server:/usr/share/nginx/html/sub-app-2/dist/
scp -r sub-app-3/dist/* user@server:/usr/share/nginx/html/sub-app-3/dist/
</code></pre>
<p><strong>è·¨åŸŸéƒ¨ç½²</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¸»åº”ç”¨</span>
scp -r main-app/dist/* user@main-server:/usr/share/nginx/html/main-app/dist/

<span class="hljs-comment"># å­åº”ç”¨ 1</span>
scp -r sub-app-1/dist/* user@sub1-server:/usr/share/nginx/html/sub-app-1/dist/

<span class="hljs-comment"># å­åº”ç”¨ 2</span>
scp -r sub-app-2/dist/* user@sub2-server:/usr/share/nginx/html/sub-app-2/dist/

<span class="hljs-comment"># å­åº”ç”¨ 3</span>
scp -r sub-app-3/dist/* user@sub3-server:/usr/share/nginx/html/sub-app-3/dist/
</code></pre>
<h4 data-id="heading-24">4. é…ç½® Nginx</h4>
<p>å‚è€ƒ <a href="#nginx-%E9%85%8D%E7%BD%AE" title="#nginx-%E9%85%8D%E7%BD%AE">Nginx é…ç½®</a> éƒ¨åˆ†ã€‚</p>
<h4 data-id="heading-25">5. æµ‹è¯•éƒ¨ç½²</h4>
<ol>
<li>è®¿é—®ä¸»åº”ç”¨ï¼š<code>https://example.com</code></li>
<li>æ£€æŸ¥å­åº”ç”¨åŠ è½½æ˜¯å¦æ­£å¸¸</li>
<li>æ£€æŸ¥è·¯ç”±è·³è½¬æ˜¯å¦æ­£å¸¸</li>
<li>æ£€æŸ¥æ•°æ®é€šä¿¡æ˜¯å¦æ­£å¸¸</li>
<li>æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯</li>
</ol>
<hr/>
<h3 data-id="heading-26">å¸¸è§é—®é¢˜</h3>
<h4 data-id="heading-27">Q1: å­åº”ç”¨åŠ è½½å¤±è´¥ï¼Œæ˜¾ç¤º CORS é”™è¯¯ï¼Ÿ</h4>
<p><strong>A</strong>: æ£€æŸ¥å­åº”ç”¨çš„ Nginx é…ç½®æ˜¯å¦åŒ…å« CORS å¤´ï¼š</p>
<pre><code class="hljs language-nginx" lang="nginx">add_header Access-Control-Allow-Origin * always;
add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS' always;
</code></pre>
<h4 data-id="heading-28">Q2: è·¯ç”±è·³è½¬åæ˜¾ç¤º 404ï¼Ÿ</h4>
<p><strong>A</strong>: æ£€æŸ¥ Nginx é…ç½®æ˜¯å¦åŒ…å«è·¯ç”±å›é€€ï¼š</p>
<pre><code class="hljs language-nginx" lang="nginx">location / {
    try_files $uri $uri/ /index.html;
}
</code></pre>
<h4 data-id="heading-29">Q3: é™æ€èµ„æºåŠ è½½å¤±è´¥ï¼Ÿ</h4>
<p><strong>A</strong>: æ£€æŸ¥ï¼š</p>
<ol>
<li>èµ„æºè·¯å¾„æ˜¯å¦æ­£ç¡®</li>
<li>Nginx é…ç½®ä¸­çš„ <code>alias</code> è·¯å¾„æ˜¯å¦æ­£ç¡®</li>
<li>æ–‡ä»¶æƒé™æ˜¯å¦æ­£ç¡®</li>
</ol>
<h4 data-id="heading-30">Q4: ç”Ÿäº§ç¯å¢ƒå­åº”ç”¨åœ°å€ä¸æ­£ç¡®ï¼Ÿ</h4>
<p><strong>A</strong>: æ£€æŸ¥ä¸»åº”ç”¨çš„ <code>.env.production</code> é…ç½®ï¼š</p>
<pre><code class="hljs language-env" lang="env"># è·¨åŸŸéƒ¨ç½²
VITE_DEPLOY_MODE=cross-origin
VITE_SUB_APP_1_ENTRY=https://sub1.example.com
</code></pre>
<h4 data-id="heading-31">Q5: å¦‚ä½•å¯ç”¨ HTTPSï¼Ÿ</h4>
<p><strong>A</strong>: å‚è€ƒ Nginx é…ç½®æ–‡ä»¶ä¸­çš„ HTTPS é…ç½®ç¤ºä¾‹ï¼š</p>
<ol>
<li>è·å– SSL è¯ä¹¦</li>
<li>é…ç½®è¯ä¹¦è·¯å¾„</li>
<li>å¯ç”¨ HTTPS server å—</li>
<li>é…ç½® HTTP é‡å®šå‘åˆ° HTTPS</li>
</ol>
<h4 data-id="heading-32">Q6: å¦‚ä½•é…ç½® CDNï¼Ÿ</h4>
<p><strong>A</strong>: ä¿®æ”¹ç¯å¢ƒå˜é‡ä¸­çš„å…¥å£åœ°å€ä¸º CDN åœ°å€ï¼š</p>
<pre><code class="hljs language-env" lang="env">VITE_SUB_APP_1_ENTRY=https://cdn.example.com/sub-app-1
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Shadcnç»„ä»¶åº“çš„ç»ˆæè¿›åŒ–ï¼React+Viteå…¨é€Ÿé©±åŠ¨ï¼ŒAnt-Designæ‰©å±•ç»„ä»¶+å¤§å±å¯è§†åŒ–æ–¹æ¡ˆä¸€ç½‘æ‰“å°½ğŸ¯]]></title>    <link>https://juejin.cn/post/7603587738161135679</link>    <guid>https://juejin.cn/post/7603587738161135679</guid>    <pubDate>2026-02-07T05:53:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603587738161135679" data-draft-id="7603581886150443062" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Shadcnç»„ä»¶åº“çš„ç»ˆæè¿›åŒ–ï¼React+Viteå…¨é€Ÿé©±åŠ¨ï¼ŒAnt-Designæ‰©å±•ç»„ä»¶+å¤§å±å¯è§†åŒ–æ–¹æ¡ˆä¸€ç½‘æ‰“å°½ğŸ¯"/> <meta itemprop="keywords" content="React.js,å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-07T05:53:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç‹‚é£ä¹‹åŠ›"/> <meta itemprop="url" content="https://juejin.cn/user/4388906150688894"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Shadcnç»„ä»¶åº“çš„ç»ˆæè¿›åŒ–ï¼React+Viteå…¨é€Ÿé©±åŠ¨ï¼ŒAnt-Designæ‰©å±•ç»„ä»¶+å¤§å±å¯è§†åŒ–æ–¹æ¡ˆä¸€ç½‘æ‰“å°½ğŸ¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4388906150688894/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç‹‚é£ä¹‹åŠ›
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T05:53:21.000Z" title="Sat Feb 07 2026 05:53:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">vite-shadcn</h2>
<p>VITE-SHADCN æ˜¯ä¸€ä¸ªåŸºäº <code>Shadcn</code> , <code>Vite</code> , <code>React</code>,<code>Zustand</code>,<code>React-Router</code> ç­‰æ„å»ºçš„é¡¹ç›® ã€‚å·²ç»å‚ç…§ant-designæ‰©å±•ç»„ä»¶æ‰©å±•äº†shadcnå¤§é‡shadcnç¼ºå°‘çš„ç»„ä»¶ã€‚å¹¶ä¸”å®ç°äº†å„ç§å¤§å±ä»¥åŠå¯è§†åŒ–æ–¹æ¡ˆã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd2097f2c7414067a980f12d85b7836b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54uC6aOO5LmL5Yqb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771048403&amp;x-signature=73GbQMGqSpt152Cr1%2BcYo5d5oUc%3D" alt="dashboard-zh-CN.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/455571d72f0b4b1b92f279a580ccb797~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54uC6aOO5LmL5Yqb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771048403&amp;x-signature=%2B0wsxxMaa1ZIDMiVjHZeZtwOmbc%3D" alt="disaster-command-zh-CN.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5a8cb37251947f1b8317c45cf48e80b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54uC6aOO5LmL5Yqb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771048403&amp;x-signature=3QF2wI4bf7lFYpuLmDkzNL03LDI%3D" alt="rechart-zh-CN.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7691d7b468c040e3b3f0ba4bc9f44763~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54uC6aOO5LmL5Yqb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771048403&amp;x-signature=dKwAtkZ6Z%2FrB2GHrl8%2B19lN7yyM%3D" alt="dashboard-zh-CN.png" loading="lazy"/></p>
<p>ä»“åº“åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyluiop123%2Fvite-shadcn" target="_blank" title="https://github.com/yluiop123/vite-shadcn" ref="nofollow noopener noreferrer">github.com/yluiop123/vâ€¦</a></p>
<p>é¡¹ç›®è®¿é—®åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fyluiop123.github.io%2Fvite-shadcn" target="_blank" title="https://yluiop123.github.io/vite-shadcn" ref="nofollow noopener noreferrer">yluiop123.github.io/vite-shadcn</a></p>
<h3 data-id="heading-1">âœ… ä»»åŠ¡æ¸…å•</h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> åˆå§‹åŒ–é¡¹ç›®</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> é…ç½® Vite + React + TypeScript + React-Router + Zustand + Axios + MSW +ShadCN ç¯å¢ƒ</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> åŠ¨æ€æƒé™è·¯ç”±åŠ è½½</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> å›½é™…åŒ–ã€ä¸»é¢˜è‰²åˆ‡æ¢ã€æš—é»‘æ¨¡å¼</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> å¤šå¸ƒå±€</li>
</ul>
<details>
<summary>ç™»å½•å’Œè·¯ç”±æƒé™æ§åˆ¶</summary>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> ç™»å½•åŠŸèƒ½</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> è·¯ç”±æƒé™æ§åˆ¶</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> è§’è‰²åˆ‡æ¢ï¼ˆæ”¯æŒèåˆæ¨¡å¼ï¼‰</li>
</ul>
</details>
<details>
<summary>ä»ªè¡¨ç›˜</summary>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> åŸºæœ¬ä»ªè¡¨ç›˜</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> æ€åŠ¿æ„ŸçŸ¥-ç½‘ç»œå®‰å…¨</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> æ€åŠ¿æ„ŸçŸ¥-å†›äº‹</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> ç¾æƒ…æŒ‡æŒ¥</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> å†œæ—ä¸šç®¡ç†</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> å·¥ä¸šç®¡ç†</li>
</ul>
</details>
<details>
<summary>ç»„ä»¶åº“</summary>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> æ™®é€šç»„ä»¶</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> å¸ƒå±€ç»„ä»¶</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> å¯¼èˆªç»„ä»¶</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> æ•°æ®å±•ç¤ºç»„ä»¶</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> åé¦ˆç»„ä»¶</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> react-hook-form è¡¨å•ç»„ä»¶</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> tanstack/react-table è¡¨æ ¼ç»„ä»¶</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> è‡ªå®šä¹‰ç»„ä»¶</li>
</ul>
</details>
<details>
<summary>å›¾è¡¨</summary>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> Rechart å›¾è¡¨ç»„ä»¶</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> Echart å›¾è¡¨ç»„ä»¶</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> D3 å›¾è¡¨ç»„ä»¶</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> Antv å›¾è¡¨ç»„ä»¶</li>
</ul>
</details>
<details>
<summary>ä¸‰ç»´</summary>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> Babylon</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> Three</li>
</ul>
</details>
<details>
<summary>åœ°å›¾</summary>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> Cesiumåœ°å›¾</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> Deckglåœ°å›¾</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> L7åœ°å›¾</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> Leafletåœ°å›¾</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> Openlayersåœ°å›¾</li>
</ul>
</details>
<details>
<summary>ç³»ç»Ÿç®¡ç†</summary>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> ç”¨æˆ·ç®¡ç†</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> è§’è‰²ç®¡ç†</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> æƒé™ç®¡ç†</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> ç»„ç»‡ç®¡ç†</li>
</ul>
</details>
<details>
<summary>åç«¯è§„åˆ’</summary>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> springbootå®ç°åç«¯æ¥å£</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> å®ç°å¾®æœåŠ¡</li>
</ul>
</details>
<h3 data-id="heading-2">å¿«é€Ÿå¼€å§‹</h3>
<h4 data-id="heading-3">1ï¼‰ç¯å¢ƒ</h4>
<ul>
<li><strong>Node.js</strong>: v18+</li>
<li><strong>pnpm</strong>: pnpm v10.28.2</li>
</ul>
<h4 data-id="heading-4">2ï¼‰æŠ€æœ¯æ ˆ</h4>
<ul>
<li><strong>æ¡†æ¶</strong>: React 19 + Vite6</li>
<li><strong>çŠ¶æ€ç®¡ç†</strong>: Zustand</li>
<li><strong>UI ç»„ä»¶åº“</strong>: ShadCN + TailwindCSS</li>
<li><strong>å›½é™…åŒ–</strong>: react-intl</li>
<li><strong>è·¯ç”±</strong>: React Router v7</li>
<li><strong>æ¥å£æ¨¡æ‹Ÿ</strong>: Mock Service Worker (MSW)</li>
<li><strong>æ„å»ºå·¥å…·</strong>: Vite6</li>
</ul>
<h4 data-id="heading-5">3ï¼‰å®‰è£…å¯åŠ¨</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å…‹éš†é¡¹ç›®</span>
git <span class="hljs-built_in">clone</span> https://github.com/yluiop123/vite-shadcn.git
<span class="hljs-built_in">cd</span> &lt;é¡¹ç›®ç›®å½•&gt;

<span class="hljs-comment"># å®‰è£…ä¾èµ–</span>
pnpm install   

<span class="hljs-comment"># æœ¬åœ°å¼€å‘å¯åŠ¨</span>
pnpm dev    

<span class="hljs-comment">#é¡¹ç›®å¯åŠ¨åè®¿é—® http://localhost:3000/   </span>
</code></pre>
<h4 data-id="heading-6">4ï¼‰å‘½ä»¤è¡Œ</h4>
<p>æˆ‘å°†ä¸ºæ‚¨æ›´æ–°è¡¨æ ¼ï¼Œæ·»åŠ è¯´æ˜åˆ—ï¼š</p>













































<table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>dev</td><td>vite</td><td>å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼Œæ”¯æŒçƒ­é‡è½½å’Œå®æ—¶ç¼–è¯‘</td></tr><tr><td>build</td><td>tsc -b &amp;&amp; vite build</td><td>æ„å»ºç”Ÿäº§ç‰ˆæœ¬ï¼Œå…ˆè¿›è¡Œ TypeScript ç±»å‹æ£€æŸ¥ï¼Œå†æ‰“åŒ…é¡¹ç›®</td></tr><tr><td>build:github</td><td>tsc -b &amp;&amp; vite build --mode github</td><td>æ„å»º GitHub éƒ¨ç½²ç‰ˆæœ¬ï¼Œä½¿ç”¨ç‰¹å®šçš„æ„å»ºé…ç½®</td></tr><tr><td>lint</td><td>eslint .</td><td>è¿è¡Œ ESLint æ£€æŸ¥ä»£ç è´¨é‡ï¼Œè¯†åˆ«æ½œåœ¨é—®é¢˜</td></tr><tr><td>preview</td><td>vite preview</td><td>é¢„è§ˆç”Ÿäº§æ„å»ºçš„é¡¹ç›®ï¼Œç”¨äºæœ¬åœ°æµ‹è¯•æ„å»ºç»“æœ</td></tr><tr><td>preview:github</td><td>vite preview --mode github</td><td>é¢„è§ˆ GitHub éƒ¨ç½²ç‰ˆæœ¬çš„æ„å»ºç»“æœ</td></tr><tr><td>analyze</td><td>cross-env ANALYZE=true vite build</td><td>åˆ†ææ‰“åŒ…ç»“æœï¼Œç”Ÿæˆ bundle åˆ†ææŠ¥å‘Š</td></tr></tbody></table>
<h4 data-id="heading-7">5ï¼‰ç¯å¢ƒå˜é‡</h4>
<p>é¡¹ç›®é»˜è®¤ä½¿ç”¨ <code>.env</code> æ–‡ä»¶ä½œä¸ºç¯å¢ƒå˜é‡é…ç½®ã€‚å½“é€šè¿‡ <code>--mode</code> å‚æ•°æŒ‡å®šç‰¹å®šæ¨¡å¼æ—¶ï¼ŒVite ä¼šè‡ªåŠ¨åŠ è½½å¯¹åº”çš„ç¯å¢ƒå˜é‡æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œ<code>build:github</code> å‘½ä»¤ä¼šåŠ è½½ <code>.env.github</code> æ–‡ä»¶ä¸­çš„é…ç½®ã€‚</p>
<p>ä»¥ä¸‹æ˜¯å¸¸ç”¨çš„ç¯å¢ƒå˜é‡é…ç½®åŠå…¶è¯´æ˜ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">VITE_BASE</span>=/              <span class="hljs-comment"># é¡¹ç›®éƒ¨ç½²çš„ç›¸å¯¹è·¯å¾„ï¼Œç”¨äºæŒ‡å®šåº”ç”¨çš„åŸºç¡€ URL</span>
<span class="hljs-attr">VITE_ROUTE</span>=browserRouter <span class="hljs-comment"># è·¯ç”±ç±»å‹ï¼Œå†³å®šåº”ç”¨ä½¿ç”¨çš„è·¯ç”±ç­–ç•¥</span>
<span class="hljs-attr">VITE_MOCK_ENABLE</span>=<span class="hljs-literal">true</span>    <span class="hljs-comment"># æ˜¯å¦å¯ç”¨ Mock æ•°æ®æœåŠ¡ï¼Œç”¨äºå¼€å‘å’Œæµ‹è¯•</span>
<span class="hljs-attr">VITE_BASE_API</span>=/api/      <span class="hljs-comment"># API è¯·æ±‚çš„ç»Ÿä¸€å‰ç¼€ï¼Œç”¨äºåç«¯æ¥å£è°ƒç”¨</span>
VITE_CESIUM_TOKEN=<span class="hljs-comment">###    # Cesium åœ°å›¾æœåŠ¡çš„è®¤è¯ä»¤ç‰Œ</span>
</code></pre>
<h3 data-id="heading-8">ç›®å½•ç»“æ„</h3>
<pre><code class="hljs language-csharp" lang="csharp">vite-shadcn
â”œâ”€â”€ .github/                     <span class="hljs-meta"># GitHub é…ç½®æ–‡ä»¶</span>
â”‚   â”œâ”€â”€ workflows/
â”‚   â”‚   â””â”€â”€ main.yml            <span class="hljs-meta"># CI/CD å·¥ä½œæµé…ç½®</span>
â”‚   â”œâ”€â”€ copilot-instructions.md  <span class="hljs-meta"># Copilot æŒ‡ä»¤</span>
â”œâ”€â”€ .trae/                       <span class="hljs-meta"># Trae IDE è§„åˆ™</span>
â”‚   â””â”€â”€ rules/
â”œâ”€â”€ <span class="hljs-keyword">public</span>/                      <span class="hljs-meta"># é™æ€èµ„æºç›®å½•</span>
â”œâ”€â”€ src/                         <span class="hljs-meta"># æºä»£ç ç›®å½•</span>
â”‚   â”œâ”€â”€ assets/                  <span class="hljs-meta"># é™æ€èµ„æº</span>
â”‚   â”œâ”€â”€ components/              <span class="hljs-meta"># é€šç”¨ç»„ä»¶</span>
â”‚   â”‚   â”œâ”€â”€ ext/                 <span class="hljs-meta"># æ‰©å±•ç»„ä»¶</span>
â”‚   â”‚   â”œâ”€â”€ ui/                  <span class="hljs-meta"># Shadcn UI åŸºç¡€ç»„ä»¶</span>
â”‚   â”‚   â”œâ”€â”€ app-sidebar.tsx      <span class="hljs-meta"># åº”ç”¨ä¾§è¾¹æ </span>
â”‚   â”‚   â”œâ”€â”€ chart-area-interactive.tsx <span class="hljs-meta"># äº¤äº’å¼é¢ç§¯å›¾</span>
â”‚   â”‚   â”œâ”€â”€ color-switcher.tsx   <span class="hljs-meta"># é¢œè‰²åˆ‡æ¢å™¨</span>
â”‚   â”‚   â”œâ”€â”€ dialog-form.tsx      <span class="hljs-meta"># è¡¨å•å¯¹è¯æ¡†</span>
â”‚   â”‚   â”œâ”€â”€ <span class="hljs-keyword">group</span>-tree-<span class="hljs-keyword">select</span>.tsx <span class="hljs-meta"># åˆ†ç»„æ ‘é€‰æ‹©å™¨</span>
â”‚   â”‚   â”œâ”€â”€ nav-main.tsx         <span class="hljs-meta"># ä¸»å¯¼èˆª</span>
â”‚   â”‚   â”œâ”€â”€ nav-user.tsx         <span class="hljs-meta"># ç”¨æˆ·å¯¼èˆª</span>
â”‚   â”‚   â”œâ”€â”€ permission-tree-<span class="hljs-keyword">select</span>.tsx <span class="hljs-meta"># æƒé™æ ‘é€‰æ‹©å™¨</span>
â”‚   â”‚   â”œâ”€â”€ permission-tree-single-<span class="hljs-keyword">select</span>.tsx <span class="hljs-meta"># æƒé™å•é€‰æ ‘</span>
â”‚   â”‚   â”œâ”€â”€ permission-type.tsx  <span class="hljs-meta"># æƒé™ç±»å‹</span>
â”‚   â”‚   â”œâ”€â”€ role-<span class="hljs-keyword">select</span>.tsx      <span class="hljs-meta"># è§’è‰²é€‰æ‹©å™¨</span>
â”‚   â”‚   â”œâ”€â”€ section-cards.tsx    <span class="hljs-meta"># åŒºåŸŸå¡ç‰‡</span>
â”‚   â”‚   â”œâ”€â”€ sidebar-menutree.tsx <span class="hljs-meta"># ä¾§è¾¹æ èœå•æ ‘</span>
â”‚   â”‚   â”œâ”€â”€ site-header.tsx      <span class="hljs-meta"># ç«™ç‚¹å¤´éƒ¨</span>
â”‚   â”‚   â””â”€â”€ ...                  <span class="hljs-meta"># æ›´å¤šç»„ä»¶</span>
â”‚   â”œâ”€â”€ hooks/                   <span class="hljs-meta"># React Hooks</span>
â”‚   â”‚   â””â”€â”€ use-mobile.ts        <span class="hljs-meta"># ç§»åŠ¨ç«¯æ£€æµ‹ Hook</span>
â”‚   â”œâ”€â”€ lib/                     <span class="hljs-meta"># å·¥å…·åº“</span>
â”‚   â”‚   â”œâ”€â”€ axios.ts             <span class="hljs-meta"># Axios é…ç½®</span>
â”‚   â”‚   â”œâ”€â”€ dict.ts              <span class="hljs-meta"># å­—å…¸å·¥å…·</span>
â”‚   â”‚   â”œâ”€â”€ fixLeafletIcon.ts    <span class="hljs-meta"># Leaflet å›¾æ ‡ä¿®å¤</span>
â”‚   â”‚   â”œâ”€â”€ notify.ts            <span class="hljs-meta"># é€šçŸ¥å·¥å…·</span>
â”‚   â”‚   â””â”€â”€ utils.ts             <span class="hljs-meta"># é€šç”¨å·¥å…·å‡½æ•°</span>
â”‚   â”œâ”€â”€ locale/                  <span class="hljs-meta"># å›½é™…åŒ–</span>
â”‚   â”‚   â”œâ”€â”€ en-US.ts             <span class="hljs-meta"># è‹±æ–‡ç¿»è¯‘</span>
â”‚   â”‚   â””â”€â”€ zh-CN.ts             <span class="hljs-meta"># ä¸­æ–‡ç¿»è¯‘</span>
â”‚   â”œâ”€â”€ mock/                    <span class="hljs-meta"># Mock æ•°æ®</span>
â”‚   â”œâ”€â”€ pages/                   <span class="hljs-meta"># é¡µé¢ç»„ä»¶</span>
â”‚   â”‚   â”œâ”€â”€ chart/               <span class="hljs-meta"># å›¾è¡¨é¡µé¢</span>
â”‚   â”‚   â”œâ”€â”€ component/           <span class="hljs-meta"># ç»„ä»¶ç¤ºä¾‹é¡µé¢</span>
â”‚   â”‚   â”œâ”€â”€ dashboard/           <span class="hljs-meta"># ä»ªè¡¨æ¿é¡µé¢</span>
â”‚   â”‚   â”œâ”€â”€ system/              <span class="hljs-meta"># ç³»ç»Ÿç®¡ç†é¡µé¢</span>
â”‚   â”œâ”€â”€ store/                   <span class="hljs-meta"># çŠ¶æ€ç®¡ç†</span>
â”‚   â”œâ”€â”€ themes/                  <span class="hljs-meta"># ä¸»é¢˜è‰²æ–‡ä»¶</span>
â”‚   â”œâ”€â”€ App.tsx                  <span class="hljs-meta"># åº”ç”¨æ ¹ç»„ä»¶</span>
â”‚   â”œâ”€â”€ index.css                <span class="hljs-meta"># å…¨å±€æ ·å¼</span>
â”‚   â”œâ”€â”€ layout.tsx               <span class="hljs-meta"># åº”ç”¨å¸ƒå±€</span>
â”‚   â””â”€â”€ main.tsx                 <span class="hljs-meta"># åº”ç”¨å…¥å£</span>
â”œâ”€â”€ .env                         <span class="hljs-meta"># ç¯å¢ƒå˜é‡</span>
â”œâ”€â”€ .env.github                  <span class="hljs-meta"># GitHub ç¯å¢ƒå˜é‡</span>
â”œâ”€â”€ .gitignore                   <span class="hljs-meta"># Git å¿½ç•¥æ–‡ä»¶</span>
â”œâ”€â”€ .hintrc                      <span class="hljs-meta"># Webhint é…ç½®</span>
â”œâ”€â”€ CODE_OF_CONDUCT.md           <span class="hljs-meta"># è¡Œä¸ºå‡†åˆ™</span>
â”œâ”€â”€ LICENSE                      <span class="hljs-meta"># è®¸å¯è¯</span>
â”œâ”€â”€ components.json              <span class="hljs-meta"># ç»„ä»¶é…ç½®</span>
â””â”€â”€ package.json                 <span class="hljs-meta"># é¡¹ç›®é…ç½®</span>
</code></pre>
<hr/>
<h3 data-id="heading-9">è·¯ç”±ä¸èœå•</h3>
<h4 data-id="heading-10">è·¯ç”±ç¤ºä¾‹ï¼ˆReact Router v7ï¼‰ï¼š</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">//src\routes.ts</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">routeSetting</span>: <span class="hljs-title class_">NavItem</span>[] = [
  {
    <span class="hljs-attr">key</span>: <span class="hljs-string">"dashboard"</span>,
    <span class="hljs-attr">title</span>: <span class="hljs-string">"menu.dashboard"</span>,
    <span class="hljs-attr">icon</span>: <span class="hljs-title class_">LayoutDashboard</span>,
    <span class="hljs-attr">children</span>: [
      { <span class="hljs-attr">key</span>: <span class="hljs-string">"normal"</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">"menu.dashboard.normal"</span>, <span class="hljs-attr">icon</span>: <span class="hljs-title class_">Gauge</span> },
    ],
  },
];
</code></pre>
<p>è·¯ç”±é…ç½®åŒ…å«å››ä¸ªæ ¸å¿ƒå‚æ•°ï¼š</p>
<ul>
<li><strong>key</strong>: è·¯ç”±è·¯å¾„æ ‡è¯†ç¬¦ï¼Œç”¨äºå”¯ä¸€ç¡®å®šå¯¼èˆªç›®æ ‡</li>
<li><strong>title</strong>: å›½é™…åŒ–é…ç½®é”®å€¼ï¼Œç”¨äºå¤šè¯­è¨€æ–‡æœ¬æ˜ å°„</li>
<li><strong>icon</strong>: èœå•å›¾æ ‡å…ƒç´ ï¼Œç”¨äºè§†è§‰æ ‡è¯†</li>
<li><strong>children</strong>: å­èœå•æ•°ç»„ï¼Œç”¨äºæ„å»ºåµŒå¥—å¯¼èˆªç»“æ„</li>
</ul>
<h4 data-id="heading-11">å¦‚ä¸‹ï¼Œæ˜¯å…¶ä¸­ä¸€ä¸ªé¡µé¢çš„é…ç½®ç¤ºä¾‹ï¼š</h4>
<ol>
<li>é…ç½®è·¯ç”±dashboard\normal</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">//src\routes.ts</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">routeSetting</span>: <span class="hljs-title class_">NavItem</span>[] = [
  {
    <span class="hljs-attr">key</span>: <span class="hljs-string">"dashboard"</span>,
    <span class="hljs-attr">title</span>: <span class="hljs-string">"menu.dashboard"</span>,
    <span class="hljs-attr">icon</span>: <span class="hljs-title class_">LayoutDashboard</span>,
    <span class="hljs-attr">children</span>: [
      { <span class="hljs-attr">key</span>: <span class="hljs-string">"normal"</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">"menu.dashboard.normal"</span>, <span class="hljs-attr">icon</span>: <span class="hljs-title class_">Gauge</span> },
    ],
  },
];
</code></pre>
<p>2.å›½å®¶åŒ–æ–‡ä»¶ä¸­é…ç½®titleä¸­çš„key</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">//src\locale\en-US.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-string">'menu.dashboard'</span>: <span class="hljs-string">'Dashboard'</span>,
    <span class="hljs-string">'menu.dashboard.normal'</span>: <span class="hljs-string">'Normal'</span>,
};
</code></pre>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">//src\locale\zh-CN.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-string">'menu.dashboard'</span>: <span class="hljs-string">'ä»ªè¡¨ç›˜'</span>,
    <span class="hljs-string">'menu.dashboard.normal'</span>: <span class="hljs-string">'æ™®é€šä»ªè¡¨ç›˜'</span>,
};
</code></pre>
<p>3.å¢åŠ é¡µé¢</p>
<p>src\pages\component\general\index.tsx</p>
<p>æ³¨æ„å¿…é¡»åœ¨index.tsxä¸‹ã€‚</p>
<p>4.mockæƒé™å¢åŠ </p>
<p>ä¸‹é¢è¿™æ®µæ¨¡æ‹Ÿçš„æ˜¯è·å–å½“å‰ç”¨æˆ·æƒé™ï¼Œéœ€è¦åœ¨è¿™æ®µä»£ç é‡Œå¢åŠ æ–°å¢èœå•çš„æƒé™ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">//src\mock\system\permission.ts</span>
    http.<span class="hljs-property">get</span>&lt;{ <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span> }&gt;(
    <span class="hljs-string">"/api/system/permissions/detail/:id"</span>,
</code></pre>
<p>å¯¹åº”çš„function æ˜¯getPermissionList</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">//src\mock\system\permission.ts</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getPermissionList</span>(<span class="hljs-params">locale: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-title class_">Permission</span>[] = [
            <span class="hljs-comment">//supper menu permissions</span>
            {<span class="hljs-attr">id</span>: <span class="hljs-string">'0000'</span>, <span class="hljs-attr">parentId</span>:<span class="hljs-string">''</span>,<span class="hljs-attr">order</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">"/dashboard"</span>,<span class="hljs-attr">type</span>: <span class="hljs-string">"directory"</span>,<span class="hljs-attr">name</span>:localeMap[locale][<span class="hljs-string">'menu.dashboard'</span>] },
            {<span class="hljs-attr">id</span>: <span class="hljs-string">'0001'</span>, <span class="hljs-attr">parentId</span>:<span class="hljs-string">''</span>,<span class="hljs-attr">order</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">"/component"</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">"menu"</span>,<span class="hljs-attr">name</span>:localeMap[locale][<span class="hljs-string">'menu.component'</span>] },
            {<span class="hljs-attr">id</span>: <span class="hljs-string">'000100'</span>, <span class="hljs-attr">parentId</span>:<span class="hljs-string">'0001'</span>,<span class="hljs-attr">order</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">"/component/general"</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">"menu"</span>,<span class="hljs-attr">name</span>:localeMap[locale][<span class="hljs-string">'menu.component.general'</span>] },
</code></pre>
<p><code>component/general</code>Â é¡µé¢å¯¹åº”çš„æƒé™æ ‡è¯†ä¸ºÂ <code>id: '000100'</code>ï¼Œå…¶ä¸­Â <code>type</code>Â å­—æ®µè¡¨ç¤ºæƒé™ç±»å‹ï¼š</p>
<ul>
<li><strong>directory</strong>: ç›®å½•æƒé™ï¼ŒåŒ…å«è¯¥ç›®å½•ä¸‹æ‰€æœ‰å­èœå•çš„è®¿é—®æƒé™</li>
<li><strong>menu</strong>: èœå•é¡¹æƒé™ï¼Œä»…æ§åˆ¶å½“å‰èœå•é¡¹çš„è®¿é—®æƒé™</li>
</ul>
<h3 data-id="heading-12">å›½é™…åŒ–</h3>
<h4 data-id="heading-13">é…ç½®ç¤ºä¾‹ï¼ˆreact-intlï¼‰ï¼š</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">//src\locale\en-US.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-string">'menu.dashboard'</span>: <span class="hljs-string">'Dashboard'</span>,
};
</code></pre>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">//src\locale\zh-CN.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-string">'menu.dashboard'</span>: <span class="hljs-string">'ä»ªè¡¨ç›˜'</span>,
};
</code></pre>
<h4 data-id="heading-14">é¡µé¢ä½¿ç”¨ç¤ºä¾‹ï¼š</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { useIntl } <span class="hljs-keyword">from</span> <span class="hljs-string">"react-intl"</span>;

<span class="hljs-keyword">const</span> { formatMessage } = <span class="hljs-title function_">useIntl</span>();
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{formatMessage({ id: "menu.dashboard", defaultMessage: "Dashboard" })}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
</code></pre>
<hr/>
<h3 data-id="heading-15">æ¨¡æ‹Ÿæ•°æ®</h3>
<p>é¡¹ç›®ä½¿ç”¨ MSW æ¨¡æ‹Ÿæ•°æ®ï¼Œmswçš„å¼•å…¥ä»£ç å¦‚ä¸‹</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">//src\main.tsx</span>
<span class="hljs-keyword">const</span> mockEnable = (<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">VITE_MOCK_ENABLE</span>||<span class="hljs-string">'true'</span>)==<span class="hljs-string">'true'</span>;
<span class="hljs-keyword">if</span>(mockEnable){
  <span class="hljs-title function_">initMSW</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">()=&gt;</span>{
    <span class="hljs-title function_">createRootElement</span>();
  })
}<span class="hljs-keyword">else</span>{
  <span class="hljs-title function_">createRootElement</span>();
}
</code></pre>
<p>mockæ•°æ®çš„å…¥å£åœ¨å¦‚ä¸‹æ–‡ä»¶ï¼Œå¦‚æœè¦æ–°å¢mockçš„è¯ï¼Œå‚ç…§å¦‚ä¸‹ä»£ç æ–°å¢ä¸€ä¸ªhandlerså°±è¡Œäº†</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">//src\mock\index.ts</span>
<span class="hljs-keyword">import</span> { setupWorker } <span class="hljs-keyword">from</span> <span class="hljs-string">"msw/browser"</span>;
<span class="hljs-keyword">import</span> groupHandlers <span class="hljs-keyword">from</span> <span class="hljs-string">"./components/group"</span>;
<span class="hljs-keyword">import</span> permissionHandlers <span class="hljs-keyword">from</span> <span class="hljs-string">"./components/permission"</span>;
<span class="hljs-keyword">import</span> loginUserHandlers <span class="hljs-keyword">from</span> <span class="hljs-string">"./login/user"</span>;
<span class="hljs-keyword">import</span> systemGroupHandlers <span class="hljs-keyword">from</span> <span class="hljs-string">"./system/group"</span>;
<span class="hljs-keyword">import</span> systemPermissionHandlers <span class="hljs-keyword">from</span> <span class="hljs-string">"./system/permission"</span>;
<span class="hljs-keyword">import</span> systemRoleHandlers <span class="hljs-keyword">from</span> <span class="hljs-string">"./system/role"</span>;
<span class="hljs-keyword">import</span> systemUserHandlers <span class="hljs-keyword">from</span> <span class="hljs-string">"./system/user"</span>;
<span class="hljs-keyword">const</span> mockHandlers = [
  ...loginUserHandlers,
  ...groupHandlers,
  ...permissionHandlers,
  ...systemUserHandlers,
  ...systemRoleHandlers,
  ...systemGroupHandlers,
  ...systemPermissionHandlers
];
<span class="hljs-keyword">let</span> <span class="hljs-attr">worker</span>: <span class="hljs-title class_">ReturnType</span>&lt;<span class="hljs-keyword">typeof</span> setupWorker&gt; | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">initMSW</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">if</span> (worker) <span class="hljs-keyword">return</span> worker;
  worker = <span class="hljs-title function_">setupWorker</span>(...mockHandlers);
  <span class="hljs-comment">// å¯åŠ¨ MSW</span>
  <span class="hljs-keyword">await</span> worker.<span class="hljs-title function_">start</span>({

    <span class="hljs-attr">serviceWorker</span>: {
      <span class="hljs-attr">url</span>: <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">import</span>.meta.env.BASE_URL}</span>mockServiceWorker.js`</span>,
      <span class="hljs-attr">options</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">'module'</span>, <span class="hljs-attr">updateViaCache</span>: <span class="hljs-string">'none'</span> },
    },
    <span class="hljs-attr">onUnhandledRequest</span>: <span class="hljs-function">(<span class="hljs-params">req</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (!req.<span class="hljs-property">url</span>.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'/api'</span>)) {
        <span class="hljs-keyword">return</span> <span class="hljs-comment">// ç›´æ¥è·³è¿‡ï¼Œä¸æ‹¦æˆª</span>
      }
    },
  });
  <span class="hljs-keyword">return</span> worker;
}
</code></pre>
<h3 data-id="heading-16">æƒé™æ§åˆ¶</h3>
<p>ç”¨æˆ·æƒé™ä»userInfoä¸­è·å–</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { useUserStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/store'</span>;
<span class="hljs-keyword">const</span> { userInfo} = <span class="hljs-title function_">useUserStore</span>();
</code></pre>
<p>ç³»ç»Ÿæƒé™ç®¡ç†åŒ…å«ä»¥ä¸‹æ¦‚å¿µï¼š</p>
<ul>
<li><strong>rolePermissions</strong>: è§’è‰²æƒé™é›†åˆï¼Œå®šä¹‰ç‰¹å®šè§’è‰²æ‰€æ‹¥æœ‰çš„æƒé™</li>
<li><strong>userPermissions</strong>: ç”¨æˆ·æƒé™é›†åˆï¼Œå®šä¹‰ç”¨æˆ·è´¦æˆ·çº§åˆ«çš„æƒé™</li>
<li><strong>currentPermission</strong>: å½“å‰ç”Ÿæ•ˆæƒé™ï¼Œä¸ºç”¨æˆ·æƒé™ä¸æ‰€é€‰è§’è‰²æƒé™çš„å¹¶é›†</li>
<li><strong>currentMenuPermission</strong>: å½“å‰èœå•æƒé™ï¼Œç”¨äºæ§åˆ¶å…·ä½“èœå•é¡¹çš„æ˜¾ç¤º</li>
<li><strong>currentDirectoryPermission</strong>: å½“å‰ç›®å½•æƒé™ï¼Œç”¨äºæ§åˆ¶ç›®å½•èŠ‚ç‚¹çš„æ˜¾ç¤ºï¼Œæ‹¥æœ‰ç›®å½•æƒé™æ—¶è‡ªåŠ¨è·å¾—å…¶ä¸‹æ‰€æœ‰å­èœå•æƒé™</li>
</ul>
<p>ç³»ç»Ÿæ”¯æŒå¤šè§’è‰²ç®¡ç†æ¨¡å¼ã€‚å½“ç”¨æˆ·é€‰æ‹©"å…¨éƒ¨è§’è‰²"æ—¶ï¼Œç³»ç»Ÿå°†æ•´åˆç”¨æˆ·æƒé™ä¸æ‰€æœ‰è§’è‰²æƒé™çš„å¹¶é›†ä½œä¸ºå½“å‰æƒé™é›†ï¼Œå®ç°çµæ´»çš„æƒé™æ§åˆ¶ç­–ç•¥ã€‚</p>
<h3 data-id="heading-17">ä¸»é¢˜</h3>
<p>1.æ–°å¢ä¸»é¢˜è‰²åœ¨src\themesä¸‹</p>
<p>2.æ–°å¢ä¸»é¢˜è‰²åï¼Œéœ€è¦å¯¼å…¥</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">//src\index.css</span>
<span class="hljs-meta">@import</span> <span class="hljs-string">"@/themes/blue.css"</span>;
<span class="hljs-meta">@import</span> <span class="hljs-string">"@/themes/green.css"</span>;
<span class="hljs-meta">@import</span> <span class="hljs-string">"@/themes/orange.css"</span>;
<span class="hljs-meta">@import</span> <span class="hljs-string">"@/themes/red.css"</span>;
<span class="hljs-meta">@import</span> <span class="hljs-string">"@/themes/rose.css"</span>;
<span class="hljs-meta">@import</span> <span class="hljs-string">"@/themes/violet.css"</span>;
<span class="hljs-meta">@import</span> <span class="hljs-string">"@/themes/yellow.css"</span>;
</code></pre>
<ul>
<li>ä¸»é¢˜è‰²åˆ‡æ¢</li>
</ul>
<p>ä¸‹é¢å¯ä»¥é…ç½®ä¸»é¢˜è‰²ï¼ŒColorçš„å­—ç¬¦ä¸²é¢œè‰²å’Œsrc\themesä¸­çš„ä¸€è‡´</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">//src\store\theme.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">Color</span> =
  | <span class="hljs-string">"default"</span>
  | <span class="hljs-string">"blue"</span>
  | <span class="hljs-string">"green"</span>
  | <span class="hljs-string">"orange"</span>
  | <span class="hljs-string">"red"</span>
  | <span class="hljs-string">"rose"</span>
  | <span class="hljs-string">"violet"</span>
  | <span class="hljs-string">"yellow"</span>;
</code></pre>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> {useThemeStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/store/index'</span>;
<span class="hljs-keyword">const</span> {color,setColor} = <span class="hljs-title function_">useThemeStore</span>();
<span class="hljs-title function_">setColor</span>(<span class="hljs-string">'blue'</span>)
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é«˜å¾·åœ°å›¾ã€Œç‚¹æ ‡è®°+ç‚¹èšåˆã€åŠ è½½æ…¢ã€å¡é¡¿é—®é¢˜ è§£å†³æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7603653885601316914</link>    <guid>https://juejin.cn/post/7603653885601316914</guid>    <pubDate>2026-02-07T06:04:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603653885601316914" data-draft-id="7603584155785232434" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é«˜å¾·åœ°å›¾ã€Œç‚¹æ ‡è®°+ç‚¹èšåˆã€åŠ è½½æ…¢ã€å¡é¡¿é—®é¢˜ è§£å†³æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="å‰ç«¯,Vue.js,JavaScript"/> <meta itemprop="datePublished" content="2026-02-07T06:04:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Joie"/> <meta itemprop="url" content="https://juejin.cn/user/3265984436383947"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é«˜å¾·åœ°å›¾ã€Œç‚¹æ ‡è®°+ç‚¹èšåˆã€åŠ è½½æ…¢ã€å¡é¡¿é—®é¢˜ è§£å†³æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3265984436383947/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Joie
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T06:04:59.000Z" title="Sat Feb 07 2026 06:04:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcoffee.joiepink.space%2F" target="_blank" title="https://coffee.joiepink.space/" ref="nofollow noopener noreferrer">coffee.joiepink.space/</a></p>
<p>Coffeeç½‘é¡µçš„è®¾è®¡çµæ„Ÿæ¥è‡ªäºä¸€ä¸ªæ™®é€šçš„åœ¨æ˜Ÿå·´å…‹å–å’–å•¡çš„ä¸‹åˆï¼Œçªå‘å¥‡æƒ³èƒ½ä¸èƒ½æŠŠå…¨å›½çš„æ˜Ÿå·´å…‹é—¨åº—éƒ½æ•´åˆåˆ°ä¸€èµ·ï¼Œç”¨åœ°å›¾å¯è§†åŒ–çš„å½¢å¼å±•ç¤ºé—¨åº—åˆ†å¸ƒå¯†åº¦ï¼Œä¸ºå’–å•¡çˆ±å¥½è€…æä¾›ä¾¿æ·çš„é—¨åº—æŸ¥è¯¢å’Œå¯¼èˆªæœåŠ¡ã€‚</p>
<p>äºæ˜¯ä¾¿è¯ç”Ÿäº†ã€‚</p>
<p>æŠ€æœ¯æ ˆï¼š<code>Vue</code> <code>Amap</code> <code>UnoCSS</code> <code>IcÃ´nes</code> <code>Vant</code> <code>ESLint</code> <code>Vite</code></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00f11148407a4283b3e53fdb758957af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSm9pZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771049099&amp;x-signature=%2BxvWnpYzF31ih3Rkbn3TizzZLk4%3D" alt="coffee-performance-01.png" loading="lazy"/></p>
<p>ç—›ç‚¹ï¼šæœ¬é¡¹ç›®æœ‰<code>8000+</code>çš„æ•°æ®é‡ï¼Œéœ€è¦åœ¨é«˜å¾·åœ°å›¾ä¸Šç‚¹æ ‡è®°æ¯å®¶æ˜Ÿå·´å…‹é—¨åº—ä¸”æ”¯æŒäº¤äº’ï¼Œç”±äºæ•°æ®é‡è¿‡å¤§ï¼Œé¦–æ¬¡è¿›å…¥é¡µé¢<code>åŠ è½½é€Ÿåº¦å¾ˆæ…¢</code>ï¼Œä¸”æŠŠ8000+ç‚¹æ ‡è®°æ˜¾ç¤ºåœ¨åœ°å›¾ä¸Šï¼Œç‚¹æ ‡è®°çš„äº¤äº’åŠ¨ä½œä¼š<code>å´©ç›˜</code>ï¼Œåœ°å›¾æ“ä½œ<code>å“åº”é€Ÿåº¦ä¹Ÿä¼šå˜æ…¢ã€å¡é¡¿</code>ï¼Œéå¸¸å½±å“ç”¨æˆ·çš„<code>ä½¿ç”¨ä½“éªŒ</code>ã€‚</p>
<p>åŸºäºæ­¤ï¼Œæˆ‘ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢å¯¹é¡¹ç›®è¿›è¡Œäº†æ€§èƒ½ä¼˜åŒ–</p>
<ol>
<li><strong>Amap SDKæŒ‰éœ€ã€åŠ¨æ€åŠ è½½</strong></li>
<li><strong>ç”¨ shallowRef å­˜åœ°å›¾ç›¸å…³å®ä¾‹</strong></li>
<li><strong>ç‚¹èšåˆ + åªæ¸²æŸ“è§†é‡å†…ç‚¹ä½</strong></li>
<li><strong>è§†å£å˜åŒ–é˜²æŠ– + åªç»‘ä¸€æ¬¡</strong></li>
<li><strong>é¦–å±åå†æ‹‰æ•°æ®</strong></li>
<li><strong>ä¸»é¢˜åˆ‡æ¢ä¸åœ°å›¾æ ·å¼</strong></li>
</ol>
<h3 data-id="heading-0">1. Amap SDKæŒ‰éœ€ã€åŠ¨æ€åŠ è½½</h3>
<p>åœ¨åœ°å›¾é¡µé¢çš„jsä¸­ï¼Œæˆ‘å¹¶ä¸åœ¨jsé¡¶éƒ¨å†™<code>import AMapLoader from '@amap/amap-jsapi-loader'</code> ã€‚</p>
<p>è¿™ç§ä½¿ç”¨æ–¹æ³•æœ‰ä¸¤ä¸ªå¼Šç«¯ï¼š</p>
<p>ç¬¬ä¸€æ–¹é¢ï¼Œåœ¨{Vite}æ‰“åŒ…çš„æ—¶å€™ï¼Œè¿™ä¸ªä¾èµ–ä¼šè¢«æ‰“åŒ…è¿›å…¥é¦–å±å°±è¦åŠ è½½çš„bundle(ä¸»chunkæˆ–å’Œä¸»å…¥å£ä¸€èµ·è¢«åŠ è½½çš„chunk)ï¼Œç”¨æˆ·ç¬¬ä¸€æ¬¡æ‰“å¼€é¡µé¢çš„æ—¶å€™ï¼Œæµè§ˆå™¨å°±ä¼šä¸€èµ·ä¸‹è½½è¿™ä»½åŒ…å«é«˜å¾·çš„JS,å¯¼è‡´é¦–å±ä½“ç§¯å˜å¤§ï¼ŒåŠ è½½é€Ÿåº¦å˜æ…¢ã€‚</p>
<p>ç¬¬äºŒæ–¹é¢ï¼Œè¿™ç§æ–¹å¼åœ¨æ¨¡å—è¢«<code>Node</code>æ‰§è¡Œçš„æ—¶å€™ä»¬å°±ä¼šè¿è¡Œï¼Œäºæ˜¯ä¼šåŠ è½½<code>@amap/amap-jsapi-loader</code>åŠå…¶å†…éƒ¨ä¾èµ–, è€Œ{Amap}å†…éƒ¨SDK/loaderä¼šç”¨åˆ°<code>window</code>ï¼Œä½†æ˜¯<code>Node</code>é‡Œé¢æ˜¯æ²¡æœ‰<code>window</code>çš„ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´æŠ¥é”™(ä¾‹å¦‚ <code>Reference Error: window is not defined</code>)ã€‚</p>
<p>ä¸ºäº†é¿å…ä»¥ä¸Šä¸¤ç§é—®é¢˜ï¼Œæˆ‘åœ¨åˆå§‹åŒ–{Amap}çš„å‡½æ•°é‡Œå†™<code>const {default: AMapLoader} = await import('@amp/amp-jsapi-loader')</code>ï¼Œè¿™ä¸ªå‡½æ•°åªåœ¨<code>onMounted</code>ç”Ÿå‘½å‘¨æœŸä¸­è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´åªåœ¨æµè§ˆå™¨é‡Œã€é¡µé¢æŒ‚è½½ä¹‹åæ‰ä¼šæ‰§è¡Œ</p>
<p>åœ¨{Vite}æ‰“åŒ…çš„æ—¶å€™ï¼Œ<code>@amap/amap-jsapi-loader</code>ä¼šè¢«æ‰“åŒ…æˆå•ç‹¬çš„<code>chunk</code>ï¼Œåªæœ‰æ‰§è¡Œåˆ°<code>const {default: AMapLoader} = await import('@amp/amp-jsapi-loader')</code>çš„æ—¶å€™æ‰ä¼šåŠ è½½è¿™æ®µJSï¼Œé¦–å±ä¸»bundleé‡Œå¹¶æ²¡æœ‰{Amap}ç›¸å…³ä»£ç ï¼Œæ‰€ä»¥é¦–åŒ…æ›´å°ã€é¦–å±æ›´å¿«ã€‚</p>
<p>SSGæ—¶Nodeä¸ä¼šæ‰§è¡Œ<code>onMounred</code>é’©å­ï¼Œæ‰€ä»¥ä¸ä¼šæ‰§è¡Œè¿™æ®µ<code>import</code>ï¼Œè‡ªç„¶ä¹Ÿå°±ä¸ä¼šåœ¨Nodeé‡ŒåŠ è½½é«˜å¾·ï¼Œä¸ä¼šç¢°åˆ°<code>window</code>ï¼Œé¿å…äº†æŠ¥é”™ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">initMap</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> { <span class="hljs-attr">default</span>: <span class="hljs-title class_">AMapLoader</span> } = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@amap/amap-jsapi-loader'</span>) <span class="hljs-comment">// [!code hl]</span>
  <span class="hljs-keyword">const</span> amapKey = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">VITE_AMAP_KEY</span>
  <span class="hljs-keyword">if</span> (!amapKey)
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Missing VITE_AMAP_KEY'</span>))
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">_AMapSecurityConfig</span> = { <span class="hljs-attr">securityJsCode</span>: amapKey }
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">AMapLoader</span>.<span class="hljs-title function_">load</span>({
    <span class="hljs-attr">key</span>: amapKey,
    <span class="hljs-attr">version</span>: <span class="hljs-string">'2.0'</span>,
    <span class="hljs-attr">plugins</span>: [<span class="hljs-string">'AMap.Scale'</span>, <span class="hljs-string">'AMap.MarkerCluster'</span>, <span class="hljs-string">'AMap.Geolocation'</span>], <span class="hljs-comment">// [!code hl]</span>
  })
}
</code></pre>
<p>åœ¨<code>initMap</code>å‡½æ•°ä¸­ï¼Œæˆ‘ä½¿ç”¨{Amap}2.0çš„<code>æŒ‰æ’ä»¶åŠ è½½</code>ç‰¹æ€§ï¼Œé€šè¿‡<code>AMapLoader.load({plugins: [...]})</code>æŒ‰éœ€åŠ è½½éœ€è¦çš„æ’ä»¶ï¼Œè¿™ç§æ–¹å¼åœ¨é¡¹ç›®ä¸­ç²¾å‡†å¼•å…¥éœ€è¦ä½¿ç”¨çš„æ’ä»¶ï¼Œä½¿å¾—é¡¹ç›®è¯·æ±‚æ›´å°‘ã€è§£ææ›´å°‘ã€åœ°å›¾åˆå§‹åŒ–æ›´è½»ï¼Œä»è€ŒåŠ å¿«äº†åŠ è½½é€Ÿåº¦ã€å‡å°äº†æ‰“åŒ…çš„åŒ…ä½“ç§¯ã€‚</p>
<h3 data-id="heading-1">2. <strong>ç”¨ shallowRef å­˜åœ°å›¾ç›¸å…³å®ä¾‹</strong></h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> map = <span class="hljs-title function_">shallowRef</span>(<span class="hljs-literal">null</span>)
<span class="hljs-keyword">const</span> currentLocationMarker = <span class="hljs-title function_">shallowRef</span>(<span class="hljs-literal">null</span>)
<span class="hljs-keyword">const</span> geolocation = <span class="hljs-title function_">shallowRef</span>(<span class="hljs-literal">null</span>)
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Amap</span> = <span class="hljs-title function_">shallowRef</span>(<span class="hljs-literal">null</span>)

<span class="hljs-comment">/** æ ¹æ® isDark è®¾ç½®åœ°å›¾åº•å›¾æ ·å¼ï¼›è¿”å› Promiseï¼Œåœ°å›¾æ ·å¼åˆ‡æ¢å®Œæˆåå† resolve */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">applyMapStyle</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (!map.<span class="hljs-property">value</span>) <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>()
  <span class="hljs-keyword">const</span> style = i
   sDark.<span class="hljs-property">value</span> ? <span class="hljs-string">'amap://styles/dark'</span> : <span class="hljs-string">'amap://styles/normal'</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
      <span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> {
        map.<span class="hljs-property">value</span>?.<span class="hljs-title function_">setMapStyle</span>(style)
      <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">1800</span>)
    })
})
}

<span class="hljs-comment">/** ç‚¹å‡»åˆ‡æ¢ä¸»é¢˜ */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">onThemeToggle</span>(<span class="hljs-params"/>) {
    themeChanging.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
  <span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">toggleDark</span>()

<span class="hljs-comment">/** ç›‘å¬ isDarkï¼Œåˆ‡å®Œæ ·å¼å†å…³ loading */</span>
<span class="hljs-title function_">watch</span>(isDark, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> p = <span class="hljs-title function_">applyMapStyle</span>()
  <span class="hljs-keyword">if</span> (p) {
      p.<span class="hljs-title function_">finally</span>(<span class="hljs-function">() =&gt;</span> {
        themeChanging.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>

    se {
  }
    themeChanging.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
}

</code></pre>
<p>å…ˆæ¥è¯´ä¸€ä¸‹{Vue}ä¸­<code>ref</code>å’Œ<code>shallowRef</code>çš„åŒºåˆ«</p>
<p><code>ref</code>: {Vue}ä¼šå¯¹ä½ å¡è¿›å»çš„æ•´ä¸ªå¯¹è±¡åšæ·±åº¦å“åº”å¼ä»£ç†â€”â€”é€’å½’çš„æŠŠå¯¹è±¡é‡Œæ¯ä¸€å±‚å±æ€§éƒ½æŠ¥ç§°getter/setter(Proxy), è¿™æ ·ä»»æ„ä¸€å±‚å±æ€§å˜äº†éƒ½ä¼šè§¦å‘æ›´æ–°</p>
<p><code>shallowRef</code>ï¼šåªå¯¹[.valueè¿™ä¸€å±‚]åšå“åº”å¼ã€‚å½“æŠŠä¸€ä¸ªå¯¹è±¡èµ‹å€¼ç»™<code>shallowRef.value</code>çš„æ—¶å€™ï¼Œ{Vue}ä¸ä¼šå»é€’å½’ä»£ç†è¿™ä¸ªå¯¹è±¡å†…éƒ¨ï¼Œå†…éƒ¨å±æ€§å˜äº†{Vue}å¹¶ä¸çŸ¥é“ï¼Œä½†åªæœ‰æŠŠæ•´ä¸ªå¯¹è±¡æ¢æ‰(é‡æ–°èµ‹å€¼.value)æ—¶å€™æ‰ä¼šè§¦å‘æ›´æ–°</p>
<p>å¦‚æœä½¿ç”¨<code>ref</code>æ¥å­˜å‚¨{Amap}å®ä¾‹ï¼Œä¼šå‡ºç°<code>å› æ·±åº¦ä»£ç†é€ æˆçš„postMessageå…‹éš†æŠ¥é”™</code>ï¼Œä¾‹å¦‚ï¼šDOMException: Failed to execute 'postMessage' on 'Worker': AMap.Map#xxx could not be cloned.</p>
<p>{Amap}çš„å®ä¾‹å¦‚<code>Map</code> <code>Marker</code> <code>Geolocation</code> <code>MarkerCluster</code>ç­‰å†…éƒ¨ä¼šç”¨åˆ°<code>postMessage</code>ä¾‹å¦‚å’Œåœ°å›¾iframe/workeré€šä¿¡</p>
<p>æµè§ˆå™¨åœ¨å‘<code>postMessage</code>çš„æ—¶å€™ï¼Œä¼šå¯¹è¦ä¼ çš„æ•°æ®åš<code>ç»“æ„åŒ–å…‹éš† structured clone</code>ï¼ŒæŠŠå¯¹è±¡åºåˆ—å·ä¹‹åå†åœ¨å¦ä¸€è¾¹ååºåˆ—åŒ–ï¼Œè€ŒProxyå¯¹è±¡ä¸æ”¯æŒè¢«å…‹éš†ï¼Œæ‰€ä»¥ä¼šæŠ¥é”™</p>
<p>èƒ½è¢«ç»“æ„åŒ–å…‹éš†çš„ï¼šæ™®é€šå¯¹è±¡ã€æ•°ç»„ã€éƒ¨åˆ†ç®€å•ç±»å‹</p>
<p>ä¸èƒ½è¢«ç»“æ„åŒ–å…‹éš†çš„ï¼šå‡½æ•°ã€DOMèŠ‚ç‚¹ã€Proxyå¯¹è±¡(Vueçš„å“åº”å¼å¯¹è±¡å°±æ˜¯Proxy)</p>
<p>å¦‚æœä½¿ç”¨<code>shallowRef</code>å­˜å‚¨çš„è¯ï¼Œèµ‹å€¼ç»™<code>shallowRef.value</code>çš„æ˜¯{Amap}åŸå§‹çš„å®ä¾‹å¯¹è±¡ï¼Œ{Vue}ä¸ä¼šå»é€’å½’ä»£ç†å®ƒé‡Œé¢çš„å±æ€§ï¼Œä¹Ÿå°±ä¸ä¼šæŠ¥é”™ã€‚è€Œ<code>ref</code>å­˜å‚¨ä¼šé€’å½’éå†ã€åˆ›å»ºå¤§é‡çš„<code>Proxy</code>ï¼Œä½†å…¶å®å¹¶ä¸éœ€è¦åœ¨åœ°å›¾å†…éƒ¨æŸä¸ªåæ ‡å˜äº†å°±è§¦å‘Vueæ›´æ–°ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æ¢åœ°å›¾ã€æ¢markerã€æ¢èšåˆçš„è¿™ç§<code>æ•´å®ä¾‹æ›¿æ¢</code>çš„æ—¶å€™æ›´æ–°å³å¯ã€‚æ‰€ä»¥<code>shallowRef</code>çš„æ—¶å€™å†…å­˜å’ŒCPUå¼€é”€éƒ½æ›´å°ï¼Œä»è€Œæœ€æ€§èƒ½æœ‰åˆ©ã€‚</p>
<h3 data-id="heading-2">3. <strong>ç‚¹èšåˆ + åªæ¸²æŸ“è§†é‡å†…ç‚¹ä½</strong></h3>
<p>ä¸ºäº†è§£å†³æ•°æ®é‡è¿‡å¤§å¯¼è‡´DOMæ•°é‡å·¨å¤§(æ¯ä¸ªé—¨åº—åˆ›å»ºä¸€ä¸ªmarkeræ ‡è®°)å¯¼è‡´å¡é¡¿å´©ç›˜çš„é—®é¢˜ï¼Œæˆ‘ä½¿ç”¨{Amap}çš„<code>ç‚¹èšåˆ MarkerCluster</code>å°†è·ç¦»è¿‘çš„ä¸€æ‰¹ç‚¹åœ¨é€»è¾‘ä¸Šå½’ä¸ºä¸€ç»„ï¼Œåœ°å›¾ä¸Šåªç”»ä¸€ä¸ªèšåˆç‚¹ï¼Œç”¨æˆ·æ”¾å¤§åœ°å›¾æ—¶ï¼Œèšåˆä¼šæ‹†å¼€å˜æˆæ›´å°çš„ç°‡æˆ–è€…å•ç‚¹ï¼Œç¼©å°åœ°å›¾çš„æ—¶å€™ï¼Œä¼šåˆå¹¶æˆæ›´å¤§çš„ç°‡ã€‚</p>
<p>å³ä½¿ä½¿ç”¨<code>ç‚¹èšåˆ MarkerCluster</code>ï¼Œå¦‚æœæŠŠå…¨å›½æ‰€æœ‰é—¨åº—(8000+)çš„æ•°æ®é‡ä¸€æ¬¡æ€§éƒ½å¡ç»™<code>ç‚¹èšåˆ MarkerCluster</code>ï¼Œèšåˆç®—æ³•è¦å¯¹è¿™æ‰€æœ‰ç‚¹éƒ½åšè·ç¦»è®¡ç®—ã€åˆ†ç°‡ã€è®¡ç®—é‡ååˆ†ä¹‹åºå¤§ï¼Œè€Œç»å¤§éƒ¨åˆ†ç‚¹å¹¶ä¸åœ¨å½“å‰ç”¨æˆ·æ‰€è§çš„å±å¹•å†…ï¼Œç”¨æˆ·æ ¹æœ¬çœ‹ä¸åˆ°ï¼Œå´è¿˜æ˜¯åœ¨è€—è´¹åå°è¿›è¡Œå‚ä¸è®¡ç®—å’Œå†…éƒ¨ç®¡ç†ï¼Œæ‰€ä»¥ï¼Œæ›´åˆç†çš„åšæ³•æ˜¯åªæŠŠ<code>å½“å‰è§†é‡ current viewport</code>å†…çš„ç‚¹æ ‡è®°äº¤ç»™<code>ç‚¹èšåˆ MarkerCluster</code>è¿›è¡Œè®¡ç®—ï¼Œè€Œè§†é‡å¤–çš„ç‚¹ä¸å‚ä¸è®¡ç®—å’Œæ¸²æŸ“ï¼Œå½“ç”¨æˆ·æ‹–åŠ¨åœ°å›¾ç”»å¸ƒæˆ–è€…æ”¾å¤§ç¼©å°å½“å‰è§†é‡çš„æ—¶å€™ï¼Œå†è¿›è¡Œè®¡ç®—å‚ä¸ã€‚</p>
<p>å…·ä½“åšæ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">updateClusterByViewport</span>(<span class="hljs-params">AmapInstance</span>) {
    <span class="hljs-keyword">if</span> (!map.<span class="hljs-property">value</span> || !pointList.<span class="hljs-property">value</span>?.<span class="hljs-property">length</span>) <span class="hljs-keyword">return</span>
  <span class="hljs-comment">// è¿”å›å½“å‰åœ°å›¾å¯è§†åŒºåŸŸçš„åœ°ç†èŒƒå›´ï¼ˆä¸€ä¸ªçŸ©å½¢ï¼Œæœ‰è¥¿å—è§’ã€ä¸œåŒ—è§’ç»çº¬åº¦ï¼‰ã€‚</span>

  <span class="hljs-keyword">const</span> b = map.<span class="hljs-property">value</span>.<span class="hljs-title function_">getBounds</span>()
  <span class="hljs-keyword">if</span> (!b) <span class="hljs-keyword">return</span>
  <span class="hljs-comment">// è¿‡æ»¤å½“å‰</span>
   è§†é‡å†…çš„ç‚¹æ•°æ®
  <span class="hljs-keyword">const</span> inBounds = pointList.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">point</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> ll = point.<span class="hljs-property">lnglat</span>
    <span class="hljs-keyword">const</span> lng = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(ll) ? ll[<span class="hljs-number">0</span>] : (ll?.<span class="hljs-property">lng</span> ?? ll?.<span class="hljs-property">longitude</span>)
    <span class="hljs-keyword">const</span> lat = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(ll) ? ll[<span class="hljs-number">1</span>] : (ll?.<span class="hljs-property">lat</span> ?? ll?.<span class="hljs-property">latitude</span>)
    <span class="hljs-comment">// åˆ¤æ–­ç‚¹æ˜¯å¦åœ¨å½“å‰è§†é‡çŸ©å½¢å†…</span>
    <span class="hljs-keyword">return</span> lng != <span class="hljs-literal">null</span> &amp;&amp; lat != <span class="hljs-literal">null</span> &amp;&amp; b.<span class="hljs-title function_">contains</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AmapInstance</span>.<span class="hljs-title class_">LngLat</span>(lng, lat))
   }
  <span class="hljs-comment">// æŠŠã€Œè§†é‡å†…ç‚¹æ•°ã€å­˜èµ·æ¥ç»™ç•Œé¢ç”¨</span>
  pointsInBounds.<span class="hljs-property">value</span> = inBounds

    <span class="hljs-comment">// é”€æ¯æ—§èšåˆå¹¶åªæ‹¿è§†é‡å†…çš„ç‚¹é‡å»ºèšåˆ</span>
  <span class="hljs-keyword">if</span> (clusterRef.<span class="hljs-property">value</span>) {
      clusterRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">setMap</span>(<span class="hljs-literal">null</span>)
    clusterRef.<span class="hljs-property">value</span> = <span class="hljs-literal">null</span>
   }
  <span class="hljs-keyword">if</span> (!inBounds.<span class="hljs-property">length</span>) <span class="hljs-keyword">return</span>
  <span class="hljs-keyword">const</span> myList = inBoun
   ds.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">point</span>) =&gt;</span> ({
      <span class="hljs-attr">lnglat</span>: <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(pont.<span class="hljs-property">lnlat</span>)
        ? point.<span class="hljs-property">lnglat</span>
      : [point.<span class="hljs-property">lnglat</span>?.<span class="hljs-property">lng</span> ?? point.<span class="hljs-property">lnglat</span>?.<span class="hljs-property">longitude</span>, point.<span class="hljs-property">lnglat</span>?.<span class="hljs-property">lat</span> ?? point.<span class="hljs-property">lnglat</span>?.<span class="hljs-property">latitude</span>],
   <span class="hljs-attr">id</span>:point.<span class="hljs-property">id</span>,
  })
  <span class="hljs-keyword">const</span> gridSize = <span class="hljs-number">60</span>
  <span class="hljs-keyword">const</span> cluster = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AmapInstance</span>.<span class="hljs-title class_">MarkerCluster</span>(map.<span class="hljs-property">value</span>, myList, {
      gridSize,
    <span class="hljs-attr">renderClusterMarker</span>: <span class="hljs-title function_">createRenderClusterMarker</span>(<span class="hljs-title class_">AmapInstance</span>, myList.<span class="hljs-property">length</span>),
    <span class="hljs-attr">renderMarker</span>: <span class="hljs-title function_">createRenderStoreMarker</span>(<span class="hljs-title class_">AmapInstance</span>),
  })
  <span class="hljs-title function_">setupClusterClickZoom</span>(cluster)
  clusterRef.<span class="hljs-property">value</span> = cluster
}
</code></pre>
<h3 data-id="heading-3">4. <strong>è§†å£å˜åŒ–é˜²æŠ– + åªç»‘ä¸€æ¬¡</strong></h3>
<p>å½“ç”¨æˆ·æ‹–æ‹½ã€ç¼©æ”¾åœ°å›¾çš„æ—¶å€™ï¼Œåœ°å›¾ä¼šè¿ç»­è§¦å‘å¾ˆå¤šæ¬¡<code>moveend/zoomend</code>çš„äº‹ä»¶ï¼Œå¦‚æœæ¯æ¬¡è§¦å‘éƒ½æ‰§è¡Œä¸Šæ–‡çš„<code>updateClusterByViewport</code>æ–¹æ³•ï¼Œè®¡ç®—æ‰§è¡Œè¿‡äºé¢‘ç¹ï¼Œå®¹æ˜“é€ æˆé¡µé¢å¡é¡¿ã€æµªè´¹CPUï¼Œå› æ­¤ä¸ºè¿™äº›æ“ä½œéƒ½åŠ ä¸Šé˜²æŠ–</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> onViewportChange = <span class="hljs-title function_">useDebounceFn</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">updateClusterByViewport</span>(<span class="hljs-title class_">Amap</span>.<span class="hljs-property">value</span>), <span class="hljs-number">150</span>)
map.<span class="hljs-property">value</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'moveend'</span>, onViewportChange)
map.<span class="hljs-property">value</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'zoomend'</span>, onViewportChange)
</code></pre>
<h3 data-id="heading-4">5. <strong>é¦–å±åå†æ‹‰æ•°æ®</strong></h3>
<p>é¦–å±åŠ è½½çš„æ—¶å€™ï¼Œåº”è¯¥æŠŠæ³¨æ„åŠ›æ”¾åœ¨åœ°å›¾å®¹å™¨å¿«é€Ÿæ¸²æŸ“ä¸Šé¢ï¼Œä»è€Œç»™ç”¨æˆ·ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ä½¿ç”¨ä½“éªŒã€‚è€ŒåŠ è½½æ•°æ®(<code>loadAndRenderStores</code>)ä¼šæ‰§è¡Œè¯·æ±‚æ•°æ®ã€å¤„ç†æ•°æ®ã€æ¸²æŸ“è§†é‡å†…ç‚¹èšåˆè¿™ä¸€ç³»åˆ—æ“ä½œï¼Œé€»è¾‘è¾ƒé‡ï¼Œå› æ­¤å¦‚æœåœ¨åœ°å›¾è¿˜æ²¡å‡†å¤‡å¥½ã€æˆ–è€…é¦–å±è¿˜åœ¨æ¸²æŸ“çš„æ—¶å€™åŒæ­¥åšè¿™äº›äº‹æƒ…ï¼Œå°±ä¼šå ç”¨ä¸»çº¿ç¨‹ï¼Œä»è€Œæ‹–æ…¢é¦–å±DOMçš„æ¸²æŸ“ã€æ‹–æ…¢åœ°å›¾SDKçš„é¦–æ¬¡ç»˜åˆ¶ï¼Œæ‰€ä»¥æŠŠç›®æ ‡å˜æˆï¼šå…ˆè®©é¦–å±å’Œåœ°å›¾ç¬¬ä¸€æ¬¡æ¸²æŸ“å®Œæˆï¼Œå†åœ¨æµè§ˆå™¨ç©ºé—²çš„æ—¶å€™å»æ‹‰å–æ•°æ®ã€è®¡ç®—èšåˆã€‚</p>
<pre><code class="hljs language-js" lang="js">map.<span class="hljs-property">value</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'complete'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">run</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-title function_">loadAndRenderStores</span>(<span class="hljs-title class_">AmapInstance</span>)
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> requestIdleCallback !== <span class="hljs-string">'undefined'</span>) {
    <span class="hljs-title function_">requestIdleCallback</span>(run, { <span class="hljs-attr">timeout</span>: <span class="hljs-number">500</span> })
  }
  <span class="hljs-keyword">else</span> {
    <span class="hljs-built_in">setTimeout</span>(run, <span class="hljs-number">0</span>)
  }
  mapReady.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>

  <span class="hljs-title function_">tryEndFirstScreenLoading</span>()
})
</code></pre>
<h3 data-id="heading-5">6. <strong>ä¸»é¢˜åˆ‡æ¢ä¸åœ°å›¾æ ·å¼</strong></h3>
<p>é¡¹ç›®ä¸­
è®¾ç½®äº†<code>Dark</code>å’Œ<code>Light</code>ä¸¤ç§ä¸»é¢˜æ¨¡å¼ï¼Œè€Œåœ¨åˆ‡æ¢çš„æ—¶å€™ï¼Œåœ°å›¾æ ·å¼åˆ‡æ¢æ˜¯å¼‚æ­¥çš„ï¼Œæ¯”å¯¼èˆªæ¡æ ·å¼åˆ‡æ¢æ…¢ï¼Œè¿™å°±ä¼šå¯¼è‡´å‡ºç°<code>å¯¼èˆªæ¡å·²ç»å˜åŒ–ä¸»é¢˜ï¼Œä½†åœ°å›¾ä¸»é¢˜è¿˜æ²¡æ›´æ–°ï¼Œä¸­é—´æœ‰ä¸€å°æ®µæ—¶é—´ä¸¤è€…é¢œè‰²ä¸ä¸€è‡´ï¼Œç”šè‡³ä¼šé—ªåŠ¨ä¸€ä¸‹ï¼Œå¸¦ç»™ç”¨æˆ·ä¸å¥½çš„ä½“éªŒæ•ˆæœ</code></p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘åœ¨åˆ‡æ¢ä¸»é¢˜çš„[ä¸­é—´æ€]ä¸­,å°†é¡µé¢ç”¨<code>å…¨å±loading</code>é®ç½©å±‚ç½©ä½ï¼Œç­‰åœ°å›¾æ ·å¼åŸºæœ¬åˆ‡æ¢å®Œæ¯•å†éšè—ï¼Œé¿å…äº†ä¸­é—´æ€çš„é—ªçƒé—®é¢˜</p>
<h2 data-id="heading-6">å°ç»“</h2>
<p>è‡³æ­¤ï¼Œ{Amap}ç›¸å…³çš„æ€§èƒ½ä¼˜åŒ–ç»“æŸï¼Œé¦–å±åŠ è½½ä»åŸå…ˆçš„<code>8,304ms</code>ä¼˜åŒ–åˆ°äº†<code>4,181ms</code>åŠ è½½æ—¶é—´å‡å°‘äº†<code>4,123ms</code>,æ€§èƒ½æå‡äº†çº¦<code>49.65%</code>ï¼ŒåŠ è½½é€Ÿåº¦å¿«äº†<code>ä¸€å€</code></p>
<p>ä¼˜åŒ–å‰ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/efba750ce385469ca7f56a6cb03c91a4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSm9pZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771049099&amp;x-signature=WxgK2YDcfflJ3BFLK8bNUOcmDik%3D" alt="coffee-performance-02.webp" loading="lazy"/></p>
<p>ä¼˜åŒ–åï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0662877051de451ca08fade09472af71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSm9pZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771049099&amp;x-signature=6BK0OfdzvO9vdKF7H7elEjXrDwc%3D" alt="coffee-performance-03.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[useRouteså’ŒcreateBrowserRouterçš„å¯¹æ¯”]]></title>    <link>https://juejin.cn/post/7603575399256178728</link>    <guid>https://juejin.cn/post/7603575399256178728</guid>    <pubDate>2026-02-07T06:35:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603575399256178728" data-draft-id="7603588665567543336" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="useRouteså’ŒcreateBrowserRouterçš„å¯¹æ¯”"/> <meta itemprop="keywords" content="React.js"/> <meta itemprop="datePublished" content="2026-02-07T06:35:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="liyang_ii"/> <meta itemprop="url" content="https://juejin.cn/user/2365804756342360"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            useRouteså’ŒcreateBrowserRouterçš„å¯¹æ¯”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2365804756342360/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    liyang_ii
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T06:35:09.000Z" title="Sat Feb 07 2026 06:35:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    14
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€ useRoutes</h2>
<pre><code class="hljs">æœ¬è´¨ï¼šHook
ç‰ˆæœ¬ï¼šV6+
é™åˆ¶ï¼šéœ€è¦é…åˆBrowserRouteræˆ–è€…HashRouterè¿›è¡Œä½¿ç”¨
ä½¿ç”¨èŒƒå›´ï¼šåœ¨ç»„ä»¶å†…éƒ¨ä½¿ç”¨
è¿”å›å€¼ï¼šå¾—åˆ°è·¯ç”±åŒ¹é…åˆ°çš„å…ƒç´ 
</code></pre>
<h2 data-id="heading-1">äºŒã€createBrowserRouter</h2>
<pre><code class="hljs">æœ¬è´¨ï¼šå‡½æ•°
ç‰ˆæœ¬ï¼šV6.4+
é™åˆ¶ï¼šä¸éœ€è¦é…åˆBrowserRouteræˆ–è€…HashRouterè¿›è¡Œä½¿ç”¨ï¼Œä½†æ˜¯éœ€è¦é…åˆRouterProvider
ä½¿ç”¨èŒƒå›´ï¼šåœ¨ç»„ä»¶å¤–éƒ¨åˆ›å»ºè·¯ç”±é…ç½®
è¿”å›å€¼ï¼šå¾—åˆ°è·¯ç”±åŒ¹é…åˆ°çš„å…ƒç´ 
</code></pre>
<h2 data-id="heading-2">ä¸‰ã€å¯¹æ¯”ä¼˜ç¼ºç‚¹</h2>
<pre><code class="hljs language-scss" lang="scss">useRoutesï¼šç®€å•ã€çµæ´»ï¼Œé€‚åˆåŸºç¡€è·¯ç”±ï¼Œä½†æ˜¯ä¸æ”¯æŒæ•°æ®åŠ è½½(loader)å’Œé”™è¯¯å¤„ç†(errorElement)
createBrowserRouterï¼šåŠŸèƒ½æ›´å¼ºï¼Œæ”¯æŒæ•°æ®åŠ è½½ã€é”™è¯¯å¤„ç†ç­‰ï¼Œé€‚åˆå¤æ‚åº”ç”¨
</code></pre>
<h2 data-id="heading-3">å››ã€ä»£ç ç¤ºä¾‹ï¼š</h2>
<h3 data-id="heading-4">useRouter:</h3>
<p><code>function Router() {   return useRoutes([     {       path: "/",       element: &lt;Layout /&gt;,       children: [         {const router = createBrowserRouter([   {     path: "/",     element: &lt;Layout /&gt;,     children: [       {         path: "home",         element: &lt;Home /&gt;,         loader: async () =&gt; {           // åŠ è½½æ•°æ®           return await fetchHomeData();         },         errorElement: &lt;ErrorBoundary /&gt;,       },     ],   }, ]); path: "home", element: &lt;Home /&gt; },       ],     },   ]); }  </code></p>
<p><code>import { BrowserRouter as Router } from "react-router-dom"; root.render(   &lt;Router&gt;  {/* éœ€è¦ BrowserRouter */}     &lt;App /&gt;   &lt;/Router&gt; );</code></p>
<h3 data-id="heading-5">createBrowserRouter:</h3>
<p><code>const router = createBrowserRouter([   {     path: "/",     element: &lt;Layout /&gt;,     children: [       {         path: "home",         element: &lt;Home /&gt;,         loader: async () =&gt; {           // åŠ è½½æ•°æ®           return await fetchHomeData();         },         errorElement: &lt;ErrorBoundary /&gt;,       },     ],   }, ]);</code></p>
<p><code>import { RouterProvider } from "react-router-dom"; import router from "./router/index"; function App() {   return &lt;RouterProvider router={router} /&gt;; // ä¸éœ€è¦ BrowserRouter }</code></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ¥å£å¯ä¸å¯ä»¥å¤šç‰ˆæœ¬å…±å­˜ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7603567912593358875</link>    <guid>https://juejin.cn/post/7603567912593358875</guid>    <pubDate>2026-02-07T07:26:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603567912593358875" data-draft-id="7600299283484770354" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ¥å£å¯ä¸å¯ä»¥å¤šç‰ˆæœ¬å…±å­˜ï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,NestJS,Node.js"/> <meta itemprop="datePublished" content="2026-02-07T07:26:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯ä»˜è±ª"/> <meta itemprop="url" content="https://juejin.cn/user/1741228277763278"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ¥å£å¯ä¸å¯ä»¥å¤šç‰ˆæœ¬å…±å­˜ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1741228277763278/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯ä»˜è±ª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T07:26:29.000Z" title="Sat Feb 07 2026 07:26:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æ¯”å¦‚ç¬¬ä¸€ç‰ˆå¼€å‘äº†è·¯ç”± aaaï¼Œå‡è®¾åé¢æˆ‘ä»¬åˆå¼€å‘äº†ä¸€ç‰ˆæ¥å£ï¼Œä½†è·¯ç”±è¿˜æ˜¯ aaaï¼Œæ€ä¹ˆåšï¼Ÿ</p>
<pre><code class="hljs language-arduino" lang="arduino">nest <span class="hljs-keyword">new</span> version-demo
</code></pre>
<p>åˆ›å»º aaa æ¨¡å—</p>
<pre><code class="hljs language-css" lang="css">nest g resource aaa <span class="hljs-attr">--no-spec</span>
</code></pre>
<p>è·‘èµ·æ¥</p>
<pre><code class="hljs language-arduino" lang="arduino">npm run start:dev
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe155d4d745846fab7fb8e6700ab08b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771053988&amp;x-signature=4lFGbGoZocIcLsHjOJKi5BfICcE%3D" alt="image.png" loading="lazy"/></p>
<p>åˆå¼€å‘äº†ä¸€ç‰ˆæ¥å£ï¼Œä½†è·¯ç”±è¿˜æ˜¯ aaa æ€ä¹ˆåŒºåˆ†å¼€ ï¼Ÿ</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d947b2cbd5734ed2bef4b2b535259d13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771053988&amp;x-signature=zCia%2BDst%2BtpL51eVyrOAUYT3cVA%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3beddec23f714b1fa0d40d721e9013e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771053988&amp;x-signature=foPY16vwmMRcMVxUANae9V2PmI4%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87d04c94aed846418e3d8bfc6b193e48~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771053988&amp;x-signature=X5X8MFSVOaVbRHQ1nYK%2BKGNJGaw%3D" alt="image.png" loading="lazy"/></p>
<p>ä¸å¸¦ version è¯·æ±‚ä¸åˆ°</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b073822df1248cfa13f269b52b7be3c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771053988&amp;x-signature=WgLsQW4lH6kMjx9ABDKelej%2Btao%3D" alt="image.png" loading="lazy"/></p>
<p>å¸¦ä¸Š version</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b76e4c345dfb4a09aaa8278365d39eb3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771053988&amp;x-signature=AUCUffXccWXHHcar8wpo2tE%2BWyA%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3cb8d700e36347fc88c9633380acfc4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771053988&amp;x-signature=NewFLgG8iceRKHeXWD%2F7seASmeM%3D" alt="image.png" loading="lazy"/></p>
<p>æƒ³æ‰€æœ‰ç‰ˆæœ¬éƒ½èƒ½è®¿é—®è¿™ä¸ªæ¥å£ï¼Œå¯ä»¥ç”¨ VERSION_NEUTRAL è¿™ä¸ªå¸¸é‡</p>
<p>ä½†æ­¤æ—¶éƒ½ä¸€æ · å¦‚ä½•åŒºåˆ†å¼€</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ffb55263896649feba9254ce3f6f39c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771053988&amp;x-signature=YF0w%2FeV9yeqrflsLsz1hRLhCgBs%3D" alt="image.png" loading="lazy"/></p>
<p>å•ç‹¬å»ºä¸€ä¸ª version 2 çš„ controller</p>
<pre><code class="hljs language-css" lang="css">nest g controller aaa/aaa-v2 <span class="hljs-attr">--no-spec</span> <span class="hljs-attr">--flat</span>
</code></pre>
<p>æ›´æ–°ä¸º</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Controller</span>, <span class="hljs-title class_">Get</span>, <span class="hljs-title class_">Version</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AaaService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./aaa.service'</span>;

<span class="hljs-meta">@Controller</span>({
  <span class="hljs-attr">path</span>: <span class="hljs-string">'aaa'</span>,
  <span class="hljs-attr">version</span>: <span class="hljs-string">'2'</span>,
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AaaV2Controller</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> aaaService: AaaService</span>) {}

  <span class="hljs-meta">@Get</span>()
  <span class="hljs-title function_">findAllV2</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">aaaService</span>.<span class="hljs-title function_">findAll</span>() + <span class="hljs-string">'222'</span>;
  }
}
</code></pre>
<p>ä¸€èˆ¬æ˜¯è¿™æ ·åšï¼Œæœ‰ä¸€ä¸ª Controller æ ‡è®°ä¸º VERSION_NEUTRALï¼Œå…¶ä»–ç‰ˆæœ¬çš„æ¥å£æ”¾åœ¨å•ç‹¬ Controller é‡Œ</p>
<p>æ³¨æ„ï¼Œcontroller ä¹‹é—´åŒæ ·è¦æ³¨æ„é¡ºåºï¼Œå‰é¢çš„ controller å…ˆç”Ÿæ•ˆ</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e6363feecf24bbfab38aa104f90cea4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771053988&amp;x-signature=FIbnepUIxcGwNxO4LAwukDT8hTk%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f713fc86cf7443c9a9eb3f0b3529c9f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771053988&amp;x-signature=ISePu7Tde%2BZQlgAq45IRVTs4Ngo%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a146f38867c40f88d70474f973f1d9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771053988&amp;x-signature=Koz4JlBdveqzpaSB1op4FZxmVhY%3D" alt="image.png" loading="lazy"/></p>
<p>é™¤äº†ç”¨è‡ªå®šä¹‰ header æºå¸¦ç‰ˆæœ¬å·ï¼Œè¿˜å¯ä»¥è¿™æ ·</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e435174259f499680e14846b2d63791~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771053988&amp;x-signature=st5HKqbFxsBZtT%2FFQ%2BdGYXPftIQ%3D" alt="image.png" loading="lazy"/></p>
<p>æ­¤å¤„éœ€è¦è¿™æ ·å†™</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5eadb8b5f26f48459531660245028ab4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771053988&amp;x-signature=fyZ0fRrqnPvK985PaEVvO9kxAig%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4faf234978d40458eff2ebfaeea2d5a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771053988&amp;x-signature=clttUmcpszSgWQ7aAcoNck0RqF8%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e18e90c0ef34bf3863549f06345c2e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771053988&amp;x-signature=7fh8QvJvk7CgVjrlRPLqpPqYzFo%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™äº›æŒ‡å®šç‰ˆæœ¬å·çš„æ–¹å¼éƒ½ä¸æ»¡è¶³éœ€æ±‚ï¼Œå¯ä»¥è‡ªå·±å†™</p>
<p>main.ts</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NestFactory</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/core'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AppModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./app.module'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">VersioningType</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">bootstrap</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> app = <span class="hljs-keyword">await</span> <span class="hljs-title class_">NestFactory</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">AppModule</span>);

  <span class="hljs-comment">//   app.enableVersioning({</span>
  <span class="hljs-comment">// type: VersioningType.HEADER,</span>
  <span class="hljs-comment">// header: 'version',</span>

  <span class="hljs-comment">//     type: VersioningType.URI,</span>
  <span class="hljs-comment">//   });</span>

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">extractor</span> = (<span class="hljs-params">request: Request</span>) =&gt; {
    <span class="hljs-keyword">if</span> (request.<span class="hljs-property">headers</span>[<span class="hljs-string">'disable-custom'</span>]) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
    }
    <span class="hljs-keyword">return</span> request.<span class="hljs-property">url</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'fuhao'</span>) ? <span class="hljs-string">'2'</span> : <span class="hljs-string">'1'</span>;
  };

  app.<span class="hljs-title function_">enableVersioning</span>({
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">VersioningType</span>.<span class="hljs-property">CUSTOM</span>,
    extractor,
  });

  <span class="hljs-keyword">await</span> app.<span class="hljs-title function_">listen</span>(process.<span class="hljs-property">env</span>.<span class="hljs-property">PORT</span> ?? <span class="hljs-number">3000</span>);
}
<span class="hljs-title function_">bootstrap</span>();

</code></pre>
<p>å¦‚æœ url é‡ŒåŒ…å« fuhaoï¼Œå°±è¿”å›ç‰ˆæœ¬ 2 çš„æ¥å£ï¼Œå¦åˆ™è¿”å›ç‰ˆæœ¬ 1</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e35fdc89a9241a585e6789f46428c16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771053988&amp;x-signature=blhy1wBNOUQX8abH4V4ojb0LGYs%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/433168c969a347c9bfe8f2ec09acbf7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771053988&amp;x-signature=P8PW1rMsqvb0C4vez6L7kdSrGqg%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74a6bfe1872b4483b21b36a8585c7544~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771053988&amp;x-signature=9fwqsIfaOfohuMkFDSG2J8wIiwE%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Calibre ç”µå­ä¹¦ç®¡ç†å™¨ï¼šè·¨å¹³å°ã€å…¨åŠŸèƒ½çš„å¼€æºè§£å†³æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7603595309232521226</link>    <guid>https://juejin.cn/post/7603595309232521226</guid>    <pubDate>2026-02-07T06:33:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603595309232521226" data-draft-id="7603567912593276955" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Calibre ç”µå­ä¹¦ç®¡ç†å™¨ï¼šè·¨å¹³å°ã€å…¨åŠŸèƒ½çš„å¼€æºè§£å†³æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½,AIGC"/> <meta itemprop="datePublished" content="2026-02-07T06:33:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="qife122"/> <meta itemprop="url" content="https://juejin.cn/user/1743174852185579"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Calibre ç”µå­ä¹¦ç®¡ç†å™¨ï¼šè·¨å¹³å°ã€å…¨åŠŸèƒ½çš„å¼€æºè§£å†³æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1743174852185579/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    qife122
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T06:33:19.000Z" title="Sat Feb 07 2026 06:33:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Calibreï¼šå…¨èƒ½ç”µå­ä¹¦ç®¡ç†å™¨</h2>
<p>Calibre æ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„ç”µå­ä¹¦ç®¡ç†å™¨ã€‚å®ƒèƒ½å¤ŸæŸ¥çœ‹ã€è½¬æ¢ã€ç¼–è¾‘å’Œç¼–ç›®æ‰€æœ‰ä¸»æµç”µå­ä¹¦æ ¼å¼ï¼Œè¿˜å¯ä»¥ä¸ç”µå­ä¹¦é˜…è¯»å™¨è®¾å¤‡é€šä¿¡ã€‚Calibre èƒ½å¤Ÿä»äº’è”ç½‘è·å–å›¾ä¹¦å…ƒæ•°æ®ï¼Œä¸‹è½½æ–°é—»å¹¶è½¬æ¢ä¸ºç”µå­ä¹¦ä»¥ä¾¿é˜…è¯»ã€‚å®ƒæ˜¯è·¨å¹³å°çš„ï¼Œå¯ä»¥åœ¨ Linuxã€Windows å’Œ macOS ä¸Šè¿è¡Œã€‚</p>
<h3 data-id="heading-1">åŠŸèƒ½ç‰¹æ€§</h3>
<ul>
<li><strong>ç”µå­ä¹¦æŸ¥çœ‹ä¸è½¬æ¢</strong>ï¼šæ”¯æŒæ‰€æœ‰ä¸»æµç”µå­ä¹¦æ ¼å¼çš„æŸ¥çœ‹å’Œäº’ç›¸è½¬æ¢ã€‚</li>
<li><strong>å…ƒæ•°æ®ç®¡ç†</strong>ï¼šè‡ªåŠ¨ä»äº’è”ç½‘è·å–å›¾ä¹¦å°é¢ã€ä½œè€…ã€ç®€ä»‹ç­‰å…ƒæ•°æ®ã€‚</li>
<li><strong>è®¾å¤‡åŒæ­¥</strong>ï¼šä¸å„ç§ç”µå­ä¹¦é˜…è¯»å™¨è®¾å¤‡æ— ç¼è¿æ¥å’ŒåŒæ­¥ã€‚</li>
<li><strong>æ–°é—»ä¸‹è½½</strong>ï¼šå°†æ–°é—»ç½‘ç«™å†…å®¹ä¸‹è½½å¹¶è½¬æ¢ä¸ºç”µå­ä¹¦æ ¼å¼ã€‚</li>
<li><strong>å›¾ä¹¦ç¼–ç›®</strong>ï¼šå¼ºå¤§çš„å›¾ä¹¦é¦†ç®¡ç†åŠŸèƒ½ï¼Œæ”¯æŒè‡ªå®šä¹‰åˆ†ç±»å’Œæ™ºèƒ½æ”¶è—ã€‚</li>
<li><strong>æ’ä»¶ç³»ç»Ÿ</strong>ï¼šæ”¯æŒé€šè¿‡æ’ä»¶æ‰©å±•åŠŸèƒ½ã€‚</li>
<li><strong>å†…ç½®é˜…è¯»å™¨</strong>ï¼šåŒ…å«åŠŸèƒ½å®Œæ•´çš„ç”µå­ä¹¦é˜…è¯»å™¨ã€‚</li>
<li><strong>å‘½ä»¤è¡Œå·¥å…·</strong>ï¼šæä¾›å®Œæ•´çš„å‘½ä»¤è¡Œç•Œé¢ï¼Œæ”¯æŒè‡ªåŠ¨åŒ–æ“ä½œã€‚</li>
<li><strong>å†…å®¹æœåŠ¡å™¨</strong>ï¼šå†…ç½® Web æœåŠ¡å™¨ï¼Œå¯åœ¨æµè§ˆå™¨ä¸­è®¿é—®ç”µå­ä¹¦åº“ã€‚</li>
<li><strong>è·¨å¹³å°æ”¯æŒ</strong>ï¼šåŸç”Ÿæ”¯æŒ Linuxã€Windows å’Œ macOS ç³»ç»Ÿã€‚</li>
</ul>
<h3 data-id="heading-2">å®‰è£…æŒ‡å—</h3>
<h4 data-id="heading-3">ç›´æ¥ä¸‹è½½å®‰è£…</h4>
<p>è®¿é—® <a href="https://link.juejin.cn?target=https%3A%2F%2Fcalibre-ebook.com%2F" target="_blank" title="https://calibre-ebook.com/" ref="nofollow noopener noreferrer">calibre-ebook.com</a> ä¸‹è½½é€‚åˆæ‚¨æ“ä½œç³»ç»Ÿçš„å®‰è£…åŒ…ï¼š</p>
<ul>
<li><strong>Windows</strong>ï¼š.exe å®‰è£…ç¨‹åº</li>
<li><strong>macOS</strong>ï¼š.dmg ç£ç›˜æ˜ åƒ</li>
<li><strong>Linux</strong>ï¼šäºŒè¿›åˆ¶å®‰è£…åŒ…æˆ–é€šè¿‡åŒ…ç®¡ç†å™¨å®‰è£…</li>
</ul>
<h4 data-id="heading-4">ä»æºç æ„å»º</h4>
<ol>
<li>
<p>å…‹éš†ä»“åº“ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/kovidgoyal/calibre.git
<span class="hljs-built_in">cd</span> calibre
</code></pre>
</li>
<li>
<p>è®¾ç½®å¼€å‘ç¯å¢ƒï¼š</p>
<pre><code class="hljs language-bash" lang="bash">python setup.py develop
</code></pre>
</li>
<li>
<p>æ„å»ºä¾èµ–é¡¹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">python setup.py build_dep
</code></pre>
</li>
</ol>
<h4 data-id="heading-5">ç³»ç»Ÿè¦æ±‚</h4>
<ul>
<li><strong>Python</strong> 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬</li>
<li><strong>Qt</strong> 6 åº“</li>
<li>å„å¹³å°ç‰¹å®šçš„ä¾èµ–åº“ï¼ˆåœ¨æ„å»ºè¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨å¤„ç†ï¼‰</li>
</ul>
<h3 data-id="heading-6">ä½¿ç”¨è¯´æ˜</h3>
<h4 data-id="heading-7">åŸºç¡€ä½¿ç”¨</h4>
<p>å¯åŠ¨ Calibre å›¾å½¢ç•Œé¢ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">calibre
</code></pre>
<p>ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·è½¬æ¢ç”µå­ä¹¦ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">ebook-convert input.epub output.mobi
</code></pre>
<p>å¯åŠ¨å†…å®¹æœåŠ¡å™¨ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">calibre-server
</code></pre>
<h4 data-id="heading-8">æ ¸å¿ƒå·¥å…·</h4>
<p>Calibre åŒ…å«å¤šä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼š</p>
<ul>
<li><code>calibre</code> - ä¸»å›¾å½¢ç•Œé¢ç¨‹åº</li>
<li><code>ebook-viewer</code> - ç”µå­ä¹¦æŸ¥çœ‹å™¨</li>
<li><code>ebook-edit</code> - ç”µå­ä¹¦ç¼–è¾‘å™¨</li>
<li><code>ebook-convert</code> - æ ¼å¼è½¬æ¢å·¥å…·</li>
<li><code>calibredb</code> - æ•°æ®åº“ç®¡ç†å·¥å…·</li>
<li><code>calibre-server</code> - å†…å®¹æœåŠ¡å™¨</li>
<li><code>calibre-customize</code> - æ’ä»¶ç®¡ç†å·¥å…·</li>
</ul>
<h4 data-id="heading-9">API ä½¿ç”¨ç¤ºä¾‹</h4>
<p>Calibre æä¾›ä¸°å¯Œçš„ Python APIï¼Œå¯ç”¨äºè‡ªåŠ¨åŒ–å¤„ç†ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> calibre.ebooks.conversion.cli <span class="hljs-keyword">import</span> main <span class="hljs-keyword">as</span> convert_main
<span class="hljs-keyword">from</span> calibre.library <span class="hljs-keyword">import</span> db

<span class="hljs-comment"># åˆå§‹åŒ–æ•°æ®åº“è¿æ¥</span>
library_db = db(<span class="hljs-string">'/path/to/calibre/library'</span>)

<span class="hljs-comment"># è·å–æ‰€æœ‰å›¾ä¹¦</span>
all_books = library_db.new_api.all_book_ids()

<span class="hljs-comment"># è½¬æ¢ç”µå­ä¹¦æ ¼å¼</span>
convert_main([<span class="hljs-string">'input.epub'</span>, <span class="hljs-string">'output.mobi'</span>, <span class="hljs-string">'--output-profile'</span>, <span class="hljs-string">'kindle'</span>])
</code></pre>
<h3 data-id="heading-10">æ ¸å¿ƒä»£ç è§£æ</h3>
<h4 data-id="heading-11">å¯åŠ¨å™¨æ ¸å¿ƒä»£ç ï¼ˆCè¯­è¨€å®ç°ï¼‰</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">/*
 * launcher.c
 * è·¨å¹³å°å¯åŠ¨å™¨å®ç°
 * è®¾ç½®ç¯å¢ƒå˜é‡å¹¶æ‰§è¡Œä¸»ç¨‹åº
 */</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> PATHLEN 1023</span>

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> **argv)</span> {
    <span class="hljs-type">static</span> <span class="hljs-type">char</span> buf[PATHLEN+<span class="hljs-number">1</span>] = {<span class="hljs-number">0</span>}, lib[PATHLEN+<span class="hljs-number">1</span>] = {<span class="hljs-number">0</span>}, base[PATHLEN+<span class="hljs-number">1</span>] = {<span class="hljs-number">0</span>}, exe[PATHLEN+<span class="hljs-number">1</span>] = {<span class="hljs-number">0</span>}, *ldp = <span class="hljs-literal">NULL</span>;

    <span class="hljs-comment">// è¯»å–å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„</span>
    <span class="hljs-keyword">if</span> (readlink(<span class="hljs-string">"/proc/self/exe"</span>, buf, PATHLEN) == <span class="hljs-number">-1</span>) {
        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Failed to read path of executable with error: %s\n"</span>, strerror(errno));
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    }
    
    <span class="hljs-comment">// è®¾ç½®ç¯å¢ƒå˜é‡</span>
    SET(<span class="hljs-string">"CALIBRE_QT_PREFIX"</span>, base)
    SET(<span class="hljs-string">"LD_LIBRARY_PATH"</span>, buf)
    SET(<span class="hljs-string">"OPENSSL_MODULES"</span>, buf)

    <span class="hljs-comment">// æ‰§è¡Œä¸»ç¨‹åº</span>
    argv[<span class="hljs-number">0</span>] = exe;
    <span class="hljs-keyword">if</span> (execv(exe, argv) == <span class="hljs-number">-1</span>) {
        <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">"Failed to execute binary: %s with error: %s\n"</span>, exe, strerror(errno));
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    }

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h4 data-id="heading-12">Python æ‰©å±•æ„å»ºç³»ç»Ÿ</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-comment"># setup.py - Calibre æ„å»ºç³»ç»Ÿæ ¸å¿ƒ</span>
<span class="hljs-string">"""
Calibre æ‰©å±•æ„å»ºç³»ç»Ÿï¼Œæ”¯æŒå¤šå¹³å°ç¼–è¯‘å’Œæ‰“åŒ…
"""</span>
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> re
<span class="hljs-keyword">import</span> sys

src_base = os.path.dirname(os.path.abspath(__file__))

<span class="hljs-keyword">def</span> <span class="hljs-title function_">check_version_info</span>():
    <span class="hljs-string">"""æ£€æŸ¥ Python ç‰ˆæœ¬è¦æ±‚"""</span>
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(os.path.join(src_base, <span class="hljs-string">'pyproject.toml'</span>)) <span class="hljs-keyword">as</span> f:
        raw = f.read()
    m = re.search(<span class="hljs-string">r'''^requires-python\s*=\s*['"](.+?)['"]'''</span>, raw, flags=re.MULTILINE)
    <span class="hljs-keyword">assert</span> m <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>
    minver = m.group(<span class="hljs-number">1</span>)
    <span class="hljs-comment"># éªŒè¯ç‰ˆæœ¬å…¼å®¹æ€§</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> is_ok:
        sys.exit(<span class="hljs-string">f'calibre requires Python <span class="hljs-subst">{minver}</span>. Current Python version: <span class="hljs-subst">{<span class="hljs-string">"."</span>.join(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">str</span>, sys.version_info[:<span class="hljs-number">3</span>]))}</span>'</span>)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Extension</span>:
    <span class="hljs-string">"""æ‰©å±•æ¨¡å—å®šä¹‰ç±»"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, sources, **kwargs</span>):
        self.data = d = {}
        self.name = d[<span class="hljs-string">'name'</span>] = name
        self.sources = d[<span class="hljs-string">'sources'</span>] = absolutize(sources)
        self.needs_cxx = d[<span class="hljs-string">'needs_cxx'</span>] = <span class="hljs-built_in">bool</span>([<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> self.sources <span class="hljs-keyword">if</span> os.path.splitext(x)[<span class="hljs-number">1</span>] <span class="hljs-keyword">in</span> (<span class="hljs-string">'.cpp'</span>, <span class="hljs-string">'.c++'</span>, <span class="hljs-string">'.cxx'</span>)])
        self.headers = d[<span class="hljs-string">'headers'</span>] = absolutize(kwargs.get(<span class="hljs-string">'headers'</span>, []))
        self.inc_dirs = d[<span class="hljs-string">'inc_dirs'</span>] = absolutize(kwargs.get(<span class="hljs-string">'inc_dirs'</span>, []))
        self.lib_dirs = d[<span class="hljs-string">'lib_dirs'</span>] = absolutize(kwargs.get(<span class="hljs-string">'lib_dirs'</span>, []))
</code></pre>
<h4 data-id="heading-13">å†»ç»“æ‰“åŒ…ç³»ç»Ÿ</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-comment"># freeze.py - åº”ç”¨å†»ç»“å’Œæ‰“åŒ…</span>
<span class="hljs-string">"""
å°† Python åº”ç”¨æ‰“åŒ…ä¸ºç‹¬ç«‹å¯æ‰§è¡Œæ–‡ä»¶
"""</span>
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> shutil
<span class="hljs-keyword">import</span> subprocess
<span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> partial

<span class="hljs-keyword">from</span> bypy.constants <span class="hljs-keyword">import</span> LIBDIR, PREFIX, python_major_minor_version
<span class="hljs-keyword">from</span> bypy.utils <span class="hljs-keyword">import</span> run_shell

<span class="hljs-keyword">def</span> <span class="hljs-title function_">binary_includes</span>():
    <span class="hljs-string">"""æ”¶é›†äºŒè¿›åˆ¶ä¾èµ–æ–‡ä»¶"""</span>
    ffmpeg_dlls = <span class="hljs-built_in">tuple</span>(os.path.basename(x).partition(<span class="hljs-string">'.'</span>)[<span class="hljs-number">0</span>][<span class="hljs-number">3</span>:] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> glob.glob(os.path.join(FFMPEG_PREFIX, <span class="hljs-string">'*.so'</span>)))
    <span class="hljs-keyword">return</span> [
        j(PREFIX, <span class="hljs-string">'bin'</span>, x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> (<span class="hljs-string">'pdftohtml'</span>, <span class="hljs-string">'pdfinfo'</span>, <span class="hljs-string">'pdftoppm'</span>, <span class="hljs-string">'pdftotext'</span>, <span class="hljs-string">'optipng'</span>, <span class="hljs-string">'cwebp'</span>, <span class="hljs-string">'JxrDecApp'</span>)] + [
        j(PREFIX, <span class="hljs-string">'private'</span>, <span class="hljs-string">'mozjpeg'</span>, <span class="hljs-string">'bin'</span>, x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> (<span class="hljs-string">'jpegtran'</span>, <span class="hljs-string">'cjpeg'</span>)] + <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(
            get_dll_path,
            (<span class="hljs-string">'usb-1.0 mtp expat ffi z lzma openjp2 poppler dbus-1 iconv xml2 xslt jpeg png16'</span>
             <span class="hljs-string">' webp webpmux webpdemux sharpyuv exslt ncursesw readline chm hunspell-1.7 hyphen'</span>
             <span class="hljs-string">' icudata icui18n icuuc icuio stemmer gcrypt gpg-error uchardet graphite2 espeak-ng'</span>
             <span class="hljs-string">' brotlicommon brotlidec brotlienc zstd podofo ssl crypto deflate tiff onnxruntime'</span>
             <span class="hljs-string">' gobject-2.0 glib-2.0'</span>)
        ))
</code></pre>
<h4 data-id="heading-14">æ’ä»¶ç³»ç»Ÿæ¶æ„</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-comment"># æ’ä»¶ç³»ç»Ÿç¤ºä¾‹</span>
<span class="hljs-string">"""
Calibre æ’ä»¶ç³»ç»Ÿæ¶æ„ç¤ºä¾‹
"""</span>
<span class="hljs-keyword">import</span> builtins
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> sys

<span class="hljs-comment"># æ’ä»¶åŸºç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">FileTypePlugin</span>:
    <span class="hljs-string">"""æ–‡ä»¶ç±»å‹æ’ä»¶åŸºç±»"""</span>
    name = <span class="hljs-string">'æ’ä»¶åç§°'</span>
    description = <span class="hljs-string">'æ’ä»¶æè¿°'</span>
    supported_platforms = [<span class="hljs-string">'windows'</span>, <span class="hljs-string">'osx'</span>, <span class="hljs-string">'linux'</span>]
    author = <span class="hljs-string">'ä½œè€…'</span>
    version = (<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
    file_types = {<span class="hljs-string">'epub'</span>, <span class="hljs-string">'mobi'</span>}
    on_postprocess = <span class="hljs-literal">True</span>
    minimum_calibre_version = (<span class="hljs-number">0</span>, <span class="hljs-number">7</span>, <span class="hljs-number">53</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self, path_to_ebook</span>):
        <span class="hljs-string">"""æ’ä»¶ä¸»é€»è¾‘"""</span>
        <span class="hljs-keyword">from</span> calibre.ebooks.metadata.meta <span class="hljs-keyword">import</span> get_metadata, set_metadata
        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(path_to_ebook, <span class="hljs-string">'r+b'</span>) <span class="hljs-keyword">as</span> file:
            ext = os.path.splitext(path_to_ebook)[-<span class="hljs-number">1</span>][<span class="hljs-number">1</span>:].lower()
            mi = get_metadata(file, ext)
            <span class="hljs-comment"># ä¿®æ”¹å…ƒæ•°æ®</span>
            mi.publisher = <span class="hljs-string">'Hello World'</span>
            set_metadata(file, mi, ext)
        <span class="hljs-keyword">return</span> path_to_ebook
</code></pre>
<h4 data-id="heading-15">è·¨å¹³å°æ„å»ºé…ç½®</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-comment"># è·¨å¹³å°æ„å»ºé…ç½®</span>
<span class="hljs-string">"""
å¤„ç†ä¸åŒå¹³å°çš„æ„å»ºå·®å¼‚
"""</span>
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> sys

<span class="hljs-comment"># å¹³å°æ£€æµ‹</span>
iswindows = re.search(<span class="hljs-string">r'win(32|64)'</span>, sys.platform)
ismacos = <span class="hljs-string">'darwin'</span> <span class="hljs-keyword">in</span> sys.platform
islinux = <span class="hljs-keyword">not</span> ismacos <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> iswindows <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> isbsd <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> ishaiku

<span class="hljs-comment"># å¹³å°ç‰¹å®šé…ç½®</span>
<span class="hljs-keyword">if</span> iswindows:
    <span class="hljs-comment"># Windows ç‰¹å®šè®¾ç½®</span>
    <span class="hljs-keyword">from</span> setup.vcvars <span class="hljs-keyword">import</span> query_vcvarsall
    env = query_vcvarsall()
    win_path = env[<span class="hljs-string">'PATH'</span>]
    os.environ[<span class="hljs-string">'PATH'</span>] = merge_paths(env[<span class="hljs-string">'PATH'</span>], os.environ[<span class="hljs-string">'PATH'</span>])
<span class="hljs-keyword">elif</span> ismacos:
    <span class="hljs-comment"># macOS ç‰¹å®šè®¾ç½®</span>
    ENV = <span class="hljs-built_in">dict</span>(
        FONTCONFIG_PATH=<span class="hljs-string">'@executable_path/../Resources/fonts'</span>,
        FONTCONFIG_FILE=<span class="hljs-string">'@executable_path/../Resources/fonts/fonts.conf'</span>,
        SSL_CERT_FILE=<span class="hljs-string">'@executable_path/../Resources/resources/mozilla-ca-certs.pem'</span>,
    )
<span class="hljs-keyword">elif</span> islinux:
    <span class="hljs-comment"># Linux ç‰¹å®šè®¾ç½®</span>
    os.environ[<span class="hljs-string">'LD_LIBRARY_PATH'</span>] = os.path.join(PREFIX, <span class="hljs-string">'lib'</span>)
</code></pre>
<h4 data-id="heading-16">å›½é™…åŒ–æ”¯æŒç³»ç»Ÿ</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-comment"># å›½é™…åŒ–ç³»ç»Ÿ</span>
<span class="hljs-string">"""
å¤„ç†å¤šè¯­è¨€ç¿»è¯‘å’Œæœ¬åœ°åŒ–
"""</span>
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict

<span class="hljs-keyword">def</span> <span class="hljs-title function_">serialize_msgid</span>(<span class="hljs-params">text</span>):
    <span class="hljs-string">'''æŒ‰ç…§ GNU POT æ ¼å¼åºåˆ—åŒ–å­—ç¬¦ä¸²'''</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> text:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'msgid ""\n'</span>
    <span class="hljs-comment"># è½¬ä¹‰åæ–œæ å’Œå¼•å·</span>
    escaped = text.replace(<span class="hljs-string">'\\'</span>, <span class="hljs-string">r'\\'</span>).replace(<span class="hljs-string">'"'</span>, <span class="hljs-string">r'\"'</span>)
    ans = [<span class="hljs-string">'msgid ""'</span>]
    lines = escaped.splitlines()
    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:
        trailer = <span class="hljs-string">'"'</span> <span class="hljs-keyword">if</span> line <span class="hljs-keyword">is</span> lines[-<span class="hljs-number">1</span>] <span class="hljs-keyword">else</span> <span class="hljs-string">r'\n"'</span>
        ans.append(<span class="hljs-string">f'"<span class="hljs-subst">{line}</span><span class="hljs-subst">{trailer}</span>'</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-string">'\n'</span>.join(ans)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TranslationManager</span>:
    <span class="hljs-string">"""ç¿»è¯‘ç®¡ç†å™¨"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.translations = defaultdict(<span class="hljs-built_in">dict</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_translation</span>(<span class="hljs-params">self, language, key, value</span>):
        <span class="hljs-string">"""æ·»åŠ ç¿»è¯‘"""</span>
        self.translations[language][key] = value
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_pot_file</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""ç”Ÿæˆ POT æ¨¡æ¿æ–‡ä»¶"""</span>
        pot_content = []
        pot_content.append(<span class="hljs-string">'msgid ""'</span>)
        pot_content.append(<span class="hljs-string">'msgstr ""'</span>)
        pot_content.append(<span class="hljs-string">'"Content-Type: text/plain; charset=UTF-8\\n"'</span>)
        
        <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> <span class="hljs-built_in">sorted</span>(self.translations[<span class="hljs-string">'en'</span>].keys()):
            pot_content.append(<span class="hljs-string">''</span>)
            pot_content.append(serialize_msgid(key))
            pot_content.append(<span class="hljs-string">'msgstr ""'</span>)
        
        <span class="hljs-keyword">return</span> <span class="hljs-string">'\n'</span>.join(pot_content)
</code></pre>
<p>è¿™äº›ä»£ç å±•ç¤ºäº† Calibre çš„æ ¸å¿ƒæ¶æ„ï¼ŒåŒ…æ‹¬è·¨å¹³å°å¯åŠ¨å™¨ã€æ‰©å±•æ„å»ºç³»ç»Ÿã€æ’ä»¶æ¶æ„å’Œå›½é™…åŒ–æ”¯æŒã€‚é¡¹ç›®é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œæ¯ä¸ªç»„ä»¶éƒ½æœ‰æ¸…æ™°çš„èŒè´£åˆ†ç¦»ï¼Œä½¿å¾—ç»´æŠ¤å’Œæ‰©å±•å˜å¾—å®¹æ˜“ã€‚FINISHED
QEHhY4oFma5gLUWjolaPoAWVwAn3V7aQMaT4L47PbMQ=</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Scrapyæ¡†æ¶å…¥é—¨æŒ‡å—]]></title>    <link>https://juejin.cn/post/7603588665567494184</link>    <guid>https://juejin.cn/post/7603588665567494184</guid>    <pubDate>2026-02-07T05:27:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603588665567494184" data-draft-id="7603563360330203178" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Scrapyæ¡†æ¶å…¥é—¨æŒ‡å—"/> <meta itemprop="keywords" content="Python,Scrapy"/> <meta itemprop="datePublished" content="2026-02-07T05:27:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°å°å¼ è¯´æ•…äº‹"/> <meta itemprop="url" content="https://juejin.cn/user/741501567509111"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Scrapyæ¡†æ¶å…¥é—¨æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/741501567509111/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°å°å¼ è¯´æ•…äº‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T05:27:55.000Z" title="Sat Feb 07 2026 05:27:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. Scrapyçš„æ¦‚è§ˆä¸æ ¸å¿ƒä»·å€¼</h2>
<p>æƒ³è±¡ä¸€ä¸‹,å¦‚æœä½ éœ€è¦ä»æˆåƒä¸Šä¸‡ä¸ªç½‘é¡µä¸­æå–ç»“æ„åŒ–æ•°æ®,ç”¨ä¼ ç»Ÿçš„<code>requests</code> + <code>BeautifulSoup</code>æ–¹å¼å°±åƒç”¨å‹ºå­æŒ–åœŸâ€”â€”è™½ç„¶å¯è¡Œ,ä½†æ•ˆç‡ä½ä¸‹ä¸”éš¾ä»¥ç»´æŠ¤ã€‚<code>Scrapy</code>æ­£æ˜¯ä¸ºè§£å†³å¤§è§„æ¨¡ã€é«˜æ€§èƒ½æ•°æ®æŠ“å–éœ€æ±‚è€Œç”Ÿçš„å·¥ä¸šçº§çˆ¬è™«æ¡†æ¶ã€‚</p>
<p>åœ¨Pythonç”Ÿæ€ç³»ç»Ÿä¸­,Scrapyå æ®äº†ä¸å¯æ›¿ä»£çš„åœ°ä½ã€‚å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªçˆ¬è™«åº“,æ›´æ˜¯ä¸€ä¸ªå®Œæ•´çš„çˆ¬è™«å¼€å‘æ¡†æ¶,å°†æ•°æ®æŠ“å–çš„æ•´ä¸ªæµç¨‹â€”â€”ä»è¯·æ±‚è°ƒåº¦ã€ç½‘é¡µä¸‹è½½ã€æ•°æ®æå–åˆ°æŒä¹…åŒ–å­˜å‚¨â€”â€”å°è£…æˆäº†ä¸€å¥—æ ‡å‡†åŒ–çš„æµæ°´çº¿ç³»ç»Ÿã€‚è¿™ç§æ¨¡å—åŒ–è®¾è®¡è®©å¼€å‘è€…èƒ½å¤Ÿä¸“æ³¨äº"çˆ¬ä»€ä¹ˆ"è€Œé"æ€ä¹ˆçˆ¬",æå¤§æå‡äº†å¼€å‘æ•ˆç‡ã€‚</p>
<p>Scrapyçš„ç‹¬ç‰¹ä»·å€¼åœ¨äºå…¶åŸºäºTwistedå¼‚æ­¥ç½‘ç»œæ¡†æ¶çš„äº‹ä»¶é©±åŠ¨æ¶æ„,èƒ½å¤Ÿä»¥å•çº¿ç¨‹å®ç°é«˜å¹¶å‘è¯·æ±‚å¤„ç†,åœ¨ä¸å¢åŠ ç¡¬ä»¶èµ„æºçš„å‰æä¸‹è·å¾—10å€äºä¼ ç»Ÿçˆ¬è™«çš„æŠ“å–é€Ÿåº¦ã€‚åŒæ—¶,å®ƒå†…ç½®çš„è¯·æ±‚å»é‡ã€è‡ªåŠ¨é‡è¯•ã€ç”¨æˆ·ä»£ç†è½®æ¢ç­‰åçˆ¬æœºåˆ¶,è®©å¼€å‘è€…èƒ½å¤Ÿå¿«é€Ÿæ„å»ºç¨³å®šå¯é çš„çˆ¬è™«ç³»ç»Ÿã€‚</p>
<h2 data-id="heading-1">2. ç¯å¢ƒæ­å»ºä¸"Hello, World"</h2>
<h3 data-id="heading-2">å®‰è£…Scrapy</h3>
<p>Scrapyæ”¯æŒPython 3.7åŠä»¥ä¸Šç‰ˆæœ¬,æ¨èä½¿ç”¨Python 3.8+ä»¥è·å¾—æœ€ä½³å…¼å®¹æ€§ã€‚å®‰è£…æ–¹å¼å¦‚ä¸‹:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨pipå®‰è£…(æ¨èä½¿ç”¨å›½å†…é•œåƒæºåŠ é€Ÿ)</span>
pip install scrapy -i https://pypi.douban.com/simple

<span class="hljs-comment"># éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ</span>
scrapy version
</code></pre>
<p>å¦‚æœçœ‹åˆ°ç±»ä¼¼<code>Scrapy 2.11.0</code>çš„ç‰ˆæœ¬å·è¾“å‡º,è¯´æ˜å®‰è£…æˆåŠŸã€‚å¯¹äºWindowsç”¨æˆ·,å¯èƒ½éœ€è¦å…ˆå®‰è£…Microsoft Visual C++ Build Toolsä»¥è§£å†³æŸäº›ä¾èµ–åŒ…çš„ç¼–è¯‘é—®é¢˜ã€‚</p>
<h3 data-id="heading-3">ç¬¬ä¸€ä¸ªScrapyçˆ¬è™«</h3>
<p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæœ€ç®€å•çš„çˆ¬è™«æ¥æŠ“å–quotes.toscrape.comç½‘ç«™çš„åŠ±å¿—åè¨€:</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> scrapy

<span class="hljs-keyword">class</span> <span class="hljs-title class_">QuotesSpider</span>(scrapy.Spider):
    <span class="hljs-comment"># çˆ¬è™«çš„å”¯ä¸€æ ‡è¯†ç¬¦</span>
    name = <span class="hljs-string">'quotes'</span>
    
    <span class="hljs-comment"># èµ·å§‹URLåˆ—è¡¨</span>
    start_urls = [<span class="hljs-string">'http://quotes.toscrape.com/page/1/'</span>]
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">parse</span>(<span class="hljs-params">self, response</span>):
        <span class="hljs-comment"># éå†é¡µé¢ä¸­çš„æ¯ä¸ªåè¨€</span>
        <span class="hljs-keyword">for</span> quote <span class="hljs-keyword">in</span> response.css(<span class="hljs-string">'div.quote'</span>):
            <span class="hljs-comment"># æå–åè¨€å†…å®¹ã€ä½œè€…å’Œæ ‡ç­¾</span>
            <span class="hljs-keyword">yield</span> {
                <span class="hljs-string">'text'</span>: quote.css(<span class="hljs-string">'span.text::text'</span>).get(),
                <span class="hljs-string">'author'</span>: quote.css(<span class="hljs-string">'small.author::text'</span>).get(),
                <span class="hljs-string">'tags'</span>: quote.css(<span class="hljs-string">'a.tag::text'</span>).getall(),
            }
        
        <span class="hljs-comment"># æŸ¥æ‰¾ä¸‹ä¸€é¡µé“¾æ¥å¹¶ç»§ç»­çˆ¬å–</span>
        next_page = response.css(<span class="hljs-string">'li.next a::attr(href)'</span>).get()
        <span class="hljs-keyword">if</span> next_page <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">yield</span> response.follow(next_page, callback=self.parse)
</code></pre>
<p><strong>ä»£ç é€è¡Œè§£æ:</strong></p>
<ul>
<li><code>class QuotesSpider(scrapy.Spider)</code>: ç»§æ‰¿Scrapyçš„SpideråŸºç±»,æ‰€æœ‰è‡ªå®šä¹‰çˆ¬è™«éƒ½å¿…é¡»è¿™æ ·åš</li>
<li><code>name = 'quotes'</code>: å®šä¹‰çˆ¬è™«åç§°,è¿è¡Œçˆ¬è™«æ—¶ä¼šç”¨åˆ°è¿™ä¸ªæ ‡è¯†ç¬¦,å¿…é¡»åœ¨é¡¹ç›®ä¸­å”¯ä¸€</li>
<li><code>start_urls = [...]</code>: å®šä¹‰çˆ¬è™«çš„èµ·å§‹URLåˆ—è¡¨,Scrapyä¼šè‡ªåŠ¨ä¸ºæ¯ä¸ªURLåˆ›å»ºè¯·æ±‚</li>
<li><code>def parse(self, response)</code>: é»˜è®¤çš„å›è°ƒå‡½æ•°,å¤„ç†å“åº”çš„å‡½æ•°åå›ºå®šä¸ºparse(é™¤éä½ æŒ‡å®šå…¶ä»–å›è°ƒ)</li>
<li><code>response.css(...)</code>: ä½¿ç”¨CSSé€‰æ‹©å™¨æå–æ•°æ®,Scrapyæ”¯æŒCSSå’ŒXPathä¸¤ç§é€‰æ‹©å™¨</li>
<li><code>yield {...}</code>: ç”Ÿæˆå­—å…¸æ•°æ®,è¿™äº›æ•°æ®ä¼šè¢«ä¼ é€’ç»™Item Pipelineè¿›è¡Œåç»­å¤„ç†</li>
<li><code>response.follow()</code>: åˆ›å»ºæ–°çš„è¯·æ±‚æ¥è·Ÿè¿›é“¾æ¥,ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯URL,ç¬¬äºŒä¸ªå‚æ•°æ˜¯å›è°ƒå‡½æ•°</li>
</ul>
<p><strong>è¿è¡Œç»“æœ:</strong></p>
<p>åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿è¡Œçˆ¬è™«:</p>
<pre><code class="hljs language-bash" lang="bash">scrapy crawl quotes -o quotes.json
</code></pre>
<p>è¿è¡Œå,Scrapyä¼šè‡ªåŠ¨ä»ç¬¬ä¸€é¡µå¼€å§‹æŠ“å–,æå–æ¯æ¡åè¨€çš„ä¿¡æ¯,å¹¶è‡ªåŠ¨ç¿»é¡µç›´åˆ°æŠ“å–å®Œæ‰€æœ‰é¡µé¢ã€‚æœ€ç»ˆæ•°æ®ä¼šä¿å­˜åœ¨<code>quotes.json</code>æ–‡ä»¶ä¸­,æ ¼å¼å¦‚ä¸‹:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"â€œThe world as we have created it is a process of our thinking. It cannot be changed without changing our thinking.â€"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"author"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Albert Einstein"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"tags"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"change"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"deep-thoughts"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"thinking"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"world"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    ...
<span class="hljs-punctuation">]</span>
</code></pre>
<h2 data-id="heading-4">3. æ ¸å¿ƒæ¦‚å¿µè§£æ</h2>
<p>Scrapyçš„æ ¸å¿ƒæ¶æ„å›´ç»•å‡ ä¸ªå…³é”®ç»„ä»¶å±•å¼€,ç†è§£è¿™äº›ç»„ä»¶çš„èŒè´£å’Œäº¤äº’æ–¹å¼æ˜¯æŒæ¡Scrapyçš„å…³é”®ã€‚</p>
<h3 data-id="heading-5">3.1 Spider(çˆ¬è™«)</h3>
<p>Spideræ˜¯ç”¨æˆ·ç¼–å†™çš„æ ¸å¿ƒé€»è¾‘æ¨¡å—,å®šä¹‰äº†:</p>
<ul>
<li>å¦‚ä½•çˆ¬å–ç½‘ç«™(èµ·å§‹URLã€å¦‚ä½•è·Ÿè¿›é“¾æ¥)</li>
<li>å¦‚ä½•è§£æé¡µé¢å†…å®¹(æå–æ•°æ®)</li>
<li>å¦‚ä½•å¤„ç†æå–åˆ°çš„æ•°æ®(ç”ŸæˆItemæˆ–æ–°çš„Request)</li>
</ul>
<p>æ¯ä¸ªSpiderå¿…é¡»ç»§æ‰¿<code>scrapy.Spider</code>åŸºç±»,å¹¶è‡³å°‘å®ç°<code>parse()</code>æ–¹æ³•ã€‚Spiderçš„å…¸å‹å·¥ä½œæµç¨‹æ˜¯:æ¥æ”¶Responseå¯¹è±¡ â†’ è§£æé¡µé¢ â†’ æå–æ•°æ®æˆ–ç”Ÿæˆæ–°Request â†’ yieldå‡ºå»ã€‚</p>
<h3 data-id="heading-6">3.2 Item(æ•°æ®é¡¹)</h3>
<p>Itemæ˜¯Scrapyæä¾›çš„æ•°æ®å®¹å™¨,ç±»ä¼¼äºPythonå­—å…¸ä½†æä¾›äº†å­—æ®µéªŒè¯åŠŸèƒ½ã€‚é€šè¿‡é¢„å®šä¹‰æ•°æ®ç»“æ„,Itemèƒ½å¤Ÿé¿å…å­—æ®µæ‹¼å†™é”™è¯¯å’Œç±»å‹æ··ä¹±ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> scrapy

<span class="hljs-keyword">class</span> <span class="hljs-title class_">QuoteItem</span>(scrapy.Item):
    text = scrapy.Field()
    author = scrapy.Field()
    tags = scrapy.Field()
</code></pre>
<p>ä½¿ç”¨Itemçš„å¥½å¤„åŒ…æ‹¬:</p>
<ul>
<li>å­—æ®µå®šä¹‰æ¸…æ™°,ä¾¿äºå›¢é˜Ÿåä½œ</li>
<li>æ”¯æŒæ•°æ®éªŒè¯å’Œç±»å‹æ£€æŸ¥</li>
<li>ä¸Pipelineé…åˆ,å®ç°æ•°æ®æ¸…æ´—çš„æ ‡å‡†åŒ–æµç¨‹</li>
</ul>
<h3 data-id="heading-7">3.3 Pipeline(ç®¡é“)</h3>
<p>Pipelineè´Ÿè´£å¤„ç†Spideræå–çš„Item,å…¸å‹æ“ä½œåŒ…æ‹¬:</p>
<ul>
<li>æ•°æ®æ¸…æ´—(å»é™¤ç©ºæ ¼ã€è½¬æ¢æ ¼å¼)</li>
<li>æ•°æ®éªŒè¯(æ£€æŸ¥å¿…å¡«å­—æ®µ)</li>
<li>æ•°æ®å»é‡(é¿å…é‡å¤å­˜å‚¨)</li>
<li>æŒä¹…åŒ–å­˜å‚¨(å­˜å…¥æ•°æ®åº“æˆ–æ–‡ä»¶)</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CleanPipeline</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_item</span>(<span class="hljs-params">self, item, spider</span>):
        <span class="hljs-comment"># å»é™¤æ–‡æœ¬é¦–å°¾ç©ºæ ¼</span>
        item[<span class="hljs-string">'text'</span>] = item[<span class="hljs-string">'text'</span>].strip()
        <span class="hljs-keyword">return</span> item

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabasePipeline</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.db_conn = <span class="hljs-literal">None</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">open_spider</span>(<span class="hljs-params">self, spider</span>):
        <span class="hljs-comment"># çˆ¬è™«å¯åŠ¨æ—¶å»ºç«‹æ•°æ®åº“è¿æ¥</span>
        self.db_conn = create_database_connection()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_item</span>(<span class="hljs-params">self, item, spider</span>):
        <span class="hljs-comment"># å°†itemå­˜å…¥æ•°æ®åº“</span>
        self.db_conn.insert(item)
        <span class="hljs-keyword">return</span> item
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">close_spider</span>(<span class="hljs-params">self, spider</span>):
        <span class="hljs-comment"># çˆ¬è™«å…³é—­æ—¶é‡Šæ”¾èµ„æº</span>
        self.db_conn.close()
</code></pre>
<h3 data-id="heading-8">æ ¸å¿ƒç»„ä»¶å…³ç³»å›¾</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[Spider] --&gt;|ç”ŸæˆRequest| B[Engine]
    B --&gt;|ä¼ é€’Request| C[Scheduler]
    C --&gt;|è¿”å›å¾…çˆ¬Request| B
    B --&gt;|ä¼ é€’Request| D[Downloader]
    D --&gt;|è¿”å›Response| B
    B --&gt;|ä¼ é€’Response| A
    A --&gt;|yield Item| B
    B --&gt;|ä¼ é€’Item| E[Pipeline]
    A --&gt;|yieldæ–°Request| B
    E --&gt;|å¤„ç†Item| F[Database/File]
    
    style A fill:#e1f5ff
    style B fill:#fff4e1
    style C fill:#ffe1e1
    style D fill:#e1ffe1
    style E fill:#f0e1ff
</code></pre>
<p>Scrapyçš„å·¥ä½œæµç¨‹æ˜¯ä¸€ä¸ªé—­ç¯:Spiderç”Ÿæˆåˆå§‹Request â†’ Engineè°ƒåº¦ â†’ Scheduleræ’é˜Ÿ â†’ Downloaderä¸‹è½½ â†’ Engineä¼ é€’å“åº” â†’ Spiderè§£æ â†’ æå–æ•°æ®æˆ–ç”Ÿæˆæ–°Request â†’ å¾ªç¯å¾€å¤ã€‚</p>
<h2 data-id="heading-9">4. å®æˆ˜æ¼”ç»ƒ:è§£å†³ä¸€ä¸ªå…¸å‹é—®é¢˜</h2>
<p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®æ¥å®æˆ˜Scrapyçš„æ ¸å¿ƒåŠŸèƒ½ã€‚æˆ‘ä»¬å°†çˆ¬å–è±†ç“£ç”µå½±Top250çš„ä¿¡æ¯,åŒ…æ‹¬ç”µå½±åç§°ã€è¯„åˆ†ã€å¯¼æ¼”å’Œç®€ä»‹ã€‚</p>
<h3 data-id="heading-10">éœ€æ±‚åˆ†æ</h3>
<p>ç›®æ ‡ç½‘ç«™:<a href="https://link.juejin.cn?target=https%3A%2F%2Fmovie.douban.com%2Ftop250" target="_blank" title="https://movie.douban.com/top250" ref="nofollow noopener noreferrer">movie.douban.com/top250</a><br/>
éœ€è¦æå–çš„æ•°æ®:ç”µå½±æ ‡é¢˜ã€è¯„åˆ†ã€å¯¼æ¼”ã€ç®€ä»‹<br/>
ç‰¹æ®Šéœ€æ±‚:å®ç°ç¿»é¡µåŠŸèƒ½,çˆ¬å–æ‰€æœ‰250éƒ¨ç”µå½±</p>
<h3 data-id="heading-11">æ–¹æ¡ˆè®¾è®¡</h3>
<p>é€‰æ‹©Scrapyçš„åŸå› :</p>
<ul>
<li>é«˜æ•ˆçš„å¼‚æ­¥å¹¶å‘èƒ½åŠ›,èƒ½å¤Ÿå¿«é€Ÿçˆ¬å–25é¡µæ•°æ®</li>
<li>å†…ç½®çš„Requestå»é‡æœºåˆ¶,é¿å…é‡å¤çˆ¬å–</li>
<li>çµæ´»çš„Pipelineè®¾è®¡,ä¾¿äºæ•°æ®æ¸…æ´—å’Œå­˜å‚¨</li>
</ul>
<p>æŠ€æœ¯æ–¹æ¡ˆ:</p>
<ul>
<li>ä½¿ç”¨CSSé€‰æ‹©å™¨æå–æ•°æ®</li>
<li>é€šè¿‡ç¿»é¡µé“¾æ¥çš„è§„å¾‹å®ç°è‡ªåŠ¨ç¿»é¡µ</li>
<li>å°†æ•°æ®ä¿å­˜ä¸ºCSVæ–‡ä»¶ä¾¿äºåç»­åˆ†æ</li>
</ul>
<h3 data-id="heading-12">ä»£ç å®ç°</h3>
<p><strong>æ­¥éª¤1: åˆ›å»ºé¡¹ç›®</strong></p>
<pre><code class="hljs language-bash" lang="bash">scrapy startproject douban_movie
<span class="hljs-built_in">cd</span> douban_movie
</code></pre>
<p><strong>æ­¥éª¤2: å®šä¹‰æ•°æ®ç»“æ„(items.py)</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> scrapy

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MovieItem</span>(scrapy.Item):
    title = scrapy.Field()    <span class="hljs-comment"># ç”µå½±æ ‡é¢˜</span>
    rating = scrapy.Field()   <span class="hljs-comment"># è¯„åˆ†</span>
    director = scrapy.Field() <span class="hljs-comment"># å¯¼æ¼”</span>
    intro = scrapy.Field()    <span class="hljs-comment"># ç®€ä»‹</span>
</code></pre>
<p><strong>æ­¥éª¤3: ç¼–å†™çˆ¬è™«(spiders/movie_spider.py)</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> scrapy
<span class="hljs-keyword">from</span> douban_movie.items <span class="hljs-keyword">import</span> MovieItem

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MovieSpider</span>(scrapy.Spider):
    name = <span class="hljs-string">'douban_top250'</span>
    allowed_domains = [<span class="hljs-string">'douban.com'</span>]
    start_urls = [<span class="hljs-string">'https://movie.douban.com/top250'</span>]
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">parse</span>(<span class="hljs-params">self, response</span>):
        <span class="hljs-comment"># æå–å½“å‰é¡µçš„æ‰€æœ‰ç”µå½±æ¡ç›®</span>
        movie_list = response.css(<span class="hljs-string">'ol.grid_view li'</span>)
        
        <span class="hljs-keyword">for</span> movie <span class="hljs-keyword">in</span> movie_list:
            item = MovieItem()
            
            <span class="hljs-comment"># æå–ç”µå½±æ ‡é¢˜(å¯èƒ½å­˜åœ¨ä¸­è‹±æ–‡å,å–ç¬¬ä¸€ä¸ª)</span>
            item[<span class="hljs-string">'title'</span>] = movie.css(<span class="hljs-string">'span.title::text'</span>).get()
            
            <span class="hljs-comment"># æå–è¯„åˆ†</span>
            item[<span class="hljs-string">'rating'</span>] = movie.css(<span class="hljs-string">'span.rating_num::text'</span>).get()
            
            <span class="hljs-comment"># æå–å¯¼æ¼”ä¿¡æ¯</span>
            info = movie.css(<span class="hljs-string">'div.bd p::text'</span>).getall()
            <span class="hljs-keyword">if</span> info:
                director_info = info[<span class="hljs-number">0</span>].strip()
                <span class="hljs-comment"># å¯¼æ¼”ä¿¡æ¯æ ¼å¼:å¯¼æ¼”: å¼ ä¸‰ ä¸»æ¼”: æå›› ç‹äº”</span>
                item[<span class="hljs-string">'director'</span>] = director_info.split(<span class="hljs-string">'ä¸»æ¼”:'</span>)[<span class="hljs-number">0</span>].replace(<span class="hljs-string">'å¯¼æ¼”:'</span>, <span class="hljs-string">''</span>).strip()
            
            <span class="hljs-comment"># æå–ç®€ä»‹(å¯èƒ½ä¸å­˜åœ¨)</span>
            item[<span class="hljs-string">'intro'</span>] = movie.css(<span class="hljs-string">'span.inq::text'</span>).get() <span class="hljs-keyword">or</span> <span class="hljs-string">'æš‚æ— ç®€ä»‹'</span>
            
            <span class="hljs-keyword">yield</span> item
        
        <span class="hljs-comment"># å¤„ç†ç¿»é¡µ</span>
        next_page = response.css(<span class="hljs-string">'span.next a::attr(href)'</span>).get()
        <span class="hljs-keyword">if</span> next_page:
            <span class="hljs-keyword">yield</span> response.follow(next_page, callback=self.parse)
</code></pre>
<p><strong>æ­¥éª¤4: é…ç½®settings.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ¨¡æ‹Ÿæµè§ˆå™¨User-Agent</span>
USER_AGENT = <span class="hljs-string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'</span>

<span class="hljs-comment"># ä¸éµå®ˆrobotsåè®®(è±†ç“£çš„robots.txtç¦æ­¢çˆ¬å–)</span>
ROBOTSTXT_OBEY = <span class="hljs-literal">False</span>

<span class="hljs-comment"># ä¸‹è½½å»¶è¿Ÿ,é¿å…è¢«å°IP</span>
DOWNLOAD_DELAY = <span class="hljs-number">2</span>

<span class="hljs-comment"># å¯ç”¨Pipeline</span>
ITEM_PIPELINES = {
    <span class="hljs-string">'douban_movie.pipelines.DoubanMoviePipeline'</span>: <span class="hljs-number">300</span>,
}
</code></pre>
<h3 data-id="heading-13">è¿è¡Œè¯´æ˜</h3>
<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨çˆ¬è™«:</p>
<pre><code class="hljs language-bash" lang="bash">scrapy crawl douban_top250 -o movies.csv
</code></pre>
<p>è¿è¡Œè¿‡ç¨‹ä¸­ä½ ä¼šçœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„æ—¥å¿—è¾“å‡º:</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-number">2024-06-15 10:00:00</span> [<span class="hljs-string">scrapy.core.engine</span>] <span class="hljs-attr">INFO:</span> <span class="hljs-string">Spider</span> <span class="hljs-string">opened</span>
<span class="hljs-number">2024-06-15 10:00:02</span> [<span class="hljs-string">scrapy.core.engine</span>] <span class="hljs-attr">DEBUG:</span> <span class="hljs-string">Crawled</span> <span class="hljs-string">(200)</span> <span class="hljs-string">&lt;GET</span> <span class="hljs-string">https://movie.douban.com/top250&gt;</span>
<span class="hljs-number">2024-06-15 10:00:04</span> [<span class="hljs-string">scrapy.core.engine</span>] <span class="hljs-attr">DEBUG:</span> <span class="hljs-string">Crawled</span> <span class="hljs-string">(200)</span> <span class="hljs-string">&lt;GET</span> <span class="hljs-string">https://movie.douban.com/top250?start=25&amp;filter=&gt;</span>
<span class="hljs-string">...</span>
<span class="hljs-number">2024-06-15 10:01:30</span> [<span class="hljs-string">scrapy.statscollectors</span>] <span class="hljs-attr">INFO:</span> <span class="hljs-string">Closing</span> <span class="hljs-string">spider</span> <span class="hljs-string">(finished)</span>
</code></pre>
<p>çˆ¬å–å®Œæˆå,<code>movies.csv</code>æ–‡ä»¶å°†åŒ…å«æ‰€æœ‰250éƒ¨ç”µå½±çš„ä¿¡æ¯:</p>
<pre><code class="hljs language-csv" lang="csv">title,rating,director,intro
è‚–ç”³å…‹çš„æ•‘èµ,9.7,å¯¼æ¼”: å¼—å…°å…‹Â·å¾·æ‹‰é‚¦ç‰¹,å¸Œæœ›è®©äººè‡ªç”±ã€‚
éœ¸ç‹åˆ«å§¬,9.6,å¯¼æ¼”: é™ˆå‡¯æ­Œ,é£åç»ä»£ã€‚
é˜¿ç”˜æ­£ä¼ ,9.5,å¯¼æ¼”: ç½—ä¼¯ç‰¹Â·æ³½ç±³å‰æ–¯,äººç”Ÿå°±åƒä¸€ç›’å·§å…‹åŠ›ã€‚
...
</code></pre>
<p>æ•´ä¸ªçˆ¬å–è¿‡ç¨‹å¤§çº¦éœ€è¦1-2åˆ†é’Ÿ,ç›¸æ¯”ä¼ ç»Ÿä¸²è¡Œçˆ¬è™«é€Ÿåº¦æå‡äº†æ•°å€ã€‚Scrapyè‡ªåŠ¨å¤„ç†äº†å¹¶å‘ã€å»é‡ã€é‡è¯•ç­‰å¤æ‚é—®é¢˜,è®©æˆ‘ä»¬èƒ½å¤Ÿä¸“æ³¨äºæ•°æ®æå–é€»è¾‘æœ¬èº«ã€‚</p>
<h2 data-id="heading-14">5. æœ€ä½³å®è·µä¸å¸¸è§é™·é˜±</h2>
<h3 data-id="heading-15">5.1 å¸¸è§é”™è¯¯åŠè§„é¿æ–¹æ³•</h3>
<p><strong>é”™è¯¯1: è¦†ç›–parseæ–¹æ³•å¯¼è‡´CrawlSpiderå¤±æ•ˆ</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># âŒ é”™è¯¯åšæ³•</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MySpider</span>(<span class="hljs-title class_ inherited__">CrawlSpider</span>):
    name = <span class="hljs-string">'my_spider'</span>
    rules = [Rule(LinkExtractor(), callback=<span class="hljs-string">'parse'</span>)]
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">parse</span>(<span class="hljs-params">self, response</span>):
        <span class="hljs-comment"># è‡ªå®šä¹‰parseæ–¹æ³•ä¼šè¦†ç›–CrawlSpiderçš„å†…ç½®é€»è¾‘</span>
        <span class="hljs-keyword">pass</span>
</code></pre>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># âœ… æ­£ç¡®åšæ³•</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MySpider</span>(<span class="hljs-title class_ inherited__">CrawlSpider</span>):
    name = <span class="hljs-string">'my_spider'</span>
    rules = [Rule(LinkExtractor(), callback=<span class="hljs-string">'parse_item'</span>)]
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_item</span>(<span class="hljs-params">self, response</span>):
        <span class="hljs-comment"># ä½¿ç”¨ä¸åŒçš„å›è°ƒå‡½æ•°å</span>
        <span class="hljs-keyword">pass</span>
</code></pre>
<p><strong>é”™è¯¯2: å¿˜è®°è¿”å›Itemå¯¼è‡´Pipelineæ— æ³•æ¥æ”¶æ•°æ®</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># âŒ é”™è¯¯åšæ³•</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_item</span>(<span class="hljs-params">self, item, spider</span>):
    self.db.insert(item)
    <span class="hljs-comment"># å¿˜è®°è¿”å›item,åç»­Pipelineæ— æ³•æ¥æ”¶åˆ°æ•°æ®</span>
</code></pre>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># âœ… æ­£ç¡®åšæ³•</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_item</span>(<span class="hljs-params">self, item, spider</span>):
    self.db.insert(item)
    <span class="hljs-keyword">return</span> item  <span class="hljs-comment"># å¿…é¡»è¿”å›itemæˆ–æŠ›å‡ºDropItem</span>
</code></pre>
<p><strong>é”™è¯¯3: ç›´æ¥ä¿®æ”¹Requestçš„metaä¸­ä¿ç•™é”®</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># âŒ é”™è¯¯åšæ³•</span>
<span class="hljs-keyword">yield</span> scrapy.Request(url, callback=self.parse, meta={<span class="hljs-string">'redirect_urls'</span>: [...]})
</code></pre>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># âœ… æ­£ç¡®åšæ³•</span>
<span class="hljs-keyword">yield</span> scrapy.Request(url, callback=self.parse, meta={<span class="hljs-string">'custom_data'</span>: {...}})
<span class="hljs-comment"># é¿å…ä½¿ç”¨Scrapyä¿ç•™çš„metaé”®å,å¦‚redirect_urlsã€cookiejarç­‰</span>
</code></pre>
<h3 data-id="heading-16">5.2 æœ€ä½³å®è·µå»ºè®®</h3>
<p><strong>1. åˆç†è®¾ç½®ä¸‹è½½å»¶è¿Ÿ</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ ¹æ®ç›®æ ‡ç½‘ç«™çš„è´Ÿè½½èƒ½åŠ›è°ƒæ•´å»¶è¿Ÿ</span>
DOWNLOAD_DELAY = <span class="hljs-number">2</span>  <span class="hljs-comment"># å¯¹äºè±†ç“£è¿™æ ·çš„ç½‘ç«™,2ç§’è¾ƒä¸ºåˆç†</span>
AUTOTHROTTLE_ENABLED = <span class="hljs-literal">True</span>  <span class="hljs-comment"># å¯ç”¨è‡ªåŠ¨é™é€Ÿ</span>
</code></pre>
<p><strong>2. ä½¿ç”¨Item Loaderç®€åŒ–æ•°æ®æå–</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> scrapy.loader <span class="hljs-keyword">import</span> ItemLoader

<span class="hljs-keyword">def</span> <span class="hljs-title function_">parse</span>(<span class="hljs-params">self, response</span>):
    loader = ItemLoader(item=MovieItem(), response=response)
    loader.add_css(<span class="hljs-string">'title'</span>, <span class="hljs-string">'span.title::text'</span>)
    loader.add_css(<span class="hljs-string">'rating'</span>, <span class="hljs-string">'span.rating_num::text'</span>)
    <span class="hljs-keyword">yield</span> loader.load_item()
</code></pre>
<p><strong>3. é…ç½®æ—¥å¿—çº§åˆ«ä¾¿äºè°ƒè¯•</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å¼€å‘ç¯å¢ƒä½¿ç”¨DEBUGçº§åˆ«</span>
LOG_LEVEL = <span class="hljs-string">'DEBUG'</span>

<span class="hljs-comment"># ç”Ÿäº§ç¯å¢ƒä½¿ç”¨INFOæˆ–WARNINGçº§åˆ«</span>
LOG_LEVEL = <span class="hljs-string">'INFO'</span>
</code></pre>
<p><strong>4. ä½¿ç”¨ç®¡é“é“¾å¤„ç†å¤æ‚æ•°æ®æµ</strong></p>
<pre><code class="hljs language-python" lang="python">ITEM_PIPELINES = {
    <span class="hljs-string">'myproject.pipelines.ValidationPipeline'</span>: <span class="hljs-number">100</span>,  <span class="hljs-comment"># æ•°æ®éªŒè¯</span>
    <span class="hljs-string">'myproject.pipelines.DeduplicationPipeline'</span>: <span class="hljs-number">200</span>,  <span class="hljs-comment"># å»é‡</span>
    <span class="hljs-string">'myproject.pipelines.StoragePipeline'</span>: <span class="hljs-number">300</span>,  <span class="hljs-comment"># å­˜å‚¨</span>
}
</code></pre>
<h3 data-id="heading-17">5.3 æ³¨æ„äº‹é¡¹</h3>
<ul>
<li><strong>éµå®ˆrobotsåè®®</strong>:è™½ç„¶å¯ä»¥è®¾ç½®<code>ROBOTSTXT_OBEY = False</code>,ä½†å»ºè®®å°½é‡éµå®ˆç½‘ç«™çš„robots.txtè§„å®š,åšä¸€ä¸ªæ–‡æ˜çš„çˆ¬è™«</li>
<li><strong>æ§åˆ¶å¹¶å‘æ•°</strong>:é»˜è®¤å¹¶å‘æ•°ä¸º16,å¯¹äºå°å‹ç½‘ç«™å»ºè®®é™ä½åˆ°8æˆ–æ›´ä½,é¿å…ç»™æœåŠ¡å™¨é€ æˆè¿‡å¤§å‹åŠ›</li>
<li><strong>å¤„ç†å¼‚å¸¸</strong>:åœ¨parseæ–¹æ³•ä¸­ä½¿ç”¨try-exceptæ•è·å¼‚å¸¸,é¿å…ä¸ªåˆ«é¡µé¢è§£æå¤±è´¥å¯¼è‡´æ•´ä¸ªçˆ¬è™«ä¸­æ–­</li>
<li><strong>å–„ç”¨Scrapy Shell</strong>:ä½¿ç”¨<code>scrapy shell URL</code>å‘½ä»¤è°ƒè¯•é€‰æ‹©å™¨,ç¡®ä¿æå–é€»è¾‘æ­£ç¡®åå†å†™å…¥çˆ¬è™«ä»£ç </li>
<li><strong>ç›‘æ§çˆ¬è™«çŠ¶æ€</strong>:ä½¿ç”¨Scrapyæä¾›çš„stats collectorç›‘æ§çˆ¬è™«è¿è¡ŒçŠ¶æ€,åŠæ—¶å‘ç°å¼‚å¸¸</li>
</ul>
<h2 data-id="heading-18">6. è¿›é˜¶æŒ‡å¼•</h2>
<p>æŒæ¡äº†Scrapyçš„åŸºç¡€ç”¨æ³•å,ä½ å¯ä»¥ç»§ç»­æ¢ç´¢ä»¥ä¸‹é«˜çº§ç‰¹æ€§:</p>
<p><strong>1. ä¸­é—´ä»¶(Middleware)</strong><br/>
ä¸­é—´ä»¶æä¾›äº†åœ¨è¯·æ±‚/å“åº”å¤„ç†è¿‡ç¨‹ä¸­æ’å…¥è‡ªå®šä¹‰é€»è¾‘çš„é’©å­ã€‚å…¸å‹åº”ç”¨åœºæ™¯åŒ…æ‹¬:</p>
<ul>
<li>åŠ¨æ€åˆ‡æ¢User-Agentå’Œä»£ç†IP</li>
<li>å®ç°è¯·æ±‚é‡è¯•å’Œå¼‚å¸¸å¤„ç†</li>
<li>ä¿®æ”¹è¯·æ±‚å¤´å’Œå“åº”å†…å®¹</li>
</ul>
<p><strong>2. åˆ†å¸ƒå¼çˆ¬è™«</strong><br/>
é€šè¿‡<code>scrapy-redis</code>æ‰©å±•,å¯ä»¥å®ç°åˆ†å¸ƒå¼çˆ¬è™«,å¤šä¸ªçˆ¬è™«èŠ‚ç‚¹å…±äº«åŒä¸€ä¸ªRedisé˜Ÿåˆ—,ååŒå¤„ç†å¤§è§„æ¨¡çˆ¬å–ä»»åŠ¡ã€‚</p>
<p><strong>3. åŠ¨æ€ç½‘é¡µæ¸²æŸ“</strong><br/>
å¯¹äºéœ€è¦JavaScriptæ¸²æŸ“çš„é¡µé¢,å¯ä»¥é›†æˆ<code>scrapy-splash</code>æˆ–<code>scrapy-playwright</code>,å®ç°åŠ¨æ€å†…å®¹çš„æŠ“å–ã€‚</p>
<p><strong>4. æ•°æ®å­˜å‚¨æ‰©å±•</strong><br/>
é™¤äº†CSVå’ŒJSON,Scrapy Pipelineå¯ä»¥è½»æ¾å¯¹æ¥å„ç§æ•°æ®åº“:</p>
<ul>
<li>MySQL/PostgreSQL:ä½¿ç”¨<code>pymysql</code>æˆ–<code>psycopg2</code>é©±åŠ¨</li>
<li>MongoDB:ä½¿ç”¨<code>pymongo</code>é©±åŠ¨</li>
<li>Redis:ä½¿ç”¨<code>redis</code>é©±åŠ¨</li>
</ul>
<p><strong>å­¦ä¹ èµ„æºæ¨è:</strong></p>
<ul>
<li><strong>å®˜æ–¹æ–‡æ¡£</strong>:<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.scrapy.org" target="_blank" title="https://docs.scrapy.org" ref="nofollow noopener noreferrer">docs.scrapy.org</a> - æœ€æƒå¨å’Œå…¨é¢çš„å­¦ä¹ èµ„æ–™</li>
<li><strong>GitHubä»“åº“</strong>:<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fscrapy%2Fscrapy" target="_blank" title="https://github.com/scrapy/scrapy" ref="nofollow noopener noreferrer">github.com/scrapy/scraâ€¦</a> - æŸ¥çœ‹æºç å’Œæäº¤é—®é¢˜</li>
<li><strong>Stack Overflow</strong>:æœç´¢<code>scrapy</code>æ ‡ç­¾,è§£å†³å…·ä½“é—®é¢˜</li>
<li><strong>å®æˆ˜é¡¹ç›®</strong>:å°è¯•çˆ¬å–ä¸åŒç±»å‹çš„ç½‘ç«™(ç”µå•†ã€æ–°é—»ã€ç¤¾äº¤åª’ä½“),ç§¯ç´¯å®æˆ˜ç»éªŒ</li>
</ul>
<p>Scrapyçš„å­¦ä¹ æ›²çº¿è™½ç„¶ç•¥é™¡,ä½†ä¸€æ—¦æŒæ¡,ä½ å°±æ‹¥æœ‰äº†æ„å»ºé«˜æ€§èƒ½çˆ¬è™«ç³»ç»Ÿçš„å¼ºå¤§å·¥å…·ã€‚ä»ç®€å•çš„æ•°æ®é‡‡é›†åˆ°å¤æ‚çš„åˆ†å¸ƒå¼çˆ¬è™«,Scrapyéƒ½èƒ½èƒœä»»ã€‚å¼€å§‹ä½ çš„Scrapyä¹‹æ—…å§!</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸ºä»€ä¹ˆæµè§ˆå™¨ä¼šè¿›è¡ŒOPTIONSé¢„æ£€è¯·æ±‚]]></title>    <link>https://juejin.cn/post/7603616672926285839</link>    <guid>https://juejin.cn/post/7603616672926285839</guid>    <pubDate>2026-02-07T04:03:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603616672926285839" data-draft-id="7603567912592834587" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸ºä»€ä¹ˆæµè§ˆå™¨ä¼šè¿›è¡ŒOPTIONSé¢„æ£€è¯·æ±‚"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-07T04:03:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¾®ç¬‘1234"/> <meta itemprop="url" content="https://juejin.cn/user/4380914057753640"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸ºä»€ä¹ˆæµè§ˆå™¨ä¼šè¿›è¡ŒOPTIONSé¢„æ£€è¯·æ±‚
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4380914057753640/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¾®ç¬‘1234
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T04:03:58.000Z" title="Sat Feb 07 2026 04:03:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æµè§ˆå™¨ OPTIONS é¢„æ£€è¯·æ±‚æŠ€æœ¯æ–‡æ¡£</h2>
<h3 data-id="heading-1">ä¸€ã€ä»€ä¹ˆæ˜¯è·¨åŸŸè¯·æ±‚</h3>
<h4 data-id="heading-2">1.1 åŒæºç­–ç•¥ï¼ˆSame-Origin Policyï¼‰</h4>
<p>åŒæºç­–ç•¥æ˜¯æµè§ˆå™¨çš„ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œç”¨äºé™åˆ¶ä¸€ä¸ªæºï¼ˆOriginï¼‰çš„æ–‡æ¡£æˆ–è„šæœ¬å¦‚ä½•ä¸å¦ä¸€ä¸ªæºçš„èµ„æºè¿›è¡Œäº¤äº’ã€‚</p>
<h5 data-id="heading-3">ä»€ä¹ˆæ˜¯"æº"ï¼ˆOriginï¼‰</h5>
<p>æºç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š<strong>åè®®ï¼ˆProtocolï¼‰+ åŸŸåï¼ˆDomainï¼‰+ ç«¯å£ï¼ˆPortï¼‰</strong></p>
<pre><code class="hljs language-bash" lang="bash">https://www.example.com:443/api/users
â””â”€â”¬â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”¬â”˜
åè®®        åŸŸå        ç«¯å£
</code></pre>
<h5 data-id="heading-4">åŒæºåˆ¤æ–­è§„åˆ™</h5>
<p>åªæœ‰å½“ä¸¤ä¸ª URL çš„<strong>åè®®ã€åŸŸåã€ç«¯å£</strong>å®Œå…¨ç›¸åŒæ—¶ï¼Œæ‰è¢«è®¤ä¸ºæ˜¯åŒæºã€‚</p>









































<table><thead><tr><th>å½“å‰é¡µé¢ URL</th><th>ç›®æ ‡ URL</th><th>æ˜¯å¦åŒæº</th><th>åŸå› </th></tr></thead><tbody><tr><td><code>https://www.example.com/page1</code></td><td><code>https://www.example.com/page2</code></td><td>âœ… åŒæº</td><td>åè®®ã€åŸŸåã€ç«¯å£éƒ½ç›¸åŒ</td></tr><tr><td><code>https://www.example.com/page1</code></td><td><code>http://www.example.com/page2</code></td><td>âŒ è·¨åŸŸ</td><td>åè®®ä¸åŒï¼ˆhttps vs httpï¼‰</td></tr><tr><td><code>https://www.example.com/page1</code></td><td><code>https://api.example.com/page2</code></td><td>âŒ è·¨åŸŸ</td><td>åŸŸåä¸åŒï¼ˆwww vs apiï¼‰</td></tr><tr><td><code>https://www.example.com/page1</code></td><td><code>https://www.example.com:8080/page2</code></td><td>âŒ è·¨åŸŸ</td><td>ç«¯å£ä¸åŒï¼ˆ443 vs 8080ï¼‰</td></tr><tr><td><code>https://www.example.com/page1</code></td><td><code>https://www.example.org/page2</code></td><td>âŒ è·¨åŸŸ</td><td>åŸŸåä¸åŒï¼ˆ.com vs .orgï¼‰</td></tr></tbody></table>
<h4 data-id="heading-5">1.2 ä»€ä¹ˆæ˜¯è·¨åŸŸè¯·æ±‚</h4>
<p><strong>è·¨åŸŸè¯·æ±‚</strong>æ˜¯æŒ‡ä»ä¸€ä¸ªæºå‘å¦ä¸€ä¸ªä¸åŒæºçš„æœåŠ¡å™¨å‘èµ·çš„ HTTP è¯·æ±‚ã€‚</p>
<h5 data-id="heading-6">å…¸å‹çš„è·¨åŸŸåœºæ™¯</h5>
<p><strong>åœºæ™¯ 1ï¼šå‰åç«¯åˆ†ç¦»æ¶æ„</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">å‰ç«¯é¡µé¢ï¼šhttps:<span class="hljs-comment">//www.example.com</span>
åç«¯ APIï¼šhttps:<span class="hljs-comment">//api.example.com</span>
â†’ è·¨åŸŸï¼ˆåŸŸåä¸åŒï¼‰
</code></pre>
<p><strong>åœºæ™¯ 2ï¼šæœ¬åœ°å¼€å‘ç¯å¢ƒ</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">å‰ç«¯å¼€å‘æœåŠ¡å™¨ï¼šhttp:<span class="hljs-comment">//localhost:3000</span>
åç«¯å¼€å‘æœåŠ¡å™¨ï¼šhttp:<span class="hljs-comment">//localhost:8080</span>
â†’ è·¨åŸŸï¼ˆç«¯å£ä¸åŒï¼‰
</code></pre>
<p><strong>åœºæ™¯ 3ï¼šCDN èµ„æºåŠ è½½</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">ç½‘ç«™é¡µé¢ï¼šhttps:<span class="hljs-comment">//www.example.com</span>
CDN èµ„æºï¼šhttps:<span class="hljs-comment">//cdn.example.com</span>
â†’ è·¨åŸŸï¼ˆåŸŸåä¸åŒï¼‰
</code></pre>
<p><strong>åœºæ™¯ 4ï¼šç¬¬ä¸‰æ–¹ API è°ƒç”¨</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">ç½‘ç«™é¡µé¢ï¼šhttps:<span class="hljs-comment">//www.mysite.com</span>
ç¬¬ä¸‰æ–¹ APIï¼šhttps:<span class="hljs-comment">//api.thirdparty.com</span>
â†’ è·¨åŸŸï¼ˆåŸŸåå®Œå…¨ä¸åŒï¼‰
</code></pre>
<h4 data-id="heading-7">1.3 åŒæºç­–ç•¥é™åˆ¶çš„å†…å®¹</h4>
<p>æµè§ˆå™¨çš„åŒæºç­–ç•¥ä¼šé™åˆ¶ä»¥ä¸‹è·¨åŸŸè¡Œä¸ºï¼š</p>
<h5 data-id="heading-8">1. Ajax/Fetch è¯·æ±‚</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä» https://www.example.com å‘èµ·è¯·æ±‚</span>
<span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://api.example.com/users'</span>)  <span class="hljs-comment">// âŒ è¢«åŒæºç­–ç•¥é˜»æ­¢</span>
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">json</span>())
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'è·¨åŸŸé”™è¯¯:'</span>, error));
</code></pre>
<h5 data-id="heading-9">2. Cookieã€LocalStorageã€IndexedDB è®¿é—®</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ— æ³•è¯»å–å…¶ä»–åŸŸçš„ Cookie</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>  <span class="hljs-comment">// åªèƒ½è®¿é—®å½“å‰åŸŸçš„ Cookie</span>
</code></pre>
<h5 data-id="heading-10">3. DOM è®¿é—®</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ— æ³•è®¿é—® iframe ä¸­ä¸åŒæºé¡µé¢çš„ DOM</span>
<span class="hljs-keyword">const</span> iframe = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'myIframe'</span>);
iframe.<span class="hljs-property">contentWindow</span>.<span class="hljs-property">document</span>  <span class="hljs-comment">// âŒ è·¨åŸŸè®¿é—®è¢«é˜»æ­¢</span>
</code></pre>
<h4 data-id="heading-11">1.4 ä¸å—åŒæºç­–ç•¥é™åˆ¶çš„å†…å®¹</h4>
<p>ä»¥ä¸‹èµ„æºåŠ è½½<strong>ä¸å—</strong>åŒæºç­–ç•¥é™åˆ¶ï¼š</p>
<h5 data-id="heading-12">1. å›¾ç‰‡ã€CSSã€JavaScript æ–‡ä»¶</h5>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- âœ… å…è®¸è·¨åŸŸåŠ è½½ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.example.com/image.jpg"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://cdn.example.com/style.css"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.example.com/script.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h5 data-id="heading-13">2. è¡¨å•æäº¤</h5>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- âœ… å…è®¸è·¨åŸŸæäº¤ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"https://api.example.com/submit"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"POST"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"username"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span>&gt;</span>æäº¤<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
</code></pre>
<h5 data-id="heading-14">3. é¡µé¢è·³è½¬</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âœ… å…è®¸è·¨åŸŸè·³è½¬</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span> = <span class="hljs-string">'https://other-site.com'</span>;
</code></pre>
<h4 data-id="heading-15">1.5 è·¨åŸŸè§£å†³æ–¹æ¡ˆ</h4>
<h5 data-id="heading-16">æ–¹æ¡ˆ 1ï¼šCORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰- æ¨è</h5>
<p>æœåŠ¡å™¨é€šè¿‡è®¾ç½®å“åº”å¤´å…è®¸è·¨åŸŸè¯·æ±‚ï¼š</p>
<pre><code class="hljs language-http" lang="http">Access-Control-Allow-Origin: https://www.example.com
Access-Control-Allow-Methods: GET, POST, PUT, DELETE
Access-Control-Allow-Headers: Content-Type, Authorization
</code></pre>
<h5 data-id="heading-17">æ–¹æ¡ˆ 2ï¼šJSONPï¼ˆä»…æ”¯æŒ GET è¯·æ±‚ï¼‰</h5>
<p>åˆ©ç”¨ <code>&lt;script&gt;</code> æ ‡ç­¾ä¸å—åŒæºç­–ç•¥é™åˆ¶çš„ç‰¹æ€§ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å‰ç«¯</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleResponse</span>(<span class="hljs-params">data</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);
}

<span class="hljs-keyword">const</span> script = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'script'</span>);
script.<span class="hljs-property">src</span> = <span class="hljs-string">'https://api.example.com/data?callback=handleResponse'</span>;
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(script);
</code></pre>
<h5 data-id="heading-18">æ–¹æ¡ˆ 3ï¼šä»£ç†æœåŠ¡å™¨</h5>
<p>é€šè¿‡åŒæºçš„ä»£ç†æœåŠ¡å™¨è½¬å‘è¯·æ±‚ï¼š</p>
<pre><code class="hljs">æµè§ˆå™¨ â†’ åŒæºä»£ç†æœåŠ¡å™¨ â†’ ç›®æ ‡æœåŠ¡å™¨
</code></pre>
<h5 data-id="heading-19">æ–¹æ¡ˆ 4ï¼šNginx åå‘ä»£ç†</h5>
<pre><code class="hljs language-nginx" lang="nginx">location /api/ {
    proxy_pass https://api.example.com/;
}
</code></pre>
<h4 data-id="heading-20">1.6 ä¸ºä»€ä¹ˆéœ€è¦åŒæºç­–ç•¥</h4>
<h5 data-id="heading-21">å®‰å…¨ä¿æŠ¤</h5>
<ol>
<li><strong>é˜²æ­¢ CSRF æ”»å‡»</strong>ï¼šæ¶æ„ç½‘ç«™æ— æ³•è¯»å–å…¶ä»–ç½‘ç«™çš„ Cookie</li>
<li><strong>ä¿æŠ¤ç”¨æˆ·éšç§</strong>ï¼šé˜²æ­¢æ¶æ„è„šæœ¬çªƒå–ç”¨æˆ·æ•°æ®</li>
<li><strong>éš”ç¦»ä¸åŒç«™ç‚¹</strong>ï¼šç¡®ä¿ç½‘ç«™ä¹‹é—´çš„æ•°æ®éš”ç¦»</li>
</ol>
<h5 data-id="heading-22">ç¤ºä¾‹ï¼šæ²¡æœ‰åŒæºç­–ç•¥çš„å±é™©åœºæ™¯</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å‡è®¾æ²¡æœ‰åŒæºç­–ç•¥</span>
<span class="hljs-comment">// ç”¨æˆ·è®¿é—®æ¶æ„ç½‘ç«™ evil.com</span>
<span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://bank.com/api/account'</span>)  <span class="hljs-comment">// èƒ½è¯»å–é“¶è¡Œè´¦æˆ·ä¿¡æ¯</span>
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">json</span>())
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
    <span class="hljs-comment">// æ¶æ„ç½‘ç«™çªƒå–ç”¨æˆ·é“¶è¡Œæ•°æ®</span>
    <span class="hljs-title function_">sendToHacker</span>(data);
  });
</code></pre>
<hr/>
<h3 data-id="heading-23">äºŒã€ä»€ä¹ˆæ˜¯ OPTIONS é¢„æ£€è¯·æ±‚</h3>
<p>OPTIONS è¯·æ±‚æ˜¯æµè§ˆå™¨åœ¨å‘é€è·¨åŸŸè¯·æ±‚å‰è‡ªåŠ¨å‘èµ·çš„ä¸€ç§"é¢„æ£€è¯·æ±‚"ï¼ˆPreflight Requestï¼‰ï¼Œç”¨äºæ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å…è®¸å®é™…çš„è·¨åŸŸè¯·æ±‚ã€‚</p>
<h4 data-id="heading-24">1.1 è§¦å‘æ¡ä»¶</h4>
<p>æµè§ˆå™¨ä¼šåœ¨ä»¥ä¸‹æƒ…å†µä¸‹è‡ªåŠ¨å‘èµ· OPTIONS é¢„æ£€è¯·æ±‚ï¼š</p>
<h5 data-id="heading-25">ç®€å•è¯·æ±‚ vs éç®€å•è¯·æ±‚</h5>
<p><strong>ç®€å•è¯·æ±‚</strong>ï¼ˆä¸ä¼šè§¦å‘ OPTIONSï¼‰éœ€è¦åŒæ—¶æ»¡è¶³ï¼š</p>
<ul>
<li>è¯·æ±‚æ–¹æ³•ä¸ºï¼š<code>GET</code>ã€<code>HEAD</code>ã€<code>POST</code></li>
<li>HTTP å¤´éƒ¨ä»…åŒ…å«ï¼š
<ul>
<li><code>Accept</code></li>
<li><code>Accept-Language</code></li>
<li><code>Content-Language</code></li>
<li><code>Content-Type</code>ï¼ˆä»…é™ <code>application/x-www-form-urlencoded</code>ã€<code>multipart/form-data</code>ã€<code>text/plain</code>ï¼‰</li>
</ul>
</li>
</ul>
<p><strong>éç®€å•è¯·æ±‚</strong>ï¼ˆä¼šè§¦å‘ OPTIONSï¼‰åŒ…æ‹¬ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>PUT</code>ã€<code>DELETE</code>ã€<code>PATCH</code> ç­‰æ–¹æ³•</li>
<li>å‘é€ <code>application/json</code> ç±»å‹çš„æ•°æ®</li>
<li>è‡ªå®šä¹‰ HTTP å¤´éƒ¨ï¼ˆå¦‚ <code>Authorization</code>ã€<code>X-Custom-Header</code>ï¼‰</li>
<li>æºå¸¦ Cookie æˆ–è®¤è¯ä¿¡æ¯</li>
</ul>
<hr/>
<h3 data-id="heading-26">äºŒã€ä¸ºä»€ä¹ˆæµè§ˆå™¨è¦å‘èµ· OPTIONS è¯·æ±‚</h3>
<h4 data-id="heading-27">2.1 å®‰å…¨æœºåˆ¶ï¼šåŒæºç­–ç•¥ï¼ˆSame-Origin Policyï¼‰</h4>
<p>æµè§ˆå™¨çš„åŒæºç­–ç•¥æ˜¯ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œé™åˆ¶äº†ä¸åŒæºä¹‹é—´çš„èµ„æºè®¿é—®ã€‚OPTIONS é¢„æ£€è¯·æ±‚æ˜¯ CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰æœºåˆ¶çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ã€‚</p>
<h4 data-id="heading-28">2.2 OPTIONS è¯·æ±‚çš„ä½œç”¨</h4>
<ol>
<li><strong>å®‰å…¨éªŒè¯</strong>ï¼šåœ¨å‘é€å®é™…è¯·æ±‚å‰ï¼Œå…ˆè¯¢é—®æœåŠ¡å™¨æ˜¯å¦å…è®¸è·¨åŸŸè®¿é—®</li>
<li><strong>æƒé™ç¡®è®¤</strong>ï¼šæ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å…è®¸ç‰¹å®šçš„ HTTP æ–¹æ³•å’Œå¤´éƒ¨</li>
<li><strong>é¿å…å‰¯ä½œç”¨</strong>ï¼šé˜²æ­¢éç®€å•è¯·æ±‚ç›´æ¥ä¿®æ”¹æœåŠ¡å™¨æ•°æ®</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šé€šè¿‡ç¼“å­˜é¢„æ£€ç»“æœï¼Œå‡å°‘åç»­è¯·æ±‚çš„é¢„æ£€æ¬¡æ•°</li>
</ol>
<h4 data-id="heading-29">2.3 å·¥ä½œæµç¨‹</h4>
<pre><code class="hljs language-sql" lang="sql">å®¢æˆ·ç«¯                                æœåŠ¡å™¨
  <span class="hljs-operator">|</span>                                    <span class="hljs-operator">|</span>
  <span class="hljs-operator">|</span>  <span class="hljs-number">1.</span> OPTIONS é¢„æ£€è¯·æ±‚               <span class="hljs-operator">|</span>
  <span class="hljs-operator">|</span>  (è¯¢é—®æ˜¯å¦å…è®¸è·¨åŸŸ)                 <span class="hljs-operator">|</span>
  <span class="hljs-operator">|</span> <span class="hljs-comment">---------------------------------&gt; |</span>
  <span class="hljs-operator">|</span>                                    <span class="hljs-operator">|</span>
  <span class="hljs-operator">|</span>  <span class="hljs-number">2.</span> è¿”å› CORS å“åº”å¤´               <span class="hljs-operator">|</span>
  <span class="hljs-operator">|</span>  (å‘ŠçŸ¥å…è®¸çš„æ–¹æ³•ã€å¤´éƒ¨ç­‰)           <span class="hljs-operator">|</span>
  <span class="hljs-operator">|</span> <span class="hljs-operator">&lt;</span><span class="hljs-comment">--------------------------------- |</span>
  <span class="hljs-operator">|</span>                                    <span class="hljs-operator">|</span>
  <span class="hljs-operator">|</span>  <span class="hljs-number">3.</span> å‘é€å®é™…è¯·æ±‚                   <span class="hljs-operator">|</span>
  <span class="hljs-operator">|</span>  (POST<span class="hljs-operator">/</span>PUT<span class="hljs-operator">/</span><span class="hljs-keyword">DELETE</span> ç­‰)              <span class="hljs-operator">|</span>
  <span class="hljs-operator">|</span> <span class="hljs-comment">---------------------------------&gt; |</span>
  <span class="hljs-operator">|</span>                                    <span class="hljs-operator">|</span>
  <span class="hljs-operator">|</span>  <span class="hljs-number">4.</span> è¿”å›ä¸šåŠ¡æ•°æ®                   <span class="hljs-operator">|</span>
  <span class="hljs-operator">|</span> <span class="hljs-operator">&lt;</span><span class="hljs-comment">--------------------------------- |</span>
</code></pre>
<hr/>
<h3 data-id="heading-30">ä¸‰ã€OPTIONS è¯·æ±‚ç¤ºä¾‹</h3>
<h4 data-id="heading-31">3.1 é¢„æ£€è¯·æ±‚ç¤ºä¾‹</h4>
<pre><code class="hljs language-http" lang="http">OPTIONS /api/users HTTP/1.1
Host: api.example.com
Origin: https://www.example.com
Access-Control-Request-Method: POST
Access-Control-Request-Headers: Content-Type, Authorization
</code></pre>
<h4 data-id="heading-32">3.2 æœåŠ¡å™¨å“åº”ç¤ºä¾‹</h4>
<pre><code class="hljs language-http" lang="http">HTTP/1.1 200 OK
Access-Control-Allow-Origin: https://www.example.com
Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS
Access-Control-Allow-Headers: Content-Type, Authorization
Access-Control-Max-Age: 86400
Access-Control-Allow-Credentials: true
</code></pre>
<hr/>
<h3 data-id="heading-33">å››ã€Gateway å±‚é¢çš„å¤„ç†æ–¹æ¡ˆ</h3>
<h4 data-id="heading-34">4.1 æ ¸å¿ƒé…ç½®è¦ç‚¹</h4>
<h5 data-id="heading-35">1. å…è®¸ OPTIONS æ–¹æ³•</h5>
<p>ç¡®ä¿ Gateway ä¸ä¼šæ‹¦æˆªæˆ–æ‹’ç» OPTIONS è¯·æ±‚ã€‚</p>
<h5 data-id="heading-36">2. è¿”å›æ­£ç¡®çš„ CORS å“åº”å¤´</h5>
<p>å¿…é¡»åŒ…å«ä»¥ä¸‹å…³é”®å“åº”å¤´ï¼š</p>



































<table><thead><tr><th>å“åº”å¤´</th><th>è¯´æ˜</th><th>ç¤ºä¾‹å€¼</th></tr></thead><tbody><tr><td><code>Access-Control-Allow-Origin</code></td><td>å…è®¸çš„æº</td><td><code>https://www.example.com</code> æˆ– <code>*</code></td></tr><tr><td><code>Access-Control-Allow-Methods</code></td><td>å…è®¸çš„ HTTP æ–¹æ³•</td><td><code>GET, POST, PUT, DELETE, OPTIONS</code></td></tr><tr><td><code>Access-Control-Allow-Headers</code></td><td>å…è®¸çš„è¯·æ±‚å¤´</td><td><code>Content-Type, Authorization</code></td></tr><tr><td><code>Access-Control-Max-Age</code></td><td>é¢„æ£€ç»“æœç¼“å­˜æ—¶é—´ï¼ˆç§’ï¼‰</td><td><code>86400</code>ï¼ˆ24å°æ—¶ï¼‰</td></tr><tr><td><code>Access-Control-Allow-Credentials</code></td><td>æ˜¯å¦å…è®¸æºå¸¦å‡­è¯</td><td><code>true</code></td></tr></tbody></table>
<p>Access-Control-Allow-Credentials æ˜¯ CORS ä¸­ç”¨äºæ§åˆ¶æ˜¯å¦å…è®¸è·¨åŸŸè¯·æ±‚æºå¸¦å‡­è¯ï¼ˆCookieã€HTTP è®¤è¯ä¿¡æ¯ç­‰ï¼‰çš„å“åº”å¤´ã€‚</p>
<h5 data-id="heading-37">3. å¿«é€Ÿå“åº” OPTIONS è¯·æ±‚</h5>
<p>OPTIONS è¯·æ±‚ä¸éœ€è¦è½¬å‘åˆ°åç«¯æœåŠ¡ï¼Œåº”åœ¨ Gateway å±‚ç›´æ¥è¿”å› 200 å“åº”ã€‚</p>
<hr/>
<h4 data-id="heading-38">4.2 Spring Cloud Gateway é…ç½®æ–¹æ¡ˆ</h4>
<h5 data-id="heading-39">æ–¹æ¡ˆä¸€ï¼šå…¨å±€ CORS é…ç½®ï¼ˆæ¨èï¼‰</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hljs-keyword">import</span> org.springframework.web.cors.CorsConfiguration;
<span class="hljs-keyword">import</span> org.springframework.web.cors.reactive.CorsWebFilter;
<span class="hljs-keyword">import</span> org.springframework.web.cors.reactive.UrlBasedCorsConfigurationSource;

<span class="hljs-comment">/**
 * å…¨å±€ CORS è·¨åŸŸé…ç½®
 * ç”¨äºå¤„ç†æµè§ˆå™¨çš„ OPTIONS é¢„æ£€è¯·æ±‚
 */</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CorsConfig</span> {

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> CorsWebFilter <span class="hljs-title function_">corsWebFilter</span><span class="hljs-params">()</span> {
        <span class="hljs-type">CorsConfiguration</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CorsConfiguration</span>();
        
        <span class="hljs-comment">// å…è®¸çš„æºï¼ˆç”Ÿäº§ç¯å¢ƒåº”æŒ‡å®šå…·ä½“åŸŸåï¼‰</span>
        config.addAllowedOriginPattern(<span class="hljs-string">"*"</span>);
        
        <span class="hljs-comment">// å…è®¸çš„ HTTP æ–¹æ³•</span>
        config.addAllowedMethod(<span class="hljs-string">"GET"</span>);
        config.addAllowedMethod(<span class="hljs-string">"POST"</span>);
        config.addAllowedMethod(<span class="hljs-string">"PUT"</span>);
        config.addAllowedMethod(<span class="hljs-string">"DELETE"</span>);
        config.addAllowedMethod(<span class="hljs-string">"OPTIONS"</span>);
        
        <span class="hljs-comment">// å…è®¸çš„è¯·æ±‚å¤´</span>
        config.addAllowedHeader(<span class="hljs-string">"*"</span>);
        
        <span class="hljs-comment">// æ˜¯å¦å…è®¸æºå¸¦å‡­è¯ï¼ˆCookieï¼‰</span>
        config.setAllowCredentials(<span class="hljs-literal">true</span>);
        
        <span class="hljs-comment">// é¢„æ£€è¯·æ±‚çš„ç¼“å­˜æ—¶é—´ï¼ˆç§’ï¼‰</span>
        config.setMaxAge(<span class="hljs-number">86400L</span>);
        
        <span class="hljs-comment">// æš´éœ²ç»™å‰ç«¯çš„å“åº”å¤´</span>
        config.addExposedHeader(<span class="hljs-string">"Content-Disposition"</span>);
        
        <span class="hljs-type">UrlBasedCorsConfigurationSource</span> <span class="hljs-variable">source</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UrlBasedCorsConfigurationSource</span>();
        source.registerCorsConfiguration(<span class="hljs-string">"/**"</span>, config);
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CorsWebFilter</span>(source);
    }
}
</code></pre>
<h5 data-id="heading-40">æ–¹æ¡ˆäºŒï¼šapplication.yml é…ç½®</h5>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">cloud:</span>
    <span class="hljs-attr">gateway:</span>
      <span class="hljs-attr">globalcors:</span>
        <span class="hljs-attr">cors-configurations:</span>
          <span class="hljs-string">'[/**]'</span><span class="hljs-string">:</span>
            <span class="hljs-comment"># å…è®¸çš„æº</span>
            <span class="hljs-attr">allowed-origin-patterns:</span> <span class="hljs-string">"*"</span>
            <span class="hljs-comment"># å…è®¸çš„æ–¹æ³•</span>
            <span class="hljs-attr">allowed-methods:</span>
              <span class="hljs-bullet">-</span> <span class="hljs-string">GET</span>
              <span class="hljs-bullet">-</span> <span class="hljs-string">POST</span>
              <span class="hljs-bullet">-</span> <span class="hljs-string">PUT</span>
              <span class="hljs-bullet">-</span> <span class="hljs-string">DELETE</span>
              <span class="hljs-bullet">-</span> <span class="hljs-string">OPTIONS</span>
            <span class="hljs-comment"># å…è®¸çš„è¯·æ±‚å¤´</span>
            <span class="hljs-attr">allowed-headers:</span> <span class="hljs-string">"*"</span>
            <span class="hljs-comment"># æ˜¯å¦å…è®¸æºå¸¦å‡­è¯</span>
            <span class="hljs-attr">allow-credentials:</span> <span class="hljs-literal">true</span>
            <span class="hljs-comment"># é¢„æ£€è¯·æ±‚ç¼“å­˜æ—¶é—´ï¼ˆç§’ï¼‰</span>
            <span class="hljs-attr">max-age:</span> <span class="hljs-number">86400</span>
</code></pre>
<h5 data-id="heading-41">æ–¹æ¡ˆä¸‰ï¼šè‡ªå®šä¹‰ GlobalFilterï¼ˆé«˜çº§åœºæ™¯ï¼‰</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.cloud.gateway.filter.GatewayFilterChain;
<span class="hljs-keyword">import</span> org.springframework.cloud.gateway.filter.GlobalFilter;
<span class="hljs-keyword">import</span> org.springframework.core.Ordered;
<span class="hljs-keyword">import</span> org.springframework.http.HttpHeaders;
<span class="hljs-keyword">import</span> org.springframework.http.HttpMethod;
<span class="hljs-keyword">import</span> org.springframework.http.HttpStatus;
<span class="hljs-keyword">import</span> org.springframework.http.server.reactive.ServerHttpRequest;
<span class="hljs-keyword">import</span> org.springframework.http.server.reactive.ServerHttpResponse;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;
<span class="hljs-keyword">import</span> org.springframework.web.server.ServerWebExchange;
<span class="hljs-keyword">import</span> reactor.core.publisher.Mono;

<span class="hljs-comment">/**
 * å…¨å±€ CORS è¿‡æ»¤å™¨
 * ä¼˜å…ˆçº§æœ€é«˜ï¼Œç¡®ä¿ OPTIONS è¯·æ±‚è¢«æ­£ç¡®å¤„ç†
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CorsGlobalFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GlobalFilter</span>, Ordered {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">filter</span><span class="hljs-params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> {
        <span class="hljs-type">ServerHttpRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> exchange.getRequest();
        <span class="hljs-type">ServerHttpResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> exchange.getResponse();
        <span class="hljs-type">HttpHeaders</span> <span class="hljs-variable">headers</span> <span class="hljs-operator">=</span> response.getHeaders();
        
        <span class="hljs-comment">// è·å–è¯·æ±‚æº</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">origin</span> <span class="hljs-operator">=</span> request.getHeaders().getOrigin();
        
        <span class="hljs-comment">// è®¾ç½® CORS å“åº”å¤´</span>
        <span class="hljs-keyword">if</span> (origin != <span class="hljs-literal">null</span>) {
            headers.add(HttpHeaders.ACCESS_CONTROL_ALLOW_ORIGIN, origin);
        }
        headers.add(HttpHeaders.ACCESS_CONTROL_ALLOW_METHODS, <span class="hljs-string">"GET, POST, PUT, DELETE, OPTIONS"</span>);
        headers.add(HttpHeaders.ACCESS_CONTROL_ALLOW_HEADERS, <span class="hljs-string">"*"</span>);
        headers.add(HttpHeaders.ACCESS_CONTROL_ALLOW_CREDENTIALS, <span class="hljs-string">"true"</span>);
        headers.add(HttpHeaders.ACCESS_CONTROL_MAX_AGE, <span class="hljs-string">"86400"</span>);
        
        <span class="hljs-comment">// å¦‚æœæ˜¯ OPTIONS è¯·æ±‚ï¼Œç›´æ¥è¿”å› 200</span>
        <span class="hljs-keyword">if</span> (request.getMethod() == HttpMethod.OPTIONS) {
            response.setStatusCode(HttpStatus.OK);
            <span class="hljs-keyword">return</span> Mono.empty();
        }
        
        <span class="hljs-comment">// ç»§ç»­æ‰§è¡Œåç»­è¿‡æ»¤å™¨</span>
        <span class="hljs-keyword">return</span> chain.filter(exchange);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getOrder</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// è®¾ç½®æœ€é«˜ä¼˜å…ˆçº§</span>
        <span class="hljs-keyword">return</span> Ordered.HIGHEST_PRECEDENCE;
    }
}
</code></pre>
<hr/>
<h4 data-id="heading-42">4.3 Nginx Gateway é…ç½®æ–¹æ¡ˆ</h4>
<pre><code class="hljs language-nginx" lang="nginx">server {
    listen 80;
    server_name api.example.com;

    # å¤„ç† OPTIONS é¢„æ£€è¯·æ±‚
    if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '$http_origin' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' 'Content-Type, Authorization, X-Requested-With' always;
        add_header 'Access-Control-Allow-Credentials' 'true' always;
        add_header 'Access-Control-Max-Age' 86400 always;
        add_header 'Content-Length' 0;
        add_header 'Content-Type' 'text/plain charset=UTF-8';
        return 204;
    }

    # ä¸ºæ‰€æœ‰å“åº”æ·»åŠ  CORS å¤´
    add_header 'Access-Control-Allow-Origin' '$http_origin' always;
    add_header 'Access-Control-Allow-Credentials' 'true' always;

    location /api/ {
        proxy_pass http://backend-service;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
</code></pre>
<hr/>
<h4 data-id="heading-43">4.4 é…ç½®å»ºè®®</h4>
<h5 data-id="heading-44">ç”Ÿäº§ç¯å¢ƒå®‰å…¨é…ç½®</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ ä¸æ¨èï¼šå…è®¸æ‰€æœ‰æº</span>
config.addAllowedOrigin(<span class="hljs-string">"*"</span>);

<span class="hljs-comment">// âœ… æ¨èï¼šæŒ‡å®šå…·ä½“åŸŸå</span>
config.addAllowedOrigin(<span class="hljs-string">"https://www.example.com"</span>);
config.addAllowedOrigin(<span class="hljs-string">"https://admin.example.com"</span>);

<span class="hljs-comment">// âœ… æ¨èï¼šä½¿ç”¨ Pattern æ”¯æŒå¤šä¸ªå­åŸŸå</span>
config.addAllowedOriginPattern(<span class="hljs-string">"https://*.example.com"</span>);
</code></pre>
<h5 data-id="heading-45">æ€§èƒ½ä¼˜åŒ–é…ç½®</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è®¾ç½®è¾ƒé•¿çš„ç¼“å­˜æ—¶é—´ï¼Œå‡å°‘é¢„æ£€è¯·æ±‚é¢‘ç‡</span>
config.setMaxAge(<span class="hljs-number">86400L</span>); <span class="hljs-comment">// 24 å°æ—¶</span>

<span class="hljs-comment">// ä»…æš´éœ²å¿…è¦çš„å“åº”å¤´</span>
config.addExposedHeader(<span class="hljs-string">"Content-Disposition"</span>);
config.addExposedHeader(<span class="hljs-string">"X-Total-Count"</span>);
</code></pre>
<hr/>
<h3 data-id="heading-46">äº”ã€æµè§ˆå™¨è¿™ä¹ˆåšçš„æ„ä¹‰</h3>
<h4 data-id="heading-47">5.1 å®‰å…¨ä¿éšœ</h4>
<ol>
<li><strong>é˜²æ­¢ CSRF æ”»å‡»</strong>ï¼šé€šè¿‡é¢„æ£€æœºåˆ¶ï¼Œç¡®ä¿åªæœ‰æˆæƒçš„æºæ‰èƒ½å‘èµ·è·¨åŸŸè¯·æ±‚</li>
<li><strong>ä¿æŠ¤ç”¨æˆ·æ•°æ®</strong>ï¼šé¿å…æ¶æ„ç½‘ç«™æœªç»æˆæƒè®¿é—®ç”¨æˆ·çš„æ•æ„Ÿæ•°æ®</li>
<li><strong>æœåŠ¡å™¨ä¸»åŠ¨æ§åˆ¶</strong>ï¼šè®©æœåŠ¡å™¨å†³å®šå“ªäº›è·¨åŸŸè¯·æ±‚æ˜¯å®‰å…¨çš„</li>
</ol>
<h4 data-id="heading-48">5.2 å…¼å®¹æ€§ä¿éšœ</h4>
<ol>
<li><strong>å‘åå…¼å®¹</strong>ï¼šä¿æŠ¤ä¸æ”¯æŒ CORS çš„æ—§æœåŠ¡å™¨ä¸è¢«æ„å¤–è®¿é—®</li>
<li><strong>æ¸è¿›å¢å¼º</strong>ï¼šå…è®¸ç°ä»£ Web åº”ç”¨å®‰å…¨åœ°è¿›è¡Œè·¨åŸŸé€šä¿¡</li>
</ol>
<h4 data-id="heading-49">5.3 æ€§èƒ½ä¼˜åŒ–</h4>
<ol>
<li><strong>ç¼“å­˜æœºåˆ¶</strong>ï¼šé€šè¿‡ <code>Access-Control-Max-Age</code> ç¼“å­˜é¢„æ£€ç»“æœ</li>
<li><strong>å‡å°‘è¯·æ±‚</strong>ï¼šç¼“å­˜æœŸå†…çš„ç›¸åŒè¯·æ±‚ä¸å†å‘èµ·é¢„æ£€</li>
<li><strong>å¿«é€Ÿå¤±è´¥</strong>ï¼šåœ¨é¢„æ£€é˜¶æ®µå°±èƒ½å‘ç°è·¨åŸŸé—®é¢˜ï¼Œé¿å…æµªè´¹èµ„æº</li>
</ol>
<hr/>
<h3 data-id="heading-50">å…­ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h3>
<h4 data-id="heading-51">6.1 é—®é¢˜ï¼šæ¯æ¬¡è¯·æ±‚éƒ½å‘èµ· OPTIONS</h4>
<p><strong>åŸå› </strong>ï¼š</p>
<ul>
<li>æœªè®¾ç½® <code>Access-Control-Max-Age</code> å“åº”å¤´</li>
<li>ç¼“å­˜æ—¶é—´è®¾ç½®è¿‡çŸ­</li>
<li>è¯·æ±‚å¤´æˆ–æ–¹æ³•å‘ç”Ÿå˜åŒ–</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è®¾ç½®è¾ƒé•¿çš„ç¼“å­˜æ—¶é—´</span>
config.setMaxAge(<span class="hljs-number">86400L</span>); <span class="hljs-comment">// 24 å°æ—¶</span>
</code></pre>
<h4 data-id="heading-52">6.2 é—®é¢˜ï¼šOPTIONS è¯·æ±‚è¿”å› 403 æˆ– 404</h4>
<p><strong>åŸå› </strong>ï¼š</p>
<ul>
<li>Gateway æœªæ­£ç¡®å¤„ç† OPTIONS è¯·æ±‚</li>
<li>è·¯ç”±é…ç½®ä¸åŒ¹é… OPTIONS æ–¹æ³•</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ul>
<li>ç¡®ä¿ CORS è¿‡æ»¤å™¨ä¼˜å…ˆçº§æœ€é«˜</li>
<li>åœ¨ Gateway å±‚ç›´æ¥è¿”å› 200ï¼Œä¸è½¬å‘åˆ°åç«¯</li>
</ul>
<h4 data-id="heading-53">6.3 é—®é¢˜ï¼šæºå¸¦ Cookie çš„è¯·æ±‚å¤±è´¥</h4>
<p><strong>åŸå› </strong>ï¼š</p>
<ul>
<li>æœªè®¾ç½® <code>Access-Control-Allow-Credentials: true</code></li>
<li>ä½¿ç”¨äº† <code>Access-Control-Allow-Origin: *</code>ï¼ˆä¸ Credentials å†²çªï¼‰</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java">config.setAllowCredentials(<span class="hljs-literal">true</span>);
config.addAllowedOriginPattern(<span class="hljs-string">"https://www.example.com"</span>); <span class="hljs-comment">// ä¸èƒ½ç”¨ *</span>
</code></pre>
<h4 data-id="heading-54">6.4 é—®é¢˜ï¼šè®¾ç½® Cookie çš„æ¥å£è·¨åŸŸå¤±è´¥ï¼ˆé‡è¦ï¼‰</h4>
<p><strong>ç°è±¡</strong>ï¼š</p>
<ul>
<li>å‰ç«¯è°ƒç”¨ç™»å½•æ¥å£ï¼Œä½¿ç”¨äº† <code>withCredentials: true</code></li>
<li>åç«¯è®¾ç½®äº† <code>config.setAllowCredentials(false)</code> æˆ–æœªè®¾ç½®</li>
<li>æµè§ˆå™¨æŠ¥é”™ï¼šCORS policy blocked</li>
</ul>
<p><strong>é”™è¯¯ä¿¡æ¯</strong>ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">Access to XMLHttpRequest at <span class="hljs-string">'http://localhost:9087/api/users/login'</span> <span class="hljs-keyword">from</span> origin <span class="hljs-string">'http://localhost:3000'</span> 
has been blocked <span class="hljs-keyword">by</span> CORS policy: The <span class="hljs-keyword">value</span> of the <span class="hljs-string">'Access-Control-Allow-Credentials'</span> header <span class="hljs-keyword">in</span> the 
response <span class="hljs-keyword">is</span> <span class="hljs-string">''</span> which must be <span class="hljs-string">'true'</span> <span class="hljs-keyword">when</span> the request<span class="hljs-string">'s credentials mode is '</span>include<span class="hljs-string">'.
</span></code></pre>
<p><strong>åŸå› åˆ†æ</strong>ï¼š</p>
<ol>
<li>å‰ç«¯è®¾ç½®äº† <code>withCredentials: true</code>ï¼ˆè¡¨ç¤ºè¦æºå¸¦æˆ–æ¥æ”¶ Cookieï¼‰</li>
<li>åç«¯è®¾ç½®äº† <code>setAllowCredentials(false)</code> æˆ–æœªè®¾ç½®ï¼ˆé»˜è®¤ä¸º falseï¼‰</li>
<li>æµè§ˆå™¨æ£€æµ‹åˆ°ä¸åŒ¹é…ï¼Œæ‹’ç»è¯·æ±‚</li>
</ol>
<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li>å³ä½¿æ˜¯<strong>è®¾ç½® Cookie</strong> çš„æ¥å£ï¼ˆå¦‚ç™»å½•ï¼‰ï¼Œä¹Ÿéœ€è¦ <code>Access-Control-Allow-Credentials: true</code></li>
<li>ä¸ä»…ä»…æ˜¯<strong>æºå¸¦ Cookie</strong> çš„æ¥å£éœ€è¦è¿™ä¸ªé…ç½®</li>
<li>åªè¦å‰ç«¯ä½¿ç”¨äº† <code>withCredentials: true</code>ï¼Œåç«¯å°±å¿…é¡»è¿”å› <code>Access-Control-Allow-Credentials: true</code></li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ é”™è¯¯é…ç½®</span>
config.setAllowCredentials(<span class="hljs-literal">false</span>);  <span class="hljs-comment">// æˆ–è€…ä¸è®¾ç½®</span>

<span class="hljs-comment">// âœ… æ­£ç¡®é…ç½®</span>
config.setAllowCredentials(<span class="hljs-literal">true</span>);
config.addAllowedOriginPattern(<span class="hljs-string">"http://localhost:3000"</span>);  <span class="hljs-comment">// å¿…é¡»æŒ‡å®šå…·ä½“æºï¼Œä¸èƒ½ç”¨ *</span>
</code></pre>
<p><strong>å®Œæ•´ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CorsConfig</span> {

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> CorsFilter <span class="hljs-title function_">corsFilter</span><span class="hljs-params">()</span> {
        <span class="hljs-type">CorsConfiguration</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CorsConfiguration</span>();
        
        <span class="hljs-comment">// âœ… å…³é”®ï¼šå…è®¸æºå¸¦å‡­è¯</span>
        config.setAllowCredentials(<span class="hljs-literal">true</span>);
        
        <span class="hljs-comment">// âœ… å…³é”®ï¼šä¸èƒ½ä½¿ç”¨ *ï¼Œå¿…é¡»æŒ‡å®šå…·ä½“æº</span>
        config.addAllowedOriginPattern(<span class="hljs-string">"http://localhost:3000"</span>);
        config.addAllowedOriginPattern(<span class="hljs-string">"http://localhost:8080"</span>);
        
        config.addAllowedMethod(<span class="hljs-string">"*"</span>);
        config.addAllowedHeader(<span class="hljs-string">"*"</span>);
        config.setMaxAge(<span class="hljs-number">3600L</span>);
        
        <span class="hljs-type">UrlBasedCorsConfigurationSource</span> <span class="hljs-variable">source</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UrlBasedCorsConfigurationSource</span>();
        source.registerCorsConfiguration(<span class="hljs-string">"/**"</span>, config);
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CorsFilter</span>(source);
    }
}
</code></pre>
<p><strong>å‰ç«¯ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç™»å½•æ¥å£ - éœ€è¦æ¥æ”¶ Set-Cookie</span>
axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/users/login'</span>, {
  <span class="hljs-attr">username</span>: <span class="hljs-string">'zhangsan'</span>,
  <span class="hljs-attr">password</span>: <span class="hljs-string">'123456'</span>
}, {
  <span class="hljs-attr">withCredentials</span>: <span class="hljs-literal">true</span>  <span class="hljs-comment">// å¿…é¡»è®¾ç½®</span>
});

<span class="hljs-comment">// åç»­è¯·æ±‚ - éœ€è¦æºå¸¦ Cookie</span>
axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/users/profile'</span>, {
  <span class="hljs-attr">withCredentials</span>: <span class="hljs-literal">true</span>  <span class="hljs-comment">// å¿…é¡»è®¾ç½®</span>
});
</code></pre>
<p><strong>æ€»ç»“</strong>ï¼š</p>
<ul>
<li><code>withCredentials: true</code> å’Œ <code>Access-Control-Allow-Credentials: true</code> å¿…é¡»åŒæ—¶å­˜åœ¨</li>
<li>è¿™ä¸ªé…ç½®ä¸ä»…å½±å“æºå¸¦ Cookieï¼Œä¹Ÿå½±å“æ¥æ”¶ Cookieï¼ˆSet-Cookieï¼‰</li>
<li>è®¾ç½® Cookie çš„ç™»å½•æ¥å£ä¹Ÿéœ€è¦è¿™ä¸ªé…ç½®</li>
</ul>
<h4 data-id="heading-55">6.5 é—®é¢˜ï¼šè‡ªå®šä¹‰è¯·æ±‚å¤´è¢«æ‹’ç»</h4>
<p><strong>åŸå› </strong>ï¼š</p>
<ul>
<li>æœªåœ¨ <code>Access-Control-Allow-Headers</code> ä¸­å£°æ˜</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java">config.addAllowedHeader(<span class="hljs-string">"Authorization"</span>);
config.addAllowedHeader(<span class="hljs-string">"X-Custom-Header"</span>);
<span class="hljs-comment">// æˆ–è€…å…è®¸æ‰€æœ‰å¤´éƒ¨ï¼ˆå¼€å‘ç¯å¢ƒï¼‰</span>
config.addAllowedHeader(<span class="hljs-string">"*"</span>);
</code></pre>
<hr/>
<h3 data-id="heading-56">ä¸ƒã€æœ€ä½³å®è·µæ€»ç»“</h3>
<h4 data-id="heading-57">7.1 å¼€å‘ç¯å¢ƒé…ç½®</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å®½æ¾é…ç½®ï¼Œæ–¹ä¾¿å¼€å‘è°ƒè¯•</span>
config.addAllowedOriginPattern(<span class="hljs-string">"*"</span>);
config.addAllowedMethod(<span class="hljs-string">"*"</span>);
config.addAllowedHeader(<span class="hljs-string">"*"</span>);
config.setAllowCredentials(<span class="hljs-literal">true</span>);
config.setMaxAge(<span class="hljs-number">3600L</span>);
</code></pre>
<h4 data-id="heading-58">7.2 ç”Ÿäº§ç¯å¢ƒé…ç½®</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸¥æ ¼é…ç½®ï¼Œç¡®ä¿å®‰å…¨</span>
config.addAllowedOriginPattern(<span class="hljs-string">"https://*.example.com"</span>);
config.addAllowedMethod(<span class="hljs-string">"GET"</span>);
config.addAllowedMethod(<span class="hljs-string">"POST"</span>);
config.addAllowedMethod(<span class="hljs-string">"PUT"</span>);
config.addAllowedMethod(<span class="hljs-string">"DELETE"</span>);
config.addAllowedHeader(<span class="hljs-string">"Content-Type"</span>);
config.addAllowedHeader(<span class="hljs-string">"Authorization"</span>);
config.setAllowCredentials(<span class="hljs-literal">true</span>);
config.setMaxAge(<span class="hljs-number">86400L</span>);
</code></pre>
<h4 data-id="heading-59">7.3 ç›‘æ§ä¸æ—¥å¿—</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CorsLoggingFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GlobalFilter</span>, Ordered {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">filter</span><span class="hljs-params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> {
        <span class="hljs-type">ServerHttpRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> exchange.getRequest();
        
        <span class="hljs-keyword">if</span> (request.getMethod() == HttpMethod.OPTIONS) {
            log.info(<span class="hljs-string">"OPTIONS é¢„æ£€è¯·æ±‚: {} from {}"</span>, 
                request.getURI(), 
                request.getHeaders().getOrigin());
        }
        
        <span class="hljs-keyword">return</span> chain.filter(exchange);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getOrder</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> Ordered.HIGHEST_PRECEDENCE + <span class="hljs-number">1</span>;
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-60">å…«ã€å‚è€ƒèµ„æ–™</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FHTTP%2FCORS" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CORS" ref="nofollow noopener noreferrer">MDN - CORS</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2Fcors%2F" target="_blank" title="https://www.w3.org/TR/cors/" ref="nofollow noopener noreferrer">W3C - CORS Specification</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.spring.io%2Fspring-cloud-gateway%2Fdocs%2Fcurrent%2Freference%2Fhtml%2F%23cors-configuration" target="_blank" title="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#cors-configuration" ref="nofollow noopener noreferrer">Spring Cloud Gateway - CORS Configuration</a></li>
</ul>
<hr/>
<h3 data-id="heading-61">ä¹ã€æ€»ç»“</h3>
<p>OPTIONS é¢„æ£€è¯·æ±‚æ˜¯æµè§ˆå™¨çš„å®‰å…¨æœºåˆ¶ï¼Œè™½ç„¶ä¼šå¢åŠ ä¸€æ¬¡é¢å¤–çš„è¯·æ±‚ï¼Œä½†é€šè¿‡åˆç†é…ç½®ï¼š</p>
<ol>
<li><strong>åœ¨ Gateway å±‚ç»Ÿä¸€å¤„ç† CORS</strong>ï¼Œé¿å…æ¯ä¸ªå¾®æœåŠ¡é‡å¤é…ç½®</li>
<li><strong>è®¾ç½®åˆç†çš„ç¼“å­˜æ—¶é—´</strong>ï¼Œå‡å°‘é¢„æ£€è¯·æ±‚é¢‘ç‡</li>
<li><strong>ç”Ÿäº§ç¯å¢ƒä¸¥æ ¼æ§åˆ¶å…è®¸çš„æº</strong>ï¼Œç¡®ä¿å®‰å…¨æ€§</li>
<li><strong>å¼€å‘ç¯å¢ƒå®½æ¾é…ç½®</strong>ï¼Œæé«˜å¼€å‘æ•ˆç‡</li>
</ol>
<p>è¿™æ ·æ—¢èƒ½ä¿è¯å®‰å…¨æ€§ï¼Œåˆèƒ½ä¼˜åŒ–æ€§èƒ½ï¼Œæ˜¯ç°ä»£ Web åº”ç”¨çš„æ ‡å‡†åšæ³•ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Cursor 500MB å¤ªé‡ï¼Ÿè¯•è¯•è¿™ä¸ª 5MB çš„ CLI æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7603616672926269455</link>    <guid>https://juejin.cn/post/7603616672926269455</guid>    <pubDate>2026-02-07T03:55:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603616672926269455" data-draft-id="7603575399255932968" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Cursor 500MB å¤ªé‡ï¼Ÿè¯•è¯•è¿™ä¸ª 5MB çš„ CLI æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2026-02-07T03:55:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="echoVic"/> <meta itemprop="url" content="https://juejin.cn/user/729731451069998"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Cursor 500MB å¤ªé‡ï¼Ÿè¯•è¯•è¿™ä¸ª 5MB çš„ CLI æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/729731451069998/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    echoVic
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T03:55:06.000Z" title="Sat Feb 07 2026 03:55:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    31
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Cursor 500MB å¤ªé‡ï¼Ÿè¯•è¯•è¿™ä¸ª 5MB çš„ CLI æ–¹æ¡ˆ</h2>
<h3 data-id="heading-1">ä¸ºä»€ä¹ˆæˆ‘æ”¾å¼ƒäº† Cursor</h3>
<p>ä¸Šä¸ªæœˆå›¢é˜Ÿè®©æˆ‘è¯•ç”¨ Cursorã€‚ä¸‹è½½å®Œ 500MB å®‰è£…åŒ…åï¼Œæˆ‘å¼€å§‹æ€€ç–‘äººç”Ÿã€‚</p>
<p>å¯åŠ¨è¦ 10 ç§’ï¼Œæ‰“å¼€å¤§é¡¹ç›®è¦ 30 ç§’ï¼Œå†…å­˜å ç”¨ 2GB+ã€‚æˆ‘åªæ˜¯æƒ³è®© AI å¸®æˆ‘å†™ä¸ªè„šæœ¬ï¼Œä¸ºä»€ä¹ˆè¦è£…ä¸ªè¿™ä¹ˆé‡çš„ IDEï¼Ÿ</p>
<p>åæ¥å‘ç°äº† Blade Codeã€‚</p>
<h3 data-id="heading-2">Blade Code æ˜¯ä»€ä¹ˆ</h3>
<p>ä¸€ä¸ª 5MB çš„ Node.js CLI å·¥å…·ï¼Œä¸“é—¨åšä¸€ä»¶äº‹ï¼šè®© AI å¿«é€Ÿå®Œæˆç¼–ç¨‹ä»»åŠ¡ã€‚</p>
<p>ä¸æ˜¯ IDEï¼Œä¸æ˜¯ç¼–è¾‘å™¨ï¼Œå°±æ˜¯ä¸ªå‘½ä»¤è¡Œå·¥å…·ã€‚</p>
<h3 data-id="heading-3">å¯¹æ¯”æ•°æ®</h3>








































<table><thead><tr><th>ç»´åº¦</th><th>Cursor</th><th>Blade Code</th></tr></thead><tbody><tr><td>å®‰è£…åŒ…å¤§å°</td><td>500MB</td><td>5MB (npm åŒ…)</td></tr><tr><td>å¯åŠ¨é€Ÿåº¦</td><td>10ç§’</td><td>1ç§’</td></tr><tr><td>å†…å­˜å ç”¨</td><td>2GB+</td><td>50MB</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>å®Œæ•´å¼€å‘ç¯å¢ƒ</td><td>å¿«é€Ÿä»»åŠ¡ã€è„šæœ¬ã€è‡ªåŠ¨åŒ–</td></tr><tr><td>å­¦ä¹ æˆæœ¬</td><td>éœ€è¦é€‚åº”æ–° IDE</td><td>ä¼šç”¨å‘½ä»¤è¡Œå°±è¡Œ</td></tr><tr><td>ä»·æ ¼</td><td>$20/æœˆ</td><td>MIT å¼€æº</td></tr></tbody></table>
<h3 data-id="heading-4">çœŸå®åœºæ™¯</h3>
<h4 data-id="heading-5">åœºæ™¯ 1ï¼šå¿«é€Ÿé‡æ„ä»£ç </h4>
<pre><code class="hljs language-bash" lang="bash">blade <span class="hljs-string">"æŠŠè¿™ä¸ªæ–‡ä»¶çš„æ‰€æœ‰ var æ”¹æˆ let/const"</span>
</code></pre>
<p>3 ç§’å®Œæˆï¼Œä¸ç”¨æ‰“å¼€ IDEã€‚</p>
<h4 data-id="heading-6">åœºæ™¯ 2ï¼šæ‰¹é‡å¤„ç†æ–‡ä»¶</h4>
<pre><code class="hljs language-bash" lang="bash">blade <span class="hljs-string">"æŠŠ src/ ä¸‹æ‰€æœ‰ .js æ–‡ä»¶åŠ ä¸Š 'use strict'"</span>
</code></pre>
<p>20 ä¸ªæ–‡ä»¶ï¼Œ5 ç§’æå®šã€‚</p>
<h4 data-id="heading-7">åœºæ™¯ 3ï¼šç”Ÿæˆæµ‹è¯•ç”¨ä¾‹</h4>
<pre><code class="hljs language-bash" lang="bash">blade <span class="hljs-string">"ç»™ utils.ts ç”Ÿæˆå•å…ƒæµ‹è¯•"</span>
</code></pre>
<p>è‡ªåŠ¨åˆ†æä»£ç ï¼Œç”Ÿæˆå®Œæ•´æµ‹è¯•æ–‡ä»¶ã€‚</p>
<h3 data-id="heading-8">ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«</h3>
<ol>
<li>æ—  GUI å¼€é”€ - çº¯å‘½ä»¤è¡Œï¼Œæ²¡æœ‰æ¸²æŸ“è´Ÿæ‹…</li>
<li>æŒ‰éœ€åŠ è½½ - åªåŠ è½½éœ€è¦çš„å·¥å…·</li>
<li>æµå¼å“åº” - è¾¹ç”Ÿæˆè¾¹è¾“å‡ºï¼Œä¸ç­‰å…¨éƒ¨å®Œæˆ</li>
<li>è½»é‡è®¾è®¡ - æ ¸å¿ƒåªæœ‰å‡  MB</li>
</ol>
<h3 data-id="heading-9">20+ å†…ç½®å·¥å…·</h3>
<p>Blade Code ä¸åªæ˜¯ä¸ª AI å¯¹è¯å·¥å…·ï¼Œå®ƒå†…ç½®äº† 20+ å®ç”¨å·¥å…·ï¼š</p>
<ul>
<li>æ–‡ä»¶æ“ä½œï¼šè¯»ã€å†™ã€æœç´¢ã€æ‰¹é‡å¤„ç†</li>
<li>ä»£ç åˆ†æï¼šAST è§£æã€ä¾èµ–åˆ†æ</li>
<li>Shell æ‰§è¡Œï¼šå®‰å…¨çš„å‘½ä»¤æ‰§è¡Œ</li>
<li>Git é›†æˆï¼šæäº¤ã€åˆ†æ”¯ã€å†å²æŸ¥è¯¢</li>
<li>Web æœç´¢ï¼šå®æ—¶æŸ¥è¯¢æœ€æ–°ä¿¡æ¯</li>
</ul>
<h3 data-id="heading-10">å®‰å…¨è®¾è®¡</h3>
<p>å¾ˆå¤šäººæ‹…å¿ƒ AI å·¥å…·ä¼šè¯¯åˆ ä»£ç ã€‚Blade Code æœ‰ä¸‰å±‚ä¿æŠ¤ï¼š</p>
<ol>
<li>æƒé™æ§åˆ¶ - å±é™©æ“ä½œéœ€è¦ç¡®è®¤</li>
<li>å·¥å…·ç™½åå• - åªèƒ½ç”¨é¢„å®šä¹‰çš„å·¥å…·</li>
<li>æ“ä½œæ—¥å¿— - æ‰€æœ‰æ“ä½œå¯è¿½æº¯</li>
</ol>
<h3 data-id="heading-11">5 åˆ†é’Ÿä¸Šæ‰‹</h3>
<h4 data-id="heading-12">å®‰è£…</h4>
<pre><code class="hljs language-bash" lang="bash">npm install -g blade-code
</code></pre>
<h4 data-id="heading-13">é…ç½® API Key</h4>
<pre><code class="hljs language-bash" lang="bash">blade config
</code></pre>
<p>æ”¯æŒ OpenAIã€Claudeã€Geminiã€å›½äº§å¤§æ¨¡å‹ã€‚</p>
<h4 data-id="heading-14">å¼€å§‹ä½¿ç”¨</h4>
<pre><code class="hljs language-bash" lang="bash">blade <span class="hljs-string">"å¸®æˆ‘é‡æ„è¿™ä¸ªå‡½æ•°"</span>
</code></pre>
<p>å°±è¿™ä¹ˆç®€å•ã€‚</p>
<h3 data-id="heading-15">é€‚åˆè°ç”¨</h3>
<p>é€‚åˆï¼š</p>
<ul>
<li>éœ€è¦å¿«é€Ÿå®Œæˆå°ä»»åŠ¡çš„å¼€å‘è€…</li>
<li>å–œæ¬¢å‘½ä»¤è¡Œçš„æå®¢</li>
<li>æƒ³è¦è½»é‡çº§ AI å·¥å…·çš„äºº</li>
<li>éœ€è¦è„šæœ¬åŒ– AI èƒ½åŠ›çš„åœºæ™¯</li>
</ul>
<p>ä¸é€‚åˆï¼š</p>
<ul>
<li>éœ€è¦å®Œæ•´ IDE åŠŸèƒ½çš„äºº</li>
<li>ä¸ä¹ æƒ¯å‘½ä»¤è¡Œçš„äºº</li>
<li>éœ€è¦å›¾å½¢ç•Œé¢çš„åœºæ™¯</li>
</ul>
<h3 data-id="heading-16">å’Œå…¶ä»–å·¥å…·å¯¹æ¯”</h3>
<h4 data-id="heading-17">vs Cursor</h4>
<ul>
<li>Cursorï¼šå®Œæ•´ IDEï¼Œé€‚åˆé•¿æ—¶é—´å¼€å‘</li>
<li>Blade Codeï¼šå¿«é€Ÿä»»åŠ¡ï¼Œé€‚åˆè„šæœ¬åŒ–åœºæ™¯</li>
</ul>
<h4 data-id="heading-18">vs OpenCode</h4>
<ul>
<li>OpenCodeï¼š95K starsï¼ŒåŠŸèƒ½å…¨é¢ä½†å¤æ‚</li>
<li>Blade Codeï¼šä¸“æ³¨ CLIï¼Œç®€å•ç›´æ¥</li>
</ul>
<h3 data-id="heading-19">å¼€æº + å¯æ‰©å±•</h3>
<p>Blade Code æ˜¯ MIT å¼€æºçš„ï¼Œä»£ç åœ¨ GitHubï¼š
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FechoVic%2Fblade-code" target="_blank" title="https://github.com/echoVic/blade-code" ref="nofollow noopener noreferrer">github.com/echoVic/blaâ€¦</a></p>
<p>æ”¯æŒ MCP (Model Context Protocol)ï¼Œå¯ä»¥è‡ªå·±å†™æ’ä»¶æ‰©å±•åŠŸèƒ½ã€‚</p>
<h3 data-id="heading-20">æ€»ç»“</h3>
<p>å¦‚æœä½ è§‰å¾— Cursor å¤ªé‡ï¼Œéœ€è¦å¿«é€Ÿå®Œæˆå°ä»»åŠ¡ï¼Œå–œæ¬¢å‘½ä»¤è¡Œï¼Œæƒ³è¦å…è´¹çš„ AI ç¼–ç¨‹å·¥å…·ï¼Œè¯•è¯• Blade Codeã€‚</p>
<p>5MBï¼Œ1 ç§’å¯åŠ¨ï¼ŒMIT å¼€æºã€‚</p>
<p>é¡¹ç›®åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FechoVic%2Fblade-code" target="_blank" title="https://github.com/echoVic/blade-code" ref="nofollow noopener noreferrer">github.com/echoVic/blaâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å»ä¸­å¿ƒåŒ–é¢„æµ‹å¸‚åœºå®æˆ˜å¼€å‘ï¼šSolidity+Viem ä»åˆçº¦è®¾è®¡åˆ°å·¥ç¨‹åŒ–è½åœ°]]></title>    <link>https://juejin.cn/post/7603567912593031195</link>    <guid>https://juejin.cn/post/7603567912593031195</guid>    <pubDate>2026-02-07T04:31:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603567912593031195" data-draft-id="7603294029531791411" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å»ä¸­å¿ƒåŒ–é¢„æµ‹å¸‚åœºå®æˆ˜å¼€å‘ï¼šSolidity+Viem ä»åˆçº¦è®¾è®¡åˆ°å·¥ç¨‹åŒ–è½åœ°"/> <meta itemprop="keywords" content="æ™ºèƒ½åˆçº¦,Solidity,web3"/> <meta itemprop="datePublished" content="2026-02-07T04:31:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æœ¨è¥¿"/> <meta itemprop="url" content="https://juejin.cn/user/2436173496845549"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å»ä¸­å¿ƒåŒ–é¢„æµ‹å¸‚åœºå®æˆ˜å¼€å‘ï¼šSolidity+Viem ä»åˆçº¦è®¾è®¡åˆ°å·¥ç¨‹åŒ–è½åœ°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436173496845549/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æœ¨è¥¿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T04:31:25.000Z" title="Sat Feb 07 2026 04:31:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<blockquote>
<p>åœ¨ Web3 ç”Ÿæ€è¿ˆå‘ 2026 å¹´çš„æ–°é˜¶æ®µï¼Œå»ä¸­å¿ƒåŒ–é¢„æµ‹å¸‚åœºï¼ˆDecentralized Prediction Marketï¼ŒDPMï¼‰æ—©å·²çªç ´å•çº¯çš„åšå¼ˆå·¥å…·å±æ€§ï¼Œæˆä¸ºèåˆ<strong>ç¾¤ä½“æ™ºæ…§ä»·æ ¼å‘ç°</strong>ã€<strong>å»ä¸­å¿ƒåŒ–é‡‘èå¯¹å†²</strong>ã€<strong>ç°å®ä¸–ç•Œäº‹ä»¶ä»·å€¼æ˜ å°„</strong>çš„æ ¸å¿ƒ DeFi ç»„ä»¶ã€‚ä¸ä¸­å¿ƒåŒ–é¢„æµ‹å¹³å°ç›¸æ¯”ï¼ŒåŸºäºæ™ºèƒ½åˆçº¦çš„ DPM å‡­å€Ÿé“¾ä¸Šé€æ˜ã€æ— éœ€ä¿¡ä»»ã€èµ„äº§è‡ªç®¡çš„ç‰¹æ€§ï¼Œæˆä¸º Web3 è½åœ°ç°å®åº”ç”¨çš„é‡è¦è½½ä½“ã€‚</p>
<p>æœ¬æ–‡å°†ä»<strong>åº•å±‚æ ¸å¿ƒé€»è¾‘</strong>å‡ºå‘ï¼Œæ‹†è§£å»ä¸­å¿ƒåŒ–é¢„æµ‹å¸‚åœºçš„è®¾è®¡ç²¾é«“ï¼Œé€šè¿‡<strong>Solidity</strong>å®ç°å¯è½åœ°çš„æ™ºèƒ½åˆçº¦æ¶æ„ï¼Œå¹¶ç»“åˆ Web3 å¼€å‘æ–°æ ‡æ¤<strong>Viem</strong>å®Œæˆå·¥ç¨‹åŒ–æµ‹è¯•ï¼ŒåŒæ—¶ç»™å‡ºä»åŸºç¡€ç‰ˆæœ¬åˆ°ç”Ÿäº§çº§åº”ç”¨çš„ä¼˜åŒ–æ–¹å‘ä¸æŠ€æœ¯æ ˆé€‰å‹ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿå¿«é€Ÿä¸Šæ‰‹å¹¶æ­å»ºå±äºè‡ªå·±çš„å»ä¸­å¿ƒåŒ–é¢„æµ‹å¸‚åœºã€‚</p>
</blockquote>
<h2 data-id="heading-1">ä¸€ã€æ ¸å¿ƒå®šä½ä¸åº•å±‚é€»è¾‘</h2>
<h4 data-id="heading-2">1. å¸‚åœºå®šä½</h4>
<p>2026 å¹´çš„ DPM å·²çªç ´åšå¼ˆå±æ€§ï¼Œæˆä¸ºèåˆ<strong>ç¾¤ä½“æ™ºæ…§ä»·æ ¼å‘ç°</strong>ã€<strong>å»ä¸­å¿ƒåŒ–é‡‘èå¯¹å†²</strong>ã€<strong>ç°å®ä¸–ç•Œäº‹ä»¶ä»·å€¼æ˜ å°„</strong>çš„æ ¸å¿ƒ DeFi ç»„ä»¶ï¼Œæ ¸å¿ƒä¼˜åŠ¿æ˜¯é“¾ä¸Šé€æ˜ã€æ— éœ€ä¿¡ä»»ã€èµ„äº§è‡ªç®¡ã€‚</p>
<h4 data-id="heading-3">2. åº•å±‚æ ¸å¿ƒæ³•åˆ™ï¼šæŠµæŠ¼å“å®ˆæ’ï¼ˆ1=1+1ï¼‰</h4>
<p>æ‰€æœ‰è®¾è®¡å›´ç»• â€œ1 å•ä½æŠµæŠ¼å“ = 1 ä»½ Yes ä»£å¸ + 1 ä»½ No ä»£å¸â€ å±•å¼€ï¼Œåˆ†ä¸‰ä¸ªæ ¸å¿ƒç¯èŠ‚ï¼š</p>

























<table><thead><tr><th>ç¯èŠ‚</th><th>æ ¸å¿ƒåŠ¨ä½œ</th><th>ä»·å€¼é€»è¾‘</th></tr></thead><tbody><tr><td>èµ„äº§å¯¹å†²</td><td>ç”¨æˆ·å­˜å…¥æŠµæŠ¼å“ï¼Œåˆçº¦ 1:1 é“¸é€  Yes/No ç»“æœä»£å¸</td><td>æŠµæŠ¼å“ç­‰ä»·äº Yes+No ä»£å¸ç»„åˆï¼Œå•ä¸€ä»£å¸æˆä¸ºæŠ•æ³¨å¤´å¯¸</td></tr><tr><td>æ¦‚ç‡å®šä»·</td><td>Yes/No ä»£å¸äºŒçº§å¸‚åœºè‡ªç”±äº¤æ˜“</td><td>ä»£å¸ä»·æ ¼ç›´æ¥åæ˜ å¸‚åœºå¯¹äº‹ä»¶ç»“æœçš„æ¦‚ç‡é¢„æœŸï¼ˆå¦‚ Yes=0.7ETHâ†’70% å‘ç”Ÿæ¦‚ç‡ï¼‰</td></tr><tr><td>æœ€ç»ˆç»“ç®—</td><td>é¢„è¨€æœºæäº¤ç»“æœï¼Œèƒœå‡ºä»£å¸ = 1 å•ä½æŠµæŠ¼å“ï¼Œå¤±è´¥ä»£å¸å½’é›¶</td><td>æŠµæŠ¼å“æ€»é‡ä¸å˜ï¼Œç”¨æˆ·é”€æ¯èƒœå‡ºä»£å¸èµå›æŠµæŠ¼å“</td></tr></tbody></table>
<h2 data-id="heading-4">äºŒã€æŠ€æœ¯å®ç°ï¼ˆSolidity+Viemï¼‰</h2>
<h4 data-id="heading-5">æ™ºèƒ½åˆçº¦</h4>
<p><strong>IOutcomeTokenæ¥å£åˆçº¦</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// SPDX-License-Identifier: MIT</span>
pragma solidity ^<span class="hljs-number">0.8</span><span class="hljs-number">.20</span>;

<span class="hljs-keyword">import</span> <span class="hljs-string">"@openzeppelin/contracts/token/ERC20/IERC20.sol"</span>;

interface <span class="hljs-title class_">IOutcomeToken</span> is <span class="hljs-title class_">IERC20</span> {
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">mint</span>(<span class="hljs-params">address to, uint256 amount</span>) external;
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">burn</span>(<span class="hljs-params">address <span class="hljs-keyword">from</span>, uint256 amount</span>) external;
}
</code></pre>
<p><strong>OutcomeTokenï¼ˆç»“æœä»£å¸ï¼‰</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// SPDX-License-Identifier: MIT</span>
pragma solidity ^<span class="hljs-number">0.8</span><span class="hljs-number">.20</span>;

<span class="hljs-keyword">import</span> <span class="hljs-string">"@openzeppelin/contracts/token/ERC20/ERC20.sol"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">"./IOutcomeToken.sol"</span>;

contract <span class="hljs-title class_">OutcomeToken</span> is <span class="hljs-title class_">ERC20</span>, <span class="hljs-title class_">IOutcomeToken</span> {
    address <span class="hljs-keyword">public</span> immutable market;

    error <span class="hljs-title class_">OnlyMarketAllowed</span>();

    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">
        <span class="hljs-built_in">string</span> memory name, 
        <span class="hljs-built_in">string</span> memory <span class="hljs-built_in">symbol</span>, 
        address _market
    </span>) <span class="hljs-title class_">ERC20</span>(name, <span class="hljs-built_in">symbol</span>) {
        market = _market;
    }

    modifier <span class="hljs-title function_">onlyMarket</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">if</span> (msg.<span class="hljs-property">sender</span> != market) revert <span class="hljs-title class_">OnlyMarketAllowed</span>();
        _;
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">mint</span>(<span class="hljs-params">address to, uint256 amount</span>) external onlyMarket {
        <span class="hljs-title function_">_mint</span>(to, amount);
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">burn</span>(<span class="hljs-params">address <span class="hljs-keyword">from</span>, uint256 amount</span>) external onlyMarket {
        <span class="hljs-title function_">_burn</span>(<span class="hljs-keyword">from</span>, amount);
    }
}

</code></pre>
<p><strong>MockV3Aggregatorï¼ˆé¢„è¨€æœºåˆçº¦ï¼‰</strong>:<code>åœ¨æœ¬åœ°å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒä¸­éƒ¨ç½²æ¨¡æ‹Ÿåˆçº¦ï¼Œè€Œåœ¨æ­£å¼ç”Ÿäº§ç¯å¢ƒçš„é¡¹ç›®ä¸­ï¼Œåˆ™ä½¿ç”¨ Chainlink æä¾›çš„ MockV3Aggregator åˆçº¦</code></p>
<pre><code class="hljs language-ini" lang="ini">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20<span class="hljs-comment">;</span>
contract MockV3Aggregator4 {
    int256 private _price<span class="hljs-comment">;</span>
    constructor(int256 initialPrice) { <span class="hljs-attr">_price</span> = initialPrice<span class="hljs-comment">; }</span>
    function updatePrice(int256 newPrice) external { <span class="hljs-attr">_price</span> = newPrice<span class="hljs-comment">; }</span>
    function latestRoundData() external view returns (uint80, int256 price, uint256, uint256, uint80) {
        return (0, _price, 0, 0, 0)<span class="hljs-comment">;</span>
    }
}

</code></pre>
<p><strong>PredictionMarketï¼ˆé¢„æµ‹å¸‚åœºåˆçº¦ï¼‰</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// SPDX-License-Identifier: MIT</span>
pragma solidity ^<span class="hljs-number">0.8</span><span class="hljs-number">.20</span>;

import <span class="hljs-string">"@openzeppelin/contracts/access/Ownable.sol"</span>;
import <span class="hljs-string">"@openzeppelin/contracts/utils/ReentrancyGuard.sol"</span>;
import <span class="hljs-string">"@chainlink/contracts/src/v0.8/shared/interfaces/AggregatorV3Interface.sol"</span>;
import <span class="hljs-string">"./OutcomeToken.sol"</span>;

contract PredictionMarket <span class="hljs-keyword">is</span> Ownable, ReentrancyGuard {
    IOutcomeToken <span class="hljs-keyword">public</span> immutable yesToken;
    IOutcomeToken <span class="hljs-keyword">public</span> immutable noToken;
    AggregatorV3Interface <span class="hljs-keyword">public</span> immutable priceFeed;

    uint256 <span class="hljs-keyword">public</span> immutable targetPrice;
    <span class="hljs-built_in">bool</span> <span class="hljs-keyword">public</span> resolved;
    <span class="hljs-built_in">bool</span> <span class="hljs-keyword">public</span> winningOutcome; <span class="hljs-comment">// true = Yes, false = No</span>

    <span class="hljs-function"><span class="hljs-keyword">event</span> <span class="hljs-title">MarketMinted</span>(<span class="hljs-params">address indexed user, uint256 amount</span>)</span>;
    <span class="hljs-function"><span class="hljs-keyword">event</span> <span class="hljs-title">MarketResolved</span>(<span class="hljs-params"><span class="hljs-built_in">bool</span> winningOutcome, int256 finalPrice</span>)</span>;
    <span class="hljs-function"><span class="hljs-keyword">event</span> <span class="hljs-title">Redeemed</span>(<span class="hljs-params">address indexed user, uint256 amount</span>)</span>;

    <span class="hljs-function">error <span class="hljs-title">AlreadyResolved</span>()</span>;
    <span class="hljs-function">error <span class="hljs-title">NotResolved</span>()</span>;
    <span class="hljs-function">error <span class="hljs-title">InsufficientBalance</span>()</span>;

    constructor(
        address _priceFeed, 
        uint256 _targetPrice
    ) Ownable(msg.sender) {
        priceFeed = AggregatorV3Interface(_priceFeed);
        targetPrice = _targetPrice;
        
        <span class="hljs-comment">// å®ä¾‹åŒ– Outcome ä»£å¸</span>
        yesToken = <span class="hljs-keyword">new</span> OutcomeToken(<span class="hljs-string">"Predict YES"</span>, <span class="hljs-string">"YES"</span>, address(<span class="hljs-keyword">this</span>));
        noToken = <span class="hljs-keyword">new</span> OutcomeToken(<span class="hljs-string">"Predict NO"</span>, <span class="hljs-string">"NO"</span>, address(<span class="hljs-keyword">this</span>));
    }

    <span class="hljs-comment">/**
     * @notice å­˜å…¥ ETH é“¸é€  1:1 çš„ Yes å’Œ No å¤´å¯¸
     */</span>
    <span class="hljs-function">function <span class="hljs-title">mintPositions</span>() external payable nonReentrant</span> {
        <span class="hljs-keyword">if</span> (resolved) <span class="hljs-function">revert <span class="hljs-title">AlreadyResolved</span>()</span>;
        <span class="hljs-keyword">if</span> (msg.<span class="hljs-keyword">value</span> == <span class="hljs-number">0</span>) <span class="hljs-function">revert <span class="hljs-title">InsufficientBalance</span>()</span>;

        yesToken.mint(msg.sender, msg.<span class="hljs-keyword">value</span>);
        noToken.mint(msg.sender, msg.<span class="hljs-keyword">value</span>);

        <span class="hljs-function">emit <span class="hljs-title">MarketMinted</span>(<span class="hljs-params">msg.sender, msg.<span class="hljs-keyword">value</span></span>)</span>;
    }

    <span class="hljs-comment">/**
     * @notice è°ƒç”¨ Chainlink è·å–ä»·æ ¼å¹¶ç»“ç®—å¸‚åœº
     */</span>
    <span class="hljs-function">function <span class="hljs-title">resolveMarket</span>() external onlyOwner</span> {
        <span class="hljs-keyword">if</span> (resolved) <span class="hljs-function">revert <span class="hljs-title">AlreadyResolved</span>()</span>;

        (, int256 price, , , ) = priceFeed.latestRoundData();
        
        <span class="hljs-comment">// åˆ¤å®šé€»è¾‘ï¼šå½“å‰ä»· &gt; ç›®æ ‡ä»·åˆ™ Yes èµ¢</span>
        winningOutcome = uint256(price) &gt; targetPrice;
        resolved = <span class="hljs-literal">true</span>;

        <span class="hljs-function">emit <span class="hljs-title">MarketResolved</span>(<span class="hljs-params">winningOutcome, price</span>)</span>;
    }

    <span class="hljs-comment">/**
     * @notice ç»“ç®—åï¼Œèƒœæ–¹é”€æ¯ä»£å¸å–å› 1:1 çš„ ETH
     */</span>
    <span class="hljs-function">function <span class="hljs-title">redeem</span>(<span class="hljs-params">uint256 amount</span>) external nonReentrant</span> {
        <span class="hljs-keyword">if</span> (!resolved) <span class="hljs-function">revert <span class="hljs-title">NotResolved</span>()</span>;

        <span class="hljs-keyword">if</span> (winningOutcome) {
            yesToken.burn(msg.sender, amount);
        } <span class="hljs-keyword">else</span> {
            noToken.burn(msg.sender, amount);
        }

        (<span class="hljs-built_in">bool</span> success, ) = payable(msg.sender).call{<span class="hljs-keyword">value</span>: amount}(<span class="hljs-string">""</span>);
        require(success, <span class="hljs-string">"Transfer failed"</span>);

        <span class="hljs-function">emit <span class="hljs-title">Redeemed</span>(<span class="hljs-params">msg.sender, amount</span>)</span>;
    }

    receive() external payable {}
}
</code></pre>
<h4 data-id="heading-6">æµ‹è¯•è„šæœ¬</h4>
<p><strong>æµ‹è¯•ç”¨ä¾‹</strong>ï¼š</p>
<ol>
<li><strong>Minting (é“¸é€ å¤´å¯¸)</strong></li>
<li><strong>Resolution &amp; Redemption (ç»“ç®—ä¸å…‘ä»˜)</strong></li>
<li><strong>å½“ä»·æ ¼è¶…è¿‡ç›®æ ‡æ—¶ï¼ŒYES æŒæœ‰è€…åº”èƒ½å…‘ç°</strong></li>
<li><strong>æœªç»“ç®—å‰ä¸åº”å…è®¸å…‘ç°</strong></li>
</ol>
<pre><code class="hljs language-ini" lang="ini">import assert from "node:assert/strict"<span class="hljs-comment">;</span>
import { describe, it, beforeEach } from "node:test"<span class="hljs-comment">;</span>
import { parseEther, formatEther } from 'viem'<span class="hljs-comment">;</span>
import { network } from "hardhat"<span class="hljs-comment">;</span>

describe("PredictionMarket", function () {
    let market: any, mockOracle: any<span class="hljs-comment">;</span>
    let yesToken: any, noToken: any<span class="hljs-comment">;</span>
    let publicClient: any<span class="hljs-comment">;</span>
    let owner: any, user1: any<span class="hljs-comment">;</span>
    let deployerAddress: string<span class="hljs-comment">;</span>

    const <span class="hljs-attr">TARGET_PRICE</span> = <span class="hljs-number">3000</span>n * <span class="hljs-number">10</span>n**<span class="hljs-number">8</span>n<span class="hljs-comment">; // å‡è®¾ç›®æ ‡ä»· 3000 (8ä½å°æ•°)</span>
    const <span class="hljs-attr">INITIAL_PRICE</span> = <span class="hljs-number">2500</span>n * <span class="hljs-number">10</span>n**<span class="hljs-number">8</span>n<span class="hljs-comment">; // åˆå§‹ä»· 2500</span>

    beforeEach(async function () {
        const { viem } = await (network as any).connect()<span class="hljs-comment">;</span>
        <span class="hljs-attr">publicClient</span> = await viem.getPublicClient()<span class="hljs-comment">;</span>
        <span class="hljs-section">[owner, user1]</span> = await viem.getWalletClients()<span class="hljs-comment">;</span>
        <span class="hljs-attr">deployerAddress</span> = owner.account.address<span class="hljs-comment">;</span>

        // 1. éƒ¨ç½² Mock é¢„è¨€æœº (åˆå§‹ä»·æ ¼ 2500)
        <span class="hljs-attr">mockOracle</span> = await viem.deployContract(<span class="hljs-string">"MockV3Aggregator4"</span>, [INITIAL_PRICE])<span class="hljs-comment">;</span>
        
        // 2. éƒ¨ç½²é¢„æµ‹å¸‚åœºä¸»åˆçº¦
        <span class="hljs-attr">market</span> = await viem.deployContract(<span class="hljs-string">"PredictionMarket"</span>, [
            mockOracle.address,
            TARGET_PRICE
        ])<span class="hljs-comment">;</span>

        // 3. è·å–ç”Ÿæˆçš„ YES/NO ä»£å¸åˆçº¦å®ä¾‹
        const <span class="hljs-attr">yesAddr</span> = await market.read.<span class="hljs-literal">yes</span>Token()<span class="hljs-comment">;</span>
        const <span class="hljs-attr">noAddr</span> = await market.read.noToken()<span class="hljs-comment">;</span>
        
        <span class="hljs-attr">yesToken</span> = await viem.getContractAt(<span class="hljs-string">"OutcomeToken"</span>, <span class="hljs-literal">yes</span>Addr)<span class="hljs-comment">;</span>
        <span class="hljs-attr">noToken</span> = await viem.getContractAt(<span class="hljs-string">"OutcomeToken"</span>, noAddr)<span class="hljs-comment">;</span>

        console.log(`å¸‚åœºéƒ¨ç½²æˆåŠŸ: ${market.address}`)<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>

    describe("Minting (é“¸é€ å¤´å¯¸)", function () {
        it("åº”è¯¥å…è®¸ç”¨æˆ·å­˜å…¥ ETH å¹¶è·å¾— 1:1 çš„ Yes/No ä»£å¸", async function () {
            const <span class="hljs-attr">mintAmount</span> = parseEther(<span class="hljs-string">"1"</span>)<span class="hljs-comment">;</span>

            // æ‰§è¡Œé“¸é€ 
            const <span class="hljs-attr">hash</span> = await market.write.mintPositions({
                value: mintAmount,
                account: user1.account
            })<span class="hljs-comment">;</span>
            await publicClient.waitForTransactionReceipt({ hash })<span class="hljs-comment">;</span>

            // æ£€æŸ¥ä½™é¢
            const <span class="hljs-attr">userYesBalance</span> = await <span class="hljs-literal">yes</span>Token.read.balanceOf([user1.account.address])<span class="hljs-comment">;</span>
            const <span class="hljs-attr">userNoBalance</span> = await noToken.read.balanceOf([user1.account.address])<span class="hljs-comment">;</span>

            assert.equal(userYesBalance, mintAmount, "YES ä»£å¸æ•°é‡ä¸åŒ¹é…")<span class="hljs-comment">;</span>
            assert.equal(userNoBalance, mintAmount, "NO ä»£å¸æ•°é‡ä¸åŒ¹é…")<span class="hljs-comment">;</span>
            
            console.log(`ç”¨æˆ·1 æˆåŠŸé“¸é€ : ${formatEther(userYesBalance)} YES &amp; NO`)<span class="hljs-comment">;</span>
        })<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>

    describe("Resolution &amp; Redemption (ç»“ç®—ä¸å…‘ä»˜)", function () {
        beforeEach(async function () {
            // é¢„å…ˆä¸º user1 é“¸é€  2 ETH çš„å¤´å¯¸
            await market.write.mintPositions({
                value: parseEther("2"),
                account: user1.account
            })<span class="hljs-comment">;</span>
        })<span class="hljs-comment">;</span>

        it("å½“ä»·æ ¼è¶…è¿‡ç›®æ ‡æ—¶ï¼ŒYES æŒæœ‰è€…åº”èƒ½å…‘ç°", async function () {
            // 1. æ¨¡æ‹Ÿä»·æ ¼ä¸Šæ¶¨è‡³ 3500 (è¶…è¿‡ç›®æ ‡ 3000)
            const <span class="hljs-attr">newPrice</span> = <span class="hljs-number">3500</span>n * <span class="hljs-number">10</span>n**<span class="hljs-number">8</span>n<span class="hljs-comment">;</span>
            await mockOracle.write.updatePrice(<span class="hljs-section">[newPrice]</span>)<span class="hljs-comment">;</span>

            // 2. æ‰€æœ‰è€…ç»“ç®—å¸‚åœº
            await market.write.resolveMarket()<span class="hljs-comment">;</span>
            
            const <span class="hljs-attr">winningOutcome</span> = await market.read.winningOutcome()<span class="hljs-comment">;</span>
            assert.equal(winningOutcome, true, "åº”è¯¥æ˜¯ YES èµ¢")<span class="hljs-comment">;</span>

            // 3. ç”¨æˆ·å…‘ç° YES ä»£å¸
            const <span class="hljs-attr">redeemAmount</span> = parseEther(<span class="hljs-string">"2"</span>)<span class="hljs-comment">;</span>
            const <span class="hljs-attr">balanceBefore</span> = await publicClient.getBalance({ address: user1.account.address })<span class="hljs-comment">;</span>

            const <span class="hljs-attr">hash</span> = await market.write.redeem([redeemAmount], {
                account: user1.account
            })<span class="hljs-comment">;</span>
            await publicClient.waitForTransactionReceipt({ hash })<span class="hljs-comment">;</span>

            // 4. æ£€æŸ¥ç»“æœ
            const <span class="hljs-attr">yesBalanceAfter</span> = await <span class="hljs-literal">yes</span>Token.read.balanceOf([user1.account.address])<span class="hljs-comment">;</span>
            const <span class="hljs-attr">balanceAfter</span> = await publicClient.getBalance({ address: user1.account.address })<span class="hljs-comment">;</span>

            assert.equal(yesBalanceAfter, 0n, "å…‘ç°åä»£å¸åº”é”€æ¯")<span class="hljs-comment">;</span>
            assert.ok(balanceAfter &gt; balanceBefore, "ç”¨æˆ·ä½™é¢åº”å¢åŠ  (å¿½ç•¥ Gas)")<span class="hljs-comment">;</span>
            
            console.log("âœ… YES èƒœå‡ºï¼Œç”¨æˆ·æˆåŠŸå…‘å› ETH")<span class="hljs-comment">;</span>
        })<span class="hljs-comment">;</span>

        it("æœªç»“ç®—å‰ä¸åº”å…è®¸å…‘ç°", async function () {
            await assert.rejects(
                market.write.redeem(<span class="hljs-section">[parseEther("1")]</span>, { account: user1.account }),
                /NotResolved/,
                "æœªç»“ç®—æ—¶ä¸åº”å…è®¸ redeem"
            )<span class="hljs-comment">;</span>
        })<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-7">éƒ¨ç½²è„šæœ¬</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// scripts/deploy.js</span>
<span class="hljs-keyword">import</span> { network, artifacts } <span class="hljs-keyword">from</span> <span class="hljs-string">"hardhat"</span>;
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// è¿æ¥ç½‘ç»œ</span>
  <span class="hljs-keyword">const</span> { viem } = <span class="hljs-keyword">await</span> network.<span class="hljs-title function_">connect</span>({ <span class="hljs-attr">network</span>: network.<span class="hljs-property">name</span> });<span class="hljs-comment">//æŒ‡å®šç½‘ç»œè¿›è¡Œé“¾æ¥</span>
  
  <span class="hljs-comment">// è·å–å®¢æˆ·ç«¯</span>
  <span class="hljs-keyword">const</span> [deployer] = <span class="hljs-keyword">await</span> viem.<span class="hljs-title function_">getWalletClients</span>();
  <span class="hljs-keyword">const</span> publicClient = <span class="hljs-keyword">await</span> viem.<span class="hljs-title function_">getPublicClient</span>();
 
  <span class="hljs-keyword">const</span> deployerAddress = deployer.<span class="hljs-property">account</span>.<span class="hljs-property">address</span>;
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"éƒ¨ç½²è€…çš„åœ°å€:"</span>, deployerAddress);
  <span class="hljs-comment">// åŠ è½½åˆçº¦</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title class_">MockV3AggregatorArtifact</span> = <span class="hljs-keyword">await</span> artifacts.<span class="hljs-title function_">readArtifact</span>(<span class="hljs-string">"MockV3Aggregator4"</span>);
  <span class="hljs-keyword">const</span> <span class="hljs-title class_">PredictionMarketArtifact</span> = <span class="hljs-keyword">await</span> artifacts.<span class="hljs-title function_">readArtifact</span>(<span class="hljs-string">"PredictionMarket"</span>);
  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TARGET_PRICE</span> = <span class="hljs-number">3000n</span> * <span class="hljs-number">10n</span>**<span class="hljs-number">8n</span>; <span class="hljs-comment">// å‡è®¾ç›®æ ‡ä»· 3000 (8ä½å°æ•°)</span>
 <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">INITIAL_PRICE</span> = <span class="hljs-number">2500n</span> * <span class="hljs-number">10n</span>**<span class="hljs-number">8n</span>; <span class="hljs-comment">// åˆå§‹ä»· 2500</span>
  <span class="hljs-comment">// éƒ¨ç½²ï¼ˆæ„é€ å‡½æ•°å‚æ•°ï¼šrecipient, initialOwnerï¼‰</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title class_">MockV3AggregatorHash</span> = <span class="hljs-keyword">await</span> deployer.<span class="hljs-title function_">deployContract</span>({
    <span class="hljs-attr">abi</span>: <span class="hljs-title class_">MockV3AggregatorArtifact</span>.<span class="hljs-property">abi</span>,<span class="hljs-comment">//è·å–abi</span>
    <span class="hljs-attr">bytecode</span>: <span class="hljs-title class_">MockV3AggregatorArtifact</span>.<span class="hljs-property">bytecode</span>,<span class="hljs-comment">//ç¡¬ç¼–ç </span>
    <span class="hljs-attr">args</span>: [<span class="hljs-variable constant_">INITIAL_PRICE</span>],<span class="hljs-comment">//éƒ¨ç½²è€…åœ°å€ï¼Œåˆå§‹æ‰€æœ‰è€…åœ°å€</span>
  });
   <span class="hljs-keyword">const</span> <span class="hljs-title class_">MockV3AggregatorReceipt</span> = <span class="hljs-keyword">await</span> publicClient.<span class="hljs-title function_">waitForTransactionReceipt</span>({ <span class="hljs-attr">hash</span>: <span class="hljs-title class_">MockV3AggregatorHash</span> });
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"é¢„è¨€æœºåˆçº¦åœ°å€:"</span>, <span class="hljs-title class_">MockV3AggregatorReceipt</span>.<span class="hljs-property">contractAddress</span>);
<span class="hljs-comment">//</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">PredictionMarketHash</span> = <span class="hljs-keyword">await</span> deployer.<span class="hljs-title function_">deployContract</span>({
    <span class="hljs-attr">abi</span>: <span class="hljs-title class_">PredictionMarketArtifact</span>.<span class="hljs-property">abi</span>,<span class="hljs-comment">//è·å–abi</span>
    <span class="hljs-attr">bytecode</span>: <span class="hljs-title class_">PredictionMarketArtifact</span>.<span class="hljs-property">bytecode</span>,<span class="hljs-comment">//ç¡¬ç¼–ç </span>
    <span class="hljs-attr">args</span>: [<span class="hljs-title class_">MockV3AggregatorReceipt</span>.<span class="hljs-property">contractAddress</span>,<span class="hljs-variable constant_">TARGET_PRICE</span>],<span class="hljs-comment">//éƒ¨ç½²è€…åœ°å€ï¼Œåˆå§‹æ‰€æœ‰è€…åœ°å€</span>
  });
  <span class="hljs-comment">// ç­‰å¾…ç¡®è®¤å¹¶æ‰“å°åœ°å€</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title class_">PredictionMarketReceipt</span> = <span class="hljs-keyword">await</span> publicClient.<span class="hljs-title function_">waitForTransactionReceipt</span>({ <span class="hljs-attr">hash</span>: <span class="hljs-title class_">PredictionMarketHash</span> });
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"é¢„æµ‹å¸‚åœºåˆçº¦åœ°å€:"</span>, <span class="hljs-title class_">PredictionMarketReceipt</span>.<span class="hljs-property">contractAddress</span>);
}
<span class="hljs-title function_">main</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">error</span>);
</code></pre>
<h3 data-id="heading-8">ä¸‰ã€ç”Ÿæ€ä»·å€¼ä¸æœªæ¥å±•æœ›</h3>
<p>åœ¨ 2026 å¹´çš„ Web3 ç”Ÿæ€ä¸­ï¼Œå»ä¸­å¿ƒåŒ–é¢„æµ‹å¸‚åœºä¸ä»…æ˜¯ DeFi çš„æ ¸å¿ƒç»„ä»¶ï¼Œæ›´æ˜¯<strong>è¿æ¥é“¾ä¸Šä¸é“¾ä¸‹ä¸–ç•Œçš„é‡è¦æ¡¥æ¢</strong>ï¼Œå…¶ç”Ÿæ€ä»·å€¼æ—©å·²è¶…è¶Šå•çº¯çš„é¢„æµ‹åŠŸèƒ½</p>
<h4 data-id="heading-9">1. æ ¸å¿ƒç”Ÿæ€ä»·å€¼</h4>

























<table><thead><tr><th>ä»·å€¼æ–¹å‘</th><th>å…·ä½“åº”ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>ç¾¤ä½“æ™ºæ…§ä»·æ ¼å‘ç°</td><td>é‡‘èå¯¹å†²ã€ä¼ä¸šå†³ç­–ã€æ”¿ç­–åˆ¶å®šçš„æ¦‚ç‡æ•°æ®æ”¯æ’‘</td></tr><tr><td>DeFi ç”Ÿæ€è¡¥å……</td><td>å¼€å‘äº‹ä»¶ä¿é™©ã€å¯¹å†²å·¥å…·ã€åˆæˆèµ„äº§ç­‰åˆ›æ–°äº§å“</td></tr><tr><td>DAO æ²»ç†å·¥å…·</td><td>ä¸º DAO ææ¡ˆæä¾›ç¤¾åŒºé¢„æœŸå‚è€ƒï¼Œæå‡æ²»ç†ç§‘å­¦æ€§</td></tr><tr><td>RWA ä»·å€¼æ˜ å°„</td><td>å®ç°ç°å®äº‹ä»¶ï¼ˆå¤§å®—å•†å“ / ä½“è‚²èµ›äº‹ / å®è§‚æ•°æ®ï¼‰çš„é“¾ä¸Šä»·å€¼æ˜ å°„</td></tr></tbody></table>
<h4 data-id="heading-10">2. æœªæ¥æ¼”è¿›æ–¹å‘</h4>
<ul>
<li><strong>æŠ€æœ¯å±‚é¢</strong>ï¼šç»“åˆ ZKPã€ä¹è§‚é¢„è¨€æœºã€è·¨é“¾æŠ€æœ¯ï¼Œæå‡å»ä¸­å¿ƒåŒ–ç¨‹åº¦ã€é™ä½å‚ä¸é—¨æ§›ï¼›</li>
<li><strong>å¾…è§£å†³é—®é¢˜</strong>ï¼šåˆè§„æ€§ã€æµåŠ¨æ€§ã€ç”¨æˆ·æ•™è‚²ï¼›</li>
<li><strong>æ ¸å¿ƒç›®æ ‡</strong>ï¼šå®ç° â€œç¾¤ä½“æ™ºæ…§çš„ä»·å€¼åŒ–â€ï¼Œæˆä¸º Web3 è½åœ°ç°å®åº”ç”¨çš„æ ¸å¿ƒè½½ä½“ã€‚</li>
</ul>
<h2 data-id="heading-11">æ€»ç»“</h2>
<ul>
<li>
<p><strong>åº•å±‚é€»è¾‘</strong>ï¼šDPM çš„æ ¸å¿ƒæ˜¯ â€œ1=1+1 æŠµæŠ¼å“å®ˆæ’æ³•åˆ™â€ï¼Œè´¯ç©¿é“¸é€ ã€å®šä»·ã€ç»“ç®—å…¨æµç¨‹ï¼›</p>
</li>
<li>
<p><strong>æŠ€æœ¯å®ç°</strong>ï¼šåˆçº¦é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œç»“åˆ OpenZeppelin ä¿éšœå®‰å…¨ï¼ŒViem æ›¿ä»£ Ethers å®ç°é«˜æ•ˆæµ‹è¯• / éƒ¨ç½²ï¼›</p>
</li>
<li>
<p><strong>ç”Ÿæ€ä»·å€¼</strong>ï¼šDPM çš„æ ¸å¿ƒä»·å€¼æ˜¯æŒ–æ˜ç¾¤ä½“æ™ºæ…§ã€æ¨åŠ¨é“¾ä¸Šé“¾ä¸‹èåˆï¼Œè€Œéå•çº¯çš„åšå¼ˆåŠŸèƒ½ï¼›</p>
</li>
<li>
<p><strong>æ‹“å±•æ€§</strong>ï¼šæœ¬æ–‡ä»£ç ä¸ºåŸºç¡€æ¡†æ¶ï¼Œå¯åŸºäºæ­¤æ‹“å±• AMMï¼ˆæå‡æµåŠ¨æ€§ï¼‰ã€ERC1155ï¼ˆå¤šç»“æœæ”¯æŒï¼‰ç­‰ç”Ÿäº§çº§åŠŸèƒ½ã€‚</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Androidè¯­éŸ³é€šè¯çŠ¶æ€ç›‘å¬]]></title>    <link>https://juejin.cn/post/7603627478020292618</link>    <guid>https://juejin.cn/post/7603627478020292618</guid>    <pubDate>2026-02-07T04:47:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603627478020292618" data-draft-id="7603575763787235354" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Androidè¯­éŸ³é€šè¯çŠ¶æ€ç›‘å¬"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-02-07T04:47:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·341408199125"/> <meta itemprop="url" content="https://juejin.cn/user/570004686782272"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Androidè¯­éŸ³é€šè¯çŠ¶æ€ç›‘å¬
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/570004686782272/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·341408199125
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T04:47:49.000Z" title="Sat Feb 07 2026 04:47:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">ä¸€ã€ç›‘å¬æ–¹æ¡ˆå¯¹æ¯”</h3>
<p>Android æä¾›äº† <strong>ä¸¤å¥—ç›‘å¬ä½“ç³»</strong>ï¼š</p>





































<table><thead><tr><th>æ–¹æ¡ˆ</th><th>API å±‚çº§</th><th>æƒé™</th><th>ç²¾åº¦</th><th>æ¨è</th><th>å¼ƒç”¨</th></tr></thead><tbody><tr><td><strong>PhoneStateListener</strong></td><td>android.telephony</td><td>READ_PHONE_STATE</td><td>ä½</td><td>âœ—</td><td>âœ“ å·²å¼ƒç”¨</td></tr><tr><td><strong>TelephonyCallback</strong></td><td>android.telephony</td><td>READ_PHONE_STATE</td><td>é«˜</td><td>âœ“</td><td>ç°ä»£æ–¹æ¡ˆ</td></tr><tr><td><strong>PreciseCallStateListener</strong></td><td>@SystemApi</td><td>READ_PRECISE_PHONE_STATE</td><td>é«˜</td><td>ç³»ç»Ÿåº”ç”¨</td><td>ä½å±‚ç›‘å¬</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-1">äºŒã€é€šè¯çŠ¶æ€å±‚çº§</h3>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é€šè¯çŠ¶æ€çš„ <span class="hljs-number">3</span> ä¸ªå±‚çº§                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

<span class="hljs-number">1</span>ï¸âƒ£ é«˜å±‚çŠ¶æ€ (TelephonyCallback.CallStateListener)
   â”œâ”€ CALL_STATE_IDLE       (<span class="hljs-number">0</span>)   æ— é€šè¯
   â”œâ”€ CALL_STATE_RINGING    (<span class="hljs-number">1</span>)   æ¥ç”µå“é“ƒ
   â””â”€ CALL_STATE_OFFHOOK    (<span class="hljs-number">2</span>)   æ´»è·ƒé€šè¯æˆ–é€šè¯ä¸­

<span class="hljs-number">2</span>ï¸âƒ£ ç²¾ç¡®çŠ¶æ€ (PreciseCallState - ç³»ç»Ÿçº§)
   â”œâ”€ PRECISE_CALL_STATE_IDLE           (<span class="hljs-number">0</span>)   ç©ºé—²
   â”œâ”€ PRECISE_CALL_STATE_ACTIVE         (<span class="hljs-number">1</span>)   æ´»è·ƒé€šè¯
   â”œâ”€ PRECISE_CALL_STATE_HOLDING        (<span class="hljs-number">2</span>)   ä¿æŒé€šè¯
   â”œâ”€ PRECISE_CALL_STATE_DIALING        (<span class="hljs-number">3</span>)   æ­£åœ¨æ‹¨å·
   â”œâ”€ PRECISE_CALL_STATE_ALERTING       (<span class="hljs-number">4</span>)   è¿œæ–¹å“é“ƒ
   â”œâ”€ PRECISE_CALL_STATE_INCOMING       (<span class="hljs-number">5</span>)   æ¥ç”µ
   â”œâ”€ PRECISE_CALL_STATE_WAITING        (<span class="hljs-number">6</span>)   æ¥ç”µç­‰å¾…
   â”œâ”€ PRECISE_CALL_STATE_DISCONNECTED   (<span class="hljs-number">7</span>)   å·²æ–­å¼€
   â””â”€ PRECISE_CALL_STATE_DISCONNECTING  (<span class="hljs-number">8</span>)   æ­£åœ¨æ–­å¼€

<span class="hljs-number">3</span>ï¸âƒ£ Call å†…éƒ¨çŠ¶æ€ (frameworks_opt_telephony)
   â”œâ”€ Call<span class="hljs-selector-class">.State</span><span class="hljs-selector-class">.IDLE</span>         (æ— è¿æ¥)
   â”œâ”€ Call<span class="hljs-selector-class">.State</span><span class="hljs-selector-class">.ACTIVE</span>       (æ´»è·ƒ)
   â”œâ”€ Call<span class="hljs-selector-class">.State</span><span class="hljs-selector-class">.HOLDING</span>      (ä¿æŒ)
   â”œâ”€ Call<span class="hljs-selector-class">.State</span><span class="hljs-selector-class">.DIALING</span>      (æ‹¨å·ä¸­ - MO)
   â”œâ”€ Call<span class="hljs-selector-class">.State</span><span class="hljs-selector-class">.ALERTING</span>     (è¿œæ–¹å“é“ƒ - MO)
   â”œâ”€ Call<span class="hljs-selector-class">.State</span><span class="hljs-selector-class">.INCOMING</span>     (æ¥ç”µ - MT)
   â”œâ”€ Call<span class="hljs-selector-class">.State</span><span class="hljs-selector-class">.WAITING</span>      (æ¥ç”µç­‰å¾… - MT)
   â”œâ”€ Call<span class="hljs-selector-class">.State</span><span class="hljs-selector-class">.DISCONNECTED</span> (å·²æ–­å¼€)
   â””â”€ Call<span class="hljs-selector-class">.State</span><span class="hljs-selector-class">.DISCONNECTING</span> (æ–­å¼€ä¸­)
</code></pre>
<hr/>
<h3 data-id="heading-2">ä¸‰ã€ç°ä»£æ–¹æ¡ˆï¼šTelephonyCallback</h3>
<h4 data-id="heading-3">3.1 åŸºç¡€ç”¨æ³•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åˆ›å»ºå›è°ƒç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTelephonyCallback</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">TelephonyCallback</span> <span class="hljs-keyword">implements</span>
        <span class="hljs-title class_">TelephonyCallback</span>.CallStateListener {
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCallStateChanged</span><span class="hljs-params">(<span class="hljs-meta">@Annotation</span>.CallState <span class="hljs-type">int</span> state)</span> {
        <span class="hljs-keyword">switch</span>(state) {
            <span class="hljs-keyword">case</span> TelephonyManager.CALL_STATE_IDLE:
                <span class="hljs-comment">// æ— é€šè¯</span>
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> TelephonyManager.CALL_STATE_RINGING:
                <span class="hljs-comment">// æ¥ç”µæˆ–æ¥ç”µç­‰å¾…</span>
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> TelephonyManager.CALL_STATE_OFFHOOK:
                <span class="hljs-comment">// æ´»è·ƒé€šè¯æˆ–æ­£åœ¨æ‹¨å·</span>
                <span class="hljs-keyword">break</span>;
        }
    }
}

<span class="hljs-comment">// æ³¨å†Œç›‘å¬</span>
<span class="hljs-type">TelephonyManager</span> <span class="hljs-variable">tm</span> <span class="hljs-operator">=</span> context.getSystemService(TelephonyManager.class);
<span class="hljs-type">MyTelephonyCallback</span> <span class="hljs-variable">callback</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyTelephonyCallback</span>();

tm.registerTelephonyCallback(
    executor,           <span class="hljs-comment">// Executor (å¦‚ ConcurrentUtils.DIRECT_EXECUTOR)</span>
    callback            <span class="hljs-comment">// TelephonyCallback å®ä¾‹</span>
);

<span class="hljs-comment">// å–æ¶ˆç›‘å¬</span>
tm.unregisterTelephonyCallback(callback);
</code></pre>
<h4 data-id="heading-4">3.2 æƒé™é…ç½®</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- AndroidManifest.xml --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.READ_PHONE_STATE"</span> /&gt;</span>
</code></pre>
<p><strong>æƒé™è·å–</strong> (Android 31+):</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">if</span> (ContextCompat.checkSelfPermission(context, 
        Manifest.permission.READ_PHONE_STATE)
        != PackageManager.PERMISSION_GRANTED) {
    <span class="hljs-comment">// è¯·æ±‚æƒé™</span>
    ActivityCompat.requestPermissions(activity,
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]{Manifest.permission.READ_PHONE_STATE}, 
            REQUEST_CODE);
}
</code></pre>
<h4 data-id="heading-5">3.3 é«˜çº§ï¼šPreciseCallStateListener (ç³»ç»Ÿåº”ç”¨)</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åªæœ‰ç³»ç»Ÿåº”ç”¨æˆ–è¿è¥å•†åº”ç”¨èƒ½ä½¿ç”¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyPreciseCallback</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">TelephonyCallback</span> <span class="hljs-keyword">implements</span>
        <span class="hljs-title class_">TelephonyCallback</span>.PreciseCallStateListener {
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onPreciseCallStateChanged</span><span class="hljs-params">(PreciseCallState callState)</span> {
        <span class="hljs-comment">// è·å–ä¸‰ç±»ç”µè¯çš„ç²¾ç¡®çŠ¶æ€</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">ringingState</span> <span class="hljs-operator">=</span> callState.getRingingCallState();
        <span class="hljs-type">int</span> <span class="hljs-variable">fgState</span> <span class="hljs-operator">=</span> callState.getForegroundCallState();
        <span class="hljs-type">int</span> <span class="hljs-variable">bgState</span> <span class="hljs-operator">=</span> callState.getBackgroundCallState();
        
        <span class="hljs-comment">// çŠ¶æ€å¤„ç†</span>
        handleCallState(ringingState, fgState, bgState);
    }
}

<span class="hljs-comment">// æ³¨å†Œ</span>
tm.registerTelephonyCallback(executor, preciseCallback);
</code></pre>
<p><strong>æƒé™</strong> (ç³»ç»Ÿçº§):</p>
<pre><code class="hljs language-ini" lang="ini">&lt;uses-permission android:<span class="hljs-attr">name</span>=<span class="hljs-string">"android.permission.READ_PRECISE_PHONE_STATE"</span> /&gt;
</code></pre>
<h4 data-id="heading-6">3.4 å…¶ä»–æœ‰ç”¨çš„å›è°ƒ</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FullTelephonyCallback</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">TelephonyCallback</span> <span class="hljs-keyword">implements</span>
        <span class="hljs-title class_">TelephonyCallback</span>.CallStateListener,
        TelephonyCallback.CallAttributesListener,
        TelephonyCallback.CallDisconnectCauseListener {
    
    <span class="hljs-comment">// åŸºç¡€é€šè¯çŠ¶æ€</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCallStateChanged</span><span class="hljs-params">(<span class="hljs-type">int</span> state)</span> {
        Log.d(TAG, <span class="hljs-string">"Call state: "</span> + state);
    }
    
    <span class="hljs-comment">// é€šè¯å±æ€§ (è´¨é‡ã€ç½‘ç»œç±»å‹ç­‰)</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCallAttributesChanged</span><span class="hljs-params">(CallAttributes attrs)</span> {
        <span class="hljs-type">PreciseCallState</span> <span class="hljs-variable">callState</span> <span class="hljs-operator">=</span> attrs.getPreciseCallState();
        <span class="hljs-type">int</span> <span class="hljs-variable">networkType</span> <span class="hljs-operator">=</span> attrs.getNetworkType();
        <span class="hljs-type">CallQuality</span> <span class="hljs-variable">quality</span> <span class="hljs-operator">=</span> attrs.getCallQuality();
    }
    
    <span class="hljs-comment">// æ–­å¼€åŸå› </span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCallDisconnectCauseChanged</span><span class="hljs-params">(<span class="hljs-type">int</span> cause, <span class="hljs-type">int</span> preciseCause)</span> {
        <span class="hljs-comment">// DisconnectCause ç±»ä¸­å®šä¹‰</span>
        Log.d(TAG, <span class="hljs-string">"Disconnect: "</span> + cause);
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-7">å››ã€æ—§æ–¹æ¡ˆï¼šPhoneStateListenerï¼ˆå·²å¼ƒç”¨ï¼‰</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âš ï¸ ä¸æ¨èä½¿ç”¨ï¼Œä»…ä½œå‚è€ƒ</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyPhoneStateListener</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">PhoneStateListener</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCallStateChanged</span><span class="hljs-params">(<span class="hljs-type">int</span> state, String incomingNumber)</span> {
        <span class="hljs-comment">// state: CALL_STATE_IDLE / RINGING / OFFHOOK</span>
        <span class="hljs-comment">// incomingNumber: æ¥ç”µå·ç ï¼ˆå¯èƒ½ä¸ºç©ºï¼‰</span>
    }
}

<span class="hljs-comment">// æ³¨å†Œ</span>
<span class="hljs-type">TelephonyManager</span> <span class="hljs-variable">tm</span> <span class="hljs-operator">=</span> context.getSystemService(TelephonyManager.class);
tm.listen(phoneStateListener, PhoneStateListener.LISTEN_CALL_STATE);

<span class="hljs-comment">// å–æ¶ˆ</span>
tm.listen(phoneStateListener, PhoneStateListener.LISTEN_NONE);
</code></pre>
<hr/>
<h3 data-id="heading-8">äº”ã€é€šè¯çŠ¶æ€è½¬ç§»å›¾</h3>
<h4 data-id="heading-9">5.1 æ‹¨å·æµç¨‹ (Outgoing Call)</h4>
<pre><code class="hljs language-objectivec" lang="objectivec">ç”¨æˆ·æ‹¨å·
    â”‚
    â”œâ”€â†’ <span class="hljs-built_in">CALL_STATE_OFFHOOK</span> (å¼€å§‹æ‹¨å·)
    â”‚
    â””â”€â†’ PreciseCallState:
        â”œâ”€ DIALING        (æ­£åœ¨æ‹¨å·)
        â”œâ”€ ALERTING       (è¿œæ–¹å“é“ƒ)
        â””â”€ ACTIVE         (é€šè¯å·²æ¥é€š)
        
        â”‚
        â””â”€â†’ æŒ‚æ–­
            â”œâ”€ DISCONNECTING
            â””â”€ DISCONNECTED
            
        â”‚
        â””â”€â†’ <span class="hljs-built_in">CALL_STATE_IDLE</span> (é€šè¯ç»“æŸ)
</code></pre>
<p><strong>è¯¦ç»†äº‹ä»¶åºåˆ—</strong>:</p>
<pre><code class="hljs language-ini" lang="ini">æ‹¨å·
  â”‚
  â”œâ”€ Event: onCallStateChanged(CALL_STATE_OFFHOOK)
  â”‚
  â”œâ”€ Event: onPreciseCallStateChanged(
  â”‚            <span class="hljs-attr">ringing</span>=IDLE,
  â”‚            <span class="hljs-attr">fg</span>=DIALING,
  â”‚            <span class="hljs-attr">bg</span>=IDLE)
  â”‚
  â”œâ”€ RIL ä¸ŠæŠ¥è¿œæ–¹å“é“ƒ
  â”‚  â””â”€ Event: onPreciseCallStateChanged(
  â”‚             <span class="hljs-attr">fg</span>=ALERTING, ...)
  â”‚
  â”œâ”€ è¿œæ–¹æ¥å¬
  â”‚  â””â”€ Event: onPreciseCallStateChanged(
  â”‚             <span class="hljs-attr">fg</span>=ACTIVE, ...)
  â”‚
  â””â”€ é€šè¯ä¸­ (ä¿æŒ OFFHOOK çŠ¶æ€)
</code></pre>
<h4 data-id="heading-10">5.2 æ¥ç”µæµç¨‹ (Incoming Call)</h4>
<pre><code class="hljs language-objectivec" lang="objectivec">RIL ä¸ŠæŠ¥æ–°æ¥ç”µ
    â”‚
    â”œâ”€â†’ <span class="hljs-built_in">CALL_STATE_RINGING</span> (æ¥ç”µé“ƒå£°)
    â”‚
    â”œâ”€â†’ PreciseCallState:
    â”‚   â”œâ”€ INCOMING  (MT æ¥ç”µ)
    â”‚   â””â”€ WAITING   (å·²æœ‰æ´»è·ƒå‘¼å«ï¼Œæ¥ç”µç­‰å¾…)
    â”‚
    â”œâ”€ ç”¨æˆ·æ¥å¬
    â”‚  â”œâ”€ <span class="hljs-built_in">CALL_STATE_OFFHOOK</span> (é€šè¯ä¸­)
    â”‚  â””â”€ ACTIVE (å·²æ¥é€š)
    â”‚
    â””â”€ ç”¨æˆ·æ‹’æ¥
       â””â”€ DISCONNECTED + <span class="hljs-built_in">CALL_STATE_IDLE</span>
</code></pre>
<p><strong>å®Œæ•´äº‹ä»¶åºåˆ—</strong>:</p>
<pre><code class="hljs language-ini" lang="ini">æ¥ç”µåˆ°è¾¾
  â”‚
  â”œâ”€ Event: onCallStateChanged(CALL_STATE_RINGING)
  â”‚
  â”œâ”€ Event: onPreciseCallStateChanged(
  â”‚            <span class="hljs-attr">ringing</span>=INCOMING,
  â”‚            <span class="hljs-attr">fg</span>=IDLE,
  â”‚            <span class="hljs-attr">bg</span>=IDLE)
  â”‚
  â”œâ”€ ç”¨æˆ·æ¥å¬
  â”‚  â”œâ”€ Event: onCallStateChanged(CALL_STATE_OFFHOOK)
  â”‚  â””â”€ Event: onPreciseCallStateChanged(
  â”‚             <span class="hljs-attr">ringing</span>=IDLE,
  â”‚             <span class="hljs-attr">fg</span>=ACTIVE,
  â”‚             <span class="hljs-attr">bg</span>=IDLE)
  â”‚
  â””â”€ é€šè¯ä¸­
</code></pre>
<h4 data-id="heading-11">5.3 æ¥ç”µç­‰å¾… (Call Waiting)</h4>
<pre><code class="hljs language-ini" lang="ini">æ´»è·ƒé€šè¯ä¸­ï¼Œæ”¶åˆ°æ–°æ¥ç”µ
    â”‚
    â”œâ”€ ä¿æŒæ´»è·ƒé€šè¯
    â”‚  â””â”€ <span class="hljs-attr">fg</span>=ACTIVE
    â”‚
    â”œâ”€ æ–°æ¥ç”µè¿›å…¥ç­‰å¾…çŠ¶æ€
    â”‚  â””â”€ <span class="hljs-attr">ringing</span>=WAITING
    â”‚
    â”œâ”€ ç”¨æˆ·åˆ‡æ¢åˆ°æ¥ç”µ
    â”‚  â”œâ”€ <span class="hljs-attr">fg</span>=HOLDING (æ´»è·ƒè½¬ä¸ºä¿æŒ)
    â”‚  â””â”€ <span class="hljs-attr">ringing</span>=ACTIVE (ç­‰å¾…è½¬ä¸ºæ´»è·ƒ)
    â”‚
    â””â”€ ä»ä¸º CALL_STATE_OFFHOOK
</code></pre>
<h4 data-id="heading-12">5.4 ä¼šè®®é€šè¯</h4>
<pre><code class="hljs language-ini" lang="ini">å¤šæ–¹é€šè¯ä¸­
    â”‚
    â”œâ”€ <span class="hljs-attr">fg</span>=ACTIVE (å‰æ™¯é€šè¯)
    â”œâ”€ <span class="hljs-attr">bg</span>=ACTIVE (èƒŒæ™¯é€šè¯)
    â”‚
    â””â”€ çŠ¶æ€: CALL_STATE_OFFHOOK
</code></pre>
<hr/>
<h3 data-id="heading-13">å…­ã€æ ¸å¿ƒæ•°æ®ç»“æ„</h3>
<h4 data-id="heading-14">6.1 CallState (ç°ä»£)</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CallState</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Parcelable</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getCallState</span><span class="hljs-params">()</span>;              <span class="hljs-comment">// PRECISE_CALL_STATE_*</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCallClassification</span><span class="hljs-params">()</span>; <span class="hljs-comment">// FOREGROUND/BACKGROUND/RINGING</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getNetworkType</span><span class="hljs-params">()</span>;           <span class="hljs-comment">// NETWORK_TYPE_*</span>
    <span class="hljs-keyword">public</span> CallQuality <span class="hljs-title function_">getCallQuality</span><span class="hljs-params">()</span>;   <span class="hljs-comment">// é€šè¯è´¨é‡</span>
}
</code></pre>
<h4 data-id="heading-15">6.2 PreciseCallState</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PreciseCallState</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Parcelable</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getRingingCallState</span><span class="hljs-params">()</span>;      <span class="hljs-comment">// æ¥ç”µ/æ¥ç”µç­‰å¾…</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getForegroundCallState</span><span class="hljs-params">()</span>;   <span class="hljs-comment">// æ´»è·ƒé€šè¯</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getBackgroundCallState</span><span class="hljs-params">()</span>;   <span class="hljs-comment">// ä¿æŒé€šè¯</span>
    
    <span class="hljs-comment">// æ–­å¼€åŸå› </span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getDisconnectCause</span><span class="hljs-params">()</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getPreciseDisconnectCause</span><span class="hljs-params">()</span>;
}
</code></pre>
<h4 data-id="heading-16">6.3 CallAttributes</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CallAttributes</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Parcelable</span> {
    <span class="hljs-keyword">public</span> PreciseCallState <span class="hljs-title function_">getPreciseCallState</span><span class="hljs-params">()</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getNetworkType</span><span class="hljs-params">()</span>;           <span class="hljs-comment">// LTE, NR, WIFI ç­‰</span>
    <span class="hljs-keyword">public</span> CallQuality <span class="hljs-title function_">getCallQuality</span><span class="hljs-params">()</span>;   <span class="hljs-comment">// å»¶è¿Ÿã€ä¸¢åŒ…ç‡ç­‰</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-17">ä¸ƒã€å®æˆ˜ç¤ºä¾‹</h3>
<h4 data-id="heading-18">7.1 å®Œæ•´é€šè¯çŠ¶æ€ç›‘å¬å™¨</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CallStateMonitor</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Context mContext;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> TelephonyManager mTm;
    <span class="hljs-keyword">private</span> MyCallback mCallback;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CallStateMonitor</span><span class="hljs-params">(Context context)</span> {
        mContext = context;
        mTm = context.getSystemService(TelephonyManager.class);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startMonitoring</span><span class="hljs-params">(MyCallback callback)</span> {
        mCallback = callback;
        
        <span class="hljs-comment">// æ£€æŸ¥æƒé™</span>
        <span class="hljs-keyword">if</span> (ContextCompat.checkSelfPermission(mContext,
                Manifest.permission.READ_PHONE_STATE)
                == PackageManager.PERMISSION_GRANTED) {
            
            <span class="hljs-type">MyTelephonyCallback</span> <span class="hljs-variable">telCallback</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyTelephonyCallback</span>();
            mTm.registerTelephonyCallback(
                Executors.newSingleThreadExecutor(),
                telCallback
            );
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">stopMonitoring</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (mTelephonyCallback != <span class="hljs-literal">null</span>) {
            mTm.unregisterTelephonyCallback(mTelephonyCallback);
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTelephonyCallback</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">TelephonyCallback</span> <span class="hljs-keyword">implements</span>
            <span class="hljs-title class_">TelephonyCallback</span>.CallStateListener,
            TelephonyCallback.CallAttributesListener {
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCallStateChanged</span><span class="hljs-params">(<span class="hljs-type">int</span> state)</span> {
            String stateStr;
            <span class="hljs-keyword">switch</span> (state) {
                <span class="hljs-keyword">case</span> TelephonyManager.CALL_STATE_IDLE:
                    stateStr = <span class="hljs-string">"IDLE"</span>;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> TelephonyManager.CALL_STATE_RINGING:
                    stateStr = <span class="hljs-string">"RINGING"</span>;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> TelephonyManager.CALL_STATE_OFFHOOK:
                    stateStr = <span class="hljs-string">"OFFHOOK"</span>;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">default</span>:
                    stateStr = <span class="hljs-string">"UNKNOWN"</span>;
            }
            
            <span class="hljs-keyword">if</span> (mCallback != <span class="hljs-literal">null</span>) {
                mCallback.onCallStateChanged(stateStr);
            }
        }
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCallAttributesChanged</span><span class="hljs-params">(CallAttributes attrs)</span> {
            <span class="hljs-type">PreciseCallState</span> <span class="hljs-variable">ps</span> <span class="hljs-operator">=</span> attrs.getPreciseCallState();
            <span class="hljs-type">int</span> <span class="hljs-variable">quality</span> <span class="hljs-operator">=</span> attrs.getCallQuality().getAverageFlushedDelayMillis();
            
            <span class="hljs-keyword">if</span> (mCallback != <span class="hljs-literal">null</span>) {
                mCallback.onCallAttributesChanged(ps, quality);
            }
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MyCallback</span> {
        <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCallStateChanged</span><span class="hljs-params">(String state)</span>;
        <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCallAttributesChanged</span><span class="hljs-params">(PreciseCallState state, <span class="hljs-type">int</span> quality)</span>;
    }
}
</code></pre>
<h4 data-id="heading-19">7.2 æ¥ç”µæ£€æµ‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IncomingCallDetector</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> TelephonyManager mTm;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">IncomingCallDetector</span><span class="hljs-params">(TelephonyManager tm)</span> {
        mTm = tm;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">monitorIncomingCalls</span><span class="hljs-params">(Executor executor)</span> {
        mTm.registerTelephonyCallback(executor, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TelephonyCallback</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCallStateChanged</span><span class="hljs-params">(<span class="hljs-type">int</span> state)</span> {
                <span class="hljs-keyword">if</span> (state == TelephonyManager.CALL_STATE_RINGING) {
                    <span class="hljs-comment">// æ¥ç”µåˆ°è¾¾</span>
                    Log.d(TAG, <span class="hljs-string">"Incoming call detected!"</span>);
                    handleIncomingCall();
                }
            }
        });
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleIncomingCall</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// å¯ä»¥æ‰§è¡Œï¼š</span>
        <span class="hljs-comment">// - è®°å½•é€šè¯</span>
        <span class="hljs-comment">// - æ˜¾ç¤ºé€šçŸ¥</span>
        <span class="hljs-comment">// - è·å–æ¥ç”µä¿¡æ¯</span>
        <span class="hljs-comment">// - è‡ªåŠ¨åº”ç­”ï¼ˆéœ€è¦é«˜æƒé™ï¼‰</span>
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-20">å…«ã€å¸¸è§é—®é¢˜</h3>
<p><strong>Q1: å¦‚ä½•è·å¾—æ¥ç”µå·ç ?</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ—§ API (å·²å¼ƒç”¨)</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">onCallStateChanged</span><span class="hljs-params">(<span class="hljs-type">int</span> state, String incomingNumber)</span> {
    <span class="hljs-comment">// incomingNumber åŒ…å«æ¥ç”µå·ç </span>
}

<span class="hljs-comment">// æ–° API: éœ€è¦å…¶ä»–æœºåˆ¶</span>
<span class="hljs-comment">// é€šå¸¸é€šè¿‡ PHONE_STATE_CHANGED å¹¿æ’­ + </span>
<span class="hljs-comment">// ContentResolver æŸ¥è¯¢é€šè¯è®°å½•</span>
</code></pre>
<p><strong>Q2: é€šè¯ä¸­å¦‚ä½•æ£€æµ‹æŒ‚æ–­?</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç›‘å¬é€šè¯çŠ¶æ€å˜åŒ–</span>
<span class="hljs-comment">// OFFHOOK â†’ IDLE (é€šè¯ç»“æŸ)</span>
<span class="hljs-comment">// æˆ– onCallDisconnectCauseChanged() å›è°ƒ</span>
</code></pre>
<p><strong>Q3: å¦‚ä½•æ”¯æŒå¤šSIMå¡?</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸ºæ¯ä¸ªè®¢é˜…åˆ›å»ºç‹¬ç«‹çš„ TelephonyManager</span>
<span class="hljs-type">TelephonyManager</span> <span class="hljs-variable">tm</span> <span class="hljs-operator">=</span> 
    context.getSystemService(TelephonyManager.class)
           .createForSubscriptionId(subscriptionId);
tm.registerTelephonyCallback(executor, callback);
</code></pre>
<hr/>
<h3 data-id="heading-21">ä¹ã€æ€§èƒ½ä¼˜åŒ–</h3>
<ol>
<li><strong>é¿å…é¢‘ç¹æ³¨å†Œ/æ³¨é”€</strong> - åº”ç”¨å¯åŠ¨æ—¶æ³¨å†Œï¼Œé”€æ¯æ—¶å–æ¶ˆ</li>
<li><strong>ä½¿ç”¨åˆé€‚çš„ Executor</strong> - ä¸è¦åœ¨ UI çº¿ç¨‹å¤„ç†</li>
<li><strong>æƒé™æ£€æŸ¥</strong> - å…ˆæ£€æŸ¥æƒé™å†æ³¨å†Œï¼Œé¿å…å´©æºƒ</li>
<li><strong>å†…å­˜æ³„æ¼</strong> - ç¡®ä¿åœ¨ Activity é”€æ¯æ—¶å–æ¶ˆç›‘å¬</li>
</ol>
<p>è¿™å°±æ˜¯ Android é€šè¯çŠ¶æ€ç›‘å¬çš„å®Œæ•´ä½“ç³»ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸€ä¸ªå¤§é¾„ç¨‹åºå‘˜çš„åœ°é“æ—¥è®°ï¼ˆç¬¬7æœŸï¼‰ï¼Œå‡ ä»¶ç”Ÿæ´»å°äº‹ï¼Œä¸ä¸€ç§è®©è‡ªå·±å¹³é™çš„æ–¹æ³•]]></title>    <link>https://juejin.cn/post/7603567912593014811</link>    <guid>https://juejin.cn/post/7603567912593014811</guid>    <pubDate>2026-02-07T04:31:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603567912593014811" data-draft-id="7603627478020227082" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸€ä¸ªå¤§é¾„ç¨‹åºå‘˜çš„åœ°é“æ—¥è®°ï¼ˆç¬¬7æœŸï¼‰ï¼Œå‡ ä»¶ç”Ÿæ´»å°äº‹ï¼Œä¸ä¸€ç§è®©è‡ªå·±å¹³é™çš„æ–¹æ³•"/> <meta itemprop="keywords" content="ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2026-02-07T04:31:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æˆ‘è¦æ”¹åå«å˜Ÿå˜Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/1698109849624061"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸€ä¸ªå¤§é¾„ç¨‹åºå‘˜çš„åœ°é“æ—¥è®°ï¼ˆç¬¬7æœŸï¼‰ï¼Œå‡ ä»¶ç”Ÿæ´»å°äº‹ï¼Œä¸ä¸€ç§è®©è‡ªå·±å¹³é™çš„æ–¹æ³•
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1698109849624061/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æˆ‘è¦æ”¹åå«å˜Ÿå˜Ÿ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T04:31:01.000Z" title="Sat Feb 07 2026 04:31:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»14åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ¬æœŸçš„åœ°é“æ—¥è®°ï¼Œä¾ç„¶å„æœ‰æ ‡é¢˜ï¼Œå®ƒä»¬æ˜¯é¢è¯•å‡†å¤‡ã€æˆ‘çš„ç¦»å¼€æ·±åœ³å¿«ä¸‰å¹´ã€æ‹”æ™ºé½¿ã€è®©è‡ªå·±å˜å¾—å¹³é™çš„æ–¹æ³•ã€åœ°é“ä¸Šä¸¤ä¸ªå¥³äººçš„åµæ¶ã€å½“å‰çš„çœ‹ä¹¦åˆ†ç±»ï¼Œä»¥åŠæˆ‘ä¹Ÿæ¨èã€Šæ€§å¿ƒç†å­¦ã€‹ã€‚</p>
<h3 data-id="heading-0">1ã€é¢è¯•ä¹‹å‰å¯ä»¥åšå“ªäº›å‡†å¤‡å‘¢ï¼Ÿ</h3>
<p>ä½œä¸ºä¸€ä¸ªèŒåœºè€é¸Ÿï¼Œåå‡ å¹´æ¥å‚åŠ è¿‡å¾ˆå¤šå¾ˆå¤šæ¬¡é¢è¯•ï¼Œä¹Ÿåšè¿‡å‡ æ¬¡é¢è¯•å®˜ã€‚çœ‹è¿‡å¥½å‡ æœ¬é¢è¯•ç›¸å…³çš„ä¹¦ï¼Œä¹Ÿä¸ºé¢è¯•åˆ·è¿‡å¥½äº›é¢˜ã€‚</p>
<p>æˆ‘ç°åœ¨æƒ³åˆ°çš„ï¼Œå¤§æ¦‚æœ‰è¿™æ ·å‡ æ¡ï¼š</p>
<p>é¦–å…ˆæ˜¯å¤–è²Œçš„æŠŠæ§ï¼Œå¦‚æœé¢è¯•å²—ä½æœ‰ç€è£…è¦æ±‚ï¼Œè¯·æŒ‰ç…§è¿™è¦æ±‚è¿›è¡Œã€‚å¦‚æœæ²¡æœ‰ï¼Œç©¿ç€è¯·å°½é‡ç®€å•å¤§æ–¹ã€å¹²å‡€æ•´æ´ï¼Œèƒ¡å­æ‹‰ç¢´æ˜¯ä¸å¯å–çš„ã€‚ç¬¬ä¸€å°è±¡ï¼Œæ˜¯é‡è¦çš„ï¼Œè€ŒåŒæ—¶ï¼Œç€è£…æ•´æ´ä¹Ÿä»£è¡¨ç€äººé™…äº¤å¾€ä¸­ï¼ˆä¸ä»…ä»…æ˜¯é¢è¯•ï¼Œçº¦ä¼šåŒç†çš„ï¼‰çš„ä¸€ç§å°Šé‡ã€‚</p>
<p>ç„¶åå…³äºæ€åº¦ï¼Œæˆ‘ä»¥ä¸ºé¢è¯•è¿™ä»¶äº‹ï¼Œåº”è¯¥éƒ½ä»¥è®¤çœŸæ€åº¦å¯¹å¾…ï¼Œä¸ç®¡è‡ªå·±æ˜¯å¦æƒ³å»è¿™å…¬å¸ã€‚è®¤çœŸæ€åº¦ï¼Œä¼šåœ¨ä¸€æ¬¡æ¬¡é¢è¯•ä¸­ä¼ é€’ï¼Œè¿™ä¹Ÿå¯ç®—ä½œä¸€ç§è®­ç»ƒï¼Œä¸€ç§å¯å°†è®¤çœŸå›ºåŒ–åˆ°å¹³æ—¥è¡Œä¸ºçš„è®­ç»ƒã€‚ä½œä¸ºé¢è¯•å®˜ï¼Œæ˜¯èƒ½æ„Ÿå—åˆ°é¢è¯•è€…å¯¹æ­¤æ¬¡é¢è¯•çš„æŠ•å…¥ç¨‹åº¦çš„ã€‚æŠ•å…¥ï¼Œè¯´æ˜é è°±ï¼Œå°è±¡åˆ†ä¾¿å¯èƒ½å¤šä¸Šå‡ åˆ†ã€‚</p>
<p>ä¾ç„¶å…³äºæ€åº¦ï¼Œè®¤çœŸå‡†å¤‡è®¤çœŸå¯¹å¾…ä¹‹åï¼Œä½œä¸ºåº”è¯•è€…ï¼Œåº”è¯¥æœ‰ä¸€ç§ä¸å‘ä¸äº¢æ€åº¦ã€‚ç­”ä¸ä¸Šæ¥çš„é—®é¢˜ï¼Œç»è¿‡æ€ç´¢åç›´æ¥å›å¤â€œæ²¡äº†è§£è¿‡â€å³å¯ã€‚å…¶å®é¢è¯•å½“ä¸­è®¸å¤šé—®é¢˜ï¼Œé¢è¯•å®˜ä¹Ÿä¸ä¸€å®šç†Ÿæ‚‰ï¼Œé¢è¯•å®˜çš„ç›®æ ‡ï¼Œæ˜¯æ‰¾åˆ°ä¸€ä¸ªé è°±çš„åˆä½œè€…ï¼Œè€Œå¹¶éä»¥é¢è¯•é¢˜ç›®å¡äººã€‚è¿™ä¸€æ¡è¯´çš„æœ‰ç‚¹æ‚ï¼Œæˆ‘æƒ³è¡¨è¾¾çš„è§‚ç‚¹å…¶å®æ˜¯ï¼Œé¢è¯•æœ‰æ—¶å€™ä¹Ÿå¸¦äº›è¿æ°”æˆåˆ†ï¼Œæˆ–è®¸ä¸é¢è¯•è€…å’Œé¢è¯•å®˜æ°”åœºæ˜¯å¦åŒ¹é…ä¹Ÿæœ‰äº›å…³ç³»ã€‚å¤§åº¦ã€è‡ªç„¶ã€çœŸå®è¡¨ç°è‡ªå·±å³å¯ã€‚</p>
<p>ç„¶åå…³äºä¸“ä¸šæŠ€èƒ½çš„å‡†å¤‡ã€‚æˆ‘æƒ³å„è¡Œå„ä¸šé¢è¯•å†…å®¹å„ä¸ä¸€æ ·ï¼Œä½œä¸ºé¢è¯•è€…è‚¯å®šçŸ¥é“è‡ªå·±ä¸“ä¸šæ‰€éœ€è¦å‡†å¤‡å†…å®¹æ˜¯å“ªäº›çš„ï¼Œé’ˆå¯¹æ€§å‡†å¤‡å³å¯ã€‚</p>
<p>ä½œä¸ºç¨‹åºå‘˜ï¼Œæˆ‘æƒ³è‡ªå·±æ˜¯ä¾ç„¶æ¨èã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMjM5ODczOTMzMA%3D%3D%26mid%3D2247485801%26idx%3D1%26sn%3D88d597b5bced0de1a8ee836df6959f25%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MjM5ODczOTMzMA==&amp;mid=2247485801&amp;idx=1&amp;sn=88d597b5bced0de1a8ee836df6959f25&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">ç¨‹åºå‘˜é¢è¯•é‡‘å…¸</a>ã€‹è¿™æœ¬ä¹¦çš„ã€‚</p>
<h3 data-id="heading-1">2ã€æˆ‘ç¦»å¼€æ·±åœ³å·²ç»å¿«ä¸‰å¹´äº†</h3>
<p>ä»Šå¤©ï¼Œã€Šèˆªæ—…çºµæ¨ªã€‹APPå¼¹å‡ºæ¥ä¸€ä¸ªæ¡†å‘Šè¯‰æˆ‘ä»Šå¹´çš„é£è¡Œæ€»ç»“ï¼Œåœ¨å®ƒçš„æ€»ç»“å½“ä¸­ï¼Œæœ‰ä¸€æ®µæ–‡å­—ä»¿ä½›æŠ“ä½æˆ‘çš„å¿ƒï¼Œè®©æˆ‘å›åˆ°å¿«ä¸‰å¹´ä»¥å‰ã€‚</p>
<p>â€œäº”å¹´é—´ï¼Œä½ 20æ¬¡å¥”èµ´æ·±åœ³ï¼Œç„¶è€Œè®°å¿†æ‚„æ‚„å®šæ ¼åœ¨2023å¹´çš„æ˜¥å¤©ï¼Œè·ç¦»æœ€åä¸€æ¬¡æŠµè¾¾è¿™åº§åŸï¼Œå·²ç»è¿‡å»1002å¤©ã€‚</p>
<p>â€œè¿‡å»äº”å¹´ï¼Œå®å®‰æœºåœºè§è¯äº†ä½ 43æ¬¡æ—…é€”ã€‚è‡ªä»2023å¹´è¿™ä¸€åˆ«ï¼Œä½ å·²947å¤©æœªä»è¿™é‡Œèµ·è½ã€‚æ„¿ä¸‹æ¬¡é‡é€¢ä¾æ—§å¦‚æ•…ï¼Œå†èµ´äº‘ç«¯ä¹‹çº¦ã€‚â€</p>
<p>21å¹´6æœˆåˆ°23å¹´5æœˆï¼Œæ˜¯æˆ‘å¾…åœ¨æ·±åœ³çš„æ—¶é—´ï¼Œæ•´æ•´ä¸¤å¹´ã€‚</p>
<p>è¿™æ®µæ—¶é—´ï¼Œå¤§æ¦‚æ˜¯æˆ‘å¿«åä¸‰å¹´èŒä¸šç”Ÿæ¶¯æœŸé—´ï¼Œæœ€å¿«ä¹æœ€è½»æ¾çš„ä¸¤å¹´ï¼Œä¸å·ä¸å·æ˜¯çœŸçš„ä¸å·ï¼ŒçœŸçš„ä¸å·ï¼Œå…¬å¸è¿˜èƒ½æŒ£åˆ°é’±ã€‚è¿™æ®µæ—¶é—´ï¼Œæˆ‘ä»¥ä¸ºè‡ªå·±æ˜¯çœŸæ­£åšåˆ°Work Life Balanceçš„ã€‚</p>
<p>â€œå·¥ä½œæ˜¯å·¥ä½œï¼Œç”Ÿæ´»æ˜¯ç”Ÿæ´»â€ï¼Œå¯çœŸæ˜¯ä¸€ç§å¾ˆèµçš„çŠ¶æ€å‘€ï¼</p>
<p>æ·±åœ³çš„æ°”å€™å¾ˆå¥½ï¼Œé™¤å»å…ƒæ—¦å‡ å¤©ç•¥å†·ï¼Œå‰©ä¸‹æ—¶é—´è¡£æœéƒ½å¯ä»¥ä¸è¶…è¿‡ä¸¤ä»¶ã€‚æ·±åœ³çš„å¤å¤©ï¼Œæš´é›¨æ¥çš„å¿«å»çš„ä¹Ÿå¿«ï¼Œæš´é›¨è¿‡åæ˜¯æ™´å¤©ï¼Œä»¥åŠå½©è™¹ã€‚</p>
<p>æˆ‘æœ€æƒ³å¿µçš„ï¼Œæ˜¯æ·±åœ³å‚æ™šçš„å¤©ç©ºã€‚å¤§å¤šæ•°æ—¶é—´è¿œæ–¹çš„äº‘å‘ˆé’è‰²ï¼Œå¦‚ç”»å·ï¼›é‡‘è‰²æ™šéœæ¼«å¤©æ—¶ï¼Œå¤©ç©ºã€å¤§æ¥¼é«˜å¤„ï¼Œç»Ÿç»Ÿç»Ÿç»Ÿéƒ½ç»™äºˆæˆ‘ä¸€ç§å¿ƒæ—·ç¥æ€¡çš„å£®è§‚æ„Ÿå—ã€‚</p>
<p>æˆ‘åœ¨æ·±åœ³çš„åŒäº‹ï¼Œéƒ½å¯çˆ±é’æ˜¥æœ‰æ´»åŠ›ã€‚å’Œä»–ä»¬å¾…åœ¨ä¸€èµ·çš„æ—¶é—´ï¼Œå¿«ä¹æ— é™ã€‚</p>
<h3 data-id="heading-2">3ã€åŸæ¥æ‹”æ™ºé½¿çš„æ„Ÿè§‰æ˜¯è¿™æ ·çš„</h3>
<p>åœ¨é˜¿å¦®é™ªä¼´ä¸‹å»çœ‹äº†å¾ˆä¸“ä¸šå¾ˆä»”ç»†çš„ç‰™åŒ»ï¼Œä»–ç»™äºˆæˆ‘çš„å»ºè®®æ˜¯å››é¢—æ™ºé½¿åº”è¯¥éƒ½æ‹”æ‰ã€‚å¯¹äºè¿™ä½æˆ‘å¾ˆæ˜¯ä¿¡èµ–åŒ»ç”Ÿçš„å»ºè®®ï¼Œæˆ‘ä»¥ç™¾åˆ†ç™¾çš„æ¥çº³æ€åº¦å¯¹å¾…ã€‚</p>
<p>åŒ»ç”Ÿè¯´ï¼Œæ™ºé½¿é•¿å¾—å¾ˆæ­ªï¼Œå·²ç»å¿«é¡¶åæ—è¾¹ç‰™é½¿æ ¹éƒ¨ï¼Œå¦‚æœå†æŒ¤ï¼Œæ—è¾¹ç‰™é½¿å¯èƒ½ä¼šè¢«æŒ¤æ‰ï¼Œäºæ˜¯ä¸èƒ½ä»»å…¶ç»§ç»­é•¿ä¸‹å»ã€‚</p>
<p>ä»Šå¤©å…ˆæ‹”å»å·¦è¾¹ä¸¤é¢—ã€‚</p>
<p>éº»è¯æˆ³é’ˆæˆ‘æ˜¯æœ‰æ„Ÿè§‰çš„ï¼Œä¸Šé¢ä¸€é’ˆä¸‹é¢ä¸€é’ˆï¼Œå¤§æ¦‚æµä¸€ç‚¹è¡€ã€‚</p>
<p>æ—¶é—´ä¼¼ä¹è¿‡å»ä¸‰åˆ°äº”åˆ†é’Ÿï¼Œé¦–å…ˆæ˜¯èˆŒå¤´æ„Ÿè§‰åˆ°éº»æœ¨ï¼Œå†è¿‡ä¸‰äº”åˆ†é’Ÿï¼Œä¸Šä¸‹å˜´å”‡å¼€å§‹ä¸å¬ä½¿å”¤ã€‚</p>
<p>æ•´ä¸ªæ‹”ç‰™è¿‡ç¨‹å¹¶ä¸ç–¼ç—›ï¼Œåªæ˜¯å¶å°”è¢«å‹åˆ°èˆŒæ ¹ä¼šæ¶å¿ƒæƒ³åã€‚æƒ³åï¼ŒåŒ»ç”Ÿä¾¿è®©åä¸€åã€‚</p>
<p>ä¸¤é¢—ç‰™å®Œæ•´æ“ä½œæ—¶é—´å¤§æ¦‚èŠ±å››ååˆ†é’Ÿã€‚æ‹”ç‰™ç»“æŸï¼Œå†åœ¨åŒ»é™¢ç­‰å¾…40åˆ†é’Ÿå¾…åŒ»ç”Ÿç¡®è®¤ç‰™é½¿ä¸å†æµè¡€åç¦»å¼€ã€‚</p>
<p>åŒ»ç”Ÿæœ‰ç»™ä¸€ä¸ªå•å­ï¼Œä¸Šé¢æ˜¯æ³¨æ„äº‹é¡¹ï¼š</p>
<ol>
<li>40åˆ†é’Ÿå†…ï¼Œå’¬ç´§çº±çƒæ­¢è¡€å”¾æ¶²å’½ä¸‹ã€‚æ­¤å¤„ç”±äºéº»è¯æ•ˆæœï¼Œæˆ‘å…¶å®å¹¶ä¸ç¡®å®šè‡ªå·±æ˜¯å¦å’¬ç€çº±çƒçš„ã€‚</li>
<li>ä¸¤å°æ—¶å†…ä¸è¿›é£Ÿä¸å–æ°´ã€‚ä¸¤å°æ—¶åå¯åƒé¥­ï¼Œä½†ä¸è¦åƒè¿‡ç¡¬ã€è¿‡çƒ­ä¸è¾›è¾£é£Ÿç‰©ã€‚</li>
<li>24å°æ—¶å†…ä¸æ´—æ¾¡ä¸åˆ·ç‰™ã€‚ï¼ˆä¸´ç¡å‰æˆ‘æœ‰æ´—è„¸ä¸€ä¸‹ï¼Œå‘ç°å£è…”å†…ä¾¿åˆæµäº†è¡€ã€‚ï¼‰</li>
</ol>
<p>æ‹”ç‰™åä¸€å°æ—¶ï¼Œå˜´é‡Œå¼€å§‹æœ‰ä¸€ç‚¹ç–¼ï¼Œåƒä¸€é¢—å¸ƒæ´›èŠ¬åç¼“è§£è®¸å¤šã€‚</p>
<p>ä¸¤å°æ—¶ï¼Œåæ‰çº±çƒåæ„Ÿè§‰å˜´é‡Œå¥½å—è®¸å¤šã€‚å¾ˆé¥¿ï¼Œåƒä¸€ç¢—æ¸…æ±¤é¢ï¼Œé¢æ¡å¾ˆé¦™ã€‚å³ä¾§å’€åš¼å¹¶æ— é—®é¢˜ï¼Œåªæ˜¯åå’½æ—¶ä¼¼ä¹æ··ç€äº›å…¶å®ƒä¸œè¥¿ã€‚</p>
<p>å†ä¸‹åˆï¼Œé—´æ­‡æ€§å†·æ•·å†°è¢‹ã€‚å˜´é‡Œç¨å¾®æœ‰ç‚¹æ„Ÿè§‰ã€‚</p>
<p>8å°æ—¶åï¼ŒåŒå­¦å®¶åƒé¥­ï¼Œå…¶ä¸­ä¸€é“èœæœ‰ç‚¹è¾£ï¼Œä½¿ç”¨å³ä¾§åƒé¥­æ¯«æ— æ„Ÿè§‰ã€‚</p>
<p>11å°æ—¶åï¼Œä¼°è®¡æ˜¯è¯æ•ˆå¿«è¿‡æœŸï¼Œç‰™é½¿é‚£é‡Œå¾®å¾®ä½œç—›ã€‚</p>
<p>7å¤©ä¹‹åæ‹†çº¿ï¼Œæ‹†çº¿åä¸€å‘¨æ„Ÿè§‰æœ€æ˜¯ä¸¥é‡ï¼šå˜´ä¸èƒ½å¼ å¼€ï¼Œå–æ¸©æ°´ä¹Ÿç–¼ï¼Œå‘¼å¸ä¸€ç›´æœ‰æ¼é£æ„Ÿã€‚</p>
<p>ä¸€ä¸ªæœˆåï¼Œå˜´ä¾ç„¶ä¸èƒ½å¼ å¾—å¾ˆå¼€ï¼ŒåŒ»ç”Ÿè¯´è¿™æ˜¯è‚Œè‚‰è¢«æ‹‰ä¼¤ï¼Œå¾—çƒ­æ•·ç€æ…¢æ…¢æ¢å¤ã€‚</p>
<h3 data-id="heading-3">4ã€æˆ‘çš„è®©è‡ªå·±å˜å¾—å¹³é™çš„æ–¹æ³•</h3>
<p>åŸºäºæˆ‘çš„ä¸ªäººç»éªŒâ€”â€”è¿‡å»çš„å¾ˆé•¿æ—¶é—´ä¸çŸ¥é“æœªæ¥ä¼šæ€æ ·äºæ˜¯ç„¦è™‘ï¼Œåˆ°ç°åœ¨è‡ªç„¶å¿½è§†æœªæ¥ä¼šæ€æ ·å¿µå¤´åªè®¤çœŸè¿‡å¥½å½“ä¸‹â€”â€”æ¥çœ‹ï¼Œæˆ‘ä»¥ä¸ºå¸®åŠ©è‡ªå·±å˜å¾—å¹³é™ï¼ˆå³ä¾¿åªæ˜¯90ï¼…æ—¶é—´çš„å¹³é™ï¼‰èµ°å‡ºè¿·èŒ«çš„ç¼˜ç”±æ˜¯è¯»ä¹¦ï¼Œä¸åœåœ°è¯»ä¹¦ã€‚</p>
<p>è¿™äº›ä¹¦å½“ä¸­ï¼Œå¸¦äº›å¸®åŠ©çªç ´è¿·èŒ«åŠŸæ•ˆçš„ï¼Œå¤§å¤šæ˜¯äººç‰©ä¼ è®°ï¼Œå³éšç€è‡ªå·±çœ‹äººç‰©ä¼ è®°è¶Šå¤šï¼Œæˆ‘ä¾¿è¶Šæ„Ÿå—åˆ°ä¸€ç§å¾ˆæ˜¯è‡ªç„¶çš„å†…å¿ƒå¹³é™ï¼Œæˆ‘ä»¿ä½›çŸ¥æ™“è‡ªå·±å¦‚æœæƒ³è¦æœ‰æ‰€æ±‚ï¼Œä¾¿å¾—æœ‰æ‰€è°‹ã€‚</p>
<p>æ­¤å¤„çš„â€œè°‹â€ï¼Œåªä¸ºæŠ¼éŸµï¼Œå®ƒåªæ˜¯ä¸€ä¸ªä¸­æ€§è¯ï¼Œå®ƒæŒ‡çš„æ˜¯ä¸€ç§åŸºäºçƒ­çˆ±çš„å¥‹æ–—ä¸æŒç»­æŠ•å…¥ã€‚å³æˆ‘çœ‹åˆ°çš„è®¸å¤šæˆåŠŸäººä¸–ï¼Œå¦‚ä¹”å¸ƒæ–¯åˆ›ç«‹è‹¹æœï¼Œå¦‚æ›¾å›½è—©æˆä¸ºå°ç–†å¤§åï¼Œéƒ½æ˜¯å…ˆæœ‰çƒ­çˆ±ä¸æŠ•å…¥æ‰æˆåŠŸçš„ã€‚ï¼ˆæˆ–è®¸å½“ç„¶ä¹Ÿéœ€è¦æŸäº›è¿æ°”ã€‚ï¼‰</p>
<p>æˆ‘ä¸æŠ•å…¥å…¨èº«å¿ƒçƒ­çˆ±å»è¿½é€æŸä¸ªç›®æ ‡ï¼Œä¾¿ä¿®å¿ƒä»¥æ…¢æ…¢æ¥å—è‡ªå·±çš„å¹³å‡¡ï¼Œåªè¿½æ±‚â€œåƒé¥±ç©¿æš–ç¡å¥½â€å°±å¥½ã€‚è€Œâ€œåƒé¥±ç©¿æš–ç¡å¥½â€åœ¨ç°åœ¨ç¤¾ä¼šï¼Œæ˜¯ä¸€ä¸ªå¾ˆå®¹æ˜“è¾¾æˆçš„ç›®æ ‡ã€‚</p>
<p>é‚£äº›å¸®åŠ©æˆ‘æ„å»ºå½“ä¸‹å¿ƒå¢ƒçš„äººç‰©ä¼ è®°ï¼Œæœ‰ã€Šä¹”å¸ƒæ–¯ä¼ ã€‹ã€Šæ›¾å›½è—©ä¼ ã€‹ã€Šæˆ‘çš„å‰åŠç”Ÿã€‹ã€Šäººç”Ÿç”±æˆ‘ã€‹ã€Šæˆ‘æ›¾èµ°åœ¨å´©æºƒçš„è¾¹ç¼˜ã€‹ã€Šèº«åæ— é—ç‰©ã€‹ã€Šåˆè€çš„å¥³äººã€‹ã€Šä»æ–‡è‡ªä¼ ã€‹ã€Šå·¦æ‰‹ç¨‹åºå³æ‰‹è¯—ã€‹ï¼Œä»¥åŠæ¥è‡ªäºã€ŠäºŒåäº”å²ç®€æ˜è¯»æœ¬ã€‹ä¸­çš„è®¸å¤šçŸ­å°ç²¾ç‚¼çš„äººç”Ÿæ•…äº‹ã€‚</p>
<p>è¿™äº›ä¹¦ï¼Œæ˜¯æˆ‘éƒ½æ¨èçš„ã€‚</p>
<h3 data-id="heading-4">5ã€åœ°é“ä¸Šä¸¤ä¸ªå¥³äººçš„åµæ¶ä¸æ‰“æ¶</h3>
<p>æˆ‘ç«™åœ¨åœ°é“é—¨å£ç«™ç«‹æ‰¶æ†å¤„ã€‚</p>
<p>å·¦æ‰‹è¾¹ï¼Œæ˜¯ä¸€ä½çº¢è‰²ç¾½ç»’æœé•¿å‘å¥³æ€§ï¼Œå¥¹å·¦æ‰‹æ‹‰ç€ä¸€ä¸ªæ‰¶æ‰‹åœˆï¼Œå³æ‰‹æ¨ªç›´æ¡ç€æˆ‘é¢å‰çš„æ‰¶æ†ã€‚å¥¹å çš„åŒºåŸŸç•¥å®½ï¼Œæˆ‘ä¸èƒ½æ¡åˆ°æ‰¶æ†ã€‚åªä¸€å°ä¼šï¼Œå¥¹å³æ‰‹æŒªå¼€æ¡è‡ªå·±å·¦æ‰‹ã€‚</p>
<p>ä¸‹ä¸€ç«™ï¼ŒæŒ¤ä¸Šæ¥ä¸€ä½é»„è‰²çŸ­å‘èº«ç©¿å¤§çº¢ä¸Šè¡£å¥³æ€§ã€‚å¥¹æ¢ä¸¤ä¸ªåŠ¨ä½œä¹‹åï¼Œæˆ‘æŒªåˆ°ç¦»å¥¹ä¸‰äººè¿œåœ°æ–¹æŒ¨ç€ä¸¤èŠ‚è½¦å¢äº¤æ±‡å¤„ã€‚</p>
<p>å¥¹ç¬¬ä¸€ä¸ªåŠ¨ä½œï¼Œæ˜¯å°†èº«ä½“é å‘æ‰¶æ†ï¼Œäºæ˜¯æˆ‘æ‰‹ä¸å¾—ä¸æ¾å¼€æ‰¶æ†ã€‚</p>
<p>å¥¹ç¬¬äºŒä¸ªåŠ¨ä½œï¼Œæ˜¯å¾€å·¦å†æŒªåŠæ­¥ï¼Œå·¦æ‰‹ç¯æŠ±æ‰¶æ†ï¼Œæ•´ä¸ªäººç«™åœ¨æˆ‘è„¸ä¸Šï¼ˆæ­¤å¤„ä½œè€…ç”¨äº†å¤¸å¼ æ‰‹æ³•ï¼Œåªä¸ºè¡¨è¾¾ä½œè€…å¯¹è¿™å¥³æ€§çš„ä¸æ»¡ï¼‰ã€‚æˆ‘å¾€åé€€å¤§æ¦‚ä¸‰å˜ç±³ä¾ç„¶è§‰å¾—ä¸è‡ªç„¶ä¸è‡ªåœ¨äºæ˜¯èµ°å¼€ã€‚</p>
<p>åœ°é“åˆ°ç«™ä¸¤è·¯å£ï¼Œç¬¬ä¸€ä½çº¢è¡£å¥³å£«é¢å‰çš„ä¹˜å®¢ä¸‹è½¦ç©ºå‡ºåº§ä½ï¼Œç¬¬äºŒä½çŸ­å‘å¥³æ€§æŠ¢å¾—åº§ä½ã€‚å¤§æ¦‚æƒ…æ™¯è¯¥æ˜¯çŸ­å‘å¥³æ€§ç›´æ¥æŠ¢åˆ°çº¢è¡£å¥³å£«é¢å‰å¾—äº†åº§ä½ï¼Œè¿‡ç¨‹ä¸­å¯èƒ½ç¢°åˆ°æ¨æ¡äº†çº¢è¡£å¥³å£«ã€‚</p>
<p>å¥¹ä»¬çš„äº‰åµå†…å®¹æˆ‘å·²ç»å¤è¿°ä¸å‡ºæ¥ï¼Œåªè®°å¾—ä¸€ä¸ªæ¢—æ¦‚ï¼ˆéª‚äººä»¥åŠå’Œäººåµæ¶ï¼ŒçœŸä¸æ˜¯æˆ‘çš„å¼ºé¡¹ï¼Œæˆ‘å·²ç»ç”¨åŠ›è®°ä¸€æ¬¡ï¼Œä½†å°±æ˜¯ä¸èƒ½å®Œæ•´å¤è¿°ï¼‰ã€‚</p>
<p>çº¢è¡£å¥³å£«é¦–å…ˆæ˜¯ç†è®ºï¼Œåœ¨çŸ­å‘å¥³æ€§è¯´å‡ºâ€œä¸æ™“å¾—ä½ å­¦åˆ°å“ªé‡Œå»äº†â€å¸¦äº›æ”»å‡»æ€§è¨€è®ºä¹‹åå¥¹å¼€å§‹åå‡»ï¼Œâ€œä¸æ™“å¾—ä½ è¿™ä¹ˆå¤§å¹´çºªæ´»åˆ°å“ªä¸ªèº«ä¸Šå»äº†â€ï¼ŒçŸ­å‘å¥³æ€§å›åº”â€œæˆ‘å°±æ˜¯æ²¡æ–‡åŒ–â€ã€‚</p>
<p>ä¸€æ¥äºŒå»ï¼Œäº‰åµä¸æ¯ã€‚æˆ‘å†…å¿ƒè™½ç„¶å¹³é™ä½†å·²ç»å†™ä¸äº†ã€Šäº²å¯†å…³ç³»ã€‹çš„ç¬”è®°ï¼Œäºæ˜¯å†å¾€æ—è¾¹æŒªä¸‰äº”ä¸ªäººä½ç½®åˆ°å¦ä¸€ä¸ªè½¦å¢ã€‚</p>
<p>æˆ‘å³ä¾§ä¸€ä½å¤§å”é—´æ–­æ€§å‘å£°åŠæ¶æ¯«æ— ç”¨å¤„ã€‚</p>
<p>ä¸ç¡®å®šæ˜¯è°å…ˆåŠ¨æ‰‹ï¼ˆæˆ‘æ¨¡ç³Šçœ‹åˆ°åƒæ˜¯çŸ­å‘å¥³æ€§ç«™èµ·æ¥æªä½çº¢è¡£å¥³å£«å¤´å‘ï¼‰ï¼Œä¸¤äººæ‰­æ‰“åˆ°ä¸€èµ·ï¼ŒæŒç»­æ—¶é—´å¤§æ¦‚ä¸€ä¸¤åˆ†é’Ÿè¢«æ—äººæ‹‰å¼€ã€‚</p>
<p>åˆ—è½¦åˆ°ç«™è§‚éŸ³æ¡¥ï¼Œçº¢è¡£å¥³å£«ä¸‹äº†è½¦ã€‚çŸ­å‘å¥³æ€§ä¾ç„¶å£°éŸ³å¾ˆå¤§å¤è¿°åˆšæ‰æƒ…æ™¯ã€‚çŸ­å‘å¥³æ€§å¤è¿°çš„é‡ç‚¹æ˜¯å¥¹å—äº†æ¬ºè´Ÿï¼Œè€Œçº¢è¡£å¥³å£«æ˜¯æ¶äººï¼Œä¸­é—´å¤¹æ‚äº›éª‚äººè¨€è¯­ã€‚</p>
<p>æˆ‘å·¦è¾¹ä¸€ä½å¥³å£«æ¥è¯è®©å¥¹ä¸è¦å†åµã€‚åµæ¶å†ç»§ç»­ï¼Œæˆ‘å¯¹å·¦è¾¹å¥³å£«è¯´ä¸€å¥â€œä¸ç”¨å’Œå¥¹åµâ€ï¼Œå¥³å£«å®‰é™ä¸€ä¼šå„¿ä½†çŸ­å‘å¥³æ€§ç»§ç»­ã€‚</p>
<p>æˆ‘å†…å¿ƒå¸¦äº›ä¸è‡ªç„¶å£°éŸ³å¾ˆå°æœçŸ­å‘å¥³æ€§ä¹Ÿè¯´ä¸€å¥â€œæˆ‘ä»¬éƒ½çœ‹åˆ°çš„â€ï¼ˆè¿™æ„æ€æ˜¯å¥¹åšçš„ä¸å¯¹ï¼‰ï¼Œç„¶åçŸ­å‘å¥³æ€§å£°éŸ³æ²¡äº†ï¼Œä½†åª5ç§’ï¼Œå¥¹åˆç»§ç»­ï¼Œæˆ‘å·¦è¾¹å¥³å£«ä¹Ÿå†æ¥è¯ã€‚</p>
<p>åˆ°æ¢ä¹˜ç«™äº†ã€‚</p>
<h3 data-id="heading-5">6ã€æˆ‘è¿˜åœ¨ä¸€ç›´çœ‹ä¹¦çš„</h3>
<p>åˆ°26å¹´1æœˆï¼Œæˆ‘åšæŒæ¯å¤©è¯»ä¹¦å·²ç»5å¹´åˆ4ä¸ªæœˆã€‚è¿‡å»64ä¸ªæœˆå†…ï¼Œæˆ‘çš„æ—¥å‡é˜…è¯»æ—¶é•¿å¤§æ¦‚æ˜¯ä¸€å°æ—¶å¤šä¸€åˆ»é’Ÿã€‚</p>
<p>æˆ‘çš„è¯»ä¹¦ï¼Œèµ·æºäºä¾¯æ·è€å¸ˆçš„ã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMjM5ODczOTMzMA%3D%3D%26mid%3D2247483680%26idx%3D1%26sn%3D01e6a91f8bbd1c40edebcab75ab012e6%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MjM5ODczOTMzMA==&amp;mid=2247483680&amp;idx=1&amp;sn=01e6a91f8bbd1c40edebcab75ab012e6&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">å·¦æ‰‹ç¨‹åºå³æ‰‹è¯—</a>ã€‹ï¼Œä»¥åŠæ±ªæ›¾ç¥ºå…ˆç”Ÿçš„ã€Šäººé—´è‰æœ¨ã€‹ã€‚</p>
<p>ä¾¯æ·è€å¸ˆåœ¨ã€Šå·¦æ‰‹ç¨‹åºå³æ‰‹è¯—ã€‹ä¸­å‘ŠçŸ¥æˆ‘çš„ï¼Œæ˜¯â€œå‰äººä¼šå†™ä¸œè¥¿ï¼Œä¼šåˆ†äº«ç»éªŒï¼Œæˆ‘æƒ³è¦çš„è®¸å¤šç”Ÿæ´»ç»éªŒéƒ½èƒ½åœ¨å‰äººä½œå“ä¸­çœ‹åˆ°â€ã€‚</p>
<p>è€Œã€Šäººé—´è‰æœ¨ã€‹å¸®åŠ©æˆ‘å…»æˆé˜…è¯»ä¹ æƒ¯ï¼Œå€Ÿç€Try something new for 30 daysï¼šæ¯å¤©çœ‹ä¹¦ååˆ†é’Ÿï¼ŒåšæŒ30å¤©ã€‚å¾…30å¤©è¿‡å»ï¼Œã€Šäººé—´è‰æœ¨ã€‹å¿«è¯»å®Œï¼Œé‚£å°±è¯»å®Œå§ã€‚</p>
<p>ã€Šäººé—´è‰æœ¨ã€‹å½“ä¸­ï¼Œæ±ªæ›¾ç¥ºå…ˆç”Ÿæœ‰èŠ±è®¸å¤šæ–‡å­—ä»‹ç»ä»–çš„å…ˆç”Ÿæ²ˆä»æ–‡å…ˆç”Ÿï¼ŒåŸºäºè¿™ä»‹ç»ï¼Œæˆ‘å¯¹æ²ˆå…ˆç”Ÿå……æ»¡å¥½å¥‡ï¼Œäºæ˜¯å†èŠ±14ä¸ªæœˆè¯»å®Œã€Šæ²ˆä»æ–‡æ–‡é›†ã€‹ã€‚</p>
<p>è‡³æ­¤ï¼Œè¯»ä¹¦æˆä¸ºåƒåƒé¥­ç¡è§‰ä¸€æ ·ï¼Œæ˜¯æˆ‘æ¯å¤©éƒ½ä¼šåšçš„äº‹æƒ…ã€‚</p>
<p>æ²ˆä»æ–‡å…ˆç”Ÿæœ‰æ¨èä¸€ç§è¯»ä¹¦æ–¹æ³•ï¼šä¸åœåœ°çœ‹ä¹¦ï¼Œçœ‹ä¹¦ä¸é’»ç‰›è§’å°–ï¼Œçœ‹å„ç§å„æ ·å„è¡Œå„ä¸šå…¨ä¸ç›¸åŒçš„ä¹¦ï¼Œä¸€ç›´çœ‹ä¸‹å»ã€‚</p>
<p>æˆ‘äºæ˜¯ä¸€ç›´çœ‹ä¸‹å»ã€‚</p>
<p>äººç‰©ä¼ è®°ï¼Œã€Šæ›¾å›½è—©ä¼ ã€‹ã€Šä¹”å¸ƒæ–¯ä¼ ã€‹ã€Šæˆ‘çš„å‰åŠç”Ÿã€‹â€¦â€¦ç»™äºˆæˆ‘çš„ï¼Œæ˜¯å…³äºäººç”Ÿçš„ç›®æ ‡ä»¥åŠæˆåŠŸï¼Œå¦‚æœçƒ­çˆ±æŸç§äº‹ç‰©å¹¶æƒ³è¦ä¸ºè¿™çƒ­çˆ±å†å¢å…‰äº®ï¼Œæˆ‘ä»¬å°±è¯¥å°†å…¨éƒ¨å¿ƒæ€èŠ±åœ¨è¿™ä¸Šé¢ï¼Œä»¥çƒ­çˆ±ä¸ºåŸºå»å®Œæˆè‡ªå·±æƒ³è¦å®Œæˆçš„äº‹ã€‚</p>
<p>å†å²ï¼Œã€Šå›½å²å¤§çº²ã€‹ï¼Œä»¥åŠå¥½å¤šæœä»£å²ï¼ˆæˆ‘ç›®å‰å·²ç»ä»å¤å•†å‘¨çœ‹åˆ°å…ƒï¼‰ï¼Œæ˜¯ä¸€ä¸ªåˆä¸€ä¸ªå†å²äººç‰©ç»„æˆçš„ã€‚å†å²ç»™äºˆæˆ‘çš„æœ€çº¯ç²¹ä½“éªŒï¼Œæ˜¯â€œå‡¡äººç»ˆå°†ä¸€æ­»â€ã€‚</p>
<p>å¿ƒç†å­¦ï¼Œã€Šä¹Ÿè®¸ä½ è¯¥æ‰¾ä¸ªäººèŠèŠã€‹ã€Šè›¤èŸ†å…ˆç”Ÿå»çœ‹å¿ƒç†åŒ»ç”Ÿã€‹ã€Šè¢«è®¨åŒçš„å‹‡æ°”ã€‹ã€Šæ´¥å·´å¤šæ™®é€šå¿ƒç†å­¦ã€‹ã€Šäº²å¯†å…³ç³»ã€‹ã€Šæ´»å‡ºç”Ÿå‘½çš„æ„ä¹‰ã€‹â€¦â€¦å¸®åŠ©æˆ‘è®¤æ¸…è‡ªå·±ã€‚</p>
<p>ä»¥åŠç¨‹åºå‘˜è¡Œä¸šçš„é‚£äº›åŸºç¡€æŠ€èƒ½ï¼Œå¦‚ã€ŠPythonæºç å‰–æã€‹ã€Šæ“ä½œç³»ç»Ÿå¯¼è®ºã€‹ã€ŠRedisè®¾è®¡ä¸å®ç°ã€‹ï¼Œå¸®æˆ‘ææ¸…æŠ€èƒ½èƒŒåçš„è¿è¡Œæœ¬è´¨ã€‚</p>
<p>æ€»ä¹‹ï¼Œè¿‡å»äº”å¹´å¤šæ¥ï¼Œæˆ‘å°±è¿™æ ·ä»…ä»…å‡­ç€è‡ªå·±çš„çŸ­æœŸå–œå¥½ä¸åœåœ°çœ‹ä¹¦ï¼Œä¸€æœ¬åˆä¸€æœ¬ã€‚</p>
<h3 data-id="heading-6">7ã€æˆ‘ä¹Ÿæ¨èã€Šæ€§å¿ƒç†å­¦ã€‹</h3>
<p>æ¨èç›®å‰æ­£åœ¨é˜…è¯»çš„ã€Šæ€§å¿ƒç†å­¦ã€‹ï¼Œæˆ‘çš„æ¨èç¼˜ç”±æœ‰äºŒï¼šä¸€åŸºäºä¾¯æ·è€å¸ˆçš„æ¨èï¼ŒäºŒåŸºäºæˆ‘è‡ªå·±çš„é˜…è¯»ä½“éªŒã€‚</p>
<p>ä¾¯æ·è€å¸ˆæ˜¯ä¸€ä½æŠ€æœ¯ä½œå®¶ï¼Œä¹Ÿæ˜¯ä¸€ä½æŠ€æœ¯ç¿»è¯‘å®¶ï¼Œåœ¨ä»–çš„ã€Šå·¦æ‰‹ç¨‹åºå³æ‰‹è¯—ã€‹â€”â€”ä¸€æœ¬è®°å½•è‡ªå·±ç”Ÿæ´»æ„Ÿæ‚Ÿã€å·¥ä½œæŠ€èƒ½çš„æ–‡é›†â€”â€”ä¸­ï¼Œä¾¯æ·è€å¸ˆæœ‰è°ˆåˆ°ç¿»è¯‘çš„åŸåˆ™ï¼Œå®ƒå¤§ä½“çš„æ ¸å¿ƒåœ¨äºâ€œä¿¡è¾¾é›…â€ã€‚</p>
<p>ä¿¡ï¼ŒæŒ‡çš„æ˜¯è¯‘è€…åœ¨ç¿»è¯‘è¿‡ç¨‹ä¸­è¯¥å¿ å®äºåŸæ–‡ã€æ„ä¹‰å‡†ç¡®ï¼Œä¸è¯¯è§£ä½œè€…æ„æ€ä¹Ÿä¸å¢æ·»è‡ªå·±ç†è§£ã€‚</p>
<p>è¾¾ï¼ŒæŒ‡çš„æ˜¯ç¿»è¯‘ä¹‹åçš„æ–‡ç« è¯¥é€šé¡ºã€å¯è¯»ä¸”æ˜“äºç†è§£ï¼Œç¬¦åˆç›®æ ‡è¯­è¨€ç¾¤ä½“çš„é˜…è¯»ä¹ æƒ¯ã€‚</p>
<p>é›…ï¼ŒæŒ‡çš„æ˜¯åœ¨ä¿¡ã€è¾¾åŸºç¡€ä¸Šå¢æ·»çš„æ–‡é‡‡ã€æ ¼è°ƒï¼Œä½¿å¾—è¯‘æ–‡è¯»æ¥èˆ’æœä¸”ä¼˜ç¾ã€‚</p>
<p>ä¾¯æ·è€å¸ˆè¯´ï¼Œåœ¨ä»–è‡ªå·±è¯»è¿‡ä½œå“å½“ä¸­ï¼Œèƒ½å¤Ÿåšåˆ°ä¿¡è¾¾é›…ä¸‰è€…å…¼æœ‰çš„ï¼Œæ˜¯æ½˜å…‰æ—¦å…ˆç”Ÿç¿»è¯‘çš„éœ­ç†å£«çš„ã€Šæ€§å¿ƒç†å­¦ã€‹ã€‚</p>
<p>è¿™æœ¬ä¹¦æˆ‘åŠ å…¥ä¹¦æ¶äº”å…­å¹´ä¸è¯»ï¼Œä½†ä¸€ç›´è®°å¾—ã€‚ å‰æ®µæ—¶é—´å¬å®Œã€Šä¹Œåˆä¹‹ä¼—ã€‹ï¼Œåœ¨é€‰æ‹©ä¸‹ä¸€æœ¬ä¹¦æ—¶ï¼Œå‘ç°ã€Šæ€§å¿ƒç†å­¦ã€‹ä¹Ÿæœ‰äº†æœ‰å£°ä¹¦ï¼Œäºæ˜¯ä¸Šç­è·¯ä¸Šï¼Œæˆ‘å°†å®ƒæ‹¿å‡ºæ¥å¬ã€‚</p>
<p>å¬ã€Šæ€§å¿ƒç†å­¦ã€‹è¿˜ä¸åˆ°ä¸€å°æ—¶ï¼Œæˆ‘ä¾¿å·²ç»è¢«ä¹¦ä¸­å†…å®¹æ‰€æŠ˜æœï¼Œæˆ‘ä¹Ÿæ„Ÿå—åˆ°ä¾¯æ·è€å¸ˆæ‰€è¯´çš„â€œä¿¡è¾¾é›…â€ï¼Œæˆ‘ä»¥ä¸ºæ½˜å…ˆç”Ÿçš„ç¿»è¯‘çœŸå¯è°“æ˜¯æ˜“äºç†è§£ä¸”æ–‡å­—ç¾ä¸½çš„ï¼ˆâ€œä¿¡â€è¿™ä¸€ç‚¹ï¼Œé‰´äºæˆ‘æ²¡é˜…è¯»åŸä¹¦äºæ˜¯ä¸ä½œè¯„ä»·ï¼Œä½†æˆ‘ç›¸ä¿¡åšåˆ°è¾¾ä¸é›…ä¹‹å‰ï¼Œä¿¡è‚¯å®šæ˜¯è¢«è¶³è¶³ä¿éšœçš„ï¼‰ã€‚</p>
<blockquote>
<p>è¿™ç§çŸ¥è¯†çš„ç¼ºä¹ä¸å¿Œè®³çš„æ€åº¦è¿˜é€ æˆä¸€ç§ä¸¥é‡çš„æ¶æœï¼Œå°±æ˜¯å°†æœ‰æ€§çš„ç²¾ç¥å˜æ€çš„äººè®¤ä¸ºæ˜¯â€œé‚ªæ°”æ‰€é’Ÿâ€ï¼Œè€ŒæŠŠä»–çš„å˜æ€å«åšâ€œé‚ªå­½â€ï¼ˆperversionï¼‰ï¼Œå› æ­¤å°±æŠŠè¿™ç§äººä¸åˆ†çš‚ç™½åœ°å«åšâ€œé‚ªå­½ä¹‹äººâ€ï¼ˆpervertï¼‰ã€‚ä¸€èˆ¬äººå¯¹é‚ªå­½ä¸é‚ªå­½è€…åªæœ‰ä¸€ä¸ªæ€åº¦ï¼Œå°±æ˜¯ï¼šå¦‚è§è›‡èï¼Œé¿ä¹‹å”¯æä¸é€Ÿã€‚å› æ­¤ï¼Œæ€§å˜æ€çš„äººå»è®¿æ±‚åŒ»ç”Ÿæ˜¯åªæœ‰å¤±æœ›çš„ä¸€é€”çš„ã€‚åŒ»ç”Ÿä¸æ˜¯å‘Šè¯‰ä»–è¯´ï¼Œä»–çš„ç—…ç—‡æ— å…³ç´§è¦ï¼Œå¯ä»¥ä¸å¿…æ²»ç–—ï¼Œå°±æ˜¯æ ¹æœ¬è®¤ä¸ºä»–æœ‰æ¶åŠ£æ ¹æ€§ï¼Œæ— å¯æ•‘è¯ã€‚</p>
</blockquote>
<p>å¦‚ä¸Šä¸€æ®µï¼Œæ˜¯æˆ‘å†™æœ¬ç¯‡æ—¶å†ä»å¤´é˜…è¯»åŸæ–‡äº”åˆ†é’Ÿåæ‘˜å½•ä¸‹æ¥çš„ã€‚æˆ‘å‰é¢äº”åˆ†é’Ÿçš„é˜…è¯»ä½“éªŒï¼Œæ˜¯è¡Œæ–‡æµç•…æ˜“æ‡‚ï¼›åˆ°â€œå¦‚è§è›‡èï¼Œé¿ä¹‹å”¯æä¸é€Ÿâ€æ—¶ï¼Œä¸€ç§ç»†å¾®çš„è°ƒæ•´è¢«æˆ‘å‘ç°ã€‚</p>
<p>ç›¸å¯¹æ¥è¯´ï¼Œâ€œé¿ä¹‹å”¯æä¸åŠâ€æ˜¯æ¯”â€œé¿ä¹‹å”¯æä¸é€Ÿâ€æ›´å¸¸è§çš„ï¼Œä¸”ç”¨åœ¨æ­¤å¤„å¹¶ä¸çªå…€ï¼Œä¹Ÿä¸ä¼šå˜äº†åŸæ–‡æ„æ€ï¼Œä½†æ­¤å¤„çš„å°†â€œåŠâ€æ”¹ä¸ºâ€œé€Ÿâ€ï¼Œåˆ™åˆäº†åä¸€å¥â€œå¤±æœ›çš„ä¸€é€”â€çš„éŸµè„šã€‚æ­£æ˜¯æ­¤ç§å‰åè¿è´¯çš„éŸµè„šï¼Œç»™äºˆæˆ‘ä¸€ç§æµç•…çš„é˜…è¯»ä½“éªŒã€‚</p>
<p>ä»¥ä¸Šï¼Œæ˜¯æˆ‘ç°åœ¨æ‰€ä»¥æ¨èã€Šæ€§å¿ƒç†å­¦ã€‹çš„ç¼˜ç”±ä¹‹äºŒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è¿™ 7 ä¸ªå…è´¹ Lottie åŠ¨ç”»ç½‘ç«™ï¼Œå¸®ä½ çœä¸‹ä¸€ä¸ªè®¾è®¡å¸ˆçš„å·¥èµ„]]></title>    <link>https://juejin.cn/post/7603591775392153627</link>    <guid>https://juejin.cn/post/7603591775392153627</guid>    <pubDate>2026-02-07T03:03:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603591775392153627" data-draft-id="7603567912592916507" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è¿™ 7 ä¸ªå…è´¹ Lottie åŠ¨ç”»ç½‘ç«™ï¼Œå¸®ä½ çœä¸‹ä¸€ä¸ªè®¾è®¡å¸ˆçš„å·¥èµ„"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-07T03:03:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜å¤§å"/> <meta itemprop="url" content="https://juejin.cn/user/3507878440995946"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è¿™ 7 ä¸ªå…è´¹ Lottie åŠ¨ç”»ç½‘ç«™ï¼Œå¸®ä½ çœä¸‹ä¸€ä¸ªè®¾è®¡å¸ˆçš„å·¥èµ„
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3507878440995946/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜å¤§å
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T03:03:25.000Z" title="Sat Feb 07 2026 03:03:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å¤§åï¼</p>
<p>æœ‰æ—¶å€™å†™å‰ç«¯ï¼Œä¼šè§‰å¾—ï¼šåŒæ ·æ˜¯å†™é¡µé¢ï¼Œä¸ºä»€ä¹ˆæœ‰äº›äº§å“ä¸€çœ‹å°±å¾ˆèˆ’æœï¼Œè€Œè‡ªå·±å†™çš„ç•Œé¢ï¼Œæ€ä¹ˆçœ‹éƒ½è§‰å¾—å¾ˆç¬¨é‡ã€‚</p>
<p>æ˜¯ä»–ä»¬ç”¨äº†ä»€ä¹ˆé«˜æ·±çš„æŠ€æœ¯å—ï¼Ÿ</p>
<p>å…¶å®é‚£äº›çœ‹èµ·æ¥å¾ˆå¥½çœ‹ï¼Œå¾ˆä¸æ»‘çš„åŠ¨ç”»ï¼Œå¤§å¤šæ•°é¡¹ç›®åªæ˜¯ç”¨äº† Lottieã€‚</p>
<p>æ¯”å¦‚ä¸‹é¢è¿™ç§åŠ¨ç”»æ•ˆæœï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6914328f159648d4982b69f68a9c31f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771038204&amp;x-signature=PcRmbednD4Mei0xhrjazggRzQMg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">ä»€ä¹ˆæ˜¯LottieåŠ¨ç”»ï¼Ÿ</h2>
<p>Lottie å¹¶ä¸æ˜¯æŸç§å‰ç«¯æ¡†æ¶ï¼Œè€Œæ˜¯ä¸€ç§åŠ¨ç”»æ–‡ä»¶æ ¼å¼å’Œæ’­æ”¾æ–¹æ¡ˆã€‚
è®¾è®¡å¸ˆåœ¨ After Effects é‡ŒæŠŠåŠ¨ç”»åšå¥½ï¼Œå¯¼å‡ºæˆ JSON æ–‡ä»¶ï¼Œå‰ç«¯æˆ–å®¢æˆ·ç«¯åªéœ€è¦é€šè¿‡ Lottie æ’­æ”¾å™¨åŠ è½½ï¼Œå°±èƒ½æŠŠåŠ¨ç”»æ¸²æŸ“å‡ºæ¥ã€‚</p>
<p>å’Œ GIF æˆ–è§†é¢‘ç›¸æ¯”ï¼ŒLottie çš„ä½“ç§¯æ›´å°ã€æ›´è½»é‡ã€‚
å®ƒæ˜¯çŸ¢é‡åŠ¨ç”»ï¼Œä½“ç§¯å°ã€æ”¾å¤§ä¸ä¼šå¤±çœŸï¼Œè¿˜å¯ä»¥é€šè¿‡ä»£ç æ§åˆ¶æ’­æ”¾ã€æš‚åœã€å¾ªç¯ï¼Œç”šè‡³åŠ¨æ€æ”¹é¢œè‰²å’Œé€Ÿåº¦ã€‚</p>
<h2 data-id="heading-1">æ€ä¹ˆä½¿ç”¨ï¼Ÿ</h2>
<h3 data-id="heading-2">ä¸€ã€åœ¨ HTML / åŸç”Ÿé¡µé¢ä¸­ä½¿ç”¨ Lottie</h3>
<p>è¿™æ˜¯æœ€ç®€å•ã€ä¹Ÿæ˜¯æœ€é€šç”¨çš„ä¸€ç§æ–¹å¼ï¼Œé€‚åˆå®˜ç½‘ã€æ´»åŠ¨é¡µã€Demo é¡µé¢ã€‚</p>
<p>ç°åœ¨å®˜æ–¹æ›´æ¨èç”¨ <strong><code>lottie-web</code> + <code>&lt;lottie-player&gt;</code></strong> è¿™ç§æ–¹å¼ï¼ŒåŸºæœ¬é›¶å­¦ä¹ æˆæœ¬ã€‚</p>
<h3 data-id="heading-3">1ï¸âƒ£ å¼•å…¥ Lottie æ’­æ”¾å™¨</h3>
<p>ç›´æ¥åœ¨ HTML é‡Œå¼•å…¥å®˜æ–¹ CDNï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-4">2ï¸âƒ£ åœ¨é¡µé¢ä¸­ä½¿ç”¨</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">lottie-player</span>
  <span class="hljs-attr">src</span>=<span class="hljs-string">"https://assets.lottiefiles.com/packages/lf20_x62chJ.json"</span>
  <span class="hljs-attr">background</span>=<span class="hljs-string">"transparent"</span>
  <span class="hljs-attr">speed</span>=<span class="hljs-string">"1"</span>
  <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 300px; height: 300px;"</span>
  <span class="hljs-attr">loop</span>
  <span class="hljs-attr">autoplay</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">lottie-player</span>&gt;</span>
</code></pre>
<p>è¿™æ ·ï¼Œä¸€ä¸ªç®€å•çš„åŠ¨ç”»å°±å·²ç»è·‘èµ·æ¥äº†ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d3a4c72041f43f4a07975cfa40109e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771038204&amp;x-signature=IL%2B%2FBbPSrehw5rt5EEN4YKwbZNY%3D" alt="" loading="lazy"/></p>
<p>ä½ å¯ä»¥ç®€å•ç†è§£ä¸ºï¼š
<strong>Lottie = ä¸€ä¸ªè‡ªå®šä¹‰çš„ HTML æ ‡ç­¾ï¼Œsrc æŒ‡å‘ JSON æ–‡ä»¶å³å¯ã€‚</strong></p>
<p>å¸¸ç”¨å±æ€§ä¹Ÿå¾ˆå¥½è®°ï¼š</p>
<ul>
<li><code>loop</code>ï¼šæ˜¯å¦å¾ªç¯</li>
<li><code>autoplay</code>ï¼šæ˜¯å¦è‡ªåŠ¨æ’­æ”¾</li>
<li><code>speed</code>ï¼šæ’­æ”¾é€Ÿåº¦</li>
<li><code>style</code>ï¼šæ§åˆ¶å¤§å°</li>
</ul>
<p>å¦‚æœä½ åªæ˜¯æƒ³åŠ ä¸ªåŠ è½½åŠ¨ç”»ã€ç©ºçŠ¶æ€åŠ¨ç”»ï¼Œè¿™ç§æ–¹å¼å·²ç»å®Œå…¨å¤Ÿç”¨äº†ã€‚</p>
<hr/>
<h3 data-id="heading-5">äºŒã€åœ¨ Vue é¡¹ç›®ä¸­ä½¿ç”¨ Lottie</h3>
<p>åœ¨ Vue é‡Œï¼Œä¸€èˆ¬ä¼šç›´æ¥ä½¿ç”¨ <code>lottie-web</code>ï¼Œæ§åˆ¶åŠ›æ›´å¼ºï¼Œé€‚åˆä¸šåŠ¡åœºæ™¯ã€‚</p>
<h3 data-id="heading-6">1ï¸âƒ£ å®‰è£…ä¾èµ–</h3>
<pre><code class="hljs language-bash" lang="bash">npm install lottie-web
</code></pre>
<h3 data-id="heading-7">2ï¸âƒ£ åœ¨ç»„ä»¶ä¸­ä½¿ç”¨</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"lottieContainer"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 300px; height: 300px;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> lottie <span class="hljs-keyword">from</span> <span class="hljs-string">'lottie-web'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    lottie.<span class="hljs-title function_">loadAnimation</span>({
      <span class="hljs-attr">container</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">lottieContainer</span>,
      <span class="hljs-attr">renderer</span>: <span class="hljs-string">'svg'</span>,
      <span class="hljs-attr">loop</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">autoplay</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">path</span>: <span class="hljs-string">'/lottie/loading.json'</span> <span class="hljs-comment">// æœ¬åœ°æˆ–è¿œç¨‹ JSON</span>
    })
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>è¿™æ ·åŠ¨ç”»ä¼šåœ¨ç»„ä»¶æŒ‚è½½å®Œæˆåè‡ªåŠ¨æ’­æ”¾ã€‚</p>
<p>è¿™é‡Œæœ‰å‡ ä¸ªå…³é”®ç‚¹ï¼Œç†è§£äº†åŸºæœ¬å°±ä¸æ€•ç”¨äº†ï¼š</p>
<ul>
<li><code>container</code>ï¼šåŠ¨ç”»æŒ‚è½½çš„ DOM</li>
<li><code>renderer</code>ï¼šä¸€èˆ¬ç”¨ <code>svg</code></li>
<li><code>path</code>ï¼šLottie JSON æ–‡ä»¶è·¯å¾„</li>
<li><code>loop / autoplay</code>ï¼šæ§åˆ¶æ’­æ”¾è¡Œä¸º</li>
</ul>
<hr/>
<h3 data-id="heading-8">ä¸‰ã€åœ¨ Vue é‡Œæ€ä¹ˆæ§åˆ¶åŠ¨ç”»ï¼Ÿ</h3>
<p>è¿™ä¹Ÿæ˜¯ Lottie ç›¸æ¯” GIF æœ€å¤§çš„ä¼˜åŠ¿ä¹‹ä¸€ã€‚</p>
<p>ä½ å¯ä»¥æ‹¿åˆ°åŠ¨ç”»å®ä¾‹ï¼Œç„¶åéšæ„æ§åˆ¶ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> animation = lottie.<span class="hljs-title function_">loadAnimation</span>({
  <span class="hljs-attr">container</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">lottieContainer</span>,
  <span class="hljs-attr">renderer</span>: <span class="hljs-string">'svg'</span>,
  <span class="hljs-attr">loop</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">autoplay</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">path</span>: <span class="hljs-string">'/lottie/success.json'</span>
})

<span class="hljs-comment">// æ‰‹åŠ¨æ’­æ”¾</span>
animation.<span class="hljs-title function_">play</span>()

<span class="hljs-comment">// æš‚åœ</span>
animation.<span class="hljs-title function_">pause</span>()

<span class="hljs-comment">// åœæ­¢</span>
animation.<span class="hljs-title function_">stop</span>()
</code></pre>
<p>æ¯”å¦‚ï¼š</p>
<ul>
<li>æäº¤æˆåŠŸåå†æ’­æ”¾åŠ¨ç”»</li>
<li>è¯·æ±‚å®Œæˆæ‰æ˜¾ç¤ºåŠ¨æ•ˆ</li>
<li>æ ¹æ®çŠ¶æ€åˆ‡æ¢ä¸åŒåŠ¨ç”»</li>
</ul>
<p>ç®€è€Œè¨€ä¹‹ï¼šLottie å¯ä»¥è®©ä½ åœ¨åº”ç”¨æˆ–ç½‘ç«™ä¸­æ·»åŠ æ›´æµç•…çš„åŠ¨ç”»æ•ˆæœï¼Œå¹¶ä¸”ä¸ä¼šé™ä½æ€§èƒ½æˆ–å ç”¨æ‰€å­˜å‚¨çš„ç©ºé—´ã€‚</p>
<hr/>
<h2 data-id="heading-9">å…è´¹ Lottie åŠ¨ç”»ç½‘ç«™</h2>
<p>è¯´å®è¯ï¼ŒåŠ¨ç”»åˆ¶ä½œæˆæœ¬å¾ˆé«˜ã€‚æ²¡äººä¼šä¸ºäº†åšä¸€ä¸ªå¼¹è·³çš„è´­ç‰©è½¦å›¾æ ‡å°±å»ç»„ä»¶æ•´ä¸ªç‰¹æ•ˆå›¢é˜Ÿã€‚
å¹¸è¿çš„æ˜¯ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šå…è´¹çš„ Lottie åŠ¨ç”»ï¼Œä½ å¯ä»¥ç›´æ¥æŠŠå®ƒä»¬æ·»åŠ åˆ°ä½ çš„åº”ç”¨æˆ–è€…ç½‘ç«™é‡Œé¢ã€‚</p>
<p>ä¸‹é¢è¿™äº›ç½‘ç«™ï¼ŒåŸºæœ¬å¯ä»¥è¦†ç›–ä½  80% çš„æ—¥å¸¸éœ€æ±‚ï¼Œè€Œä¸”ä¸èŠ±é’±ã€‚</p>
<h3 data-id="heading-10">1. LottieFilesï¼ˆå®˜æ–¹é¦–é€‰ï¼‰</h3>
<p>Lottie çš„å®˜æ–¹å¹³å°ï¼Œä¹Ÿæ˜¯å¤§å¤šæ•°äººæ‰¾åŠ¨ç”»çš„ç¬¬ä¸€ç«™ã€‚
æä¾›å¤§é‡å…è´¹åŠ¨ç”»èµ„æºï¼Œæ”¯æŒåœ¨çº¿é¢„è§ˆå’Œä¿®æ”¹é¢œè‰²ï¼Œä¸‹è½½çš„å°±æ˜¯æ ‡å‡† JSON æ–‡ä»¶ï¼Œç”¨èµ·æ¥éå¸¸çœå¿ƒã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5d6968a036b411293e0c269cd21027d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771038204&amp;x-signature=dy%2B7mU5tqyeuKUTBSBTXuWlvrhc%3D" alt="" loading="lazy"/></p>
<p>ç½‘ç«™ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Flottiefiles.com%2F" target="_blank" title="https://lottiefiles.com/" ref="nofollow noopener noreferrer">lottiefiles.com/</a></p>
<hr/>
<h3 data-id="heading-11">2. IconScout</h3>
<p>IconScout æœ¬èº«å°±æ˜¯ä¸€ä¸ªå¤§å‹è®¾è®¡ç´ æç«™ï¼Œå…¶ä¸­çš„å…è´¹ Lottie åŠ¨ç”»è¦†ç›–äº†å¤§é‡ UI åœºæ™¯ï¼Œä»åŠ è½½åŠ¨ç”»åˆ°è§’è‰²åŠ¨æ•ˆéƒ½æœ‰ï¼Œé£æ ¼ä¹Ÿæ¯”è¾ƒå¤šæ ·ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/485a4420abdc43ec9fa6665a1dbe49d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771038204&amp;x-signature=lcXAM62pY58WHFIQDtLaMNhThw8%3D" alt="" loading="lazy"/></p>
<p>ç½‘ç«™ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Ficonscout.com%2F" target="_blank" title="https://iconscout.com/" ref="nofollow noopener noreferrer">iconscout.com/</a></p>
<hr/>
<h3 data-id="heading-12">3. Storysetï¼ˆFreepik å‡ºå“ï¼‰</h3>
<p>Storyset æä¾›å¯åœ¨æµè§ˆå™¨ä¸­ç›´æ¥ç¼–è¾‘çš„æ’ç”»å’Œ Lottie åŠ¨ç”»ï¼Œä½ å¯ä»¥è‡ªå·±æ”¹é¢œè‰²ã€æ­é…å…ƒç´ ï¼Œç„¶åå¯¼å‡ºã€‚å³ä½¿å®Œå…¨ä¸æ‡‚è®¾è®¡ï¼Œä¹Ÿèƒ½åšå‡ºâ€œåƒå®šåˆ¶è¿‡â€çš„æ•ˆæœã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a926cd15230b4d0cbfeb873aec7f08cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771038204&amp;x-signature=dtyCCjNMMkTkLUK81Vt3OWNEr6o%3D" alt="" loading="lazy"/></p>
<p>ç½‘ç«™ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fstoryset.com%2F" target="_blank" title="https://storyset.com/" ref="nofollow noopener noreferrer">storyset.com/</a></p>
<hr/>
<h3 data-id="heading-13">4. LottieFlow</h3>
<p>ç”± Webflow ç¤¾åŒºç»´æŠ¤çš„å…è´¹ Lottie åº“ï¼Œä¸»æ‰“æ— æ°´å°ã€æ— ä¼šå‘˜é™åˆ¶ã€‚
åŠ¨ç”»ä»¥ Web åœºæ™¯ä¸ºä¸»ï¼Œä½† JSON æ–‡ä»¶åœ¨ä»»ä½•é¡¹ç›®ä¸­éƒ½èƒ½ç”¨ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62cb6dfbd9c34a358f838225c8ce4bfb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771038204&amp;x-signature=3WNmrnioRF%2F%2BQ7ettCsLEkzZNX4%3D" alt="" loading="lazy"/></p>
<p>ç½‘ç«™ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Ffinsweet.com%2Flottieflow" target="_blank" title="https://finsweet.com/lottieflow" ref="nofollow noopener noreferrer">finsweet.com/lottieflow</a></p>
<hr/>
<h2 data-id="heading-14">å…¶ä»–å¯é€‰èµ„æº</h2>
<p>å¦‚æœä½ æƒ³å¤šå›¤ä¸€äº›é£æ ¼ä¸åŒçš„åŠ¨ç”»ï¼Œè¿™äº›ä¹Ÿå¯ä»¥é¡ºæ‰‹æ”¶è—ï¼š</p>
<ul>
<li>Creattieï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fcreattie.com%2F" target="_blank" title="https://creattie.com/" ref="nofollow noopener noreferrer">creattie.com/</a></li>
<li>Lordiconï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Flordicon.com%2F" target="_blank" title="https://lordicon.com/" ref="nofollow noopener noreferrer">lordicon.com/</a></li>
<li>Lottielabï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Flottielab.com%2F" target="_blank" title="https://lottielab.com/" ref="nofollow noopener noreferrer">lottielab.com/</a></li>
</ul>
<hr/>
<p>Lottie çœŸæ­£è§£å†³çš„ï¼Œå…¶å®æ˜¯é¡µé¢ä½“éªŒçš„é—®é¢˜ã€‚
å®ƒè®©åŠ¨ç”»å˜å¾—è½»é‡ã€å¯æ§ï¼Œä¹Ÿå¤§å¹…é™ä½äº†å¼€å‘å’Œè®¾è®¡ä¹‹é—´çš„åä½œæˆæœ¬ã€‚</p>
<p>ä½ ä¸éœ€è¦æ˜¯ After Effects é«˜æ‰‹ï¼Œä¹Ÿä¸ç”¨å†™å¤æ‚çš„åŠ¨ç”»é€»è¾‘ã€‚
å¾ˆå¤šæ—¶å€™ï¼Œåªæ˜¯ä¸‹è½½ä¸€ä¸ª JSON æ–‡ä»¶ï¼Œæ”¾è¿›é¡¹ç›®é‡Œï¼Œé¡µé¢ç«‹åˆ»å°±ä¼šå¤šä¸€ç‚¹è´¨æ„Ÿã€‚</p>
<blockquote>
<p>æœ¬æ–‡é¦–å‘äºå…¬ä¼—å·ï¼šç¨‹åºå‘˜å¤§åï¼Œä¸“æ³¨å‰ç«¯ã€Javaå¼€å‘ï¼ŒAIåº”ç”¨å’Œå·¥å…·çš„åˆ†äº«ã€‚å…³æ³¨æˆ‘ï¼Œå°‘èµ°å¼¯è·¯ï¼Œä¸€èµ·è¿›æ­¥ï¼</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android Telephony ç³»ç»Ÿ - å®Œæ•´åŠŸèƒ½ä¸æ ¸å¿ƒç±»åˆ†æ]]></title>    <link>https://juejin.cn/post/7603591775392202779</link>    <guid>https://juejin.cn/post/7603591775392202779</guid>    <pubDate>2026-02-07T03:25:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603591775392202779" data-draft-id="7603627478020112394" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android Telephony ç³»ç»Ÿ - å®Œæ•´åŠŸèƒ½ä¸æ ¸å¿ƒç±»åˆ†æ"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-02-07T03:25:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·341408199125"/> <meta itemprop="url" content="https://juejin.cn/user/570004686782272"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android Telephony ç³»ç»Ÿ - å®Œæ•´åŠŸèƒ½ä¸æ ¸å¿ƒç±»åˆ†æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/570004686782272/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·341408199125
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T03:25:22.000Z" title="Sat Feb 07 2026 03:25:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">ä¸€ã€ç³»ç»Ÿæ•´ä½“æ¶æ„</h3>
<p>Android Telephony ç³»ç»Ÿæ˜¯ä¸€ä¸ªåˆ†å±‚çš„é€šä¿¡ç®¡ç†æ¡†æ¶ï¼Œè´Ÿè´£ç®¡ç†è¯­éŸ³é€šè¯ã€çŸ­ä¿¡/å½©ä¿¡ã€æ•°æ®è¿æ¥å’Œå„ç§ç”µä¿¡åŠŸèƒ½ã€‚</p>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     åº”ç”¨å±‚ API (Java Framework)          â”‚
â”‚  TelephonyManager, SmsManager,           â”‚
â”‚  TelecomManager, TelephonyCallback       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Framework æœåŠ¡å±‚ (packages_services_  â”‚
â”‚            Telephony)                   â”‚
â”‚  PhoneGlobals, PhoneInterfaceManager,   â”‚
â”‚  TelephonyConnectionService             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å±‚ (frameworks_opt_       â”‚
â”‚           telephony)                    â”‚
â”‚  Phone, GsmCdmaPhone, CallTracker,       â”‚
â”‚  ServiceStateTracker, ImsPhone           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   RIL é€šä¿¡å±‚ (CommandsInterface)        â”‚
â”‚  ä¸åº•å±‚ modem/RIL é€šä¿¡                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ç¡¬ä»¶å±‚ (Modem/RIL)               â”‚
â”‚   <span class="hljs-number">2</span>G/<span class="hljs-number">3</span>G/<span class="hljs-number">4</span>G/<span class="hljs-number">5</span>G æ— çº¿ç”µæ”¶å‘                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h3 data-id="heading-1">äºŒã€æ ¸å¿ƒç±»ä½“ç³»</h3>
<h4 data-id="heading-2">2.1 Phone æ¥å£ä¸å®ç°</h4>
<pre><code class="hljs language-scss" lang="scss">Phone (æŠ½è±¡åŸºç±»)
â”œâ”€â”€ GsmCdmaPhone (ä¸»è¦å®ç°)
â”‚   â”œâ”€â”€ GSM å‘¼å«å¤„ç†
â”‚   â”œâ”€â”€ CDMA å‘¼å«å¤„ç†
â”‚   â””â”€â”€ IMS èåˆé€šä¿¡
â”‚
â””â”€â”€ ImsPhone (IMS ä¸“ç”¨)
    â”œâ”€â”€ VoLTE (Voice over LTE)
    â”œâ”€â”€ VoWiFi (Voice over WiFi)
    â””â”€â”€ RCS (Rich Communication Services)
</code></pre>
<p><strong>Phone çš„å…³é”®èŒè´£</strong>ï¼š</p>
<ul>
<li>å‘¼å«ç®¡ç†ï¼ˆæ¥é€šã€æŒ‚æ–­ã€è½¬æ¥ç­‰ï¼‰</li>
<li>çŸ­ä¿¡/å½©ä¿¡æ”¶å‘</li>
<li>ä¿¡å·å¼ºåº¦å’ŒæœåŠ¡çŠ¶æ€è·Ÿè¸ª</li>
<li>SIM å¡ç®¡ç†</li>
<li>æ•°æ®è¿æ¥æ§åˆ¶</li>
</ul>
<h4 data-id="heading-3">2.2 å…³é”®ç±»æ¸…å•</h4>
















































































<table><thead><tr><th>ç±»å</th><th>æ‰€å±æ¨¡å—</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td><strong>GsmCdmaPhone</strong></td><td>frameworks_opt_telephony</td><td>GSM/CDMA/LTE é€šç”¨ Phone å®ç°</td></tr><tr><td><strong>Phone</strong></td><td>frameworks_opt_telephony</td><td>Phone æ¥å£å®šä¹‰</td></tr><tr><td><strong>GsmCdmaCallTracker</strong></td><td>frameworks_opt_telephony</td><td>å‘¼å«çŠ¶æ€è¿½è¸ªå™¨</td></tr><tr><td><strong>GsmCdmaCall</strong></td><td>frameworks_opt_telephony</td><td>å‘¼å«å¯¹è±¡ï¼ˆå‰æ™¯/èƒŒæ™¯/æ¥ç”µï¼‰</td></tr><tr><td><strong>GsmCdmaConnection</strong></td><td>frameworks_opt_telephony</td><td>å•ä¸ªè¿æ¥å¯¹è±¡</td></tr><tr><td><strong>ServiceStateTracker</strong></td><td>frameworks_opt_telephony</td><td>ç½‘ç»œæœåŠ¡çŠ¶æ€è·Ÿè¸ª</td></tr><tr><td><strong>ServiceState</strong></td><td>frameworks_base</td><td>æœåŠ¡çŠ¶æ€æ•°æ®ç»“æ„</td></tr><tr><td><strong>SignalStrengthController</strong></td><td>frameworks_opt_telephony</td><td>ä¿¡å·å¼ºåº¦ç®¡ç†</td></tr><tr><td><strong>TelephonyManager</strong></td><td>frameworks_base</td><td>åº”ç”¨ API å…¥å£</td></tr><tr><td><strong>SmsManager</strong></td><td>frameworks_base</td><td>çŸ­ä¿¡ç®¡ç† API</td></tr><tr><td><strong>TelecomManager</strong></td><td>frameworks_base</td><td>é€šè¯ç®¡ç† API</td></tr><tr><td><strong>InboundSmsHandler</strong></td><td>frameworks_opt_telephony</td><td>çŸ­ä¿¡æ¥æ”¶å¤„ç†</td></tr><tr><td><strong>PhoneInterfaceManager</strong></td><td>packages_services_Telephony</td><td>Binder æ¥å£å®ç°</td></tr><tr><td><strong>TelephonyConnectionService</strong></td><td>packages_services_Telephony</td><td>Telecom é›†æˆ</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-4">ä¸‰ã€å‘¼å«ç®¡ç†ç³»ç»Ÿ</h3>
<h4 data-id="heading-5">3.1 Call çŠ¶æ€æœº</h4>
<pre><code class="hljs language-java" lang="java">GsmCdmaCall çš„ <span class="hljs-number">3</span> ç§ä¸»è¦çŠ¶æ€ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RINGING    â”‚  â† æ¥ç”µå“é“ƒæˆ–æ¥ç”µç­‰å¾…
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”œâ”€ acceptCall() â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                   â”‚   ACTIVE    â”‚
      â””â”€ rejectCall() â”€â”€â†’ â”‚  (å·²æ¥é€š)    â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”œâ”€ hold() â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  IDLE       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚  HOLDING    â”‚
â”‚ (æ— å‘¼å«)     â”‚    hangup()     â”‚             â”‚ (ä¿æŒä¸­)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-6">3.2 GsmCdmaCallTracker æ ¸å¿ƒåŠŸèƒ½</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GsmCdmaCallTracker</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">CallTracker</span> {
    <span class="hljs-comment">// ä¸‰ä¸ªä¸»è¦çš„ Call å®¹å™¨</span>
    <span class="hljs-keyword">public</span> GsmCdmaCall mRingingCall;      <span class="hljs-comment">// æ¥ç”µ / æ¥ç”µç­‰å¾…</span>
    <span class="hljs-keyword">public</span> GsmCdmaCall mForegroundCall;   <span class="hljs-comment">// å‰æ™¯å‘¼å«ï¼ˆæ´»è·ƒï¼‰</span>
    <span class="hljs-keyword">public</span> GsmCdmaCall mBackgroundCall;   <span class="hljs-comment">// èƒŒæ™¯å‘¼å«ï¼ˆä¿æŒï¼‰</span>
    
    <span class="hljs-comment">// è¿æ¥æ•°ç»„ï¼ˆå•ä¸ªé€šè¯çš„åº•å±‚è¿æ¥ï¼‰</span>
    <span class="hljs-keyword">public</span> GsmCdmaConnection[] mConnections;
    
    <span class="hljs-comment">// æ ¸å¿ƒæ–¹æ³•</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dial</span><span class="hljs-params">(String dialString, DialArgs dialArgs)</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">acceptCall</span><span class="hljs-params">()</span>;                          <span class="hljs-comment">// æ¥å¬æ¥ç”µ</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rejectCall</span><span class="hljs-params">()</span>;                          <span class="hljs-comment">// æ‹’æ¥æ¥ç”µ</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">switchWaitingOrHoldingAndActive</span><span class="hljs-params">()</span>;     <span class="hljs-comment">// åˆ‡æ¢æ´»è·ƒ/ä¿æŒ</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">conference</span><span class="hljs-params">()</span>;                          <span class="hljs-comment">// ä¼šè®®</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">explicitCallTransfer</span><span class="hljs-params">()</span>;                <span class="hljs-comment">// å‘¼å«è½¬ç§»</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hangupForegroundResumeBackground</span><span class="hljs-params">()</span>;    <span class="hljs-comment">// æŒ‚æ–­å‰æ™¯æ¢å¤èƒŒæ™¯</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hangupWaitingOrBackground</span><span class="hljs-params">()</span>;           <span class="hljs-comment">// æŒ‚æ–­èƒŒæ™¯/ç­‰å¾…</span>
}
</code></pre>
<p><strong>GsmCdmaCallTracker çš„å·¥ä½œæµç¨‹</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-number">1</span>. æ‹¨å· (Outgoing Call)
   â”œâ”€ <span class="hljs-built_in">dial</span>() â†’ å‘é€ ATD å‘½ä»¤ç»™ RIL
   â”œâ”€ çŠ¶æ€: DIALING â†’ ALERTING â†’ ACTIVE
   â””â”€ é€šçŸ¥ mForegroundCall

<span class="hljs-number">2</span>. æ¥ç”µ (Incoming Call)
   â”œâ”€ RIL ä¸ŠæŠ¥ CALL_STATE_CHANGE
   â”œâ”€ <span class="hljs-built_in">pollCalls</span>() è·å–æœ€æ–°å‘¼å«åˆ—è¡¨
   â”œâ”€ çŠ¶æ€: INCOMING â†’ WAITING (å¦‚å·²æœ‰æ´»è·ƒå‘¼å«)
   â””â”€ é€šçŸ¥ mRingingCall

<span class="hljs-number">3</span>. æ¥å¬
   â”œâ”€ <span class="hljs-built_in">acceptCall</span>() æˆ– <span class="hljs-built_in">switchWaitingOrHoldingAndActive</span>()
   â”œâ”€ å‰æ™¯å‘¼å«è¿›å…¥ HOLDING
   â”œâ”€ æ¥ç”µè¿›å…¥ ACTIVE
   â””â”€ è§¦å‘ CallStateChanged å›è°ƒ

<span class="hljs-number">4</span>. æŒ‚æ–­
   â”œâ”€ <span class="hljs-built_in">hangup</span>(call)
   â”œâ”€ çŠ¶æ€è½¬ç§»åˆ° IDLE
   â””â”€ æ¸…ç†è¿æ¥èµ„æº
</code></pre>
<hr/>
<h3 data-id="heading-7">å››ã€æœåŠ¡çŠ¶æ€ä¸ä¿¡å·ç®¡ç†</h3>
<h4 data-id="heading-8">4.1 ServiceState æ•°æ®ç»“æ„</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceState</span> {
    <span class="hljs-comment">// ç½‘ç»œæ³¨å†ŒçŠ¶æ€</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> mVoiceRegState;      <span class="hljs-comment">// è¯­éŸ³: IN_SERVICE, OUT_OF_SERVICE, etc.</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> mDataRegState;       <span class="hljs-comment">// æ•°æ®</span>
    
    <span class="hljs-comment">// è¿è¥å•†ä¿¡æ¯</span>
    <span class="hljs-keyword">private</span> String mOperatorAlphaLong;    <span class="hljs-comment">// å¦‚"China Mobile"</span>
    <span class="hljs-keyword">private</span> String mOperatorAlphaShort;   <span class="hljs-comment">// å¦‚"CMCC"</span>
    <span class="hljs-keyword">private</span> String mOperatorNumeric;      <span class="hljs-comment">// MCC/MNC å¦‚"46000"</span>
    
    <span class="hljs-comment">// ç½‘ç»œä¿¡æ¯</span>
    <span class="hljs-keyword">private</span> List&lt;NetworkRegistrationInfo&gt; mNetworkRegistrationInfos;
    
    <span class="hljs-comment">// ç‰¹æ®ŠçŠ¶æ€</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> mIsEmergencyOnly;     <span class="hljs-comment">// ä»…ç´§æ€¥å‘¼å«</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> mIsManualNetworkSelection;  <span class="hljs-comment">// æ‰‹åŠ¨é€‰ç½‘</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> mNrFrequencyRange;        <span class="hljs-comment">// 5G é¢‘æ®µä¿¡æ¯</span>
    
    <span class="hljs-comment">// å…³é”®æ–¹æ³•</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getState</span><span class="hljs-params">()</span>;                <span class="hljs-comment">// æ•´ä½“æœåŠ¡çŠ¶æ€</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isInService</span><span class="hljs-params">()</span>;         <span class="hljs-comment">// æ˜¯å¦åœ¨ç½‘</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getDataNetworkType</span><span class="hljs-params">()</span>;      <span class="hljs-comment">// æ•°æ®ç½‘ç»œç±»å‹</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getVoiceNetworkType</span><span class="hljs-params">()</span>;     <span class="hljs-comment">// è¯­éŸ³ç½‘ç»œç±»å‹</span>
}
</code></pre>
<p><strong>æœåŠ¡çŠ¶æ€å¸¸é‡</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">STATE_IN_SERVICE</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;           <span class="hljs-comment">// åœ¨ç½‘</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">STATE_OUT_OF_SERVICE</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;       <span class="hljs-comment">// æ— ä¿¡å·</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">STATE_EMERGENCY_ONLY</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;       <span class="hljs-comment">// ä»…ç´§æ€¥</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">STATE_POWER_OFF</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;            <span class="hljs-comment">// å…³æœº</span>
</code></pre>
<h4 data-id="heading-9">4.2 SignalStrength ä¸ SignalStrengthController</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SignalStrengthController</span> {
    <span class="hljs-comment">// ä¿¡å·å¼ºåº¦ç­‰çº§</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SIGNAL_STRENGTH_POOR</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SIGNAL_STRENGTH_MODERATE</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SIGNAL_STRENGTH_GOOD</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SIGNAL_STRENGTH_GREAT</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;
    
    <span class="hljs-comment">// ä¸åŒ RAT çš„ä¿¡å·é˜ˆå€¼</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThresholdsEntry</span> {
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span>[] GERAN_RSSI;  <span class="hljs-comment">// GSM ä¿¡å·</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span>[] UTRAN_RSCP;  <span class="hljs-comment">// 3G ä¿¡å·</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span>[] EUTRAN_RSRP; <span class="hljs-comment">// LTE ä¿¡å·</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span>[] NGRAN_SSRP;  <span class="hljs-comment">// 5G ä¿¡å·</span>
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-10">äº”ã€çŸ­ä¿¡ç³»ç»Ÿ</h3>
<h4 data-id="heading-11">5.1 çŸ­ä¿¡å‘é€æµç¨‹</h4>
<pre><code class="hljs language-scss" lang="scss">SmsManager<span class="hljs-selector-class">.sendTextMessage</span>()
    â”‚
    â”œâ”€ æƒé™æ£€æŸ¥ (SEND_SMS)
    â”‚
    â”œâ”€ è·å– ISms (Binder æ¥å£)
    â”‚
    â”œâ”€ iSms<span class="hljs-selector-class">.sendTextForSubscriber</span>(
    â”‚     subscriptionId,
    â”‚     destinationAddress,
    â”‚     scAddress,           // Service Center Address
    â”‚     text,
    â”‚     sentIntent,          // å‘é€ç»“æœå›è°ƒ
    â”‚     deliveryIntent       // é€’é€ç»“æœå›è°ƒ
    â”‚ )
    â”‚
    â””â”€ è§¦å‘ sentIntent
        â”œâ”€ RESULT_OK (æˆåŠŸ)
        â”œâ”€ RESULT_ERROR_GENERIC_FAILURE
        â”œâ”€ RESULT_ERROR_RADIO_OFF
        â”œâ”€ RESULT_ERROR_NULL_PDU
        â””â”€ å…¶ä»–é”™è¯¯
</code></pre>
<h4 data-id="heading-12">5.2 çŸ­ä¿¡æ¥æ”¶æµç¨‹</h4>
<pre><code class="hljs language-scss" lang="scss">RIL ä¸ŠæŠ¥ SMS_ON_COMPLETE_MESSAGE
    â”‚
    â””â”€â†’ InboundSmsHandler<span class="hljs-selector-class">.handleMessage</span>(MSG_NEW_SMS)
        â”‚
        â”œâ”€ è§£æ PDU (Protocol Data Unit)
        â”‚
        â”œâ”€ æ£€æŸ¥æ˜¯å¦ä¸ºæ¥è‡ªåº”ç”¨çš„ SMS (AppSmsManager)
        â”‚
        â”œâ”€ å‘é»˜è®¤ SMS åº”ç”¨æŠ•é€’
        â”‚   â”œâ”€ å¹¿æ’­ Intent SMS_DELIVER_ACTION
        â”‚   â””â”€ æˆ–å‘é€ç»™ç‰¹å®šåº”ç”¨ç»„ä»¶
        â”‚
        â””â”€ å†™å…¥ SMS æ•°æ®åº“ (content://sms)
</code></pre>
<p><strong>SmsManager å…³é”®æ–¹æ³•</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å‘é€</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendTextMessage</span><span class="hljs-params">(String destinationAddress, String scAddress,
                           String text, PendingIntent sentIntent,
                           PendingIntent deliveryIntent)</span>

<span class="hljs-comment">// å‘é€å¤šéƒ¨åˆ†çŸ­ä¿¡</span>
<span class="hljs-keyword">public</span> ArrayList&lt;String&gt; <span class="hljs-title function_">divideMessage</span><span class="hljs-params">(String text)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendMultipartTextMessage</span><span class="hljs-params">(String destinationAddress,
                                     String scAddress,
                                     ArrayList&lt;String&gt; parts,
                                     ArrayList&lt;PendingIntent&gt; sentIntents,
                                     ArrayList&lt;PendingIntent&gt; deliveryIntents)</span>

<span class="hljs-comment">// å‘é€æ•°æ®çŸ­ä¿¡</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendDataMessage</span><span class="hljs-params">(String destinationAddress, String scAddress,
                           <span class="hljs-type">short</span> destinationPort, <span class="hljs-type">byte</span>[] data,
                           PendingIntent sentIntent,
                           PendingIntent deliveryIntent)</span>
</code></pre>
<hr/>
<h3 data-id="heading-13">å…­ã€æ•°æ®è¿æ¥ç®¡ç†</h3>
<h4 data-id="heading-14">6.1 DataNetworkController æ¶æ„</h4>
<pre><code class="hljs language-scss" lang="scss">DataNetworkController (ç®¡ç†æ•°æ®ç½‘ç»œ)
â”œâ”€â”€ DataNetwork (å•ä¸ªæ•°æ®è¿æ¥)
â”‚   â”œâ”€â”€ APN é…ç½®
â”‚   â”œâ”€â”€ QoS å‚æ•°
â”‚   â”œâ”€â”€ è·¯ç”±è§„åˆ™
â”‚   â””â”€â”€ ç»Ÿè®¡ä¿¡æ¯
â”‚
â”œâ”€â”€ DataNetworkManager (å¤šè¿æ¥ç®¡ç†)
â”‚   â”œâ”€â”€ äº’è”ç½‘ PDN (Primary)
â”‚   â”œâ”€â”€ IMS PDN (è¯­éŸ³è§†é¢‘)
â”‚   â””â”€â”€ å…¶ä»–ç‰¹æ®Š PDN
â”‚
â””â”€â”€ DataProfileManager (APN é…ç½®ç®¡ç†)
    â”œâ”€â”€ é»˜è®¤ APN
    â”œâ”€â”€ MMS APN
    â”œâ”€â”€ SUPL APN
    â””â”€â”€ IMS APN
</code></pre>
<h4 data-id="heading-15">6.2 NetworkRegistrationInfo</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkRegistrationInfo</span> {
    <span class="hljs-comment">// åŸŸç±»å‹</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">DOMAIN_CS</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;     <span class="hljs-comment">// Circuit Switch (è¯­éŸ³)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">DOMAIN_PS</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;     <span class="hljs-comment">// Packet Switch (æ•°æ®)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">DOMAIN_CS_PS</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;  <span class="hljs-comment">// ä¸¤è€…</span>
    
    <span class="hljs-comment">// ä¼ è¾“ç±»å‹</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TRANSPORT_TYPE_WWAN</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;   <span class="hljs-comment">// ç§»åŠ¨ç½‘ç»œ</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TRANSPORT_TYPE_WLAN</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;   <span class="hljs-comment">// WiFi</span>
    
    <span class="hljs-comment">// æ³¨å†ŒçŠ¶æ€</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">REGISTRATION_STATE_NOT_REGISTERED</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">REGISTRATION_STATE_HOME</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">REGISTRATION_STATE_SEARCHING</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">REGISTRATION_STATE_DENIED</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">REGISTRATION_STATE_UNKNOWN</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">REGISTRATION_STATE_ROAMING</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;
    
    <span class="hljs-comment">// å…³é”®å­—æ®µ</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> mDomain;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> mTransportType;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> mRegistrationState;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> mAccessNetworkTechnology;  <span class="hljs-comment">// NETWORK_TYPE_*</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-16">ä¸ƒã€Telecom é›†æˆ</h3>
<h4 data-id="heading-17">7.1 TelecomManager ä¸ InCallService</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TelecomManager</span> {
    <span class="hljs-comment">// å‘¼å«ç®¡ç† API</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">acceptRingingCall</span><span class="hljs-params">()</span>         <span class="hljs-comment">// æ¥å¬æ¥ç”µ</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">endCall</span><span class="hljs-params">()</span>                <span class="hljs-comment">// æŒ‚æ–­é€šè¯</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">silenceRinger</span><span class="hljs-params">()</span>             <span class="hljs-comment">// é™éŸ³é“ƒå£°</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">holdCall</span><span class="hljs-params">(String callId)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unholdCall</span><span class="hljs-params">(String callId)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">disconnect</span><span class="hljs-params">(String callId)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transfer</span><span class="hljs-params">(String callId, Uri address)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">conference</span><span class="hljs-params">(String callId1, String callId2)</span>
    
    <span class="hljs-comment">// æŸ¥è¯¢ API</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isInCall</span><span class="hljs-params">()</span>               <span class="hljs-comment">// æ˜¯å¦åœ¨é€šè¯</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isRinging</span><span class="hljs-params">()</span>              <span class="hljs-comment">// æ˜¯å¦æœ‰æ¥ç”µ</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getCallState</span><span class="hljs-params">()</span>               <span class="hljs-comment">// è·å–é€šè¯çŠ¶æ€</span>
}
</code></pre>
<h4 data-id="heading-18">7.2 TelephonyConnectionService</h4>
<pre><code class="hljs language-scss" lang="scss">TelephonyConnectionService é›†æˆ Telecom Framework
    â”‚
    â”œâ”€ æ¥æ”¶ <span class="hljs-built_in">onCreateOutgoingConnection</span>()
    â”‚   â””â”€â†’ åˆ›å»º TelephonyConnection
    â”‚
    â”œâ”€ æ¥æ”¶ <span class="hljs-built_in">onCreateIncomingConnection</span>()
    â”‚   â””â”€â†’ æŠ•é€’æ¥ç”µ Intent
    â”‚
    â””â”€ å¤„ç†æ¥è‡ª Telecom çš„å‘½ä»¤
        â”œâ”€ <span class="hljs-built_in">answer</span>(), <span class="hljs-built_in">disconnect</span>()
        â”œâ”€ <span class="hljs-built_in">hold</span>(), <span class="hljs-built_in">unhold</span>()
        â””â”€ <span class="hljs-built_in">conference</span>(), <span class="hljs-built_in">transfer</span>()
</code></pre>
<hr/>
<h3 data-id="heading-19">å…«ã€IMS ä¸ VoLTE</h3>
<h4 data-id="heading-20">8.1 ImsPhone æ¶æ„</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-built_in">ImsPhone</span> (IMS å®ç°)
â”œâ”€â”€ IMS æ³¨å†Œç®¡ç†
â”‚   â”œâ”€ æ³¨å†Œåˆ° IMS æœåŠ¡å™¨
â”‚   â”œâ”€ å¿ƒè·³ä¿æ´»
â”‚   â””â”€ è¿æ¥ç®¡ç†
â”‚
â”œâ”€â”€ VoLTE å‘¼å«å¤„ç†
â”‚   â”œâ”€ æ‹¨å·
â”‚   â”œâ”€ æ¥å¬
â”‚   â””â”€ å‘¼å«ç®¡ç†
â”‚
â”œâ”€â”€ VoWiFi æ”¯æŒ
â”‚   â”œâ”€ <span class="hljs-built_in">WiFi</span> ä¸Šçš„ VoIP
â”‚   â””â”€ <span class="hljs-built_in">WiFi</span>-Cellular åˆ‡æ¢
â”‚
â”œâ”€â”€ RCS åŠŸèƒ½
â”‚   â”œâ”€ æ–‡ä»¶ä¼ è¾“
â”‚   â”œâ”€ ç¾¤èŠ
â”‚   â””â”€ å¯Œåª’ä½“
â”‚
â””â”€â”€ <span class="hljs-built_in">VoNR</span> (Voice over NR)
    â””â”€ <span class="hljs-number">5</span>G è¯­éŸ³æœåŠ¡
</code></pre>
<h4 data-id="heading-21">8.2 VoLTE çš„ä¼˜åŠ¿</h4>
<ul>
<li><strong>è¯­éŸ³è´¨é‡æ›´ä¼˜</strong>: AMR-WB ç¼–ç  (16kHz é‡‡æ ·)</li>
<li><strong>æ›´å¿«æ¥é€š</strong>: æ— éœ€å»ºç«‹ CS è¿æ¥</li>
<li><strong>é€šè¯ä¸­å¯ç”¨æ•°æ®</strong>: PS åŸŸå¯åŒæ—¶ä¼ è¾“</li>
<li><strong>ç”µæ± æ•ˆç‡</strong>: åŠŸè€—æ›´ä½</li>
</ul>
<hr/>
<h3 data-id="heading-22">ä¹ã€é€šçŸ¥ä¸å›è°ƒæœºåˆ¶</h3>
<h4 data-id="heading-23">9.1 TelephonyCallback ä½“ç³»</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TelephonyCallback</span> {
    <span class="hljs-comment">// æœåŠ¡çŠ¶æ€å˜åŒ–</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ServiceStateListener</span> {
        <span class="hljs-keyword">void</span> <span class="hljs-title function_">onServiceStateChanged</span><span class="hljs-params">(ServiceState state)</span>;
    }
    
    <span class="hljs-comment">// ä¿¡å·å¼ºåº¦å˜åŒ–</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SignalStrengthsListener</span> {
        <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSignalStrengthsChanged</span><span class="hljs-params">(SignalStrength signalStrength)</span>;
    }
    
    <span class="hljs-comment">// æ•°æ®è¿æ¥çŠ¶æ€</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DataConnectionStateListener</span> {
        <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDataConnectionStateChanged</span><span class="hljs-params">(<span class="hljs-type">int</span> state, <span class="hljs-type">int</span> networkType)</span>;
    }
    
    <span class="hljs-comment">// æ•°æ®æ´»åŠ¨</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DataActivityListener</span> {
        <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDataActivity</span><span class="hljs-params">(<span class="hljs-meta">@DataActivity</span> <span class="hljs-type">int</span> direction)</span>;
    }
    
    <span class="hljs-comment">// å‘¼å«çŠ¶æ€</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">PreciseCallStateListener</span> {
        <span class="hljs-keyword">void</span> <span class="hljs-title function_">onPreciseCallStateChanged</span><span class="hljs-params">(PreciseCallState callState)</span>;
    }
    
    <span class="hljs-comment">// æ˜¾ç¤ºä¿¡æ¯</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DisplayInfoListener</span> {
        <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDisplayInfoChanged</span><span class="hljs-params">(TelephonyDisplayInfo displayInfo)</span>;
    }
}
</code></pre>
<h4 data-id="heading-24">9.2 æ³¨å†Œå›è°ƒ</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åº”ç”¨å±‚æ³¨å†Œç›‘å¬</span>
<span class="hljs-type">TelephonyManager</span> <span class="hljs-variable">tm</span> <span class="hljs-operator">=</span> context.getSystemService(TelephonyManager.class);

<span class="hljs-type">MyCellback</span> <span class="hljs-variable">callback</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyCallback</span>();
tm.registerTelephonyCallback(executor, callback);

<span class="hljs-comment">// å–æ¶ˆæ³¨å†Œ</span>
tm.unregisterTelephonyCallback(callback);
</code></pre>
<hr/>
<h3 data-id="heading-25">åã€æƒé™æ¨¡å‹</h3>
<h4 data-id="heading-26">10.1 Telephony æƒé™</h4>













































<table><thead><tr><th>æƒé™</th><th>åŠŸèƒ½</th><th>é£é™©çº§åˆ«</th></tr></thead><tbody><tr><td>READ_PHONE_STATE</td><td>è¯»å–ç”µè¯çŠ¶æ€</td><td>å±é™©</td></tr><tr><td>READ_CALL_LOG</td><td>è¯»å–é€šè¯è®°å½•</td><td>å±é™©</td></tr><tr><td>READ_SMS</td><td>è¯»å–çŸ­ä¿¡</td><td>å±é™©</td></tr><tr><td>RECEIVE_SMS</td><td>æ¥æ”¶çŸ­ä¿¡</td><td>å±é™©</td></tr><tr><td>SEND_SMS</td><td>å‘é€çŸ­ä¿¡</td><td>å±é™©</td></tr><tr><td>CALL_PHONE</td><td>æ‹¨å·</td><td>å±é™©</td></tr><tr><td>MODIFY_PHONE_STATE</td><td>ä¿®æ”¹ç”µè¯çŠ¶æ€</td><td>ç³»ç»Ÿçº§</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-27">åä¸€ã€GsmCdmaPhone æ ¸å¿ƒæ–¹æ³•</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GsmCdmaPhone</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Phone</span> {
    <span class="hljs-comment">// å‘¼å«ç›¸å…³</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dial</span><span class="hljs-params">(String dialString, DialArgs dialArgs)</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rejectCall</span><span class="hljs-params">()</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">acceptCall</span><span class="hljs-params">()</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">conference</span><span class="hljs-params">()</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">explicitCallTransfer</span><span class="hljs-params">()</span>;
    
    <span class="hljs-comment">// ä¿¡æ¯ç›¸å…³</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getImei</span><span class="hljs-params">()</span>                 <span class="hljs-comment">// è·å– IMEI</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getSubscriberId</span><span class="hljs-params">()</span>         <span class="hljs-comment">// è·å– IMSI</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getGroupIdLevel1</span><span class="hljs-params">()</span>        <span class="hljs-comment">// è·å– GID1</span>
    
    <span class="hljs-comment">// SIM å¡ç›¸å…³</span>
    <span class="hljs-keyword">public</span> IccRecords <span class="hljs-title function_">getIccRecords</span><span class="hljs-params">()</span>       <span class="hljs-comment">// è·å– SIM è®°å½•</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getSimState</span><span class="hljs-params">()</span>                <span class="hljs-comment">// è·å– SIM çŠ¶æ€</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSimPowerState</span><span class="hljs-params">(<span class="hljs-type">int</span> state, Message result)</span>  <span class="hljs-comment">// SIM ç”µæºæ§åˆ¶</span>
    
    <span class="hljs-comment">// ç½‘ç»œç›¸å…³</span>
    <span class="hljs-keyword">public</span> ServiceState <span class="hljs-title function_">getServiceState</span><span class="hljs-params">()</span>   <span class="hljs-comment">// è·å–æœåŠ¡çŠ¶æ€</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setNetworkSelectionModeAutomatic</span><span class="hljs-params">()</span>  <span class="hljs-comment">// è‡ªåŠ¨é€‰ç½‘</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">selectNetworkManually</span><span class="hljs-params">(OperatorInfo operator, Message onComplete)</span>  <span class="hljs-comment">// æ‰‹åŠ¨é€‰ç½‘</span>
    
    <span class="hljs-comment">// è¯­éŸ³é‚®ä»¶</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateVoiceMail</span><span class="hljs-params">()</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getVoiceMailNumber</span><span class="hljs-params">()</span>
    
    <span class="hljs-comment">// æ•°æ®ç›¸å…³</span>
    <span class="hljs-keyword">public</span> DataNetworkController <span class="hljs-title function_">getDataNetworkController</span><span class="hljs-params">()</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-28">åäºŒã€å…³é”®æµç¨‹ç¤ºä¾‹</h3>
<h4 data-id="heading-29">12.1 æ‹¨å·å®Œæ•´æµç¨‹</h4>
<pre><code class="hljs language-css" lang="css">åº”ç”¨å±‚: TelecomManager.<span class="hljs-built_in">placeCall</span>(uri)
    â”‚
    â””â”€â”€â†’ Telecom Service
        â”‚
        â”œâ”€ é€‰æ‹©åˆé€‚çš„ PhoneAccount
        â”œâ”€ æƒé™æ£€æŸ¥
        â””â”€â”€â†’ TelephonyConnectionService.<span class="hljs-built_in">onCreateOutgoingConnection</span>()
            â”‚
            â””â”€â”€â†’ GsmCdmaPhone.<span class="hljs-built_in">dial</span>(dialString, dialArgs)
                â”‚
                â”œâ”€ æ£€æŸ¥ç”µè¯çŠ¶æ€ (IDLE/RINGING/OFFHOOK)
                â”œâ”€ åˆ›å»º GsmCdmaConnection å¯¹è±¡
                â”œâ”€ å‘é€ AT+ATD å‘½ä»¤ç»™ RIL
                â”‚
                â””â”€â”€â†’ RIL å¤„ç†
                    â”‚
                    â”œâ”€ å»ºç«‹ CS è¿æ¥
                    â”œâ”€ å‘é€ä¿¡ä»¤å»ºç«‹å‘¼å«
                    â”‚
                    â””â”€â”€â†’ ä¸ŠæŠ¥ CALL_STATE_CHANGE äº‹ä»¶
                        â”‚
                        â”œâ”€ çŠ¶æ€: DIALING â†’ ALERTING â†’ ACTIVE
                        â”œâ”€ è§¦å‘ CallStateChanged å›è°ƒ
                        â””â”€â”€â†’ UI æ›´æ–°æ˜¾ç¤º
</code></pre>
<h4 data-id="heading-30">12.2 æ¥ç”µæ¥å¬æµç¨‹</h4>
<pre><code class="hljs language-scss" lang="scss">RIL ä¸ŠæŠ¥ CALL_STATE_CHANGE (æ–°çš„æ¥ç”µ)
    â”‚
    â””â”€â”€â†’ GsmCdmaCallTracker<span class="hljs-selector-class">.pollCalls</span>()
        â”‚
        â”œâ”€ å‘é€ AT+CLCC (åˆ—å‡ºå½“å‰å‘¼å«)
        â”œâ”€ è§£æ RIL è¿”å›çš„å‘¼å«åˆ—è¡¨
        â”‚
        â””â”€â”€â†’ <span class="hljs-built_in">updateCallsFromNewCallList</span>()
            â”‚
            â”œâ”€ åˆ›å»ºæ–°çš„ GsmCdmaConnection
            â”œâ”€ æ›´æ–° mRingingCall
            â”œâ”€ è§¦å‘ CallStateChanged äº‹ä»¶
            â”‚
            â””â”€â”€â†’ Telecom æ¡†æ¶
                â”‚
                â””â”€â”€â†’ æ˜¾ç¤ºæ¥ç”µ UI
                    â”‚
                    ç”¨æˆ·ç‚¹å‡»æ¥å¬
                    â”‚
                    â””â”€â”€â†’ TelephonyConnectionService<span class="hljs-selector-class">.onAnswer</span>()
                        â”‚
                        â””â”€â”€â†’ GsmCdmaCallTracker<span class="hljs-selector-class">.acceptCall</span>()
                            â”‚
                            â”œâ”€ å‘é€ ATA å‘½ä»¤ç»™ RIL
                            â”œâ”€ å‰æ™¯å‘¼å«è¿›å…¥ HOLDING
                            â”œâ”€ æ¥ç”µè¿›å…¥ ACTIVE
                            â”‚
                            â””â”€â”€â†’ RIL å¤„ç†å‘¼å«åˆ‡æ¢
</code></pre>
<hr/>
<h3 data-id="heading-31">åä¸‰ã€é¢è¯•æ ¸å¿ƒçŸ¥è¯†ç‚¹</h3>
<p><strong>âœ… å¿…é¡»æŒæ¡</strong>ï¼š</p>
<ol>
<li>
<p><strong>Phone æ¡†æ¶</strong></p>
<ul>
<li>Phone æ¥å£ vs GsmCdmaPhone å®ç°</li>
<li>ä½•æ—¶ä½¿ç”¨ ImsPhone</li>
</ul>
</li>
<li>
<p><strong>Call ç®¡ç†</strong></p>
<ul>
<li>3 ä¸ª Call å¯¹è±¡çš„ç”¨é€”</li>
<li>å‘¼å«çŠ¶æ€è½¬ç§»å›¾</li>
<li>Connection ä¸ Call çš„å…³ç³»</li>
</ul>
</li>
<li>
<p><strong>ServiceState</strong></p>
<ul>
<li>æ³¨å†ŒçŠ¶æ€å«ä¹‰</li>
<li>NetworkRegistrationInfo çš„ä½œç”¨</li>
<li>æ•°æ®/è¯­éŸ³åˆ†åŸŸç®¡ç†</li>
</ul>
</li>
<li>
<p><strong>çŸ­ä¿¡ç³»ç»Ÿ</strong></p>
<ul>
<li>å‘é€æµç¨‹å’Œé”™è¯¯å¤„ç†</li>
<li>æ¥æ”¶å¤„ç†å’Œåº”ç”¨åˆ†å‘</li>
<li>PDU ç¼–ç </li>
</ul>
</li>
<li>
<p><strong>IMS/VoLTE</strong></p>
<ul>
<li>VoLTE ä¼˜åŠ¿</li>
<li>IMS æ³¨å†Œæµç¨‹</li>
<li>VoNR æ¦‚å¿µ</li>
</ul>
</li>
<li>
<p><strong>æƒé™æ¨¡å‹</strong></p>
<ul>
<li>å±é™©æƒé™åˆ—è¡¨</li>
<li>ç³»ç»Ÿæƒé™èŒƒå›´</li>
</ul>
</li>
</ol>
<hr/>
<p>è¿™ä¸ªå®Œæ•´çš„åˆ†ææ¶µç›–äº† Android Telephony ç³»ç»Ÿçš„æ‰€æœ‰ä¸»è¦åŠŸèƒ½å’Œæ ¸å¿ƒç±»ï¼Œå¯ä»¥ä½œä¸ºæ·±å…¥å­¦ä¹ æˆ–é¢è¯•å‡†å¤‡çš„å‚è€ƒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è™šæ‹Ÿåˆ—è¡¨ï¼šä»å®šé«˜åˆ°åŠ¨æ€é«˜åº¦çš„ Vue 3 & React æ»¡åˆ†å®ç°]]></title>    <link>https://juejin.cn/post/7603591775392251931</link>    <guid>https://juejin.cn/post/7603591775392251931</guid>    <pubDate>2026-02-07T03:49:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603591775392251931" data-draft-id="7603359026711969802" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è™šæ‹Ÿåˆ—è¡¨ï¼šä»å®šé«˜åˆ°åŠ¨æ€é«˜åº¦çš„ Vue 3 &amp; React æ»¡åˆ†å®ç°"/> <meta itemprop="keywords" content="å‰ç«¯,Vue.js,React.js"/> <meta itemprop="datePublished" content="2026-02-07T03:49:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‘ç°ä¸€åªå¤§å‘†ç“œ"/> <meta itemprop="url" content="https://juejin.cn/user/180747382561607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è™šæ‹Ÿåˆ—è¡¨ï¼šä»å®šé«˜åˆ°åŠ¨æ€é«˜åº¦çš„ Vue 3 &amp; React æ»¡åˆ†å®ç°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180747382561607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‘ç°ä¸€åªå¤§å‘†ç“œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T03:49:36.000Z" title="Sat Feb 07 2026 03:49:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">å‰è¨€</h3>
<p>åœ¨å¤„ç†æµ·é‡æ•°æ®æ¸²æŸ“ï¼ˆå¦‚ä¸‡çº§ç”šè‡³åä¸‡çº§åˆ—è¡¨ï¼‰æ—¶ï¼Œç›´æ¥æ“ä½œ DOM ä¼šå¯¼è‡´ä¸¥é‡çš„é¡µé¢å¡é¡¿ç”šè‡³å´©æºƒã€‚<strong>è™šæ‹Ÿåˆ—è¡¨ï¼ˆVirtual Listï¼‰</strong> ä½œä¸ºå‰ç«¯æ€§èƒ½ä¼˜åŒ–çš„â€œæ ¸æ­¦å™¨â€ï¼Œé€šè¿‡â€œåªæ¸²æŸ“å¯è§†åŒºâ€çš„ç­–ç•¥ï¼Œèƒ½å°†æ¸²æŸ“æ€§èƒ½æå‡æ•°ä¸ªé‡çº§ã€‚æœ¬æ–‡å°†å¸¦ä½ ä»é›¶å®ç°ä¸€ä¸ªæ”¯æŒ<strong>åŠ¨æ€é«˜åº¦</strong>çš„é€šç”¨è™šæ‹Ÿåˆ—è¡¨ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0aeb589869424d08be07ff8183e5af9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771040975&amp;x-signature=83d1HWo%2Fzcfl0pbpVr8sTUG%2Bd4g%3D" alt="å®šé«˜è™šæ‹Ÿåˆ—è¡¨æ»šåŠ¨.gif" loading="lazy"/></p>
<h2 data-id="heading-1">ä¸€ã€ æ ¸å¿ƒåŸç†è§£æ</h2>
<p>è™šæ‹Ÿåˆ—è¡¨æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªâ€œéšœçœ¼æ³•â€ï¼Œå…¶ç»“æ„é€šå¸¸åˆ†ä¸ºä¸‰å±‚ï¼š</p>
<ol>
<li><strong>å¤–å±‚å®¹å™¨ï¼ˆContainerï¼‰</strong> ï¼šå›ºå®šé«˜åº¦ï¼Œè®¾ç½® <code>overflow: auto</code>ï¼Œè´Ÿè´£ç›‘å¬æ»šåŠ¨äº‹ä»¶ã€‚</li>
<li><strong>å ä½èƒŒæ™¯ï¼ˆPlaceholderï¼‰</strong> ï¼šé«˜åº¦ç­‰äºâ€œæ€»æ•°æ®é‡ Ã— åˆ—è¡¨é¡¹é«˜åº¦â€ï¼Œç”¨äºæ’‘å¼€æ»šåŠ¨æ¡ï¼Œæ¨¡æ‹ŸçœŸå®æ»šåŠ¨çš„è§†è§‰æ•ˆæœã€‚</li>
<li><strong>æ¸²æŸ“å†…å®¹åŒºï¼ˆContent Areaï¼‰</strong> ï¼šç»å¯¹å®šä½ï¼Œæ ¹æ®æ»šåŠ¨è·ç¦»åŠ¨æ€è®¡ç®—èµ·å§‹ç´¢å¼•ï¼Œå¹¶é€šè¿‡ <code>translateY</code> åç§»åˆ°å½“å‰å¯è§†åŒºåŸŸã€‚</li>
</ol>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35758c5b480e4fd4ae543f60afd26730~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771040975&amp;x-signature=gm9VzHaAFCGyUyiSagfZbbWktEk%3D" alt="image.png" width="60%" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-2">äºŒã€ å®šé«˜è™šæ‹Ÿåˆ—è¡¨</h2>
<h3 data-id="heading-3">1. è®¾è®¡æ€è·¯</h3>
<ul>
<li><strong>å¯è§†é¡¹æ•°è®¡ç®—</strong>ï¼š<code>Math.ceil(å®¹å™¨é«˜åº¦ / å›ºå®šé«˜åº¦) Â± ç¼“å†²åŒº (BUFFER)</code>ã€‚</li>
<li><strong>èµ·å§‹ç´¢å¼•</strong>ï¼š<code>Math.floor(æ»šåŠ¨è·ç¦» / å›ºå®šé«˜åº¦)</code>ã€‚</li>
<li><strong>åç§»é‡</strong>ï¼š<code>èµ·å§‹ç´¢å¼• * å›ºå®šé«˜åº¦</code>ã€‚</li>
</ul>
<h3 data-id="heading-4">2. Vue 3 + TailwindCSSå®ç°</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div
    class="min-h-screen bg-gradient-to-br from-indigo-600 to-purple-600 py-10 px-5"
  &gt;
    &lt;div class="bg-white mt-20 h-[calc(100vh-200px)] rounded-xl"&gt;
      &lt;!-- æ»šåŠ¨å®¹å™¨ --&gt;
      &lt;div
        ref="virtualListRef"
        class="h-full overflow-auto relative"
        @scroll="handleScroll"
      &gt;
        &lt;!-- å ä½å®¹å™¨ï¼šç”¨äºæ’‘å¼€æ»šåŠ¨æ¡ï¼Œé«˜åº¦ = æ€»æ•°æ®é‡ * æ¯é¡¹é«˜åº¦ --&gt;
        &lt;div :style="{ height: `${totalHeight}px` }"&gt;&lt;/div&gt;

        &lt;!-- å¯è§†åŒºåŸŸåˆ—è¡¨ï¼šé€šè¿‡ transform å®šä½åˆ°æ»šåŠ¨ä½ç½® --&gt;
        &lt;div
          class="absolute top-0 left-0 right-0"
          :style="{ transform: `translateY(${offsetY}px)` }"
        &gt;
          &lt;div
            v-for="item in visibleList"
            :key="item.id"
            class="py-2 px-4 border-b border-gray-200"
            :class="{
              'bg-pink-200 h-[100px]': item.id % 2 !== 0,
              'bg-green-200 h-[100px]': item.id % 2 === 0,
            }"
          &gt;
            {{ item.name }}
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div
      class="fixed top-2 left-24 -translate-x-1/2 px-8 py-3 bg-white text-indigo-600 rounded-full text-base font-semibold cursor-pointer shadow-lg transition-all duration-300 hover:-translate-x-1/2 hover:-translate-y-0.5 hover:shadow-2xl"
      @click="goBack"
    &gt;
      â† è¿”å›é¦–é¡µ
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { ref, onMounted, computed } from 'vue';
import { useRouter } from 'vue-router';

const router = useRouter();

const ITEM_HEIGHT = 100; // åˆ—è¡¨é¡¹å›ºå®šé«˜åº¦ï¼ˆä¸æ ·å¼ä¸­çš„ h-[100px] ä¸€è‡´ï¼‰
const BUFFER = 5; // ç¼“å†²åŒºæ•°é‡ï¼Œé¿å…æ»šåŠ¨æ—¶å‡ºç°ç©ºç™½

const virtualListRef = ref&lt;HTMLDivElement | null&gt;(null);

const ListData = ref&lt;any[]&gt;([]); // å®Œæ•´åˆ—è¡¨æ•°æ®
const scrollTop = ref(0); // æ»šåŠ¨å®¹å™¨çš„æ»šåŠ¨è·ç¦»

// æ€»åˆ—è¡¨é«˜åº¦ï¼ˆæ’‘å¼€æ»šåŠ¨æ¡ç”¨ï¼‰
const totalHeight = computed(() =&gt; ListData.value.length * ITEM_HEIGHT);

// å¯è§†åŒºåŸŸé«˜åº¦ï¼ˆæ»šåŠ¨å®¹å™¨çš„é«˜åº¦ï¼‰
const viewportHeight = computed(() =&gt; {
  return virtualListRef.value?.clientHeight || 0;
});

// å¯è§†åŒºåŸŸå¯æ˜¾ç¤ºçš„åˆ—è¡¨é¡¹æ•°é‡ï¼ˆå‘ä¸Šå–æ•´ + ç¼“å†²åŒºï¼‰
const visibleCount = computed(() =&gt; {
  return Math.ceil(viewportHeight.value / ITEM_HEIGHT) + BUFFER;
});

// å½“å‰æ˜¾ç¤ºçš„èµ·å§‹ç´¢å¼•
const startIndex = computed(() =&gt; {
  // æ»šåŠ¨è·ç¦» / æ¯é¡¹é«˜åº¦ = è·³è¿‡çš„é¡¹æ•°ï¼ˆå‘ä¸‹å–æ•´ï¼‰
  const index = Math.floor(scrollTop.value / ITEM_HEIGHT);
  // é˜²æ­¢ç´¢å¼•ä¸ºè´Ÿæ•°
  return Math.max(0, index);
});

// å½“å‰æ˜¾ç¤ºçš„ç»“æŸç´¢å¼•
const endIndex = computed(() =&gt; {
  const end = startIndex.value + visibleCount.value;
  // é˜²æ­¢è¶…å‡ºæ€»æ•°æ®é•¿åº¦
  return Math.min(end, ListData.value.length);
});

// å¯è§†åŒºåŸŸéœ€è¦æ¸²æŸ“çš„åˆ—è¡¨æ•°æ®
const visibleList = computed(() =&gt; {
  return ListData.value.slice(startIndex.value, endIndex.value);
});

// å¯è§†åŒºåŸŸçš„åç§»é‡ï¼ˆè®©åˆ—è¡¨é¡¹å®šä½åˆ°æ­£ç¡®ä½ç½®ï¼‰
const offsetY = computed(() =&gt; {
  return startIndex.value * ITEM_HEIGHT;
});

// å¤„ç†æ»šåŠ¨äº‹ä»¶
const handleScroll = () =&gt; {
  if (virtualListRef.value) {
    scrollTop.value = virtualListRef.value.scrollTop;
  }
};

// è¿”å›é¦–é¡µ
const goBack = () =&gt; {
  router.push('/home');
};

// åˆå§‹åŒ–
onMounted(() =&gt; {
  // ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
  ListData.value = Array.from({ length: 1000 }, (_, index) =&gt; ({
    id: index,
    name: `Item ${index}`,
  }));
});
&lt;/script&gt;

</code></pre>
<h3 data-id="heading-5">3. å®ç°æ•ˆæœå›¾</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0aeb589869424d08be07ff8183e5af9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771040975&amp;x-signature=83d1HWo%2Fzcfl0pbpVr8sTUG%2Bd4g%3D" alt="å®šé«˜è™šæ‹Ÿåˆ—è¡¨æ»šåŠ¨.gif" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-6">ä¸‰ã€ è¿›é˜¶ï¼šä¸å®šé«˜ï¼ˆåŠ¨æ€é«˜åº¦ï¼‰è™šæ‹Ÿåˆ—è¡¨</h2>
<p>åœ¨å®é™…ä¸šåŠ¡ï¼ˆå¦‚ç¤¾äº¤åŠ¨æ€ã€èŠå¤©è®°å½•ï¼‰ä¸­ï¼Œæ¯ä¸ª Item çš„é«˜åº¦å¾€å¾€æ˜¯ä¸å›ºå®šçš„ã€‚</p>
<h3 data-id="heading-7">1. æ ¸å¿ƒæ”¹è¿›æ€è·¯</h3>
<ul>
<li><strong>é«˜åº¦æ˜ å°„è¡¨ï¼ˆMapï¼‰</strong> ï¼šè®°å½•æ¯ä¸€ä¸ª Item æ¸²æŸ“åçš„çœŸå®é«˜åº¦ã€‚</li>
<li><strong>ç´¯è®¡é«˜åº¦æ•°ç»„ï¼ˆCumulative Heightsï¼‰</strong> ï¼šå­˜å‚¨æ¯ä¸€é¡¹ç›¸å¯¹äºé¡¶éƒ¨çš„åç§»ä½ç½®ã€‚</li>
<li><strong>ResizeObserver</strong>ï¼šåˆ©ç”¨è¯¥ API ç›‘å¬å­ç»„ä»¶é«˜åº¦å˜åŒ–ï¼Œå®æ—¶æ›´æ–°æ˜ å°„è¡¨ï¼Œè§£å†³å›¾ç‰‡åŠ è½½æˆ–æ–‡æœ¬æŠ˜è¡Œå¯¼è‡´çš„ä½ç§»ã€‚</li>
</ul>
<h3 data-id="heading-8">2. Vue 3 + tailwindCSS å®ç°ï¼ˆå­ç»„ä»¶æŠ½ç¦»ï¼‰</h3>
<p><strong>å­ç»„ä»¶</strong>ï¼š è´Ÿè´£ä¸ŠæŠ¥çœŸå®é«˜åº¦ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div
    ref="itemRef"
    class="py-2 px-4 border-b border-gray-200"
    :class="{
      'bg-pink-200': item.id % 2 !== 0,
      'bg-green-200': item.id % 2 === 0,
    }"
    :style="{ height: item.id % 2 === 0 ? '150px' : '100px' }"
  &gt;
    {{ item.name }}
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { ref, onMounted, onUpdated, onUnmounted, watch, nextTick } from 'vue';

// å®šä¹‰propsï¼šæ¥æ”¶çˆ¶ç»„ä»¶ä¼ é€’çš„itemæ•°æ®
const props = defineProps&lt;{
  item: {
    id: number;
    name: string;
  };
}&gt;();

// å®šä¹‰emitï¼šå‘çˆ¶ç»„ä»¶ä¼ é€’é«˜åº¦æ›´æ–°äº‹ä»¶
const emit = defineEmits&lt;{
  (e: 'update-height', id: number, height: number): void;
}&gt;();

const itemRef = ref&lt;HTMLDivElement | null&gt;(null);
let resizeObserver: ResizeObserver | null = null;

// è®¡ç®—å¹¶å‘é€å½“å‰ç»„ä»¶çš„é«˜åº¦
const sendItemHeight = () =&gt; {
  if (!itemRef.value) return;
  const realHeight = itemRef.value.offsetHeight;
  emit('update-height', props.item.id, realHeight);
};

// ç›‘å¬ç»„ä»¶æŒ‚è½½ï¼šé¦–æ¬¡å‘é€é«˜åº¦ + ç›‘å¬é«˜åº¦å˜åŒ–
onMounted(() =&gt; {
  // é¦–æ¬¡æ¸²æŸ“å®Œæˆåå‘é€é«˜åº¦
  nextTick(() =&gt; {
    sendItemHeight();
  });

  // ç›‘å¬å…ƒç´ é«˜åº¦å˜åŒ–ï¼ˆé€‚é…åŠ¨æ€å†…å®¹å¯¼è‡´çš„é«˜åº¦å˜åŒ–ï¼‰
  if (window.ResizeObserver) {
    resizeObserver = new ResizeObserver(() =&gt; {
      sendItemHeight();
    });
    if (itemRef.value) {
      resizeObserver.observe(itemRef.value);
    }
  }
});

// ç»„ä»¶æ›´æ–°åé‡æ–°å‘é€é«˜åº¦ï¼ˆæ¯”å¦‚å†…å®¹å˜åŒ–ï¼‰
onUpdated(() =&gt; {
  nextTick(() =&gt; {
    sendItemHeight();
  });
});

// ç»„ä»¶å¸è½½ï¼šæ¸…ç†ç›‘å¬
onUnmounted(() =&gt; {
  if (resizeObserver) {
    resizeObserver.disconnect();
    resizeObserver = null;
  }
});

// ç›‘å¬itemå˜åŒ–ï¼šå¦‚æœitemæ›¿æ¢ï¼Œé‡æ–°è®¡ç®—é«˜åº¦
watch(
  () =&gt; props.item.id,
  () =&gt; {
    nextTick(() =&gt; {
      sendItemHeight();
    });
  }
);
&lt;/script&gt;

</code></pre>
<p><strong>çˆ¶ç»„ä»¶</strong>ï¼šæ ¸å¿ƒé€»è¾‘</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div
    class="min-h-screen bg-gradient-to-br from-indigo-600 to-purple-600 py-10 px-5"
  &gt;
    &lt;div class="bg-white mt-20 h-[calc(100vh-200px)] rounded-xl"&gt;
      &lt;!-- æ»šåŠ¨å®¹å™¨ --&gt;
      &lt;div
        ref="virtualListRef"
        class="h-full overflow-auto relative"
        @scroll="handleScroll"
      &gt;
        &lt;!-- å ä½å®¹å™¨ï¼šæ’‘å¼€æ»šåŠ¨æ¡ --&gt;
        &lt;div :style="{ height: `${totalHeight}px` }"&gt;&lt;/div&gt;

        &lt;!-- å¯è§†åŒºåŸŸåˆ—è¡¨ --&gt;
        &lt;div
          class="absolute top-0 left-0 right-0"
          :style="{ transform: `translateY(${offsetY}px)` }"
        &gt;
          &lt;!-- æ¸²æŸ“å­ç»„ä»¶ï¼Œç›‘å¬é«˜åº¦æ›´æ–°äº‹ä»¶ --&gt;
          &lt;VirtualListItem
            v-for="item in visibleList"
            :key="item.id"
            :item="item"
            @update-height="handleItemHeightUpdate"
          /&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div
      class="fixed top-2 left-24 -translate-x-1/2 px-8 py-3 bg-white text-indigo-600 rounded-full text-base font-semibold cursor-pointer shadow-lg transition-all duration-300 hover:-translate-x-1/2 hover:-translate-y-0.5 hover:shadow-2xl"
      @click="goBack"
    &gt;
      â† è¿”å›é¦–é¡µ
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { ref, onMounted, computed, onUnmounted, nextTick } from 'vue';
import { useRouter } from 'vue-router';
import VirtualListItem from './listItem.vue'; // å¼•å…¥å­ç»„ä»¶

const router = useRouter();

const MIN_ITEM_HEIGHT = 100; // å­é¡¹é¢„è®¾çš„æœ€å°é«˜åº¦
const BUFFER = 5; //ä¸Šä¸‹ç¼“å†²åŒºæ•°ç›®
const virtualListRef = ref&lt;HTMLDivElement | null&gt;(null); // æ»šåŠ¨å®¹å™¨å¼•ç”¨

const ListData = ref&lt;any[]&gt;([]); // å®Œæ•´åˆ—è¡¨æ•°æ®
const scrollTop = ref(0); // æ»šåŠ¨è·ç¦»
const itemHeights = ref&lt;Map&lt;number, number&gt;&gt;(new Map()); // å­ç»„ä»¶é«˜åº¦æ˜ å°„è¡¨
const cumulativeHeights = ref&lt;number[]&gt;([0]); // ç´¯è®¡é«˜åº¦æ•°ç»„
const scrollTimer = ref&lt;number | null&gt;(null); // æ»šåŠ¨èŠ‚æµå®šæ—¶å™¨
const isUpdatingCumulative = ref(false); // ç´¯è®¡é«˜åº¦æ›´æ–°é˜²æŠ–

// åˆå§‹åŒ–ä½ç½®æ•°æ®
const initPositionData = () =&gt; {
  // åˆå§‹åŒ–é«˜åº¦æ˜ å°„è¡¨ï¼ˆé»˜è®¤æœ€å°é«˜åº¦ï¼‰
  const heightMap = new Map&lt;number, number&gt;();
  ListData.value.forEach((item) =&gt; {
    heightMap.set(item.id, MIN_ITEM_HEIGHT);
  });
  // åˆå§‹åŒ–ç´¯è®¡é«˜åº¦
  updateCumulativeHeights();
};

// æ›´æ–°ç´¯è®¡é«˜åº¦ï¼ˆæ ¸å¿ƒï¼‰
const updateCumulativeHeights = () =&gt; {
  if (isUpdatingCumulative.value) return;
  isUpdatingCumulative.value = true;

  const itemCount = ListData.value.length;
  const cumulative = [0];
  let sum = 0;

  for (let i = 0; i &lt; itemCount; i++) {
    const itemId = ListData.value[i].id;
    sum += itemHeights.value.get(itemId) || MIN_ITEM_HEIGHT;
    cumulative.push(sum);
  }

  cumulativeHeights.value = cumulative;
  isUpdatingCumulative.value = false;
};

// å¤„ç†å­ç»„ä»¶çš„é«˜åº¦æ›´æ–°äº‹ä»¶
const handleItemHeightUpdate = (id: number, height: number) =&gt; {
  // é«˜åº¦æœªå˜åŒ–åˆ™è·³è¿‡
  if (itemHeights.value.get(id) === height) return;

  // æ›´æ–°é«˜åº¦æ˜ å°„è¡¨
  itemHeights.value.set(id, height);

  // å¼‚æ­¥æ›´æ–°ç´¯è®¡é«˜åº¦ï¼ˆé¿å…åŒæ­¥æ›´æ–°å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ï¼‰
  nextTick(() =&gt; {
    updateCumulativeHeights();
  });
};

// æ€»é«˜åº¦ï¼Œæ ¹æ®ç»Ÿè®¡é«˜åº¦æ•°ç»„æœ€åä¸€ä¸ªå€¼è®¡ç®—å¾—å‡º
const totalHeight = computed(() =&gt; {
  return cumulativeHeights.value[cumulativeHeights.value.length - 1] || 0;
});

// åˆ—è¡¨å¯è§†åŒºåŸŸé«˜åº¦
const viewportHeight = computed(() =&gt; {
  return virtualListRef.value?.clientHeight || MIN_ITEM_HEIGHT * 5;
});

// è®¡ç®—èµ·å§‹ç´¢å¼•
const startIndex = computed(() =&gt; {
  const totalItemCount = ListData.value.length;
  if (totalItemCount === 0) return 0;
  if (scrollTop.value &lt;= 0) return 0;

  let baseStartIndex = 0;
  // åå‘éå†æ‰¾èµ·å§‹ç´¢å¼•
  for (let i = cumulativeHeights.value.length - 1; i &gt;= 0; i--) {
    if (cumulativeHeights.value[i] &lt;= scrollTop.value) {
      baseStartIndex = i;
      break;
    }
  }
  const finalIndex = Math.max(0, baseStartIndex - BUFFER); // ç¡®ä¿ä¸å°äº0
  return Math.min(finalIndex, totalItemCount - 1);
});

// è®¡ç®—ç»“æŸç´¢å¼•
const endIndex = computed(() =&gt; {
  const totalItemCount = ListData.value.length;
  const viewportHeightVal = viewportHeight.value;
  if (totalItemCount === 0) return 0;

  const targetScrollBottom = scrollTop.value + viewportHeightVal; // ç›®æ ‡æ»šåŠ¨åˆ°åº•éƒ¨ä½ç½®
  let baseEndIndex = totalItemCount - 1;
  for (let i = 0; i &lt; cumulativeHeights.value.length; i++) {
    if (cumulativeHeights.value[i] &gt; targetScrollBottom) {
      baseEndIndex = i - 1;
      break;
    }
  }
  const finalEndIndex = Math.min(baseEndIndex + BUFFER, totalItemCount - 1); // ç¡®ä¿ä¸å¤§äºæ€»é¡¹æ•°-1
  return finalEndIndex;
});

// å¯è§åˆ—è¡¨
const visibleList = computed(() =&gt; {
  const start = startIndex.value;
  const end = endIndex.value;
  return start &lt;= end ? ListData.value.slice(start, end + 1) : [];
});

const offsetY = computed(() =&gt; {
  return cumulativeHeights.value[startIndex.value] || 0;
});

// æ»šåŠ¨èŠ‚æµå¤„ç†
const handleScroll = () =&gt; {
  if (!virtualListRef.value) return;

  if (scrollTimer.value) clearTimeout(scrollTimer.value);
  scrollTimer.value = window.setTimeout(() =&gt; {
    scrollTop.value = virtualListRef.value!.scrollTop;
  }, 20);
};

const handleResize = () =&gt; {
  if (virtualListRef.value) {
    scrollTop.value = virtualListRef.value.scrollTop;
  }
};

const goBack = () =&gt; {
  router.push('/home');
};

// ç”Ÿå‘½å‘¨æœŸ
onMounted(() =&gt; {
  // ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
  ListData.value = Array.from({ length: 1000 }, (_, index) =&gt; ({
    id: index,
    name: `Item ${index}`,
  }));
  initPositionData();
  window.addEventListener('resize', handleResize); // ç›‘å¬çª—å£å¤§å°å˜åŒ–
});

onUnmounted(() =&gt; {
  window.removeEventListener('resize', handleResize);
  if (scrollTimer.value) clearTimeout(scrollTimer.value);
  isUpdatingCumulative.value = false;
  itemHeights.value.clear();
});
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-9">3. React + tailwindCSS å®ç°ï¼ˆå­ç»„ä»¶æŠ½ç¦»ï¼‰</h3>
<p><strong>å­ç»„ä»¶ï¼š</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useEffect, useRef, useState, useCallback } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">VirtualListItemProps</span> {
  <span class="hljs-attr">item</span>: {
    <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  };
  <span class="hljs-attr">onUpdateHeight</span>: <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">number</span>, height: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>; <span class="hljs-comment">// æ›¿ä»£ Vue çš„ emit</span>
}

<span class="hljs-keyword">const</span> <span class="hljs-title class_">VirtualListItem</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;<span class="hljs-title class_">VirtualListItemProps</span>&gt; = <span class="hljs-function">(<span class="hljs-params">{
  item,
  onUpdateHeight,
}</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> itemRef = useRef&lt;<span class="hljs-title class_">HTMLDivElement</span>&gt;(<span class="hljs-literal">null</span>);
  <span class="hljs-comment">// å­˜å‚¨ ResizeObserver å®ä¾‹ï¼ˆé¿å…é‡å¤åˆ›å»ºï¼‰</span>
  <span class="hljs-keyword">const</span> resizeObserverRef = useRef&lt;<span class="hljs-title class_">ResizeObserver</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);

  <span class="hljs-comment">// è®¡ç®—å¹¶ä¸ŠæŠ¥é«˜åº¦</span>
  <span class="hljs-keyword">const</span> sendItemHeight = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (!itemRef.<span class="hljs-property">current</span>) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">const</span> realHeight = itemRef.<span class="hljs-property">current</span>.<span class="hljs-property">offsetHeight</span>;
    <span class="hljs-title function_">onUpdateHeight</span>(item.<span class="hljs-property">id</span>, realHeight);
  }, [item.<span class="hljs-property">id</span>, onUpdateHeight]);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">sendItemHeight</span>();
    }, <span class="hljs-number">0</span>);

    <span class="hljs-comment">// åˆå§‹åŒ– ResizeObserver ç›‘å¬é«˜åº¦å˜åŒ–</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">ResizeObserver</span>) {
      resizeObserverRef.<span class="hljs-property">current</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResizeObserver</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">sendItemHeight</span>();
      });
      <span class="hljs-keyword">if</span> (itemRef.<span class="hljs-property">current</span>) {
        resizeObserverRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">observe</span>(itemRef.<span class="hljs-property">current</span>);
      }
    }

    <span class="hljs-comment">// æ¸…ç†å®šæ—¶å™¨ï¼ˆå¯¹åº” Vue çš„ onUnmounted éƒ¨åˆ†ï¼‰</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-built_in">clearTimeout</span>(timer);
      <span class="hljs-keyword">if</span> (resizeObserverRef.<span class="hljs-property">current</span>) {
        resizeObserverRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">disconnect</span>();
        resizeObserverRef.<span class="hljs-property">current</span> = <span class="hljs-literal">null</span>;
      }
    };
  }, [sendItemHeight]); <span class="hljs-comment">// ä»…é¦–æ¬¡æŒ‚è½½æ‰§è¡Œ</span>

  <span class="hljs-comment">//ç›‘å¬ item å˜åŒ–é‡æ–°è®¡ç®—é«˜åº¦</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">sendItemHeight</span>();
    }, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearTimeout</span>(timer);
  }, [item.<span class="hljs-property">id</span>, sendItemHeight]); <span class="hljs-comment">// item.id å˜åŒ–æ—¶æ‰§è¡Œ</span>

  <span class="hljs-keyword">const</span> itemClass = <span class="hljs-string">`py-2 px-4 border-b border-gray-200 <span class="hljs-subst">${
    item.id % <span class="hljs-number">2</span> !== <span class="hljs-number">0</span> ? <span class="hljs-string">'bg-pink-200'</span> : <span class="hljs-string">'bg-green-200'</span>
  }</span>`</span>;

  <span class="hljs-keyword">const</span> <span class="hljs-attr">itemStyle</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">CSSProperties</span> = {
    <span class="hljs-attr">height</span>: item.<span class="hljs-property">id</span> % <span class="hljs-number">2</span> === <span class="hljs-number">0</span> ? <span class="hljs-string">'150px'</span> : <span class="hljs-string">'100px'</span>,
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{itemRef}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{itemClass}</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{itemStyle}</span>&gt;</span>
      {item.name}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">VirtualListItem</span>;


</code></pre>
<p><strong>çˆ¶ç»„ä»¶ï¼š</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, {
  useEffect,
  useRef,
  useState,
  useCallback,
  useMemo,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">VirtualListItem</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./listItem'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">VirtualList</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span> = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">MIN_ITEM_HEIGHT</span> = <span class="hljs-number">100</span>; <span class="hljs-comment">// æœ€å°é¡¹é«˜åº¦</span>
  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">BUFFER</span> = <span class="hljs-number">5</span>; <span class="hljs-comment">// ç¼“å†²åŒºé¡¹æ•°</span>

  <span class="hljs-keyword">const</span> virtualListRef = useRef&lt;<span class="hljs-title class_">HTMLDivElement</span>&gt;(<span class="hljs-literal">null</span>); <span class="hljs-comment">// è™šæ‹Ÿåˆ—è¡¨å®¹å™¨å¼•ç”¨</span>

  <span class="hljs-keyword">const</span> [listData, setListData] = useState&lt;<span class="hljs-title class_">Array</span>&lt;{ <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> }&gt;&gt;(
    []
  ); <span class="hljs-comment">// åˆ—è¡¨æ•°æ®</span>
  <span class="hljs-keyword">const</span> [scrollTop, setScrollTop] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// æ»šåŠ¨ä½ç½®</span>
  <span class="hljs-keyword">const</span> [itemHeights, setItemHeights] = useState&lt;<span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>&gt;&gt;(
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()
  ); <span class="hljs-comment">// é«˜åº¦æ˜ å°„è¡¨ï¼ˆMap ç»“æ„ï¼‰</span>
  <span class="hljs-keyword">const</span> [cumulativeHeights, setCumulativeHeights] = useState&lt;<span class="hljs-built_in">number</span>[]&gt;([<span class="hljs-number">0</span>]); <span class="hljs-comment">// ç´¯è®¡é«˜åº¦æ•°ç»„</span>
  <span class="hljs-keyword">const</span> scrollTimerRef = useRef&lt;<span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>); <span class="hljs-comment">// æ»šåŠ¨èŠ‚æµå®šæ—¶å™¨</span>

  <span class="hljs-comment">// åˆå§‹åŒ–æ¨¡æ‹Ÿæ•°æ®</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">initData</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">const</span> mockData = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">1000</span> }, <span class="hljs-function">(<span class="hljs-params">_, index</span>) =&gt;</span> ({
      <span class="hljs-attr">id</span>: index,
      <span class="hljs-attr">name</span>: <span class="hljs-string">`Item <span class="hljs-subst">${index}</span>`</span>,
    }));
    <span class="hljs-title function_">setListData</span>(mockData);
    <span class="hljs-comment">// åˆå§‹åŒ–é«˜åº¦æ˜ å°„è¡¨ï¼ˆé»˜è®¤æœ€å°é«˜åº¦ï¼‰</span>
    <span class="hljs-keyword">const</span> initHeightMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>&gt;();
    mockData.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {
      initHeightMap.<span class="hljs-title function_">set</span>(item.<span class="hljs-property">id</span>, <span class="hljs-variable constant_">MIN_ITEM_HEIGHT</span>);
    });
    <span class="hljs-title function_">setItemHeights</span>(initHeightMap);
    <span class="hljs-comment">// åˆå§‹åŒ–ç´¯è®¡é«˜åº¦</span>
    <span class="hljs-title function_">updateCumulativeHeights</span>(initHeightMap, mockData);
  };

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">initData</span>();
    <span class="hljs-comment">// ç›‘å¬çª—å£å¤§å°å˜åŒ–</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleResize</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-keyword">if</span> (virtualListRef.<span class="hljs-property">current</span>) {
        <span class="hljs-title function_">setScrollTop</span>(virtualListRef.<span class="hljs-property">current</span>.<span class="hljs-property">scrollTop</span>);
      }
    };
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, handleResize);

    <span class="hljs-comment">// æ¸…ç†ç›‘å¬</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'resize'</span>, handleResize);
      <span class="hljs-keyword">if</span> (scrollTimerRef.<span class="hljs-property">current</span>) {
        <span class="hljs-built_in">clearTimeout</span>(scrollTimerRef.<span class="hljs-property">current</span>);
      }
      itemHeights.<span class="hljs-title function_">clear</span>(); <span class="hljs-comment">// æ¸…ç©º Map é‡Šæ”¾å†…å­˜</span>
    };
  }, []);

  <span class="hljs-comment">// æ›´æ–°ç´¯è®¡é«˜åº¦ï¼ˆæ ¸å¿ƒå‡½æ•°ï¼‰</span>
  <span class="hljs-keyword">const</span> updateCumulativeHeights = <span class="hljs-title function_">useCallback</span>(
    <span class="hljs-function">(<span class="hljs-params">heightMap: <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>&gt;, data: <span class="hljs-keyword">typeof</span> listData</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> cumulative = [<span class="hljs-number">0</span>];
      <span class="hljs-keyword">let</span> sum = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; data.<span class="hljs-property">length</span>; i++) {
        <span class="hljs-keyword">const</span> itemId = data[i].<span class="hljs-property">id</span>;
        sum += heightMap.<span class="hljs-title function_">get</span>(itemId) || <span class="hljs-variable constant_">MIN_ITEM_HEIGHT</span>;
        cumulative.<span class="hljs-title function_">push</span>(sum);
      }
      <span class="hljs-title function_">setCumulativeHeights</span>(cumulative);
    },
    [<span class="hljs-variable constant_">MIN_ITEM_HEIGHT</span>]
  );

  <span class="hljs-comment">// å¤„ç†å­ç»„ä»¶çš„é«˜åº¦æ›´æ–°äº‹ä»¶ï¼ˆå¯¹åº” Vue çš„ handleItemHeightUpdateï¼‰</span>
  <span class="hljs-keyword">const</span> handleItemHeightUpdate = <span class="hljs-title function_">useCallback</span>(
    <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">number</span>, height: <span class="hljs-built_in">number</span></span>) =&gt;</span> {
      <span class="hljs-comment">// é«˜åº¦æœªå˜åŒ–åˆ™è·³è¿‡</span>
      <span class="hljs-keyword">if</span> (itemHeights.<span class="hljs-title function_">get</span>(id) === height) <span class="hljs-keyword">return</span>;

      <span class="hljs-comment">// æ›´æ–°é«˜åº¦æ˜ å°„è¡¨</span>
      <span class="hljs-keyword">const</span> newHeightMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(itemHeights);
      newHeightMap.<span class="hljs-title function_">set</span>(id, height);
      <span class="hljs-title function_">setItemHeights</span>(newHeightMap);

      <span class="hljs-comment">// å¼‚æ­¥æ›´æ–°ç´¯è®¡é«˜åº¦</span>
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">updateCumulativeHeights</span>(newHeightMap, listData);
      }, <span class="hljs-number">0</span>);
    },
    [itemHeights, listData, updateCumulativeHeights]
  );

  <span class="hljs-comment">// æ»šåŠ¨èŠ‚æµå¤„ç†</span>
  <span class="hljs-keyword">const</span> handleScroll = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (!virtualListRef.<span class="hljs-property">current</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-comment">// èŠ‚æµï¼š20ms å†…åªæ›´æ–°ä¸€æ¬¡ scrollTop</span>
    <span class="hljs-keyword">if</span> (scrollTimerRef.<span class="hljs-property">current</span>) {
      <span class="hljs-built_in">clearTimeout</span>(scrollTimerRef.<span class="hljs-property">current</span>);
    }
    scrollTimerRef.<span class="hljs-property">current</span> = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">setScrollTop</span>(virtualListRef.<span class="hljs-property">current</span>!.<span class="hljs-property">scrollTop</span>);
    }, <span class="hljs-number">20</span>);
  }, []);

  <span class="hljs-comment">// å¯è§†åŒºåŸŸé«˜åº¦</span>
  <span class="hljs-keyword">const</span> viewportHeight = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> virtualListRef.<span class="hljs-property">current</span>?.<span class="hljs-property">clientHeight</span> || <span class="hljs-variable constant_">MIN_ITEM_HEIGHT</span> * <span class="hljs-number">5</span>;
  }, []);

  <span class="hljs-comment">//  æ€»åˆ—è¡¨é«˜åº¦</span>
  <span class="hljs-keyword">const</span> totalHeight = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> cumulativeHeights[cumulativeHeights.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>] || <span class="hljs-number">0</span>;
  }, [cumulativeHeights]);

  <span class="hljs-comment">// èµ·å§‹ç´¢å¼•</span>
  <span class="hljs-keyword">const</span> startIndex = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> totalItemCount = listData.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">if</span> (totalItemCount === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span> (scrollTop &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;

    <span class="hljs-comment">// åå‘éå†æ‰¾èµ·å§‹ç´¢å¼•</span>
    <span class="hljs-keyword">let</span> baseStartIndex = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = cumulativeHeights.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
      <span class="hljs-keyword">if</span> (cumulativeHeights[i] &lt;= scrollTop) {
        baseStartIndex = i;
        <span class="hljs-keyword">break</span>;
      }
    }

    <span class="hljs-keyword">const</span> finalIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, baseStartIndex - <span class="hljs-variable constant_">BUFFER</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(finalIndex, totalItemCount - <span class="hljs-number">1</span>);
  }, [
    scrollTop,
    viewportHeight,
    totalHeight,
    cumulativeHeights,
    listData.<span class="hljs-property">length</span>,
  ]);

  <span class="hljs-comment">// ç»“æŸç´¢å¼•</span>
  <span class="hljs-keyword">const</span> endIndex = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> totalItemCount = listData.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">if</span> (totalItemCount === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;

    <span class="hljs-keyword">const</span> targetScrollBottom = scrollTop + viewportHeight;
    <span class="hljs-keyword">let</span> baseEndIndex = totalItemCount - <span class="hljs-number">1</span>;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; cumulativeHeights.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-keyword">if</span> (cumulativeHeights[i] &gt; targetScrollBottom) {
        baseEndIndex = i - <span class="hljs-number">1</span>;
        <span class="hljs-keyword">break</span>;
      }
    }

    <span class="hljs-keyword">let</span> finalEndIndex = baseEndIndex + <span class="hljs-variable constant_">BUFFER</span>;
    finalEndIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(finalEndIndex, totalItemCount - <span class="hljs-number">1</span>);
    <span class="hljs-keyword">return</span> finalEndIndex;
  }, [scrollTop, viewportHeight, cumulativeHeights, listData.<span class="hljs-property">length</span>]);

  <span class="hljs-comment">// å¯è§†åŒºåˆ—è¡¨</span>
  <span class="hljs-keyword">const</span> visibleList = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> startIndex &lt;= endIndex
      ? listData.<span class="hljs-title function_">slice</span>(startIndex, endIndex + <span class="hljs-number">1</span>)
      : [];
  }, [startIndex, endIndex, listData]);

  <span class="hljs-comment">// åç§»é‡</span>
  <span class="hljs-keyword">const</span> offsetY = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> cumulativeHeights[startIndex] || <span class="hljs-number">0</span>;
  }, [startIndex, cumulativeHeights]);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"h-full bg-gradient-to-br from-indigo-600 to-purple-600 py-10 px-5"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"bg-white mt-10 h-[calc(100vh-200px)] rounded-xl"</span>&gt;</span>
        {/* æ»šåŠ¨å®¹å™¨ */}
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
          <span class="hljs-attr">ref</span>=<span class="hljs-string">{virtualListRef}</span>
          <span class="hljs-attr">className</span>=<span class="hljs-string">"h-full overflow-auto relative"</span>
          <span class="hljs-attr">onScroll</span>=<span class="hljs-string">{handleScroll}</span>
        &gt;</span>
          {/* å ä½å®¹å™¨ï¼šæ’‘å¼€æ»šåŠ¨æ¡ */}
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">height:</span> `${<span class="hljs-attr">totalHeight</span>}<span class="hljs-attr">px</span>` }}&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

          {/* å¯è§†åŒºåŸŸåˆ—è¡¨ï¼štransform åç§» */}
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
            <span class="hljs-attr">className</span>=<span class="hljs-string">"absolute top-0 left-0 right-0"</span>
            <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">transform:</span> `<span class="hljs-attr">translateY</span>(${<span class="hljs-attr">offsetY</span>}<span class="hljs-attr">px</span>)` }}
          &gt;</span>
            {visibleList.map((item) =&gt; (
              <span class="hljs-tag">&lt;<span class="hljs-name">VirtualListItem</span>
                <span class="hljs-attr">key</span>=<span class="hljs-string">{item.id}</span>
                <span class="hljs-attr">item</span>=<span class="hljs-string">{item}</span>
                <span class="hljs-attr">onUpdateHeight</span>=<span class="hljs-string">{handleItemHeightUpdate}</span>
              /&gt;</span>
            ))}
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">VirtualList</span>;

</code></pre>
<h3 data-id="heading-10">4. å®ç°æ•ˆæœå›¾</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f94fc95662c463caed332ed77b1d3c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771040975&amp;x-signature=SGyg1H2pDISwd9X9leROtXl7YlA%3D" alt="åŠ¨é«˜è™šæ‹Ÿåˆ—è¡¨æ»šåŠ¨.gif" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-11">å››ã€ æ€»ç»“ä¸é¿å‘æŒ‡å—</h2>
<h3 data-id="heading-12">1. ä¸ºä»€ä¹ˆéœ€è¦ç¼“å†²åŒºï¼ˆBUFFERï¼‰ï¼Ÿ</h3>
<p>å¦‚æœåªæ¸²æŸ“å¯è§éƒ¨åˆ†ï¼Œç”¨æˆ·å¿«é€Ÿæ»šåŠ¨æ—¶ï¼Œå¼‚æ­¥æ¸²æŸ“å¯èƒ½ä¼šå¯¼è‡´ç¬é—´çš„â€œç™½å±â€ã€‚è®¾ç½®ä¸Šä¸‹ç¼“å†²åŒºå¯ä»¥é¢„åŠ è½½éƒ¨åˆ† DOMï¼Œè®©æ»‘åŠ¨æ›´é¡ºæ»‘ã€‚</p>
<h3 data-id="heading-13">2. æ€§èƒ½è¿›ä¸€æ­¥ä¼˜åŒ–</h3>
<ul>
<li><strong>æ»šåŠ¨èŠ‚æµï¼ˆThrottleï¼‰</strong> ï¼šè™½ç„¶æ»šåŠ¨ç›‘å¬å¾ˆå¿«ï¼Œä½†åœ¨ <code>handleScroll</code> ä¸­åŠ å…¥ <code>requestAnimationFrame</code> æˆ– 20ms çš„èŠ‚æµï¼Œèƒ½æœ‰æ•ˆå‡è½»ä¸»çº¿ç¨‹å‹åŠ›ã€‚</li>
<li><strong>Key çš„é€‰æ‹©</strong>ï¼šåœ¨è™šæ‹Ÿåˆ—è¡¨ä¸­ï¼Œ<code>key</code> å¿…é¡»æ˜¯å”¯ä¸€çš„ <code>id</code>ï¼Œç»å¯¹ä¸èƒ½ä½¿ç”¨ <code>index</code>ï¼Œå¦åˆ™åœ¨æ»šåŠ¨é‡ç”¨ DOM æ—¶ä¼šå‡ºç°çŠ¶æ€é”™ä¹±ã€‚</li>
</ul>
<h3 data-id="heading-14">3. æ³¨æ„äº‹é¡¹</h3>
<ul>
<li><strong>å®šé«˜</strong>ï¼šé€»è¾‘ç®€å•ï¼Œæ€§èƒ½æé«˜ã€‚</li>
<li><strong>ä¸å®šé«˜</strong>ï¼šä¾èµ– <code>ResizeObserver</code>ï¼Œéœ€æ³¨æ„é¢‘ç¹é‡æ’å¯¹æ€§èƒ½çš„å½±å“ï¼Œå»ºè®®å¯¹ <code>updateCumulativeHeights</code> åšå¼‚æ­¥æ‰¹å¤„ç†ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»Vueåˆ°Bevyä¸Nestjsï¼šæˆ‘ä¸º Vue æ„å»ºäº†ä¸€å¥—â€œæ— å¤´â€ä¸šåŠ¡å¼•æ“]]></title>    <link>https://juejin.cn/post/7603563360329482282</link>    <guid>https://juejin.cn/post/7603563360329482282</guid>    <pubDate>2026-02-06T15:21:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603563360329482282" data-draft-id="7603563317040529471" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»Vueåˆ°Bevyä¸Nestjsï¼šæˆ‘ä¸º Vue æ„å»ºäº†ä¸€å¥—â€œæ— å¤´â€ä¸šåŠ¡å¼•æ“"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-06T15:21:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ArisuYuki"/> <meta itemprop="url" content="https://juejin.cn/user/3727757354470171"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»Vueåˆ°Bevyä¸Nestjsï¼šæˆ‘ä¸º Vue æ„å»ºäº†ä¸€å¥—â€œæ— å¤´â€ä¸šåŠ¡å¼•æ“
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3727757354470171/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ArisuYuki
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T15:21:06.000Z" title="Fri Feb 06 2026 15:21:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä¸çŸ¥é“å¤§å®¶æ˜¯å¦è§è¿‡é‚£ç§åŠ¨è¾„å‡ åƒè¡Œã€é€»è¾‘åƒä¹±éº»ä¸€æ ·ç¼ ç»•çš„ <code>.vue</code> æ–‡ä»¶ï¼Ÿ</p>
<p>ç¬”è€…åœ¨è®¸å¤šå¼€æºé¡¹ç›®å’Œä¼ä¸šçº§é¡¹ç›®é‡Œéƒ½è§è¿‡ç±»ä¼¼çš„ç°è±¡ï¼šå„ç§ <code>watch</code> äº’ç›¸å¥—å¨ƒã€ç”Ÿå‘½å‘¨æœŸé‡Œå¡æ»¡å¼‚æ­¥é€»è¾‘ã€çˆ¶å­ç»„ä»¶ä¼ å€¼ä¼ åˆ°æ€€ç–‘äººç”Ÿã€‚å½“é¡¹ç›®è¿›å…¥ä¸­åæœŸï¼ŒVue çš„å“åº”å¼ç³»ç»Ÿä»¿ä½›ä»â€˜åˆ©å™¨â€™å˜æˆäº†â€˜è¯…å’’â€™ï¼Œæ¯ä¸€è¡Œä»£ç çš„æ”¹åŠ¨éƒ½åƒæ˜¯åœ¨ç©æ‰«é›·ã€‚</p>
<p>è¿™ç§â€œé¢æ¡ä»£ç â€çš„æ³›æ»¥è®©æˆ‘å¼€å§‹åæ€ï¼š<strong>å½“ä¸‹çš„å‰ç«¯å¼€å‘èŒƒå¼ï¼ŒçœŸçš„èƒ½æ”¯æ’‘èµ·å½“ä»Šé€»è¾‘çˆ†ç‚¸çš„å¤æ‚åº”ç”¨å—ï¼Ÿ</strong></p>
<hr/>
<p>èµ·åˆï¼Œæˆ‘ä»¥ä¸ºè¿™ç§æ··ä¹±åªæ˜¯<strong>äººä¸ºå› ç´ </strong>â€”â€”è§‰å¾—åªè¦é€šè¿‡è§„èŒƒçš„ Code Reviewã€é ç€å¼€å‘è€…çš„è‡ªè§‰ï¼Œå°±èƒ½å‹åˆ¶ä½ä»£ç çš„è…çƒ‚ã€‚ä½†éšç€é¡¹ç›®è§„æ¨¡çš„è†¨èƒ€ï¼Œæˆ‘æ¨ç¿»äº†è‡ªå·±çš„æƒ³æ³•ã€‚æˆ‘å‘ç° <strong>Vue çš„ API ä»¿ä½›è‡ªå¸¦ä¸€ç§ä¼ æŸ“æ€§</strong>ã€‚</p>
<p>åªè¦ä½ çš„ä¸šåŠ¡ä»£ç ä¸­è¿˜ç›´æ¥è°ƒç”¨ç€ <code>ref</code>ã€<code>watch</code>ã€<code>onMounted</code>è¿™äº›Vueæœ€æ ¸å¿ƒçš„åŠŸèƒ½ï¼Œä¸šåŠ¡é€»è¾‘å°±ä¸å¯é¿å…åœ°ä¼šå‘ UI æ¡†æ¶ä½å¤´æˆä¸ºUIçš„é™„åº¸ã€‚ä»Šå¤©ä¸ºäº†çœäº‹é¡ºæ‰‹å†™ä¸‹çš„æ¯ä¸€ä¸ª <code>watch</code>å’Œ<code>computed</code>ï¼Œéƒ½æ˜¯ä¸ºæœªæ¥çš„â€œè°æ”¹äº†æˆ‘çš„å˜é‡â€åŸ‹ä¸‹ä¼ç¬”ã€‚Vueçš„è¿™ç§â€˜å“åº”å¼é“¾è·¯â€™åœ¨é¡¹ç›®åˆæœŸæåº¦ä¸æ»‘ï¼Œä½†åœ¨é¡¹ç›®åæœŸå°±æ˜¯å™©æ¢¦çš„å¼€å§‹ã€‚</p>
<p>ç›´åˆ°æœ€åï¼Œæˆ‘å‘ç°ä¸€ä¸ªå‡ ä¹æ— æ³•é¿å¼€çš„å®äº‹ï¼š<strong>åªè¦ UI æ¡†æ¶è¿˜æŒæ¡ç€çŠ¶æ€çš„â€˜ä¿®æ”¹æƒâ€™ï¼Œä¸šåŠ¡ä»£ç å°±å‡ ä¹æ³¨å®šä¼šé€€åŒ–æˆé¢æ¡ã€‚</strong> äºæ˜¯æˆ‘å¼€å§‹æ„è¯†åˆ°ï¼Œæˆ‘å¿…é¡»ä»ç‰©ç†å±‚é¢ç»™ Vue çš„æƒåŠ›â€˜æ–­ä¾›â€™ã€‚è¿™ä¾¿æ˜¯æˆ‘è®¾è®¡ <strong>Virid</strong> çš„åˆè¡·ï¼š<strong>æˆ‘è¦çš„ä¸æ˜¯æ›´ä¼˜é›…åœ°å†™ Vue ä»£ç çš„æ–¹æ³•ï¼Œè€Œæ˜¯ä¸€å¥—æ ¹æœ¬ä¸å±äº Vue çš„å…¨æ–°ä¸–ç•Œã€‚</strong>â€</p>
<hr/>
<p>åœ¨è¿™æ ·çš„ç†å¿µçš„æ¨åŠ¨ä¸‹ï¼Œæˆ‘äº§ç”Ÿäº†ä¸€ä¸ªæå…¶æ¿€è¿›çš„æƒ³æ³•ï¼š**è®©é€»è¾‘å½»åº•ä» UI ä¸­å‰¥ç¦»ï¼Œæ„å»ºä¸€å¥—å®Œå…¨"æ— å¤´"ï¼ˆHeadlessï¼‰çš„ä¸šåŠ¡å¼•æ“ã€‚**å½“æˆ‘å°†ç›®å…‰æŠ•å‘ <strong>Rust çš„ Bevy ECS æ¶æ„</strong> å’Œ <strong>NestJS çš„ IoC ä¾èµ–æ³¨å…¥</strong>æ—¶ï¼Œæˆ‘å‘ç°äº†æˆ‘è‡ªå·±çš„ç­”æ¡ˆã€‚</p>
<p>Bevy æ˜¯ Rust åœˆå­é‡Œæœ€ç¡¬æ ¸çš„å¼€æºé¡¹ç›®ä¹‹ä¸€ï¼Œå®ƒçš„ ECS ç³»ç»Ÿç¾å¾—åƒè‰ºæœ¯å“ã€‚ä½†å¯æƒœå®ƒä¸ºæ¸¸æˆè€Œç”Ÿï¼Œå¤©ç„¶è‡ªå¸¦é«˜é¢‘ Tickï¼Œç›´æ¥æŒªåˆ°å‰ç«¯å¼€å‘ä¸­ä¼šæ˜¾å¾—æ ¼æ ¼ä¸å…¥ã€‚NestJS æ˜¯ JS é¢†åŸŸé‡Œä¾èµ–æ³¨å…¥æœ€æˆç†Ÿçš„å®è·µã€‚æˆ‘ä¸€ç›´åœ¨æ€è€ƒï¼Œå¦‚æœèƒ½ç”¨ NestJS çš„æ‰‹æ„Ÿå»å†™ä¸€å¥— Bevy å¼çš„è§£è€¦é€»è¾‘ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ<strong>@Virid/core</strong> å°±æ˜¯è¿™ä¸ªæ€è€ƒçš„ç­”æ¡ˆã€‚å®ƒå‰”é™¤äº†å¤šä½™çš„èµ„æºæŸè€—ï¼Œä¿ç•™äº†æœ€æ ¸å¿ƒçš„æ¶æ„ç¾æ„Ÿã€‚</p>
<hr/>
<p>ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šï¼Œæˆ‘ä¸ºå‰ç«¯é‡èº«å®šåˆ¶äº†ä¸€å¥—â€œå¸¦å¸§åŒç¼“å†²ä¸ä¼˜å…ˆçº§è°ƒåº¦çš„æ¶ˆæ¯ä¸­å¿ƒâ€ã€‚</p>
<p>å®ƒç»éç®€å•çš„ Event Bus æˆ– Pub/Sub æ¨¡å¼æ‰€èƒ½æ¯”æ‹Ÿã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªèåˆäº† <strong>NestJS ä¾èµ–æ³¨å…¥</strong>ä¸<strong>Bevyè°ƒåº¦æ ¸å¿ƒ</strong>çš„ç²¾å¯†ç³»ç»Ÿã€‚é€šè¿‡<strong>å¸§åŒç¼“å†²</strong>æœºåˆ¶ï¼Œå®ƒå½»åº•æ¶ˆé™¤äº†å‰ç«¯é€»è¾‘ä¸­å¸¸è§çš„"ç«æ€æ¡ä»¶"ä¸"çŠ¶æ€è¸©è¸"ï¼›é…åˆä¼˜å…ˆçº§è°ƒåº¦ï¼Œå®ƒç¡®ä¿äº†æ¯ä¸€æ¡ä¸šåŠ¡æŒ‡ä»¤éƒ½èƒ½åœ¨æœ€åˆé€‚çš„æ—¶é—´èŠ‚æ‹é‡Œæ‰§è¡Œã€‚</p>
<p>è¦ä½¿ç”¨<code>@Virid/core</code>ï¼Œåªéœ€è¦ç®€å•çš„ä¸‰æ­¥èµ°ã€‚é¦–å…ˆæ´¾ç”Ÿä¸€ä¸ªè‡ªå·±çš„æ¶ˆæ¯ã€‚ä»–å¯ä»¥æºå¸¦ä»»ä½•ä½ æƒ³è¦å‘é€çš„æ•°æ®ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// åˆå§‹åŒ–æ ¸å¿ƒå¼•æ“</span>
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createVirid</span>();
<span class="hljs-comment">// æ´¾ç”Ÿä¸€ä¸ªè‡ªå·±çš„æ¶ˆæ¯</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">IncrementMessage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">SingleMessage</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">public</span> amount: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-variable language_">super</span>();
  }
}
</code></pre>
<p>æ¥ç€ï¼Œå®šä¹‰è‡ªå·±çš„Componentå¹¶æ³¨å†Œä»–ï¼Œè¿™æ˜¯â€œæ•°æ®ä¸­å¿ƒâ€ï¼Œä»–åªè´Ÿè´£å­˜å‚¨æ•°æ®ï¼Œé™¤æ­¤ä¹‹å¤–æ²¡æœ‰ä»»ä½•é€»è¾‘ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-meta">@Component</span>()
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CounterComponent</span> {
  <span class="hljs-keyword">public</span> count = <span class="hljs-number">0</span>;
}
<span class="hljs-comment">// æ³¨å†Œè¿™ä¸ªæ•°æ®ç»„ä»¶</span>
app.<span class="hljs-title function_">bindComponent</span>(<span class="hljs-title class_">CounterComponent</span>);
</code></pre>
<p>æœ€åï¼Œç¼–å†™ä¸€ä¸ªè‡ªå·±çš„systemã€‚<strong>ä»–æ˜¯çº¯é™æ€çš„ã€ä¸éœ€è¦ä»»ä½•æ³¨å†Œä¸è°ƒç”¨ï¼Œåªéœ€è¦ç¼–å†™ä»–éœ€è¦çš„å‚æ•°ã€‚<code>@Virid/core</code>å°†ä¼šè‡ªå·±å‘ç°å¹¶åœ¨åˆé€‚çš„æ—¶å€™è°ƒç”¨å®ƒã€‚</strong></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">//å®šä¹‰ç³»ç»Ÿ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CounterSystem</span> {
  <span class="hljs-comment">//é»˜è®¤ä¼˜å…ˆçº§</span>
  <span class="hljs-comment">//æ— éœ€ä»»ä½•æ“ä½œï¼Œåªè¦å®šä¹‰å¥½å@Virid/coreå°†ä¼šè‡ªåŠ¨å°†systemä¸å¯¹åº”çš„æ¶ˆæ¯ç±»å‹æŒ‚é’©</span>
  <span class="hljs-comment">//å½“æ¥æ”¶åˆ°å¯¹åº”çš„æ¶ˆæ¯ä¹‹åï¼Œ@Virid/coreå°†ä¼šæ³¨å…¥æ‰€æœ‰éœ€è¦çš„å‚æ•°ï¼Œè‡ªåŠ¨æ‰§è¡Œæ•´ä¸ªsystem</span>
  <span class="hljs-meta">@System</span>()
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">onIncrement</span>(<span class="hljs-params">
    <span class="hljs-meta">@Message</span>(IncrementMessage) message: IncrementMessage,
    count: CounterComponent,
  </span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"---------------------onIncrement----------------------"</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"message :&gt;&gt; "</span>, message);
    count.<span class="hljs-property">count</span> += message.<span class="hljs-property">amount</span>;
  }
   <span class="hljs-comment">//è®¾ç½®ä¸€ä¸ªå¾ˆé«˜çš„ä¼˜å…ˆçº§</span>
  <span class="hljs-meta">@System</span>(<span class="hljs-number">100</span>)
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">onIncrementPriority</span>(<span class="hljs-params">
    <span class="hljs-meta">@Message</span>(IncrementMessage) message: IncrementMessage,
    count: CounterComponent,
  </span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
      <span class="hljs-string">"---------------------onIncrementPriority----------------------"</span>,
    );
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"message :&gt;&gt; "</span>, message);
    count.<span class="hljs-property">count</span> += message.<span class="hljs-property">amount</span>;
  }
}
</code></pre>
<p>åœ¨ä»»ä½•åœ°æ–¹ï¼Œåªè¦å‘é€æ¶ˆæ¯ï¼Œ<code>onIncrement</code>å°†ä¼šè¢«<code>è‡ªåŠ¨è°ƒç”¨</code>ã€‚è€Œä¸”ç”±äºå¸§åŒç¼“å†²æœºåˆ¶ï¼Œå…¶å¤©ç„¶è‡ªå¸¦é˜²æŠ–åŠŸèƒ½ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title class_">IncrementMessage</span>.<span class="hljs-title function_">send</span>(<span class="hljs-number">1</span>);<span class="hljs-comment">//è¿™ä¸ªæ¶ˆæ¯å°†ä¼šè¢«åˆå¹¶ï¼ˆå¦‚æœä½¿ç”¨EventMessageæ´¾ç”Ÿåˆ™ä¸ä¼šè¢«åˆå¹¶ï¼‰</span>
<span class="hljs-title class_">IncrementMessage</span>.<span class="hljs-title function_">send</span>(<span class="hljs-number">5</span>);
<span class="hljs-comment">//åªéœ€è¦å‘é€ä¸Šé¢çš„æ¶ˆæ¯ï¼ŒCounterComponentå°†ä¼šè¢«è‡ªåŠ¨æ³¨å…¥onIncrementPriorityä¸onIncrementçš„è°ƒç”¨ä¸­</span>
<span class="hljs-comment">//å› ä¸ºä¼˜å…ˆçº§çš„å­˜åœ¨ï¼Œæ§åˆ¶å°ä¼šå…ˆåæ˜¾ç¤ºonIncrementPriorityä¸onIncrementçš„æ‰§è¡Œæµç¨‹</span>
<span class="hljs-comment">//---------------------onIncrementPriority----------------------</span>
<span class="hljs-comment">//message :&gt;&gt;  IncrementMessage {</span>
<span class="hljs-comment">//  amount: 5</span>
<span class="hljs-comment">//}</span>
<span class="hljs-comment">//---------------------onIncrement----------------------</span>
<span class="hljs-comment">//message :&gt;&gt;  IncrementMessage {</span>
<span class="hljs-comment">//  amount: 5</span>
<span class="hljs-comment">//}</span>
</code></pre>
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œ<strong>ä¸šåŠ¡é€»è¾‘ã€UIã€æ•°æ®ä¸‰è€…èƒ½å¤Ÿå½»åº•è§£è€¦</strong>ï¼Œæˆ‘ä»¬å°†ä¸ä¼šå†éœ€è¦Vueåšä»»ä½•äº‹æƒ…æ¥ä»‹å…¥ä¸šåŠ¡ï¼Œåªè¦è§¦å‘ä¸€ä¸ªåˆé€‚çš„ä¿¡å·ï¼Œæ‰€æœ‰çš„ç³»ç»Ÿå°†ä¼šè‡ªåŠ¨åˆé€‚çš„è°ƒç”¨ï¼Œå¹¶ä¸”è°ƒåº¦ç³»ç»Ÿå°†ä¼šä¸¥æ ¼ä¿è¯æ‰§è¡Œçš„å…ˆåé¡ºåºã€‚é€šè¿‡è¿™æ ·çš„è®¾è®¡ï¼Œé…åˆå‡ ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­ã€‚å¯ä»¥è½»è€Œæ˜“ä¸¾çš„å®ç°undo/redoä¸æ¶ˆæ¯è·Ÿè¸ªåŠŸèƒ½ï¼Œè¿™æ˜¯åœ¨æ™®é€šçš„Vueä¸­éš¾ä»¥åšåˆ°çš„äº‹ã€‚</p>
<p>ç”±äº System å’Œ Component éƒ½æ˜¯çº¯ç²¹çš„é€»è¾‘å’Œæ•°æ®ï¼Œ<strong>ä½ å¯ä»¥åœ¨å®Œå…¨ä¸å¯åŠ¨æµè§ˆå™¨ã€ä¸æ¸²æŸ“ Vue ç»„ä»¶çš„æƒ…å†µä¸‹ï¼Œå¯¹ä¸šåŠ¡é€»è¾‘è¿›è¡Œ 100% çš„å•å…ƒæµ‹è¯•</strong>ã€‚</p>
<hr/>
<p>è§£å†³äº†ä¸šåŠ¡é€»è¾‘æ”¾å’Œæ•°æ®åœ¨å“ªå„¿çš„é—®é¢˜ï¼Œå‰©ä¸‹çš„å°±æ˜¯è§£å†³ä¸<code>Vue</code>ä¹‹é—´çš„é»åˆé—®é¢˜ã€‚å¦‚ä½•åˆ©ç”¨Vueçš„å“åº”å¼å’Œå„ç§APIï¼Œä¼˜é›…çš„è®©æˆ‘ä»¬çš„æ ¸å¿ƒæ•°æ®æŠ•å½±åˆ°UIä¸Šï¼Ÿåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘åˆ›é€ äº†<code>@virid/vue</code>å’Œå¤§é‡çš„æ ¸å¿ƒæ¦‚å¿µã€‚</p>
<p>è¦æ§åˆ¶Vueï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªâ€œä»£ç†äººâ€ï¼ˆControllerï¼‰æ¥åšè¿™ä»¶äº‹ã€‚è®©ä»–è´Ÿè´£å……å½“<code>Virid</code>ä¸<code>Vue</code>ä¹‹é—´çš„æ²Ÿé€šäººã€‚ä»–å°†ä¼šå…¨æƒæ¥ç®¡Vueçš„æ‰€æœ‰æ“ä½œï¼Œå¹¶ç»Ÿä¸€è½¬å‘ç»™Systemã€‚äºæ˜¯ï¼ŒVueæ–‡ä»¶ä¸­å°†ä¼šåªå‰©ä¸‹ä¸€è¡Œscriptä»£ç ï¼ˆä»¥ä¸€ä¸ªéŸ³ä¹åˆ—è¡¨çš„æ’­æ”¾ä¸ºä¾‹ï¼‰ã€‚</p>
<pre><code class="hljs language-ts" lang="ts">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>This is a playlist page with many songs<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(item, index) in plct.playlist"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.id"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Song</span> <span class="hljs-attr">:index</span>=<span class="hljs-string">"index"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Song</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">import</span> <span class="hljs-title class_">Song</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./Song.vue"</span>;
  <span class="hljs-keyword">import</span> { useController } <span class="hljs-keyword">from</span> <span class="hljs-string">"@virid/vue"</span>;
  <span class="hljs-keyword">import</span> { <span class="hljs-title class_">PlaylistController</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/logic/controllers/playListController"</span>;
  <span class="hljs-keyword">const</span> plct = <span class="hljs-title function_">useController</span>(<span class="hljs-title class_">PlaylistController</span>, { <span class="hljs-attr">id</span>: <span class="hljs-string">"playlist"</span> });
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"scss"</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<p>åœ¨æ™®é€šçš„Vueä¸­ï¼Œä¸šåŠ¡é€»è¾‘ä¸UIé€»è¾‘å¾€å¾€æºæ‚åœ¨ä¸€èµ·ï¼Œä½†æ˜¯åœ¨<code>Virid</code>çš„æ ¸å¿ƒè°ƒåº¦ä¹‹ä¸‹æˆ‘ä»¬æ‹¥æœ‰äº†ä¸€ä¸ªå…¨æ–°çš„é€‰æ‹©ï¼šè®©Vueæ°¸è¿œåªè´Ÿè´£UIçš„æ˜¾ç¤ºä¸ç»˜åˆ¶ï¼Œå°†ä¸šåŠ¡é€»è¾‘è½¬äº¤ç»™<code>@Virid/core</code>ã€‚</p>
<p>ä¸ºäº†å…¼å®¹å“åº”å¼ï¼Œæˆ‘å¼•å…¥äº†å“åº”å¼è£…é¥°å™¨<code>@Responsive()</code>ï¼Œåªè¦ç»™ä»»ä½•å˜é‡æ‰“ä¸Šè¿™ä¸ªè£…é¥°å™¨ï¼Œå½“æˆ‘ä»¬è®¿é—®çš„æ—¶å€™ï¼Œå…¶å°†<strong>ä¼šè¢«Viridè‡ªåŠ¨è½¬æ¢æˆVueçš„å“åº”å¼å˜é‡</strong>ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç›´æ¥å‘Šè¯‰<code>Virid</code>ï¼Œé‚£äº›å˜é‡æ˜¯éœ€è¦å“åº”å¼çš„ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-meta">@Component</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PlaylistComponent</span> {
  <span class="hljs-comment">// å½“å‰æ­£åœ¨æ’­æ”¾çš„æ­Œï¼Œç¬¬ä¸€æ¬¡è®¿é—®æ—¶å°†ä¼šè¢«Viridè½¬åŒ–ä¸ºå“åº”å¼å˜é‡</span>
  <span class="hljs-meta">@Responsive</span>()
  <span class="hljs-keyword">public</span> <span class="hljs-attr">currentSong</span>: <span class="hljs-title class_">Song</span> = <span class="hljs-literal">null</span>!
  <span class="hljs-comment">// æ­Œå•åˆ—è¡¨ï¼Œç¬¬ä¸€æ¬¡è®¿é—®æ—¶å°†ä¼šè¢«Viridè½¬åŒ–ä¸ºå“åº”å¼å˜é‡</span>
  <span class="hljs-meta">@Responsive</span>()
  <span class="hljs-keyword">public</span> <span class="hljs-attr">playlist</span>: <span class="hljs-title class_">Song</span>[] = []
}
</code></pre>
<p><code>@Project()</code>æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„â€œæ¡¥æ¢â€ã€‚ä½¿å¾—<code>Controller</code>èƒ½å¤Ÿç›´æ¥è®¿é—®ä»»ä½•<code>Component</code>ä¸Šçš„å±æ€§ï¼ŒåŒæ—¶å°†å…¶è½¬åŒ–ä¸º<strong>åªè¯»</strong>çš„ã€‚è¿™æ„å‘³ç€ä¸€ä¸ª<code>Controller</code>èƒ½å¤Ÿä»»æ„è§‚å¯Ÿ<code>Component</code>ä¸­çš„æ•°æ®ï¼Œä»è€Œæ›´æ–°Vueç»„ä»¶ï¼ŒåŒæ—¶<strong>åªè¯»</strong>ä¿è¯äº†Componentæ•°æ®çš„å®‰å…¨ã€‚</p>
<p><code>@Listener()</code>è£…é¥°å™¨ç”¨äºâ€œå·å¬â€ä¸€ä¸ªæ¶ˆæ¯ï¼Œä½†æ˜¯ä¸Systemä¸åŒçš„æ˜¯ï¼Œå…¶åªèƒ½å·å¬ä¸€ç§æ´¾ç”Ÿè‡ª<code>ControllerMessage</code>ç±»å‹çš„æ¶ˆæ¯ï¼Œå¹¶ä¸”æ— æ³•äº«å—ä¾èµ–æ³¨å…¥çš„åŠŸèƒ½ï¼Œè¿™æ„å‘³ç€<strong>ä¸€ä¸ª<code>Controller</code>ä¸èƒ½ç›´æ¥æ›´æ”¹<code>Component</code></strong>ã€‚</p>
<p><code>@OnHook('onSetup')</code>è£…é¥°å™¨å‘Šè¯‰<code>Virid</code>ï¼Œéœ€è¦åœ¨<code>Vue</code>çš„ä»€ä¹ˆç”Ÿå‘½å‘¨æœŸè‡ªåŠ¨è°ƒç”¨ä¸‹é¢è¿™ä¸ªæ–¹æ³•ã€‚<code>Virid</code>å°†ä¼šåœ¨åˆé€‚çš„æ—¶æœºè‡ªåŠ¨è°ƒç”¨è¢«ä¿®é¥°çš„æ–¹æ³•ã€‚</p>
<p><code>@Watch()</code>æ˜¯ä¸€ä¸ªåœ¨<code>Vue</code>åŸç‰ˆä¸Šï¼Œèåˆäº†<code>Virid</code>ç‰¹ç‚¹çš„æ›´å¼ºå¤§çš„åŠŸèƒ½ï¼Œå…¶ä¸ä»…èƒ½å¤Ÿæ£€æµ‹<code>Controller</code>è‡ªèº«å“åº”å¼å˜é‡çš„å˜åŒ–ã€‚è¿˜èƒ½å¤Ÿç›‘æµ‹<strong>ä»»æ„ä¸€ä¸ª<code>Component</code>ä¸Šçš„å˜é‡</strong>ã€‚ä½†æ˜¯ï¼Œå› ä¸º**@Watch()**ä¸­åªèƒ½æ›´æ”¹<code>Controller</code>è‡ªèº«çš„å˜é‡ï¼Œå› æ­¤å…¶ä»ç„¶æ— æ³•ä¿®æ”¹ä»»ä½•<code>Component</code>ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SongControllerMessage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">ControllerMessage</span> {
  <span class="hljs-comment">//åˆ°åº•æ˜¯å“ªä¸€é¦–æ­Œå‘æ¥çš„æ¶ˆæ¯ï¼Ÿç´¢å¼•</span>
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> index: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-variable language_">super</span>()
  }
}

<span class="hljs-meta">@Controller</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PlaylistController</span> {
   <span class="hljs-comment">//å‘Šè¯‰Viridè‡ªåŠ¨å°†playlistå˜ä¸ºå“åº”å¼çš„</span>
  <span class="hljs-meta">@Responsive</span>()
  <span class="hljs-keyword">public</span> playlist!: <span class="hljs-title class_">Song</span>[]
    
  <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªæŠ•å½±ï¼Œä»componentä¸­æ˜ å°„æ•°æ®</span>
  <span class="hljs-meta">@Project</span>(<span class="hljs-title class_">PlaylistComponent</span>, <span class="hljs-function">(<span class="hljs-params">i</span>) =&gt;</span> i.<span class="hljs-property">currentSong</span>)
  <span class="hljs-keyword">public</span> currentSong!: <span class="hljs-title class_">Song</span>

  <span class="hljs-meta">@Listener</span>(<span class="hljs-title class_">SongControllerMessage</span>)
  <span class="hljs-title function_">onMessage</span>(<span class="hljs-params"><span class="hljs-meta">@Message</span>(SongControllerMessage) message: SongControllerMessage</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'song'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">playlist</span>[message.<span class="hljs-property">index</span>])
    <span class="hljs-comment">//å¯ä»¥åšä¸€äº›æ“ä½œç»Ÿä¸€æ‹¦æˆªï¼Œæˆ–è€…ç›´æ¥è°ƒç”¨æ’­æ”¾å™¨</span>
    <span class="hljs-title class_">PlaySongMesage</span>.<span class="hljs-title function_">send</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">playlist</span>[message.<span class="hljs-property">index</span>])
  }
    
  <span class="hljs-meta">@OnHook</span>(<span class="hljs-string">'onSetup'</span>)
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getPlaylist</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">//åœ¨è¿™é‡Œå¯ä»¥è·å–æ•°æ®ï¼Œä¾‹å¦‚ä»æœåŠ¡å™¨è·å–æ•°æ®,è¿™é‡Œæ¨¡æ‹Ÿä¸€ä¸‹</span>
    <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">1000</span>))
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">playlist</span> = [
      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Song</span>(<span class="hljs-string">'æ­Œæ›²1'</span>, <span class="hljs-string">'1'</span>),
      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Song</span>(<span class="hljs-string">'æ­Œæ›²2'</span>, <span class="hljs-string">'2'</span>),
      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Song</span>(<span class="hljs-string">'æ­Œæ›²3'</span>, <span class="hljs-string">'3'</span>),
      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Song</span>(<span class="hljs-string">'æ­Œæ›²4'</span>, <span class="hljs-string">'4'</span>),
      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Song</span>(<span class="hljs-string">'æ­Œæ›²5'</span>, <span class="hljs-string">'5'</span>),
      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Song</span>(<span class="hljs-string">'æ­Œæ›²6'</span>, <span class="hljs-string">'6'</span>),
      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Song</span>(<span class="hljs-string">'æ­Œæ›²7'</span>, <span class="hljs-string">'7'</span>)
    ]
  }
  <span class="hljs-comment">//è§‚æµ‹å½“å‰æ­Œæ›²ï¼Œå¦‚æœå˜äº†å°±è§¦å‘æŸäº›æ“ä½œ</span>
  <span class="hljs-meta">@Watch</span>(<span class="hljs-title class_">PlaylistComponent</span>, <span class="hljs-function">(<span class="hljs-params">i</span>) =&gt;</span> i.<span class="hljs-property">currentSong</span>, {})
  <span class="hljs-title function_">watchCurrentSong</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç›‘å¬åˆ°å½“å‰æ­Œæ›²æ”¹å˜PlaylistComponentï¼š'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentSong</span>)
  }
}
</code></pre>
<p>å¯¹äºæ¯ä¸€é¦–æ­Œï¼Œæˆ‘ä»¬åŒæ ·éœ€è¦åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„<code>Controller</code>æ¥å……å½“æˆ‘ä»¬å’ŒViridçš„ä»£ç†äººï¼Œä½†æ˜¯ä¸æ­¤åŒæ—¶ï¼Œæ¯ä¸€ä¸ª<code>Song</code>ç»„ä»¶ä¹Ÿéœ€è¦å’Œçˆ¶<code>Playlist</code>ç»„ä»¶é€šè®¯ã€‚å› æ­¤æˆ‘åˆ›å»ºäº†ä¸€äº›æ›´å¼ºå¤§å·¥å…·ã€‚</p>
<p>åœ¨.Vueæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬ä¼ é€’äº†è¿™æ ·çš„å˜é‡ï¼Œä½†æ˜¯ï¼**æˆ‘ä»¬åªä¼ é€’äº†Songç»„ä»¶çš„ç´¢å¼•ï¼Œå¹¶æ²¡æœ‰ä¼ é€’itemæœ¬èº«ã€‚**å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æŸç§æ–¹å¼è·å¾—indexï¼Œå¹¶ä¸”è¿˜è¦èƒ½å¤Ÿè®¿é—®åˆ°çˆ¶ç»„ä»¶çš„å±æ€§ã€‚</p>
<pre><code class="hljs language-ts" lang="ts">&lt;div v-<span class="hljs-keyword">for</span>=<span class="hljs-string">"(item, index) in plct.playlist"</span> :key=<span class="hljs-string">"item.id"</span>&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Song</span> <span class="hljs-attr">:index</span>=<span class="hljs-string">"index"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Song</span>&gt;</span></span>
&lt;/div&gt;
</code></pre>
<p><code>@Env()</code>æ˜¯ä¸€ä¸ªç”¨äºæ ‡è®°çš„æ ‡è®°è£…é¥°å™¨ã€‚å½“ä½ åœ¨å­ç»„ä»¶çš„Controllerä¸­æ ‡è®°ä¸€ä¸ªå±æ€§ä¸º  <code>@Env()</code>æ—¶ï¼Œ<code>Virid</code>å°†ä¼šè´Ÿè´£å°†å…¶å®‰è£…åˆ°è¿™ä¸ªå±æ€§ä¸Šï¼Œè¿™æ„å‘³ç€<strong>ä½ ä¸éœ€è¦è‡ªå·±å®šä¹‰propsï¼ŒæŒ‰éœ€å£°æ˜å–ç”¨å³å¯</strong>ã€‚</p>
<p><code>@Inherit()</code>æ˜¯ä¸€ä¸ªç±»ä¼¼<code>@Project()</code>çš„å·¥å…·ï¼Œå¦‚æœè¯´<code>@Project()</code>æ˜¯<code>Controller</code>ä¸<code>Component</code>ä¹‹é—´çš„åªè¯»æ¡¥æ¢ã€‚é‚£ä¹ˆ<code>@Inherit()</code>å°±æ˜¯<code>Controller</code>ä¸<code>Controller</code>ä¹‹é—´çš„åªè¯»æ¡¥æ¢ã€‚<code>@Inherit</code> å½»åº•ç»ˆç»“äº†å‰ç«¯ç»„ä»¶é€šä¿¡ä¸­å†—é•¿çš„ <code>Emit/Props</code> é“¾è·¯ã€‚å®ƒå»ºç«‹äº†ä¸€ä¸ª<strong>è™«æ´</strong>ï¼Œè®©å­ç»„ä»¶å¯ä»¥ç›´æ¥è§‚å¯Ÿåˆ°è¿œæ–¹çˆ¶ç»„ä»¶çš„çŠ¶æ€çš„åŒæ—¶ï¼Œæ— æ³•å¯¹çˆ¶ç»„ä»¶äº§ç”Ÿä»»ä½•å‰¯ä½œç”¨æ±¡æŸ“ã€‚</p>
<p>é€šè¿‡<code>@Inherit()</code>ä½ å¯ä»¥ä»ä»»æ„ç»„ä»¶å†…â€œç»§æ‰¿â€ä»»æ„<code>Controller</code>çš„çŠ¶æ€ï¼ŒåŒæ—¶ï¼Œä»–ä¹Ÿæ˜¯åªè¯»çš„ï¼Œè¿™ä¿è¯äº†ä¸€ä¸ª<code>Controller</code>æ°¸è¿œæ— æ³•å·å·ä¿®æ”¹å¦ä¸€ä¸ª<code>Controller</code>ä¸­æ•°æ®çš„æƒåˆ©ï¼Œå½“å¦ä¸€ä¸ª<code>Controller</code>å› ä¸ºç»„ä»¶å¸è½½è€Œé”€æ¯çš„æ—¶å€™ï¼Œè¿™æ ·çš„è¿æ¥å°†ä¼šè‡ªåŠ¨æ–­å¼€ï¼Œç±»ä¼¼äºä¸€ç§WeakRefã€‚</p>
<p>é€šè¿‡<code>@Inherit()</code>å’Œ<code>@Project()</code>ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°éå¸¸å¼ºå¤§çš„åŠŸèƒ½ï¼Œ<strong>ä¸éœ€è¦çˆ¶ç»„ä»¶ç»™æˆ‘ä»¬æä¾›ä»»ä½•æ•°æ®ï¼ŒSongå°†ä¼šè‡ªå·±çŸ¥é“å“ªä¸ªæ•°æ®æ‰æ˜¯è‡ªå·±åº”è¯¥å¾—åˆ°çš„ã€‚</strong></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-meta">@Controller</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SongController</span> {
  <span class="hljs-meta">@Env</span>()
  <span class="hljs-keyword">public</span> index!: <span class="hljs-built_in">number</span>
  <span class="hljs-meta">@OnHook</span>(<span class="hljs-string">'onSetup'</span>)
  <span class="hljs-keyword">public</span> <span class="hljs-title function_">onSetup</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æˆ‘çš„ç´¢å¼•æ˜¯ï¼š'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span>)
  }
  <span class="hljs-meta">@Inherit</span>(<span class="hljs-title class_">PlaylistController</span>, <span class="hljs-string">'playlist'</span>, <span class="hljs-function">(<span class="hljs-params">i</span>) =&gt;</span> i.<span class="hljs-property">playlist</span>)
  <span class="hljs-keyword">public</span> playlist!: <span class="hljs-title class_">Song</span>[]

  <span class="hljs-meta">@Project</span>&lt;<span class="hljs-title class_">SongController</span>&gt;(<span class="hljs-function">(<span class="hljs-params">i</span>) =&gt;</span> i.<span class="hljs-property">playlist</span>?.[i.<span class="hljs-property">index</span>])
  <span class="hljs-keyword">public</span> song!: <span class="hljs-title class_">Song</span>

  <span class="hljs-title function_">playThisSong</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">//å…¶å®ç›´æ¥æ’­æ”¾ä¹Ÿè¡Œï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸‹éœ€è¦å‘é€ç»™çˆ¶ç»„ä»¶è®©çˆ¶ç»„ä»¶å¤„ç†çš„æƒ…å†µ</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å‘é€æ’­æ”¾æ¶ˆæ¯:'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span>)
    <span class="hljs-title class_">SongControllerMessage</span>.<span class="hljs-title function_">send</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span>)
  }
}
</code></pre>
<p>æœ€ç»ˆï¼Œæ¶ˆæ¯å°†åœ¨Systemä¸­å¾—åˆ°å¤„ç†ï¼Œä»æ­¤æ•´ä¸ªViridå°†å¾—åˆ°å®Œæ•´çš„é—­ç¯ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">//å½“Playlistè°ƒç”¨ PlaySongMesage.send(this.playlist[message.index])æ—¶</span>
<span class="hljs-comment">//æ•´ä¸ªç³»ç»Ÿå°†è¢«æ¿€æ´»ï¼Œä»è€Œæ›´æ–°æ­£ç¡®çš„æ•°æ®</span>
<span class="hljs-meta">@System</span>()
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">playThisSong</span>(<span class="hljs-params">
    <span class="hljs-meta">@Message</span>(PlaySongMesage) message: PlaySongMesage,
    playlist: PlaylistComponent,
    player: PlayerComponent
  </span>) {
    <span class="hljs-comment">//æŠŠè¿™é¦–æ­Œæ·»åŠ åˆ°playlisté‡Œï¼Œå¦‚æœæ²¡æœ‰çš„è¯</span>
    playlist.<span class="hljs-property">playlist</span>.<span class="hljs-title function_">push</span>(message.<span class="hljs-property">song</span>)

    <span class="hljs-comment">//å¼€å§‹æ’­æ”¾è¿™é¦–æ­Œ</span>
    playlist.<span class="hljs-property">currentSong</span> = message.<span class="hljs-property">song</span>
    player.<span class="hljs-property">player</span>.<span class="hljs-title function_">play</span>(message.<span class="hljs-property">song</span>)
    <span class="hljs-comment">//è‡ªåŠ¨å‘é€æ–°æ¶ˆæ¯ï¼Œè®°å½•</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IncreasePlayNumMessage</span>()
  }
</code></pre>
<hr/>
<p><code>Virid</code> ä¸æ˜¯ä¸ºäº†æ¶ˆç­ <code>Vue</code>ï¼Œè€Œæ˜¯ä¸ºäº†è§£å†³ä¸šåŠ¡é€»è¾‘è¢«è€¦åˆåœ¨UIä¸­çš„é—®é¢˜ã€‚å®ƒå¯èƒ½ä¸é€‚åˆæ‰€æœ‰çš„ Todo-listï¼Œä½†å®ƒä¸€å®šé€‚åˆé‚£äº›è®©ä½ å¤œä¸èƒ½å¯çš„å¤æ‚ç³»ç»Ÿã€‚</p>
<p>é¡¹ç›®åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FArisuYuki%2Fvirid" target="_blank" title="https://github.com/ArisuYuki/virid" ref="nofollow noopener noreferrer">github.com/ArisuYuki/vâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ButterKnifeåœ¨Android 35 + Gradle 8.+ç¯å¢ƒä¸‹çš„é€‚é…å›°å¢ƒä¸ç°ä»£åŒ–è¿ç§»æŒ‡å—]]></title>    <link>https://juejin.cn/post/7603581886149230646</link>    <guid>https://juejin.cn/post/7603581886149230646</guid>    <pubDate>2026-02-06T10:34:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603581886149230646" data-draft-id="7603581886149214262" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ButterKnifeåœ¨Android 35 + Gradle 8.+ç¯å¢ƒä¸‹çš„é€‚é…å›°å¢ƒä¸ç°ä»£åŒ–è¿ç§»æŒ‡å—"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-06T10:34:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°ç å“¥_å¸¸"/> <meta itemprop="url" content="https://juejin.cn/user/705230023172650"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ButterKnifeåœ¨Android 35 + Gradle 8.+ç¯å¢ƒä¸‹çš„é€‚é…å›°å¢ƒä¸ç°ä»£åŒ–è¿ç§»æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/705230023172650/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°ç å“¥_å¸¸
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T10:34:37.000Z" title="Fri Feb 06 2026 10:34:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>é‡è¦å£°æ˜</strong>ï¼šButterKnifeå·²äº2020å¹´ç”±ä½œè€…Jake Whartonæ­£å¼å®£å¸ƒå¼ƒç”¨ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJakeWharton%2Fbutterknife" target="_blank" title="https://github.com/JakeWharton/butterknife" ref="nofollow noopener noreferrer">GitHubå½’æ¡£è¯´æ˜</a>ï¼‰ã€‚æœ¬æ–‡æ ¸å¿ƒç»“è®ºï¼š<strong>å¼ºçƒˆä¸å»ºè®®åœ¨æ–°é¡¹ç›®ä¸­ä½¿ç”¨ButterKnifeï¼Œç°æœ‰é¡¹ç›®åº”ä¼˜å…ˆè¿ç§»è‡³ViewBinding</strong>ã€‚æœ¬æ–‡ä»…æä¾›æŠ€æœ¯èƒŒæ™¯åˆ†æä¸è¿ç§»è·¯å¾„ï¼Œé¿å…å¼€å‘è€…é™·å…¥ç»´æŠ¤é™·é˜±ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">ä¸€ã€ä¸ºä»€ä¹ˆButterKnifeæ— æ³•é€‚é…Gradle 8.+ä¸Android 35ï¼Ÿ</h2>
<h3 data-id="heading-1">ğŸ”’ æ ¸å¿ƒçŸ›ç›¾ç‚¹</h3>



































<table><thead><tr><th>ç»´åº¦</th><th>ButterKnifeç°çŠ¶</th><th>Gradle 8.+ / AGP 8.+ è¦æ±‚</th><th>Android 35 (API 35) é£é™©</th></tr></thead><tbody><tr><td><strong>ç»´æŠ¤çŠ¶æ€</strong></td><td>2020å¹´å½’æ¡£ï¼Œæœ€åç‰ˆæœ¬10.2.3 (2019)</td><td>è¦æ±‚ä¾èµ–æ˜ç¡®å£°æ˜ã€æ³¨è§£å¤„ç†å™¨å…¼å®¹æ–°API</td><td>åå°„é™åˆ¶å¢å¼ºï¼ˆéSDKæ¥å£ç®¡æ§ï¼‰</td></tr><tr><td><strong>æ³¨è§£å¤„ç†å™¨</strong></td><td>åŸºäºæ—§ç‰ˆJavaPoetï¼Œæœªé€‚é…AGP 8+ SPI</td><td>å¼ºåˆ¶è¦æ±‚<code>compileApiVersion</code>å£°æ˜</td><td>ButterKnifeä¾èµ–åå°„ç»‘å®šViewï¼Œå­˜åœ¨è¿è¡Œæ—¶å´©æºƒé£é™©</td></tr><tr><td><strong>æ„å»ºé…ç½®</strong></td><td>ä¾èµ–<code>apt</code>æ’ä»¶ï¼ˆå·²åºŸå¼ƒï¼‰</td><td>ç§»é™¤<code>compile</code>/<code>provided</code>ï¼Œå¼ºåˆ¶<code>namespace</code></td><td>Android 15å¯¹åå°Activityå¯åŠ¨ç­‰æœ‰æ–°é™åˆ¶ï¼ˆé—´æ¥å½±å“äº‹ä»¶å¤„ç†ï¼‰</td></tr><tr><td><strong>Javaç‰ˆæœ¬</strong></td><td>ç¼–è¯‘äºJava 8</td><td>Gradle 8é»˜è®¤éœ€JDK 17+</td><td>JDK 17æ¨¡å—åŒ–å¯¹åå°„è°ƒç”¨æ›´ä¸¥æ ¼</td></tr></tbody></table>
<h3 data-id="heading-2">âš ï¸ å…¸å‹æŠ¥é”™ç¤ºä¾‹</h3>
<pre><code class="hljs language-log" lang="log"># AGP 8+ ä¸¥æ ¼æ¨¡å¼æŠ¥é”™
&gt; Task :app:compileDebugJavaWithJavac FAILED
error: cannot access butterknife.Unbinder
  class file for butterknife.Unbinder not found

# Gradle 8 ä¾èµ–è§£æå¤±è´¥
Could not resolve com.jakewharton:butterknife-compiler:10.2.3.
Required by: project :app &gt; com.android.tools.build:gradle:8.2.0
</code></pre>
<hr/>
<h2 data-id="heading-3">äºŒã€ä¸´æ—¶æ–¹æ¡ˆï¼ˆä»…é™ç´§æ€¥è¿‡æ¸¡ï¼Œé£é™©è‡ªæ‹…ï¼‰</h2>
<blockquote>
<p>ğŸ“Œ <strong>è­¦å‘Š</strong>ï¼šä»¥ä¸‹æ–¹æ¡ˆæ— æ³•ä¿è¯ç¨³å®šæ€§ï¼Œä»…ä½œçŸ­æœŸåº”æ€¥å‚è€ƒï¼Œ<strong>åˆ‡å‹¿ç”¨äºç”Ÿäº§ç¯å¢ƒé•¿æœŸç»´æŠ¤</strong></p>
</blockquote>
<h3 data-id="heading-4">æ–¹æ¡ˆAï¼šé™çº§æ„å»ºç¯å¢ƒï¼ˆä¸æ¨èï¼‰</h3>
<pre><code class="hljs language-gradle" lang="gradle">// gradle-wrapper.properties
distributionUrl=https\://services.gradle.org/distributions/gradle-7.6-bin.zip

// build.gradle (Project)
classpath 'com.android.tools.build:gradle:7.4.2' // é8.x
</code></pre>
<p><strong>ç¼ºé™·</strong>ï¼šæ— æ³•ä½¿ç”¨Android 35æ–°ç‰¹æ€§ï¼Œå®‰å…¨è¡¥ä¸æ»åï¼Œè¿åGoogle Play targetingè¦æ±‚ã€‚</p>
<h3 data-id="heading-5">æ–¹æ¡ˆBï¼šç¤¾åŒºForkå°è¯•ï¼ˆé«˜é£é™©ï¼‰</h3>
<pre><code class="hljs language-gradle" lang="gradle">dependencies {
    implementation 'io.github.yuweiguocn:butterknife:10.2.4' // éå®˜æ–¹fork
    annotationProcessor 'io.github.yuweiguocn:butterknife-compiler:10.2.4'
}
</code></pre>
<p><strong>é£é™©</strong>ï¼š</p>
<ul>
<li>æ— å®˜æ–¹ç»´æŠ¤ï¼Œå®‰å…¨æ¼æ´æœªçŸ¥</li>
<li>ä¸AGP 8.3+ä»å¯èƒ½å­˜åœ¨å…¼å®¹é—®é¢˜</li>
<li>Android 35åå°„é™åˆ¶å¯èƒ½å¯¼è‡´è¿è¡Œæ—¶å´©æºƒ</li>
</ul>
<hr/>
<h2 data-id="heading-6">ä¸‰ã€âœ… æ­£ç¡®è·¯å¾„ï¼šè¿ç§»åˆ°ViewBindingï¼ˆå®˜æ–¹æ¨èæ–¹æ¡ˆï¼‰</h2>
<h3 data-id="heading-7">è¿ç§»ä¼˜åŠ¿</h3>
<ul>
<li>âœ… å®Œç¾å…¼å®¹Gradle 8.0+ / AGP 8.0+ / Android 35</li>
<li>âœ… ç¼–è¯‘æœŸç±»å‹å®‰å…¨ï¼Œé›¶åå°„ï¼Œæ€§èƒ½ä¼˜äºButterKnife</li>
<li>âœ… Googleå®˜æ–¹æŒç»­ç»´æŠ¤ï¼Œä¸Composeæ— ç¼è¡”æ¥</li>
<li>âœ… å‡å°‘APKä½“ç§¯ï¼ˆæ— éœ€æ³¨è§£å¤„ç†å™¨ç”Ÿæˆä»£ç ï¼‰</li>
</ul>
<h3 data-id="heading-8">è¿ç§»å››æ­¥æ³•</h3>
<h4 data-id="heading-9">1ï¸âƒ£ å¯ç”¨ViewBindingï¼ˆbuild.gradleï¼‰</h4>
<pre><code class="hljs language-gradle" lang="gradle">android {
    namespace 'com.your.package' // AGP 8+ å¼ºåˆ¶è¦æ±‚
    buildFeatures {
        viewBinding true
    }
}
</code></pre>
<h4 data-id="heading-10">2ï¸âƒ£ Activityè¿ç§»å¯¹æ¯”</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ ButterKnife (æ—§)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> {
    <span class="hljs-meta">@BindView(R.id.tv_title)</span> TextView title;
    <span class="hljs-meta">@Override</span> <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        ButterKnife.bind(<span class="hljs-built_in">this</span>);
        title.setText(<span class="hljs-string">"Hello"</span>);
    }
}

<span class="hljs-comment">// âœ… ViewBinding (æ–°)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> {
    <span class="hljs-keyword">private</span> ActivityMainBinding binding; <span class="hljs-comment">// è‡ªåŠ¨ç”Ÿæˆç±»</span>
    
    <span class="hljs-meta">@Override</span> <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
        binding = ActivityMainBinding.inflate(getLayoutInflater());
        setContentView(binding.getRoot());
        binding.tvTitle.setText(<span class="hljs-string">"Hello"</span>); <span class="hljs-comment">// ç±»å‹å®‰å…¨</span>
    }
    
    <span class="hljs-meta">@Override</span> <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">super</span>.onDestroy();
        binding = <span class="hljs-literal">null</span>; <span class="hljs-comment">// é¿å…å†…å­˜æ³„æ¼</span>
    }
}
</code></pre>
<h4 data-id="heading-11">3ï¸âƒ£ Fragmentè¿ç§»è¦ç‚¹</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Kotlinç¤ºä¾‹ï¼ˆæ¨èï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">HomeFragment</span> : <span class="hljs-type">Fragment</span>() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> _binding: FragmentHomeBinding? = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> binding <span class="hljs-keyword">get</span>() = _binding!!

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreateView</span><span class="hljs-params">(inflater: <span class="hljs-type">LayoutInflater</span>, container: <span class="hljs-type">ViewGroup</span>?, savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span>: View {
        _binding = FragmentHomeBinding.inflate(inflater, container, <span class="hljs-literal">false</span>)
        <span class="hljs-keyword">return</span> binding.root
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onViewCreated</span><span class="hljs-params">(view: <span class="hljs-type">View</span>, savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        binding.btnSubmit.setOnClickListener { <span class="hljs-comment">/* äº‹ä»¶å¤„ç† */</span> }
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDestroyView</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.onDestroyView()
        _binding = <span class="hljs-literal">null</span> <span class="hljs-comment">// å…³é”®ï¼é˜²æ­¢Fragmentè§†å›¾æ³„æ¼</span>
    }
}
</code></pre>
<h4 data-id="heading-12">4ï¸âƒ£ æ‰¹é‡è¿ç§»æŠ€å·§</h4>
<ul>
<li><strong>Android Studioè¾…åŠ©</strong>ï¼š<br/>
<code>Refactor &gt; Migrate to ViewBinding</code>ï¼ˆéƒ¨åˆ†ç‰ˆæœ¬æ”¯æŒï¼‰</li>
<li><strong>æ­£åˆ™æ›¿æ¢å‚è€ƒ</strong>ï¼š<br/>
<code>@BindView$R\.id\.(\w+)$\s+\w+\s+(\w+);</code> â†’ <code>binding.$1</code></li>
<li><strong>åˆ†æ¨¡å—æ¨è¿›</strong>ï¼šä¼˜å…ˆè¿ç§»ä½é£é™©æ¨¡å—ï¼Œä¿ç•™ButterKnifeåœ¨ç‹¬ç«‹Moduleä¸­éš”ç¦»</li>
</ul>
<hr/>
<h2 data-id="heading-13">å››ã€Android 35ç‰¹åˆ«æ³¨æ„äº‹é¡¹</h2>
<ol>
<li><strong>åå°„é™åˆ¶</strong>ï¼šButterKnifeé€šè¿‡<code>Class.forName</code>åŠ è½½ç»‘å®šç±»ï¼Œåœ¨Android 35ä¸Šå¯èƒ½è§¦å‘<code>NoSuchMethodError</code>ï¼ˆå°¤å…¶å¯ç”¨<code>strictMode</code>æ—¶ï¼‰</li>
<li><strong>åå°é™åˆ¶</strong>ï¼š<code>@OnClick</code>è‹¥è§¦å‘Activityè·³è½¬ï¼Œéœ€æ£€æŸ¥Android 15çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fabout%2Fversions%2F15%2Fbehavior-changes-15%23pending-intent-mutability" target="_blank" title="https://developer.android.com/about/versions/15/behavior-changes-15#pending-intent-mutability" ref="nofollow noopener noreferrer"> PendingIntenté™åˆ¶</a></li>
<li><strong>è¿ç§»éªŒè¯æ¸…å•</strong>ï¼š
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> åœ¨Android 15æ¨¡æ‹Ÿå™¨/çœŸæœºæµ‹è¯•Viewç»‘å®š</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> æ£€æŸ¥æ‰€æœ‰ç‚¹å‡»äº‹ä»¶æ˜¯å¦ç¬¦åˆæ–°æƒé™æ¨¡å‹</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> ä½¿ç”¨StrictModeæ£€æµ‹åå°„è¿è§„</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-14">äº”ã€ç»“è¯­ï¼šæ‹¥æŠ±ç°ä»£Androidå¼€å‘</h2>





























<table><thead><tr><th>æ–¹æ¡ˆ</th><th>å¯è¡Œæ€§</th><th>é•¿æœŸæˆæœ¬</th><th>æ¨èæŒ‡æ•°</th></tr></thead><tbody><tr><td>å¼ºè¡Œé€‚é…ButterKnife</td><td>âŒ æä½</td><td>æé«˜ï¼ˆå®‰å…¨/ç»´æŠ¤é£é™©ï¼‰</td><td>â­</td></tr><tr><td>é™çº§Gradle/AGP</td><td>âš ï¸ ä¸´æ—¶</td><td>é«˜ï¼ˆæŠ€æœ¯å€ºç´¯ç§¯ï¼‰</td><td>â­â­</td></tr><tr><td><strong>è¿ç§»åˆ°ViewBinding</strong></td><td>âœ… 100%</td><td>ä½ï¼ˆä¸€æ¬¡æ€§æŠ•å…¥ï¼‰</td><td>â­â­â­â­â­</td></tr></tbody></table>
<blockquote>
<p><strong>è¡ŒåŠ¨å»ºè®®</strong>ï¼š<br/>
1ï¸âƒ£ ç«‹å³è¯„ä¼°é¡¹ç›®ButterKnifeä½¿ç”¨èŒƒå›´<br/>
2ï¸âƒ£ åˆ¶å®š2-4å‘¨è¿ç§»è®¡åˆ’ï¼ˆå°å›¢é˜Ÿå¯1å‘¨å®Œæˆï¼‰<br/>
3ï¸âƒ£ åˆ©ç”¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Ftopic%2Flibraries%2Fview-binding" target="_blank" title="https://developer.android.com/topic/libraries/view-binding" ref="nofollow noopener noreferrer">ViewBindingå®˜æ–¹æ–‡æ¡£</a>ä¸<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fstudio%2Fwrite%2Fview-binding-migration" target="_blank" title="https://developer.android.com/studio/write/view-binding-migration" ref="nofollow noopener noreferrer">è¿ç§»æ£€æŸ¥æ¸…å•</a><br/>
4ï¸âƒ£ å°†æ­¤æ¬¡å‡çº§è§†ä¸ºæŠ€æœ¯å€ºæ¸…ç†å¥‘æœºï¼ŒåŒæ­¥ä¼˜åŒ–æ¶æ„</p>
</blockquote>
<p><strong>æŠ€æœ¯æ¼”è¿›ä¸å¯é€†</strong>ã€‚ViewBindingä¸ä»…æ˜¯ButterKnifeçš„æ›¿ä»£å“ï¼Œæ›´æ˜¯é€šå¾€Jetpack Composeçš„æ¡¥æ¢ã€‚æœæ–­è¿ç§»ï¼Œæ–¹èƒ½è½»è£…å‰è¡Œï¼Œæ‹¥æŠ±Androidå¼€å‘çš„æœªæ¥ã€‚</p>
<blockquote>
<p><strong>è½¬è½½å£°æ˜</strong>ï¼š<br/>
1ï¸âƒ£ æœ¬æ–‡ç« æœ€æ—©å‘å¸ƒäºç å®¢<br/>
2ï¸âƒ£ æ–‡ç« åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fmake.dxmwl.com%2Fp%2F68" target="_blank" title="https://make.dxmwl.com/p/68" ref="nofollow noopener noreferrer">ButterKnifeåœ¨Android 35 + Gradle 8.+ç¯å¢ƒä¸‹çš„é€‚é…å›°å¢ƒä¸ç°ä»£åŒ–è¿ç§»æŒ‡å—</a><br/>
3ï¸âƒ£ è½¬è½½è¯·å…ˆè·å–ä½œè€…æˆæƒ</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Androidé«˜æ–¯æ¨¡ç³Šï¼šBackgroundBlurDrawableå®æˆ˜é¿å‘æŒ‡å—]]></title>    <link>https://juejin.cn/post/7603563360329072682</link>    <guid>https://juejin.cn/post/7603563360329072682</guid>    <pubDate>2026-02-06T10:46:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603563360329072682" data-draft-id="7603581886149247030" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Androidé«˜æ–¯æ¨¡ç³Šï¼šBackgroundBlurDrawableå®æˆ˜é¿å‘æŒ‡å—"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-06T10:46:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°ç å“¥_å¸¸"/> <meta itemprop="url" content="https://juejin.cn/user/705230023172650"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Androidé«˜æ–¯æ¨¡ç³Šï¼šBackgroundBlurDrawableå®æˆ˜é¿å‘æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/705230023172650/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°ç å“¥_å¸¸
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T10:46:12.000Z" title="Fri Feb 06 2026 10:46:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>æ ¸å¿ƒç»“è®ºå‰ç½®</strong>ï¼š<br/>
ğŸ”’ <code>BackgroundBlurDrawable</code> æ˜¯ <strong>Androidç³»ç»Ÿå†…éƒ¨éšè—ç±»</strong>ï¼ˆ<code>com.android.internal.widget.BackgroundBlurDrawable</code>ï¼‰ï¼Œ<strong>æ™®é€šåº”ç”¨æ— æ³•ç›´æ¥è°ƒç”¨</strong>ã€‚<br/>
ğŸŒ çœŸæ­£é¢å‘å¼€å‘è€…çš„APIæ˜¯ <strong>WindowManager.LayoutParams.blurBehindRadius</strong>ï¼ˆAndroid 12+ï¼‰ï¼Œä½†å­˜åœ¨ä¸¥é‡æƒé™ä¸å…¼å®¹æ€§é™åˆ¶ã€‚<br/>
âœ… æœ¬æ–‡å°†å½»åº•å˜æ¸…æ¦‚å¿µæ··æ·†ï¼Œå‰–æç³»ç»Ÿçº§æ¨¡ç³Šåº•å±‚é€»è¾‘ï¼Œå¹¶æä¾›æ™®é€šåº”ç”¨å¯è½åœ°çš„æ›¿ä»£æ–¹æ¡ˆã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">ä¸€ã€æ¦‚å¿µæ­£æœ¬æ¸…æºï¼šç ´é™¤â€œBackgroundBlurDrawableå¯ç›´æ¥ä½¿ç”¨â€çš„è¿·æ€</h2>
<h3 data-id="heading-1">âŒ å¸¸è§è¯¯è§£</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// é”™è¯¯ç¤ºä¾‹ï¼šå°è¯•ç›´æ¥ä½¿ç”¨BackgroundBlurDrawableï¼ˆç¼–è¯‘å³å¤±è´¥ï¼ï¼‰</span>
<span class="hljs-keyword">import</span> com.android.internal.widget.BackgroundBlurDrawable; <span class="hljs-comment">// âš ï¸ éšè—APIï¼Œæ™®é€šåº”ç”¨æ— æ³•è®¿é—®</span>
</code></pre>
<ul>
<li><strong>çœŸç›¸</strong>ï¼šè¯¥ç±»ä½äºAOSP <code>frameworks/base/core/java/com/android/internal/widget/</code>ï¼Œè¢«<code>@hide</code>æ³¨è§£æ ‡è®°ï¼Œä»…ç³»ç»Ÿè¿›ç¨‹ï¼ˆå¦‚SystemUIï¼‰å¯ç”¨ã€‚</li>
<li><strong>æ··æ·†æ ¹æº</strong>ï¼šéƒ¨åˆ†æŠ€æœ¯åšå®¢å°†â€œçª—å£æ¨¡ç³Šæ•ˆæœâ€ç¬¼ç»Ÿç§°ä¸ºâ€œBackgroundBlurDrawableå®ç°â€ï¼Œå¯¼è‡´å¼€å‘è€…è¯¯ä»¥ä¸ºå­˜åœ¨å…¬å¼€Drawableç±»ã€‚</li>
</ul>
<h3 data-id="heading-2">âœ… æ­£ç¡®æŠ€æœ¯æ ˆå®šä½</h3>



































<table><thead><tr><th>æŠ€æœ¯æ–¹æ¡ˆ</th><th>é€‚ç”¨åœºæ™¯</th><th>å¯ç”¨æ€§</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td><strong>WindowManager Blur API</strong></td><td>ç³»ç»Ÿåº”ç”¨/å®šåˆ¶ROM</td><td>éœ€ç³»ç»Ÿç­¾å</td><td>Android 12+</td></tr><tr><td><strong>RenderScript / R8</strong></td><td>æ™®é€šåº”ç”¨å±€éƒ¨æ¨¡ç³Š</td><td>âœ… æ¨è</td><td>æ€§èƒ½å¯æ§</td></tr><tr><td><strong>BlurViewå¼€æºåº“</strong></td><td>æ™®é€šåº”ç”¨UIæ¨¡ç³Š</td><td>âœ… é¦–é€‰</td><td>ç¤¾åŒºç»´æŠ¤æˆç†Ÿ</td></tr><tr><td><code>BackgroundBlurDrawable</code></td><td>ç³»ç»Ÿå†…éƒ¨å®ç°</td><td>âŒ ä¸å¯ç”¨</td><td>ä»…ä½œåŸç†åˆ†æ</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-3">äºŒã€Window Blurå®æˆ˜ï¼šç³»ç»Ÿçº§æ¨¡ç³Šçš„æ­£ç¡®æ‰“å¼€æ–¹å¼ï¼ˆä»…é™ç³»ç»Ÿåº”ç”¨ï¼‰</h2>
<h3 data-id="heading-4">1ï¸âƒ£ å¯ç”¨çª—å£æ¨¡ç³Šï¼ˆéœ€ç³»ç»Ÿç­¾å + <code>BLUR_BEHIND</code>æƒé™ï¼‰</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// AndroidManifest.xmlï¼ˆç³»ç»Ÿåº”ç”¨ä¸“å±ï¼‰</span>
&lt;uses-permission android:name=<span class="hljs-string">"android.permission.BLUR_BEHIND"</span> 
    android:protectionLevel=<span class="hljs-string">"signature|system"</span> /&gt;

<span class="hljs-comment">// Activityä¸­è®¾ç½®</span>
window.addFlags(WindowManager.LayoutParams.FLAG_BLUR_BEHIND)
<span class="hljs-keyword">val</span> params = window.attributes
params.blurBehindRadius = <span class="hljs-number">30</span> <span class="hljs-comment">// æ¨¡ç³ŠåŠå¾„(åƒç´ )</span>
params.blurBehindFlags = 
    WindowManager.LayoutParams.BLUR_BEHIND_FLAG_USE_BLUR_COLOR or
    WindowManager.LayoutParams.BLUR_BEHIND_FLAG_USE_ALPHA
params.blurBehindColor = Color.argb(<span class="hljs-number">100</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>) <span class="hljs-comment">// å åŠ è‰²</span>
window.attributes = params
</code></pre>
<h3 data-id="heading-5">2ï¸âƒ£ ç³»ç»Ÿå†…éƒ¨å¦‚ä½•å·¥ä½œï¼Ÿï¼ˆAOSPæºç è§†è§’ï¼‰</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// WindowManagerService.java (ç®€åŒ–é€»è¾‘)</span>
<span class="hljs-keyword">if</span> (params.blurBehindRadius &gt; <span class="hljs-number">0</span> &amp;&amp; hasBlurPermission) {
    <span class="hljs-comment">// åˆ›å»ºBackgroundBlurDrawableå¹¶è®¾ç½®ä¸ºçª—å£èƒŒæ™¯</span>
    <span class="hljs-type">BackgroundBlurDrawable</span> <span class="hljs-variable">blurDrawable</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BackgroundBlurDrawable</span>();
    blurDrawable.setBlurRadius(params.blurBehindRadius);
    blurDrawable.setColor(params.blurBehindColor);
    window.setBackgroundDrawable(blurDrawable); <span class="hljs-comment">// ç³»ç»Ÿå†…éƒ¨è°ƒç”¨</span>
}
</code></pre>
<ul>
<li><strong>å…³é”®ç‚¹</strong>ï¼š<code>BackgroundBlurDrawable</code>ç”±WMSåŠ¨æ€åˆ›å»ºï¼Œæ™®é€šåº”ç”¨çª—å£æ— æƒè§¦å‘æ­¤æµç¨‹ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-6">ä¸‰ã€è¡€æ³ªBugå®å½•ï¼šWindow Bluräº”å¤§è‡´å‘½é™·é˜±</h2>
<h3 data-id="heading-7">ğŸ Bug 1ï¼šAndroid 13+ æƒé™å½»åº•å°é”ï¼ˆæœ€å¸¸è§å´©æºƒï¼‰</h3>
<pre><code class="hljs language-log" lang="log">// éç³»ç»Ÿåº”ç”¨è°ƒç”¨æ—¶LogcatæŠ¥é”™
W/WindowManager: Permission denial: blur behind requires BLUR_BEHIND permission
E/AndroidRuntime: java.lang.SecurityException: 
    Requires BLUR_BEHIND permission (signature|system)
</code></pre>
<ul>
<li><strong>æ ¹å› </strong>ï¼šAndroid 13 (API 33) å°†<code>BLUR_BEHIND</code>æƒé™ä¿æŠ¤çº§åˆ«æå‡ï¼Œ<strong>å½»åº•å…³é—­ç¬¬ä¸‰æ–¹åº”ç”¨ä½¿ç”¨é€šé“</strong>ã€‚</li>
<li><strong>å½±å“èŒƒå›´</strong>ï¼š99%çš„ä¸Šæ¶åº”ç”¨ï¼ˆGoogle Play/å›½å†…å•†åº—ï¼‰æ— æ³•ä½¿ç”¨ã€‚</li>
</ul>
<h3 data-id="heading-8">ğŸ Bug 2ï¼šå‚å•†ROMé­”æ”¹å¯¼è‡´æ•ˆæœå¤±æ•ˆ</h3>

























<table><thead><tr><th>å‚å•†</th><th>è¡¨ç°</th><th>åŸå› </th></tr></thead><tbody><tr><td>å°ç±³ (MIUI 14+)</td><td>æ¨¡ç³ŠåŒºåŸŸå…¨é»‘</td><td>ç¦ç”¨RenderScriptæ¨¡ç³Šè®¡ç®—</td></tr><tr><td>åä¸º (HarmonyOS)</td><td>ä»…çŠ¶æ€æ æ¨¡ç³Š</td><td>è‡ªå®šä¹‰WindowManagerç­–ç•¥</td></tr><tr><td>OPPO (ColorOS)</td><td>æ¨¡ç³Šé—ªçƒ</td><td>å¤šç¼“å†²åŒºæ¸²æŸ“å†²çª</td></tr></tbody></table>
<h3 data-id="heading-9">ğŸ Bug 3ï¼šåœ†è§’çª—å£æ¨¡ç³Šæº¢å‡ºï¼ˆBackgroundBlurDrawableè£å‰ªç¼ºé™·ï¼‰</h3>
<ul>
<li><strong>ç°è±¡</strong>ï¼šå½“Activityè®¾ç½®<code>android:radius="16dp"</code>ï¼Œæ¨¡ç³ŠåŒºåŸŸä»ä¸ºçŸ©å½¢ï¼Œè¾¹ç¼˜å‡ºç°â€œç™½è¾¹æ³„éœ²â€ã€‚</li>
<li><strong>AOSP Issue</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fissuetracker.google.com%2Fissues%2F221897428" target="_blank" title="https://issuetracker.google.com/issues/221897428" ref="nofollow noopener noreferrer">221897428</a>ï¼ˆå®˜æ–¹å·²ç¡®è®¤ï¼Œä¿®å¤ç¼“æ…¢ï¼‰</li>
<li><strong>ä¸´æ—¶è§„é¿</strong>ï¼š
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ç”¨FrameLayoutåŒ…è£¹å†…å®¹ï¼Œæ‰‹åŠ¨è£å‰ªæ¨¡ç³ŠåŒºåŸŸ</span>
blurContainer.clipToOutline = <span class="hljs-literal">true</span>
blurContainer.outlineProvider = <span class="hljs-keyword">object</span> : ViewOutlineProvider() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getOutline</span><span class="hljs-params">(view: <span class="hljs-type">View</span>, outline: <span class="hljs-type">Outline</span>)</span></span> {
        outline.setRoundRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, view.width, view.height, <span class="hljs-number">16f</span>.dp)
    }
}
</code></pre>
</li>
</ul>
<h3 data-id="heading-10">ğŸ Bug 4ï¼šå¤šçª—å£/åˆ†å±æ¨¡å¼ä¸‹æ¨¡ç³Šå¤±æ•ˆ</h3>
<ul>
<li><strong>è§¦å‘æ¡ä»¶</strong>ï¼šè®¾å¤‡å¼€å¯åˆ†å±ï¼Œæ¨¡ç³Šçª—å£è¿›å…¥åå°ã€‚</li>
<li><strong>æ—¥å¿—ç‰¹å¾</strong>ï¼š<code>W/BackgroundBlurDrawable: Skipping blur render for non-visible window</code></li>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šç›‘å¬<code>onMultiWindowModeChanged</code>ï¼ŒåŠ¨æ€å…³é—­/é‡å¯æ¨¡ç³Šã€‚</li>
</ul>
<h3 data-id="heading-11">ğŸ Bug 5ï¼šå†…å­˜æ³„æ¼ï¼ˆç³»ç»Ÿçº§éšæ‚£ï¼‰</h3>
<ul>
<li><strong>LeakCanaryæ£€æµ‹</strong>ï¼š<code>BackgroundBlurDrawable</code>æŒæœ‰<code>SurfaceControl</code>æœªé‡Šæ”¾ã€‚</li>
<li><strong>è§¦å‘åœºæ™¯</strong>ï¼šå¿«é€Ÿè¿ç»­æ‰“å¼€/å…³é—­æ¨¡ç³Šçª—å£ï¼ˆå¦‚Dialogé¢‘ç¹å¼¹å‡ºï¼‰ã€‚</li>
<li><strong>è§„é¿å»ºè®®</strong>ï¼šç³»ç»Ÿåº”ç”¨éœ€åœ¨<code>onDestroy</code>ä¸­æ˜¾å¼æ¸…é™¤ï¼š
<pre><code class="hljs language-java" lang="java">window.clearFlags(WindowManager.LayoutParams.FLAG_BLUR_BEHIND);
</code></pre>
</li>
</ul>
<hr/>
<h2 data-id="heading-12">å››ã€æ™®é€šåº”ç”¨ç ´å±€æ–¹æ¡ˆï¼šä¸‰æ‹›å®ç°å®‰å…¨å¯æ§çš„æ¨¡ç³Šæ•ˆæœ</h2>
<h3 data-id="heading-13">âœ… æ–¹æ¡ˆ1ï¼šBlurViewï¼ˆGitHub 18k+ starsï¼‰â€”â€” é¦–é€‰æ¨è</h3>
<pre><code class="hljs language-gradle" lang="gradle">// build.gradle
implementation 'com.github.mmin18:realtimeblurview:1.2.1'
</code></pre>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- å¸ƒå±€æ–‡ä»¶ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">com.github.mmin18.widget.RealtimeBlurView</span>
    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span>
    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"200dp"</span>
    <span class="hljs-attr">app:realtimeBlurRadius</span>=<span class="hljs-string">"15dp"</span>
    <span class="hljs-attr">app:realtimeOverlayColor</span>=<span class="hljs-string">"#80000000"</span>/&gt;</span>
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>è‡ªåŠ¨é€‚é…Viewå±‚çº§å˜åŒ–</li>
<li>æ”¯æŒç¡¬ä»¶åŠ é€Ÿï¼Œæ€§èƒ½ä¼˜äºRenderScript</li>
<li>æ— æƒé™è¦æ±‚ï¼Œå®Œç¾å…¼å®¹Android 35</li>
</ul>
<h3 data-id="heading-14">âœ… æ–¹æ¡ˆ2ï¼šViewBinding + RenderScriptï¼ˆè½»é‡çº§ï¼‰</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">blurBitmap</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>, source: <span class="hljs-type">Bitmap</span>, radius: <span class="hljs-type">Float</span>)</span></span>: Bitmap {
    <span class="hljs-keyword">val</span> rs = RenderScript.create(context)
    <span class="hljs-keyword">val</span> input = Allocation.createFromBitmap(rs, source)
    <span class="hljs-keyword">val</span> output = Allocation.createTyped(rs, input.type)
    <span class="hljs-keyword">val</span> script = ScriptIntrinsicBlur.create(rs, Element.U8_4(rs))
    script.setRadius(radius.coerceIn(<span class="hljs-number">0f</span>, <span class="hljs-number">25f</span>)) <span class="hljs-comment">// é™åˆ¶èŒƒå›´é˜²å´©æºƒ</span>
    script.setInput(input)
    script.forEach(output)
    <span class="hljs-keyword">val</span> result = Bitmap.createBitmap(source.width, source.height, source.config)
    output.copyTo(result)
    rs.destroy()
    <span class="hljs-keyword">return</span> result
}
</code></pre>
<p><strong>æ³¨æ„</strong>ï¼šAndroid 12+éœ€åœ¨<code>build.gradle</code>ä¸­å¯ç”¨ï¼š</p>
<pre><code class="hljs language-gradle" lang="gradle">android {
    defaultConfig {
        renderscriptTargetApi 23
        renderscriptSupportModeEnabled true
    }
}
</code></pre>
<h3 data-id="heading-15">âœ… æ–¹æ¡ˆ3ï¼šCompose Blur Modifierï¼ˆæœªæ¥è¶‹åŠ¿ï¼‰</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@OptIn(ExperimentalComposeUiApi::class)</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">BlurryBackground</span><span class="hljs-params">()</span></span> {
    Box(
        modifier = Modifier
            .fillMaxSize()
            .blur(<span class="hljs-number">16.</span>dp) <span class="hljs-comment">// Android 12+ åŸç”Ÿæ”¯æŒ</span>
            .background(Color.Black.copy(alpha = <span class="hljs-number">0.4f</span>))
    )
}
</code></pre>
<p><strong>é™åˆ¶</strong>ï¼šä»…Android 12+æœ‰æ•ˆï¼Œä½ç‰ˆæœ¬éœ€é™çº§ä¸ºåŠé€æ˜é®ç½©ã€‚</p>
<hr/>
<h2 data-id="heading-16">äº”ã€æŠ€æœ¯é€‰å‹å†³ç­–æ ‘</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[éœ€è¦é«˜æ–¯æ¨¡ç³Šï¼Ÿ] --&gt;|æ˜¯| B{åº”ç”¨ç±»å‹}
    B --&gt;|ç³»ç»Ÿåº”ç”¨/å®šåˆ¶ROM| C[ä½¿ç”¨WindowManager Blur API&lt;br/&gt;æ³¨æ„æƒé™ä¸å‚å•†å…¼å®¹æ€§]
    B --&gt;|æ™®é€šç¬¬ä¸‰æ–¹åº”ç”¨| D{æ¨¡ç³ŠèŒƒå›´}
    D --&gt;|å…¨å±/çª—å£çº§| E[æ”¾å¼ƒWindow Blur&lt;br/&gt;æ”¹ç”¨åŠé€æ˜é®ç½©+å±€éƒ¨æ¨¡ç³Š]
    D --&gt;|å±€éƒ¨UIå…ƒç´ | F[BlurViewå¼€æºåº“]
    F --&gt; G[æ€§èƒ½æ•æ„Ÿï¼Ÿ]
    G --&gt;|æ˜¯| H[RenderScript + é‡‡æ ·ä¼˜åŒ–]
    G --&gt;|å¦| I[BlurViewé»˜è®¤é…ç½®]
    E --&gt; J[ç”¨æˆ·ä½“éªŒå¦¥åæ–¹æ¡ˆ]
</code></pre>
<hr/>
<h2 data-id="heading-17">å…­ã€ç»“è¯­ï¼šç†æ€§çœ‹å¾…æŠ€æœ¯è¾¹ç•Œ</h2>
<ol>
<li><strong>æ‹’ç»å¹»æƒ³</strong>ï¼š<code>BackgroundBlurDrawable</code> å¯¹æ™®é€šå¼€å‘è€…æ˜¯â€œç©ºä¸­æ¥¼é˜â€ï¼ŒæŠ•å…¥ç ”ç©¶æˆæœ¬æé«˜ä¸”æ— äº§å‡ºã€‚</li>
<li><strong>æ‹¥æŠ±ç°å®</strong>ï¼š
<ul>
<li>ç³»ç»Ÿåº”ç”¨ï¼šç´§ç›¯AOSPæ›´æ–°ï¼Œåšå¥½å‚å•†é€‚é…çŸ©é˜µæµ‹è¯•</li>
<li>æ™®é€šåº”ç”¨ï¼š<strong>BlurViewæ˜¯å½“å‰æœ€ä¼˜è§£</strong>ï¼Œç¤¾åŒºæ´»è·ƒã€æ–‡æ¡£å®Œå–„ã€æ— å…¼å®¹é£é™©</li>
</ul>
</li>
<li><strong>æœªæ¥å±•æœ›</strong>ï¼š
<ul>
<li>Android 15 å¯èƒ½å¼€æ”¾<code>WindowInsetsController</code>æ¨¡ç³ŠAPIï¼ˆéœ€å…³æ³¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fjetpack%2Fandroidx%2Freleases%2Fwindow" target="_blank" title="https://developer.android.com/jetpack/androidx/releases/window" ref="nofollow noopener noreferrer">AndroidX Window</a>ï¼‰</li>
<li>Jetpack Compose Blur Modifier å°†æˆä¸ºè·¨ç‰ˆæœ¬æ ‡å‡†æ–¹æ¡ˆ</li>
</ul>
</li>
</ol>
<blockquote>
<p><strong>æœ€åå¿ å‘Š</strong>ï¼š<br/>
æŠ€æœ¯é€‰å‹çš„æœ¬è´¨æ˜¯ <strong>â€œåœ¨çº¦æŸæ¡ä»¶ä¸‹å¯»æ‰¾æœ€ä¼˜è§£â€</strong>ã€‚<br/>
å½“ç³»ç»Ÿå…³é—­ä¸€æ‰‡é—¨ï¼Œç¤¾åŒºæ—©å·²ä¸ºä½ æ‰“å¼€ä¸€æ‰‡çª—â€”â€”<br/>
<strong>æ”¾ä¸‹å¯¹éšè—APIçš„æ‰§å¿µï¼Œç”¨æˆç†Ÿæ–¹æ¡ˆäº¤ä»˜ç¨³å®šä½“éªŒï¼Œæ‰æ˜¯å·¥ç¨‹å¸ˆçš„çœŸæ­£æ™ºæ…§ã€‚</strong></p>
</blockquote>
<p>ğŸ“š <strong>å»¶ä¼¸é˜…è¯»</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fjetpack%2Fandroidx%2Freleases%2Fwindow" target="_blank" title="https://developer.android.com/jetpack/androidx/releases/window" ref="nofollow noopener noreferrer">AndroidX Window æ¨¡ç³ŠAPIè¿›å±•</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmmin18%2FRealtimeBlurView" target="_blank" title="https://github.com/mmin18/RealtimeBlurView" ref="nofollow noopener noreferrer">BlurView GitHubä»“åº“</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcs.android.com%2Fandroid%2Fplatform%2Fsuperproject%2F%2B%2Fmaster%3Aframeworks%2Fbase%2Fcore%2Fjava%2Fcom%2Fandroid%2Finternal%2Fwidget%2FBackgroundBlurDrawable.java" target="_blank" title="https://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/java/com/android/internal/widget/BackgroundBlurDrawable.java" ref="nofollow noopener noreferrer">AOSP BackgroundBlurDrawableæºç </a></li>
</ul>
<blockquote>
<p><strong>è½¬è½½å£°æ˜</strong>ï¼š<br/>
1ï¸âƒ£ æœ¬æ–‡ç« æœ€æ—©å‘å¸ƒäºç å®¢<br/>
2ï¸âƒ£ æ–‡ç« åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fmake.dxmwl.com%2Fp%2F69" target="_blank" title="https://make.dxmwl.com/p/69" ref="nofollow noopener noreferrer">Androidé«˜æ–¯æ¨¡ç³Šï¼šBackgroundBlurDrawableå®æˆ˜é¿å‘æŒ‡å—</a>
3ï¸âƒ£ è½¬è½½è¯·å…ˆè·å–ä½œè€…æˆæƒ</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android 15ç½‘ç»œå­ç³»ç»Ÿæ·±åº¦è§£æï¼ˆä¸€ï¼‰ï¼šConnectivityServiceä¸ç½‘ç»œç®¡ç†æ¡†æ¶å…¨è§£æ]]></title>    <link>https://juejin.cn/post/7603376587652415538</link>    <guid>https://juejin.cn/post/7603376587652415538</guid>    <pubDate>2026-02-06T10:47:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603376587652415538" data-draft-id="7603556326815809588" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android 15ç½‘ç»œå­ç³»ç»Ÿæ·±åº¦è§£æï¼ˆä¸€ï¼‰ï¼šConnectivityServiceä¸ç½‘ç»œç®¡ç†æ¡†æ¶å…¨è§£æ"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-02-06T10:47:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·341408199125"/> <meta itemprop="url" content="https://juejin.cn/user/570004686782272"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android 15ç½‘ç»œå­ç³»ç»Ÿæ·±åº¦è§£æï¼ˆä¸€ï¼‰ï¼šConnectivityServiceä¸ç½‘ç»œç®¡ç†æ¡†æ¶å…¨è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/570004686782272/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·341408199125
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T10:47:09.000Z" title="Fri Feb 06 2026 10:47:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»50åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0"><strong>1ã€ConnectivityService æ¶æ„æ€»è§ˆ</strong></h3>
<h4 data-id="heading-1"><strong>1.1 æ ¸å¿ƒèŒè´£ä¸è®¾è®¡ç†å¿µ</strong></h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-operator">ã€</span><span class="hljs-type">ConnectivityService</span> çš„äº”å¤§æ ¸å¿ƒèŒè´£<span class="hljs-operator">ã€‘</span>
<span class="hljs-operator">â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>

<span class="hljs-number">1</span>ï¸âƒ£ ç½‘ç»œç›‘æ§ä¸å‘ç°ï¼ˆ<span class="hljs-type">Network</span> <span class="hljs-type">Monitoring</span> &amp; <span class="hljs-type">Discoveryï¼‰</span>
<span class="hljs-operator">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>

æ ¸å¿ƒåŠŸèƒ½ï¼š
<span class="hljs-operator">â”œâ”€</span> ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£çš„çŠ¶æ€å˜åŒ–
<span class="hljs-operator">â”œâ”€</span> æ£€æµ‹æ–°ç½‘ç»œçš„å‡ºç°ï¼ˆ<span class="hljs-type">WiFi</span><span class="hljs-operator">ã€</span><span class="hljs-type">LTE</span><span class="hljs-operator">ã€</span><span class="hljs-type">Ethernet</span> ç­‰ï¼‰
<span class="hljs-operator">â”œâ”€</span> ç»´æŠ¤ <span class="hljs-type">NetworkAgentInfo</span> åˆ—è¡¨ï¼ˆæ‰€æœ‰å·²çŸ¥ç½‘ç»œï¼‰
<span class="hljs-operator">â”œâ”€</span> è·Ÿè¸ªç½‘ç»œçš„è¿æ¥<span class="hljs-operator">/</span>æ–­å¼€äº‹ä»¶

å®ç°æ–¹å¼ï¼š
<span class="hljs-operator">â”œâ”€</span> é€šè¿‡ <span class="hljs-type">INetworkAgent</span> <span class="hljs-type">AIDL</span> æ¥å£æ¥æ”¶æ¥è‡ªç½‘ç»œæä¾›è€…çš„æ›´æ–°
<span class="hljs-operator">â”œâ”€</span> <span class="hljs-type">NetworkAgent</span> åœ¨ç½‘ç»œçŠ¶æ€å˜åŒ–æ—¶è°ƒç”¨ï¼š
<span class="hljs-operator">â”‚</span>  <span class="hljs-operator">â”œâ”€</span> markConnected() <span class="hljs-operator">-</span> æ ‡è®°ä¸ºè¿æ¥
<span class="hljs-operator">â”‚</span>  <span class="hljs-operator">â”œâ”€</span> unregister() <span class="hljs-operator">-</span> æ ‡è®°ä¸ºæ–­å¼€
<span class="hljs-operator">â”‚</span>  <span class="hljs-operator">â””â”€</span> sendNetworkCapabilities<span class="hljs-operator">/</span><span class="hljs-type">LinkProperties</span> <span class="hljs-operator">-</span> å‘é€èƒ½åŠ›æ›´æ–°
<span class="hljs-operator">â””â”€</span> <span class="hljs-type">ConnectivityService</span> ç»´æŠ¤ç½‘ç»œåˆ—è¡¨å¹¶åŠæ—¶å“åº”

æ•°æ®ç»“æ„ï¼š
```java
<span class="hljs-comment">// æ‰€æœ‰å·²æ³¨å†Œçš„ç½‘ç»œä»£ç†</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">List</span>&lt;<span class="hljs-type">NetworkAgentInfo</span>&gt; mNetworkAgents <span class="hljs-operator">=</span> new <span class="hljs-type">ArrayList</span>&lt;&gt;();

<span class="hljs-comment">// ç½‘ç»œè¯„åˆ†ï¼ˆç”¨äºé€‰æ‹©æœ€ä½³ç½‘ç»œï¼‰</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">Map</span>&lt;<span class="hljs-type">Network</span>, <span class="hljs-type">NetworkScore</span>&gt; mNetworkScores <span class="hljs-operator">=</span> new <span class="hljs-type">HashMap</span>&lt;&gt;();

<span class="hljs-comment">// ç½‘ç»œçŠ¶æ€è·Ÿè¸ª</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">Map</span>&lt;<span class="hljs-type">Network</span>, <span class="hljs-type">NetworkInfo</span>&gt; mNetworkInfos <span class="hljs-operator">=</span> new <span class="hljs-type">HashMap</span>&lt;&gt;();
</code></pre>
<p>2ï¸âƒ£ ç½‘ç»œè¯·æ±‚åŒ¹é…ä¸è·¯ç”±ï¼ˆNetwork Request Matching &amp; Routingï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>æ ¸å¿ƒåŠŸèƒ½ï¼š
â”œâ”€ ç®¡ç†åº”ç”¨çš„ç½‘ç»œè¯·æ±‚ï¼ˆNetworkRequestï¼‰
â”œâ”€ åŒ¹é…ç½‘ç»œä¸è¯·æ±‚çš„å…³ç³»
â”œâ”€ ä¸ºåº”ç”¨åˆ†é…æœ€åˆé€‚çš„ç½‘ç»œ
â”œâ”€ å¤„ç†ç½‘ç»œåˆ‡æ¢é€»è¾‘</p>
<p>è¯·æ±‚ç±»å‹ï¼š
â”œâ”€ LISTEN è¯·æ±‚ï¼šç›‘å¬ç‰¹å®šç½‘ç»œï¼ˆä¸ä½¿ç”¨ï¼‰
â”œâ”€ REQUEST è¯·æ±‚ï¼šè¦æ±‚ç‰¹å®šç½‘ç»œï¼ˆä½¿ç”¨ï¼‰
â”œâ”€ TRACK_DEFAULT è¯·æ±‚ï¼šè·Ÿè¸ªé»˜è®¤ç½‘ç»œå˜åŒ–
â””â”€ LISTEN_FOR_BEST è¯·æ±‚ï¼šç›‘å¬æœ€å¥½çš„ç½‘ç»œ</p>
<p>åŒ¹é…ç®—æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rematchAllNetworksAndRequests</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// æ­¥éª¤ 1ï¼šè·å–æ‰€æœ‰ç½‘ç»œï¼ŒæŒ‰è¯„åˆ†æ’åºï¼ˆä»é«˜åˆ°ä½ï¼‰</span>
    List&lt;NetworkAgentInfo&gt; sorted = sortNetworksByScore(mNetworkAgents);
    
    <span class="hljs-comment">// æ­¥éª¤ 2ï¼šå¯¹äºæ¯ä¸ªç½‘ç»œï¼Œæ‰¾å‡ºæ»¡è¶³æ¡ä»¶çš„æ‰€æœ‰è¯·æ±‚</span>
    <span class="hljs-keyword">for</span> (NetworkAgentInfo nai : sorted) {
        <span class="hljs-keyword">for</span> (NetworkRequestInfo nri : mNetworkRequests) {
            <span class="hljs-keyword">if</span> (networkSatisfiesRequest(nai, nri.request)) {
                <span class="hljs-comment">// æ­¥éª¤ 3ï¼šä¸ºè¯·æ±‚åˆ†é…ç½‘ç»œ</span>
                allocateNetworkForRequest(nai, nri);
            }
        }
    }
    
    <span class="hljs-comment">// æ­¥éª¤ 4ï¼šé€šçŸ¥åº”ç”¨æœ‰æ–°ç½‘ç»œå¯ç”¨</span>
    notifyNetworkCallbacks();
}
</code></pre>
<p>ç½‘ç»œåŒ¹é…çš„æ ¸å¿ƒé€»è¾‘ï¼ˆSimplifyNetworkCapabilitiesï¼‰ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">networkSatisfiesRequest</span><span class="hljs-params">(
    NetworkAgentInfo nai, NetworkRequest request)</span> {
    
    <span class="hljs-type">NetworkCapabilities</span> <span class="hljs-variable">caps</span> <span class="hljs-operator">=</span> nai.networkCapabilities;
    
    <span class="hljs-comment">// æ£€æŸ¥ REQUIRED èƒ½åŠ›ï¼ˆå¿…é¡»æ»¡è¶³ï¼‰</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> reqCap : request.getCapabilities()) {
        <span class="hljs-keyword">if</span> (!caps.hasCapability(reqCap)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// âŒ ç½‘ç»œä¸æ»¡è¶³è¦æ±‚</span>
        }
    }
    
    <span class="hljs-comment">// æ£€æŸ¥ UNWANTED èƒ½åŠ›ï¼ˆä¸èƒ½æœ‰ï¼‰</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> unwantedCap : request.getUnwantedCapabilities()) {
        <span class="hljs-keyword">if</span> (caps.hasCapability(unwantedCap)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// âŒ ç½‘ç»œæœ‰ä¸éœ€è¦çš„èƒ½åŠ›</span>
        }
    }
    
    <span class="hljs-comment">// å¦‚æœæŒ‡å®šäº†ç‰¹å®šä¼ è¾“æ–¹å¼</span>
    <span class="hljs-keyword">if</span> (request.hasTransportType()) {
        <span class="hljs-keyword">if</span> (!caps.hasTransport(request.getTransport())) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// âŒ ä¼ è¾“æ–¹å¼ä¸åŒ¹é…</span>
        }
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  <span class="hljs-comment">// âœ“ ç½‘ç»œæ»¡è¶³æ‰€æœ‰è¦æ±‚</span>
}
</code></pre>
<p>3ï¸âƒ£ ç½‘ç»œçŠ¶æ€ä¸ŠæŠ¥ä¸å¹¿æ’­ï¼ˆNetwork State Reporting &amp; Broadcastingï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>æ ¸å¿ƒåŠŸèƒ½ï¼š
â”œâ”€ æ”¶é›†ç½‘ç»œçŠ¶æ€ä¿¡æ¯ï¼ˆè¿æ¥ã€æ–­å¼€ã€èƒ½åŠ›å˜åŒ–ç­‰ï¼‰
â”œâ”€ é€šçŸ¥åº”ç”¨ç½‘ç»œå˜åŒ–ï¼ˆé€šè¿‡ NetworkCallbackï¼‰
â”œâ”€ å‘é€ CONNECTIVITY_ACTION å¹¿æ’­ç»™ç³»ç»Ÿ
â”œâ”€ æ›´æ–°é»˜è®¤ç½‘ç»œ</p>
<p>ç½‘ç»œçŠ¶æ€å˜åŒ–çš„ä¸ŠæŠ¥æµç¨‹ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">NetworkAgent çŠ¶æ€å˜åŒ–
        â†“
ConnectivityService<span class="hljs-selector-class">.handleNetworkInfoChange</span>()
        â†“
<span class="hljs-built_in">notifyNetworkCallbacks</span>(nai, callbackType)
        â†“
é€šçŸ¥æ‰€æœ‰ç›‘å¬è¯¥ç½‘ç»œçš„ NetworkCallback
        â†“
App æ”¶åˆ°å›è°ƒ
    â”œâ”€ <span class="hljs-built_in">onAvailable</span>(Network)
    â”œâ”€ <span class="hljs-built_in">onCapabilitiesChanged</span>(Network, caps)
    â”œâ”€ <span class="hljs-built_in">onLinkPropertiesChanged</span>(Network, lp)
    â””â”€ <span class="hljs-built_in">onLost</span>(Network)
</code></pre>
<p>æ‰€æœ‰æ”¯æŒçš„å›è°ƒç±»å‹ï¼ˆCallbackTypeï¼‰ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Framework èƒ½åŠ›ç›¸å…³</span>
CALLBACK_PRECHECK           <span class="hljs-comment">// ç½‘ç»œé¢„æ£€æŸ¥ï¼ˆéªŒè¯å‰ï¼‰</span>
CALLBACK_AVAILABLE          <span class="hljs-comment">// ç½‘ç»œå¯ç”¨</span>
CALLBACK_LOSING             <span class="hljs-comment">// ç½‘ç»œå³å°†ä¸§å¤±ï¼ˆLinger çŠ¶æ€ï¼‰</span>
CALLBACK_LOST               <span class="hljs-comment">// ç½‘ç»œå·²ä¸§å¤±</span>
CALLBACK_UNAVAILABLE        <span class="hljs-comment">// ç½‘ç»œä¸å¯ç”¨</span>

<span class="hljs-comment">// èƒ½åŠ›ä¸å±æ€§å˜åŒ–</span>
CALLBACK_CAPABILITIES_CHANGED     <span class="hljs-comment">// èƒ½åŠ›å˜åŒ–</span>
CALLBACK_LINK_PROPERTIES_CHANGED  <span class="hljs-comment">// é“¾è·¯å±æ€§å˜åŒ–</span>
CALLBACK_IP_CHANGED               <span class="hljs-comment">// IP åœ°å€å˜åŒ–</span>

<span class="hljs-comment">// éªŒè¯ç›¸å…³</span>
CALLBACK_NETWORK_STATE_CHANGED    <span class="hljs-comment">// ç½‘ç»œéªŒè¯çŠ¶æ€å˜åŒ–</span>
CALLBACK_PROVISIONING_CHANGED     <span class="hljs-comment">// é…ç½®çŠ¶æ€å˜åŒ–</span>

<span class="hljs-comment">// é«˜çº§å›è°ƒ</span>
CALLBACK_BLK_CHANGED              <span class="hljs-comment">// é˜»å¡çŠ¶æ€å˜åŒ–</span>
CALLBACK_SUSPENDED                <span class="hljs-comment">// ç½‘ç»œæš‚åœ</span>
CALLBACK_RESUMED                  <span class="hljs-comment">// ç½‘ç»œæ¢å¤</span>
</code></pre>
<p>4ï¸âƒ£ ç½‘ç»œéªŒè¯ä¸è¯„ä¼°ï¼ˆNetwork Validation &amp; Assessmentï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>æ ¸å¿ƒåŠŸèƒ½ï¼š
â”œâ”€ ç¡®å®šç½‘ç»œæ˜¯å¦æœ‰çœŸæ­£çš„äº’è”ç½‘è¿æ¥
â”œâ”€ æ£€æµ‹æ˜¯å¦å­˜åœ¨å¼ºåˆ¶é—¨æˆ·ï¼ˆCaptive Portalï¼‰
â”œâ”€ è¯„ä¼°ç½‘ç»œçš„è¿é€šæ€§è´¨é‡
â”œâ”€ æ ¹æ®éªŒè¯ç»“æœæ›´æ–°ç½‘ç»œèƒ½åŠ›</p>
<p>éªŒè¯è¿‡ç¨‹ï¼ˆ3 ä¸ªé˜¶æ®µï¼‰ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">é˜¶æ®µ</span> <span class="hljs-attr">1:</span> <span class="hljs-string">ç½‘ç»œè¿æ¥</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">NetworkAgent</span> <span class="hljs-string">è°ƒç”¨</span> <span class="hljs-string">markConnected()</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">ç½‘ç»œæ ‡è®°ä¸ºå·²è¿æ¥ï¼ˆLOCAL_NETWORK</span> <span class="hljs-string">é™¤å¤–ï¼‰</span>
<span class="hljs-string">â””â”€</span> <span class="hljs-string">å¦‚æœç½‘ç»œæ»¡è¶³</span> <span class="hljs-string">INTERNET</span> <span class="hljs-string">è¦æ±‚ï¼Œè¿›å…¥éªŒè¯</span>

<span class="hljs-string">é˜¶æ®µ</span> <span class="hljs-attr">2:</span> <span class="hljs-string">NetworkMonitor</span> <span class="hljs-string">æ¢æµ‹</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">å‘é€</span> <span class="hljs-string">HTTP</span> <span class="hljs-string">è¯·æ±‚åˆ°</span> <span class="hljs-string">captive</span> <span class="hljs-string">portal</span> <span class="hljs-string">æ£€æµ‹æœåŠ¡å™¨</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">æ£€æŸ¥</span> <span class="hljs-string">HTTP</span> <span class="hljs-string">é‡å®šå‘ï¼ˆå¼ºåˆ¶é—¨æˆ·ï¼‰</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">å‘é€</span> <span class="hljs-string">DNS</span> <span class="hljs-string">æŸ¥è¯¢ï¼ˆDNS</span> <span class="hljs-string">å¯è¾¾æ€§ï¼‰</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">éªŒè¯</span> <span class="hljs-string">HTTPSï¼ˆç§æœ‰</span> <span class="hljs-string">DNSï¼‰</span>
<span class="hljs-string">â””â”€</span> <span class="hljs-string">æ ¹æ®ç»“æœè¿”å›éªŒè¯çŠ¶æ€</span>

<span class="hljs-string">é˜¶æ®µ</span> <span class="hljs-attr">3:</span> <span class="hljs-string">æ›´æ–°</span> <span class="hljs-string">NET_CAPABILITY_VALIDATED</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">å¦‚æœæ‰€æœ‰æ¢æµ‹é€šè¿‡</span> <span class="hljs-string">â†’</span> <span class="hljs-string">æ·»åŠ </span> <span class="hljs-string">NET_CAPABILITY_VALIDATED</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">å¦‚æœå­˜åœ¨å¼ºåˆ¶é—¨æˆ·</span> <span class="hljs-string">â†’</span> <span class="hljs-string">æ·»åŠ </span> <span class="hljs-string">NET_CAPABILITY_CAPTIVE_PORTAL</span>
<span class="hljs-string">â””â”€</span> <span class="hljs-string">å¦‚æœåªæœ‰éƒ¨</span>

<span class="hljs-string">åˆ†è¿é€š</span> <span class="hljs-string">â†’</span> <span class="hljs-string">æ·»åŠ </span> <span class="hljs-string">NET_CAPABILITY_PARTIAL_CONNECTIVITY</span>
</code></pre>
<p>éªŒè¯æ—¶é—´çº¿ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">T</span>=<span class="hljs-number">0</span>: ç½‘ç»œè¿æ¥
     â””â”€ NetworkAgent.markConnected() è¢«è°ƒç”¨

<span class="hljs-attr">T</span>=<span class="hljs-number">1</span>: ConnectivityService åˆ›å»ºç½‘ç»œ
     â”œâ”€ é€šçŸ¥ NetworkMonitor å¼€å§‹éªŒè¯
     â””â”€ å¦‚æœç½‘ç»œæ»¡è¶³ INTERNET è¦æ±‚

<span class="hljs-attr">T</span>=<span class="hljs-number">2</span>-<span class="hljs-number">5</span>s: NetworkMonitor æ¢æµ‹
     â”œâ”€ HTTP GET åˆ° Google çš„æ¢æµ‹æœåŠ¡å™¨
     â”œâ”€ DNS æŸ¥è¯¢ Google åŸŸå
     â””â”€ HTTPS è¿æ¥æµ‹è¯•

<span class="hljs-attr">T</span>=<span class="hljs-number">5</span>s: éªŒè¯å®Œæˆ
     â”œâ”€ æ›´æ–° NET_CAPABILITY_VALIDATED
     â”œâ”€ å°†ç½‘ç»œæ ‡è®°ä¸º"å°±ç»ª"
     â””â”€ åº”ç”¨å¯ä»¥ä½¿ç”¨è¯¥ç½‘ç»œ
</code></pre>
<p>éªŒè¯ç»“æœï¼ˆ6 ç§ï¼‰ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> NETWORK<span class="hljs-emphasis">_VALIDATION_</span>RESULT<span class="hljs-emphasis">_VALID
   â””â”€ ç½‘ç»œå¯ä»¥è®¿é—®äº’è”ç½‘ï¼Œæ²¡æœ‰å¼ºåˆ¶é—¨æˆ·
   â””â”€ æ·»åŠ  NET_</span>CAPABILITY<span class="hljs-emphasis">_VALIDATED

2. NETWORK_</span>VALIDATION<span class="hljs-emphasis">_RESULT_</span>PARTIAL
   â””â”€ ç½‘ç»œæœ‰éƒ¨åˆ†è¿é€šï¼ˆä¾‹å¦‚åªæœ‰ IPv4 æˆ– IPv6ï¼‰
   â””â”€ æ·»åŠ  NET<span class="hljs-emphasis">_CAPABILITY_</span>PARTIAL<span class="hljs-emphasis">_CONNECTIVITY

3. NETWORK_</span>VALIDATION<span class="hljs-emphasis">_RESULT_</span>SKIPPED
   â””â”€ éªŒè¯è¢«è·³è¿‡ï¼ˆä¾‹å¦‚ LOCAL<span class="hljs-emphasis">_NETWORKï¼‰
   â””â”€ ä¸æ·»åŠ ä»»ä½•éªŒè¯èƒ½åŠ›

4. NETWORK_</span>VALIDATION<span class="hljs-emphasis">_RESULT_</span>PORTAL<span class="hljs-emphasis">_DETECTED
   â””â”€ æ£€æµ‹åˆ°å¼ºåˆ¶é—¨æˆ·
   â””â”€ æ·»åŠ  NET_</span>CAPABILITY<span class="hljs-emphasis">_CAPTIVE_</span>PORTAL

<span class="hljs-bullet">5.</span> NETWORK<span class="hljs-emphasis">_VALIDATION_</span>RESULT<span class="hljs-emphasis">_OFFLINE_</span>DETECTED
   â””â”€ ç½‘ç»œå®Œå…¨ç¦»çº¿ï¼ˆä¸èƒ½è®¿é—®ä»»ä½•å¤–éƒ¨èµ„æºï¼‰
   â””â”€ ä¸æ·»åŠ ä»»ä½•éªŒè¯èƒ½åŠ›

<span class="hljs-bullet">6.</span> NETWORK<span class="hljs-emphasis">_VALIDATION_</span>RESULT<span class="hljs-emphasis">_INVALID
   â””â”€ éªŒè¯å¤±è´¥ï¼ˆæœªçŸ¥åŸå› ï¼‰
   â””â”€ ä¸æ·»åŠ ä»»ä½•éªŒè¯èƒ½åŠ›
</span></code></pre>
<p>5ï¸âƒ£ ç½‘ç»œç­–ç•¥æ‰§è¡Œä¸æµé‡æ§åˆ¶ï¼ˆNetwork Policy &amp; Traffic Controlï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>æ ¸å¿ƒåŠŸèƒ½ï¼š
â”œâ”€ å®æ–½åå°åº”ç”¨é™åˆ¶
â”œâ”€ æ§åˆ¶æµé‡è®¡é‡ï¼ˆMeteredï¼‰
â”œâ”€ æ•°æ®ä½¿ç”¨é™åˆ¶ä¸è­¦å‘Š
â”œâ”€ çœæµé‡æ¨¡å¼ï¼ˆData Saverï¼‰
â”œâ”€ App æƒé™ä¸ç½‘ç»œè®¿é—®æ§åˆ¶</p>
<p>æµé‡æ§åˆ¶å±‚çº§ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Layer 1:</span> <span class="hljs-string">å…¨å±€ç­–ç•¥</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Background</span> <span class="hljs-string">Restrictionï¼ˆåå°é™åˆ¶ï¼‰</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Data</span> <span class="hljs-string">Saver</span> <span class="hljs-string">Modeï¼ˆçœæµé‡ï¼‰</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Doze</span> <span class="hljs-string">Modeï¼ˆæ‰“çŒç¡æ¨¡å¼ï¼‰</span>
<span class="hljs-string">â””â”€</span> <span class="hljs-string">Power</span> <span class="hljs-string">Save</span> <span class="hljs-string">Modeï¼ˆçœç”µï¼‰</span>

        <span class="hljs-string">â†“</span>
<span class="hljs-attr">Layer 2:</span> <span class="hljs-string">UID</span> <span class="hljs-string">çº§é™åˆ¶</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">åº”ç”¨æ˜¯å¦åœ¨åå°è¿è¡Œ</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">åº”ç”¨æ˜¯å¦è¢«å†»ç»“</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">åº”ç”¨æ˜¯å¦è¢«é”å®š</span>
<span class="hljs-string">â””â”€</span> <span class="hljs-string">åº”ç”¨çš„æƒé™ï¼ˆINTERNET,</span> <span class="hljs-string">ACCESS_NETWORK_STATE</span> <span class="hljs-string">ç­‰ï¼‰</span>

        <span class="hljs-string">â†“</span>
<span class="hljs-attr">Layer 3:</span> <span class="hljs-string">ç½‘ç»œçº§é™åˆ¶</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">ç½‘ç»œæ˜¯å¦è¢«è®¡é‡ï¼ˆMETEREDï¼‰</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">ç½‘ç»œæ˜¯å¦è¢«æ¼«æ¸¸ï¼ˆROAMINGï¼‰</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">ç½‘ç»œæ˜¯å¦å—é™ï¼ˆRESTRICTEDï¼‰</span>
<span class="hljs-string">â””â”€</span> <span class="hljs-string">ç½‘ç»œçš„</span> <span class="hljs-string">VPN</span> <span class="hljs-string">çŠ¶æ€</span>

        <span class="hljs-string">â†“</span>
<span class="hljs-attr">Layer 4:</span> <span class="hljs-string">BPF</span> <span class="hljs-string">é˜²ç«å¢™æ‰§è¡Œ</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">eBPF</span> <span class="hljs-string">åœ¨å†…æ ¸ç½‘ç»œæ ˆä¸­æ‹¦æˆªæ•°æ®åŒ…</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">æ ¹æ®</span> <span class="hljs-string">UID</span> <span class="hljs-string">+</span> <span class="hljs-string">Network</span> <span class="hljs-string">+</span> <span class="hljs-string">Policy</span> <span class="hljs-string">å†³å®šæ˜¯å¦è½¬å‘</span>
<span class="hljs-string">â””â”€</span> <span class="hljs-string">å®æ—¶ç”Ÿæ•ˆï¼Œæ— å»¶è¿Ÿ</span>
</code></pre>
<p>æ•°æ®æµä¸ç½‘ç»œè®¿é—®å†³ç­–ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateNetworkBlockStatus</span><span class="hljs-params">(<span class="hljs-type">int</span> uid, Network network)</span> {
    <span class="hljs-comment">// æ­¥éª¤ 1: æ£€æŸ¥åº”ç”¨æ˜¯å¦æœ‰ INTERNET æƒé™</span>
    <span class="hljs-keyword">if</span> (!hasPermission(uid, Manifest.permission.INTERNET)) {
        block(uid, network);
        <span class="hljs-keyword">return</span>;
    }
    
    <span class="hljs-comment">// æ­¥éª¤ 2: æ£€æŸ¥åº”ç”¨æ˜¯å¦åœ¨åå°</span>
    <span class="hljs-keyword">if</span> (isUidInBackground(uid)) {
        <span class="hljs-keyword">if</span> (mRestrictBackgroundEnabled) {
            block(uid, network);
            <span class="hljs-keyword">return</span>;
        }
    }
    
    <span class="hljs-comment">// æ­¥éª¤ 3: æ£€æŸ¥ç½‘ç»œæ˜¯å¦è®¡é‡</span>
    <span class="hljs-keyword">if</span> (isNetworkMetered(network)) {
        <span class="hljs-keyword">if</span> (isDataSaverEnabled() &amp;&amp; !isWhitelisted(uid)) {
            block(uid, network);
            <span class="hljs-keyword">return</span>;
        }
    }
    
    <span class="hljs-comment">// æ­¥éª¤ 4: æ£€æŸ¥ VPN å’Œç‰¹æ®Šè§’è‰²</span>
    <span class="hljs-keyword">if</span> (isNetworkVPN(network)) {
        <span class="hljs-comment">// VPN æµé‡é€šå¸¸æœ‰ç‰¹æ®Šå¤„ç†</span>
    }
    
    <span class="hljs-comment">// æ­¥éª¤ 5: é€šè¿‡ BPF é˜²ç«å¢™æ‰§è¡Œ</span>
    applyFirewallRule(uid, network, ALLOW);
}
</code></pre>
<pre><code class="hljs language-markdown" lang="markdown">
<span class="hljs-section">#### <span class="hljs-strong">**1.2 ä¸å…¶ä»–ç³»ç»ŸæœåŠ¡çš„å…³ç³»**</span></span>

</code></pre>
<p>ã€ConnectivityService çš„ä¾èµ–å…³ç³»ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-code">      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚      SystemServer               â”‚
      â”‚ (å¯åŠ¨æ‰€æœ‰ç³»ç»ŸæœåŠ¡çš„å…¥å£)        â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                â”‚
       â–¼                                â–¼
</span></code></pre>
<p>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ConnectivityService     â”‚â—„â”€â”€â”€â”¤ NetworkManagementSvc â”‚
â”‚                         â”‚    â”‚ (Netd æ¥å£)          â”‚
â”‚ æ ¸å¿ƒç½‘ç»œç®¡ç†æœåŠ¡        â”‚    â”‚                      â”‚
â”‚ - ç½‘ç»œç›‘æ§             â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ - è¯·æ±‚åŒ¹é…             â”‚             â–³
â”‚ - è·¯ç”±å†³ç­–             â”‚             â”‚
â”‚ - ç­–ç•¥æ‰§è¡Œ             â”‚      INetd æ¥å£
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                          (Linux netlink socket)
â”‚                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚             â”‚
â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NetworkMonitor                   â”‚    â”‚ DnsResolver     â”‚
â”‚ (ç½‘ç»œéªŒè¯)                       â”‚    â”‚ (DNS è§£æ)      â”‚
â”‚ - æ£€æµ‹å¼ºåˆ¶é—¨æˆ·                   â”‚    â”‚                 â”‚
â”‚ - éªŒè¯äº’è”ç½‘è¿é€šæ€§               â”‚    â”‚ ä¸ NetworkMonitor
â”‚ - æ£€æµ‹ç½‘ç»œè´¨é‡                   â”‚    â”‚ åä½œéªŒè¯ç½‘ç»œ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
<pre><code class="hljs"> â–¼
</code></pre>
<p>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WifiManager / WiFiService    â”‚     â”‚ TelephonyManager     â”‚
â”‚ (WiFi ç½‘ç»œä»£ç†)              â”‚     â”‚ (ç§»åŠ¨ç½‘ç»œä»£ç†)       â”‚
â”‚ - æ³¨å†Œ WifiNetworkAgent      â”‚     â”‚ - æ³¨å†Œ Cellular      â”‚
â”‚ - æŠ¥å‘Š WiFi çŠ¶æ€             â”‚     â”‚   NetworkAgent       â”‚
â”‚ - WiFi æ‰«æä¸è¿æ¥            â”‚     â”‚ - æŠ¥å‘Šèœ‚çªçŠ¶æ€       â”‚
â”‚                              â”‚     â”‚ - ä¿¡å·å¼ºåº¦æ›´æ–°       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
<pre><code class="hljs language-markdown" lang="markdown"> â”‚                                      â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<span class="hljs-code">                â”‚
     NetworkAgent æ¥å£ (AIDL)
                â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                            â”‚
  â–¼                            â–¼
</span></code></pre>
<p>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VpnManager       â”‚         â”‚ EthernetManager  â”‚
â”‚ (VPN ä»£ç†)       â”‚         â”‚ (ä»¥å¤ªç½‘ä»£ç†)     â”‚
â”‚                  â”‚         â”‚                  â”‚
â”‚ - VPN è¿æ¥       â”‚         â”‚ - æœ‰çº¿ç½‘ç»œ       â”‚
â”‚ - åº”ç”¨ VPN è·¯ç”±  â”‚         â”‚ - ä¼ä¸šç½‘ç»œ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
<pre><code class="hljs">
å…³é”®äº¤äº’æµï¼š

</code></pre>
<p>ã€ç½‘ç»œè¯·æ±‚çš„å®Œæ•´å¤„ç†æµç¨‹ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>åº”ç”¨å±‚
â”œâ”€ App è°ƒç”¨ ConnectivityManager.requestNetwork()
â””â”€ å‘é€ NetworkRequest åˆ° ConnectivityService</p>
<p>ConnectivityService (ä¸»çº¿ç¨‹ Handler)
â”œâ”€ æ¥æ”¶ NetworkRequestï¼ˆé€šè¿‡ Binderï¼‰
â”œâ”€ åˆ›å»º NetworkRequestInfo
â”œâ”€ è°ƒç”¨ rematchAllNetworksAndRequests()
â””â”€ å°†è¯·æ±‚å‘é€ç»™ NetworkFactory</p>
<p>NetworkFactoryï¼ˆé€šå¸¸åœ¨ WifiService æˆ– TelephonyManagerï¼‰
â”œâ”€ æ¥æ”¶è¯·æ±‚
â”œâ”€ æ£€æŸ¥æ˜¯å¦å¯ä»¥æ»¡è¶³ï¼ˆä¿¡å·å¼ºåº¦ã€èµ„æºå¯ç”¨æ€§ï¼‰
â”œâ”€ å¦‚æœå¯ä»¥ï¼šå¯åŠ¨ç½‘ç»œè¿æ¥æµç¨‹
â”œâ”€ å¦‚æœä¸èƒ½ï¼šç­‰å¾…æ¡ä»¶æ”¹å–„æˆ–æ‹’ç»
â””â”€ åˆ›å»º NetworkAgent</p>
<p>NetworkAgentï¼ˆæ–°ç½‘ç»œï¼‰
â”œâ”€ è°ƒç”¨ register() å‘ ConnectivityService æ³¨å†Œ
â”œâ”€ åˆå§‹çŠ¶æ€ï¼šCONNECTING
â”œâ”€ å¾…ç½‘ç»œå°±ç»ªï¼šè°ƒç”¨ markConnected()
â”œâ”€ çŠ¶æ€æ›´æ–°ï¼šè°ƒç”¨ sendNetworkCapabilities(), sendNetworkScore() ç­‰
â””â”€ ç½‘ç»œæ–­å¼€ï¼šè°ƒç”¨ unregister()</p>
<p>ConnectivityService å¯¹ NetworkAgent çš„å“åº”
â”œâ”€ onNetworkInfoChanged()ï¼šç½‘ç»œçŠ¶æ€å˜åŒ–
â”œâ”€ onNetworkCapabilitiesChanged()ï¼šèƒ½åŠ›å˜åŒ–
â”œâ”€ onNetworkScoreChanged()ï¼šè¯„åˆ†å˜åŒ–
â”œâ”€ è§¦å‘é‡æ–°åŒ¹é…ï¼šrematchAllNetworksAndRequests()
â”œâ”€ å‘é€éªŒè¯è¯·æ±‚ï¼šå‘é€ç»™ NetworkMonitor
â””â”€ å¹¿æ’­ç½‘ç»œå˜åŒ–ï¼šnotifyNetworkCallbacks()</p>
<p>NetworkMonitorï¼ˆéªŒè¯ç½‘ç»œï¼‰
â”œâ”€ æ¥æ”¶ç½‘ç»œä¿¡æ¯
â”œâ”€ å‘èµ· HTTP/HTTPS æ¢æµ‹
â”œâ”€ æŸ¥è¯¢ DNS
â”œâ”€ è¿”å›éªŒè¯ç»“æœï¼šVALID, PORTAL, OFFLINE ç­‰
â””â”€ ConnectivityService æ›´æ–°ç½‘ç»œèƒ½åŠ›</p>
<p>æœ€ç»ˆå›è°ƒç»™åº”ç”¨
â”œâ”€ é€šè¿‡ NetworkCallback æ¥å£
â”œâ”€ onAvailable(Network)
â”œâ”€ onCapabilitiesChanged()
â”œâ”€ åº”ç”¨å¯ä»¥å¼€å§‹ä½¿ç”¨ç½‘ç»œ
â””â”€ åº”ç”¨ getActiveNetwork() è¿”å›è¯¥ç½‘ç»œ</p>
<pre><code class="hljs language-markdown" lang="markdown">
<span class="hljs-section">#### <span class="hljs-strong">**1.3 Android 15 çš„æ¶æ„æ¼”è¿›**</span></span>

</code></pre>
<p>ã€Android 14 â†’ Android 15 çš„ä¸»è¦å˜åŒ–ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>Feature 1: æ›´ç²¾ç»†çš„ç½‘ç»œçŠ¶æ€è·Ÿè¸ª
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>Android 14:
â”œâ”€ ç½‘ç»œçŠ¶æ€ï¼šCONNECTED / DISCONNECTED
â”œâ”€ éªŒè¯çŠ¶æ€ï¼šVALIDATED / UNVALIDATED
â””â”€ åŸºæœ¬çš„è¯„åˆ†æœºåˆ¶</p>
<p>Android 15:
â”œâ”€ ç½‘ç»œçŠ¶æ€ï¼šCONNECTING, CONNECTED, DISCONNECTING, DISCONNECTED
â”œâ”€ Linger çŠ¶æ€ï¼šç½‘ç»œæ–­å¼€å‰å¯ä¿æ´»ä¸€æ®µæ—¶é—´
â”œâ”€ éªŒè¯çŠ¶æ€ç»†åˆ†ï¼š
â”‚  â”œâ”€ VALIDATEDï¼ˆæœ‰æ•ˆçš„äº’è”ç½‘è¿æ¥ï¼‰
â”‚  â”œâ”€ PARTIALï¼ˆéƒ¨åˆ†è¿é€šï¼Œä¾‹å¦‚ä»… IPv4ï¼‰
â”‚  â”œâ”€ CAPTIVE_PORTALï¼ˆå¼ºåˆ¶é—¨æˆ·ï¼‰
â”‚  â”œâ”€ PROVISIONINGï¼ˆé…ç½®ä¸­ï¼‰
â”‚  â””â”€ OFFLINEï¼ˆç¦»çº¿ï¼‰
â”œâ”€ æ›´è¯¦ç»†çš„ç½‘ç»œèƒ½åŠ›ï¼š
â”‚  â”œâ”€ OEM_PAIDï¼ˆOEM ä»˜è´¹ç½‘ç»œï¼‰
â”‚  â”œâ”€ OEM_PRIVATEï¼ˆOEM ç§æœ‰ç½‘ç»œï¼‰
â”‚  â””â”€ LOCAL_NETWORKï¼ˆæœ¬åœ°ç½‘ç»œï¼Œä¸éœ€è¦äº’è”ç½‘ï¼‰
â””â”€ NetworkScore æ›´å¤æ‚çš„è¯„åˆ†ç®—æ³•</p>
<p>Feature 2: LocalNetwork æ”¯æŒ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>é—®é¢˜ï¼šåº”ç”¨éœ€è¦è¿æ¥å±€åŸŸç½‘è®¾å¤‡ï¼ˆæ‰“å°æœºã€NAS ç­‰ï¼‰ï¼Œä½†ä¸éœ€è¦äº’è”ç½‘</p>
<p>Android 14:
â”œâ”€ LocalNetwork æ¦‚å¿µæœ‰é™
â”œâ”€ æœ¬åœ°ç½‘ç»œæ— æ³•ä¸äº’è”ç½‘ç½‘ç»œå…±å­˜
â””â”€ åº”ç”¨éœ€è¦ç‰¹æ®Šå¤„ç†</p>
<p>Android 15:
â”œâ”€ å®Œæ•´çš„ LocalNetwork æ¡†æ¶
â”œâ”€ LocalNetworkConfig å®šä¹‰æœ¬åœ°ç½‘ç»œå±æ€§
â”œâ”€ åº”ç”¨å¯ä»¥ï¼š
â”‚  â”œâ”€ ä½¿ç”¨äº’è”ç½‘ç½‘ç»œï¼ˆé»˜è®¤ï¼‰
â”‚  â”œâ”€ åŒæ—¶ä½¿ç”¨æœ¬åœ°ç½‘ç»œ
â”‚  â”œâ”€ åœ¨ä¸¤è€…ä¹‹é—´åˆ‡æ¢
â”‚  â””â”€ åˆ—ä¸¾æœ¬åœ°ç½‘ç»œè®¾å¤‡
â”œâ”€ DNS è§£ææ”¯æŒï¼š
â”‚  â”œâ”€ å±€åŸŸç½‘ mDNSï¼ˆ.local åŸŸåï¼‰
â”‚  â”œâ”€ ä¼ä¸š DNSï¼ˆActive Directoryï¼‰
â”‚  â””â”€ äº‘ç«¯ DNSï¼ˆAWS, Azure ç­‰ï¼‰
â””â”€ åº”ç”¨æ— éœ€ INTERNET æƒé™ä¹Ÿèƒ½è®¿é—®æœ¬åœ°èµ„æº</p>
<p>Feature 3: æ”¹è¿›çš„ç½‘ç»œéªŒè¯æœºåˆ¶
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>Android 14:
â”œâ”€ ç®€å•çš„ HTTP é‡å®šå‘æ£€æµ‹
â”œâ”€ ç¼ºå°‘æŸäº›åœºæ™¯ä¸‹çš„éªŒè¯æ”¯æŒ
â””â”€ éªŒè¯å¤±è´¥å¤„ç†ä¸å¤Ÿç»†è‡´</p>
<p>Android 15:
â”œâ”€ æ›´æ™ºèƒ½çš„é—¨æˆ·æ£€æµ‹ï¼š
â”‚  â”œâ”€ æ”¯æŒå¤šç§é—¨æˆ·ç±»å‹ï¼ˆWifi çƒ­ç‚¹ã€èˆªç­ WiFiï¼‰
â”‚  â”œâ”€ æ›´å¥½çš„å‡é˜³æ€§ï¼ˆfalse positiveï¼‰é¿å…
â”‚  â””â”€ æ”¯æŒè·³è¿‡å·²çŸ¥çš„è‰¯å¥½ç½‘ç»œéªŒè¯
â”œâ”€ éšç§ DNS éªŒè¯ï¼š
â”‚  â”œâ”€ æ”¯æŒ DNS-over-HTTPS (DoH)
â”‚  â”œâ”€ æ”¯æŒ DNS-over-TLS (DoT)
â”‚  â””â”€ æ”¯æŒç§æœ‰ DNS è½¬å‘
â”œâ”€ éƒ¨åˆ†è¿é€šæ€§å¤„ç†ï¼š
â”‚  â”œâ”€ IPv4-only ç½‘ç»œï¼ˆæŸäº›è¿è¥å•†ï¼‰
â”‚  â”œâ”€ IPv6-only ç½‘ç»œï¼ˆæ–°å…´è¿è¥å•†ï¼‰
â”‚  â””â”€ æ··åˆ Dual-stack æ£€æµ‹
â””â”€ éªŒè¯ç¼“å­˜ï¼š
â””â”€ ç›¸åŒ SSID/BSSID çš„ WiFi åœ¨ä¸€å°æ—¶å†…æ— éœ€é‡å¤éªŒè¯</p>
<p>Feature 4: NetworkScore æ¼”è¿›
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>Android 14:
â”œâ”€ åŸºæœ¬è¯„åˆ†ï¼ˆ-100 åˆ° +100ï¼‰
â”œâ”€ è€ƒè™‘å› ç´ ï¼š
â”‚  â”œâ”€ ç½‘ç»œç±»å‹ï¼ˆWiFi &gt; LTE &gt; 2Gï¼‰
â”‚  â”œâ”€ ä¿¡å·å¼ºåº¦
â”‚  â”œâ”€ æ˜¯å¦è®¡é‡
â”‚  â””â”€ æ˜¯å¦éªŒè¯
â””â”€ ç®€å•çš„æ’åºç®—æ³•</p>
<p>Android 15:
â”œâ”€ æ–°çš„è¯„åˆ†èŒƒå›´ï¼š0 åˆ°ä»»æ„å€¼ï¼ˆæ— ä¸Šé™ï¼‰
â”œâ”€ è€ƒè™‘å› ç´ å¢åŠ ï¼š
â”‚  â”œâ”€ å¸¦å®½ï¼ˆMBpsï¼‰
â”‚  â”œâ”€ å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰
â”‚  â”œâ”€ ä¸¢åŒ…ç‡ï¼ˆç™¾åˆ†æ¯”ï¼‰
â”‚  â”œâ”€ ç½‘ç»œç¨³å®šæ€§ï¼ˆè¿æ¥æŒç»­æ—¶é—´ï¼‰
â”‚  â”œâ”€ åœ°ç†ä½ç½®ï¼ˆä¼˜å…ˆæœ¬åœ°ç½‘ç»œï¼‰
â”‚  â””â”€ è¿è¥å•†ä¼˜å…ˆçº§è®¾ç½®ï¼ˆOEM é…ç½®ï¼‰
â”œâ”€ æ›´ç»†è‡´çš„å†³ç­–ï¼š
â”‚  â”œâ”€ WiFi 5GHz vs 2.4GHzï¼ˆä¸åŒè¯„åˆ†ï¼‰
â”‚  â”œâ”€ WiFi åŠ å¯†å¼ºåº¦ï¼ˆä¸åŒè¯„åˆ†ï¼‰
â”‚  â”œâ”€ LTE vs 5Gï¼ˆåŠ¨æ€è¯„åˆ†ï¼‰
â”‚  â””â”€ ä¸åŒ SIM å¡çš„è¯„åˆ†ï¼ˆå¤šå¡è®¾å¤‡ï¼‰
â””â”€ æœºå™¨å­¦ä¹ é¢„æµ‹ï¼š
â””â”€ åŸºäºå†å²æ•°æ®é¢„æµ‹ç½‘ç»œè´¨é‡ï¼ˆæµ‹è¯•ä¸­ï¼‰</p>
<p>Feature 5: å¤šç½‘ç»œå¹¶è¡Œä½¿ç”¨
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>Android 14:
â”œâ”€ å¤šä¸ªåº”ç”¨ä½¿ç”¨ä¸åŒç½‘ç»œï¼ˆé€šè¿‡ NetworkRequestï¼‰
â”œâ”€ ä½†é»˜è®¤ç½‘ç»œé€šå¸¸æ˜¯å•ä¸€çš„ï¼ˆWiFi æˆ– LTEï¼‰
â””â”€ åº”ç”¨å¾ˆéš¾åŒæ—¶ä½¿ç”¨å¤šä¸ªç½‘ç»œ</p>
<p>Android 15:
â”œâ”€ å®Œæ•´çš„å¤šç½‘ç»œæ ˆæ”¯æŒï¼š
â”‚  â”œâ”€ åº”ç”¨å¯ä»¥åŒæ—¶ä½¿ç”¨äº’è”ç½‘ç½‘ç»œ + æœ¬åœ°ç½‘ç»œ
â”‚  â”œâ”€ åº”ç”¨å¯ä»¥åŒæ—¶ä½¿ç”¨ WiFi + ç§»åŠ¨ç½‘ç»œï¼ˆéƒ¨åˆ†åº”ç”¨ï¼‰
â”‚  â””â”€ VPN å¯ä»¥ä¸å…¶ä»–ç½‘ç»œå…±å­˜
â”œâ”€ æ”¹è¿›çš„ DNS å¤„ç†ï¼š
â”‚  â”œâ”€ æ”¯æŒå¤šä¸ª DNS æœç´¢åˆ—è¡¨
â”‚  â”œâ”€ æ ¹æ®åŸŸåé€‰æ‹© DNS æœåŠ¡å™¨
â”‚  â””â”€ ä¼˜åŒ– DNS é‡è¯•ï¼ˆå‡å°‘å»¶è¿Ÿï¼‰
â”œâ”€ è·¯ç”±ç­–ç•¥ï¼ˆç­–ç•¥è·¯ç”±ï¼‰ï¼š
â”‚  â”œâ”€ åŸºäºç›®æ ‡åœ°å€é€‰æ‹©ç½‘ç»œ
â”‚  â”œâ”€ åŸºäºåº”ç”¨ UID é€‰æ‹©ç½‘ç»œ
â”‚  â”œâ”€ åŸºäºæµé‡ä¼˜å…ˆçº§é€‰æ‹©ç½‘ç»œ
â”‚  â””â”€ VPN æµé‡ä¼˜å…ˆçº§å¤„ç†
â””â”€ åº”ç”¨ APIï¼š
â””â”€ æ–°çš„ NetworkCapabilities å’Œ NetworkRequest é€‰é¡¹</p>
<p>Feature 6: æ”¹è¿›çš„åå°é™åˆ¶
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>Android 14:
â”œâ”€ å…¨å±€åå°é™åˆ¶
â”œâ”€ åº”ç”¨ç™½åå•æœºåˆ¶
â””â”€ é™åˆ¶ç²’åº¦è¾ƒç²—</p>
<p>Android 15:
â”œâ”€ æ›´ç»†è‡´çš„é™åˆ¶ï¼š
â”‚  â”œâ”€ æŒ‰åŠŸèƒ½é™åˆ¶ï¼ˆå®šä½ã€åå° Sync ç­‰ï¼‰
â”‚  â”œâ”€ ä¸åŒåº”ç”¨è§’è‰²çš„ä¸åŒé™åˆ¶
â”‚  â””â”€ ä¸è®¾å¤‡æ¨¡å¼å…³è”ï¼ˆçœç”µæ¨¡å¼æ—¶æ›´ä¸¥æ ¼ï¼‰
â”œâ”€ æ›´èªæ˜çš„æ£€æµ‹ï¼š
â”‚  â”œâ”€ æ£€æµ‹åº”ç”¨æ˜¯å¦åœ¨å‰å°ï¼ˆåŸºäº Visible Windowï¼‰
â”‚  â”œâ”€ æ£€æµ‹æ˜¯å¦æœ‰ç”¨æˆ·äº¤äº’
â”‚  â””â”€ æ£€æµ‹ä¼˜å…ˆçº§æ ‡ç­¾ï¼ˆPRIORITY, NORMAL, LOWï¼‰
â”œâ”€ æ”¹è¿›çš„ç™½åå•ï¼š
â”‚  â”œâ”€ åŠ¨æ€ç™½åå•ï¼ˆåŸºäºæ¡ä»¶ï¼‰
â”‚  â”œâ”€ æ—¶é—´è¡¨ç™½åå•ï¼ˆç‰¹å®šæ—¶é—´æ®µï¼‰
â”‚  â””â”€ éšç§æ„ŸçŸ¥ç™½åå•ï¼ˆæƒé™ç›¸å…³ï¼‰
â””â”€ ç”¨æˆ·é€æ˜åº¦ï¼š
â””â”€ Settings ä¸­å¯è§çš„ç½‘ç»œé™åˆ¶åŸå› </p>
<p>Feature 7: å®‰å…¨ä¸éšç§å¢å¼º
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>Android 14:
â”œâ”€ åŸºæœ¬çš„æƒé™æ£€æŸ¥
â”œâ”€ MAC åœ°å€éšè—ï¼ˆWiFiï¼‰
â””â”€ æœ‰é™çš„åŠ å¯†æ”¯æŒ</p>
<p>Android 15:
â”œâ”€ å¢å¼ºçš„æƒé™æ¨¡å‹ï¼š
â”‚  â”œâ”€ ç»†ç²’åº¦æƒé™ï¼ˆCHANGE_NETWORK_STATE åˆ†ç¦»ï¼‰
â”‚  â”œâ”€ æƒé™å§”æ‰˜ï¼ˆåº”ç”¨A å¯ä»£è¡¨åº”ç”¨B è¯·æ±‚ç½‘ç»œï¼‰
â”‚  â””â”€ æƒé™æ£€æŸ¥å®¡è®¡æ—¥å¿—
â”œâ”€ æ›´å¥½çš„éšç§ï¼š
â”‚  â”œâ”€ éšæœºåˆ¶ MAC åœ°å€ï¼ˆéšæœºåŒ–é—´éš”ï¼‰
â”‚  â”œâ”€ MAC åœ°å€æ± ç®¡ç†
â”‚  â”œâ”€ MAC åœ°å€ä¸ SSID ç»‘å®š
â”‚  â””â”€ é˜²æ­¢ MAC åœ°å€è¿½è¸ª
â”œâ”€ åŠ å¯†ç½‘ç»œç®¡ç†ï¼š
â”‚  â”œâ”€ WPA3 å®Œæ•´æ”¯æŒ
â”‚  â”œâ”€ OWEï¼ˆOpen With Encryptionï¼‰
â”‚  â”œâ”€ ä¼ä¸š EAP æ”¹è¿›
â”‚  â””â”€ IoT è®¾å¤‡ç½‘ç»œéš”ç¦»
â””â”€ æ¶æ„ç½‘ç»œé˜²æŠ¤ï¼š
â”œâ”€ æ£€æµ‹å·²çŸ¥çš„æ¶æ„ SSID
â”œâ”€ ä¸­é—´äººæ”»å‡»é˜²æŠ¤ï¼ˆHSTSï¼‰
â””â”€ DNS åŠ«æŒæ£€æµ‹</p>
<pre><code class="hljs language-yaml" lang="yaml">
<span class="hljs-meta">---
</span>
<span class="hljs-comment">### **2ã€NetworkAgent æœºåˆ¶æ·±åº¦è§£æ**</span>

<span class="hljs-comment">#### **2.1 NetworkAgent ç”Ÿå‘½å‘¨æœŸ**</span>

</code></pre>
<p>ã€å®Œæ•´çš„ NetworkAgent ç”Ÿå‘½å‘¨æœŸã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>çŠ¶æ€å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NetworkAgent ç”Ÿå‘½å‘¨æœŸ                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
<pre><code class="hljs language-scss" lang="scss">     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
     â”ƒ <span class="hljs-number">1</span>. UNREGISTERED (åˆå§‹åŒ–) â”ƒ
     â”ƒ - åˆ›å»º NetworkAgent       â”ƒ
     â”ƒ - é…ç½®åˆå§‹èƒ½åŠ›å’Œå±æ€§      â”ƒ
     â”ƒ - å°šæœªå‘ç³»ç»Ÿæ³¨å†Œ          â”ƒ
     â”—â”â”â”â”¯â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
         â”‚
         â”‚ <span class="hljs-built_in">register</span>()
         â”‚
     â”â”â”â”â–¼â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
     â”ƒ <span class="hljs-number">2</span>. REGISTERED (å·²æ³¨å†Œ)   â”ƒ
     â”ƒ - å‘ ConnectivityService â”ƒ
     â”ƒ   æ³¨å†Œ                   â”ƒ
     â”ƒ - æ”¶åˆ° <span class="hljs-built_in">onRegistered</span>()    â”ƒ
     â”ƒ - åˆå§‹çŠ¶æ€ï¼šDISCONNECTED â”ƒ
     â”—â”â”â”â”¯â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
         â”‚
         â”‚ (ç½‘ç»œè¿æ¥è¿‡ç¨‹)
         â”‚ - å‘èµ·è¿æ¥
         â”‚ - å‘é€èƒ½åŠ›/å±æ€§æ›´æ–°
         â”‚
     â”â”â”â”â–¼â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
     â”ƒ <span class="hljs-number">3</span>. CONNECTING (è¿æ¥ä¸­)   â”ƒ
     â”ƒ - ç½‘ç»œå¤„äºè¿æ¥è¿‡ç¨‹        â”ƒ
     â”ƒ - å‘ ConnectivityService  â”ƒ
     â”ƒ   å‘é€å®æ—¶æ›´æ–°            â”ƒ
     â”ƒ - ä¿¡å·å¼ºåº¦ã€IP åœ°å€ç­‰å¯èƒ½ â”ƒ
     â”ƒ   ä¸å®Œæ•´                  â”ƒ
     â”—â”â”â”â”¯â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
         â”‚
         â”‚ <span class="hljs-built_in">markConnected</span>()
         â”‚ - æ ‡è®°ç½‘ç»œå·²è¿æ¥
         â”‚ - å®Œæ•´ IP é…ç½®
         â”‚ - å¯ä»¥æ¥æ”¶æµé‡
         â”‚
     â”â”â”â”â–¼â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
     â”ƒ <span class="hljs-number">4</span>. CONNECTED (å·²è¿æ¥)    â”ƒ
     â”ƒ - L3 è¿é€šæ€§å·²å»ºç«‹         â”ƒ
     â”ƒ - åº”ç”¨å¯ä»¥ä½¿ç”¨            â”ƒ
     â”ƒ - å¯ä»¥éªŒè¯äº’è”ç½‘è¿é€šæ€§    â”ƒ
     â”ƒ - NetworkMonitor å¯å¼€å§‹   â”ƒ
     â”ƒ   éªŒè¯å·¥ä½œ                â”ƒ
     â”—â”â”â”â”¯â”â”â”â”¯â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
         â”‚   â”‚
         â”‚   â”‚ (ç½‘ç»œæ›´æ–°)
         â”‚   â”œâ”€ <span class="hljs-built_in">sendNetworkCapabilities</span>()
         â”‚   â”œâ”€ <span class="hljs-built_in">sendLinkProperties</span>()
         â”‚   â”œâ”€ <span class="hljs-built_in">sendNetworkScore</span>()
         â”‚   â””â”€ (é‡å¤å¾ªç¯)
         â”‚
         â”‚ (ç½‘ç»œæ–­å¼€æˆ–è¢«æ›¿æ¢)
         â”‚
     â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                          â”‚
â”â”â”â”â–¼â”â”â”â”â”“         â”â”â”â”â”â”â”â”â”â”â–¼â”â”â”“
â”ƒ <span class="hljs-number">5</span>a. æ­£å¸¸æ–­å¼€   â”ƒ <span class="hljs-number">5</span>b. è¢«æ›¿æ¢  â”ƒ
â”ƒ <span class="hljs-built_in">unregister</span>()   â”ƒ unregisterAfter
â”ƒ               â”ƒ <span class="hljs-built_in">Replacement</span>()
â”—â”â”â”â”¯â”â”â”â”â”›         â”—â”â”â”â”¯â”â”â”â”â”â”›
    â”‚                 â”‚
    â”‚ (ç½‘ç»œæ¸…ç†)      â”‚ (ç½‘ç»œä¿æ´»)
    â”‚ - é‡Šæ”¾èµ„æº      â”‚ - ä»æ»¡è¶³æ—§è¯·æ±‚
    â”‚ - æ–­å¼€ç½‘ç»œ      â”‚ - ä½†æ–°çš„åŒç±»ç½‘ç»œä¼˜å…ˆ
    â”‚ - åœæ­¢éªŒè¯      â”‚ - åœ¨è¶…æ—¶æˆ–æ›¿æ¢å®Œæˆæ—¶æ–­å¼€
    â”‚                 â”‚
â”â”â”â”â–¼â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â–¼â”â”â”“
â”ƒ <span class="hljs-number">6</span>. DISCONNECTED (å·²æ–­å¼€) â”ƒ
â”ƒ - ç½‘ç»œä¸å†å¯ç”¨           â”ƒ
â”ƒ - èµ„æºå·²é‡Šæ”¾             â”ƒ
â”ƒ - åº”ç”¨å¤±å»è¯¥ç½‘ç»œ         â”ƒ
â”ƒ - <span class="hljs-built_in">onDisconnected</span>() è¢«è°ƒç”¨ â”ƒ
â”ƒ - Agent ä¸å¯å†ä½¿ç”¨        â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
</code></pre>
<pre><code class="hljs language-less" lang="less">
è¯¦ç»†é˜¶æ®µè¯´æ˜ï¼š

```<span class="hljs-selector-tag">java</span>
ã€<span class="hljs-selector-tag">Stage</span> <span class="hljs-number">1</span>: åˆå§‹åŒ– (Initialization)ã€‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

<span class="hljs-comment">// WiFi ç½‘ç»œä»£ç†ç¤ºä¾‹</span>
<span class="hljs-selector-tag">WifiNetworkAgent</span> <span class="hljs-selector-tag">agent</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">WifiNetworkAgent</span>(
    context,
    looper,
    <span class="hljs-string">"WifiAgent-2.4GHz"</span>,  <span class="hljs-comment">// æ—¥å¿—æ ‡ç­¾</span>
    
    <span class="hljs-comment">// åˆå§‹ç½‘ç»œèƒ½åŠ›</span>
    new NetworkCapabilities.<span class="hljs-built_in">Builder</span>()
        .<span class="hljs-built_in">addTransportType</span>(TRANSPORT_WIFI)
        .<span class="hljs-built_in">addCapability</span>(NET_CAPABILITY_INTERNET)
        .<span class="hljs-built_in">addCapability</span>(NET_CAPABILITY_<span class="hljs-keyword">NOT</span>_METERED)
        .<span class="hljs-built_in">addCapability</span>(NET_CAPABILITY_<span class="hljs-keyword">NOT</span>_ROAMING)
        .<span class="hljs-built_in">addCapability</span>(NET_CAPABILITY_<span class="hljs-keyword">NOT</span>_SUSPENDED)
        .<span class="hljs-built_in">build</span>(),
    
    <span class="hljs-comment">// åˆå§‹é“¾è·¯å±æ€§</span>
    new LinkProperties.<span class="hljs-built_in">Builder</span>()
        .<span class="hljs-built_in">setInterfaceName</span>(<span class="hljs-string">"wlan0"</span>)
        .<span class="hljs-built_in">addLinkAddress</span>(<span class="hljs-string">"192.168.1.100/24"</span>)
        .<span class="hljs-built_in">addRoute</span>(new <span class="hljs-built_in">RouteInfo</span>(null, <span class="hljs-string">"192.168.1.1"</span>))
        .<span class="hljs-built_in">addDnsServer</span>(InetAddress.<span class="hljs-built_in">getByName</span>(<span class="hljs-string">"8.8.8.8"</span>))
        .<span class="hljs-built_in">build</span>(),
    
    <span class="hljs-comment">// åˆå§‹è¯„åˆ†</span>
    new NetworkScore.<span class="hljs-built_in">Builder</span>()
        .<span class="hljs-built_in">setTransportPrimary</span>(true)
        .<span class="hljs-built_in">setSignalStrength</span>(<span class="hljs-number">85</span>)  <span class="hljs-comment">// WiFi ä¿¡å·å¼ºåº¦ (0-100)</span>
        .<span class="hljs-built_in">build</span>(),
    
    <span class="hljs-comment">// é…ç½®</span>
    config,
    provider
);

<span class="hljs-comment">// åœ¨è¿™ä¸ªé˜¶æ®µï¼ŒAgent å·²åˆ›å»ºä½†å°šæœªæ³¨å†Œ</span>
<span class="hljs-comment">// ç½‘ç»œè¿˜ä¸è¢«ç³»ç»ŸçŸ¥é“</span>


ã€<span class="hljs-selector-tag">Stage</span> <span class="hljs-number">2</span>: æ³¨å†Œ (Registration)ã€‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

<span class="hljs-comment">// è°ƒç”¨ register() å‘ ConnectivityService æ³¨å†Œ</span>
<span class="hljs-selector-tag">agent</span><span class="hljs-selector-class">.register</span>();

â†’ <span class="hljs-selector-tag">ConnectivityService</span> å¤„ç†æµç¨‹ï¼š
â”œâ”€ åˆ›å»º <span class="hljs-selector-tag">NetworkAgentInfo</span> åŒ…è£… <span class="hljs-selector-tag">Agent</span>
â”œâ”€ æ·»åŠ åˆ° <span class="hljs-selector-tag">mNetworkAgents</span> åˆ—è¡¨
â”œâ”€ åˆ†é…å”¯ä¸€çš„ <span class="hljs-selector-tag">netId</span>
â”œâ”€ å‘é€ <span class="hljs-selector-tag">onRegistered</span>() å›è°ƒç»™ <span class="hljs-selector-tag">Agent</span>
â””â”€ è§¦å‘ç½‘ç»œé‡åŒ¹é…ï¼ˆ<span class="hljs-selector-tag">rematchAllNetworksAndRequests</span>ï¼‰

<span class="hljs-comment">// åœ¨ register() ä¸­ï¼ŒAgent åˆå§‹çŠ¶æ€æ˜¯ DISCONNECTED</span>
<span class="hljs-comment">// è¿™æ„å‘³ç€ç½‘ç»œè¿˜åœ¨è¿æ¥è¿‡ç¨‹ä¸­</span>


ã€<span class="hljs-selector-tag">Stage</span> <span class="hljs-number">3</span>: è¿æ¥ (Connecting)ã€‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

<span class="hljs-comment">// ç½‘ç»œæä¾›è€…å¼€å§‹å»ºç«‹è¿æ¥</span>
<span class="hljs-comment">// ä¾‹å¦‚ WiFi æ¨¡å—æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</span>

<span class="hljs-selector-tag">step</span> <span class="hljs-number">1</span>: æ‰«æå’Œé€‰æ‹© <span class="hljs-selector-tag">AP</span>
â”œâ”€ <span class="hljs-selector-tag">WifiManager</span><span class="hljs-selector-class">.startScan</span>()
â”œâ”€ åˆ—å‡ºå¯ç”¨ <span class="hljs-selector-tag">SSID</span>
â””â”€ é€‰æ‹©æœ€å¥½çš„ <span class="hljs-selector-tag">BSSID</span>

<span class="hljs-selector-tag">step</span> <span class="hljs-number">2</span>: å‘èµ·è¿æ¥
â”œâ”€ è°ƒç”¨ <span class="hljs-selector-tag">WifiManager</span><span class="hljs-selector-class">.connect</span>()
â”œâ”€ å‘é€ <span class="hljs-selector-tag">Association</span> <span class="hljs-selector-tag">Request</span> åˆ° <span class="hljs-selector-tag">AP</span>
â”œâ”€ <span class="hljs-selector-tag">AP</span> éªŒè¯è¯ä¹¦ï¼ˆå¦‚éœ€è¦ï¼‰
â””â”€ å»ºç«‹ <span class="hljs-number">802.11</span> è¿æ¥

<span class="hljs-selector-tag">step</span> <span class="hljs-number">3</span>: è·å– <span class="hljs-selector-tag">IP</span> åœ°å€
â”œâ”€ å‘é€ <span class="hljs-selector-tag">DHCP</span> <span class="hljs-selector-tag">Discovery</span>
â”œâ”€ æ¥æ”¶ <span class="hljs-selector-tag">DHCP</span> <span class="hljs-selector-tag">Offer</span>
â”œâ”€ å‘é€ <span class="hljs-selector-tag">DHCP</span> <span class="hljs-selector-tag">Request</span>
â””â”€ è·å¾— <span class="hljs-selector-tag">IP</span> åœ°å€ï¼Œ<span class="hljs-selector-tag">TTL</span> ç­‰ä¿¡æ¯

<span class="hljs-selector-tag">step</span> <span class="hljs-number">4</span>: å‘ <span class="hljs-selector-tag">ConnectivityService</span> æŠ¥å‘Šè¿›å±•
â”œâ”€ è°ƒç”¨ <span class="hljs-selector-tag">sendNetworkCapabilities</span>()
â”‚  â””â”€ æ›´æ–°èƒ½åŠ›ï¼ˆä¾‹å¦‚åŠ å…¥ <span class="hljs-selector-tag">IPv6</span> èƒ½åŠ›ï¼‰
â”œâ”€ è°ƒç”¨ <span class="hljs-selector-tag">sendLinkProperties</span>()
â”‚  â””â”€ æ›´æ–° <span class="hljs-selector-tag">IP</span> åœ°å€ã€<span class="hljs-selector-tag">DNS</span>ã€<span class="hljs-selector-tag">Gateway</span> ç­‰
â”œâ”€ è°ƒç”¨ <span class="hljs-selector-tag">sendNetworkScore</span>()
â”‚  â””â”€ æ›´æ–°ä¿¡å·å¼ºåº¦å¾—åˆ†
â””â”€ é‡å¤è¿™äº›è°ƒç”¨ï¼Œç›´åˆ°å®Œå…¨å°±ç»ª

<span class="hljs-comment">// åœ¨è¿™ä¸ªé˜¶æ®µï¼Œç½‘ç»œæ˜¯ CONNECTING</span>
<span class="hljs-comment">// ConnectivityService çŸ¥é“è¿™ä¸ªç½‘ç»œæ­£åœ¨å»ºç«‹</span>
<span class="hljs-comment">// ä½†åº”ç”¨å°šä¸èƒ½ä½¿ç”¨</span>


ã€<span class="hljs-selector-tag">Stage</span> <span class="hljs-number">4</span>: å·²è¿æ¥ (Connected)ã€‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

<span class="hljs-comment">// å½“ç½‘ç»œå®Œå…¨å°±ç»ªæ—¶ï¼Œè°ƒç”¨ markConnected()</span>

<span class="hljs-selector-tag">agent</span><span class="hljs-selector-class">.markConnected</span>();

â†’ <span class="hljs-selector-tag">ConnectivityService</span> å¤„ç†æµç¨‹ï¼š
â”œâ”€ æ›´æ–°ç½‘ç»œçŠ¶æ€ä¸º <span class="hljs-selector-tag">CONNECTED</span>
â”œâ”€ æ£€æŸ¥ç½‘ç»œæ˜¯å¦éœ€è¦éªŒè¯ï¼ˆæ˜¯å¦æ»¡è¶³ <span class="hljs-selector-tag">INTERNET</span> è¦æ±‚ï¼‰
â”œâ”€ å¦‚éœ€è¦ï¼Œå‘ <span class="hljs-selector-tag">NetworkMonitor</span> å‘é€éªŒè¯è¯·æ±‚
â”œâ”€ æ›´æ–° <span class="hljs-selector-tag">mNetworkAgents</span> ä¸­çš„çŠ¶æ€
â”œâ”€ è§¦å‘ç½‘ç»œé‡åŒ¹é…
â””â”€ åº”ç”¨å¯èƒ½å¼€å§‹æ¥æ”¶è¿™ä¸ªç½‘ç»œçš„å›è°ƒ

<span class="hljs-comment">// æ­¤æ—¶åº”ç”¨å¯ä»¥ï¼š</span>
â”œâ”€ é€šè¿‡ <span class="hljs-selector-tag">NetworkRequest</span> è¯·æ±‚è¯¥ç½‘ç»œ
â”œâ”€ ä½¿ç”¨ <span class="hljs-selector-tag">Network</span><span class="hljs-selector-class">.getSocketFactory</span>() è·å–å¥—æ¥å­—
â”œâ”€ å°†æµé‡å®šå‘åˆ°è¯¥ç½‘ç»œ
â””â”€ æ¥æ”¶è¯¥ç½‘ç»œçš„ <span class="hljs-selector-tag">CALLBACK_AVAILABLE</span>

<span class="hljs-comment">// ç½‘ç»œä»åœ¨éªŒè¯ä¸­ï¼ˆå¦‚æœéœ€è¦ï¼‰</span>
<span class="hljs-comment">// ç½‘ç»œå¯èƒ½æ²¡æœ‰ NET_CAPABILITY_VALIDATED èƒ½åŠ›</span>
</code></pre>
<p>å¥½çš„ï¼Œæˆ‘ç»§ç»­æ·±å…¥è®²è§£ Android 15 ç½‘ç»œå­ç³»ç»Ÿã€‚</p>
<p>ç°åœ¨è®©æˆ‘ç»§ç»­è¯¦ç»†è®²è§£ï¼š</p>
<p>å¥½çš„ï¼Œç»§ç»­è®²è§£ã€‚ç°åœ¨æˆ‘è¿›å…¥ç¬¬ 2-4 éƒ¨åˆ†çš„è¯¦ç»†è®²è§£ï¼š</p>
<hr/>
<h3 data-id="heading-2"><strong>2.2 ç½‘ç»œçŠ¶æ€ä¸ŠæŠ¥æµç¨‹ä¸å›è°ƒæœºåˆ¶</strong></h3>
<pre><code class="hljs language-scss" lang="scss">ã€NetworkAgent ä¸ŠæŠ¥ç½‘ç»œçŠ¶æ€çš„å®Œæ•´æµç¨‹ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

æ ¸å¿ƒæ¦‚å¿µï¼š
â”œâ”€ NetworkAgent ä½œä¸º"ä¿¡ä½¿"å‘ ConnectivityService ä¸ŠæŠ¥ç½‘ç»œçŠ¶æ€
â”œâ”€ é€šè¿‡ INetworkAgentRegistry AIDL æ¥å£å‘é€æ›´æ–°
â”œâ”€ ConnectivityService åœ¨ä¸“ç”¨çº¿ç¨‹å¤„ç†è¿™äº›æ›´æ–°
â””â”€ æœ€ç»ˆé€šè¿‡ NetworkCallback é€šçŸ¥åº”ç”¨

æ—¶åºä¸è°ƒç”¨é“¾ï¼š

T=<span class="hljs-number">0</span>: ç½‘ç»œäº‹ä»¶å‘ç”Ÿ (ä¾‹å¦‚è·å¾— IP åœ°å€)
     â””â”€ WiFi Driver / Telephony æ£€æµ‹åˆ°äº‹ä»¶

T=<span class="hljs-number">1</span>: NetworkAgent ä¸­çš„äº‹ä»¶å¤„ç†
     â”œâ”€ WiFiNetworkAgent.<span class="hljs-built_in">onNetworkStateChange</span>()
     â”‚  â””â”€ è°ƒç”¨ <span class="hljs-built_in">sendNetworkCapabilities</span>()
     â”‚
     â”œâ”€ <span class="hljs-built_in">sendNetworkCapabilities</span>() å®ç°ï¼š
     â”‚  â”œâ”€ åˆ›å»ºæ–°çš„ NetworkCapabilities å¯¹è±¡
     â”‚  â”œâ”€ é€šè¿‡ <span class="hljs-built_in">queueOrSendMessage</span>() æ·»åŠ åˆ°æ¶ˆæ¯é˜Ÿåˆ—
     â”‚  â””â”€ AsyncResult.<span class="hljs-built_in">forMessage</span>(mMessage)
     â”‚
     â””â”€ <span class="hljs-built_in">queueOrSendMessage</span>() å†…éƒ¨ï¼š
        â”œâ”€ æ£€æŸ¥æ˜¯å¦å¯ä»¥ç«‹å³å‘é€ï¼ˆé€šå¸¸åœ¨åŒä¸€çº¿ç¨‹ï¼‰
        â”œâ”€ æˆ–å°†æ¶ˆæ¯æ’é˜Ÿåˆ° mRegistry Messenger
        â””â”€ æœ€åé€šè¿‡ Binder IPC å‘é€

T=<span class="hljs-number">2</span>: IPC ä¼ è¾“ (Binder)
     â””â”€ AIDL å‚æ•°åºåˆ—åŒ–
        â”œâ”€ NetworkCapabilities è¢« Parcel åŒ–
        â””â”€ é€šè¿‡ Binder å†…æ ¸é©±åŠ¨ä¼ è¾“

T=<span class="hljs-number">3</span>: ConnectivityService æ¥æ”¶ (Handler Thread)
     â”œâ”€ Messenger ä¸­çš„ Handler æ”¶åˆ°æ¶ˆæ¯
     â”œâ”€ è°ƒç”¨ NetworkAgentMessageHandler.<span class="hljs-built_in">handleMessage</span>()
     â”œâ”€ æ ¹æ®æ¶ˆæ¯ç±»å‹åˆ†æ´¾ï¼š
     â”‚  â”œâ”€ ASYNCCHANNEL_CMD_SUBSCRIBE_REPLY
     â”‚  â”œâ”€ REQUEST_NETWORK
     â”‚  â”œâ”€ RELEASE_NETWORK
     â”‚  â”œâ”€ NETWORK_INFO_CHANGED
     â”‚  â”œâ”€ NETWORK_CAPABILITIES_CHANGED
     â”‚  â”œâ”€ LINK_PROPERTIES_CHANGED
     â”‚  â””â”€ ...
     â””â”€ è°ƒç”¨å¯¹åº”çš„å¤„ç†æ–¹æ³•

T=<span class="hljs-number">4</span>: ConnectivityService å¤„ç†çŠ¶æ€å˜åŒ–
     â”œâ”€ æ›´æ–° NetworkAgentInfo ä¸­çš„çŠ¶æ€
     â”œâ”€ å¯èƒ½è§¦å‘ç½‘ç»œé‡åŒ¹é…
     â”œâ”€ éªŒè¯ç½‘ç»œï¼ˆå¦‚éœ€è¦ï¼‰
     â””â”€ å¹¿æ’­é€šçŸ¥æ‰€æœ‰ç›‘å¬è€…

T=<span class="hljs-number">5</span>: åº”ç”¨å›è°ƒ (é€šè¿‡ NetworkCallback)
     â”œâ”€ åŒæ­¥ Handler çº¿ç¨‹ä¸­
     â”œâ”€ æˆ–å¼‚æ­¥é€šè¿‡ Binder å›è°ƒ
     â””â”€ åº”ç”¨æ”¶åˆ°é€šçŸ¥ï¼š
        â”œâ”€ <span class="hljs-built_in">onAvailable</span>()
        â”œâ”€ <span class="hljs-built_in">onCapabilitiesChanged</span>()
        â”œâ”€ <span class="hljs-built_in">onLinkPropertiesChanged</span>()
        â””â”€ ...


ã€<span class="hljs-number">4</span> ç§å…³é”®çš„çŠ¶æ€ä¸ŠæŠ¥æ–¹æ³•ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

<span class="hljs-number">1</span>ï¸âƒ£ <span class="hljs-built_in">sendNetworkCapabilities</span>() - èƒ½åŠ›å˜åŒ–
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ç”¨é€”ï¼š
â”œâ”€ ä¸ŠæŠ¥ç½‘ç»œçš„åŠŸèƒ½èƒ½åŠ›
â”œâ”€ ä¾‹å¦‚ï¼šæ”¯æŒ IPv6ã€è®¡é‡ã€éªŒè¯çŠ¶æ€ç­‰
â”œâ”€ åœ¨ç½‘ç»œè¿æ¥çš„ä»»ä½•é˜¶æ®µå¯è°ƒç”¨

ç¤ºä¾‹ä»£ç ï¼š
```java
public void <span class="hljs-built_in">sendNetworkCapabilities</span>(@NonNull NetworkCapabilities networkCapabilities) {
    <span class="hljs-comment">// å‚æ•°éªŒè¯</span>
    if (networkCapabilities == null) {
        throw new <span class="hljs-built_in">NullPointerException</span>("networkCapabilities is null");
    }
    
    <span class="hljs-comment">// æ„å»ºæ–°çš„èƒ½åŠ›å¯¹è±¡</span>
    NetworkCapabilities newCaps = new NetworkCapabilities<span class="hljs-selector-class">.Builder</span>(networkCapabilities)
        <span class="hljs-comment">// å¯é€‰ï¼šæ·»åŠ æˆ–ç§»é™¤èƒ½åŠ›</span>
        <span class="hljs-selector-class">.build</span>();
    
    <span class="hljs-comment">// å‘é€åˆ° ConnectivityService</span>
    <span class="hljs-comment">// å†…éƒ¨è°ƒç”¨ï¼šqueueOrSendMessage(mNetworkCapabilitiesCallback, newCaps);</span>
    <span class="hljs-built_in">queueOrSendMessage</span>(reg -&gt; reg.sendNetworkCapabilities(newCaps));
}
</code></pre>
<p>å¸¸è§çš„èƒ½åŠ›å˜åŒ–ï¼š
â”œâ”€ è·å¾— IPv6ï¼šaddCapability(NET_CAPABILITY_IPV6)
â”œâ”€ ç½‘ç»œéªŒè¯ï¼šaddCapability(NET_CAPABILITY_VALIDATED)
â”œâ”€ æ£€æµ‹é—¨æˆ·ï¼šaddCapability(NET_CAPABILITY_CAPTIVE_PORTAL)
â”œâ”€ ä¿¡å·å˜åŒ–ï¼šsetSignalStrength(85)
â””â”€ è¿é€šæ€§éƒ¨åˆ†ï¼šaddCapability(NET_CAPABILITY_PARTIAL_CONNECTIVITY)</p>
<p>ConnectivityService çš„å¤„ç†ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleNetworkCapabilitiesChanged</span><span class="hljs-params">(
    NetworkAgentInfo nai, NetworkCapabilities caps)</span> {
    
    <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦çœŸçš„å‘ç”Ÿäº†å˜åŒ–</span>
    <span class="hljs-type">NetworkCapabilities</span> <span class="hljs-variable">oldCaps</span> <span class="hljs-operator">=</span> nai.networkCapabilities;
    <span class="hljs-keyword">if</span> (oldCaps.equals(caps)) {
        <span class="hljs-keyword">return</span>;  <span class="hljs-comment">// æ— å˜åŒ–ï¼Œæ— éœ€å¤„ç†</span>
    }
    
    <span class="hljs-comment">// è®°å½•æ—¥å¿—ï¼ˆç”¨äºè°ƒè¯•ï¼‰</span>
    logNetworkEvent(nai, <span class="hljs-string">"Capabilities changed"</span>, caps);
    
    <span class="hljs-comment">// æ›´æ–°ç½‘ç»œçš„èƒ½åŠ›</span>
    nai.setNetworkCapabilities(caps);
    
    <span class="hljs-comment">// é‡æ–°è¯„ä¼°ç½‘ç»œçš„é€‚ç”¨æ€§ï¼ˆç½‘ç»œå¯èƒ½å¤±å»æŸäº›è¦æ±‚çš„èƒ½åŠ›ï¼‰</span>
    rematchAllNetworksAndRequests();
    
    <span class="hljs-comment">// é€šçŸ¥æ‰€æœ‰ç›‘å¬è€…</span>
    notifyNetworkCallbacks(nai, ConnectivityManager.CALLBACK_CAPABILITIES_CHANGED);
    
    <span class="hljs-comment">// éªŒè¯çŠ¶æ€å˜åŒ–éœ€è¦ç‰¹æ®Šå¤„ç†</span>
    <span class="hljs-keyword">if</span> (oldCaps.hasCapability(NET_CAPABILITY_VALIDATED) 
        != caps.hasCapability(NET_CAPABILITY_VALIDATED)) {
        <span class="hljs-comment">// éªŒè¯çŠ¶æ€æ”¹å˜ï¼Œæ›´æ–° NetworkMonitor</span>
        updateNetworkMonitorForValidation(nai);
    }
}
</code></pre>
<p>2ï¸âƒ£ sendLinkProperties() - é“¾è·¯å±æ€§å˜åŒ–
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>ç”¨é€”ï¼š
â”œâ”€ ä¸ŠæŠ¥ç½‘ç»œçš„ L3 å±æ€§ï¼ˆé“¾è·¯å±‚ä»¥ä¸Šï¼‰
â”œâ”€ IP åœ°å€ã€å­ç½‘æ©ç ã€ç½‘å…³ã€DNS ç­‰
â”œâ”€ è·¯ç”±ä¿¡æ¯ã€æ¥å£åç§°</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendLinkProperties</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> LinkProperties linkProperties)</span> {
    <span class="hljs-keyword">if</span> (linkProperties == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>(<span class="hljs-string">"linkProperties is null"</span>);
    }
    
    <span class="hljs-comment">// å…¸å‹åœºæ™¯ï¼šè·å¾— IP åœ°å€åæ›´æ–°</span>
    <span class="hljs-type">LinkProperties</span> <span class="hljs-variable">newProps</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkProperties</span>.Builder(linkProperties)
        .setInterfaceName(<span class="hljs-string">"wlan0"</span>)                <span class="hljs-comment">// æ¥å£å</span>
        .addLinkAddress(<span class="hljs-string">"192.168.1.100/24"</span>)      <span class="hljs-comment">// IP å’Œå­ç½‘æ©ç </span>
        .addRoute(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RouteInfo</span>(<span class="hljs-literal">null</span>, <span class="hljs-string">"192.168.1.1"</span>))  <span class="hljs-comment">// é»˜è®¤ç½‘å…³</span>
        .addDnsServer(InetAddress.getByName(<span class="hljs-string">"8.8.8.8"</span>)) <span class="hljs-comment">// DNS æœåŠ¡å™¨</span>
        .build();
    
    queueOrSendMessage(reg -&gt; reg.sendLinkProperties(newProps));
}
</code></pre>
<p>ConnectivityService çš„å¤„ç†ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleLinkPropertiesChanged</span><span class="hljs-params">(
    NetworkAgentInfo nai, LinkProperties lp)</span> {
    
    <span class="hljs-type">LinkProperties</span> <span class="hljs-variable">oldLp</span> <span class="hljs-operator">=</span> nai.linkProperties;
    <span class="hljs-keyword">if</span> (oldLp.equals(lp)) {
        <span class="hljs-keyword">return</span>;  <span class="hljs-comment">// æ— å˜åŒ–</span>
    }
    
    <span class="hljs-comment">// æ›´æ–° DNS ä¿¡æ¯ï¼ˆç³»ç»Ÿ DNS è§£æå™¨ï¼‰</span>
    updateDnsServers(nai, lp);
    
    <span class="hljs-comment">// æ›´æ–°è·¯ç”±è¡¨ï¼ˆnetdï¼‰</span>
    updateRouting(nai, lp);
    
    <span class="hljs-comment">// æ›´æ–° IP åœ°å€ï¼ˆVPNã€6to4 è½¬æ¢ç­‰ï¼‰</span>
    updateIpv6Configuration(nai, lp);
    
    <span class="hljs-comment">// é€šçŸ¥åº”ç”¨</span>
    notifyNetworkCallbacks(nai, ConnectivityManager.CALLBACK_LINK_PROPERTIES_CHANGED);
    
    <span class="hljs-comment">// å¦‚æœæ¥å£åæ”¹å˜ï¼Œæ›´æ–° BPF é˜²ç«å¢™è§„åˆ™</span>
    <span class="hljs-keyword">if</span> (!oldLp.getInterfaceName().equals(lp.getInterfaceName())) {
        updateBpfRules(nai);
    }
}
</code></pre>
<p>IP åœ°å€å˜åŒ–çš„å½±å“ï¼š
â”œâ”€ åº”ç”¨æ”¶åˆ° CALLBACK_IP_CHANGED
â”œâ”€ Socket è¿æ¥å¯èƒ½éœ€è¦é‡å»º
â”œâ”€ DNS æŸ¥è¯¢å¯èƒ½ä½¿ç”¨æ–°çš„ DNS æœåŠ¡å™¨
â””â”€ è·¯ç”±è¡¨æ”¹å˜å½±å“æµé‡è½¬å‘</p>
<p>3ï¸âƒ£ sendNetworkScore() - ç½‘ç»œè¯„åˆ†
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>ç”¨é€”ï¼š
â”œâ”€ å‘ŠçŸ¥ç³»ç»Ÿç½‘ç»œè´¨é‡ï¼ˆå¥½åï¼‰
â”œâ”€ å½±å“ç½‘ç»œé€‰æ‹©ï¼ˆå†³å®šä½¿ç”¨å“ªä¸ªç½‘ç»œï¼‰
â”œâ”€ åŠ¨æ€æ›´æ–°ï¼ˆç½‘ç»œè´¨é‡å®æ—¶å˜åŒ–ï¼‰</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendNetworkScore</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> NetworkScore score)</span> {
    <span class="hljs-keyword">if</span> (score == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>(<span class="hljs-string">"score is null"</span>);
    }
    
    <span class="hljs-comment">// è¯„åˆ†é€šå¸¸åŸºäºä¿¡å·å¼ºåº¦</span>
    <span class="hljs-comment">// WiFi: 0-100 (RSSI å¼ºåº¦)</span>
    <span class="hljs-comment">// LTE: 0-100 (RSRP å¼ºåº¦)</span>
    
    <span class="hljs-type">NetworkScore</span> <span class="hljs-variable">newScore</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkScore</span>.Builder()
        .setTransportPrimary(<span class="hljs-literal">true</span>)      <span class="hljs-comment">// æ˜¯å¦æ˜¯ä¸»è¦ä¼ è¾“æ–¹å¼</span>
        .setSignalStrength(rssiValue)   <span class="hljs-comment">// ä¿¡å·å¼ºåº¦</span>
        .setExiting(<span class="hljs-literal">false</span>)              <span class="hljs-comment">// æ˜¯å¦æ­£åœ¨é€€å‡ºï¼ˆè¢«æ›¿æ¢ï¼‰</span>
        .build();
    
    queueOrSendMessage(reg -&gt; reg.sendNetworkScore(newScore));
}
</code></pre>
<p>è¯„åˆ†å¦‚ä½•å½±å“ç½‘ç»œé€‰æ‹©ï¼ˆSimpleNetworkScorerï¼‰ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">scoreDiff</span><span class="hljs-params">(NetworkScore score1, NetworkScore score2)</span> {
    <span class="hljs-comment">// æ¯”è¾ƒä¸¤ä¸ªç½‘ç»œçš„è¯„åˆ†</span>
    <span class="hljs-comment">// è¿”å›æ­£æ•°ï¼šscore1 æ›´å¥½</span>
    <span class="hljs-comment">// è¿”å›è´Ÿæ•°ï¼šscore2 æ›´å¥½</span>
    <span class="hljs-comment">// è¿”å› 0ï¼šç›¸åŒè´¨é‡</span>
    
    <span class="hljs-comment">// WiFi é€šå¸¸è¯„åˆ†é«˜äº LTE</span>
    <span class="hljs-comment">// 5GHz WiFi é«˜äº 2.4GHz WiFi</span>
    <span class="hljs-comment">// ä¿¡å·å¼ºçš„ç½‘ç»œé«˜äºä¿¡å·å¼±çš„ç½‘ç»œ</span>
    
    <span class="hljs-comment">// å¦‚æœ score1 æ˜¯ WiFiï¼Œscore2 æ˜¯ LTEï¼š</span>
    <span class="hljs-comment">// â†’ score1 é€šå¸¸èµ¢ï¼ˆå‡è®¾ä¸¤è€…éƒ½è¿æ¥äº†ï¼‰</span>
    
    <span class="hljs-comment">// å¦‚æœéƒ½æ˜¯ WiFiï¼Œä½†ä¿¡å·ä¸åŒï¼š</span>
    <span class="hljs-comment">// â†’ ä¿¡å·å¼ºçš„èµ¢ (80dbm &gt; 70dbm)</span>
}

<span class="hljs-comment">// NetworkRanker ä½¿ç”¨è¿™ä¸ªè¯„åˆ†å†³å®šé»˜è®¤ç½‘ç»œ</span>
<span class="hljs-keyword">private</span> Network <span class="hljs-title function_">selectBestNetwork</span><span class="hljs-params">(List&lt;NetworkAgentInfo&gt; networks)</span> {
    <span class="hljs-comment">// æŒ‰è¯„åˆ†ä»é«˜åˆ°ä½æ’åº</span>
    Collections.sort(networks, (a, b) -&gt; {
        <span class="hljs-keyword">return</span> b.getScore() - a.getScore();
    });
    
    <span class="hljs-comment">// é€‰æ‹©è¯„åˆ†æœ€é«˜çš„</span>
    <span class="hljs-keyword">if</span> (!networks.isEmpty()) {
        <span class="hljs-keyword">return</span> networks.get(<span class="hljs-number">0</span>).network;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}
</code></pre>
<p>å…¸å‹çš„è¯„åˆ†å˜åŒ–åœºæ™¯ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">WiFi ä¿¡å·ä» -<span class="hljs-number">60</span>dbm å˜ä¸º -<span class="hljs-number">75</span>dbmï¼ˆå˜å¼±ï¼‰
  â†’ <span class="hljs-built_in">sendNetworkScore</span>(new NetworkScore(..., <span class="hljs-number">75</span>))  (å‡è®¾ <span class="hljs-number">75</span> åˆ†)
  â†’ ConnectivityService é‡æ–°è¯„ä¼°
  â†’ å¦‚æœè¯„åˆ†ä½äº LTEï¼Œå¯èƒ½åˆ‡æ¢åˆ° LTE

ç”¨æˆ·é è¿‘ WiFi è·¯ç”±å™¨ï¼Œä¿¡å·å˜å¼º -<span class="hljs-number">50</span>dbm
  â†’ <span class="hljs-built_in">sendNetworkScore</span>(new NetworkScore(..., <span class="hljs-number">95</span>))  (<span class="hljs-number">95</span> åˆ†)
  â†’ åˆ‡æ¢å› WiFiï¼ˆè¯„åˆ†æ›´é«˜ï¼‰
</code></pre>
<p>4ï¸âƒ£ markConnected() - æ ‡è®°ç½‘ç»œå·²è¿æ¥
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>ç”¨é€”ï¼š
â”œâ”€ è¡¨ç¤º L3 è¿é€šæ€§å·²å»ºç«‹
â”œâ”€ IP åœ°å€ã€ç½‘å…³ã€DNS éƒ½å·²é…ç½®
â”œâ”€ ç½‘ç»œå¯ä»¥æ¥å—æµé‡</p>
<p>æ–¹æ³•ç­¾åï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">markConnected</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// è¿™æ˜¯ä¸€ä¸ªæ ‡å¿—æ€§æ–¹æ³•ï¼Œè¡¨ç¤ºç½‘ç»œå·²å‡†å¤‡å°±ç»ª</span>
    <span class="hljs-comment">// ä¹‹å‰çš„ CONNECTING çŠ¶æ€ â†’ ç°åœ¨çš„ CONNECTED çŠ¶æ€</span>
    queueOrSendMessage(reg -&gt; reg.markConnected());
}
</code></pre>
<p>ConnectivityService çš„å¤„ç†ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMarkConnected</span><span class="hljs-params">(NetworkAgentInfo nai)</span> {
    <span class="hljs-keyword">if</span> (nai.getNetworkState() == NetworkInfo.State.CONNECTED) {
        <span class="hljs-keyword">return</span>;  <span class="hljs-comment">// å·²ç»è¿æ¥ï¼Œæ— éœ€å†æ¬¡å¤„ç†</span>
    }
    
    <span class="hljs-comment">// æ›´æ–°ç½‘ç»œä¿¡æ¯</span>
    <span class="hljs-type">NetworkInfo</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> nai.networkInfo;
    info.setDetailedState(NetworkInfo.DetailedState.CONNECTED, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);
    
    <span class="hljs-comment">// åˆ›å»ºç½‘ç»œï¼ˆå¦‚æœè¿˜æœªåˆ›å»ºï¼‰</span>
    <span class="hljs-comment">// è¿™ä¼šé€šçŸ¥ netd åˆ›å»º Linux ç½‘ç»œå‘½åç©ºé—´</span>
    createNetwork(nai);
    
    <span class="hljs-comment">// å¯åŠ¨éªŒè¯ï¼ˆå¦‚æœç½‘ç»œè¦æ±‚ INTERNET èƒ½åŠ›ï¼‰</span>
    <span class="hljs-keyword">if</span> (nai.networkCapabilities.hasCapability(NET_CAPABILITY_INTERNET)) {
        startNetworkMonitor(nai);  <span class="hljs-comment">// å¼€å§‹éªŒè¯ç½‘ç»œè¿é€šæ€§</span>
    }
    
    <span class="hljs-comment">// åº”ç”¨ç°åœ¨å¯ä»¥å¼€å§‹ä½¿ç”¨è¿™ä¸ªç½‘ç»œ</span>
    <span class="hljs-comment">// è§¦å‘ç½‘ç»œé‡åŒ¹é…ï¼Œåº”ç”¨å¯èƒ½ä¼š onAvailable() å›è°ƒ</span>
    rematchAllNetworksAndRequests();
}
</code></pre>
<p>markConnected() ä¹‹å‰çš„å…¸å‹çŠ¶æ€ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">step <span class="hljs-number">1</span>: <span class="hljs-built_in">register</span>() - ç½‘ç»œæ³¨å†Œï¼Œåˆå§‹çŠ¶æ€ DISCONNECTED
step <span class="hljs-number">2</span>: <span class="hljs-built_in">sendNetworkCapabilities</span>() - ä¸ŠæŠ¥åˆå§‹èƒ½åŠ›
step <span class="hljs-number">3</span>: <span class="hljs-built_in">sendLinkProperties</span>() - ä¸ŠæŠ¥åˆå§‹é“¾è·¯å±æ€§
step <span class="hljs-number">4</span>: <span class="hljs-built_in">sendNetworkScore</span>() - ä¸ŠæŠ¥åˆå§‹è¯„åˆ†
step <span class="hljs-number">5</span>: ... (å¤šæ¬¡æ›´æ–°èƒ½åŠ›/å±æ€§/è¯„åˆ†)
step <span class="hljs-number">6</span>: <span class="hljs-built_in">markConnected</span>() - âœ“ ç°åœ¨å®Œå…¨å°±ç»ª
</code></pre>
<p>æ ‡è®°ä¸ºå·²è¿æ¥åä¼šå‘ç”Ÿä»€ä¹ˆï¼š
â”œâ”€ åº”ç”¨å¯ä»¥é€šè¿‡ NetworkRequest è¯·æ±‚è¯¥ç½‘ç»œ
â”œâ”€ åº”ç”¨æ”¶åˆ° onAvailable() å›è°ƒ
â”œâ”€ ç½‘ç»œè¿›å…¥éªŒè¯æµç¨‹ï¼ˆå¦‚éœ€è¦ï¼‰
â”œâ”€ ç½‘ç»œæˆä¸ºå€™é€‰çš„é»˜è®¤ç½‘ç»œ
â””â”€ å¯ä»¥å¤„ç†åº”ç”¨æµé‡</p>
<p>ã€åº”ç”¨å›è°ƒçš„ç±»å‹ä¸é¡ºåºã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>å‡è®¾åº”ç”¨æ³¨å†Œäº† NetworkCallbackï¼š</p>
<pre><code class="hljs language-java" lang="java">ConnectivityManager.<span class="hljs-type">NetworkCallback</span> <span class="hljs-variable">callback</span> <span class="hljs-operator">=</span> 
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConnectivityManager</span>.NetworkCallback() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onAvailable</span><span class="hljs-params">(Network network)</span> {
            <span class="hljs-comment">// â† å½“ç½‘ç»œå¯ç”¨æ—¶è°ƒç”¨</span>
            <span class="hljs-comment">// æ­¤æ—¶ç½‘ç»œå·²è¿æ¥</span>
        }
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCapabilitiesChanged</span><span class="hljs-params">(Network network, 
                                         NetworkCapabilities caps)</span> {
            <span class="hljs-comment">// â† å½“ç½‘ç»œèƒ½åŠ›æ”¹å˜æ—¶è°ƒç”¨</span>
            <span class="hljs-comment">// ä¾‹å¦‚ï¼šè·å¾—éªŒè¯ã€å¤±å»éªŒè¯ç­‰</span>
        }
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onLinkPropertiesChanged</span><span class="hljs-params">(Network network, 
                                           LinkProperties lp)</span> {
            <span class="hljs-comment">// â† å½“é“¾è·¯å±æ€§æ”¹å˜æ—¶è°ƒç”¨</span>
            <span class="hljs-comment">// ä¾‹å¦‚ï¼šè·å¾— IPv6 åœ°å€</span>
        }
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onLosing</span><span class="hljs-params">(Network network, <span class="hljs-type">int</span> maxMsToLive)</span> {
            <span class="hljs-comment">// â† ç½‘ç»œå³å°†ä¸§å¤±</span>
            <span class="hljs-comment">// Linger çŠ¶æ€ï¼Œåº”ç”¨åº”å‡†å¤‡åˆ‡æ¢</span>
        }
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onLost</span><span class="hljs-params">(Network network)</span> {
            <span class="hljs-comment">// â† ç½‘ç»œå·²å®Œå…¨æ–­å¼€</span>
            <span class="hljs-comment">// ä¸å†å¯ç”¨</span>
        }
    };

<span class="hljs-comment">// æ³¨å†Œå›è°ƒ</span>
<span class="hljs-type">ConnectivityManager</span> <span class="hljs-variable">cm</span> <span class="hljs-operator">=</span> context.getSystemService(ConnectivityManager.class);
cm.registerNetworkCallback(request, callback);
</code></pre>
<p>å…¸å‹çš„å›è°ƒåºåˆ—ï¼ˆWiFi è¿æ¥è¿‡ç¨‹ï¼‰ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">T</span>=<span class="hljs-number">0</span>: ç”¨æˆ·é€‰æ‹© WiFi SSID å¹¶è¾“å…¥å¯†ç 
     â””â”€ WiFiManager å¼€å§‹è¿æ¥

<span class="hljs-attr">T</span>=<span class="hljs-number">1</span>s: WiFi è¿æ¥å»ºç«‹ï¼Œæ­£åœ¨è·å– IP
     â””â”€ NetworkAgent: sendLinkProperties()
     â””â”€ App: onLinkPropertiesChanged() <span class="hljs-section">[ä»… IP åœ°å€]</span>

<span class="hljs-attr">T</span>=<span class="hljs-number">2</span>s: IP è·å–å®Œæˆï¼Œæ ‡è®°ä¸ºè¿æ¥
     â””â”€ NetworkAgent: markConnected()
     â””â”€ ConnectivityService åˆ›å»ºç½‘ç»œ
     â””â”€ App: onAvailable(network) âœ“ ç½‘ç»œå¯ç”¨ï¼

<span class="hljs-attr">T</span>=<span class="hljs-number">3</span>s: IPv6 è‡ªåŠ¨é…ç½®å®Œæˆ
     â””â”€ NetworkAgent: sendNetworkCapabilities() <span class="hljs-section">[æ·»åŠ  IPv6]</span>
     â””â”€ App: onCapabilitiesChanged() <span class="hljs-section">[æ–°å¢ IPv6]</span>

<span class="hljs-attr">T</span>=<span class="hljs-number">4</span>s: NetworkMonitor éªŒè¯äº’è”ç½‘è¿æ¥
     â””â”€ å‘é€ HTTP æ¢æµ‹...

<span class="hljs-attr">T</span>=<span class="hljs-number">5</span>s: éªŒè¯æˆåŠŸ
     â””â”€ NetworkAgent: sendNetworkCapabilities() <span class="hljs-section">[æ·»åŠ  VALIDATED]</span>
     â””â”€ App: onCapabilitiesChanged() <span class="hljs-section">[è·å¾— VALIDATED èƒ½åŠ›]</span>
     â””â”€ ç½‘ç»œç°åœ¨æ˜¯"é«˜è´¨é‡"çš„

<span class="hljs-attr">T</span>=<span class="hljs-number">100</span>s: ç”¨æˆ·èµ°å‡º WiFi èŒƒå›´ï¼Œä¿¡å·å˜å¼±
     â””â”€ NetworkAgent: sendNetworkScore() <span class="hljs-section">[è¯„åˆ†ä¸‹é™]</span>
     â””â”€ ConnectivityService é‡æ–°è¯„ä¼°
     â””â”€ å¦‚æœ LTE è¯„åˆ†æ›´é«˜ â†’ è§¦å‘ç½‘ç»œåˆ‡æ¢

<span class="hljs-attr">T</span>=<span class="hljs-number">101</span>s: LTE æˆä¸ºæ–°çš„é»˜è®¤ç½‘ç»œ
     â””â”€ App: onAvailable(lte_network)
     â””â”€ App: onLosing(wifi_network, 120000) <span class="hljs-section">[Linger 120 ç§’]</span>
     â””â”€ WiFi æš‚æ—¶ä¿æ´»ï¼ˆå¯èƒ½é©¬ä¸Šé‡è¿ï¼‰

<span class="hljs-attr">T</span>=<span class="hljs-number">120</span>s: Linger æœŸæ»¡ï¼ŒWiFi æ–­å¼€
     â””â”€ App: onLost(wifi_network)
</code></pre>
<pre><code class="hljs language-markdown" lang="markdown">
ç°åœ¨è¿›å…¥ç¬¬ 3 éƒ¨åˆ†ï¼š

<span class="hljs-section">### <span class="hljs-strong">**3ã€NetworkFactory å·¥ä½œåŸç†**</span></span>

</code></pre>
<p>ã€NetworkFactory çš„ä¸‰å¤§æ ¸å¿ƒèŒè´£ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>NetworkFactory æ˜¯ä¸€ä¸ªå·¥å‚ç±»ï¼Œç”±ç½‘ç»œæä¾›è€…ï¼ˆå¦‚ WifiManagerã€TelephonyManagerï¼‰
åˆ›å»ºå’ŒæŒæœ‰ï¼Œç”¨äºç®¡ç†è¯¥æä¾›è€…èƒ½å¦æ»¡è¶³ç‰¹å®šçš„ç½‘ç»œè¯·æ±‚ã€‚</p>
<p>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NetworkFactory èŒè´£                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. è¯„ä¼°è¯·æ±‚                            â”‚
â”‚    â”œâ”€ è¯¥å·¥å‚èƒ½å¦æ»¡è¶³æ­¤è¯·æ±‚ï¼Ÿ          â”‚
â”‚    â”œâ”€ è¯„åˆ†æ˜¯å¤šå°‘ï¼Ÿ                    â”‚
â”‚    â””â”€ ä¾æ®ï¼šèƒ½åŠ›ã€ä¿¡å·å¼ºåº¦ç­‰          â”‚
â”‚                                        â”‚
â”‚ 2. ç®¡ç†ç½‘ç»œç”Ÿå‘½å‘¨æœŸ                    â”‚
â”‚    â”œâ”€ æ¥æ”¶è¯·æ±‚æ—¶å¯åŠ¨ç½‘ç»œ              â”‚
â”‚    â”œâ”€ æ‰€æœ‰è¯·æ±‚ç§»é™¤æ—¶å…³é—­ç½‘ç»œ          â”‚
â”‚    â””â”€ åˆ›å»º NetworkAgent               â”‚
â”‚                                        â”‚
â”‚ 3. åŠ¨æ€è°ƒæ•´è¯„åˆ†                        â”‚
â”‚    â”œâ”€ ä¿¡å·å¼ºåº¦å˜åŒ– â†’ è¯„åˆ†å˜åŒ–        â”‚
â”‚    â”œâ”€ é‡æ–°è¯„ä¼°æ‰€æœ‰è¯·æ±‚                â”‚
â”‚    â””â”€ å½±å“ç½‘ç»œé€‰æ‹©                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
<p>ã€TelephonyNetworkFactory çš„å®ç°ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>èœ‚çªç½‘ç»œå·¥å‚çš„æ ¸å¿ƒé€»è¾‘ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TelephonyNetworkFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">NetworkFactory</span> {
    
    <span class="hljs-comment">// å·¥å‚ç»´æŒçš„æ‰€æœ‰ç½‘ç»œè¯·æ±‚</span>
    <span class="hljs-keyword">private</span> Map&lt;NetworkRequest, Integer&gt; mNetworkRequests = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    
    <span class="hljs-comment">// å½“å‰ Phone å¯¹è±¡ï¼ˆå¯èƒ½æœ‰å¤šä¸ªï¼Œä»£è¡¨å¤šå¼  SIM å¡ï¼‰</span>
    <span class="hljs-keyword">private</span> Phone mPhone;
    
    <span class="hljs-comment">// å¤šå¡ç®¡ç†å™¨</span>
    <span class="hljs-keyword">private</span> PhoneSwitcher mPhoneSwitcher;
    
    <span class="hljs-comment">/**
     * Called by ConnectivityService when a new NetworkRequest is received
     * that matches this factory's filter.
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">needNetworkFor</span><span class="hljs-params">(NetworkRequest request)</span> {
        <span class="hljs-comment">// æ­¥éª¤ 1: æ£€æŸ¥æ˜¯å¦å·²æœ‰ç›¸åŒçš„è¯·æ±‚</span>
        <span class="hljs-keyword">if</span> (mNetworkRequests.containsKey(request)) {
            <span class="hljs-keyword">return</span>;  <span class="hljs-comment">// å·²æœ‰ç›¸åŒè¯·æ±‚ï¼Œæ— éœ€é‡å¤</span>
        }
        
        <span class="hljs-comment">// æ­¥éª¤ 2: è¯„ä¼°æ˜¯å¦å¯ä»¥æ»¡è¶³</span>
        <span class="hljs-comment">// ä¾‹å¦‚ï¼šæ£€æŸ¥ä¿¡å·å¼ºåº¦ã€æ˜¯å¦åœ¨ Airplane Mode ç­‰</span>
        <span class="hljs-keyword">if</span> (!canSatisfyRequest(request)) {
            <span class="hljs-keyword">return</span>;  <span class="hljs-comment">// æ— æ³•æ»¡è¶³ï¼Œæ‹’ç»</span>
        }
        
        <span class="hljs-comment">// æ­¥éª¤ 3: å¦‚æœè¿™æ˜¯ç¬¬ä¸€ä¸ªè¯·æ±‚ï¼Œå¯åŠ¨æ•°æ®è¿æ¥</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isFirstRequest</span> <span class="hljs-operator">=</span> mNetworkRequests.isEmpty();
        
        <span class="hljs-comment">// æ­¥éª¤ 4: è®°å½•è¯·æ±‚</span>
        mNetworkRequests.put(request, TRANSPORT_CELLULAR);
        
        <span class="hljs-keyword">if</span> (isFirstRequest) {
            <span class="hljs-comment">// è¿™æ˜¯ç¬¬ä¸€ä¸ªè¯·æ±‚ï¼Œå¯åŠ¨æ•°æ®è¿æ¥</span>
            <span class="hljs-comment">// ä¾‹å¦‚å»ºç«‹ PDP Context</span>
            startDataConnection(request);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// å·²ç»æœ‰æ´»è·ƒçš„æ•°æ®è¿æ¥</span>
            <span class="hljs-comment">// æ–°è¯·æ±‚å¯ä»¥ç«‹å³ä½¿ç”¨</span>
        }
    }
    
    <span class="hljs-comment">/**
     * Called by ConnectivityService when a NetworkRequest is withdrawn
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">releaseNetworkFor</span><span class="hljs-params">(NetworkRequest request)</span> {
        <span class="hljs-comment">// æ­¥éª¤ 1: ç§»é™¤è¯·æ±‚</span>
        mNetworkRequests.remove(request);
        
        <span class="hljs-comment">// æ­¥éª¤ 2: å¦‚æœæ²¡æœ‰æ›´å¤šè¯·æ±‚ï¼Œå…³é—­æ•°æ®è¿æ¥</span>
        <span class="hljs-keyword">if</span> (mNetworkRequests.isEmpty()) {
            stopDataConnection();  <span class="hljs-comment">// æ–­å¼€ PDP Context</span>
        }
    }
    
    <span class="hljs-comment">/**
     * å¼€å§‹æ•°æ®è¿æ¥
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startDataConnection</span><span class="hljs-params">(NetworkRequest request)</span> {
        <span class="hljs-comment">// ä¸ DataNetworkController é€šä¿¡</span>
        mDataNetworkController.requestDataConnection(
            request.getApnType(),   <span class="hljs-comment">// ä¾‹å¦‚ï¼šINTERNET, IMS, MMS</span>
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataConnectionCallback</span>() {
                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onConnected</span><span class="hljs-params">(DataNetwork network, LinkProperties lp)</span> {
                    <span class="hljs-comment">// ç½‘ç»œå·²è¿æ¥</span>
                    <span class="hljs-comment">// åˆ›å»º TelephonyNetworkAgent å‘ç³»ç»Ÿæ³¨å†Œ</span>
                    <span class="hljs-type">TelephonyNetworkAgent</span> <span class="hljs-variable">agent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TelephonyNetworkAgent</span>(
                        mPhone,
                        mLooper,
                        network,   <span class="hljs-comment">// DataNetwork å¯¹è±¡</span>
                        score,     <span class="hljs-comment">// åˆå§‹è¯„åˆ†ï¼ˆåŸºäºä¿¡å·å¼ºåº¦ï¼‰</span>
                        config,
                        <span class="hljs-built_in">this</span>       <span class="hljs-comment">// provider (TelephonyNetworkFactory)</span>
                    );
                    <span class="hljs-comment">// agent.register() åœ¨æ„é€ å‡½æ•°ä¸­è°ƒç”¨</span>
                }
                
                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDisconnected</span><span class="hljs-params">()</span> {
                    <span class="hljs-comment">// ç½‘ç»œå·²æ–­å¼€</span>
                    <span class="hljs-comment">// agent å°†è°ƒç”¨ unregister()</span>
                }
            }
        );
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">stopDataConnection</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// é€šçŸ¥ DataNetworkController å…³é—­æ‰€æœ‰ PDP Context</span>
        mDataNetworkController.releaseDataConnection();
    }
}
</code></pre>
<p>å…³é”®ç‰¹ç‚¹ï¼š
â”œâ”€ ä¸€ä¸ª Factory å¯èƒ½åŒæ—¶æ»¡è¶³å¤šä¸ª NetworkRequest
â”œâ”€ ä½†åº•å±‚å¯èƒ½åªæœ‰ä¸€ä¸ªæ•°æ®è¿æ¥ï¼ˆPDP Contextï¼‰
â”œâ”€ æ‰€æœ‰è¯·æ±‚å…±äº«åŒä¸€ä¸ª NetworkAgent
â”œâ”€ å½“æœ€åä¸€ä¸ªè¯·æ±‚ç§»é™¤æ—¶æ‰æ–­å¼€è¿æ¥</p>
<p>ã€WiFi NetworkFactory çš„å®ç°ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>WiFi å·¥å‚çš„ç‰¹ç‚¹ï¼šä¸€ä¸ª WiFi è¿æ¥ä¸€ä¸ª NetworkAgent</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WifiNetworkFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">NetworkFactory</span> {
    
    <span class="hljs-comment">// WiFi æä¾›çš„ç½‘ç»œ Agentï¼ˆé€šå¸¸åªæœ‰ä¸€ä¸ªï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">WifiNetworkAgent</span> <span class="hljs-variable">mWifiAgent</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
    
    <span class="hljs-comment">// WiFi ç®¡ç†å™¨</span>
    <span class="hljs-keyword">private</span> WifiManager mWifiManager;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">needNetworkFor</span><span class="hljs-params">(NetworkRequest request)</span> {
        <span class="hljs-comment">// WiFi å·¥å‚çš„é€»è¾‘ç›¸å¯¹ç®€å•</span>
        
        <span class="hljs-comment">// step 1: å¦‚æœå·²ç»æœ‰ WiFi è¿æ¥</span>
        <span class="hljs-keyword">if</span> (mWifiAgent != <span class="hljs-literal">null</span> &amp;&amp; mWifiAgent.isConnected()) {
            <span class="hljs-comment">// WiFi ç½‘ç»œå·²è¿æ¥ï¼Œå¯ä»¥æ»¡è¶³è¯·æ±‚</span>
            <span class="hljs-comment">// (æ— éœ€é¢å¤–æ“ä½œï¼Œè¯¥ç½‘ç»œå·²æ³¨å†Œ)</span>
            <span class="hljs-keyword">return</span>;
        }
        
        <span class="hljs-comment">// step 2: å¦‚æœæ²¡æœ‰ WiFiï¼Œå¯èƒ½å¯åŠ¨æ‰«æ</span>
        <span class="hljs-comment">// æˆ–è€…å¦‚æœä¹‹å‰å·²è¿æ¥ä½†æš‚æ—¶æ–­å¼€ï¼Œè‡ªåŠ¨é‡è¿</span>
        <span class="hljs-keyword">if</span> (mWifiManager != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// WiFi åœ¨ä¹‹å‰å·²é…ç½®ï¼Œè‡ªåŠ¨é‡è¿</span>
            mWifiManager.reconnect();
        }
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">releaseNetworkFor</span><span class="hljs-params">(NetworkRequest request)</span> {
        <span class="hljs-comment">// WiFi ä¸ä¼šå› ä¸ºä¸€ä¸ªè¯·æ±‚çš„ç§»é™¤å°±æ–­å¼€</span>
        <span class="hljs-comment">// ç”¨æˆ·å¯èƒ½è¿˜åœ¨æµè§ˆç½‘é¡µï¼Œå³ä½¿åº”ç”¨æ²¡æœ‰ç‰¹å®šçš„ç½‘ç»œè¯·æ±‚</span>
        <span class="hljs-comment">// WiFi åº”è¯¥ä¿æ´»</span>
        
        <span class="hljs-comment">// å®é™…ä¸Šï¼ŒWiFi é€šå¸¸ä¸å®ç°è¿™ä¸ªæ–¹æ³•</span>
        <span class="hljs-comment">// æˆ–è€…ç›´æ¥ returnï¼ˆæ— æ“ä½œï¼‰</span>
    }
    
    <span class="hljs-comment">/**
     * å½“ WiFi è¿æ¥æˆåŠŸæ—¶ï¼Œç”± WifiMonitor æˆ– WifiManager è°ƒç”¨
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onWifiConnected</span><span class="hljs-params">(String ssid, <span class="hljs-type">int</span> rssi)</span> {
        <span class="hljs-comment">// åˆ›å»ºæ–°çš„ WifiNetworkAgent</span>
        mWifiAgent = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WifiNetworkAgent</span>(
            mContext,
            mLooper,
            ssid,
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkCapabilities</span>.Builder()
                .addTransportType(TRANSPORT_WIFI)
                .addCapability(NET_CAPABILITY_INTERNET)
                .addCapability(NET_CAPABILITY_NOT_METERED)  <span class="hljs-comment">// é€šå¸¸ä¸è®¡é‡</span>
                .setSignalStrength(rssiToSignalLevel(rssi))
                .build(),
            linkProperties,
            networkScore,
            config,
            provider
        );
        
        mWifiAgent.register();  <span class="hljs-comment">// æ³¨å†Œåˆ°ç³»ç»Ÿ</span>
    }
    
    <span class="hljs-comment">/**
     * å½“ WiFi æ–­å¼€è¿æ¥æ—¶
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onWifiDisconnected</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (mWifiAgent != <span class="hljs-literal">null</span>) {
            mWifiAgent.unregister();
            mWifiAgent = <span class="hljs-literal">null</span>;
        }
    }
}
</code></pre>
<p>WiFi å’Œç§»åŠ¨ç½‘ç»œçš„é‡è¦åŒºåˆ«ï¼š
â”œâ”€ WiFi: ä¸€ä¸ªè¿æ¥ä¸€ä¸ª Agentï¼ˆå¤šä¸ªåº”ç”¨å…±äº«ï¼‰
â”œâ”€ ç§»åŠ¨ç½‘ç»œ: å¯èƒ½æœ‰å¤šä¸ª PDP Contextï¼ˆä¸åŒ APNï¼‰
â””â”€ å…³é”®ï¼šè¯„åˆ†å†³å®šä½¿ç”¨å“ªä¸ªç½‘ç»œ</p>
<p>ã€ç½‘ç»œè¯·æ±‚çš„åŒ¹é…ç®—æ³•ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>ConnectivityService å¦‚ä½•å†³å®šå“ªä¸ªå·¥å‚æ¥æ»¡è¶³è¯·æ±‚ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rematchAllNetworksAndRequests</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// æ­¥éª¤ 1: è·å–æ‰€æœ‰ç½‘ç»œï¼ŒæŒ‰è¯„åˆ†æ’åº</span>
    List&lt;NetworkAgentInfo&gt; networks = sortByScore(mNetworkAgents);
    
    <span class="hljs-comment">// æ­¥éª¤ 2: å¯¹äºæ¯ä¸ªç½‘ç»œï¼Œæ£€æŸ¥æ‰€æœ‰æœªåˆ†é…çš„è¯·æ±‚</span>
    <span class="hljs-keyword">for</span> (NetworkAgentInfo network : networks) {
        <span class="hljs-keyword">for</span> (NetworkRequestInfo request : mNetworkRequests) {
            <span class="hljs-keyword">if</span> (request.isAlreadyAssigned()) {
                <span class="hljs-keyword">continue</span>;  <span class="hljs-comment">// å·²åˆ†é…ç»™å…¶ä»–ç½‘ç»œ</span>
            }
            
            <span class="hljs-comment">// æ£€æŸ¥ç½‘ç»œæ˜¯å¦æ»¡è¶³è¯·æ±‚</span>
            <span class="hljs-keyword">if</span> (network.networkCapabilities.canBeSatisfiedBy(
                    request.networkRequest.getCapabilities())) {
                
                <span class="hljs-comment">// åˆ†é…è¯¥ç½‘ç»œç»™è¯¥è¯·æ±‚</span>
                assignNetworkToRequest(network, request);
            }
        }
    }
}
</code></pre>
<p>å…·ä½“çš„åŒ¹é…é€»è¾‘ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">canNetworkSatisfyRequest</span><span class="hljs-params">(
    NetworkAgentInfo network, NetworkRequest request)</span> {
    
    <span class="hljs-comment">// æ£€æŸ¥ 1: èƒ½åŠ›åŒ¹é…</span>
    <span class="hljs-comment">// è¯·æ±‚çš„æ‰€æœ‰ REQUIRED èƒ½åŠ›å¿…é¡»å­˜åœ¨</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> capability : request.getCapabilities()) {
        <span class="hljs-keyword">if</span> (!network.networkCapabilities.hasCapability(capability)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// ç½‘ç»œç¼ºå°‘å¿…è¦çš„èƒ½åŠ›</span>
        }
    }
    
    <span class="hljs-comment">// æ£€æŸ¥ 2: UNWANTED èƒ½åŠ›</span>
    <span class="hljs-comment">// è¯·æ±‚è¦æ±‚çš„ä»»ä½• UNWANTED èƒ½åŠ›éƒ½ä¸èƒ½å­˜åœ¨</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> unwanted : request.getUnwantedCapabilities()) {
        <span class="hljs-keyword">if</span> (network.networkCapabilities.hasCapability(unwanted)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// ç½‘ç»œæœ‰ä¸éœ€è¦çš„èƒ½åŠ›</span>
        }
    }
    
    <span class="hljs-comment">// æ£€æŸ¥ 3: ä¼ è¾“ç±»å‹</span>
    <span class="hljs-comment">// å¦‚æœè¯·æ±‚æŒ‡å®šäº†ä¼ è¾“ç±»å‹ï¼Œå¿…é¡»åŒ¹é…</span>
    <span class="hljs-keyword">if</span> (request.hasTransport()) {
        <span class="hljs-keyword">if</span> (!network.networkCapabilities.hasTransport(request.getTransport())) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// ä¼ è¾“ç±»å‹ä¸åŒ¹é…</span>
        }
    }
    
    <span class="hljs-comment">// æ£€æŸ¥ 4: ç‰¹æ®Šçš„ä¼ä¸šéœ€æ±‚ï¼ˆå¦‚æœæœ‰ï¼‰</span>
    <span class="hljs-comment">// ä¼ä¸š VPN, ç‰¹å®šè¿è¥å•†ç­‰</span>
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  <span class="hljs-comment">// ç½‘ç»œå¯ä»¥æ»¡è¶³è¯·æ±‚</span>
}
</code></pre>
<p>è¯·æ±‚åˆ†é…çš„ä¼˜å…ˆçº§ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">ä¼˜å…ˆçº§ 1: å·²éªŒè¯çš„ç½‘ç»œ (NET<span class="hljs-emphasis">_CAPABILITY_</span>VALIDATED)
<span class="hljs-code">          â”œâ”€ åˆ†é…ç»™ INTERNET è¯·æ±‚
          â”œâ”€ è¯„åˆ†è¶Šé«˜è¶Šä¼˜å…ˆ
          â””â”€ é€šå¸¸æ˜¯ WiFi æˆ–å¼ºä¿¡å·çš„ LTE
</span>
ä¼˜å…ˆçº§ 2: æœªéªŒè¯ä½†è¿æ¥çš„ç½‘ç»œ
<span class="hljs-code">          â”œâ”€ å¯ä»¥æš‚æ—¶æ»¡è¶³è¯·æ±‚
          â”œâ”€ ä½†åº”ç”¨å¯èƒ½æ£€æµ‹åˆ°æ— äº’è”ç½‘
          â””â”€ ç”¨äºæŸäº›ç‰¹æ®Šåº”ç”¨ï¼ˆæœ¬åœ°ç½‘ç»œï¼‰
</span>
ä¼˜å…ˆçº§ 3: VPN ç½‘ç»œ
<span class="hljs-code">          â”œâ”€ è¯„åˆ†é«˜äºåº•å±‚ç½‘ç»œ
          â”œâ”€ æµé‡è¢« VPN åŠ å¯†
          â””â”€ æ‰€æœ‰äº’è”ç½‘è¯·æ±‚è¢«è½¬å‘ VPN
</span>
ä¼˜å…ˆçº§ 4: å…¶ä»–ç‰¹æ®Šç½‘ç»œ
<span class="hljs-code">          â”œâ”€ è“ç‰™ç½‘ç»œ
          â”œâ”€ ä»¥å¤ªç½‘
          â””â”€ æœ¬åœ°ç½‘ç»œï¼ˆä¸éœ€è¦äº’è”ç½‘ï¼‰
</span></code></pre>
<pre><code class="hljs language-markdown" lang="markdown">
è®©æˆ‘ç»§ç»­è®²è§£ç¬¬ 4 éƒ¨åˆ†ï¼š

<span class="hljs-section">### <span class="hljs-strong">**4ã€ç½‘ç»œçŠ¶æ€ç®¡ç†ä¸ Linger æœºåˆ¶**</span></span>

</code></pre>
<p>ã€9 ç§å…³é”®çš„ç½‘ç»œçŠ¶æ€ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>Android ç½‘ç»œæ ˆä¸­ï¼Œä¸€ä¸ªç½‘ç»œå¯ä»¥å¤„äºä»¥ä¸‹å‡ ç§çŠ¶æ€ä¹‹ä¸€ï¼š</p>
<p>1ï¸âƒ£ IDLE / UNREGISTEREDï¼ˆç©ºé—²/æœªæ³¨å†Œï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å®šä¹‰ï¼š
â”œâ”€ ç½‘ç»œè¿˜ä¸å­˜åœ¨æˆ–å°šæœªè¢«ç³»ç»Ÿæ„ŸçŸ¥
â”œâ”€ NetworkAgent å°šæœªåˆ›å»ºæˆ–å·²é”€æ¯
â””â”€ å…¸å‹æƒ…å†µï¼šWiFi æœªè¿æ¥ã€ç§»åŠ¨ç½‘ç»œæ— ä¿¡å·</p>
<p>æŒç»­æ—¶é—´ï¼š
â”œâ”€ æœ€é•¿ï¼ˆç›´åˆ°ç”¨æˆ·è¿æ¥æˆ–è®¾å¤‡ç§»å‡ºä¿¡å·èŒƒå›´ï¼‰
â””â”€ æ— ç¡®å®šçš„ç»ˆæ­¢æ—¶é—´</p>
<p>è½¬æ¢åˆ°ï¼š
â””â”€ â†’ REGISTERING / CONNECTING</p>
<p>2ï¸âƒ£ REGISTERINGï¼ˆæ³¨å†Œä¸­ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å®šä¹‰ï¼š
â”œâ”€ NetworkAgent å·²åˆ›å»ºä½†å°šæœªå‘ ConnectivityService æ³¨å†Œ
â”œâ”€ æˆ–åˆšæ³¨å†Œä½†åˆå§‹çŠ¶æ€è¿˜æ˜¯ DISCONNECTED
â””â”€ ç½‘ç»œè¿˜ä¸å¯ç”¨</p>
<p>ç¤ºä¾‹æµç¨‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// WiFi æˆ–ç§»åŠ¨ç½‘ç»œåˆšå‘ç°ï¼Œåˆ›å»º Agent</span>
<span class="hljs-type">WifiNetworkAgent</span> <span class="hljs-variable">agent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WifiNetworkAgent</span>(...);
<span class="hljs-comment">// æ­¤æ—¶ç½‘ç»œæ˜¯ REGISTERING</span>

<span class="hljs-comment">// Agent å‘ç³»ç»Ÿæ³¨å†Œ</span>
agent.register();
<span class="hljs-comment">// ç°åœ¨åœ¨ ConnectivityService ä¸­è®°å½•ï¼Œä½†çŠ¶æ€ä»æ˜¯ DISCONNECTED</span>
</code></pre>
<p>æŒç»­æ—¶é—´ï¼š
â”œâ”€ éå¸¸çŸ­ï¼ˆé€šå¸¸ &lt; 100msï¼‰
â””â”€ ç›´åˆ° Agent æ„é€ å®Œæˆå¹¶è°ƒç”¨ register()</p>
<p>è½¬æ¢åˆ°ï¼š
â””â”€ â†’ CONNECTING æˆ– DISCONNECTED</p>
<p>3ï¸âƒ£ CONNECTINGï¼ˆè¿æ¥ä¸­ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å®šä¹‰ï¼š
â”œâ”€ NetworkAgent å·²æ³¨å†Œï¼Œæ­£åœ¨å»ºç«‹è¿æ¥
â”œâ”€ åº•å±‚é©±åŠ¨ï¼ˆWiFi Driverã€RILï¼‰æ­£åœ¨å·¥ä½œ
â”œâ”€ å¯èƒ½åœ¨èº«ä»½éªŒè¯ã€è·å– IP ç­‰é˜¶æ®µ
â””â”€ ç½‘ç»œè¿˜ä¸èƒ½æ¥æ”¶æµé‡</p>
<p>å…¸å‹çš„ CONNECTING å­é˜¶æ®µï¼š</p>
<pre><code class="hljs language-objectivec" lang="objectivec">CONNECTING
â”œâ”€ SCANNINGï¼ˆæ‰«æå¯ç”¨ç½‘ç»œï¼‰
â”œâ”€ AUTHENTICATINGï¼ˆéªŒè¯èº«ä»½/å¯†ç ï¼‰
â”œâ”€ OBTAINING_IPADDRï¼ˆé€šè¿‡ DHCP è·å– IPï¼‰
â”œâ”€ VERIFYING_POOR_LINKï¼ˆæ£€æŸ¥è¿æ¥è´¨é‡ï¼‰
â””â”€ <span class="hljs-built_in">CAPTIVE_PORTAL_CHECK</span>ï¼ˆæ£€æŸ¥å¼ºåˆ¶é—¨æˆ·ï¼‰
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">ç”¨æˆ·é€‰æ‹© <span class="hljs-built_in">WiFi</span> SSID å¹¶è¾“å…¥å¯†ç 
â†“
WifiManager.<span class="hljs-built_in">connect</span>()
â†“
WifiNetworkAgent: <span class="hljs-built_in">sendNetworkInfo</span>(CONNECTING)
â†“
ConnectivityService: ç½‘ç»œçŠ¶æ€å˜ä¸º CONNECTING
â†“
åº”ç”¨çœ‹åˆ°ç½‘ç»œåœ¨ CONNECTINGï¼ˆonAvailable è¿˜æœªè°ƒç”¨ï¼‰
â†“
ç»è¿‡æ•°ç§’...
â†“
<span class="hljs-built_in">WiFi</span> Driver è·å¾— IP åœ°å€
â†“
WifiNetworkAgent: <span class="hljs-built_in">markConnected</span>()
â†“
çŠ¶æ€è½¬ä¸º CONNECTED
</code></pre>
<p>æŒç»­æ—¶é—´ï¼š
â”œâ”€ WiFi: 1-5 ç§’ï¼ˆé€šå¸¸ï¼‰
â”œâ”€ ç§»åŠ¨ç½‘ç»œ: 3-10 ç§’ï¼ˆå–å†³äºä¿¡å·ï¼‰
â””â”€ æ¶åŠ£æ¡ä»¶ï¼šå¯èƒ½è¶…è¿‡ 30 ç§’</p>
<p>è½¬æ¢åˆ°ï¼š
â”œâ”€ â†’ CONNECTEDï¼ˆè¿æ¥æˆåŠŸï¼‰
â””â”€ â†’ DISCONNECTEDï¼ˆè¿æ¥å¤±è´¥ï¼‰</p>
<p>4ï¸âƒ£ CONNECTEDï¼ˆå·²è¿æ¥ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å®šä¹‰ï¼š
â”œâ”€ ç½‘ç»œå®Œå…¨è¿æ¥ï¼ŒL3 è¿é€šæ€§å·²å»ºç«‹
â”œâ”€ IP åœ°å€ã€ç½‘å…³ã€DNS é…ç½®å®Œæˆ
â”œâ”€ åº”ç”¨å¯ä»¥é€šè¿‡ NetworkRequest ä½¿ç”¨è¯¥ç½‘ç»œ
â”œâ”€ ç½‘ç»œå¯ä»¥æ¥æ”¶å’Œå‘é€æ•°æ®åŒ…</p>
<p>è¿™æ˜¯æœ€é‡è¦çš„ä¸€ä¸ªçŠ¶æ€ï¼Œåˆ†ä¸ºä¸¤ä¸ªå­é˜¶æ®µï¼š</p>
<p>4a. CONNECTED (UNVALIDATED)
â”œâ”€ ç½‘ç»œå·²è¿æ¥ä½†éªŒè¯çŠ¶æ€æœªçŸ¥
â”œâ”€ å¯èƒ½æ— æ³•è®¿é—®äº’è”ç½‘ï¼ˆä¾‹å¦‚ï¼Œéœ€è¦ç™»å½•é—¨æˆ·ï¼‰
â”œâ”€ NetworkMonitor å¯èƒ½æ­£åœ¨éªŒè¯
â””â”€ åº”ç”¨åº”è¯¥é¢„æœŸéªŒè¯å¤±è´¥</p>
<p>4b. CONNECTED (VALIDATED)
â”œâ”€ ç½‘ç»œå·²è¿æ¥ä¸”éªŒè¯é€šè¿‡
â”œâ”€ æœ‰çœŸå®çš„äº’è”ç½‘è¿æ¥
â”œâ”€ åº”ç”¨å¯ä»¥å®‰å…¨ä½¿ç”¨è¯¥ç½‘ç»œ
â””â”€ ç½‘ç»œæˆä¸ºä¸»è¦ç½‘ç»œçš„å€™é€‰</p>
<p>ç¤ºä¾‹æ—¶é—´çº¿ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">T</span>=<span class="hljs-number">0</span>s: ç½‘ç»œ CONNECTEDï¼ˆæœªéªŒè¯ï¼‰
     â””â”€ NetworkMonitor å¯åŠ¨éªŒè¯

<span class="hljs-attr">T</span>=<span class="hljs-number">2</span>-<span class="hljs-number">5</span>s: éªŒè¯åœ¨è¿›è¡Œä¸­
      â””â”€ å‘é€ HTTP æ¢æµ‹ã€DNS æŸ¥è¯¢ç­‰

<span class="hljs-attr">T</span>=<span class="hljs-number">5</span>s: éªŒè¯å®Œæˆ
     â”œâ”€ æƒ…å†µ A: éªŒè¯æˆåŠŸ â†’ VALIDATED
     â”œâ”€ æƒ…å†µ B: æ£€æµ‹åˆ°å¼ºåˆ¶é—¨æˆ· â†’ CAPTIVE_PORTAL
     â””â”€ æƒ…å†µ C: ç½‘ç»œç¦»çº¿ â†’ UNVALIDATED
</code></pre>
<p>æŒç»­æ—¶é—´ï¼š
â”œâ”€ å¯ä»¥æŒç»­æ•°ç§’åˆ°æ•°å°æ—¶
â”œâ”€ ç›´åˆ°ç½‘ç»œæ–­å¼€æˆ–è¢«æ›¿æ¢
â””â”€ æˆ–è€…ä» VALIDATED é™çº§åˆ° UNVALIDATEDï¼ˆè¿æ¥å˜å·®ï¼‰</p>
<p>è½¬æ¢åˆ°ï¼š
â”œâ”€ â†’ LOSINGï¼ˆè¢«æ›´å¥½çš„ç½‘ç»œæ›¿æ¢ï¼‰
â”œâ”€ â†’ SUSPENDEDï¼ˆä¸´æ—¶æš‚åœï¼Œä¾‹å¦‚é£è¡Œæ¨¡å¼ï¼‰
â””â”€ â†’ DISCONNECTEDï¼ˆç½‘ç»œæ•…éšœæˆ–ç”¨æˆ·æ–­å¼€ï¼‰</p>
<p>5ï¸âƒ£ LOSINGï¼ˆå³å°†ä¸§å¤±ï¼‰â­ Linger çŠ¶æ€
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å®šä¹‰ï¼š
â”œâ”€ ç½‘ç»œå³å°†è¢«æ›¿æ¢ä¸ºæ›´å¥½çš„ç½‘ç»œ
â”œâ”€ ä½†ä»ä¿æ´»ä¸€æ®µæ—¶é—´ï¼ˆLinger æ—¶é—´ï¼‰
â”œâ”€ åº”ç”¨æœ‰æœºä¼šå¹³æ»‘åˆ‡æ¢
â”œâ”€ å…¸å‹åœºæ™¯ï¼šWiFi å˜å¼±ï¼Œåˆ‡æ¢åˆ° LTEï¼Œä½† WiFi è¿˜æ´»ç€</p>
<p>ä½•æ—¶è¿›å…¥ LOSINGï¼š</p>
<pre><code class="hljs language-scss" lang="scss">ConnectivityService å‘ç°ï¼š
â”œâ”€ æ–°ç½‘ç»œæ¯”å½“å‰ç½‘ç»œè¯„åˆ†é«˜
â”œâ”€ æ–°ç½‘ç»œä¹Ÿèƒ½æ»¡è¶³ç›¸åŒçš„è¯·æ±‚
â”œâ”€ è®¾ç½® Linger è®¡æ—¶å™¨ï¼ˆé€šå¸¸ <span class="hljs-number">120</span> ç§’ï¼‰
â””â”€ å‘ŠçŸ¥åº”ç”¨ï¼š<span class="hljs-built_in">onLosing</span>(network, maxMsToLive)
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">T</span>=<span class="hljs-number">0</span>s: ç”¨æˆ·èµ°å‡º WiFi èŒƒå›´ï¼ŒWiFi ä¿¡å·å˜å¼±
     â””â”€ WiFiNetworkAgent é™ä½è¯„åˆ†

<span class="hljs-attr">T</span>=<span class="hljs-number">1</span>s: LTE ä¿¡å·å¼ºäº WiFi
     â””â”€ ConnectivityService é‡æ–°è¯„ä¼°
     â””â”€ å†³å®šï¼šLTE æ˜¯æ–°çš„é»˜è®¤ç½‘ç»œ

<span class="hljs-attr">T</span>=<span class="hljs-number">2</span>s: WiFi è¿›å…¥ LOSING çŠ¶æ€
     â””â”€ è°ƒç”¨æ‰€æœ‰ç›‘å¬è€…çš„ onLosing()
     â””â”€ è®¾ç½® 120 ç§’ Linger è®¡æ—¶å™¨

<span class="hljs-attr">T</span>=<span class="hljs-number">2</span>-<span class="hljs-number">120</span>s: WiFi ä»å¯ç”¨
         â”œâ”€ å·²è¿æ¥çš„ Socket å¯ç»§ç»­ä½¿ç”¨
         â”œâ”€ æ–°çš„ Socket é»˜è®¤ä½¿ç”¨ LTE
         â”œâ”€ åº”ç”¨å¦‚æœæ„¿æ„å¯ä»¥ç»§ç»­ç”¨ WiFi
         â””â”€ onLosing() å‘Šè¯‰åº”ç”¨ï¼šè¿˜æœ‰ 120 ç§’ï¼

<span class="hljs-attr">T</span>=<span class="hljs-number">122</span>s: Linger æ—¶é—´åˆ°æœŸ
       â””â”€ WiFi è¿›å…¥ DISCONNECTED
       â””â”€ è°ƒç”¨æ‰€æœ‰ç›‘å¬è€…çš„ onLost()
</code></pre>
<p>Linger çš„è®¾ç½®ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// é»˜è®¤ Linger æ—¶é—´ï¼ˆç§’ï¼‰</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">DEFAULT_LINGER_DELAY_MS</span> <span class="hljs-operator">=</span> <span class="hljs-number">120</span> * <span class="hljs-number">1000</span>;  <span class="hljs-comment">// 120 ç§’</span>

<span class="hljs-comment">// ä¸åŒç½‘ç»œç±»å‹çš„ Linger æ—¶é—´</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">WIFI_LINGER_TIME_MS</span> <span class="hljs-operator">=</span> <span class="hljs-number">120</span> * <span class="hljs-number">1000</span>;      <span class="hljs-comment">// WiFi: 120 ç§’</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CELLULAR_LINGER_TIME_MS</span> <span class="hljs-operator">=</span> <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>;   <span class="hljs-comment">// LTE: 60 ç§’</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">VPN_LINGER_TIME_MS</span> <span class="hljs-operator">=</span> <span class="hljs-number">30</span> * <span class="hljs-number">1000</span>;        <span class="hljs-comment">// VPN: 30 ç§’</span>
</code></pre>
<p>Linger çš„ç”¨é€”ï¼š
â”œâ”€ ç»™åº”ç”¨æ—¶é—´è¿›è¡Œå¹³æ»‘è¿‡æ¸¡
â”œâ”€ é¿å…é¢‘ç¹çš„ç½‘ç»œåˆ‡æ¢
â”œâ”€ ä¿æŠ¤æ—§ç½‘ç»œä¸Šå·²å»ºç«‹çš„è¿æ¥
â”œâ”€ å‡å°‘ç”¨æˆ·æ„ŸçŸ¥çš„ä¸­æ–­</p>
<p>Linger çš„ç¼ºç‚¹ï¼š
â”œâ”€ å»¶è¿Ÿäº†ç½‘ç»œé‡Šæ”¾
â”œâ”€ æ¶ˆè€—ç”µæ± ï¼ˆç½‘ç»œèŠ¯ç‰‡ä¿æŒæ´»è·ƒï¼‰
â”œâ”€ æµªè´¹æµé‡ï¼ˆåŒæ—¶ä½¿ç”¨ä¸¤ä¸ªç½‘ç»œï¼‰
â””â”€ æŸäº› OEM å‡çŸ­æˆ–å…³é—­ Linger</p>
<p>6ï¸âƒ£ SUSPENDEDï¼ˆæš‚åœï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å®šä¹‰ï¼š
â”œâ”€ ç½‘ç»œä»ç„¶è¿æ¥ï¼Œä½†ä¸´æ—¶ä¸å¯ç”¨
â”œâ”€ ä¾‹å¦‚ï¼šé£è¡Œæ¨¡å¼æ‰“å¼€ã€è®¾å¤‡æš‚åœ
â”œâ”€ åº”ç”¨çœ‹ä¸åˆ°è¯¥ç½‘ç»œ</p>
<p>è§¦å‘æ¡ä»¶ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">é£è¡Œæ¨¡å¼å¯ç”¨
  â†’ PhoneStateListener<span class="hljs-selector-class">.onServiceStateChanged</span>()
  â†’ Telephony ç½‘ç»œ SUSPENDED

å±å¹•å…³é—­ + æŸäº› App è¦æ±‚
  â†’ DeviceIdleManager å‘é€ IDLE ä¿¡å·
  â†’ éå¿…è¦ç½‘ç»œ SUSPENDED

VPN è¿æ¥
  â†’ åº•å±‚ç½‘ç»œ SUSPENDED
  â†’ VPN ç½‘ç»œæˆä¸ºå”¯ä¸€çš„ INTERNET ç½‘ç»œ
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">T</span>=<span class="hljs-number">0</span>s: WiFi æ­£å¸¸è¿æ¥å¹¶éªŒè¯
     â””â”€ ç½‘ç»œ: CONNECTED, VALIDATED

<span class="hljs-attr">T</span>=<span class="hljs-number">5</span>s: ç”¨æˆ·å¯ç”¨é£è¡Œæ¨¡å¼
     â””â”€ WifiManager.setAirplaneModeEnabled(true)
     â””â”€ æ‰€æœ‰ç½‘ç»œçŠ¶æ€: SUSPENDED
     â””â”€ onLost() å›è°ƒï¼ˆåº”ç”¨çœ‹ä¸åˆ°ç½‘ç»œï¼‰

<span class="hljs-attr">T</span>=<span class="hljs-number">10</span>s: ç”¨æˆ·å…³é—­é£è¡Œæ¨¡å¼
      â””â”€ WiFi æ¢å¤è¿æ¥
      â””â”€ ç½‘ç»œçŠ¶æ€å›åˆ° CONNECTED
      â””â”€ onAvailable() å›è°ƒ
</code></pre>
<p>æŒç»­æ—¶é—´ï¼š
â”œâ”€ å¯ä»¥æ˜¯ç§’çº§ï¼ˆä¸´æ—¶æš‚åœï¼‰
â”œâ”€ ä¹Ÿå¯ä»¥æ˜¯é•¿æ—¶é—´ï¼ˆç”¨æˆ·ä¸æ”¹å˜è®¾ç½®ï¼‰
â””â”€ æ— è‡ªåŠ¨æ¸…é™¤ï¼Œéœ€è¦ç”¨æˆ·æˆ–ç³»ç»Ÿäº‹ä»¶è§¦å‘æ¢å¤</p>
<p>è½¬æ¢åˆ°ï¼š
â”œâ”€ â†’ CONNECTEDï¼ˆæ¢å¤å¯ç”¨ï¼‰
â””â”€ â†’ DISCONNECTEDï¼ˆæ°¸ä¹…æ–­å¼€ï¼‰</p>
<p>7ï¸âƒ£ DISCONNECTINGï¼ˆæ–­å¼€ä¸­ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å®šä¹‰ï¼š
â”œâ”€ ç½‘ç»œæ­£åœ¨ä¼˜é›…æ–­å¼€è¿æ¥
â”œâ”€ åº•å±‚é©±åŠ¨æ­£åœ¨è¿›è¡Œæ¸…ç†ï¼ˆä¾‹å¦‚æ³¨é”€ä¼šè¯ï¼‰
â”œâ”€ åº”ç”¨åº”è¯¥åœæ­¢ä½¿ç”¨è¯¥ç½‘ç»œ
â”œâ”€ è¿™ä¸ªçŠ¶æ€é€šå¸¸å¾ˆçŸ­</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">ç”¨æˆ·æŒ‰"æ–­å¼€è¿æ¥"æŒ‰é’®
â†“
WifiManager<span class="hljs-selector-class">.disconnect</span>()
â†“
WiFi Driver å‘é€æ–­å¼€å¸§åˆ° AP
â†“
NetworkAgent: <span class="hljs-built_in">sendNetworkInfo</span>(DISCONNECTING)
â†“
åº”ç”¨æ”¶åˆ° <span class="hljs-built_in">onLosing</span>() å’Œåç»­çš„ <span class="hljs-built_in">onLost</span>()
â†“
ï¼ˆæ•°ç™¾æ¯«ç§’åï¼‰
â†“
Driver ç¡®è®¤æ–­å¼€å®Œæˆ
â†“
NetworkAgent: <span class="hljs-built_in">unregister</span>()
â†“
çŠ¶æ€å˜ä¸º DISCONNECTED
</code></pre>
<p>æŒç»­æ—¶é—´ï¼š
â”œâ”€ é€šå¸¸ &lt; 1 ç§’
â”œâ”€ WiFi: 100-500ms
â”œâ”€ ç§»åŠ¨ç½‘ç»œ: 500ms - 2 ç§’
â””â”€ è‹¥é©±åŠ¨æœ‰é—®é¢˜å¯èƒ½æ›´é•¿</p>
<p>è½¬æ¢åˆ°ï¼š
â””â”€ â†’ DISCONNECTEDï¼ˆæ–­å¼€å®Œæˆï¼‰</p>
<p>8ï¸âƒ£ DISCONNECTEDï¼ˆå·²æ–­å¼€ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å®šä¹‰ï¼š
â”œâ”€ ç½‘ç»œå·²å®Œå…¨æ–­å¼€
â”œâ”€ NetworkAgent å·² unregister()
â”œâ”€ åº”ç”¨æ— æ³•ä½¿ç”¨è¯¥ç½‘ç»œ
â”œâ”€ è¿™æ˜¯ç½‘ç»œç”Ÿå‘½å‘¨æœŸçš„ç»ˆç‚¹</p>
<p>å¯èƒ½çš„åŸå› ï¼š
â”œâ”€ ç”¨æˆ·æ‰‹åŠ¨æ–­å¼€
â”œâ”€ ç½‘ç»œä¸å¯ç”¨ï¼ˆä¿¡å·ä¸§å¤±ã€äº¤æ¢æœºæ‰çº¿ç­‰ï¼‰
â”œâ”€ è®¾å¤‡è¿›å…¥é£è¡Œæ¨¡å¼
â”œâ”€ ç³»ç»Ÿå…³é—­
â”œâ”€ NetworkFactory å†³å®šé‡Šæ”¾ç½‘ç»œ</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">WiFi ç½‘ç»œä» CONNECTED åˆ° DISCONNECTED çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼š

<span class="hljs-attr">T</span>=<span class="hljs-number">0</span>s: ç”¨æˆ·è¿æ¥åˆ° WiFi
     â”œâ”€ Agent åˆ›å»º: REGISTERING
     â”œâ”€ Agent æ³¨å†Œ: CONNECTING
     â”œâ”€ è·å– IP: CONNECTING
     â””â”€ æ ‡è®°è¿æ¥: CONNECTED

<span class="hljs-attr">T</span>=<span class="hljs-number">5</span>s: ç”¨æˆ·èµ°å‡ºèŒƒå›´ï¼Œä¿¡å·ä¸§å¤±
     â””â”€ WiFi Driver æ£€æµ‹åˆ°
     â””â”€ NetworkAgent: unregister()
     â””â”€ çŠ¶æ€: DISCONNECTED

<span class="hljs-attr">T</span>=<span class="hljs-number">5.1</span>s: <span class="hljs-literal">on</span>Lost() å›è°ƒç»™åº”ç”¨
       â””â”€ åº”ç”¨åœæ­¢ä½¿ç”¨è¯¥ç½‘ç»œ
</code></pre>
<p>æŒç»­æ—¶é—´ï¼š
â”œâ”€ DISCONNECTED æ²¡æœ‰"æŒç»­æ—¶é—´"
â”œâ”€ å®ƒæ˜¯ç»ˆç‚¹ï¼Œä¸ä¼šè‡ªåŠ¨è½¬å˜
â””â”€ éœ€è¦æ–°çš„ç½‘ç»œè¿æ¥äº‹ä»¶æ‰èƒ½å›åˆ°æ´»è·ƒçŠ¶æ€</p>
<p>ä» DISCONNECTED åˆ°ï¼š
â””â”€ â†’ REGISTERINGï¼ˆæ–°ç½‘ç»œè¿æ¥ï¼‰</p>
<p>9ï¸âƒ£ UNREGISTERED (æœ€åˆå§‹çŠ¶æ€)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å®šä¹‰ï¼š
â”œâ”€ ç½‘ç»œä»æœªè¢«ç³»ç»ŸçŸ¥é“
â”œâ”€ NetworkAgent ä»æœªåˆ›å»º
â”œâ”€ ç­‰åŒäº IDLEï¼Œä½†ä»ç³»ç»Ÿçš„è§’åº¦
â””â”€ è¿™æ˜¯ç½‘ç»œçš„é¢„åˆå§‹åŒ–çŠ¶æ€</p>
<p>è½¬æ¢åˆ°ï¼š
â””â”€ â†’ REGISTERINGï¼ˆç½‘ç»œè¢«å‘ç°å’Œåˆ›å»ºï¼‰</p>
<p>ã€çŠ¶æ€è½¬æ¢çš„å®Œæ•´å›¾è¡¨ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<pre><code class="hljs language-scss" lang="scss">                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ UNREGISTERED â”‚
                   â”‚   (åˆå§‹)      â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ ç½‘ç»œè¢«å‘ç°
                           â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ REGISTERING  â”‚
                   â”‚ (æ³¨å†Œä¸­)      â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ <span class="hljs-built_in">register</span>()
                           â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ CONNECTING   â”‚  â† WiFi æ‰«æã€èº«ä»½éªŒè¯ã€DHCP
                   â”‚ (è¿æ¥ä¸­)      â”‚     é€šå¸¸æŒç»­ <span class="hljs-number">1</span>-<span class="hljs-number">10</span> ç§’
                   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚              â”‚ è¿æ¥å¤±è´¥æˆ–è¶…æ—¶
                   â”‚ <span class="hljs-built_in">markConnected</span>()
                   â”‚              â”‚
                   â–¼              â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ CONNECTED    â”‚  â”‚ DISCONNECTED â”‚
            â”‚ (å·²è¿æ¥)      â”‚  â”‚ (å·²æ–­å¼€)      â”‚
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
           â”‚               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚ è¢«æ›¿æ¢
    â”‚ VALIDATED     â”‚     â”‚ (Linger)
    â”‚ (å·²éªŒè¯)       â”‚     â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â–¼
           â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚         â”‚ LOSING       â”‚
           â”‚         â”‚ (å³å°†ä¸§å¤±)    â”‚  &lt;- Linger <span class="hljs-number">120</span> ç§’
           â”‚         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚              â”‚ Linger æœŸæ»¡
           â”‚              â–¼
           â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â””â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ DISCONNECTED â”‚
                     â”‚ (å·²æ–­å¼€)      â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           
           å…¶ä»–å¯èƒ½ï¼š
           ä»»ä½•çŠ¶æ€ â”€â”€é£è¡Œæ¨¡å¼â”€â”€â–º SUSPENDED
           SUSPENDED â”€â”€â”€â”€â”€â”€â”€â”€â–º æ¢å¤ç½‘ç»œæ‰€æœ‰çŠ¶æ€
</code></pre>
<p>ã€Linger æœºåˆ¶çš„è¯¦ç»†å·¥ä½œæµç¨‹ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>Linger æ˜¯ Android ç½‘ç»œæ ˆä¸­æœ€é‡è¦çš„å¹³æ»‘è¿‡æ¸¡æœºåˆ¶ã€‚</p>
<pre><code class="hljs language-arduino" lang="arduino">Step <span class="hljs-number">1</span>: è§¦å‘æ¡ä»¶ - æ›´å¥½çš„ç½‘ç»œå‡ºç°
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

å½“å‰çŠ¶æ€ï¼š
â”œâ”€ é»˜è®¤ç½‘ç»œ: <span class="hljs-built_in">WiFi</span> (è¯„åˆ†: <span class="hljs-number">75</span>, å·²éªŒè¯)
â”œâ”€ å¾…æœºç½‘ç»œ: <span class="hljs-built_in">LTE</span> (è¯„åˆ†: <span class="hljs-number">50</span>, å·²éªŒè¯)
â””â”€ æ´»è·ƒåº”ç”¨: æµè§ˆå™¨ï¼Œé€šè¿‡ <span class="hljs-built_in">WiFi</span> ä¸‹è½½æ–‡ä»¶

ç½‘ç»œè¯„åˆ†å˜åŒ–ï¼š
â”œâ”€ <span class="hljs-built_in">WiFi</span> ä¿¡å·å˜å¼±: <span class="hljs-number">-75</span>dbm â†’ <span class="hljs-number">-85</span>dbm
â”œâ”€ <span class="hljs-built_in">WiFi</span> è¯„åˆ†ä¸‹é™: <span class="hljs-number">75</span> â†’ <span class="hljs-number">45</span>
â”œâ”€ LTE è¯„åˆ†: <span class="hljs-number">50</span> (ä¿æŒä¸å˜)
â””â”€ æ–°çš„è¯„åˆ†: <span class="hljs-built_in">LTE</span> (<span class="hljs-number">50</span>) &gt; <span class="hljs-built_in">WiFi</span> (<span class="hljs-number">45</span>)

ConnectivityService çš„å†³ç­–ï¼š
â”œâ”€ è°ƒç”¨ <span class="hljs-built_in">rematchAllNetworksAndRequests</span>()
â”œâ”€ å‘ç° LTE ç°åœ¨åº”è¯¥æ˜¯é»˜è®¤ç½‘ç»œ
â”œâ”€ ä½† <span class="hljs-built_in">WiFi</span> ä»ç„¶æ»¡è¶³æ‰€æœ‰æ´»è·ƒè¯·æ±‚
â””â”€ å†³å®šï¼šè¿›å…¥ <span class="hljs-built_in">LOSING</span> (Linger)


Step <span class="hljs-number">2</span>: è¿›å…¥ LOSING çŠ¶æ€
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ConnectivityService çš„æ“ä½œï¼š
```<span class="hljs-function">java
<span class="hljs-keyword">private</span> <span class="hljs-type">void</span> <span class="hljs-title">handleNetworkLosing</span><span class="hljs-params">(NetworkAgentInfo nai)</span> </span>{
    <span class="hljs-keyword">if</span> (nai.<span class="hljs-built_in">isLosing</span>()) {
        <span class="hljs-keyword">return</span>;  <span class="hljs-comment">// å·²ç»åœ¨ LOSING çŠ¶æ€</span>
    }
    
    <span class="hljs-comment">// æ ‡è®°ç½‘ç»œä¸º LOSING</span>
    nai.<span class="hljs-built_in">setLosing</span>();
    
    <span class="hljs-comment">// è®¾ç½® Linger è®¡æ—¶å™¨</span>
    <span class="hljs-type">int</span> lingerMs = <span class="hljs-built_in">getLingerTimeoutMs</span>(nai.networkType);
    <span class="hljs-comment">// lingerMs = 120000ms (é»˜è®¤ 120 ç§’)</span>
    
    mHandler.<span class="hljs-built_in">sendMessageDelayed</span>(
        mHandler.<span class="hljs-built_in">obtainMessage</span>(EVENT_LINGER_TIMEOUT, nai),
        lingerMs
    );
    
    <span class="hljs-comment">// é€šçŸ¥æ‰€æœ‰ç›‘å¬è€…ï¼šç½‘ç»œå³å°†ä¸§å¤±</span>
    <span class="hljs-built_in">notifyNetworkCallbacks</span>(nai, 
        ConnectivityManager.CALLBACK_LOSING,
        lingerMs);  <span class="hljs-comment">// å‘Šè¯‰åº”ç”¨è¿˜æœ‰å¤šå°‘æ—¶é—´</span>
}
</code></pre>
<p>åº”ç”¨æ”¶åˆ°çš„å›è°ƒï¼š</p>
<pre><code class="hljs language-java" lang="java">callback.onLosing(wifiNetwork, <span class="hljs-number">120000</span>);  <span class="hljs-comment">// è¿˜æœ‰ 120 ç§’ï¼</span>
</code></pre>
<p>åº”ç”¨çš„å…¸å‹ååº”ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onLosing</span><span class="hljs-params">(Network network, <span class="hljs-type">int</span> maxMsToLive)</span> {
    <span class="hljs-comment">// åº”ç”¨çŸ¥é“ WiFi å³å°†ä¸å¯ç”¨</span>
    <span class="hljs-comment">// æœ‰ä¸¤ç§é€‰æ‹©ï¼š</span>
    
    <span class="hljs-comment">// é€‰é¡¹ 1: ç«‹å³åœæ­¢ä½¿ç”¨ WiFi</span>
    <span class="hljs-comment">// ä¸»åŠ¨åˆ‡æ¢åˆ° LTE</span>
    <span class="hljs-comment">// ä¼˜ç‚¹ï¼šä¸ä¼šä¸­æ–­</span>
    <span class="hljs-comment">// ç¼ºç‚¹ï¼šå¯èƒ½ä¸ä¼šæœ‰ WiFi çš„é‡æ–°è¿æ¥æœºä¼š</span>
    
    <span class="hljs-comment">// é€‰é¡¹ 2: ç»§ç»­ä½¿ç”¨ WiFi</span>
    <span class="hljs-comment">// å¸Œæœ› Linger æ—¶é—´å†… WiFi ä¿¡å·æ¢å¤</span>
    <span class="hljs-comment">// ä¼˜ç‚¹ï¼šå¦‚æœä¿¡å·æ¢å¤å°±èƒ½ç»§ç»­ç”¨ WiFi</span>
    <span class="hljs-comment">// ç¼ºç‚¹ï¼šå¦‚æœä¸æ¢å¤ä¼šè¢«å¼ºåˆ¶åˆ‡æ¢ï¼Œå¯¼è‡´ä¸­æ–­</span>
}
</code></pre>
<p>Step 3: Linger æœŸé—´ - å¹¶è¡Œç½‘ç»œ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>Linger æ—¶é—´å†…å‘ç”Ÿçš„äº‹æƒ…ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">æ—¶é—´: <span class="hljs-number">0</span> - <span class="hljs-number">120</span> ç§’

åº”ç”¨çš„ç½‘ç»œä½¿ç”¨ï¼š
â”œâ”€ å·²å»ºç«‹çš„ Socket/è¿æ¥: ç»§ç»­ç”¨ WiFiï¼ˆä¸ä¸­æ–­ï¼‰
â”œâ”€ æ–°çš„ç½‘ç»œè¯·æ±‚: ä½¿ç”¨ LTEï¼ˆé»˜è®¤ç½‘ç»œï¼‰
â””â”€ æ˜¾å¼ä½¿ç”¨ WiFi çš„åº”ç”¨: ä»ç„¶å¯ç”¨

ç³»ç»Ÿçš„æ“ä½œï¼š
â”œâ”€ WiFi è¯„åˆ†ç»§ç»­å˜åŒ–
â”‚  â”œâ”€ å¦‚æœä¿¡å·æ”¹å–„: å›åˆ° CONNECTEDï¼ˆå–æ¶ˆ Lingerï¼‰
â”‚  â””â”€ å¦‚æœä¿¡å·ç»§ç»­å˜å·®: ä¿æŒ LOSING
â”œâ”€ LTE æˆä¸ºé»˜è®¤ç½‘ç»œ
â”œâ”€ æ–°åº”ç”¨ä½¿ç”¨ LTEï¼ˆè‡ªåŠ¨ï¼‰
â””â”€ æ—§åº”ç”¨ä»åœ¨ WiFi ä¸Šï¼ˆå¦‚æœæ˜¾å¼è¯·æ±‚ï¼‰


Step <span class="hljs-number">4</span>: WiFi ä¿¡å·æ¢å¤ - Linger å–æ¶ˆ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

åœ¨ Linger æœŸé—´ï¼Œå¦‚æœ WiFi ä¿¡å·æ”¹å–„ï¼š

WiFiNetworkAgent:
â”œâ”€ æ£€æµ‹åˆ°ä¿¡å·æ”¹å–„
â”œâ”€ <span class="hljs-built_in">sendNetworkScore</span>(newScore)
â”‚  â””â”€ è¯„åˆ†æé«˜: <span class="hljs-number">40</span> â†’ <span class="hljs-number">70</span>
â””â”€ ConnectivityService æ”¶åˆ°æ›´æ–°

ConnectivityService:
```java
private void <span class="hljs-built_in">handleNetworkScoreChanged</span>(NetworkAgentInfo nai) {
    int newScore = nai<span class="hljs-selector-class">.getNetworkScore</span>();
    
    if (nai.isLosing()) {
        <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦è¿˜åº”è¯¥ LOSING</span>
        if (newScore &gt; currentDefaultNetworkScore) {
            <span class="hljs-comment">// è¯„åˆ†æ”¹å–„ï¼Œå–æ¶ˆ Linger</span>
            nai<span class="hljs-selector-class">.clearLosing</span>();
            mHandler<span class="hljs-selector-class">.removeMessages</span>(EVENT_LINGER_TIMEOUT, nai);
            
            <span class="hljs-comment">// WiFi å›åˆ° CONNECTED</span>
            <span class="hljs-comment">// å¹¶å¯èƒ½æˆä¸ºé»˜è®¤ç½‘ç»œï¼ˆå¦‚æœè¯„åˆ†è¶³å¤Ÿé«˜ï¼‰</span>
            <span class="hljs-built_in">rematchAllNetworksAndRequests</span>();
            
            <span class="hljs-comment">// é€šçŸ¥åº”ç”¨ï¼šä¸ç”¨æ‹…å¿ƒäº†</span>
            <span class="hljs-built_in">notifyNetworkCallbacks</span>(nai, 
                CALLBACK_AVAILABLE);
        }
    }
}
</code></pre>
<p>åº”ç”¨æ”¶åˆ°å›è°ƒï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// WiFi æ¢å¤ï¼Œä¸å† LOSING</span>
callback.onAvailable(wifiNetwork);  <span class="hljs-comment">// æˆ–å…¶ä»–èƒ½åŠ›æ›´æ–°å›è°ƒ</span>
</code></pre>
<p>Step 5: Linger æœŸæ»¡ - ç½‘ç»œæ–­å¼€
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å¦‚æœ 120 ç§’å†… WiFi è¯„åˆ†æ²¡æœ‰æ¢å¤åˆ°è¶³å¤Ÿé«˜ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleLingerTimeout</span><span class="hljs-params">(NetworkAgentInfo nai)</span> {
    <span class="hljs-keyword">if</span> (!nai.isLosing()) {
        <span class="hljs-keyword">return</span>;  <span class="hljs-comment">// å·²ç»æ¢å¤äº†</span>
    }
    
    <span class="hljs-comment">// Linger æœŸæ»¡ï¼Œæ–­å¼€ç½‘ç»œ</span>
    nai.clearLosing();
    
    <span class="hljs-comment">// æ ‡è®°ä¸º DISCONNECTED</span>
    handleNetworkDisconnected(nai);
    
    <span class="hljs-comment">// æœ€ç»ˆé€šçŸ¥åº”ç”¨</span>
    notifyNetworkCallbacks(nai, CALLBACK_LOST);
}
</code></pre>
<p>åº”ç”¨æœ€ç»ˆæ”¶åˆ°ï¼š</p>
<pre><code class="hljs language-java" lang="java">callback.onLost(wifiNetwork);  <span class="hljs-comment">// WiFi å½»åº•æ–­å¼€</span>
</code></pre>
<p>å®Œæ•´çš„æ—¶é—´çº¿ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">T</span>=<span class="hljs-number">0</span>s:    WiFi ä¿¡å·å¼€å§‹å˜å¼±
         åº”ç”¨: æ”¶åˆ° onCapabilitiesChanged (è¯„åˆ†å˜åŒ–ï¼Œä½†ä» CONNECTED)

<span class="hljs-attr">T</span>=<span class="hljs-number">5</span>s:    WiFi è¯„åˆ† &lt; LTE è¯„åˆ†
         ConnectivityService: å†³å®šåˆ‡æ¢
         åº”ç”¨: æ”¶åˆ° onLosing(wifiNetwork, 120000)

<span class="hljs-attr">T</span>=<span class="hljs-number">5</span>-<span class="hljs-number">60</span>s: ç”¨æˆ·å¯èƒ½é è¿‘ WiFi è·¯ç”±å™¨
         WiFi: sendNetworkScore(æ”¹å–„)
         åº”ç”¨: ç»§ç»­ä½¿ç”¨æ—§è¿æ¥çš„ WiFi

<span class="hljs-attr">T</span>=<span class="hljs-number">60</span>s:   WiFi ä¿¡å·ç»§ç»­å˜å·®æˆ–æœªæ”¹å–„
         ConnectivityService: è¯„åˆ†ä» &lt; LTE
         åº”ç”¨: ä»åœ¨ Linger, ä»å¯ç”¨

<span class="hljs-attr">T</span>=<span class="hljs-number">125</span>s:  Linger æœŸæ»¡
         ConnectivityService: handleLingerTimeout()
         WiFi: å¼ºåˆ¶ DISCONNECTED
         åº”ç”¨: æ”¶åˆ° onLost(wifiNetwork)
         å·²å»ºç«‹çš„ WiFi è¿æ¥: ä¸­æ–­ âŒ
</code></pre>
<p>ã€Linger çš„é…ç½®ä¸ä¼˜åŒ–ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>ç³»ç»Ÿå±æ€§æ§åˆ¶ Linger æ—¶é—´ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">ro.config.ip_linger_ms</span>=<span class="hljs-number">120000</span>  <span class="hljs-comment"># 120 ç§’ï¼ˆé»˜è®¤ï¼‰</span>
</code></pre>
<p>OEM å¯ä»¥è‡ªå®šä¹‰ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">ro.config.ip_linger_ms</span>=<span class="hljs-number">60000</span>   <span class="hljs-comment"># æ¿€è¿›ï¼š60 ç§’ï¼ˆæ—©ç‚¹åˆ‡æ¢ï¼‰</span>
<span class="hljs-attr">ro.config.ip_linger_ms</span>=<span class="hljs-number">300000</span>  <span class="hljs-comment"># ä¿å®ˆï¼š5 åˆ†é’Ÿï¼ˆç­‰å¾…ç½‘ç»œæ¢å¤ï¼‰</span>
<span class="hljs-attr">ro.config.ip_linger_ms</span>=<span class="hljs-number">0</span>       <span class="hljs-comment"># ç¦ç”¨ Lingerï¼ˆç«‹å³åˆ‡æ¢ï¼‰</span>
</code></pre>
<p>Linger çš„ä¼˜ç¼ºç‚¹ï¼š</p>
<p>âœ“ ä¼˜ç‚¹ï¼š
â”œâ”€ å¹³æ»‘è¿‡æ¸¡ï¼šåº”ç”¨æ— éœ€æ„ŸçŸ¥ç½‘ç»œå˜åŒ–
â”œâ”€ è‡ªåŠ¨æ¢å¤ï¼šå¦‚æœä¿¡å·æ”¹å–„ï¼Œè‡ªåŠ¨å›åˆ°åŸç½‘ç»œ
â”œâ”€ çµæ´»æ€§ï¼šåº”ç”¨å¯é€‰æ‹©ä½•æ—¶åˆ‡æ¢
â””â”€ ç”¨æˆ·ä½“éªŒï¼šå‡å°‘ä¸­æ–­å’Œå»¶è¿Ÿ</p>
<p>âœ— ç¼ºç‚¹ï¼š
â”œâ”€ ç”µæ± æ¶ˆè€—ï¼šå¤šä¸ªç½‘ç»œåŒæ—¶æ´»è·ƒ
â”œâ”€ æµé‡æµªè´¹ï¼šå¯èƒ½ä½¿ç”¨ä¸¤ä¸ªç½‘ç»œ
â”œâ”€ å»¶è¿Ÿåˆ‡æ¢ï¼šä¸æ˜¯ç«‹å³åˆ‡æ¢åˆ°æœ€å¥½çš„ç½‘ç»œ
â””â”€ å¤æ‚æ€§ï¼šå¢åŠ ç½‘ç»œæ ˆçš„å¤æ‚åº¦</p>
<p>ä¸åŒ OEM çš„é€‰æ‹©ï¼š
â”œâ”€ Google Pixel: 120 ç§’ï¼ˆæ ‡å‡†ï¼‰
â”œâ”€ Samsung: 60-120 ç§’ï¼ˆä¸­ç­‰ï¼‰
â”œâ”€ æŸäº›å›½è¿è¥å•†: 30 ç§’ï¼ˆæ¿€è¿›ï¼‰
â””â”€ ä¼ä¸šè®¾å¤‡: 0 ç§’ï¼ˆç¦ç”¨ï¼Œå¼ºåˆ¶æœ€å¥½ç½‘ç»œï¼‰</p>
<pre><code class="hljs language-yaml" lang="yaml">
<span class="hljs-string">ç»§ç»­è®²è§£ç¬¬</span> <span class="hljs-number">5</span><span class="hljs-number">-6</span> <span class="hljs-string">éƒ¨åˆ†ã€‚</span>

<span class="hljs-string">å¥½çš„ï¼Œç°åœ¨å¼€å§‹è®²è§£ç¬¬</span> <span class="hljs-number">5</span><span class="hljs-number">-6</span> <span class="hljs-string">éƒ¨åˆ†ï¼š</span>

<span class="hljs-meta">---
</span>
<span class="hljs-comment">### **5ã€WiFi ä¸ç§»åŠ¨ç½‘ç»œåˆ‡æ¢æ·±åº¦è§£æ**</span>

</code></pre>
<p>ã€NetworkRanker çš„ 3 å±‚å†³ç­–æ¨¡å‹ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>NetworkRanker æ˜¯å†³å®š"å“ªä¸ªç½‘ç»œæœ€å¥½"çš„æ ¸å¿ƒå¼•æ“ã€‚å®ƒé€šè¿‡ä¸€ç³»åˆ—è¿‡æ»¤è§„åˆ™ï¼Œ
é€æ­¥æ’é™¤ä¸åˆæ ¼çš„ç½‘ç»œï¼Œæœ€ç»ˆé€‰å‡ºæœ€ä½³ç½‘ç»œã€‚</p>
<p>Layer 1: ç¡¬æ€§æ¡ä»¶ï¼ˆå¿…é¡»æ»¡è¶³ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>è¿™ä¸€å±‚è¿‡æ»¤æ‰å®Œå…¨ä¸ç¬¦åˆæ¡ä»¶çš„ç½‘ç»œï¼š</p>
<p>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. è¯·æ±‚å®Œå…¨æ»¡è¶³ (Satisfy Request)                  â”‚
â”‚    â””â”€ ç½‘ç»œå¿…é¡»æœ‰è¯·æ±‚è¦æ±‚çš„æ‰€æœ‰èƒ½åŠ›                â”‚
â”‚       ä¾‹å¦‚ï¼šè¯·æ±‚è¦æ±‚ INTERNET                      â”‚
â”‚       ç½‘ç»œå¿…é¡»æœ‰ NET_CAPABILITY_INTERNET             â”‚
â”‚                                                     â”‚
â”‚ 2. ä¸èƒ½æ˜¯å³å°†é”€æ¯çš„ç½‘ç»œ                            â”‚
â”‚    â””â”€ POLICY_IS_DESTROYED çš„ç½‘ç»œè¢«æ’é™¤             â”‚
â”‚       è¿™æ ·æ–°ç½‘ç»œå¯ä»¥ç›´æ¥æ›¿æ¢                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
<p>ä»£ç ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ­¥éª¤ 1: è¿‡æ»¤å‡ºèƒ½æ»¡è¶³è¯·æ±‚çš„ç½‘ç»œ</span>
List&lt;NetworkAgentInfo&gt; candidates = 
    networks.stream()
        .filter(nai -&gt; nai.satisfies(request))
        .collect(toList());

<span class="hljs-keyword">if</span> (candidates.isEmpty()) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;  <span class="hljs-comment">// æ²¡æœ‰ç½‘ç»œæ»¡è¶³è¦æ±‚</span>
}
</code></pre>
<p>Layer 2: ä¼˜å…ˆçº§è¿‡æ»¤ï¼ˆPrioritization Filtersï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>è¿™ä¸€å±‚ä½¿ç”¨ä¸€ç³»åˆ—è§„åˆ™é€æ­¥ç¼©å°å€™é€‰èŒƒå›´ï¼š</p>
<p>è§„åˆ™ 1: ä¸è´¥çš„ç½‘ç»œï¼ˆInvincible Networksï¼‰</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">if</span> (any network has POLICY_IS_INVINCIBLE) {
    <span class="hljs-keyword">return</span> that network;  <span class="hljs-comment">// ç›´æ¥è¿”å›ï¼Œå…¶ä»–ç½‘ç»œæ— è®ºå¤šå¥½éƒ½ä¸è¡Œ</span>
}
</code></pre>
<p>ç”¨é€”ï¼š
â”œâ”€ OEM ç‰¹æ®Šé…ç½®çš„ç½‘ç»œ
â”œâ”€ ä¼ä¸š VPNï¼ˆå¦‚é…ç½®ä¸ºä¸è´¥ï¼‰
â””â”€ æŸäº›ç‰¹æ®Šåœºæ™¯ä¸‹çš„ä¸“ç½‘</p>
<p>è§„åˆ™ 2: VPN ç½‘ç»œï¼ˆVPN Policyï¼‰</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">if</span> (any network is <span class="hljs-title function_">VPN</span> <span class="hljs-params">(POLICY_IS_VPN)</span>) {
    <span class="hljs-keyword">return</span> the VPN network;  <span class="hljs-comment">// VPN é€šå¸¸ä¼˜å…ˆäºåº•å±‚ç½‘ç»œ</span>
}
</code></pre>
<p>åŸå› ï¼š
â”œâ”€ VPN æ˜¯ç”¨æˆ·æ˜ç¡®é€‰æ‹©çš„åŠ å¯†é€šé“
â”œâ”€ æ‰€æœ‰äº’è”ç½‘æµé‡éƒ½åº”è¯¥é€šè¿‡ VPN
â””â”€ VPN çš„è¯„åˆ†é€šå¸¸é«˜äºåº•å±‚ç½‘ç»œ</p>
<p>è§„åˆ™ 3: ç”¨æˆ·é€‰æ‹©çš„ç½‘ç»œï¼ˆUser Selection Policyï¼‰</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">if</span> (any network has both:
    - POLICY_EVER_USER_SELECTED (ç”¨æˆ·ä¸»åŠ¨è¿æ¥è¿‡)
    - POLICY_ACCEPT_UNVALIDATED (ç”¨æˆ·æ„¿æ„æ¥å—æœªéªŒè¯)
) {
    prefer that network;
}
</code></pre>
<p>ç”¨é€”ï¼š
â”œâ”€ ç”¨æˆ·å–œæ¬¢ç”¨æŸä¸ªç‰¹å®šçš„ WiFi
â”œâ”€ å³ä½¿æœ‰éªŒè¯å¤±è´¥ï¼Œä¹Ÿåº”è¯¥ä¼˜å…ˆ
â””â”€ ä¾‹å¦‚ï¼šå®¶é‡Œçš„ WiFiï¼Œuser æ˜ç¡®é€‰æ‹©</p>
<p>è§„åˆ™ 4: éªŒè¯çŠ¶æ€ï¼ˆValidation Policyï¼‰</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">if</span> (any network is VALIDATED or POLICY_ACCEPT_UNVALIDATED) {
    exclude non-validated networks;
}
</code></pre>
<p>é€»è¾‘ï¼š
â”œâ”€ æœ‰æ•ˆçš„ç½‘ç»œï¼ˆå·²éªŒè¯äº’è”ç½‘è¿æ¥ï¼‰æ€»æ˜¯ä¼˜äºæ— æ•ˆç½‘ç»œ
â”œâ”€ æˆ–è€…å¦‚æœæœ‰ç½‘ç»œçš„ç”¨æˆ·æ¥å—æœªéªŒè¯ï¼Œå°±æ’é™¤æ‰€æœ‰æœªéªŒè¯ç½‘ç»œ
â””â”€ <strong>å…³é”®çš„å†³ç­–ç‚¹</strong></p>
<p>è§„åˆ™ 5: WiFi ä¸èœ‚çªçš„é€‰æ‹©ï¼ˆYield to Bad WiFi Policyï¼‰</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">if</span> (some networks have POLICY_YIELD_TO_BAD_WIFI) {
    <span class="hljs-comment">// è¿™ä¸ªè§„åˆ™ç”¨æ¥å¤„ç†"å WiFi vs å¥½èœ‚çª"çš„å›°å¢ƒ</span>
    
    <span class="hljs-keyword">if</span> (POLICY_YIELD_TO_BAD_WIFI &amp;&amp; there are bad WiFis) {
        prefer the bad WiFi;  <span class="hljs-comment">// åå¥½å WiFi</span>
    } <span class="hljs-keyword">else</span> {
        prefer the LTE;  <span class="hljs-comment">// å¦åˆ™ç”¨ LTE</span>
    }
}
</code></pre>
<p>è¿™æ˜¯æœ€å¤æ‚çš„è§„åˆ™ï¼è¯¦è§ä¸‹æ–‡ã€‚</p>
<p>è§„åˆ™ 6: éé€€å‡ºç½‘ç»œï¼ˆNon-Exiting Policyï¼‰</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">if</span> (any network doesn<span class="hljs-string">'t have POLICY_EXITING) {
    exclude networks with POLICY_EXITING;  // Linger é˜¶æ®µçš„ç½‘ç»œ
}
</span></code></pre>
<p>ç”¨é€”ï¼š
â”œâ”€ ä¼˜å…ˆé€‰æ‹©ä¸åœ¨ Linger çš„ç½‘ç»œï¼ˆå³å°†æ¶ˆå¤±ï¼‰
â”œâ”€ é¿å…é€‰æ‹©ä¸€ä¸ªå³å°†æ–­å¼€çš„ç½‘ç»œ</p>
<p>è§„åˆ™ 7: ä¸»è¦ä¼ è¾“æ–¹å¼ï¼ˆPrimary Transport Policyï¼‰</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">for</span> each SIM slot {
    <span class="hljs-keyword">if</span> (there<span class="hljs-string">'s a network for primary subscription) {
        prefer it over networks for secondary subscriptions;
    }
}
</span></code></pre>
<p>ç”¨é€”ï¼š
â”œâ”€ å¤šå¡è®¾å¤‡ï¼Œé€šå¸¸æœ‰ä¸€å¼ ä¸»å¡ï¼ˆPrimary SIMï¼‰
â”œâ”€ èœ‚çªç½‘ç»œä¼˜å…ˆä½¿ç”¨ä¸»å¡çš„ä¿¡å·
â””â”€ æ¬¡å¡çš„ç½‘ç»œä½œä¸ºå¤‡é€‰</p>
<p>è§„åˆ™ 8: ä¼ è¾“ä¼˜å…ˆçº§ï¼ˆTransport Priorityï¼‰</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¼˜å…ˆçº§é¡ºåºï¼šä»¥å¤ªç½‘ &gt; WiFi &gt; è“ç‰™ &gt; èœ‚çª</span>
<span class="hljs-keyword">for</span> (transport in [ETHERNET, WIFI, BLUETOOTH, CELLULAR]) {
    <span class="hljs-keyword">if</span> (any network has <span class="hljs-built_in">this</span> transport) {
        prefer <span class="hljs-built_in">this</span> transport over lower ones;
    }
}
</code></pre>
<p>ä¾‹å­ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">å€™é€‰ç½‘ç»œï¼š
â”œâ”€ LTE (è¯„åˆ† <span class="hljs-number">80</span>, å·²éªŒè¯)
â”œâ”€ WiFi (è¯„åˆ† <span class="hljs-number">60</span>, å·²éªŒè¯)
â””â”€ ä»¥å¤ªç½‘ (è¯„åˆ† <span class="hljs-number">30</span>, å·²éªŒè¯)

æŒ‰è§„åˆ™ <span class="hljs-number">8</span> è¯„ä¼°ï¼š
â”œâ”€ æœ‰ä»¥å¤ªç½‘ï¼Ÿâ†’ é€‰æ‹©ä»¥å¤ªç½‘ï¼ˆå³ä½¿è¯„åˆ†æœ€ä½ï¼ï¼‰
</code></pre>
<p>è§„åˆ™ 9: ç¨³å®šæ€§å€¾å‘ï¼ˆStickinessï¼‰</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">if</span> (currentSatisfier is still in candidates after all rules) {
    keep it;  <span class="hljs-comment">// "ç²˜æ€§"ï¼šå€¾å‘äºä¿æŒå½“å‰ç½‘ç»œ</span>
}
</code></pre>
<p>ç”¨é€”ï¼š
â”œâ”€ é¿å…é¢‘ç¹åˆ‡æ¢ï¼ˆæŠ–åŠ¨ï¼‰
â”œâ”€ å‡å°‘ç”¨æˆ·æ„ŸçŸ¥åˆ°çš„ç½‘ç»œåˆ‡æ¢
â””â”€ å¦‚æœå½“å‰ç½‘ç»œè¶³å¤Ÿå¥½ï¼Œå°±åˆ«æ¢</p>
<p>Layer 3: è¯„åˆ†æ¯”è¾ƒï¼ˆScore Comparisonï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å¦‚æœç»è¿‡æ‰€æœ‰è¿‡æ»¤è§„åˆ™åä»æœ‰å¤šä¸ªå€™é€‰ï¼Œåˆ™æŒ‰è¯„åˆ†æ’åºï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span> <span class="hljs-variable">scoreDiff</span> <span class="hljs-operator">=</span> networkA.getScore() - networkB.getScore();
<span class="hljs-keyword">if</span> (scoreDiff &gt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> networkA;  <span class="hljs-comment">// A è¯„åˆ†æ›´é«˜</span>
<span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> networkB;
</code></pre>
<p>è¯„åˆ†çš„è®¡ç®—ï¼ˆFullScoreï¼‰ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FullScore</span> {
    <span class="hljs-comment">// WiFi è¯„åˆ†ï¼ˆ0-100ï¼ŒåŸºäº RSSIï¼‰</span>
    <span class="hljs-comment">// RSSI -40dbm: 95 åˆ†ï¼ˆæœ€å¼ºï¼‰</span>
    <span class="hljs-comment">// RSSI -70dbm: 60 åˆ†ï¼ˆä¸­ç­‰ï¼‰</span>
    <span class="hljs-comment">// RSSI -85dbm: 25 åˆ†ï¼ˆå¼±ï¼‰</span>
    <span class="hljs-comment">// RSSI &lt; -90dbm: 0 åˆ†ï¼ˆæ–­çº¿ï¼‰</span>
    
    <span class="hljs-comment">// LTE è¯„åˆ†ï¼ˆ0-100ï¼ŒåŸºäºä¿¡å·å¼ºåº¦ï¼‰</span>
    <span class="hljs-comment">// RSRP -75dbm: 90 åˆ†ï¼ˆæœ€å¼ºï¼‰</span>
    <span class="hljs-comment">// RSRP -100dbm: 60 åˆ†ï¼ˆä¸­ç­‰ï¼‰</span>
    <span class="hljs-comment">// RSRP -120dbm: 20 åˆ†ï¼ˆå¼±ï¼‰</span>
    
    <span class="hljs-comment">// éªŒè¯å¥–åŠ±ï¼š+20 åˆ†</span>
    <span class="hljs-comment">// Linger æƒ©ç½šï¼š-30 åˆ†</span>
    <span class="hljs-comment">// VPN å¥–åŠ±ï¼š+50 åˆ†</span>
}
</code></pre>
<p>ã€Yield to Bad WiFi è§„åˆ™è¯¦è§£ã€‘â­ æœ€å…³é”®çš„ WiFi vs LTE å†³ç­–
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>è¿™ä¸ªè§„åˆ™è§£å†³çš„é—®é¢˜ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">ç”¨æˆ·æœ‰ä¸¤ä¸ªç½‘ç»œå¯ç”¨ï¼š
â”œâ”€ <span class="hljs-built_in">WiFi</span>: <span class="hljs-number">-85</span>dbmï¼ŒæœªéªŒè¯æˆ–å¼ºåˆ¶é—¨æˆ·ï¼ˆ<span class="hljs-string">"å"</span> <span class="hljs-built_in">WiFi</span>ï¼‰
â””â”€ LTE: <span class="hljs-number">-95</span>dbmï¼Œå·²éªŒè¯ï¼ˆ<span class="hljs-string">"å¥½"</span> LTEï¼‰

é—®é¢˜ï¼š
â”œâ”€ è¯„åˆ†ä¸Šï¼ŒLTE å¯èƒ½æ›´é«˜
â”œâ”€ ä½†ç”¨æˆ·å·²è¿æ¥åˆ° <span class="hljs-built_in">WiFi</span>ï¼ˆå¯èƒ½æ˜¯é¢„æœŸçš„ï¼‰
â”œâ”€ ç³»ç»Ÿåº”è¯¥ä¿ç•™ <span class="hljs-built_in">WiFi</span>ï¼ˆå³ä½¿åï¼‰è¿˜æ˜¯ç«‹å³åˆ‡æ¢åˆ° LTEï¼Ÿ
</code></pre>
<p>POLICY_YIELD_TO_BAD_WIFI æ˜¯ä¸€ä¸ªæ ‡å¿—ï¼Œè¡¨ç¤ºï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"å¦‚æœæœ‰åä½†å·²è¿æ¥çš„ WiFiï¼Œä¼˜å…ˆä½¿ç”¨å®ƒï¼Œè€Œä¸æ˜¯åˆ‡æ¢åˆ°æ›´å¥½çš„èœ‚çªç½‘ç»œ"</span>
</code></pre>
<p>ä½•æ—¶è®¾ç½®ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-number">1.</span> <span class="hljs-built_in">WiFi</span> å·²è¿æ¥ä½†éªŒè¯å¤±è´¥ï¼ˆå¯èƒ½æ˜¯å¼ºåˆ¶é—¨æˆ·ï¼‰
   â”œâ”€ ç”¨æˆ·å¯èƒ½æƒ³é€šè¿‡é—¨æˆ·è®¤è¯
   â”œâ”€ æ­¤æ—¶ä¸åº”ç«‹å³åˆ‡æ¢åˆ° LTE
   â””â”€ è®¾ç½® YIELD_TO_BAD_WIFI

<span class="hljs-number">2.</span> <span class="hljs-built_in">WiFi</span> ä¿¡å·å˜å¼±ä½†ä»è¿æ¥
   â”œâ”€ ç”¨æˆ·å¯èƒ½èµ°è¿‘è·¯ç”±å™¨æ—¶ <span class="hljs-built_in">WiFi</span> ä¼šæ¢å¤
   â”œâ”€ ä¸åº”ç«‹å³åˆ‡æ¢åˆ° LTE
   â””â”€ è®¾ç½® YIELD_TO_BAD_WIFI

<span class="hljs-number">3.</span> <span class="hljs-built_in">WiFi</span> è™½ç„¶æœªéªŒè¯ä½†èƒ½ä¸Šç½‘ï¼ˆä¾‹å¦‚æŸäº›ç‰¹æ®Šåœºæ™¯ï¼‰
   â”œâ”€ å¯èƒ½æ˜¯ä»£ç†ã€ç‰¹æ®Šé…ç½®ç­‰
   â””â”€ ä¼˜å…ˆä¿ç•™ <span class="hljs-built_in">WiFi</span>
</code></pre>
<p>ç®—æ³•ï¼ˆisPreferredBadWiFiï¼‰ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isPreferredBadWiFi</span><span class="hljs-params">(NetworkScore score, NetworkCapabilities caps)</span> {
    <span class="hljs-comment">// æ¡ä»¶ 1: å¿…é¡»æ˜¯ WiFi</span>
    <span class="hljs-keyword">if</span> (!caps.hasTransport(TRANSPORT_WIFI)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    
    <span class="hljs-comment">// æ¡ä»¶ 2: ä¸èƒ½æ˜¯å·²éªŒè¯çš„ç½‘ç»œï¼ˆå·²éªŒè¯å°±ä¸æ˜¯"å" WiFiï¼‰</span>
    <span class="hljs-keyword">if</span> (score.hasPolicy(POLICY_IS_VALIDATED)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    
    <span class="hljs-comment">// æ¡ä»¶ 3: ä¸èƒ½æ˜¯ç”¨æˆ·ä¸»åŠ¨é¿å…çš„ï¼ˆåœ¨ UI ä¸­å–æ¶ˆå‹¾é€‰ï¼‰</span>
    <span class="hljs-keyword">if</span> (score.hasPolicy(POLICY_AVOIDED_WHEN_UNVALIDATED)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    
    <span class="hljs-comment">// æ¡ä»¶ 4: å¿…é¡»æ›¾ç»è¯„ä¼°è¿‡ï¼ˆåœ¨è¿æ¥è¯„ä¼°é˜¶æ®µï¼‰</span>
    <span class="hljs-keyword">if</span> (!score.hasPolicy(POLICY_EVER_EVALUATED)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    
    <span class="hljs-comment">// æ¡ä»¶ 5: ä¸èƒ½æ˜¯æ´»è·ƒå¼ºåˆ¶é—¨æˆ·</span>
    <span class="hljs-comment">// ï¼ˆä½†å¦‚æœæ›¾ç»éªŒè¯è¿‡ï¼Œå³ä½¿ç°åœ¨æ˜¯é—¨æˆ·ä¹Ÿå¯ä»¥ï¼‰</span>
    <span class="hljs-keyword">if</span> (caps.hasCapability(NET_CAPABILITY_CAPTIVE_PORTAL)) {
        <span class="hljs-comment">// å¦‚æœæ›¾ç»éªŒè¯è¿‡ï¼Œè¯´æ˜ç”¨æˆ·ä¹‹å‰ç™»å½•è¿‡</span>
        <span class="hljs-comment">// ç°åœ¨é—¨æˆ·å¯èƒ½ç”±äºæŸäº›åŸå› é‡æ–°å‡ºç°</span>
        <span class="hljs-comment">// ä»ç„¶åº”è¯¥ä¼˜å…ˆä½¿ç”¨ WiFi</span>
        <span class="hljs-keyword">if</span> (!score.hasPolicy(POLICY_EVER_VALIDATED)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// ä»æœªéªŒè¯è¿‡çš„é—¨æˆ·ï¼Œä¸ä¼˜å…ˆ</span>
        }
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  <span class="hljs-comment">// è¿™æ˜¯ä¸€ä¸ª"ä¼˜å…ˆçš„å WiFi"</span>
}

<span class="hljs-comment">// åœ¨ç½‘ç»œé€‰æ‹©ä¸­ä½¿ç”¨</span>
applyYieldToBadWifiPolicy(validated, unvalidated) {
    <span class="hljs-keyword">if</span> (any network has POLICY_YIELD_TO_BAD_WIFI) {
        List&lt;BadWiFi&gt; badWiFis = unvalidated.stream()
            .filter(nai -&gt; isPreferredBadWiFi(nai.getScore()))
            .collect(toList());
        
        <span class="hljs-keyword">if</span> (!badWiFis.isEmpty()) {
            <span class="hljs-comment">// æœ‰åä½†ä¼˜å…ˆçš„ WiFi</span>
            <span class="hljs-comment">// ç§»é™¤æ‰€æœ‰æœ‰ YIELD_TO_BAD_WIFI çš„é WiFi ç½‘ç»œ</span>
            validated.removeAll(networks_with_YIELD_TO_BAD_WIFI);
            <span class="hljs-comment">// ä¿ç•™å WiFi</span>
        }
    }
}
</code></pre>
<p>å…¸å‹åœºæ™¯çš„å†³ç­–æµç¨‹ï¼š</p>
<p>åœºæ™¯ A: ç”¨æˆ·åœ¨å¼€æ”¾ WiFiï¼ˆå¦‚æœºåœºï¼‰</p>
<pre><code class="hljs language-objectivec" lang="objectivec">WiFi çŠ¶æ€ï¼šè¿æ¥ï¼Œå­˜åœ¨å¼ºåˆ¶é—¨æˆ·ï¼ŒæœªéªŒè¯
LTE çŠ¶æ€ï¼šè¿æ¥ï¼Œå·²éªŒè¯

isPreferredBadWiFi(WiFi)?
â”œâ”€ æ˜¯ WiFi? âœ“ <span class="hljs-literal">YES</span>
â”œâ”€ å·²éªŒè¯? âœ— <span class="hljs-literal">NO</span> (æœªéªŒè¯)
â”œâ”€ è¢«ç”¨æˆ·é¿å…? âœ— <span class="hljs-literal">NO</span>
â”œâ”€ æ›¾è¯„ä¼°è¿‡? âœ“ <span class="hljs-literal">YES</span>
â”œâ”€ æ˜¯å¼ºåˆ¶é—¨æˆ·? âœ“ <span class="hljs-literal">YES</span>ï¼Œä½†æ›¾éªŒè¯? âœ— <span class="hljs-literal">NO</span>
â””â”€ â†’ <span class="hljs-keyword">return</span> <span class="hljs-literal">FALSE</span> (ä¸ä¼˜å…ˆ)

å†³ç­–ï¼šé€‰æ‹© LTEï¼ˆå·²éªŒè¯ï¼‰âŒ
é—®é¢˜ï¼šç”¨æˆ·å¯èƒ½æƒ³ç™»å½• WiFiï¼
</code></pre>
<p>åœºæ™¯ B: ç”¨æˆ·åœ¨å®¶é‡Œ WiFiï¼ˆå·²ç™»å½•è¿‡çš„é—¨æˆ·ï¼‰</p>
<pre><code class="hljs language-objectivec" lang="objectivec">WiFi çŠ¶æ€ï¼šè¿æ¥ï¼Œå¼ºåˆ¶é—¨æˆ·ï¼ŒæœªéªŒè¯ï¼Œä½†æ›¾éªŒè¯
LTE çŠ¶æ€ï¼šè¿æ¥ï¼Œå·²éªŒè¯

isPreferredBadWiFi(WiFi)?
â”œâ”€ æ˜¯ WiFi? âœ“ <span class="hljs-literal">YES</span>
â”œâ”€ å·²éªŒè¯? âœ— <span class="hljs-literal">NO</span> (ç°åœ¨æœªéªŒè¯)
â”œâ”€ è¢«ç”¨æˆ·é¿å…? âœ— <span class="hljs-literal">NO</span>
â”œâ”€ æ›¾è¯„ä¼°è¿‡? âœ“ <span class="hljs-literal">YES</span>
â”œâ”€ æ˜¯å¼ºåˆ¶é—¨æˆ·? âœ“ <span class="hljs-literal">YES</span>ï¼Œä½†æ›¾éªŒè¯? âœ“ <span class="hljs-literal">YES</span>
â””â”€ â†’ <span class="hljs-keyword">return</span> <span class="hljs-literal">TRUE</span> (ä¼˜å…ˆï¼)

å†³ç­–ï¼šé€‰æ‹© WiFiï¼ˆåä½†ä¼˜å…ˆï¼‰âœ“
åŸå› ï¼šç”¨æˆ·ä¹‹å‰ç™»å½•è¿‡ï¼Œç°åœ¨åªæ˜¯é—¨æˆ·é‡æ–°å‡ºç°ï¼Œåº”è¯¥ä¿ç•™ WiFi
</code></pre>
<p>åœºæ™¯ C: WiFi ä¿¡å·å¼±</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-built_in">WiFi</span> çŠ¶æ€ï¼šRSSI <span class="hljs-number">-88</span>dbmï¼Œè¯„åˆ† <span class="hljs-number">25</span>ï¼Œå·²éªŒè¯
LTE çŠ¶æ€ï¼šRSSI <span class="hljs-number">-95</span>dbmï¼Œè¯„åˆ† <span class="hljs-number">70</span>ï¼Œå·²éªŒè¯

<span class="hljs-built_in">isPreferredBadWiFi</span>(<span class="hljs-built_in">WiFi</span>)?
â”œâ”€ æ˜¯ <span class="hljs-built_in">WiFi</span>? âœ“ YES
â”œâ”€ å·²éªŒè¯? âœ“ YES
â””â”€ â†’ <span class="hljs-keyword">return</span> <span class="hljs-built_in">FALSE</span> (å·²éªŒè¯ä¸ç®—<span class="hljs-string">"å"</span> <span class="hljs-built_in">WiFi</span>)

è¯„åˆ†æ¯”è¾ƒï¼š
â””â”€ <span class="hljs-built_in">LTE</span> (<span class="hljs-number">70</span>) &gt; <span class="hljs-built_in">WiFi</span> (<span class="hljs-number">25</span>)

å†³ç­–ï¼šé€‰æ‹© LTE âœ“
åŸå› ï¼š<span class="hljs-built_in">WiFi</span> è™½ç„¶éªŒè¯è¿‡ï¼Œä½†è¯„åˆ†å¤ªä½ï¼ŒLTE æ›´å¥½
</code></pre>
<p>ã€ç½‘ç»œåˆ‡æ¢çš„å®Œæ•´æ—¶é—´çº¿ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>å®é™…ç½‘ç»œåˆ‡æ¢çš„å‘ç”Ÿè¿‡ç¨‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">T</span>=<span class="hljs-number">0</span>: ç”¨æˆ·åœ¨ WiFi è¦†ç›–èŒƒå›´å†…
     â”œâ”€ WiFi è¿æ¥ï¼Œå·²éªŒè¯ (RSSI -40dbm, è¯„åˆ† 95)
     â”œâ”€ LTE è¿æ¥ï¼Œå·²éªŒè¯ (RSRP -90dbm, è¯„åˆ† 65)
     â””â”€ é»˜è®¤ç½‘ç»œï¼šWiFi (95 &gt; 65)

<span class="hljs-attr">T</span>=<span class="hljs-number">10</span>s: ç”¨æˆ·èµ°å‡º WiFi è¦†ç›–èŒƒå›´
       â””â”€ WiFi ä¿¡å·å¼€å§‹è¡°å‡ -40 â†’ -50 â†’ -60 ...

<span class="hljs-attr">T</span>=<span class="hljs-number">15</span>s: WiFi ä¿¡å·ç»§ç»­è¡°å‡åˆ° -<span class="hljs-number">85</span>dbm
       â”œâ”€ WiFiNetworkAgent.onSignalStrengthChanged(-85)
       â”œâ”€ æ–°è¯„åˆ†ï¼š25
       â”œâ”€ ConnectivityService.onNetworkScoreChanged()
       â””â”€ è§¦å‘ rematchAllNetworksAndRequests()

<span class="hljs-attr">T</span>=<span class="hljs-number">16</span>s: NetworkRanker.getBestNetwork()
       â”œâ”€ å€™é€‰ï¼šWiFi (è¯„åˆ† 25), LTE (è¯„åˆ† 65)
       â”œâ”€ è§„åˆ™ 1-7ï¼šéƒ½é€šè¿‡ (éƒ½å·²éªŒè¯ï¼Œä¸åœ¨ Linger ç­‰)
       â”œâ”€ ä¼ è¾“ä¼˜å…ˆçº§ï¼šéƒ½ä¸æ˜¯ä»¥å¤ªç½‘/è“ç‰™ï¼Œç»§ç»­
       â”œâ”€ è¯„åˆ†æ¯”è¾ƒï¼šLTE (65) &gt; WiFi (25)
       â””â”€ ç»“è®ºï¼šLTE æ˜¯æ›´å¥½çš„ç½‘ç»œ

<span class="hljs-attr">T</span>=<span class="hljs-number">16.1</span>s: åšå‡ºåˆ‡æ¢å†³å®š
         â””â”€ ConnectivityService: "WiFi è¯„åˆ†å¤ªä½ï¼Œåº”è¯¥åˆ‡æ¢åˆ° LTE"

<span class="hljs-attr">T</span>=<span class="hljs-number">16.2</span>s: è¿›å…¥ Lingerï¼ˆå¦‚æœ WiFi æœ‰æ´»è·ƒè¯·æ±‚ï¼‰
         â”œâ”€ WiFi çŠ¶æ€å˜ä¸º LOSING
         â”œâ”€ è®¾ç½® 120 ç§’ Linger è®¡æ—¶å™¨
         â”œâ”€ è°ƒç”¨ onLosing(wifiNetwork, 120000)
         â””â”€ LTE æˆä¸ºæ–°çš„é»˜è®¤ç½‘ç»œ

<span class="hljs-attr">T</span>=<span class="hljs-number">16.3</span>s: åº”ç”¨è¡Œä¸ºæ”¹å˜
         â”œâ”€ æ–°çš„ç½‘ç»œè¯·æ±‚ â†’ LTE
         â”œâ”€ ç°æœ‰ Socket â†’ WiFi (ä»åœ¨ Linger)
         â”œâ”€ ConnectivityManager.getActiveNetwork() â†’ LTE
         â””â”€ åº”ç”¨å¯èƒ½ä¸æ„ŸçŸ¥ï¼ˆå·²åœ¨ Lingerï¼‰

<span class="hljs-attr">T</span>=<span class="hljs-number">60</span>s: WiFi ä¿¡å·å®Œå…¨ä¸§å¤±
       â”œâ”€ WiFi æ–­å¼€
       â”œâ”€ WiFi çŠ¶æ€å˜ä¸º DISCONNECTED
       â””â”€ onLost() å›è°ƒ

<span class="hljs-attr">T</span>=<span class="hljs-number">136</span>s: å¦‚æœ WiFi ä¿¡å·ä¸€ç›´æ²¡æœ‰æ¢å¤ï¼ŒLinger æœŸæ»¡
        â””â”€ WiFi è¢«å¼ºåˆ¶æ–­å¼€ï¼ˆå¦‚æœä»åœ¨ Lingerï¼‰
</code></pre>
<p>ã€åˆ‡æ¢çš„å¹³æ»‘åº¦ä¼˜åŒ–ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>ä¸ºäº†è®©ç”¨æˆ·æ— æ„ŸçŸ¥åœ°åˆ‡æ¢ç½‘ç»œï¼ŒAndroid é‡‡ç”¨äº†å¤šç§ä¼˜åŒ–ï¼š</p>
<p>ä¼˜åŒ– 1: Linger æœºåˆ¶
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œâ”€ ç»™æ—§ç½‘ç»œä¿æ´»æ—¶é—´ï¼ˆ120 ç§’ï¼‰
â”œâ”€ å·²å»ºç«‹çš„è¿æ¥ç»§ç»­ç”¨æ—§ç½‘ç»œ
â”œâ”€ æ–°è¿æ¥è‡ªåŠ¨ç”¨æ–°ç½‘ç»œ
â””â”€ åº”ç”¨æ— éœ€æ”¹å˜ä»£ç </p>
<p>ä¼˜åŒ– 2: è¿æ¥æ± å¤ç”¨
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
HTTP:
â”œâ”€ TCP è¿æ¥æ± ç»‘å®šåˆ°ç½‘ç»œ
â”œâ”€ æ–°ç½‘ç»œï¼Œæ–°è¿æ¥æ± 
â””â”€ æ—§è¿æ¥åœ¨æ—§ç½‘ç»œä¸Šç»§ç»­ç”¨</p>
<p>Socket:
â”œâ”€ ä½¿ç”¨ Network.getSocketFactory() åˆ›å»º
â”œâ”€ ç»‘å®šåˆ°ç‰¹å®šç½‘ç»œ
â””â”€ ç½‘ç»œæ–­å¼€æ—¶æ‰ä¼šä¸­æ–­</p>
<p>ä¼˜åŒ– 3: DNS ç¼“å­˜
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œâ”€ åŸŸåè§£æç»“æœè¢«ç¼“å­˜
â”œâ”€ é¿å…é¢‘ç¹é‡æ–°è§£æ
â””â”€ è·¨ç½‘ç»œä½¿ç”¨ç¼“å­˜ç»“æœ</p>
<p>ä¼˜åŒ– 4: é¢„è¿æ¥
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œâ”€ è¯†åˆ«å³å°†éœ€è¦çš„èµ„æº
â”œâ”€ åœ¨æ–°ç½‘ç»œä¸Šé¢„å…ˆå»ºç«‹è¿æ¥
â””â”€ ç”¨æˆ·åˆ‡æ¢æ—¶ç«‹å³å¯ç”¨</p>
<p>ä¼˜åŒ– 5: ä¿¡å·é¢„æµ‹
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
åŸºäºå†å²æ•°æ®ï¼š
â”œâ”€ WiFi é€šå¸¸åœ¨è¿™ä¸ªä½ç½®ä¼šæ–­å¼€
â”œâ”€ è¿™ä¸ªæ—¶é—´æ®µ LTE ä¿¡å·è¾ƒå¼±
â”œâ”€ æ ¹æ®é¢„æµ‹ä¸»åŠ¨è°ƒæ•´ç½‘ç»œé€‰æ‹©
â””â”€ å‡å°‘ç½‘ç»œå¡é¡¿</p>
<pre><code class="hljs language-markdown" lang="markdown">
ç°åœ¨è¿›å…¥ç¬¬ 6 éƒ¨åˆ†ï¼š

<span class="hljs-section">### <span class="hljs-strong">**6ã€å®æˆ˜ï¼šç½‘ç»œé—®é¢˜è¯Šæ–­ä¸ä¼˜åŒ–**</span></span>

</code></pre>
<p>ã€WiFi è¿æ¥å¤±è´¥çš„æ’æŸ¥æµç¨‹ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>é—®é¢˜ï¼šç”¨æˆ·æ— æ³•è¿æ¥åˆ°ç‰¹å®šçš„ WiFi SSID</p>
<p>è¯Šæ–­æ­¥éª¤ï¼š</p>
<p>Step 1: æ£€æŸ¥åº•å±‚ WiFi é©±åŠ¨
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">adb logcat | <span class="hljs-keyword">grep</span> -i <span class="hljs-string">"wifi"</span>
</code></pre>
<p>å…³é”®æ—¥å¿—ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">WifiManager:</span> [Network <span class="hljs-keyword">event</span> callback]
<span class="hljs-symbol">WifiManager:</span> State change: SCANNING
<span class="hljs-symbol">WifiManager:</span> State change: CONNECTING
<span class="hljs-symbol">WifiManager:</span> State change: AUTHENTICATING
<span class="hljs-symbol">WifiManager:</span> State change: OBTAINING_IPADDR
<span class="hljs-symbol">WifiManager:</span> State change: CONNECTED
<span class="hljs-symbol">WifiManager:</span> State change: DISCONNECTED (reason=X)
</code></pre>
<p>å¸¸è§çš„æ–­å¼€åŸå› ä»£ç ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">reason</span>=<span class="hljs-number">1</span>    : WIFI_REASON_UNSPECIFIED (æœªæŒ‡å®š)
<span class="hljs-attr">reason</span>=<span class="hljs-number">2</span>    : WIFI_REASON_WRONG_PASSWORD (å¯†ç é”™è¯¯)
<span class="hljs-attr">reason</span>=<span class="hljs-number">3</span>    : WIFI_REASON_AUTH_FAILED (è®¤è¯å¤±è´¥)
<span class="hljs-attr">reason</span>=<span class="hljs-number">4</span>    : WIFI_REASON_NETWORK_UNAVAILABLE (ç½‘ç»œä¸å¯ç”¨)
<span class="hljs-attr">reason</span>=<span class="hljs-number">5</span>    : WIFI_REASON_DEAUTH_RECEIVED (æ”¶åˆ° Deauth å¸§)
<span class="hljs-attr">reason</span>=<span class="hljs-number">6</span>    : WIFI_REASON_DISASSOC_RECEIVED (æ”¶åˆ° Disassoc å¸§)
<span class="hljs-attr">reason</span>=<span class="hljs-number">7</span>    : WIFI_REASON_ASSOC_FAILED (å…³è”å¤±è´¥)
<span class="hljs-attr">reason</span>=<span class="hljs-number">8</span>    : WIFI_REASON_HAND_SHAKE_TIMEOUT (æ¡æ‰‹è¶…æ—¶)
</code></pre>
<p>è¯Šæ–­ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">å¦‚æœæ—¥å¿—æ˜¾ç¤º AUTHENTICATING åœç•™å¾ˆä¹…åè·³åˆ° DISCONNECTED
â”œâ”€ å¯èƒ½åŸå› ï¼šå¯†ç é”™è¯¯ã€è·¯ç”±å™¨ä¸æ”¯æŒè¯¥åŠ å¯†æ–¹å¼
â””â”€ è§£å†³ï¼šæ£€æŸ¥å¯†ç ã€æ£€æŸ¥è·¯ç”±å™¨é…ç½®

å¦‚æœå¿«é€Ÿæ˜¾ç¤º DISCONNECTEDï¼Œ<span class="hljs-attr">reason</span>=<span class="hljs-number">5</span>
â”œâ”€ AP æ‹’ç»è¿æ¥ï¼ˆå¯èƒ½ MAC è¿‡æ»¤ã€å®‰å…¨é—®é¢˜ï¼‰
â””â”€ è”ç³» WiFi ç®¡ç†å‘˜
</code></pre>
<p>Step 2: æ£€æŸ¥ IP é…ç½®
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å‘½ä»¤ï¼š</p>
<pre><code class="hljs">adb shell ifconfig wlan0
</code></pre>
<p>è¾“å‡ºç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">wlan0: <span class="hljs-attr">flags</span>=<span class="hljs-number">4163</span>&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;
       inet 192.168.1.100  netmask 255.255.255.0  broadcast 192.168.1.255
       inet6 fe80::xxxx:yyyy:zzzz:wwww  prefixlen 64  scopeid 0x20&lt;link&gt;
       ...
</code></pre>
<p>è¯Šæ–­ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">å¦‚æœæ²¡æœ‰ inet åœ°å€ï¼š
â”œâ”€ DHCP æ²¡æœ‰ç»™ IP
â”œâ”€ å¯èƒ½è·¯ç”±å™¨ DHCP æ•…éšœ
â””â”€ æˆ–è€… <span class="hljs-built_in">WiFi</span> é©±åŠ¨é—®é¢˜

å¦‚æœæœ‰ inet åœ°å€ï¼Œå¯ä»¥ç»§ç»­
</code></pre>
<p>Step 3: æ£€æŸ¥ç½‘ç»œè¿æ¥æ€§
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-r" lang="r">adb shell ping <span class="hljs-operator">-</span><span class="hljs-built_in">c</span> <span class="hljs-number">4</span> <span class="hljs-number">8.8</span>.8.8
</code></pre>
<p>ç»“æœï¼š</p>
<pre><code class="hljs language-python" lang="python">æˆåŠŸï¼š
PING <span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span> (<span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span>): <span class="hljs-number">56</span> data <span class="hljs-built_in">bytes</span>
<span class="hljs-number">64</span> <span class="hljs-built_in">bytes</span> <span class="hljs-keyword">from</span> <span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span>: seq=<span class="hljs-number">0</span> ttl=<span class="hljs-number">57</span> time=<span class="hljs-number">25.3</span> ms
<span class="hljs-number">64</span> <span class="hljs-built_in">bytes</span> <span class="hljs-keyword">from</span> <span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span>: seq=<span class="hljs-number">1</span> ttl=<span class="hljs-number">57</span> time=<span class="hljs-number">24.8</span> ms
...

å¤±è´¥ï¼š
PING <span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span> (<span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span>): <span class="hljs-number">56</span> data <span class="hljs-built_in">bytes</span>
(no response)
</code></pre>
<p>è¯Šæ–­ï¼š</p>
<pre><code class="hljs">å¦‚æœ ping æˆåŠŸï¼š
â”œâ”€ IP é…ç½®æ­£å¸¸
â”œâ”€ DNS å¯èƒ½æœ‰é—®é¢˜ï¼ˆè§ä¸‹ä¸€æ­¥ï¼‰
â””â”€ æˆ–è€…æ˜¯åº”ç”¨é—®é¢˜

å¦‚æœ ping å¤±è´¥ï¼š
â”œâ”€ ç½‘ç»œè¿æ¥ç¡®å®æœ‰é—®é¢˜
â”œâ”€ å¯èƒ½åŸå› ï¼š
â”‚  â”œâ”€ è·¯ç”±å™¨ç½‘ç»œæ•…éšœ
â”‚  â”œâ”€ ISP æ–­ç½‘
â”‚  â”œâ”€ é˜²ç«å¢™é˜»æ­¢
â”‚  â””â”€ è·¯ç”±å™¨è®¾ç½®ä¸å½“
</code></pre>
<p>Step 4: æ£€æŸ¥ DNS è§£æ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å‘½ä»¤ï¼š</p>
<pre><code class="hljs">adb shell nslookup google.com
æˆ–
adb shell getprop net.dns1
adb shell getprop net.dns2
</code></pre>
<p>ç»“æœï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">æˆåŠŸï¼š
<span class="hljs-symbol">Server:</span>         <span class="hljs-number">8.8</span>.<span class="hljs-number">8.8</span>
<span class="hljs-symbol">Address:</span>        <span class="hljs-number">8.8</span>.<span class="hljs-number">8.8#</span><span class="hljs-number">53</span>

<span class="hljs-symbol">Name:</span>   google.com
<span class="hljs-symbol">Address:</span> <span class="hljs-number">142.251</span>.<span class="hljs-number">41.14</span>

å¤±è´¥ï¼š
<span class="hljs-symbol">nslookup:</span> can<span class="hljs-comment">'t resolve google.com</span>
</code></pre>
<p>è¯Šæ–­ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">å¦‚æœ DNS å¤±è´¥ï¼š
â”œâ”€ è·¯ç”±å™¨ DNS æ•…éšœ
â”œâ”€ æ”¹ç”¨å…¬å…± DNS (<span class="hljs-number">8.8</span>.<span class="hljs-number">8.8</span>, <span class="hljs-number">1.1</span>.<span class="hljs-number">1.1</span>)
â””â”€ æ£€æŸ¥è·¯ç”±å™¨ DHCP é…ç½®

å¦‚æœ DNS æˆåŠŸä½†æµè§ˆå™¨ä¸å·¥ä½œï¼š
â”œâ”€ å¯èƒ½æ˜¯ä»£ç†é—®é¢˜
â”œâ”€ æˆ–è€…é˜²ç«å¢™é—®é¢˜
â””â”€ æˆ–åº”ç”¨æƒé™ä¸è¶³
</code></pre>
<p>Step 5: æ£€æŸ¥ ConnectivityService æ—¥å¿—
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">adb logcat -b <span class="hljs-keyword">system</span> | <span class="hljs-keyword">grep</span> -i <span class="hljs-string">"connectivity"</span>
</code></pre>
<p>å…³é”®æ—¥å¿—ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">ConnectivityService:</span> <span class="hljs-string">updateNetworkInfo()</span>
<span class="hljs-attr">ConnectivityService:</span> <span class="hljs-string">handleNetworkInfoChange()</span>
<span class="hljs-attr">ConnectivityService:</span> <span class="hljs-string">maybeNotifyNetworkCallbacks()</span>

<span class="hljs-string">//</span> <span class="hljs-string">ç½‘ç»œçŠ¶æ€å˜åŒ–</span>
<span class="hljs-attr">NetworkInfo:</span> <span class="hljs-string">State=CONNECTING</span> <span class="hljs-string">-&gt;</span> <span class="hljs-string">State=CONNECTED</span>
<span class="hljs-attr">NetworkInfo:</span> <span class="hljs-string">DetailedState=AUTHENTICATING</span> <span class="hljs-string">-&gt;</span> <span class="hljs-string">DetailedState=CONNECTED</span>

<span class="hljs-string">//</span> <span class="hljs-string">èƒ½åŠ›å˜åŒ–</span>
<span class="hljs-attr">NetworkCapabilities:</span> <span class="hljs-string">INTERNET,</span> <span class="hljs-string">NOT_METERED,</span> <span class="hljs-string">NOT_ROAMING,</span> <span class="hljs-string">VALIDATED</span>

<span class="hljs-string">//</span> <span class="hljs-string">è¯„åˆ†</span>
<span class="hljs-attr">Network score:</span> <span class="hljs-number">75</span>
</code></pre>
<p>è¯Šæ–­ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">å¦‚æœçœ‹åˆ° CONNECTED ä½†æ²¡æœ‰ VALIDATEDï¼š
â”œâ”€ NetworkMonitor éªŒè¯å¤±è´¥
â”œâ”€ å¯èƒ½æ˜¯å¼ºåˆ¶é—¨æˆ·ï¼ˆéœ€è¦ç™»å½•ï¼‰
â”œâ”€ æˆ–ç½‘ç»œç¡®å®æ— äº’è”ç½‘
â””â”€ æŸ¥çœ‹ä¸‹ä¸€æ­¥çš„ NetworkMonitor æ—¥å¿—

å¦‚æœæ²¡æœ‰çœ‹åˆ°ç½‘ç»œåˆ›å»ºï¼ˆnetIdï¼‰ï¼š
â”œâ”€ ç½‘ç»œæ²¡æœ‰è¢«æ­£ç¡®æ³¨å†Œ
â”œâ”€ å¯èƒ½ NetworkAgent æœ‰é—®é¢˜
â””â”€ æ£€æŸ¥ <span class="hljs-built_in">WiFi</span> é©±åŠ¨æˆ– WifiService
</code></pre>
<p>Step 6: æ£€æŸ¥ NetworkMonitor éªŒè¯çŠ¶æ€
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">adb logcat | <span class="hljs-keyword">grep</span> -i <span class="hljs-string">"NetworkMonitor"</span>
</code></pre>
<p>å…³é”®æ—¥å¿—ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">NetworkMonitor:</span> Probing network...
<span class="hljs-symbol">NetworkMonitor:</span> <span class="hljs-keyword">GET</span> http://www.google.com/generate_204
<span class="hljs-symbol">NetworkMonitor:</span> Response code: <span class="hljs-number">204</span>
<span class="hljs-symbol">NetworkMonitor:</span> Network validation successful

æˆ–

<span class="hljs-symbol">NetworkMonitor:</span> <span class="hljs-keyword">GET</span> http://...
<span class="hljs-symbol">NetworkMonitor:</span> Captive portal detected
<span class="hljs-symbol">NetworkMonitor:</span> Response code: <span class="hljs-number">302</span> (redirect)

æˆ–

<span class="hljs-symbol">NetworkMonitor:</span> Probe failed
<span class="hljs-symbol">NetworkMonitor:</span> DNS timeout
</code></pre>
<p>è¯Šæ–­ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">å¦‚æœçœ‹åˆ° <span class="hljs-string">"validation successful"</span>ï¼š
â”œâ”€ ç½‘ç»œå·²éªŒè¯ï¼Œåº”è¯¥å¯ä»¥ç”¨
â”œâ”€ å¦‚æœåº”ç”¨è¿˜æ˜¯ä¸èƒ½è”ç½‘ï¼Œå¯èƒ½æ˜¯åº”ç”¨æƒé™é—®é¢˜

å¦‚æœçœ‹åˆ° <span class="hljs-string">"Captive portal detected"</span>ï¼š
â”œâ”€ éœ€è¦ç™»å½• <span class="hljs-built_in">WiFi</span>
â”œâ”€ ç³»ç»Ÿä¼šå¼¹å‡º portal ç™»å½•çª—å£
â””â”€ ç”¨æˆ·éœ€è¦åœ¨æµè§ˆå™¨ä¸­è®¤è¯

å¦‚æœçœ‹åˆ° <span class="hljs-string">"Probe failed"</span>ï¼š
â”œâ”€ éªŒè¯å¤±è´¥ï¼Œç½‘ç»œä¸å¯ç”¨
â”œâ”€ åŸå› ï¼šæ²¡æœ‰ IPv4, IPv6, æˆ– DNS é—®é¢˜
â””â”€ æ£€æŸ¥ç½‘ç»œé…ç½®
</code></pre>
<p>Step 7: æ£€æŸ¥åº”ç”¨æƒé™
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">adb shell cmd appops get com.your.app INTERNET
</code></pre>
<p>ç»“æœï¼š</p>
<pre><code class="hljs language-rust" lang="rust">Allow       <span class="hljs-punctuation">-&gt;</span> æœ‰æƒé™
Deny        <span class="hljs-punctuation">-&gt;</span> æ— æƒé™
<span class="hljs-built_in">Default</span>     <span class="hljs-punctuation">-&gt;</span> è·Ÿéšç³»ç»Ÿè®¾ç½®
</code></pre>
<p>å¦‚æœæ— æƒé™ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">adb shell cmd appops set com.your.app INTERNET allow
</code></pre>
<p>å…¶ä»–éœ€è¦çš„æƒé™ï¼š</p>
<pre><code class="hljs language-rust" lang="rust">ACCESS_NETWORK_STATE      <span class="hljs-punctuation">-&gt;</span> æŸ¥è¯¢ç½‘ç»œçŠ¶æ€
ACCESS_WIFI_STATE         <span class="hljs-punctuation">-&gt;</span> æŸ¥è¯¢ WiFi çŠ¶æ€
CHANGE_NETWORK_STATE      <span class="hljs-punctuation">-&gt;</span> åˆ‡æ¢ç½‘ç»œ
</code></pre>
<p>è¯Šæ–­ï¼š</p>
<pre><code class="hljs">å¦‚æœåº”ç”¨æœ‰ INTERNET æƒé™ä½†ä»ä¸èƒ½è¿ï¼š
â”œâ”€ å¯èƒ½æ˜¯ç½‘ç»œæœ¬èº«çš„é—®é¢˜ï¼ˆè§å‰é¢æ­¥éª¤ï¼‰
â”œâ”€ æˆ–åº”ç”¨æœ‰ bugï¼ˆå‘é€ä¸æ­£ç¡®çš„è¯·æ±‚ï¼‰
â””â”€ ç”¨ tcpdump æŠ“åŒ…æ£€æŸ¥
</code></pre>
<p>Step 8: æŠ“åŒ…åˆ†ææµé‡
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">adb shell tcpdump -i wlan0 -w /sdcard/traffic.pcap
<span class="hljs-comment">// è¿è¡Œåº”ç”¨å’Œé‡ç°é—®é¢˜</span>
adb pull /sdcard/traffic.pcap
<span class="hljs-comment">// ç”¨ Wireshark åˆ†æ</span>
</code></pre>
<p>å…³é”®æ£€æŸ¥ç‚¹ï¼š</p>
<pre><code class="hljs language-vbscript" lang="vbscript">DHCP é˜¶æ®µï¼š
â”œâ”€ è®¾å¤‡å‘é€ DHCP Discovery
â”œâ”€ è·¯ç”±å™¨å“åº” DHCP Offer
â”œâ”€ è®¾å¤‡å‘é€ DHCP <span class="hljs-built_in">Request</span>
â””â”€ è·¯ç”±å™¨å“åº” DHCP ACK

DNS é˜¶æ®µï¼š
â”œâ”€ è®¾å¤‡å‘é€ DNS Query (A æˆ– AAAA)
â”œâ”€ DNS æœåŠ¡å™¨å“åº”ç»“æœ
â””â”€ æ£€æŸ¥æ˜¯å¦æœ‰è¶…æ—¶æˆ–é”™è¯¯

HTTP/HTTPS é˜¶æ®µï¼š
â”œâ”€ TCP <span class="hljs-number">3</span>-way handshake
â”œâ”€ HTTP <span class="hljs-keyword">GET</span>/POST è¯·æ±‚
â”œâ”€ æ£€æŸ¥å“åº”çŠ¶æ€ç 
â””â”€ æ£€æŸ¥æ˜¯å¦æœ‰è¶…æ—¶
</code></pre>
<p>ã€ç½‘ç»œåˆ‡æ¢å¼‚å¸¸çš„å®šä½ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>é—®é¢˜ï¼šè®¾å¤‡é¢‘ç¹åˆ‡æ¢ WiFi å’Œ LTEï¼ˆæŠ–åŠ¨ï¼‰</p>
<p>è¯Šæ–­ï¼š</p>
<p>Step 1: ç¡®è®¤æ˜¯å¦çœŸçš„åœ¨åˆ‡æ¢
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">adb logcat -b <span class="hljs-keyword">system</span> | <span class="hljs-keyword">grep</span> -E <span class="hljs-string">"rematch|default|network.available"</span>
</code></pre>
<p>æ—¥å¿—ç¤ºä¾‹ï¼ˆè¡¨ç¤ºåœ¨åˆ‡æ¢ï¼‰ï¼š</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">T+0.0s: [WiFi] Network score: 75</span>
<span class="hljs-section">T+1.5s: [LTE] Network score: 65</span>
<span class="hljs-section">T+2.0s: rematchAllNetworksAndRequests() -&gt; é€‰æ‹© WiFi</span>
<span class="hljs-section">T+5.0s: [WiFi] Network score: 45 (ä¿¡å·å˜å¼±)</span>
<span class="hljs-section">T+5.1s: rematchAllNetworksAndRequests() -&gt; é€‰æ‹© LTE</span>
<span class="hljs-section">T+5.2s: WiFi entering LOSING state</span>
<span class="hljs-section">T+8.0s: [WiFi] Network score: 75 (ä¿¡å·æ¢å¤!)</span>
<span class="hljs-section">T+8.1s: rematchAllNetworksAndRequests() -&gt; é€‰æ‹© WiFi (å–æ¶ˆ Linger)</span>
<span class="hljs-section">T+10.0s: (é‡å¤ä¸Šé¢çš„å¾ªç¯)</span>
</code></pre>
<p>è¯Šæ–­ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">å¦‚æœé¢‘ç¹çœ‹åˆ°è¿™ç§æ—¥å¿—ï¼š
â”œâ”€ <span class="hljs-built_in">WiFi</span> ä¿¡å·ä¸ç¨³å®šï¼ˆä¿¡å·åœ¨è¾¹ç•Œï¼Œä¸Šä¸‹æ³¢åŠ¨ï¼‰
â”œâ”€ NetworkRanker æ¯æ¬¡è¯„åˆ†å˜åŒ–éƒ½è§¦å‘é‡æ–°åŒ¹é…
â””â”€ è¿™å¯¼è‡´é¢‘ç¹åˆ‡æ¢
</code></pre>
<p>Step 2: æ£€æŸ¥ä¿¡å·å¼ºåº¦å˜åŒ–
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">adb logcat | <span class="hljs-keyword">grep</span> -E <span class="hljs-string">"SignalStrength|RSSI|RSRP"</span>
</code></pre>
<p>æ—¥å¿—ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-rust" lang="rust">WifiManager: RSSI changed: -<span class="hljs-number">60</span>dbm <span class="hljs-punctuation">-&gt;</span> -<span class="hljs-number">70</span>dbm <span class="hljs-punctuation">-&gt;</span> -<span class="hljs-number">60</span>dbm <span class="hljs-punctuation">-&gt;</span> -<span class="hljs-number">70</span>dbm ...
TelephonyManager: Signal strength: <span class="hljs-number">2</span> bars <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">3</span> bars <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">2</span> bars <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">3</span> bars ...
</code></pre>
<p>è¯Šæ–­ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">å¦‚æœçœ‹åˆ°ä¿¡å·åœ¨è¾¹ç•Œé¢‘ç¹æ³¢åŠ¨ï¼š
â”œâ”€ ç‰©ç†ä½ç½®åœ¨ä¿¡å·è¾¹ç•Œ
â”œâ”€ ç”¨æˆ·èµ°è¿‘/ç¦»å¼€ <span class="hljs-built_in">WiFi</span> è·¯ç”±å™¨
â””â”€ è§£å†³ï¼šå»ºè®®ç”¨æˆ·ç§»åŠ¨ä½ç½®æˆ–åŠ å¼º <span class="hljs-built_in">WiFi</span> è¦†ç›–
</code></pre>
<p>Step 3: æ£€æŸ¥è¯„åˆ†è®¡ç®—
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">adb logcat | <span class="hljs-keyword">grep</span> <span class="hljs-string">"NetworkScore"</span>
</code></pre>
<p>æ—¥å¿—ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">WiFi score:</span> <span class="hljs-number">60</span> <span class="hljs-string">(RSSI:</span> <span class="hljs-string">-75dbm,</span> <span class="hljs-attr">validated:</span> <span class="hljs-literal">true</span><span class="hljs-string">,</span> <span class="hljs-attr">exiting:</span> <span class="hljs-literal">false</span><span class="hljs-string">)</span>
<span class="hljs-attr">LTE score:</span> <span class="hljs-number">65</span> <span class="hljs-string">(RSRP:</span> <span class="hljs-string">-90dbm,</span> <span class="hljs-attr">validated:</span> <span class="hljs-literal">true</span><span class="hljs-string">,</span> <span class="hljs-attr">exiting:</span> <span class="hljs-literal">false</span><span class="hljs-string">)</span>

<span class="hljs-attr">Decision:</span> <span class="hljs-string">LTE</span> <span class="hljs-string">&gt;</span> <span class="hljs-string">WiFi,</span> <span class="hljs-string">switch</span> <span class="hljs-string">to</span> <span class="hljs-string">LTE</span>
</code></pre>
<p>è¯Šæ–­ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">å¦‚æœè¯„åˆ†éƒ½æ­£ç¡®ï¼Œä½†é¢‘ç¹åˆ‡æ¢ï¼š
â”œâ”€ å¯èƒ½æ˜¯ç½‘ç»œæ’åºç®—æ³•çš„é—®é¢˜
â”œâ”€ æˆ–è€… NetworkRanker çš„ <span class="hljs-string">"stickiness"</span> æ²¡æœ‰ç”Ÿæ•ˆ
â””â”€ æ£€æŸ¥å½“å‰é»˜è®¤ç½‘ç»œæ˜¯å¦åœ¨ candidates ä¸­
</code></pre>
<p>Step 4: è°ƒæ•´å‚æ•°ä»¥å‡å°‘åˆ‡æ¢
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>ç³»ç»Ÿå±æ€§ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># å¢åŠ  Linger æ—¶é—´ï¼ˆç»™ç½‘ç»œæ¢å¤æ›´å¤šæ—¶é—´ï¼‰</span>
<span class="hljs-attr">ro.config.ip_linger_ms</span>=<span class="hljs-number">300000</span>  (é»˜è®¤ <span class="hljs-number">120000</span>)

<span class="hljs-comment"># æ”¹å˜è¯„åˆ†åå¥½</span>
<span class="hljs-attr">persist.sys.wifi.prefer_bad_wifi</span>=<span class="hljs-literal">true</span>  (å€¾å‘äºä¿ç•™ WiFi)

<span class="hljs-comment"># ç¦ç”¨è‡ªåŠ¨åˆ‡æ¢ï¼ˆä¸æ¨èï¼‰</span>
<span class="hljs-attr">persist.sys.disable_network_switching</span>=<span class="hljs-literal">true</span>
</code></pre>
<p>ä»£ç å±‚é¢çš„è§£å†³ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">åœ¨ NetworkRanker ä¸­å¢åŠ <span class="hljs-string">"ç²˜æ€§"</span>è¯„åˆ†å¥–åŠ±ï¼š
â”œâ”€ å¦‚æœå½“å‰ç½‘ç»œè¿˜åœ¨ candidates ä¸­
â”œâ”€ ç»™å½“å‰ç½‘ç»œ +<span class="hljs-number">10</span> åˆ†ï¼ˆç²˜æ€§å¥–åŠ±ï¼‰
â”œâ”€ å‡å°‘ä¸å¿…è¦çš„åˆ‡æ¢
â””â”€ åªåœ¨è¯„åˆ†å·®å¼‚è¶³å¤Ÿå¤§æ—¶æ‰åˆ‡æ¢
</code></pre>
<p>ã€ç½‘ç»œæ€§èƒ½ä¼˜åŒ–ã€‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</p>
<p>ä¼˜åŒ– 1: åŠ é€Ÿç½‘ç»œå°±ç»ªæ—¶é—´
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>é—®é¢˜ï¼šä»æ— ç½‘ç»œåˆ°æœ‰ç½‘ç»œè¦ 10 ç§’</p>
<p>ä¼˜åŒ–æ–¹æ³•ï¼š</p>
<p>a) å¹¶è¡Œåˆå§‹åŒ–</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸æ¨èï¼šä¸²è¡Œ</span>
step1_getIPAddress();  <span class="hljs-comment">// 3 ç§’</span>
step2_startDNS();      <span class="hljs-comment">// 2 ç§’</span>
step3_startValidation();  <span class="hljs-comment">// 5 ç§’</span>
<span class="hljs-comment">// æ€»è€—æ—¶ï¼š10 ç§’</span>

<span class="hljs-comment">// æ¨èï¼šå¹¶è¡Œ</span>
parallel {
    task1: getIPAddress();       <span class="hljs-comment">// 3 ç§’</span>
    task2: startDNS();           <span class="hljs-comment">// 2 ç§’</span>
    task3: startValidation();    <span class="hljs-comment">// 5 ç§’ (å¹¶è¡Œ)</span>
}
<span class="hljs-comment">// æ€»è€—æ—¶ï¼š5 ç§’ (æœ€é•¿çš„ä»»åŠ¡)</span>
</code></pre>
<p>b) éªŒè¯ç¼“å­˜</p>
<pre><code class="hljs language-arduino" lang="arduino">å¦‚æœç›¸åŒ SSID çš„ <span class="hljs-built_in">WiFi</span> åœ¨ <span class="hljs-number">1</span> å°æ—¶å†…éªŒè¯è¿‡ï¼š
â”œâ”€ è·³è¿‡éªŒè¯ï¼Œç›´æ¥æ ‡è®°ä¸º VALIDATED
â”œâ”€ æˆ–å‘é€æ¢æµ‹ä½†ä¸ç­‰ç»“æœ
â””â”€ èŠ‚çœ <span class="hljs-number">3</span><span class="hljs-number">-5</span> ç§’
</code></pre>
<p>c) æå‰å¯åŠ¨ç½‘ç»œæœåŠ¡</p>
<pre><code class="hljs">åœ¨ CONNECTING çŠ¶æ€ï¼Œå°±å¯ä»¥ï¼š
â”œâ”€ å¯åŠ¨ DNS è§£æ
â”œâ”€ å¯åŠ¨ HTTP è¿æ¥æ± 
â”œâ”€ é¢„åŠ è½½å¸¸ç”¨èµ„æº
â””â”€ ç­‰ CONNECTED æ—¶ç«‹å³å¯ç”¨
</code></pre>
<p>ä¼˜åŒ– 2: é™ä½ç½‘ç»œåˆ‡æ¢çš„å»¶è¿Ÿ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>é—®é¢˜ï¼šWiFi åˆ° LTE çš„åˆ‡æ¢éœ€è¦ 2-3 ç§’</p>
<p>ä¼˜åŒ–æ–¹æ³•ï¼š</p>
<p>a) é¢„è¿æ¥</p>
<pre><code class="hljs">è¯†åˆ«å³å°†éœ€è¦çš„æœåŠ¡å™¨ï¼š
â”œâ”€ å»ºç«‹ TCP è¿æ¥ï¼ˆSYN å‘é€ï¼‰
â”œâ”€ å»ºç«‹ TLS æ¡æ‰‹ï¼ˆéƒ¨åˆ†å®Œæˆï¼‰
â””â”€ å½“ Linger æ—¶ç”¨æˆ·äº¤äº’æ—¶ï¼Œç«‹å³å¯ç”¨
</code></pre>
<p>b) è¿æ¥å¤ç”¨</p>
<pre><code class="hljs">ä½¿ç”¨ HTTP/2 å’Œ HTTP/3ï¼š
â”œâ”€ å¤šè·¯å¤ç”¨ï¼ˆé¿å…å¤šä¸ª TCP è¿æ¥ï¼‰
â”œâ”€ è¿æ¥è¿ç§»ï¼ˆè·¨ç½‘ç»œä¿æ´»è¿æ¥ï¼‰
â””â”€ å¤´éƒ¨å‹ç¼©ï¼ˆå‡å°‘é‡å»ºè¿æ¥çš„å¼€é”€ï¼‰
</code></pre>
<p>c) ç¼“å­˜å’Œç¦»çº¿æ”¯æŒ</p>
<pre><code class="hljs">ç¼“å­˜å…³é”®èµ„æºï¼š
â”œâ”€ é¿å…ç½‘ç»œåˆ‡æ¢æ—¶é‡æ–°è·å–
â”œâ”€ Service Worker æä¾›ç¦»çº¿æ”¯æŒ
â””â”€ ç”¨æˆ·æ— æ„ŸçŸ¥åˆ‡æ¢
</code></pre>
<p>ä¼˜åŒ– 3: å‡å°‘ç”µæ± æ¶ˆè€—
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</p>
<p>é—®é¢˜ï¼šWiFi å’Œ LTE åŒæ—¶æ´»è·ƒæ¶ˆè€—ç”µæ± </p>
<p>ä¼˜åŒ–æ–¹æ³•ï¼š</p>
<p>a) åŠæ—¶å…³é—­ Linger ä¸­çš„ç½‘ç»œ</p>
<pre><code class="hljs">å½“ç½‘ç»œè´¨é‡å·®æ—¶ï¼š
â”œâ”€ ä¸ç­‰ 120 ç§’ Linger å®Œæˆ
â”œâ”€ ç«‹å³åˆ‡æ¢å¹¶æ–­å¼€æ—§ç½‘ç»œ
â””â”€ çœç”µ
</code></pre>
<p>b) åˆå¹¶ DNS æŸ¥è¯¢</p>
<pre><code class="hljs">ä¸åŒåº”ç”¨çš„ DNS æŸ¥è¯¢ï¼š
â”œâ”€ ç³»ç»Ÿç¼“å­˜ï¼Œé¿å…é‡å¤æŸ¥è¯¢
â”œâ”€ å‡å°‘ç½‘ç»œèŠ¯ç‰‡å”¤é†’æ¬¡æ•°
â””â”€ æ›´çœç”µ
</code></pre>
<p>c) æ™ºèƒ½é¢„æµ‹</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">åŸºäºåº”ç”¨ä½¿ç”¨æ¨¡å¼ï¼š</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">é¢„æµ‹ç”¨æˆ·ä½•æ—¶éœ€è¦ç½‘ç»œ</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-string">æå‰å»ºç«‹ç½‘ç»œï¼Œé¿å…é¢‘ç¹å¼€å…³</span>
<span class="hljs-string">â””â”€</span> <span class="hljs-string">æ¯”åå¤å¼€å…³æ›´çœç”µ</span>


<span class="hljs-string">ä¼˜åŒ–</span> <span class="hljs-attr">4:</span> <span class="hljs-string">æé«˜ç½‘ç»œç¨³å®šæ€§</span>
<span class="hljs-string">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>

<span class="hljs-string">a)</span> <span class="hljs-string">å¢å¼ºå‹æ¡æ‰‹</span>
</code></pre>
<p>åœ¨ä¸ç¨³å®šç½‘ç»œä¸­ï¼š
â”œâ”€ é‡è¯•æœºåˆ¶ï¼ˆTCP fast openï¼‰
â”œâ”€ æ–­çº¿é‡è¿ï¼ˆå¿«é€Ÿæ¢å¤ï¼‰
â”œâ”€ è¯·æ±‚é‡è¯•ï¼ˆè‡ªåŠ¨æ¢å¤ï¼‰
â””â”€ ç”¨æˆ·æ„Ÿå—åˆ°çš„ä¸­æ–­æ›´çŸ­</p>
<pre><code class="hljs language-css" lang="css">
<span class="hljs-selector-tag">b</span>) å¤šç½‘ç»œç»‘å®š
</code></pre>
<p>å…³é”®è¿æ¥ä½¿ç”¨ä¸¤ä¸ªç½‘ç»œï¼š
â”œâ”€ WiFi å’Œ LTE åŒæ—¶ç”¨
â”œâ”€ ä»»ä¸€ç½‘ç»œæ•…éšœè‡ªåŠ¨åˆ‡æ¢
â”œâ”€ æ— ä¸­æ–­ï¼ˆè¶…çº§ç”¨æˆ·ä½“éªŒï¼‰</p>
<pre><code class="hljs language-r" lang="r">
<span class="hljs-built_in">c</span><span class="hljs-punctuation">)</span> ç¼–ç ä¼˜åŒ–
</code></pre>
<p>åœ¨å·®ç½‘ç»œä¸­ï¼š
â”œâ”€ æ›´å¼ºçš„çº é”™ç 
â”œâ”€ æ›´é¢‘ç¹çš„æ ¡éªŒ
â”œâ”€ è‡ªåŠ¨ç ç‡è°ƒæ•´
â””â”€ å‡å°‘é‡ä¼ </p>
<pre><code class="hljs"/></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€Navigation3ã€‘åŸºç¡€å…¥é—¨]]></title>    <link>https://juejin.cn/post/7603359026712133642</link>    <guid>https://juejin.cn/post/7603359026712133642</guid>    <pubDate>2026-02-06T15:12:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603359026712133642" data-draft-id="7603352117640200201" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€Navigation3ã€‘åŸºç¡€å…¥é—¨"/> <meta itemprop="keywords" content="Composer"/> <meta itemprop="datePublished" content="2026-02-06T15:12:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BUGé›†ç»“è€…"/> <meta itemprop="url" content="https://juejin.cn/user/131597123982871"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€Navigation3ã€‘åŸºç¡€å…¥é—¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/131597123982871/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BUGé›†ç»“è€…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T15:12:42.000Z" title="Fri Feb 06 2026 15:12:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç¯å¢ƒé…ç½®</h2>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fguide%2Fnavigation%2Fnavigation-3%2Fget-started%3Fhl%3Dzh-cn" target="_blank" title="https://developer.android.com/guide/navigation/navigation-3/get-started?hl=zh-cn" ref="nofollow noopener noreferrer">å®˜æ–¹æ•™ç¨‹æ–‡æ¡£</a></p>
</blockquote>
<h2 data-id="heading-1">APIä»‹ç»</h2>
<p>Navigation3åŒ…å«é‡è¦é…ç½®å¯¼èˆªå…¥å£<code>NavDisplay</code>ï¼Œåº”ç”¨äºå…¨å±€é…ç½®é¡µé¢å¯¼èˆªã€é¡µé¢å †æ ˆç®¡ç†ã€é¡µé¢åˆ‡æ¢åŠ¨ç”»ç®¡ç†ç­‰ç­‰ï¼Œå…·ä½“å‡½æ•°å£°æ˜ä»£ç å¦‚ä¸‹ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fcs.android.com%2Fandroidx%2Fplatform%2Fframeworks%2Fsupport%2F%2B%2Fandroidx-main%3Anavigation3%2Fnavigation3-ui%2Fsrc%2FcommonMain%2Fkotlin%2Fandroidx%2Fnavigation3%2Fui%2FNavDisplay.kt%3Fhl%3Dzh-cn" target="_blank" title="https://cs.android.com/androidx/platform/frameworks/support/+/androidx-main:navigation3/navigation3-ui/src/commonMain/kotlin/androidx/navigation3/ui/NavDisplay.kt?hl=zh-cn" ref="nofollow noopener noreferrer">é“¾æ¥ï¼šNavDisplayå‡½æ•°æºç ä½ç½®</a>ï¼‰ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : Any&gt;</span> <span class="hljs-title">NavDisplay</span><span class="hljs-params">(
    backStack: <span class="hljs-type">List</span>&lt;<span class="hljs-type">T</span>&gt;,
    modifier: <span class="hljs-type">Modifier</span> = Modifier,
    contentAlignment: <span class="hljs-type">Alignment</span> = Alignment.TopStart,
    onBack: () -&gt; <span class="hljs-type">Unit</span> = {
        <span class="hljs-keyword">if</span> (backStack <span class="hljs-keyword">is</span> MutableList&lt;T&gt;)</span></span> {
            backStack.removeLastOrNull()
        }
    },
    entryDecorators: List&lt;NavEntryDecorator&lt;T&gt;&gt; =
        listOf(rememberSaveableStateHolderNavEntryDecorator()),
    sceneStrategy: SceneStrategy&lt;T&gt; = SinglePaneSceneStrategy(),
    sizeTransform: SizeTransform? = <span class="hljs-literal">null</span>,
    transitionSpec: AnimatedContentTransitionScope&lt;Scene&lt;T&gt;&gt;.() -&gt; ContentTransform =
        defaultTransitionSpec(),
    popTransitionSpec: AnimatedContentTransitionScope&lt;Scene&lt;T&gt;&gt;.() -&gt; ContentTransform =
        defaultPopTransitionSpec(),
    predictivePopTransitionSpec:
        AnimatedContentTransitionScope&lt;Scene&lt;T&gt;&gt;.(
            <span class="hljs-meta">@NavigationEvent</span>.SwipeEdge <span class="hljs-built_in">Int</span>
        ) -&gt; ContentTransform =
        defaultPredictivePopTransitionSpec(),
    entryProvider: (key: T) -&gt; NavEntry&lt;T&gt;,
)
</code></pre>
<ul>
<li>å‡½æ•°åŸºç¡€å‚æ•°è¯´æ˜
<ul>
<li><code>backStack</code> æ˜¯ä¸€ä¸ªListé›†åˆï¼Œç”¨äºç®¡ç†é¡µé¢å †æ ˆã€‚å¯¹é›†åˆè¿›è¡Œå¢åˆ æŸ¥æ”¹ä¹‹åï¼Œ<code>Nav3</code>ä¼šè‡ªåŠ¨çš„åˆ‡æ¢é¡µé¢</li>
<li><code>onBack</code> ç³»ç»Ÿè¿”å›é”®å›è°ƒå‡½æ•°</li>
<li><code>entryProvider</code> ç”¨äºå£°æ˜å †æ ˆä¸­çš„Keyä¸é¡µé¢é—´çš„æ˜ å°„å…³ç³»</li>
</ul>
</li>
</ul>
<h2 data-id="heading-2">æ¡ˆä¾‹</h2>
<blockquote>
<p>è¦ä» RouteA å¯¼èˆªåˆ° RouteBï¼Œæˆ‘ä»¬åªéœ€å°† RouteB çš„å®ä¾‹æ·»åŠ åˆ°è¿”å›æ ˆä¸­ã€‚è¯¥ id ä½œä¸ºå‚æ•°ä¼ é€’ç»™ RouteBdata ç±»ã€‚</p>
</blockquote>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> <span class="hljs-keyword">data</span> <span class="hljs-keyword">object</span> RouteA

<span class="hljs-keyword">private</span> <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RouteB</span>(<span class="hljs-keyword">val</span> id: String)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BasicActivity</span> : <span class="hljs-type">ComponentActivity</span>() {

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        setEdgeToEdgeConfig()
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        setContent {
            <span class="hljs-keyword">val</span> backStack = remember { mutableStateListOf&lt;Any&gt;(RouteA) }

            NavDisplay(
                backStack = backStack,
                onBack = { backStack.removeLastOrNull() },
                entryProvider = { key -&gt;
                    <span class="hljs-keyword">when</span> (key) {
                        <span class="hljs-keyword">is</span> RouteA -&gt; NavEntry(key) {
                            ContentGreen(<span class="hljs-string">"Welcome to Nav3"</span>) {
                                Button(onClick = dropUnlessResumed {
                                    backStack.add(RouteB(<span class="hljs-string">"123"</span>))
                                }) {
                                    Text(<span class="hljs-string">"Click to navigate"</span>)
                                }
                            }
                        }

                        <span class="hljs-keyword">is</span> RouteB -&gt; NavEntry(key) {
                            ContentBlue(<span class="hljs-string">"Route id: <span class="hljs-subst">${key.id}</span> "</span>)
                        }

                        <span class="hljs-keyword">else</span> -&gt; {
                            error(<span class="hljs-string">"Unknown route: <span class="hljs-variable">$key</span>"</span>)
                        }
                    }
                }
            )
        }
    }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[[Navigation3]æŒä¹…åŒ–å †æ ˆ]]></title>    <link>https://juejin.cn/post/7603359026712182794</link>    <guid>https://juejin.cn/post/7603359026712182794</guid>    <pubDate>2026-02-06T15:29:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603359026712182794" data-draft-id="7603575763786711066" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="[Navigation3]æŒä¹…åŒ–å †æ ˆ"/> <meta itemprop="keywords" content="Composer"/> <meta itemprop="datePublished" content="2026-02-06T15:29:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BUGé›†ç»“è€…"/> <meta itemprop="url" content="https://juejin.cn/user/131597123982871"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            [Navigation3]æŒä¹…åŒ–å †æ ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/131597123982871/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BUGé›†ç»“è€…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T15:29:09.000Z" title="Fri Feb 06 2026 15:29:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">èƒŒæ™¯</h2>
<p><code>Nav3</code>å°†å¯¼èˆªå †æ ˆé›†åˆäº¤ç”±å¼€å‘è€…è®¾ç½®ï¼Œåœ¨ä¸€äº›æç«¯æ¡ä»¶ä¸‹ï¼Œæ¯”å¦‚Activityé…ç½®æ›´æ”¹ã€åº”ç”¨è¿›ç¨‹è¢«æ€æ­»ï¼Œå‡å¯èƒ½ä¼šå¯¼è‡´è®¾ç½®å †æ ˆæ•°æ®çš„ä¸¢å¤±ã€‚ä¸ºäº†é˜²æ­¢è¿™ç§æ„å¤–ï¼Œåˆ™éœ€è¦ä¸ºå †æ ˆè¿›è¡ŒæŒä¹…åŒ–é…ç½®</p>
<h2 data-id="heading-1">è§£å†³æ–¹æ¡ˆ</h2>
<ul>
<li>
<h3 data-id="heading-2"><code>rememberNavBackStack</code>å…·ä½“ä½¿ç”¨å¦‚ä¸‹ï¼Œå°±ä¸è¿‡å¤šé˜è¿°ã€‚</h3>
</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Serializable</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">data</span> <span class="hljs-keyword">object</span> RouteA : NavKey

<span class="hljs-meta">@Serializable</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RouteB</span>(<span class="hljs-keyword">val</span> id: String) : NavKey

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BasicSaveableActivity</span> : <span class="hljs-type">ComponentActivity</span>() {

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        setEdgeToEdgeConfig()
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        setContent {
            <span class="hljs-keyword">val</span> backStack = rememberNavBackStack(RouteA)

            NavDisplay(
                backStack = backStack,
                onBack = { backStack.removeLastOrNull() },
                entryProvider = { key -&gt;
                    <span class="hljs-keyword">when</span> (key) {
                        <span class="hljs-keyword">is</span> RouteA -&gt; NavEntry(key) {
                            ContentGreen(<span class="hljs-string">"Welcome to Nav3"</span>) {
                                Button(onClick = dropUnlessResumed {
                                    backStack.add(RouteB(<span class="hljs-string">"123"</span>))
                                }) {
                                    Text(<span class="hljs-string">"Click to navigate"</span>)
                                }
                            }
                        }

                        <span class="hljs-keyword">is</span> RouteB -&gt; NavEntry(key) {
                            ContentBlue(<span class="hljs-string">"Route id: <span class="hljs-subst">${key.id}</span> "</span>)
                        }

                        <span class="hljs-keyword">else</span> -&gt; {
                            error(<span class="hljs-string">"Unknown route: <span class="hljs-variable">$key</span>"</span>)
                        }
                    }
                }
            )
        }
    }
}
</code></pre>
<h2 data-id="heading-3">å‚è€ƒèµ„æ–™å¦‚ä¸‹ï¼š</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcs.android.com%2Fandroidx%2Fplatform%2Fframeworks%2Fsupport%2F%2B%2Fandroidx-main%3Anavigation3%2Fnavigation3-runtime%2Fsrc%2FcommonMain%2Fkotlin%2Fandroidx%2Fnavigation3%2Fruntime%2FRememberNavBackStack.kt%3Fhl%3Dzh-cn" target="_blank" title="https://cs.android.com/androidx/platform/frameworks/support/+/androidx-main:navigation3/navigation3-runtime/src/commonMain/kotlin/androidx/navigation3/runtime/RememberNavBackStack.kt?hl=zh-cn" ref="nofollow noopener noreferrer">å®˜æ–¹æºç </a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fguide%2Fnavigation%2Fnavigation-3%2Fsave-state%3Fhl%3Dzh-cn" target="_blank" title="https://developer.android.com/guide/navigation/navigation-3/save-state?hl=zh-cn" ref="nofollow noopener noreferrer">å®˜æ–¹æ•™ç¨‹</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenClaw é…ç½®é£ä¹¦æ•™ç¨‹ï¼ˆç›´æ¥æ›´æ–°ï¼Œä¸å«å®‰è£…openclaw]]></title>    <link>https://juejin.cn/post/7603352117639725065</link>    <guid>https://juejin.cn/post/7603352117639725065</guid>    <pubDate>2026-02-06T10:58:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603352117639725065" data-draft-id="7603376587652382770" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenClaw é…ç½®é£ä¹¦æ•™ç¨‹ï¼ˆç›´æ¥æ›´æ–°ï¼Œä¸å«å®‰è£…openclaw"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-02-06T10:58:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·557203665058"/> <meta itemprop="url" content="https://juejin.cn/user/2913054520778011"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenClaw é…ç½®é£ä¹¦æ•™ç¨‹ï¼ˆç›´æ¥æ›´æ–°ï¼Œä¸å«å®‰è£…openclaw
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2913054520778011/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·557203665058
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T10:58:05.000Z" title="Fri Feb 06 2026 10:58:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Flinux.do%2Fu%2Fcarlos_star" target="_blank" title="https://linux.do/u/carlos_star" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3065d46c908d48d0844a59e1682b34d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NTU3MjAzNjY1MDU4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770980285&amp;x-signature=0m4qiswl1BSrG6IH9uquuKr4cOs%3D" alt="" loading="lazy"/></a></p>
<blockquote>
<p>æœ¬æ–‡æ¡£ä»æ›´æ–° OpenClaw å¼€å§‹ï¼Œä»‹ç»å¦‚ä½•å°† OpenClaw æ¥å…¥é£ä¹¦æœºå™¨äººã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-0"><a href="https://link.juejin.cn?target=https%3A%2F%2Flinux.do%2Ft%2Ftopic%2F1564722%23p-13467701-openclaw-2" target="_blank" title="https://linux.do/t/topic/1564722#p-13467701-openclaw-2" ref="nofollow noopener noreferrer"/>ä¸€ã€æ›´æ–° OpenClaw</h2>
<pre><code class="hljs language-bash" lang="bash">openclaw update
</code></pre>
<blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/629ee9bf6f384e488d735dadf40919cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NTU3MjAzNjY1MDU4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770980285&amp;x-signature=CBxjDHSHUcsauaYUDc3nMlB%2B0m4%3D" alt=":warning:" loading="lazy"/> å¦‚æœå·²ç»æ¥å…¥è¿‡ç¬¬ä¸‰æ–¹é£ä¹¦æ’ä»¶ï¼Œéœ€è¦å…ˆåˆ é™¤æ—§é…ç½®ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">rm</span> -rf ~/.openclaw/extensions/feishu
</code></pre>
<p>å¦‚æœæ²¡æœ‰æ¥å…¥è¿‡ï¼Œå¿½ç•¥æ­¤æ­¥éª¤ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-1"><a href="https://link.juejin.cn?target=https%3A%2F%2Flinux.do%2Ft%2Ftopic%2F1564722%23p-13467701-h-3" target="_blank" title="https://linux.do/t/topic/1564722#p-13467701-h-3" ref="nofollow noopener noreferrer"/>äºŒã€åˆ›å»ºé£ä¹¦æœºå™¨äºº</h2>
<h3 data-id="heading-2"><a href="https://link.juejin.cn?target=https%3A%2F%2Flinux.do%2Ft%2Ftopic%2F1564722%23p-13467701-h-21-4" target="_blank" title="https://linux.do/t/topic/1564722#p-13467701-h-21-4" ref="nofollow noopener noreferrer"/>2.1 åˆ›å»ºåº”ç”¨</h3>
<ol>
<li>è®¿é—® <a href="https://link.juejin.cn?target=https%3A%2F%2Fopen.feishu.cn%2Fapp" target="_blank" title="https://open.feishu.cn/app" ref="nofollow noopener noreferrer">é£ä¹¦å¼€å‘è€…åå°</a></li>
<li>ç‚¹å‡»ã€Œåˆ›å»ºä¼ä¸šè‡ªå»ºåº”ç”¨ã€</li>
<li>å¡«å†™åº”ç”¨åç§°å’Œæè¿°ï¼ˆéšæ„å¡«å†™å³å¯ï¼‰</li>
</ol>
<h3 data-id="heading-3"><a href="https://link.juejin.cn?target=https%3A%2F%2Flinux.do%2Ft%2Ftopic%2F1564722%23p-13467701-h-22-5" target="_blank" title="https://linux.do/t/topic/1564722#p-13467701-h-22-5" ref="nofollow noopener noreferrer"/>2.2 æ·»åŠ æœºå™¨äººèƒ½åŠ›</h3>
<ol>
<li>è¿›å…¥åº”ç”¨ï¼Œé€‰æ‹©ã€Œæ·»åŠ åº”ç”¨èƒ½åŠ›ã€</li>
<li>åœ¨å³ä¾§ã€ŒæŒ‰èƒ½åŠ›æ·»åŠ ã€èœå•ä¸­æ‰¾åˆ°ã€Œæœºå™¨äººã€</li>
<li>ç‚¹å‡»æ·»åŠ </li>
</ol>
<h3 data-id="heading-4"><a href="https://link.juejin.cn?target=https%3A%2F%2Flinux.do%2Ft%2Ftopic%2F1564722%23p-13467701-h-23-6" target="_blank" title="https://linux.do/t/topic/1564722#p-13467701-h-23-6" ref="nofollow noopener noreferrer"/>2.3 å¼€é€šæƒé™</h3>
<p>è¿›å…¥ã€Œæƒé™ç®¡ç†ã€ï¼Œå¼€é€šä»¥ä¸‹æƒé™ï¼š<br/>
åœ¨â€œæƒé™â€é¡µé¢ï¼Œç‚¹å‡»â€œæ‰¹é‡å¯¼å…¥â€å¹¶ç²˜è´´ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">{
  <span class="hljs-string">"scopes"</span>: {
    <span class="hljs-string">"tenant"</span>: [
      <span class="hljs-string">"aily:file:read"</span>,
      <span class="hljs-string">"aily:file:write"</span>,
      <span class="hljs-string">"application:application.app_message_stats.overview:readonly"</span>,
      <span class="hljs-string">"application:application:self_manage"</span>,
      <span class="hljs-string">"application:bot.menu:write"</span>,
      <span class="hljs-string">"contact:user.employee_id:readonly"</span>,
      <span class="hljs-string">"corehr:file:download"</span>,
      <span class="hljs-string">"event:ip_list"</span>,
      <span class="hljs-string">"im:chat.access_event.bot_p2p_chat:read"</span>,
      <span class="hljs-string">"im:chat.members:bot_access"</span>,
      <span class="hljs-string">"im:message"</span>,
      <span class="hljs-string">"im:message.group_at_msg:readonly"</span>,
      <span class="hljs-string">"im:message.p2p_msg:readonly"</span>,
      <span class="hljs-string">"im:message:readonly"</span>,
      <span class="hljs-string">"im:message:send_as_bot"</span>,
      <span class="hljs-string">"im:resource"</span>
    ],
    <span class="hljs-string">"user"</span>: [<span class="hljs-string">"aily:file:read"</span>, <span class="hljs-string">"aily:file:write"</span>, <span class="hljs-string">"im:chat.access_event.bot_p2p_chat:read"</span>]
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-5"><a href="https://link.juejin.cn?target=https%3A%2F%2Flinux.do%2Ft%2Ftopic%2F1564722%23p-13467701-openclaw-7" target="_blank" title="https://linux.do/t/topic/1564722#p-13467701-openclaw-7" ref="nofollow noopener noreferrer"/>ä¸‰ã€é…ç½® OpenClaw</h2>
<h3 data-id="heading-6"><a href="https://link.juejin.cn?target=https%3A%2F%2Flinux.do%2Ft%2Ftopic%2F1564722%23p-13467701-h-31-8" target="_blank" title="https://linux.do/t/topic/1564722#p-13467701-h-31-8" ref="nofollow noopener noreferrer"/>3.1 æ·»åŠ é£ä¹¦æ¸ é“</h3>
<pre><code class="hljs language-bash" lang="bash">openclaw channels add
</code></pre>
<p>åœ¨åˆ—è¡¨ä¸­é€‰æ‹© <code>feishu</code>ã€‚</p>
<h3 data-id="heading-7"><a href="https://link.juejin.cn?target=https%3A%2F%2Flinux.do%2Ft%2Ftopic%2F1564722%23p-13467701-h-32-9" target="_blank" title="https://linux.do/t/topic/1564722#p-13467701-h-32-9" ref="nofollow noopener noreferrer"/>3.2 å¤„ç†å·²æœ‰é…ç½®</h3>
<p>å¦‚æœå‡ºç° <code>Feishu already configured</code>ï¼Œé€‰æ‹©ã€Œä¿®æ”¹é…ç½®ã€ã€‚</p>
<h3 data-id="heading-8"><a href="https://link.juejin.cn?target=https%3A%2F%2Flinux.do%2Ft%2Ftopic%2F1564722%23p-13467701-h-33-10" target="_blank" title="https://linux.do/t/topic/1564722#p-13467701-h-33-10" ref="nofollow noopener noreferrer"/>3.3 é…ç½®å‚æ•°</h3>
<p>æŒ‰æç¤ºä¾æ¬¡é…ç½®ï¼š</p>

























<table><thead><tr><th>é…ç½®é¡¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Feishu account</td><td>é€‰æ‹© <code>default</code></td></tr><tr><td>domain</td><td>æ ¹æ®åŒºåŸŸé€‰æ‹©ï¼ˆå›½å†…é€‰ <code>feishu</code>ï¼Œå›½é™…é€‰ <code>lark</code>ï¼‰</td></tr><tr><td>App ID</td><td>åœ¨é£ä¹¦å¼€å‘è€…åå°ã€Œå‡­æ®ä¸åŸºç¡€ä¿¡æ¯ã€é¡µé¢è·å–</td></tr><tr><td>App Secret</td><td>åŒä¸Š</td></tr></tbody></table>
<p>å¡«å†™å®Œæˆåé€‰æ‹© <code>finish</code>ã€‚</p>
<h3 data-id="heading-9"><a href="https://link.juejin.cn?target=https%3A%2F%2Flinux.do%2Ft%2Ftopic%2F1564722%23p-13467701-h-34-11" target="_blank" title="https://linux.do/t/topic/1564722#p-13467701-h-34-11" ref="nofollow noopener noreferrer"/>3.4 åç»­é…ç½®é€‰é¡¹</h3>
<pre><code class="hljs language-bash" lang="bash">Configure DM access policies now? â†’ é€‰ No
Add display names <span class="hljs-keyword">for</span> these accounts? â†’ é€‰ No
</code></pre>
<h3 data-id="heading-10"><a href="https://link.juejin.cn?target=https%3A%2F%2Flinux.do%2Ft%2Ftopic%2F1564722%23p-13467701-h-35-gateway-12" target="_blank" title="https://linux.do/t/topic/1564722#p-13467701-h-35-gateway-12" ref="nofollow noopener noreferrer"/>3.5 é‡å¯ Gateway</h3>
<pre><code class="hljs language-bash" lang="bash">openclaw gateway restart
</code></pre>
<hr/>
<h2 data-id="heading-11"><a href="https://link.juejin.cn?target=https%3A%2F%2Flinux.do%2Ft%2Ftopic%2F1564722%23p-13467701-h-13" target="_blank" title="https://linux.do/t/topic/1564722#p-13467701-h-13" ref="nofollow noopener noreferrer"/>å››ã€é…ç½®é£ä¹¦äº‹ä»¶è®¢é˜…</h2>
<p>å›åˆ°é£ä¹¦å¼€å‘è€…åå°ï¼š</p>
<ol>
<li>é€‰æ‹©ã€Œäº‹ä»¶ä¸å›è°ƒã€</li>
<li>æ·»åŠ äº‹ä»¶ï¼š<code>im.message.receive_v1</code></li>
<li>è®¢é˜…æ–¹å¼é€‰æ‹©ã€Œä½¿ç”¨é•¿è¿æ¥æ¥æ”¶äº‹ä»¶ã€</li>
</ol>
<hr/>
<h2 data-id="heading-12"><a href="https://link.juejin.cn?target=https%3A%2F%2Flinux.do%2Ft%2Ftopic%2F1564722%23p-13467701-h-14" target="_blank" title="https://linux.do/t/topic/1564722#p-13467701-h-14" ref="nofollow noopener noreferrer"/>äº”ã€éªŒè¯</h2>
<p>ç°åœ¨å¯ä»¥åœ¨é£ä¹¦ä¸­ä½¿ç”¨ OpenClaw äº†ï¼</p>
<p>æ‰¾åˆ°ä½ åˆ›å»ºçš„æœºå™¨äººåº”ç”¨ï¼Œå‘é€æ¶ˆæ¯æµ‹è¯•æ˜¯å¦æ­£å¸¸å“åº”ã€‚</p>
<hr/>
<h2 data-id="heading-13"><a href="https://link.juejin.cn?target=https%3A%2F%2Flinux.do%2Ft%2Ftopic%2F1564722%23p-13467701-h-15" target="_blank" title="https://linux.do/t/topic/1564722#p-13467701-h-15" ref="nofollow noopener noreferrer"/>å…­ã€å¸¸ç”¨å‘½ä»¤</h2>
<pre><code class="hljs language-bash" lang="bash">openclaw update


openclaw channels add


openclaw gateway restart


openclaw gateway status


openclaw logs --follow
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¼ä¸šå¾®ä¿¡æ¥å£åœ¨ç¾å¤‡æ¶æ„ä¸ä¸šåŠ¡è¿ç»­æ€§ä¿éšœä¸­çš„å®è·µ]]></title>    <link>https://juejin.cn/post/7603575399255146536</link>    <guid>https://juejin.cn/post/7603575399255146536</guid>    <pubDate>2026-02-06T13:08:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603575399255146536" data-draft-id="7603347438013939747" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" ä¼ä¸šå¾®ä¿¡æ¥å£åœ¨ç¾å¤‡æ¶æ„ä¸ä¸šåŠ¡è¿ç»­æ€§ä¿éšœä¸­çš„å®è·µ"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2026-02-06T13:08:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="bot555666"/> <meta itemprop="url" content="https://juejin.cn/user/1092275002677466"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             ä¼ä¸šå¾®ä¿¡æ¥å£åœ¨ç¾å¤‡æ¶æ„ä¸ä¸šåŠ¡è¿ç»­æ€§ä¿éšœä¸­çš„å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1092275002677466/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    bot555666
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T13:08:01.000Z" title="Fri Feb 06 2026 13:08:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¼ä¸šå¾®ä¿¡æ¥å£åœ¨ç¾å¤‡æ¶æ„ä¸ä¸šåŠ¡è¿ç»­æ€§ä¿éšœä¸­çš„å®è·µ</h2>
<p>åœ¨ä¼ä¸šå…³é”®ä¸šåŠ¡ç³»ç»Ÿæ·±åº¦é›†æˆä¼ä¸šå¾®ä¿¡çš„åœºæ™¯ä¸‹ï¼Œå¦‚ä½•ç¡®ä¿å½“ä¼ä¸šå¾®ä¿¡æœåŠ¡æœ¬èº«æˆ–é›†æˆé“¾è·¯å‡ºç°å¼‚å¸¸æ—¶ï¼Œæ ¸å¿ƒä¸šåŠ¡æµç¨‹ä»èƒ½æŒç»­è¿è¡Œï¼Œæˆä¸ºä¼ä¸šæ¶æ„è®¾è®¡çš„é‡è¦è€ƒé‡ã€‚æœ¬æ–‡ç³»ç»Ÿæ€§åœ°æ¢è®¨åŸºäºä¼ä¸šå¾®ä¿¡æ¥å£æ„å»ºçš„é«˜å¯ç”¨ç¾å¤‡æ¶æ„ï¼Œå®ç°ä¸šåŠ¡è¿ç»­æ€§çš„å¤šå±‚çº§ä¿éšœã€‚</p>
<h3 data-id="heading-1">ä¸€ã€ä¼ä¸šå¾®ä¿¡é›†æˆåœºæ™¯çš„ç¾å¤‡æŒ‘æˆ˜åˆ†æ</h3>
<p>ä¼ä¸šå¾®ä¿¡ä½œä¸ºé€šä¿¡æ¢çº½ï¼Œå…¶å¼‚å¸¸çŠ¶æ€ä¼šå¯¹ä¾èµ–å®ƒçš„ä¸šåŠ¡ç³»ç»Ÿäº§ç”Ÿè¿é”å½±å“ï¼Œä¸»è¦é£é™©åŒ…æ‹¬ï¼š</p>
<ol>
<li><strong>æœåŠ¡ç«¯å¯ç”¨æ€§é£é™©</strong>ï¼šä¼ä¸šå¾®ä¿¡å¹³å°æœåŠ¡ä¸´æ—¶ä¸å¯ç”¨æˆ–ç»´æŠ¤ï¼Œå¯¼è‡´APIè°ƒç”¨å¤±è´¥ã€‚</li>
<li><strong>ç½‘ç»œåˆ†åŒºé£é™©</strong>ï¼šä¼ä¸šç½‘ç»œä¸è…¾è®¯äº‘ä¹‹é—´çš„ç½‘ç»œè¿æ¥ä¸­æ–­ã€‚</li>
<li><strong>å‡­è¯å¤±æ•ˆé£é™©</strong>ï¼šAccess Tokené›†ä¸­å¤±æ•ˆä¸”æ— æ³•åŠæ—¶åˆ·æ–°ã€‚</li>
<li><strong>é…é¢è€—å°½é£é™©</strong>ï¼šä¸šåŠ¡é«˜å³°è§¦å‘APIè°ƒç”¨é¢‘ç‡é™åˆ¶ã€‚</li>
<li><strong>æ•°æ®ä¸€è‡´æ€§é£é™©</strong>ï¼šä¸»å¤‡ç¯å¢ƒåˆ‡æ¢å¯¼è‡´æ¶ˆæ¯é‡å¤æˆ–ä¸¢å¤±ã€‚</li>
</ol>
<h3 data-id="heading-2">äºŒã€å¤šå±‚æ¬¡ç¾å¤‡æ¶æ„è®¾è®¡</h3>
<p>è®¾è®¡ä¸€ä¸ªä»å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„å®Œæ•´ç¾å¤‡ä½“ç³»ï¼Œé‡‡ç”¨"åˆ†çº§é™çº§ã€å¹³æ»‘åˆ‡æ¢"çš„åŸåˆ™ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-attr">[ä¸šåŠ¡åº”ç”¨å±‚]</span>
â”œâ”€â”€ ä¸»ç”¨é€šé“ï¼šä¼ä¸šå¾®ä¿¡API (è…¾è®¯äº‘)
â”œâ”€â”€ å¤‡ç”¨é€šé“<span class="hljs-number">1</span>ï¼šä¼ä¸šå¾®ä¿¡ç§æœ‰åŒ–éƒ¨ç½²
â”œâ”€â”€ å¤‡ç”¨é€šé“<span class="hljs-number">2</span>ï¼šæ··åˆé€šä¿¡ç½‘å…³ï¼ˆçŸ­ä¿¡/é‚®ä»¶/é’‰é’‰ç­‰ï¼‰
â””â”€â”€ æœ¬åœ°åº”æ€¥é€šé“ï¼šæ¶ˆæ¯é˜Ÿåˆ—æŒä¹…åŒ–

<span class="hljs-selector-attr">[æµé‡è°ƒåº¦å±‚]</span>
â”œâ”€â”€ å¥åº·æ£€æŸ¥ä¸æ•…éšœæ£€æµ‹
â”œâ”€â”€ æ™ºèƒ½è·¯ç”±å†³ç­–å¼•æ“
â””â”€â”€ æµé‡åˆ‡æ¢æ§åˆ¶å™¨

<span class="hljs-selector-attr">[æ•°æ®åŒæ­¥å±‚]</span>
â”œâ”€â”€ åŒæ´»æ•°æ®åŒæ­¥
â”œâ”€â”€ çŠ¶æ€ä¸€è‡´æ€§ä¿éšœ
â””â”€â”€ åˆ‡æ¢åæ•°æ®ä¿®å¤
</code></pre>
<h3 data-id="heading-3">ä¸‰ã€æ ¸å¿ƒç¾å¤‡æŠ€æœ¯å®ç°</h3>
<h4 data-id="heading-4">1. å¤šé€šé“å®¢æˆ·ç«¯ä¸æ™ºèƒ½è·¯ç”±</h4>
<p>æ„å»ºå…·å¤‡è‡ªåŠ¨æ•…éšœåˆ‡æ¢èƒ½åŠ›çš„å®¢æˆ·ç«¯SDKï¼Œæ”¯æŒå¤šé€šé“ä¼˜å…ˆçº§é…ç½®ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ”¯æŒå¤šé€šé“ä¸è‡ªåŠ¨æ•…éšœåˆ‡æ¢çš„ä¼ä¸šå¾®ä¿¡å®¢æˆ·ç«¯</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DisasterRecoveryWeComClient</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WeComClient</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;MessageChannel&gt; channels;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> HealthChecker healthChecker;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CircuitBreaker circuitBreaker;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> MessageBuffer persistentBuffer;
    
    <span class="hljs-comment">// é€šé“ä¼˜å…ˆçº§é…ç½®</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DisasterRecoveryWeComClient</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">this</span>.channels = Arrays.asList(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">PrimaryWeComChannel</span>(),      <span class="hljs-comment">// ä¸»é€šé“ï¼šä¼ä¸šå¾®ä¿¡å…¬æœ‰äº‘</span>
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">PrivateWeComChannel</span>(),      <span class="hljs-comment">// å¤‡é€šé“1ï¼šä¼ä¸šå¾®ä¿¡ç§æœ‰åŒ–</span>
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">HybridNotificationChannel</span>(), <span class="hljs-comment">// å¤‡é€šé“2ï¼šæ··åˆé€šçŸ¥é€šé“</span>
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">PersistentQueueChannel</span>()     <span class="hljs-comment">// æœ€ç»ˆå¤‡é€‰ï¼šæœ¬åœ°æŒä¹…åŒ–</span>
        );
        
        <span class="hljs-built_in">this</span>.healthChecker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompositeHealthChecker</span>();
        <span class="hljs-built_in">this</span>.circuitBreaker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Resilience4jCircuitBreaker</span>();
        <span class="hljs-built_in">this</span>.persistentBuffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">KafkaMessageBuffer</span>();
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> SendResult <span class="hljs-title function_">sendMessage</span><span class="hljs-params">(WeComMessage message)</span> {
        <span class="hljs-comment">// 1. åŸºç¡€æ ¡éªŒä¸æ¶ˆæ¯å‡†å¤‡</span>
        validateMessage(message);
        <span class="hljs-type">EnrichedMessage</span> <span class="hljs-variable">enriched</span> <span class="hljs-operator">=</span> enrichMessage(message);
        
        <span class="hljs-comment">// 2. æŒä¹…åŒ–åˆ°æœ¬åœ°ç¼“å†²åŒºï¼ˆç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±ï¼‰</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">bufferId</span> <span class="hljs-operator">=</span> persistentBuffer.store(enriched);
        
        <span class="hljs-comment">// 3. å°è¯•é€šè¿‡å¯ç”¨é€šé“å‘é€</span>
        <span class="hljs-keyword">for</span> (MessageChannel channel : getAvailableChannels()) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// ä½¿ç”¨ç†”æ–­å™¨ä¿æŠ¤æ¯ä¸ªé€šé“</span>
                <span class="hljs-type">SendResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> circuitBreaker.executeSupplier(
                    () -&gt; attemptSendThroughChannel(channel, enriched)
                );
                
                <span class="hljs-keyword">if</span> (result.isSuccess()) {
                    <span class="hljs-comment">// å‘é€æˆåŠŸï¼Œæ ‡è®°ç¼“å†²åŒºæ¶ˆæ¯ä¸ºå·²å¤„ç†</span>
                    persistentBuffer.markAsSent(bufferId, channel.getType());
                    <span class="hljs-keyword">return</span> result;
                }
            } <span class="hljs-keyword">catch</span> (Exception e) {
                log.warn(<span class="hljs-string">"é€šé“ {} å‘é€å¤±è´¥: {}"</span>, channel.getType(), e.getMessage());
                <span class="hljs-keyword">continue</span>; <span class="hljs-comment">// å°è¯•ä¸‹ä¸€ä¸ªé€šé“</span>
            }
        }
        
        <span class="hljs-comment">// 4. æ‰€æœ‰é€šé“å‡å¤±è´¥ï¼Œè¿”å›é™çº§ç»“æœ</span>
        <span class="hljs-keyword">return</span> SendResult.degraded(
            <span class="hljs-string">"æ¶ˆæ¯å·²ä¿å­˜åˆ°æœ¬åœ°ç¼“å†²åŒºï¼Œå°†åœ¨æœåŠ¡æ¢å¤åé‡è¯•"</span>,
            bufferId
        );
    }
    
    <span class="hljs-keyword">private</span> List&lt;MessageChannel&gt; <span class="hljs-title function_">getAvailableChannels</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> channels.stream()
            .filter(channel -&gt; {
                <span class="hljs-comment">// æ£€æŸ¥é€šé“å¥åº·çŠ¶æ€</span>
                <span class="hljs-type">boolean</span> <span class="hljs-variable">isHealthy</span> <span class="hljs-operator">=</span> healthChecker.isHealthy(channel);
                
                <span class="hljs-comment">// æ£€æŸ¥é€šé“æƒé‡é…ç½®ï¼ˆå¯åŠ¨æ€è°ƒæ•´ï¼‰</span>
                <span class="hljs-type">int</span> <span class="hljs-variable">weight</span> <span class="hljs-operator">=</span> channelWeightService.getWeight(channel.getType());
                
                <span class="hljs-comment">// æ£€æŸ¥ä¸šåŠ¡ä¼˜å…ˆçº§åŒ¹é…</span>
                <span class="hljs-type">boolean</span> <span class="hljs-variable">matchesPriority</span> <span class="hljs-operator">=</span> currentMessagePriority &lt;= channel.getMaxPriority();
                
                <span class="hljs-keyword">return</span> isHealthy &amp;&amp; weight &gt; <span class="hljs-number">0</span> &amp;&amp; matchesPriority;
            })
            .sorted(Comparator.comparingInt(MessageChannel::getPriority))
            .collect(Collectors.toList());
    }
    
    <span class="hljs-keyword">private</span> SendResult <span class="hljs-title function_">attemptSendThroughChannel</span><span class="hljs-params">(MessageChannel channel, EnrichedMessage message)</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        
        <span class="hljs-comment">// é€šé“ç‰¹å®šçš„é€‚é…è½¬æ¢</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">channelMessage</span> <span class="hljs-operator">=</span> channel.adaptMessage(message);
        
        <span class="hljs-comment">// æ‰§è¡Œå‘é€ï¼ˆæ”¯æŒè¶…æ—¶æ§åˆ¶ï¼‰</span>
        <span class="hljs-type">ChannelResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> channel.send(channelMessage, <span class="hljs-number">5000</span>); <span class="hljs-comment">// 5ç§’è¶…æ—¶</span>
        
        <span class="hljs-comment">// è®°å½•è¯¦ç»†æŒ‡æ ‡</span>
        metrics.recordChannelAttempt(
            channel.getType(),
            response.isSuccess(),
            System.currentTimeMillis() - startTime
        );
        
        <span class="hljs-keyword">return</span> SendResult.fromChannelResponse(response);
    }
    
    <span class="hljs-comment">// åå°ä»»åŠ¡ï¼šå¤„ç†ç¼“å†²åŒºä¸­æœªå‘é€çš„æ¶ˆæ¯</span>
    <span class="hljs-meta">@Scheduled(fixedDelay = 30000)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">retryBufferedMessages</span><span class="hljs-params">()</span> {
        List&lt;BufferedMessage&gt; failedMessages = persistentBuffer.getFailedMessages(<span class="hljs-number">100</span>);
        
        <span class="hljs-keyword">for</span> (BufferedMessage buffered : failedMessages) {
            <span class="hljs-comment">// æ£€æŸ¥åŸå§‹æ¶ˆæ¯æ˜¯å¦ä»éœ€è¦å‘é€ï¼ˆé¿å…è¿‡æ—¶æ¶ˆæ¯ï¼‰</span>
            <span class="hljs-keyword">if</span> (isMessageStillValid(buffered)) {
                <span class="hljs-comment">// é‡æ–°å°è¯•å‘é€</span>
                sendMessage(buffered.getOriginalMessage());
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// æ¶ˆæ¯å·²è¿‡æœŸï¼Œç§»è‡³æ­»ä¿¡é˜Ÿåˆ—</span>
                persistentBuffer.moveToDeadLetter(buffered.getId());
            }
        }
    }
}

<span class="hljs-comment">// æ··åˆé€šçŸ¥é€šé“å®ç°ï¼šå½“ä¼ä¸šå¾®ä¿¡ä¸å¯ç”¨æ—¶ï¼Œè‡ªåŠ¨é™çº§åˆ°å…¶ä»–é€šçŸ¥æ–¹å¼</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HybridNotificationChannel</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MessageChannel</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> EmailService emailService;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> SmsService smmsService;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DingTalkService dingTalkService;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> ChannelResponse <span class="hljs-title function_">send</span><span class="hljs-params">(Object message, <span class="hljs-type">long</span> timeoutMs)</span> {
        <span class="hljs-type">WeComMessage</span> <span class="hljs-variable">wecomMsg</span> <span class="hljs-operator">=</span> (WeComMessage) message;
        
        <span class="hljs-comment">// æ ¹æ®æ¶ˆæ¯ç±»å‹å’Œæ¥æ”¶äººé€‰æ‹©åˆé€‚çš„é™çº§æ¸ é“</span>
        <span class="hljs-keyword">if</span> (wecomMsg.getMsgType() == MsgType.TEXT) {
            <span class="hljs-comment">// æ–‡æœ¬æ¶ˆæ¯ä¼˜å…ˆå°è¯•çŸ­ä¿¡</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">mobile</span> <span class="hljs-operator">=</span> getUserMobile(wecomMsg.getToUser());
            <span class="hljs-keyword">if</span> (mobile != <span class="hljs-literal">null</span>) {
                <span class="hljs-type">SmsResult</span> <span class="hljs-variable">smsResult</span> <span class="hljs-operator">=</span> smsService.sendSms(
                    mobile,
                    formatForSms(wecomMsg.getContent())
                );
                <span class="hljs-keyword">if</span> (smsResult.isSuccess()) {
                    <span class="hljs-keyword">return</span> ChannelResponse.success(
                        <span class="hljs-string">"sent_via_sms"</span>,
                        smsResult.getMessageId()
                    );
                }
            }
            
            <span class="hljs-comment">// çŸ­ä¿¡å¤±è´¥å°è¯•é‚®ä»¶</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">email</span> <span class="hljs-operator">=</span> getUserEmail(wecomMsg.getToUser());
            <span class="hljs-keyword">if</span> (email != <span class="hljs-literal">null</span>) {
                <span class="hljs-type">EmailResult</span> <span class="hljs-variable">emailResult</span> <span class="hljs-operator">=</span> emailService.sendEmail(
                    email,
                    <span class="hljs-string">"ä¼ä¸šå¾®ä¿¡æ¶ˆæ¯ä»£å‘"</span>,
                    formatForEmail(wecomMsg)
                );
                <span class="hljs-keyword">if</span> (emailResult.isSuccess()) {
                    <span class="hljs-keyword">return</span> ChannelResponse.success(
                        <span class="hljs-string">"sent_via_email"</span>,
                        emailResult.getMessageId()
                    );
                }
            }
        }
        
        <span class="hljs-comment">// å¦‚æœçŸ­ä¿¡å’Œé‚®ä»¶éƒ½ä¸å¯ç”¨ï¼Œå°è¯•å…¶ä»–åä½œå·¥å…·</span>
        <span class="hljs-keyword">if</span> (dingTalkService.isAvailable()) {
            <span class="hljs-type">DingTalkResult</span> <span class="hljs-variable">dtResult</span> <span class="hljs-operator">=</span> dingTalkService.sendMessage(
                convertToDingTalkMessage(wecomMsg)
            );
            <span class="hljs-keyword">if</span> (dtResult.isSuccess()) {
                <span class="hljs-keyword">return</span> ChannelResponse.success(
                    <span class="hljs-string">"sent_via_dingtalk"</span>,
                    dtResult.getMessageId()
                );
            }
        }
        
        <span class="hljs-keyword">return</span> ChannelResponse.failed(<span class="hljs-string">"æ‰€æœ‰å¤‡ç”¨æ¸ é“å‡ä¸å¯ç”¨"</span>);
    }
}
</code></pre>
<h4 data-id="heading-5">2. åŒæ´»æ•°æ®ä¸­å¿ƒçš„æ•°æ®åŒæ­¥</h4>
<p>åœ¨ä¼ä¸šå¾®ä¿¡ç§æœ‰åŒ–éƒ¨ç½²åœºæ™¯ä¸‹ï¼Œå®ç°è·¨æ•°æ®ä¸­å¿ƒçš„åŒæ´»æ¶æ„ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ä¼ä¸šå¾®ä¿¡åŒæ´»æ•°æ®åŒæ­¥æœåŠ¡</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DualActiveDataSyncService</span>:
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, primary_client, standby_client, sync_state_store</span>):
        self.primary = primary_client  <span class="hljs-comment"># ä¸»æ•°æ®ä¸­å¿ƒä¼ä¸šå¾®ä¿¡</span>
        self.standby = standby_client  <span class="hljs-comment"># å¤‡æ•°æ®ä¸­å¿ƒä¼ä¸šå¾®ä¿¡</span>
        self.state_store = sync_state_store
        self.sync_queue = RedisPriorityQueue(<span class="hljs-string">"wecom_sync_queue"</span>)
        
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">setup_bidirectional_sync</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""å»ºç«‹åŒå‘æ•°æ®åŒæ­¥"""</span>
        <span class="hljs-comment"># 1. åˆå§‹å…¨é‡åŒæ­¥</span>
        <span class="hljs-keyword">await</span> self.perform_initial_sync()
        
        <span class="hljs-comment"># 2. å¯åŠ¨å¢é‡åŒæ­¥ç›‘å¬å™¨</span>
        asyncio.create_task(self.listen_primary_changes())
        asyncio.create_task(self.listen_standby_changes())
        
        <span class="hljs-comment"># 3. å¯åŠ¨å†²çªæ£€æµ‹ä¸è§£å†³</span>
        asyncio.create_task(self.resolve_sync_conflicts())
        
        logger.info(<span class="hljs-string">"åŒæ´»æ•°æ®åŒæ­¥å·²å¯åŠ¨"</span>)
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">perform_initial_sync</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""æ‰§è¡Œåˆå§‹å…¨é‡åŒæ­¥"""</span>
        <span class="hljs-comment"># åŒæ­¥ç»„ç»‡æ¶æ„</span>
        depts_primary = <span class="hljs-keyword">await</span> self.primary.get_department_list()
        depts_standby = <span class="hljs-keyword">await</span> self.standby.get_department_list()
        
        <span class="hljs-comment"># æ¯”è¾ƒå·®å¼‚ï¼Œç”ŸæˆåŒæ­¥ä»»åŠ¡</span>
        dept_diff = self.compare_departments(depts_primary, depts_standby)
        <span class="hljs-keyword">for</span> dept_sync_task <span class="hljs-keyword">in</span> dept_diff:
            <span class="hljs-keyword">await</span> self.sync_queue.put(dept_sync_task, priority=<span class="hljs-number">1</span>)
        
        <span class="hljs-comment"># åŒæ­¥ç”¨æˆ·ä¿¡æ¯</span>
        users_primary = <span class="hljs-keyword">await</span> self.primary.get_user_list()
        users_standby = <span class="hljs-keyword">await</span> self.standby.get_user_list()
        
        user_diff = self.compare_users(users_primary, users_standby)
        <span class="hljs-keyword">for</span> user_sync_task <span class="hljs-keyword">in</span> user_diff:
            <span class="hljs-keyword">await</span> self.sync_queue.put(user_sync_task, priority=<span class="hljs-number">2</span>)
        
        <span class="hljs-comment"># åŒæ­¥å¤–éƒ¨è”ç³»äºº</span>
        external_primary = <span class="hljs-keyword">await</span> self.primary.get_external_contact_list()
        external_standby = <span class="hljs-keyword">await</span> self.standby.get_external_contact_list()
        
        external_diff = self.compare_external_contacts(external_primary, external_standby)
        <span class="hljs-keyword">for</span> external_sync_task <span class="hljs-keyword">in</span> external_diff:
            <span class="hljs-keyword">await</span> self.sync_queue.put(external_sync_task, priority=<span class="hljs-number">3</span>)
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">listen_primary_changes</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""ç›‘å¬ä¸»æ•°æ®ä¸­å¿ƒå˜æ›´"""</span>
        <span class="hljs-comment"># ä½¿ç”¨ä¼ä¸šå¾®ä¿¡çš„å›è°ƒæœºåˆ¶ç›‘å¬å˜æ›´</span>
        <span class="hljs-comment"># æˆ–è€…å®šæœŸè½®è¯¢æ£€æŸ¥å¢é‡å˜æ›´</span>
        
        last_seq = <span class="hljs-keyword">await</span> self.state_store.get_last_sync_seq(<span class="hljs-string">"primary"</span>)
        
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            <span class="hljs-keyword">try</span>:
                changes = <span class="hljs-keyword">await</span> self.primary.get_incremental_changes(seq=last_seq)
                
                <span class="hljs-keyword">if</span> changes:
                    <span class="hljs-keyword">for</span> change <span class="hljs-keyword">in</span> changes:
                        <span class="hljs-comment"># æ ‡è®°å˜æ›´æ¥æºï¼Œç”¨äºå†²çªæ£€æµ‹</span>
                        change[<span class="hljs-string">'_source'</span>] = <span class="hljs-string">'primary'</span>
                        change[<span class="hljs-string">'_timestamp'</span>] = time.time()
                        
                        <span class="hljs-comment"># æ ¹æ®å˜æ›´ç±»å‹å¤„ç†</span>
                        <span class="hljs-keyword">if</span> change[<span class="hljs-string">'type'</span>] == <span class="hljs-string">'user_change'</span>:
                            <span class="hljs-keyword">await</span> self.handle_user_change(change, <span class="hljs-string">'primary_to_standby'</span>)
                        <span class="hljs-keyword">elif</span> change[<span class="hljs-string">'type'</span>] == <span class="hljs-string">'department_change'</span>:
                            <span class="hljs-keyword">await</span> self.handle_department_change(change, <span class="hljs-string">'primary_to_standby'</span>)
                        <span class="hljs-keyword">elif</span> change[<span class="hljs-string">'type'</span>] == <span class="hljs-string">'external_contact_change'</span>:
                            <span class="hljs-keyword">await</span> self.handle_external_contact_change(change, <span class="hljs-string">'primary_to_standby'</span>)
                        
                        <span class="hljs-comment"># æ›´æ–°åºåˆ—å·</span>
                        last_seq = change[<span class="hljs-string">'seq'</span>]
                        <span class="hljs-keyword">await</span> self.state_store.update_sync_seq(<span class="hljs-string">"primary"</span>, last_seq)
                
                <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)  <span class="hljs-comment"># çŸ­é—´éš”è½®è¯¢</span>
                
            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                logger.error(<span class="hljs-string">f"ç›‘å¬ä¸»æ•°æ®ä¸­å¿ƒå˜æ›´å¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
                <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">5</span>)  <span class="hljs-comment"># é”™è¯¯åç­‰å¾…ç¨é•¿æ—¶é—´</span>
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_user_change</span>(<span class="hljs-params">self, change, direction</span>):
        <span class="hljs-string">"""å¤„ç†ç”¨æˆ·å˜æ›´åŒæ­¥"""</span>
        user_id = change[<span class="hljs-string">'userid'</span>]
        change_type = change[<span class="hljs-string">'changetype'</span>]  <span class="hljs-comment"># create, update, delete</span>
        
        <span class="hljs-comment"># æ£€æŸ¥å†²çª</span>
        conflict = <span class="hljs-keyword">await</span> self.check_conflict(user_id, change)
        <span class="hljs-keyword">if</span> conflict:
            <span class="hljs-keyword">await</span> self.sync_queue.put({
                <span class="hljs-string">'type'</span>: <span class="hljs-string">'conflict'</span>,
                <span class="hljs-string">'data'</span>: conflict,
                <span class="hljs-string">'priority'</span>: <span class="hljs-number">0</span>  <span class="hljs-comment"># æœ€é«˜ä¼˜å…ˆçº§</span>
            })
            <span class="hljs-keyword">return</span>
        
        <span class="hljs-comment"># æ‰§è¡ŒåŒæ­¥</span>
        <span class="hljs-keyword">if</span> direction == <span class="hljs-string">'primary_to_standby'</span>:
            <span class="hljs-keyword">if</span> change_type == <span class="hljs-string">'delete'</span>:
                <span class="hljs-keyword">await</span> self.standby.delete_user(user_id)
            <span class="hljs-keyword">else</span>:
                user_detail = <span class="hljs-keyword">await</span> self.primary.get_user_detail(user_id)
                <span class="hljs-keyword">await</span> self.standby.sync_user(user_detail)
        
        <span class="hljs-comment"># è®°å½•åŒæ­¥çŠ¶æ€</span>
        <span class="hljs-keyword">await</span> self.state_store.record_sync_operation(
            resource_type=<span class="hljs-string">'user'</span>,
            resource_id=user_id,
            direction=direction,
            change_type=change_type,
            timestamp=change[<span class="hljs-string">'_timestamp'</span>]
        )
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">resolve_sync_conflicts</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""è§£å†³æ•°æ®åŒæ­¥å†²çª"""</span>
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            <span class="hljs-keyword">try</span>:
                conflict_task = <span class="hljs-keyword">await</span> self.sync_queue.get_conflict_task()
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> conflict_task:
                    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)
                    <span class="hljs-keyword">continue</span>
                
                conflict = conflict_task[<span class="hljs-string">'data'</span>]
                
                <span class="hljs-comment"># åº”ç”¨å†²çªè§£å†³ç­–ç•¥</span>
                resolution = self.resolve_conflict_by_policy(conflict)
                
                <span class="hljs-comment"># æ‰§è¡Œè§£å†³æ–¹æ¡ˆ</span>
                <span class="hljs-keyword">if</span> resolution[<span class="hljs-string">'action'</span>] == <span class="hljs-string">'use_primary'</span>:
                    <span class="hljs-keyword">await</span> self.apply_change_to_standby(conflict[<span class="hljs-string">'primary_change'</span>])
                <span class="hljs-keyword">elif</span> resolution[<span class="hljs-string">'action'</span>] == <span class="hljs-string">'use_standby'</span>:
                    <span class="hljs-keyword">await</span> self.apply_change_to_primary(conflict[<span class="hljs-string">'standby_change'</span>])
                <span class="hljs-keyword">elif</span> resolution[<span class="hljs-string">'action'</span>] == <span class="hljs-string">'merge'</span>:
                    merged = self.merge_changes(
                        conflict[<span class="hljs-string">'primary_change'</span>],
                        conflict[<span class="hljs-string">'standby_change'</span>]
                    )
                    <span class="hljs-keyword">await</span> self.apply_merged_change(merged)
                
                <span class="hljs-comment"># è®°å½•å†²çªè§£å†³</span>
                <span class="hljs-keyword">await</span> self.state_store.record_conflict_resolution(
                    conflict_id=conflict[<span class="hljs-string">'id'</span>],
                    resolution=resolution[<span class="hljs-string">'action'</span>],
                    resolved_by=<span class="hljs-string">'auto_system'</span>
                )
                
            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                logger.error(<span class="hljs-string">f"è§£å†³åŒæ­¥å†²çªå¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
                <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">5</span>)
</code></pre>
<h4 data-id="heading-6">3. åŸºäºæµé‡åˆ‡ç‰‡çš„ç°åº¦åˆ‡æ¢æœºåˆ¶</h4>
<p>å½“éœ€è¦ä»ä¸»æ•°æ®ä¸­å¿ƒåˆ‡æ¢åˆ°å¤‡ç”¨æ•°æ®ä¸­å¿ƒæ—¶ï¼Œé‡‡ç”¨é€æ­¥æµé‡åˆ‡æ¢ç­–ç•¥ã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># æµé‡åˆ‡æ¢é…ç½®å®šä¹‰</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">disaster-recovery/v1alpha1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">TrafficSwitchPlan</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">wecom-primary-to-standby</span>
  <span class="hljs-attr">namespace:</span> <span class="hljs-string">wecom-integration</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">strategy:</span> <span class="hljs-string">gradual-traffic-shift</span>  <span class="hljs-comment"># ç­–ç•¥ï¼šé€æ­¥æµé‡åˆ‡æ¢</span>
  <span class="hljs-attr">steps:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">é˜¶æ®µä¸€ï¼šåªè¯»æµ‹è¯•</span>
      <span class="hljs-attr">duration:</span> <span class="hljs-string">30m</span>
      <span class="hljs-attr">actions:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">redirect</span>
          <span class="hljs-attr">trafficPercentage:</span> <span class="hljs-number">0</span>
          <span class="hljs-attr">apis:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">/cgi-bin/user/get</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">/cgi-bin/department/list</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">/cgi-bin/tag/get</span>
          <span class="hljs-attr">target:</span> <span class="hljs-string">standby-cluster</span>
      <span class="hljs-attr">validations:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">api-success-rate</span>
          <span class="hljs-attr">threshold:</span> <span class="hljs-number">99.5</span><span class="hljs-string">%</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">latency-p95</span>
          <span class="hljs-attr">threshold:</span> <span class="hljs-string">200ms</span>
    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">é˜¶æ®µäºŒï¼šä½é£é™©å†™å…¥</span>
      <span class="hljs-attr">duration:</span> <span class="hljs-string">1h</span>
      <span class="hljs-attr">actions:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">redirect</span>
          <span class="hljs-attr">trafficPercentage:</span> <span class="hljs-number">10</span>
          <span class="hljs-attr">apis:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">/cgi-bin/message/send</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">/cgi-bin/appchat/send</span>
          <span class="hljs-attr">target:</span> <span class="hljs-string">standby-cluster</span>
      <span class="hljs-attr">validations:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">message-delivery-rate</span>
          <span class="hljs-attr">threshold:</span> <span class="hljs-number">99</span><span class="hljs-string">%</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">duplicate-rate</span>
          <span class="hljs-attr">threshold:</span> <span class="hljs-number">0.1</span><span class="hljs-string">%</span>
    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">é˜¶æ®µä¸‰ï¼šæ ¸å¿ƒä¸šåŠ¡åˆ‡æ¢</span>
      <span class="hljs-attr">duration:</span> <span class="hljs-string">2h</span>
      <span class="hljs-attr">actions:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">redirect</span>
          <span class="hljs-attr">trafficPercentage:</span> <span class="hljs-number">50</span>
          <span class="hljs-attr">apis:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">/cgi-bin/externalcontact/*</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">/cgi-bin/oa/*</span>
          <span class="hljs-attr">target:</span> <span class="hljs-string">standby-cluster</span>
      <span class="hljs-attr">validations:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">business-transaction-success</span>
          <span class="hljs-attr">threshold:</span> <span class="hljs-number">99.8</span><span class="hljs-string">%</span>
    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">é˜¶æ®µå››ï¼šå®Œå…¨åˆ‡æ¢</span>
      <span class="hljs-attr">duration:</span> <span class="hljs-string">30m</span>
      <span class="hljs-attr">actions:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">redirect</span>
          <span class="hljs-attr">trafficPercentage:</span> <span class="hljs-number">100</span>
          <span class="hljs-attr">apis:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">"/*"</span>  <span class="hljs-comment"># æ‰€æœ‰API</span>
          <span class="hljs-attr">target:</span> <span class="hljs-string">standby-cluster</span>
    
  <span class="hljs-attr">rollbackConditions:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">condition:</span> <span class="hljs-string">api-error-rate</span>
      <span class="hljs-attr">operator:</span> <span class="hljs-string">"&gt;="</span>
      <span class="hljs-attr">value:</span> <span class="hljs-number">5</span>
      <span class="hljs-attr">duration:</span> <span class="hljs-string">5m</span>
    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">condition:</span> <span class="hljs-string">critical-business-failure</span>
      <span class="hljs-attr">operator:</span> <span class="hljs-string">"=="</span>
      <span class="hljs-attr">value:</span> <span class="hljs-literal">true</span>
    
  <span class="hljs-attr">notificationRules:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">events:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">switch.started</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">switch.completed</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">switch.rolledback</span>
      <span class="hljs-attr">channels:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">wecom_alert_group</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">sms_admin</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">email_management</span>
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æµé‡åˆ‡æ¢æ§åˆ¶å™¨å®ç°</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TrafficSwitchController</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> TrafficRouter trafficRouter;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> HealthMonitor healthMonitor;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConfigManager configManager;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AuditLogger auditLogger;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeSwitchPlan</span><span class="hljs-params">(String planId)</span> {
        <span class="hljs-type">TrafficSwitchPlan</span> <span class="hljs-variable">plan</span> <span class="hljs-operator">=</span> configManager.getSwitchPlan(planId);
        <span class="hljs-type">ExecutionContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExecutionContext</span>(plan);
        
        logger.info(<span class="hljs-string">"å¼€å§‹æ‰§è¡Œæµé‡åˆ‡æ¢è®¡åˆ’: {}"</span>, plan.getMetadata().getName());
        
        <span class="hljs-comment">// è®°å½•å¼€å§‹å®¡è®¡</span>
        auditLogger.logSwitchStart(planId, context);
        
        <span class="hljs-comment">// æ‰§è¡Œæ¯ä¸ªé˜¶æ®µ</span>
        <span class="hljs-keyword">for</span> (SwitchStep step : plan.getSpec().getSteps()) {
            <span class="hljs-type">boolean</span> <span class="hljs-variable">stepSuccess</span> <span class="hljs-operator">=</span> executeStep(step, context);
            
            <span class="hljs-keyword">if</span> (!stepSuccess) {
                logger.error(<span class="hljs-string">"é˜¶æ®µæ‰§è¡Œå¤±è´¥: {}"</span>, step.getName());
                
                <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦éœ€è¦å›æ»š</span>
                <span class="hljs-keyword">if</span> (shouldRollback(plan, context)) {
                    performRollback(plan, context);
                    <span class="hljs-keyword">return</span>;
                }
            }
            
            <span class="hljs-comment">// é˜¶æ®µé—´ç­‰å¾…</span>
            waitForStepInterval(step);
        }
        
        logger.info(<span class="hljs-string">"æµé‡åˆ‡æ¢è®¡åˆ’æ‰§è¡Œå®Œæˆ"</span>);
        auditLogger.logSwitchCompletion(planId, context);
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">executeStep</span><span class="hljs-params">(SwitchStep step, ExecutionContext context)</span> {
        logger.info(<span class="hljs-string">"æ‰§è¡Œé˜¶æ®µ: {}"</span>, step.getName());
        
        <span class="hljs-comment">// 1. åº”ç”¨æµé‡è·¯ç”±è§„åˆ™</span>
        applyTrafficRouting(step.getActions());
        
        <span class="hljs-comment">// 2. ç­‰å¾…ç¨³å®š</span>
        waitForStabilization(step.getDuration());
        
        <span class="hljs-comment">// 3. æ‰§è¡ŒéªŒè¯</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">validationPassed</span> <span class="hljs-operator">=</span> performValidations(step.getValidations());
        
        <span class="hljs-keyword">if</span> (validationPassed) {
            logger.info(<span class="hljs-string">"é˜¶æ®µéªŒè¯é€šè¿‡: {}"</span>, step.getName());
            context.recordStepSuccess(step.getName());
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        } <span class="hljs-keyword">else</span> {
            logger.warn(<span class="hljs-string">"é˜¶æ®µéªŒè¯å¤±è´¥: {}"</span>, step.getName());
            context.recordStepFailure(step.getName());
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">applyTrafficRouting</span><span class="hljs-params">(List&lt;TrafficAction&gt; actions)</span> {
        <span class="hljs-keyword">for</span> (TrafficAction action : actions) {
            <span class="hljs-keyword">switch</span> (action.getType()) {
                <span class="hljs-keyword">case</span> <span class="hljs-string">"redirect"</span>:
                    <span class="hljs-comment">// æ›´æ–°æµé‡è·¯ç”±é…ç½®</span>
                    trafficRouter.updateRouting(
                        action.getApis(),
                        action.getTarget(),
                        action.getTrafficPercentage()
                    );
                    <span class="hljs-keyword">break</span>;
                    
                <span class="hljs-keyword">case</span> <span class="hljs-string">"drain"</span>:
                    <span class="hljs-comment">// æ’ç©ºæŒ‡å®šAPIçš„æµé‡</span>
                    trafficRouter.drainTraffic(action.getApis());
                    <span class="hljs-keyword">break</span>;
                    
                <span class="hljs-keyword">case</span> <span class="hljs-string">"block"</span>:
                    <span class="hljs-comment">// é˜»æ–­æŒ‡å®šAPI</span>
                    trafficRouter.blockApis(action.getApis());
                    <span class="hljs-keyword">break</span>;
            }
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">performValidations</span><span class="hljs-params">(List&lt;ValidationRule&gt; validations)</span> {
        <span class="hljs-keyword">for</span> (ValidationRule rule : validations) {
            <span class="hljs-type">boolean</span> <span class="hljs-variable">passed</span> <span class="hljs-operator">=</span> validateRule(rule);
            <span class="hljs-keyword">if</span> (!passed) {
                logger.warn(<span class="hljs-string">"éªŒè¯è§„åˆ™æœªé€šè¿‡: {} {}"</span>, rule.getType(), rule.getThreshold());
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">validateRule</span><span class="hljs-params">(ValidationRule rule)</span> {
        <span class="hljs-keyword">switch</span> (rule.getType()) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">"api-success-rate"</span>:
                <span class="hljs-type">double</span> <span class="hljs-variable">successRate</span> <span class="hljs-operator">=</span> healthMonitor.getApiSuccessRate(
                    rule.getDuration(),
                    rule.getApis()
                );
                <span class="hljs-keyword">return</span> successRate &gt;= rule.getThreshold();
                
            <span class="hljs-keyword">case</span> <span class="hljs-string">"latency-p95"</span>:
                <span class="hljs-type">double</span> <span class="hljs-variable">latency</span> <span class="hljs-operator">=</span> healthMonitor.getLatencyP95(
                    rule.getDuration(),
                    rule.getApis()
                );
                <span class="hljs-keyword">return</span> latency &lt;= rule.getThreshold();
                
            <span class="hljs-keyword">case</span> <span class="hljs-string">"duplicate-rate"</span>:
                <span class="hljs-type">double</span> <span class="hljs-variable">duplicateRate</span> <span class="hljs-operator">=</span> messageMonitor.getDuplicateRate(
                    rule.getDuration()
                );
                <span class="hljs-keyword">return</span> duplicateRate &lt;= rule.getThreshold();
                
            <span class="hljs-keyword">default</span>:
                logger.warn(<span class="hljs-string">"æœªçŸ¥éªŒè¯è§„åˆ™ç±»å‹: {}"</span>, rule.getType());
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">performRollback</span><span class="hljs-params">(TrafficSwitchPlan plan, ExecutionContext context)</span> {
        logger.warn(<span class="hljs-string">"å¼€å§‹å›æ»šæµé‡åˆ‡æ¢"</span>);
        
        <span class="hljs-comment">// æ¢å¤åˆ°åˆå§‹çŠ¶æ€</span>
        trafficRouter.restoreDefaultRouting();
        
        <span class="hljs-comment">// é€šçŸ¥ç›¸å…³äººå‘˜</span>
        notificationService.sendRollbackAlert(
            plan.getMetadata().getName(),
            context.getFailureReason()
        );
        
        auditLogger.logSwitchRollback(plan.getMetadata().getName(), context);
    }
}
</code></pre>
<h4 data-id="heading-7">4. ç¾å¤‡æ¼”ç»ƒä¸è‡ªåŠ¨åŒ–éªŒè¯</h4>
<p>å®šæœŸæ‰§è¡Œè‡ªåŠ¨åŒ–ç¾å¤‡æ¼”ç»ƒï¼Œç¡®ä¿ç³»ç»Ÿå®é™…å¯ç”¨æ€§ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># è‡ªåŠ¨åŒ–ç¾å¤‡æ¼”ç»ƒå¼•æ“</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DisasterRecoveryDrillEngine</span>:
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, scenario_registry, assertion_engine</span>):
        self.scenarios = scenario_registry
        self.assertion_engine = assertion_engine
        self.report_generator = DrillReportGenerator()
        
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">execute_drill</span>(<span class="hljs-params">self, scenario_id, drill_level=<span class="hljs-string">"full"</span></span>):
        <span class="hljs-string">"""æ‰§è¡Œç¾å¤‡æ¼”ç»ƒ"""</span>
        scenario = self.scenarios.get_scenario(scenario_id)
        
        logger.info(<span class="hljs-string">f"å¼€å§‹ç¾å¤‡æ¼”ç»ƒ: <span class="hljs-subst">{scenario.name}</span> (çº§åˆ«: <span class="hljs-subst">{drill_level}</span>)"</span>)
        
        <span class="hljs-comment"># 1. é¢„æ£€æŸ¥</span>
        precheck_result = <span class="hljs-keyword">await</span> self.run_prechecks(scenario.prechecks)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> precheck_result.success:
            <span class="hljs-keyword">return</span> DrillResult.failed(<span class="hljs-string">"é¢„æ£€æŸ¥å¤±è´¥"</span>, precheck_result.details)
        
        <span class="hljs-comment"># 2. æ‰§è¡Œæ•…éšœæ³¨å…¥</span>
        fault_results = []
        <span class="hljs-keyword">for</span> fault <span class="hljs-keyword">in</span> scenario.faults:
            <span class="hljs-keyword">if</span> fault.level &lt;= drill_level:
                result = <span class="hljs-keyword">await</span> self.inject_fault(fault)
                fault_results.append(result)
                
                <span class="hljs-comment"># ç­‰å¾…æ•…éšœç”Ÿæ•ˆ</span>
                <span class="hljs-keyword">await</span> asyncio.sleep(fault.ramp_up_time)
        
        <span class="hljs-comment"># 3. éªŒè¯ç³»ç»Ÿè¡Œä¸º</span>
        verification_results = []
        <span class="hljs-keyword">for</span> verification <span class="hljs-keyword">in</span> scenario.verifications:
            result = <span class="hljs-keyword">await</span> self.assertion_engine.verify(
                verification.condition,
                verification.expected_state,
                verification.timeout
            )
            verification_results.append(result)
            
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> result.success <span class="hljs-keyword">and</span> verification.is_critical:
                <span class="hljs-comment"># å…³é”®éªŒè¯å¤±è´¥ï¼Œç«‹å³ç»ˆæ­¢æ¼”ç»ƒ</span>
                <span class="hljs-keyword">await</span> self.recover_from_faults(scenario.faults)
                <span class="hljs-keyword">return</span> DrillResult.failed(<span class="hljs-string">"å…³é”®éªŒè¯å¤±è´¥"</span>, result.details)
        
        <span class="hljs-comment"># 4. æ¢å¤ä¸æ¸…ç†</span>
        recovery_results = <span class="hljs-keyword">await</span> self.recover_from_faults(scenario.faults)
        
        <span class="hljs-comment"># 5. ç”Ÿæˆæ¼”ç»ƒæŠ¥å‘Š</span>
        report = self.report_generator.generate(
            scenario=scenario,
            prechecks=precheck_result,
            faults=fault_results,
            verifications=verification_results,
            recovery=recovery_results
        )
        
        <span class="hljs-comment"># 6. è¯†åˆ«æ”¹è¿›é¡¹</span>
        improvements = self.identify_improvements(report)
        
        logger.info(<span class="hljs-string">f"ç¾å¤‡æ¼”ç»ƒå®Œæˆ: <span class="hljs-subst">{scenario.name}</span>"</span>)
        
        <span class="hljs-keyword">return</span> DrillResult.success(report, improvements)
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">inject_fault</span>(<span class="hljs-params">self, fault_spec</span>):
        <span class="hljs-string">"""æ³¨å…¥æŒ‡å®šç±»å‹çš„æ•…éšœ"""</span>
        fault_type = fault_spec.<span class="hljs-built_in">type</span>
        
        <span class="hljs-keyword">if</span> fault_type == <span class="hljs-string">"network_partition"</span>:
            <span class="hljs-comment"># æ¨¡æ‹Ÿç½‘ç»œåˆ†åŒº</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> self.network_partition_fault(fault_spec)
            
        <span class="hljs-keyword">elif</span> fault_type == <span class="hljs-string">"service_outage"</span>:
            <span class="hljs-comment"># æ¨¡æ‹ŸæœåŠ¡ä¸å¯ç”¨</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> self.service_outage_fault(fault_spec)
            
        <span class="hljs-keyword">elif</span> fault_type == <span class="hljs-string">"high_latency"</span>:
            <span class="hljs-comment"># æ¨¡æ‹Ÿé«˜å»¶è¿Ÿ</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> self.high_latency_fault(fault_spec)
            
        <span class="hljs-keyword">elif</span> fault_type == <span class="hljs-string">"rate_limit_triggered"</span>:
            <span class="hljs-comment"># æ¨¡æ‹Ÿè§¦å‘é¢‘ç‡é™åˆ¶</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> self.rate_limit_fault(fault_spec)
            
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f"æœªçŸ¥æ•…éšœç±»å‹: <span class="hljs-subst">{fault_type}</span>"</span>)
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">network_partition_fault</span>(<span class="hljs-params">self, fault_spec</span>):
        <span class="hljs-string">"""ç½‘ç»œåˆ†åŒºæ•…éšœæ³¨å…¥"""</span>
        target_service = fault_spec.target
        
        <span class="hljs-comment"># è®°å½•å½“å‰ç½‘ç»œé…ç½®</span>
        original_config = <span class="hljs-keyword">await</span> self.record_network_config(target_service)
        
        <span class="hljs-comment"># æ³¨å…¥æ•…éšœï¼šé˜»æ–­ç‰¹å®šç½‘ç»œæµé‡</span>
        <span class="hljs-keyword">await</span> self.network_controller.block_traffic(
            source=<span class="hljs-string">"business_zone"</span>,
            destination=target_service,
            port=fault_spec.get(<span class="hljs-string">"port"</span>, <span class="hljs-number">443</span>)
        )
        
        <span class="hljs-comment"># éªŒè¯æ•…éšœå·²ç”Ÿæ•ˆ</span>
        is_blocked = <span class="hljs-keyword">await</span> self.verify_connectivity(target_service)
        
        <span class="hljs-keyword">return</span> FaultInjectionResult(
            <span class="hljs-built_in">type</span>=<span class="hljs-string">"network_partition"</span>,
            target=target_service,
            original_config=original_config,
            success=<span class="hljs-keyword">not</span> is_blocked,
            timestamp=time.time()
        )
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">service_outage_fault</span>(<span class="hljs-params">self, fault_spec</span>):
        <span class="hljs-string">"""æœåŠ¡ä¸å¯ç”¨æ•…éšœæ³¨å…¥"""</span>
        target_service = fault_spec.target
        
        <span class="hljs-keyword">if</span> fault_spec.method == <span class="hljs-string">"pod_termination"</span>:
            <span class="hljs-comment"># ç»ˆæ­¢Kubernetes Podï¼ˆæ¨¡æ‹ŸèŠ‚ç‚¹æ•…éšœï¼‰</span>
            pod_name = <span class="hljs-keyword">await</span> self.k8s_client.get_service_pod(target_service)
            <span class="hljs-keyword">await</span> self.k8s_client.terminate_pod(pod_name)
            
        <span class="hljs-keyword">elif</span> fault_spec.method == <span class="hljs-string">"process_kill"</span>:
            <span class="hljs-comment"># æ€æ­»è¿›ç¨‹</span>
            <span class="hljs-keyword">await</span> self.ssh_client.kill_process(
                fault_spec.host,
                fault_spec.process_pattern
            )
        
        <span class="hljs-comment"># ç­‰å¾…æœåŠ¡å®Œå…¨ä¸å¯ç”¨</span>
        <span class="hljs-keyword">await</span> asyncio.sleep(fault_spec.get(<span class="hljs-string">"downtime_delay"</span>, <span class="hljs-number">10</span>))
        
        <span class="hljs-comment"># éªŒè¯æœåŠ¡çŠ¶æ€</span>
        is_available = <span class="hljs-keyword">await</span> self.health_checker.check_service(target_service)
        
        <span class="hljs-keyword">return</span> FaultInjectionResult(
            <span class="hljs-built_in">type</span>=<span class="hljs-string">"service_outage"</span>,
            target=target_service,
            method=fault_spec.method,
            success=<span class="hljs-keyword">not</span> is_available,
            timestamp=time.time()
        )
</code></pre>
<h3 data-id="heading-8">å››ã€ç›‘æ§ã€å‘Šè­¦ä¸æ¢å¤æœºåˆ¶</h3>
<p>å»ºç«‹å®Œå–„çš„ç¾å¤‡ç›‘æ§ä½“ç³»ï¼Œå®ç°å¿«é€Ÿæ•…éšœæ£€æµ‹ä¸è‡ªåŠ¨æ¢å¤ã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç¾å¤‡çŠ¶æ€ç›‘æ§æ•°æ®åº“è®¾è®¡</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> disaster_recovery_status (
    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT,
    component_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    component_type ENUM(<span class="hljs-string">'primary'</span>, <span class="hljs-string">'standby'</span>, <span class="hljs-string">'gateway'</span>, <span class="hljs-string">'sync_service'</span>),
    status ENUM(<span class="hljs-string">'healthy'</span>, <span class="hljs-string">'degraded'</span>, <span class="hljs-string">'unhealthy'</span>, <span class="hljs-string">'unknown'</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    health_score <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">5</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">100.00</span>, <span class="hljs-comment">-- å¥åº·åº¦è¯„åˆ†</span>
    last_check_time <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    check_interval <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">30</span>, <span class="hljs-comment">-- æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰</span>
    
    <span class="hljs-comment">-- è¯¦ç»†çŠ¶æ€ä¿¡æ¯</span>
    metrics JSON,
    error_message TEXT,
    
    <span class="hljs-comment">-- åˆ‡æ¢ç›¸å…³çŠ¶æ€</span>
    in_traffic <span class="hljs-type">BOOLEAN</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">FALSE</span>, <span class="hljs-comment">-- æ˜¯å¦æ­£åœ¨æ‰¿è½½æµé‡</span>
    traffic_weight <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>, <span class="hljs-comment">-- æµé‡æƒé‡</span>
    last_switch_time <span class="hljs-type">TIMESTAMP</span>,
    
    INDEX idx_component_type (component_type, status),
    INDEX idx_health_check (last_check_time, health_score),
    INDEX idx_traffic_status (in_traffic, traffic_weight)
);

<span class="hljs-comment">-- æ•…éšœäº‹ä»¶è¡¨</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> failure_events (
    event_id <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">PRIMARY</span> KEY,
    component_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    failure_type <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    severity ENUM(<span class="hljs-string">'critical'</span>, <span class="hljs-string">'high'</span>, <span class="hljs-string">'medium'</span>, <span class="hljs-string">'low'</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    detected_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    
    <span class="hljs-comment">-- æ•…éšœè¯¦æƒ…</span>
    error_code <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>),
    error_message TEXT,
    stack_trace TEXT,
    
    <span class="hljs-comment">-- å½±å“èŒƒå›´</span>
    affected_services JSON,
    user_impact_estimate <span class="hljs-type">INT</span>, <span class="hljs-comment">-- é¢„è®¡å½±å“ç”¨æˆ·æ•°</span>
    
    <span class="hljs-comment">-- æ¢å¤ä¿¡æ¯</span>
    auto_recovery_attempted <span class="hljs-type">BOOLEAN</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">FALSE</span>,
    auto_recovery_success <span class="hljs-type">BOOLEAN</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">FALSE</span>,
    manual_intervention_required <span class="hljs-type">BOOLEAN</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">FALSE</span>,
    resolved_at <span class="hljs-type">TIMESTAMP</span>,
    resolution_notes TEXT,
    
    INDEX idx_failure_type (failure_type, severity),
    INDEX idx_detection_time (detected_at, resolved_at),
    INDEX idx_recovery_status (auto_recovery_success, manual_intervention_required)
);

<span class="hljs-comment">-- è‡ªåŠ¨åˆ›å»ºæ•…éšœæ£€æµ‹äº‹ä»¶</span>
<span class="hljs-keyword">CREATE</span> EVENT monitor_failure_detection
<span class="hljs-keyword">ON</span> SCHEDULE <span class="hljs-keyword">EVERY</span> <span class="hljs-number">10</span> <span class="hljs-keyword">SECOND</span>
DO
<span class="hljs-keyword">BEGIN</span>
    <span class="hljs-comment">-- æ£€æŸ¥ç»„ä»¶å¥åº·çŠ¶æ€</span>
    <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> failure_events (
        event_id, component_name, failure_type,
        severity, detected_at, error_message
    )
    <span class="hljs-keyword">SELECT</span> 
        UUID() <span class="hljs-keyword">as</span> event_id,
        s.component_name,
        <span class="hljs-keyword">CASE</span> 
            <span class="hljs-keyword">WHEN</span> s.health_score <span class="hljs-operator">&lt;</span> <span class="hljs-number">60</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">'component_unhealthy'</span>
            <span class="hljs-keyword">WHEN</span> s.health_score <span class="hljs-operator">&lt;</span> <span class="hljs-number">80</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">'component_degraded'</span>
            <span class="hljs-keyword">ELSE</span> <span class="hljs-string">'unknown'</span>
        <span class="hljs-keyword">END</span> <span class="hljs-keyword">as</span> failure_type,
        <span class="hljs-keyword">CASE</span>
            <span class="hljs-keyword">WHEN</span> s.health_score <span class="hljs-operator">&lt;</span> <span class="hljs-number">50</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">'critical'</span>
            <span class="hljs-keyword">WHEN</span> s.health_score <span class="hljs-operator">&lt;</span> <span class="hljs-number">70</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">'high'</span>
            <span class="hljs-keyword">WHEN</span> s.health_score <span class="hljs-operator">&lt;</span> <span class="hljs-number">80</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">'medium'</span>
            <span class="hljs-keyword">ELSE</span> <span class="hljs-string">'low'</span>
        <span class="hljs-keyword">END</span> <span class="hljs-keyword">as</span> severity,
        NOW() <span class="hljs-keyword">as</span> detected_at,
        s.error_message
    <span class="hljs-keyword">FROM</span> disaster_recovery_status s
    <span class="hljs-keyword">WHERE</span> s.health_score <span class="hljs-operator">&lt;</span> <span class="hljs-number">80</span>
        <span class="hljs-keyword">AND</span> s.last_check_time <span class="hljs-operator">&gt;=</span> DATE_SUB(NOW(), <span class="hljs-type">INTERVAL</span> s.check_interval <span class="hljs-keyword">SECOND</span>)
        <span class="hljs-keyword">AND</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> (
            <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> failure_events e 
            <span class="hljs-keyword">WHERE</span> e.component_name <span class="hljs-operator">=</span> s.component_name 
                <span class="hljs-keyword">AND</span> e.resolved_at <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>
        );
    
    <span class="hljs-comment">-- è‡ªåŠ¨è§¦å‘æ¢å¤å°è¯•</span>
    <span class="hljs-keyword">CALL</span> attempt_auto_recovery();
<span class="hljs-keyword">END</span>;

<span class="hljs-comment">-- è‡ªåŠ¨æ¢å¤å­˜å‚¨è¿‡ç¨‹</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> attempt_auto_recovery()
<span class="hljs-keyword">BEGIN</span>
    <span class="hljs-keyword">DECLARE</span> done <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">FALSE</span>;
    <span class="hljs-keyword">DECLARE</span> v_event_id <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>);
    <span class="hljs-keyword">DECLARE</span> v_component_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">128</span>);
    <span class="hljs-keyword">DECLARE</span> v_failure_type <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>);
    
    <span class="hljs-comment">-- æ¸¸æ ‡ï¼šè·å–å¯è‡ªåŠ¨æ¢å¤çš„æ•…éšœäº‹ä»¶</span>
    <span class="hljs-keyword">DECLARE</span> cur <span class="hljs-keyword">CURSOR</span> <span class="hljs-keyword">FOR</span> 
        <span class="hljs-keyword">SELECT</span> event_id, component_name, failure_type
        <span class="hljs-keyword">FROM</span> failure_events
        <span class="hljs-keyword">WHERE</span> resolved_at <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>
            <span class="hljs-keyword">AND</span> manual_intervention_required <span class="hljs-operator">=</span> <span class="hljs-literal">FALSE</span>
            <span class="hljs-keyword">AND</span> auto_recovery_attempted <span class="hljs-operator">=</span> <span class="hljs-literal">FALSE</span>
            <span class="hljs-keyword">AND</span> detected_at <span class="hljs-operator">&lt;=</span> DATE_SUB(NOW(), <span class="hljs-type">INTERVAL</span> <span class="hljs-number">30</span> <span class="hljs-keyword">SECOND</span>) <span class="hljs-comment">-- ç­‰å¾…30ç§’è§‚å¯Ÿ</span>
        LIMIT <span class="hljs-number">10</span>;
    
    <span class="hljs-keyword">DECLARE</span> CONTINUE HANDLER <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">NOT</span> FOUND <span class="hljs-keyword">SET</span> done <span class="hljs-operator">=</span> <span class="hljs-literal">TRUE</span>;
    
    <span class="hljs-keyword">OPEN</span> cur;
    
    recovery_loop: LOOP
        <span class="hljs-keyword">FETCH</span> cur <span class="hljs-keyword">INTO</span> v_event_id, v_component_name, v_failure_type;
        
        IF done <span class="hljs-keyword">THEN</span>
            LEAVE recovery_loop;
        <span class="hljs-keyword">END</span> IF;
        
        <span class="hljs-comment">-- æ ¹æ®æ•…éšœç±»å‹æ‰§è¡Œä¸åŒçš„æ¢å¤ç­–ç•¥</span>
        <span class="hljs-keyword">CASE</span> v_failure_type
            <span class="hljs-keyword">WHEN</span> <span class="hljs-string">'component_unhealthy'</span>:
                <span class="hljs-comment">-- å°è¯•é‡å¯ç»„ä»¶</span>
                <span class="hljs-keyword">CALL</span> restart_component(v_component_name);
                
                <span class="hljs-comment">-- æ£€æŸ¥æ¢å¤æ˜¯å¦æˆåŠŸ</span>
                <span class="hljs-keyword">SET</span> <span class="hljs-variable">@recovery</span>_success <span class="hljs-operator">=</span> check_component_health(v_component_name);
                
                <span class="hljs-keyword">UPDATE</span> failure_events
                <span class="hljs-keyword">SET</span> auto_recovery_attempted <span class="hljs-operator">=</span> <span class="hljs-literal">TRUE</span>,
                    auto_recovery_success <span class="hljs-operator">=</span> <span class="hljs-variable">@recovery</span>_success,
                    resolved_at <span class="hljs-operator">=</span> IF(<span class="hljs-variable">@recovery</span>_success, NOW(), <span class="hljs-keyword">NULL</span>)
                <span class="hljs-keyword">WHERE</span> event_id <span class="hljs-operator">=</span> v_event_id;
                
            <span class="hljs-keyword">WHEN</span> <span class="hljs-string">'network_partition'</span>:
                <span class="hljs-comment">-- å°è¯•é‡æ–°å»ºç«‹ç½‘ç»œè¿æ¥</span>
                <span class="hljs-keyword">CALL</span> reestablish_network_connection(v_component_name);
                
                <span class="hljs-comment">-- æ›´æ–°çŠ¶æ€</span>
                <span class="hljs-keyword">UPDATE</span> failure_events
                <span class="hljs-keyword">SET</span> auto_recovery_attempted <span class="hljs-operator">=</span> <span class="hljs-literal">TRUE</span>,
                    auto_recovery_success <span class="hljs-operator">=</span> <span class="hljs-literal">TRUE</span>,
                    resolved_at <span class="hljs-operator">=</span> NOW()
                <span class="hljs-keyword">WHERE</span> event_id <span class="hljs-operator">=</span> v_event_id;
                
            <span class="hljs-comment">-- å…¶ä»–æ•…éšœç±»å‹çš„æ¢å¤é€»è¾‘...</span>
        <span class="hljs-keyword">END</span> <span class="hljs-keyword">CASE</span>;
        
    <span class="hljs-keyword">END</span> LOOP;
    
    <span class="hljs-keyword">CLOSE</span> cur;
<span class="hljs-keyword">END</span>;
</code></pre>
<h3 data-id="heading-9">äº”ã€æ€»ç»“</h3>
<p>æ„å»ºä¼ä¸šå¾®ä¿¡æ¥å£çš„ç¾å¤‡æ¶æ„éœ€è¦ä»å¤šä¸ªç»´åº¦è¿›è¡Œç³»ç»Ÿæ€§è®¾è®¡ï¼šé€šè¿‡å¤šé€šé“å®¢æˆ·ç«¯å®ç°æ¥å…¥å±‚çš„é«˜å¯ç”¨ï¼Œé€šè¿‡åŒæ´»æ•°æ®åŒæ­¥ç¡®ä¿æ•°æ®å±‚çš„ä¸€è‡´æ€§ï¼Œé€šè¿‡æ™ºèƒ½æµé‡è°ƒåº¦å®ç°å¹³æ»‘åˆ‡æ¢ï¼Œæœ€åé€šè¿‡è‡ªåŠ¨åŒ–æ¼”ç»ƒéªŒè¯æ•´ä¸ªä½“ç³»çš„å¯é æ€§ã€‚</p>
<p>è¿™ç§æ¶æ„ä¸ä»…èƒ½å¤Ÿåº”å¯¹ä¼ä¸šå¾®ä¿¡æœåŠ¡æœ¬èº«çš„ä¸­æ–­ï¼Œä¹Ÿèƒ½åœ¨ä¼ä¸šç½‘ç»œã€æ•°æ®ä¸­å¿ƒç­‰åŸºç¡€è®¾æ–½å‡ºç°æ•…éšœæ—¶ï¼Œç¡®ä¿å…³é”®ä¸šåŠ¡é€šä¿¡çš„è¿ç»­æ€§ã€‚åœ¨å®é™…å®æ–½ä¸­ï¼Œéœ€è¦æ ¹æ®ä¸šåŠ¡çš„å…³é”®ç¨‹åº¦ã€RTO/RPOè¦æ±‚ä»¥åŠæˆæœ¬é¢„ç®—ï¼Œé€‰æ‹©åˆé€‚çš„ç¾å¤‡ç­‰çº§å’ŒæŠ€æœ¯æ–¹æ¡ˆã€‚</p>
<pre><code class="hljs language-python" lang="python">string_wxid = <span class="hljs-string">"bot555666"</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸ºä»€ä¹ˆæœ‰çš„å‡½æ•°è¦ç”¨ callï¼Œæœ‰çš„å´å®Œå…¨ä¸ç”¨ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7603587738160889919</link>    <guid>https://juejin.cn/post/7603587738160889919</guid>    <pubDate>2026-02-07T02:32:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603587738160889919" data-draft-id="7603563360329941034" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸ºä»€ä¹ˆæœ‰çš„å‡½æ•°è¦ç”¨ callï¼Œæœ‰çš„å´å®Œå…¨ä¸ç”¨ï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,é¢è¯•"/> <meta itemprop="datePublished" content="2026-02-07T02:32:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="DoraBigHead"/> <meta itemprop="url" content="https://juejin.cn/user/1557383746694648"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸ºä»€ä¹ˆæœ‰çš„å‡½æ•°è¦ç”¨ callï¼Œæœ‰çš„å´å®Œå…¨ä¸ç”¨ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1557383746694648/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    DoraBigHead
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T02:32:06.000Z" title="Sat Feb 07 2026 02:32:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>â€”â€”ä» this è®¾è®¡æœ¬è´¨ç†è§£ JavaScript æ–¹æ³•åˆ†ç±»</p>
<p>åœ¨å­¦ä¹  JavaScript çš„è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¤šäººéƒ½ä¼šå¡åœ¨ä¸€ä¸ªé—®é¢˜ä¸Šï¼š</p>
<blockquote>
<p><strong>ä¸ºä»€ä¹ˆ <code>Object.getPrototypeOf(obj)</code> ä¸éœ€è¦ <code>call</code>ï¼Œ<br/>
è€Œ <code>Object.prototype.toString</code> å´å¿…é¡»ç”¨ <code>call</code>ï¼Ÿ</strong></p>
</blockquote>
<p>æ›´è¿›ä¸€æ­¥çš„é—®é¢˜æ˜¯ï¼š</p>
<blockquote>
<p><strong>æˆ‘æ€ä¹ˆæå‰çŸ¥é“ä¸€ä¸ªå‡½æ•°åˆ°åº•æ˜¯â€œå‚æ•°å‹å‡½æ•°â€è¿˜æ˜¯â€œthis å‹å‡½æ•°â€ï¼Ÿ</strong></p>
</blockquote>
<p>æœ¬æ–‡å°†ä»<strong>è®¾è®¡å±‚é¢</strong>è€Œä¸æ˜¯â€œè®°è§„åˆ™â€çš„è§’åº¦ï¼Œå½»åº•è§£é‡Šè¿™ä¸ªé—®é¢˜ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€å›°æƒ‘çš„æ ¹æºï¼šæˆ‘ä»¬æ··æ·†äº†ä¸¤ç§â€œå‡½æ•°è®¾è®¡æ–¹å¼â€</h2>
<p>åœ¨ JS é‡Œï¼Œ<strong>å‡½æ•°åªæœ‰ä¸€ç§è¯­æ³•å½¢å¼</strong>ï¼Œä½†å®é™…ä¸Šæœ‰<strong>ä¸¤ç§å®Œå…¨ä¸åŒçš„è®¾è®¡æ€è·¯</strong>ï¼š</p>
<h3 data-id="heading-1">1ï¸âƒ£ å‚æ•°å‹å‡½æ•°ï¼ˆParameter-basedï¼‰</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(obj)
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(obj)
<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
</code></pre>
<p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li>æ“ä½œå¯¹è±¡ <strong>é€šè¿‡å‚æ•°ä¼ å…¥</strong></li>
<li>å‡½æ•°å†…éƒ¨ <strong>ä¸ä¾èµ– this</strong></li>
<li>this æ˜¯è° <strong>æ— å…³ç´§è¦</strong></li>
</ul>
<hr/>
<h3 data-id="heading-2">2ï¸âƒ£ this å‹å‡½æ•°ï¼ˆThis-basedï¼‰</h3>
<pre><code class="hljs language-scss" lang="scss">obj<span class="hljs-selector-class">.toString</span>()
arr<span class="hljs-selector-class">.push</span>(<span class="hljs-number">1</span>)
<span class="hljs-selector-tag">Object</span><span class="hljs-selector-class">.prototype</span><span class="hljs-selector-class">.toString</span><span class="hljs-selector-class">.call</span>(value)
</code></pre>
<p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li>æ“ä½œå¯¹è±¡ <strong>æ¥è‡ª this</strong></li>
<li>å‡½æ•°å†…éƒ¨ <strong>å¼ºä¾èµ– this</strong></li>
<li>å¿…é¡»æ˜ç¡® this æŒ‡å‘è°</li>
</ul>
<hr/>
<p>ğŸ‘‰ <strong>æ˜¯å¦éœ€è¦ä½¿ç”¨ <code>call</code>ï¼Œåªå–å†³äºè¿™ä¸€ç‚¹</strong></p>
<hr/>
<h2 data-id="heading-3">äºŒã€ä¸ºä»€ä¹ˆ <code>Object.getPrototypeOf</code> ä¸éœ€è¦ callï¼Ÿ</h2>
<p>å…ˆçœ‹è°ƒç”¨æ–¹å¼ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">Object</span><span class="hljs-selector-class">.getPrototypeOf</span>(<span class="hljs-attribute">left</span>)
</code></pre>
<p>å®ƒçš„â€œè®¾è®¡æ„å›¾â€éå¸¸æ˜ç¡®ï¼š</p>
<ul>
<li>è¦æ“ä½œçš„å¯¹è±¡æ˜¯ <code>left</code></li>
<li><code>left</code> å·²ç»ä½œä¸ºå‚æ•°ä¼ å…¥</li>
<li>å‡½æ•°å†…éƒ¨åªå…³å¿ƒå‚æ•°ï¼Œä¸å…³å¿ƒ this</li>
</ul>
<p>å¯ä»¥æŠŠå®ƒç†è§£ä¸ºä¼ªä»£ç ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getPrototypeOf</span>(<span class="hljs-params">obj</span>) {
  <span class="hljs-keyword">return</span> obj.<span class="hljs-property">__proto__</span>
}
</code></pre>
<p>ğŸ‘‰ <strong>è¿™æ˜¯ä¸€ä¸ªçº¯å·¥å…·å‡½æ•°ï¼ˆutility functionï¼‰</strong></p>
<p>æ‰€ä»¥ï¼š</p>
<ul>
<li>ä¸éœ€è¦ <code>call</code></li>
<li>ç”¨ <code>call</code> åè€Œå¤šä½™</li>
</ul>
<hr/>
<h2 data-id="heading-4">ä¸‰ã€ä¸ºä»€ä¹ˆ <code>Object.prototype.toString</code> å¿…é¡»ç”¨ callï¼Ÿ</h2>
<p>å†çœ‹è¿™ä¸ªç»å…¸å†™æ³•ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(value)
</code></pre>
<p>ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥è¿™æ ·ï¼Ÿ</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-title function_">toString</span>(value) <span class="hljs-comment">// âŒ</span>
</code></pre>
<p>å› ä¸ºè¿™ä¸ªæ–¹æ³•çš„è®¾è®¡æ˜¯ï¼š</p>
<ul>
<li><strong>æ²¡æœ‰å‚æ•°</strong></li>
<li>è¦æ£€æŸ¥çš„å¯¹è±¡åªèƒ½æ¥è‡ª <code>this</code></li>
</ul>
<p>ä¼ªä»£ç ç†è§£ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-string">"[object "</span> + å†…éƒ¨ç±»å‹(<span class="hljs-variable language_">this</span>) + <span class="hljs-string">"]"</span>
}
</code></pre>
<p>ğŸ‘‰ å¦‚æœä½ ä¸å‘Šè¯‰å®ƒ <code>this</code> æ˜¯è°ï¼Œå®ƒæ ¹æœ¬ä¸çŸ¥é“è¦æ£€æŸ¥ä»€ä¹ˆã€‚</p>
<p>è¿™å°±æ˜¯ <strong>å¿…é¡»ä½¿ç”¨ <code>call</code> çš„æ ¹æœ¬åŸå› </strong>ã€‚</p>
<hr/>
<h2 data-id="heading-5">å››ã€ä¸€ä¸ªæå…¶é‡è¦çš„åˆ¤æ–­æ ‡å‡†ï¼ˆ80% å‡†ç¡®ï¼‰</h2>
<blockquote>
<p><strong>çœ‹æ–¹æ³•â€œæŒ‚åœ¨å“ªé‡Œâ€</strong></p>
</blockquote>
<h3 data-id="heading-6">âœ… æŒ‚åœ¨æ„é€ å‡½æ•°æœ¬èº«ä¸Šçš„ï¼ˆå‚æ•°å‹ï¼‰</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Object</span>.<span class="hljs-property">keys</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-property">getPrototypeOf</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-property">isArray</span>
<span class="hljs-title class_">Math</span>.<span class="hljs-property">max</span>
</code></pre>
<p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li><code>Object.xxx</code></li>
<li><code>Array.xxx</code></li>
<li><code>Math.xxx</code></li>
</ul>
<p>ğŸ‘‰ <strong>å‡ ä¹ä¸€å®šæ˜¯å‚æ•°å‹å‡½æ•°</strong></p>
<hr/>
<h3 data-id="heading-7">âœ… æŒ‚åœ¨ prototype ä¸Šçš„ï¼ˆthis å‹ï¼‰</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">push</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">slice</span>
<span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">call</span>
</code></pre>
<p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li><code>xxx.prototype.xxx</code></li>
<li>æ“ä½œâ€œå½“å‰å¯¹è±¡â€</li>
</ul>
<p>ğŸ‘‰ <strong>å‡ ä¹ä¸€å®šä¾èµ– this</strong></p>
<hr/>
<h3 data-id="heading-8">å£è¯€æ€»ç»“ï¼ˆéå¸¸é‡è¦ï¼‰</h3>
<blockquote>
<p><strong>é™æ€æ–¹æ³•ç”¨å‚æ•°ï¼ŒåŸå‹æ–¹æ³•é  this</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-9">äº”ã€æœ€å¯é çš„æ–¹æ³•ï¼šä¸€è¡Œä»£ç éªŒè¯</h2>
<p>å¦‚æœä½ çœŸçš„ä¸ç¡®å®šï¼Œç›´æ¥ç”¨è¿™ä¸€æ‹›ã€‚</p>
<h3 data-id="heading-10">éªŒè¯æ˜¯å¦ä¾èµ– this</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fn = <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>
<span class="hljs-title function_">fn</span>() <span class="hljs-comment">// âŒ æŠ¥é”™æˆ–ç»“æœå¼‚å¸¸</span>
</code></pre>
<p>ğŸ‘‰ æ²¡æœ‰ this å°±ä¸èƒ½å·¥ä½œ â†’ this å‹å‡½æ•°</p>
<hr/>
<h3 data-id="heading-11">éªŒè¯æ˜¯å¦ä¾èµ–å‚æ•°</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">const</span> <span class="hljs-variable">fn</span> <span class="hljs-operator">=</span> Object.getPrototypeOf
<span class="hljs-title function_">fn</span><span class="hljs-params">({})</span> <span class="hljs-comment">// âœ… æ­£å¸¸æ‰§è¡Œ</span>
</code></pre>
<p>ğŸ‘‰ this ä¸é‡è¦ â†’ å‚æ•°å‹å‡½æ•°</p>
<hr/>
<h2 data-id="heading-12">å…­ã€ä¸ºä»€ä¹ˆä¸èƒ½â€œæ‰€æœ‰å‡½æ•°éƒ½ç”¨ callâ€ï¼Ÿ</h2>
<p>æŠ€æœ¯ä¸Šå¯ä»¥ï¼Œä½†<strong>è¯­ä¹‰ä¸Šæ˜¯é”™è¯¯çš„</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Object</span>.<span class="hljs-property">getPrototypeOf</span>.<span class="hljs-title function_">call</span>(<span class="hljs-literal">null</span>, obj)
</code></pre>
<p>é—®é¢˜åœ¨äºï¼š</p>
<ul>
<li>this è¢«å®Œå…¨å¿½ç•¥</li>
<li>ä»£ç å¯è¯»æ€§å˜å·®</li>
<li>è¿èƒŒ JS API çš„è®¾è®¡åˆè¡·</li>
</ul>
<p>ğŸ‘‰ <strong>call çš„å­˜åœ¨æ˜¯ä¸ºäº†è§£å†³ thisï¼Œè€Œä¸æ˜¯ç»Ÿä¸€å†™æ³•</strong></p>
<hr/>
<h2 data-id="heading-13">ä¸ƒã€æ€»ç»“ä¸€å¥è¯ï¼ˆåšå®¢ç»“å°¾ç‰ˆï¼‰</h2>
<blockquote>
<p><strong>JS ä¸­æ˜¯å¦ä½¿ç”¨ <code>call</code>ï¼Œ<br/>
ä¸å–å†³äºâ€œå‡½æ•°é«˜çº§ä¸é«˜çº§â€ï¼Œ<br/>
åªå–å†³äºâ€œè¿™ä¸ªå‡½æ•°æ˜¯å¦ä¾èµ– thisâ€ã€‚</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-14">å…«ã€ä½ ç°åœ¨å¡ä½ï¼Œå…¶å®éå¸¸æ­£å¸¸</h2>
<p>ä½ ç°åœ¨é‡åˆ°çš„ä¸æ˜¯â€œè¯­æ³•é—®é¢˜â€ï¼Œè€Œæ˜¯ï¼š</p>
<blockquote>
<p><strong>ä»â€œä¼šç”¨ JSâ€ â†’ â€œç†è§£ JS è®¾è®¡â€ çš„è¿‡æ¸¡é˜¶æ®µ</strong></p>
</blockquote>
<p>è¿™æ˜¯ä¸€ä¸ªæ‰€æœ‰ä¸­é«˜çº§ JS å¼€å‘è€…éƒ½å¿…ç»çš„åã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç”¨AIç¼–ç¨‹å¿«ä¸€å¹´äº†ï¼Œåˆ†äº« 10 ä¸ªè®©æˆ‘æ•ˆç‡ç¿»å€çš„ Claude Code æ ¸å¿ƒ Skills]]></title>    <link>https://juejin.cn/post/7603444191448530978</link>    <guid>https://juejin.cn/post/7603444191448530978</guid>    <pubDate>2026-02-06T10:32:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603444191448530978" data-draft-id="7603444191448514594" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç”¨AIç¼–ç¨‹å¿«ä¸€å¹´äº†ï¼Œåˆ†äº« 10 ä¸ªè®©æˆ‘æ•ˆç‡ç¿»å€çš„ Claude Code æ ¸å¿ƒ Skills"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯"/> <meta itemprop="datePublished" content="2026-02-06T10:32:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="aZheçš„å…¨æ ˆçŸ¥è¯†åˆ†äº«"/> <meta itemprop="url" content="https://juejin.cn/user/1039471959105228"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç”¨AIç¼–ç¨‹å¿«ä¸€å¹´äº†ï¼Œåˆ†äº« 10 ä¸ªè®©æˆ‘æ•ˆç‡ç¿»å€çš„ Claude Code æ ¸å¿ƒ Skills
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1039471959105228/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    aZheçš„å…¨æ ˆçŸ¥è¯†åˆ†äº«
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T10:32:30.000Z" title="Fri Feb 06 2026 10:32:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    19
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è½¬çœ¼åˆ°äº† 2026 å¹´ï¼Œä½¿ç”¨ AI è¾…åŠ©ç¼–ç¨‹å·²ç»å¿«ä¸€å¹´äº†ã€‚ä»æœ€åˆçš„å°é²œåˆ°ç°åœ¨çš„æ·±åº¦ä¾èµ–ï¼ŒClaude Code å·²ç»å®Œå…¨æ”¹å˜äº†æˆ‘çš„å¼€å‘å·¥ä½œæµã€‚</p>
<p>å¾ˆå¤šäººåªæŠŠ Claude Code å½“ä½œä¸€ä¸ªç®€å•çš„é—®ç­”å·¥å…·ï¼Œå…¶å®å®ƒå†…ç½®çš„ Skills æ‰æ˜¯çœŸæ­£çš„ææ•ˆç¥å™¨ã€‚ç»è¿‡è¿™ä¸€å¹´çš„å®æˆ˜æ‘¸ç´¢ï¼Œæˆ‘æ€»ç»“äº†ä½¿ç”¨é¢‘ç‡æœ€é«˜ã€æœ€èƒ½æ‰“çš„ 10 ä¸ªæ ¸å¿ƒ Skillsã€‚ç†Ÿç»ƒæŒæ¡è¿™äº›ï¼Œä½ çš„å¼€å‘æ•ˆç‡è‡³å°‘èƒ½æå‡ 200%ã€‚</p>
<h2 data-id="heading-0">å®‰è£…ä¸åŸºç¡€</h2>
<p>å¦‚æœä½ è¿˜æ²¡ç”¨è¿‡ï¼Œå…ˆå¿«é€Ÿä¸Šæ‰‹ï¼š</p>
<ol>
<li><strong>å®‰è£…</strong>:Â <code>npm install -g @anthropic-ai/claude-code</code></li>
<li><strong>ç™»å½•</strong>:Â <code>claude login</code></li>
<li><strong>ä½¿ç”¨</strong>: åœ¨äº¤äº’ç•Œé¢è¾“å…¥Â <code>/</code>Â åŠ ä¸Š Skill åç§°å³å¯ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-1">ç¬¬ä¸€é˜¶æ®µï¼šè°‹å®šè€ŒååŠ¨ â€”â€” è§„åˆ’ä¸æ¶æ„</h2>
<h3 data-id="heading-2">1. Plan (<code>/plan</code>)</h3>
<p><strong>æ ¸å¿ƒç”¨é€”</strong>: å®æ–½è§„åˆ’ä¸æ¶æ„è®¾è®¡</p>
<p>è¿™ç»å¯¹æ˜¯è¢«ä½ä¼°çš„ç¥æŠ€ã€‚ä»¥å‰æ‹¿åˆ°éœ€æ±‚å°±æƒ³å†™ä»£ç ï¼Œç»“æœå†™åˆ°ä¸€åŠå‘ç°é€»è¾‘æ¼æ´ã€‚ç°åœ¨æˆ‘éƒ½ä¼šå…ˆç”¨Â <code>/plan</code>ã€‚å®ƒä¸åªæ˜¯åˆ—ä¸ªæ¸…å•ï¼Œè€Œæ˜¯åƒä¸€ä¸ªèµ„æ·±æ¶æ„å¸ˆä¸€æ ·ï¼Œå¸®ä½ æ‹†è§£æ­¥éª¤ã€é¢„åˆ¤é£é™©ã€è®¾è®¡æ¥å£ã€‚</p>
<p><strong>ç»éªŒä¹‹è°ˆ</strong>: ä¸è¦åªè¯´â€œå¸®æˆ‘åšä¸ªç™»å½•â€ï¼Œè¯•ç€è¯´ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/plan é‡æ„ç”¨æˆ·è®¤è¯æ¨¡å—ï¼Œæ”¯æŒ OAuth2.0ï¼Œéœ€è¦å…¼å®¹ç°æœ‰çš„ JWT é€»è¾‘
</code></pre>
<p>å®ƒç”Ÿæˆçš„è®¡åˆ’ä¹¦ï¼Œå¾€å¾€æ¯”æˆ‘è‡ªå·±æƒ³çš„è¿˜è¦å‘¨å…¨ã€‚</p>
<hr/>
<h2 data-id="heading-3">ç¬¬äºŒé˜¶æ®µï¼šæé€Ÿç¼–ç  â€”â€” è´¨é‡ä¸é€Ÿåº¦å¹¶é‡</h2>
<h3 data-id="heading-4">2. TDD (<code>/tdd</code>)</h3>
<p><strong>æ ¸å¿ƒç”¨é€”</strong>: æµ‹è¯•é©±åŠ¨å¼€å‘</p>
<p>â€œå…ˆå†™æµ‹è¯•å†å†™ä»£ç â€æ˜¯å¾ˆå¤šäººçš„ç—›ç‚¹ï¼Œå› ä¸ºå†™æµ‹è¯•å¾ˆç¹çã€‚ä½†æœ‰äº†Â <code>/tdd</code>ï¼Œä¸€åˆ‡éƒ½å˜äº†ã€‚å®ƒä¸¥æ ¼éµå¾ªâ€œçº¢-ç»¿-é‡æ„â€æµç¨‹ï¼Œè‡ªåŠ¨å¸®ä½ å†™æµ‹è¯•ç”¨ä¾‹ï¼Œç„¶åå®ç°åŠŸèƒ½é€šè¿‡æµ‹è¯•ã€‚</p>
<p><strong>ç»éªŒä¹‹è°ˆ</strong>: ç”¨å®ƒæ¥å†™å·¥å…·å‡½æ•°æˆ–å¤æ‚é€»è¾‘ç‰¹åˆ«çˆ½ï¼Œä¿è¯ä»£ç ä¸€å‡ºç‚‰å°±æ˜¯å¥å£®çš„ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">/tdd å®ç°ä¸€ä¸ªè§£æ CSV æ–‡ä»¶çš„å·¥å…·å‡½æ•°ï¼Œå¤„ç†å„ç§è¾¹ç¼˜æƒ…å†µ
</code></pre>
<h3 data-id="heading-5">3. Commit (<code>/commit</code>)</h3>
<p><strong>æ ¸å¿ƒç”¨é€”</strong>: æ™ºèƒ½ Git æäº¤</p>
<p>å†™ Commit Message æ˜¯ä»¶æ¯ç‡¥çš„äº‹ï¼Œä½†åˆå¾ˆé‡è¦ã€‚<code>/commit</code>Â ä¼šè‡ªåŠ¨åˆ†æä½ æš‚å­˜åŒºçš„ä»£ç å˜æ›´ï¼Œç”Ÿæˆç¬¦åˆ Conventional Commits è§„èŒƒçš„æäº¤ä¿¡æ¯ã€‚</p>
<p><strong>ç»éªŒä¹‹è°ˆ</strong>: å®ƒèƒ½ç²¾å‡†è¯†åˆ«ä½ æ˜¯ featã€fix è¿˜æ˜¯ refactorï¼Œæè¿°æ¯”æˆ‘è‡ªå·±å†™çš„è¿˜å‡†ç¡®ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">/commit
</code></pre>
<hr/>
<h2 data-id="heading-6">ç¬¬ä¸‰é˜¶æ®µï¼šè´¨é‡å®ˆæŠ¤ â€”â€” å®‰å…¨ä¸ç¨³å®š</h2>
<h3 data-id="heading-7">4. Code Review (<code>/code-review</code>)</h3>
<p><strong>æ ¸å¿ƒç”¨é€”</strong>: ä»£ç è´¨é‡å®¡æŸ¥</p>
<p>åœ¨è¿™ä¸ª AI ç”Ÿæˆä»£ç çš„æ—¶ä»£ï¼ŒReview å˜å¾—æ¯”ç¼–å†™æ›´é‡è¦ã€‚æ¯æ¬¡å†™å®Œä»£ç ï¼Œæˆ‘éƒ½ä¼šä¹ æƒ¯æ€§æ•²ä¸€ä¸‹Â <code>/code-review</code>ã€‚å®ƒå°±åƒä¸€ä¸ªä¸çŸ¥ç–²å€¦çš„ Tech Leadï¼Œä»å‘½åè§„èŒƒåˆ°æ½œåœ¨ Bugï¼Œç”šè‡³æ€§èƒ½éšæ‚£ï¼Œéƒ½èƒ½ç»™ä½ æªå‡ºæ¥ã€‚</p>
<p><strong>ç»éªŒä¹‹è°ˆ</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">/code-review
</code></pre>
<h3 data-id="heading-8">5. Security Review (<code>/security-review</code>)</h3>
<p><strong>æ ¸å¿ƒç”¨é€”</strong>: å®‰å…¨æ€§å®¡è®¡</p>
<p>å®‰å…¨é—®é¢˜å¾€å¾€æ˜¯åçŸ¥åè§‰çš„ã€‚è¿™ä¸ª Skill ä¸“æ³¨äºå®‰å…¨é¢†åŸŸï¼ŒæŒ‰ç…§ OWASP Top 10 æ ‡å‡†æ‰«æä½ çš„ä»£ç ã€‚SQL æ³¨å…¥ã€XSSã€æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼Œå®ƒæ¯”ä½ æ›´æ•æ„Ÿã€‚</p>
<p><strong>ç»éªŒä¹‹è°ˆ</strong>: æ¶‰åŠç”¨æˆ·è¾“å…¥æˆ–æ”¯ä»˜æ¥å£æ—¶ï¼Œå¿…é¡»è·‘ä¸€éã€‚</p>
<pre><code class="hljs language-bash" lang="bash">/security-review æ£€æŸ¥åˆšä¿®æ”¹çš„æ”¯ä»˜æ¥å£é€»è¾‘
</code></pre>
<h3 data-id="heading-9">6. Build Fix (<code>/build-fix</code>)</h3>
<p><strong>æ ¸å¿ƒç”¨é€”</strong>: æ„å»ºä¸ç¼–è¯‘ä¿®å¤</p>
<p>é¢å¯¹ä¸€å †çº¢è‰²çš„æŠ¥é”™ä¿¡æ¯å¤´å¤§å—ï¼Ÿ<code>/build-fix</code>Â ä¸“é—¨ç”¨æ¥è§£å†³ç¼–è¯‘å¤±è´¥ã€ç±»å‹é”™è¯¯ï¼ˆç‰¹åˆ«æ˜¯ TypeScript å’Œ Goï¼‰ã€‚å®ƒä¸æ˜¯çæ”¹ï¼Œè€Œæ˜¯é€šè¿‡æœ€å°åŒ–çš„å˜æ›´è®©é¡¹ç›®æ¢å¤â€œç»¿è‰²â€ã€‚</p>
<p><strong>ç»éªŒä¹‹è°ˆ</strong>: CI æŒ‚äº†æˆ–è€…æœ¬åœ°è·‘ä¸èµ·æ¥æ—¶ï¼Œç›´æ¥äº¤ç»™å®ƒã€‚</p>
<pre><code class="hljs language-bash" lang="bash">/build-fix è§£å†³å½“å‰çš„ TypeScript ç¼–è¯‘é”™è¯¯
</code></pre>
<h3 data-id="heading-10">7. E2E (<code>/e2e</code>)</h3>
<p><strong>æ ¸å¿ƒç”¨é€”</strong>: ç«¯åˆ°ç«¯æµ‹è¯•</p>
<p>Playwright å¾ˆå¥½ç”¨ï¼Œä½†å†™è„šæœ¬å¾ˆç´¯ã€‚<code>/e2e</code>Â å¯ä»¥è‡ªåŠ¨ç”Ÿæˆã€è¿è¡Œå’Œç»´æŠ¤ E2E æµ‹è¯•è„šæœ¬ã€‚å®ƒèƒ½æ¨¡æ‹ŸçœŸå®ç”¨æˆ·æ“ä½œï¼Œç¡®ä¿ä½ çš„æ ¸å¿ƒä¸šåŠ¡æµç¨‹ï¼ˆæ¯”å¦‚ä¸‹å•ã€æ³¨å†Œï¼‰åœ¨ä»»ä½•æ—¶å€™éƒ½æ˜¯é€šçš„ã€‚</p>
<p><strong>ç»éªŒä¹‹è°ˆ</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">/e2e ä¸ºè´­ç‰©è½¦ç»“ç®—æµç¨‹åˆ›å»ºæµ‹è¯•
</code></pre>
<hr/>
<h2 data-id="heading-11">ç¬¬å››é˜¶æ®µï¼šæŒç»­è¿›åŒ– â€”â€” ç»´æŠ¤ä¸æˆé•¿</h2>
<h3 data-id="heading-12">8. Refactor Clean (<code>/refactor-clean</code>)</h3>
<p><strong>æ ¸å¿ƒç”¨é€”</strong>: ä»£ç æ¸…ç†ä¸é‡æ„</p>
<p>é¡¹ç›®è·‘ä¹…äº†ï¼Œæ€»ä¼šå †ç§¯å¾ˆå¤šæ­»ä»£ç ã€‚<code>/refactor-clean</code>Â ç»“åˆäº† knip ç­‰å·¥å…·ï¼Œèƒ½ç²¾å‡†è¯†åˆ«å¹¶å®‰å…¨ç§»é™¤æœªä½¿ç”¨çš„å¯¼å‡ºã€å˜é‡å’Œæ–‡ä»¶ã€‚</p>
<p><strong>ç»éªŒä¹‹è°ˆ</strong>: å®šæœŸè·‘ä¸€æ¬¡ï¼Œç»™ä»£ç åº“â€œç˜¦èº«â€ï¼Œå¿ƒæƒ…éƒ½ä¼šå˜å¥½ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">/refactor-clean æ¸…ç† src/utils ç›®å½•ä¸‹çš„æœªä½¿ç”¨ä»£ç 
</code></pre>
<h3 data-id="heading-13">9. Update Docs (<code>/update-docs</code>)</h3>
<p><strong>æ ¸å¿ƒç”¨é€”</strong>: æ–‡æ¡£è‡ªåŠ¨åŒ–æ›´æ–°</p>
<p>ä»£ç æ”¹äº†ï¼Œæ–‡æ¡£æ²¡æ”¹ï¼Œè¿™æ˜¯å¸¸æ€ã€‚<code>/update-docs</code>Â è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚å®ƒèƒ½è‡ªåŠ¨åˆ†æä»£ç å˜æ›´ï¼ŒåŒæ­¥æ›´æ–° README å’Œæ¶æ„å›¾ï¼ˆCodemapsï¼‰ã€‚</p>
<p><strong>ç»éªŒä¹‹è°ˆ</strong>: ä¿æŒæ–‡æ¡£é²œæ´»çš„ç§˜è¯€ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">/update-docs
</code></pre>
<h3 data-id="heading-14">10. Learn (<code>/learn</code>)</h3>
<p><strong>æ ¸å¿ƒç”¨é€”</strong>: æŒç»­å­¦ä¹ ä¸æ¨¡å¼æå–</p>
<p>è¿™æ˜¯ Claude Code æœ€å…·â€œæˆé•¿æ€§â€çš„åŠŸèƒ½ã€‚å½“ä½ è§£å†³äº†ä¸€ä¸ªæ£˜æ‰‹é—®é¢˜ï¼Œæˆ–è€…é€šè¿‡å¯¹è¯ç£¨åˆå‡ºäº†ä¸€å¥—å®Œç¾çš„ Promptï¼Œç”¨Â <code>/learn</code>Â æŠŠå®ƒè®°å½•ä¸‹æ¥ã€‚ä¸‹æ¬¡å®ƒå°±ä¼šè®°ä½ä½ çš„åå¥½å’Œç»éªŒã€‚</p>
<p><strong>ç»éªŒä¹‹è°ˆ</strong>: æŠŠ AI å˜æˆä½ ä¸“å±çš„å½¢çŠ¶ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">/learn æ€»ç»“è¿™æ¬¡è§£å†³ Next.js è·¯ç”±é—®é¢˜çš„æ–¹æ¡ˆ
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç”¨ chatgpt å­¦ä¹ è‹±è¯­ 90/n C16T3L3 Seed germination (ç§å­å‘èŠ½)]]></title>    <link>https://juejin.cn/post/7603563317040136255</link>    <guid>https://juejin.cn/post/7603563317040136255</guid>    <pubDate>2026-02-06T11:34:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603563317040136255" data-draft-id="7603587738160070719" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç”¨ chatgpt å­¦ä¹ è‹±è¯­ 90/n C16T3L3 Seed germination (ç§å­å‘èŠ½)"/> <meta itemprop="keywords" content="Gemini"/> <meta itemprop="datePublished" content="2026-02-06T11:34:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="VincentHe"/> <meta itemprop="url" content="https://juejin.cn/user/1398234520758189"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç”¨ chatgpt å­¦ä¹ è‹±è¯­ 90/n C16T3L3 Seed germination (ç§å­å‘èŠ½)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1398234520758189/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    VincentHe
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T11:34:56.000Z" title="Fri Feb 06 2026 11:34:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8624b20d6c7e45b48eec3c21eaf3f78a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmluY2VudEhl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770982496&amp;x-signature=zuaTkVveLXU5ALU2gu0oMwF%2Frp0%3D" alt="banner" loading="lazy"/></p>
<h2 data-id="heading-0">å‰‘é›… 13 Test 1 Listening 3 Seed germination (C13T1L3) (ç§å­å‘èŠ½) å¤ç›˜</h2>
<h3 data-id="heading-1">Section 3 Seed germination (C13T1L3)</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fieltscat.xdf.cn%2Fpractice%2Fanalyze%2Flisten%2F6682%2F276B7F251298D34F" target="_blank" title="https://ieltscat.xdf.cn/practice/analyze/listen/6682/276B7F251298D34F" ref="nofollow noopener noreferrer">Listen 3</a></p>
<h4 data-id="heading-2">ç¬¬ 21 é¢˜ï¼š[é€‰æ‹©é¢˜] å®éªŒé€‰é¢˜åŠ¨æœº</h4>
<ul>
<li><strong>é¢˜å¹²å…³é”®è¯ (Keywords)</strong>ï¼š
<ul>
<li><code>Jack interested</code></li>
<li><code>investigating</code></li>
<li><code>seed germination</code></li>
</ul>
</li>
<li><strong>åŸæ–‡åŒä¹‰æ›¿æ¢ (Paraphrasing)</strong>ï¼š
<ul>
<li><code>reason</code> -&gt; <code>reason</code> (Sent 4)</li>
<li><code>do a module</code> -&gt; <code>optional module</code> (Sent 5)</li>
<li><code>later on</code> -&gt; <code>in the third year</code> (Sent 5)</li>
</ul>
</li>
<li><strong>åŸæ–‡å®šä½ (Evidence)</strong>ï¼š
<ul>
<li><strong>Sentence 5</strong>: "Yeah, but practically everything we do is going to feed into that. No, there's an <code>optional module</code> on seed structure and function <code>in the third year</code> that I might do,"</li>
<li><strong>Sentence 6</strong>: "so I thought it <code>might be useful for that</code>."</li>
</ul>
</li>
<li><strong>è§£æ &amp; é¿å‘æŒ‡å—</strong>ï¼š
<ul>
<li><strong>æ­£ç¡®ç­”æ¡ˆ A</strong>ï¼šJack æ˜ç¡®æåˆ°å¤§ä¸‰æœ‰ä¸€ä¸ªé€‰ä¿®æ¨¡å—ï¼ˆoptional moduleï¼‰ï¼Œåšè¿™ä¸ªå®éªŒæ˜¯ä¸ºäº†é‚£ä¸ªæ¨¡å—åšå‡†å¤‡ã€‚</li>
<li><strong>å¹²æ‰°é¡¹ B (career)</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„ <strong>â€œæ‰¿è®¤ä½†éä¸»è¦åŸå› â€</strong> çš„å¹²æ‰°ã€‚Emma åœ¨ <strong>Sentence 4</strong> æåˆ° "hoping to work in plant science"ï¼ŒJack åœ¨ <strong>Sentence 5</strong> å¼€å¤´è¯´äº† "Yeah"ï¼Œä½†ä»–é©¬ä¸Šç”¨ "<strong>but</strong>... No..." è¿›è¡Œäº†è½¬æŠ˜ã€‚å¯¹äº 5.5 åˆ†å­¦ç”Ÿæ¥è¯´ï¼Œå¬åˆ° "Yeah" å®¹æ˜“è¯¯ä»¥ä¸ºæ˜¯åœ¨ç¡®è®¤ç­”æ¡ˆï¼Œå¿…é¡»è€å¿ƒå¬å®Œç´§æ¥ç€çš„è½¬æŠ˜è¿è¯ã€‚</li>
<li><strong>å¹²æ‰°é¡¹ C (dissertation)</strong>ï¼š<strong>Sentence 6</strong> æåˆ° "I <code>don't</code> have to do a dissertation module"ï¼Œè¿™æ˜¯æ˜ç¡®çš„å¦å®šä¿¡æ¯ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-3">ç¬¬ 22 é¢˜ï¼š[é€‰æ‹©é¢˜] å®éªŒçš„ä¸»è¦ä¼˜åŠ¿</h4>
<ul>
<li><strong>é¢˜å¹²å…³é”®è¯ (Keywords)</strong>ï¼š
<ul>
<li><code>main advantage</code></li>
<li><code>present experiment</code></li>
</ul>
</li>
<li><strong>åŸæ–‡åŒä¹‰æ›¿æ¢ (Paraphrasing)</strong>ï¼š
<ul>
<li><code>advantage</code> -&gt; <code>good one to choose</code> (Sent 11)</li>
<li><code>completed in the time available</code> -&gt; <code>That should be fine if we start now</code> (Sent 10)</li>
</ul>
</li>
<li><strong>åŸæ–‡å®šä½ (Evidence)</strong>ï¼š
<ul>
<li><strong>Sentence 10</strong>: "<code>That should be fine if we start now</code>. A lot of the other possible experiments need quite a bit longer."</li>
<li><strong>Sentence 11</strong>: "So that'd <code>make it a good one to choose</code>."</li>
</ul>
</li>
<li><strong>è§£æ &amp; é¿å‘æŒ‡å—</strong>ï¼š
<ul>
<li><strong>æ­£ç¡®ç­”æ¡ˆ C</strong>ï¼šJack è¯´å¦‚æœç°åœ¨å¼€å§‹æ—¶é—´æ­£å¥½ï¼ˆfineï¼‰ï¼Œè€Œå…¶ä»–å®éªŒéœ€è¦æ›´é•¿æ—¶é—´ï¼ˆneed quite a bit longerï¼‰ï¼ŒEmma æ€»ç»“è¯´è¿™æ˜¯é€‰æ‹©å®ƒçš„å¥½ç†ç”±ã€‚</li>
<li><strong>å¹²æ‰°é¡¹ B (laboratory/equipment)</strong>ï¼š<strong>Sentence 11</strong> ä¸­ Emma æåˆ°äº† "equipment" å’Œ "laboratory"ï¼Œä½†å¥¹è¯´çš„æ˜¯ "that's <code>not really an issue</code>"ï¼ˆé‚£ä¸æ˜¯ä¸ªé—®é¢˜/é‡ç‚¹ï¼‰ã€‚å†² 7 åˆ†å¿…é¡»å­¦ä¼šåŒºåˆ†â€œæåŠçš„ç»†èŠ‚â€å’Œâ€œè¢«å¼ºè°ƒçš„ä¼˜ç‚¹â€ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-4">ç¬¬ 23 é¢˜ï¼š[é€‰æ‹©é¢˜] éœ€è¦è·Ÿå¯¼å¸ˆç¡®è®¤çš„äº‹é¡¹</h4>
<ul>
<li><strong>é¢˜å¹²å…³é”®è¯ (Keywords)</strong>ï¼š
<ul>
<li><code>decide to check</code></li>
<li><code>tutor</code></li>
</ul>
</li>
<li><strong>åŸæ–‡åŒä¹‰æ›¿æ¢ (Paraphrasing)</strong>ï¼š
<ul>
<li><code>check with their tutor</code> -&gt; <code>have a word with the tutor</code> (Sent 12)</li>
<li><code>anyone else</code> -&gt; <code>the only ones</code> (Sent 13)</li>
</ul>
</li>
<li><strong>åŸæ–‡å®šä½ (Evidence)</strong>ï¼š
<ul>
<li><strong>Sentence 12</strong>: "Yeah. We need to <code>have a word with the tutor</code> if we're going to go ahead with it though."</li>
<li><strong>Sentence 13</strong>: "But we need to be sure we're <code>the only ones</code> doing it."</li>
</ul>
</li>
<li><strong>è§£æ &amp; é¿å‘æŒ‡å—</strong>ï¼š
<ul>
<li><strong>æ­£ç¡®ç­”æ¡ˆ B</strong>ï¼šJack è¯´éœ€è¦ç¡®è®¤ä»–ä»¬æ˜¯å”¯ä¸€åšè¿™ä¸ªé¢˜ç›®çš„äººï¼ˆthe only ones doing itï¼‰ï¼Œå¯¹åº”é€‰é¡¹ B ä¸­çš„ anyone elseã€‚</li>
<li><strong>å¹²æ‰°é¡¹ A (aim)</strong>ï¼š<strong>Sentence 12</strong> æåˆ° "I'm sure our aim's OK"ï¼Œæ—¢ç„¶å·²ç» sureï¼ˆç¡®å®šï¼‰äº†ï¼Œå°±ä¸éœ€è¦å†å» checkï¼ˆæ ¸å®ï¼‰ã€‚</li>
<li><strong>å¹²æ‰°é¡¹ C (final grade)</strong>ï¼š<strong>Sentence 13</strong> æåˆ°äº† "ten percent of our final mark"ï¼Œä½†è¿™åªæ˜¯ä»–ä»¬åœ¨è®¨è®ºåˆ†å€¼ï¼Œå¹¶éè¦æ‰¾å¯¼å¸ˆç¡®è®¤çš„å†…å®¹ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-5">ç¬¬ 24 é¢˜ï¼š[é€‰æ‹©é¢˜] å¯¹ Graves ä¹¦ç±çš„è¯„ä»·</h4>
<ul>
<li><strong>é¢˜å¹²å…³é”®è¯ (Keywords)</strong>ï¼š
<ul>
<li><code>Graves' book</code></li>
<li><code>disappointing</code></li>
</ul>
</li>
<li><strong>åŸæ–‡åŒä¹‰æ›¿æ¢ (Paraphrasing)</strong>ï¼š
<ul>
<li><code>book</code> -&gt; <code>The one by Graves</code> (Sent 16)</li>
<li><code>theoretical</code> -&gt; <code>theory</code> (Sent 16)</li>
</ul>
</li>
<li><strong>åŸæ–‡å®šä½ (Evidence)</strong>ï¼š
<ul>
<li><strong>Sentence 16</strong>: "I found it quite hard to follow - <code>lots about the theory</code>, which I hadn't expected."</li>
<li><strong>Sentence 17</strong>: "Yes, I'd been hoping for something more practical."</li>
</ul>
</li>
<li><strong>è§£æ &amp; é¿å‘æŒ‡å—</strong>ï¼š
<ul>
<li><strong>æ­£ç¡®ç­”æ¡ˆ C</strong>ï¼šEmma è¯´ä¹¦é‡Œå…¨æ˜¯ç†è®ºï¼ˆtheoryï¼‰ï¼ŒJack é™„å’Œè¯´ä»–åŸæœ¬å¸Œæœ›èƒ½æ›´å®ç”¨ï¼ˆpracticalï¼‰ã€‚è¯æ€§è½¬æ¢ <code>theory</code> (n.) -&gt; <code>theoretical</code> (adj.) æ˜¯é›…æ€æ ¸å¿ƒè€ƒç‚¹ã€‚</li>
<li><strong>å¹²æ‰°é¡¹ A (recent advances)</strong>ï¼š<strong>Sentence 17</strong> æåˆ°ä¹¦é‡Œç¡®å®åŒ…å«äº† "recent findings"ï¼Œæ‰€ä»¥ A é€‰é¡¹è¯´ "fails to cover"ï¼ˆæ²¡åŒ…å«ï¼‰æ˜¯é”™è¯¯çš„ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-6">ç¬¬ 25 é¢˜ï¼š[é€‰æ‹©é¢˜] å¯¹ Lee Hall æ–‡ç« çš„è¯„ä»·</h4>
<ul>
<li><strong>é¢˜å¹²å…³é”®è¯ (Keywords)</strong>ï¼š
<ul>
<li><code>Jack say</code></li>
<li><code>Lee Hall</code></li>
</ul>
</li>
<li><strong>åŸæ–‡åŒä¹‰æ›¿æ¢ (Paraphrasing)</strong>ï¼š
<ul>
<li><code>analysis of statistics</code> -&gt; <code>analysis of figures</code> (Sent 21)</li>
<li><code>thorough</code> -&gt; <code>detail</code> (Sent 21)</li>
</ul>
</li>
<li><strong>åŸæ–‡å®šä½ (Evidence)</strong>ï¼š
<ul>
<li><strong>Sentence 21</strong>: "His <code>analysis of figures</code> comparing the times of the fires and the proportion of seeds that germinated was done in <code>a lot of detail</code> - very impressive."</li>
</ul>
</li>
<li><strong>è§£æ &amp; é¿å‘æŒ‡å—</strong>ï¼š
<ul>
<li><strong>æ­£ç¡®ç­”æ¡ˆ B</strong>ï¼š<code>figures</code> æ˜¯ <code>statistics</code> çš„é«˜é¢‘åŒä¹‰è¯ï¼Œ<code>in a lot of detail</code> å¯¹åº” <code>thorough</code>ï¼ˆå½»åº•çš„/è¯¦å°½çš„ï¼‰ã€‚</li>
<li><strong>å¹²æ‰°é¡¹ A (diagrams/illustrations)</strong>ï¼š<strong>Sentence 22</strong> Emma é—®æ˜¯ä¸æ˜¯é‚£ç¯‡æœ‰æ’å›¾ï¼ˆillustrationsï¼‰çš„æ–‡ç« ï¼Œä½† Jack åœ¨ <strong>Sentence 23</strong> çº æ­£è¯´ "I think those diagrams were in <code>another article</code>"ã€‚å¬åˆ°å¦å®šé€»è¾‘ï¼ˆanother articleï¼‰è¦ç«‹åˆ»æ’é™¤ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-7">ç¬¬ 26 é¢˜ï¼š[åŒ¹é…/å¡«ç©º] ç§å­çš„é€‰æ‹©</h4>
<ul>
<li><strong>é¢˜å¹²å…³é”®è¯ (Keywords)</strong>ï¼š
<ul>
<li><code>Select seeds</code></li>
<li><code>different</code></li>
</ul>
</li>
<li><strong>åŸæ–‡åŒä¹‰æ›¿æ¢ (Paraphrasing)</strong>ï¼š
<ul>
<li><code>types</code> -&gt; <code>sorts</code> (Sent 25)</li>
</ul>
</li>
<li><strong>åŸæ–‡å®šä½ (Evidence)</strong>ï¼š
<ul>
<li><strong>Sentence 25</strong>: "So, how many <code>sorts</code> do we need? About four different ones?"</li>
</ul>
</li>
<li><strong>è§£æ &amp; é¿å‘æŒ‡å—</strong>ï¼š
<ul>
<li><strong>æ­£ç¡®ç­”æ¡ˆ G (types)</strong>ï¼šåŸæ–‡ç”¨äº† <code>sorts</code>ï¼Œè¿™æ˜¯ <code>types</code> çš„ç›´æ¥åŒä¹‰è¯ã€‚</li>
<li><strong>å¤‡è€ƒå»ºè®®</strong>ï¼šåœ¨å¬åˆ° vegetable seeds ä¹‹åï¼ŒJack é—®éœ€è¦å¤šå°‘ç§ <code>sorts</code>ï¼Œè¿™é‡Œè¦ååº”è¿‡æ¥æ˜¯æŒ‡ç§ç±»ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-8">ç¬¬ 27 é¢˜ï¼š[åŒ¹é…/å¡«ç©º] æµ‹é‡è®°å½•</h4>
<ul>
<li><strong>é¢˜å¹²å…³é”®è¯ (Keywords)</strong>ï¼š
<ul>
<li><code>Measure</code></li>
<li><code>record</code></li>
</ul>
</li>
<li><strong>åŸæ–‡åŒä¹‰æ›¿æ¢ (Paraphrasing)</strong>ï¼š
<ul>
<li><code>weight</code> -&gt; <code>weighs</code> (Sent 27)</li>
</ul>
</li>
<li><strong>åŸæ–‡å®šä½ (Evidence)</strong>ï¼š
<ul>
<li><strong>Sentence 27</strong>: "Then, for each seed we need to find out <code>how much it weighs</code>, and also measure its dimensions,"</li>
</ul>
</li>
<li><strong>è§£æ &amp; é¿å‘æŒ‡å—</strong>ï¼š
<ul>
<li><strong>æ­£ç¡®ç­”æ¡ˆ C (weight)</strong>ï¼šåŸæ–‡æ˜¯åŠ¨è¯ <code>weighs</code>ï¼Œé¢˜ç›®è¦æ±‚å¡«åè¯ï¼ˆæˆ–è€…é€‰å¯¹åº”çš„åè¯é€‰é¡¹ <code>weight</code>ï¼‰ã€‚è¿™æ˜¯å…¸å‹çš„è¯æ€§è½¬æ¢è€ƒç‚¹ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-9">ç¬¬ 28 é¢˜ï¼š[åŒ¹é…/å¡«ç©º] ç§æ¤æ·±åº¦</h4>
<ul>
<li><strong>é¢˜å¹²å…³é”®è¯ (Keywords)</strong>ï¼š
<ul>
<li><code>Decide on</code></li>
</ul>
</li>
<li><strong>åŸæ–‡åŒä¹‰æ›¿æ¢ (Paraphrasing)</strong>ï¼š
<ul>
<li><code>depths</code> -&gt; <code>how deep</code> (Sent 28)</li>
</ul>
</li>
<li><strong>åŸæ–‡å®šä½ (Evidence)</strong>ï¼š
<ul>
<li><strong>Sentence 28</strong>: "And we also need to decide <code>how deep</code> we're going to plant the seeds"</li>
</ul>
</li>
<li><strong>è§£æ &amp; é¿å‘æŒ‡å—</strong>ï¼š
<ul>
<li><strong>æ­£ç¡®ç­”æ¡ˆ H (depths)</strong>ï¼šåŸæ–‡ç”¨ <code>how deep</code> è¡¨è¾¾æ·±åº¦ï¼Œå¯¹åº”åè¯ <code>depths</code>ã€‚</li>
<li><strong>æ³¨æ„</strong>ï¼šç´§æ¥ç€åé¢åˆ—ä¸¾äº† "surface, a few millimetres down..." è¿™äº›éƒ½æ˜¯æ·±åº¦çš„å…·ä½“ä¾‹å­ï¼Œå¸®åŠ©ç¡®è®¤ç­”æ¡ˆã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-10">ç¬¬ 29 é¢˜ï¼š[åŒ¹é…/å¡«ç©º] å®¹å™¨é€‰æ‹©</h4>
<ul>
<li><strong>é¢˜å¹²å…³é”®è¯ (Keywords)</strong>ï¼š
<ul>
<li><code>Use a different</code></li>
<li><code>each seed</code></li>
</ul>
</li>
<li><strong>åŸæ–‡åŒä¹‰æ›¿æ¢ (Paraphrasing)</strong>ï¼š
<ul>
<li><code>container</code> -&gt; <code>plant pot</code> / <code>one</code> (Sent 29-30)</li>
</ul>
</li>
<li><strong>åŸæ–‡å®šä½ (Evidence)</strong>ï¼š
<ul>
<li><strong>Sentence 29</strong>: "Do you think we can plant several seeds together in the same <code>plant pot</code>?"</li>
<li><strong>Sentence 30</strong>: "No. I think we need a <code>different one</code> for each seed."</li>
</ul>
</li>
<li><strong>è§£æ &amp; é¿å‘æŒ‡å—</strong>ï¼š
<ul>
<li><strong>æ­£ç¡®ç­”æ¡ˆ A (container)</strong>ï¼šè¿™æ˜¯ä¸€ä¸ª<strong>ä¸Šä¹‰è¯å½’çº³</strong>ã€‚åŸæ–‡è¯´çš„æ˜¯å…·ä½“çš„ <code>plant pot</code>ï¼ˆèŠ±ç›†ï¼‰ï¼ŒEmma è¯´éœ€è¦ä¸åŒçš„ <code>one</code>ï¼ˆæŒ‡ä»£ potï¼‰ã€‚åœ¨é€‰é¡¹ä¸­ï¼Œåªæœ‰ <code>container</code>ï¼ˆå®¹å™¨ï¼‰å¯ä»¥æ¦‚æ‹¬èŠ±ç›†ã€‚</li>
<li><strong>5.5 åˆ†å¸¸è§ç—›ç‚¹</strong>ï¼šä¸€ç›´åœ¨ç­‰ exact wordï¼ˆåŸè¯ï¼‰ï¼Œä½†é›…æ€ 7 åˆ†è¦æ±‚èƒ½è¯†åˆ«ä¸Šä¸‹ä¹‰å…³ç³»ï¼ˆèŠ±ç›†=å®¹å™¨ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-11">ç¬¬ 30 é¢˜ï¼š[åŒ¹é…/å¡«ç©º] å®éªŒç»“æœè®°å½•</h4>
<ul>
<li><strong>é¢˜å¹²å…³é”®è¯ (Keywords)</strong>ï¼š
<ul>
<li><code>After about 3 weeks</code></li>
<li><code>record</code></li>
</ul>
</li>
<li><strong>åŸæ–‡åŒä¹‰æ›¿æ¢ (Paraphrasing)</strong>ï¼š
<ul>
<li><code>height</code> -&gt; <code>how tall</code> (Sent 32)</li>
</ul>
</li>
<li><strong>åŸæ–‡å®šä½ (Evidence)</strong>ï¼š
<ul>
<li><strong>Sentence 32</strong>: "Then we see if our plants have come up, and write down <code>how tall</code> they've grown."</li>
</ul>
</li>
<li><strong>è§£æ &amp; é¿å‘æŒ‡å—</strong>ï¼š
<ul>
<li><strong>æ­£ç¡®ç­”æ¡ˆ E (height)</strong>ï¼šåŸæ–‡ <code>how tall</code> å¯¹åº”åè¯ <code>height</code>ã€‚</li>
<li><strong>å®šä½æŠ€å·§</strong>ï¼šå¬åˆ° <code>three weeks</code> (Sent 32) æ—¶è¦é«˜åº¦è­¦è§‰ï¼Œç­”æ¡ˆç´§éšå…¶åã€‚æ³¨æ„ <code>write down</code> å’Œ <code>record</code> çš„æ›¿æ¢ã€‚</li>
</ul>
</li>
</ul>
<h2 data-id="heading-12">é›…æ€å¬åŠ›çœŸé¢˜è¯æ±‡ç²¾è®²ç¬”è®° (å‰‘é›…13 Test 1 Section 3)</h2>
<p>æœ¬ç¯‡ç¬”è®°æ•´ç†è‡ªå‰‘æ¡¥é›…æ€çœŸé¢˜ 13-1-3 <em>Seed Germination</em> ç›¸å…³çš„è¯æ±‡æ•™å­¦å¯¹è¯ã€‚é‡ç‚¹æ¶µç›–å­¦æœ¯åœºæ™¯æ ¸å¿ƒè¯è¾¨æã€æ˜“æ··æ·†æ‹¼å†™åŠå¬åŠ›é€»è¾‘ä¿¡å·è¯ã€‚</p>
<h3 data-id="heading-13">Dissertation vs Essay vs Thesisï¼šè®ºæ–‡ä¸‰å…„å¼Ÿ</h3>
<p>åœ¨é›…æ€å¬åŠ›å­¦æœ¯åœºæ™¯ä¸­ï¼Œè™½ç„¶éƒ½æŒ‡â€œè®ºæ–‡â€ï¼Œä½†æ ¹æ®ä½œä¸šæ€§è´¨å’Œç¯‡å¹…æœ‰æ˜æ˜¾åŒºåˆ«ã€‚</p>

























<table><thead><tr><th align="left">è¯æ±‡</th><th align="left">æ ¸å¿ƒå«ä¹‰</th><th align="left">é›…æ€å¬åŠ›åœºæ™¯ç‰¹å¾</th></tr></thead><tbody><tr><td align="left"><code>essay</code></td><td align="left">(è¯¾ç¨‹)çŸ­è®ºæ–‡</td><td align="left">é’ˆå¯¹å…·ä½“è¯¾ç¨‹ (Module) çš„ä½œä¸šï¼Œç¯‡å¹…çŸ­ï¼Œä¾§é‡è®ºè¯ã€‚</td></tr><tr><td align="left"><code>dissertation</code></td><td align="left">(å­¦ä½)é•¿è®ºæ–‡</td><td align="left">æœ¬ç§‘æˆ–ç¡•å£«æ¯•ä¸šè®ºæ–‡ï¼Œç¯‡å¹…é•¿ï¼Œéœ€å¤§é‡é˜…è¯»/ç ”ç©¶ã€‚</td></tr><tr><td align="left"><code>thesis</code></td><td align="left">(å­¦ä½)å¤§è®ºæ–‡</td><td align="left">å¸¸ä¸ <code>dissertation</code> äº’æ¢ï¼Œä¸¥è°¨è¯­å¢ƒä¸‹æŒ‡åšå£«è®ºæ–‡æˆ–æ ¸å¿ƒè®ºç‚¹ã€‚</td></tr></tbody></table>
<blockquote>
<p><strong>ğŸ’¡ æ‹¼å†™åŠ©è®°</strong>
<code>dissertation</code> åŒå†™ <code>ss</code>ã€‚
è®°å¿†é€»è¾‘ï¼šå†™è®ºæ–‡éœ€è¦å¤§é‡çš„è®¨è®º (<code>discuss</code>)ï¼Œ<code>discuss</code> æ˜¯åŒ <code>s</code>ï¼Œæ‰€ä»¥ <code>dissertation</code> ä¹Ÿæ˜¯åŒ <code>ss</code>ã€‚æ³¨æ„ä¸­é—´æ˜¯ <code>er</code> ä¸æ˜¯ <code>ar</code>ã€‚</p>
</blockquote>
<ul>
<li><strong>å®é™…åº”ç”¨</strong>ï¼šå¬åˆ° "final year project" æˆ– "degree" å¾€å¾€å¯¹åº” <code>dissertation</code>ï¼›å¬åˆ° "term paper" å¾€å¾€å¯¹åº” <code>essay</code>ã€‚</li>
</ul>
<h3 data-id="heading-14">Dissertation / Dessert / Desertï¼šS çš„æ•°é‡é€»è¾‘</h3>
<p>è¿™ç»„è¯æ±‡æ˜¯æ‹¼å†™å’Œå¬éŸ³çš„é‡ç¾åŒºï¼Œé€šè¿‡é€»è¾‘è”æƒ³è®°å¿†æœ€ä¸ºç¨³å›ºã€‚</p>





























<table><thead><tr><th align="left">è¯æ±‡</th><th align="left">å«ä¹‰</th><th align="left">æ‹¼å†™ç‰¹å¾</th><th align="left">åŠ©è®°æ³• (Memory Hook)</th></tr></thead><tbody><tr><td align="left"><code>dissertation</code></td><td align="left">è®ºæ–‡</td><td align="left">åŒ <code>ss</code></td><td align="left">éœ€è¦ <code>discuss</code> (è®¨è®º)</td></tr><tr><td align="left"><code>dessert</code></td><td align="left">ç”œç‚¹</td><td align="left">åŒ <code>ss</code></td><td align="left">æƒ³åƒ<strong>ä¸¤ä»½</strong> (Two <strong>S</strong>ervings) / <strong>S</strong>uper <strong>S</strong>weet</td></tr><tr><td align="left"><code>desert</code></td><td align="left">æ²™æ¼ </td><td align="left">å• <code>s</code></td><td align="left">æ²™æ¼ è´«ç˜ ï¼Œåªæœ‰<strong>ä¸€ç²’æ²™</strong> (One <strong>S</strong>and)</td></tr></tbody></table>
<ul>
<li><strong>å®é™…åº”ç”¨</strong>ï¼š
<ul>
<li>"I'm worried about my <strong>dissertation</strong> word count." (è®ºæ–‡)</li>
<li>"We ordered a chocolate <strong>dessert</strong>." (ç”œç‚¹)</li>
</ul>
</li>
</ul>
<h3 data-id="heading-15">Eventuallyï¼šå¬åŠ›é€»è¾‘è·¯æ ‡</h3>
<p>è¿™æ˜¯é›…æ€å¬åŠ›ä¸­çš„<strong>ä¿¡å·è¯ (Signpost Word)</strong>ï¼Œç”¨äºæŒ‡ç¤ºâ€œæœ€ç»ˆå†³å®šâ€ï¼Œé€šå¸¸ä¼´éšç€å¯¹ä¹‹å‰è®¡åˆ’çš„å¦å®šã€‚</p>
<ul>
<li><strong>å¬åŠ›é™·é˜±å…¬å¼</strong>ï¼š
Plan A (å¹²æ‰°é¡¹) + But / However + <code>eventually</code> + Plan B (<strong>æ­£ç¡®ç­”æ¡ˆ</strong>)</li>
</ul>
<blockquote>
<p><strong>ğŸ’¡ å¬é¢˜æŠ€å·§</strong>
å¬åˆ° <code>eventually</code>ã€<code>finally</code> æˆ– <code>in the end</code> æ—¶ï¼Œè¯·å¿½ç•¥å‰é¢çš„å†…å®¹ï¼Œç­”æ¡ˆå°±åœ¨è¿™ä¸€å¥ä¹‹åã€‚(æœ¬ç¯‡ä¾‹å¤–)</p>
</blockquote>
<ul>
<li><strong>å®é™…åº”ç”¨</strong>ï¼š
<ul>
<li>å½•éŸ³ï¼š"At first we thought about Consumer Behavior, but <strong>eventually</strong> we realized <code>Market Research</code> would be more relevant."</li>
<li>ç­”æ¡ˆï¼š<code>Market Research</code> (Consumer Behavior æ˜¯å¹²æ‰°é¡¹)ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-16">Figureï¼šä¸€è¯å¤šä¹‰çš„å˜è‰²é¾™</h3>
<p>è¯¥è¯åœ¨å¬åŠ›ä¸åŒ Section ä¸­æœ‰å®Œå…¨ä¸åŒçš„è€ƒç‚¹ã€‚</p>






























<table><thead><tr><th align="left">å«ä¹‰</th><th align="left">å¸¸è§åœºæ™¯</th><th align="left">å…¸å‹ä¾‹å¥</th></tr></thead><tbody><tr><td align="left"><strong>æ•°å­—</strong></td><td align="left">S1 / S4</td><td align="left">"Look at the sales <code>figures</code>." (åŒ <code>number</code>)</td></tr><tr><td align="left"><strong>å›¾è¡¨</strong></td><td align="left">S3 / é˜…è¯»</td><td align="left">"Refer to <code>Figure</code> 2 on page 5." (åŒ <code>chart</code>/<code>diagram</code>)</td></tr><tr><td align="left"><strong>äººç‰©</strong></td><td align="left">å†å²/ä¼ è®°</td><td align="left">"A key historical <code>figure</code>."</td></tr><tr><td align="left"><strong>è®¤ä¸º/æƒ³å‡º</strong></td><td align="left">å£è¯­/åŠ¨è¯</td><td align="left">"<code>Figure out</code> the problem."</td></tr></tbody></table>
<ul>
<li><strong>å®é™…åº”ç”¨</strong>ï¼š
<ul>
<li>"His analysis of <code>figures</code>..." (æ­¤å¤„æŒ‡å¯¹æ•°æ®çš„åˆ†æ)</li>
<li>"Please look at the <code>figure</code> on the screen." (æ­¤å¤„æŒ‡å›¾è¡¨)</li>
</ul>
</li>
</ul>
<h3 data-id="heading-17">Theoretical vs Practicalï¼šå­¦æœ¯å¯¹ç«‹é¢</h3>
<p>é›…æ€å¬åŠ› Section 3 å¸¸è€ƒçš„ä¸€å¯¹åä¹‰è¯ã€‚</p>
<ul>
<li><code>theoretical</code>ï¼šç†è®ºçš„ (æ³¨é‡ Theory)</li>
<li><code>practical</code>ï¼šå®è·µçš„ (æ³¨é‡ Practice)</li>
</ul>
<blockquote>
<p><strong>ğŸ’¡ æ‹¼å†™/å¬è¾¨æç¤º</strong></p>
<ul>
<li><code>theoretical</code>ï¼šæ³¨æ„ä¸­é—´çš„ <code>o</code> (The-<strong>o</strong>-ret-ical)ã€‚</li>
<li><code>practical</code>ï¼šæ³¨æ„ä¸­é—´æœ‰ <code>c</code> (Prac-ti-cal)ï¼Œåˆ‡å‹¿æ‹¼æˆ praticalã€‚</li>
</ul>
</blockquote>
<ul>
<li><strong>å®é™…åº”ç”¨</strong>ï¼š
<ul>
<li>Student: "The course was too <code>theoretical</code>; I wish we had done more <code>practical</code> work."</li>
</ul>
</li>
</ul>
<h3 data-id="heading-18">Irrelevantï¼šå¦å®šçš„å‰ç¼€é™·é˜±</h3>
<p>è¡¨ç¤ºâ€œä¸ç›¸å…³çš„â€ã€â€œä¸åˆ‡é¢˜çš„â€ã€‚</p>
<ul>
<li><strong>æ„è¯</strong>ï¼šPrefix <code>ir-</code> (å¦å®š) + <code>relevant</code>ã€‚</li>
<li><strong>é‡éŸ³</strong>ï¼šè½åœ¨ç¬¬äºŒä¸ªéŸ³èŠ‚ /ÉªËˆ<strong>re</strong>lÉ™vÉ™nt/ã€‚</li>
<li><strong>åŒä¹‰æ›¿æ¢</strong>ï¼šå¬åŠ›ä¸­å¬åˆ° "nothing to do with" æˆ– "unrelated" æ—¶ï¼Œå³å¯¹åº” <code>irrelevant</code>ã€‚</li>
</ul>
<h3 data-id="heading-19">Feed intoï¼šåœ°é“åŠ¨è¯çŸ­è¯­</h3>
<ul>
<li>
<p><strong>å­—é¢ä¹‰</strong>ï¼š(æ²³æµ) æµå…¥ã€‚</p>
</li>
<li>
<p><strong>æŠ½è±¡ä¹‰</strong>ï¼š(ä¸º...) æä¾›èµ„æº / å¯¹...äº§ç”Ÿå½±å“ / è½¬åŒ–ä¸ºã€‚</p>
</li>
<li>
<p><strong>å®é™…åº”ç”¨</strong>ï¼š</p>
<ul>
<li>"Practically everything we do is going to <code>feed into</code> that." (æˆ‘ä»¬åšçš„æ¯ä»¶äº‹æœ€ç»ˆéƒ½ä¼š<strong>åŠ©ç›Š</strong>äºé‚£ä¸ªç›®æ ‡ã€‚)</li>
<li>æ›¿æ¢è¯ï¼š<code>contribute to</code>, <code>influence</code>ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-20">Laboratory &amp; Analysisï¼šæ‹¼å†™â€œæ‰‹æœ¯å°â€</h3>
<p>è¿™ä¸¤ä¸ªè¯æ˜¯å…¸å‹çš„â€œå¬å¾—æ‡‚ã€å†™ä¸å¯¹â€é«˜å±è¯ã€‚</p>
<p><strong>1. <code>laboratory</code> (å®éªŒå®¤)</strong></p>
<ul>
<li><strong>é™·é˜±</strong>ï¼šè‹±éŸ³å¸¸åæ‰ä¸­é—´çš„ <code>o</code> (/lÉ™ËˆbÉ’rÉ™tri/)ï¼Œå¯¼è‡´æ¼å†™ã€‚</li>
<li><strong>åŠ©è®°</strong>ï¼š<code>labor</code> (åŠ³åŠ¨) + a + <code>tory</code> (åœºæ‰€) â†’ å®éªŒå®¤æ˜¯<strong>åŠ³åŠ¨</strong>çš„åœ°æ–¹ã€‚</li>
</ul>
<p><strong>2. <code>analysis</code> (åˆ†æ)</strong></p>
<ul>
<li>
<p><strong>é™·é˜±</strong>ï¼šä¸­é—´æ˜¯ <code>y</code> ä¸æ˜¯ <code>i</code>ï¼›å•å¤æ•°å˜åŒ–ã€‚</p>
</li>
<li>
<p><strong>å˜å½¢è§„åˆ™</strong>ï¼š</p>
<ul>
<li>å•æ•°ï¼š<code>analysis</code> (ç»“å°¾ <code>is</code> â†’ 1)</li>
<li>å¤æ•°ï¼š<code>analyses</code> (ç»“å°¾ <code>es</code> â†’ å¤šï¼Œå‘éŸ³ /siËz/)</li>
</ul>
</li>
<li>
<p><strong>å®é™…åº”ç”¨</strong>ï¼š</p>
<ul>
<li>"We need plenty of equipment in the <code>laboratory</code>."</li>
<li>"His <code>analysis</code> of the data was impressive."</li>
</ul>
</li>
</ul>
<h3 data-id="heading-21">Bonusï¼šå¬åŠ›åŸæ–‡åœ°é“è¡¨è¾¾ (Collocations)</h3>
<p>æºè‡ªå‰‘é›… 13-1-3 åŸæ–‡çš„åœ°é“å£è¯­çŸ­è¯­ã€‚</p>

























<table><thead><tr><th align="left">çŸ­è¯­</th><th align="left">å«ä¹‰</th><th align="left">å¬åŠ›è€ƒç‚¹/åŒä¹‰æ›¿æ¢</th></tr></thead><tbody><tr><td align="left"><code>come up</code></td><td align="left">(ç§å­)å‘èŠ½ï¼Œé•¿å‡º</td><td align="left">å¯¹åº” <code>germinate</code> / <code>grow</code></td></tr><tr><td align="left"><code>have a word with</code></td><td align="left">å’Œ...è°ˆè°ˆ/å•†é‡</td><td align="left">å¯¹åº” <code>consult</code> / <code>speak to</code></td></tr><tr><td align="left"><code>get going with</code></td><td align="left">å¼€å§‹åš...</td><td align="left">å¯¹åº” <code>start</code></td></tr></tbody></table>
<h3 data-id="heading-22">ğŸŒŸ é›…æ€å­¦æœ¯ç»ˆæä¾‹å¥ (The Ultimate Sentence)</h3>
<blockquote>
<p>"After excluding the irrelevant figures from our laboratory analysis, we realized that the remaining data would eventually feed into the theoretical section of my dissertation."</p>
</blockquote>
<p><strong>ğŸ“ ä¸­æ–‡è¯‘æ–‡</strong></p>
<p>â€œåœ¨æ’é™¤äº†æˆ‘ä»¬å®éªŒå®¤åˆ†æä¸­é‚£äº›ä¸ç›¸å…³çš„å›¾è¡¨/æ•°æ®åï¼Œæˆ‘ä»¬æ„è¯†åˆ°å‰©ä¸‹çš„æ•°æ®æœ€ç»ˆå°†æ±‡å…¥ï¼ˆåŠ©ç›Šäºï¼‰æˆ‘å­¦ä½è®ºæ–‡ä¸­çš„ç†è®ºéƒ¨åˆ†ã€‚â€</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä½¿ç”¨ Groq ä¸ Elasticsearch è¿›è¡Œæ™ºèƒ½æŸ¥è¯¢]]></title>    <link>https://juejin.cn/post/7603561363571654719</link>    <guid>https://juejin.cn/post/7603561363571654719</guid>    <pubDate>2026-02-06T22:44:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603561363571654719" data-draft-id="7603563317040709695" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä½¿ç”¨ Groq ä¸ Elasticsearch è¿›è¡Œæ™ºèƒ½æŸ¥è¯¢"/> <meta itemprop="keywords" content="Elasticsearch"/> <meta itemprop="datePublished" content="2026-02-06T22:44:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Elasticsearch"/> <meta itemprop="url" content="https://juejin.cn/user/2612095360441448"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä½¿ç”¨ Groq ä¸ Elasticsearch è¿›è¡Œæ™ºèƒ½æŸ¥è¯¢
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2612095360441448/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Elasticsearch
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T22:44:01.000Z" title="Fri Feb 06 2026 22:44:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½œè€…ï¼šæ¥è‡ª ElasticÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fauthor%2Fmark-puddick" title="https://www.elastic.co/search-labs/author/mark-puddick" target="_blank" ref="nofollow noopener noreferrer">Mark Puddick</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f19c6c7115454bf4bb74fea10cc0210c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=91BIePLGwKrfSaNrlOSKOcA61p0%3D" alt="" loading="lazy"/></p>
<p>å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Groq ä¸ Elasticsearch åœ¨æ¯«ç§’çº§è¿è¡Œ LLM æŸ¥è¯¢å’Œè‡ªç„¶è¯­è¨€æœç´¢ã€‚</p>
<p>Elasticsearch å…·æœ‰ä¸è¡Œä¸šé¢†å…ˆçš„ Gen AI å·¥å…·å’Œæä¾›å•†çš„åŸç”Ÿé›†æˆã€‚æŸ¥çœ‹æˆ‘ä»¬å…³äº<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fvirtual-events%2Fbeyond-rag-basics" title="https://www.elastic.co/virtual-events/beyond-rag-basics" target="_blank" ref="nofollow noopener noreferrer">è¶…è¶Š RAG åŸºç¡€</a>çš„ç½‘ç»œç ”è®¨ä¼šï¼Œæˆ–æ„å»ºç”Ÿäº§å°±ç»ªçš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fvirtual-events%2Fvector-databases-fast-track-production" title="https://www.elastic.co/virtual-events/vector-databases-fast-track-production" target="_blank" ref="nofollow noopener noreferrer">Elastic Vector Database</a> åº”ç”¨ã€‚</p>
<p>ä¸ºäº†ä¸ºä½ çš„ä½¿ç”¨åœºæ™¯æ„å»ºæœ€ä½³æœç´¢è§£å†³æ–¹æ¡ˆï¼Œç°åœ¨å°±å¼€å§‹<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.elastic.co%2Fregistration%3Fonboarding_token%3Dsearch%26cta%3Dcloudregistration%26tech%3Dtrial%26plcmt%3Dcross%2520module%26pg%3Dsearch-labs" title="https://cloud.elastic.co/registration?onboarding_token=search&amp;cta=cloudregistration&amp;tech=trial&amp;plcmt=cross%20module&amp;pg=search-labs" target="_blank" ref="nofollow noopener noreferrer">å…è´¹äº‘è¯•ç”¨</a>ï¼Œæˆ–åœ¨ä½ çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F143747798" title="https://elasticstack.blog.csdn.net/article/details/143747798" target="_blank" ref="nofollow noopener noreferrer">æœ¬åœ°æœºå™¨</a>ä¸Šå°è¯• Elasticã€‚</p>
<hr/>
<p>åœ¨å°†å¤§è¯­è¨€æ¨¡å‹ï¼ˆ LLMs ï¼‰ä¸ Elastic ç»“åˆä½¿ç”¨æ—¶ï¼Œå…¶ä¸­ä¸€ä¸ªæŒ‘æˆ˜æ˜¯æˆ‘ä»¬é€šå¸¸éœ€è¦éå¸¸å¿«çš„ç»“æœã€‚Elastic åœ¨æä¾›æ¯«ç§’çº§å“åº”æ—¶é—´æ–¹é¢æ²¡æœ‰é—®é¢˜ã€‚ç„¶è€Œï¼Œå½“æˆ‘ä»¬å¼•å…¥ <a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F134747557" title="https://elasticstack.blog.csdn.net/article/details/134747557" target="_blank" ref="nofollow noopener noreferrer">LLM</a> è°ƒç”¨æ—¶ï¼Œæ€§èƒ½å¯èƒ½ä¼šä¸‹é™åˆ°ä¸å¯æ¥å—çš„æ°´å¹³ã€‚è¿™æ­£æ˜¯ä½¿ç”¨ Groq çš„ç¡¬ä»¶<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fexplore-analyze%2Felastic-inference" title="https://www.elastic.co/docs/explore-analyze/elastic-inference" target="_blank" ref="nofollow noopener noreferrer">æ¨ç†</a>åœ¨å°† Elastic ä¸ LLM ç»“åˆæ—¶å¯ä»¥æå¤§æå‡ç»“æœé€Ÿåº¦çš„åœ°æ–¹ã€‚</p>
<p>Groq æ˜¯ä¸€å®¶ä¸“æ³¨äºåœ¨è§„æ¨¡åŒ–åœºæ™¯ä¸‹æä¾›è¶…ä½å»¶è¿Ÿã€ç¡®å®šæ€§ AI æ¨ç†çš„ç¡¬ä»¶å’Œè½¯ä»¶å…¬å¸ã€‚å…¶æ ¸å¿ƒåˆ›æ–°æ˜¯ Groq Language Processing Unitï¼ˆ LPU ï¼‰æ¨ç†å¼•æ“ï¼Œè¿™æ˜¯ä¸€ç§ä¸“é—¨ä¸ºä»¥æé«˜é€Ÿåº¦è¿è¡Œ LLMs å¹¶ä¿æŒå¯é¢„æµ‹æ€§èƒ½è€Œå®šåˆ¶è®¾è®¡çš„èŠ¯ç‰‡æ¶æ„ã€‚ä¸‹é¢çš„é“¾æ¥æä¾›äº†å¯¹ Groq æ¶æ„æ›´è¯¦ç»†çš„æ¦‚è¿°ã€‚</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgroq.com%2Flpu-architecture" title="https://groq.com/lpu-architecture" target="_blank" ref="nofollow noopener noreferrer">Groqï¼š ä»‹ç» LPU</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgroq.com%2Fblog%2Fartificialanalysis-ai-llm-benchmark-doubles-axis-to-fit-new-groq-lpu-inference-engine-performance-results" title="https://groq.com/blog/artificialanalysis-ai-llm-benchmark-doubles-axis-to-fit-new-groq-lpu-inference-engine-performance-results" target="_blank" ref="nofollow noopener noreferrer">Groqï¼š æ–°çš„ LLM æ¨ç†åŸºå‡†</a></li>
</ul>
<p>ä¸ä¼ ç»ŸåŸºäº GPU çš„ç³»ç»Ÿä¸åŒï¼ŒGroq é¢å‘æ¨ç†çš„ä¸“ç”¨æ¶æ„å¯ä»¥ä»¥ç©ºå‰çš„ååé‡å¤„ç† tokenï¼ŒåŒæ—¶å“åº”æ—¶é—´çš„æ³¢åŠ¨æå°ã€‚è¿™ç›´æ¥è§£å†³äº†é€šå¸¸ä¼šæ‹–æ…¢ä¼ ç»Ÿ LLM è°ƒç”¨çš„å†…å­˜å¸¦å®½ç“¶é¢ˆå’Œè°ƒåº¦å¼€é”€ï¼Œç¡®ä¿å°† LLM ä¸ Elastic çš„æœç´¢ç»“æœé›†æˆæ—¶ä»èƒ½ä¿æŒå®æ—¶çš„ç”¨æˆ·ä½“éªŒã€‚Groq é€šè¿‡ GroqCloud æä¾›è¿™ç§è¡Œä¸šé¢†å…ˆçš„é€Ÿåº¦å’Œæ€§èƒ½ï¼ŒGroqCloud æ˜¯ä¸€ä¸ªæ˜“äºä½¿ç”¨çš„ tokens-as-a-service å¹³å°ï¼Œå¹¶ä¸”é€šå¸¸å…·æœ‰æœ€ä½³çš„æ€§èƒ½ä»·æ ¼æ¯”ã€‚</p>
<p>è®©æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªå¸¸è§çš„æ™ºèƒ½æŸ¥è¯¢å±‚è¯·æ±‚æ¨¡å¼ï¼Œä»¥åŠæˆ‘ä»¬å¯ä»¥ä»ä¸­è·å¾—å“ªäº›æ”¹è¿›ã€‚</p>
<h2 data-id="heading-0">è‡ªç„¶è¯­è¨€æœç´¢</h2>
<p>è‡ªä» LLMs å¹¿æ³›åº”ç”¨ä»¥æ¥ï¼Œä¸€ä¸ªå¸¸è§çš„æœç´¢éœ€æ±‚æ˜¯èƒ½å¤Ÿä½¿ç”¨è‡ªç„¶è¯­è¨€è¿›è¡Œç‰¹å®šé¢†åŸŸæœç´¢ã€‚ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ³•æ˜¯åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F134396254" title="https://elasticstack.blog.csdn.net/article/details/134396254" target="_blank" ref="nofollow noopener noreferrer">RAG</a>ï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰å·¥ä½œæµä¸­è¿›è¡Œç®€å•çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F145485873" title="https://elasticstack.blog.csdn.net/article/details/145485873" target="_blank" ref="nofollow noopener noreferrer">è¯­ä¹‰æœç´¢</a>ï¼›ç„¶è€Œï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™å¹¶ä¸èƒ½æä¾›ç†æƒ³çš„ç»“æœã€‚è¿™ä¸»è¦æ˜¯å› ä¸ºé—®é¢˜ä¸­å­˜åœ¨éœ€è¦è½¬æ¢ä¸ºæŸ¥è¯¢è¯çš„ç‰¹å®šå±æ€§ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥è®© LLM ç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œçš„æŸ¥è¯¢ã€‚ç„¶è€Œï¼Œè¿™ä»ç„¶å­˜åœ¨å¾ˆå¤§é”™è¯¯ç©ºé—´ã€‚æœ€ç»ˆï¼Œæˆ‘ä»¬å‘ç°ä¸ºå·¥å…·æä¾›ç‰¹å®šé¢†åŸŸçš„å‚æ•°å¹¶ä¸ LLM é…åˆä½¿ç”¨å¯ä»¥å¾—åˆ°æœ€ä½³ç»“æœã€‚æ›´å¤šä¿¡æ¯è¯·å‚è§<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F151350072" title="https://elasticstack.blog.csdn.net/article/details/151350072" target="_blank" ref="nofollow noopener noreferrer">è¿™ç¯‡åšå®¢</a>ã€‚</p>
<p>ä¸ºäº†å®šä¹‰ agentï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹ promptï¼š</p>
<pre><code class="hljs language-sql" lang="sql">`

<span class="hljs-number">1.</span>  You <span class="hljs-keyword">are</span> a helpful banking transaction agent. You help users <span class="hljs-keyword">search</span> <span class="hljs-keyword">and</span> analyze their banking transactions.

<span class="hljs-number">3.</span>  <span class="hljs-keyword">Current</span> <span class="hljs-type">date</span>: {<span class="hljs-built_in">current_date</span>}

<span class="hljs-number">5.</span>  <span class="hljs-keyword">When</span> users ask about transactions, use the appropriate tools:
<span class="hljs-number">6.</span>  <span class="hljs-operator">-</span> Use trans<span class="hljs-operator">-</span><span class="hljs-keyword">search</span> <span class="hljs-keyword">for</span> finding <span class="hljs-keyword">specific</span> transactions

<span class="hljs-number">8.</span>  <span class="hljs-keyword">For</span> <span class="hljs-type">date</span> <span class="hljs-keyword">references</span>:
<span class="hljs-number">9.</span>  <span class="hljs-operator">-</span> "last month" <span class="hljs-operator">=</span> past <span class="hljs-number">30</span> days <span class="hljs-keyword">from</span> today
<span class="hljs-number">10.</span>  <span class="hljs-operator">-</span> "this month" <span class="hljs-operator">=</span> <span class="hljs-keyword">current</span> <span class="hljs-keyword">month</span> <span class="hljs-keyword">from</span> <span class="hljs-number">1</span>st <span class="hljs-keyword">to</span> today
<span class="hljs-number">11.</span>  <span class="hljs-operator">-</span> "last week" <span class="hljs-operator">=</span> past <span class="hljs-number">7</span> days
<span class="hljs-number">12.</span>  <span class="hljs-operator">-</span> "this year" <span class="hljs-operator">=</span> January <span class="hljs-number">1</span>st <span class="hljs-keyword">of</span> <span class="hljs-keyword">current</span> <span class="hljs-keyword">year</span> <span class="hljs-keyword">to</span> today

<span class="hljs-number">14.</span>  <span class="hljs-keyword">By</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">set</span> the make the <span class="hljs-keyword">to</span> <span class="hljs-type">date</span> today <span class="hljs-keyword">and</span> the <span class="hljs-keyword">from</span> <span class="hljs-type">date</span> <span class="hljs-number">1</span> <span class="hljs-keyword">year</span> ago
<span class="hljs-number">15.</span>  Common categories: groceries, dining, gas, shopping, entertainment, utilities, healthcare, transportation, travel, subscriptions, insurance, phone, internet

`AIå†™ä»£ç <span class="hljs-operator">!</span>[](https:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>csdnimg.cn<span class="hljs-operator">/</span><span class="hljs-keyword">release</span><span class="hljs-operator">/</span>blogv2<span class="hljs-operator">/</span>dist<span class="hljs-operator">/</span>pc<span class="hljs-operator">/</span>img<span class="hljs-operator">/</span>runCode<span class="hljs-operator">/</span>icon<span class="hljs-operator">-</span>arrowwhite.png)
</code></pre>
<p>ä¾‹å¦‚ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d0237c1c76c4b96822a9c818a51c867~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=WvlofFa1I%2FlBRUlu4NkBInWQuZE%3D" alt="" loading="lazy"/></p>
<p>è¿™ç»™æˆ‘ä»¬å¸¦æ¥äº†ä¸é”™çš„ç»“æœï¼Œä½†ç”±äº LLM è°ƒç”¨ï¼Œæˆ‘ä»¬çš„æœç´¢æ—¶é—´ä»ä¸åˆ° 100ms å¢åŠ åˆ°è¶…è¿‡ 1 ç§’ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Groq çš„ç¡¬ä»¶æ¨ç†åœ¨æ›´çŸ­çš„æ—¶é—´å†…è¿è¡Œæ­¤æŸ¥è¯¢ã€‚è¦è¿è¡Œè¿™ä¸ªç¤ºä¾‹ï¼Œä½ éœ€è¦<a href="https://link.juejin.cn?target=https%3A%2F%2Fconsole.groq.com%2Fhome" title="https://console.groq.com/home" target="_blank" ref="nofollow noopener noreferrer">æ³¨å†Œä¸€ä¸ª Groq è´¦æˆ·</a>ã€‚</p>
<p>ç„¶åä½ å¯ä»¥ä»å³ä¸Šè§’èœå•ç”Ÿæˆä¸€ä¸ª API keyï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46151d89654c4dc5bc3765adba479f0a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=dTyZAtfHHVgExbiL%2Fmc4sw70h3M%3D" alt="" loading="lazy"/></p>
<p>æˆ‘ä»¬åœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmarkpudd%2Ftransaction_search_mcp" title="https://github.com/markpudd/transaction_search_mcp" target="_blank" ref="nofollow noopener noreferrer">è¿™é‡Œ</a>åˆ›å»ºäº†è¿™ä¸ªå·¥å…·ï¼Œä»¥ä¾¿èƒ½å¤Ÿæ‰§è¡Œæœç´¢ã€‚</p>
<p>å…‹éš†ä¸Šè¿° repo åï¼Œä½ éœ€è¦æ›´æ–° .env æŒ‡å‘ Groqï¼š</p>
<pre><code class="hljs language-ini" lang="ini">`

<span class="hljs-attr">1.  OPENAI_API_KEY</span>=gsk-........

<span class="hljs-attr">3.  OPENAI_API_BASE</span>=https://api.groq.com/openai/v1

<span class="hljs-attr">5.  OPENAI_MODEL</span>=openai/gpt-oss-<span class="hljs-number">20</span>b

`AIå†™ä»£ç 
</code></pre>
<p>æˆ‘ä»¬ä½¿ç”¨äº† 20b gpt-oss æ¨¡å‹ï¼Œå› ä¸ºè¿™å¯ä»¥æä¾›å‡†ç¡®çš„ç»“æœã€‚å¯¹äºè¿™ç§ç±»å‹çš„è§£å†³æ–¹æ¡ˆï¼Œä½¿ç”¨æ›´å¤§çš„æ¨¡å‹å‡ ä¹æ²¡æœ‰ä»»ä½•æ”¶ç›Šã€‚</p>
<p>ç°åœ¨ï¼Œä»æµ‹è¯•æƒ…å†µæ¥çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•çš„ UI ä½¿ç”¨ prompt è°ƒç”¨è¯¥å·¥å…·è¿è¡Œï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc52397e442a4a54b93648920122c95b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=F1GDS332%2FIlUBYmy%2FICZfjhnIjE%3D" alt="" loading="lazy"/></p>
<p>ä¸ºäº†æµ‹è¯•æ—¶é—´ï¼Œæˆ‘ä»¬å°†è¿è¡Œè¯¥å·¥å…· 50 æ¬¡ï¼Œå¹¶è®¡ç®—æ€»å“åº”ã€LLM å’Œ Groq çš„å¹³å‡å€¼ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ ChatGPT-4.1-nano å’Œ Groq OSS-20b æ¨¡å‹ã€‚ä»¥ä¸‹æ˜¯æ­¤æ¬¡æµ‹è¯•çš„ç»“æœï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a18dc07e089843279e2f19eff9f1e7ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=S7H%2F1rht2YY9ZWAlUDKmv1IJiH4%3D" alt="" loading="lazy"/></p>
<p>æ˜¾ç„¶ï¼Œé€šè¿‡ä½¿ç”¨ Groq çš„ç¡¬ä»¶æ¨ç†ï¼Œæˆ‘ä»¬å¯ä»¥å°†å¤§çº¦ä¸€ç§’çš„å»¶è¿Ÿé™ä½ã€‚æˆ‘ä»¬è¿˜ä½¿ç”¨äº†ä¸€ä¸ªè¾ƒå°çš„æ¨¡å‹ï¼Œå¯¹äºè¿™ä¸ªä½¿ç”¨åœºæ™¯ï¼Œå®ƒä»ç„¶æä¾›äº†è‰¯å¥½çš„ç»“æœã€‚å°†å“åº”æ—¶é—´ä» 1.5 ç§’é™ä½åˆ° 250ms åï¼Œé€šå¸¸å¯ä»¥æ»¡è¶³è®¸å¤šç»„ç»‡çš„æœåŠ¡ç­‰çº§åè®®ï¼ˆSLAï¼‰è¦æ±‚ã€‚</p>
<h2 data-id="heading-1">Elastic Agent Builder</h2>
<p>æˆ‘ä»¬å·²ç»å±•ç¤ºäº†è¿™ä¸ä»…å¯ä»¥ç”¨æ¥åŠ é€Ÿ Elastic çš„è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fexplore-analyze%2Fmachine-learning%2Fnlp%2Fml-nlp-overview" title="https://www.elastic.co/docs/explore-analyze/machine-learning/nlp/ml-nlp-overview" target="_blank" ref="nofollow noopener noreferrer">NLP</a>ï¼‰æœç´¢ï¼Œè¿˜å¯ä»¥ç”¨æ¥åŠ é€Ÿ Elastic <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Felasticsearch%2Fagent-builder" title="https://www.elastic.co/elasticsearch/agent-builder" target="_blank" ref="nofollow noopener noreferrer">Agent Builder</a>ã€‚Agent Builder æœ€è¿‘å‘å¸ƒäº†æŠ€æœ¯é¢„è§ˆç‰ˆï¼Œç°åœ¨å¯ä»¥é€šè¿‡ Groq ç«¯ç‚¹è¿æ¥ Groqã€‚Agent Builder åœ¨ Elastic 9.1+ å¯ç”¨ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¹‹å‰ä½¿ç”¨çš„ç›¸åŒ API keyã€‚</p>
<p>ä»¥ä¸‹æ˜¯è®¾ç½®æ–¹æ³•ï¼š<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20f784c300444a039cae542551d60820~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=1dmI7sKrHCe8oIycspQJYtW2%2FpE%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd5b507aedc84e33a98c73f48c7a3f5a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=bJ7%2BluLhV0eWqEmqmZ7CiJFZuag%3D" alt="" loading="lazy"/></p>
<p>å¦‚æœä½ ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fcloud%2Fserverless" title="https://www.elastic.co/cloud/serverless" target="_blank" ref="nofollow noopener noreferrer">serverless</a>ï¼Œä½ éœ€è¦ä» Stack Management Connectors é¡µé¢åˆ›å»ºä¸€ä¸ªæ–°çš„ connectorã€‚é¦–å…ˆï¼Œç‚¹å‡» AI Connectorã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f934a9f3582a4def9117f13c98aaa981~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=w8IfXWJo8APQLgf60erLM0kUwZs%3D" alt="" loading="lazy"/></p>
<p>åœ¨ä¸‹ä¸€ä¸ªç•Œé¢ï¼Œé€‰æ‹© Groq ä½œä¸ºæœåŠ¡ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa1f4ac933ef4ba2a0e447fbd2a46538~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=KSaaGic3zRBNI%2Fh0LXznDxLhCcU%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97fa7639ed394809bd7b8ddafbac3732~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=ZJHmSYPRHoUevi7S7EZmOjzEkTU%3D" alt="" loading="lazy"/></p>
<p>ç„¶åä½ å¯ä»¥è®¾ç½®è¦ä½¿ç”¨çš„æ¨¡å‹ã€‚æ”¯æŒçš„æ¨¡å‹åˆ—åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fconsole.groq.com%2Fdocs%2Fmodels" title="https://console.groq.com/docs/models" target="_blank" ref="nofollow noopener noreferrer">Groq ç½‘ç«™</a>ä¸Šã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce4e0c0d0e5144f48c6a588527724072~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=uoF4sGEyakcjg9v9kFVT7g3y4io%3D" alt="" loading="lazy"/></p>
<p>å¦‚æœä½ éœ€è¦æ·»åŠ ä½ çš„ organization IDï¼Œå¯ä»¥åœ¨ <strong>Settings</strong> ä¸‹å±•å¼€ <strong>More options</strong> æ·»åŠ ã€‚</p>
<p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯æ‰˜ç®¡ç‰ˆ Elasticï¼Œåœ¨æœ¬æ–‡æ’°å†™æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ Groq ä¸Šä¸ OpenAI å…¼å®¹çš„ç«¯ç‚¹è¿æ¥ Elasticã€‚ä¸ºæ­¤ï¼Œé€‰æ‹© OpenAI æœåŠ¡ï¼Œå¹¶ä½¿ç”¨æŒ‡å‘ Groq URL çš„è‡ªå®šä¹‰ URLï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7af0e0d0d7f049358a447635c1da9cf7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=kFpJtx29BUTxtTk4pY2xYr24Td8%3D" alt="" loading="lazy"/></p>
<p>ä¸€æ—¦ä½ ä½¿ç”¨ä¸Šè¿°ä»»ä¸€æ–¹æ³•è®¾ç½®äº† Groqï¼Œè¿›å…¥ GenAI Settings å¹¶å°† Groq è®¾ç½®ä¸ºé»˜è®¤ GenAIã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9dc307599a14ff3aca4e955e66d13ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=STCywcuvnlbPyLVi5L3BWjcX4rM%3D" alt="" loading="lazy"/></p>
<p>Agent Builder ç°åœ¨å°†é»˜è®¤ä½¿ç”¨ Groq connectorã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹æ˜¯å¦å¯ä»¥åœ¨ Agent Builder ä¸­å¤åˆ¶ NLP æœç´¢å¹¶ä½¿ç”¨ Groqã€‚</p>
<p>ä¸ºäº†åˆ›å»º agentsï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦ä¸º agent æä¾›ä¸€äº›å·¥å…·ã€‚åœ¨ Agent Builder ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨å†…ç½®å·¥å…·æˆ–åˆ›å»ºè‡ªå·±çš„å·¥å…·ã€‚è®¸å¤šå†…ç½®å·¥å…·åœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fexplore-analyze%2Fai-features%2Fagent-builder%2Ftools%2Fbuiltin-tools-reference" title="https://www.elastic.co/docs/explore-analyze/ai-features/agent-builder/tools/builtin-tools-reference" target="_blank" ref="nofollow noopener noreferrer">æ­¤å¤„</a>æœ‰æ–‡æ¡£è¯´æ˜ã€‚</p>
<p>ä½ å¯ä»¥ä½¿ç”¨è¿™äº›å·¥å…·è¿›è¡Œäº¤æ˜“æœç´¢ã€‚LLM å°†ä½¿ç”¨å†…ç½®å·¥å…·ï¼Œå¦‚ <code>index_explorer</code>ã€<code>generate_esql</code> å’Œ <code>execute_esql</code>ï¼Œå®ƒä»¬ä¼šå°è¯•æ‰¾åˆ°ç›¸å…³çš„ç´¢å¼•ã€æ£€æŸ¥ç»“æ„ï¼Œå¹¶æ‰§è¡Œç”Ÿæˆçš„ Elasticsearch Query Languageï¼ˆ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fexplore-analyze%2Fquery-filter%2Flanguages%2Fesql" title="https://www.elastic.co/docs/explore-analyze/query-filter/languages/esql" target="_blank" ref="nofollow noopener noreferrer">ES|QL</a> ï¼‰æŸ¥è¯¢ã€‚ç„¶è€Œï¼Œè¿™ä¼šå¸¦æ¥ä¸€äº›æŒ‘æˆ˜ï¼š</p>
<ul>
<li>è¿è¡Œ agent çš„æ—¶é—´ä¼šæ˜¾è‘—å¢åŠ ï¼Œå› ä¸ºä¼šæœ‰å¤šä¸ªæ¨ç†æ­¥éª¤å’Œå·¥å…·æ‰§è¡Œã€‚ç”±äºæˆ‘ä»¬ä½¿ç”¨ Groq è·å–æ›´å¿«çš„ç»“æœï¼Œè¿™å¹¶ä¸ç†æƒ³ã€‚</li>
<li>éšç€æ­¥éª¤æ•°é‡å’Œå·¥å…·ä½¿ç”¨çš„å¢åŠ ï¼Œæˆ‘ä»¬å°†æ¶ˆè€—æ›´å¤šçš„ tokenï¼Œä»è€Œå¢åŠ æˆæœ¬ã€‚</li>
</ul>
<p>ä¸ºé¿å…ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°å·¥å…·ï¼Œä¸“é—¨ç”¨äºæœç´¢äº¤æ˜“ã€‚åœ¨æœ¬æ–‡æ’°å†™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‰ç§ç±»å‹çš„å·¥å…·ï¼š</p>
<ul>
<li>ES|QL å·¥å…·ï¼šå…è®¸ä½ ä½¿ç”¨æ¨¡æ¿åŒ–çš„ ES|QL å®šä¹‰æŸ¥è¯¢ã€‚</li>
<li>Index æœç´¢å·¥å…·ï¼šå…è®¸ä½ æä¾›ç´¢å¼•ï¼ŒLLM åˆ›å»ºæŸ¥è¯¢ã€‚</li>
<li>Model Context Protocolï¼ˆMCPï¼‰å·¥å…·ï¼šå…è®¸ä½ é€šè¿‡ MCP ä½¿ç”¨å¤–éƒ¨å·¥å…·ã€‚</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¹‹å‰åˆ›å»ºçš„ MCP å·¥å…·ï¼›ç„¶è€Œï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ index æœç´¢å·¥å…·ã€‚ä½ å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼è®¾ç½®ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5259935ffdb0441a9e78a75fafd06eed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=uJihVfBGDDT7KLOJcPMzLNeKw4w%3D" alt="" loading="lazy"/></p>
<p>åˆ›å»ºå·¥å…·åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Agent Builder ä¸­åˆ›å»ºä¸€ä¸ª agentã€‚ä¸ºæ­¤ï¼Œç‚¹å‡» Create agent æŒ‰é’®ï¼Œå¹¶æŒ‰ç…§ä¸‹å›¾å¡«å†™ä¿¡æ¯ï¼Œä½¿ç”¨æˆ‘ä»¬åœ¨åŸå§‹ç¤ºä¾‹ä¸­ä½¿ç”¨çš„ promptï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f4ec7e7cc6545f5adc383ae391bd1b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=xOdxxWEqQSVy2dzA77WRt%2FlgmLk%3D" alt="" loading="lazy"/></p>
<p>æˆ‘ä»¬è¿˜éœ€è¦é€‰æ‹©æˆ‘ä»¬åˆ›å»ºçš„å·¥å…·ä½œä¸º agent çš„ä¸€éƒ¨åˆ†ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4afa82f1562546e39d585a78d2da683a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=ur80Ws9hpfYMMBkzTvDjY7KsOqg%3D" alt="" loading="lazy"/></p>
<p>ç„¶ååœ¨ Agent Builder UI ä¸­æµ‹è¯•ï¼Œé€šè¿‡æå‡ºå‡ ä¸ªä¸åŒçš„é—®é¢˜ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/409dd2649c1f48c79c985deda0860300~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=PusH%2BpyxJaq6NMNv63t0pz%2FB98k%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe3ca158e81945abb60dc79b02d1f40d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771022641&amp;x-signature=sMAZ1Mq9LQCffqKRWAMQI%2F4d5hw%3D" alt="" loading="lazy"/></p>
<p>é€šè¿‡ Agent Builderï¼Œæˆ‘ä»¬å®é™…ä¸Šå¯ä»¥è·å¾—æ›´å¤šåŠŸèƒ½ï¼Œå› ä¸ºå®ƒå¯ä»¥æ ¹æ®æˆ‘ä»¬é€‰æ‹©çš„é¢å¤–å†…ç½®å·¥å…·åˆ›å»ºé¢å¤–æŸ¥è¯¢ã€‚å”¯ä¸€çš„çœŸæ­£ç¼ºç‚¹æ˜¯æ•´ä½“å›ç­”é—®é¢˜çš„æ—¶é—´å¯èƒ½æ›´é•¿ï¼Œå› ä¸º LLM èƒ½åšæ›´å¤šæ“ä½œã€‚åŒæ ·ï¼Œè¿™ä¹Ÿæ˜¯ Groq å¯ä»¥æä¾›å¸®åŠ©çš„åœ°æ–¹ã€‚è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹åœ¨ Agent Builder ä¸­ä½¿ç”¨ Groq çš„æ€§èƒ½å·®å¼‚ã€‚</p>
<h2 data-id="heading-2">Agent Builder ä¸­ Groq çš„æ€§èƒ½</h2>
<p>Agent Builder çš„ä¸€ä¸ªå¾ˆæ£’çš„åŠŸèƒ½æ˜¯å®ƒå¼€ç®±å³ç”¨æ”¯æŒ MCP å’Œ agent-to-agentï¼ˆA2Aï¼‰ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹è¿›è¡Œä¸€äº›ç®€å•çš„åŸºå‡†æµ‹è¯•ã€‚é€šè¿‡ A2Aï¼Œæˆ‘ä»¬å¯ä»¥æ›¿æ¢ UI å’Œæµ‹è¯•ç¯å¢ƒä¸­çš„å†…ç½® agentã€‚è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨ Elastic LLM å’Œ Groq ä¸­çš„å‡ ä¸ªä¸åŒæ¨¡å‹æµ‹è¯• Agent Builderã€‚</p>
<p>æœ‰ä¸€ä¸ª<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmarkpudd%2Fa2a_chat" title="https://github.com/markpudd/a2a_chat" target="_blank" ref="nofollow noopener noreferrer">æ›´æ–°çš„ repo</a>ï¼Œå…¶ä¸­åŒ…å«åŸºå‡†æµ‹è¯•è„šæœ¬ã€‚</p>
<p>ä¸ºäº†æµ‹è¯•ï¼Œæˆ‘ä»¬å°†æå‡ºé—®é¢˜ï¼š</p>
<p>æˆ‘åœ¨æ±½æ²¹ä¸ŠèŠ±äº†å¤šå°‘é’±ï¼Ÿ</p>
<p>æµ‹è¯•ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<table><thead><tr><th/><th>Groq -openai/gpt-oss-120b</th><th>Groq llama-3.3-70b-versatile</th><th>Elastic LLM</th></tr></thead><tbody><tr><td>Min: 6.040s</td><td>6.04</td><td>4.433</td><td>15.962</td></tr><tr><td>Max: 9.625s</td><td>9.625</td><td>7.986</td><td>24.037</td></tr><tr><td>Mean: 7.862s</td><td>7.862</td><td>6.216</td><td>17.988</td></tr><tr><td>Median: 7.601s</td><td>7.601</td><td>6.264</td><td>17.027</td></tr><tr><td>StdDev: 1.169s</td><td>1.169</td><td>1.537</td><td>2.541</td></tr></tbody></table>
<p>å¦‚ä½ æ‰€è§ï¼Œå†…ç½®çš„ Elastic LLM è¡¨ç°ä¸é”™ï¼Œä½† Groq å¹³å‡ä»å¿«äº†è¿‘ 3 å€ã€‚ä½ ä¼šæ³¨æ„åˆ°æ•´ä½“é€Ÿåº¦æ¯”å¤–éƒ¨åº”ç”¨æ…¢å¾—å¤šã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨ Agent Builder ä¸­è®¾ç½®å·¥å…·æ—¶ä»…ä½¿ç”¨äº† indexã€‚å› æ­¤ï¼Œå¤§éƒ¨åˆ†æ—¶é—´èŠ±åœ¨äº† Agent Builder çš„æ¨ç†ä¸Šï¼ˆå³æ£€æŸ¥ indexï¼‰ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¨¡æ¿åŒ–çš„ ES|QL å·¥å…·æ›¿ä»£ indexï¼Œè¿™å°†ä½¿ç»“æœæ›´æ¥è¿‘å¤–éƒ¨åº”ç”¨ã€‚</p>
<h2 data-id="heading-3">ç»“è®º</h2>
<p>æ˜¾è€Œæ˜“è§ï¼Œé€šè¿‡å°† Groq ä¸ Elastic ç»“åˆä½¿ç”¨ï¼Œæˆ‘ä»¬å¼€å¯äº†ä¸€ç³»åˆ—æ–°çš„å¯èƒ½æ€§ï¼Œå…¶ä¸­é€Ÿåº¦æ˜¯ä¸€ä¸ªé‡è¦å› ç´ ã€‚æœ¬æ–‡ä»‹ç»äº†åŸºæœ¬çš„æ™ºèƒ½æŸ¥è¯¢ç¤ºä¾‹ï¼Œä½†è¿˜æœ‰è®¸å¤šå…¶ä»–åº”ç”¨ï¼Œå¦‚å›¾åƒç†è§£ã€æ‘˜è¦å’Œå­—å¹•ç”Ÿæˆï¼Œè¿™äº›åœ¨é€Ÿåº¦æå‡ 10 å€çš„æƒ…å†µä¸‹éƒ½å˜å¾—å¯è¡Œã€‚</p>
<p>åŸæ–‡ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fblog%2Fgroq-elasticsearch" title="https://www.elastic.co/search-labs/blog/groq-elasticsearch" target="_blank" ref="nofollow noopener noreferrer">www.elastic.co/search-labsâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[316. Java Stream API - æ”¶é›†ä¸º Mapï¼šä½¿ç”¨ Collectors.toMap()]]></title>    <link>https://juejin.cn/post/7603581886149967926</link>    <guid>https://juejin.cn/post/7603581886149967926</guid>    <pubDate>2026-02-07T00:35:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603581886149967926" data-draft-id="7603563317040775231" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="316. Java Stream API - æ”¶é›†ä¸º Mapï¼šä½¿ç”¨ Collectors.toMap() "/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯"/> <meta itemprop="datePublished" content="2026-02-07T00:35:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CacheæŠ€æœ¯åˆ†äº«"/> <meta itemprop="url" content="https://juejin.cn/user/1662117313262776"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            316. Java Stream API - æ”¶é›†ä¸º Mapï¼šä½¿ç”¨ Collectors.toMap() 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1662117313262776/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CacheæŠ€æœ¯åˆ†äº«
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T00:35:23.000Z" title="Sat Feb 07 2026 00:35:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">316. Java Stream API - æ”¶é›†ä¸º Mapï¼šä½¿ç”¨ <code>Collectors.toMap()</code></h2>
<p>é™¤äº†å‰é¢è®²è¿‡çš„ <code>groupingBy()</code> æ”¶é›†å™¨ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªå¼ºå¤§çš„ä¼™ä¼´ï¼š<code>Collectors.toMap()</code>ï¼Œç”¨äºå°† Stream ä¸­çš„å…ƒç´ è½¬æ¢ä¸ºä¸€ä¸ªçœŸæ­£çš„é”®å€¼å¯¹æ˜ å°„ï¼ˆMapï¼‰ã€‚è¿™ä¸€æ–¹æ³•éå¸¸é€‚åˆæ„å»ºç¼“å­˜ã€ç´¢å¼•æˆ–è€…å¿«é€ŸæŸ¥æ‰¾çš„æ•°æ®ç»“æ„ã€‚</p>
<hr/>
<h4 data-id="heading-1">âœ¨ åŸºæœ¬ä½¿ç”¨æ–¹å¼ï¼šä¸¤ä¸ªå‡½æ•°æå®šé”®å’Œå€¼</h4>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹åŸºç¡€è¯­æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java">Map&lt;K, V&gt; map = stream.collect(Collectors.toMap(keyMapper, valueMapper));
</code></pre>
<ul>
<li><code>keyMapper</code>ï¼šç”¨äºç”Ÿæˆ Map çš„ keyã€‚</li>
<li><code>valueMapper</code>ï¼šç”¨äºç”Ÿæˆ Map çš„ valueã€‚</li>
</ul>
<blockquote>
<p>âš ï¸ æ³¨æ„ï¼šå¦‚æœå¤šä¸ªå…ƒç´ äº§ç”Ÿç›¸åŒçš„ keyï¼Œä¼šæŠ›å‡º <code>IllegalStateException</code>ï¼Œé™¤éä½ æä¾›åˆå¹¶é€»è¾‘ã€‚</p>
</blockquote>
<hr/>
<h4 data-id="heading-2">âœ… ç¤ºä¾‹ï¼šæ„å»ºç”¨æˆ·ç¼“å­˜</h4>
<p>å‡è®¾ä½ æœ‰ä¸€ä¸ª <code>User</code> ç±»ï¼Œæ¯ä¸ªç”¨æˆ·æœ‰ä¸€ä¸ª <code>id</code>ï¼Œä½ æƒ³ç”¨ <code>id</code> ä½œä¸º keyï¼ŒæŠŠç”¨æˆ·ç¼“å­˜èµ·æ¥ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">record</span> <span class="hljs-title class_">User</span><span class="hljs-params">(<span class="hljs-type">long</span> id, String name)</span> {}

List&lt;User&gt; users = List.of(
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">1L</span>, <span class="hljs-string">"Mary"</span>),
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">2L</span>, <span class="hljs-string">"James"</span>),
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">3L</span>, <span class="hljs-string">"Patricia"</span>),
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">4L</span>, <span class="hljs-string">"Michael"</span>)
);

Map&lt;Long, User&gt; userCache = users.stream()
    .collect(Collectors.toMap(User::id, Function.identity()));

System.out.println(<span class="hljs-string">"Map size = "</span> + userCache.size());
System.out.println(<span class="hljs-string">"Keys = "</span> + userCache.keySet());
</code></pre>
<p><strong>è¿è¡Œç»“æœï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Map</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>
Keys = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]
</code></pre>
<ul>
<li><code>User::id</code> ç”Ÿæˆ key</li>
<li><code>Function.identity()</code> è¿”å›å…ƒç´ æœ¬èº«ä½œä¸º value</li>
</ul>
<p>ğŸ¯ ç”¨é€”ï¼šå¸¸ç”¨äº <strong>ç¼“å­˜</strong>ã€<strong>ç´¢å¼•è¡¨</strong> çš„æ„å»ºã€‚</p>
<hr/>
<h4 data-id="heading-3">â—ï¸å¤„ç†é‡å¤ Keyï¼šä¼ å…¥åˆå¹¶å‡½æ•°</h4>
<p>å¦‚æœä½ é¢„æœŸå¤šä¸ªå…ƒç´ ä¼šç”Ÿæˆç›¸åŒçš„ keyï¼Œä½ éœ€è¦æä¾›ä¸€ä¸ª<strong>åˆå¹¶å‡½æ•°</strong>ï¼ˆ<code>BinaryOperator</code>ï¼‰å‘Šè¯‰ Java å¦‚ä½•åˆå¹¶å€¼ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹ä¸‹é¢è¿™ä¸ªç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">Collection&lt;String&gt; strings = List.of(
    <span class="hljs-string">"one"</span>, <span class="hljs-string">"two"</span>, <span class="hljs-string">"three"</span>, <span class="hljs-string">"four"</span>, <span class="hljs-string">"five"</span>, <span class="hljs-string">"six"</span>, <span class="hljs-string">"seven"</span>, <span class="hljs-string">"eight"</span>, <span class="hljs-string">"nine"</span>,
    <span class="hljs-string">"ten"</span>, <span class="hljs-string">"eleven"</span>, <span class="hljs-string">"twelve"</span>);

Map&lt;Integer, String&gt; map = strings.stream()
    .collect(Collectors.toMap(
        str -&gt; str.length(),      <span class="hljs-comment">// key: å­—ç¬¦ä¸²é•¿åº¦</span>
        str -&gt; str,               <span class="hljs-comment">// value: å­—ç¬¦ä¸²æœ¬èº«</span>
        (s1, s2) -&gt; s1 + <span class="hljs-string">", "</span> + s2));  <span class="hljs-comment">// åˆå¹¶å‡½æ•°ï¼šæ‹¼æ¥å­—ç¬¦ä¸²</span>

map.forEach((key, value) -&gt; System.out.println(key + <span class="hljs-string">" :: "</span> + value));
</code></pre>
<p><strong>è¾“å‡ºç»“æœï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-number">3</span> :: one, two, six, ten
<span class="hljs-number">4</span> :: four, five, nine
<span class="hljs-number">5</span> :: three, seven, eight
<span class="hljs-number">6</span> :: eleven, twelve
</code></pre>
<p>ğŸ“Œ å¦‚æœä¸æä¾›åˆå¹¶å‡½æ•°ï¼Œä¼šåœ¨ key å†²çªæ—¶æŠ›å‡ºå¼‚å¸¸ã€‚</p>
<hr/>
<h4 data-id="heading-4">ğŸ§° é«˜çº§ç”¨æ³•ï¼šæŒ‡å®š Map å®ç°ç±»</h4>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>toMap()</code> è¿”å›ä¸€ä¸ª <code>HashMap</code>ã€‚ä½†ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ç¬¬å››ä¸ªå‚æ•°ä¼ å…¥ä½ æƒ³è¦çš„ Map ç±»å‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">TreeMap&lt;Integer, String&gt; sortedMap = strings.stream()
    .collect(Collectors.toMap(
        str -&gt; str.length(),
        str -&gt; str,
        (s1, s2) -&gt; s1 + <span class="hljs-string">", "</span> + s2,
        TreeMap::<span class="hljs-keyword">new</span>));

System.out.println(sortedMap);
</code></pre>
<p>ğŸ§¾ è¾“å‡ºå°†æ˜¯æŒ‰ key æ’åºçš„ï¼š</p>
<pre><code class="hljs language-java" lang="java">{<span class="hljs-number">3</span>=one, two, six, ten, <span class="hljs-number">4</span>=four, five, nine, <span class="hljs-number">5</span>=three, seven, eight, <span class="hljs-number">6</span>=eleven, twelve}
</code></pre>
<hr/>
<h4 data-id="heading-5">ğŸ§µ å¤šçº¿ç¨‹æ”¶é›†ï¼šä½¿ç”¨ <code>toConcurrentMap()</code></h4>
<p>ä½ è¿˜å¯ä»¥ä½¿ç”¨ <code>Collectors.toConcurrentMap()</code> æ¥æ„å»ºçº¿ç¨‹å®‰å…¨çš„ Mapï¼Œé€‚åˆå¹¶è¡Œæµæˆ–å¤šçº¿ç¨‹åœºæ™¯ï¼š</p>
<pre><code class="hljs language-java" lang="java">ConcurrentMap&lt;Long, User&gt; userCache = users.parallelStream()
    .collect(Collectors.toConcurrentMap(User::id, Function.identity()));
</code></pre>
<blockquote>
<p>ğŸ’¡ å®é™…ç±»å‹é€šå¸¸æ˜¯ <code>ConcurrentHashMap</code>ï¼Œä½†è§„èŒƒä¸ä¿è¯å…·ä½“å®ç°ã€‚</p>
</blockquote>
<hr/>
<h4 data-id="heading-6">ğŸ“š æ€»ç»“å¯¹æ¯”</h4>

































<table><thead><tr><th>Collector</th><th>ç”¨é€”</th><th>æ”¯æŒé‡å¤ Key</th><th>ä¸‹æ¸¸æ”¶é›†å™¨</th><th>æ§åˆ¶ Map ç±»å‹</th></tr></thead><tbody><tr><td><code>groupingBy()</code></td><td>åˆ†ç»„ã€ç»Ÿè®¡ã€åˆ†ç±»</td><td>âœ…</td><td>âœ… å¯é€‰</td><td>âœ… å¯é€‰</td></tr><tr><td><code>toMap()</code></td><td>æ˜ å°„ã€ç¼“å­˜ã€ç´¢å¼•</td><td>âŒï¼ˆéœ€æ‰‹åŠ¨åˆå¹¶ï¼‰</td><td>âŒ</td><td>âœ… å¯é€‰</td></tr><tr><td><code>toConcurrentMap()</code></td><td>å¹¶å‘å®‰å…¨æ˜ å°„</td><td>âŒï¼ˆéœ€æ‰‹åŠ¨åˆå¹¶ï¼‰</td><td>âŒ</td><td>âœ… é»˜è®¤å¹¶å‘ Map</td></tr></tbody></table>
<hr/>
<h4 data-id="heading-7">ğŸ—£ å°ç»“è¯­å¥ï¼ˆå¯è¯¾å ‚å£æ’­ï¼‰ï¼š</h4>
<blockquote>
<p>ğŸ”Š â€œæˆ‘ä»¬ç”¨ <code>groupingBy()</code> åšç»Ÿè®¡å›¾ã€åšåˆ†ç±»ã€‚ä½†å½“ä½ éœ€è¦æ„å»ºé”®å€¼ç»“æ„ï¼Œæ¯”å¦‚ç¼“å­˜ã€ç´¢å¼•è¡¨ï¼Œå°±è½®åˆ° <code>toMap()</code> ç™»åœºäº†ï¼è¦æ³¨æ„ key å†²çªçš„å¤„ç†ï¼Œé¿å…è¿è¡Œæ—¶ç‚¸é”…ï¼â€</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TypeScript æ³›å‹ä»è½»æ¾å…¥é—¨åˆ°çœ‹æ‡‚æºç ]]></title>    <link>https://juejin.cn/post/7603444191449055266</link>    <guid>https://juejin.cn/post/7603444191449055266</guid>    <pubDate>2026-02-06T18:02:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603444191449055266" data-draft-id="7603347438013710371" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TypeScript æ³›å‹ä»è½»æ¾å…¥é—¨åˆ°çœ‹æ‡‚æºç "/> <meta itemprop="keywords" content="TypeScript"/> <meta itemprop="datePublished" content="2026-02-06T18:02:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SuperEugene"/> <meta itemprop="url" content="https://juejin.cn/user/2366613652515256"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TypeScript æ³›å‹ä»è½»æ¾å…¥é—¨åˆ°çœ‹æ‡‚æºç 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2366613652515256/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SuperEugene
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T18:02:31.000Z" title="Fri Feb 06 2026 18:02:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä»ã€Œå®Œå…¨ä¸æ‡‚æ³›å‹ã€ä¸€è·¯èµ°åˆ°ã€Œçœ‹æ‡‚ä¸‹é¢è¿™æ®µä»£ç åˆ°åº•åœ¨å¹²å˜›ã€ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">//æ­¤ä»£ä¸ºä¸ºVxeTableç»„ä»¶åº“Gridé…ç½®å¼è¡¨æ ¼æ•°æ®åˆ†é¡µç¤ºä¾‹ä»£ç éƒ¨åˆ†ç‰‡æ®µ</span>
&lt;script lang=<span class="hljs-string">"ts"</span> setup&gt;
<span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">VxeGridProps</span>, <span class="hljs-title class_">VxeGridListeners</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vxe-table'</span>

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">RowVO</span> {  
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>  
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>  
  <span class="hljs-attr">role</span>: <span class="hljs-built_in">string</span>  
  <span class="hljs-attr">sex</span>: <span class="hljs-built_in">string</span>  
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>  
  <span class="hljs-attr">address</span>: <span class="hljs-built_in">string</span>
}

<span class="hljs-keyword">const</span> gridOptions = reactive&lt;<span class="hljs-title class_">VxeGridProps</span>&lt;<span class="hljs-title class_">RowVO</span>&gt;&gt;({  
  <span class="hljs-attr">showOverflow</span>: <span class="hljs-literal">true</span>,  
  <span class="hljs-attr">border</span>: <span class="hljs-literal">true</span>,  
  <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span>,  
  <span class="hljs-attr">height</span>: <span class="hljs-number">500</span>,  
  <span class="hljs-attr">pagerConfig</span>: pagerVO,  
  <span class="hljs-attr">columns</span>: [    
    { <span class="hljs-attr">type</span>: <span class="hljs-string">'seq'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">70</span>, <span class="hljs-attr">fixed</span>: <span class="hljs-string">'left'</span> },    
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'name'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Name'</span>, <span class="hljs-attr">minWidth</span>: <span class="hljs-number">160</span> },    
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'email'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Email'</span>, <span class="hljs-attr">minWidth</span>: <span class="hljs-number">160</span> },    
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'nickname'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Nickname'</span>, <span class="hljs-attr">minWidth</span>: <span class="hljs-number">160</span> },    
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'age'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Age'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">100</span> },    
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'role'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Role'</span>, <span class="hljs-attr">minWidth</span>: <span class="hljs-number">160</span> },    
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'amount'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Amount'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">140</span> },    
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'updateDate'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Update Date'</span>, <span class="hljs-attr">visible</span>: <span class="hljs-literal">false</span> },    
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'createDate'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Create Date'</span>, <span class="hljs-attr">visible</span>: <span class="hljs-literal">false</span> },  
  ],  
  <span class="hljs-attr">data</span>: [],
})
&lt;/script&gt;
</code></pre>
<blockquote>
<p>VxeTableç»„ä»¶åº“ç®€ä»‹ï¼š</p>
<ul>
<li>ç”±äºè¿™ç¯‡æ–‡ç« å¼•ç”¨åˆ°äº†VxeTableç»„ä»¶åº“çš„ä»£ç ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œç»™æ²¡æ¥è§¦è¿‡çš„å°ä¼™ä¼´åšä¸€ä¸ªç®€å•çš„ä»‹ç»ï¼Œè€å¸æœºå¯è‡ªè¡Œè·³è¿‡ã€‚</li>
<li>VxeTableæ˜¯ä¸€ä¸ªåŸºäº Vue çš„è¡¨æ ¼ç»„ä»¶åº“ï¼Œæä¾›è¡¨æ ¼ã€è¡¨å•ã€å·¥å…·æ ã€åˆ†é¡µç­‰ç»„ä»¶ï¼Œé€‚åˆä¸­åå°åœºæ™¯ã€‚æ€§èƒ½ä¸åŠŸèƒ½éƒ½è¾ƒå¼ºï¼Œä½†å­¦ä¹ æˆæœ¬å’ŒæŒ‰éœ€å¼•å…¥çš„é…ç½®éœ€è¦æŠ•å…¥æ—¶é—´ã€‚å¦‚æœä½ çš„é¡¹ç›®ä»¥è¡¨æ ¼ä¸ºæ ¸å¿ƒï¼Œä¸”éœ€è¦è™šæ‹Ÿæ»šåŠ¨ã€å¤æ‚äº¤äº’ç­‰åŠŸèƒ½ï¼ŒVxeTable æ˜¯åˆé€‚çš„é€‰æ‹©ã€‚æ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥é€šè¿‡ä¸‹æ–¹è´´ä¸Šçš„å®˜ç½‘é“¾æ¥å­¦ä¹ äº†è§£ã€‚</li>
</ul>
<p>ï¼ˆPSÂ·å³ä½¿æ²¡ç”¨è¿‡VxeTableä¹Ÿä¸å½±å“ä½ çœ‹æ‡‚è¿™ç¯‡æ–‡ç« ï¼‰</p>
<p>å®˜ç½‘é“¾æ¥<a href="https://link.juejin.cn?target=https%3A%2F%2Fvxetable.cn%2F%23%2Fcomponent%2Fgrid%2Fpager%2FmockPage" target="_blank" title="https://vxetable.cn/#/component/grid/pager/mockPage" ref="nofollow noopener noreferrer">ï¼šVxeTableå®˜ç½‘</a></p>
</blockquote>
<h2 data-id="heading-0">ä¸€ã€ä»€ä¹ˆæ˜¯æ³›å‹ï¼Ÿä¸€å¥è¯ç‰ˆæœ¬</h2>
<p>æ³›å‹ = ç»™ â€œç±»å‹â€ åŠ å‚æ•°ã€‚</p>
<ul>
<li>å‡½æ•°å¯ä»¥æœ‰å‚æ•°ï¼š<code>function fn(x: number) {}</code></li>
<li>ç±»å‹ä¹Ÿå¯ä»¥æœ‰ â€œå‚æ•°â€ï¼š<code>Array&lt;string&gt;</code></li>
</ul>
<p>è¿™é‡Œ <code>Array</code> å°±æ˜¯ä¸€ä¸ªã€Œå¸¦ç±»å‹å‚æ•°ã€çš„ç±»å‹ï¼Œ<code>&lt;string&gt;</code> å°±æ˜¯ã€Œä¼ ç»™å®ƒçš„ç±»å‹å‚æ•°ã€ã€‚</p>
<p>ç”¨äººè¯è¯´ï¼š</p>
<blockquote>
<p>æ³›å‹å°±æ˜¯ï¼š<strong>æˆ‘å†™ä¸€ä»½é€šç”¨çš„ç±»å‹ / å‡½æ•°ï¼ŒçœŸæ­£ç”¨çš„æ—¶å€™å†å‘Šè¯‰å®ƒå…·ä½“ç”¨ä»€ä¹ˆç±»å‹</strong>ã€‚</p>
</blockquote>
<h2 data-id="heading-1">äºŒã€æœ€æ™®é€šçš„ä¸€å±‚æ³›å‹</h2>
<h3 data-id="heading-2">1. æœ€ç†Ÿæ‚‰çš„ä¾‹å­ï¼šæ•°ç»„</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// è¿™ä¿©æ˜¯å®Œå…¨ç­‰ä»·çš„</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">list1</span>: <span class="hljs-built_in">string</span>[] = []
<span class="hljs-keyword">const</span> <span class="hljs-attr">list2</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = []
</code></pre>
<ul>
<li><code>Array&lt;T&gt;</code> æ˜¯ä¸€ä¸ªæ³›å‹ç±»å‹</li>
<li><code>T</code> æ˜¯å®ƒçš„ç±»å‹å‚æ•°</li>
<li><code>Array&lt;string&gt;</code> è¡¨ç¤ºã€Œå…ƒç´ ç±»å‹æ˜¯ <code>string</code> çš„æ•°ç»„ã€</li>
</ul>
<h3 data-id="heading-3">2. è‡ªå·±å†™ä¸€ä¸ªæ³›å‹å‡½æ•°</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> identity&lt;T&gt;(<span class="hljs-attr">value</span>: T): T {  
  <span class="hljs-keyword">return</span> value
}
identity&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">1</span>)      <span class="hljs-comment">// T è¢«æ›¿æ¢æˆ number</span>
identity&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">'hi'</span>)   <span class="hljs-comment">// T è¢«æ›¿æ¢æˆ string</span>
</code></pre>
<p>ä½ å¯ä»¥ç†è§£ä¸ºï¼š</p>
<ul>
<li>å®šä¹‰ï¼š<code>identity&lt;T&gt;</code> â†’ <code>T</code> æ˜¯ä¸€ä¸ªã€Œå ä½çš„ç±»å‹ã€</li>
<li>ä½¿ç”¨ï¼š<code>identity&lt;number&gt;</code> â†’ è¿™æ¬¡è°ƒç”¨é‡Œã€ŒæŠŠ <code>T</code> æ¢æˆ <code>number</code>ã€</li>
</ul>
<p>æˆ–è®¸æœ‰åŒå­¦ä¸ç†è§£ä¸ºä»€ä¹ˆè¦åœ¨å‡½æ•°åç§°åé¢å†™<code>&lt;T&gt;</code>ã€‚ä¸ç”¨çº ç»“ï¼Œè¿™æ˜¯å›ºå®šçš„å†™æ³•ï¼Œå°±åƒä½ è¦ä½¿ç”¨å˜é‡ï¼Œå°±è¦å…ˆå£°æ˜ä¸€æ ·,å¦‚ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">let</span> data = []
data.<span class="hljs-title function_">push</span>(<span class="hljs-number">123</span>)
</code></pre>
<p>å¦‚æœæ­¤å¤„æ²¡æœ‰å£°æ˜<code>data</code>ï¼Œä¾¿ç”¨ä¸äº†<code>data</code>ã€‚åŒç†å¦‚æœä¸åœ¨å‡½æ•°åç§°åé¢å†™<code>&lt;T&gt;</code>å£°æ˜ä¸€ä¸‹è¿™æ˜¯æ³›å‹å‚æ•°ï¼Œ<code>TypeScript</code> æ— æ³•è¯†åˆ«Â <code>T</code>Â æ˜¯ä»€ä¹ˆ,å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">//  é”™è¯¯ï¼šæ‰¾ä¸åˆ°åç§° 'T'</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">identity</span>(<span class="hljs-params">value: T</span>): T {
  <span class="hljs-keyword">return</span> value
}
<span class="hljs-comment">// æŠ¥é”™ï¼šCannot find name 'T'</span>
</code></pre>
<p><code>TypeScript</code> ä¼šæŠŠÂ <code>T</code>Â å½“ä½œä¸€ä¸ªæœªå£°æ˜çš„ç±»å‹ï¼Œå› æ­¤æŠ¥é”™ã€‚</p>
<h2 data-id="heading-4">ä¸‰ã€ç±»å‹ä¹Ÿå¯ä»¥æ˜¯æ³›å‹ï¼šæ¥å£ /type</h2>
<h3 data-id="heading-5">1. æ³›å‹æ¥å£</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// ä½¿ç”¨æ—¶ä¼ å…¥ä¸åŒçš„ T</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApiResponse</span>&lt;T&gt; {  
  <span class="hljs-attr">code</span>: <span class="hljs-built_in">number</span>  
  <span class="hljs-attr">msg</span>: <span class="hljs-built_in">string</span>  
  <span class="hljs-attr">data</span>: T
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {  
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>  
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>
}

<span class="hljs-keyword">const</span> <span class="hljs-attr">res1</span>: <span class="hljs-title class_">ApiResponse</span>&lt;<span class="hljs-title class_">User</span>&gt; = {  
  <span class="hljs-attr">code</span>: <span class="hljs-number">0</span>,  
  <span class="hljs-attr">msg</span>: <span class="hljs-string">'ok'</span>,  
  <span class="hljs-attr">data</span>: { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'å¼ ä¸‰'</span> },
}

<span class="hljs-keyword">const</span> <span class="hljs-attr">res2</span>: <span class="hljs-title class_">ApiResponse</span>&lt;<span class="hljs-built_in">string</span>[]&gt; = {  
  <span class="hljs-attr">code</span>: <span class="hljs-number">0</span>,  
  <span class="hljs-attr">msg</span>: <span class="hljs-string">'ok'</span>,  
  <span class="hljs-attr">data</span>: [<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>],
}
</code></pre>
<p>è§‚å¯Ÿï¼š</p>
<ul>
<li><code>ApiResponse&lt;T&gt;</code> è‡ªå·±å¹¶ä¸çŸ¥é“ <code>T</code> æ˜¯å•¥</li>
<li>çœŸæ­£ç”¨çš„æ—¶å€™å†™ <code>ApiResponse&lt;User&gt;</code> / <code>ApiResponse&lt;string[]&gt;</code></li>
<li><code>TypeScript</code> åœ¨è¿™ä¸€åˆ»æ‰æŠŠ <code>T</code> æ›¿æ¢æ‰</li>
</ul>
<h2 data-id="heading-6">å››ã€åµŒå¥—æ³›å‹ï¼šæ³›å‹é‡Œé¢å†å¥—æ³›å‹</h2>
<p>å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯ã€Œç±»å‹å‚æ•°æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæ³›å‹ç±»å‹ã€ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// ä¸€å±‚ï¼šæ•°ç»„é‡Œæ”¾å­—ç¬¦ä¸²</span>
<span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;

<span class="hljs-comment">// ä¸¤å±‚ï¼šPromise é‡Œæ”¾æ•°ç»„ï¼Œæ•°ç»„é‡Œæ”¾å­—ç¬¦ä¸²</span>
<span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt;

<span class="hljs-comment">// æ¢ä¸ªå†™æ³•æ›´ç›´è§‚</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">StringArray</span> = <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">StringArrayPromise</span> = <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">StringArray</span>&gt;
</code></pre>
<p>ä½ å¯ä»¥è¿™ä¹ˆæƒ³ï¼š</p>
<ul>
<li>ç¬¬ä¸€å±‚ï¼š<code>Array&lt;T&gt;</code></li>
<li>ç¬¬äºŒå±‚ï¼š<code>Promise&lt;ç¬¬ä¸€å±‚&gt;</code></li>
</ul>
<h2 data-id="heading-7">äº”ã€å›åˆ°æ–‡ç« æœ€å¼€å§‹çš„ä¾‹å­ï¼š<code>VxeGridProps&lt;RowVO&gt;</code></h2>
<p>å…ˆçœ‹å®šä¹‰çš„è¡Œæ•°æ®ç±»å‹ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">RowVO</span> {  
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>  
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>  
  <span class="hljs-attr">role</span>: <span class="hljs-built_in">string</span>  
  <span class="hljs-attr">sex</span>: <span class="hljs-built_in">string</span>  
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>  
  <span class="hljs-attr">address</span>: <span class="hljs-built_in">string</span>
}
</code></pre>
<p>ç„¶åï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> gridOptions = reactive&lt;<span class="hljs-title class_">VxeGridProps</span>&lt;<span class="hljs-title class_">RowVO</span>&gt;&gt;({...})
</code></pre>
<p>æ‹†å¼€ç†è§£ï¼š</p>
<ul>
<li><code>VxeGridProps&lt;D = any&gt;</code> æ˜¯ vxe-table æä¾›çš„æ³›å‹æ¥å£</li>
<li>ä½ å†™çš„æ˜¯ <code>VxeGridProps&lt;RowVO&gt;</code></li>
<li>è¿™ä¸€åˆ»ï¼Œ<code>D</code> å°±è¢«æ›¿æ¢æˆäº† <code>RowVO</code></li>
</ul>
<p>ä¹Ÿå°±æ˜¯åœ¨è¿™ä¸€æ•´æ¬¡ä½¿ç”¨é‡Œï¼Œå¯ä»¥æŠŠå®ƒè„‘è¡¥æˆï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// ä¼ªä»£ç ï¼Œä»…ç”¨äºç†è§£</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">VxeGridProps</span>_RowVO <span class="hljs-keyword">extends</span> <span class="hljs-title class_">VxeTableProps</span>&lt;<span class="hljs-title class_">RowVO</span>&gt; {  
  columns?: <span class="hljs-title class_">VxeGridPropTypes</span>.<span class="hljs-property">Columns</span>&lt;<span class="hljs-title class_">RowVO</span>&gt;  
  proxyConfig?: <span class="hljs-title class_">VxeGridPropTypes</span>.<span class="hljs-property">ProxyConfig</span>&lt;<span class="hljs-title class_">RowVO</span>&gt;  
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>å¯èƒ½å¾ˆå¤šåŒå­¦çœ‹åˆ°è¿™é‡Œä¼šæ„Ÿåˆ°äº›ç–‘æƒ‘ï¼Œæ€ä¹ˆä¸€ä¼šå„¿Tä¸€ä¼šå„¿Dçš„ã€‚å…¶å®ä¸ç®¡æ˜¯Tè¿˜æ˜¯Déƒ½æ˜¯ç±»å‹å˜é‡çš„è‡ªå®šä¹‰åç§°ï¼Œå«ä»€ä¹ˆéƒ½æ— æ‰€è°“ï¼Œè¯­æ³•ä¸Šæ²¡æœ‰ä»»ä½•å›ºå®šå«ä¹‰ï¼Œå°±åƒä½ å†™ JS æ—¶ç»™å˜é‡èµ·å<code>num</code>/<code>name</code>/<code>age</code>ä¸€æ ·ï¼Œåªæ˜¯å‰ç«¯ç¤¾åŒºå½¢æˆäº†ã€Œçº¦å®šä¿—æˆçš„å‘½åä¹ æƒ¯ã€ï¼Œç”¨ä¸åŒå­—æ¯å¯¹åº”ä¸åŒè¯­ä¹‰ï¼Œè®©ä»£ç æ›´æ˜“è¯»ã€‚</p>















































<table><thead><tr><th>å­—æ¯</th><th>å…¨ç§°</th><th>å«ä¹‰/ä½¿ç”¨åœºæ™¯</th><th>ä¾‹å­</th></tr></thead><tbody><tr><td>T</td><td>Type</td><td>é€šç”¨ç±»å‹ï¼ˆæœ€å¸¸ç”¨ï¼Œæ— ç‰¹æ®Šè¯­ä¹‰æ—¶éƒ½ç”¨ Tï¼‰</td><td><code>first&lt;T&gt;(arr: T[])</code></td></tr><tr><td>D</td><td>Default/Date</td><td>é€šå¸¸æŒ‡ â€œé»˜è®¤ç±»å‹â€ æˆ– â€œæ—¥æœŸç±»å‹â€ï¼ˆå°ä¼—ï¼‰</td><td>æ³›å‹æ¥å£é‡Œçš„é»˜è®¤ç±»å‹ï¼š<code>interface Config&lt;D = string&gt;</code></td></tr><tr><td>K</td><td>KeyKey</td><td>è¡¨ç¤ºå¯¹è±¡çš„ã€Œé”®ã€ç±»å‹</td><td><code>getKey&lt;K extends string&gt;(obj: { [k: K]: any }, key: K)</code></td></tr><tr><td>V</td><td>Value</td><td>è¡¨ç¤ºå¯¹è±¡çš„ã€Œå€¼ã€ç±»å‹</td><td><code>Map&lt;K, V&gt;</code>ï¼ˆTS å†…ç½®çš„ Map æ³›å‹ï¼‰</td></tr><tr><td>E</td><td>Element</td><td>è¡¨ç¤ºæ•°ç»„ / é›†åˆçš„ã€Œå…ƒç´ ã€ç±»å‹</td><td><code>Array&lt;E&gt;</code>ï¼ˆTS å†…ç½®çš„æ•°ç»„æ³›å‹ï¼‰</td></tr><tr><td>P</td><td>Parameter</td><td>è¡¨ç¤ºå‡½æ•°çš„ã€Œå‚æ•°ã€ç±»å‹</td><td><code>function wrap&lt;P&gt;(fn: (arg: P) =&gt; void, arg: P)</code></td></tr></tbody></table>
<h2 data-id="heading-8">å…­ã€ç±»å‹å‚æ•°æ˜¯æ€ä¹ˆä¸€å±‚ä¸€å±‚ â€œä¼ ä¸‹å»â€ çš„ï¼Ÿ</h2>
<p>åˆ°è¿™ä¸€æ­¥ä¸ºäº†æ›´å¥½çš„ç†è§£æ³›å‹ï¼Œæˆ‘å°†å¸¦ç€åŒå­¦ä»¬è¿½æº¯æºç ã€‚ä¸€èµ·æ¥è¿½è¸ªä¸€ä¸‹æºç çœ‹çœ‹å§ã€‚</p>
<h3 data-id="heading-9">1. ç¬¬ä¸€å±‚ï¼š<code>VxeGridProps&lt;D&gt;</code></h3>
<p>æºç é‡Œï¼ˆç®€åŒ–ï¼‰ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">VxeGridProps</span>&lt;D = <span class="hljs-built_in">any</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">VxeTableProps</span>&lt;D&gt; {  
  columns?: <span class="hljs-title class_">VxeGridPropTypes</span>.<span class="hljs-property">Columns</span>&lt;D&gt;  
  proxyConfig?: <span class="hljs-title class_">VxeGridPropTypes</span>.<span class="hljs-property">ProxyConfig</span>&lt;D&gt;  
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>å½“ä½ ç”¨ <code>VxeGridProps&lt;RowVO&gt;</code>ï¼š</p>
<ul>
<li><code>extends VxeTableProps&lt;D&gt;</code> â†’ å˜æˆ <code>extends VxeTableProps&lt;RowVO&gt;</code></li>
<li><code>columns?: Columns&lt;D&gt;</code> â†’ å˜æˆ <code>columns?: Columns&lt;RowVO&gt;</code></li>
<li><code>proxyConfig?: ProxyConfig&lt;D&gt;</code> â†’ å˜æˆ <code>proxyConfig?: ProxyConfig&lt;RowVO&gt;</code></li>
</ul>
<blockquote>
<p>è®°å¿†ï¼šå“ªé‡Œå†™äº† <code>&lt;D&gt;</code>ï¼Œå°±ä¼šè¢«æ›¿æ¢æˆ <code>&lt;RowVO&gt;</code>ã€‚</p>
</blockquote>
<h3 data-id="heading-10">2. ç¬¬äºŒå±‚ï¼š<code>Columns&lt;D&gt; = Column&lt;D&gt;[]</code></h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">namespace</span> <span class="hljs-title class_">VxeGridPropTypes</span> {  
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">Column</span>&lt;D = <span class="hljs-built_in">any</span>&gt; = <span class="hljs-title class_">VxeTableDefines</span>.<span class="hljs-property">ColumnOptions</span>&lt;D&gt;  
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">Columns</span>&lt;D = <span class="hljs-built_in">any</span>&gt; = <span class="hljs-title class_">Column</span>&lt;D&gt;[]
}
</code></pre>
<p>å½“ä½ ç”¨çš„æ˜¯ <code>Columns&lt;RowVO&gt;</code> æ—¶ï¼š</p>
<ul>
<li><code>Columns&lt;D&gt;</code> â†’ <code>Columns&lt;RowVO&gt;</code></li>
<li><code>= Column&lt;D&gt;[]</code> è¿™ä¸€è¡Œé‡Œçš„ <code>D</code> åŒæ ·è¢«æ›¿æ¢æˆ <code>RowVO</code>ï¼Œå˜æˆï¼š</li>
<li><code>Columns&lt;RowVO&gt; = Column&lt;RowVO&gt;[]</code></li>
</ul>
<p>æ¥ç€ï¼š</p>
<ul>
<li><code>Column&lt;D&gt; = VxeTableDefines.ColumnOptions&lt;D&gt;</code></li>
<li>ä¹Ÿä¼šå˜æˆï¼š<code>Column&lt;RowVO&gt; = VxeTableDefines.ColumnOptions&lt;RowVO&gt;</code></li>
</ul>
<p>æ‰€ä»¥ï¼š</p>
<blockquote>
<p><code>columns</code> çš„æ¯ä¸€é¡¹ç±»å‹å°±æ˜¯ <code>ColumnOptions&lt;RowVO&gt;</code>ã€‚</p>
</blockquote>
<h3 data-id="heading-11">ä¸ƒã€ç¬¬ä¸‰å±‚ï¼š<code>ColumnOptions&lt;D&gt;</code> é‡Œ <code>D</code> çœŸæ­£ç”¨åœ¨å“ªé‡Œï¼Ÿ</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ColumnOptions</span>&lt;D = <span class="hljs-built_in">any</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">VxeColumnProps</span>&lt;D&gt; {  
  children?: <span class="hljs-title class_">ColumnOptions</span>&lt;D&gt;[]  
  slots?: <span class="hljs-title class_">VxeColumnPropTypes</span>.<span class="hljs-property">Slots</span>&lt;D&gt;
}
</code></pre>
<p>ç»§ç»­æ›¿æ¢ï¼š</p>
<ul>
<li><code>ColumnOptions&lt;D&gt;</code> â†’ <code>ColumnOptions&lt;RowVO&gt;</code></li>
<li><code>extends VxeColumnProps&lt;D&gt;</code> â†’ å˜æˆ <code>extends VxeColumnProps&lt;RowVO&gt;</code></li>
<li><code>children?: ColumnOptions&lt;D&gt;[]</code> â†’ å˜æˆ <code>children?: ColumnOptions&lt;RowVO&gt;[]</code></li>
<li><code>slots?: Slots&lt;D&gt;</code> â†’ å˜æˆ <code>slots?: Slots&lt;RowVO&gt;</code></li>
</ul>
<p>å…³é”®ç‚¹ï¼š<code>ColumnOptions&lt;RowVO&gt;</code> æœ¬èº«å®šä¹‰äº†ã€Œåˆ—é…ç½®ã€çš„ç»“æ„å®ƒç»§æ‰¿çš„ <code>VxeColumnProps&lt;RowVO&gt;</code> + <code>Slots&lt;RowVO&gt;</code> ç­‰åœ°æ–¹ï¼Œä¼šåœ¨ã€Œéœ€è¦è¡Œæ•°æ®çš„å›è°ƒã€é‡Œç”¨åˆ° <code>RowVO</code>ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title function_">formatter</span>(<span class="hljs-attr">params</span>: { <span class="hljs-attr">row</span>: <span class="hljs-title class_">RowVO</span>; ... })
<span class="hljs-title function_">className</span>(<span class="hljs-attr">params</span>: { <span class="hljs-attr">row</span>: <span class="hljs-title class_">RowVO</span>; ... })
</code></pre>
<h2 data-id="heading-12">å…«ã€æˆ‘åœ¨å­¦ä¹ æ—¶å€™çš„ç–‘æƒ‘ï¼Ÿ</h2>
<p>æˆ‘å½“æ—¶å¹¶ä¸ç†è§£<code>TypeScript</code> åšçš„æ˜¯ç»Ÿä¸€æ›¿æ¢</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// æŠŠ D æ¢æˆ RowVOï¼š</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Columns</span>&lt;<span class="hljs-title class_">RowVO</span>&gt; = <span class="hljs-title class_">Column</span>&lt;<span class="hljs-title class_">RowVO</span>&gt;[]

<span class="hljs-comment">// å†æŠŠ Column å±•å¼€ï¼š</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Column</span>&lt;<span class="hljs-title class_">RowVO</span>&gt; = <span class="hljs-title class_">VxeTableDefines</span>.<span class="hljs-property">ColumnOptions</span>&lt;<span class="hljs-title class_">RowVO</span>&gt;

<span class="hljs-comment">// åˆèµ·æ¥å°±æ˜¯ï¼š</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Columns</span>&lt;<span class="hljs-title class_">RowVO</span>&gt; = <span class="hljs-title class_">VxeTableDefines</span>.<span class="hljs-property">ColumnOptions</span>&lt;<span class="hljs-title class_">RowVO</span>&gt;[]
</code></pre>
<p>å°±æ‹¿æ–‡ç« ç¤ºä¾‹çš„ä»£ç æ¥çœ‹ï¼Œ<code>TypeScript</code> ä¼šæŠŠå‡½æ•°ä½“ä¸­æ‰€æœ‰çš„<code>&lt;T&gt;</code>éƒ½
æ›¿æ¢æˆä½ åˆ¶å®šçš„ç±»å‹ã€‚</p>
<p>ä¸ç†è§£çš„ä»£ç ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">Column</span>&lt;D = <span class="hljs-built_in">any</span>&gt; = <span class="hljs-title class_">VxeTableDefines</span>.<span class="hljs-property">ColumnOptions</span>&lt;D&gt;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">Columns</span>&lt;D = <span class="hljs-built_in">any</span>&gt; = <span class="hljs-title class_">Column</span>&lt;D&gt;[]
</code></pre>
<p>æˆ‘å½“ç‰¹åˆ«ä¸èƒ½ç†è§£<code> Column&lt;D&gt;[]</code>çš„<code>&lt;D&gt;</code>æ˜¯æ€ä¹ˆå˜æˆ<code>&lt;RowVO&gt;</code>çš„ã€‚ç›´åˆ°æˆ‘æ˜ç™½äº†<code>TypeScript</code>ä¼šåšç»Ÿä¸€æ›¿æ¢ï¼Œæ ¹æœ¬ä¸æ˜¯æŒ‰æ•°æ®ä¼ å‚çš„é€»è¾‘å»åšçš„ã€‚</p>
<h2 data-id="heading-13">ä¹ã€æŠŠæ•´ä¸ªé“¾è·¯ä¸²èµ·æ¥ï¼ˆä»å¤–åˆ°å†…ï¼‰</h2>
<p>ä½ å†™äº†ï¼š</p>
<pre><code class="hljs language-ts" lang="ts">reactive&lt;<span class="hljs-title class_">VxeGridProps</span>&lt;<span class="hljs-title class_">RowVO</span>&gt;&gt;({...})
</code></pre>
<p>äºæ˜¯ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title class_">VxeGridProps</span>&lt;D&gt; â†’ <span class="hljs-title class_">VxeGridProps</span>&lt;<span class="hljs-title class_">RowVO</span>&gt;
<span class="hljs-keyword">extends</span> <span class="hljs-title class_">VxeTableProps</span>&lt;D&gt; â†’ <span class="hljs-keyword">extends</span> <span class="hljs-title class_">VxeTableProps</span>&lt;<span class="hljs-title class_">RowVO</span>&gt;
columns?: <span class="hljs-title class_">Columns</span>&lt;D&gt; â†’ columns?: <span class="hljs-title class_">Columns</span>&lt;<span class="hljs-title class_">RowVO</span>&gt;
</code></pre>
<p>ç„¶åï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title class_">Columns</span>&lt;D&gt; = <span class="hljs-title class_">Column</span>&lt;D&gt;[] â†’ <span class="hljs-title class_">Columns</span>&lt;<span class="hljs-title class_">RowVO</span>&gt; = <span class="hljs-title class_">Column</span>&lt;<span class="hljs-title class_">RowVO</span>&gt;[]
<span class="hljs-title class_">Column</span>&lt;D&gt; = <span class="hljs-title class_">ColumnOptions</span>&lt;D&gt; â†’ <span class="hljs-title class_">Column</span>&lt;<span class="hljs-title class_">RowVO</span>&gt; = <span class="hljs-title class_">ColumnOptions</span>&lt;<span class="hljs-title class_">RowVO</span>&gt;
</code></pre>
<p>å†å¾€ä¸‹ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title class_">ColumnOptions</span>&lt;D&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">VxeColumnProps</span>&lt;D&gt; â†’ <span class="hljs-title class_">ColumnOptions</span>&lt;<span class="hljs-title class_">RowVO</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">VxeColumnProps</span>&lt;<span class="hljs-title class_">RowVO</span>&gt;
</code></pre>
<p>æœ€ç»ˆæ•ˆæœï¼š</p>
<ul>
<li><code>data</code> çš„ç±»å‹æ˜¯ï¼š<code>RowVO[]</code></li>
<li>æ‰€æœ‰å›è°ƒé‡Œæ¶‰åŠã€Œè¡Œæ•°æ®ã€çš„åœ°æ–¹ï¼Œç±»å‹å‚æ•°æ˜¯ <code>RowVO</code></li>
</ul>
<h2 data-id="heading-14">åã€æ€»ç»“è¿™æ¬¡æ¡ˆä¾‹</h2>
<ul>
<li><code>RowVO</code>ï¼šæè¿° â€œä¸€è¡Œæ•°æ®é•¿ä»€ä¹ˆæ ·â€</li>
<li><code>VxeGridProps&lt;RowVO&gt;</code>ï¼šå‘Šè¯‰è¡¨æ ¼ã€Œæˆ‘çš„æ¯ä¸€è¡Œæ•°æ®éƒ½æ˜¯ <code>RowVO</code>ã€</li>
<li>æ³›å‹å‚æ•° <code>&lt;RowVO&gt;</code> ä¼šä¸€å±‚å±‚å¾€ä¸‹ä¼ ï¼Œå‡¡æ˜¯ç±»å‹é‡Œå†™äº† <code>&lt;D&gt;</code> çš„åœ°æ–¹ï¼Œå°±ä¼šå˜æˆ <code>&lt;RowVO&gt;</code></li>
</ul>
<p>ä½ ç°åœ¨å·²ç»ä¸æ˜¯ â€œä¸æ‡‚æ³›å‹çš„å°ç™½â€ äº†ï¼Œä½ å·²ç»èƒ½ï¼š</p>
<ul>
<li>çœ‹æ‡‚ã€Œç±»å‹å‚æ•°æ˜¯æ€ä¹ˆä¸€å±‚ä¸€å±‚ä¼ ä¸‹å»çš„ã€</li>
<li>é¡ºç€ <code>VxeGridProps&lt;RowVO&gt; â†’ Columns&lt;RowVO&gt; â†’ ColumnOptions&lt;RowVO&gt;</code> è¿™ä¸€æ•´æ¡é“¾è·¯å¾€ä¸‹è¿½</li>
</ul>
<p>è¿™å°±å·²ç»æ˜¯éå¸¸æ‰å®çš„æ³›å‹ç†è§£äº†ã€‚</p>
<h3 data-id="heading-15">æ€»ç»“</h3>
<ol>
<li>æ³›å‹çš„æ ¸å¿ƒæ˜¯ã€Œç»™ç±»å‹åŠ å‚æ•°ã€ï¼Œä½¿ç”¨æ—¶å†æŒ‡å®šå…·ä½“ç±»å‹ï¼Œå¦‚ <code>Array&lt;string&gt;</code>ã€<code>VxeGridProps&lt;RowVO&gt;</code>ï¼›</li>
<li>åµŒå¥—æ³›å‹çš„æœ¬è´¨æ˜¯ã€Œç±»å‹å‚æ•°æœ¬èº«ä¹Ÿæ˜¯æ³›å‹ã€ï¼Œå‚æ•°ä¼šé€å±‚ä¼ é€’æ›¿æ¢ï¼ˆ<code>D</code> â†’ <code>RowVO</code>ï¼‰ï¼›</li>
</ol>
<p>ä»¥ä¸Šä¾¿æ˜¯å¯¹æ³›å‹çš„åˆ†äº«ï¼Œæ¬¢è¿å¤§å®¶æŒ‡æ­£è®¨è®ºï¼Œä¸å¤§å®¶å…±å‹‰ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æŒ‘æˆ˜å…¨æ ˆæ¡†æ¶çš„æé™ï¼šä»… 7kb çš„ Lupine.js å‘å¸ƒäº†]]></title>    <link>https://juejin.cn/post/7603588665567051816</link>    <guid>https://juejin.cn/post/7603588665567051816</guid>    <pubDate>2026-02-06T22:55:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603588665567051816" data-draft-id="7603574149773574196" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æŒ‘æˆ˜å…¨æ ˆæ¡†æ¶çš„æé™ï¼šä»… 7kb çš„ Lupine.js å‘å¸ƒäº†"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2026-02-06T22:55:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="uuware"/> <meta itemprop="url" content="https://juejin.cn/user/2339389938342535"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æŒ‘æˆ˜å…¨æ ˆæ¡†æ¶çš„æé™ï¼šä»… 7kb çš„ Lupine.js å‘å¸ƒäº†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2339389938342535/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    uuware
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T22:55:52.000Z" title="Fri Feb 06 2026 22:55:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Lupine.jsï¼šä¸€æ¬¾"æå…¶"é«˜æ•ˆçš„ Web æ¡†æ¶</h2>
<p>åœ¨ä¸€ä¸ªè¢«åºå¤§çš„å…ƒæ¡†æ¶ (Meta-frameworks) å’Œå¤æ‚æ„å»ºé“¾ä¸»å¯¼çš„ä¸–ç•Œé‡Œï¼Œ<strong>Lupine.js</strong> æå‡ºäº†ä¸€ä¸ªç®€å•çš„é—®é¢˜ï¼š<em>å¦‚æœæˆ‘ä»¬èƒ½æ‹¥æœ‰ç°ä»£å…¨æ ˆæ¡†æ¶çš„å¨åŠ›ï¼Œå´ä¸éœ€è¦é‚£äº›è‡ƒè‚¿çš„è´Ÿæ‹…ï¼Œä¼šæ€æ ·ï¼Ÿ</em></p>
<p>Lupine.js æ˜¯ä¸€ä¸ª <strong>è½»é‡çº§ (7kb gzipped)</strong> çš„ <strong>å…¨æ ˆ</strong> Web æ¡†æ¶ï¼Œå®ƒç»“åˆäº†ç±» React çš„å‰ç«¯ä½“éªŒå’Œç±» Express çš„åç«¯æ¶æ„ã€‚å®ƒæ˜¯å®Œå…¨ä»é›¶å¼€å§‹è®¾è®¡ï¼Œæ—¨åœ¨å®ç°æè‡´çš„é€Ÿåº¦ã€ç®€æ´å’Œé«˜æ•ˆã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0aad91329f984831a09dd60e9c663d3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXV3YXJl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771023738&amp;x-signature=Qyi9XESXPC%2F3Kp80SXr%2Fd%2BtxKLg%3D" alt="og-image.png" loading="lazy"/></p>
<h3 data-id="heading-1">ä¸ºä»€ä¹ˆé€‰æ‹© Lupine.jsï¼Ÿ</h3>
<h4 data-id="heading-2">1. ğŸª¶ æå…¶è½»é‡çš„å‰ç«¯</h4>
<p><code>lupine.web</code> å‰ç«¯åŒ…æå…¶å°å·§â€”â€”ä»… <strong>7kb gzipped</strong>ã€‚ç„¶è€Œï¼Œå®ƒä¿ç•™äº†ä½ ç†Ÿæ‚‰å’Œå–œçˆ±çš„å¼€å‘ä½“éªŒï¼š<strong>TSX è¯­æ³•</strong> (React JSX)ã€ç»„ä»¶å’Œ Hooksã€‚æ²¡æœ‰æ²‰é‡çš„è¿è¡Œæ—¶éœ€è¦ä¸‹è½½ï¼Œè¿™æ„å‘³ç€å³ä½¿åœ¨æ…¢é€Ÿç½‘ç»œä¸‹ï¼Œä½ çš„é¡µé¢ä¹Ÿèƒ½ç¬é—´åŠ è½½ã€‚</p>
<h4 data-id="heading-3">2. âš¡ å†…ç½®æœåŠ¡ç«¯æ¸²æŸ“ (SSR)</h4>
<p>å¤§å¤šæ•°æ¡†æ¶å°† SSR è§†ä¸ºé™„åŠ åŠŸèƒ½ã€‚åœ¨ Lupine ä¸­ï¼ŒSSR æ˜¯ <strong>ä¸€ç­‰å…¬æ°‘</strong>ã€‚<code>lupine.api</code> åç«¯ç»è¿‡ä¼˜åŒ–ï¼Œèƒ½å¤Ÿè‡ªåŠ¨åœ¨æœåŠ¡å™¨ä¸Šæ¸²æŸ“ä½ çš„å‰ç«¯é¡µé¢ã€‚</p>
<ul>
<li><strong>æ— æ ·å¼é—ªçƒ (No FOUC)</strong>: å…³é”® CSS ç”±æœåŠ¡ç«¯æ³¨å…¥ã€‚</li>
<li><strong>é›¶é…ç½® SEO</strong>: Meta æ ‡ç­¾ (<code>og:image</code>, <code>description</code>) åœ¨é¡µé¢ç¦»å¼€æœåŠ¡å™¨å‰å°±å·²ç»è®¡ç®—å®Œæ¯•ã€‚</li>
<li><strong>ç¤¾äº¤åˆ†äº«å°±ç»ª</strong>: åˆ†äº«åˆ° Twitter/å¾®ä¿¡/Facebook çš„é“¾æ¥å¼€ç®±å³ç”¨ï¼Œæ•ˆæœå®Œç¾ã€‚</li>
</ul>
<h4 data-id="heading-4">3. ğŸ¨ åŸç”Ÿ CSS-in-JS å¼•æ“</h4>
<p>å‘Šåˆ«é…ç½® PostCSSã€Tailwind æˆ– styled-components çš„çƒ¦æ¼ã€‚Lupine å†…ç½®äº†ä¸€ä¸ªå¼ºå¤§çš„ CSS-in-JS å¼•æ“ã€‚</p>
<ul>
<li><strong>æ ·å¼éš”ç¦»</strong>: æ ·å¼è‡ªåŠ¨éš”ç¦»åˆ°ä½ çš„ç»„ä»¶ã€‚</li>
<li><strong>åµŒå¥—æ”¯æŒ</strong>: æ”¯æŒ <code>.parent &amp;</code> è¯­æ³•ã€‚</li>
<li><strong>é«˜æ€§èƒ½</strong>: æ ·å¼åœ¨ SSR æœŸé—´è¢«é«˜æ•ˆæå–å’Œæ³¨å…¥ã€‚</li>
</ul>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> <span class="hljs-title function_">Button</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> css = {
    <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'#0ac92a'</span>,
    <span class="hljs-string">'&amp;:hover'</span>: {
      <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'#08a823'</span>,
    },
  };
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">css</span>=<span class="hljs-string">{css}</span>&gt;</span>ç‚¹å‡»æˆ‘<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;
};
</code></pre>
<h4 data-id="heading-5">4. ğŸš€ å…¨æ ˆåˆä¸€</h4>
<p>Lupine ä¸ä»…ä»…æ˜¯ä¸€ä¸ªå‰ç«¯åº“ï¼›å®ƒæ˜¯å®Œæ•´çš„åº”ç”¨è§£å†³æ–¹æ¡ˆã€‚</p>
<ul>
<li><strong>åç«¯ (<code>lupine.api</code>)</strong>: ä¸€ä¸ªé«˜æ•ˆã€æç®€çš„ Node.js æ¡†æ¶ï¼Œç±»ä¼¼äº Expressã€‚</li>
<li><strong>å‰ç«¯ (<code>lupine.web</code>)</strong>: ä¸€ä¸ªå“åº”å¼çš„ UI åº“ã€‚</li>
<li><strong>å¼€å‘ä½“éªŒ</strong>: è¿è¡Œ <code>npm run dev</code>ï¼Œå³å¯åœ¨åŒä¸€ä¸ª VS Code ä¼šè¯ä¸­åŒæ—¶è°ƒè¯•å‰ç«¯å’Œåç«¯ã€‚</li>
</ul>
<h3 data-id="heading-6">å¿«é€Ÿå¼€å§‹</h3>
<p>å‡†å¤‡å¥½å°è¯•äº†å—ï¼Ÿå‡ ç§’é’Ÿå°±èƒ½æ­å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®ã€‚</p>
<h4 data-id="heading-7">ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºé¡¹ç›®</h4>
<p>ä½¿ç”¨æˆ‘ä»¬çš„ CLI å·¥å…·åˆ›å»ºä¸€ä¸ªæ–°åº”ç”¨ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">npx create-lupine@latest my-awesome-app
</code></pre>
<h4 data-id="heading-8">ç¬¬äºŒæ­¥ï¼šè¿è¡Œé¡¹ç›®</h4>
<p>è¿›å…¥ç›®å½•å¹¶å¯åŠ¨å¼€å‘æœåŠ¡å™¨ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> my-awesome-app
npm install
npm run dev
</code></pre>
<p>è®¿é—® <code>http://localhost:11080</code>ï¼Œä½ å°†çœ‹åˆ°ä½ çš„ç¬¬ä¸€ä¸ª Lupine åº”ç”¨æ­£åœ¨è¿è¡Œï¼</p>
<h3 data-id="heading-9">ä»£ç æ´»è·ƒåº¦</h3>
<p>Lupine æ­£åœ¨ç§¯æå¼€å‘ä¸­ã€‚ä½ å¯ä»¥ç›´æ¥åœ¨ GitHub ä¸ŠæŸ¥çœ‹æˆ‘ä»¬çš„ä»£ç é¢‘ç‡å’Œè´¡çŒ®ï¼š
ğŸ‘‰ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fuuware%2Flupine.js" target="_blank" title="https://github.com/uuware/lupine.js" ref="nofollow noopener noreferrer">github.com/uuware/lupiâ€¦</a></p>
<h3 data-id="heading-10">æ€»ç»“</h3>
<p>Lupine.js éå¸¸é€‚åˆè¿™æ ·çš„å¼€å‘è€…ï¼š</p>
<ul>
<li><strong>æŒæ§åŠ›</strong>: æƒ³è¦äº†è§£æŠ€æœ¯æ ˆçš„æ¯ä¸€ä¸ªéƒ¨åˆ†ã€‚</li>
<li><strong>é€Ÿåº¦</strong>: æƒ³ä¸ºç”¨æˆ·æä¾›æœ€å¿«çš„ä½“éªŒã€‚</li>
<li><strong>ç®€æ´</strong>: æ²¡æœ‰éšè—çš„é­”æ³•ï¼Œåªæœ‰å¹²å‡€çš„ä»£ç ã€‚</li>
</ul>
<p>ç»™ <strong>Lupine.js</strong> åœ¨ GitHub ä¸Šç‚¹ä¸ª Starï¼Œå¹¶åœ¨ä½ çš„ä¸‹ä¸€ä¸ªé¡¹ç›®ä¸­å°è¯•ä¸€ä¸‹å§ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3ä¸­éå“åº”å¼çš„å…¨å±€çŠ¶æ€ç®¡ç†]]></title>    <link>https://juejin.cn/post/7603587738160578623</link>    <guid>https://juejin.cn/post/7603587738160578623</guid>    <pubDate>2026-02-07T00:14:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603587738160578623" data-draft-id="7603563360329662506" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3ä¸­éå“åº”å¼çš„å…¨å±€çŠ¶æ€ç®¡ç†"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-02-07T00:14:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="EchoEcho"/> <meta itemprop="url" content="https://juejin.cn/user/2920774267837208"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3ä¸­éå“åº”å¼çš„å…¨å±€çŠ¶æ€ç®¡ç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2920774267837208/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    EchoEcho
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T00:14:10.000Z" title="Sat Feb 07 2026 00:14:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨<code>vue</code>é¡¹ç›®ä¸­ï¼Œä¸€èˆ¬è¯´åˆ°çŠ¶æ€ç®¡ç†ï¼Œæˆ‘ä»¬ä¼šæƒ³åˆ°<code>pinia</code>ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç®¡ç†éœ€è¦åœ¨å¤šä¸ªé¡µé¢ã€ç»„ä»¶é—´å…±äº«çš„æ•°æ®ï¼Œå¹¶ä¸”æ ¹æ®æ•°æ®çš„æ›´æ–°è§¦å‘ç›¸å…³çš„æ¸²æŸ“æ›´æ–°ã€‚ä½†å¦‚æœæ˜¯æ•°æ®å˜åŒ–ä¸ä¼šå¼•èµ·é¡µé¢åˆ·æ–°çš„å…¨å±€æ•°æ®å‘¢ï¼Ÿ</p>
<blockquote>
<p>Â æ¯”å¦‚æˆ‘å½“å‰å¼€å‘çš„é¡¹ç›®ä¸­ï¼Œéœ€è¦åœ¨é¡¹ç›®åˆå§‹åŒ–ä¹‹åè·å–å¯¹åº”çš„å¼•æ“å®ä¾‹ï¼Œè¯¥å®ä¾‹æä¾›ç›¸å…³<code>api</code>ç”¨äºå¤„ç†é¡µé¢é€»è¾‘ï¼Œä½†è¯¥å®ä¾‹å¹¶ä¸ä¼šè§¦å‘é¡µé¢çš„æ›´æ–°ï¼Œæ­¤æ—¶å°±éœ€è¦ä¸€ä¸ªÂ <strong>éå“åº”å¼çš„å…¨å±€çŠ¶æ€ç®¡ç†</strong>Â --Â <code>globalState</code></p>
</blockquote>
<h5 data-id="heading-0">é€‚ç”¨åœºæ™¯ï¼š</h5>
<ul>
<li>å…¨å±€é…ç½®ã€ç¼“å­˜ã€ä¸´æ—¶æ•°æ®</li>
<li>è·¨é¡µé¢/ç»„ä»¶çš„äº‹ä»¶é€šçŸ¥</li>
<li>ä¸éœ€è¦å“åº”å¼çš„æ•°æ®å…±äº«</li>
</ul>
<h5 data-id="heading-1">ä¸é€‚ç”¨åœºæ™¯</h5>
<ul>
<li>éœ€è¦æ•°æ®å˜åŒ–æ—¶è‡ªåŠ¨åˆ·æ–°é¡µé¢çš„åœºæ™¯ã€ç”¨<code>Pinia</code>æˆ–<code>Vuex</code>ã€‘</li>
</ul>
<h5 data-id="heading-2">é€»è¾‘æ¢³ç†ï¼š</h5>
<ol>
<li>Â å®šä¹‰ä¸€ä¸ª<code>globalState</code>ç±»ï¼Œå…¨å±€åªæœ‰ä¸€ä¸ªå®ä¾‹</li>
<li>ç»´æŠ¤ä¸€ä»½<code>state</code>æ•°æ®ï¼Œæä¾›<code>set</code>ã€<code>get</code>ã€<code>has</code>ã€<code>delete</code>ã€<code>clear</code></li>
<li>æä¾›äº‹ä»¶æ€»çº¿åŠŸèƒ½ï¼Œç”¨äºåœ¨ä¸åŒç»„ä»¶é—´â€œå¹¿æ’­æ¶ˆæ¯â€ï¼šÂ <code>on</code>ã€ç›‘å¬äº‹ä»¶ã€‘ã€<code>emit</code>ã€è§¦å‘äº‹ä»¶ã€‘ã€<code>off</code>ã€ç§»é™¤ç›‘å¬ã€‘</li>
</ol>
<h4 data-id="heading-3">å…·ä½“å®ç°ä»£ç ï¼š</h4>
<p><code>/stores/globalState.ts</code></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å…¨å±€çŠ¶æ€ç®¡ç†ï¼ˆéå“åº”å¼ï¼‰</span>
<span class="hljs-comment">/**
Â * è·¨é¡µé¢/ç»„ä»¶å…±äº«æ•°æ®ï¼Œä½†åˆä¸éœ€è¦å“åº”å¼ï¼ˆä¸éœ€è¦è‡ªåŠ¨åˆ·æ–°UIï¼‰ã€‚
Â * å­˜å‚¨å…¨å±€é…ç½®ã€ç¼“å­˜ã€ä¸´æ—¶æ•°æ®ç­‰ã€‚
Â * é¿å…æ±¡æŸ“ windowï¼Œæ¯”ç›´æ¥ç”¨ window.xxx æ›´å®‰å…¨ã€å¯æ§ã€æ˜“ç»´æŠ¤ã€‚
Â * æ¯” Pinia/Vuex æ›´è½»é‡ï¼Œé€‚åˆå­˜å‚¨ä¸éœ€è¦å“åº”å¼çš„æ•°æ®ã€‚
Â */</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalState</span> {
Â  Â  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-attr">instance</span>: <span class="hljs-title class_">GlobalState</span>
Â  Â  <span class="hljs-keyword">private</span> <span class="hljs-attr">state</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()
Â  Â  <span class="hljs-keyword">private</span> <span class="hljs-attr">eventListeners</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Function</span>[]&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()

Â  Â  <span class="hljs-keyword">static</span> <span class="hljs-title function_">getInstance</span>(): <span class="hljs-title class_">GlobalState</span> {
Â  Â  Â  Â  <span class="hljs-keyword">if</span>(!<span class="hljs-title class_">GlobalState</span>.<span class="hljs-property">instance</span>) {
Â  Â  Â  Â  Â  Â  <span class="hljs-title class_">GlobalState</span>.<span class="hljs-property">instance</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GlobalState</span>()
Â  Â  Â  Â  }
Â  Â  Â  Â  <span class="hljs-keyword">return</span> <span class="hljs-title class_">GlobalState</span>.<span class="hljs-property">instance</span>
Â  Â  }
Â  Â Â 
Â  Â  <span class="hljs-title function_">set</span>(<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">value</span>: <span class="hljs-built_in">any</span>): <span class="hljs-built_in">void</span> {
Â  Â  Â  Â  <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-title function_">set</span>(key, value)
Â  Â  }

Â  Â  <span class="hljs-title function_">get</span>(<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">any</span> {
Â  Â  Â  Â  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-title function_">get</span>(key)
Â  Â  }

Â  Â  <span class="hljs-title function_">has</span>(<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">boolean</span> {
Â  Â  Â  Â  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-title function_">has</span>(key)
Â  Â  }

Â  Â  <span class="hljs-title function_">delete</span>(<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">boolean</span> {
Â  Â  Â  Â  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-title function_">delete</span>(key)
Â  Â  }

Â  Â  <span class="hljs-title function_">clear</span>(): <span class="hljs-built_in">void</span> {
Â  Â  Â  Â  <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-title function_">clear</span>()
Â  Â  }

Â  Â  <span class="hljs-comment">// æ–°å¢äº‹ä»¶æ€»çº¿åŠŸèƒ½</span>
Â  Â  <span class="hljs-title function_">on</span>(<span class="hljs-attr">eventName</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">callback</span>: <span class="hljs-title class_">Function</span>): <span class="hljs-built_in">void</span> {
Â  Â  Â  Â  <span class="hljs-keyword">if</span>(!<span class="hljs-variable language_">this</span>.<span class="hljs-property">eventListeners</span>.<span class="hljs-title function_">has</span>(eventName)) {
Â  Â  Â  Â  Â  Â  <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventListeners</span>.<span class="hljs-title function_">set</span>(eventName, [])
Â  Â  Â  Â  }
Â  Â  Â  Â  <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventListeners</span>.<span class="hljs-title function_">get</span>(eventName)?.<span class="hljs-title function_">push</span>(callback)
Â  Â  }
Â  Â Â 
Â  Â  <span class="hljs-title function_">emit</span>(<span class="hljs-attr">eventName</span>: <span class="hljs-built_in">string</span>, data?: <span class="hljs-built_in">any</span>): <span class="hljs-built_in">void</span> {
Â  Â  Â  Â  <span class="hljs-keyword">const</span> listeners = <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventListeners</span>.<span class="hljs-title function_">get</span>(eventName)
Â  Â  Â  Â  <span class="hljs-keyword">if</span>(listeners) {
Â  Â  Â  Â  Â  Â  listeners.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">callback</span> =&gt;</span> {
Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-keyword">try</span> {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-title function_">callback</span>(data)
Â  Â  Â  Â  Â  Â  Â  Â  } <span class="hljs-keyword">catch</span> (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'äº‹ä»¶å›è°ƒæ‰§è¡Œé”™è¯¯:'</span>, error)
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  }
Â  Â  }

Â  Â  <span class="hljs-title function_">off</span>(<span class="hljs-attr">eventName</span>: <span class="hljs-built_in">string</span>, callback?: <span class="hljs-title class_">Function</span>): <span class="hljs-built_in">void</span> {
Â  Â  Â  Â  <span class="hljs-keyword">if</span> (!callback) {
Â  Â  Â  Â  Â  Â  <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventListeners</span>.<span class="hljs-title function_">delete</span>(eventName)
Â  Â  Â  Â  } <span class="hljs-keyword">else</span> {
Â  Â  Â  Â  Â  Â  <span class="hljs-keyword">const</span> listeners = <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventListeners</span>.<span class="hljs-title function_">get</span>(eventName)
Â  Â  Â  Â  Â  Â  <span class="hljs-keyword">if</span> (listeners) {
Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-keyword">const</span> index = listeners.<span class="hljs-title function_">indexOf</span>(callback)
Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-keyword">if</span> (index &gt; -<span class="hljs-number">1</span>) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  listeners.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>)
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }

}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> globalState = <span class="hljs-title class_">GlobalState</span>.<span class="hljs-title function_">getInstance</span>()
</code></pre>
<h5 data-id="heading-4">ä½¿ç”¨</h5>
<ol>
<li>ç»„ä»¶A --Â <code>a.vue</code>Â  ã€å½“å¼•æ“å®ä¾‹åŒ–æˆåŠŸåï¼Œè®¾ç½®å¼•æ“æ•°æ®ï¼Œå¹¶è§¦å‘å¹¿æ’­ï¼Œåœ¨é€‚åˆçš„æ—¶æœºé”€æ¯ç›¸å…³æ•°æ®ã€‘</li>
</ol>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// a.vue å½“å¼•æ“å®ä¾‹åŒ–æˆåŠŸåï¼Œè®¾ç½®å¼•æ“æ•°æ®ï¼Œå¹¶è§¦å‘å¹¿æ’­</span>
<span class="hljs-keyword">import</span> { globalState } from <span class="hljs-string">"@/stores/globalState"</span>;
<span class="hljs-keyword">const</span> InstanceHasInited = (<span class="hljs-keyword">data</span>) =&gt; {
Â  Â  Â  <span class="hljs-keyword">if</span> (engine) {
Â  Â  Â  Â  Â  Â  globalState.<span class="hljs-keyword">set</span>(<span class="hljs-string">"engineInstance"</span>, <span class="hljs-keyword">data</span>);
Â  Â  Â  Â  Â  Â  <span class="hljs-comment">// è§¦å‘äº‹ä»¶ï¼Œé€šçŸ¥å…¶ä»–ç»„ä»¶</span>
Â  Â  Â  Â  Â  Â  globalState.emit(<span class="hljs-string">"engineInstance:created"</span>, <span class="hljs-keyword">data</span>);
Â  Â  Â  }
});
<span class="hljs-comment">// é”€æ¯ç›¸å…³æ•°æ®</span>
onUnmounted(() =&gt; {
Â  globalState.delete(<span class="hljs-string">"engineInstance"</span>);
Â  globalState.off(<span class="hljs-string">"engineInstance:created"</span>);
});
</code></pre>
<ol>
<li>ç»„ä»¶B --Â <code>b.vue</code>Â  ã€åœ¨éœ€è¦ä½¿ç”¨å¼•æ“<code>api</code>è·å–æ•°æ®çš„ä½ç½®æ·»åŠ ç›‘å¬ã€‘</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript">
<span class="hljs-keyword">import</span> { globalState } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/globalState"</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleInstanceCreated</span> = (<span class="hljs-params">engine: Engine</span>) =&gt; {
Â  Â  <span class="hljs-keyword">if</span>(engine) {
Â  Â  Â  Â  <span class="hljs-comment">// è°ƒç”¨ç›¸å…³api</span>
Â  Â  }
}
<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
Â  <span class="hljs-comment">// ç›‘å¬å¼•æ“å®ä¾‹åˆ›å»ºäº‹ä»¶</span>
Â  globalState.<span class="hljs-title function_">on</span>(<span class="hljs-string">"engineInstance:created"</span>, handleInstanceCreated);
})
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android ç½‘ç»œå­ç³»ç»Ÿé¢è¯•çŸ¥è¯†ç‚¹å…¨è§£]]></title>    <link>https://juejin.cn/post/7603595309232029706</link>    <guid>https://juejin.cn/post/7603595309232029706</guid>    <pubDate>2026-02-07T01:36:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603595309232029706" data-draft-id="7603376587652841522" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android ç½‘ç»œå­ç³»ç»Ÿé¢è¯•çŸ¥è¯†ç‚¹å…¨è§£"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-07T01:36:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·341408199125"/> <meta itemprop="url" content="https://juejin.cn/user/570004686782272"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android ç½‘ç»œå­ç³»ç»Ÿé¢è¯•çŸ¥è¯†ç‚¹å…¨è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/570004686782272/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·341408199125
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T01:36:21.000Z" title="Sat Feb 07 2026 01:36:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">ä¸€ã€å®è§‚æ¶æ„ï¼ˆå¿…é—®ï¼‰</h3>
<p><strong>1. NetworkStack çš„å®šä¹‰å’Œç»„æˆ</strong></p>
<pre><code class="hljs language-scss" lang="scss">é—®ï¼šNetworkStack æ˜¯ä»€ä¹ˆï¼Ÿ
ç­”ï¼šä¸æ˜¯å•ä¸€æ¨¡å—ï¼Œè€Œæ˜¯ç½‘ç»œç®¡ç†æ¡†æ¶çš„æ€»ç§°
  â”œâ”€ frameworks_base (ConnectivityService åŸºç¡€)
  â”œâ”€ packages_modules_Connectivity (å¯æ›´æ–°éƒ¨åˆ†ï¼ŒAPEX)
  â”œâ”€ system_netd (å®ˆæŠ¤è¿›ç¨‹)
  â”œâ”€ hardware_ril (ç”µè¯å±‚)
  â””â”€ hardware_interfaces (ç¡¬ä»¶é€‚é…)

å…³é”®è¯ï¼šåˆ†å±‚è§£è€¦ã€APEX å¯æ›´æ–°ã€æ¨¡å—åŒ–
</code></pre>
<p><strong>2. ç³»ç»Ÿå¯åŠ¨æµç¨‹</strong></p>
<pre><code class="hljs language-scss" lang="scss">SystemServer<span class="hljs-selector-class">.main</span>()
  â†“
åˆå§‹åŒ–ç½‘ç»œç›¸å…³æœåŠ¡é¡ºåºï¼ˆé‡ç‚¹è®°ä½ï¼‰ï¼š
  <span class="hljs-number">1</span>. ConnectivityModuleConnector<span class="hljs-selector-class">.init</span>()
  <span class="hljs-number">2</span>. NetworkStackClient<span class="hljs-selector-class">.init</span>()
  <span class="hljs-number">3</span>. NetworkManagementService<span class="hljs-selector-class">.create</span>()  â† netd é€šä¿¡å±‚
  <span class="hljs-number">4</span>. NetworkStatsService<span class="hljs-selector-class">.start</span>()        â† å¿…é¡»åœ¨ NetworkPolicyManager ä¹‹å‰
  <span class="hljs-number">5</span>. <span class="hljs-built_in">NetworkPolicyManagerService</span>()      â† æµé‡é™åˆ¶
  <span class="hljs-number">6</span>. WifiService<span class="hljs-selector-class">.start</span>()                â† WiFi
  <span class="hljs-number">7</span>. ConnectivityService<span class="hljs-selector-class">.start</span>()        â† æ ¸å¿ƒ
  <span class="hljs-number">8</span>. VpnManagerService<span class="hljs-selector-class">.create</span>()
  
<span class="hljs-built_in">systemReady</span>() é˜¶æ®µï¼š
  â”œâ”€ networkManagement<span class="hljs-selector-class">.systemReady</span>()
  â”œâ”€ connectivity<span class="hljs-selector-class">.systemReady</span>()
  â””â”€ NetworkStackClient<span class="hljs-selector-class">.start</span>()         â† çœŸæ­£å¯åŠ¨ NetworkStack
</code></pre>
<p><strong>æ¨¡å—åŠ è½½æ–¹å¼</strong>ï¼ˆé¢è¯•å¸¸é—®ï¼‰ï¼š</p>
<ul>
<li>ä» APEX (<code>com.android.tethering</code>) åŠ è½½</li>
<li>ä½¿ç”¨ AIDL è¿›ç¨‹é—´é€šä¿¡</li>
<li><code>startServiceFromJar()</code> åŠ¨æ€åŠ è½½</li>
</ul>
<hr/>
<h3 data-id="heading-1">äºŒã€æ ¸å¿ƒç»„ä»¶æ·±åº¦ï¼ˆé«˜é¢‘è€ƒç‚¹ï¼‰</h3>
<h4 data-id="heading-2">2.1 ConnectivityServiceï¼ˆæœ€é‡è¦ï¼‰</h4>
<p><strong>èŒè´£äº”å¤§ä»¶</strong>ï¼ˆå¿…èƒŒï¼‰ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> ç½‘ç»œç”Ÿå‘½å‘¨æœŸç®¡ç†
<span class="hljs-bullet">   -</span> NetworkAgent æ³¨å†Œ/æ³¨é”€
<span class="hljs-bullet">   -</span> ç½‘ç»œçŠ¶æ€è½¬æ¢ï¼ˆNASCENT â†’ CONNECTED â†’ LINGERING â†’ DESTROYEDï¼‰

<span class="hljs-bullet">2.</span> ç½‘ç»œè¯·æ±‚åŒ¹é…ç®—æ³•
<span class="hljs-bullet">   -</span> NetworkRequest + NetworkCapabilities åŒ¹é…
<span class="hljs-bullet">   -</span> ç½‘ç»œè¯„åˆ†ï¼ˆNetworkRankerï¼‰
<span class="hljs-bullet">   -</span> é»˜è®¤ç½‘ç»œé€‰æ‹©

<span class="hljs-bullet">3.</span> ç½‘ç»œéªŒè¯æœºåˆ¶
<span class="hljs-bullet">   -</span> NetworkMonitor æ¢æµ‹
<span class="hljs-bullet">   -</span> éªŒè¯æµç¨‹ï¼šDNS â†’ HTTP â†’ HTTPS â†’ Private DNS
<span class="hljs-bullet">   -</span> éªŒè¯ç»“æœï¼šVALID/PARTIAL/INVALID/SKIP

<span class="hljs-bullet">4.</span> æƒé™å’Œç­–ç•¥ç®¡ç†
<span class="hljs-bullet">   -</span> UID æƒé™æ£€æŸ¥
<span class="hljs-bullet">   -</span> VPN éš”ç¦»
<span class="hljs-bullet">   -</span> èƒŒæ™¯åº”ç”¨é™åˆ¶

<span class="hljs-bullet">5.</span> ç½‘ç»œå›è°ƒé€šçŸ¥
<span class="hljs-bullet">   -</span> NetworkCallback æœºåˆ¶
<span class="hljs-bullet">   -</span> CONNECTIVITY<span class="hljs-emphasis">_ACTION å¹¿æ’­
   - Settings æ•°æ®åº“åŒæ­¥
</span></code></pre>
<p><strong>é‡è¦æ•°æ®ç»“æ„</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java">NetworkAgentInfo:
  â”œâ”€ ç½‘ç»œæ ‡è¯†
  â”‚  â”œâ”€ Network network
  â”‚  â”œâ”€ NetworkInfo networkInfo
  â”‚  â””â”€ LinkProperties linkProperties
  â”‚
  â”œâ”€ çŠ¶æ€è·Ÿè¸ª
  â”‚  â”œâ”€ mCreatedTime (netd åˆ›å»º)
  â”‚  â”œâ”€ mConnectedTime (å¯ç”¨æ—¶é—´)
  â”‚  â”œâ”€ mFirstValidationTime (é¦–æ¬¡éªŒè¯)
  â”‚  â””â”€ mCurrentValidationTime (æœ€æ–°éªŒè¯)
  â”‚
  â”œâ”€ èƒ½åŠ›æè¿°
  â”‚  â””â”€ NetworkCapabilities (INTERNET, NOT_METEREDç­‰)
  â”‚
  â””â”€ ç½‘ç»œè¯„åˆ†
     â””â”€ FullScore (ç”¨äºæ’åº)
</code></pre>
<p><strong>å¸¸è§é¢è¯•é¢˜</strong>ï¼š</p>
<ul>
<li>
<p>Q: ConnectivityService å¦‚ä½•é€‰æ‹©é»˜è®¤ç½‘ç»œï¼Ÿ
A: é€šè¿‡ NetworkRanker å¯¹æ‰€æœ‰å¯ç”¨ç½‘ç»œè¯„åˆ†ï¼Œé€‰æœ€é«˜åˆ†ã€‚è¯„åˆ†è€ƒè™‘ï¼štransportä¼˜å…ˆçº§ã€éªŒè¯çŠ¶æ€ã€ç”¨æˆ·åå¥½ã€æƒé™ç­‰</p>
</li>
<li>
<p>Q: å¦‚ä½•å®ç°åº”ç”¨ç»‘å®šåˆ°ç‰¹å®šç½‘ç»œï¼Ÿ
A: åº”ç”¨è°ƒç”¨ <code>bindProcessToNetwork(network)</code> â†’ ConnectivityService è®¾ç½® socket mark â†’ è·¯ç”±æŸ¥è¯¢æ—¶ä½¿ç”¨ä¸“ç”¨è·¯ç”±è¡¨</p>
</li>
</ul>
<hr/>
<h4 data-id="heading-3">2.2 NetworkAgentInfo ç½‘ç»œä»£ç†ä¿¡æ¯</h4>
<p><strong>çŠ¶æ€æœº</strong>ï¼ˆé¢è¯•å¿…é—®ï¼‰ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚   NASCENT       â”‚
                     â”‚  (æ–°å»ºï¼Œæœªè¿)    â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚   CONNECTED     â”‚
                     â”‚   (å·²è¿æ¥)       â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚   LINGERING     â”‚
                     â”‚   (ä¿æ´»ç­‰é”€æ¯)   â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚   DESTROYED     â”‚
                     â”‚   (å·²é”€æ¯)       â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>å…³é”®æ—¶é—´æˆ³</strong>ï¼ˆå¿…èƒŒï¼‰ï¼š</p>
<ul>
<li><code>mCreatedTime</code> - netd åˆ›å»ºæ—¶é—´</li>
<li><code>mConnectedTime</code> - è¿æ¥å¯ç”¨æ—¶é—´ï¼ˆfirst CONNECTEDï¼‰</li>
<li><code>mFirstValidationTime</code> - é¦–æ¬¡éªŒè¯é€šè¿‡ï¼ˆstickyï¼‰</li>
<li><code>mCurrentValidationTime</code> - æœ€æ–°éªŒè¯ç»“æœ</li>
<li><code>mDestroyedTime</code> - é”€æ¯æ—¶é—´</li>
</ul>
<hr/>
<h4 data-id="heading-4">2.3 ç½‘ç»œéªŒè¯ï¼ˆNetworkMonitorï¼‰</h4>
<p><strong>éªŒè¯æµç¨‹</strong>ï¼ˆé¢è¯•é«˜é¢‘ï¼‰ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">ç½‘ç»œè¿æ¥æˆåŠŸ
  â†“
ConnectivityService åˆ›å»º NetworkMonitor
  â†“
éªŒè¯æ­¥éª¤ï¼ˆé¡ºåºæ‰§è¡Œï¼‰ï¼š
  <span class="hljs-number">1</span>. DNS æ¢æµ‹
     â””â”€ æŸ¥è¯¢ <span class="hljs-string">"www.google.com"</span> (å¯é…ç½®)
     
  <span class="hljs-number">2</span>. HTTP æ¢æµ‹
     â””â”€ <span class="hljs-keyword">GET</span> http://www.google.com/generate_204
     â””â”€ æœŸæœ›ï¼š<span class="hljs-number">204</span> No Content
     
  <span class="hljs-number">3</span>. HTTPS æ¢æµ‹
     â””â”€ <span class="hljs-keyword">GET</span> https://www.google.com/generate_204
     â””â”€ æœŸæœ›ï¼š<span class="hljs-number">204</span> No Content
     
  <span class="hljs-number">4</span>. <span class="hljs-keyword">Private</span> DNS æ¢æµ‹ (å¦‚æœå¯ç”¨)
     â””â”€ DNS over TLS/DoH
     â””â”€ å•ç‹¬éªŒè¯æµç¨‹

éªŒè¯ç»“æœï¼š
  â”œâ”€ VALID (å®Œå…¨è¿æ¥ï¼Œæ‰€æœ‰æ¢æµ‹é€šè¿‡)
  â”œâ”€ <span class="hljs-keyword">PARTIAL</span> (éƒ¨åˆ†è¿æ¥ï¼Œéƒ¨åˆ†å¤±è´¥)
  â”œâ”€ INVALID (æ— è¿æ¥ï¼Œæ‰€æœ‰å¤±è´¥)
  â””â”€ <span class="hljs-keyword">SKIP</span> (è·³è¿‡éªŒè¯ï¼Œå¦‚æŸäº›ç‰¹æ®Šç½‘ç»œ)
</code></pre>
<p><strong>éªŒè¯å¤±è´¥åœºæ™¯</strong>ï¼ˆé¢è¯•å¸¸é—®ï¼‰ï¼š</p>
<ul>
<li>å›½å®¶/è¿è¥å•†å¹²æ‰°</li>
<li>ä»£ç†é‡å®šå‘ï¼ˆéªŒè¯ä¸º captive portalï¼‰</li>
<li>DNS é—®é¢˜</li>
<li>é˜²ç«å¢™é™åˆ¶</li>
</ul>
<hr/>
<h4 data-id="heading-5">2.4 DNS ç®¡ç†ï¼ˆDnsManagerï¼‰</h4>
<p><strong>DNS é…ç½®æ¥æº</strong>ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">DHCP è·å–çš„ DNS
<span class="hljs-bullet">  +</span> æ‰‹åŠ¨é…ç½®
<span class="hljs-bullet">  +</span> Private DNS (DoH/DoT)
  â†“
DnsManager.updateDnses()
  â†“
IDnsResolver AIDL
  â†“
netd dnsresolver æ¨¡å—
</code></pre>
<p><strong>Private DNS ä¸‰ç§æ¨¡å¼</strong>ï¼ˆå¿…èƒŒï¼‰ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> PRIVATE<span class="hljs-emphasis">_DNS_</span>MODE<span class="hljs-emphasis">_OFF
   â””â”€ å…³é—­ï¼Œä½¿ç”¨æ˜æ–‡ DNS

2. PRIVATE_</span>DNS<span class="hljs-emphasis">_MODE_</span>OPPORTUNISTIC
   â””â”€ å°è¯• DoH/DoTï¼Œå¤±è´¥å›æºåˆ°æ˜æ–‡

<span class="hljs-bullet">3.</span> PRIVATE<span class="hljs-emphasis">_DNS_</span>MODE<span class="hljs-emphasis">_PROVIDER_</span>HOSTNAME
   â””â”€ å¼ºåˆ¶ä½¿ç”¨æŒ‡å®šä¸»æœºçš„ Private DNS
</code></pre>
<hr/>
<h3 data-id="heading-6">ä¸‰ã€è·¯ç”±ç®¡ç†ç³»ç»Ÿï¼ˆé‡è¦ï¼‰</h3>
<h4 data-id="heading-7">3.1 ç­–ç•¥è·¯ç”±ï¼ˆPolicy-based Routingï¼‰</h4>
<p><strong>æ ¸å¿ƒæ¦‚å¿µ</strong>ï¼š</p>
<pre><code class="hljs language-objectivec" lang="objectivec">ä¼ ç»Ÿè·¯ç”±ï¼šåªçœ‹ç›®æ ‡ IP
   â†“ vs â†“
ç­–ç•¥è·¯ç”±ï¼šçœ‹ç›®æ ‡ IP + fwmark + <span class="hljs-built_in">UID</span> + IIF + OIF ç­‰

Android éœ€è¦ç­–ç•¥è·¯ç”±åŸå› ï¼š
  â”œâ”€ å¤šç½‘ç»œå¹¶å­˜ï¼ˆWiFi + èœ‚çª + VPNï¼‰
  â”œâ”€ <span class="hljs-built_in">UID</span> ç²’åº¦æ§åˆ¶ï¼ˆåº”ç”¨çº§é€‰ç½‘ï¼‰
  â””â”€ VPN éš”ç¦»å’Œåˆ†éš§é“
</code></pre>
<p><strong>Fwmark æ ‡è®°ä½“ç³»</strong>ï¼ˆé¢è¯•å¿…é—®ï¼‰ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Fwmark</span> {
    <span class="hljs-type">uint32_t</span> netId : <span class="hljs-number">16</span>;              <span class="hljs-comment">// ç½‘ç»œID (0-65535)</span>
    <span class="hljs-type">uint32_t</span> explicitlySelected : <span class="hljs-number">1</span>;  <span class="hljs-comment">// æ˜ç¡®é€‰æ‹©è¿˜æ˜¯éšå¼</span>
    <span class="hljs-type">uint32_t</span> protectedFromVpn : <span class="hljs-number">1</span>;    <span class="hljs-comment">// æ˜¯å¦å— VPN ä¿æŠ¤</span>
    <span class="hljs-type">uint32_t</span> permission : <span class="hljs-number">2</span>;          <span class="hljs-comment">// æƒé™ (NONE/SYSTEM/INTERNET)</span>
    <span class="hljs-type">uint32_t</span> reserved : <span class="hljs-number">12</span>;           <span class="hljs-comment">// ä¿ç•™</span>
};
</code></pre>
<p><strong>åº”ç”¨æµç¨‹</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">åº”ç”¨ <span class="hljs-built_in">requestNetwork</span>() æˆ– <span class="hljs-built_in">bindProcessToNetwork</span>()
  â†“
ConnectivityService<span class="hljs-selector-class">.requestNetwork</span>()
  â†“
è®¾ç½® socket <span class="hljs-selector-tag">mark</span>ï¼šfwmark = {netId, explicitlySelected, ...}
  â†“
kernel <span class="hljs-built_in">socket</span>(SO_MARK) or iptables <span class="hljs-selector-tag">MARK</span>
  â†“
routing lookup (æŸ¥è¯¢è§„åˆ™è¡¨)
  â†“
kernel æŒ‰ç…§ FIB è§„åˆ™åŒ¹é…
  â”œâ”€ è§„åˆ™ <span class="hljs-number">1</span> (ä¼˜å…ˆçº§ <span class="hljs-number">9000</span>): æœ¬åœ°è·¯ç”±
  â”œâ”€ è§„åˆ™ <span class="hljs-number">2</span> (ä¼˜å…ˆçº§ <span class="hljs-number">10000</span>): VPN è§„åˆ™
  â”œâ”€ ...
  â””â”€ è§„åˆ™ N (ä¼˜å…ˆçº§æœ€ä½): ä¸»è·¯ç”±è¡¨
  
æ¯æ¡è§„åˆ™æŒ‡å®šï¼š
  â”œâ”€ åŒ¹é…æ¡ä»¶ (fwmark, UID range, IIFç­‰)
  â””â”€ åŠ¨ä½œ (æŒ‡å‘å“ªä¸ªè·¯ç”±è¡¨)
  
æœ€ç»ˆï¼šä½¿ç”¨æŒ‡å®šè·¯ç”±è¡¨æŸ¥æ‰¾ç›®æ ‡ IP
</code></pre>
<h4 data-id="heading-8">3.2 ç½‘ç»œæ¥å£è·¯ç”±è¡¨</h4>
<p><strong>æ¯ä¸ªç‰©ç†æ¥å£çš„è·¯ç”±è¡¨è®¡ç®—</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">table_id</span> = interface_index + ROUTE_TABLE_<span class="hljs-literal">OFF</span>SET_FROM_INDEX

ç¤ºä¾‹ï¼š
  æ¥å£ wlan0  (<span class="hljs-attr">if_index</span>=<span class="hljs-number">2</span>)  â†’ è·¯ç”±è¡¨ <span class="hljs-number">10002</span>
  æ¥å£ rmnet0 (<span class="hljs-attr">if_index</span>=<span class="hljs-number">3</span>)  â†’ è·¯ç”±è¡¨ <span class="hljs-number">10003</span>
  æ¥å£ eth0   (<span class="hljs-attr">if_index</span>=<span class="hljs-number">4</span>)  â†’ è·¯ç”±è¡¨ <span class="hljs-number">10004</span>
</code></pre>
<p><strong>ç‰¹æ®Šè·¯ç”±è¡¨</strong>ï¼ˆå¿…èƒŒï¼‰ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">RT_TABLE_LOCAL (<span class="hljs-number">255</span>)            - æœ¬åœ°è·¯ç”± (<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>ç­‰)
RT_TABLE_MAIN (<span class="hljs-number">254</span>)             - ä¸»è·¯ç”±è¡¨ (é»˜è®¤)
ROUTE_TABLE_LOCAL_NETWORK (<span class="hljs-number">97</span>)  - æœ¬åœ°ç½‘ç»œç‰¹æ®Šè·¯ç”±
ROUTE_TABLE_LEGACY_NETWORK (<span class="hljs-number">98</span>) - é—ç•™ç½‘ç»œ
ROUTE_TABLE_LEGACY_SYSTEM (<span class="hljs-number">99</span>)  - é—ç•™ç³»ç»Ÿ
</code></pre>
<hr/>
<h3 data-id="heading-9">å››ã€VPN å’Œåˆ†éš§é“ï¼ˆé¢è¯•å¸¸é—®ï¼‰</h3>
<p><strong>VPN æ¶æ„</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">åº”ç”¨å±‚ VPN Service
  â†“ AIDL
VPN ç®¡ç†å±‚ (VpnManagerService)
  â†“
ç³»ç»Ÿé›†æˆå±‚ (ConnectivityService)
  â”œâ”€ VPN ä½œä¸º NetworkAgent æ³¨å†Œ
  â”œâ”€ NetworkCapabilities æ ‡è®°ä¸º VPN
  â””â”€ ä¸å…¶ä»–ç½‘ç»œç«äº‰ (é€šå¸¸ä¼˜å…ˆçº§é«˜)
  â†“
å†…æ ¸å±‚ (TUN/TAP + netd)
  â”œâ”€ åˆ›å»ºè™šæ‹Ÿç½‘å¡
  â”œâ”€ è·¯ç”±è§„åˆ™é…ç½®
  â””â”€ æ•°æ®åŒ…æ‹¦æˆª/è½¬å‘
</code></pre>
<p><strong>åˆ†éš§é“ï¼ˆSplit Tunnelï¼‰å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">VPN è®¾ç½® declaredUnderlyingNetworks <span class="hljs-operator">=</span> {network1, network2}
  â†“
ConnectivityService æ·»åŠ  fallthrough è§„åˆ™ï¼š
  
  if (packet <span class="hljs-keyword">matches</span> VPN fwmark)
      lookup <span class="hljs-keyword">in</span> VPN routing <span class="hljs-keyword">table</span>
      if found â†’ through VPN
      if <span class="hljs-keyword">NOT</span> found â†’ fallthrough è§„åˆ™ â†’ underlying network <span class="hljs-keyword">table</span>
</code></pre>
<p><strong>å¸¸è§é¢è¯•é¢˜</strong>ï¼š</p>
<ul>
<li>Q: ä¸ºä»€ä¹ˆ VPN è¦æŒ‡å®š underlying networksï¼Ÿ
A: å‘Šè¯‰ç³»ç»Ÿ VPN ä¸‹é¢çœŸå®çš„ç½‘ç»œæ˜¯ä»€ä¹ˆï¼Œç”¨äº split tunnel å’Œæ•…éšœè½¬ç§»</li>
</ul>
<hr/>
<h3 data-id="heading-10">äº”ã€NAT64 å’Œ IPv6ï¼ˆé‡è¦ï¼‰</h3>
<p><strong>NAT64 (464xlat) ç”¨é€”</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">IPv6-only ç½‘ç»œ + åº”ç”¨æœŸæœ› IPv4
  â†“
clatd å®ˆæŠ¤è¿›ç¨‹ï¼š
  â”œâ”€ åˆ›å»ºè™šæ‹Ÿç½‘å¡ (v4-&lt;iface&gt;)
  â”œâ”€ ç›‘å¬ IPv4 æµé‡
  â”œâ”€ ç¿»è¯‘æˆ IPv6 (ä½¿ç”¨ NAT64 å‰ç¼€)
  â”œâ”€ å‘é€åˆ°çœŸå®ç½‘ç»œ
  â””â”€ å“åº”ç¿»è¯‘å› IPv4
</code></pre>
<p><strong>NAT64 å‰ç¼€å‘ç°</strong>ï¼ˆé¢è¯•é«˜é¢‘ï¼‰ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> Router Advertisement (RA)
   â””â”€ ç›´æ¥ä» RA æŠ¥æ–‡ä¸­è·å¾—
   
<span class="hljs-bullet">2.</span> DNS (RFC 7050)
   â””â”€ æŸ¥è¯¢ "ipv4only.arpa"
   â””â”€ è·å¾— AAAA è®°å½•
   
<span class="hljs-bullet">3.</span> é»˜è®¤å‰ç¼€
   â””â”€ 64:ff9b::/96
</code></pre>
<hr/>
<h3 data-id="heading-11">å…­ã€å¤šæ’­è·¯ç”±ï¼ˆè¿›é˜¶ï¼‰</h3>
<p><strong>IPv6 å¤šæ’­è½¬å‘</strong>ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">MulticastRoutingCoordinatorService:</span>
  â”œâ”€ æ·»åŠ è™šæ‹Ÿæ¥å£ (MIF index)
  â”œâ”€ æ·»åŠ å¤šæ’­è½¬å‘ç¼“å­˜ (MFC)
  â”‚  â””â”€ <span class="hljs-keyword">Key</span>: (incoming iface, source addr, <span class="hljs-keyword">group</span> addr)
  â”‚  â””â”€ Value: {outgoing interfaces}
  â””â”€ ä¸‰ç§è½¬å‘æ¨¡å¼ï¼š
     â”œâ”€ FORWARD_NONE
     â”œâ”€ FORWARD_WITH_MIN_SCOPE
     â””â”€ FORWARD_SELECTED
</code></pre>
<hr/>
<h3 data-id="heading-12">ä¸ƒã€Android 15 æ–°ç‰¹æ€§ï¼ˆåŠ åˆ†é¡¹ï¼‰</h3>
<p><strong>eBPF ç½‘ç»œç­–ç•¥</strong>ï¼š</p>
<pre><code class="hljs">é«˜æ€§èƒ½è·¯ç”±å’Œæµé‡æ§åˆ¶
  â”œâ”€ Metered ç½‘ç»œæ ‡è®°
  â”œâ”€ åº”ç”¨çº§é˜²ç«å¢™
  â”œâ”€ ç½‘ç»œåˆ‡ç‰‡æ”¯æŒ
  â””â”€ å®æ—¶æ€§èƒ½ç›‘æµ‹
</code></pre>
<p><strong>5G ç½‘ç»œåˆ‡ç‰‡</strong>ï¼š</p>
<pre><code class="hljs language-objectivec" lang="objectivec">URSP (UE Route Selection Policy)
Traffic Descriptor åŒ¹é…
<span class="hljs-built_in">NSSAI</span> æ”¯æŒ
</code></pre>
<hr/>
<h3 data-id="heading-13">å…«ã€å®æˆ˜é¢è¯•é¢˜åº“</h3>
<p><strong>åŸºç¡€é¢˜</strong>ï¼ˆå¿…ä¼šï¼‰ï¼š</p>
<ol>
<li>
<p>Q: ä»€ä¹ˆæ˜¯ ConnectivityServiceï¼Ÿ
A: Android æ ¸å¿ƒç½‘ç»œç®¡ç†æœåŠ¡ï¼Œè´Ÿè´£ç½‘ç»œé€‰æ‹©ã€éªŒè¯ã€å›è°ƒç­‰</p>
</li>
<li>
<p>Q: å¦‚ä½•è·å–å½“å‰å¯ç”¨ç½‘ç»œåˆ—è¡¨ï¼Ÿ
A: <code>ConnectivityManager.getAllNetworks()</code> æˆ– <code>getAvailableNetworks()</code></p>
</li>
<li>
<p>Q: å¦‚ä½•è®©åº”ç”¨ä½¿ç”¨ç‰¹å®šç½‘ç»œï¼Ÿ
A: è°ƒç”¨ <code>bindProcessToNetwork(network)</code> æˆ– <code>requestNetwork(request, callback)</code></p>
</li>
</ol>
<p><strong>ä¸­ç­‰é¢˜</strong>ï¼ˆå¸¸è§ï¼‰ï¼š
4. Q: ç½‘ç»œéªŒè¯å¤±è´¥ä¼šæ€æ ·ï¼Ÿ
A: ç½‘ç»œå¤±å» VALIDATED èƒ½åŠ›ï¼Œä¸ä¼šæˆä¸ºé»˜è®¤ç½‘ç»œï¼Œåº”ç”¨å¯æ”¶åˆ°éªŒè¯å¤±è´¥å›è°ƒ</p>
<ol start="5">
<li>
<p>Q: å¦‚ä½•å®ç°åº”ç”¨çº§ VPN æ§åˆ¶ï¼Ÿ
A: åœ¨ NetworkCapabilities ä¸­æŒ‡å®šåº”ç”¨ UID èŒƒå›´ï¼ŒConnectivityService æ ¹æ® UID é€‰æ‹© VPN</p>
</li>
<li>
<p>Q: Split Tunnel VPN å¦‚ä½•å·¥ä½œï¼Ÿ
A: VPN æŒ‡å®š underlying networksï¼ŒæœªåŒ¹é…çš„æµé‡ä½¿ç”¨ fallthrough è§„åˆ™ç»•è¿‡ VPN</p>
</li>
</ol>
<p><strong>é«˜éš¾é¢˜</strong>ï¼ˆæ·±åº¦ï¼‰ï¼š
7. Q: æ€æ ·å®ç°å¤šç½‘ç»œä¼˜å…ˆçº§ç®¡ç†ï¼Ÿ
A: é€šè¿‡ç½‘ç»œè¯„åˆ†ç³»ç»Ÿï¼ŒConnectivityService å¯¹æ‰€æœ‰ç½‘ç»œè¯„åˆ†æ’åºï¼Œé€‰æœ€ä¼˜</p>
<ol start="8">
<li>
<p>Q: ä¸ºä»€ä¹ˆéœ€è¦ policy-based routingï¼Ÿ
A: æ”¯æŒå¤šç½‘ç»œå¹¶å­˜ã€UID ç²’åº¦æ§åˆ¶ã€VPN éš”ç¦»ç­‰ Android ç‰¹æœ‰éœ€æ±‚</p>
</li>
<li>
<p>Q: clatd ä¸ºä»€ä¹ˆéœ€è¦ NAT64 å‰ç¼€ï¼Ÿ
A: å°† IPv4 åœ°å€æ˜ å°„åˆ° IPv6 åœ°å€ç©ºé—´ï¼Œå‰ç¼€ç”¨äºæ ‡è®°è¿™äº›åˆæˆçš„ IPv6 åœ°å€</p>
</li>
</ol>
<hr/>
<h3 data-id="heading-14">ä¹ã€é¢è¯•å‡†å¤‡å»ºè®®</h3>
<p><strong>ä»£ç å¿…è¯»</strong>ï¼ˆä¼˜å…ˆçº§ï¼‰ï¼š</p>
<ol>
<li>â­â­â­ <code>ConnectivityService.java</code> - æ ¸å¿ƒç±»</li>
<li>â­â­â­ <code>NetworkAgentInfo.java</code> - æ•°æ®ç»“æ„</li>
<li>â­â­â­ <code>RouteController.cpp</code> - è·¯ç”±ç®¡ç†</li>
<li>â­â­ <code>DnsManager.java</code> - DNS ç®¡ç†</li>
<li>â­â­ <code>Nat464Xlat.java</code> - NAT64 å®ç°</li>
</ol>
<p><strong>è°ƒè¯•å‘½ä»¤</strong>ï¼ˆåŠ åˆ†ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">dumpsys connectivity --verbose     <span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œçŠ¶æ€</span>
ip rule list [all]                 <span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰ç­–ç•¥è§„åˆ™</span>
ip route show table &lt;table_id&gt;      <span class="hljs-comment"># æŸ¥çœ‹ç‰¹å®šè·¯ç”±è¡¨</span>
netd list_table_for_interface wlan0 <span class="hljs-comment"># netd å‘½ä»¤</span>
adb logcat | grep NetworkMonitor   <span class="hljs-comment"># ç½‘ç»œéªŒè¯æ—¥å¿—</span>
</code></pre>
<p><strong>è¦ç‚¹æ€»ç»“</strong>ï¼ˆé¢è¯•æ—¶å¼ºè°ƒï¼‰ï¼š</p>
<ul>
<li>NetworkStack = åˆ†å±‚æ¶æ„ï¼ˆåº”ç”¨å±‚ â†’ ç³»ç»Ÿå±‚ â†’ netd â†’ å†…æ ¸ï¼‰</li>
<li>APEX å¯æ›´æ–°æ€§æ˜¯è®¾è®¡äº®ç‚¹</li>
<li>ç½‘ç»œè¯„åˆ† + ç­–ç•¥è·¯ç”±æ˜¯æ ¸å¿ƒç®—æ³•</li>
<li>VPN å’Œ split tunnel æ˜¯å¤æ‚ç‰¹æ€§</li>
<li>NAT64 è§£å†³ IPv6-only å…¼å®¹æ€§</li>
</ul>
<hr/>
<p>è¿™äº›çŸ¥è¯†ç‚¹æ˜¯ Android ç½‘ç»œé¢è¯•çš„å®Œæ•´ä½“ç³»ã€‚ç¥ä½ é¢è¯•é¡ºåˆ©ï¼ğŸ¯</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android ç½‘ç»œç­–ç•¥ç®¡ç†æœåŠ¡ï¼ˆNetworkPolicyManagerï¼‰å®Œæ•´æ¶æ„åˆ†æ]]></title>    <link>https://juejin.cn/post/7603591775391989787</link>    <guid>https://juejin.cn/post/7603591775391989787</guid>    <pubDate>2026-02-07T01:59:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603591775391989787" data-draft-id="7603575763787005978" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android ç½‘ç»œç­–ç•¥ç®¡ç†æœåŠ¡ï¼ˆNetworkPolicyManagerï¼‰å®Œæ•´æ¶æ„åˆ†æ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-07T01:59:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·341408199125"/> <meta itemprop="url" content="https://juejin.cn/user/570004686782272"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android ç½‘ç»œç­–ç•¥ç®¡ç†æœåŠ¡ï¼ˆNetworkPolicyManagerï¼‰å®Œæ•´æ¶æ„åˆ†æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/570004686782272/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·341408199125
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T01:59:59.000Z" title="Sat Feb 07 2026 01:59:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€æ ¸å¿ƒæ¨¡å—æ¦‚è§ˆ</h2>
<h3 data-id="heading-1">1. <strong>NetworkPolicyManager</strong>ï¼ˆç”¨æˆ·ç©ºé—´æ¥å£å±‚ï¼‰</h3>
<p>ä½ç½®ï¼š<code>frameworks_base/core/java/android/net/NetworkPolicyManager.java</code></p>
<p><strong>åŠŸèƒ½</strong>ï¼š</p>
<ul>
<li>å…¬å¼€ API ç»™åº”ç”¨ç¨‹åºå’Œç³»ç»ŸæœåŠ¡</li>
<li>å®šä¹‰ç½‘ç»œç­–ç•¥ç±»å‹å’Œè§„åˆ™å¸¸é‡</li>
<li>é€šè¿‡ Binder IPC ä¸ <code>NetworkPolicyManagerService</code> é€šä¿¡</li>
</ul>
<p><strong>å…³é”®å¸¸é‡</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">POLICY_NONE</span> = <span class="hljs-number">0</span>x0
<span class="hljs-attr">POLICY_REJECT_METERED_BACKGROUND</span> = <span class="hljs-number">0</span>x1  // åå°æ‹’ç»è®¡è´¹ç½‘ç»œ
<span class="hljs-attr">POLICY_ALLOW_METERED_BACKGROUND</span> = <span class="hljs-number">0</span>x4   // åå°å…è®¸è®¡è´¹ç½‘ç»œ

<span class="hljs-attr">RULE_ALLOW_METERED</span> = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">0</span>      // å…è®¸è®¡è´¹ç½‘ç»œ
<span class="hljs-attr">RULE_ALLOW_ALL</span> = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">1</span>          // å…è®¸æ‰€æœ‰ç½‘ç»œ
<span class="hljs-attr">RULE_REJECT_METERED</span> = ...        // æ‹’ç»è®¡è´¹ç½‘ç»œ
<span class="hljs-attr">RULE_REJECT_ALL</span> = ...            // æ‹’ç»æ‰€æœ‰ç½‘ç»œ
</code></pre>
<hr/>
<h2 data-id="heading-2">äºŒã€æ ¸å¿ƒæœåŠ¡æ¶æ„</h2>
<h3 data-id="heading-3">1. <strong>INetworkPolicyManagerï¼ˆBinder æ¥å£ï¼‰</strong></h3>
<p>ä½ç½®ï¼š<code>frameworks_base/core/java/android/net/INetworkPolicyManager.aidl</code></p>
<p><strong>Binder æ–¹æ³•</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// UID ç­–ç•¥æ§åˆ¶</span>
<span class="hljs-built_in">setUidPolicy</span>(uid, policy)
<span class="hljs-built_in">addUidPolicy</span>(uid, policy)
<span class="hljs-built_in">removeUidPolicy</span>(uid, policy)
<span class="hljs-built_in">getUidPolicy</span>(uid)
<span class="hljs-built_in">getUidsWithPolicy</span>(policy)

<span class="hljs-comment">// ç½‘ç»œç­–ç•¥</span>
<span class="hljs-built_in">setNetworkPolicies</span>(policies[])
<span class="hljs-built_in">getNetworkPolicies</span>()
<span class="hljs-built_in">snoozeLimit</span>(template)

<span class="hljs-comment">// é™åˆ¶èƒŒæ™¯æ•°æ®</span>
<span class="hljs-built_in">setRestrictBackground</span>(enabled)
<span class="hljs-built_in">getRestrictBackground</span>()
<span class="hljs-built_in">getRestrictBackgroundStatus</span>(uid)

<span class="hljs-comment">// é˜²ç«å¢™è§„åˆ™</span>
<span class="hljs-built_in">setDeviceIdleMode</span>(enabled)
<span class="hljs-built_in">setWifiMeteredOverride</span>(networkId, override)
</code></pre>
<h3 data-id="heading-4">2. <strong>NetworkPolicyManagerService</strong>ï¼ˆæ ¸å¿ƒæœåŠ¡å®ç°ï¼‰</h3>
<p>ä½ç½®ï¼š<code>frameworks_base/services/core/java/com/android/server/net/NetworkPolicyManagerService.java</code></p>
<p><strong>å…³é”®èŒè´£</strong>ï¼š</p>
<h4 data-id="heading-5">a) <strong>ç½‘ç»œç­–ç•¥ç®¡ç†</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç»´æŠ¤ NetworkPolicy å¯¹è±¡</span>
<span class="hljs-comment">// - template: ç½‘ç»œåŒ¹é…æ¨¡æ¿ (ç§»åŠ¨ç½‘ç»œ/WiFi/ä»¥å¤ªç½‘)</span>
<span class="hljs-comment">// - cycleRule: ä½¿ç”¨å‘¨æœŸ (æœˆåº¦ã€å‘¨åº¦ç­‰)</span>
<span class="hljs-comment">// - warningBytes: è­¦å‘Šé™åˆ¶ (è§¦å‘ç”¨æˆ·é€šçŸ¥)</span>
<span class="hljs-comment">// - limitBytes: ç¡¬é™åˆ¶ (è§¦å‘ç½‘ç»œç¦ç”¨)</span>
</code></pre>
<h4 data-id="heading-6">b) <strong>UID è§„åˆ™ç®¡ç†</strong></h4>
<p>ç»´æŠ¤ 6 ä¸ªé˜²ç«å¢™é“¾ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">FIREWALL_CHAIN_DOZABLE        (Doze æ¨¡å¼)
FIREWALL_CHAIN_STANDBY        (App Standby/åº”ç”¨é—²ç½®)
FIREWALL_CHAIN_POWERSAVE       (ç”µæ± çœç”µæ¨¡å¼)
FIREWALL_CHAIN_BACKGROUND     (åå°ç½‘ç»œé™åˆ¶)
FIREWALL_CHAIN_RESTRICTED     (å—é™æ¨¡å¼)
FIREWALL_CHAIN_LOW_POWER_STANDBY
</code></pre>
<h4 data-id="heading-7">c) <strong>åå°ç½‘ç»œé™åˆ¶ï¼ˆData Saver æ¨¡å¼ï¼‰</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç»´æŠ¤ä¸‰æ¡é“¾</span>
bw_penalty_box        <span class="hljs-comment">// æ‹’ç»åå• (UID è¢«é˜»æ­¢)</span>
bw_happy_box          <span class="hljs-comment">// å…è®¸åå• (UID è¢«å…è®¸)</span>
bw_data_saver         <span class="hljs-comment">// æ•°æ®ä¿æŠ¤æ¨¡å¼ (å…¨å±€é™åˆ¶)</span>
</code></pre>
<p><strong>æ‰§è¡Œæµç¨‹</strong>ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">åº”ç”¨å‘èµ·ç½‘ç»œè¯·æ±‚
<span class="hljs-code">    â†“
æ£€æŸ¥ UID æ˜¯å¦åœ¨å„ä¸ªé™åˆ¶é“¾ä¸­
    â”œâ†’ FIREWALL_CHAIN_DOZABLE
    â”œâ†’ FIREWALL_CHAIN_STANDBY
    â”œâ†’ FIREWALL_CHAIN_POWERSAVE
    â”œâ†’ FIREWALL_CHAIN_BACKGROUND
    â”œâ†’ FIREWALL_CHAIN_RESTRICTED
    â””â†’ bw_penalty_box (æ•°æ®é™åˆ¶)
    â†“
åº”ç”¨è¢«å…è®¸/æ‹’ç»ç½‘ç»œè®¿é—®
</span></code></pre>
<hr/>
<h2 data-id="heading-8">ä¸‰ã€æ•°æ®ç»“æ„è¯¦è§£</h2>
<h3 data-id="heading-9">1. <strong>NetworkPolicyï¼ˆç½‘ç»œç­–ç•¥ï¼‰</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkPolicy</span> {
    NetworkTemplate template;      <span class="hljs-comment">// åŒ¹é…è§„åˆ™ (MATCH_MOBILE/WIFIç­‰)</span>
    RecurrenceRule cycleRule;      <span class="hljs-comment">// é‡å¤å‘¨æœŸ (æ¯æœˆç¬¬å‡ å¤©é‡ç½®)</span>
    <span class="hljs-type">long</span> warningBytes;             <span class="hljs-comment">// è­¦å‘Šé˜ˆå€¼</span>
    <span class="hljs-type">long</span> limitBytes;               <span class="hljs-comment">// ç¡¬é™åˆ¶å­—èŠ‚æ•°</span>
    <span class="hljs-type">long</span> lastWarningSnooze;        <span class="hljs-comment">// ä¸Šæ¬¡å¿½ç•¥è­¦å‘Šçš„æ—¶é—´</span>
    <span class="hljs-type">long</span> lastLimitSnooze;          <span class="hljs-comment">// ä¸Šæ¬¡æš‚åœé™åˆ¶çš„æ—¶é—´</span>
    <span class="hljs-type">boolean</span> metered;               <span class="hljs-comment">// æ˜¯å¦è®¡è´¹</span>
    <span class="hljs-type">boolean</span> inferred;              <span class="hljs-comment">// æ˜¯å¦ç”±ç³»ç»Ÿæ¨æ–­</span>
}
</code></pre>
<h3 data-id="heading-10">2. <strong>NetworkTemplateï¼ˆç½‘ç»œåŒ¹é…æ¨¡æ¿ï¼‰</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åŒ¹é…è§„åˆ™ç±»å‹</span>
MATCH_MOBILE           <span class="hljs-comment">// ç§»åŠ¨ç½‘ç»œ (SIMå¡)</span>
MATCH_WIFI             <span class="hljs-comment">// WiFi</span>
MATCH_ETHERNET         <span class="hljs-comment">// ä»¥å¤ªç½‘</span>
MATCH_CARRIER          <span class="hljs-comment">// ç‰¹å®šè¿è¥å•†</span>
MATCH_WIFI_WILDCARD    <span class="hljs-comment">// æ‰€æœ‰WiFi</span>
</code></pre>
<hr/>
<h2 data-id="heading-11">å››ã€æ ¸å¿ƒæµç¨‹è¯¦è§£</h2>
<h3 data-id="heading-12">1. <strong>åˆ¶çº¦å…³é”®è·¯å¾„ï¼šåº”ç”¨è”ç½‘æ£€æŸ¥</strong></h3>
<pre><code class="hljs language-scss" lang="scss">åº”ç”¨è°ƒç”¨ <span class="hljs-built_in">socket</span>() / <span class="hljs-built_in">connect</span>()
    â†“
Binder è¿›ç¨‹é—´é€šä¿¡
    â†“
INetworkPolicyManager<span class="hljs-selector-class">.Stub</span>
    â†“
NetworkPolicyManagerService
    â”œâ†’ è·å– UID
    â”œâ†’ æ£€æŸ¥ UID Policy
    â”œâ†’ æ£€æŸ¥åå°/å‰å°çŠ¶æ€
    â”œâ†’ æ£€æŸ¥ Data Saver å¯ç”¨
    â”œâ†’ æ£€æŸ¥ç½‘ç»œç±»å‹ (è®¡è´¹/éè®¡è´¹)
    â””â†’ å†³ç­–ï¼šå…è®¸/é˜»æ­¢
    â†“
ConnectivityService / BpfNetMaps
    â”œâ†’ æŸ¥è¯¢ eBPF uidOwnerMap
    â””â†’ åº”ç”¨é˜²ç«å¢™è§„åˆ™
    â†“
Netfilter (iptables/nftables)
    â”œâ†’ æ£€æŸ¥ UID åœ¨å„é“¾ä¸­çš„çŠ¶æ€
    â””â†’ æ¥å—æˆ–ä¸¢å¼ƒæ•°æ®åŒ…
</code></pre>
<h3 data-id="heading-13">2. <strong>UID è§„åˆ™æ›´æ–°è·¯å¾„</strong></h3>
<pre><code class="hljs language-scss" lang="scss">NetworkPolicyManagerService
    â†“
<span class="hljs-built_in">updateRestrictionRulesForUidUL</span>(uid)
    â”œâ†’ <span class="hljs-built_in">updateRuleForDeviceIdleUL</span>(uid)     <span class="hljs-comment">// Doze æ¨¡å¼</span>
    â”œâ†’ <span class="hljs-built_in">updateRuleForAppIdleUL</span>(uid)        <span class="hljs-comment">// åº”ç”¨é—²ç½®</span>
    â”œâ†’ <span class="hljs-built_in">updateRuleForRestrictPowerUL</span>(uid)  <span class="hljs-comment">// ç”µæ± çœç”µ</span>
    â”œâ†’ <span class="hljs-built_in">updateRuleForBackgroundUL</span>(uid)     <span class="hljs-comment">// åå°é™åˆ¶</span>
    â”œâ†’ <span class="hljs-built_in">updateRestrictedModeForUidUL</span>(uid)  <span class="hljs-comment">// å—é™æ¨¡å¼</span>
    â””â†’ <span class="hljs-built_in">updateRulesForDataUsageRestrictionsUL</span>(uid)
    â†“
<span class="hljs-built_in">setUidFirewallRuleUL</span>(chain, uid, rule)
    â”œâ†’ æ›´æ–°å†…å­˜ä¸­çš„ mUidFirewall*Rules ç¼“å­˜
    â””â†’ è°ƒç”¨ mNetworkManager<span class="hljs-selector-class">.setFirewallUidRule</span>()
    â†“
INetworkManagementService / ConnectivityService
    â”œâ†’ BpfNetMaps<span class="hljs-selector-class">.setUidRule</span>(chain, uid, rule)
    â”‚   â”œâ†’ è·å– chain å¯¹åº”çš„ BPF match ä½æ©ç 
    â”‚   â”œâ†’ <span class="hljs-built_in">addRule</span>() æˆ– <span class="hljs-built_in">removeRule</span>()
    â”‚   â””â†’ æ›´æ–° sUidOwnerMap (eBPF map)
    â””â†’ Netfilter è§„åˆ™åŒæ­¥
    â†“
å†…æ ¸ eBPF ç¨‹åº
    â”œâ†’ æ‹¦æˆªæ‰€æœ‰ç½‘ç»œåŒ…
    â”œâ†’ æ£€æŸ¥ UID å¯¹åº”çš„ rule ä½æ©ç 
    â””â†’ åº”ç”¨é˜²ç«å¢™ç­–ç•¥
</code></pre>
<hr/>
<h2 data-id="heading-14">äº”ã€é˜²ç«å¢™é“¾è¯¦è§£</h2>
<h3 data-id="heading-15">1. <strong>å„é“¾çš„ä½œç”¨åŠå¯ç”¨æ¡ä»¶</strong></h3>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FIREWALL_CHAIN_DOZABLE (Doze æ¨¡å¼é˜²ç«å¢™é“¾)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯ç”¨æ¡ä»¶ï¼šè®¾å¤‡è¿›å…¥ Doze æ¨¡å¼                                 â”‚
â”‚ é»˜è®¤è§„åˆ™ï¼šç©ºé—²åº”ç”¨è¢«æ‹’ç»                                     â”‚
â”‚ ä¾‹å¤–ï¼šåº”ç”¨åœ¨ allowlist ä¸­åˆ™è¢«å…è®¸                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FIREWALL_CHAIN_STANDBY (App Standby é—²ç½®é“¾)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯ç”¨æ¡ä»¶ï¼šåº”ç”¨è¢«åˆ¤å®šä¸ºç©ºé—² (ä½¿ç”¨ç»Ÿè®¡åˆ†æ)                    â”‚
â”‚ é»˜è®¤è§„åˆ™ï¼šé—²ç½®åº”ç”¨è¢«æ‹’ç»                                     â”‚
â”‚ ä¾‹å¤–ï¼šåº”ç”¨é€šè¿‡ parole æ¨¡å¼æˆ– allowlist è¢«å…è®¸               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FIREWALL_CHAIN_POWERSAVE (ç”µæ± çœç”µæ¨¡å¼é“¾)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯ç”¨æ¡ä»¶ï¼šç”¨æˆ·å¯ç”¨ Battery Saver                            â”‚
â”‚ é»˜è®¤è§„åˆ™ï¼šåå°åº”ç”¨è¢«æ‹’ç»ï¼Œé™¤éåœ¨ allowlist ä¸­               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FIREWALL_CHAIN_BACKGROUND (åå°ç½‘ç»œé™åˆ¶é“¾)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯ç”¨æ¡ä»¶ï¼šç³»ç»Ÿé…ç½® config_networkBlockedForTopSleepingAndAbove
â”‚ é»˜è®¤è§„åˆ™ï¼šåå°åº”ç”¨è¢«æ‹’ç»                                     â”‚
â”‚ é€‚ç”¨ï¼šåå°ç½‘ç»œé™åˆ¶åŠŸèƒ½                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FIREWALL_CHAIN_RESTRICTED (å—é™æ¨¡å¼é“¾)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯ç”¨æ¡ä»¶ï¼šç”¨æˆ·å¯ç”¨å—é™æ¨¡å¼                                   â”‚
â”‚ é»˜è®¤è§„åˆ™ï¼šæ‰€æœ‰åº”ç”¨è¢«æ‹’ç»ï¼Œé™¤éæœ‰æƒé™æˆ–åœ¨ allowlist ä¸­        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FIREWALL_CHAIN_METERED_ALLOW (è®¡è´¹ç½‘ç»œå…è®¸åå•)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯ç”¨æ¡ä»¶ï¼šData Saver æ¨¡å¼å¯ç”¨æ—¶                             â”‚
â”‚ é»˜è®¤è§„åˆ™ï¼šåå•ä¸­çš„åº”ç”¨å¯ä½¿ç”¨è®¡è´¹ç½‘ç»œ                         â”‚
â”‚ ç±»å‹ï¼šå…è®¸åå• (Allowlist)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FIREWALL_CHAIN_METERED_DENY_USER (ç”¨æˆ·æ‹’ç»åå•)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯ç”¨æ¡ä»¶ï¼šç”¨æˆ·é™åˆ¶åº”ç”¨ä½¿ç”¨è®¡è´¹ç½‘ç»œ                           â”‚
â”‚ é»˜è®¤è§„åˆ™ï¼šåå•ä¸­çš„åº”ç”¨è¢«æ‹’ç»è®¡è´¹ç½‘ç»œè®¿é—®                     â”‚
â”‚ ç±»å‹ï¼šæ‹’ç»åå• (Denylist) - ç”¨æˆ·é…ç½®                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FIREWALL_CHAIN_METERED_DENY_ADMIN (ç®¡ç†å‘˜æ‹’ç»åå•)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯ç”¨æ¡ä»¶ï¼šç®¡ç†å‘˜/ç³»ç»Ÿé™åˆ¶åº”ç”¨ä½¿ç”¨è®¡è´¹ç½‘ç»œ                    â”‚
â”‚ é»˜è®¤è§„åˆ™ï¼šåå•ä¸­çš„åº”ç”¨è¢«æ‹’ç»è®¡è´¹ç½‘ç»œè®¿é—®                     â”‚
â”‚ ç±»å‹ï¼šæ‹’ç»åå• (Denylist) - ç®¡ç†å‘˜é…ç½®                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h2 data-id="heading-16">å…­ã€eBPF å’Œ BpfNetMaps é›†æˆ</h2>
<h3 data-id="heading-17">1. <strong>BpfNetMapsï¼ˆAndroid 13+ eBPF é›†æˆï¼‰</strong></h3>
<p>ä½ç½®ï¼š<code>packages_modules_Connectivity/service/src/com/android/server/BpfNetMaps.java</code></p>
<p><strong>æ ¸å¿ƒ eBPF Maps</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">sUidOwnerMap          <span class="hljs-comment">// UID â†’ UidOwnerValue (rule ä½æ©ç )</span>
sConfigurationMap     <span class="hljs-comment">// å…¨å±€é…ç½® (å¯ç”¨çš„é“¾)</span>
sCookieTagMap         <span class="hljs-comment">// Socket Cookie â†’ Tag (æµé‡ç»Ÿè®¡)</span>
sDataSaverEnabledMap  <span class="hljs-comment">// Data Saver çŠ¶æ€æ ‡å¿—</span>
sUidPermissionMap     <span class="hljs-comment">// UID â†’ æƒé™ (INTERNET ç­‰)</span>
sIngressDiscardMap    <span class="hljs-comment">// å…¥ç«™ä¸¢å¼ƒè§„åˆ™ (åå‘è·¯å¾„è¿‡æ»¤)</span>
</code></pre>
<p><strong>UidOwnerValue ç»“æ„</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">UidOwnerValue</span> {</span>
    <span class="hljs-type">uint32_t</span> rule;   <span class="hljs-comment">// 32 ä½ä½æ©ç  (å„é“¾çš„å¯ç”¨æ ‡å¿—)</span>
    <span class="hljs-type">uint32_t</span> iif;    <span class="hljs-comment">// å…¥ç«™æ¥å£ç´¢å¼• (å¯é€‰)</span>
};
</code></pre>
<p><strong>rule ä½æ©ç </strong>ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Bit 0-7:</span>    <span class="hljs-string">DOZABLE_MATCH</span>
<span class="hljs-attr">Bit 8-15:</span>   <span class="hljs-string">STANDBY_MATCH</span>
<span class="hljs-attr">Bit 16-23:</span>  <span class="hljs-string">POWERSAVE_MATCH</span>
<span class="hljs-attr">Bit 24:</span>     <span class="hljs-string">RESTRICTED_MATCH</span>
<span class="hljs-attr">Bit 25-27:</span>  <span class="hljs-string">OEM_DENY_1/2/3_MATCH</span>
<span class="hljs-attr">Bit 28:</span>     <span class="hljs-string">LOW_POWER_STANDBY_MATCH</span>
<span class="hljs-attr">Bit 29:</span>     <span class="hljs-string">BACKGROUND_MATCH</span>
<span class="hljs-attr">Bit 30:</span>     <span class="hljs-string">PENALTY_BOX_USER_MATCH</span>
<span class="hljs-attr">Bit 31:</span>     <span class="hljs-string">HAPPY_BOX_MATCH</span>
<span class="hljs-string">...</span>         <span class="hljs-string">æ›´å¤šä½ä¾›æœªæ¥æ‰©å±•</span>
</code></pre>
<h3 data-id="heading-18">2. <strong>é˜²ç«å¢™è§„åˆ™åº”ç”¨æµç¨‹</strong></h3>
<pre><code class="hljs language-ini" lang="ini">NetworkPolicyManagerService (Java)
    â†“
BpfNetMaps.setUidRule(chain, uid, rule)
    â†“
è·å– chain å¯¹åº”çš„ match ä½
ä¾‹å¦‚ FIREWALL_CHAIN_POWERSAVE â†’ POWERSAVE_MATCH
    â†“
sUidOwnerMap.getValue(uid)
    â”œâ†’ å¦‚æœ <span class="hljs-attr">rule</span> == ALLOW &amp;&amp; isAllowList
    â”‚  â””â†’ uid_rule |= match
    â””â†’ å¦‚æœ <span class="hljs-attr">rule</span> == DENY &amp;&amp; !isAllowList
       â””â†’ uid_rule |= match
    â†“
sUidOwnerMap.updateEntry(uid, new_value)
    â†“
å†…æ ¸ eBPF ç¨‹åºåœ¨ TC/XDP é’©å­
    â”œâ†’ è¯»å– sUidOwnerMap<span class="hljs-section">[uid]</span>
    â”œâ†’ æ£€æŸ¥ rule &amp; å¯¹åº”çš„ match
    â””â†’ å…è®¸/ä¸¢å¼ƒæ•°æ®åŒ…
</code></pre>
<hr/>
<h2 data-id="heading-19">ä¸ƒã€Data Saver æ¨¡å¼è¯¦è§£</h2>
<h3 data-id="heading-20">å…³é”®å†³ç­–çŸ©é˜µ</h3>
<p>æ ¹æ®ä»£ç ä¸­çš„ <code>network-policy-restrictions.md</code>ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">è®¡è´¹ç½‘ç»œä¸Šçš„ Data Saver æ•ˆæœï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ çŠ¶æ€         â”‚ åå°åº”ç”¨æ˜¯å¦å¯è”ç½‘                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DS-<span class="hljs-keyword">ON</span>,AL     â”‚ å¦ (é™¤éä¹Ÿåœ¨ allowlist æˆ–å‰å°)          â”‚
â”‚ DS-<span class="hljs-keyword">ON</span>,!AL    â”‚ å¦                                       â”‚
â”‚ DS-<span class="hljs-keyword">ON</span>,DL     â”‚ å¦                                       â”‚
â”‚ DS-<span class="hljs-keyword">OFF</span>,AL    â”‚ æ˜¯                                       â”‚
â”‚ DS-<span class="hljs-keyword">OFF</span>,!AL   â”‚ æ˜¯ (è®¡è´¹ç½‘ç»œé»˜è®¤å…è®¸)                    â”‚
â”‚ DS-<span class="hljs-keyword">OFF</span>,DL    â”‚ å¦ (æ‹’ç»åå•ä¼˜å…ˆ)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

éè®¡è´¹ç½‘ç»œä¸Šçš„ Data Saver æ•ˆæœï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ çŠ¶æ€         â”‚ åå°åº”ç”¨æ˜¯å¦å¯è”ç½‘                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä»»ä½•çŠ¶æ€     â”‚ æ˜¯ (Data Saver ä¸å½±å“éè®¡è´¹ç½‘ç»œ)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h2 data-id="heading-21">å…«ã€å…³é”®ç±»å’Œæ¥å£æ€»ç»“</h2>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å…¬å¼€ API å±‚                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ NetworkPolicyManager                (ç”¨æˆ·ä¾§ API)
â”‚ INetworkPolicyManager<span class="hljs-selector-class">.aidl</span>          (Binder æ¥å£)
â”‚ INetworkPolicyListener<span class="hljs-selector-class">.aidl</span>         (å›è°ƒæ¥å£)
â”‚ NetworkPolicy                        (ç­–ç•¥å¯¹è±¡)
â”‚ NetworkTemplate                      (ç½‘ç»œåŒ¹é…æ¨¡æ¿)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“ Binder IPC
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç³»ç»ŸæœåŠ¡å±‚                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ NetworkPolicyManagerService          (æ ¸å¿ƒæœåŠ¡å®ç°)
â”‚ INetworkManagementService            (ç½‘ç»œç®¡ç†æœåŠ¡)
â”‚ NetworkManagementService             (iptables ç®¡ç†)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“ Binder IPC
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¿æ¥ç®¡ç†å±‚                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ConnectivityService                  (è¿æ¥æœåŠ¡)
â”‚ ConnectivityManager                  (è¿æ¥ç®¡ç†å™¨)
â”‚ BpfNetMaps                           (eBPF é›†æˆ)
â”‚ NetworkStackBpfNetMaps               (eBPF è¯»å–)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“ ç³»ç»Ÿè°ƒç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å†…æ ¸å±‚                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ eBPF Programs (XDP/TC hooks)         (æ•°æ®åŒ…å¤„ç†)
â”‚ Netfilter (iptables/nftables)        (é˜²ç«å¢™è§„åˆ™)
â”‚ tc (traffic control)                 (æµé‡æ§åˆ¶)
â”‚ Linux Socket API                     (å¥—æ¥å­—)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h2 data-id="heading-22">ä¹ã€æ ¸å¿ƒé¢è¯•çŸ¥è¯†ç‚¹</h2>
<h3 data-id="heading-23">1. <strong>UID Policy vs Firewall Rules</strong></h3>
<ul>
<li><strong>Policy</strong>ï¼šåº”ç”¨çº§åˆ«çš„é«˜å±‚ç­–ç•¥ (POLICY_REJECT_METERED_BACKGROUND)</li>
<li><strong>Rules</strong>ï¼šå…·ä½“çš„é˜²ç«å¢™é“¾è§„åˆ™ (FIREWALL_CHAIN_POWERSAVE)</li>
</ul>
<h3 data-id="heading-24">2. <strong>å‰å° vs åå°åº”ç”¨</strong></h3>
<ul>
<li>å‰å°åº”ç”¨ï¼šåœ¨ foreground çŠ¶æ€ï¼Œé€šå¸¸è¢«å…è®¸ç½‘ç»œè®¿é—®</li>
<li>åå°åº”ç”¨ï¼šä¸åœ¨ç„¦ç‚¹ã€æ—  foreground æœåŠ¡ï¼Œå—é™åˆ¶</li>
</ul>
<h3 data-id="heading-25">3. <strong>è®¡è´¹ vs éè®¡è´¹ç½‘ç»œ</strong></h3>
<ul>
<li>è®¡è´¹ç½‘ç»œ (metered)ï¼šç§»åŠ¨æ•°æ®ç½‘ç»œï¼ŒData Saver å¯é™åˆ¶</li>
<li>éè®¡è´¹ç½‘ç»œ (non-metered)ï¼šWiFiã€ä»¥å¤ªç½‘ï¼ŒData Saver ä¸é™åˆ¶</li>
</ul>
<h3 data-id="heading-26">4. <strong>Data Saver å·¥ä½œåŸç†</strong></h3>
<ul>
<li>å¯ç”¨æ—¶ï¼Œæ‰€æœ‰åå°åº”ç”¨é»˜è®¤æ— æ³•ä½¿ç”¨è®¡è´¹ç½‘ç»œ</li>
<li>åœ¨ allowlist ä¸­çš„åº”ç”¨è¢«å…è®¸</li>
<li>åœ¨ denylist ä¸­çš„åº”ç”¨å³ä½¿ä¸æ˜¯åå°ä¹Ÿè¢«æ‹’ç»</li>
</ul>
<h3 data-id="heading-27">5. <strong>eBPF ä¼˜åŠ¿</strong></h3>
<ul>
<li>ä¸ iptables ç›¸æ¯”ï¼Œæ€§èƒ½æ›´é«˜</li>
<li>é€šè¿‡ BPF maps å¿«é€ŸæŸ¥è¯¢ UID è§„åˆ™</li>
<li>æ— éœ€é¢‘ç¹çš„ userspace/kernel åˆ‡æ¢</li>
</ul>
<p>è¿™å°±æ˜¯å®Œæ•´çš„ Android ç½‘ç»œç­–ç•¥ç®¡ç†æœåŠ¡æ¶æ„ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android ç½‘ç»œä¼ è¾“æ•°æ®ç»Ÿè®¡æœåŠ¡ï¼ˆNetworkStats Serviceï¼‰å®Œæ•´æ¶æ„åˆ†æ]]></title>    <link>https://juejin.cn/post/7603584155785429042</link>    <guid>https://juejin.cn/post/7603584155785429042</guid>    <pubDate>2026-02-07T02:14:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603584155785429042" data-draft-id="7603627478019981322" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android ç½‘ç»œä¼ è¾“æ•°æ®ç»Ÿè®¡æœåŠ¡ï¼ˆNetworkStats Serviceï¼‰å®Œæ•´æ¶æ„åˆ†æ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-07T02:14:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·341408199125"/> <meta itemprop="url" content="https://juejin.cn/user/570004686782272"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android ç½‘ç»œä¼ è¾“æ•°æ®ç»Ÿè®¡æœåŠ¡ï¼ˆNetworkStats Serviceï¼‰å®Œæ•´æ¶æ„åˆ†æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/570004686782272/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·341408199125
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T02:14:45.000Z" title="Sat Feb 07 2026 02:14:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»16åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æˆ‘æ¥åˆ†æ Android ç½‘ç»œä¼ è¾“æ•°æ®ç»Ÿè®¡æœåŠ¡çš„å®Œæ•´æ¶æ„ã€‚</p>
<p>ç°åœ¨è®©æˆ‘ç»§ç»­æœç´¢æ›´å¤šå…³é”®ç»„ä»¶ã€‚</p>
<p>ç°åœ¨æˆ‘æœ‰äº†è¶³å¤Ÿçš„ä¿¡æ¯æ¥è¯¦ç»†åˆ†æ Android ç½‘ç»œä¼ è¾“æ•°æ®ç»Ÿè®¡æœåŠ¡ã€‚è®©æˆ‘ä¸ºç”¨æˆ·æ•´ç†å®Œæ•´çš„æ¶æ„åˆ†æã€‚</p>
<h2 data-id="heading-0">Android ç½‘ç»œä¼ è¾“æ•°æ®ç»Ÿè®¡æœåŠ¡ï¼ˆNetworkStats Serviceï¼‰å®Œæ•´æ¶æ„åˆ†æ</h2>
<p>åŸºäºå¯¹æ•´ä¸ª android1 ç›®å½•çš„æ·±åº¦åˆ†æï¼Œæˆ‘æ¥è¯¦ç»†è®²è§£ Android ç½‘ç»œä¼ è¾“æ•°æ®ç»Ÿè®¡æœåŠ¡çš„æ¶æ„ã€‚</p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€æ ¸å¿ƒæ¨¡å—æ¦‚è§ˆ</h2>
<h3 data-id="heading-2">1. <strong>åˆ†å±‚æ¶æ„</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åº”ç”¨å±‚ <span class="hljs-variable constant_">API</span>                                                    â”‚
â”‚ <span class="hljs-title class_">TrafficStats</span> / <span class="hljs-title class_">NetworkStatsManager</span> / <span class="hljs-title class_">NetworkStats</span>             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç³»ç»ŸæœåŠ¡å±‚                                                    â”‚
â”‚ <span class="hljs-title class_">NetworkStatsService</span> / <span class="hljs-title class_">INetworkStatsService</span> (<span class="hljs-title class_">Binder</span>)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ•°æ®æ”¶é›†å’ŒæŒä¹…åŒ–                                              â”‚
â”‚ <span class="hljs-title class_">NetworkStatsRecorder</span> / <span class="hljs-title class_">NetworkStatsCollection</span> / <span class="hljs-title class_">FileRotator</span>   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å†…æ ¸æ•°æ®æº                                                    â”‚
â”‚ eBPF <span class="hljs-title class_">Maps</span> / xt_qtaguid / <span class="hljs-regexp">/proc/</span>net/xt_qtaguid/stats         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h2 data-id="heading-3">äºŒã€æ ¸å¿ƒæ•°æ®ç»“æ„è¯¦è§£</h2>
<h3 data-id="heading-4">1. <strong>NetworkStats.Bucketï¼ˆæ•°æ®ç»Ÿè®¡æ¡¶ï¼‰</strong></h3>
<p>æœ€å°æ•°æ®å•ä½ï¼Œæ¯ä¸ª Bucket åŒ…å«ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Bucket</span> {
    <span class="hljs-comment">// æ—¶é—´èŒƒå›´</span>
    <span class="hljs-type">long</span> mBeginTimeStamp;     <span class="hljs-comment">// å¼€å§‹æ—¶é—´æˆ³</span>
    <span class="hljs-type">long</span> mEndTimeStamp;       <span class="hljs-comment">// ç»“æŸæ—¶é—´æˆ³</span>
    
    <span class="hljs-comment">// æµé‡æ•°æ®</span>
    <span class="hljs-type">long</span> mRxBytes;            <span class="hljs-comment">// æ¥æ”¶å­—èŠ‚æ•°</span>
    <span class="hljs-type">long</span> mRxPackets;          <span class="hljs-comment">// æ¥æ”¶åŒ…æ•°</span>
    <span class="hljs-type">long</span> mTxBytes;            <span class="hljs-comment">// å‘é€å­—èŠ‚æ•°</span>
    <span class="hljs-type">long</span> mTxPackets;          <span class="hljs-comment">// å‘é€åŒ…æ•°</span>
    
    <span class="hljs-comment">// ç»´åº¦ä¿¡æ¯</span>
    <span class="hljs-type">int</span> mUid;                 <span class="hljs-comment">// UID (è¿›ç¨‹ID)</span>
    <span class="hljs-type">int</span> mTag;                 <span class="hljs-comment">// æ ‡ç­¾ (åº”ç”¨çº§æ ‡ç­¾)</span>
    <span class="hljs-type">int</span> mState;               <span class="hljs-comment">// çŠ¶æ€ (STATE_DEFAULT/STATE_FOREGROUND)</span>
    <span class="hljs-type">int</span> mMetered;             <span class="hljs-comment">// æ˜¯å¦è®¡è´¹ (METERED_YES/NO/ALL)</span>
    <span class="hljs-type">int</span> mRoaming;             <span class="hljs-comment">// æ˜¯å¦æ¼«æ¸¸ (ROAMING_YES/NO/ALL)</span>
    <span class="hljs-type">int</span> mDefaultNetworkStatus;<span class="hljs-comment">// æ˜¯å¦é»˜è®¤ç½‘ç»œ</span>
}
</code></pre>
<p><strong>å…³é”®å¸¸é‡</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// çŠ¶æ€</span>
STATE_ALL = -<span class="hljs-number">1</span>           <span class="hljs-comment">// æ‰€æœ‰çŠ¶æ€</span>
STATE_DEFAULT = <span class="hljs-number">0x1</span>      <span class="hljs-comment">// åå°æµé‡</span>
STATE_FOREGROUND = <span class="hljs-number">0x2</span>   <span class="hljs-comment">// å‰å°æµé‡</span>

<span class="hljs-comment">// è®¡è´¹ç±»å‹</span>
METERED_ALL = -<span class="hljs-number">1</span>
METERED_NO = <span class="hljs-number">0x1</span>         <span class="hljs-comment">// éè®¡è´¹ (WiFi)</span>
METERED_YES = <span class="hljs-number">0x2</span>        <span class="hljs-comment">// è®¡è´¹ (ç§»åŠ¨ç½‘ç»œ)</span>

<span class="hljs-comment">// ç‰¹æ®Š UID</span>
UID_ALL = -<span class="hljs-number">1</span>
UID_REMOVED = -<span class="hljs-number">4</span>         <span class="hljs-comment">// å·²å¸è½½åº”ç”¨</span>
UID_TETHERING = -<span class="hljs-number">5</span>       <span class="hljs-comment">// ç½‘ç»œå…±äº«</span>
</code></pre>
<h3 data-id="heading-5">2. <strong>NetworkStatsHistoryï¼ˆå†å²æ•°æ®å®¹å™¨ï¼‰</strong></h3>
<p>å­˜å‚¨ä¸€ç³»åˆ—æ—¶é—´è¿ç»­çš„æ•°æ®æ¡¶ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkStatsHistory</span> {
    <span class="hljs-comment">// å­˜å‚¨å•ä½ï¼šé•¿æ•°ç»„</span>
    <span class="hljs-type">long</span>[] bucketStart;      <span class="hljs-comment">// æ¯ä¸ª Bucket çš„å¼€å§‹æ—¶é—´</span>
    <span class="hljs-type">long</span>[] rxBytes;          <span class="hljs-comment">// æ¯ä¸ª Bucket çš„æ¥æ”¶å­—èŠ‚æ•°</span>
    <span class="hljs-type">long</span>[] rxPackets;        <span class="hljs-comment">// æ¯ä¸ª Bucket çš„æ¥æ”¶åŒ…æ•°</span>
    <span class="hljs-type">long</span>[] txBytes;          <span class="hljs-comment">// æ¯ä¸ª Bucket çš„å‘é€å­—èŠ‚æ•°</span>
    <span class="hljs-type">long</span>[] txPackets;        <span class="hljs-comment">// æ¯ä¸ª Bucket çš„å‘é€åŒ…æ•°</span>
    <span class="hljs-type">long</span>[] operations;       <span class="hljs-comment">// æ“ä½œæ•° (å¯é€‰)</span>
    
    <span class="hljs-type">long</span> bucketDuration;     <span class="hljs-comment">// æ¯ä¸ª Bucket çš„æ—¶é•¿ (é€šå¸¸ 2 å°æ—¶)</span>
    <span class="hljs-type">int</span> bucketCount;         <span class="hljs-comment">// å½“å‰ Bucket æ•°é‡</span>
}
</code></pre>
<h3 data-id="heading-6">3. <strong>NetworkStatsCollectionï¼ˆæ”¶é›†å™¨ï¼‰</strong></h3>
<p>å¤šä¸ª NetworkStatsHistory çš„èšåˆï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkStatsCollection</span> {
    <span class="hljs-comment">// é”®å€¼å¯¹å­˜å‚¨</span>
    ArrayMap&lt;Key, NetworkStatsHistory&gt; mStats;
    
    <span class="hljs-comment">// Key ç»“æ„</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Key</span> {
        NetworkIdentitySet ident;    <span class="hljs-comment">// ç½‘ç»œèº«ä»½ (ç§»åŠ¨/WiFiç­‰)</span>
        <span class="hljs-type">int</span> uid;                     <span class="hljs-comment">// UID</span>
        <span class="hljs-type">int</span> set;                     <span class="hljs-comment">// SET (DEFAULT/FOREGROUND)</span>
        <span class="hljs-type">int</span> tag;                     <span class="hljs-comment">// TAG (åº”ç”¨æ ‡ç­¾)</span>
    }
    
    <span class="hljs-type">long</span> mBucketDurationMillis;      <span class="hljs-comment">// Bucket æ—¶é•¿</span>
    <span class="hljs-type">long</span> mStartMillis;               <span class="hljs-comment">// é›†åˆå¼€å§‹æ—¶é—´</span>
    <span class="hljs-type">long</span> mEndMillis;                 <span class="hljs-comment">// é›†åˆç»“æŸæ—¶é—´</span>
    <span class="hljs-type">long</span> mTotalBytes;                <span class="hljs-comment">// æ€»å­—èŠ‚æ•° (ç¼“å­˜)</span>
    <span class="hljs-type">boolean</span> mDirty;                  <span class="hljs-comment">// æ˜¯å¦æœ‰æœªä¿å­˜çš„ä¿®æ”¹</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-7">ä¸‰ã€æ ¸å¿ƒæœåŠ¡å®ç°</h2>
<h3 data-id="heading-8">1. <strong>NetworkStatsService</strong></h3>
<p>ä½ç½®ï¼š<code>packages_modules_Connectivity/service-t/src/com/android/server/net/NetworkStatsService.java</code></p>
<p><strong>æ ¸å¿ƒèŒè´£</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkStatsService</span> {
    <span class="hljs-comment">// ä¸‰ä¸ªç‹¬ç«‹çš„ Recorder</span>
    <span class="hljs-keyword">private</span> NetworkStatsRecorder mXtRecorder;      <span class="hljs-comment">// XT ç»Ÿè®¡ (æ¥å£çº§)</span>
    <span class="hljs-keyword">private</span> NetworkStatsRecorder mUidRecorder;     <span class="hljs-comment">// UID ç»Ÿè®¡ (åº”ç”¨çº§)</span>
    <span class="hljs-keyword">private</span> NetworkStatsRecorder mUidTagRecorder;  <span class="hljs-comment">// UID+Tag ç»Ÿè®¡ (ç»†ç²’åº¦)</span>
    
    <span class="hljs-comment">// é…ç½®é¡¹</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> NetworkStatsSettings mSettings;
    
    <span class="hljs-comment">// å®šæ—¶è½®è¯¢</span>
    <span class="hljs-keyword">private</span> PendingIntent mPollIntent;             <span class="hljs-comment">// å®šæœŸè½®è¯¢ Intent</span>
    <span class="hljs-keyword">private</span> AlarmManager mAlarmManager;            <span class="hljs-comment">// å‘Šè­¦ç®¡ç†å™¨</span>
    
    <span class="hljs-comment">// æ•°æ®æº</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> INetd mNetd;                     <span class="hljs-comment">// netd Binder æ¥å£</span>
    <span class="hljs-keyword">private</span> AlertObserver mAlertObserver;          <span class="hljs-comment">// å‘Šè­¦è§‚å¯Ÿè€…</span>
}
</code></pre>
<p><strong>ä¸»è¦æ–¹æ³•</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è½®è¯¢è§¦å‘</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">handlePollLocked</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 1. è·å–å½“å‰ç½‘ç»œç»Ÿè®¡å¿«ç…§</span>
    <span class="hljs-type">NetworkStats</span> <span class="hljs-variable">snapshot</span> <span class="hljs-operator">=</span> getNetworkStatsFromKernel();
    
    <span class="hljs-comment">// 2. è®¡ç®— delta (å¢é‡)</span>
    <span class="hljs-type">NetworkStats</span> <span class="hljs-variable">delta</span> <span class="hljs-operator">=</span> calculateDelta(lastSnapshot, snapshot);
    
    <span class="hljs-comment">// 3. è®°å½•åˆ° mXtRecorder / mUidRecorder</span>
    mXtRecorder.recordSnapshotLocked(snapshot, ...);
    mUidRecorder.recordSnapshotLocked(snapshot, ...);
    
    <span class="hljs-comment">// 4. å°è¯•æŒä¹…åŒ– (å¦‚æœè¶…è¿‡é˜ˆå€¼)</span>
    mXtRecorder.maybePersistLocked(currentTimeMillis);
    mUidRecorder.maybePersistLocked(currentTimeMillis);
    
    <span class="hljs-comment">// 5. å¹¿æ’­ç»Ÿè®¡å·²æ›´æ–°äº‹ä»¶</span>
    broadcastNetworkStatsUpdated();
}

<span class="hljs-comment">// æŸ¥è¯¢æ¥å£</span>
NetworkStats <span class="hljs-title function_">getDataLayerSnapshotForUid</span><span class="hljs-params">(<span class="hljs-type">int</span> uid)</span> {
    <span class="hljs-comment">// è¿”å›å½“å‰ UID çš„å³æ—¶å¿«ç…§ (ä¸èšåˆ)</span>
}

NetworkStats <span class="hljs-title function_">getSummaryForUser</span><span class="hljs-params">(NetworkTemplate template, 
                               <span class="hljs-type">long</span> start, <span class="hljs-type">long</span> end)</span> {
    <span class="hljs-comment">// è¿”å›ç»™å®šæ—¶é—´èŒƒå›´çš„æ±‡æ€»ç»Ÿè®¡ (èšåˆæ‰€æœ‰æ—¶é—´)</span>
}

NetworkStats <span class="hljs-title function_">getHistoryForUid</span><span class="hljs-params">(NetworkTemplate template, 
                              <span class="hljs-type">int</span> uid, <span class="hljs-type">int</span> tag, <span class="hljs-type">int</span> state,
                              <span class="hljs-type">long</span> start, <span class="hljs-type">long</span> end)</span> {
    <span class="hljs-comment">// è¿”å›å†å²æ•°æ® (æŒ‰æ—¶é—´åˆ†æ¡¶)</span>
}
</code></pre>
<h3 data-id="heading-9">2. <strong>NetworkStatsRecorderï¼ˆæ•°æ®è®°å½•å™¨ï¼‰</strong></h3>
<p><strong>æ ¸å¿ƒèŒè´£</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkStatsRecorder</span> {
    <span class="hljs-comment">// æ–‡ä»¶è½®è½¬ç®¡ç†</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> FileRotator mRotator;     <span class="hljs-comment">// æ–‡ä»¶è‡ªåŠ¨è½®è½¬</span>
    
    <span class="hljs-comment">// å†…å­˜ç¼“å­˜</span>
    <span class="hljs-keyword">private</span> NetworkStatsCollection mPending;<span class="hljs-comment">// å¾…å†™å…¥çš„æ•°æ®</span>
    <span class="hljs-keyword">private</span> NetworkStatsCollection mSinceBoot; <span class="hljs-comment">// å¯åŠ¨ä»¥æ¥çš„ç´¯è®¡æ•°æ®</span>
    <span class="hljs-keyword">private</span> WeakReference&lt;NetworkStatsCollection&gt; mComplete; <span class="hljs-comment">// å®Œæ•´å†å² (æ‡’åŠ è½½)</span>
    
    <span class="hljs-comment">// é…ç½®</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> mBucketDuration;     <span class="hljs-comment">// Bucket æ—¶é•¿ (é€šå¸¸ 2 å°æ—¶)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> mPersistThresholdBytes;    <span class="hljs-comment">// æŒä¹…åŒ–é˜ˆå€¼ (é»˜è®¤ 2 MB)</span>
}
</code></pre>
<p><strong>å…³é”®æ–¹æ³•</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è®°å½•å¿«ç…§å¢é‡</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">recordSnapshotLocked</span><span class="hljs-params">(NetworkStats snapshot, 
                         Map&lt;String, Long&gt; ifaceStats,
                         <span class="hljs-type">long</span> currentTimeMillis)</span> {
    <span class="hljs-comment">// 1. è®¡ç®—æœ¬æ¬¡å¿«ç…§ä¸ä¸Šæ¬¡çš„å·®å€¼</span>
    <span class="hljs-type">NetworkStats</span> <span class="hljs-variable">delta</span> <span class="hljs-operator">=</span> calculateDelta(mLastSnapshot, snapshot);
    
    <span class="hljs-comment">// 2. å°†å·®å€¼æ•°æ®å½’å…¥ mPending (æŒ‰ Bucket åˆ†ç»„)</span>
    mPending.recordData(delta);
    
    <span class="hljs-comment">// 3. æ›´æ–° mSinceBoot</span>
    mSinceBoot.recordData(delta);
    
    <span class="hljs-comment">// 4. æ›´æ–°æœ€åå¿«ç…§</span>
    mLastSnapshot = snapshot;
    
    <span class="hljs-comment">// 5. æ£€æŸ¥æ˜¯å¦éœ€è¦æŒä¹…åŒ–</span>
    <span class="hljs-keyword">if</span> (mPending.getTotalBytes() &gt;= mPersistThresholdBytes) {
        forcePersistLocked(currentTimeMillis);
    }
}

<span class="hljs-comment">// æŒä¹…åŒ–åˆ°ç£ç›˜</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">forcePersistLocked</span><span class="hljs-params">(<span class="hljs-type">long</span> currentTimeMillis)</span> {
    <span class="hljs-keyword">if</span> (mPending.isDirty()) {
        <span class="hljs-comment">// é€šè¿‡ FileRotator å†™å…¥æ–‡ä»¶</span>
        mRotator.rewriteActive(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CombiningRewriter</span>(mPending), 
                               currentTimeMillis);
        mPending.reset();  <span class="hljs-comment">// æ¸…ç©ºå†…å­˜ç¼“å†²</span>
    }
}

<span class="hljs-comment">// åŠ è½½å®Œæ•´å†å²</span>
NetworkStatsCollection <span class="hljs-title function_">getOrLoadCompleteLocked</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (mComplete.get() == <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// ä»ç£ç›˜åŠ è½½å…¨éƒ¨å†å²æ•°æ®</span>
        <span class="hljs-type">NetworkStatsCollection</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> loadLocked(
            Long.MIN_VALUE, Long.MAX_VALUE);
        <span class="hljs-comment">// åˆå¹¶å¾…å†™å…¥çš„æ•°æ®</span>
        res.recordCollection(mPending);
        mComplete = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>&lt;&gt;(res);
    }
    <span class="hljs-keyword">return</span> mComplete.get();
}
</code></pre>
<hr/>
<h2 data-id="heading-10">å››ã€æ•°æ®æŒä¹…åŒ–æœºåˆ¶</h2>
<h3 data-id="heading-11">1. <strong>FileRotatorï¼ˆæ–‡ä»¶è½®è½¬ï¼‰</strong></h3>
<pre><code class="hljs language-markdown" lang="markdown">æ•°æ®æµï¼š
å†…å­˜ç¼“å†² (mPending)
<span class="hljs-code">    â†“ è¾¾åˆ°é˜ˆå€¼æˆ–å®šæ—¶
    â†“
FileRotator å†™å…¥æ´»è·ƒæ–‡ä»¶
    â†“ åˆ°è¾¾è½®è½¬æ—¶é—´
    â†“
å½’æ¡£æ–‡ä»¶ï¼ˆæŒ‰æ—¥æœŸï¼‰
    â†“ è¶…è¿‡ä¿ç•™æœŸé™
    â†“
åˆ é™¤
</span></code></pre>
<p><strong>æ–‡ä»¶ç»“æ„</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/data/system/netstats/
â”œâ”€â”€ xt_stat_current         <span class="hljs-comment"># å½“å‰æ´»è·ƒæ–‡ä»¶ (XT ç»Ÿè®¡)</span>
â”œâ”€â”€ xt_stat_001             <span class="hljs-comment"># å½’æ¡£æ–‡ä»¶ (æŒ‰æ—¶é—´æˆ³)</span>
â”œâ”€â”€ xt_stat_002
â”œâ”€â”€ uid_stat_current        <span class="hljs-comment"># å½“å‰æ´»è·ƒæ–‡ä»¶ (UID ç»Ÿè®¡)</span>
â”œâ”€â”€ uid_stat_001
â”œâ”€â”€ uid_stat_002
â”œâ”€â”€ uid_tag_stat_current    <span class="hljs-comment"># å½“å‰æ´»è·ƒæ–‡ä»¶ (TAG ç»Ÿè®¡)</span>
â””â”€â”€ uid_tag_stat_001
</code></pre>
<p><strong>é…ç½®å‚æ•°</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// XT é…ç½®ï¼ˆæ¥å£çº§ï¼‰</span>
XT_CONFIG:
  bucketDuration = <span class="hljs-number">1</span> å°æ—¶
  rotateAgeMillis = <span class="hljs-number">15</span> å¤©
  deleteAgeMillis = <span class="hljs-number">90</span> å¤©

<span class="hljs-comment">// UID é…ç½®ï¼ˆåº”ç”¨çº§ï¼‰</span>
UID_CONFIG:
  bucketDuration = <span class="hljs-number">2</span> å°æ—¶
  rotateAgeMillis = <span class="hljs-number">7</span> å¤©
  deleteAgeMillis = <span class="hljs-number">30</span> å¤©

<span class="hljs-comment">// TAG é…ç½®ï¼ˆç»†ç²’åº¦ï¼‰</span>
UID_TAG_CONFIG:
  bucketDuration = <span class="hljs-number">2</span> å°æ—¶
  rotateAgeMillis = <span class="hljs-number">1</span> å¤©
  deleteAgeMillis = <span class="hljs-number">5</span> å¤©
</code></pre>
<h3 data-id="heading-12">2. <strong>NetworkStatsCollection æŒä¹…åŒ–æ ¼å¼</strong></h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[æ–‡ä»¶å¤´]</span>
Magic: "ANET" (0x414E4554)
Version: 16 (UNIFIED_INIT)

<span class="hljs-section">[æ•°æ®æ®µ]</span>
NetworkIdentitySet count
  â”œâ”€ ident1
  â”œâ”€ ident2
  â””â”€ ...

Key count
  â”œâ”€ (ident_idx, uid, set, tag) â†’ NetworkStatsHistory
  â”œâ”€ (ident_idx, uid, set, tag) â†’ NetworkStatsHistory
  â””â”€ ...

<span class="hljs-section">[NetworkStatsHistory æ ¼å¼]</span>
bucketStart<span class="hljs-section">[]</span>
rxBytes<span class="hljs-section">[]</span>
rxPackets<span class="hljs-section">[]</span>
txBytes<span class="hljs-section">[]</span>
txPackets<span class="hljs-section">[]</span>
operations<span class="hljs-section">[]</span> (å¯é€‰)
</code></pre>
<hr/>
<h2 data-id="heading-13">äº”ã€æ•°æ®é‡‡é›†é“¾è·¯</h2>
<h3 data-id="heading-14">1. <strong>å†…æ ¸æ•°æ®æº</strong></h3>
<h4 data-id="heading-15">a) <strong>eBPF Maps</strong> (Android 13+)</h4>
<pre><code class="hljs language-scss" lang="scss">eBPF ç¨‹åºæ‹¦æˆªæ‰€æœ‰ç½‘ç»œåŒ…
    â†“
æ›´æ–°å†…æ ¸ç©ºé—´çš„ BPF Mapsï¼š
    â”œâ”€ uidOwnerMap     (UID è§„åˆ™)
    â”œâ”€ statsMap        (æµé‡ç»Ÿè®¡)
    â””â”€ cookieTagMap    (Socket æ ‡ç­¾)
    â†“
ç”¨æˆ·ç©ºé—´è¯»å– BPF Maps
    â†“
NetworkStatsService å®šæœŸè½®è¯¢
</code></pre>
<h4 data-id="heading-16">b) <strong>xt_qtaguid</strong> (Android 12 åŠæ›´æ—©ç‰ˆæœ¬)</h4>
<pre><code class="hljs language-bash" lang="bash">iptables è§„åˆ™æ ‡è®°æ•°æ®åŒ…
    â†“
xt_qtaguid å†…æ ¸æ¨¡å—ç»Ÿè®¡
    â†“
å¯¼å‡ºåˆ° /proc/net/xt_qtaguid/stats
    â†“
NetworkStatsService è¯»å–
</code></pre>
<h3 data-id="heading-17">2. <strong>TrafficStats API - å¿«é€ŸæŸ¥è¯¢</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è·å–å½“å‰ UID çš„å³æ—¶æµé‡</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getUidRxBytes</span><span class="hljs-params">(<span class="hljs-type">int</span> uid)</span> {
    <span class="hljs-comment">// ç›´æ¥ä»å†…æ ¸è¯»å–ï¼Œæ— éœ€ç£ç›˜ I/O</span>
    <span class="hljs-keyword">return</span> getStatsService().getUidStats(uid, TYPE_RX_BYTES);
}

<span class="hljs-comment">// è°ƒç”¨é“¾ï¼š</span>
TrafficStats.getUidRxBytes(uid)
    â†“
INetworkStatsService.Stub (Binder)
    â†“
NetworkStatsService.getUidStats(uid, type)
    â†“
ä» eBPF Maps æˆ– /proc è¯»å–
</code></pre>
<hr/>
<h2 data-id="heading-18">å…­ã€æŸ¥è¯¢ API è¯¦è§£</h2>
<h3 data-id="heading-19">1. <strong>NetworkStatsManager - åº”ç”¨ä¾§æŸ¥è¯¢</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkStatsManager</span> {
    <span class="hljs-comment">// æŸ¥è¯¢æ±‡æ€»æ•°æ®ï¼ˆæŒ‰æ—¶é—´èšåˆï¼‰</span>
    Bucket <span class="hljs-title function_">querySummaryForDevice</span><span class="hljs-params">(NetworkTemplate template,
                               <span class="hljs-type">long</span> startTime, <span class="hljs-type">long</span> endTime)</span>
    
    Bucket <span class="hljs-title function_">querySummaryForUser</span><span class="hljs-params">(<span class="hljs-type">int</span> networkType, String subscriberId,
                             <span class="hljs-type">long</span> startTime, <span class="hljs-type">long</span> endTime)</span>
    
    <span class="hljs-comment">// æŸ¥è¯¢å†å²æ•°æ®ï¼ˆæŒ‰æ—¶é—´åˆ†æ¡¶ï¼‰</span>
    NetworkStats <span class="hljs-title function_">queryDetailsForUidTag</span><span class="hljs-params">(<span class="hljs-type">int</span> networkType, String subscriberId,
                                     <span class="hljs-type">long</span> startTime, <span class="hljs-type">long</span> endTime, 
                                     <span class="hljs-type">int</span> uid, <span class="hljs-type">int</span> tag)</span>
    
    NetworkStats <span class="hljs-title function_">queryDetails</span><span class="hljs-params">(<span class="hljs-type">int</span> networkType, String subscriberId,
                            <span class="hljs-type">long</span> startTime, <span class="hljs-type">long</span> endTime)</span>
}
</code></pre>
<p><strong>æŸ¥è¯¢ç±»å‹</strong>ï¼š</p>
<pre><code class="hljs language-objectivec" lang="objectivec">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ±‡æ€»æŸ¥è¯¢ (Summary)                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - èšåˆæ‰€æœ‰æ—¶é—´åŒºé—´                                      â”‚
â”‚ - èšåˆæ‰€æœ‰ <span class="hljs-built_in">UID</span>                                          â”‚
â”‚ - è¿”å›å•ä¸ª Bucket                                       â”‚
â”‚ - æ—¶é—´æˆ³éƒ½ç›¸ç­‰ï¼ˆstartTime == endTimeï¼‰                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å†å²æŸ¥è¯¢ (History)                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - æŒ‰æ—¶é—´åˆ†æ¡¶ï¼Œé€šå¸¸ <span class="hljs-number">2</span> å°æ—¶ä¸€ä¸ª Bucket                   â”‚
â”‚ - ä¸èšåˆ <span class="hljs-built_in">UID</span>ï¼ˆæŒ‡å®šå•ä¸ª <span class="hljs-built_in">UID</span>ï¼‰                           â”‚
â”‚ - è¿”å›å¤šä¸ª Bucket                                       â”‚
â”‚ - æ¯ä¸ª Bucket ä»£è¡¨ç‰¹å®šæ—¶é—´æ®µ                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-20">2. <strong>æƒé™æ¨¡å‹</strong></h3>
<pre><code class="hljs language-scss" lang="scss">å¯è®¿é—®èŒƒå›´ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æƒé™             â”‚ æŸ¥è¯¢èŒƒå›´         â”‚ éœ€è¦æƒé™         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ— æƒé™           â”‚ ä»…è‡ªå·±çš„åº”ç”¨     â”‚ -                â”‚
â”‚ PACKAGE_USAGE    â”‚ æ‰€æœ‰åº”ç”¨ï¼ˆç”¨æˆ·ï¼‰ â”‚ PACKAGE_USAGE    â”‚
â”‚ STATS            â”‚ æ‰€æœ‰åº”ç”¨ï¼ˆè®¾å¤‡ï¼‰ â”‚ PACKAGE_USAGE    â”‚
â”‚ DPC (è®¾å¤‡ç®¡ç†å‘˜) â”‚ å—ç®¡ç”¨æˆ·çš„åº”ç”¨   â”‚ è‡ªåŠ¨æˆäºˆ         â”‚
â”‚ è¿è¥å•†æƒé™       â”‚ æ‰€æœ‰æ•°æ®         â”‚ è¿è¥å•†æƒé™       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h2 data-id="heading-21">ä¸ƒã€TAG æœºåˆ¶ï¼ˆç»†ç²’åº¦ç»Ÿè®¡ï¼‰</h2>
<h3 data-id="heading-22">1. <strong>åº”ç”¨æ ‡ç­¾ï¼ˆApp-level Tagsï¼‰</strong></h3>
<pre><code class="hljs language-scss" lang="scss">åº”ç”¨ â†’ <span class="hljs-built_in">tagSocket</span>() â†’ UID + Tag
    â†“
æ•°æ®åŒ…æµç» netd
    â†“
FwmarkServer æ‹¦æˆª
    â†“
è®¾ç½® socket å…³è”çš„ tag
    â†“
å†…æ ¸ç»Ÿè®¡æ—¶å¸¦ä¸Š tag ä¿¡æ¯
</code></pre>
<h3 data-id="heading-23">2. <strong>æ ‡ç­¾å­˜å‚¨</strong></h3>
<p><strong>CookieTagMap (eBPF)</strong>:</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">CookieTagMapKey</span> {</span>
    <span class="hljs-type">uint64_t</span> socketCookie;
};

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">CookieTagMapValue</span> {</span>
    <span class="hljs-type">uint32_t</span> tag;
    <span class="hljs-type">uint32_t</span> uid;
};
</code></pre>
<h3 data-id="heading-24">3. <strong>TAG æŸ¥è¯¢ç¤ºä¾‹</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æŸ¥è¯¢ UID 10001 çš„æ ‡ç­¾ç»Ÿè®¡</span>
<span class="hljs-type">NetworkStats</span> <span class="hljs-variable">stats</span> <span class="hljs-operator">=</span> queryDetailsForUidTag(
    ConnectivityManager.TYPE_MOBILE,
    <span class="hljs-literal">null</span>,
    startTime, endTime,
    <span class="hljs-number">10001</span>,                    <span class="hljs-comment">// UID</span>
    <span class="hljs-number">0x1234</span>                    <span class="hljs-comment">// TAG (å…·ä½“æ ‡ç­¾å€¼)</span>
);
</code></pre>
<hr/>
<h2 data-id="heading-25">å…«ã€æ€§èƒ½ä¼˜åŒ–</h2>
<h3 data-id="heading-26">1. <strong>Bucket æ—¶é•¿ï¼ˆGranularityï¼‰</strong></h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="hljs-string">â”‚</span> <span class="hljs-string">Bucket</span> <span class="hljs-string">æ—¶é•¿å¯¹æ€§èƒ½çš„å½±å“</span>                         <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="hljs-string">â”‚</span> <span class="hljs-string">æ—¶é•¿</span>     <span class="hljs-string">â”‚</span> <span class="hljs-number">1</span> <span class="hljs-string">å°æ—¶</span> <span class="hljs-string">â”‚</span> <span class="hljs-number">2</span><span class="hljs-string">å°æ—¶â”‚</span> <span class="hljs-number">4</span><span class="hljs-string">å°æ—¶â”‚</span> <span class="hljs-number">6</span><span class="hljs-string">å°æ—¶â”‚</span> <span class="hljs-number">12</span> <span class="hljs-string">å°æ—¶â”‚</span>
<span class="hljs-string">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="hljs-string">â”‚</span> <span class="hljs-string">æ—¥æ•°æ®é‡</span> <span class="hljs-string">â”‚</span>  <span class="hljs-number">24</span> <span class="hljs-string">ä¸ª</span> <span class="hljs-string">â”‚</span> <span class="hljs-number">12</span> <span class="hljs-string">ä¸ªâ”‚</span> <span class="hljs-number">6</span> <span class="hljs-string">ä¸ª</span> <span class="hljs-string">â”‚</span> <span class="hljs-number">4</span> <span class="hljs-string">ä¸ª</span> <span class="hljs-string">â”‚</span>  <span class="hljs-number">2</span> <span class="hljs-string">ä¸ª</span> <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span> <span class="hljs-string">å¹´æ•°æ®</span>   <span class="hljs-string">â”‚</span>  <span class="hljs-number">8760</span> <span class="hljs-string">â”‚</span> <span class="hljs-number">4380</span> <span class="hljs-string">â”‚</span> <span class="hljs-number">2190</span> <span class="hljs-string">â”‚1460</span> <span class="hljs-string">â”‚</span>  <span class="hljs-number">730</span>  <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span> <span class="hljs-string">å†…å­˜å ç”¨</span> <span class="hljs-string">â”‚</span> <span class="hljs-string">è¾ƒå¤š</span>   <span class="hljs-string">â”‚</span> <span class="hljs-string">ä¸­ç­‰</span> <span class="hljs-string">â”‚</span> <span class="hljs-string">è¾ƒå°‘</span> <span class="hljs-string">â”‚</span> <span class="hljs-string">å°‘</span>  <span class="hljs-string">â”‚</span>  <span class="hljs-string">å¾ˆå°‘</span> <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span> <span class="hljs-string">å‡†ç¡®åº¦</span>   <span class="hljs-string">â”‚</span> <span class="hljs-string">é«˜</span>     <span class="hljs-string">â”‚</span> <span class="hljs-string">é«˜</span>   <span class="hljs-string">â”‚</span> <span class="hljs-string">ä¸­</span>   <span class="hljs-string">â”‚</span> <span class="hljs-string">ä½</span>  <span class="hljs-string">â”‚</span>  <span class="hljs-string">ä½</span>   <span class="hljs-string">â”‚</span>
<span class="hljs-string">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre>
<p><strong>Android é…ç½®</strong>ï¼š</p>
<ul>
<li>XT (æ¥å£çº§): 1 å°æ—¶</li>
<li>UID (åº”ç”¨çº§): 2 å°æ—¶</li>
<li>TAG (ç»†ç²’åº¦): 2 å°æ—¶</li>
</ul>
<h3 data-id="heading-27">2. <strong>æŒä¹…åŒ–ä¼˜åŒ–</strong></h3>
<pre><code class="hljs language-diff" lang="diff">é˜ˆå€¼ä¼˜åŒ–ï¼š
<span class="hljs-deletion">- é»˜è®¤ 2 MBï¼ˆå¯é…ç½®ï¼‰</span>
<span class="hljs-deletion">- è¶…è¿‡é˜ˆå€¼ç«‹å³å†™ç›˜</span>
<span class="hljs-deletion">- å®šæ—¶è½®è½¬ï¼ˆé˜²æ­¢æ–‡ä»¶è¿‡å¤§ï¼‰</span>
<span class="hljs-deletion">- å¢é‡è®°å½•ï¼ˆåªè®°å½•å˜åŒ–é‡ï¼‰</span>
</code></pre>
<h3 data-id="heading-28">3. <strong>æŸ¥è¯¢ä¼˜åŒ–</strong></h3>
<pre><code class="hljs language-diff" lang="diff">ç¼“å­˜ç­–ç•¥ï¼š
<span class="hljs-deletion">- mComplete: WeakReference (lazy load)</span>
<span class="hljs-deletion">- æ‡’åŠ è½½å®Œæ•´å†å²</span>
<span class="hljs-deletion">- å†…å­˜å‹åŠ›å¤§æ—¶è‡ªåŠ¨é‡Šæ”¾</span>
<span class="hljs-deletion">- é‡æ–°åŠ è½½æ—¶åˆå¹¶å¢é‡æ•°æ®</span>
</code></pre>
<hr/>
<h2 data-id="heading-29">ä¹ã€464xlat æµé‡è°ƒæ•´</h2>
<h3 data-id="heading-30">ç‰¹æ®Šå¤„ç†ï¼šIPv6-only ç½‘ç»œä¸Šçš„ IPv4 æµé‡</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 464xlat ä¼šé¢å¤–å¢åŠ  IPv4 vs IPv6 å¤´çš„ 20 å­—èŠ‚å·®</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">apply464xlatAdjustments</span><span class="hljs-params">(
    NetworkStats baseTraffic,
    NetworkStats stackedTraffic,
    Map&lt;String, String&gt; stackedIfaces)</span> {
    
    <span class="hljs-comment">// å¯¹ clat æ¥å£çš„æµé‡å¢åŠ  20 å­—èŠ‚/åŒ…è°ƒæ•´</span>
    <span class="hljs-keyword">for</span> (Entry entry : stackedTraffic) {
        <span class="hljs-keyword">if</span> (entry.iface.startsWith(<span class="hljs-string">"v4-"</span>)) {
            entry.rxBytes += entry.rxPackets * IPV4V6_HEADER_DELTA;  <span class="hljs-comment">// +20</span>
            entry.txBytes += entry.txPackets * IPV4V6_HEADER_DELTA;
        }
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-31">åã€æ ¸å¿ƒé¢è¯•çŸ¥è¯†ç‚¹</h2>
<h3 data-id="heading-32">1. <strong>Bucket vs History vs Collection</strong></h3>
<ul>
<li><strong>Bucket</strong>: å•ä¸ªæ—¶é—´æ®µçš„ç»Ÿè®¡æ•°æ®ï¼ˆæœ€å°å•ä½ï¼‰</li>
<li><strong>History</strong>: æ—¶é—´åºåˆ—çš„ Bucket æ•°ç»„ï¼ˆåŒä¸€ä¸ª key çš„å†å²ï¼‰</li>
<li><strong>Collection</strong>: å¤šä¸ª History çš„æ˜ å°„ï¼ˆå…¨é‡æ•°æ®ï¼‰</li>
</ul>
<h3 data-id="heading-33">2. <strong>è½®è¯¢æœºåˆ¶</strong></h3>
<ul>
<li>å®šæ—¶å™¨è§¦å‘è½®è¯¢ï¼ˆé»˜è®¤ 30 åˆ†é’Ÿé—´éš”ï¼‰</li>
<li>å¢é‡è®¡ç®—ï¼ˆæ–°å¿«ç…§ - æ—§å¿«ç…§ï¼‰</li>
<li>è¾¾åˆ°é˜ˆå€¼ç«‹å³æŒä¹…åŒ–</li>
</ul>
<h3 data-id="heading-34">3. <strong>æƒé™ç®¡ç†</strong></h3>
<ul>
<li>UID çº§åˆ«çš„éš”ç¦»</li>
<li>PACKAGE_USAGE_STATS æƒé™æ£€æŸ¥</li>
<li>Profile/Device Owner ç‰¹æ®Šæƒé™</li>
</ul>
<h3 data-id="heading-35">4. <strong>æ•°æ®ä¸€è‡´æ€§</strong></h3>
<ul>
<li>æ–‡ä»¶è½®è½¬ç®¡ç†ï¼ˆFileRotatorï¼‰</li>
<li>æ—¥å¿—æ¢å¤æœºåˆ¶ï¼ˆDropBoxManagerï¼‰</li>
<li>æ ¡éªŒå’ŒéªŒè¯</li>
</ul>
<h3 data-id="heading-36">5. <strong>æ€§èƒ½å…³é”®</strong></h3>
<ul>
<li>eBPF å–ä»£ iptables (ä½å¼€é”€)</li>
<li>å¼‚æ­¥æŒä¹…åŒ–</li>
<li>æ‡’åŠ è½½å†å²æ•°æ®</li>
<li>Bucket èšåˆ</li>
</ul>
<p>è¿™å°±æ˜¯ Android ç½‘ç»œç»Ÿè®¡æœåŠ¡çš„å®Œæ•´æ¶æ„ï¼</p>
<p>æˆ‘æ¥æ·±åº¦åˆ†æ eBPF åœ¨ Android ç½‘ç»œç»Ÿè®¡æœåŠ¡ä¸­çš„ä½œç”¨ï¼Œè¿™æ˜¯æ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒã€‚</p>
<p>å¥½çš„ï¼Œç°åœ¨æˆ‘çœ‹åˆ°å…³é”®çš„ eBPF ç¨‹åºä»£ç ã€‚è®©æˆ‘è¿›ä¸€æ­¥æ·±å…¥åˆ†æ eBPF çš„å…·ä½“å·¥ä½œæµç¨‹ï¼š</p>
<p>ç°åœ¨è®©æˆ‘æŸ¥çœ‹ eBPF ç»Ÿè®¡æ›´æ–°çš„å…·ä½“å®ç°ï¼š</p>
<p>ç°åœ¨è®©æˆ‘æ·±å…¥äº†è§£ NetworkStatsService å¦‚ä½•ä» eBPF è¯»å–æ•°æ®ï¼š</p>
<p>å®Œç¾ï¼ç°åœ¨æˆ‘æœ‰è¶³å¤Ÿçš„ä¿¡æ¯æ¥è¿›è¡Œæ·±åº¦åˆ†æã€‚è®©æˆ‘ä¸ºç”¨æˆ·æä¾› eBPF åœ¨ Android ç½‘ç»œç»Ÿè®¡æœåŠ¡ä¸­çš„å®Œæ•´ã€æ¸…æ™°çš„ä½œç”¨åˆ†æã€‚</p>
<h2 data-id="heading-37">Android ç½‘ç»œä¼ è¾“æ•°æ®ç»Ÿè®¡æœåŠ¡ä¸­ eBPF çš„æ·±åº¦åˆ†æ</h2>
<p>æˆ‘æ¥ä»å¤šä¸ªç»´åº¦è§£é‡Š <strong>eBPF åœ¨ Android ç½‘ç»œç»Ÿè®¡æœåŠ¡ä¸­çš„æ ¸å¿ƒä½œç”¨</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-38"><strong>ä¸€ã€eBPF çš„æˆ˜ç•¥åœ°ä½ï¼šæ›¿ä»£ xt_qtaguid çš„å†…æ ¸æ ¸å¿ƒ</strong></h2>
<h3 data-id="heading-39">å†å²èƒŒæ™¯</h3>
<ul>
<li><strong>æ—§æ–¹æ¡ˆï¼ˆAndroid 10-ï¼‰</strong>ï¼šä½¿ç”¨ Linux å†…æ ¸ä¸­çš„ <code>xt_qtaguid</code> æ¨¡å—ï¼Œæ˜¯ iptables æ’ä»¶ï¼Œåœ¨ç½‘ç»œåŒ…å¤„ç†æ—¶æ ‡è®°å’Œç»Ÿè®¡</li>
<li><strong>æ–°æ–¹æ¡ˆï¼ˆAndroid 12+ï¼‰</strong>ï¼šè¿ç§»åˆ° <strong>eBPFï¼ˆextended Berkeley Packet Filterï¼‰</strong>ï¼Œç›´æ¥åœ¨å†…æ ¸è¿è¡Œ JIT ç¼–è¯‘çš„ç¨‹åº</li>
</ul>
<pre><code class="hljs">xt_qtaguidï¼ˆè€ï¼‰          eBPFï¼ˆæ–°ï¼‰
  â”œâ”€ æ¨¡å—åŒ–              â”œâ”€ é«˜æ€§èƒ½ JIT ç¼–è¯‘
  â”œâ”€ é”ç«äº‰æ¿€çƒˆ          â”œâ”€ åŸå­æ“ä½œæ— é”ï¼ˆpercpuï¼‰
  â”œâ”€ ä¸­æ–­å¤„ç†            â”œâ”€ ç›´æ¥åœ¨ cgroup ä¸­è¿è¡Œ
  â””â”€ çµæ´»æ€§æœ‰é™          â””â”€ å¯åŠ¨æ€åŠ è½½/å¸è½½
</code></pre>
<hr/>
<h2 data-id="heading-40"><strong>äºŒã€eBPF ç¨‹åºçš„ 3 ä¸ªå…³é”®æ‰§è¡Œç‚¹</strong></h2>
<h3 data-id="heading-41"><strong>1. Cgroup Ingressï¼ˆå…¥ç«™æµé‡ç»Ÿè®¡ï¼‰</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">DEFINE_NETD_BPF_PROG_KVER_RANGE</span>(
    <span class="hljs-string">"cgroupskb/ingress/stats$4_19"</span>, 
    <span class="hljs-variable constant_">AID_ROOT</span>, <span class="hljs-variable constant_">AID_SYSTEM</span>,
    bpf_cgroup_ingress_4_19, 
    <span class="hljs-variable constant_">KVER_4_19</span>, <span class="hljs-variable constant_">KVER_INF</span>
)
</code></pre>
<p><strong>æ‰§è¡Œæ—¶æœº</strong>ï¼šæ¯ä¸ªæ•°æ®åŒ…è¿›å…¥ç”¨æˆ·ç©ºé—´å‰
<strong>ç»Ÿè®¡å¯¹è±¡</strong>ï¼šRXï¼ˆæ¥æ”¶ï¼‰æµé‡
<strong>æ ¸å¿ƒé€»è¾‘</strong>ï¼š</p>
<ul>
<li>è·å– socket UIDï¼ˆ<code>bpf_get_socket_uid(skb)</code>ï¼‰</li>
<li>æŸ¥è¯¢ <code>cookie_tag_map</code> è·å–åº”ç”¨æ ‡ç­¾ï¼ˆTagï¼‰</li>
<li>æ›´æ–° <code>stats_map</code> ä¸­çš„ç»Ÿè®¡</li>
</ul>
<h3 data-id="heading-42"><strong>2. Cgroup Egressï¼ˆå‡ºç«™æµé‡ç»Ÿè®¡ï¼‰</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">DEFINE_NETD_BPF_PROG_KVER_RANGE</span>(
    <span class="hljs-string">"cgroupskb/egress/stats$4_19"</span>,
    <span class="hljs-variable constant_">AID_ROOT</span>, <span class="hljs-variable constant_">AID_SYSTEM</span>,
    bpf_cgroup_egress_4_19,
    <span class="hljs-variable constant_">KVER_4_19</span>, <span class="hljs-variable constant_">KVER_INF</span>
)
</code></pre>
<p><strong>æ‰§è¡Œæ—¶æœº</strong>ï¼šæ¯ä¸ªæ•°æ®åŒ…ç¦»å¼€å†…æ ¸å‰
<strong>ç»Ÿè®¡å¯¹è±¡</strong>ï¼šTXï¼ˆå‘é€ï¼‰æµé‡
<strong>ç‰¹æ®Šå¤„ç†</strong>ï¼š</p>
<ul>
<li>æ£€æŸ¥ <code>DROP_UNLESS_DNS</code> è§„åˆ™ï¼ˆDNS ç™½åå•ï¼‰</li>
<li>æ£€æŸ¥ <code>uid_owner_map</code> çš„ç­–ç•¥é™åˆ¶</li>
<li>é˜²æ­¢ CLATï¼ˆ464xlatï¼‰é‡å¤è®¡æ•°</li>
</ul>
<h3 data-id="heading-43"><strong>3. xtables BPF Matcherï¼ˆiptables é›†æˆï¼‰</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">DEFINE_XTBPF_PROG</span>(
    <span class="hljs-string">"skfilter/egress/xtbpf"</span>, 
    <span class="hljs-variable constant_">AID_ROOT</span>, <span class="hljs-variable constant_">AID_NET_ADMIN</span>, 
    xt_bpf_egress_prog
)
</code></pre>
<p><strong>æ‰§è¡Œæ—¶æœº</strong>ï¼šiptables è§„åˆ™è¯„ä¼°æ—¶
<strong>ç”¨é€”</strong>ï¼š</p>
<ul>
<li>æ¥å£çº§ç»Ÿè®¡ï¼ˆInterface ç²’åº¦ï¼‰</li>
<li>ä¸ cgroup ç»Ÿè®¡å½¢æˆ 2 å±‚ä½“ç³»</li>
</ul>
<hr/>
<h2 data-id="heading-44"><strong>ä¸‰ã€eBPF ä¸­çš„æ ¸å¿ƒæ•°æ®ç»“æ„ä¸ BPF Map</strong></h2>
<h3 data-id="heading-45"><strong>å…³é”® BPF Map</strong></h3>




































































<table><thead><tr><th>Map åç§°</th><th>Key ç±»å‹</th><th>Value ç±»å‹</th><th>ç”¨é€”</th><th>å¤§å°</th></tr></thead><tbody><tr><td><code>cookie_tag_map</code></td><td>uint64_t (socket cookie)</td><td>UidTagValue (UID+Tag)</td><td>å­˜å‚¨ socket åˆ° UID/Tag çš„æ˜ å°„</td><td>10000</td></tr><tr><td><code>stats_map_A</code></td><td>StatsKey</td><td>StatsValue</td><td>æ´»è·ƒç»Ÿè®¡æ•°æ®ï¼ˆå½“å‰å†™å…¥ï¼‰</td><td>5000</td></tr><tr><td><code>stats_map_B</code></td><td>StatsKey</td><td>StatsValue</td><td>éæ´»è·ƒç»Ÿè®¡æ•°æ®ï¼ˆå‡†å¤‡è¯»å–ï¼‰</td><td>5000</td></tr><tr><td><code>app_uid_stats_map</code></td><td>uint32_t (UID)</td><td>StatsValue</td><td>èšåˆåº”ç”¨çº§ç»Ÿè®¡</td><td>10000</td></tr><tr><td><code>iface_stats_map</code></td><td>uint32_t (ifindex)</td><td>StatsValue</td><td>æ¥å£çº§ç»Ÿè®¡</td><td>1000</td></tr><tr><td><code>uid_counterset_map</code></td><td>uint32_t (UID)</td><td>uint8_t (set)</td><td>UID åˆ°è®¡æ•°å™¨é›†çš„æ˜ å°„</td><td>4000</td></tr><tr><td><code>uid_owner_map</code></td><td>uint32_t (UID)</td><td>UidOwnerValue</td><td>ç½‘ç»œç­–ç•¥è§„åˆ™</td><td>4000</td></tr><tr><td><code>configuration_map</code></td><td>uint32_t</td><td>uint32_t</td><td>è¿è¡Œæ—¶é…ç½®ï¼ˆæ´»è·ƒ Map é€‰æ‹©ï¼‰</td><td>2</td></tr></tbody></table>
<h3 data-id="heading-46"><strong>StatsKey ç»“æ„</strong></h3>
<pre><code class="hljs language-c" lang="c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">StatsKey</span> {</span>
    <span class="hljs-type">uint32_t</span> uid;           <span class="hljs-comment">// åº”ç”¨ UID</span>
    <span class="hljs-type">uint64_t</span> tag;           <span class="hljs-comment">// åº”ç”¨æ ‡ç­¾ï¼ˆTrafficStats æ ‡è®°ï¼‰</span>
    <span class="hljs-type">uint32_t</span> counterSet;    <span class="hljs-comment">// è®¡æ•°å™¨é›†ï¼šDEFAULT/FOREGROUND/BACKGROUND</span>
    <span class="hljs-type">uint32_t</span> ifaceIndex;    <span class="hljs-comment">// ç½‘å¡æ¥å£ç´¢å¼•</span>
};

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">StatsValue</span> {</span>
    <span class="hljs-type">uint64_t</span> rxPackets;     <span class="hljs-comment">// RX åŒ…æ•°</span>
    <span class="hljs-type">uint64_t</span> rxBytes;       <span class="hljs-comment">// RX å­—èŠ‚æ•°</span>
    <span class="hljs-type">uint64_t</span> txPackets;     <span class="hljs-comment">// TX åŒ…æ•°</span>
    <span class="hljs-type">uint64_t</span> txBytes;       <span class="hljs-comment">// TX å­—èŠ‚æ•°</span>
};
</code></pre>
<hr/>
<h2 data-id="heading-47"><strong>å››ã€æµé‡ç»Ÿè®¡çš„å®Œæ•´æ•°æ®æµ</strong></h2>
<h3 data-id="heading-48"><strong>âš¡ å®æ—¶ç»Ÿè®¡è·¯å¾„ï¼ˆå†…æ ¸ eBPF å±‚ï¼‰</strong></h3>
<pre><code class="hljs language-scss" lang="scss">ç½‘ç»œæ•°æ®åŒ…åˆ°è¾¾
    â†“
<span class="hljs-selector-attr">[CGroup Ingress/Egress é’©å­è§¦å‘]</span>
    â†“
eBPF ç¨‹åº <span class="hljs-built_in">bpf_traffic_account</span>() æ‰§è¡Œ
    â”œâ”€ æ­¥éª¤ <span class="hljs-number">1</span>ï¼šè·å– Socket UID
    â”‚   â””â”€ <span class="hljs-built_in">bpf_get_socket_uid</span>(skb) â†’ è·å–å®é™…å‘é€/æ¥æ”¶ UID
    â”‚
    â”œâ”€ æ­¥éª¤ <span class="hljs-number">2</span>ï¼šæŸ¥è¯¢ Tag æ˜ å°„
    â”‚   â””â”€ é€šè¿‡ socket cookie æŸ¥è¯¢ cookie_tag_map
    â”‚   â””â”€ è·å–åº”ç”¨è‡ªå®šä¹‰æ ‡ç­¾ï¼ˆå¦‚ HTTP/<span class="hljs-selector-tag">Video</span>/Downloadï¼‰
    â”‚
    â”œâ”€ æ­¥éª¤ <span class="hljs-number">3</span>ï¼šç­–ç•¥æ£€æŸ¥
    â”‚   â”œâ”€ æ£€æŸ¥ uid_owner_map ä¸­çš„è§„åˆ™
    â”‚   â”œâ”€ æ£€æŸ¥ Data Saverã€Per-App Restrictions
    â”‚   â””â”€ DROP/PASS å†³ç­–
    â”‚
    â””â”€ æ­¥éª¤ <span class="hljs-number">4</span>ï¼šåŸå­æ›´æ–°ç»Ÿè®¡
        â”œâ”€ æ„å»º StatsKey = {uid, tag, counterSet, ifaceIndex}
        â”œâ”€ æŸ¥è¯¢/åˆ›å»º stats_map<span class="hljs-selector-attr">[StatsKey]</span>
        â””â”€ <span class="hljs-built_in">__sync_fetch_and_add</span>(&amp;value-&gt;txBytes, bytes)  <span class="hljs-comment">// åŸå­æ“ä½œ</span>
           <span class="hljs-built_in">__sync_fetch_and_add</span>(&amp;value-&gt;txPackets, <span class="hljs-number">1</span>)

æ›´æ–°å®Œæˆï¼Œè¿”å› PASS/DROP
</code></pre>
<p><strong>å…³é”®ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>__sync_fetch_and_add()</code>ï¼šåŸå­ CAS æŒ‡ä»¤ï¼Œ<strong>æ— é”</strong>æ›´æ–°</li>
<li>å¤„äºä¸­æ–­ä¸Šä¸‹æ–‡ï¼š<strong>ç²¾ç¡®çš„æ—¶é—´æˆ³</strong></li>
<li>percpu æ•°æ®ç»“æ„ï¼šCPU ä¹‹é—´<strong>æ— ç¼“å­˜å†²çª</strong></li>
</ul>
<hr/>
<h2 data-id="heading-49"><strong>äº”ã€ç”¨æˆ·ç©ºé—´çš„æ•°æ®é‡‡é›†æµç¨‹</strong></h2>
<h3 data-id="heading-50"><strong>å‘¨æœŸæ€§è½®è¯¢</strong></h3>
<pre><code class="hljs language-scss" lang="scss">NetworkStatsService<span class="hljs-selector-class">.performPollLocked</span>()
    â†“
æ¯ <span class="hljs-number">2</span> å°æ—¶æ‰§è¡Œä¸€æ¬¡ (å¯é…ç½®)
    â†“
<span class="hljs-selector-attr">[Map Swap æ“ä½œ]</span>
    <span class="hljs-number">1</span>. è¯»å– configuration_map è·å–å½“å‰æ´»è·ƒ Mapï¼ˆ<span class="hljs-selector-tag">A</span> æˆ– <span class="hljs-selector-tag">B</span>ï¼‰
    <span class="hljs-number">2</span>. åˆ‡æ¢åˆ°éæ´»è·ƒ Mapï¼ˆ<span class="hljs-selector-tag">B</span> â†’ <span class="hljs-selector-tag">A</span> æˆ– <span class="hljs-selector-tag">A</span> â†’ <span class="hljs-selector-tag">B</span>ï¼‰
    <span class="hljs-number">3</span>. è°ƒç”¨ <span class="hljs-built_in">synchronizeKernelRCU</span>()
       â””â”€ ç­‰å¾…æ‰€æœ‰ CPU çš„ eBPF ç¨‹åºå®Œæˆ
    
    â†“
ä»éæ´»è·ƒï¼ˆæ—§ï¼‰Map è¯»å–æ•°æ®
    â”‚
    â”œâ”€ <span class="hljs-built_in">nativeReadNetworkStatsDetail</span>()  <span class="hljs-selector-attr">[C++ å‡½æ•°]</span>
    â”‚   â”œâ”€ éå† stats_mapï¼ˆéæ´»è·ƒï¼‰
    â”‚   â”œâ”€ èšåˆ UID/Tag/Interface ç»´åº¦
    â”‚   â””â”€ è¿”å› NetworkStats å¯¹è±¡
    â”‚
    â””â”€ æ¸…ç©ºå·²è¯»çš„æ—§ Map
        â””â”€ inactiveStatsMap-&gt;<span class="hljs-attribute">clear</span>()

æ›´æ–°å®Œæˆåï¼š
    <span class="hljs-number">1</span>. å°†å¢é‡åˆå¹¶åˆ° mPersistSnapshot
    <span class="hljs-number">2</span>. è°ƒç”¨ NetworkStatsRecorder æŒä¹…åŒ–
    <span class="hljs-number">3</span>. é‡æ–°åˆ‡æ¢ Mapï¼ˆæ¢å¤åŸå§‹æ´»è·ƒ Mapï¼‰
</code></pre>
<h3 data-id="heading-51"><strong>ä»£ç ç¤ºä¾‹</strong>ï¼ˆBpfNetworkStats.cppï¼‰</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">parseBpfNetworkStatsDetail</span><span class="hljs-params">(std::vector&lt;stats_line&gt;* lines)</span> </span>{
    <span class="hljs-comment">// è¯»å–å½“å‰é…ç½®</span>
    <span class="hljs-keyword">auto</span> configuration = configurationMap.<span class="hljs-built_in">readValue</span>(
        CURRENT_STATS_MAP_CONFIGURATION_KEY);
    
    <span class="hljs-comment">// é€‰æ‹©éæ´»è·ƒ Map</span>
    BpfMap&lt;StatsKey, StatsValue&gt; *inactiveStatsMap;
    <span class="hljs-keyword">if</span> (configuration.<span class="hljs-built_in">value</span>() == SELECT_MAP_A) {
        inactiveStatsMap = &amp;statsMapB;  <span class="hljs-comment">// è¯»å– Bï¼ˆå¦‚æœ A æ˜¯æ´»è·ƒï¼‰</span>
    } <span class="hljs-keyword">else</span> {
        inactiveStatsMap = &amp;statsMapA;
    }
    
    <span class="hljs-comment">// è¿­ä»£è¯»å–æ‰€æœ‰æ¡ç›®</span>
    <span class="hljs-built_in">parseBpfNetworkStatsDetailInternal</span>(
        *lines, 
        *inactiveStatsMap, 
        ifindex2name
    );
    
    <span class="hljs-comment">// æ¸…ç©ºå·²è¯» Map</span>
    inactiveStatsMap-&gt;<span class="hljs-built_in">clear</span>();
}
</code></pre>
<hr/>
<h2 data-id="heading-52"><strong>å…­ã€åŒ Map æœºåˆ¶çš„å¦™å¤„</strong></h2>
<h3 data-id="heading-53"><strong>ä¸ºä»€ä¹ˆéœ€è¦ stats_map_A å’Œ stats_map_Bï¼Ÿ</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript">é—®é¢˜ï¼šå¦‚æœåªç”¨ <span class="hljs-number">1</span> ä¸ª <span class="hljs-title class_">Map</span>
  â”œâ”€ ç”¨æˆ·ç©ºé—´è¿­ä»£è¯» <span class="hljs-title class_">Map</span> éœ€è¦ ms çº§æ—¶é—´
  â”œâ”€ æœŸé—´å†…æ ¸ eBPF ç»§ç»­å†™å…¥
  â”œâ”€ æ•°æ®ä¸ä¸€è‡´ï¼å¯èƒ½è¯»åˆ°åŠæˆå“æ•°æ®

è§£å†³æ–¹æ¡ˆï¼šåŒ <span class="hljs-title class_">Map</span> + åŸå­äº¤æ¢
  â”œâ”€ <span class="hljs-title class_">Map</span> Aï¼ˆæ´»è·ƒå†™å…¥ï¼‰
  â”‚   â””â”€ å†…æ ¸ eBPF ç¨‹åºæŒç»­æ›´æ–°
  â”‚
  â”œâ”€ <span class="hljs-title class_">Map</span> Bï¼ˆå‡†å¤‡è¯»å–ï¼‰
  â”‚   â””â”€ ç”¨æˆ·ç©ºé—´å®‰å…¨è¯»å–
  â”‚
  â””â”€ åŒæ­¥æ—¶æœº
      <span class="hljs-number">1.</span> ç”¨æˆ·ç©ºé—´ï¼šäº¤æ¢ configuration_map
      <span class="hljs-number">2.</span> å†…æ ¸ï¼š<span class="hljs-variable constant_">RCU</span> åŒæ­¥ï¼Œç¡®ä¿æ‰€æœ‰ eBPF å®Œæˆ
      <span class="hljs-number">3.</span> ç”¨æˆ·ç©ºé—´ï¼šå®‰å…¨è¯» <span class="hljs-title class_">Map</span> Bï¼ˆæ²¡æœ‰å¹¶å‘å†™ï¼‰
      <span class="hljs-number">4.</span> ç”¨æˆ·ç©ºé—´ï¼šæ¸…ç©º <span class="hljs-title class_">Map</span> B
      <span class="hljs-number">5.</span> ç”¨æˆ·ç©ºé—´ï¼šæ¢å¤é…ç½®ï¼ˆå›åˆ°åŸæ¥çš„ Aï¼‰
</code></pre>
<p><strong>æ—¶åºå›¾</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">æ—¶é—´çº¿
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
T0  <span class="hljs-built_in">Map_A</span>(æ´»)    <span class="hljs-built_in">Map_B</span>(ç©º)
    eBPFå†™â†’       ç”¨æˆ·è¯»(ä¸Šæ¬¡ç»“æœ)
    
T1  <span class="hljs-selector-attr">[é…ç½®äº¤æ¢]</span> configuration_map = <span class="hljs-selector-tag">B</span>
    
T2  <span class="hljs-selector-attr">[RCUåŒæ­¥]</span> <span class="hljs-built_in">synchronizeKernelRCU</span>()
    æ‰€æœ‰ CPU eBPF å®Œæˆ
    
T3  <span class="hljs-built_in">Map_A</span>(ä¸Šæ¬¡æ•°æ®)  <span class="hljs-built_in">Map_B</span>(æ´»ï¼Œæ–°æ•°æ®)
    ç”¨æˆ·è¯»â†’          eBPFå†™â†’
    
T4  <span class="hljs-selector-attr">[æ¸…ç©º Map_A]</span> Map_A<span class="hljs-selector-class">.clear</span>()
    
T5  <span class="hljs-selector-attr">[æ¢å¤é…ç½®]</span> configuration_map = <span class="hljs-selector-tag">A</span>
    
T6  å‡†å¤‡ä¸‹ä¸€è½®å¾ªç¯
</code></pre>
<hr/>
<h2 data-id="heading-54"><strong>ä¸ƒã€eBPF çš„æ€§èƒ½ä¼˜åŒ–æŠ€å·§</strong></h2>
<h3 data-id="heading-55"><strong>1. åŸå­æ“ä½œæ›¿ä»£é”</strong></h3>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// ä¸ç”¨äº’æ–¥é”ï¼Œç”¨ CPU çº§åŸå­æ“ä½œ</span>
__sync_fetch_and_add(&amp;value-&gt;txBytes, bytes);
<span class="hljs-comment">// ç¼–è¯‘ä¸ºå•æ¡ LOCK ADD æŒ‡ä»¤ï¼ˆx86ï¼‰æˆ– STXRï¼ˆARMï¼‰</span>
</code></pre>
<p><strong>æ€§èƒ½å¯¹æ¯”</strong>ï¼š</p>
<ul>
<li>äº’æ–¥é”ï¼šéœ€è¦è°ƒåº¦å™¨åˆ‡æ¢ï¼ŒÎ¼s é‡çº§å»¶è¿Ÿ</li>
<li>åŸå­æ“ä½œï¼šå•æ¡æŒ‡ä»¤ï¼Œns é‡çº§</li>
</ul>
<h3 data-id="heading-56"><strong>2. æ¡ä»¶ç¼–è¯‘å¤šç‰ˆæœ¬æ”¯æŒ</strong></h3>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// ä¸ºä¸åŒå†…æ ¸ç‰ˆæœ¬ç¼–è¯‘ä¸åŒ eBPF ä»£ç </span>
DEFINE_NETD_BPF_PROG_KVER_RANGE(
    <span class="hljs-string">"cgroupskb/egress/stats$4_19"</span>, 
    ..., 
    KVER_4_19,   <span class="hljs-comment">// æœ€ä½æ”¯æŒ 4.19</span>
    KVER_INF     <span class="hljs-comment">// æœ€é«˜æ— é™åˆ¶</span>
)

DEFINE_NETD_BPF_PROG_KVER_RANGE(
    <span class="hljs-string">"cgroupskb/egress/stats$4_14"</span>,
    ...,
    KVER_NONE,   <span class="hljs-comment">// æœ€ä½ 4.14</span>
    KVER_4_19    <span class="hljs-comment">// æœ€é«˜ 4.19</span>
)
</code></pre>
<p><strong>åŸå› </strong>ï¼š</p>
<ul>
<li>4.14ï¼šåŠŸèƒ½æœ‰é™ï¼Œç”¨åŸºç¡€ API</li>
<li>4.19+ï¼šæ”¯æŒ <code>bpf_skb_load_bytes_relative()</code>ï¼Œæ›´å‡†ç¡®çš„åŒ…å¤´è¯»å–</li>
<li>5.8+ï¼šæ”¯æŒ ringbufï¼Œå¯åšåŒ…è·Ÿè¸ª</li>
</ul>
<h3 data-id="heading-57"><strong>3. æ•°æ®åŒ…å¤§å°é‡ç®—</strong></h3>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// MTU åˆ†æ®µé‡ç®—</span>
<span class="hljs-keyword">if</span> (bytes &gt; mtu) {  <span class="hljs-comment">// 1500 å­—èŠ‚</span>
    <span class="hljs-type">int</span> tcp_overhead = ip_overhead + <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">struct</span> tcphdr) + <span class="hljs-number">12</span>;
    <span class="hljs-type">int</span> mss = mtu - tcp_overhead;
    
    <span class="hljs-comment">// è®¡ç®—åˆ†æ®µåå®é™…å‘é€çš„åŒ…æ•°å’Œå­—èŠ‚æ•°</span>
    <span class="hljs-type">uint64_t</span> payload = bytes - tcp_overhead;
    packets = (payload + mss - <span class="hljs-number">1</span>) / mss;  <span class="hljs-comment">// ceil é™¤æ³•</span>
    bytes = tcp_overhead * packets + payload;
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆé‡è¦</strong>ï¼Ÿ</p>
<ul>
<li>åº”ç”¨å±‚çœ‹åˆ° 1KB çš„æ•°æ®</li>
<li>ç½‘ç»œå±‚éœ€è¦ 1500 å­—èŠ‚ MTU æ‹†åˆ†æˆ 1 åŒ…</li>
<li><strong>ç»Ÿè®¡çš„æ˜¯ç½‘ç»œå±‚å­—èŠ‚æ•°</strong>ï¼Œéœ€è¦é‡ç®—</li>
</ul>
<hr/>
<h2 data-id="heading-58"><strong>å…«ã€eBPF Map çš„å†…å­˜ç®¡ç†</strong></h2>
<h3 data-id="heading-59"><strong>Map å¤§å°è®¡ç®—</strong></h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">cookie_tag_map:</span>     <span class="hljs-number">10000</span> <span class="hljs-string">entries</span> <span class="hljs-string">Ã—</span> <span class="hljs-string">(8B</span> <span class="hljs-string">key</span> <span class="hljs-string">+</span> <span class="hljs-string">12B</span> <span class="hljs-string">value)</span>  <span class="hljs-string">=</span> <span class="hljs-number">200</span> <span class="hljs-string">KB</span>
<span class="hljs-attr">stats_map_A/B:</span>      <span class="hljs-number">5000 </span><span class="hljs-string">entries</span> <span class="hljs-string">Ã—</span> <span class="hljs-string">(16B</span> <span class="hljs-string">key</span> <span class="hljs-string">+</span> <span class="hljs-string">32B</span> <span class="hljs-string">value)</span> <span class="hljs-string">=</span> <span class="hljs-number">240</span> <span class="hljs-string">KB</span> <span class="hljs-string">(Ã—2)</span>
<span class="hljs-attr">uid_counterset_map:</span> <span class="hljs-number">4000 </span><span class="hljs-string">entries</span> <span class="hljs-string">Ã—</span> <span class="hljs-string">(4B</span> <span class="hljs-string">+</span> <span class="hljs-string">1B)</span>            <span class="hljs-string">=</span> <span class="hljs-number">20</span> <span class="hljs-string">KB</span>
<span class="hljs-attr">iface_stats_map:</span>    <span class="hljs-number">1000 </span><span class="hljs-string">entries</span> <span class="hljs-string">Ã—</span> <span class="hljs-string">(4B</span> <span class="hljs-string">+</span> <span class="hljs-string">32B)</span>           <span class="hljs-string">=</span> <span class="hljs-number">36</span> <span class="hljs-string">KB</span>
<span class="hljs-attr">uid_owner_map:</span>      <span class="hljs-number">4000 </span><span class="hljs-string">entries</span> <span class="hljs-string">Ã—</span> <span class="hljs-string">(4B</span> <span class="hljs-string">+</span> <span class="hljs-string">8B)</span>            <span class="hljs-string">=</span> <span class="hljs-number">48</span> <span class="hljs-string">KB</span>
<span class="hljs-string">...</span>
<span class="hljs-string">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span>
<span class="hljs-string">æ€»è®¡ï¼š~</span> <span class="hljs-number">4.9</span> <span class="hljs-string">MB</span>
</code></pre>
<p><strong>å†…æ ¸è¦æ±‚</strong>ï¼š</p>
<ul>
<li>éœ€è¦ memlock rlimit â‰¥ 5MBï¼ˆå¯ç”¨ <code>ulimit -l</code> æŸ¥çœ‹ï¼‰</li>
<li>ç›¸æ¯” xt_qtaguid çš„å†…å­˜ç®¡ç†æ›´é«˜æ•ˆ</li>
</ul>
<hr/>
<h2 data-id="heading-60"><strong>ä¹ã€ä¸ç½‘ç»œç­–ç•¥ç®¡ç†çš„åä½œ</strong></h2>
<p>eBPF ä¸ä»…ç»Ÿè®¡ï¼Œè¿˜<strong>æ‰§è¡Œç½‘ç»œç­–ç•¥</strong>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin">uid_owner_map è§„åˆ™æ£€æŸ¥
    â”œâ”€ BACKGROUND_MATCHï¼šåå°åº”ç”¨é™åˆ¶
    â”œâ”€ DOZABLE_MATCHï¼šä½ç”µé‡æ¨¡å¼é™åˆ¶
    â”œâ”€ POWERSAVE_MATCHï¼šçœç”µæ¨¡å¼é™åˆ¶
    â”œâ”€ IIF_MATCHï¼šç‰¹å®šæ¥å£é™åˆ¶
    â”œâ”€ LOCKDOWN_VPN_MATCHï¼šVPN éš”ç¦»
    â””â”€ DROP_UNLESS_DNSï¼šä»…å…è®¸ DNS

å®æ—¶å†³ç­–
    <span class="hljs-keyword">if</span> (enabledRules &amp; BACKGROUND_MATCH &amp;&amp; uidRules &amp; BACKGROUND_MATCH)
        <span class="hljs-keyword">return</span> DROP;  <span class="hljs-comment">// eBPF ç›´æ¥ä¸¢åŒ…ï¼Œä¸éœ€ç”¨æˆ·ç©ºé—´å¹²é¢„</span>
</code></pre>
<p><strong>æ€§èƒ½æ„ä¹‰</strong>ï¼š</p>
<ul>
<li>åå°åº”ç”¨é™åˆ¶ç›´æ¥åœ¨å†…æ ¸æ‰§è¡Œ</li>
<li>æ— éœ€ç³»ç»Ÿè°ƒç”¨ï¼Œ<strong>é˜²æ­¢æ•°æ®æ³„éœ²</strong></li>
<li><strong>Sub-microsecond åˆ¤å†³å»¶è¿Ÿ</strong></li>
</ul>
<hr/>
<h2 data-id="heading-61"><strong>åã€æ•°æ®æŒä¹…åŒ–ç®¡ç†</strong></h2>
<h3 data-id="heading-62"><strong>NetworkStatsRecorder çš„è§’è‰²</strong></h3>
<pre><code class="hljs language-python" lang="python">å‘¨æœŸè½®è¯¢                    æ–‡ä»¶å­˜å‚¨
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
eBPF Map(å®æ—¶)
    â†“
NetworkStatsFactory
    â†“
NetworkStatsService
    â”œâ”€ mUidStatsï¼ˆå†…å­˜ï¼‰      â†’ NetworkStatsRecorder
    â”œâ”€ mIfaceStats            â†’ FileRotator
    â””â”€ mNetworkStats          â†’ /data/system/netstats/
                                 â””â”€ current.<span class="hljs-built_in">bin</span>
                                 â””â”€ xt_stat_YYYY-MM-DD.<span class="hljs-built_in">bin</span>
                                 â””â”€ uid_stat_YYYY-MM-DD.<span class="hljs-built_in">bin</span>
                                 â””â”€ uid_tag_stat_YYYY-MM-DD.<span class="hljs-built_in">bin</span>
</code></pre>
<p><strong>FileRotator ç­–ç•¥</strong>ï¼š</p>
<ul>
<li>2 å°æ—¶æ»šåŠ¨ä¸€æ¬¡ï¼ˆnetwork statsï¼‰</li>
<li>5 å¤©å­˜å‚¨ï¼ˆuid statsï¼‰</li>
<li>15 å¤©å­˜å‚¨ï¼ˆtag statsï¼‰</li>
</ul>
<h3 data-id="heading-63"><strong>æŒä¹…åŒ–æ¡ä»¶</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// NetworkStatsRecorder.maybePersistLocked()</span>
<span class="hljs-keyword">if</span> (pendingBytes &gt;= PERSIST_THRESHOLD) {  <span class="hljs-comment">// é»˜è®¤ 2MB</span>
    forcePersistLocked();
}
</code></pre>
<hr/>
<h2 data-id="heading-64"><strong>åä¸€ã€å®Œæ•´äº¤äº’æµç¨‹æ€»ç»“</strong></h2>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[åº”ç”¨å±‚]</span> App å‘é€ HTTP è¯·æ±‚
    â†“
<span class="hljs-section">[ç³»ç»Ÿè°ƒç”¨]</span> write(socket_fd, data)
    â†“
<span class="hljs-section">[å†…æ ¸ Socket å±‚]</span> __sock_sendmsg()
    â”œâ”€ eBPF Cgroup Socket Create Hookï¼šæ ‡è®° socket
    â”‚   â””â”€ <span class="hljs-attr">TAG_HTTP</span> = <span class="hljs-number">0</span>x123 å†™å…¥ cookie_tag_map
    â”‚
    â””â”€ eBPF Cgroup Egress Hookï¼šç»Ÿè®¡ TX
        â”œâ”€ è·å– <span class="hljs-attr">UID</span> = <span class="hljs-number">10086</span>ï¼ˆå‡è®¾ WeChatï¼‰
        â”œâ”€ æŸ¥è¯¢ <span class="hljs-attr">tag</span> = <span class="hljs-number">0</span>x123ï¼ˆHTTPï¼‰
        â”œâ”€ æ£€æŸ¥ uid_owner_map ç­–ç•¥
        â”œâ”€ åŸå­æ›´æ–° stats_map<span class="hljs-section">[{uid=10086, tag=0x123, ...}]</span>
        â”‚   += {txPackets: 1, txBytes: 1024}
        â””â”€ è¿”å› PASSï¼ŒåŒ…ç»§ç»­å‘é€
    â†“
<span class="hljs-section">[ç½‘ç»œé©±åŠ¨]</span> åŒ…ç¦»å¼€ç½‘å¡
    â†“
<span class="hljs-section">[å†…æ ¸ eBPF TC å±‚]</span> skfilter/egress/xtbpf Hook
    â””â”€ æ›´æ–° iface_stats_mapï¼ˆæ¥å£çº§ç»Ÿè®¡ï¼‰
    â†“
<span class="hljs-section">[å‘¨æœŸè½®è¯¢ 2 å°æ—¶]</span> NetworkStatsService.performPollLocked()
    â”œâ”€ äº¤æ¢ Mapï¼ˆA â†” Bï¼‰
    â”œâ”€ ä»éæ´»è·ƒ Map è¯»å–æ‰€æœ‰ç»Ÿè®¡
    â”œâ”€ èšåˆæ•°æ®ï¼šstats_map â†’ NetworkStats å¯¹è±¡
    â”œâ”€ NetworkStatsRecorder å†™å…¥ç£ç›˜
    â”‚   â””â”€ /data/system/netstats/current.bin
    â””â”€ App å¯é€šè¿‡ TrafficStats.getUidTxBytes(10086) æŸ¥è¯¢
       æˆ–é€šè¿‡ NetworkStatsManager æŸ¥è¯¢å†å²æ•°æ®
</code></pre>
<hr/>
<h2 data-id="heading-65"><strong>æ€»ç»“ï¼šeBPF çš„æ ¸å¿ƒä»·å€¼</strong></h2>


















































<table><thead><tr><th>ç»´åº¦</th><th>ä¼ ç»Ÿæ–¹æ¡ˆï¼ˆxt_qtaguidï¼‰</th><th>eBPF æ–°æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td><strong>æ‰§è¡Œä½ç½®</strong></td><td>å†…æ ¸æ¨¡å—ï¼ˆé¢„ç¼–è¯‘ï¼‰</td><td>å†…æ ¸ eBPF VMï¼ˆJIT ç¼–è¯‘ï¼‰</td></tr><tr><td><strong>å¹¶å‘æ§åˆ¶</strong></td><td>é”ç«äº‰ï¼ˆè‡ªæ—‹é”ï¼‰</td><td>åŸå­æ“ä½œï¼ˆæ— é”ï¼‰</td></tr><tr><td><strong>çµæ´»æ€§</strong></td><td>å›ºå®šåŠŸèƒ½</td><td>åŠ¨æ€åŠ è½½/å¸è½½</td></tr><tr><td><strong>å¼€é”€</strong></td><td>é«˜ï¼ˆç¼“å­˜è¡Œå¤±æ•ˆï¼‰</td><td>ä½ï¼ˆpercpu æ•°æ®ï¼‰</td></tr><tr><td><strong>æ—¶é—´ç²¾åº¦</strong></td><td>ms çº§</td><td>ns çº§</td></tr><tr><td><strong>å†…å­˜å ç”¨</strong></td><td>å¤§ï¼ˆçµæ´»ä½†æ•£ä¹±ï¼‰</td><td>å°ï¼ˆç»“æ„åŒ– Mapï¼‰</td></tr><tr><td><strong>å¯å®¡è®¡æ€§</strong></td><td>é»‘ç›’</td><td>eBPF æºç å¯è¯»</td></tr><tr><td><strong>æ›´æ–°å‘¨æœŸ</strong></td><td>éœ€è¦é‡ç¼–å†…æ ¸</td><td>APEX æ¨¡å—åŒ–æ›´æ–°</td></tr></tbody></table>
<p><strong>eBPF æ˜¯ Android ç½‘ç»œç»Ÿè®¡çš„"å¿ƒè„"</strong>ï¼š</p>
<ul>
<li>ç›´æ¥åœ¨æ•°æ®åŒ…ç»è¿‡å†…æ ¸æ—¶é‡‡é›†ï¼ˆ<strong>é›¶æ‹·è´</strong>ï¼‰</li>
<li>ç­–ç•¥æ‰§è¡Œï¼ˆDROP/PASSï¼‰åŒæ­¥è¿›è¡Œ</li>
<li>åŒ Map æœºåˆ¶ä¿è¯æ•°æ®ä¸€è‡´æ€§</li>
<li>åŸå­æ“ä½œå®ç°é«˜æ€§èƒ½æ— é”æ›´æ–°</li>
<li>æ”¯æŒçƒ­æ›´æ–°å’Œç‰ˆæœ¬çµæ´»æ€§</li>
</ul>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ Android 12+ å…¨é¢è¿ç§»åˆ° eBPF çš„åŸå› ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android å…±äº«è¿æ¥ç®¡ç†ç³»ç»Ÿ - å®Œæ•´æ¶æ„åˆ†æ]]></title>    <link>https://juejin.cn/post/7603575763787087898</link>    <guid>https://juejin.cn/post/7603575763787087898</guid>    <pubDate>2026-02-07T02:53:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603575763787087898" data-draft-id="7603567912592900123" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android å…±äº«è¿æ¥ç®¡ç†ç³»ç»Ÿ - å®Œæ•´æ¶æ„åˆ†æ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-02-07T02:53:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·341408199125"/> <meta itemprop="url" content="https://juejin.cn/user/570004686782272"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android å…±äº«è¿æ¥ç®¡ç†ç³»ç»Ÿ - å®Œæ•´æ¶æ„åˆ†æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/570004686782272/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·341408199125
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T02:53:58.000Z" title="Sat Feb 07 2026 02:53:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»14åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">ä¸€ã€ç³»ç»Ÿæ•´ä½“æ¶æ„</h3>
<p>Android Tethering ç³»ç»Ÿæ˜¯ä¸€ä¸ªå¤šå±‚çš„ç½‘ç»œå…±äº«ç®¡ç†æ¡†æ¶ï¼Œå…è®¸è®¾å¤‡é€šè¿‡ä¸åŒçš„ä¸‹æ¸¸æ¥å£ï¼ˆWiFi çƒ­ç‚¹ã€USBã€è“ç‰™ã€ä»¥å¤ªç½‘ç­‰ï¼‰å‘å…¶ä»–è®¾å¤‡å…±äº«ç½‘ç»œè¿æ¥ã€‚</p>
<h4 data-id="heading-1">æ ¸å¿ƒå±‚çº§ç»“æ„ï¼š</h4>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       åº”ç”¨å±‚ (SystemUI / Framework APIs)              â”‚
â”‚  TetheringManager, HotspotController, ConnectivityUI  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    FrameworkæœåŠ¡å±‚ (packages_modules_Connectivity)   â”‚
â”‚  TetheringService, Tethering (ä¸»çŠ¶æ€æœº)ï¼ŒUpstreamNetworkMonitor
â”‚  IpServer (ä¸‹æ¸¸æ¥å£çŠ¶æ€æœº)ï¼ŒBpfCoordinator           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç³»ç»ŸæœåŠ¡å±‚ (system_netd / INetd Binder)            â”‚
â”‚  TetherController (DHCP/DNS), NetworkController      â”‚
â”‚  RouteController (IPè½¬å‘/NAT), iptablesè§„åˆ™ç®¡ç†      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    å†…æ ¸å±‚ (Linux Kernel)                             â”‚
â”‚  iptables, netfilter, IPè½¬å‘ï¼ŒTC (æµé‡æ§åˆ¶)ï¼ŒBPF     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h3 data-id="heading-2">äºŒã€æ ¸å¿ƒæ¨¡å—è¯¦è§£</h3>
<h4 data-id="heading-3">2.1 TetheringManager / TetheringServiceï¼ˆåº”ç”¨å…¥å£ï¼‰</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç”¨æˆ·ä¾§ API</span>
TetheringManager.startTethering(TetheringRequest, Executor, callback)
TetheringManager.stopTethering(type)

<span class="hljs-comment">// å†…éƒ¨å¤„ç†</span>
TetheringService
â”œâ”€â”€ TetheringConnector (Binderæ¥å£)
â””â”€â”€ Tethering (æ ¸å¿ƒçŠ¶æ€æœºæœåŠ¡)
</code></pre>
<p><strong>æ ¸å¿ƒæµç¨‹</strong>ï¼š</p>
<ul>
<li>åº”ç”¨è°ƒç”¨ <code>startTethering()</code> æ—¶ï¼ŒæŒ‡å®šå…±äº«ç±»å‹ï¼ˆWiFiã€USBã€Bluetoothç­‰ï¼‰</li>
<li>è§¦å‘æƒé™æ£€æŸ¥å’Œé…é¢æ£€æŸ¥</li>
<li>å¯åŠ¨ Tethering æœåŠ¡çŠ¶æ€æœº</li>
</ul>
<h4 data-id="heading-4">2.2 Tethering ä¸»çŠ¶æ€æœº</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Tethering</span> {
    <span class="hljs-comment">// ç»´æŠ¤å„æ¥å£çš„çŠ¶æ€</span>
    SparseArray&lt;TetherState&gt; mTetherStates;  <span class="hljs-comment">// æŒ‰æ¥å£ç±»å‹ç´¢å¼•</span>
    
    <span class="hljs-comment">// ä¸Šæ¸¸ç½‘ç»œç›‘æ§</span>
    UpstreamNetworkMonitor mUpstreamNetworkMonitor;
    
    <span class="hljs-comment">// ä¸»çŠ¶æ€æœº</span>
    TetherMainSM mTetherMainSM;
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TetherState</span> {
    IpServer ipServer;           <span class="hljs-comment">// è¯¥æ¥å£çš„IPé…ç½®æœº</span>
    <span class="hljs-type">int</span> lastState;               <span class="hljs-comment">// AVAILABLE/TETHERED/LOCAL_ONLY/UNAVAILABLE</span>
    <span class="hljs-type">int</span> lastError;               <span class="hljs-comment">// é”™è¯¯ä»£ç </span>
    <span class="hljs-type">boolean</span> isNcm;               <span class="hljs-comment">// USB NCM æ ‡å¿—</span>
}
</code></pre>
<p><strong>å…³é”®èŒè´£</strong>ï¼š</p>
<ol>
<li><strong>æ¥å£ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ï¼šåˆ›å»º/é”€æ¯ä¸‹æ¸¸æ¥å£å¯¹åº”çš„ IpServer</li>
<li><strong>ä¸Šæ¸¸ç½‘ç»œè·Ÿè¸ª</strong>ï¼šç›‘å¬ç³»ç»Ÿé»˜è®¤ç½‘ç»œå˜åŒ–</li>
<li><strong>è½¬å‘è§„åˆ™åè°ƒ</strong>ï¼šä¸ netd é€šä¿¡è®¾ç½® NAT å’Œè½¬å‘</li>
<li><strong>é…é¢/ç»Ÿè®¡ç®¡ç†</strong>ï¼šé€šè¿‡ BpfCoordinator æ”¶é›†è½¬å‘æµé‡ç»Ÿè®¡</li>
</ol>
<h4 data-id="heading-5">2.3 IpServer ä¸‹æ¸¸æ¥å£çŠ¶æ€æœºï¼ˆæ ¸å¿ƒï¼‰</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">IpServer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">StateMachineShim</span> {
    <span class="hljs-comment">// ===== 5ä¸ªçŠ¶æ€ =====</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">STATE_UNAVAILABLE</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">// æ¥å£æœªå°±ç»ª</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">STATE_AVAILABLE</span>   <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;  <span class="hljs-comment">// æ¥å£å°±ç»ªï¼Œç­‰å¾…è¯·æ±‚</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">STATE_TETHERED</span>    <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;  <span class="hljs-comment">// æ­£åœ¨å…±äº«ï¼ˆå…¨å±€ä¸Šæ¸¸ï¼‰</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">STATE_LOCAL_ONLY</span>  <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;  <span class="hljs-comment">// æœ¬åœ°çƒ­ç‚¹ï¼ˆæ— ä¸Šæ¸¸ï¼‰</span>
    <span class="hljs-comment">// (å†…éƒ¨) WaitingForRestart         // é‡å¯ä¸­</span>
    
    <span class="hljs-comment">// ===== å…³é”®æˆå‘˜ =====</span>
    String mIfaceName;                       <span class="hljs-comment">// æ¥å£å (wlan0, usb0, etc.)</span>
    LinkAddress mIpv4Address;               <span class="hljs-comment">// åˆ†é…çš„æœåŠ¡å™¨ IPv4 åœ°å€</span>
    LinkProperties mLinkProperties;         <span class="hljs-comment">// é“¾è·¯å±æ€§</span>
    IDhcpServer mDhcpServer;                <span class="hljs-comment">// DHCP æœåŠ¡å™¨</span>
    RouterAdvertisementDaemon mRaDaemon;    <span class="hljs-comment">// IPv6 RA è¿›ç¨‹</span>
    InterfaceSet mUpstreamIfaceSet;         <span class="hljs-comment">// ä¸Šæ¸¸æ¥å£é›†åˆ</span>
    List&lt;TetheredClient&gt; mDhcpLeases;       <span class="hljs-comment">// DHCP ç§Ÿçº¦åˆ—è¡¨</span>
    
    <span class="hljs-comment">// BPF å¸è½½åŠ é€Ÿ</span>
    BpfCoordinator mBpfCoordinator;
}
</code></pre>
<p><strong>5ä¸ªæ ¸å¿ƒçŠ¶æ€è¯¦è§£</strong>ï¼š</p>









































<table><thead><tr><th>çŠ¶æ€</th><th>å«ä¹‰</th><th>ä½•æ—¶è¿›å…¥</th><th>ä½•æ—¶é€€å‡º</th></tr></thead><tbody><tr><td>UNAVAILABLE</td><td>æ¥å£ä¸å¯ç”¨</td><td>æ¥å£ç§»é™¤/é©±åŠ¨å´©æºƒ</td><td>æ¥å£é‡æ–°åŠ å…¥</td></tr><tr><td>AVAILABLE</td><td>æ¥å£å°±ç»ª</td><td>åˆå§‹çŠ¶æ€/åœæ­¢å…±äº«</td><td>æ”¶åˆ° CMD_TETHER_REQUESTED</td></tr><tr><td>TETHERED</td><td>æ­£åœ¨å…±äº«</td><td>ç”¨æˆ·å¯ç”¨å…±äº«</td><td>ç”¨æˆ·åœç”¨/ä¸Šæ¸¸æ”¹å˜</td></tr><tr><td>LOCAL_ONLY</td><td>æœ¬åœ°çƒ­ç‚¹</td><td>ç”¨æˆ·å¯ç”¨æœ¬åœ°çƒ­ç‚¹</td><td>ç”¨æˆ·åœç”¨/æ¥å£ä¸‹çº¿</td></tr><tr><td>WaitingForRestart</td><td>é‡å¯ä¸­</td><td>å‰ç¼€å†²çª</td><td>é‡å¯å®Œæˆ</td></tr></tbody></table>
<p><strong>çŠ¶æ€è½¬ç§»å›¾</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                 â”‚
    â–¼                                 â–¼
<span class="hljs-section">[UNAVAILABLE]</span>  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º <span class="hljs-section">[AVAILABLE]</span>
    â”‚                               â”‚
    â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ CMD_TETHER_REQUESTED
                           â”‚        â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
                    â”‚   <span class="hljs-attr">arg1</span>=STATE_TETHEREDâ”‚ or
                    â”‚   <span class="hljs-attr">arg1</span>=STATE_LOCAL   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚        â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”  â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ TETHEREDâ”‚  â”‚ LOCAL_ONLY  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜  â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚      â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚ WaitingForRestart  â”‚
                    â”‚ (prefix conflict)  â”‚
                    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚ <span class="hljs-section">[Restart]</span>  â”‚
                    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Back to TETHERED   â”‚
                    â”‚ or LOCAL_ONLY      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h3 data-id="heading-6">ä¸‰ã€IPv4 é…ç½®æµç¨‹</h3>
<h4 data-id="heading-7">3.1 IPv4 åœ°å€åˆ†é…</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">startIPv4</span>() 
    â”‚
    â”œâ”€â–º <span class="hljs-built_in">requestIpv4Address</span>(scope)
    â”‚   â””â”€â–º PrivateAddressCoordinator<span class="hljs-selector-class">.requestDownstream</span>()
    â”‚       â”œâ”€ å…¨å±€ä½œç”¨åŸŸ(TETHERED): ä½¿ç”¨ PrefixUtils ä»é…ç½®æ± é€‰æ‹©
    â”‚       â””â”€ æœ¬åœ°ä½œç”¨åŸŸ(LOCAL_ONLY): ä½¿ç”¨ç‰¹å®šå‰ç¼€ (e.g., <span class="hljs-number">192.168</span>.<span class="hljs-number">43</span>.x)
    â”‚
    â”œâ”€â–º <span class="hljs-built_in">configureIPv4</span>(enabled, scope)
    â”‚   â”œâ”€ å¯¹äº WiFi/Ethernet: ä¸è®¾ç½® interface upï¼ˆé©±åŠ¨å·²ç®¡ç†ï¼‰
    â”‚   â”œâ”€ å¯¹äº USB/Bluetooth: è°ƒç”¨ InterfaceController è®¾ç½® up
    â”‚   â””â”€ mInterfaceCtrl.<span class="hljs-built_in">setInterfaceConfiguration</span>(linkAddress, setIfaceUp)
    â”‚
    â””â”€â–º <span class="hljs-built_in">configureDhcp</span>(enabled, serverAddr, clientAddr)
        â””â”€â–º <span class="hljs-built_in">startDhcp</span>() / <span class="hljs-built_in">stopDhcp</span>()
</code></pre>
<h4 data-id="heading-8">3.2 DHCP æœåŠ¡å™¨å¯åŠ¨</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// IpServer.java - startDhcp()</span>
<span class="hljs-type">IDhcpServer</span> <span class="hljs-variable">mDhcpServer</span> <span class="hljs-operator">=</span> mDeps.makeDhcpServer(
    ifaceName,                              <span class="hljs-comment">// æ¥å£å</span>
    DhcpServingParamsParcel {
        Inet4Address defaultRouter;         <span class="hljs-comment">// é»˜è®¤ç½‘å…³ (e.g., 192.168.43.1)</span>
        Inet4Address dnsServer;             <span class="hljs-comment">// DNS æœåŠ¡å™¨ (e.g., 192.168.43.1)</span>
        LinkAddress serverAddr;             <span class="hljs-comment">// æœåŠ¡å™¨åœ°å€ (192.168.43.1/24)</span>
        Inet4Address singleClientAddr;      <span class="hljs-comment">// å•ä¸€å®¢æˆ·ç«¯åœ°å€ (ä»…USB/NCM)</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">dhcpLeaseTimeSecs</span> <span class="hljs-operator">=</span> <span class="hljs-number">3600</span>;       <span class="hljs-comment">// ç§Ÿçº¦æ—¶é—´ (1å°æ—¶)</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">metered</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;             <span class="hljs-comment">// æ ‡è®°ä¸ºè®¡è´¹</span>
        <span class="hljs-type">int</span> leasesSubnetPrefixLength;        <span class="hljs-comment">// P2P å‰ç¼€é•¿åº¦</span>
    },
    DhcpEventCallback {
        onLeasesChanged(DhcpLeaseParcelable[])  <span class="hljs-comment">// è·å– DHCP ç§Ÿçº¦</span>
        onNewPrefixRequest(IpPrefix)             <span class="hljs-comment">// å‰ç¼€æ”¹å˜é€šçŸ¥</span>
    }
)
</code></pre>
<p><strong>DHCP å®¢æˆ·ç«¯ä¿¡æ¯æ”¶é›†</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// DhcpEventCallback.onLeasesChanged() </span>
List&lt;DhcpLeaseParcelable&gt; leases â†’ TetheredClient[] {
    MacAddress macAddress;                  <span class="hljs-comment">// å®¢æˆ·ç«¯ MAC</span>
    LinkAddress address;                    <span class="hljs-comment">// åˆ†é…çš„ IP (å«è¿‡æœŸæ—¶é—´)</span>
    String hostname;                        <span class="hljs-comment">// å®¢æˆ·ç«¯ä¸»æœºå</span>
    <span class="hljs-type">int</span> tetheringType;                      <span class="hljs-comment">// å…±äº«ç±»å‹ (WiFi/USB/BT)</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-9">å››ã€IPv6 é…ç½®ä¸ RAï¼ˆè·¯ç”±é€šå‘Šï¼‰</h3>
<h4 data-id="heading-10">4.1 IPv6 è®¾ç½®æ­¥éª¤</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">startIPv6</span>()
    â”‚
    â”œâ”€â–º <span class="hljs-built_in">configureForIPv6Router</span>(interface)
    â”‚   â”œâ”€ <span class="hljs-built_in">setEnableIPv6</span>(iface, <span class="hljs-number">0</span>) â†’ <span class="hljs-built_in">setEnableIPv6</span>(iface, <span class="hljs-number">1</span>)
    â”‚   â”œâ”€ <span class="hljs-built_in">setAcceptIPv6Ra</span>(iface, <span class="hljs-number">0</span>)        <span class="hljs-comment">// ç¦ç”¨å®¢æˆ·ç«¯ RA</span>
    â”‚   â”œâ”€ <span class="hljs-built_in">setAcceptIPv6Dad</span>(iface, <span class="hljs-number">0</span>)       <span class="hljs-comment">// ç¦ç”¨ DAD</span>
    â”‚   â””â”€ <span class="hljs-built_in">setIPv6DadTransmits</span>(iface, "<span class="hljs-number">0</span>")  <span class="hljs-comment">// ç¦ç”¨ DAD å‘é€</span>
    â”‚
    â”œâ”€â–º RouterAdvertisementDaemon<span class="hljs-selector-class">.start</span>()
    â”‚   â””â”€ å‘¨æœŸå‘é€ RA (Router Advertisement)
    â”‚       â”œâ”€ å‰ç¼€ä¿¡æ¯ (Prefix Information)
    â”‚       â”œâ”€ MTU ä¿¡æ¯
    â”‚       â””â”€ DNS æœåŠ¡å™¨ (RDNSS é€‰é¡¹)
    â”‚
    â””â”€â–º <span class="hljs-built_in">startIPv6TetheringCoordinator</span>()
        â””â”€ ç®¡ç† IPv6 å‰ç¼€åå•†
</code></pre>
<h4 data-id="heading-11">4.2 NAT64/464XLAT</h4>
<p>For IPv6-only or dual-stack scenarios, IpServer can coordinate with:</p>
<ul>
<li><strong>IPv6TetheringCoordinator</strong>: Allocates IPv6 prefixes to downstreams</li>
<li><strong>Nat464Xlat</strong>: Manages NAT64 translation if needed</li>
</ul>
<hr/>
<h3 data-id="heading-12">äº”ã€ä¸Šæ¸¸ç½‘ç»œé€‰æ‹©æœºåˆ¶</h3>
<h4 data-id="heading-13">5.1 UpstreamNetworkMonitor</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UpstreamNetworkMonitor</span> {
    <span class="hljs-comment">// è·Ÿè¸ªç³»ç»Ÿé»˜è®¤ç½‘ç»œ</span>
    Network mDefaultInternetNetwork;
    
    <span class="hljs-comment">// æ‰€æœ‰å¯ç”¨çš„ä¸Šæ¸¸ç½‘ç»œ</span>
    Map&lt;Network, UpstreamNetworkState&gt; mNetworkMap;
    
    <span class="hljs-comment">// é…ç½®æ ‡å¿—</span>
    <span class="hljs-type">boolean</span> mTryCell;              <span class="hljs-comment">// æ˜¯å¦å°è¯•èœ‚çªç½‘ç»œ</span>
    <span class="hljs-type">boolean</span> mDunRequired;          <span class="hljs-comment">// æ˜¯å¦éœ€è¦ DUNï¼ˆDial-Up Networkï¼‰</span>
    <span class="hljs-type">boolean</span> mAutoUpstream;         <span class="hljs-comment">// è‡ªåŠ¨é€‰æ‹©ä¸Šæ¸¸</span>
    <span class="hljs-type">boolean</span> mIsDefaultCellularUpstream;  <span class="hljs-comment">// å½“å‰é»˜è®¤æ˜¯èœ‚çª</span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">UpstreamNetworkState</span> {
    Network network;
    NetworkCapabilities capabilities;
    LinkProperties linkProperties;
}
</code></pre>
<h4 data-id="heading-14">5.2 ä¸Šæ¸¸é€‰æ‹©é€»è¾‘</h4>
<pre><code class="hljs language-java" lang="java">getCurrentPreferredUpstream() {
    <span class="hljs-comment">// 1. è·å–ç³»ç»Ÿé»˜è®¤ç½‘ç»œçŠ¶æ€</span>
    <span class="hljs-type">UpstreamNetworkState</span> <span class="hljs-variable">dfltState</span> <span class="hljs-operator">=</span> mNetworkMap.get(mDefaultInternetNetwork);
    
    <span class="hljs-comment">// 2. ä¼˜å…ˆé€‰æ‹©éèœ‚çªç½‘ç»œ (WiFi/æœ‰çº¿)</span>
    <span class="hljs-keyword">if</span> (isNetworkUsableAndNotCellular(dfltState)) 
        <span class="hljs-keyword">return</span> dfltState;
    
    <span class="hljs-comment">// 3. æ£€æŸ¥æ˜¯å¦å…è®¸èœ‚çªä¸Šæ¸¸</span>
    <span class="hljs-keyword">if</span> (!isCellularUpstreamPermitted()) 
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;  <span class="hljs-comment">// æ— ä¸Šæ¸¸ï¼Œæœ¬åœ°çƒ­ç‚¹æ¨¡å¼</span>
    
    <span class="hljs-comment">// 4. å¦‚æœéœ€è¦ DUNï¼ˆæŸäº›è¿è¥å•†è¦æ±‚ï¼‰</span>
    <span class="hljs-keyword">if</span> (!mDunRequired) 
        <span class="hljs-keyword">return</span> dfltState;
    
    <span class="hljs-comment">// 5. æœç´¢ DUN ä¸“ç”¨ç½‘ç»œ</span>
    <span class="hljs-keyword">return</span> findFirstDunNetwork(mNetworkMap.values());
}
</code></pre>
<p><strong>äº‹ä»¶é€šçŸ¥</strong>ï¼š</p>
<ul>
<li><code>EVENT_DEFAULT_SWITCHED</code>: ç³»ç»Ÿé»˜è®¤ç½‘ç»œæ”¹å˜</li>
<li><code>EVENT_IFACE_SERVING_STATE_ACTIVE</code>: ä¸‹æ¸¸å¼€å§‹å…±äº«</li>
<li><code>EVENT_IFACE_SERVING_STATE_INACTIVE</code>: ä¸‹æ¸¸åœæ­¢å…±äº«</li>
</ul>
<hr/>
<h3 data-id="heading-15">å…­ã€NAT ä¸ IP è½¬å‘</h3>
<h4 data-id="heading-16">6.1 TetherController - netd ä¸­çš„è½¬å‘ç®¡ç†</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// system_netd/server/TetherController.cpp</span>

<span class="hljs-comment">// 1. å¯ç”¨ IP è½¬å‘</span>
<span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">enableForwarding</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* requester)</span> </span>{
    mForwardingRequests.<span class="hljs-built_in">insert</span>(requester);      <span class="hljs-comment">// å¼•ç”¨è®¡æ•°</span>
    <span class="hljs-built_in">writeToFile</span>(<span class="hljs-string">"/proc/sys/net/ipv4/ip_forward"</span>, <span class="hljs-string">"1"</span>);
    <span class="hljs-built_in">writeToFile</span>(<span class="hljs-string">"/proc/sys/net/ipv6/conf/all/forwarding"</span>, <span class="hljs-string">"1"</span>);
}

<span class="hljs-comment">// 2. å¯åŠ¨ dnsmasqï¼ˆDHCP/DNS æœåŠ¡ï¼‰</span>
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">startTethering</span><span class="hljs-params">(<span class="hljs-type">bool</span> usingLegacyDnsProxy, <span class="hljs-type">char</span>** dhcpRanges)</span> </span>{
    <span class="hljs-comment">// ä¸º dnsmasq åˆ›å»ºç®¡é“é€šä¿¡</span>
    <span class="hljs-built_in">Pipe</span>(pipeRead, pipeWrite);
    
    <span class="hljs-comment">// fork() å¯åŠ¨ dnsmasq è¿›ç¨‹</span>
    <span class="hljs-type">pid_t</span> pid = fork();
    <span class="hljs-keyword">if</span> (pid == <span class="hljs-number">0</span>) {
        <span class="hljs-built_in">execve</span>(<span class="hljs-string">"/system/bin/dnsmasq"</span>, args, <span class="hljs-literal">NULL</span>);
    }
    
    <span class="hljs-comment">// ä¸ dnsmasq é€šä¿¡ï¼šupdate_ifaces|wlan0|usb0</span>
    <span class="hljs-built_in">write</span>(daemonFd, update_ifaces_cmd);
    <span class="hljs-built_in">write</span>(daemonFd, update_dns_cmd);
}

<span class="hljs-comment">// 3. è®¾ç½® NAT è½¬å‘è§„åˆ™</span>
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">enableNat</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* intIface, <span class="hljs-type">const</span> <span class="hljs-type">char</span>* extIface)</span> </span>{
    <span class="hljs-comment">// ç¬¬ä¸€æ¬¡å¯ç”¨è½¬å‘æ—¶ï¼Œæ·»åŠ  MASQUERADE è§„åˆ™</span>
    iptables-restore &lt;&lt; EOF
*nat
-A tetherctrl_nat_POSTROUTING -o $extIface -j MASQUERADE
COMMIT
EOF
    
    <span class="hljs-comment">// ä¸ºè¯¥è½¬å‘å¯¹æ·»åŠ è½¬å‘è§„åˆ™</span>
    iptables-restore &lt;&lt; EOF
*raw
-A tetherctrl_raw_PREROUTING -i $intIface -m rpfilter --invert ! -s fe80::/<span class="hljs-number">64</span> -j DROP
COMMIT

*filter
-A tetherctrl_FORWARD -i $extIface -o $intIface -m state --state ESTABLISHED,RELATED -g tetherctrl_counters
-A tetherctrl_FORWARD -i $intIface -o $extIface -m state --state INVALID -j DROP
-A tetherctrl_FORWARD -i $intIface -o $extIface -g tetherctrl_counters
COMMIT
EOF
}
</code></pre>
<h4 data-id="heading-17">6.2 iptables è§„åˆ™ç»“æ„</h4>
<pre><code class="hljs language-markdown" lang="markdown">è½¬å‘é“¾ (tetherctrl<span class="hljs-emphasis">_FORWARD):

ä¸‹æ¸¸æ¥çš„åŒ… (intIfaceâ†’extIface)ï¼š
    â”‚
    â”œâ”€ çŠ¶æ€æ£€æŸ¥: INVALID â†’ DROP
    â”œâ”€ æµé‡è®¡æ•°: goto tetherctrl_</span>counters
<span class="hljs-code">    â””â”€ é»˜è®¤: DROP
</span>
ä¸Šæ¸¸æ¥çš„åŒ… (extIfaceâ†’intIface)ï¼š
<span class="hljs-code">    â”‚
    â”œâ”€ çŠ¶æ€æ£€æŸ¥: ESTABLISHED,RELATED â†’ goto tetherctrl_counters
    â””â”€ é»˜è®¤: DROP
</span>
MASQUERADE è§„åˆ™ (natè¡¨):
<span class="hljs-code">    å‡ºæ¥å£ $extIface â†’ æ”¹å†™æºåœ°å€ä¸ºå‡ºæ¥å£åœ°å€
</span></code></pre>
<p><strong>å…³é”®é“¾å®šä¹‰</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">LOCAL_FORWARD</span>                = <span class="hljs-string">"tetherctrl_FORWARD"</span>
<span class="hljs-attr">LOCAL_MANGLE_FORWARD</span>         = <span class="hljs-string">"tetherctrl_mangle_FORWARD"</span>
<span class="hljs-attr">LOCAL_NAT_POSTROUTING</span>        = <span class="hljs-string">"tetherctrl_nat_POSTROUTING"</span>
<span class="hljs-attr">LOCAL_RAW_PREROUTING</span>         = <span class="hljs-string">"tetherctrl_raw_PREROUTING"</span>
<span class="hljs-attr">LOCAL_TETHER_COUNTERS_CHAIN</span>  = <span class="hljs-string">"tetherctrl_counters"</span>
</code></pre>
<hr/>
<h3 data-id="heading-18">ä¸ƒã€DHCP ä¸ DNS è½¬å‘</h3>
<h4 data-id="heading-19">7.1 dnsmasq é›†æˆ</h4>
<pre><code class="hljs language-ini" lang="ini">TetherController ä¸­çš„ dnsmasq ç®¡ç†ï¼š

å¯åŠ¨æµç¨‹ï¼š
    startTethering()
    â””â”€â–º fork() + execve("/system/bin/dnsmasq", args)
        
dnsmasq å‚æ•°é…ç½®ï¼š
    --keep-in-foreground       <span class="hljs-comment"># å‰å°è¿è¡Œï¼ˆé¿å…å®ˆæŠ¤åŒ–ï¼‰</span>
    --no-resolv               <span class="hljs-comment"># ä¸è¯»å– /etc/resolv.conf</span>
    --no-poll                 <span class="hljs-comment"># ä¸è½®è¯¢ resolv.conf</span>
    --dhcp-authoritative      <span class="hljs-comment"># æ­¤ DHCP æ˜¯æƒå¨æœåŠ¡</span>
    <span class="hljs-attr">--dhcp-range</span>=start,end,<span class="hljs-number">1</span>h <span class="hljs-comment"># DHCP èŒƒå›´å’Œç§Ÿçº¦æ—¶é—´</span>
    <span class="hljs-attr">--listen-mark</span>=<span class="hljs-number">0</span>x...       <span class="hljs-comment"># Socket markï¼ˆç”¨äºè·¯ç”±ç­–ç•¥ï¼‰</span>
    <span class="hljs-attr">--user</span>=dns_tether         <span class="hljs-comment"># è¿è¡Œç”¨æˆ·</span>
    <span class="hljs-attr">--port</span>=<span class="hljs-number">0</span>                  <span class="hljs-comment"># ç¦ç”¨ DNS é€’å½’æŸ¥è¯¢ç«¯å£</span>
    
ä¸ dnsmasq çš„åŠ¨æ€é€šä¿¡ï¼ˆé€šè¿‡ pipeï¼‰ï¼š
    å‘½ä»¤æ ¼å¼: "command|arg1|arg2|..."
    
    update_ifaces|wlan0|usb0
        â””â”€ å‘Šè¯‰ dnsmasq åœ¨å“ªäº›æ¥å£ä¸Šæä¾› DHCP
    
    update_dns|0x12345|8.8.8.8|8.8.4.4
        â””â”€ å‘Šè¯‰ dnsmasq è½¬å‘ DNS è¯·æ±‚åˆ°è¿™äº›åœ°å€
           0x12345 æ˜¯ Fwmark (ç”¨äºæŒ‡å®šä½¿ç”¨å“ªä¸ªç½‘ç»œ)
</code></pre>
<h4 data-id="heading-20">7.2 DNS æŸ¥è¯¢æµç¨‹</h4>
<pre><code class="hljs language-markdown" lang="markdown">ä¸‹æ¸¸å®¢æˆ·ç«¯ DNS æŸ¥è¯¢:

<span class="hljs-bullet">1.</span> å®¢æˆ·ç«¯å‘é€ DNS æŸ¥è¯¢åˆ° dnsmasq (IpServer åˆ†é…çš„IP:53)
<span class="hljs-bullet">2.</span> dnsmasq æŸ¥è¯¢ç¼“å­˜ â†’ æœªå‘½ä¸­ï¼Œåˆ™è½¬å‘ç»™ä¸Šæ¸¸
<span class="hljs-bullet">3.</span> DNS è½¬å‘è§„åˆ™:
<span class="hljs-bullet">   -</span> æºåœ°å€æ”¹å†™: ä» dnsmasq å‡ºå‘
<span class="hljs-bullet">   -</span> Fwmark æ ‡è®°: ç¡®ä¿ä½¿ç”¨æŒ‡å®šçš„ä¸Šæ¸¸ç½‘ç»œ
<span class="hljs-bullet">   -</span> ç›®æ ‡åœ°å€: ä¸Šæ¸¸ DNS æœåŠ¡å™¨ (é€šè¿‡ setDnsForwarders() é…ç½®)
<span class="hljs-bullet">4.</span> ä¸Šæ¸¸ DNS å“åº” â†’ dnsmasq ç¼“å­˜ â†’ å›å¤ç»™å®¢æˆ·ç«¯
</code></pre>
<hr/>
<h3 data-id="heading-21">å…«ã€ä¸åŒä¸‹æ¸¸ç±»å‹çš„ç‰¹æ®Šå¤„ç†</h3>
<h4 data-id="heading-22">8.1 WiFi çƒ­ç‚¹ (TETHERING_WIFI)</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å¯ç”¨æµç¨‹</span>
setWifiTethering(enable) {
    <span class="hljs-type">WifiManager</span> <span class="hljs-variable">mgr</span> <span class="hljs-operator">=</span> getWifiManager();
    <span class="hljs-keyword">if</span> (enable) {
        mgr.startTetheredHotspot(<span class="hljs-literal">null</span>);  <span class="hljs-comment">// å¯åŠ¨ SoftAP</span>
    } <span class="hljs-keyword">else</span> {
        mgr.stopSoftAp();                 <span class="hljs-comment">// åœæ­¢ SoftAP</span>
    }
}

<span class="hljs-comment">// WiFi ç‰¹æ€§:</span>
<span class="hljs-comment">// - æ¥å£ç”± WiFi Framework ç®¡ç† (up/downçŠ¶æ€)</span>
<span class="hljs-comment">// - IpServer ä¸è°ƒç”¨ setIfaceUp()</span>
<span class="hljs-comment">// - æ”¯æŒå¤šä¸ªå®¢æˆ·ç«¯</span>
<span class="hljs-comment">// - å¯é…ç½® SSIDã€å¯†ç ã€é¢‘æ®µ</span>
<span class="hljs-comment">// - MAC åœ°å€å¯èƒ½æ˜¯éšæœºçš„</span>
</code></pre>
<h4 data-id="heading-23">8.2 USB å…±äº« (TETHERING_USB / TETHERING_NCM)</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// USB é©±åŠ¨ç®¡ç†</span>
setUsbTethering(enable) {
    <span class="hljs-type">UsbManager</span> <span class="hljs-variable">mgr</span> <span class="hljs-operator">=</span> getUsbManager();
    String[] functions = enable 
        ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[] { USB_FUNCTION_RNDIS }  <span class="hljs-comment">// æ—§è®¾å¤‡</span>
        : <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[] { USB_FUNCTION_NCM };   <span class="hljs-comment">// Android 10+</span>
    mgr.setCurrentFunctions(functions);
}

<span class="hljs-comment">// USB ç‰¹æ€§:</span>
<span class="hljs-comment">// - IpServer éœ€è¦ç®¡ç† interface up/down</span>
<span class="hljs-comment">// - é€šå¸¸ä¸ºå•ä¸€å®¢æˆ·ç«¯ (PC/Mac)</span>
<span class="hljs-comment">// - é™æ€ IP åœ°å€é…ç½®å¯é€‰ (--dhcp-range=å•ä¸ªåœ°å€)</span>
<span class="hljs-comment">// - é«˜é€Ÿã€ç¨³å®šè¿æ¥</span>
<span class="hljs-comment">// - Prefix å˜åŒ–æ—¶éœ€è¦åå•† (NCM ç‰¹æ€§)</span>
</code></pre>
<p><strong>USB NCM çš„å‰ç¼€åå•†</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// onNewPrefixRequest() å¤„ç†</span>
<span class="hljs-comment">// å½“ netd è¯·æ±‚æ–°å‰ç¼€æ—¶ï¼š</span>
handleNewPrefixRequest(IpPrefix newPrefix) {
    <span class="hljs-comment">// 1. ç§»é™¤æ—§åœ°å€å’Œè·¯ç”±</span>
    removeRoutesFromLocalNetwork(oldRoutes);
    
    <span class="hljs-comment">// 2. æ·»åŠ æ–°åœ°å€</span>
    mInterfaceCtrl.addAddress(newAddr, prefixLen);
    
    <span class="hljs-comment">// 3. æ›´æ–° DHCP å‚æ•°</span>
    mDhcpServer.updateParams(newParams);
    
    <span class="hljs-comment">// 4. æ›´æ–° RA å‚æ•° (IPv6)</span>
    mRaDaemon.updateParams(newRaParams);
}
</code></pre>
<h4 data-id="heading-24">8.3 è“ç‰™å…±äº« (TETHERING_BLUETOOTH)</h4>
<pre><code class="hljs language-java" lang="java">setBluetoothTethering(enable, listener) {
    <span class="hljs-type">BluetoothAdapter</span> <span class="hljs-variable">adapter</span> <span class="hljs-operator">=</span> deps.getBluetoothAdapter();
    <span class="hljs-keyword">if</span> (adapter == <span class="hljs-literal">null</span> || !adapter.isEnabled())
        <span class="hljs-keyword">return</span> TETHER_ERROR_SERVICE_UNAVAIL;
    
    <span class="hljs-comment">// è·å– PAN æœåŠ¡</span>
    <span class="hljs-type">BluetoothPan</span> <span class="hljs-variable">pan</span> <span class="hljs-operator">=</span> mBluetoothPan;
    
    <span class="hljs-keyword">if</span> (enable) {
        pan.enable();  <span class="hljs-comment">// å¯ç”¨ PAN è§’è‰²</span>
    } <span class="hljs-keyword">else</span> {
        pan.disable(); <span class="hljs-comment">// ç¦ç”¨ PAN è§’è‰²</span>
    }
}

<span class="hljs-comment">// è“ç‰™ç‰¹æ€§:</span>
<span class="hljs-comment">// - æ¥å£é¢„é…ç½®: 192.168.44.1/24 (å›ºå®š)</span>
<span class="hljs-comment">// - å•ä¸€å®¢æˆ·ç«¯è¿æ¥ (PAN åè®®)</span>
<span class="hljs-comment">// - è¾ƒä½å¸¦å®½ã€é«˜å»¶è¿Ÿ</span>
<span class="hljs-comment">// - ç”µæºæ¶ˆè€—å¤§</span>
</code></pre>
<h4 data-id="heading-25">8.4 ä»¥å¤ªç½‘å…±äº« (TETHERING_ETHERNET)</h4>
<pre><code class="hljs language-java" lang="java">setEthernetTethering(enable) {
    <span class="hljs-type">EthernetManager</span> <span class="hljs-variable">mgr</span> <span class="hljs-operator">=</span> getEthernetManager();
    <span class="hljs-comment">// å°†ä»¥å¤ªç½‘æ¥å£åŠ å…¥ tethering ç®¡ç†</span>
    
    <span class="hljs-comment">// ä»¥å¤ªç½‘ç‰¹æ€§:</span>
    <span class="hljs-comment">// - æ¥å£ç”±ç½‘ç»œæ¡†æ¶ç®¡ç†</span>
    <span class="hljs-comment">// - é«˜é€Ÿã€ä½å»¶è¿Ÿ</span>
    <span class="hljs-comment">// - å¯å¤šä¸ªæ¥å£</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-26">ä¹ã€BPF å¸è½½åŠ é€Ÿæœºåˆ¶</h3>
<h4 data-id="heading-27">9.1 BpfCoordinator å·¥ä½œæµç¨‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BpfCoordinator</span> {
    <span class="hljs-comment">// BPF æ˜ å°„è·¯å¾„</span>
    /sys/fs/bpf/tethering/map_offload_tether_*_map
    
    <span class="hljs-comment">// å…³é”® BPF æ˜ å°„:</span>
    tether_stats_map      <span class="hljs-comment">// æŒ‰ä¸Šæ¸¸æ¥å£ç´¢å¼•ï¼Œè®°å½•è½¬å‘å­—èŠ‚/åŒ…æ•°</span>
    tether_limit_map      <span class="hljs-comment">// è½¬å‘æ•°æ®é™åˆ¶</span>
    tether_downstream4_map   <span class="hljs-comment">// IPv4 ä¸‹æ¸¸è§„åˆ™ (æº/ç›®çš„)</span>
    tether_downstream6_map   <span class="hljs-comment">// IPv6 ä¸‹æ¸¸è§„åˆ™</span>
    tether_upstream4_map     <span class="hljs-comment">// IPv4 ä¸Šæ¸¸è§„åˆ™</span>
    tether_upstream6_map     <span class="hljs-comment">// IPv6 ä¸Šæ¸¸è§„åˆ™</span>
    tether_downstream64_map  <span class="hljs-comment">// NAT64 è½¬æ¢è§„åˆ™</span>
}
</code></pre>
<h4 data-id="heading-28">9.2 BPF è½¬å‘æµç¨‹</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">ä¸‹è¡ŒåŒ…</span> <span class="hljs-string">(downstream</span> <span class="hljs-string">â†’</span> <span class="hljs-string">upstream):</span>
    
    <span class="hljs-string">kernel</span> <span class="hljs-string">æ”¶åˆ°åŒ…ï¼ˆæ¥è‡ªä¸‹æ¸¸æ¥å£ï¼‰</span>
        <span class="hljs-string">â”‚</span>
        <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">BPF_TC_INGRESS</span> <span class="hljs-string">hook</span>
        <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">bpf_tether_downstream_ipv4/ipv6()</span>
        <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">æŸ¥æ‰¾è½¬å‘è§„åˆ™:</span> <span class="hljs-string">tether_downstream*_map</span>
        <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">ä¿®æ”¹åŒ…å¤´:</span>
        <span class="hljs-string">â”‚</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">æº</span> <span class="hljs-attr">MAC:</span> <span class="hljs-string">ä¸‹æ¸¸</span> <span class="hljs-string">â†’</span> <span class="hljs-string">ä¸Šæ¸¸æ¥å£</span> <span class="hljs-string">MAC</span>
        <span class="hljs-string">â”‚</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">ç›®çš„</span> <span class="hljs-attr">MAC:</span> <span class="hljs-string">è·å–ä¸Šæ¸¸ç½‘å…³</span> <span class="hljs-string">MAC</span>
        <span class="hljs-string">â”‚</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">æº/ç›®çš„</span> <span class="hljs-attr">IP:</span> <span class="hljs-string">æŒ‰</span> <span class="hljs-string">NAT64/444xlat</span> <span class="hljs-string">ä¿®æ”¹</span>
        <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">æ›´æ–°ç»Ÿè®¡:</span> <span class="hljs-string">tether_stats_map[upstream_ifindex]</span>
        <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">æ£€æŸ¥æ•°æ®é™åˆ¶:</span> <span class="hljs-string">tether_limit_map</span>
        <span class="hljs-string">â””â”€</span> <span class="hljs-attr">TC_ACT_REDIRECT:</span> <span class="hljs-string">é‡å®šå‘åˆ°ä¸Šæ¸¸æ¥å£</span>
        
<span class="hljs-string">ä¸Šè¡ŒåŒ…</span> <span class="hljs-string">(upstream</span> <span class="hljs-string">â†’</span> <span class="hljs-string">downstream):</span>
    
    <span class="hljs-string">kernel</span> <span class="hljs-string">æ”¶åˆ°åŒ…ï¼ˆæ¥è‡ªä¸Šæ¸¸æ¥å£ï¼‰</span>
        <span class="hljs-string">â”‚</span>
        <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">BPF_TC_EGRESS</span> <span class="hljs-string">hook</span>
        <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">bpf_tether_upstream_ipv4/ipv6()</span>
        <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">æŸ¥æ‰¾è½¬å‘è§„åˆ™:</span> <span class="hljs-string">tether_upstream*_map</span>
        <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">ä¿®æ”¹åŒ…å¤´:</span>
        <span class="hljs-string">â”‚</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">æº</span> <span class="hljs-attr">MAC:</span> <span class="hljs-string">ä¸Šæ¸¸</span> <span class="hljs-string">â†’</span> <span class="hljs-string">ä¸‹æ¸¸æ¥å£</span> <span class="hljs-string">MAC</span>
        <span class="hljs-string">â”‚</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">ç›®çš„</span> <span class="hljs-attr">MAC:</span> <span class="hljs-string">è·å–ä¸‹æ¸¸å®¢æˆ·ç«¯</span> <span class="hljs-string">MAC</span>
        <span class="hljs-string">â”‚</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">IP</span> <span class="hljs-string">åœ°å€åå‘è½¬æ¢</span>
        <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">æ›´æ–°ç»Ÿè®¡:</span> <span class="hljs-string">tether_stats_map[upstream_ifindex]</span>
        <span class="hljs-string">â””â”€</span> <span class="hljs-attr">TC_ACT_REDIRECT:</span> <span class="hljs-string">é‡å®šå‘åˆ°ä¸‹æ¸¸æ¥å£</span>
</code></pre>
<h4 data-id="heading-29">9.3 ç»Ÿè®¡æ”¶é›†</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å®šæœŸè½®è¯¢ (é»˜è®¤ 500ms)</span>
maybeSchedulePollingStats() {
    handler.postDelayed(() -&gt; {
        updateForwardedStats();  <span class="hljs-comment">// ä» BPF æ˜ å°„è¯»å–ç»Ÿè®¡</span>
        maybeSchedulePollingStats();  <span class="hljs-comment">// é‡æ–°è°ƒåº¦</span>
    }, getPollingInterval());
}

updateForwardedStats() {
    SparseArray&lt;TetherStatsValue&gt; stats = 
        bpfCoordinatorShim.tetherOffloadGetStats();
    
    <span class="hljs-comment">// ç»Ÿè®¡å€¼ {</span>
    <span class="hljs-comment">//   long rxBytes;</span>
    <span class="hljs-comment">//   long rxPackets;</span>
    <span class="hljs-comment">//   long txBytes;</span>
    <span class="hljs-comment">//   long txPackets;</span>
    <span class="hljs-comment">// }</span>
    
    <span class="hljs-comment">// ä¸ NetworkStatsManager åŒæ­¥ï¼Œç”¨äº:</span>
    <span class="hljs-comment">// - åº”ç”¨æŸ¥è¯¢æ•°æ®ç”¨é‡</span>
    <span class="hljs-comment">// - æ£€æŸ¥æ•°æ®é™åˆ¶</span>
    <span class="hljs-comment">// - è§¦å‘è­¦æŠ¥</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-30">åã€å…³é”®æ•°æ®æµ</h3>
<h4 data-id="heading-31">10.1 å¯ç”¨å…±äº«çš„å®Œæ•´æµç¨‹</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-number">1</span>. ç”¨æˆ·åœ¨ SystemUI å¯ç”¨ WiFi çƒ­ç‚¹
   â”‚
   â”œâ”€â–º HotspotControllerImpl<span class="hljs-selector-class">.setHotspotEnabled</span>(true)
   â”‚
   â”œâ”€â–º TetheringManager<span class="hljs-selector-class">.startTethering</span>(
   â”‚       TetheringRequest.Builder(TETHERING_WIFI)<span class="hljs-selector-class">.build</span>()
   â”‚   )
   â”‚
   â”œâ”€â–º TetheringService<span class="hljs-selector-class">.TetheringConnector</span><span class="hljs-selector-class">.startTethering</span>()
   â”‚
   â”œâ”€â–º Tethering<span class="hljs-selector-class">.startTethering</span>(request)
   â”‚
   â”œâ”€â–º Tethering<span class="hljs-selector-class">.enableTetheringInternal</span>(TETHERING_WIFI, true)
   â”‚
   â”œâ”€â–º <span class="hljs-built_in">setWifiTethering</span>(true)
   â”‚   â””â”€â–º WifiManager<span class="hljs-selector-class">.startTetheredHotspot</span>()
   â”‚       â””â”€ WiFi Framework å¯åŠ¨ SoftAPï¼Œå¹¿æ’­ IFACE_IP_MODE_TETHERED
   â”‚
   â”œâ”€ Tethering<span class="hljs-selector-class">.onInterfaceServingStateActive</span>(ifname, mode)
   â”‚
   â”œâ”€â–º Tethering<span class="hljs-selector-class">.enableIpServing</span>(type, ifname, STATE_TETHERED)
   â”‚
   â”œâ”€â–º IpServer<span class="hljs-selector-class">.enable</span>(STATE_TETHERED, request)
   â”‚   â””â”€ å‘é€ CMD_TETHER_REQUESTED
   â”‚
   â”œâ”€ IpServer çŠ¶æ€è½¬ç§»: InitialState â†’ TetheredState
   â”‚   (è¿›å…¥ TetheredState)
   â”‚
   â”œâ”€â–º BaseServingState.<span class="hljs-built_in">enter</span>()
   â”‚   â”œâ”€â–º <span class="hljs-built_in">startServingInterface</span>()
   â”‚   â”‚   â”œâ”€â–º <span class="hljs-built_in">startIPv4</span>()
   â”‚   â”‚   â”‚   â”œâ”€ è¯·æ±‚ IPv4 åœ°å€ (<span class="hljs-number">192.168</span>.<span class="hljs-number">43.1</span>/<span class="hljs-number">24</span>)
   â”‚   â”‚   â”‚   â”œâ”€ InterfaceController.<span class="hljs-built_in">setInterfaceConfiguration</span>()
   â”‚   â”‚   â”‚   â””â”€â–º <span class="hljs-built_in">startDhcp</span>()
   â”‚   â”‚   â”‚       â””â”€ DHCP æœåŠ¡å™¨å¯åŠ¨
   â”‚   â”‚   â”‚
   â”‚   â”‚   â”œâ”€â–º NetdUtils.<span class="hljs-built_in">tetherInterface</span>()
   â”‚   â”‚   â”‚   â””â”€â–º INetd.<span class="hljs-built_in">tetherInterfaceAdd</span>()
   â”‚   â”‚   â”‚       â””â”€â–º TetherController.<span class="hljs-built_in">tetherInterface</span>()
   â”‚   â”‚   â”‚
   â”‚   â”‚   â””â”€â–º <span class="hljs-built_in">startIPv6</span>()
   â”‚   â”‚       â”œâ”€ é…ç½® IPv6 ä¸ºè·¯ç”±å™¨æ¨¡å¼
   â”‚   â”‚       â””â”€ å¯åŠ¨ RA è¿›ç¨‹
   â”‚   â”‚
   â”‚   â”œâ”€â–º TetherMainSM.EVENT_IFACE_SERVING_STATE_ACTIVE
   â”‚   â”‚   (ä¸» SM é…ç½®è½¬å‘è§„åˆ™)
   â”‚   â”‚
   â”‚   â””â”€â–º <span class="hljs-built_in">setInterfaceState</span>(STATE_TETHERED)
   â”‚
   â””â”€ å…±äº«å·²å¯ç”¨ï¼

<span class="hljs-number">2</span>. ä¸‹æ¸¸å®¢æˆ·ç«¯è¿æ¥
   â”‚
   â”œâ”€ å®¢æˆ·ç«¯è¿æ¥åˆ° WiFi çƒ­ç‚¹
   â”œâ”€ DHCP æœåŠ¡å™¨åˆ†é… IP (<span class="hljs-number">192.168</span>.<span class="hljs-number">43</span>.x)
   â”œâ”€ IpServer.DhcpEventCallback.<span class="hljs-built_in">onLeasesChanged</span>()
   â””â”€ Tethering.<span class="hljs-built_in">dhcpLeasesChanged</span>() â†’ æ›´æ–°å®¢æˆ·ç«¯åˆ—è¡¨

<span class="hljs-number">3</span>. æ•°æ®è½¬å‘å¼€å§‹
   â”‚
   â”œâ”€ ä¸‹æ¸¸å®¢æˆ·ç«¯å‘é€æ•°æ®åŒ…
   â”œâ”€ Netfilter hooks è§¦å‘
   â”œâ”€ BPF ç¨‹åºæ£€æŸ¥è½¬å‘è§„åˆ™å’Œæ•°æ®é™åˆ¶
   â”œâ”€ å¦‚æœå¯ç”¨å¸è½½ï¼ŒBPF ç›´æ¥è½¬å‘å¹¶æ›´æ–°ç»Ÿè®¡
   â”œâ”€ å¦åˆ™ç”± iptables è§„åˆ™å¤„ç†
   â””â”€ ç»Ÿè®¡å®šæœŸé‡‡æ ·å¹¶ä¸ŠæŠ¥
</code></pre>
<h4 data-id="heading-32">10.2 ç¦ç”¨å…±äº«çš„å®Œæ•´æµç¨‹</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-number">1</span>. ç”¨æˆ·åœ¨ SystemUI ç¦ç”¨ WiFi çƒ­ç‚¹
   â”‚
   â”œâ”€â–º HotspotControllerImpl<span class="hljs-selector-class">.setHotspotEnabled</span>(false)
   â”‚
   â”œâ”€â–º TetheringManager<span class="hljs-selector-class">.stopTethering</span>(TETHERING_WIFI)
   â”‚
   â”œâ”€â–º Tethering<span class="hljs-selector-class">.stopTethering</span>(TETHERING_WIFI)
   â”‚
   â”œâ”€â–º Tethering<span class="hljs-selector-class">.stopTetheringInternal</span>(TETHERING_WIFI)
   â”‚   â””â”€â–º <span class="hljs-built_in">enableTetheringInternal</span>(TETHERING_WIFI, false)
   â”‚
   â”œâ”€â–º <span class="hljs-built_in">setWifiTethering</span>(false)
   â”‚   â””â”€â–º WifiManager<span class="hljs-selector-class">.stopSoftAp</span>()
   â”‚       â””â”€ WiFi å¹¿æ’­ IFACE_IP_MODE_CONFIGURATION_ERROR
   â”‚
   â”œâ”€ Tethering<span class="hljs-selector-class">.onInterfaceServingStateInactive</span>()
   â”‚
   â”œâ”€â–º IpServer<span class="hljs-selector-class">.unwanted</span>()
   â”‚   â””â”€ å‘é€ CMD_TETHER_UNREQUESTED
   â”‚
   â”œâ”€ IpServer çŠ¶æ€è½¬ç§»: TetheredState â†’ InitialState
   â”‚   (ç¦»å¼€ BaseServingState)
   â”‚
   â”œâ”€â–º BaseServingState.<span class="hljs-built_in">exit</span>()
   â”‚   â”œâ”€â–º <span class="hljs-built_in">stopIPv6</span>()
   â”‚   â”‚   â””â”€ åœæ­¢ RA è¿›ç¨‹
   â”‚   â”‚
   â”‚   â”œâ”€â–º NetdUtils.<span class="hljs-built_in">untetherInterface</span>()
   â”‚   â”‚   â””â”€â–º INetd.<span class="hljs-built_in">tetherInterfaceRemove</span>()
   â”‚   â”‚       â””â”€â–º TetherController.<span class="hljs-built_in">untetherInterface</span>()
   â”‚   â”‚
   â”‚   â”œâ”€â–º <span class="hljs-built_in">stopIPv4</span>()
   â”‚   â”‚   â”œâ”€ åœæ­¢ DHCP æœåŠ¡
   â”‚   â”‚   â”œâ”€ æ¸…é™¤æ¥å£åœ°å€
   â”‚   â”‚   â”œâ”€ é‡Šæ”¾ IPv4 åœ°å€
   â”‚   â”‚   â””â”€ BpfCoordinator.<span class="hljs-built_in">tetherOffloadClientClear</span>()
   â”‚   â”‚
   â”‚   â””â”€ <span class="hljs-built_in">resetLinkProperties</span>()
   â”‚
   â””â”€ å…±äº«å·²ç¦ç”¨ï¼
</code></pre>
<hr/>
<h3 data-id="heading-33">åä¸€ã€æ ¸å¿ƒæ•°æ®ç»“æ„</h3>
<h4 data-id="heading-34">11.1 TetheringRequest</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Parcelable</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TetheringRequest</span> {
    <span class="hljs-type">int</span> tetheringType;              <span class="hljs-comment">// TETHERING_WIFI/USB/BLUETOOTH</span>
    <span class="hljs-type">boolean</span> showProvisioningUi;     <span class="hljs-comment">// æ˜¯å¦æ˜¾ç¤ºé…é¢æ£€æŸ¥ UI</span>
    <span class="hljs-type">boolean</span> exemptFromEntitlementCheck;  <span class="hljs-comment">// è±å…é…é¢æ£€æŸ¥</span>
    Inet4Address localIPv4Address;  <span class="hljs-comment">// æœ¬åœ° IPv4 åœ°å€ (å¯é€‰)</span>
    Inet4Address staticClientAddress;  <span class="hljs-comment">// é™æ€å®¢æˆ·ç«¯åœ°å€ (å¯é€‰)</span>
}
</code></pre>
<h4 data-id="heading-35">11.2 LinkProperties</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LinkProperties</span> {
    List&lt;LinkAddress&gt; mLinkAddresses;   <span class="hljs-comment">// IPv4/IPv6 åœ°å€</span>
    List&lt;RouteInfo&gt; mRoutes;            <span class="hljs-comment">// è·¯ç”±è§„åˆ™</span>
    Collection&lt;InetAddress&gt; mDnses;     <span class="hljs-comment">// DNS æœåŠ¡å™¨</span>
    String mDomains;                    <span class="hljs-comment">// DNS æœç´¢åŸŸ</span>
    List&lt;InetAddress&gt; mValidatedDnses;  <span class="hljs-comment">// å·²éªŒè¯çš„ DNS</span>
    Inet4Address mDhcpServerAddress;    <span class="hljs-comment">// DHCP æœåŠ¡å™¨åœ°å€</span>
    String mHttpProxy;                  <span class="hljs-comment">// HTTP ä»£ç†</span>
    String mPrivateDnsServerName;       <span class="hljs-comment">// ç§æœ‰ DNS</span>
}
</code></pre>
<h4 data-id="heading-36">11.3 TetheredClient</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TetheredClient</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Parcelable</span> {
    MacAddress mMacAddress;             <span class="hljs-comment">// å®¢æˆ·ç«¯ MAC åœ°å€</span>
    List&lt;AddressInfo&gt; mAddresses;       <span class="hljs-comment">// åˆ†é…çš„åœ°å€åˆ—è¡¨</span>
    <span class="hljs-type">int</span> mTetheringType;                 <span class="hljs-comment">// å…±äº«ç±»å‹</span>
    
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">AddressInfo</span> {
        LinkAddress mAddress;           <span class="hljs-comment">// IP åœ°å€ + å‰ç¼€é•¿åº¦</span>
        String mHostname;               <span class="hljs-comment">// DHCP æŠ¥å‘Šçš„ä¸»æœºå</span>
        <span class="hljs-type">long</span> <span class="hljs-title function_">getExpirationTime</span><span class="hljs-params">()</span>;       <span class="hljs-comment">// ç§Ÿçº¦è¿‡æœŸæ—¶é—´</span>
    }
}
</code></pre>
<h4 data-id="heading-37">11.4 UpstreamNetworkState</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UpstreamNetworkState</span> {
    Network network;
    NetworkCapabilities capabilities;
    LinkProperties linkProperties;
    <span class="hljs-comment">// ç”¨äºåˆ¤æ–­æ˜¯å¦é€‚åˆä½œä¸ºä¸Šæ¸¸</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">isCellular</span><span class="hljs-params">()</span> { <span class="hljs-comment">/* æ£€æŸ¥ capability */</span> }
}
</code></pre>
<hr/>
<h3 data-id="heading-38">åäºŒã€æƒé™ä¸é…é¢æ£€æŸ¥</h3>
<h4 data-id="heading-39">12.1 æƒé™æ¨¡å‹</h4>
<pre><code class="hljs">Binder æƒé™ï¼ˆTethering APIï¼‰:
â”œâ”€ android.Manifest.permission.TETHER_PRIVILEGED
â”‚  â””â”€ ç³»ç»Ÿåº”ç”¨ï¼ˆSystemUIã€Settingsï¼‰
â”‚
â”œâ”€ android.Manifest.permission.WRITE_SETTINGS
â”‚  â””â”€ æ™®é€šåº”ç”¨ï¼ˆéœ€è¦ç”¨æˆ·æˆäºˆï¼‰
â”‚
â””â”€ android.Manifest.permission.NETWORK_SETTINGS
   â””â”€ ç³»ç»Ÿåº”ç”¨
</code></pre>
<h4 data-id="heading-40">12.2 é…é¢æœºåˆ¶</h4>
<pre><code class="hljs language-markdown" lang="markdown">EntitlementManager æ£€æŸ¥:

<span class="hljs-bullet">1.</span> è¿è¥å•†é…é¢æ£€æŸ¥
   â”œâ”€ è¯»å– CarrierConfig
   â”œâ”€ æ£€æŸ¥ KEY<span class="hljs-emphasis">_TETHER_</span>DUN<span class="hljs-emphasis">_REQUIRED_</span>BOOL (æ˜¯å¦éœ€è¦ DUN)
   â””â”€ æ£€æŸ¥ KEY<span class="hljs-emphasis">_CARRIER_</span>PROVISIONING<span class="hljs-emphasis">_* (è¿è¥å•†é…ç½®)

2. DUN (Dial-Up Network) ç½‘ç»œ
   â”œâ”€ æŸäº›è¿è¥å•†è¦æ±‚ tethering ä½¿ç”¨ DUN APN
   â”œâ”€ DUN ç½‘ç»œå•ç‹¬è®¡è´¹æˆ–æœ‰é™åˆ¶
   â””â”€ Tethering é€šè¿‡ ConnectivityManager è¯·æ±‚ DUN ç½‘ç»œ

3. æ•°æ®é™åˆ¶
   â”œâ”€ æ¯ä¸ªä¸Šæ¸¸æ¥å£å¯ä»¥è®¾ç½®æ•°æ®é™åˆ¶
   â”œâ”€ ç”± BpfCoordinator åœ¨å†…æ ¸çº§åˆ«æ£€æŸ¥
   â””â”€ è¶…é™æ—¶ä¸¢åŒ…å¹¶é€šçŸ¥åº”ç”¨
</span></code></pre>
<hr/>
<h3 data-id="heading-41">åä¸‰ã€é”™è¯¯å¤„ç†ä¸æ¢å¤</h3>
<h4 data-id="heading-42">13.1 IpServer é”™è¯¯ä»£ç </h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TETHER_ERROR_NO_ERROR</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TETHER_ERROR_UNKNOWN_IFACE</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TETHER_ERROR_UNKNOWN_TYPE</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TETHER_ERROR_UNAVAIL_IFACE</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TETHER_ERROR_INTERNAL_ERROR</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TETHER_ERROR_SERVICE_UNAVAIL</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TETHER_ERROR_UNSUPPORTED</span> <span class="hljs-operator">=</span> <span class="hljs-number">6</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TETHER_ERROR_IFACE_CFG_ERROR</span> <span class="hljs-operator">=</span> <span class="hljs-number">7</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TETHER_ERROR_TETHER_IFACE_ERROR</span> <span class="hljs-operator">=</span> <span class="hljs-number">8</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TETHER_ERROR_UNTETHER_IFACE_ERROR</span> <span class="hljs-operator">=</span> <span class="hljs-number">9</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TETHER_ERROR_DHCPSERVER_ERROR</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
</code></pre>
<h4 data-id="heading-43">13.2 å‰ç¼€å†²çªå¤„ç†</h4>
<pre><code class="hljs language-objectivec" lang="objectivec">å½“æ£€æµ‹åˆ° IPv6 å‰ç¼€å†²çªæ—¶ï¼š

<span class="hljs-number">1.</span> IpServer æ”¶åˆ° <span class="hljs-built_in">CMD_NOTIFY_PREFIX_CONFLICT</span>
   â”‚
   â”œâ”€ è½¬ç§»åˆ° WaitingForRestartState
   â”‚
   â”œâ”€ è§¦å‘ mCallback.requestEnableTethering(type, <span class="hljs-literal">false</span>)
   â”‚   â””â”€ ç¦ç”¨å½“å‰å…±äº«
   â”‚
   â”œâ”€ æ¸…é™¤æ‰€æœ‰ç°æœ‰é…ç½®
   â”‚
   â””â”€ è¿”å› <span class="hljs-built_in">AVAILABLE</span> çŠ¶æ€

<span class="hljs-number">2.</span> ç¨åé‡æ–°å¯ç”¨æ—¶
   â”‚
   â”œâ”€ è¯·æ±‚æ–°çš„ IPv6 å‰ç¼€
   â”‚
   â”œâ”€ é‡æ–°é…ç½®æ¥å£
   â”‚
   â””â”€ æ¢å¤å…±äº«
</code></pre>
<hr/>
<h3 data-id="heading-44">åå››ã€ç›‘æ§ä¸è°ƒè¯•</h3>
<h4 data-id="heading-45">14.1 Dumpsys è¾“å‡º</h4>
<pre><code class="hljs language-bash" lang="bash">adb shell dumpsys connectivity | grep -A 100 <span class="hljs-string">"Tethering"</span>
</code></pre>
<p>è¾“å‡ºåŒ…æ‹¬ï¼š</p>
<ul>
<li>å½“å‰ tethering çŠ¶æ€</li>
<li>æ´»è·ƒçš„ä¸‹æ¸¸æ¥å£åŠå…¶çŠ¶æ€</li>
<li>è½¬å‘ç»Ÿè®¡</li>
<li>BPF è½¬å‘è§„åˆ™</li>
<li>iptables è§„åˆ™</li>
</ul>
<h4 data-id="heading-46">14.2 æ—¥å¿—æ”¶é›†</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹ Tethering æ—¥å¿—</span>
adb logcat -s Tethering IpServer TetherController UpstreamNetworkMonitor

<span class="hljs-comment"># æŸ¥çœ‹ DHCP æ—¥å¿—</span>
adb logcat -s dnsmasq dhcpserver

<span class="hljs-comment"># æŸ¥çœ‹ netd æ—¥å¿—</span>
adb logcat -s netd
</code></pre>
<hr/>
<h3 data-id="heading-47">åäº”ã€æ€§èƒ½ä¼˜åŒ–å…³é”®ç‚¹</h3>
<ol>
<li>
<p><strong>BPF å¸è½½åŠ é€Ÿ</strong>ï¼š</p>
<ul>
<li>å‡è½»å†…æ ¸è½¬å‘è´Ÿæ‹…</li>
<li>é™ä½ CPU ä½¿ç”¨ç‡</li>
<li>æé«˜ååé‡ï¼ˆå¯è¾¾ Gbps çº§åˆ«ï¼‰</li>
</ul>
</li>
<li>
<p><strong>TCP MSS é’³åˆ¶</strong>ï¼š</p>
<ul>
<li>iptables mangle è¡¨è®¾ç½® TCPMSS</li>
<li>é˜²æ­¢å¤§åŒ…è¢«åˆ†ç‰‡</li>
</ul>
</li>
<li>
<p><strong>Conntrack ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>é…ç½® nf_conntrack å‚æ•°</li>
<li>å¢åŠ è¿æ¥è·Ÿè¸ªç¼“å†²åŒº</li>
</ul>
</li>
<li>
<p><strong>DNS ç¼“å­˜</strong>ï¼š</p>
<ul>
<li>dnsmasq ç¼“å­˜ DNS å“åº”</li>
<li>å‡å°‘ä¸Šæ¸¸ DNS æŸ¥è¯¢</li>
</ul>
</li>
<li>
<p><strong>ç»Ÿè®¡é‡‡æ ·é—´éš”</strong>ï¼š</p>
<ul>
<li>å¹³è¡¡ç²¾åº¦å’Œ CPU å¼€é”€</li>
<li>é»˜è®¤ 500ms</li>
</ul>
</li>
</ol>
<hr/>
<p>è¿™ä¸ªå®Œæ•´çš„åˆ†ææ¶µç›–äº† Android å…±äº«è¿æ¥ç®¡ç†ç³»ç»Ÿçš„å„ä¸ªæ–¹é¢ï¼Œä»ç”¨æˆ·è§¦å‘åˆ°å†…æ ¸è½¬å‘ï¼ŒåŒ…æ‹¬æ‰€æœ‰å…³é”®ç»„ä»¶å’Œæ•°æ®æµã€‚è¿™æ˜¯é¢è¯•æ—¶çš„æ ¸å¿ƒçŸ¥è¯†ä½“ç³»ã€‚</p>
<p>å®Œç¾ï¼æˆ‘å·²ç»å®Œæˆäº†å¯¹ Android å…±äº«è¿æ¥ç®¡ç†ç³»ç»Ÿçš„æ·±åº¦åˆ†æã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸å…¨é¢çš„æ€»ç»“ï¼Œæ¶µç›–äº†ï¼š</p>
<h2 data-id="heading-48">ğŸ“‹ åˆ†æå†…å®¹æ€»è§ˆ</h2>
<p>âœ… <strong>15 ä¸ªé‡ç‚¹ä¸»é¢˜</strong>ï¼š</p>
<ol>
<li><strong>ç³»ç»Ÿæ•´ä½“æ¶æ„</strong> - 4å±‚æ¨¡å‹ï¼ˆåº”ç”¨å±‚ã€Frameworkã€ç³»ç»ŸæœåŠ¡ã€å†…æ ¸å±‚ï¼‰</li>
<li><strong>TetheringManager &amp; TetheringService</strong> - ç”¨æˆ·å…¥å£ API</li>
<li><strong>Tethering ä¸»çŠ¶æ€æœº</strong> - æ ¸å¿ƒçš„æ¥å£ç”Ÿå‘½å‘¨æœŸç®¡ç†</li>
<li><strong>IpServer ä¸‹æ¸¸æ¥å£çŠ¶æ€æœº</strong> - 5ä¸ªçŠ¶æ€ã€è½¬ç§»å›¾ã€çŠ¶æ€å¤„ç†</li>
<li><strong>IPv4 é…ç½®æµç¨‹</strong> - åœ°å€åˆ†é…ã€DHCP å¯åŠ¨ã€å®¢æˆ·ç«¯ç®¡ç†</li>
<li><strong>IPv6 é…ç½®ä¸ RA</strong> - Router Advertisementã€NAT64</li>
<li><strong>ä¸Šæ¸¸ç½‘ç»œé€‰æ‹©</strong> - UpstreamNetworkMonitorã€DUN åè®®ã€ä¼˜å…ˆçº§</li>
<li><strong>NAT ä¸ IP è½¬å‘</strong> - TetherControllerã€iptables è§„åˆ™ã€MASQUERADE</li>
<li><strong>DHCP ä¸ DNS è½¬å‘</strong> - dnsmasq é›†æˆã€åŠ¨æ€é…ç½®ã€DNS æŸ¥è¯¢æµç¨‹</li>
<li><strong>5 ç§ä¸‹æ¸¸ç±»å‹å¤„ç†</strong> - WiFiã€USBã€Bluetoothã€Ethernetã€å„è‡ªç‰¹ç‚¹</li>
<li><strong>BPF å¸è½½åŠ é€Ÿ</strong> - BpfCoordinatorã€å†…æ ¸è½¬å‘ä¼˜åŒ–ã€ç»Ÿè®¡æ”¶é›†</li>
<li><strong>å®Œæ•´æ•°æ®æµ</strong> - å¯ç”¨/ç¦ç”¨çš„å…¨æµç¨‹è¯¦è§£</li>
<li><strong>æ ¸å¿ƒæ•°æ®ç»“æ„</strong> - TetheringRequestã€LinkPropertiesã€TetheredClient</li>
<li><strong>æƒé™ä¸é…é¢</strong> - Binder æƒé™æ¨¡å‹ã€è¿è¥å•†é…é¢ã€DUN ç½‘ç»œ</li>
<li><strong>ç›‘æ§ã€è°ƒè¯•ã€æ€§èƒ½ä¼˜åŒ–</strong> - dumpsysã€æ—¥å¿—ã€å…³é”®ä¼˜åŒ–ç‚¹</li>
</ol>
<h2 data-id="heading-49">ğŸ¯ é€‚ç”¨äºé¢è¯•çš„æ ¸å¿ƒè¦ç‚¹</h2>
<p>è¿™ä»½åˆ†ææ¶µç›–äº†æ‰€æœ‰å¯èƒ½å‡ºç°çš„é¢è¯•é—®é¢˜ï¼š</p>
<ul>
<li><strong>æ¶æ„ç›¸å…³</strong>ï¼šç³»ç»Ÿå¦‚ä½•è®¾è®¡ã€å„å±‚èŒè´£</li>
<li><strong>çŠ¶æ€æœº</strong>ï¼šIpServer çš„ 5 ä¸ªçŠ¶æ€åŠè½¬ç§»</li>
<li><strong>ç½‘ç»œé…ç½®</strong>ï¼šIPv4/IPv6 åœ°å€åˆ†é…ã€DHCP/DNS</li>
<li><strong>æ•°æ®è½¬å‘</strong>ï¼šiptables è§„åˆ™ã€NATã€BPF åŠ é€Ÿ</li>
<li><strong>æ•…éšœå¤„ç†</strong>ï¼šé”™è¯¯ä»£ç ã€å‰ç¼€å†²çªå¤„ç†</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šBPF å¸è½½ã€TCP MSSã€Conntrack</li>
<li><strong>å®ç°ç»†èŠ‚</strong>ï¼šå„ç±»å‹æ¥å£çš„ç‰¹æ®Šå¤„ç†</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[16 ä¸ª AI Agent åä½œä»é›¶å†™å‡º C ç¼–è¯‘å™¨ï¼Œè¿˜èƒ½ç¼–è¯‘ Linux å†…æ ¸â€”â€”Claude 4.6 åšåˆ°äº†]]></title>    <link>https://juejin.cn/post/7603376587653169202</link>    <guid>https://juejin.cn/post/7603376587653169202</guid>    <pubDate>2026-02-07T01:16:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603376587653169202" data-draft-id="7603584155785166898" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="16 ä¸ª AI Agent åä½œä»é›¶å†™å‡º C ç¼–è¯‘å™¨ï¼Œè¿˜èƒ½ç¼–è¯‘ Linux å†…æ ¸â€”â€”Claude 4.6 åšåˆ°äº†"/> <meta itemprop="keywords" content="Agent,Claude,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2026-02-07T01:16:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å­Ÿå¥AIç¼–ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/4212984287073895"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            16 ä¸ª AI Agent åä½œä»é›¶å†™å‡º C ç¼–è¯‘å™¨ï¼Œè¿˜èƒ½ç¼–è¯‘ Linux å†…æ ¸â€”â€”Claude 4.6 åšåˆ°äº†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984287073895/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å­Ÿå¥AIç¼–ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-07T01:16:15.000Z" title="Sat Feb 07 2026 01:16:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å­Ÿå¥ã€‚</p>
<p>16 ä¸ª AIï¼Œ2 å‘¨æ—¶é—´ï¼Œ10 ä¸‡è¡Œä»£ç ï¼Œä»é›¶å†™å‡ºäº†ä¸€ä¸ªèƒ½ç¼–è¯‘ Linux å†…æ ¸çš„ C ç¼–è¯‘å™¨ã€‚</p>
<p>ä¸æ˜¯äººå†™çš„ã€‚æ˜¯ Claude è‡ªå·±å†™çš„ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/477226ae6e714f66a85410714e5c4119~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771031774&amp;x-signature=JauUVTPXxMDzd06zNHvBRuNyGAo%3D" alt="" loading="lazy"/></p>
<hr/>
<p>æ˜¨å¤© Anthropic å‘äº†ä¸€ç¯‡åšå®¢ï¼Œæ ‡é¢˜å¾ˆæœ´ç´ â€”â€”"We tasked Opus 4.6 using agent teams to build a C Compiler"ã€‚</p>
<p>ç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼š<strong>æˆ‘ä»¬è®©ä¸€ç¾¤ Claude è‡ªå·±å»å†™äº†ä¸ª C ç¼–è¯‘å™¨ï¼Œç„¶åæˆ‘ä»¬èµ°å¼€äº†ã€‚</strong></p>
<p>è¯»å®Œè¿™ç¯‡åšå®¢ï¼Œæˆ‘æ•´ä¸ªäººæ˜¯æ‡µçš„ã€‚ä¸æ˜¯å› ä¸º"AI åˆè¿›æ­¥äº†"è¿™ç§ç©ºè¯ï¼Œè€Œæ˜¯å› ä¸ºè¿™ä»¶äº‹èƒŒåçš„å«ä¹‰ï¼Œå¯èƒ½æ¯”å¤§å¤šæ•°äººæƒ³åˆ°çš„è¦æ·±å¾—å¤šã€‚</p>
<h2 data-id="heading-0">01 åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</h2>
<p>Anthropic çš„ç ”ç©¶å‘˜ Nicholas Carlini åšäº†ä¸ªå®éªŒï¼š</p>
<p><strong>16 ä¸ª Claude Opus 4.6 å®ä¾‹ï¼ŒåŒæ—¶å·¥ä½œï¼Œç”¨ Rust ä»é›¶å¼€å§‹å†™ä¸€ä¸ª C ç¼–è¯‘å™¨ã€‚</strong></p>
<p>æ²¡æœ‰äººæ‰‹æŠŠæ‰‹å¸¦ã€‚æ²¡æœ‰äººé€è¡Œ reviewã€‚æ²¡æœ‰æ¶æ„å¸ˆç”»è®¾è®¡å›¾ã€‚</p>
<p>Carlini åªåšäº†ä¸€ä»¶äº‹ï¼šæ­å¥½ Docker å®¹å™¨ã€Git ä»“åº“ã€æµ‹è¯•å¥—ä»¶ï¼Œç„¶åæŒ‰ä¸‹å¯åŠ¨é”®ï¼Œèµ°å¼€äº†ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/672577c3ba974ed2b506d444b95b5002~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771031774&amp;x-signature=E2EiWn24mhPfsNX29hGMif7S4TA%3D" alt="" loading="lazy"/></p>
<p>ä¸¤å‘¨åå›æ¥ï¼Œè¿™äº› AI Agent äº¤å‡ºäº†æˆæœï¼š</p>
<ul>
<li>
<p>ğŸ“¦ <strong>10 ä¸‡è¡Œ Rust ä»£ç </strong></p>
</li>
<li>
<p>âœ… GCC torture test é€šè¿‡ç‡ <strong>99%</strong></p>
</li>
<li>
<p>ğŸ§ èƒ½ç¼–è¯‘ <strong>Linux 6.9 å†…æ ¸</strong>ï¼ˆx86ã€ARMã€RISC-V ä¸‰ä¸ªæ¶æ„ï¼‰</p>
</li>
<li>
<p>ğŸ® èƒ½ç¼–è¯‘ <strong>Doomã€ PostgreSQL ã€Redisã€FFmpegã€ SQLite ã€QEMU</strong></p>
</li>
<li>
<p>ğŸ’° æ€»èŠ±è´¹ï¼š<strong>$20,000</strong>ï¼ˆçº¦ 14 ä¸‡äººæ°‘å¸ï¼‰</p>
</li>
<li>
<p>â±ï¸ æ€»è€—æ—¶ï¼š<strong>2 å‘¨</strong>ï¼Œè¿‘ 2000 ä¸ª Claude Code session</p>
</li>
</ul>
<p>ä¸€ä¸ªåœ¨ Google èŠ±äº†è¿‘åå¹´æ‰æå®šçš„äº‹æƒ…ï¼ˆè®© Clang ç¼–è¯‘ Linux å†…æ ¸ï¼‰ï¼ŒAI ç”¨ä¸¤å‘¨åšåˆ°äº†ã€‚ä¸€ä½ HN ç½‘å‹çš„åŸè¯æ˜¯ï¼š"This LLM did it in ï¼ˆchecks notesï¼‰... 2,000 sessions."</p>
<h2 data-id="heading-1">02 å®ƒä»¬æ˜¯æ€ä¹ˆåä½œçš„ï¼Ÿ</h2>
<p>è¿™æ˜¯æœ€è®©æˆ‘éœ‡æ’¼çš„éƒ¨åˆ†â€”â€”<strong>æ²¡æœ‰"è€æ¿ Agent"ã€‚</strong></p>
<p>16 ä¸ª Claude å„è‡ªç‹¬ç«‹è¿è¡Œåœ¨ Docker å®¹å™¨é‡Œï¼Œå…±äº«ä¸€ä¸ª Git ä»“åº“ã€‚æ¯ä¸ª Agent çš„å·¥ä½œæµç¨‹æ˜¯ï¼š</p>
<ol>
<li>
<p>ä»ä»“åº“æ‹‰ä»£ç </p>
</li>
<li>
<p>è‡ªå·±æ‰¾"ä¸‹ä¸€ä¸ªæœ€æ˜æ˜¾è¦ä¿®çš„é—®é¢˜"</p>
</li>
<li>
<p>åˆ›å»º lock æ–‡ä»¶å å‘</p>
</li>
<li>
<p>å†™ä»£ç ã€è·‘æµ‹è¯•</p>
</li>
<li>
<p>æ¨ä»£ç å›ä¸»å¹²</p>
</li>
<li>
<p>é‡åˆ° merge å†²çªï¼Ÿè‡ªå·±è§£å†³</p>
</li>
</ol>
<p>æœ‰çš„ Agent ä¸“é—¨æ¸…ç†é‡å¤ä»£ç ï¼Œæœ‰çš„ä¸“æ³¨ä¼˜åŒ–æ€§èƒ½ï¼Œæœ‰çš„åƒ Rust ä¸“å®¶ä¸€æ ·åš code reviewï¼Œè¿˜æœ‰çš„è´Ÿè´£æ›´æ–°æ–‡æ¡£ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e34c2d9dc670473bb7fc63fd1255c7f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771031774&amp;x-signature=abYVM0YOEercfaEn6wmJ%2FLiyxNg%3D" alt="" loading="lazy"/></p>
<p><strong>æ²¡æœ‰äººåˆ†é…ä»»åŠ¡ï¼Œæ²¡æœ‰ project manager ï¼Œæ²¡æœ‰ Jiraã€‚</strong></p>
<p>å®ƒä»¬è‡ªå·±å½¢æˆäº†åˆ†å·¥ã€‚</p>
<p>å¦‚æœä½ åšè¿‡å›¢é˜Ÿç®¡ç†ï¼Œä½ åº”è¯¥èƒ½æ„Ÿå—åˆ°è¿™æœ‰å¤šç¦»è°±â€”â€”16 ä¸ª"äºº"åä½œä¸¤å‘¨ï¼Œæ²¡æœ‰ä¸€æ¬¡ standup ä¼šè®®ï¼Œæ²¡æœ‰ä¸€ä¸ªéœ€æ±‚æ–‡æ¡£ï¼Œäº§å‡º 10 ä¸‡è¡Œèƒ½è·‘çš„ä»£ç ã€‚</p>
<h2 data-id="heading-2">03 å®ƒçš„å±€é™åœ¨å“ªï¼Ÿ</h2>
<p>å…ˆåˆ«æ€¥ç€ææ…Œã€‚è¿™ä¸ªç¼–è¯‘å™¨å‰å®³ï¼Œä½†ä¸æ˜¯å®Œç¾çš„ï¼š</p>
<p><strong>1ï¼‰ç”Ÿæˆçš„ä»£ç æ•ˆç‡å¾ˆä½ã€‚</strong> å³ä½¿å¼€äº†æ‰€æœ‰ä¼˜åŒ–ï¼Œè¾“å‡ºçš„æœºå™¨ç è¿˜ä¸å¦‚ GCC å…³æ‰ä¼˜åŒ–çš„æ•ˆæœã€‚æ¢å¥è¯è¯´â€”â€”èƒ½ç”¨ï¼Œä½†æ€§èƒ½æ‹‰èƒ¯ã€‚</p>
<p><strong>2ï¼‰16 ä½ x86 ä¸è¡Œã€‚</strong> Linux å†…æ ¸å¯åŠ¨éœ€è¦ 16 ä½å®æ¨¡å¼ä»£ç ï¼ŒClaude æä¸å®šè¿™å—ï¼Œæœ€å"ä½œå¼Š"è°ƒç”¨äº† GCC æ¥å¤„ç†ã€‚</p>
<p><strong>3ï¼‰æ²¡æœ‰è‡ªå·±çš„ æ±‡ç¼–å™¨ å’Œé“¾æ¥å™¨ã€‚</strong> è¿˜æ˜¯ä¾èµ– GNU çš„å·¥å…·é“¾ã€‚</p>
<p><strong>4ï¼‰ä»£ç è´¨é‡"å¤Ÿç”¨ä½†ä¸ç²¾"ã€‚</strong> Carlini åŸè¯ï¼š"The resulting compiler has nearly reached the limits of Opus's abilitiesã€‚"â€”â€”å·²ç»æ¥è¿‘è¿™ä¸ªæ¨¡å‹èƒ½åŠ›çš„å¤©èŠ±æ¿äº†ã€‚</p>
<p>è¿™äº›å±€é™å¾ˆé‡è¦ï¼Œä½†ä¸å½±å“æ ¸å¿ƒç»“è®ºï¼š<strong>AI å·²ç»èƒ½ç‹¬ç«‹å®Œæˆä¸€ä¸ªæå…¶å¤æ‚çš„ç³»ç»Ÿçº§è½¯ä»¶é¡¹ç›®ã€‚</strong></p>
<h2 data-id="heading-3">04 ä¸ºä»€ä¹ˆè¿™äº‹æ¯”ä½ æƒ³çš„æ›´é‡è¦ï¼Ÿ</h2>
<p>æœ‰äººä¼šè¯´ï¼š"ç¼–è¯‘å™¨è§„èŒƒå¾ˆæˆç†Ÿï¼Œæµ‹è¯•å¥—ä»¶å¾ˆå®Œæ•´ï¼Œè¿™æ˜¯ AI æ“…é•¿çš„ç±»å‹å•Šã€‚"</p>
<p>æ²¡é”™ã€‚Ars Technica çš„æŠ¥é“ä¹ŸæŒ‡å‡ºâ€”â€”C ç¼–è¯‘å™¨æ˜¯"near-ideal task for semi-autonomous AI coding"ï¼Œå› ä¸ºè§„èŒƒæ¸…æ™°ã€æµ‹è¯•å¥—ä»¶ç°æˆã€æœ‰å‚è€ƒå®ç°å¯ä»¥å¯¹ç…§ã€‚</p>
<p>ä½†é—®é¢˜æ˜¯ï¼š<strong>å»å¹´ AI è¿˜åšä¸åˆ°è¿™ä»¶äº‹ã€‚</strong></p>
<p>Carlini è‡ªå·±è¯´äº†ä¸€å¥è®©æˆ‘å°è±¡å¾ˆæ·±çš„è¯ï¼š</p>
<blockquote>
<p>"I did not expect this to be anywhere near possible so early in 2026."</p>
</blockquote>
<p>ä»–æ²¡æœ‰é¢„æ–™åˆ° 2026 å¹´åˆå°±èƒ½èµ°åˆ°è¿™ä¸€æ­¥ã€‚</p>
<p>è¿›æ­¥çš„é€Ÿåº¦æ‰æ˜¯æœ€å€¼å¾—å…³æ³¨çš„ä¿¡å·ã€‚</p>
<p>è€Œä¸”è¿™æ¬¡å®éªŒçœŸæ­£éªŒè¯çš„ä¸æ˜¯"AI èƒ½å†™ä»£ç "â€”â€”è¿™ä¸ªæˆ‘ä»¬æ—©å°±çŸ¥é“äº†ã€‚<strong>å®ƒéªŒè¯çš„æ˜¯ï¼šå¤šä¸ª AI Agent å¯ä»¥åƒä¸€ä¸ªå›¢é˜Ÿä¸€æ ·åä½œï¼Œå®Œæˆéœ€è¦æ¶æ„è®¾è®¡ã€æ¨¡å—åˆ†å·¥ã€å†²çªè§£å†³çš„å¤§å‹å·¥ç¨‹ã€‚</strong></p>
<p>ä¸€ä¸ª Agent å†™å‡½æ•°ï¼Œå¤§å®¶éƒ½è§è¿‡ã€‚16 ä¸ª Agent åä½œå†™ç¼–è¯‘å™¨ï¼Œè¿™æ˜¯è´¨å˜ã€‚</p>
<h2 data-id="heading-4">05 å¯¹æˆ‘ä»¬æ„å‘³ç€ä»€ä¹ˆï¼Ÿ</h2>
<p><strong>å¦‚æœä½ æ˜¯ç¨‹åºå‘˜â€”â€”</strong></p>
<p>è¿™ä¸æ˜¯"AI è¦å–ä»£ä½ "çš„æ•…äº‹ã€‚ç¼–è¯‘å™¨æ˜¯æœ€é€‚åˆ AI åšçš„ä»»åŠ¡ç±»å‹ï¼šè§„èŒƒç¡®å®šã€æµ‹è¯•å®Œå–„ã€æœ‰å‚è€ƒå®ç°ã€‚å¤§éƒ¨åˆ†çœŸå®é¡¹ç›®ä¸å…·å¤‡è¿™äº›æ¡ä»¶ã€‚çœŸå®çš„è½¯ä»¶å¼€å‘éš¾çš„ä¸æ˜¯å†™ä»£ç ï¼Œæ˜¯ææ¸…æ¥šéœ€æ±‚åˆ°åº•æ˜¯ä»€ä¹ˆã€‚</p>
<p>ä½†ä½ åº”è¯¥å¼€å§‹è®¤çœŸå­¦ä¹ å¦‚ä½•<strong>ç®¡ç† AI Agent å›¢é˜Ÿ</strong>äº†ã€‚æœªæ¥çš„ç¼–ç¨‹å¯èƒ½ä¸æ˜¯"ä½ å†™ä»£ç "ï¼Œè€Œæ˜¯"ä½ å®šä¹‰ç›®æ ‡ã€å‡†å¤‡æµ‹è¯•ã€è®© Agent å¹²æ´»ã€ä½ åš review"ã€‚</p>
<p><strong>å¦‚æœä½ æ˜¯åˆ›ä¸šè€…â€”â€”</strong></p>
<p>$20,000 å†™ 10 ä¸‡è¡Œç¼–è¯‘å™¨çº§ä»£ç ã€‚è¿™ä¸ªæˆæœ¬è¿˜åœ¨å¿«é€Ÿä¸‹é™ã€‚æƒ³æƒ³åŠå¹´åã€ä¸€å¹´åä¼šæ˜¯ä»€ä¹ˆä»·æ ¼ã€‚ç‹¬ç«‹å¼€å‘è€…åšå¤æ‚é¡¹ç›®çš„é—¨æ§›æ­£åœ¨è¢«å½»åº•é‡æ–°å®šä¹‰ã€‚</p>
<p><strong>å¦‚æœä½ æ˜¯æŠ€æœ¯ç®¡ç†è€…â€”â€”</strong></p>
<p>å¤š Agent åä½œçš„èŒƒå¼å·²ç»è¢«éªŒè¯äº†ã€‚ä¸æ˜¯ PPT é‡Œçš„æ¦‚å¿µï¼Œæ˜¯èƒ½ç¼–è¯‘ Linux å†…æ ¸çš„çœŸå®äº§å‡ºã€‚ä½ éœ€è¦å¼€å§‹æ€è€ƒï¼šå›¢é˜Ÿé‡Œå“ªäº›å·¥ä½œå¯ä»¥ç”¨ Agent å›¢é˜Ÿæ¥åšï¼Ÿ</p>
<hr/>
<p>Carlini åœ¨åšå®¢ç»“å°¾è¯´äº†ä¸€æ®µå¾ˆçœŸè¯šçš„è¯ã€‚ä»–è¯´è‡ªå·±åšè¿‡æ¸—é€æµ‹è¯•ï¼Œæ·±çŸ¥æ²¡æœ‰äººå·¥éªŒè¯çš„ä»£ç æœ‰å¤šå±é™©ã€‚é¢å¯¹ 10 ä¸‡è¡Œä»æœªäº²çœ¼çœ‹è¿‡çš„ä»£ç ï¼Œä»–æ—¢å…´å¥‹åˆä¸å®‰ã€‚</p>
<p>è¿™å¤§æ¦‚å°±æ˜¯ 2026 å¹´åšæŠ€æœ¯çš„äººå…±åŒçš„å¿ƒæƒ…ã€‚</p>
<p><strong>å…´å¥‹çš„æ˜¯ï¼Œå·¥å…·å°±æ‘†åœ¨é‚£é‡Œï¼Œæ¯”æƒ³è±¡ä¸­å¼ºå¤ªå¤šã€‚ä¸å®‰çš„æ˜¯ï¼Œæˆ‘ä»¬è¿˜ä¸å®Œå…¨çŸ¥é“è¯¥æ€ä¹ˆç”¨å¥½å®ƒã€‚</strong></p>
<p>ä½†æœ‰ä¸€ä»¶äº‹æ˜¯ç¡®å®šçš„â€”â€”AI ç¼–ç¨‹çš„èŒƒå¼å·²ç»ä»"ä¸€ä¸ªäºº+ä¸€ä¸ª Copilot"ï¼Œè¿›åŒ–åˆ°äº†"ä¸€ä¸ªäºº+ä¸€æ”¯ AI å›¢é˜Ÿ"ã€‚</p>
<p>è¿™ä¸æ˜¯æœªæ¥ã€‚è¿™æ˜¯æ­£åœ¨å‘ç”Ÿçš„äº‹æƒ…ã€‚</p>
<hr/>
<p>ğŸ”— <strong>ç›¸å…³é“¾æ¥ï¼š</strong></p>
<ul>
<li>
<p>Anthropic åšå®¢åŸæ–‡ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.anthropic.com%2Fengineering%2Fbuilding-c-compiler" target="_blank" title="https://www.anthropic.com/engineering/building-c-compiler" ref="nofollow noopener noreferrer">www.anthropic.com/engineeringâ€¦</a></p>
</li>
<li>
<p>ç¼–è¯‘å™¨ GitHub æºç ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fclaudes-c-compiler" target="_blank" title="https://github.com/anthropics/claudes-c-compiler" ref="nofollow noopener noreferrer">github.com/anthropics/â€¦</a></p>
</li>
<li>
<p>Hacker News è®¨è®ºï¼ˆ400+è¯„è®ºï¼‰ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fnews.ycombinator.com%2Fitem%3Fid%3D46903616" target="_blank" title="https://news.ycombinator.com/item?id=46903616" ref="nofollow noopener noreferrer">news.ycombinator.com/item?id=469â€¦</a></p>
</li>
</ul>
<hr/>
<p>å¦‚æœè¿™ç¯‡å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµã€æ”¶è—ã€å…³æ³¨ï¼Œä½ çš„æ”¯æŒæ˜¯æˆ‘æŒç»­è¾“å‡ºçš„åŠ¨åŠ› âœ¨</p>
<hr/>
<p>æˆ‘çš„å…¶ä»–å¹³å°è´¦å·å’Œå¼€æºé¡¹ç›®åœ¨ä¸ªäººä¸»é¡µä¸­ï¼Œæ¬¢è¿äº¤æµ ğŸ¤</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>