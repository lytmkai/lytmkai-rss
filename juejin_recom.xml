<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[uTools：一个能让你卸载几十个软件的效率“外挂”]]></title>    <link>https://juejin.cn/post/7604690250364207113</link>    <guid>https://juejin.cn/post/7604690250364207113</guid>    <pubDate>2026-02-10T01:50:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604690250364207113" data-draft-id="7604690250364190729" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="uTools：一个能让你卸载几十个软件的效率“外挂”"/> <meta itemprop="keywords" content="后端,Java,程序员"/> <meta itemprop="datePublished" content="2026-02-10T01:50:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SimonKing"/> <meta itemprop="url" content="https://juejin.cn/user/4001878056904584"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            uTools：一个能让你卸载几十个软件的效率“外挂”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4001878056904584/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SimonKing
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T01:50:53.000Z" title="Tue Feb 10 2026 01:50:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>关注我的公众号：【编程朝花夕拾】，可获取首发内容。</p>
</blockquote>
<h2 data-id="heading-0">01 引言</h2>
<p>你是否厌倦了在无数软件间来回切换？是否希望有一个“万能入口”，能瞬间响应所有临时需求？试试 <code>uTools</code>，它不只是一种工具，更是一种全新的效率哲学。通过一个简单的搜索框和智能面板，它将海量插件融入你的每一次点击和选择，让工具主动为你服务，真正实现“一切皆插件”，打造你独一无二的数字工作流。</p>
<h2 data-id="heading-1">02 简介</h2>
<p><code>uTools</code>可以理解为一个可高度自定义的效率启动器。它本身非常轻巧，但通过安装丰富的插件，就能瞬间变成一个功能强大的全能助手。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d4c9f09b8dd4fb497496412c115dc8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771293053&amp;x-signature=79tAzP5GPxfCTfVRigZg0%2F9h1f8%3D" alt="" loading="lazy"/></p>
<p>其核心操作方式：</p>
<ul>
<li><strong>万能搜索框</strong>：通过快捷键（默认 <code>Alt + Space</code>）快速呼出搜索框，输入关键词即可搜索本地文件、打开软件，或直接使用各种插件工具。</li>
<li><strong>超级面板</strong>：在任意界面，长按鼠标中键（或自定义键）即可唤出一个圆形菜单，里面是常用的工具，方便随时取用。</li>
<li><strong>悬浮球</strong>：一个可以吸附在屏幕边缘的小球，方便快速访问。</li>
</ul>
<p>目前的版本已经更新到<code>v7.5.1</code>了，分别支持 <code>Windows</code>, <code>macOS</code>, <code>Linux</code>三大平台。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c1f4ea9a99f42d0bfdd6bc12431bb71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771293053&amp;x-signature=M2c9fGmPrggn8x6pQClV4cZJmjM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">03 使用</h2>
<p>我们可以在插件市场上随意下载插件。截止目前插件市场已经收录了3109个插件。</p>
<p>通过悬浮球或者快捷键<code>Alt + 空格</code>快速唤起！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8fdcc5dcac24bc6bf58ec64a2198f6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771293053&amp;x-signature=GlglGp5xnqlr8dDjJ8J91%2BiXiQE%3D" alt="" loading="lazy"/></p>
<p>我们简单的介绍几个插件。</p>
<h3 data-id="heading-3">3.1 屏幕取色工具</h3>
<p>什么时候用呢？写页面样式的时候，设计原型里面如果没有给出颜色的值，就需要我们通过取色工具获取。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0d2389bef464a51b260adc58ad5062d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771293053&amp;x-signature=DFC8bkweibNPGZQ6rXLL86PV01M%3D" alt="" loading="lazy"/></p>
<p>类似项目中的这种底色，我们只能取色来解决。</p>
<p>当然正常的设计都有专门的<code>UI</code>设计，会标注的非常详细。但是对于我们的自己的一些项目，样式要求没有那么高的，只能靠我们自己手搓了。</p>
<p>我们需要呼起搜索框，然后搜索自己的取色工具即可。界面会自动展示常用的工具。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/780fcb2a29ba40d5acafcb40b4f53356~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771293053&amp;x-signature=zkpwi2hSvKavtfKmTu8wbluGpKs%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50f2fab6a9444f13b0806d1b17ed79c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771293053&amp;x-signature=%2BxQnhzGf%2BWhbarZy9Rjsn%2BbBU0w%3D" alt="" loading="lazy"/></p>
<p>选择取色工具，点击开始取色。点击即可完成取色</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1d10a0c9d1b42c8820a9f63fd94c203~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771293053&amp;x-signature=15qYmBfyCr78X5YkqTScNpFFIRA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">3.2 Tree</h3>
<p>读取目录结构生成如下所示的树状图文本, 模仿<code>tree</code>方法, 并提供自由定义文件夹结构的功能.</p>
<p>当我们写文章的时候，需展示项目结构的时候，我们只需要给到文件夹即可。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a3831a87ffb48bf91b9073038be8eea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771293053&amp;x-signature=KrtWL0cMRTeNjdn9DPms6anpcGI%3D" alt="" loading="lazy"/></p>
<p>无论是写文章，还是查看目录结构都非常友好。</p>
<h3 data-id="heading-5">3.3 程序员必备</h3>
<p><code>ctool</code>收集了程序员常用的一些工具。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c533980bd7c482391b292b0c5939d48~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771293053&amp;x-signature=gMUrTqygbCTPFA3pEUPaJyxaYyk%3D" alt="" loading="lazy"/></p>
<p>官网地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fctool.dev%2F" target="_blank" title="https://ctool.dev/" ref="nofollow noopener noreferrer">ctool.dev/</a></p>
<h3 data-id="heading-6">3.4 截图悬浮</h3>
<p>截图悬浮用在老师多媒体讲课的比较多，截取图片然后给大家分享内容。普通的截图工具，截完图之后，图片都在剪切板，而截图悬浮则停留在当前页面。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/362284ba9cd542c09c120df83bfccbda~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771293053&amp;x-signature=UV6OIOdU9H40TBmXbg8c2bef3G0%3D" alt="" loading="lazy"/></p>
<p><strong>效果</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c6c96d5018542a28b4568456cdcedb7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771293053&amp;x-signature=aWGemd0gnl5AuELGnTedE8TXnv0%3D" alt="" loading="lazy"/></p>
<p>里面的插件还有很多，大家可以根据自己的喜好随意安装。</p>
<h2 data-id="heading-7">04 小结</h2>
<p><code>uTools</code>以盒子的形式展示给大家，工具以插件的方式给大家使用。真的是方便很多。免费版的仅支持10个插件，但是足够用了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0b8d687f2604d5d9fe94413db84b0e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771293053&amp;x-signature=i4yZmfdUuwl7FR7%2FYfBKZ2JTNuo%3D" alt="" loading="lazy"/></p>
<p>想要免限制的可以使用类似的软件:<code>rubick</code></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5a4c877f79e4b41a26c111721a9ff11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771293053&amp;x-signature=VlxRyi%2BKfUu9%2Fq7Re3REKKz%2BY5U%3D" alt="" loading="lazy"/></p>
<p><code>GitHub</code>地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FrubickCenter%2Frubick" target="_blank" title="https://github.com/rubickCenter/rubick" ref="nofollow noopener noreferrer">github.com/rubickCente…</a></p>
<p>里面的插件有限，整体感觉没有<code>utools</code>顺畅，但是完全开源免费。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入理解Go语言结构体标签：用途、用法与注意事项]]></title>    <link>https://juejin.cn/post/7604574877035216939</link>    <guid>https://juejin.cn/post/7604574877035216939</guid>    <pubDate>2026-02-09T16:18:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604574877035216939" data-draft-id="7604574877035200555" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入理解Go语言结构体标签：用途、用法与注意事项"/> <meta itemprop="keywords" content="后端,Go,面试"/> <meta itemprop="datePublished" content="2026-02-09T16:18:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="我叫黑大帅"/> <meta itemprop="url" content="https://juejin.cn/user/1678295463898875"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入理解Go语言结构体标签：用途、用法与注意事项
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1678295463898875/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    我叫黑大帅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T16:18:41.000Z" title="Mon Feb 09 2026 16:18:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">深入理解Go语言结构体标签：用途、用法与注意事项</h2>
<p>在Go语言中，结构体（struct）是用于封装数据的核心语法，而结构体标签（Struct Tag）则是附着在结构体字段上的“隐形元数据”——它本身不参与程序的逻辑运行，也不会影响字段的取值和赋值，但在运行时可以通过**反射（reflect包）**被读取和解析，进而实现各类自动化功能。</p>
<p>简单来说，结构体标签就像是给结构体的每个字段“贴小纸条”，纸条上写着该字段的额外说明，这些说明只有“具备透视能力”的反射才能看到，而正是这些“小纸条”，支撑起了Go语言中大量主流工具库（如JSON序列化、ORM框架、参数校验库）的核心功能。接下来，我们从本质、语法、核心用途、完整示例、常见误区五个维度，全面拆解结构体标签，让你既能懂原理，也能直接落地使用。</p>
<h3 data-id="heading-1">一、结构体标签的本质与基础语法</h3>
<h4 data-id="heading-2">1. 本质</h4>
<p>结构体标签是<strong>字符串常量</strong>，附着在结构体字段声明的后方，用于存储该字段的元数据（描述性信息）。它不属于结构体字段的一部分，编译期会被保留在二进制文件中，运行时通过反射包的相关方法（如Tag.Get()）读取，进而实现“根据元数据自动处理字段”的逻辑。</p>
<p>核心特点：无侵入性（不修改字段本身的功能）、可扩展性（可自定义标签键值对）、仅能通过反射读取（普通代码无法直接访问）。</p>
<h4 data-id="heading-3">2. 基础语法（必记，避免踩坑）</h4>
<p>结构体标签的语法有严格规范，写错会导致反射无法读取，且编译期不会报错（极易排查），核心规则如下：</p>
<ul>
<li>
<p>标签必须用 <strong>反引号（`）</strong> 包裹（不能用双引号""或单引号''），否则会被解析为普通字符串，而非标签。</p>
</li>
<li>
<p>标签内部采用 <strong>键值对</strong> 格式，格式为：<code>键1:"值1" 键2:"值2" ...</code>（键与值之间用冒号分隔，值用双引号包裹，多个键值对用空格分隔，不能用逗号）。</p>
</li>
<li>
<p>标签的键和值可以自定义（如doc:"用户姓名"），也可以使用主流库约定的键（如json:"username"、gorm:"column:id"）。</p>
</li>
<li>
<p>标签中可以包含空格、引号（需转义）等特殊字符，但建议保持简洁，仅存储必要的元数据。</p>
</li>
</ul>
<h5 data-id="heading-4">正确与错误示例对比</h5>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 正确示例（反引号包裹、键值对格式正确）</span>
<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    Name <span class="hljs-type">string</span> <span class="hljs-string">`json:"username" doc:"用户姓名" validate:"required"`</span>
    Age  <span class="hljs-type">int</span>    <span class="hljs-string">`gorm:"column:user_age;type:int(3)"`</span>
}

<span class="hljs-comment">// 错误示例（常见踩坑点）</span>
<span class="hljs-keyword">type</span> UserWrong <span class="hljs-keyword">struct</span> {
    <span class="hljs-comment">// 错误1：用双引号包裹标签，会被解析为普通字符串</span>
    Name <span class="hljs-type">string</span> <span class="hljs-string">"json:'username'"</span>
    <span class="hljs-comment">// 错误2：多个键值对用逗号分隔，反射无法识别</span>
    Age  <span class="hljs-type">int</span>    <span class="hljs-string">`gorm:"column:user_age",validate:"gte=18"`</span>
    <span class="hljs-comment">// 错误3：值未用双引号包裹，语法不规范</span>
    Sex  <span class="hljs-type">string</span> <span class="hljs-string">`doc:男/女`</span>
}
</code></pre>
<h3 data-id="heading-5">二、结构体标签的4大核心用途（附完整可运行示例）</h3>
<p>结构体标签的核心价值的是“自动化”——通过提前定义标签，让工具库（依赖反射）自动处理字段，减少重复编码。以下是开发中最常用的4个场景，每个场景都搭配完整代码示例，可直接复制运行。</p>
<h4 data-id="heading-6">用途1：JSON序列化/反序列化（最常用场景）</h4>
<p>Go语言标准库encoding/json，就是通过读取结构体标签中的json键，来实现结构体与JSON字符串的转换，核心作用是：自定义JSON的键名、控制字段是否序列化、处理空值等。</p>
<h5 data-id="heading-7">常见json标签参数</h5>
<ul>
<li>
<p>json:"username"：指定JSON中的键名为username（替换结构体字段原名Name）。</p>
</li>
<li>
<p>json:"-"：指定该字段不参与JSON序列化/反序列化（无论字段有值与否，都不会出现在JSON中）。</p>
</li>
<li>
<p>json:"age,omitempty"：如果字段值为空（如int为0、string为空串、slice为空），则不显示该字段。</p>
</li>
<li>
<p>json:"sex,string"：将字段值转换为字符串类型后再序列化（如int类型的1，会变成"1"）。</p>
</li>
</ul>
<h5 data-id="heading-8">完整示例代码</h5>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"encoding/json"</span>
    <span class="hljs-string">"fmt"</span>
)

<span class="hljs-comment">// 定义带有json标签的结构体</span>
<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    Name     <span class="hljs-type">string</span> <span class="hljs-string">`json:"username"`</span>       <span class="hljs-comment">// 自定义JSON键名</span>
    Age      <span class="hljs-type">int</span>    <span class="hljs-string">`json:"age,omitempty"`</span>  <span class="hljs-comment">// 空值不显示</span>
    Password <span class="hljs-type">string</span> <span class="hljs-string">`json:"-"`</span>              <span class="hljs-comment">// 不参与JSON序列化</span>
    Sex      <span class="hljs-type">int</span>    <span class="hljs-string">`json:"sex,string"`</span>     <span class="hljs-comment">// 转换为字符串序列化</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 结构体转JSON（序列化）</span>
    user := User{
        Name:     <span class="hljs-string">"张三"</span>,
        Age:      <span class="hljs-number">0</span>,      <span class="hljs-comment">// 空值，会被omitempty忽略</span>
        Password: <span class="hljs-string">"123456"</span>,<span class="hljs-comment">// 会被json:"-"忽略</span>
        Sex:      <span class="hljs-number">1</span>,
    }
    jsonStr, err := json.Marshal(user)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Println(<span class="hljs-string">"JSON序列化失败："</span>, err)
        <span class="hljs-keyword">return</span>
    }
    fmt.Println(<span class="hljs-string">"序列化结果："</span>, <span class="hljs-type">string</span>(jsonStr)) <span class="hljs-comment">// 输出：{"username":"张三","sex":"1"}</span>

    <span class="hljs-comment">// 2. JSON转结构体（反序列化）</span>
    jsonStr2 := <span class="hljs-string">`{"username":"李四","age":20,"sex":"0"}`</span>
    <span class="hljs-keyword">var</span> user2 User
    err = json.Unmarshal([]<span class="hljs-type">byte</span>(jsonStr2), &amp;user2)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Println(<span class="hljs-string">"JSON反序列化失败："</span>, err)
        <span class="hljs-keyword">return</span>
    }
    fmt.Println(<span class="hljs-string">"反序列化结果："</span>, user2) <span class="hljs-comment">// 输出：{李四 20  0}</span>
}
</code></pre>
<h4 data-id="heading-9">用途2：数据库ORM映射（GORM/XORM核心用法）</h4>
<p>在Go语言开发中，ORM框架（如GORM）是操作数据库的主流方式，而ORM框架正是通过结构体标签，将结构体字段与数据库表的列进行映射，无需手动编写SQL语句，实现“面向对象”的数据库操作。</p>
<p>以最流行的GORM框架为例，常见的gorm标签参数如下（仅列举高频）：</p>
<h5 data-id="heading-10">常见gorm标签参数</h5>
<ul>
<li>
<p>gorm:"column:user_id"：指定数据库表的列名为user_id（替换结构体字段原名ID）。</p>
</li>
<li>
<p>gorm:"primaryKey"：指定该字段为主键（对应数据库的PRIMARY KEY）。</p>
</li>
<li>
<p>gorm:"autoIncrement"：指定该字段为自增列（仅适用于int类型主键）。</p>
</li>
<li>
<p>gorm:"type:varchar(50)"：指定数据库列的类型（如varchar(50)、int(11)）。</p>
</li>
<li>
<p>gorm:"not null"：指定该列不能为空（对应数据库的NOT NULL）。</p>
</li>
<li>
<p>gorm:"default:0"：指定该列的默认值（对应数据库的DEFAULT）。</p>
</li>
<li>
<p>gorm:"comment:用户姓名"：给数据库列添加注释（方便后期维护）。</p>
</li>
</ul>
<h5 data-id="heading-11">完整示例代码（GORM）</h5>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"gorm.io/driver/mysql"</span>
    <span class="hljs-string">"gorm.io/gorm"</span>
    <span class="hljs-string">"fmt"</span>
)

<span class="hljs-comment">// 定义带有gorm标签的结构体（对应数据库表users）</span>
<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    ID       <span class="hljs-type">int</span>    <span class="hljs-string">`gorm:"column:user_id;primaryKey;autoIncrement"`</span> <span class="hljs-comment">// 主键自增</span>
    Name     <span class="hljs-type">string</span> <span class="hljs-string">`gorm:"column:user_name;type:varchar(50);not null;comment:用户姓名"`</span>
    Age      <span class="hljs-type">int</span>    <span class="hljs-string">`gorm:"column:user_age;type:int(3);default:0;comment:用户年龄"`</span>
    Email    <span class="hljs-type">string</span> <span class="hljs-string">`gorm:"column:user_email;type:varchar(100);unique;comment:用户邮箱（唯一）"`</span>
    Password <span class="hljs-type">string</span> <span class="hljs-string">`gorm:"column:user_password;type:varchar(100);not null;comment:用户密码"`</span>
}

<span class="hljs-comment">// 自定义表名（可选，默认表名为结构体复数形式users）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u User)</span></span> TableName() <span class="hljs-type">string</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"users"</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 连接数据库（替换为自己的数据库信息）</span>
    dsn := <span class="hljs-string">"root:123456@tcp(127.0.0.1:3306)/test?charset=utf8mb4&amp;parseTime=True&amp;loc=Local"</span>
    db, err := gorm.Open(mysql.Open(dsn), &amp;gorm.Config{})
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-built_in">panic</span>(<span class="hljs-string">"数据库连接失败："</span> + err.Error())
    }

    <span class="hljs-comment">// 2. 根据结构体创建表（自动根据gorm标签生成列属性）</span>
    err = db.AutoMigrate(&amp;User{})
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-built_in">panic</span>(<span class="hljs-string">"创建表失败："</span> + err.Error())
    }
    fmt.Println(<span class="hljs-string">"表创建成功（若不存在）"</span>)

    <span class="hljs-comment">// 3. 插入数据（ORM自动映射结构体字段与数据库列）</span>
    user := User{
        Name:     <span class="hljs-string">"张三"</span>,
        Age:      <span class="hljs-number">25</span>,
        Email:    <span class="hljs-string">"zhangsan@163.com"</span>,
        Password: <span class="hljs-string">"123456"</span>,
    }
    db.Create(&amp;user)
    fmt.Println(<span class="hljs-string">"插入数据成功，用户ID："</span>, user.ID)
}
</code></pre>
<h4 data-id="heading-12">用途3：参数校验（validator库必备）</h4>
<p>在接口开发中，我们经常需要校验请求参数（如用户注册时的邮箱格式、密码长度、年龄范围等），如果手动编写大量if-else判断，会导致代码冗余、难以维护。此时，通过结构体标签配合validator库，就能实现参数的自动校验。</p>
<p>validator库是Go语言中最流行的参数校验库，支持通过标签定义校验规则，自动校验结构体字段的值是否符合要求。</p>
<h5 data-id="heading-13">常见validate标签参数（高频）</h5>
<ul>
<li>
<p>validate:"required"：字段必填（不能为默认空值，如string为空串、int为0）。</p>
</li>
<li>
<p>validate:"email"：字段值必须是合法的邮箱格式（如<a href="https://link.juejin.cn?target=mailto%3Axxx%40xxx.com" target="_blank" title="mailto:xxx@xxx.com" ref="nofollow noopener noreferrer">xxx@xxx.com</a>）。</p>
</li>
<li>
<p>validate:"gte=18,lte=120"：字段值必须大于等于18、小于等于120（仅适用于数值类型）。</p>
</li>
<li>
<p>validate:"len=6"：字段值的长度必须等于6（适用于string、slice等）。</p>
</li>
<li>
<p>validate:"min=6,max=20"：字段值的长度必须在6-20之间（适用于string、slice等）。</p>
</li>
<li>
<p>validate:"oneof=male female"：字段值必须是指定选项中的一个（如只能是male或female）。</p>
</li>
</ul>
<h5 data-id="heading-14">完整示例代码（validator）</h5>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"github.com/go-playground/validator/v10"</span>
)

<span class="hljs-comment">// 定义带有validate标签的请求结构体</span>
<span class="hljs-keyword">type</span> RegisterRequest <span class="hljs-keyword">struct</span> {
    Username <span class="hljs-type">string</span> <span class="hljs-string">`json:"username" validate:"required,min=6,max=20"`</span> <span class="hljs-comment">// 必填，长度6-20</span>
    Email    <span class="hljs-type">string</span> <span class="hljs-string">`json:"email" validate:"required,email"`</span>          <span class="hljs-comment">// 必填，合法邮箱</span>
    Age      <span class="hljs-type">int</span>    <span class="hljs-string">`json:"age" validate:"required,gte=18,lte=120"`</span>   <span class="hljs-comment">// 必填，年龄18-120</span>
    Password <span class="hljs-type">string</span> <span class="hljs-string">`json:"password" validate:"required,len=6"`</span>       <span class="hljs-comment">// 必填，长度6</span>
    Sex      <span class="hljs-type">string</span> <span class="hljs-string">`json:"sex" validate:"required,oneof=male female"`</span><span class="hljs-comment">// 必填，只能是male/female</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 初始化校验器</span>
    validate := validator.New()

    <span class="hljs-comment">// 2. 模拟请求参数（不符合校验规则的示例）</span>
    req := RegisterRequest{
        Username: <span class="hljs-string">"zhangsan"</span>, <span class="hljs-comment">// 长度8，符合要求</span>
        Email:    <span class="hljs-string">"zhangsan163.com"</span>, <span class="hljs-comment">// 不合法邮箱（缺少@）</span>
        Age:      <span class="hljs-number">17</span>,         <span class="hljs-comment">// 年龄17，不符合gte=18</span>
        Password: <span class="hljs-string">"12345"</span>,    <span class="hljs-comment">// 长度5，不符合len=6</span>
        Sex:      <span class="hljs-string">"man"</span>,      <span class="hljs-comment">// 不是指定选项（male/female）</span>
    }

    <span class="hljs-comment">// 3. 执行校验</span>
    err := validate.Struct(req)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-comment">// 4. 输出校验失败信息</span>
        <span class="hljs-keyword">for</span> _, err := <span class="hljs-keyword">range</span> err.(validator.ValidationErrors) {
            fmt.Printf(<span class="hljs-string">"参数校验失败：%s（字段：%s，要求：%s）\n"</span>, 
                err.Error(), err.Field(), err.Tag())
        }
        <span class="hljs-keyword">return</span>
    }

    fmt.Println(<span class="hljs-string">"参数校验通过，可以执行注册逻辑"</span>)
}
</code></pre>
<h4 data-id="heading-15">用途4：文档/表单自动生成（接口开发必备）</h4>
<p>在接口开发中，我们需要编写接口文档（如Swagger），或者实现表单参数与结构体的自动绑定，此时结构体标签就能发挥作用——通过自定义标签（如doc、form），存储字段的说明信息、表单键名，再配合工具库自动生成文档或绑定参数。</p>
<p>这正是你之前语雀链接中展示的用法（用doc标签存储字段说明），我们扩展为“文档+表单绑定”的完整示例。</p>
<h5 data-id="heading-16">常见标签（自定义+主流约定）</h5>
<ul>
<li>
<p>doc:"用户姓名"：存储字段的说明信息，用于自动生成接口文档。</p>
</li>
<li>
<p>form:"user_name"：指定表单提交时的参数名，用于表单参数与结构体的自动绑定（如gin框架）。</p>
</li>
<li>
<p>swagger:"true"：标记该字段需要显示在Swagger文档中（配合swaggo库）。</p>
</li>
</ul>
<h5 data-id="heading-17">完整示例代码（gin框架表单绑定+文档说明）</h5>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"github.com/gin-gonic/gin"</span>
    <span class="hljs-string">"net/http"</span>
)

<span class="hljs-comment">// 定义带有form和doc标签的结构体（用于表单提交）</span>
<span class="hljs-keyword">type</span> LoginForm <span class="hljs-keyword">struct</span> {
    Username <span class="hljs-type">string</span> <span class="hljs-string">`form:"user_name" doc:"登录用户名，长度6-20位" validate:"required,min=6,max=20"`</span>
    Password <span class="hljs-type">string</span> <span class="hljs-string">`form:"user_password" doc:"登录密码，长度6位" validate:"required,len=6"`</span>
    Remember <span class="hljs-type">bool</span>   <span class="hljs-string">`form:"remember_me" doc:"是否记住登录状态，默认false"`</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 初始化gin引擎</span>
    r := gin.Default()

    <span class="hljs-comment">// 定义登录接口（表单提交）</span>
    r.POST(<span class="hljs-string">"/login"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> {
        <span class="hljs-keyword">var</span> form LoginForm
        <span class="hljs-comment">// 自动绑定表单参数（根据form标签匹配）</span>
        <span class="hljs-keyword">if</span> err := c.ShouldBindForm(&amp;form); err != <span class="hljs-literal">nil</span> {
            c.JSON(http.StatusBadRequest, gin.H{
                <span class="hljs-string">"code"</span>: <span class="hljs-number">400</span>,
                <span class="hljs-string">"msg"</span>:  <span class="hljs-string">"表单参数错误"</span>,
                <span class="hljs-string">"err"</span>:  err.Error(),
            })
            <span class="hljs-keyword">return</span>
        }

        <span class="hljs-comment">// 这里可以添加参数校验、登录逻辑（省略）</span>
        c.JSON(http.StatusOK, gin.H{
            <span class="hljs-string">"code"</span>: <span class="hljs-number">200</span>,
            <span class="hljs-string">"msg"</span>:  <span class="hljs-string">"登录成功"</span>,
            <span class="hljs-string">"data"</span>: form,
        })
    })

    <span class="hljs-comment">// 启动服务</span>
    r.Run(<span class="hljs-string">":8080"</span>)
    <span class="hljs-comment">// 测试：访问http://localhost:8080/login，提交表单参数user_name、user_password、remember_me</span>
    <span class="hljs-comment">// 文档生成：配合swaggo库，可自动读取doc标签，生成接口文档</span>
}
</code></pre>
<h3 data-id="heading-18">三、反射读取结构体标签（核心原理，必懂）</h3>
<p>前面所有用途，核心都是“反射读取标签”——结构体标签本身没有任何作用，只有通过reflect包读取并解析它，才能实现自动化逻辑。我们结合你之前语雀链接中的代码，拆解反射读取标签的完整流程。</p>
<h4 data-id="heading-19">反射读取标签的3个核心步骤</h4>
<ol>
<li>
<p>通过reflect.TypeOf()获取接口变量的反射类型（Type）。</p>
</li>
<li>
<p>如果传入的是结构体指针，需通过Elem()方法获取指针指向的实际结构体类型。</p>
</li>
<li>
<p>通过Field(i).Tag.Get("键名")，读取指定字段的标签值（i为字段索引，从0开始）。</p>
</li>
</ol>
<h4 data-id="heading-20">完整示例代码（反射读取标签）</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"reflect"</span>
)

<span class="hljs-comment">// 定义带有多个标签的结构体（模拟语雀链接中的场景）</span>
<span class="hljs-keyword">type</span> Resume <span class="hljs-keyword">struct</span> {
    Name  <span class="hljs-type">string</span> <span class="hljs-string">`json:"name" doc:"我的名字"`</span>
    Age   <span class="hljs-type">int</span>    <span class="hljs-string">`json:"age" doc:"我的年龄"`</span>
    Email <span class="hljs-type">string</span> <span class="hljs-string">`json:"email" doc:"我的邮箱" validate:"required,email"`</span>
}

<span class="hljs-comment">// findDoc：通过反射读取结构体的doc标签，返回json标签与doc标签的映射</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">findDoc</span><span class="hljs-params">(stru <span class="hljs-keyword">interface</span>{})</span></span> <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span> {
    <span class="hljs-comment">// 1. 获取反射类型（Type），判断是否为指针</span>
    t := reflect.TypeOf(stru)
    <span class="hljs-keyword">if</span> t.Kind() != reflect.Ptr {
        fmt.Println(<span class="hljs-string">"错误：传入的必须是结构体指针"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    }

    <span class="hljs-comment">// 2. 获取指针指向的实际结构体类型</span>
    t = t.Elem()
    <span class="hljs-keyword">if</span> t.Kind() != reflect.Struct {
        fmt.Println(<span class="hljs-string">"错误：传入的指针必须指向结构体"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    }

    <span class="hljs-comment">// 3. 遍历结构体的所有字段，读取标签</span>
    docMap := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>)
    <span class="hljs-comment">// 获取结构体字段数量</span>
    fieldCount := t.NumField()
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; fieldCount; i++ {
        <span class="hljs-comment">// 获取第i个字段</span>
        field := t.Field(i)
        <span class="hljs-comment">// 读取json标签的值（作为map的键）</span>
        jsonKey := field.Tag.Get(<span class="hljs-string">"json"</span>)
        <span class="hljs-comment">// 读取doc标签的值（作为map的值）</span>
        docValue := field.Tag.Get(<span class="hljs-string">"doc"</span>)
        <span class="hljs-comment">// 存入map（跳过json标签为空的字段）</span>
        <span class="hljs-keyword">if</span> jsonKey != <span class="hljs-string">""</span> {
            docMap[jsonKey] = docValue
        }
    }
    <span class="hljs-keyword">return</span> docMap
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 创建结构体实例</span>
    resume := Resume{
        Name:  <span class="hljs-string">"张三"</span>,
        Age:   <span class="hljs-number">25</span>,
        Email: <span class="hljs-string">"zhangsan@163.com"</span>,
    }

    <span class="hljs-comment">// 传入结构体指针，读取doc标签</span>
    docMap := findDoc(&amp;resume)
    fmt.Println(<span class="hljs-string">"json标签与doc标签的映射："</span>, docMap)
    <span class="hljs-comment">// 输出：map[age:我的年龄 email:我的邮箱 name:我的名字]</span>

    <span class="hljs-comment">// 读取指定json标签对应的doc说明</span>
    fmt.Println(<span class="hljs-string">"name对应的说明："</span>, docMap[<span class="hljs-string">"name"</span>]) <span class="hljs-comment">// 输出：我的名字</span>
}
</code></pre>
<h3 data-id="heading-21">四、结构体标签的常见误区（避坑重点）</h3>
<p>结构体标签的语法简单，但容易踩坑，且坑点多为“编译期不报错、运行时出问题”，以下是4个最常见的误区，一定要牢记：</p>
<h4 data-id="heading-22">误区1：用双引号/单引号包裹标签</h4>
<p>标签必须用反引号（`）包裹，用双引号或单引号会被解析为普通字符串，反射无法读取。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 错误</span>
<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    Name <span class="hljs-type">string</span> <span class="hljs-string">"json:'username'"</span> <span class="hljs-comment">// 双引号包裹，反射读不到</span>
}

<span class="hljs-comment">// 正确</span>
<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    Name <span class="hljs-type">string</span> <span class="hljs-string">`json:"username"`</span> <span class="hljs-comment">// 反引号包裹</span>
}
</code></pre>
<h4 data-id="heading-23">误区2：多个标签键值对用逗号分隔</h4>
<p>多个标签键值对必须用<strong>空格</strong>分隔，用逗号分隔会导致反射无法识别多个键值对，只能读取到第一个。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 错误</span>
<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    Name <span class="hljs-type">string</span> <span class="hljs-string">`json:"username",doc:"用户姓名"`</span> <span class="hljs-comment">// 逗号分隔，错误</span>
}

<span class="hljs-comment">// 正确</span>
<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    Name <span class="hljs-type">string</span> <span class="hljs-string">`json:"username" doc:"用户姓名"`</span> <span class="hljs-comment">// 空格分隔，正确</span>
}
</code></pre>
<h4 data-id="heading-24">误区3：标签值未用双引号包裹</h4>
<p>标签的键值对中，值必须用双引号包裹，否则语法不规范，反射读取时会返回空字符串。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 错误</span>
<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    Name <span class="hljs-type">string</span> <span class="hljs-string">`json:username`</span> <span class="hljs-comment">// 值未用双引号，错误</span>
}

<span class="hljs-comment">// 正确</span>
<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    Name <span class="hljs-type">string</span> <span class="hljs-string">`json:"username"`</span> <span class="hljs-comment">// 值用双引号，正确</span>
}
</code></pre>
<h4 data-id="heading-25">误区4：传入非指针类型给反射函数</h4>
<p>反射读取结构体标签时，如果传入的是结构体值（而非指针），虽然能读取到标签，但如果后续需要修改结构体字段的值（结合反射Set()方法），会报错；同时，传入非指针类型，无法处理“nil”的情况，建议统一传入结构体指针。</p>
<h3 data-id="heading-26">五、总结</h3>
<p>结构体标签是Go语言中“元数据”的核心实现方式，它本身不参与业务逻辑，但通过反射，能让工具库实现自动化功能，极大地减少重复编码，提升开发效率。</p>
<p>核心要点回顾：</p>
<ol>
<li>
<p>本质：附着在结构体字段上的字符串常量，仅能通过反射读取。</p>
</li>
<li>
<p>核心用途：JSON序列化、ORM映射、参数校验、文档/表单生成（四大场景覆盖80%+开发需求）。</p>
</li>
<li>
<p>语法规范：反引号包裹、键值对格式、多个标签用空格分隔（必记，避坑关键）。</p>
</li>
<li>
<p>注意事项：避免常见语法误区，反射读取时建议传入结构体指针。</p>
</li>
</ol>
<p>一句话总结：结构体标签是“给工具库看的字段说明”，有了它，才有了Go语言中各类高效的工具库，让我们摆脱重复的手动编码，专注于核心业务逻辑。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入理解Go语言的核心：Type-Value Pair（类型-值对）]]></title>    <link>https://juejin.cn/post/7604693038438973446</link>    <guid>https://juejin.cn/post/7604693038438973446</guid>    <pubDate>2026-02-09T16:20:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604693038438973446" data-draft-id="7604693038438957062" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入理解Go语言的核心：Type-Value Pair（类型-值对）"/> <meta itemprop="keywords" content="后端,面试,Go"/> <meta itemprop="datePublished" content="2026-02-09T16:20:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="我叫黑大帅"/> <meta itemprop="url" content="https://juejin.cn/user/1678295463898875"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入理解Go语言的核心：Type-Value Pair（类型-值对）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1678295463898875/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    我叫黑大帅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T16:20:27.000Z" title="Mon Feb 09 2026 16:20:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">深入理解Go语言的核心：Type-Value Pair（类型-值对）</h2>
<p>作为Go语言开发者，你是否在学习<strong>接口</strong>、<strong>反射</strong>时感到困惑？比如：为什么空接口<code>interface{}</code>能接收任意类型的值？为什么类型断言有时会失败？为什么反射能“看透”变量的本质？</p>
<p>这些问题的核心答案，都指向Go语言中变量的底层本质——<strong>Type-Value Pair（类型-值对）</strong>，我更习惯称它为“Pair”。理解Pair，是打通Go语言接口、反射任督二脉的关键。</p>
<h3 data-id="heading-1">一、什么是Type-Value Pair？</h3>
<p>在Go语言中，<strong>任何变量都不是孤立的“值”，而是由“类型”和“值”组成的二元组（Pair）</strong>。这个Pair包含两个核心维度：</p>

























<table><thead><tr><th>维度</th><th>说明</th><th>适用场景</th></tr></thead><tbody><tr><td>Static Type（静态类型）</td><td>变量声明时显式指定的类型（如int、string、自定义结构体、接口），编译期确定</td><td>所有变量</td></tr><tr><td>Concrete Type（具体类型）</td><td>接口类型变量实际指向的底层类型（运行时确定），普通类型的Concrete Type等于Static Type</td><td>仅接口类型变量</td></tr><tr><td>Value（值）</td><td>变量存储的具体数据（如10、"hello"、结构体实例）</td><td>所有变量</td></tr></tbody></table>
<ul>
<li>
<p>对于普通类型变量（如<code>int</code>、<code>string</code>），Pair = <code>Static Type + Value</code>；</p>
</li>
<li>
<p>对于接口类型变量（如<code>interface{}</code>、<code>io.Reader</code>），Pair = <code>Static Type(接口) + Concrete Type(底层类型) + Value</code>。</p>
</li>
</ul>
<p>举个最基础的例子：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 普通变量：Static Type=int，Value=10</span>
<span class="hljs-keyword">var</span> a <span class="hljs-type">int</span> = <span class="hljs-number">10</span>
<span class="hljs-comment">// 普通变量：Static Type=string，Value="Go Pair"</span>
<span class="hljs-keyword">var</span> b <span class="hljs-type">string</span> = <span class="hljs-string">"Go Pair"</span>
</code></pre>
<p>此时<code>a</code>的Pair是<code>(int, 10)</code>，<code>b</code>的Pair是<code>(string, "Go Pair")</code>——这是最直观的Pair形态。</p>
<h3 data-id="heading-2">二、Pair的核心特性：不变性与传递性</h3>
<p>Pair最关键的特性是：<strong>变量在赋值、传递过程中，其底层的Type-Value Pair不会被改变</strong>。哪怕将变量赋值给接口类型，Pair依然保持原样，这是理解接口的核心。</p>
<h4 data-id="heading-3">示例1：普通变量赋值给空接口</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 普通变量：Pair=(int, 20)</span>
    <span class="hljs-keyword">var</span> num <span class="hljs-type">int</span> = <span class="hljs-number">20</span>
    <span class="hljs-comment">// 空接口变量：Static Type=interface{}，Concrete Type=int，Value=20</span>
    <span class="hljs-keyword">var</span> emptyIface <span class="hljs-keyword">interface</span>{} = num

    <span class="hljs-comment">// 类型断言：从空接口中提取Concrete Type=int的Value</span>
    <span class="hljs-keyword">if</span> v, ok := emptyIface.(<span class="hljs-type">int</span>); ok {
        fmt.Printf(<span class="hljs-string">"类型：%T，值：%d\n"</span>, v, v) <span class="hljs-comment">// 输出：类型：int，值：20</span>
    }
}
</code></pre>
<p>在这个例子中：</p>
<ul>
<li>
<p><code>num</code>的Pair是<code>(int, 20)</code>；</p>
</li>
<li>
<p>当把<code>num</code>赋值给<code>emptyIface</code>时，<code>emptyIface</code>的Pair并没有变成<code>(interface{}, 20)</code>，而是<strong>保留了原变量的Concrete Type和Value</strong>，仅Static Type变为<code>interface{}</code>；</p>
</li>
<li>
<p>类型断言的本质，就是检查接口变量的Concrete Type是否匹配，并提取对应的Value。</p>
</li>
</ul>
<h4 data-id="heading-4">示例2：接口嵌套与Pair的一致性</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// 定义两个接口</span>
<span class="hljs-keyword">type</span> Reader <span class="hljs-keyword">interface</span> {
    Read() <span class="hljs-type">string</span>
}

<span class="hljs-keyword">type</span> Writer <span class="hljs-keyword">interface</span> {
    Write() <span class="hljs-type">string</span>
}

<span class="hljs-comment">// 定义结构体，实现两个接口</span>
<span class="hljs-keyword">type</span> Book <span class="hljs-keyword">struct</span> {
    Name <span class="hljs-type">string</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(b Book)</span></span> Read() <span class="hljs-type">string</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"阅读："</span> + b.Name
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(b Book)</span></span> Write() <span class="hljs-type">string</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"记录："</span> + b.Name
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 结构体实例：Pair=(Book, Book{Name:"Go实战"})</span>
    book := Book{Name: <span class="hljs-string">"Go实战"</span>}
    
    <span class="hljs-comment">// 赋值给Reader接口：Pair=(Reader, Book, Book{Name:"Go实战"})</span>
    <span class="hljs-keyword">var</span> r Reader = book
    <span class="hljs-comment">// 赋值给Writer接口：Pair=(Writer, Book, Book{Name:"Go实战"})</span>
    <span class="hljs-keyword">var</span> w Writer = book

    <span class="hljs-comment">// 类型断言：Reader -&gt; Book（成功，因为Concrete Type是Book）</span>
    <span class="hljs-keyword">if</span> b, ok := r.(Book); ok {
        fmt.Println(b.Read()) <span class="hljs-comment">// 输出：阅读：Go实战</span>
    }

    <span class="hljs-comment">// 类型断言：Writer -&gt; Reader（成功，因为底层Concrete Type都是Book）</span>
    <span class="hljs-keyword">if</span> r2, ok := w.(Reader); ok {
        fmt.Println(r2.Read()) <span class="hljs-comment">// 输出：阅读：Go实战</span>
    }
}
</code></pre>
<p>这个例子验证了：只要接口变量的Concrete Type相同，即使Static Type（接口类型）不同，也能通过类型断言转换——核心原因就是<strong>Pair中的Concrete Type和Value始终未变</strong>。</p>
<h3 data-id="heading-5">三、Pair是反射的“底层逻辑”</h3>
<p>Go语言的反射（<code>reflect</code>包）之所以能“动态获取变量类型和值”，本质是因为反射直接操作变量的Pair：</p>
<ul>
<li>
<p><code>reflect.TypeOf(x)</code>：获取变量<code>x</code>的Concrete Type；</p>
</li>
<li>
<p><code>reflect.ValueOf(x)</code>：获取变量<code>x</code>的Value；</p>
</li>
<li>
<p>反射修改变量值的前提，是获取到变量的“可设置”Value（即指向原变量的指针）。</p>
</li>
</ul>
<p>示例：用反射读取Pair的Type和Value</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"reflect"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> str = <span class="hljs-string">"Hello Pair"</span>
    <span class="hljs-comment">// 获取Type</span>
    t := reflect.TypeOf(str)
    <span class="hljs-comment">// 获取Value</span>
    v := reflect.ValueOf(str)

    fmt.Printf(<span class="hljs-string">"Type：%s，Kind：%s，Value：%v\n"</span>, t.Name(), t.Kind(), v)
    <span class="hljs-comment">// 输出：Type：string，Kind：string，Value：Hello Pair</span>

    <span class="hljs-comment">// 空接口的反射</span>
    <span class="hljs-keyword">var</span> iface <span class="hljs-keyword">interface</span>{} = str
    t2 := reflect.TypeOf(iface)
    v2 := reflect.ValueOf(iface)
    fmt.Printf(<span class="hljs-string">"接口Type：%s，接口Value：%v\n"</span>, t2.Name(), v2)
    <span class="hljs-comment">// 输出：接口Type：string，接口Value：Hello Pair</span>
}
</code></pre>
<p>可以看到，即使变量被包装进空接口，反射依然能精准获取到原变量的Concrete Type和Value——这正是Pair的“功劳”。</p>
<h3 data-id="heading-6">四、理解Pair的实际意义</h3>
<ol>
<li>
<p><strong>避免接口使用的坑</strong>：很多新手认为“空接口能存任意类型，所以可以随意转换”，但实际上如果Concrete Type不匹配，类型断言会失败。比如将<code>int</code>类型赋值给空接口后，断言为<code>string</code>会直接报错，本质是Pair的Concrete Type不匹配。</p>
</li>
<li>
<p><strong>正确使用反射</strong>：反射的所有操作都围绕Pair展开，比如修改变量值时，必须确保<code>reflect.Value</code>是“可设置的”（即指向原变量的指针），否则会触发panic——这是因为反射修改的是Pair的Value，而非副本。</p>
</li>
<li>
<p><strong>理解接口的“多态”</strong>：Go语言的接口多态，本质是不同类型的变量（不同Pair）赋值给同一接口类型变量时，只要Concrete Type实现了接口的方法，就能被接口“兼容”——核心还是Pair的Concrete Type在起作用。</p>
</li>
</ol>
<h3 data-id="heading-7">总结</h3>
<p>Type-Value Pair是Go语言变量的底层本质，它决定了：</p>
<ol>
<li>
<p>变量的类型和值是不可分割的整体，传递过程中Pair保持不变；</p>
</li>
<li>
<p>接口的核心是“包裹”底层变量的Concrete Type和Value；</p>
</li>
<li>
<p>反射的本质是对变量Pair的直接操作。</p>
</li>
</ol>
<p>理解Pair，你就能彻底搞懂Go语言的接口、反射机制，避开新手常见的坑，写出更符合Go语言设计哲学的代码。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[IDEA连接MySQL数据库错误]]></title>    <link>https://juejin.cn/post/7604574877034823723</link>    <guid>https://juejin.cn/post/7604574877034823723</guid>    <pubDate>2026-02-09T13:19:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604574877034823723" data-draft-id="7604433863726235702" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="IDEA连接MySQL数据库错误"/> <meta itemprop="keywords" content="后端,IntelliJ IDEA"/> <meta itemprop="datePublished" content="2026-02-09T13:19:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="何中应"/> <meta itemprop="url" content="https://juejin.cn/user/1435305504958535"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            IDEA连接MySQL数据库错误
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1435305504958535/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    何中应
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T13:19:08.000Z" title="Mon Feb 09 2026 13:19:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>说明：使用IDEA连接云服务器中的MySQL数据库时，报下面的这个错误；</p>
<pre><code class="hljs language-vbscript" lang="vbscript">[<span class="hljs-number">08</span>S01] Communications link failure

  The last packet sent successfully <span class="hljs-keyword">to</span> the <span class="hljs-built_in">server</span> was <span class="hljs-number">0</span> milliseconds ago. The driver has <span class="hljs-keyword">not</span> received any packets from the <span class="hljs-built_in">server</span>. No appropriate protocol (protocol <span class="hljs-keyword">is</span> disabled <span class="hljs-keyword">or</span> cipher suites are inappropriate)


  The following required algorithms might be disabled: SSLv3, TLSv1, TLSv1<span class="hljs-number">.1</span>, RC4, DES, MD5withRSA, DH keySize &lt; <span class="hljs-number">1024</span>, EC keySize &lt; <span class="hljs-number">224</span>, <span class="hljs-number">3</span>DES_EDE_CBC, anon, <span class="hljs-literal">NULL</span>. Edit the list of disabled algorithms <span class="hljs-keyword">to</span> include required algorithms. You can try <span class="hljs-keyword">to</span> enable TLSv1 <span class="hljs-keyword">or</span> TLSv1<span class="hljs-number">.1</span> first.  
  
  JDBC driver may have disabled TLS <span class="hljs-number">1.1</span> <span class="hljs-keyword">and</span> its earlier versions.
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9dbf8df9591c4419ba054204c193b66e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V5Lit5bqU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771247947&amp;x-signature=26LlY9OF0JuVG%2B6TcfbPzgNSrGk%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>错误翻译如下；</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8cc60272c2ee4b33830ad10d0a2f7c4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V5Lit5bqU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771247947&amp;x-signature=aatSe%2FZ%2Br7AGEPoAbSS9jE7nv2s%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>解决：</p>
<p>如果你的IDEA中错误下面有这几个提示，选择Enable TLSv1；</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/126e833803e24637aa437292056eb3a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V5Lit5bqU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771247947&amp;x-signature=QrPMnC15E83yPf4VqDUgRI6gBQI%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>IDEA中会自动增加以下配置，直接点“Apply”就可以；</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7bff62cafc614c328e3473905f28e046~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V5Lit5bqU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771247947&amp;x-signature=Yb%2Be2S6Oei4dIz44%2BoWuHRe5Jto%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>Test，连接成功；
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af15bc157483422e87651fea3f656f26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V5Lit5bqU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771247947&amp;x-signature=SNlttjOsUUiVFvjzJc3j%2F4VTJUk%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>如果没有提示，可手动添加以下配置：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56e5283979964e99b515845eb5a355f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V5Lit5bqU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771247947&amp;x-signature=Qv30ncS40hfR97QEsQX1kDCctFo%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"-Djdk.tls.disabledAlgorithms=SSLv3, TLSv1.1, RC4, DES, MD5withRSA, DH keySize &lt; 1024, EC keySize &lt; 224, 3DES_EDE_CBC, anon, NULL"</span>
</code></pre>
<h2 data-id="heading-0">首次发布</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhezhongying.blog.csdn.net%2Farticle%2Fdetails%2F132355979" target="_blank" title="https://hezhongying.blog.csdn.net/article/details/132355979" ref="nofollow noopener noreferrer">hezhongying.blog.csdn.net/article/det…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深度分析：RocketMQ 如何保证消息不丢失 —— 全链路防丢机制与生产实践]]></title>    <link>https://juejin.cn/post/7604665952320307251</link>    <guid>https://juejin.cn/post/7604665952320307251</guid>    <pubDate>2026-02-09T19:52:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604665952320307251" data-draft-id="7604672395626823707" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深度分析：RocketMQ 如何保证消息不丢失 —— 全链路防丢机制与生产实践"/> <meta itemprop="keywords" content="RocketMQ"/> <meta itemprop="datePublished" content="2026-02-09T19:52:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="三水不滴"/> <meta itemprop="url" content="https://juejin.cn/user/283045639753100"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深度分析：RocketMQ 如何保证消息不丢失 —— 全链路防丢机制与生产实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/283045639753100/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    三水不滴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T19:52:42.000Z" title="Mon Feb 09 2026 19:52:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">深度分析：RocketMQ 如何保证消息不丢失 —— 全链路防丢机制与生产实践</h2>
<hr/>
<h2 data-id="heading-1">一、前言</h2>
<p>在分布式系统中，<strong>消息可靠性</strong>是核心指标。很多人以为用了 MQ 就天然不丢消息，其实完全错了。</p>
<p>RocketMQ 本身<strong>不保证 100% 绝对不丢</strong>，但通过<strong>正确的架构 + 正确的配置 + 正确的使用姿势</strong>，可以达到<strong>金融级、生产级不丢失</strong>。</p>
<p>消息丢失只会发生在三个阶段：</p>
<ol>
<li><strong>Producer → Broker</strong>（发送丢失）</li>
<li><strong>Broker 内存 → 磁盘</strong>（存储丢失）</li>
<li><strong>Broker → Consumer</strong>（消费丢失）</li>
</ol>
<p>本文把这三部分<strong>全部讲透</strong>。</p>
<hr/>
<h2 data-id="heading-2">二、第一阶段：生产者如何保证消息不丢</h2>
<p>生产者丢消息，一般是：消息发了，但 Broker 没收到、没返回 ACK、生产者直接忽略异常。</p>
<h3 data-id="heading-3">2.1 使用同步发送（最关键）</h3>
<ul>
<li><strong>同步发送 <code>send()</code></strong> ：等待 Broker 返回 ACK，失败直接抛异常。</li>
<li><strong>严禁使用 <code>sendOneway()</code></strong> ：发完不管，必丢消息。</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 同步发送（推荐）</span>
<span class="hljs-type">SendResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> producer.send(message);
</code></pre>
<h3 data-id="heading-4">2.2 开启生产者重试</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 同步发送失败重试次数</span>
producer.setRetryTimesWhenSendFailed(<span class="hljs-number">3</span>);
<span class="hljs-comment">// 异步发送失败重试次数</span>
producer.setRetryTimesWhenSendAsyncFailed(<span class="hljs-number">3</span>);
</code></pre>
<h3 data-id="heading-5">2.3 严格校验发送结果</h3>
<p>必须判断 <code>SendStatus</code>，失败一定要重试 / 告警 / 落库。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">if</span> (result.getSendStatus() != SendStatus.SEND_OK) {
    <span class="hljs-comment">// 日志、告警、重试、持久化待重发</span>
}
</code></pre>
<h3 data-id="heading-6">2.4 极高可靠场景：使用事务消息</h3>
<p>订单 / 支付等核心业务，直接用 <strong>事务消息</strong>，从根源保证：<strong>本地事务成功 ↔ 消息一定发送成功</strong></p>
<hr/>
<h2 data-id="heading-7">三、第二阶段：Broker 如何保证消息不丢（最核心）</h2>
<p>Broker 是最容易丢消息的环节，99% 是因为：<strong>消息还在 PageCache，机器断电 / 宕机，数据丢失。</strong></p>
<h3 data-id="heading-8">3.1 刷盘策略：同步刷盘</h3>
<p>RocketMQ 默认是 <strong>异步刷盘</strong>，性能高，但可能丢消息。</p>
<p>要绝对不丢，必须开启：</p>
<pre><code class="hljs language-properties" lang="properties">flushDiskType = SYNC_FLUSH
</code></pre>
<ul>
<li>消息<strong>真正写入磁盘</strong>才返回 ACK</li>
<li>机器宕机、断电都不会丢</li>
<li>金融 / 支付必开</li>
</ul>
<h3 data-id="heading-9">3.2 主从同步：同步双写</h3>
<p>单机一定有风险，必须部署主从。</p>
<pre><code class="hljs language-properties" lang="properties">brokerRole = SYNC_MASTER
</code></pre>
<ul>
<li>必须 <strong>主 + 从都写入成功</strong> 才返回成功</li>
<li>主机挂了，从机依然有完整数据</li>
</ul>
<h3 data-id="heading-10">3.3 最强不丢配置（金融级）</h3>
<pre><code class="hljs language-properties" lang="properties">flushDiskType=SYNC_FLUSH
brokerRole=SYNC_MASTER
</code></pre>
<p>这套配置，只要磁盘不坏，<strong>绝对不丢</strong>。</p>
<hr/>
<h2 data-id="heading-11">四、第三阶段：消费者如何保证消息不丢（最容易忽略）</h2>
<p>消费端丢消息，是最经典的坑：</p>
<p><strong>业务还没执行完，就自动 ACK，服务一挂，消息永久丢失。</strong></p>
<h3 data-id="heading-12">4.1 核心原则：先执行业务，再 ACK</h3>
<p>RocketMQ 消费者逻辑：</p>
<ul>
<li>返回 <strong>CONSUME_SUCCESS</strong> → 认为消息消费完成</li>
<li>抛出异常 / 返回 <strong>RECONSUME_LATER</strong> → 会重试</li>
</ul>
<p>正确写法：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> ConsumeConcurrentlyStatus <span class="hljs-title function_">consumeMessage</span><span class="hljs-params">(...)</span> {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 1. 先执行业务（入库、调用、处理）</span>
        doBusiness();

        <span class="hljs-comment">// 2. 成功后再返回 SUCCESS</span>
        <span class="hljs-keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;
    } <span class="hljs-keyword">catch</span> (Exception e) {
        log.error(<span class="hljs-string">"消费失败"</span>, e);
        <span class="hljs-comment">// 3. 异常 → 不 ACK，Broker 会重试</span>
        <span class="hljs-keyword">return</span> ConsumeConcurrentlyStatus.RECONSUME_LATER;
    }
}
</code></pre>
<h3 data-id="heading-13">4.2 严禁提前 ACK</h3>
<p>不要在业务执行前就返回成功。</p>
<h3 data-id="heading-14">4.3 消费超时合理设置</h3>
<p>避免因为超时导致重复或丢失。</p>
<hr/>
<h2 data-id="heading-15">五、消息不丢失完整流程（总结一张图看懂）</h2>
<pre><code class="hljs">生产者
  ↓（同步发送 + 校验结果 + 重试）
Broker
  ↓（同步刷盘 + 同步主从）
消费者
  ↓（先执行业务，成功再 ACK）
最终：消息不丢失
</code></pre>
<hr/>
<h2 data-id="heading-16">六、生产环境终极最佳实践（直接照做）</h2>
<h3 data-id="heading-17">生产者</h3>
<ul>
<li>使用同步发送</li>
<li>开启重试</li>
<li>校验 SendResult</li>
<li>核心业务用事务消息</li>
<li>失败消息落库 + 定时任务重试</li>
</ul>
<h3 data-id="heading-18">Broker</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">flushDiskType</span>=SYNC_FLUSH
<span class="hljs-attr">brokerRole</span>=SYNC_MASTER
</code></pre>
<ul>
<li>主从架构</li>
<li>磁盘 RAID</li>
<li>监控磁盘健康、内存、服务状态</li>
</ul>
<h3 data-id="heading-19">消费者</h3>
<ul>
<li>先处理业务，再 ACK</li>
<li>异常返回 RECONSUME_LATER</li>
<li>必须做<strong>幂等</strong>（重试会重复）</li>
<li>监控：堆积、重试、死信</li>
</ul>
<hr/>
<h2 data-id="heading-20">七、经典问题</h2>
<ol>
<li>RocketMQ 如何保证消息不丢失？</li>
<li>同步刷盘 vs 异步刷盘 区别？</li>
<li>同步主从 vs 异步主从 区别？</li>
<li>消费端为什么会丢消息？</li>
<li>事务消息为什么能防丢？</li>
<li>生产中你是如何确保消息不丢失的？</li>
</ol>
<hr/>
<h2 data-id="heading-21">八、总结</h2>
<p>RocketMQ 不承诺 “天然不丢消息”，但通过：</p>
<p><strong>同步发送 + 同步刷盘 + 同步主从 + 先业务后 ACK</strong></p>
<p>可以实现<strong>工业级、金融级、生产级的消息不丢失</strong>。</p>
<p>记住一句话：<strong>消息不丢失，不是中间件单方面的事，是全链路设计的结果。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深度分析RocketMQ 消息重试（重读）机制]]></title>    <link>https://juejin.cn/post/7604690250363781129</link>    <guid>https://juejin.cn/post/7604690250363781129</guid>    <pubDate>2026-02-09T19:23:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604690250363781129" data-draft-id="7604665952320192563" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深度分析RocketMQ 消息重试（重读）机制"/> <meta itemprop="keywords" content="RocketMQ"/> <meta itemprop="datePublished" content="2026-02-09T19:23:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="三水不滴"/> <meta itemprop="url" content="https://juejin.cn/user/283045639753100"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深度分析RocketMQ 消息重试（重读）机制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/283045639753100/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    三水不滴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T19:23:39.000Z" title="Mon Feb 09 2026 19:23:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">深度分析 RocketMQ 消息重试（重读）机制：原理、流程、配置与生产实战</h2>
<h3 data-id="heading-1">一、前言</h3>
<p>在分布式系统里，<strong>消费失败是常态</strong>：</p>
<ul>
<li>网络抖动、调用超时</li>
<li>数据库异常、锁等待</li>
<li>业务校验失败、流量突刺</li>
<li>消费者重启、扩容、宕机</li>
</ul>
<p>如果没有可靠的<strong>消息重试（重读）机制</strong>，就会出现：<strong>数据不一致、丢消息、业务中断、人工补单</strong>。</p>
<p>RocketMQ 提供了一套<strong>全自动、可配置、隔离性强</strong>的消费重试方案。</p>
<h3 data-id="heading-2">二、什么是消息重试（重读）？</h3>
<p><strong>消息重试 = 消费失败后，Broker 自动重新投递消息给消费者。</strong></p>
<p>RocketMQ 只保证：<strong>At Least Once（至少投递一次）不保证 Exactly Once。</strong></p>
<p>所以：<strong>消费失败 = 不返回成功 = 自动重试</strong></p>
<hr/>
<h3 data-id="heading-3">三、哪些情况会触发重试？</h3>
<p>只要消费者<strong>没有明确返回成功</strong>，就会重试：</p>
<ol>
<li>业务代码抛出 <strong>Exception / Error</strong></li>
<li>显式返回 <code>RECONSUME_LATER</code></li>
<li>消费<strong>超时</strong>（默认 15min）</li>
<li>消费者进程挂掉、断开连接</li>
<li>队列重新负载均衡（rebalance）</li>
</ol>
<p>只要没返回：</p>
<pre><code class="hljs language-java" lang="java">ConsumeConcurrentlyStatus.CONSUME_SUCCESS
</code></pre>
<p>一律进入重试。</p>
<hr/>
<h3 data-id="heading-4">四、核心机制：重试消息存在哪里？</h3>
<p>重点：<strong>重试消息不在原 Topic！</strong></p>
<p>RocketMQ 会为<strong>每个消费组</strong>创建一个<strong>内置重试队列</strong>：</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">%</span><span class="bash">RETRY%+消费者组名</span>
</code></pre>
<p>例如：消费组：<code>order-consumer-group</code>重试队列：<code>%RETRY%order-consumer-group</code></p>
<p>特点：</p>
<ul>
<li>自动创建，无需手动建</li>
<li>对业务透明</li>
<li>与正常 Topic 隔离，不影响主流程</li>
<li>只有当前消费组能消费</li>
</ul>
<hr/>
<h3 data-id="heading-5">五、重试延迟规则（非常重要）</h3>
<p>RocketMQ <strong>不是立即重试</strong>，而是使用<strong>延迟等级</strong>控制间隔。</p>
<p>默认 <strong>18 个延迟级别</strong>：</p>
<pre><code class="hljs">1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h
</code></pre>
<p>对应 level：<code>1 ~ 18</code></p>
<h4 data-id="heading-6">重试次数与延迟对应</h4>
<ul>
<li>第 1 次重试 → level 3 → <strong>10s</strong></li>
<li>第 2 次重试 → level 4 → <strong>30s</strong></li>
<li>第 3 次重试 → level 5 → <strong>1m</strong></li>
<li>第 4 次重试 → level 6 → <strong>2m</strong></li>
<li>…</li>
<li>越来越长，<strong>避免雪崩式重试</strong></li>
</ul>
<hr/>
<h3 data-id="heading-7">六、最大重试次数 &amp; 死信队列（DLQ）</h3>
<h4 data-id="heading-8">1. 默认最大重试次数</h4>
<ul>
<li><strong>集群模式：默认 16 次</strong></li>
<li><strong>广播模式：不重试（只发一次）</strong></li>
</ul>
<h4 data-id="heading-9">2. 超过最大重试 → 进入死信队列</h4>
<p>死信队列格式：</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">%</span><span class="bash">DLQ%+消费者组名</span>
</code></pre>
<p>特点：</p>
<ul>
<li>进入死信后 <strong>不再自动投递</strong></li>
<li>需要人工排查、处理、恢复</li>
<li>是分布式系统最后的<strong>兜底保障</strong></li>
</ul>
<hr/>
<h3 data-id="heading-10">七、集群模式 vs 广播模式 重试对比</h3>
<p>表格</p>


























<table><thead><tr><th>模式</th><th>是否重试</th><th>重试队列</th><th>死信队列</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>集群模式</strong></td><td>✅ 是</td><td>✅ 有</td><td>✅ 有</td><td>生产环境默认</td></tr><tr><td><strong>广播模式</strong></td><td>❌ 不重试</td><td>❌ 无</td><td>❌ 无</td><td>日志、通知</td></tr></tbody></table>
<p><strong>生产 99% 用集群模式。</strong></p>
<hr/>
<h3 data-id="heading-11">八、完整重试流程（图文版逻辑）</h3>
<pre><code class="hljs language-erlang" lang="erlang">消费开始
  ↓
执行业务逻辑
  ↓
成功？→ 返回 CONSUME_SUCCESS → 结束
  ↓
失败？
  ↓
写入 <span class="hljs-comment">%RETRY%消费组 队列</span>
  ↓
按延迟等级等待
  ↓
重新投递给消费者
  ↓
重复直到达到最大次数
  ↓
进入 <span class="hljs-comment">%DLQ%消费组 死信队列</span>
  ↓
人工处理
</code></pre>
<hr/>
<h3 data-id="heading-12">九、代码层面如何控制重试？</h3>
<h4 data-id="heading-13">1. 抛异常自动重试（最常用）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> ConsumeConcurrentlyStatus <span class="hljs-title function_">consumeMessage</span><span class="hljs-params">(
        List&lt;MessageExt&gt; msgs, ConsumeConcurrentlyContext context)</span> {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 业务处理</span>
        doBusiness(msgs);
        <span class="hljs-keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;
    } <span class="hljs-keyword">catch</span> (Exception e) {
        log.error(<span class="hljs-string">"消费异常，自动重试"</span>, e);
        <span class="hljs-comment">// 抛出异常 → 自动进入重试</span>
        <span class="hljs-keyword">throw</span> e;
    }
}
</code></pre>
<h4 data-id="heading-14">2. 手动返回重试</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">return</span> ConsumeConcurrentlyStatus.RECONSUME_LATER;
</code></pre>
<h4 data-id="heading-15">3. 不想重试？直接吞异常</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">try</span> {
    doBusiness();
} <span class="hljs-keyword">catch</span> (Exception e) {
    log.error(<span class="hljs-string">"业务失败，不再重试"</span>, e);
}
<span class="hljs-keyword">return</span> CONSUME_SUCCESS;
</code></pre>
<p>⚠️ 谨慎使用，会丢消息。</p>
<hr/>
<h3 data-id="heading-16">十、如何自定义最大重试次数？</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">DefaultMQPushConsumer</span> <span class="hljs-variable">consumer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultMQPushConsumer</span>(<span class="hljs-string">"order-group"</span>);
<span class="hljs-comment">// 设置最大重试次数</span>
consumer.setMaxReconsumeTimes(<span class="hljs-number">5</span>);
</code></pre>
<p>推荐：<strong>3~5 次</strong>，避免无限重试。</p>
<hr/>
<h3 data-id="heading-17">十一、生产环境最佳实践</h3>
<ol>
<li>
<p><strong>消费必须幂等</strong>重试一定会带来重复消息，必须保证重复消费不影响结果。</p>
</li>
<li>
<p><strong>可重试与不可重试异常分开处理</strong></p>
<ul>
<li>网络 / DB 抖动：可重试</li>
<li>参数非法 / 数据不存在：不重试，直接记录</li>
</ul>
</li>
<li>
<p><strong>快速失败，不要阻塞</strong>阻塞会导致队列大量堆积。</p>
</li>
<li>
<p><strong>死信队列必须监控告警</strong>出现死信 = 系统异常，必须及时处理。</p>
</li>
<li>
<p><strong>重试次数不要设置过大</strong>避免消息长期占用队列，影响正常消费。</p>
</li>
<li>
<p><strong>禁止禁用重试</strong>高可靠系统不允许丢消息。</p>
</li>
</ol>
<hr/>
<h3 data-id="heading-18">十二、总结</h3>
<p>RocketMQ 消息重试（重读）机制是：<strong>高可靠分布式系统的核心保障</strong>。</p>
<p>核心要点：</p>
<ul>
<li>消费失败 → 进入 <code>%RETRY%组名</code></li>
<li>按延迟等级重试，避免风暴</li>
<li>超过次数 → 进入 <code>%DLQ%组名</code></li>
<li>消费端必须做<strong>幂等</strong></li>
<li>生产必须监控<strong>重试、死信、堆积</strong></li>
</ul>
<p>理解这套机制，你就能真正写出<strong>生产可用、高可靠、高可用</strong>的消息服务。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【节点】[HDSceneColor节点]原理解析与实际应用]]></title>    <link>https://juejin.cn/post/7604853010162499647</link>    <guid>https://juejin.cn/post/7604853010162499647</guid>    <pubDate>2026-02-10T01:54:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604853010162499647" data-draft-id="7604853010162483263" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【节点】[HDSceneColor节点]原理解析与实际应用"/> <meta itemprop="keywords" content="游戏开发,图形学,Unity3D"/> <meta itemprop="datePublished" content="2026-02-10T01:54:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SmalBox"/> <meta itemprop="url" content="https://juejin.cn/user/2218166695237532"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【节点】[HDSceneColor节点]原理解析与实际应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2218166695237532/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SmalBox
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T01:54:00.000Z" title="Tue Feb 10 2026 01:54:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fchenghai37%2Fcategory_13074589.html%3Ffromshare%3Dblogcolumn%26sharetype%3Dblogcolumn%26sharerId%3D13074589%26sharerefer%3DPC%26sharesource%3Dchenghai37%26sharefrom%3Dfrom_link" target="_blank" title="https://blog.csdn.net/chenghai37/category_13074589.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13074589&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" ref="nofollow noopener noreferrer">【Unity Shader Graph 使用与特效实现】</a><strong>专栏-直达</strong></p>
</blockquote>
<p>高清场景颜色节点（HD Scene Color Node）是Unity高清渲染管线（HDRP）中一个功能强大的着色器图形节点，它扩展了传统场景颜色节点的能力，为开发者提供了更精细的颜色缓冲区访问控制。该节点的核心价值在于能够访问颜色缓冲区的Mipmap级别，这在实现各种高级渲染效果时至关重要。</p>
<p>在实时渲染中，颜色缓冲区存储了场景的最终渲染结果，而Mipmap链则是该缓冲区的一系列逐渐降低分辨率版本。HD Scene Color节点的独特之处在于它允许着色器程序访问这些不同分辨率的颜色数据，为后处理效果、屏幕空间反射、细节层次（LOD）系统等高级图形功能提供了技术基础。</p>
<h2 data-id="heading-0">渲染管线兼容性详解</h2>
<p>HD Scene Color节点的可用性完全取决于所使用的渲染管线，这是开发者在选择和使用该节点时必须首先考虑的因素。</p>
<p><strong>高清渲染管线（HDRP）支持</strong></p>
<ul>
<li>HDRP是Unity针对高端平台和高端硬件设计的高保真渲染解决方案</li>
<li>HD Scene Color节点专为HDRP设计，充分利用了HDRP的复杂渲染架构</li>
<li>在HDRP中，颜色缓冲区通常包含HDR（高动态范围）数据，提供了更丰富的颜色信息和亮度范围</li>
<li>HDRP的渲染路径允许多个颜色缓冲区并存，HD Scene Color节点可以访问这些缓冲区中的特定数据</li>
</ul>
<p><strong>通用渲染管线（URP）不支持</strong></p>
<ul>
<li>URP是Unity的轻量级、跨平台渲染解决方案，设计目标是性能和效率</li>
<li>URP不支持HD Scene Color节点，因为它简化了渲染架构，不包含完整的Mipmap颜色缓冲区链</li>
<li>在URP中，开发者应使用标准的Scene Color节点来访问场景颜色，但无法访问不同Mip级别的数据</li>
<li>这种设计差异反映了URP和HDRP在目标应用场景和功能复杂度上的根本区别</li>
</ul>
<p>选择正确的渲染管线对于项目成功至关重要。如果项目需要高级颜色缓冲区操作、复杂的后处理效果或面向高端硬件平台，HDRP和HD Scene Color节点是理想选择。而对于移动端、VR或需要广泛平台兼容性的项目，URP可能是更合适的选择，尽管它不支持HD Scene Color节点的所有高级功能。</p>
<h2 data-id="heading-1">端口详细说明</h2>
<p>HD Scene Color节点的三个端口分别承担着不同的功能，理解每个端口的特性和用法是实现预期视觉效果的关键。</p>
<h3 data-id="heading-2">UV输入端口</h3>
<p>UV输入端口是节点中最常用的输入之一，它定义了在颜色缓冲区中采样的位置。</p>
<p><strong>数据类型与绑定</strong></p>
<ul>
<li>UV端口接受Vector 4类型的输入，提供了足够的维度来支持各种采样坐标系统</li>
<li>该端口默认绑定到屏幕位置（Screen Position），这意味着如果不显式连接其他值，节点将使用当前像素的屏幕坐标进行采样</li>
<li>屏幕坐标通常是归一化的，范围在[0,1]之间，其中(0,0)表示屏幕左下角，(1,1)表示屏幕右上角</li>
</ul>
<p><strong>高级使用技巧</strong></p>
<ul>
<li>可以通过连接其他节点来修改UV值，实现平移、旋转、缩放等采样效果</li>
<li>使用时间变量动画UV坐标可以创建动态采样效果，如屏幕波动、热浪扭曲等</li>
<li>通过偏移UV坐标，可以实现视差效果、伪反射和其他基于屏幕空间的变形</li>
<li>在多摄像机设置中，需要注意UV坐标的参考系，确保采样正确的摄像机颜色缓冲区</li>
</ul>
<p><strong>实际应用示例</strong></p>
<p>假设我们想创建一个简单的屏幕扭曲效果，可以连接一个正弦波节点到UV端口的X和Y分量，使采样位置随时间轻微波动，模拟热量 haze 或水下的折射效果。</p>
<h3 data-id="heading-3">Lod输入端口</h3>
<p>Lod（Level of Detail）输入端口是HD Scene Color节点区别于普通Scene Color节点的关键特性，它控制着采样时使用的Mipmap级别。</p>
<p><strong>Mipmap基础概念</strong></p>
<ul>
<li>Mipmap是原始纹理的一系列缩小版本，每个后续级别的分辨率减半</li>
<li>在实时渲染中，Mipmap主要用于减少远处表面的锯齿和提高缓存效率</li>
<li>HD Scene Color节点允许访问颜色缓冲区的Mipmap链，这意味着可以采样到不同分辨率的场景颜色数据</li>
</ul>
<p><strong>Lod端口特性</strong></p>
<ul>
<li>Lod端口接受Float类型的输入，表示要采样的Mip级别</li>
<li>值为0表示最高分辨率的原始颜色缓冲区</li>
<li>值每增加1，对应的Mip级别分辨率减半（级别1为1/2分辨率，级别2为1/4分辨率，以此类推）</li>
<li>支持小数值，允许在三线性过滤模式下在Mip级别之间平滑插值</li>
</ul>
<p><strong>Lod值的计算与使用</strong></p>
<ul>
<li>可以直接连接常量值来固定Mip级别</li>
<li>可以根据像素到摄像机的距离动态计算Lod值，实现自适应细节级别</li>
<li>可以使用屏幕空间导数函数（如ddx/ddy）来计算基于局部几何复杂度的Lod值</li>
<li>在后处理效果中，通常使用较高的Lod值（如2-4）来获取模糊的场景颜色，用于泛光、景深等效果</li>
</ul>
<p><strong>性能考虑</strong></p>
<ul>
<li>采样较高的Mip级别（较低分辨率）通常更快，因为需要处理的数据更少</li>
<li>但是，频繁在不同Mip级别之间切换可能导致缓存效率降低</li>
<li>在性能敏感的场景中，应平衡视觉效果需求和性能开销</li>
</ul>
<h3 data-id="heading-4">输出端口</h3>
<p>输出端口提供从颜色缓冲区指定位置和Mip级别采样得到的颜色值。</p>
<p><strong>输出特性</strong></p>
<ul>
<li>输出为Vector 3类型，对应RGB颜色空间中的红、绿、蓝三个通道</li>
<li>颜色值通常位于HDR范围内，可能包含超过[0,1]传统范围的值</li>
<li>输出颜色已经过当前摄像机的色调映射和颜色分级处理（除非在特殊渲染通道中）</li>
</ul>
<p><strong>颜色空间注意事项</strong></p>
<ul>
<li>在HDRP中，颜色数据可能在线性空间或伽马空间，取决于项目设置</li>
<li>进行颜色操作时，确保了解当前工作颜色空间，避免不正确的结果</li>
<li>当与其他颜色值混合或操作时，可能需要手动进行颜色空间转换</li>
</ul>
<p><strong>输出数据的后续处理</strong></p>
<ul>
<li>采样得到的颜色可以用于各种计算：亮度提取、颜色操作、与其他纹理混合等</li>
<li>在自定义后处理效果中，HD Scene Color节点的输出通常作为主要输入之一</li>
<li>可以通过连接其他着色器图形节点对输出颜色进行进一步处理：应用颜色曲线、调整饱和度、实施颜色替换等</li>
</ul>
<h2 data-id="heading-5">曝光控制深入解析</h2>
<p>曝光控制是HD Scene Color节点中一个微妙但重要的特性，正确理解和使用它对实现预期的视觉效果至关重要。</p>
<h3 data-id="heading-6">曝光属性基础</h3>
<p>曝光属性决定了节点输出颜色时是否应用了场景的曝光设置。</p>
<p><strong>启用曝光</strong></p>
<ul>
<li>当Exposure属性启用时，输出颜色会乘以当前摄像机的曝光值</li>
<li>这适用于大多数标准渲染情况，确保颜色与场景中的其他元素一致</li>
<li>在自动曝光（自适应曝光）情况下，输出颜色会随曝光调整而动态变化</li>
</ul>
<p><strong>禁用曝光</strong></p>
<ul>
<li>当Exposure属性禁用时，输出颜色不会应用曝光调整</li>
<li>这可以防止在已经应用了曝光的颜色上重复应用曝光，避免过度明亮或黑暗的结果</li>
<li>在后处理效果中，通常需要禁用曝光，因为后处理栈通常有自己独立的曝光控制</li>
</ul>
<h3 data-id="heading-7">曝光与HDR渲染</h3>
<p>在高动态范围渲染中，曝光控制尤为重要。</p>
<p><strong>HDR颜色值</strong></p>
<ul>
<li>在HDRP中，颜色缓冲区通常存储超过传统[0,1]范围的值</li>
<li>这些值表示场景中真实的物理光照水平，可能从极暗到极亮</li>
<li>色调映射过程将这些HDR值转换为显示设备能够处理的LDR（低动态范围）值</li>
</ul>
<p><strong>曝光在色调映射中的作用</strong></p>
<ul>
<li>曝光是色调映射过程中的关键参数，控制着HDR到LDR的转换</li>
<li>适当的曝光设置确保场景中的重要细节在最终图像中可见</li>
<li>HD Scene Color节点的曝光设置决定了采样颜色是否已经过这个转换过程</li>
</ul>
<h3 data-id="heading-8">避免双重曝光问题</h3>
<p>双重曝光是使用HD Scene Color节点时常见的错误，会导致颜色计算不正确。</p>
<p><strong>双重曝光的成因</strong></p>
<ul>
<li>当颜色缓冲区中的数据已经应用了曝光，而节点再次应用曝光时发生</li>
<li>这会导致颜色值被两次乘以曝光值，产生过度明亮或饱和的结果</li>
<li>在后处理效果中特别常见，因为后处理通常在全屏通道中执行，已经包含了曝光信息</li>
</ul>
<p><strong>识别双重曝光</strong></p>
<ul>
<li>渲染结果异常明亮或黑暗，与场景照明不符</li>
<li>颜色饱和度异常高，特别是在明亮区域</li>
<li>当调整摄像机曝光时，效果强度变化异常剧烈</li>
</ul>
<p><strong>解决方案</strong></p>
<ul>
<li>在大多数后处理场景中，应禁用HD Scene Color节点的Exposure属性</li>
<li>如果需要在着色器中手动应用曝光，可以使用Exposure节点和当前曝光值</li>
<li>测试时，尝试切换Exposure属性，观察结果变化，确定正确的设置</li>
</ul>
<h2 data-id="heading-9">采样器模式详解</h2>
<p>HD Scene Color节点使用的三线性钳位模式采样器对采样质量和性能有重要影响。</p>
<h3 data-id="heading-10">三线性过滤原理</h3>
<p>三线性过滤是一种高级纹理过滤技术，结合了双线性过滤和Mipmap插值。</p>
<p><strong>双线性过滤</strong></p>
<ul>
<li>在单个Mip级别内，对四个最近的纹素进行加权平均</li>
<li>减少了近距离观察纹理时的块状像素化现象</li>
<li>但不能解决远处表面的闪烁和锯齿问题</li>
</ul>
<p><strong>Mipmap插值</strong></p>
<ul>
<li>在两个最近的Mip级别之间进行插值</li>
<li>根据像素在屏幕上的大小自动选择合适的细节级别</li>
<li>解决了远处表面的闪烁和莫尔图案问题</li>
</ul>
<p><strong>三线性过滤</strong></p>
<ul>
<li>结合了双线性过滤和Mipmap插值</li>
<li>首先在两个Mip级别上分别执行双线性过滤</li>
<li>然后在两个过滤结果之间进行线性插值</li>
<li>提供了平滑的细节过渡，消除了Mip级别之间的突然变化</li>
</ul>
<h3 data-id="heading-11">钳位模式特性</h3>
<p>钳位模式定义了当采样坐标超出标准[0,1]范围时的采样行为。</p>
<p><strong>标准钳位行为</strong></p>
<ul>
<li>当UV坐标小于0时，使用边界处的颜色值（UV为0时的颜色）</li>
<li>当UV坐标大于1时，使用边界处的颜色值（UV为1时的颜色）</li>
<li>这防止了采样器在纹理边界外采样，避免了意外行为</li>
</ul>
<p><strong>与其他模式的比较</strong></p>
<ul>
<li>重复（Wrap）模式会在超出边界时重复纹理</li>
<li>镜像（Mirror）模式会镜像纹理</li>
<li>边框（Border）模式会使用指定的边框颜色</li>
<li>对于屏幕空间采样，钳位模式通常是最合适的选择，因为它符合屏幕边界的物理特性</li>
</ul>
<h3 data-id="heading-12">性能影响与优化</h3>
<p>三线性钳位采样虽然质量高，但也有性能成本。</p>
<p><strong>性能考虑</strong></p>
<ul>
<li>三线性过滤需要访问8个纹素（两个Mip级别各4个），而双线性只需4个</li>
<li>这增加了内存带宽需求和纹理缓存压力</li>
<li>在性能敏感的场景中，可能需要权衡质量与性能</li>
</ul>
<p><strong>优化策略</strong></p>
<ul>
<li>对于不需要高质量过滤的效果，可以考虑使用双线性采样</li>
<li>通过适当设置Lod值，可以减少不必要的Mip级别插值</li>
<li>在移动平台或低端硬件上，可以考虑减少三线性过滤的使用范围</li>
</ul>
<h2 data-id="heading-13">实际应用案例</h2>
<p>HD Scene Color节点在实践中有多种应用，以下是一些常见的使用场景。</p>
<h3 data-id="heading-14">屏幕空间反射</h3>
<p>屏幕空间反射（SSR）是HD Scene Color节点的经典应用之一。</p>
<p><strong>基本原理</strong></p>
<ul>
<li>通过射线行进在屏幕空间中查找反射表面</li>
<li>使用HD Scene Color节点采样反射方向上的场景颜色</li>
<li>通过适当的Lod设置减少反射中的噪点和闪烁</li>
</ul>
<p><strong>实现步骤</strong></p>
<ul>
<li>计算当前像素的反射向量</li>
<li>在反射方向上进行射线行进，检测与场景几何的碰撞</li>
<li>使用碰撞点的屏幕坐标作为UV输入HD Scene Color节点</li>
<li>根据射线行进距离和表面粗糙度设置适当的Lod值</li>
<li>将采样得到的反射颜色与表面颜色混合</li>
</ul>
<p><strong>优化技巧</strong></p>
<ul>
<li>使用分层射线行进提高性能</li>
<li>根据表面粗糙度动态调整Lod值——粗糙表面使用较高Lod</li>
<li>实施回退机制，当屏幕空间反射失败时使用其他反射技术</li>
</ul>
<h3 data-id="heading-15">自定义后处理效果</h3>
<p>HD Scene Color节点是创建自定义后处理效果的强大工具。</p>
<p><strong>颜色分级效果</strong></p>
<ul>
<li>采样场景颜色并进行非线性颜色变换</li>
<li>实现自定义的色调映射曲线、颜色分级表（LUT）</li>
<li>创建风格化的视觉效果，如复古、电影感或科幻风格</li>
</ul>
<p><strong>空间效果</strong></p>
<ul>
<li>使用扭曲的UV坐标采样场景颜色，创建热浪、水下折射等效果</li>
<li>通过时间变化的UV偏移实现屏幕波动效果</li>
<li>结合深度缓冲区实现基于距离的颜色效果</li>
</ul>
<p><strong>多Pass效果</strong></p>
<ul>
<li>在第一Pass中采样场景颜色并存储到自定义缓冲区</li>
<li>在后续Pass中结合HD Scene Color节点采样进行复杂混合</li>
<li>实现如运动模糊、景深、泛光等多阶段后处理效果</li>
</ul>
<h3 data-id="heading-16">高级混合模式</h3>
<p>HD Scene Color节点可以实现超越标准混合模式的复杂合成效果。</p>
<p><strong>基于深度的混合</strong></p>
<ul>
<li>结合深度缓冲区信息，实现仅在特定深度范围内生效的混合</li>
<li>创建如雾气、水下水花等基于距离的效果</li>
</ul>
<p><strong>基于亮度的混合</strong></p>
<ul>
<li>提取采样颜色的亮度，用于控制混合因子</li>
<li>实现如泛光、镜头光晕等高光相关效果</li>
</ul>
<p><strong>自定义屏幕空间遮罩</strong></p>
<ul>
<li>使用HD Scene Color节点采样特定颜色通道作为遮罩</li>
<li>实现仅在屏幕特定区域生效的效果</li>
<li>创建如体积光、上帝光线等局部后处理效果</li>
</ul>
<h2 data-id="heading-17">性能优化与最佳实践</h2>
<p>正确使用HD Scene Color节点对保持应用性能至关重要。</p>
<h3 data-id="heading-18">采样成本分析</h3>
<p>了解HD Scene Color节点的性能特征有助于做出明智的优化决策。</p>
<p><strong>影响因素</strong></p>
<ul>
<li>采样位置（UV）的连贯性影响缓存效率</li>
<li>Lod值影响访问的Mip级别和内存带宽</li>
<li>屏幕分辨率直接影响采样操作的绝对数量</li>
</ul>
<p><strong>性能监控</strong></p>
<ul>
<li>使用Unity的Frame Debugger或Render Doc分析具体采样操作</li>
<li>监控GPU时间和内存带宽使用情况</li>
<li>在不同硬件平台上测试性能表现</li>
</ul>
<h3 data-id="heading-19">优化策略</h3>
<p>多种策略可以帮助优化使用HD Scene Color节点的着色器性能。</p>
<p><strong>减少采样次数</strong></p>
<ul>
<li>尽可能重用采样结果，避免重复采样相同位置</li>
<li>使用双线性过滤的优势，通过单次采样获取平滑结果</li>
<li>在可行的情况下，降低采样频率并使用插值</li>
</ul>
<p><strong>智能Lod选择</strong></p>
<ul>
<li>根据视觉效果需求选择最低可接受的Lod级别</li>
<li>对远处或次要效果使用较高Lod级别</li>
<li>动态调整Lod级别，平衡质量与性能</li>
</ul>
<p><strong>平台特定优化</strong></p>
<ul>
<li>在移动平台上，考虑使用更简单的采样策略</li>
<li>利用特定硬件的纹理采样特性</li>
<li>为不同性能级别的设备提供多个质量设置</li>
</ul>
<h2 data-id="heading-20">故障排除与常见问题</h2>
<p>使用HD Scene Color节点时可能遇到各种问题，了解如何识别和解决这些问题很重要。</p>
<h3 data-id="heading-21">采样结果不正确</h3>
<p>当HD Scene Color节点返回意外结果时，可能的原因和解决方案。</p>
<p><strong>UV坐标问题</strong></p>
<ul>
<li>确认UV坐标在预期的[0,1]范围内</li>
<li>检查UV坐标是否应用了正确的变换</li>
<li>验证屏幕位置是否正确转换为纹理坐标</li>
</ul>
<p><strong>Lod设置问题</strong></p>
<ul>
<li>确认Lod值在合理范围内，不会导致采样过低分辨率的Mip级别</li>
<li>检查Lod计算逻辑是否正确，特别是基于距离或导数的计算</li>
<li>验证三线性插值是否按预期工作</li>
</ul>
<p><strong>曝光相关问题</strong></p>
<ul>
<li>检查Exposure属性设置是否符合当前渲染上下文</li>
<li>验证是否存在双重曝光问题</li>
<li>确认颜色空间转换是否正确处理</li>
</ul>
<h3 data-id="heading-22">性能问题</h3>
<p>当使用HD Scene Color节点导致性能下降时，可能的优化方向。</p>
<p><strong>识别瓶颈</strong></p>
<ul>
<li>使用性能分析工具确定是ALU瓶颈还是内存带宽瓶颈</li>
<li>检查是否有不必要的重复采样操作</li>
<li>评估采样频率是否高于视觉效果所需</li>
</ul>
<p><strong>优化方案</strong></p>
<ul>
<li>减少全屏采样操作的数量和频率</li>
<li>使用较低分辨率的Mip级别，特别是在后处理效果中</li>
<li>考虑使用近似方法替代精确采样</li>
</ul>
<h3 data-id="heading-23">平台兼容性问题</h3>
<p>在不同平台或渲染设置下，HD Scene Color节点可能表现出不同行为。</p>
<p><strong>渲染管线差异</strong></p>
<ul>
<li>确认项目使用的是HDRP，因为HD Scene Color节点在URP中不可用</li>
<li>检查HDRP版本和配置，确保所有必需功能已启用</li>
<li>验证颜色缓冲区和Mipmap链的可用性</li>
</ul>
<p><strong>平台特定行为</strong></p>
<ul>
<li>在不同图形API（DirectX、Vulkan、Metal）下测试着色器</li>
<li>检查移动平台上的功能支持级别</li>
<li>验证着色器变体是否为目标平台正确编译</li>
</ul>
<hr/>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fchenghai37%2Fcategory_13074589.html%3Ffromshare%3Dblogcolumn%26sharetype%3Dblogcolumn%26sharerId%3D13074589%26sharerefer%3DPC%26sharesource%3Dchenghai37%26sharefrom%3Dfrom_link" target="_blank" title="https://blog.csdn.net/chenghai37/category_13074589.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13074589&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" ref="nofollow noopener noreferrer">【Unity Shader Graph 使用与特效实现】</a><strong>专栏-直达</strong>
（欢迎<em>点赞留言</em>探讨，更多人加入进来能更加完善这个探索的过程，🙏）</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用 Python 5 分钟搭一个多模型 AI API 网关（附完整代码）]]></title>    <link>https://juejin.cn/post/7604853010162253887</link>    <guid>https://juejin.cn/post/7604853010162253887</guid>    <pubDate>2026-02-10T01:07:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604853010162253887" data-draft-id="7604666872127520787" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用 Python 5 分钟搭一个多模型 AI API 网关（附完整代码）"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-02-10T01:07:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码路飞"/> <meta itemprop="url" content="https://juejin.cn/user/186265609189227"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用 Python 5 分钟搭一个多模型 AI API 网关（附完整代码）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/186265609189227/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码路飞
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T01:07:27.000Z" title="Tue Feb 10 2026 01:07:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>还在手动切换 OpenAI、Claude、DeepSeek 的 API？太蠢了。本文教你用 Python 搭一个统一的 AI 网关，一个接口调所有模型，自动故障转移，代码不到 100 行。</p>
</blockquote>
<h2 data-id="heading-0">为什么需要 AI API 网关？</h2>
<p>如果你在做 AI 应用开发，大概率遇到过这些问题：</p>
<ul>
<li>OpenAI 抽风了，服务挂了 2 小时，你的应用跟着挂</li>
<li>DeepSeek 发布新版本，API 过载，请求全超时</li>
<li>老板突然说"我们试试 Claude"，你得改一堆代码</li>
<li>不同模型的 API 格式不一样，适配起来头疼</li>
</ul>
<p><strong>这些问题的本质是：你的应用直接耦合了某个具体的模型 API。</strong></p>
<p>解决方案很简单——在你的应用和模型之间加一层网关，统一接口、自动路由、故障转移。</p>
<h2 data-id="heading-1">完整代码：100 行的 AI 网关</h2>
<p>直接上代码，Python + FastAPI，能跑的那种。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> httpx
<span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Request
<span class="hljs-keyword">from</span> fastapi.responses <span class="hljs-keyword">import</span> JSONResponse

app = FastAPI(title=<span class="hljs-string">"AI API Gateway"</span>)

<span class="hljs-comment"># 模型配置：按优先级排列</span>
MODEL_PROVIDERS = [
    {
        <span class="hljs-string">"name"</span>: <span class="hljs-string">"deepseek"</span>,
        <span class="hljs-string">"base_url"</span>: <span class="hljs-string">"https://api.deepseek.com/v1"</span>,
        <span class="hljs-string">"api_key"</span>: os.getenv(<span class="hljs-string">"DEEPSEEK_API_KEY"</span>, <span class="hljs-string">""</span>),
        <span class="hljs-string">"model"</span>: <span class="hljs-string">"deepseek-chat"</span>,
        <span class="hljs-string">"timeout"</span>: <span class="hljs-number">30</span>,
        <span class="hljs-string">"max_retries"</span>: <span class="hljs-number">2</span>,
    },
    {
        <span class="hljs-string">"name"</span>: <span class="hljs-string">"openai"</span>,
        <span class="hljs-string">"base_url"</span>: <span class="hljs-string">"https://api.openai.com/v1"</span>,
        <span class="hljs-string">"api_key"</span>: os.getenv(<span class="hljs-string">"OPENAI_API_KEY"</span>, <span class="hljs-string">""</span>),
        <span class="hljs-string">"model"</span>: <span class="hljs-string">"gpt-4o-mini"</span>,
        <span class="hljs-string">"timeout"</span>: <span class="hljs-number">30</span>,
        <span class="hljs-string">"max_retries"</span>: <span class="hljs-number">1</span>,
    },
    {
        <span class="hljs-string">"name"</span>: <span class="hljs-string">"anthropic"</span>,
        <span class="hljs-string">"base_url"</span>: <span class="hljs-string">"https://api.anthropic.com/v1"</span>,
        <span class="hljs-string">"api_key"</span>: os.getenv(<span class="hljs-string">"ANTHROPIC_API_KEY"</span>, <span class="hljs-string">""</span>),
        <span class="hljs-string">"model"</span>: <span class="hljs-string">"claude-3-5-sonnet-20241022"</span>,
        <span class="hljs-string">"timeout"</span>: <span class="hljs-number">30</span>,
        <span class="hljs-string">"max_retries"</span>: <span class="hljs-number">1</span>,
    },
]

<span class="hljs-comment"># 健康状态追踪</span>
provider_health = {p[<span class="hljs-string">"name"</span>]: {<span class="hljs-string">"healthy"</span>: <span class="hljs-literal">True</span>, <span class="hljs-string">"last_fail"</span>: <span class="hljs-number">0</span>} <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> MODEL_PROVIDERS}
COOLDOWN_SECONDS = <span class="hljs-number">60</span>  <span class="hljs-comment"># 故障冷却时间</span>


<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">call_provider</span>(<span class="hljs-params">provider: <span class="hljs-built_in">dict</span>, messages: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
    <span class="hljs-string">"""调用单个模型供应商"""</span>
    headers = {
        <span class="hljs-string">"Authorization"</span>: <span class="hljs-string">f"Bearer <span class="hljs-subst">{provider[<span class="hljs-string">'api_key'</span>]}</span>"</span>,
        <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span>,
    }

    <span class="hljs-comment"># Anthropic 的 API 格式略有不同</span>
    <span class="hljs-keyword">if</span> provider[<span class="hljs-string">"name"</span>] == <span class="hljs-string">"anthropic"</span>:
        headers = {
            <span class="hljs-string">"x-api-key"</span>: provider[<span class="hljs-string">"api_key"</span>],
            <span class="hljs-string">"anthropic-version"</span>: <span class="hljs-string">"2023-06-01"</span>,
            <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span>,
        }
        payload = {
            <span class="hljs-string">"model"</span>: provider[<span class="hljs-string">"model"</span>],
            <span class="hljs-string">"max_tokens"</span>: <span class="hljs-number">4096</span>,
            <span class="hljs-string">"messages"</span>: messages,
        }
        url = <span class="hljs-string">f"<span class="hljs-subst">{provider[<span class="hljs-string">'base_url'</span>]}</span>/messages"</span>
    <span class="hljs-keyword">else</span>:
        payload = {
            <span class="hljs-string">"model"</span>: provider[<span class="hljs-string">"model"</span>],
            <span class="hljs-string">"messages"</span>: messages,
            <span class="hljs-string">"max_tokens"</span>: <span class="hljs-number">4096</span>,
        }
        url = <span class="hljs-string">f"<span class="hljs-subst">{provider[<span class="hljs-string">'base_url'</span>]}</span>/chat/completions"</span>

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> httpx.AsyncClient(timeout=provider[<span class="hljs-string">"timeout"</span>]) <span class="hljs-keyword">as</span> client:
        resp = <span class="hljs-keyword">await</span> client.post(url, json=payload, headers=headers)
        resp.raise_for_status()
        <span class="hljs-keyword">return</span> resp.json()


<span class="hljs-keyword">def</span> <span class="hljs-title function_">normalize_response</span>(<span class="hljs-params">provider_name: <span class="hljs-built_in">str</span>, raw: <span class="hljs-built_in">dict</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
    <span class="hljs-string">"""统一不同供应商的响应格式"""</span>
    <span class="hljs-keyword">if</span> provider_name == <span class="hljs-string">"anthropic"</span>:
        content = raw.get(<span class="hljs-string">"content"</span>, [{}])[<span class="hljs-number">0</span>].get(<span class="hljs-string">"text"</span>, <span class="hljs-string">""</span>)
        model = raw.get(<span class="hljs-string">"model"</span>, <span class="hljs-string">""</span>)
    <span class="hljs-keyword">else</span>:
        content = raw[<span class="hljs-string">"choices"</span>][<span class="hljs-number">0</span>][<span class="hljs-string">"message"</span>][<span class="hljs-string">"content"</span>]
        model = raw.get(<span class="hljs-string">"model"</span>, <span class="hljs-string">""</span>)

    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"content"</span>: content,
        <span class="hljs-string">"model"</span>: model,
        <span class="hljs-string">"provider"</span>: provider_name,
    }


<span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">"/v1/chat"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">chat</span>(<span class="hljs-params">request: Request</span>):
    <span class="hljs-string">"""统一聊天接口——自动路由到可用的模型"""</span>
    body = <span class="hljs-keyword">await</span> request.json()
    messages = body.get(<span class="hljs-string">"messages"</span>, [])
    preferred = body.get(<span class="hljs-string">"provider"</span>, <span class="hljs-literal">None</span>)  <span class="hljs-comment"># 可选：指定供应商</span>

    errors = []

    <span class="hljs-keyword">for</span> provider <span class="hljs-keyword">in</span> MODEL_PROVIDERS:
        name = provider[<span class="hljs-string">"name"</span>]
        health = provider_health[name]

        <span class="hljs-comment"># 跳过指定供应商以外的</span>
        <span class="hljs-keyword">if</span> preferred <span class="hljs-keyword">and</span> name != preferred:
            <span class="hljs-keyword">continue</span>

        <span class="hljs-comment"># 跳过冷却中的供应商</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> health[<span class="hljs-string">"healthy"</span>] <span class="hljs-keyword">and</span> time.time() - health[<span class="hljs-string">"last_fail"</span>] &lt; COOLDOWN_SECONDS:
            <span class="hljs-keyword">continue</span>

        <span class="hljs-keyword">try</span>:
            raw = <span class="hljs-keyword">await</span> call_provider(provider, messages)
            provider_health[name][<span class="hljs-string">"healthy"</span>] = <span class="hljs-literal">True</span>
            <span class="hljs-keyword">return</span> JSONResponse(normalize_response(name, raw))

        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            provider_health[name] = {<span class="hljs-string">"healthy"</span>: <span class="hljs-literal">False</span>, <span class="hljs-string">"last_fail"</span>: time.time()}
            errors.append(<span class="hljs-string">f"<span class="hljs-subst">{name}</span>: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>)
            <span class="hljs-keyword">continue</span>

    <span class="hljs-keyword">return</span> JSONResponse(
        {<span class="hljs-string">"error"</span>: <span class="hljs-string">"All providers failed"</span>, <span class="hljs-string">"details"</span>: errors},
        status_code=<span class="hljs-number">503</span>,
    )


<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/health"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">health</span>():
    <span class="hljs-string">"""查看各供应商健康状态"""</span>
    <span class="hljs-keyword">return</span> {name: info <span class="hljs-keyword">for</span> name, info <span class="hljs-keyword">in</span> provider_health.items()}
</code></pre>
<h2 data-id="heading-2">怎么用</h2>
<h3 data-id="heading-3">1. 安装依赖</h3>
<pre><code class="hljs language-bash" lang="bash">pip install fastapi uvicorn httpx
</code></pre>
<h3 data-id="heading-4">2. 设置 API Key</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> DEEPSEEK_API_KEY=<span class="hljs-string">"sk-xxx"</span>
<span class="hljs-built_in">export</span> OPENAI_API_KEY=<span class="hljs-string">"sk-xxx"</span>
<span class="hljs-built_in">export</span> ANTHROPIC_API_KEY=<span class="hljs-string">"sk-xxx"</span>
</code></pre>
<h3 data-id="heading-5">3. 启动</h3>
<pre><code class="hljs language-bash" lang="bash">uvicorn gateway:app --port 8000
</code></pre>
<h3 data-id="heading-6">4. 调用</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 自动路由（优先 DeepSeek，失败自动切换）</span>
curl -X POST http://localhost:8000/v1/chat \
  -H <span class="hljs-string">"Content-Type: application/json"</span> \
  -d <span class="hljs-string">'{"messages": [{"role": "user", "content": "你好"}]}'</span>

<span class="hljs-comment"># 指定供应商</span>
curl -X POST http://localhost:8000/v1/chat \
  -H <span class="hljs-string">"Content-Type: application/json"</span> \
  -d <span class="hljs-string">'{"messages": [{"role": "user", "content": "你好"}], "provider": "openai"}'</span>

<span class="hljs-comment"># 查看健康状态</span>
curl http://localhost:8000/health
</code></pre>
<h2 data-id="heading-7">核心设计思路</h2>
<h3 data-id="heading-8">1. 优先级路由</h3>
<p><code>MODEL_PROVIDERS</code> 数组的顺序就是优先级。DeepSeek 排第一是因为性价比最高，OpenAI 和 Claude 作为备用。</p>
<h3 data-id="heading-9">2. 自动故障转移</h3>
<p>某个供应商报错后，标记为"不健康"并进入 60 秒冷却期。在此期间跳过该供应商，直接尝试下一个。冷却结束后自动恢复。</p>
<h3 data-id="heading-10">3. 响应格式统一</h3>
<p>不管后端用的是哪个模型，返回格式都是统一的 <code>{content, model, provider}</code>，调用方完全不需要关心底层用的是谁。</p>
<h2 data-id="heading-11">进阶优化方向</h2>
<p>这个 100 行版本是最小可用版。生产环境中你可能还需要：</p>

































<table><thead><tr><th>功能</th><th>说明</th></tr></thead><tbody><tr><td>流式响应</td><td>SSE 支持，实现打字机效果</td></tr><tr><td>请求日志</td><td>记录每次请求的模型、耗时、token 数</td></tr><tr><td>成本追踪</td><td>按 token 计费，统计各模型花费</td></tr><tr><td>负载均衡</td><td>多个 API Key 轮询，避免单 Key 限流</td></tr><tr><td>缓存层</td><td>相同请求命中缓存，省钱又快</td></tr><tr><td>鉴权</td><td>给网关加 API Key，防止滥用</td></tr></tbody></table>
<p>如果你不想自己造轮子，市面上也有现成的模型聚合方案：</p>
<ul>
<li><strong>OpenRouter</strong>：国外主流，模型多，但国内访问不稳定</li>
<li><strong>Ofox.ai</strong>：国内可直接用，支持主流模型，适合国内开发者</li>
<li><strong>One-API / New-API</strong>：开源自建方案，需要自己部署维护</li>
</ul>
<h2 data-id="heading-12">总结</h2>
<p>搭一个 AI API 网关并不难，核心就三件事：<strong>统一接口、自动路由、故障转移</strong>。</p>
<p>100 行代码就能解决 90% 的场景。剩下的 10%（流式、缓存、监控），要么自己加，要么用现成的聚合平台。</p>
<p>重点是：<strong>别让你的应用跟任何一个模型供应商绑死</strong>。今天 DeepSeek 最强，明天可能是别人。保持灵活，才能永远用上最好的。</p>
<hr/>
<p><em>觉得有用？点个赞收个藏，这是我继续写的最大动力。有问题评论区见。</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深度分析 RocketMQ 幂等性设计与生产级实现方案]]></title>    <link>https://juejin.cn/post/7604665952320274483</link>    <guid>https://juejin.cn/post/7604665952320274483</guid>    <pubDate>2026-02-09T19:39:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604665952320274483" data-draft-id="7604690250363813897" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深度分析 RocketMQ 幂等性设计与生产级实现方案"/> <meta itemprop="keywords" content="RocketMQ,后端,设计"/> <meta itemprop="datePublished" content="2026-02-09T19:39:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="三水不滴"/> <meta itemprop="url" content="https://juejin.cn/user/283045639753100"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深度分析 RocketMQ 幂等性设计与生产级实现方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/283045639753100/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    三水不滴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T19:39:54.000Z" title="Mon Feb 09 2026 19:39:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">深度分析 RocketMQ 幂等性设计与生产级实现方案</h2>
<h3 data-id="heading-1">一、前言</h3>
<p>在使用 RocketMQ 时，我们必须面对一个事实：<strong>RocketMQ 只保证 At Least Once（至少投递一次），不保证 Exactly Once（精确一次）。</strong></p>
<p>这意味着：<strong>消息重复是必然的，不是偶然的</strong>。如果不做幂等处理，就会出现：</p>
<ul>
<li>重复下单</li>
<li>重复扣款</li>
<li>重复插入数据</li>
<li>数据不一致</li>
</ul>
<p>本文从<strong>重复原因 → 设计原则 → 五大实现方案 → 生产最佳实践</strong>，把 RocketMQ 幂等性讲透。</p>
<hr/>
<h3 data-id="heading-2">二、为什么 RocketMQ 会出现重复消息？</h3>
<p>消息重复主要发生在这几个场景：</p>
<ol>
<li><strong>Producer 重试发送</strong>网络超时、异常、Broker 响应丢失，都会触发重试。</li>
<li><strong>Broker 重试投递</strong>消费失败、超时、断开连接 → 进入重试队列。</li>
<li><strong>Rebalance 重平衡</strong>扩容、缩容、重启导致队列重新分配。</li>
<li><strong>Consumer 提前 ACK</strong>业务没执行完就返回成功，重启后消息再次投递。</li>
</ol>
<p><strong>结论：<strong>RocketMQ <strong>本身不做去重</strong>，去重必须由</strong>业务层实现幂等</strong>。</p>
<hr/>
<h3 data-id="heading-3">三、什么是幂等？</h3>
<p><strong>幂等：同一个消息执行一次与执行多次，结果完全一致。</strong></p>
<p>满足：</p>
<ul>
<li>重复消息不报错</li>
<li>重复消息不产生脏数据</li>
<li>重复消息返回成功</li>
</ul>
<hr/>
<h3 data-id="heading-4">四、RocketMQ 幂等设计核心思路</h3>
<p>实现幂等只需要抓住一点：<strong>识别这条消息是否已经被处理过。</strong></p>
<p>关键标识：</p>
<ol>
<li><strong>msgId</strong>：Broker 生成的唯一 ID</li>
<li><strong>offsetMsgId</strong>：基于物理偏移的 ID</li>
<li><strong>keys</strong>：业务唯一标识（<strong>最推荐</strong>，如订单号、流水号）</li>
</ol>
<p><strong>最佳实践：优先使用业务唯一键。</strong></p>
<hr/>
<h3 data-id="heading-5">五、生产级幂等五大方案（从简单到推荐）</h3>
<h4 data-id="heading-6">方案 1：数据库唯一索引（最简单、最稳定）</h4>
<p>适用场景：insert 类业务（订单、流水、日志）</p>
<p>思路：利用数据库唯一索引约束，重复插入会报错，捕获后视为成功。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">try</span> {
    orderMapper.insert(order);
} <span class="hljs-keyword">catch</span> (DuplicateKeyException e) {
    log.info(<span class="hljs-string">"订单已存在，幂等处理：{}"</span>, orderNo);
}
<span class="hljs-keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;
</code></pre>
<p>优点：</p>
<ul>
<li>实现最简单</li>
<li>天然并发安全</li>
<li>无额外中间件</li>
</ul>
<p>缺点：</p>
<ul>
<li>只适用于插入场景</li>
</ul>
<hr/>
<h4 data-id="heading-7">方案 2：去重表 + 事务（通用强一致）</h4>
<p>适用场景：多表操作、无法加唯一索引</p>
<p>建表：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> message_idempotent (
    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT,
    message_key <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">UNIQUE</span>,
    create_time DATETIME
);
</code></pre>
<p>逻辑：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(String key)</span> {
    <span class="hljs-comment">// 插入去重表</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">rows</span> <span class="hljs-operator">=</span> idempotentMapper.insertIgnore(key);
    <span class="hljs-keyword">if</span> (rows == <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// 已处理</span>
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-comment">// 执行业务逻辑</span>
}
</code></pre>
<p>优点：</p>
<ul>
<li>通用、强一致</li>
<li>与业务事务绑定</li>
</ul>
<hr/>
<h4 data-id="heading-8">方案 3：Redis 分布式锁（高并发首选）</h4>
<p>适用场景：高并发、更新操作、多服务实例</p>
<p>以 <code>messageKey</code> 作为锁标识：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">"mq:idempotent:"</span> + messageKey;
<span class="hljs-type">Boolean</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue()
        .setIfAbsent(key, <span class="hljs-string">"handled"</span>, <span class="hljs-number">24</span>, TimeUnit.HOURS);

<span class="hljs-keyword">if</span> (Boolean.FALSE.equals(lock)) {
    <span class="hljs-keyword">return</span> CONSUME_SUCCESS;
}
<span class="hljs-comment">// 执行业务</span>
</code></pre>
<p>优点：</p>
<ul>
<li>性能极高</li>
<li>适合高并发更新</li>
</ul>
<p>注意：</p>
<ul>
<li>过期时间要足够长（≥24h）</li>
<li>不要使用自动续期</li>
</ul>
<hr/>
<h4 data-id="heading-9">方案 4：状态机幂等（最优雅、企业最爱）</h4>
<p>适用场景：订单、支付、物流等状态流转</p>
<p>例如订单状态：待支付 → 已支付 → 已完成</p>
<p>消费时：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">order</span>
<span class="hljs-keyword">SET</span> status <span class="hljs-operator">=</span> <span class="hljs-number">2</span>
<span class="hljs-keyword">WHERE</span> order_no <span class="hljs-operator">=</span> ? <span class="hljs-keyword">AND</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<ul>
<li>影响行数 = 1 → 第一次处理</li>
<li>影响行数 = 0 → 重复消息，直接返回成功</li>
</ul>
<p>优点：</p>
<ul>
<li>无锁、高性能</li>
<li>天然幂等</li>
<li>业务语义清晰</li>
</ul>
<p><strong>生产环境最推荐方案。</strong></p>
<hr/>
<h4 data-id="heading-10">方案 5：业务唯一标识 + 本地表 + Redis 多级防御</h4>
<p>适用场景：金融、支付核心链路</p>
<p>流程：</p>
<ol>
<li>用业务唯一号做 Redis 去重</li>
<li>用去重表做持久化</li>
<li>用状态机保证安全</li>
</ol>
<p>超高可靠。</p>
<hr/>
<h3 data-id="heading-11">六、RocketMQ 消费端幂等编码模板</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> ConsumeConcurrentlyStatus <span class="hljs-title function_">consumeMessage</span><span class="hljs-params">(
        List&lt;MessageExt&gt; msgs, ConsumeConcurrentlyContext context)</span> {
    <span class="hljs-keyword">for</span> (MessageExt msg : msgs) {
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> msg.getKeys(); <span class="hljs-comment">// 业务唯一键</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 1. 幂等判断：是否已处理</span>
            <span class="hljs-keyword">if</span> (idempotentService.isProcessed(key)) {
                <span class="hljs-keyword">continue</span>;
            }
            <span class="hljs-comment">// 2. 业务处理</span>
            businessService.handle(msg);
            <span class="hljs-comment">// 3. 标记已处理</span>
            idempotentService.markProcessed(key);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"消费异常"</span>, e);
            <span class="hljs-comment">// 异常 → 重试</span>
            <span class="hljs-keyword">return</span> ConsumeConcurrentlyStatus.RECONSUME_LATER;
        }
    }
    <span class="hljs-keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;
}
</code></pre>
<hr/>
<h3 data-id="heading-12">七、幂等设计三大原则</h3>
<ol>
<li><strong>先判断是否处理，再执行业务</strong></li>
<li><strong>幂等判断必须原子性</strong></li>
<li><strong>重复消息直接返回成功，不抛异常</strong></li>
</ol>
<hr/>
<h3 data-id="heading-13">八、经典问题</h3>
<ol>
<li>RocketMQ 是 At Least Once 还是 Exactly Once？</li>
<li>为什么 MQ 不内部实现去重？</li>
<li>消息重复的场景有哪些？</li>
<li>生产中你用什么方案实现幂等？</li>
<li>唯一索引、Redis、状态机三种方案对比？</li>
<li>如何保证幂等高可用？</li>
</ol>
<hr/>
<h3 data-id="heading-14">九、生产最佳实践总结</h3>
<ol>
<li><strong>所有消费端必须做幂等</strong>，不要抱有侥幸</li>
<li><strong>优先使用业务唯一键（keys）</strong></li>
<li><strong>插入用唯一索引，更新用状态机，高并发用 Redis</strong></li>
<li>异常时返回 <strong>RECONSUME_LATER</strong>，不要吞异常</li>
<li>做好<strong>重试、死信、堆积</strong>监控</li>
<li>幂等是架构问题，不是 MQ 问题</li>
</ol>
<hr/>
<h3 data-id="heading-15">十、结语</h3>
<p>RocketMQ 不保证消息不重复，但通过<strong>合理的幂等设计</strong>，可以轻松实现：<strong>重复消息 = 安全跳过 = 最终一致</strong>。</p>
<p>幂等是分布式系统高可用的基础，也是面试与生产的必考点。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[319. Java Stream API - 使用终端收集器]]></title>    <link>https://juejin.cn/post/7604853010162040895</link>    <guid>https://juejin.cn/post/7604853010162040895</guid>    <pubDate>2026-02-09T23:25:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604853010162040895" data-draft-id="7604574877035413547" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="319. Java Stream API - 使用终端收集器"/> <meta itemprop="keywords" content="后端,前端"/> <meta itemprop="datePublished" content="2026-02-09T23:25:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Cache技术分享"/> <meta itemprop="url" content="https://juejin.cn/user/1662117313262776"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            319. Java Stream API - 使用终端收集器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1662117313262776/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Cache技术分享
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T23:25:41.000Z" title="Mon Feb 09 2026 23:25:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">319. Java Stream API - 使用终端收集器</h2>
<p>在 Java 的 <strong>Collector API</strong> 中，有一组非常有用的 <strong>终端收集器（terminal collectors）</strong>，它们与 Stream API 中的终端操作紧密对应。下面，我们来逐一讲解这些收集器的作用、使用方式，以及它们在实际开发中的典型应用场景。</p>
<hr/>
<h3 data-id="heading-1">🔍 1. <code>maxBy()</code> 和 <code>minBy()</code></h3>
<p>这两个收集器用于找出流中的 <strong>最大值或最小值</strong>。
它们接收一个 <code>Comparator</code> 作为参数，并返回一个 <code>Optional&lt;T&gt;</code>。如果流为空，那么返回的 <code>Optional</code> 也是空的。</p>
<h4 data-id="heading-2">📌 示例：</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.*;
<span class="hljs-keyword">import</span> java.util.stream.*;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MaxMinCollectorDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        List&lt;String&gt; names = List.of(<span class="hljs-string">"Alice"</span>, <span class="hljs-string">"Bob"</span>, <span class="hljs-string">"Charlie"</span>, <span class="hljs-string">"David"</span>);

        Optional&lt;String&gt; longestName = names.stream()
            .collect(Collectors.maxBy(Comparator.comparingInt(String::length)));

        Optional&lt;String&gt; shortestName = names.stream()
            .collect(Collectors.minBy(Comparator.comparingInt(String::length)));

        System.out.println(<span class="hljs-string">"Longest name: "</span> + longestName.orElse(<span class="hljs-string">"N/A"</span>));
        System.out.println(<span class="hljs-string">"Shortest name: "</span> + shortestName.orElse(<span class="hljs-string">"N/A"</span>));
    }
}
</code></pre>
<h4 data-id="heading-3">🎯 输出：</h4>
<pre><code class="hljs language-java" lang="java">Longest name: Charlie
Shortest name: Bob
</code></pre>
<hr/>
<h3 data-id="heading-4">➕ 2. <code>summingInt()</code> / <code>summingLong()</code> / <code>summingDouble()</code></h3>
<p>这三个收集器用于对流中的元素进行求和。
你需要传入一个映射函数，将对象映射为 <code>int</code>、<code>long</code> 或 <code>double</code>，然后进行加总。</p>
<h4 data-id="heading-5">📌 示例：</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">record</span> <span class="hljs-title class_">Product</span><span class="hljs-params">(String name, <span class="hljs-type">double</span> price)</span> {}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SumDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        List&lt;Product&gt; products = List.of(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>(<span class="hljs-string">"Pen"</span>, <span class="hljs-number">1.5</span>),
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>(<span class="hljs-string">"Notebook"</span>, <span class="hljs-number">3.0</span>),
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>(<span class="hljs-string">"Pencil"</span>, <span class="hljs-number">0.5</span>)
        );

        <span class="hljs-type">double</span> <span class="hljs-variable">totalPrice</span> <span class="hljs-operator">=</span> products.stream()
            .collect(Collectors.summingDouble(Product::price));

        System.out.println(<span class="hljs-string">"Total price: "</span> + totalPrice);
    }
}
</code></pre>
<h4 data-id="heading-6">🎯 输出：</h4>
<pre><code class="hljs language-java" lang="java">Total price: <span class="hljs-number">5.0</span>
</code></pre>
<hr/>
<h3 data-id="heading-7">📊 3. <code>averagingInt()</code> / <code>averagingLong()</code> / <code>averagingDouble()</code></h3>
<p>这些收集器用于计算平均值，也接受一个映射函数，将对象映射为对应数值类型。
不同于 <code>IntStream.average()</code> 等方法，这些收集器始终返回一个 <code>Double</code> 值，即使流为空时也不会抛异常，而是返回 <code>0.0</code>。</p>
<h4 data-id="heading-8">📌 示例：</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AverageDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        List&lt;String&gt; words = List.of(<span class="hljs-string">"cat"</span>, <span class="hljs-string">"elephant"</span>, <span class="hljs-string">"tiger"</span>, <span class="hljs-string">"lion"</span>);

        <span class="hljs-type">double</span> <span class="hljs-variable">averageLength</span> <span class="hljs-operator">=</span> words.stream()
            .collect(Collectors.averagingInt(String::length));

        System.out.println(<span class="hljs-string">"Average length: "</span> + averageLength);
    }
}
</code></pre>
<h4 data-id="heading-9">🎯 输出：</h4>
<pre><code class="hljs language-java" lang="java">Average length: <span class="hljs-number">5.25</span>
</code></pre>
<p>🧠 <strong>小贴士</strong>：</p>
<ul>
<li><code>averagingInt()</code> 和 <code>IntStream.average()</code> 的区别在于：
<ul>
<li><code>IntStream.average()</code> 返回 <code>OptionalDouble</code>，如果流为空会返回 <code>Optional.empty()</code>；</li>
<li><code>Collectors.averagingInt()</code> 返回 <code>Double</code> 类型，并且空流默认返回 <code>0.0</code>，更安全。</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-10">📌 小结</h3>





























<table><thead><tr><th>收集器名称</th><th>功能描述</th><th>返回类型</th><th>空流处理方式</th></tr></thead><tbody><tr><td><code>maxBy()</code> / <code>minBy()</code></td><td>获取最大 / 最小元素</td><td><code>Optional&lt;T&gt;</code></td><td>返回空 Optional</td></tr><tr><td><code>summingInt()</code> 等</td><td>求和</td><td><code>int</code> / <code>long</code> / <code>double</code></td><td>返回 0</td></tr><tr><td><code>averagingInt()</code> 等</td><td>求平均值</td><td><code>Double</code></td><td>返回 0.0</td></tr></tbody></table>
<hr/>
<p>这些收集器在实际开发中非常常见，尤其适用于统计类、报表类、分析类的处理场景。如果你想基于 <code>Stream</code> 结果进行一些汇总、分析操作，这些工具就是你的好帮手！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从Vue3到React：一场跨越范式的进化之旅]]></title>    <link>https://juejin.cn/post/7604685644684591156</link>    <guid>https://juejin.cn/post/7604685644684591156</guid>    <pubDate>2026-02-10T00:57:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604685644684591156" data-draft-id="7604522883486122018" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从Vue3到React：一场跨越范式的进化之旅"/> <meta itemprop="keywords" content="前端,React.js"/> <meta itemprop="datePublished" content="2026-02-10T00:57:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="青青家的小幸运"/> <meta itemprop="url" content="https://juejin.cn/user/2295436009545944"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从Vue3到React：一场跨越范式的进化之旅
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2295436009545944/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    青青家的小幸运
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T00:57:53.000Z" title="Tue Feb 10 2026 00:57:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><h2 data-id="heading-0">从Vue3到React：一场跨越范式的进化之旅</h2>
<p>作为深耕前端领域7年++的开发者，我曾将Vue3视为"渐进式框架"的完美答案。直到公司决定将核心项目迁移至React生态，这场技术栈的变革让我深刻体会到：​<strong>框架的更迭不是非此即彼的选择，而是开发者认知边界的拓展</strong>。在完成迁移的半年后，我既惊叹于React生态的强大生命力，也愈发珍惜Vue3带来的开发哲学启示。</p>
<hr/>
<h3 data-id="heading-1">一、范式碰撞：两种思维模式的对话</h3>
<h4 data-id="heading-2">1.1 响应式系统的哲学差异</h4>
<p>Vue3的Proxy响应式系统如同精密的瑞士钟表，通过<code>ref</code>和<code>reactive</code>自动追踪数据流动。在开发企业级后台时，我曾享受过<code>watchEffect</code>自动追踪依赖的优雅：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue3数据追踪示例</span>
<span class="hljs-keyword">const</span> userInfo = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">28</span> });
<span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`用户 <span class="hljs-subst">${userInfo.name}</span> 年龄更新为 <span class="hljs-subst">${userInfo.age}</span>`</span>);
});
</code></pre>
<p>而React的<code>useState</code>/<code>useEffect</code>更像乐高积木，需要开发者手动搭建状态管理逻辑。迁移初期，这种显式声明让我倍感繁琐：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// React状态管理对比</span>
<span class="hljs-keyword">const</span> [userInfo, setUserInfo] = <span class="hljs-title function_">useState</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">28</span> });
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`用户 <span class="hljs-subst">${userInfo.name}</span> 年龄更新为 <span class="hljs-subst">${userInfo.age}</span>`</span>);
}, [userInfo]);
</code></pre>
<p>但正是这种显式性，让我在复杂表单处理时避免了Vue中<code>computed</code>属性可能引发的依赖陷阱。</p>
<h4 data-id="heading-3">1.2 组件化开发的殊途同归</h4>
<p>Vue3的单文件组件(SFC)将模板、逻辑、样式封装在<code>.vue</code>文件中，适合快速原型开发：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleSubmit"</span>&gt;</span>{{ loading ? '提交中...' : '提交' }}<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">const</span> form = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">title</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">''</span> });
<span class="hljs-keyword">const</span> { loading } = <span class="hljs-title function_">useLoading</span>();
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>React的函数组件+Hooks模式则更接近原生JavaScript，这种"代码即网页"的直白风格在大型项目中展现出独特优势：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// React组件对比</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">SubmitButton</span> = (<span class="hljs-params">{ loading }</span>) =&gt; (
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">disabled</span>=<span class="hljs-string">{loading}</span>&gt;</span>
    {loading ? '提交中...' : '提交'}
  <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
);
</code></pre>
<p>迁移过程中我发现，​<strong>组件拆分的粒度控制</strong>是两大框架的核心差异：Vue更适合业务逻辑紧密耦合的模块，而React的组件化更强调单一职责原则。</p>
<hr/>
<h3 data-id="heading-4">二、迁移实战：在挑战中寻找突破</h3>
<h4 data-id="heading-5">2.1 状态管理的重构艺术</h4>
<p>将Pinia迁移到Redux Toolkit的过程充满挑战。我们采用渐进式改造策略：</p>
<ol>
<li>​<strong>核心状态层保留Pinia</strong>​：用户认证、全局配置等基础状态继续使用Vuex模式</li>
<li>​<strong>业务逻辑层转向Redux</strong>​：使用<code>createSlice</code>重构表单提交、数据缓存等场景</li>
<li>​<strong>中间件桥接方案</strong>​：通过<code>redux-thunk</code>兼容原有API调用模式</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 混合架构示例</span>
<span class="hljs-comment">// stores/auth.js (Pinia)</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useAuthStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'auth'</span>, {
  <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({ <span class="hljs-attr">token</span>: <span class="hljs-literal">null</span> }),
  <span class="hljs-attr">actions</span>: { login }
})

<span class="hljs-comment">// features/formSlice.js (Redux Toolkit)</span>
<span class="hljs-keyword">const</span> formSlice = <span class="hljs-title function_">createSlice</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'form'</span>,
  <span class="hljs-attr">reducers</span>: { <span class="hljs-attr">submit</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> { <span class="hljs-comment">/* ... */</span> } }
})
</code></pre>
<h4 data-id="heading-6">2.2 路由系统的范式转换</h4>
<p>从<code>vue-router</code>到<code>react-router-dom</code>的迁移需要重构整个导航逻辑：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// Vue3路由配置</span>
const router = <span class="hljs-built_in">createRouter</span>({
  routes: })

<span class="hljs-comment">// React路由配置</span>
const router = <span class="hljs-built_in">createBrowserRouter</span>(})
</code></pre>
<p>我们创新性地采用<strong>混合路由方案</strong>​：核心页面使用React Router，微前端子应用保留Vue Router，通过<code>&lt;iframe&gt;</code>实现无缝衔接。</p>
<hr/>
<h3 data-id="heading-7">三、认知升级：超越框架的开发者思维</h3>
<h4 data-id="heading-8">3.1 性能优化的新维度</h4>
<p>React 19的Server Components彻底改变了渲染范式。在开发数据看板时，我们将实时图表组件转为服务端渲染：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Server Component示例</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">RealTimeChart</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchAnalytics</span>();
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Chart</span> <span class="hljs-attr">data</span>=<span class="hljs-string">{data}</span> /&gt;</span></span>;
}
</code></pre>
<p>这种架构下，首屏加载时间从2.1s骤降至480ms，但代价是失去了Vue中<code>&lt;keep-alive&gt;</code>的组件缓存能力。我们通过<strong>分层缓存策略</strong>弥补缺陷：高频数据走Redis缓存，低频数据使用React Query。</p>
<h4 data-id="heading-9">3.2 开发体验的再定义</h4>
<p>React 19的编译器革命带来了意想不到的收益。在重构旧版表单组件时，编译器自动将<code>useEffect</code>依赖项优化为精确追踪：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 编译前</span>
<span class="hljs-built_in">useEffect</span>(() =&gt; {
  console<span class="hljs-selector-class">.log</span>(value);
}, <span class="hljs-selector-attr">[value]</span>);

<span class="hljs-comment">// 编译后（等效优化）</span>
const memoizedValue = <span class="hljs-built_in">useMemo</span>(() =&gt; value, <span class="hljs-selector-attr">[value]</span>);
<span class="hljs-built_in">useEffect</span>(() =&gt; {
  console<span class="hljs-selector-class">.log</span>(memoizedValue);
}, <span class="hljs-selector-attr">[memoizedValue]</span>);
</code></pre>
<p>这种智能优化让我们在保持代码简洁性的同时，获得接近Vue3的响应式体验。</p>
<hr/>
<h3 data-id="heading-10">四、双向赋能：构建技术中立的世界观</h3>
<h4 data-id="heading-11">4.1 Vue3的持续价值</h4>
<p>在迁移过程中，Vue3的以下特性持续发挥作用：</p>
<ul>
<li>​<strong>组合式API</strong>​：为React Hooks提供了优雅的替代方案</li>
<li>​<strong>编译器增强</strong>​：Vue3的编译器提示帮助我们规避了React中的常见错误</li>
<li>​<strong>生态兼容性</strong>​：通过<code>@vue/compiler-sfc</code>继续维护旧版组件库</li>
</ul>
<h4 data-id="heading-12">4.2 React的进化启示</h4>
<p>React生态的以下创新反向滋养了Vue开发：</p>
<ul>
<li>​<strong>TypeScript深度集成</strong>​：推动我们为Vue3项目添加完整类型定义</li>
<li>​<strong>Web3开发模式</strong>​：借鉴React的<code>useEffect</code>异步模式重构DApp交互逻辑</li>
<li>​<strong>微前端架构</strong>​：采用React的模块联邦方案实现Vue3子应用集成</li>
</ul>
<hr/>
<h3 data-id="heading-13">五、未来展望：框架无关的开发者之路</h3>
<p>站在2026年的时间节点回望，Vue3与React的迁移经历让我领悟到：</p>
<ol>
<li>​<strong>工具是中性的</strong>​：框架只是实现目标的手段，核心在于理解底层原理</li>
<li>​<strong>认知需要迭代</strong>​：保持对新技术的敏感度，但坚守技术判断力</li>
<li>​<strong>生态决定未来</strong>​：React在Web3、AI应用中的优势值得关注，Vue3在可视化、低代码领域的潜力同样不可忽视</li>
</ol>
<p>正如我在团队分享会上常说的：​<strong>​"我们不是Vue开发者或React开发者，而是能用任何工具解决问题的问题解决者。"​</strong>​ 这场框架迁移不是终点，而是打开更广阔技术视野的起点。在未来的项目中，我将继续以开放心态拥抱变化，因为真正的开发者永远在路上。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript Proxy与Reflect]]></title>    <link>https://juejin.cn/post/7604666872127586323</link>    <guid>https://juejin.cn/post/7604666872127586323</guid>    <pubDate>2026-02-10T01:21:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604666872127586323" data-draft-id="7604678037808431140" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript Proxy与Reflect"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-02-10T01:21:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="wuhen_n"/> <meta itemprop="url" content="https://juejin.cn/user/4149996261738233"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript Proxy与Reflect
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4149996261738233/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    wuhen_n
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T01:21:25.000Z" title="Tue Feb 10 2026 01:21:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在 JavaScript 中如何拦截对象的读取、修改、删除操作？Vue3的响应式系统如何实现？本文将深入讲解 JavaScript 的元编程世界，探索 Proxy 和 Reflect 的奥秘。</p>
</blockquote>
<h2 data-id="heading-0">前言：从Vue3的响应式说起</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue3的响应式数据实现原理</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">reactive</span> = (<span class="hljs-params">target</span>) =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(target, {
        <span class="hljs-title function_">get</span>(<span class="hljs-params">target, key, receiver</span>) {
            <span class="hljs-title function_">track</span>(target, key); <span class="hljs-comment">// 依赖收集</span>
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, key, receiver);
        },
        <span class="hljs-title function_">set</span>(<span class="hljs-params">target, key, value, receiver</span>) {
            <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, key, value, receiver);
            <span class="hljs-title function_">trigger</span>(target, key); <span class="hljs-comment">// 触发更新</span>
            <span class="hljs-keyword">return</span> result;
        }
    });
};
</code></pre>
<p>Vue3的响应式数据实现原理的背后，就是 Proxy 和 Reflect 。理解它们，我们就能真正掌握 JavaScript 元编程的能力。</p>
<h2 data-id="heading-1">理解Proxy与Reflect</h2>
<h3 data-id="heading-2">什么是Proxy（代理）？</h3>
<p><strong>Proxy</strong> 对象用于创建一个对象的代理，从而实现对基本操作的拦截和自定义（如属性查找、赋值、枚举、函数调用等）。</p>
<h3 data-id="heading-3">Proxy工作流程示意图</h3>
<pre><code class="hljs language-text" lang="text">
┌─────────┐   操作请求   ┌─────────┐   转发操作    ┌─────────┐
│ 客户端   │───────────→ │  Proxy  │───────────→ │ 目标对象 │
│         │             │  代理    │             │         │
│         │←─────────── │         │←─────────── │         │
└─────────┘   响应结果   └─────────┘   实际结果    └─────────┘
                ↓                           ↓
         ┌─────────────┐            ┌─────────────┐
         │ 拦截和自定义  │            │ 原始行为     │
         │   （陷阱）   │            │             │
         └─────────────┘            └─────────────┘
</code></pre>
<h3 data-id="heading-4">什么是Reflect（反射）？</h3>
<p><strong>Reflect</strong> 是一个内置的对象，它提供拦截 JavaScript 操作的方法。这些方法与 Proxy 的陷阱方法一一对应。</p>
<h3 data-id="heading-5">为什么需要Reflect？</h3>
<ol>
<li>统一的操作API</li>
<li>更好的错误处理（返回布尔值而非抛出异常）</li>
<li>与Proxy陷阱方法一一对应</li>
</ol>
<h2 data-id="heading-6">代理基础：创建第一个代理</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 目标对象</span>
<span class="hljs-keyword">const</span> target = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>
};

<span class="hljs-comment">// 处理器对象（包含陷阱方法）</span>
<span class="hljs-keyword">const</span> handler = {
  <span class="hljs-comment">// 拦截属性读取</span>
  <span class="hljs-title function_">get</span>(<span class="hljs-params">target, property, receiver</span>) {

    <span class="hljs-comment">// 添加自定义逻辑</span>
    <span class="hljs-keyword">if</span> (property === <span class="hljs-string">'age'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${target[property]}</span>岁`</span>;
    }

    <span class="hljs-comment">// 默认行为：使用Reflect</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, property, receiver);
  },

  <span class="hljs-comment">// 拦截属性设置</span>
  <span class="hljs-title function_">set</span>(<span class="hljs-params">target, property, value, receiver</span>) {
    <span class="hljs-comment">// 添加验证逻辑</span>
    <span class="hljs-keyword">if</span> (property === <span class="hljs-string">'age'</span> &amp;&amp; (value &lt; <span class="hljs-number">0</span> || value &gt; <span class="hljs-number">150</span>)) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'年龄必须在0-150之间'</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// 返回false表示设置失败</span>
    }

    <span class="hljs-comment">// 默认行为：使用Reflect</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, property, value, receiver);
  }
};

<span class="hljs-comment">// 创建代理</span>
<span class="hljs-keyword">const</span> proxy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(target, handler);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(proxy.<span class="hljs-property">name</span>);  <span class="hljs-comment">// 张三</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(proxy.<span class="hljs-property">age</span>);   <span class="hljs-comment">// 30岁</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(target.<span class="hljs-property">age</span>); <span class="hljs-comment">// 30</span>
</code></pre>
<h2 data-id="heading-7">13种可拦截的陷阱方法</h2>
<h3 data-id="heading-8">完整陷阱方法概览</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> completeHandler = {
  <span class="hljs-comment">// 1. 属性访问拦截</span>
  <span class="hljs-title function_">get</span>(<span class="hljs-params">target, prop, receiver</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`get: <span class="hljs-subst">${prop}</span>`</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, prop, receiver);
  },

  <span class="hljs-comment">// 2. 属性赋值拦截</span>
  <span class="hljs-title function_">set</span>(<span class="hljs-params">target, prop, value, receiver</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`set: <span class="hljs-subst">${prop}</span> = <span class="hljs-subst">${value}</span>`</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, prop, value, receiver);
  },

  <span class="hljs-comment">// 3. in操作符拦截</span>
  <span class="hljs-title function_">has</span>(<span class="hljs-params">target, prop</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`has: <span class="hljs-subst">${prop}</span>`</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">has</span>(target, prop);
  },

  <span class="hljs-comment">// 4. delete操作符拦截</span>
  <span class="hljs-title function_">deleteProperty</span>(<span class="hljs-params">target, prop</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`delete: <span class="hljs-subst">${prop}</span>`</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">deleteProperty</span>(target, prop);
  },

  <span class="hljs-comment">// 5. 构造函数调用拦截</span>
  <span class="hljs-title function_">construct</span>(<span class="hljs-params">target, args, newTarget</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`construct with args:`</span>, args);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">construct</span>(target, args, newTarget);
  },

  <span class="hljs-comment">// 6. 函数调用拦截</span>
  <span class="hljs-title function_">apply</span>(<span class="hljs-params">target, thisArg, args</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`apply: thisArg=`</span>, thisArg, <span class="hljs-string">'args='</span>, args);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">apply</span>(target, thisArg, args);
  },

  <span class="hljs-comment">// 7. Object.getOwnPropertyDescriptor拦截</span>
  <span class="hljs-title function_">getOwnPropertyDescriptor</span>(<span class="hljs-params">target, prop</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`getOwnPropertyDescriptor: <span class="hljs-subst">${prop}</span>`</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">getOwnPropertyDescriptor</span>(target, prop);
  },

  <span class="hljs-comment">// 8. Object.defineProperty拦截</span>
  <span class="hljs-title function_">defineProperty</span>(<span class="hljs-params">target, prop, descriptor</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`defineProperty: <span class="hljs-subst">${prop}</span>`</span>, descriptor);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">defineProperty</span>(target, prop, descriptor);
  },

  <span class="hljs-comment">// 9. 原型访问拦截</span>
  <span class="hljs-title function_">getPrototypeOf</span>(<span class="hljs-params">target</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'getPrototypeOf'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">getPrototypeOf</span>(target);
  },

  <span class="hljs-comment">// 10. 原型设置拦截</span>
  <span class="hljs-title function_">setPrototypeOf</span>(<span class="hljs-params">target, prototype</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`setPrototypeOf:`</span>, prototype);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">setPrototypeOf</span>(target, prototype);
  },

  <span class="hljs-comment">// 11. 可扩展性判断拦截</span>
  <span class="hljs-title function_">isExtensible</span>(<span class="hljs-params">target</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'isExtensible'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">isExtensible</span>(target);
  },

  <span class="hljs-comment">// 12. 防止扩展拦截</span>
  <span class="hljs-title function_">preventExtensions</span>(<span class="hljs-params">target</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'preventExtensions'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">preventExtensions</span>(target);
  },

  <span class="hljs-comment">// 13. 自身属性枚举拦截</span>
  <span class="hljs-title function_">ownKeys</span>(<span class="hljs-params">target</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ownKeys'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">ownKeys</span>(target);
  }
};
</code></pre>
<h3 data-id="heading-9">陷阱方法详细解析</h3>
<h4 data-id="heading-10">1. get陷阱：属性访问拦截</h4>
<p>get() 会在获取属性值的操作中被调用：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> getHandler = {
  <span class="hljs-title function_">get</span>(<span class="hljs-params">target, property, receiver</span>) {
    <span class="hljs-comment">// 处理不存在的属性</span>
    <span class="hljs-keyword">if</span> (!(property <span class="hljs-keyword">in</span> target)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`属性不存在: <span class="hljs-subst">${property}</span>`</span>);
    }

    <span class="hljs-comment">// 处理私有属性（约定以_开头的属性为私有）</span>
    <span class="hljs-keyword">if</span> (property.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'_'</span>)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`不能访问私有属性: <span class="hljs-subst">${property}</span>`</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, property, receiver);
  }
};
</code></pre>
<ul>
<li>参数说明：
<ol>
<li>target：目标对象</li>
<li>property：引用的目标对象上的属性</li>
<li>receiver：代理对象</li>
</ol>
</li>
<li>返回值说明：返回值无限制</li>
</ul>
<h4 data-id="heading-11">2. set陷阱：属性赋值拦截</h4>
<p>set() 会在设置属性值的操作中被调用：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> setHandler = {
  <span class="hljs-title function_">set</span>(<span class="hljs-params">target, property, value, receiver</span>) {
    <span class="hljs-comment">// 只读属性检查（约定以$开头的属性为只读）</span>
    <span class="hljs-keyword">if</span> (property.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'$'</span>)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`属性不可修改: <span class="hljs-subst">${property}</span>`</span>);
    }
    <span class="hljs-comment">// 执行设置</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, property, value, receiver);
  }
};
</code></pre>
<ul>
<li>参数说明：
<ol>
<li>target：目标对象</li>
<li>property：引用的目标对象上的属性</li>
<li>value：要给属性设置的值</li>
<li>receiver：代理对象</li>
</ol>
</li>
<li>返回值说明：返回 true 表示成功；返回false表示失败。</li>
</ul>
<h4 data-id="heading-12">3. has陷阱：in操作符拦截</h4>
<p>has() 会在 in 操作符中被调用：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> hasHandler = {
  <span class="hljs-title function_">has</span>(<span class="hljs-params">target, property</span>) {
    <span class="hljs-comment">// 隐藏某些属性（不在in操作中暴露）</span>
    <span class="hljs-keyword">const</span> hiddenProperties = [<span class="hljs-string">'password'</span>, <span class="hljs-string">'token'</span>, <span class="hljs-string">'_internal'</span>];
    <span class="hljs-keyword">if</span> (hiddenProperties.<span class="hljs-title function_">includes</span>(property)) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`隐藏属性: <span class="hljs-subst">${property}</span>`</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-comment">// 虚拟属性（不存在但返回true）</span>
    <span class="hljs-keyword">const</span> virtualProperties = [<span class="hljs-string">'isAdmin'</span>, <span class="hljs-string">'hasAccess'</span>];
    <span class="hljs-keyword">if</span> (virtualProperties.<span class="hljs-title function_">includes</span>(property)) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`虚拟属性: <span class="hljs-subst">${property}</span>`</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">has</span>(target, property);
  }
};
</code></pre>
<ul>
<li>参数说明：
<ol>
<li>target：目标对象</li>
<li>value：要给属性设置的值</li>
</ol>
</li>
<li>返回值说明：返回布尔值表示属性是否存在，返回非布尔型会被转成布尔型。</li>
</ul>
<blockquote>
<p>注：Object.keys() 不受 has() 影响，仍会返回所有属性。</p>
</blockquote>
<h4 data-id="heading-13">4. apply陷阱：函数调用拦截</h4>
<p>apply() 会在调用函数时被调用：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> applyHandler = {
  <span class="hljs-title function_">apply</span>(<span class="hljs-params">target, thisArg, argumentsList</span>) {
    <span class="hljs-comment">// 参数验证</span>
    <span class="hljs-keyword">if</span> (target.<span class="hljs-property">name</span> === <span class="hljs-string">'calculate'</span>) {
      <span class="hljs-keyword">if</span> (argumentsList.<span class="hljs-property">length</span> &lt; <span class="hljs-number">2</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'calculate函数需要至少2个参数'</span>);
      }
      <span class="hljs-keyword">if</span> (!argumentsList.<span class="hljs-title function_">every</span>(<span class="hljs-function"><span class="hljs-params">arg</span> =&gt;</span> <span class="hljs-keyword">typeof</span> arg === <span class="hljs-string">'number'</span>)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'calculate函数的所有参数必须是数字'</span>);
      }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">apply</span>(target, thisArg, argumentsList);
  }
};
</code></pre>
<ul>
<li>参数说明：
<ol>
<li>target：目标对象</li>
<li>thisArg：调用函数时的this参数</li>
<li>argumentsList：调用函数时的参数列表</li>
</ol>
</li>
<li>返回值说明：返回值无限制</li>
</ul>
<h4 data-id="heading-14">5. construct陷阱：构造函数拦截</h4>
<p>construct() 会在调用函数时被调用：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> constructHandler = {
  <span class="hljs-title function_">construct</span>(<span class="hljs-params">target, argumentsList, newTarget</span>) {
    <span class="hljs-comment">// 单例模式：确保只有一个实例</span>
    <span class="hljs-keyword">if</span> (target.<span class="hljs-property">_instance</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'返回现有实例'</span>);
      <span class="hljs-keyword">return</span> target.<span class="hljs-property">_instance</span>;
    }

    <span class="hljs-comment">// 创建实例</span>
    <span class="hljs-keyword">const</span> instance = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">construct</span>(target, argumentsList, newTarget);

    <span class="hljs-comment">// 为单例保存实例</span>
    <span class="hljs-keyword">if</span> (target.<span class="hljs-property">name</span> === <span class="hljs-string">'Singleton'</span>) {
      target.<span class="hljs-property">_instance</span> = instance;
    }

    <span class="hljs-comment">// 为实例添加额外属性</span>
    instance.<span class="hljs-property">createdAt</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
    instance.<span class="hljs-property">_id</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>().<span class="hljs-title function_">toString</span>(<span class="hljs-number">36</span>).<span class="hljs-title function_">substr</span>(<span class="hljs-number">2</span>, <span class="hljs-number">9</span>);

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'创建新实例，ID:'</span>, instance.<span class="hljs-property">_id</span>);
    <span class="hljs-keyword">return</span> instance;
  }
};
</code></pre>
<ul>
<li>参数说明：
<ol>
<li>target：目标构造函数</li>
<li>argumentsList：传给目标构造函数的参数列表</li>
<li>newTarget：最初被调用的构造函数</li>
</ol>
</li>
<li>返回值说明：必须返回一个对象</li>
</ul>
<h4 data-id="heading-15">6. ownKeys陷阱：影响Object.keys()等遍历</h4>
<p>ownKeys() 会在Object.keys()及类似方法中被调用：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> ownKeysHandler = {
  <span class="hljs-title function_">ownKeys</span>(<span class="hljs-params">target</span>) {
    <span class="hljs-comment">// 过滤掉以_开头的私有属性</span>
    <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">ownKeys</span>(target);
    <span class="hljs-keyword">return</span> keys.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> key === <span class="hljs-string">'string'</span>) {
        <span class="hljs-keyword">return</span> !key.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'_'</span>);
      }
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    });
  }
};
</code></pre>
<ul>
<li>参数说明：
<ol>
<li>target：目标构造函数</li>
</ol>
</li>
<li>返回值说明：必须返回一个包含字符串或符号的可枚举对象</li>
</ul>
<h4 data-id="heading-16">7. getOwnPropertyDescriptor陷阱：影响Object.getOwnPropertyDescriptor()</h4>
<p>getOwnPropertyDescriptor() 会在Object.getOwnPropertyDescriptor()方法中被调用：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> getOwnPropertyDescriptorHandler = {
  <span class="hljs-title function_">getOwnPropertyDescriptor</span>(<span class="hljs-params">target, prop</span>) {
    <span class="hljs-comment">// 隐藏私有属性的描述符</span>
    <span class="hljs-keyword">if</span> (prop.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'_'</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">getOwnPropertyDescriptor</span>(target, prop);
  }
};
</code></pre>
<ul>
<li>参数说明：
<ol>
<li>target：目标构造函数</li>
<li>prop：引用的目标对象上的字符串属性</li>
</ol>
</li>
<li>返回值说明：必须返回对象，或在属性不存在时返回 undefined</li>
</ul>
<h4 data-id="heading-17">8. defineProperty陷阱：拦截Object.defineProperty()</h4>
<p>defineProperty() 会在Object.defineProperty()方法中被调用：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> definePropertyHandler = {
  <span class="hljs-title function_">defineProperty</span>(<span class="hljs-params">target, prop, descriptor</span>) {
    <span class="hljs-comment">// 防止修改只读属性</span>
    <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">'id'</span> &amp;&amp; target.<span class="hljs-property">id</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'id属性是只读的'</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">defineProperty</span>(target, prop, descriptor);
  }
};
</code></pre>
<ul>
<li>参数说明：
<ol>
<li>target：目标构造函数</li>
<li>prop：引用的目标对象上的字符串属性</li>
<li>descriptor：包含可选的enumrable、configurable、value、get 和 set 等定义的对象</li>
</ol>
</li>
<li>返回值说明：必须返回布尔值，表示属性是否成功定义</li>
</ul>
<h4 data-id="heading-18">9. deleteProperty陷阱：拦截delete操作</h4>
<p>deleteProperty() 会在 delete 操作中被调用：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> deletePropertyHandler = {
  <span class="hljs-title function_">deleteProperty</span>(<span class="hljs-params">target, prop</span>) {
    <span class="hljs-comment">// 防止删除重要属性</span>
    <span class="hljs-keyword">const</span> protectedProps = [<span class="hljs-string">'id'</span>, <span class="hljs-string">'createdAt'</span>];
    <span class="hljs-keyword">if</span> (protectedProps.<span class="hljs-title function_">includes</span>(prop)) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">`不能删除受保护的属性: <span class="hljs-subst">${prop}</span>`</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">deleteProperty</span>(target, prop);
  }
};
</code></pre>
<ul>
<li>参数说明：
<ol>
<li>target：目标构造函数</li>
<li>property：引用的目标对象上的属性</li>
</ol>
</li>
<li>返回值说明：必须返回布尔值，表示属性是否被成功删除</li>
</ul>
<h4 data-id="heading-19">10. preventExtensions陷阱：拦截Object.preventExtensions()</h4>
<p>preventExtensions() 会在 Object.preventExtensions() 方法中被调用：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> preventExtensionsHandler = {
  <span class="hljs-title function_">preventExtensions</span>(<span class="hljs-params">target</span>) {
    <span class="hljs-comment">// 在阻止扩展前添加标记</span>
    target.<span class="hljs-property">_frozenAt</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">preventExtensions</span>(target);
  }
};
</code></pre>
<ul>
<li>参数说明：
<ol>
<li>target：目标构造函数</li>
</ol>
</li>
<li>返回值说明：必须返回布尔值，表示 target 是否已经不可扩展</li>
</ul>
<h4 data-id="heading-20">11. getPrototypeOf陷阱：拦截Object.getPrototypeOf()</h4>
<p>getPrototypeOf() 会在 Object.getPrototypeOf() 方法中被调用：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> getPrototypeOfHandler = {
  <span class="hljs-title function_">getPrototypeOf</span>(<span class="hljs-params">target</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">getPrototypeOf</span>(target);
  }
};
</code></pre>
<ul>
<li>参数说明：
<ol>
<li>target：目标构造函数</li>
</ol>
</li>
<li>返回值说明：必须返回对象或null</li>
</ul>
<h4 data-id="heading-21">12. setPrototypeOf陷阱：拦截Object.setPrototypeOf()</h4>
<p>setPrototypeOf() 会在 Object.setPrototypeOf() 方法中被调用：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> setPrototypeOfHandler = {
  <span class="hljs-title function_">setPrototypeOf</span>(<span class="hljs-params">target, prototype</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">setPrototypeOf</span>(target, prototype);
  }
};
</code></pre>
<ul>
<li>参数说明：
<ol>
<li>target：目标构造函数</li>
<li>property：引用的目标对象上的属性</li>
</ol>
</li>
<li>返回值说明：必须返回布尔值，表示原型赋值是否成功</li>
</ul>
<h4 data-id="heading-22">13. isExtensible陷阱：拦截Object.isExtensible()</h4>
<p>isExtensible() 会在 Object.isExtensible() 方法中被调用：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> isExtensibleHandler = {
  <span class="hljs-title function_">isExtensible</span>(<span class="hljs-params">targete</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">isExtensible</span>(targete);
  }
};
</code></pre>
<ul>
<li>参数说明：
<ol>
<li>target：目标构造函数</li>
</ol>
</li>
<li>返回值说明：必须返回布尔值，表示 target 是否可扩展</li>
</ul>
<h2 data-id="heading-23">可撤销代理</h2>
<h3 data-id="heading-24">什么是可撤销代理？</h3>
<p><strong>可撤销代理</strong>（Revocable Proxy）是一种特殊的代理，它提供了一个 <code>revoke()</code> 方法，调用该方法后，代理将不再可用，所有对代理的操作都会抛出 <code>TypeError</code>，即：会中断代理对象和目标对象之间的联系。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> target = { <span class="hljs-attr">name</span>: <span class="hljs-string">'zhangsan'</span> };
<span class="hljs-keyword">const</span> handler = {
  <span class="hljs-title function_">get</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">'foo'</span>;
  }
}
<span class="hljs-comment">// 创建可撤销代理</span>
<span class="hljs-keyword">const</span> { proxy, revoke } = <span class="hljs-title class_">Proxy</span>.<span class="hljs-title function_">revocable</span>(target, handler);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(proxy.<span class="hljs-property">name</span>); <span class="hljs-comment">// 'zhangsan'</span>

<span class="hljs-comment">// 撤销代理</span>
<span class="hljs-title function_">revoke</span>();

<span class="hljs-comment">// 代理已失效</span>
<span class="hljs-keyword">try</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(proxy.<span class="hljs-property">name</span>); <span class="hljs-comment">// TypeError: Cannot perform 'get' on a proxy that has been revoked</span>
} <span class="hljs-keyword">catch</span> (error) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'错误:'</span>, error.<span class="hljs-property">message</span>);
}
</code></pre>
<h2 data-id="heading-25">实现响应式数据（Vue3原理）</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 简易版Vue3响应式系统</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ReactiveSystem</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">targetMap</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>(); <span class="hljs-comment">// 存储依赖关系</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">effectStack</span> = [];          <span class="hljs-comment">// 当前正在执行的effect</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">batchQueue</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>();    <span class="hljs-comment">// 批量更新队列</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isBatching</span> = <span class="hljs-literal">false</span>;        <span class="hljs-comment">// 是否处于批量更新模式</span>
  }

  <span class="hljs-comment">// 核心：创建响应式对象</span>
  <span class="hljs-title function_">reactive</span>(<span class="hljs-params">target</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(target, {
      <span class="hljs-title function_">get</span>(<span class="hljs-params">target, key, receiver</span>) {
        <span class="hljs-comment">// 获取原始值</span>
        <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, key, receiver);

        <span class="hljs-comment">// 依赖收集</span>
        <span class="hljs-title function_">track</span>(target, key);

        <span class="hljs-comment">// 深度响应式（如果值是对象，继续代理）</span>
        <span class="hljs-keyword">if</span> (result &amp;&amp; <span class="hljs-keyword">typeof</span> result === <span class="hljs-string">'object'</span>) {
          <span class="hljs-keyword">return</span> <span class="hljs-title function_">reactive</span>(result);
        }

        <span class="hljs-keyword">return</span> result;
      },

      <span class="hljs-title function_">set</span>(<span class="hljs-params">target, key, value, receiver</span>) {
        <span class="hljs-comment">// 获取旧值</span>
        <span class="hljs-keyword">const</span> oldValue = target[key];

        <span class="hljs-comment">// 设置新值</span>
        <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, key, value, receiver);

        <span class="hljs-comment">// 触发更新（值确实改变时才触发）</span>
        <span class="hljs-keyword">if</span> (oldValue !== value) {
          <span class="hljs-title function_">trigger</span>(target, key);
        }

        <span class="hljs-keyword">return</span> result;
      },

      <span class="hljs-comment">// 处理删除操作</span>
      <span class="hljs-title function_">deleteProperty</span>(<span class="hljs-params">target, key</span>) {
        <span class="hljs-keyword">const</span> hasKey = key <span class="hljs-keyword">in</span> target;
        <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">deleteProperty</span>(target, key);

        <span class="hljs-keyword">if</span> (hasKey &amp;&amp; result) {
          <span class="hljs-title function_">trigger</span>(target, key);
        }

        <span class="hljs-keyword">return</span> result;
      }
    });
  }

  <span class="hljs-comment">// 依赖收集</span>
  <span class="hljs-title function_">track</span>(<span class="hljs-params">target, key</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">effectStack</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">let</span> depsMap = <span class="hljs-variable language_">this</span>.<span class="hljs-property">targetMap</span>.<span class="hljs-title function_">get</span>(target);
    <span class="hljs-keyword">if</span> (!depsMap) {
      depsMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">targetMap</span>.<span class="hljs-title function_">set</span>(target, depsMap);
    }

    <span class="hljs-keyword">let</span> dep = depsMap.<span class="hljs-title function_">get</span>(key);
    <span class="hljs-keyword">if</span> (!dep) {
      dep = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>();
      depsMap.<span class="hljs-title function_">set</span>(key, dep);
    }

    <span class="hljs-comment">// 收集当前正在执行的effect</span>
    <span class="hljs-keyword">const</span> activeEffect = <span class="hljs-variable language_">this</span>.<span class="hljs-property">effectStack</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">effectStack</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>];
    <span class="hljs-keyword">if</span> (activeEffect) {
      dep.<span class="hljs-title function_">add</span>(activeEffect);
      <span class="hljs-comment">// effect也需要知道哪些依赖收集了它</span>
      activeEffect.<span class="hljs-property">deps</span>.<span class="hljs-title function_">push</span>(dep);
    }
  }

  <span class="hljs-comment">// 触发更新</span>
  <span class="hljs-title function_">trigger</span>(<span class="hljs-params">target, key</span>) {
    <span class="hljs-keyword">const</span> depsMap = <span class="hljs-variable language_">this</span>.<span class="hljs-property">targetMap</span>.<span class="hljs-title function_">get</span>(target);
    <span class="hljs-keyword">if</span> (!depsMap) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">const</span> dep = depsMap.<span class="hljs-title function_">get</span>(key);
    <span class="hljs-keyword">if</span> (dep) {
      <span class="hljs-comment">// 如果是批量更新模式，加入队列</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isBatching</span>) {
        dep.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">effect</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">batchQueue</span>.<span class="hljs-title function_">add</span>(effect));
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 立即执行所有依赖的effect</span>
        dep.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">effect</span> =&gt;</span> {
          <span class="hljs-keyword">if</span> (effect !== <span class="hljs-variable language_">this</span>.<span class="hljs-property">effectStack</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">effectStack</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>]) {
            effect.<span class="hljs-title function_">run</span>();
          }
        });
      }
    }
  }

  <span class="hljs-comment">// 创建effect（副作用）</span>
  <span class="hljs-title function_">effect</span>(<span class="hljs-params">fn</span>) {
    <span class="hljs-keyword">const</span> effect = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReactiveEffect</span>(fn, <span class="hljs-variable language_">this</span>);
    effect.<span class="hljs-title function_">run</span>();

    <span class="hljs-comment">// 返回停止函数</span>
    <span class="hljs-keyword">const</span> runner = effect.<span class="hljs-property">run</span>.<span class="hljs-title function_">bind</span>(effect);
    runner.<span class="hljs-property">effect</span> = effect;
    runner.<span class="hljs-property">stop</span> = <span class="hljs-function">() =&gt;</span> effect.<span class="hljs-title function_">stop</span>();

    <span class="hljs-keyword">return</span> runner;
  }

  <span class="hljs-comment">// 开始批量更新</span>
  <span class="hljs-title function_">batchStart</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isBatching</span> = <span class="hljs-literal">true</span>;
  }

  <span class="hljs-comment">// 结束批量更新</span>
  <span class="hljs-title function_">batchEnd</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isBatching</span> = <span class="hljs-literal">false</span>;

    <span class="hljs-comment">// 执行队列中的所有effect</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">batchQueue</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">effect</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (effect !== <span class="hljs-variable language_">this</span>.<span class="hljs-property">effectStack</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">effectStack</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>]) {
        effect.<span class="hljs-title function_">run</span>();
      }
    });

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">batchQueue</span>.<span class="hljs-title function_">clear</span>();
  }

  <span class="hljs-comment">// computed计算属性</span>
  <span class="hljs-title function_">computed</span>(<span class="hljs-params">getter</span>) {
    <span class="hljs-keyword">let</span> value;
    <span class="hljs-keyword">let</span> dirty = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">const</span> runner = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">effect</span>(<span class="hljs-function">() =&gt;</span> {
      value = <span class="hljs-title function_">getter</span>();
      dirty = <span class="hljs-literal">false</span>;
    });

    <span class="hljs-keyword">return</span> {
      <span class="hljs-keyword">get</span> <span class="hljs-title function_">value</span>() {
        <span class="hljs-keyword">if</span> (dirty) {
          <span class="hljs-title function_">runner</span>();
        }
        <span class="hljs-keyword">return</span> value;
      }
    };
  }

  <span class="hljs-comment">// watch侦听器</span>
  <span class="hljs-title function_">watch</span>(<span class="hljs-params">source, callback, options = {}</span>) {
    <span class="hljs-keyword">let</span> getter;

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> source === <span class="hljs-string">'function'</span>) {
      getter = source;
    } <span class="hljs-keyword">else</span> {
      getter = <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">traverse</span>(source);
    }

    <span class="hljs-keyword">let</span> oldValue;
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">job</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-keyword">const</span> newValue = <span class="hljs-title function_">runner</span>();
      <span class="hljs-title function_">callback</span>(newValue, oldValue);
      oldValue = newValue;
    };

    <span class="hljs-keyword">const</span> runner = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">effect</span>(getter, {
      <span class="hljs-attr">lazy</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">scheduler</span>: job
    });

    oldValue = <span class="hljs-title function_">runner</span>();

    <span class="hljs-keyword">if</span> (options.<span class="hljs-property">immediate</span>) {
      <span class="hljs-title function_">job</span>();
    }
  }

  <span class="hljs-comment">// 深度遍历对象（用于watch）</span>
  <span class="hljs-title function_">traverse</span>(<span class="hljs-params">value, seen = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Set</span>()</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value !== <span class="hljs-string">'object'</span> || value === <span class="hljs-literal">null</span> || seen.<span class="hljs-title function_">has</span>(value)) {
      <span class="hljs-keyword">return</span> value;
    }

    seen.<span class="hljs-title function_">add</span>(value);

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> value) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">traverse</span>(value[key], seen);
    }

    <span class="hljs-keyword">return</span> value;
  }
}

<span class="hljs-comment">// 响应式effect类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ReactiveEffect</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">fn, scheduler</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">fn</span> = fn;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">scheduler</span> = scheduler;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">deps</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">active</span> = <span class="hljs-literal">true</span>;
  }

  <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">active</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">try</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">scheduler</span>.<span class="hljs-property">effectStack</span>.<span class="hljs-title function_">push</span>(<span class="hljs-variable language_">this</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">fn</span>();
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">scheduler</span>.<span class="hljs-property">effectStack</span>.<span class="hljs-title function_">pop</span>();
    }
  }

  <span class="hljs-title function_">stop</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">active</span>) {
      <span class="hljs-comment">// 从所有依赖中移除自己</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">deps</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">dep</span> =&gt;</span> dep.<span class="hljs-title function_">delete</span>(<span class="hljs-variable language_">this</span>));
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">deps</span>.<span class="hljs-property">length</span> = <span class="hljs-number">0</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">active</span> = <span class="hljs-literal">false</span>;
    }
  }
}
</code></pre>
<h2 data-id="heading-26">实现不可变数据（immer.js原理）</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 简易版immer实现</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Immer</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">baseState</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">baseState</span> = baseState;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">draft</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createDraft</span>(baseState);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isModified</span> = <span class="hljs-literal">false</span>;
  }

  <span class="hljs-comment">// 创建草稿（代理）</span>
  <span class="hljs-title function_">createDraft</span>(<span class="hljs-params">base</span>) {
    <span class="hljs-comment">// 如果不是对象，直接返回</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> base !== <span class="hljs-string">'object'</span> || base === <span class="hljs-literal">null</span>) {
      <span class="hljs-keyword">return</span> base;
    }

    <span class="hljs-comment">// 处理数组</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(base)) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createArrayDraft</span>(base);
    }

    <span class="hljs-comment">// 处理对象</span>
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createObjectDraft</span>(base);
  }

  <span class="hljs-comment">// 创建对象草稿</span>
  <span class="hljs-title function_">createObjectDraft</span>(<span class="hljs-params">base</span>) {
    <span class="hljs-keyword">const</span> draft = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(base) ? [] : {};

    <span class="hljs-comment">// 复制所有属性</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> base) {
      <span class="hljs-keyword">if</span> (base.<span class="hljs-title function_">hasOwnProperty</span>(key)) {
        draft[key] = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createDraft</span>(base[key]);
      }
    }

    <span class="hljs-comment">// 创建代理</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(draft, {
      <span class="hljs-attr">get</span>: <span class="hljs-function">(<span class="hljs-params">target, prop, receiver</span>) =&gt;</span> {
        <span class="hljs-comment">// 特殊属性处理</span>
        <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">'__immer_draft__'</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">'__immer_original__'</span>) <span class="hljs-keyword">return</span> base;

        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, prop, receiver);
      },

      <span class="hljs-attr">set</span>: <span class="hljs-function">(<span class="hljs-params">target, prop, value, receiver</span>) =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">isModified</span> = <span class="hljs-literal">true</span>;

        <span class="hljs-comment">// 如果新值是普通值，直接设置</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value !== <span class="hljs-string">'object'</span> || value === <span class="hljs-literal">null</span>) {
          <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, prop, value, receiver);
        }

        <span class="hljs-comment">// 如果新值是草稿，获取其最终状态</span>
        <span class="hljs-keyword">if</span> (value.<span class="hljs-property">__immer_draft__</span>) {
          value = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">finalize</span>(value);
        }

        <span class="hljs-comment">// 如果新值是对象，创建新的草稿</span>
        <span class="hljs-keyword">const</span> newDraft = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createDraft</span>(value);
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, prop, newDraft, receiver);
      },

      <span class="hljs-attr">deleteProperty</span>: <span class="hljs-function">(<span class="hljs-params">target, prop</span>) =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">isModified</span> = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">deleteProperty</span>(target, prop);
      }
    });
  }

  <span class="hljs-comment">// 创建数组草稿（需要特殊处理）</span>
  <span class="hljs-title function_">createArrayDraft</span>(<span class="hljs-params">base</span>) {
    <span class="hljs-keyword">const</span> draft = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createObjectDraft</span>(base);

    <span class="hljs-comment">// 代理数组方法</span>
    <span class="hljs-keyword">const</span> arrayMethods = [<span class="hljs-string">'push'</span>, <span class="hljs-string">'pop'</span>, <span class="hljs-string">'shift'</span>, <span class="hljs-string">'unshift'</span>, <span class="hljs-string">'splice'</span>, <span class="hljs-string">'sort'</span>, <span class="hljs-string">'reverse'</span>];

    arrayMethods.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">method</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> originalMethod = <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>[method];

      draft[method] = <span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">isModified</span> = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">return</span> originalMethod.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);
      }.<span class="hljs-title function_">bind</span>({ <span class="hljs-attr">isModified</span>: <span class="hljs-literal">false</span> }); <span class="hljs-comment">// 这里简化处理</span>
    });

    <span class="hljs-keyword">return</span> draft;
  }

  <span class="hljs-comment">// 获取草稿</span>
  <span class="hljs-title function_">getDraft</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">draft</span>;
  }

  <span class="hljs-comment">// 完成修改，生成新状态</span>
  <span class="hljs-title function_">produce</span>(<span class="hljs-params">producer</span>) {
    <span class="hljs-comment">// 执行生产者函数</span>
    <span class="hljs-title function_">producer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">draft</span>);

    <span class="hljs-comment">// 如果没有修改，返回原状态</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">isModified</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">baseState</span>;
    }

    <span class="hljs-comment">// 最终化草稿，生成新状态</span>
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">finalize</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">draft</span>);
  }

  <span class="hljs-comment">// 最终化草稿（将草稿转换为普通对象）</span>
  <span class="hljs-title function_">finalize</span>(<span class="hljs-params">draft</span>) {
    <span class="hljs-comment">// 如果不是草稿，直接返回</span>
    <span class="hljs-keyword">if</span> (!draft || !draft.<span class="hljs-property">__immer_draft__</span>) {
      <span class="hljs-keyword">return</span> draft;
    }

    <span class="hljs-keyword">const</span> original = draft.<span class="hljs-property">__immer_original__</span>;
    <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(original) ? [] : {};
    <span class="hljs-keyword">let</span> hasChanges = <span class="hljs-literal">false</span>;

    <span class="hljs-comment">// 收集所有键（包括原对象和新对象）</span>
    <span class="hljs-keyword">const</span> allKeys = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([
      ...<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(original || {}),
      ...<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(draft)
    ]);

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">of</span> allKeys) {
      <span class="hljs-keyword">const</span> originalValue = original ? original[key] : <span class="hljs-literal">undefined</span>;
      <span class="hljs-keyword">const</span> draftValue = draft[key];

      <span class="hljs-comment">// 如果属性被删除</span>
      <span class="hljs-keyword">if</span> (!(key <span class="hljs-keyword">in</span> draft)) {
        hasChanges = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">continue</span>;
      }

      <span class="hljs-comment">// 如果值是草稿，递归最终化</span>
      <span class="hljs-keyword">if</span> (draftValue &amp;&amp; draftValue.<span class="hljs-property">__immer_draft__</span>) {
        <span class="hljs-keyword">const</span> finalized = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">finalize</span>(draftValue);
        <span class="hljs-keyword">if</span> (finalized !== originalValue) {
          hasChanges = <span class="hljs-literal">true</span>;
          result[key] = finalized;
        } <span class="hljs-keyword">else</span> {
          result[key] = originalValue;
        }
      }
      <span class="hljs-comment">// 如果值被修改</span>
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (draftValue !== originalValue) {
        hasChanges = <span class="hljs-literal">true</span>;
        result[key] = draftValue;
      }
      <span class="hljs-comment">// 值未修改</span>
      <span class="hljs-keyword">else</span> {
        result[key] = originalValue;
      }
    }

    <span class="hljs-keyword">return</span> hasChanges ? result : original;
  }
}

<span class="hljs-comment">// 简化API</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">produce</span>(<span class="hljs-params">baseState, producer</span>) {
  <span class="hljs-keyword">const</span> immer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Immer</span>(baseState);
  <span class="hljs-keyword">return</span> immer.<span class="hljs-title function_">produce</span>(producer);
}

</code></pre>
<h2 data-id="heading-27">结语</h2>
<p>Proxy和Reflect开启了JavaScript元编程的新篇章，它们不仅是框架开发的利器，也是理解现代JavaScript运行时特性的关键。对于文章中错误的地方或者有任何问题，欢迎在评论区留言讨论！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用 oxlint + oxfmt 替换 ESLint + Prettier]]></title>    <link>https://juejin.cn/post/7604685644684673076</link>    <guid>https://juejin.cn/post/7604685644684673076</guid>    <pubDate>2026-02-10T01:19:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604685644684673076" data-draft-id="7604685644684640308" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用 oxlint + oxfmt 替换 ESLint + Prettier"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-10T01:19:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Whbbit1999"/> <meta itemprop="url" content="https://juejin.cn/user/2225067267209288"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用 oxlint + oxfmt 替换 ESLint + Prettier
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2225067267209288/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Whbbit1999
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T01:19:44.000Z" title="Tue Feb 10 2026 01:19:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近我将自己的 Nest 项目中的 ESLint 和 Prettier 替换为 oxlint 和 oxfmt，至今运行良好。最明显的改善是速度：原先完整的 lint 检查需要 10 多秒，现在仅需 1 秒左右；保存文件时的格式化也几乎无感延迟。今天就来分享一下为什么要做这个替换，以及如何平滑迁移。</p>
<h2 data-id="heading-0">什么是 oxlint 和 oxfmt</h2>
<p>两者都属于 <strong>oxc</strong> 项目（一个用 Rust 编写的高性能 JavaScript/TypeScript 工具链）。</p>
<ul>
<li><strong>oxlint</strong> 对标 ESLint，用于代码质量检查。</li>
<li><strong>oxfmt</strong> 对标 Prettier，用于代码自动格式化。</li>
</ul>
<p>目前它们已实现绝大多数常用规则与配置选项，兼容性良好，完全能满足日常开发需求。</p>
<p>由于采用 Rust 编写，它们在性能上具有数量级优势，同时保持了与现有配置相似的迁移体验。</p>
<h2 data-id="heading-1">为什么选择它们？</h2>
<ol>
<li><strong>极致的速度</strong>：相比 ESLint，oxlint 在大型项目中通常快 50 倍以上；oxfmt 也远快于 Prettier，尤其在实时格式化时感知明显。</li>
<li><strong>高度兼容</strong>：支持常见的 ESLint 规则（包括 TypeScript）和 Prettier 配置方式，迁移成本低。</li>
<li><strong>迁移简单</strong>：配置结构与原有工具相似，大部分规则名称一致，只需少量调整即可接入。</li>
<li><strong>专注替代</strong>：相比于一体化工具链（如 Biome），oxlint/oxfmt 更专注于直接替代 ESLint/Prettier，对现有项目改造更友好。</li>
</ol>
<p>如果你正在寻找更快的代码检查与格式化方案，且不希望大幅改动配置，oxlint + oxfmt 是一个值得尝试的选择。它们不仅带来了开发体验上的流畅感，也延续了熟悉的配置方式，是目前 Rust 工具链中迁移成本较低的一套方案。</p>
<h2 data-id="heading-2">在现有项目中我们如何将eslint + prettier替换为 oxlint 和oxfmt</h2>
<p>我这里有一个之前的 nest 项目，使用的是 eslint + prettier的方案，我们一起将它改造一下。具体改造步骤如下：</p>
<h3 data-id="heading-3">1. 安装依赖</h3>
<pre><code class="hljs language-shell" lang="shell">pnpm add -D oxlint oxfmt
</code></pre>
<h3 data-id="heading-4">2. 改造脚本</h3>
<p>将之前使用 ESLint 和 Prettier 的脚本改成使用 oxlint 和 oxfmt</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"lint:check"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"oxlint"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"lint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"oxlint --fix"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"fmt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"oxfmt"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"fmt:check"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"oxfmt --check"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-5">3. 运行迁移脚本</h3>
<ul>
<li>Prettier 迁移</li>
</ul>
<pre><code class="hljs language-shell" lang="shell">pnpm dlx oxfmt --migrate prettier
</code></pre>
<ul>
<li>ESLint 迁移</li>
</ul>
<pre><code class="hljs language-shell" lang="shell">pnpm dlx @oxlint/migrate ./eslint.config.mjs
</code></pre>
<ul>
<li>限制它们的运行范围</li>
</ul>
<p>这里我不需要它来格式化 <code>drizzle</code> 和 <code>dist</code> 中的文件，我们需要在 <code>.oxfmtrc.json</code> 和 <code>.oxlintrc.json</code> 中添加以下代码。你可以根据你要限制的范围来配置</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"ignorePatterns"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"drizzle/**"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"dist/**/*"</span><span class="hljs-punctuation">]</span>
</code></pre>
<ul>
<li>删除之前的 <code>.prettierrc</code></li>
<li>删除 eslint.config.mjs 中的 prettier 插件</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> eslintPluginPrettierRecommended <span class="hljs-keyword">from</span> <span class="hljs-string">'eslint-plugin-prettier/recommended'</span>; <span class="hljs-comment">// [!code --]</span>
<span class="hljs-comment">// 其他内容</span>
eslintPluginPrettierRecommended, <span class="hljs-comment">// [!code --]</span>
</code></pre>
<ul>
<li>移除 prettier 插件</li>
</ul>
<pre><code class="hljs language-shell" lang="shell">pnpm remove prettier
</code></pre>
<h3 data-id="heading-6">4. 添加 vscode 配置</h3>
<p><code>.vscode/extensions.json</code> 中添加 oxc 插件</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"recommendations"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"oxc.oxc-vscode"</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<blockquote>
<p>这是让别人在使用该项目时 vscode 提示该项目需要安装 oxc</p>
</blockquote>
<p><code>.vscode/settings.json</code> 改造</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"oxc.fmt.configPath"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">".oxfmtrc.json"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"editor.defaultFormatter"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"oxc.oxc-vscode"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"editor.formatOnSave"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"[javascript]"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"editor.defaultFormatter"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"oxc.oxc-vscode"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"editor.formatOnSave"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"[typescript]"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"editor.defaultFormatter"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"oxc.oxc-vscode"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"editor.formatOnSave"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-7">5. 运行脚本检查是否可以正确格式化</h3>
<h3 data-id="heading-8">两者运行速度对比</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d10aeb99ac7461d9465d0f01fa83c64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgV2hiYml0MTk5OQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771291186&amp;x-signature=57ypc6Wf8kKu792lfatEM02DBmc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3402f401c6984b638648deddbf4900b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgV2hiYml0MTk5OQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771291186&amp;x-signature=2oBqxTZLBSGLCuw7GkrlwN5zLqA%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[uni-app x 实战编程技巧：从高效开发到性能拉满，附可直接复用代码]]></title>    <link>https://juejin.cn/post/7604685644684722228</link>    <guid>https://juejin.cn/post/7604685644684722228</guid>    <pubDate>2026-02-10T01:24:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604685644684722228" data-draft-id="7604522883487121442" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="uni-app x 实战编程技巧：从高效开发到性能拉满，附可直接复用代码"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-10T01:24:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="运行快乐"/> <meta itemprop="url" content="https://juejin.cn/user/1212117848963450"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            uni-app x 实战编程技巧：从高效开发到性能拉满，附可直接复用代码
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1212117848963450/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    运行快乐
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T01:24:18.000Z" title="Tue Feb 10 2026 01:24:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>前言：uni-app x 作为 DCloud 推出的新一代跨端开发框架，基于 uts 语言打造，实现了真正的原生渲染、跨端一致体验，同时兼容 Vue 语法，成为越来越多前端开发者的首选跨端方案。但很多开发者在使用过程中，仍会遇到“写法繁琐、性能瓶颈、跨端兼容踩坑”等问题，导致开发效率低下，最终项目体验不佳。<br/>
本文聚焦 uni-app x 实战开发中的高频场景，拆解 8 个可直接落地的编程技巧，涵盖 uts 语法优化、原生能力调用、性能优化、避坑指南等核心维度，每个技巧均配套完整代码示例和场景说明，新手能快速上手，进阶开发者可直接复用提升效率，助力大家用 uni-app x 快速开发高质量跨端应用，同时适配 CSDN 引流需求，收藏+点赞+评论拉满！</p>
<h2 data-id="heading-0"><strong>一、uts 语法高效用法：告别冗余，提升代码可维护性</strong></h2>
<p>uni-app x 以 uts（Uni TypeScript）为核心开发语言，兼容 TypeScript 语法，同时新增了原生类型、跨端接口等特性，用好 uts 能大幅减少冗余代码，降低后期维护成本。</p>
<h3 data-id="heading-1"><strong>技巧1： uts 类型定义复用，避免重复编码</strong></h3>
<p>痛点：开发中经常需要重复定义相同的接口类型（如接口返回数据、组件Props），不仅冗余，还容易出现类型不一致问题。</p>
<p>技巧：利用 uts 的 interface 和 type 特性，封装公共类型，全局复用，同时结合泛型适配多场景。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/typings/common.uts</span>
<span class="hljs-comment">// 1. 封装公共响应体类型（接口请求通用）</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApiResponse</span>&lt;T&gt; {
  <span class="hljs-attr">code</span>: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// 状态码</span>
  <span class="hljs-attr">msg</span>: <span class="hljs-built_in">string</span>;  <span class="hljs-comment">// 提示信息</span>
  <span class="hljs-attr">data</span>: T;      <span class="hljs-comment">// 响应数据（泛型适配不同接口）</span>
  <span class="hljs-attr">timestamp</span>: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// 时间戳</span>
}

<span class="hljs-comment">// 2. 封装分页参数类型（列表请求通用）</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">PageParams</span> = {
  <span class="hljs-attr">pageNum</span>: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// 页码</span>
  <span class="hljs-attr">pageSize</span>: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// 每页条数</span>
  keyword?: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 可选搜索关键词</span>
};

<span class="hljs-comment">// 3. 业务相关类型（如用户信息）</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserInfo</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">username</span>: <span class="hljs-built_in">string</span>;
  avatar?: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">role</span>: <span class="hljs-string">'admin'</span> | <span class="hljs-string">'user'</span>; <span class="hljs-comment">// 联合类型限定取值</span>
}

<span class="hljs-comment">// 实战使用（页面/组件中）</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ApiResponse</span>, <span class="hljs-title class_">PageParams</span>, <span class="hljs-title class_">UserInfo</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/typings/common.uts'</span>;

<span class="hljs-comment">// 请求用户列表（泛型指定data类型）</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getUserList</span>(<span class="hljs-params">params: PageParams</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">ApiResponse</span>&lt;<span class="hljs-title class_">UserInfo</span>[]&gt;&gt; {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> uni.<span class="hljs-title function_">request</span>({
    <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/user/list'</span>,
    <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>,
    <span class="hljs-attr">data</span>: params
  });
  <span class="hljs-keyword">return</span> res.<span class="hljs-property">data</span>;
}
</code></pre>
<p>注意：类型文件建议统一放在 src/typings 目录下，方便全局引入；泛型的合理使用能减少重复定义，提升代码灵活性，尤其适合接口请求场景。</p>
<h3 data-id="heading-2"><strong>技巧2： uts 异步处理优化，替代传统回调</strong></h3>
<p>痛点：uni-app x 中部分原生接口仍支持回调写法，嵌套层级多，代码可读性差，容易出现“回调地狱”。</p>
<p>技巧：利用 async/await 封装回调式接口，同时结合 try/catch 统一处理异常，简化代码逻辑。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/utils/uniAsync.uts</span>
<span class="hljs-comment">// 封装uni.getSystemInfo回调接口为Promise形式</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getSystemInfoAsync</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">UniApp</span>.<span class="hljs-property">GetSystemInfoResult</span>&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    uni.<span class="hljs-title function_">getSystemInfo</span>({
      <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> <span class="hljs-title function_">resolve</span>(res),
      <span class="hljs-attr">fail</span>: <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> <span class="hljs-title function_">reject</span>(err)
    });
  });
}

<span class="hljs-comment">// 封装uni.showActionSheet接口</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">showActionSheetAsync</span>(<span class="hljs-params">options: UniApp.ShowActionSheetOptions</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">UniApp</span>.<span class="hljs-property">ShowActionSheetSuccessCallbackResult</span>&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    uni.<span class="hljs-title function_">showActionSheet</span>({
      ...options,
      <span class="hljs-attr">success</span>: resolve,
      <span class="hljs-attr">fail</span>: reject
    });
  });
}

<span class="hljs-comment">// 实战使用（页面中）</span>
<span class="hljs-keyword">import</span> { getSystemInfoAsync } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/uniAsync.uts'</span>;

<span class="hljs-title function_">onLoad</span>(<span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 异步获取系统信息，无需嵌套回调</span>
    <span class="hljs-keyword">const</span> systemInfo = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getSystemInfoAsync</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'系统信息：'</span>, systemInfo);
    <span class="hljs-comment">// 后续逻辑（如根据系统类型适配布局）</span>
    <span class="hljs-keyword">if</span> (systemInfo.<span class="hljs-property">platform</span> === <span class="hljs-string">'android'</span>) {
      <span class="hljs-comment">// 安卓端适配</span>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (systemInfo.<span class="hljs-property">platform</span> === <span class="hljs-string">'ios'</span>) {
      <span class="hljs-comment">// iOS端适配</span>
    }
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-comment">// 统一异常处理</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'获取系统信息失败：'</span>, err);
    uni.<span class="hljs-title function_">showToast</span>({ <span class="hljs-attr">title</span>: <span class="hljs-string">'获取系统信息失败'</span>, <span class="hljs-attr">icon</span>: <span class="hljs-string">'none'</span> });
  }
})
</code></pre>
<p>延伸：可将常用的回调式接口（如 uni.chooseImage、uni.getStorage）全部封装为 Promise 形式，放在 utils 目录下，全局复用，大幅提升开发效率。</p>
<h3 data-id="heading-3"><strong>二、原生能力调用技巧：简化配置，发挥 uni-app x 核心优势</strong></h3>
<p>uni-app x 最大的优势的是“一次编码，多端原生渲染”，但很多开发者在调用原生能力时，仍会出现配置繁琐、调用失败等问题，以下技巧可快速解决。</p>
<h3 data-id="heading-4"><strong>技巧3： 原生组件按需注册，减少包体积</strong></h3>
<p>痛点：uni-app x 支持全局注册原生组件，但全局注册过多组件会导致包体积增大，影响应用启动速度。</p>
<p>技巧：采用“局部注册”模式，只在需要使用组件的页面/组件中注册，同时利用 easycom 自动注册特性，简化配置（无需手动引入组件）。</p>
<pre><code class="hljs language-javascript" lang="javascript">&lt;!-- 页面组件：pages/index/index.<span class="hljs-property">vue</span> --&amp;gt;
&amp;lt;template&amp;gt;
  &amp;lt;view&amp;gt;
    &lt;!-- 直接使用组件，无需手动<span class="hljs-keyword">import</span>和components注册 --&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">uni-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleClick"</span>&gt;</span>原生按钮<span class="hljs-tag">&lt;/<span class="hljs-name">uni-button</span>&gt;</span></span>
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">uni-list</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">uni-list-item</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"列表项1"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">uni-list-item</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">uni-list</span>&gt;</span></span>
  &lt;/view&gt;
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"uts"</span>&gt;</span><span class="javascript">
<span class="hljs-comment">// 无需手动注册uni-button、uni-list（easycom自动注册）</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params"/>) =&gt; {
  uni.<span class="hljs-title function_">showToast</span>({ <span class="hljs-attr">title</span>: <span class="hljs-string">'点击成功'</span> });
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="hljs-comment">// 配置说明（pages.json）</span>
{
  <span class="hljs-string">"easycom"</span>: {
    <span class="hljs-comment">// 开启easycom自动注册（默认开启）</span>
    <span class="hljs-string">"autoscan"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-comment">// 自定义组件匹配规则（可选，默认适配uni-ui组件）</span>
    <span class="hljs-string">"custom"</span>: {
      <span class="hljs-string">"^uni-(.*)"</span>: <span class="hljs-string">"@dcloudio/uni-ui/lib/uni-$1/uni-$1.vue"</span>
    }
  },
  <span class="hljs-string">"pages"</span>: [
    {
      <span class="hljs-string">"path"</span>: <span class="hljs-string">"pages/index/index"</span>,
      <span class="hljs-string">"style"</span>: {
        <span class="hljs-string">"navigationBarTitleText"</span>: <span class="hljs-string">"首页"</span>
      }
    }
  ]
}
</code></pre>
<p>注意：easycom 仅支持符合“组件名-组件文件名”规范的组件，自定义组件建议遵循此规范；对于不常用的原生组件，优先局部注册，避免全局注册占用资源。</p>
<h3 data-id="heading-5"><strong>技巧4： 原生模块调用避坑，解决跨端兼容问题</strong></h3>
<p>痛点：uni-app x 调用原生模块（如地图、支付）时，容易出现“某一端正常、某一端失效”的问题，尤其是小程序和App端的差异。</p>
<p>技巧：调用原生模块前，先判断当前运行环境，根据环境差异处理逻辑；同时利用 uni.getSystemInfoSync() 快速获取环境信息，简化判断。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/utils/env.uts</span>
<span class="hljs-comment">// 封装环境判断工具函数（全局复用）</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> envUtil = {
  <span class="hljs-comment">// 判断是否为App端</span>
  <span class="hljs-title function_">isApp</span>(): <span class="hljs-built_in">boolean</span> {
    <span class="hljs-keyword">const</span> systemInfo = uni.<span class="hljs-title function_">getSystemInfoSync</span>();
    <span class="hljs-keyword">return</span> systemInfo.<span class="hljs-property">platform</span> === <span class="hljs-string">'android'</span> || systemInfo.<span class="hljs-property">platform</span> === <span class="hljs-string">'ios'</span>;
  },
  <span class="hljs-comment">// 判断是否为微信小程序</span>
  <span class="hljs-title function_">isWechatMini</span>(): <span class="hljs-built_in">boolean</span> {
    <span class="hljs-keyword">const</span> systemInfo = uni.<span class="hljs-title function_">getSystemInfoSync</span>();
    <span class="hljs-keyword">return</span> systemInfo.<span class="hljs-property">mpPlatform</span> === <span class="hljs-string">'weixin'</span>;
  },
  <span class="hljs-comment">// 判断是否为支付宝小程序</span>
  <span class="hljs-title function_">isAlipayMini</span>(): <span class="hljs-built_in">boolean</span> {
    <span class="hljs-keyword">const</span> systemInfo = uni.<span class="hljs-title function_">getSystemInfoSync</span>();
    <span class="hljs-keyword">return</span> systemInfo.<span class="hljs-property">mpPlatform</span> === <span class="hljs-string">'alipay'</span>;
  },
  <span class="hljs-comment">// 判断是否为H5端</span>
  <span class="hljs-title function_">isH5</span>(): <span class="hljs-built_in">boolean</span> {
    <span class="hljs-keyword">const</span> systemInfo = uni.<span class="hljs-title function_">getSystemInfoSync</span>();
    <span class="hljs-keyword">return</span> systemInfo.<span class="hljs-property">platform</span> === <span class="hljs-string">'h5'</span>;
  }
};

<span class="hljs-comment">// 实战使用（调用地图模块）</span>
<span class="hljs-keyword">import</span> { envUtil } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/env.uts'</span>;

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">openMap</span>(<span class="hljs-params">latitude: <span class="hljs-built_in">number</span>, longitude: <span class="hljs-built_in">number</span></span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 根据环境差异处理地图调用逻辑</span>
    <span class="hljs-keyword">if</span> (envUtil.<span class="hljs-title function_">isApp</span>()) {
      <span class="hljs-comment">// App端：调用原生地图模块</span>
      <span class="hljs-keyword">await</span> uni.<span class="hljs-title function_">openLocation</span>({
        latitude,
        longitude,
        <span class="hljs-attr">name</span>: <span class="hljs-string">'目标位置'</span>,
        <span class="hljs-attr">address</span>: <span class="hljs-string">'详细地址'</span>
      });
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (envUtil.<span class="hljs-title function_">isWechatMini</span>()) {
      <span class="hljs-comment">// 微信小程序：判断是否有权限</span>
      <span class="hljs-keyword">const</span> auth = <span class="hljs-keyword">await</span> uni.<span class="hljs-title function_">getSetting</span>();
      <span class="hljs-keyword">if</span> (!auth.<span class="hljs-property">authSetting</span>[<span class="hljs-string">'scope.userLocation'</span>]) {
        <span class="hljs-comment">// 无权限，请求授权</span>
        <span class="hljs-keyword">await</span> uni.<span class="hljs-title function_">authorize</span>({ <span class="hljs-attr">scope</span>: <span class="hljs-string">'scope.userLocation'</span> });
      }
      <span class="hljs-comment">// 调用微信小程序地图</span>
      <span class="hljs-keyword">await</span> uni.<span class="hljs-title function_">openLocation</span>({ latitude, longitude, <span class="hljs-attr">name</span>: <span class="hljs-string">'目标位置'</span> });
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (envUtil.<span class="hljs-title function_">isH5</span>()) {
      <span class="hljs-comment">// H5端：跳转百度/高德地图网页版</span>
      <span class="hljs-keyword">const</span> url = <span class="hljs-string">`https://api.map.baidu.com/marker?location=<span class="hljs-subst">${latitude}</span>,<span class="hljs-subst">${longitude}</span>&amp;title=目标位置&amp;output=html`</span>;
      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">open</span>(url, <span class="hljs-string">'_blank'</span>);
    }
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'打开地图失败：'</span>, err);
    uni.<span class="hljs-title function_">showToast</span>({ <span class="hljs-attr">title</span>: <span class="hljs-string">'打开地图失败，请检查权限'</span>, <span class="hljs-attr">icon</span>: <span class="hljs-string">'none'</span> });
  }
}
</code></pre>
<p>关键：原生模块的跨端差异主要集中在“权限配置”和“接口参数”上，提前判断环境，针对性处理，能避免80%的跨端兼容问题；同时，App端需在 manifest.json 中配置对应模块权限（如地图、定位）。</p>
<h2 data-id="heading-6"><strong>三、性能优化技巧：从启动到运行，全方位提速</strong></h2>
<p>性能是跨端应用的核心竞争力，uni-app x 虽然原生渲染性能优异，但不合理的开发方式仍会导致卡顿、启动慢等问题，以下技巧可全方位优化性能。</p>
<h3 data-id="heading-7"><strong>技巧5： 页面渲染优化，减少卡顿（核心重点）</strong></h3>
<p>痛点：列表渲染、频繁数据更新时，容易出现页面卡顿、掉帧，尤其是大数据列表场景。</p>
<p>技巧：结合 vue3 的响应式优化和 uni-app x 的渲染特性，做好3点：1. 列表渲染用 v-for + key（唯一值）；2. 大数据列表用分页加载+虚拟列表；3. 避免频繁修改响应式数据。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 大数据列表优化：虚拟列表 + 分页加载 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">view</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 虚拟列表：只渲染可视区域内的列表项，减少DOM节点 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">uni-virtual-list</span> 
      <span class="hljs-attr">:height</span>=<span class="hljs-string">"500"</span> 
      <span class="hljs-attr">:item-height</span>=<span class="hljs-string">"80"</span> 
      <span class="hljs-attr">:items</span>=<span class="hljs-string">"listData"</span>
      <span class="hljs-attr">key</span>=<span class="hljs-string">"id"</span>
    &gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">item</span>=<span class="hljs-string">"{ item }"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">image</span> <span class="hljs-attr">:src</span>=<span class="hljs-string">"item.avatar"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"avatar"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">image</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"info"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"name"</span>&gt;</span>{{ item.username }}<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"desc"</span>&gt;</span>{{ item.desc }}<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">uni-virtual-list</span>&gt;</span><span class="hljs-comment">&lt;!-- 加载中/无数据提示 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"loading"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"loading"</span>&gt;</span>加载中...<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"!loading &amp;&amp; listData.length === 0"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"no-data"</span>&gt;</span>暂无数据<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"uts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, onLoad } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PageParams</span>, <span class="hljs-title class_">UserInfo</span>, <span class="hljs-title class_">ApiResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/typings/common.uts'</span>;

<span class="hljs-keyword">const</span> listData = ref&lt;<span class="hljs-title class_">UserInfo</span>[]&gt;([]);
<span class="hljs-keyword">const</span> loading = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>);
<span class="hljs-keyword">const</span> pageNum = <span class="hljs-title function_">ref</span>(<span class="hljs-number">1</span>);
<span class="hljs-keyword">const</span> pageSize = <span class="hljs-title function_">ref</span>(<span class="hljs-number">10</span>);
<span class="hljs-keyword">const</span> hasMore = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">true</span>); <span class="hljs-comment">// 是否还有更多数据</span>

<span class="hljs-comment">// 分页加载数据</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">loadData</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (loading.<span class="hljs-property">value</span> || !hasMore.<span class="hljs-property">value</span>) <span class="hljs-keyword">return</span>;
  loading.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>;
  
  <span class="hljs-keyword">const</span> <span class="hljs-attr">params</span>: <span class="hljs-title class_">PageParams</span> = {
    <span class="hljs-attr">pageNum</span>: pageNum.<span class="hljs-property">value</span>,
    <span class="hljs-attr">pageSize</span>: pageSize.<span class="hljs-property">value</span>
  };
  
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">res</span>: <span class="hljs-title class_">ApiResponse</span>&lt;<span class="hljs-title class_">UserInfo</span>[]&gt; = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getUserList</span>(params);
    <span class="hljs-keyword">if</span> (res.<span class="hljs-property">code</span> === <span class="hljs-number">200</span>) {
      <span class="hljs-keyword">const</span> newData = res.<span class="hljs-property">data</span> || [];
      <span class="hljs-comment">// 避免直接修改listData，用concat拼接（减少响应式更新次数）</span>
      listData.<span class="hljs-property">value</span> = listData.<span class="hljs-property">value</span>.<span class="hljs-title function_">concat</span>(newData);
      <span class="hljs-comment">// 判断是否还有更多数据</span>
      hasMore.<span class="hljs-property">value</span> = newData.<span class="hljs-property">length</span> === pageSize.<span class="hljs-property">value</span>;
      pageNum.<span class="hljs-property">value</span>++;
    }
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'加载数据失败：'</span>, err);
  } <span class="hljs-keyword">finally</span> {
    loading.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;
  }
};

<span class="hljs-comment">// 页面加载时初始化数据</span>
<span class="hljs-title function_">onLoad</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">loadData</span>();
});

<span class="hljs-comment">// 下拉刷新（页面配置enablePullDownRefresh: true）</span>
<span class="hljs-title function_">onPullDownRefresh</span>(<span class="hljs-function">() =&gt;</span> {
  pageNum.<span class="hljs-property">value</span> = <span class="hljs-number">1</span>;
  listData.<span class="hljs-property">value</span> = [];
  hasMore.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-title function_">loadData</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    uni.<span class="hljs-title function_">stopPullDownRefresh</span>(); <span class="hljs-comment">// 停止下拉刷新</span>
  });
});

<span class="hljs-comment">// 上拉加载（页面配置onReachBottomDistance: 50）</span>
<span class="hljs-title function_">onReachBottom</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">loadData</span>();
});
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 样式省略，注意避免使用复杂选择器，减少渲染开销 */</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p>补充：虚拟列表可使用 uni-ui 的 uni-virtual-list 组件，无需自己封装；列表渲染时，key 必须是唯一值（如 id），避免使用 index 作为 key，否则会导致渲染错乱；频繁更新的数据（如倒计时），可使用 vue3 的 shallowRef 替代 ref，减少响应式监听开销。</p>
<h3 data-id="heading-8"><strong>技巧6： 包体积优化，提升启动速度</strong></h3>
<p>痛点：App端包体积过大，导致下载慢、启动慢；小程序端包体积超过限制，无法上线。</p>
<p>技巧：从“资源、代码、依赖”三个维度优化，核心技巧如下：</p>
<ol>
<li>
<p>资源优化：图片压缩（使用 tinypng 压缩）、图标使用 iconfont 替代本地图片、大文件（如视频、音频）采用在线加载，不打包进应用；</p>
</li>
<li>
<p>代码优化：删除无用代码（dead code）、合并重复代码、使用 tree-shaking 剔除未使用的依赖（uni-app x 打包时默认开启）；</p>
</li>
<li>
<p>依赖优化：减少不必要的第三方依赖，优先使用 uni-app x 原生能力替代第三方插件（如日期处理用原生 Date，无需引入 moment.js）；</p>
</li>
<li>
<p>分包加载：小程序端开启分包加载，将不常用的页面放在分包中，减少主包体积；App端可开启按需加载，提升启动速度。</p>
</li>
</ol>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// 小程序分包配置（pages.json）</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"pages"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-comment">// 主包页面（常用页面）</span>
    <span class="hljs-punctuation">{</span> <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pages/index/index"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span> <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pages/login/login"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-comment">// 分包配置（不常用页面，如个人中心、设置）</span>
  <span class="hljs-attr">"subPackages"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"root"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pages/subpackage/"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 分包根目录</span>
      <span class="hljs-attr">"pages"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span> <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my/my"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span> <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"setting/setting"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-comment">// 预加载分包（进入主包页面时，预加载分包，提升体验）</span>
  <span class="hljs-attr">"preloadRule"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"pages/index/index"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"network"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"all"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 所有网络环境都预加载</span>
      <span class="hljs-attr">"packages"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"pages/subpackage"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-9"><strong>四、避坑与实战技巧：解决开发中最常见的问题</strong></h2>
<p>结合大量 uni-app x 实战经验，整理了4个最常见的坑，以及对应的解决方案，帮你少走弯路。</p>
<h3 data-id="heading-10"><strong>技巧7： 页面跳转传参避坑，解决参数丢失、类型异常</strong></h3>
<p>痛点：页面跳转时，传递对象、数组等复杂参数，容易出现参数丢失、类型转换异常（如数字变为字符串）。</p>
<p>技巧：传递复杂参数时，先将参数转为 JSON 字符串，接收时再解析；传递简单参数（如 id、name），可直接拼接在路径后，注意参数类型转换。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 跳转页面，传递复杂参数（如用户信息对象）</span>
<span class="hljs-comment">// 页面A：pages/index/index.uts</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">goToDetail</span>(<span class="hljs-params">user: UserInfo</span>) {
  <span class="hljs-comment">// 复杂参数转为JSON字符串</span>
  <span class="hljs-keyword">const</span> userStr = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(user);
  <span class="hljs-comment">// 跳转页面，携带参数</span>
  uni.<span class="hljs-title function_">navigateTo</span>({
    <span class="hljs-attr">url</span>: <span class="hljs-string">`/pages/detail/detail?user=<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(userStr)}</span>`</span> <span class="hljs-comment">// 编码，避免特殊字符报错</span>
  });
}

<span class="hljs-comment">// 接收参数</span>
<span class="hljs-comment">// 页面B：pages/detail/detail.uts</span>
<span class="hljs-keyword">import</span> { onLoad } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">UserInfo</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/typings/common.uts'</span>;

<span class="hljs-title function_">onLoad</span>(<span class="hljs-function">(<span class="hljs-params">options</span>) =&gt;</span> {
  <span class="hljs-comment">// 接收参数，解码后解析为对象</span>
  <span class="hljs-keyword">const</span> userStr = <span class="hljs-built_in">decodeURIComponent</span>(options.<span class="hljs-property">user</span> <span class="hljs-keyword">as</span> string);
  <span class="hljs-keyword">const</span> user = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(userStr) <span class="hljs-keyword">as</span> <span class="hljs-title class_">UserInfo</span>;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'接收的用户信息：'</span>, user);
  
  <span class="hljs-comment">// 简单参数接收（如id）</span>
  <span class="hljs-keyword">const</span> id = <span class="hljs-title class_">Number</span>(options.<span class="hljs-property">id</span>); <span class="hljs-comment">// 转为数字类型，避免字符串类型异常</span>
});
</code></pre>
<p>注意：传递参数时，若参数包含特殊字符（如中文、&amp;、=），需用 encodeURIComponent 编码，接收时用 decodeURIComponent 解码；JSON 字符串解析时，需做好异常捕获，避免参数格式错误导致报错。</p>
<h3 data-id="heading-11"><strong>技巧8： 本地存储优化，避免存储异常、数据泄露</strong></h3>
<p>痛点：使用 uni.setStorage 存储数据时，容易出现数据覆盖、存储容量超限、敏感数据泄露等问题。</p>
<p>技巧：封装统一的存储工具类，区分存储类型（临时存储、永久存储），添加存储前缀避免覆盖，敏感数据加密存储。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/utils/storage.uts</span>
<span class="hljs-keyword">import</span> { encode, decode } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/crypto.uts'</span>; <span class="hljs-comment">// 假设已封装加密工具</span>

<span class="hljs-comment">// 存储前缀，避免与其他项目/插件存储的数据冲突</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">STORAGE_PREFIX</span> = <span class="hljs-string">'uni_app_x_'</span>;

<span class="hljs-comment">// 封装存储工具类</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> storageUtil = {
  <span class="hljs-comment">// 永久存储（uni.setStorage）</span>
  <span class="hljs-title function_">set</span>(<span class="hljs-params">key: <span class="hljs-built_in">string</span>, value: <span class="hljs-built_in">any</span>, isEncrypt = <span class="hljs-literal">false</span></span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> realKey = <span class="hljs-variable constant_">STORAGE_PREFIX</span> + key;
      <span class="hljs-keyword">let</span> realValue = value;
      <span class="hljs-comment">// 敏感数据加密存储（如token、用户密码）</span>
      <span class="hljs-keyword">if</span> (isEncrypt) {
        realValue = <span class="hljs-title function_">encode</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(realValue));
      } <span class="hljs-keyword">else</span> {
        realValue = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(realValue);
      }
      uni.<span class="hljs-title function_">setStorage</span>({ <span class="hljs-attr">key</span>: realKey, <span class="hljs-attr">data</span>: realValue });
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'存储失败：'</span>, err);
      <span class="hljs-comment">// 存储容量超限处理</span>
      uni.<span class="hljs-title function_">showToast</span>({ <span class="hljs-attr">title</span>: <span class="hljs-string">'存储空间不足，请清理缓存'</span>, <span class="hljs-attr">icon</span>: <span class="hljs-string">'none'</span> });
    }
  },

  <span class="hljs-comment">// 永久存储获取</span>
  <span class="hljs-title function_">get</span>(<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>, isEncrypt = <span class="hljs-literal">false</span>): <span class="hljs-built_in">any</span> {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> realKey = <span class="hljs-variable constant_">STORAGE_PREFIX</span> + key;
      <span class="hljs-keyword">const</span> value = uni.<span class="hljs-title function_">getStorageSync</span>(realKey);
      <span class="hljs-keyword">if</span> (!value) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
      <span class="hljs-comment">// 敏感数据解密</span>
      <span class="hljs-keyword">if</span> (isEncrypt) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title function_">decode</span>(value));
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(value);
      }
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'获取存储失败：'</span>, err);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
  },

  <span class="hljs-comment">// 临时存储（uni.setStorageSync，页面关闭后失效）</span>
  <span class="hljs-title function_">setTemp</span>(<span class="hljs-params">key: <span class="hljs-built_in">string</span>, value: <span class="hljs-built_in">any</span></span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> realKey = <span class="hljs-variable constant_">STORAGE_PREFIX</span> + key;
      uni.<span class="hljs-title function_">setStorageSync</span>(realKey, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(value));
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'临时存储失败：'</span>, err);
    }
  },

  <span class="hljs-comment">// 临时存储获取</span>
  <span class="hljs-title function_">getTemp</span>(<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">any</span> {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> realKey = <span class="hljs-variable constant_">STORAGE_PREFIX</span> + key;
      <span class="hljs-keyword">const</span> value = uni.<span class="hljs-title function_">getStorageSync</span>(realKey);
      <span class="hljs-keyword">return</span> value ? <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(value) : <span class="hljs-literal">null</span>;
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'获取临时存储失败：'</span>, err);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
  },

  <span class="hljs-comment">// 删除指定存储</span>
  <span class="hljs-title function_">remove</span>(<span class="hljs-params">key: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-keyword">const</span> realKey = <span class="hljs-variable constant_">STORAGE_PREFIX</span> + key;
    uni.<span class="hljs-title function_">removeStorage</span>({ <span class="hljs-attr">key</span>: realKey });
  },

  <span class="hljs-comment">// 清空所有存储（谨慎使用）</span>
  <span class="hljs-title function_">clear</span>(<span class="hljs-params"/>) {
    uni.<span class="hljs-title function_">clearStorage</span>();
  }
};

<span class="hljs-comment">// 实战使用</span>
<span class="hljs-comment">// 存储普通数据（如用户信息，不加密）</span>
storageUtil.<span class="hljs-title function_">set</span>(<span class="hljs-string">'userInfo'</span>, { <span class="hljs-attr">id</span>: <span class="hljs-string">'123'</span>, <span class="hljs-attr">username</span>: <span class="hljs-string">'test'</span> });

<span class="hljs-comment">// 存储敏感数据（如token，加密）</span>
storageUtil.<span class="hljs-title function_">set</span>(<span class="hljs-string">'token'</span>, <span class="hljs-string">'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'</span>, <span class="hljs-literal">true</span>);

<span class="hljs-comment">// 获取数据</span>
<span class="hljs-keyword">const</span> userInfo = storageUtil.<span class="hljs-title function_">get</span>(<span class="hljs-string">'userInfo'</span>);
<span class="hljs-keyword">const</span> token = storageUtil.<span class="hljs-title function_">get</span>(<span class="hljs-string">'token'</span>, <span class="hljs-literal">true</span>);
</code></pre>
<h2 data-id="heading-12"><strong>五、总结</strong></h2>
<p>uni-app x 作为新一代跨端开发框架，凭借 uts 语法、原生渲染、多端兼容等优势，成为前端开发者的优选工具。本文整理的 8 个实战编程技巧，涵盖 uts 语法、原生能力调用、性能优化、避坑指南等核心维度，每个技巧均配套完整代码示例，可直接落地复用，帮助你提升开发效率、解决实际开发问题。</p>
<p>后续将持续分享 uni-app x 进阶技巧（如插件开发、打包部署、原生插件集成），欢迎关注，一起成长</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3 + Vite 性能优化实战]]></title>    <link>https://juejin.cn/post/7604685644684902452</link>    <guid>https://juejin.cn/post/7604685644684902452</guid>    <pubDate>2026-02-10T01:54:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604685644684902452" data-draft-id="7604493165329072162" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3 + Vite 性能优化实战"/> <meta itemprop="keywords" content="前端,面试,Vue.js"/> <meta itemprop="datePublished" content="2026-02-10T01:54:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="不想秃头的程序员"/> <meta itemprop="url" content="https://juejin.cn/user/2754702534251820"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3 + Vite 性能优化实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2754702534251820/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    不想秃头的程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T01:54:10.000Z" title="Tue Feb 10 2026 01:54:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue3 + Vite 性能优化实战：从开发到生产，全方位提速指南</h2>
<p>前言：在前端开发的江湖里，Vue3 + Vite 组合早已成为主流选择，凭借简洁的语法、高效的构建能力，成为很多项目的首选技术栈。但不少开发者迁移后却纷纷吐槽“不够快”——开发时冷启动卡顿、热更新延迟，生产环境首屏加载缓慢、打包体积臃肿。其实不是 Vue3 和 Vite 不给力，而是你的配置和用法没到位！今天就结合实战经验，分享一套从开发期到生产期的全方位性能优化技巧，把这套组合的性能压榨到极致，让你的项目开发飞起、运行丝滑✨</p>
<h3 data-id="heading-1">一、先搞懂：Vite 快的核心原理</h3>
<p>在开始优化前，先简单理清 Vite 比传统构建工具（如 Webpack）快的核心逻辑，才能精准找到优化切入点，避免盲目操作。</p>
<p>Vite 的速度优势主要体现在两个阶段，吃透这两点，后续优化会更有方向：</p>
<ol>
<li><strong>开发期：原生 ESM + ESBuild 预构建</strong>：Vite 启动时不会打包整个项目，只需启动一个开发服务器，通过浏览器原生 ESM 加载源码；同时用 ESBuild（Go 语言编写）对 node_modules 中的依赖进行预构建，比 Webpack 的 JS 编写的构建器快 10-100 倍，冷启动速度大幅提升，相当于“打开一扇门就能进房间，不用拆了整个房子重建”。</li>
<li><strong>生产期：Rollup 深度优化打包</strong>：生产环境下，Vite 会切换到 Rollup 进行打包（Rollup 对 ES 模块的 tree-shaking 更彻底），配合一系列优化配置，能最大程度精简打包体积，兼顾速度和体积双重优势。</li>
</ol>
<p>小提醒：很多开发者误以为“用了 Vite 就一定快”，其实默认配置下，面对大型项目或不合理的依赖引入，依然会出现性能瓶颈——这也是我们今天优化的核心意义。</p>
<h3 data-id="heading-2">二、开发期优化：告别卡顿，提升开发体验</h3>
<p>开发期的优化核心是“降低启动时间、减少热更新延迟”，让我们在写代码时不用等待，专注开发本身。以下技巧均经过实战验证，直接复制配置即可生效。</p>
<h4 data-id="heading-3">1. 依赖预构建优化：精准控制预构建范围</h4>
<p>Vite 会自动预构建 node_modules 中的依赖，但默认配置可能会预构建一些不必要的依赖，或遗漏常用依赖，导致启动速度变慢。我们可以手动配置 optimizeDeps，精准控制预构建范围。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// vite.config.ts</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span>
<span class="hljs-keyword">import</span> { resolve } <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">vue</span>()],
  <span class="hljs-attr">resolve</span>: {
    <span class="hljs-attr">alias</span>: {
      <span class="hljs-string">'@'</span>: <span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'src'</span>) <span class="hljs-comment">// 路径别名，减少路径查找时间</span>
    }
  },
  <span class="hljs-comment">// 依赖预构建优化</span>
  <span class="hljs-attr">optimizeDeps</span>: {
    <span class="hljs-attr">include</span>: [<span class="hljs-string">'vue'</span>, <span class="hljs-string">'vue-router'</span>, <span class="hljs-string">'pinia'</span>, <span class="hljs-string">'axios'</span>], <span class="hljs-comment">// 强制预构建常用依赖</span>
    <span class="hljs-attr">exclude</span>: [<span class="hljs-string">'some-large-library'</span>], <span class="hljs-comment">// 排除大型第三方库（如echarts，按需引入即可）</span>
    <span class="hljs-attr">cacheDir</span>: <span class="hljs-string">'.vite'</span>, <span class="hljs-comment">// 缓存预构建结果，提升二次启动速度（默认就是.vite，可自定义路径）</span>
  }
})
</code></pre>
<p>优化点说明：include 配置常用依赖，避免 Vite 重复判断是否需要预构建；exclude 排除大型库，避免预构建体积过大；路径别名不仅方便开发，还能减少 Vite 的路径查找时间，一举两得。</p>
<h4 data-id="heading-4">2. HMR 优化：解决热更新延迟问题</h4>
<p>热更新（HMR）是开发期高频使用的功能，若出现延迟（修改代码后几秒才生效），会严重影响开发效率。尤其是在 Windows 或 Docker 环境下，大概率是文件监听配置不合理导致的，可通过以下配置优化：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// vite.config.ts 新增 server 配置</span>
<span class="hljs-attr">server</span>: {
  <span class="hljs-attr">watch</span>: {
    <span class="hljs-attr">usePolling</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// Windows/Docker 环境必加，解决文件监听不灵敏问题</span>
    <span class="hljs-attr">ignored</span>: [<span class="hljs-string">'**/node_modules/**'</span>, <span class="hljs-string">'**/.git/**'</span>, <span class="hljs-string">'**/dist/**'</span>], <span class="hljs-comment">// 忽略无需监听的目录</span>
    <span class="hljs-attr">interval</span>: <span class="hljs-number">100</span>, <span class="hljs-comment">// 监听间隔，单位ms，默认100，可根据需求调整</span>
  },
  <span class="hljs-attr">open</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 启动后自动打开浏览器</span>
  <span class="hljs-attr">port</span>: <span class="hljs-number">3000</span>, <span class="hljs-comment">// 固定端口，避免每次启动随机端口</span>
  <span class="hljs-attr">strictPort</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 端口被占用时，直接报错（避免自动切换端口导致的配置错乱）</span>
}
</code></pre>
<p>补充：若项目体积过大，可额外配置 server.hmr.overlay: false，关闭热更新错误提示层（错误提示会打印到控制台），也能轻微提升热更新速度。</p>
<h4 data-id="heading-5">3. 多页面应用（MPA）优化：独立构建，提升效率</h4>
<p>若你的项目是多页面应用（如后台管理系统 + 前台展示页面），默认配置下会构建所有页面，启动速度较慢。可通过配置多入口，让每个页面独立构建，按需加载：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// vite.config.ts 新增 build 配置</span>
<span class="hljs-attr">build</span>: {
  <span class="hljs-attr">rollupOptions</span>: {
    <span class="hljs-attr">input</span>: {
      <span class="hljs-attr">main</span>: <span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'index.html'</span>), <span class="hljs-comment">// 主页面入口</span>
      <span class="hljs-attr">admin</span>: <span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'admin.html'</span>), <span class="hljs-comment">// 后台页面入口</span>
      <span class="hljs-attr">mobile</span>: <span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'mobile.html'</span>) <span class="hljs-comment">// 移动端页面入口</span>
    },
  },
}
</code></pre>
<p>优化效果：启动时只会构建当前访问的页面，其他页面不加载，冷启动速度提升 50% 以上；打包时也能独立打包每个页面，后续部署可按需部署，降低部署成本。</p>
<h3 data-id="heading-6">三、生产期优化：精简体积，提升运行速度</h3>
<p>生产期的优化核心是“减小打包体积、提升首屏加载速度”——用户不会等待一个加载十几秒的页面，首屏加载速度直接影响用户留存。以下优化从“体积精简、加载提速、性能监控”三个维度展开，覆盖生产期全场景。</p>
<h4 data-id="heading-7">1. 代码分割：合理分包，减少首屏加载体积</h4>
<p>默认打包会将所有代码合并成一个大文件，首屏加载时需要加载整个文件，速度较慢。通过代码分割，将代码拆分成多个小文件，按需加载，能显著提升首屏加载速度。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// vite.config.ts build 配置新增</span>
<span class="hljs-attr">build</span>: {
  <span class="hljs-attr">rollupOptions</span>: {
    <span class="hljs-attr">output</span>: {
      <span class="hljs-comment">// 自定义分包策略</span>
      <span class="hljs-attr">manualChunks</span>: {
        <span class="hljs-string">'vue-vendor'</span>: [<span class="hljs-string">'vue'</span>, <span class="hljs-string">'vue-router'</span>, <span class="hljs-string">'pinia'</span>], <span class="hljs-comment">// Vue 核心依赖打包成一个文件</span>
        <span class="hljs-string">'ui-vendor'</span>: [<span class="hljs-string">'element-plus'</span>, <span class="hljs-string">'ant-design-vue'</span>], <span class="hljs-comment">// UI 组件库打包成一个文件</span>
        <span class="hljs-string">'utils'</span>: [<span class="hljs-string">'lodash-es'</span>, <span class="hljs-string">'dayjs'</span>, <span class="hljs-string">'axios'</span>], <span class="hljs-comment">// 工具库打包成一个文件</span>
      },
      <span class="hljs-comment">// 静态资源命名规范，便于缓存</span>
      <span class="hljs-attr">assetFileNames</span>: <span class="hljs-string">'assets/[name]-[hash].[extname]'</span>,
      <span class="hljs-attr">chunkFileNames</span>: <span class="hljs-string">'chunks/[name]-[hash].js'</span>,
      <span class="hljs-attr">entryFileNames</span>: <span class="hljs-string">'entry/[name]-[hash].js'</span>,
    },
  },
  <span class="hljs-comment">// 开启压缩（默认开启，可进一步优化）</span>
  <span class="hljs-attr">minify</span>: <span class="hljs-string">'esbuild'</span>, <span class="hljs-comment">// 用 esbuild 压缩，速度快；需要更极致压缩可改用 'terser'</span>
}
</code></pre>
<p>优化逻辑：将核心依赖、UI 库、工具库分别打包，这些文件变更频率低，可利用浏览器缓存（后续用户访问时无需重新加载）；业务代码单独打包，变更频率高，减小每次更新的加载体积。</p>
<h4 data-id="heading-8">2. 静态资源优化：减小传输体积，减少请求次数</h4>
<p>前端项目中，图片、字体等静态资源往往是打包体积的“大头”，合理优化静态资源，能快速减小打包体积，提升加载速度。</p>
<h5 data-id="heading-9">（1）图片优化</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// vite.config.ts 新增 assets 配置</span>
<span class="hljs-attr">build</span>: {
  <span class="hljs-attr">assetsInlineLimit</span>: <span class="hljs-number">4096</span>, <span class="hljs-comment">// 小于 4KB 的图片转 base64，减少 HTTP 请求</span>
}
<span class="hljs-comment">// 额外安装 vite-plugin-imagemin 插件，实现图片压缩（可选，需手动安装）</span>
<span class="hljs-keyword">import</span> imagemin <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-imagemin'</span>

<span class="hljs-attr">plugins</span>: [
  <span class="hljs-title function_">vue</span>(),
  <span class="hljs-title function_">imagemin</span>({
    <span class="hljs-attr">gifsicle</span>: { <span class="hljs-attr">optimizationLevel</span>: <span class="hljs-number">7</span>, <span class="hljs-attr">interlaced</span>: <span class="hljs-literal">false</span> }, <span class="hljs-comment">// gif 压缩</span>
    <span class="hljs-attr">optipng</span>: { <span class="hljs-attr">optimizationLevel</span>: <span class="hljs-number">7</span> }, <span class="hljs-comment">// png 压缩</span>
    <span class="hljs-attr">mozjpeg</span>: { <span class="hljs-attr">quality</span>: <span class="hljs-number">80</span> }, <span class="hljs-comment">// jpg 压缩</span>
    <span class="hljs-attr">pngquant</span>: { <span class="hljs-attr">quality</span>: [<span class="hljs-number">0.7</span>, <span class="hljs-number">0.8</span>], <span class="hljs-attr">speed</span>: <span class="hljs-number">4</span> }, <span class="hljs-comment">// png 深度压缩</span>
  })
]
</code></pre>
<p>补充建议：开发时尽量使用 WebP/AVIF 格式图片（体积比 JPG/PNG 小 30%-50%），可通过 picture 标签做降级兼容，兼顾兼容性和体积。</p>
<h5 data-id="heading-10">（2）字体优化</h5>
<p>字体文件往往体积较大，可通过“按需引入字体子集”“压缩字体”优化：</p>
<ol>
<li>使用 font-spider 工具，提取项目中实际用到的字体字符，生成字体子集（删除未用到的字符，体积可减小 80% 以上）；</li>
<li>将字体文件放在 CDN 上，通过 preload 预加载关键字体，避免字体加载延迟导致的“闪屏”问题。</li>
</ol>
<h4 data-id="heading-11">3. 组件懒加载：按需加载，减少首屏渲染压力</h4>
<p>Vue3 提供了路由级懒加载和组件级懒加载两种方式，能有效减少首屏需要加载的组件数量，提升首屏渲染速度，尤其适合大型项目。</p>
<h5 data-id="heading-12">（1）路由级懒加载（最基础、最推荐）</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// router/index.ts</span>
<span class="hljs-keyword">import</span> { createRouter, createWebHistory } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>

<span class="hljs-keyword">const</span> routes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'Home'</span>,
    <span class="hljs-comment">// 路由懒加载：点击路由时才加载对应的组件</span>
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/Home.vue'</span>)
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/about'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'About'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/About.vue'</span>)
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/admin'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'Admin'</span>,
    <span class="hljs-comment">// 嵌套路由也支持懒加载</span>
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/Admin/Admin.vue'</span>),
    <span class="hljs-attr">children</span>: [
      { <span class="hljs-attr">path</span>: <span class="hljs-string">'dashboard'</span>, <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/Admin/Dashboard.vue'</span>) }
    ]
  }
]

<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>({
  <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHistory</span>(),
  routes
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router
</code></pre>
<h5 data-id="heading-13">（2）组件级懒加载（针对大型组件）</h5>
<p>对于体积较大的组件（如富文本编辑器、图表组件），即使在当前路由中，也可通过 defineAsyncComponent 实现懒加载，用到时再加载：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 组件中使用</span>
首页
    &lt;!-- 懒加载大型组件 --&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">HeavyComponent</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"showHeavyComponent"</span> /&gt;</span></span>
    &lt;button @显示大型组件&lt;script setup 
import { ref, defineAsyncComponent } from 'vue'

// 定义异步组件（懒加载）
const HeavyComponent = defineAsyncComponent(() =&gt; import('@/components/HeavyComponent.vue'))

const showHeavyComponent = ref(false)
</code></pre>
<h5 data-id="heading-14">（3）第三方组件按需引入</h5>
<p>若使用 Element Plus、Ant Design Vue 等 UI 组件库，一定要开启按需引入，避免打包整个组件库（体积会增加几百 KB）：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// vite.config.ts 配置 Element Plus 按需引入</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Components</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'unplugin-vue-components/vite'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ElementPlusResolver</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'unplugin-vue-components/resolvers'</span>

<span class="hljs-attr">plugins</span>: [
  <span class="hljs-title function_">vue</span>(),
  <span class="hljs-title class_">Components</span>({
    <span class="hljs-attr">resolvers</span>: [<span class="hljs-title class_">ElementPlusResolver</span>()], <span class="hljs-comment">// 自动按需引入 Element Plus 组件</span>
  })
]
</code></pre>
<p>注意：无需手动引入组件和样式，插件会自动识别模板中使用的组件，按需打包对应的组件和样式。</p>
<h4 data-id="heading-15">4. 性能监控：精准定位性能瓶颈</h4>
<p>优化完成后，需要通过工具监控性能，确认优化效果，同时定位未优化到位的瓶颈。推荐两个常用工具，简单易上手：</p>
<h5 data-id="heading-16">（1）打包体积分析：rollup-plugin-visualizer</h5>
<p>通过该插件，可生成打包体积分析图，清晰看到每个模块的体积占比，快速找到体积过大的模块：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 安装插件：npm i rollup-plugin-visualizer -D</span>
<span class="hljs-keyword">import</span> { visualizer } <span class="hljs-keyword">from</span> <span class="hljs-string">'rollup-plugin-visualizer'</span>

<span class="hljs-attr">plugins</span>: [
  <span class="hljs-title function_">vue</span>(),
  <span class="hljs-comment">// 打包体积分析</span>
  <span class="hljs-title function_">visualizer</span>({
    <span class="hljs-attr">open</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 打包完成后自动打开分析图</span>
    <span class="hljs-attr">gzipSize</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 显示 gzip 压缩后的体积</span>
    <span class="hljs-attr">brotliSize</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 显示 brotli 压缩后的体积</span>
  })
]
</code></pre>
<p>使用方法：执行 npm run build 后，会在 dist 目录下生成 stats.html 文件，打开后即可看到体积分析图，针对性优化体积过大的模块。</p>
<h5 data-id="heading-17">（2）浏览器性能监控：Lighthouse</h5>
<p>Chrome 浏览器自带的 Lighthouse 工具，可全面检测页面的性能、可访问性、SEO 等指标，给出具体的优化建议：</p>
<ol>
<li>打开 Chrome 开发者工具（F12），切换到 Lighthouse 标签；</li>
<li>勾选“Performance”（性能），点击“Generate report”；</li>
<li>等待检测完成，根据报告中的“Opportunities”（优化机会），进一步优化性能。</li>
</ol>
<h3 data-id="heading-18">四、TS 集成优化：兼顾类型安全与性能</h3>
<p>现在很多 Vue3 项目都会搭配 TypeScript 使用，TS 虽能提升代码可维护性，但也可能带来性能损耗（如类型检查耗时过长），可通过以下配置优化：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// tsconfig.json 核心配置优化</span>
{
  <span class="hljs-string">"compilerOptions"</span>: {
    <span class="hljs-string">"target"</span>: <span class="hljs-string">"es2020"</span>, <span class="hljs-comment">// 目标 ES 版本，匹配 Vite 构建目标</span>
    <span class="hljs-string">"module"</span>: <span class="hljs-string">"esnext"</span>, <span class="hljs-comment">// 模块格式，支持 ESM</span>
    <span class="hljs-string">"experimentalDecorators"</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 支持装饰器（若使用）</span>
    <span class="hljs-string">"useDefineForClassFields"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-string">"isolatedModules"</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 提升大型项目类型检查效率</span>
    <span class="hljs-string">"skipLibCheck"</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 跳过第三方库的类型检查，减少耗时</span>
    <span class="hljs-string">"noEmit"</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 只做类型检查，不生成编译文件（Vite 负责构建）</span>
    <span class="hljs-string">"strict"</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 开启严格模式，兼顾类型安全</span>
    <span class="hljs-string">"moduleResolution"</span>: <span class="hljs-string">"bundler"</span>, <span class="hljs-comment">// 让 TS 使用 Vite 的模块解析逻辑，避免冲突</span>
  },
  <span class="hljs-string">"include"</span>: [<span class="hljs-string">"src/**/*.ts"</span>, <span class="hljs-string">"src/**/*.d.ts"</span>, <span class="hljs-string">"src/**/*.tsx"</span>, <span class="hljs-string">"src/**/*.vue"</span>],
  <span class="hljs-string">"exclude"</span>: [<span class="hljs-string">"node_modules"</span>]
}
</code></pre>
<p>优化点说明：skipLibCheck 跳过第三方库类型检查，可大幅减少类型检查耗时；isolatedModules 开启后，TS 会将每个文件视为独立模块，提升构建和类型检查效率；moduleResolution: "bundler" 避免 TS 和 Vite 的模块解析逻辑冲突，减少报错。</p>
<h3 data-id="heading-19">五、实战总结：优化前后对比 &amp; 避坑指南</h3>
<h4 data-id="heading-20">1. 优化前后效果对比（大型 Vue3 + Vite + TS 项目）</h4>



































<table><thead><tr><th>优化维度</th><th>优化前</th><th>优化后</th><th>提升比例</th></tr></thead><tbody><tr><td>开发期冷启动时间</td><td>8-10 秒</td><td>1-2 秒</td><td>80%+</td></tr><tr><td>热更新延迟</td><td>2-3 秒</td><td>≤300ms</td><td>85%+</td></tr><tr><td>生产打包体积（未压缩）</td><td>1.2MB</td><td>450KB</td><td>62.5%</td></tr><tr><td>首屏加载时间（3G 网络）</td><td>8-10 秒</td><td>2-3 秒</td><td>70%+</td></tr></tbody></table>
<h4 data-id="heading-21">2. 常见避坑点（必看）</h4>
<ul>
<li>不要盲目开启所有优化：按需优化即可，比如小型项目无需配置多页面入口、手动分包，反而会增加配置复杂度；</li>
<li>避免过度压缩：用 terser 压缩虽能减小体积，但会增加打包时间，大型项目可权衡选择，小型项目用 esbuild 足够；</li>
<li>图片转 base64 要适度：大于 4KB 的图片不建议转 base64，会增加 JS 文件体积，反而拖慢首屏加载；</li>
<li>第三方库优化优先：很多时候性能瓶颈来自第三方库（如 echarts、xlsx），优先考虑按需引入、CDN 引入，而非自己优化源码。</li>
</ul>
<h3 data-id="heading-22">六、结尾互动</h3>
<p>以上就是 Vue3 + Vite 从开发到生产的全方位性能优化实战技巧，所有配置均经过真实项目验证，直接复制就能用!</p>
<p>你在使用 Vue3 + Vite 时，还遇到过哪些性能问题？比如冷启动卡顿、打包体积过大、热更新失效等，欢迎在评论区留言讨论，一起解决前端性能难题～</p>
<p>如果觉得这篇文章对你有帮助，别忘了点赞、收藏、关注，后续会分享更多 Vue3、Vite、TS 相关的实战干货！</p>
<p>掘金标签推荐：#前端 #Vue3 #Vite #性能优化 #TypeScript（3-5 个标签，贴合主题，提升曝光）</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[五个chrome ! 我再也不用切账号了]]></title>    <link>https://juejin.cn/post/7604690250364223497</link>    <guid>https://juejin.cn/post/7604690250364223497</guid>    <pubDate>2026-02-10T01:53:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604690250364223497" data-draft-id="7604694326518366259" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="五个chrome ! 我再也不用切账号了"/> <meta itemprop="keywords" content="JavaScript,程序员"/> <meta itemprop="datePublished" content="2026-02-10T01:53:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="兆子龙"/> <meta itemprop="url" content="https://juejin.cn/user/994385683293918"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            五个chrome ! 我再也不用切账号了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/994385683293918/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    兆子龙
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T01:53:56.000Z" title="Tue Feb 10 2026 01:53:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">告别多账号切换烦恼：Chrome 多实例配置管理方案</h2>
<h3 data-id="heading-1">前言</h3>
<p>相信做过自动化测试、爬虫开发或者需要管理多个平台账号的同学，都遇到过这样的痛点：</p>
<ul>
<li>🔄 <strong>频繁切换账号</strong>：测试不同账号的功能，手动登录登出效率低下</li>
<li>🚫 <strong>无痕模式不给力</strong>：每次都要重新登录，Cookie、LocalStorage 全丢失</li>
<li>🤯 <strong>脚本跑不起来</strong>：自动化脚本需要稳定的登录态，手动切换根本不现实</li>
<li>📦 <strong>配置难管理</strong>：多个 Chrome 实例的配置散落各处，维护成本高</li>
</ul>
<p>今天分享一个轻量级的解决方案：<strong>Chrome 多实例配置管理器</strong>，让你优雅地管理多个独立的 Chrome 实例。</p>
<h3 data-id="heading-2">核心思路</h3>
<p>Chrome 提供了两个关键参数：</p>
<pre><code class="hljs language-bash" lang="bash">--user-data-dir=/path/to/profile    <span class="hljs-comment"># 独立的用户数据目录</span>
--remote-debugging-port=9222         <span class="hljs-comment"># 远程调试端口</span>
</code></pre>
<p>通过为每个账号分配独立的用户数据目录和调试端口，我们可以：</p>
<ol>
<li><strong>完全隔离</strong>：每个实例拥有独立的 Cookie、LocalStorage、插件等</li>
<li><strong>持久化登录</strong>：关闭浏览器后，下次启动自动恢复登录态</li>
<li><strong>并行运行</strong>：多个实例可以同时运行，互不干扰</li>
<li><strong>脚本友好</strong>：通过调试端口，可以用 Puppeteer/Playwright 控制浏览器</li>
</ol>
<p>效果也非常棒</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/502a342a27b141a0858df489455e0812~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWG5a2Q6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771293237&amp;x-signature=gUQhvYeImDnWn%2FXlJa%2BOCXvtxYc%3D" alt="image.png" loading="lazy"/></p>
<p>每个实例都是完全隔开</p>
<h3 data-id="heading-3">快速上手</h3>
<h4 data-id="heading-4">1. 创建配置</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { createConfig } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./chromeToolConfig'</span>)

<span class="hljs-comment">// 创建抖音专用配置</span>
<span class="hljs-keyword">const</span> douyinConfig = <span class="hljs-keyword">await</span> <span class="hljs-title function_">createConfig</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'抖音账号1'</span>,
  <span class="hljs-attr">config</span>: {
    <span class="hljs-attr">userDataDir</span>: <span class="hljs-string">'./chrome-profiles/douyin-1'</span>,
    <span class="hljs-attr">remoteDebuggingPort</span>: <span class="hljs-number">9222</span>
  }
})

<span class="hljs-comment">// 创建微博专用配置</span>
<span class="hljs-keyword">const</span> weiboConfig = <span class="hljs-keyword">await</span> <span class="hljs-title function_">createConfig</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'微博账号1'</span>,
  <span class="hljs-attr">config</span>: {
    <span class="hljs-attr">userDataDir</span>: <span class="hljs-string">'./chrome-profiles/weibo-1'</span>,
    <span class="hljs-attr">remoteDebuggingPort</span>: <span class="hljs-number">9223</span>
  }
})

<span class="hljs-comment">// 创建抖音和微博第一个小号配置</span>
<span class="hljs-keyword">const</span> config2 = <span class="hljs-keyword">await</span> <span class="hljs-title function_">createConfig</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'小号A'</span>,
  <span class="hljs-attr">config</span>: {
    <span class="hljs-attr">userDataDir</span>: <span class="hljs-string">'./chrome-profiles/douyin-2'</span>,
    <span class="hljs-attr">remoteDebuggingPort</span>: <span class="hljs-number">9224</span>
  }
})

<span class="hljs-comment">// 创建抖音和微博第二个小号配置</span>
<span class="hljs-keyword">const</span> config3 = <span class="hljs-keyword">await</span> <span class="hljs-title function_">createConfig</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'小号B'</span>,
  <span class="hljs-attr">config</span>: {
    <span class="hljs-attr">userDataDir</span>: <span class="hljs-string">'./chrome-profiles/douyin-2'</span>,
    <span class="hljs-attr">remoteDebuggingPort</span>: <span class="hljs-number">9225</span>
  }
})
</code></pre>
<h4 data-id="heading-5">2. 启动 Chrome</h4>
<p>提供了三种启动模式，满足不同场景需求：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 默认模式：如果已运行则提示</span>
node chromeToolConfig/launch.js 1

<span class="hljs-comment"># 强制重启：杀死现有进程并重启</span>
node chromeToolConfig/launch.js 1 -hard

<span class="hljs-comment"># 复用模式：将现有窗口置顶</span>
node chromeToolConfig/launch.js 1 -soft

<span class="hljs-comment"># 启动时打开指定网址</span>
node chromeToolConfig/launch.js 1 https://www.douyin.com
</code></pre>
<p><strong>模式对比</strong>：</p>

























<table><thead><tr><th>模式</th><th>场景</th><th>行为</th></tr></thead><tbody><tr><td><code>-normal</code></td><td>日常使用</td><td>已运行时提示用户选择</td></tr><tr><td><code>-hard</code></td><td>脚本自动化</td><td>强制重启，确保干净环境</td></tr><tr><td><code>-soft</code></td><td>快速切换</td><td>复用进程，秒级响应</td></tr></tbody></table>
<h4 data-id="heading-6">3. 管理账号链接</h4>
<p>为每个配置关联平台账号信息：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { addLink } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./chromeToolConfig'</span>)

<span class="hljs-comment">// 为配置添加抖音账号信息</span>
<span class="hljs-keyword">await</span> <span class="hljs-title function_">addLink</span>(<span class="hljs-string">'chrome_config-1'</span>, <span class="hljs-string">'douyin'</span>, {
  <span class="hljs-attr">id</span>: <span class="hljs-string">'user_123456'</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">'我的抖音账号'</span>,
  <span class="hljs-attr">extra</span>: {
    粉丝数: <span class="hljs-string">'10万'</span>,
    备注: <span class="hljs-string">'主账号'</span>
  }
})

<span class="hljs-comment">// 添加微博账号</span>
<span class="hljs-keyword">await</span> <span class="hljs-title function_">addLink</span>(<span class="hljs-string">'chrome_config-1'</span>, <span class="hljs-string">'weibo'</span>, {
  <span class="hljs-attr">id</span>: <span class="hljs-string">'weibo_789'</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">'我的微博'</span>
})
</code></pre>
<h4 data-id="heading-7">4. 书签同步</h4>
<p>将一个配置的账号信息同步到另一个配置：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { syncBookmarks } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./chromeToolConfig'</span>)

<span class="hljs-comment">// 合并模式：保留目标配置的现有账号</span>
<span class="hljs-keyword">await</span> <span class="hljs-title function_">syncBookmarks</span>(<span class="hljs-string">'1'</span>, <span class="hljs-string">'2'</span>, { <span class="hljs-attr">merge</span>: <span class="hljs-literal">true</span> })

<span class="hljs-comment">// 覆盖模式：完全替换目标配置的账号</span>
<span class="hljs-keyword">await</span> <span class="hljs-title function_">syncBookmarks</span>(<span class="hljs-string">'1'</span>, <span class="hljs-string">'2'</span>, { <span class="hljs-attr">merge</span>: <span class="hljs-literal">false</span> })

<span class="hljs-comment">// 只同步指定平台</span>
<span class="hljs-keyword">await</span> <span class="hljs-title function_">syncBookmarks</span>(<span class="hljs-string">'1'</span>, <span class="hljs-string">'2'</span>, { 
  <span class="hljs-attr">platforms</span>: [<span class="hljs-string">'douyin'</span>, <span class="hljs-string">'weibo'</span>] 
})
</code></pre>
<h3 data-id="heading-8">实战场景</h3>
<h4 data-id="heading-9">场景 1：自动化测试</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> puppeteer = <span class="hljs-built_in">require</span>(<span class="hljs-string">'puppeteer'</span>)
<span class="hljs-keyword">const</span> { launchChrome } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./chromeToolConfig'</span>)

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">runTest</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 启动配置 1 的 Chrome</span>
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">launchChrome</span>(<span class="hljs-string">'1'</span>)
  
  <span class="hljs-comment">// 连接到已启动的 Chrome</span>
  <span class="hljs-keyword">const</span> browser = <span class="hljs-keyword">await</span> puppeteer.<span class="hljs-title function_">connect</span>({
    <span class="hljs-attr">browserURL</span>: <span class="hljs-string">`http://localhost:<span class="hljs-subst">${result.port}</span>`</span>
  })
  
  <span class="hljs-keyword">const</span> page = <span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">newPage</span>()
  <span class="hljs-keyword">await</span> page.<span class="hljs-title function_">goto</span>(<span class="hljs-string">'https://www.douyin.com'</span>)
  
  <span class="hljs-comment">// 执行测试...</span>
  <span class="hljs-comment">// 登录态已自动恢复，无需重新登录</span>
}
</code></pre>
<h4 data-id="heading-10">场景 2：多账号并行操作</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 终端 1：启动账号 1</span>
node chromeToolConfig/launch.js 1 https://www.douyin.com

<span class="hljs-comment"># 终端 2：启动账号 2</span>
node chromeToolConfig/launch.js 2 https://www.douyin.com

<span class="hljs-comment"># 终端 3：启动账号 3</span>
node chromeToolConfig/launch.js 3 https://www.douyin.com
</code></pre>
<p>三个窗口同时运行，互不干扰，可以同时进行不同账号的操作。</p>
<h4 data-id="heading-11">场景 3：快速切换账号</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 工作时使用账号 1</span>
node chromeToolConfig/launch.js 1 -soft

<span class="hljs-comment"># 需要切换到账号 2</span>
node chromeToolConfig/launch.js 2 -soft

<span class="hljs-comment"># 回到账号 1</span>
node chromeToolConfig/launch.js 1 -soft
</code></pre>
<p>使用 <code>-soft</code> 模式，秒级切换，窗口自动置顶。</p>
<h3 data-id="heading-12">核心实现</h3>
<h4 data-id="heading-13">1. 配置管理</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// api/config.js</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createConfig</span>(<span class="hljs-params">data</span>) {
  <span class="hljs-comment">// 验证数据</span>
  <span class="hljs-title function_">validateConfig</span>(data)
  
  <span class="hljs-comment">// 检查端口和目录唯一性</span>
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">checkUniqueness</span>(data.<span class="hljs-property">config</span>)
  
  <span class="hljs-comment">// 生成 ID</span>
  <span class="hljs-keyword">const</span> id = <span class="hljs-title function_">generateId</span>(<span class="hljs-string">'chrome_config'</span>)
  
  <span class="hljs-comment">// 保存配置</span>
  <span class="hljs-keyword">const</span> config = {
    id,
    <span class="hljs-attr">name</span>: data.<span class="hljs-property">name</span>,
    <span class="hljs-attr">config</span>: data.<span class="hljs-property">config</span>,
    <span class="hljs-attr">links</span>: {},
    <span class="hljs-attr">createdAt</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>()
  }
  
  <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">save</span>(<span class="hljs-string">'configs'</span>, id, config)
  <span class="hljs-keyword">return</span> config
}
</code></pre>
<h4 data-id="heading-14">2. Chrome 启动</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// api/chrome.js</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">launchChrome</span>(<span class="hljs-params">id, options = {}</span>) {
  <span class="hljs-keyword">const</span> config = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getConfig</span>(id)
  <span class="hljs-keyword">const</span> userDataDir = path.<span class="hljs-title function_">resolve</span>(config.<span class="hljs-property">config</span>.<span class="hljs-property">userDataDir</span>)
  
  <span class="hljs-comment">// 确保目录存在</span>
  <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">ensureDir</span>(userDataDir)
  
  <span class="hljs-comment">// 构建启动参数</span>
  <span class="hljs-keyword">const</span> args = [
    <span class="hljs-string">`--user-data-dir=<span class="hljs-subst">${userDataDir}</span>`</span>,
    <span class="hljs-string">`--remote-debugging-port=<span class="hljs-subst">${config.config.remoteDebuggingPort}</span>`</span>
  ]
  
  <span class="hljs-keyword">if</span> (options.<span class="hljs-property">url</span>) {
    args.<span class="hljs-title function_">push</span>(options.<span class="hljs-property">url</span>)
  }
  
  <span class="hljs-comment">// 启动 Chrome</span>
  <span class="hljs-keyword">const</span> chromePath = <span class="hljs-title function_">getChromePath</span>()
  <span class="hljs-keyword">const</span> chromeProcess = <span class="hljs-title function_">spawn</span>(chromePath, args, {
    <span class="hljs-attr">detached</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">stdio</span>: <span class="hljs-string">'ignore'</span>
  })
  
  chromeProcess.<span class="hljs-title function_">unref</span>()
  
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">pid</span>: chromeProcess.<span class="hljs-property">pid</span>,
    <span class="hljs-attr">port</span>: config.<span class="hljs-property">config</span>.<span class="hljs-property">remoteDebuggingPort</span>
  }
}
</code></pre>
<h4 data-id="heading-15">3. 进程管理</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 检查是否运行</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">isChromRunning</span>(<span class="hljs-params">id</span>) {
  <span class="hljs-keyword">const</span> config = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getConfig</span>(id)
  <span class="hljs-keyword">const</span> port = config.<span class="hljs-property">config</span>.<span class="hljs-property">remoteDebuggingPort</span>
  
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> req = http.<span class="hljs-title function_">get</span>(
      <span class="hljs-string">`http://localhost:<span class="hljs-subst">${port}</span>/json/version`</span>,
      <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> <span class="hljs-title function_">resolve</span>(res.<span class="hljs-property">statusCode</span> === <span class="hljs-number">200</span>)
    )
    
    req.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-literal">false</span>))
    req.<span class="hljs-built_in">setTimeout</span>(<span class="hljs-number">1000</span>, <span class="hljs-function">() =&gt;</span> {
      req.<span class="hljs-title function_">destroy</span>()
      <span class="hljs-title function_">resolve</span>(<span class="hljs-literal">false</span>)
    })
  })
}

<span class="hljs-comment">// 杀死进程</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">killChrome</span>(<span class="hljs-params">id</span>) {
  <span class="hljs-keyword">const</span> config = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getConfig</span>(id)
  <span class="hljs-keyword">const</span> port = config.<span class="hljs-property">config</span>.<span class="hljs-property">remoteDebuggingPort</span>
  
  <span class="hljs-comment">// 通过端口查找并杀死进程</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title function_">killChromeByPort</span>(port)
}
</code></pre>
<h3 data-id="heading-16">项目结构</h3>
<pre><code class="hljs language-bash" lang="bash">chromeToolConfig/
├── api/                    <span class="hljs-comment"># API 层</span>
│   ├── config.js          <span class="hljs-comment"># 配置管理</span>
│   ├── link.js            <span class="hljs-comment"># 账号链接管理</span>
│   ├── chrome.js          <span class="hljs-comment"># Chrome 启动管理</span>
│   └── validator.js       <span class="hljs-comment"># 数据验证</span>
├── database/              <span class="hljs-comment"># 数据层</span>
│   ├── db.js              <span class="hljs-comment"># 数据库操作</span>
│   ├── configs.json       <span class="hljs-comment"># 配置存储</span>
│   └── todos.json         <span class="hljs-comment"># 待办事项</span>
├── utils/                 <span class="hljs-comment"># 工具函数</span>
│   ├── index.js           <span class="hljs-comment"># 通用工具</span>
│   └── sync.js            <span class="hljs-comment"># 书签同步</span>
├── launch.js              <span class="hljs-comment"># 命令行启动工具</span>
└── index.js               <span class="hljs-comment"># 主入口</span>
</code></pre>
<h3 data-id="heading-17">设计亮点</h3>
<h4 data-id="heading-18">1. ID 命名规范</h4>
<p>采用统一的命名规则：</p>
<ul>
<li>配置 ID：<code>chrome_config-1</code></li>
<li>待办 ID：<code>todo-1</code></li>
</ul>
<p><strong>规则</strong>：</p>
<ul>
<li>同一含义用 <code>_</code> 连接（如 <code>chrome_config</code>）</li>
<li>不同含义用 <code>-</code> 连接（如 <code>chrome_config-1</code>）</li>
</ul>
<h4 data-id="heading-19">2. 自动 ID 补全</h4>
<p>支持简写，自动补全前缀：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 输入 "1"，自动转换为 "chrome_config-1"</span>
<span class="hljs-keyword">await</span> <span class="hljs-title function_">getConfig</span>(<span class="hljs-string">'1'</span>)
<span class="hljs-keyword">await</span> <span class="hljs-title function_">launchChrome</span>(<span class="hljs-string">'1'</span>)
<span class="hljs-keyword">await</span> <span class="hljs-title function_">syncBookmarks</span>(<span class="hljs-string">'1'</span>, <span class="hljs-string">'2'</span>)
</code></pre>
<h4 data-id="heading-20">3. 数据验证</h4>
<p>使用 Joi 进行严格的数据验证：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> configSchema = <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">object</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">string</span>().required(),
  <span class="hljs-attr">config</span>: <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">object</span>({
    <span class="hljs-attr">userDataDir</span>: <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">string</span>().required(),
    <span class="hljs-attr">remoteDebuggingPort</span>: <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">number</span>().<span class="hljs-title function_">integer</span>().<span class="hljs-title function_">min</span>(<span class="hljs-number">1024</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">65535</span>).required(),
    <span class="hljs-attr">headless</span>: <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">boolean</span>(),
    <span class="hljs-attr">windowSize</span>: <span class="hljs-title class_">Joi</span>.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">pattern</span>(<span class="hljs-regexp">/^\d+,\d+$/</span>)
  }).required()
})
</code></pre>
<h4 data-id="heading-21">4. 跨平台支持</h4>
<p>自动检测操作系统，使用对应的 Chrome 路径：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getChromePath</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> platform = process.<span class="hljs-property">platform</span>
  
  <span class="hljs-keyword">if</span> (platform === <span class="hljs-string">'darwin'</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">'/Applications/Google Chrome.app/Contents/MacOS/Google Chrome'</span>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (platform === <span class="hljs-string">'win32'</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">'C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe'</span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">'google-chrome'</span>
  }
}
</code></pre>
<h3 data-id="heading-22">扩展能力</h3>
<h4 data-id="heading-23">1. 与 Puppeteer 集成</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> puppeteer = <span class="hljs-built_in">require</span>(<span class="hljs-string">'puppeteer'</span>)
<span class="hljs-keyword">const</span> { launchChrome } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./chromeToolConfig'</span>)

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">connectToChrome</span>(<span class="hljs-params">configId</span>) {
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">launchChrome</span>(configId)
  
  <span class="hljs-keyword">const</span> browser = <span class="hljs-keyword">await</span> puppeteer.<span class="hljs-title function_">connect</span>({
    <span class="hljs-attr">browserURL</span>: <span class="hljs-string">`http://localhost:<span class="hljs-subst">${result.port}</span>`</span>
  })
  
  <span class="hljs-keyword">return</span> browser
}
</code></pre>
<h4 data-id="heading-24">2. 与 Playwright 集成</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { chromium } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'playwright'</span>)
<span class="hljs-keyword">const</span> { launchChrome } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./chromeToolConfig'</span>)

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">connectToChrome</span>(<span class="hljs-params">configId</span>) {
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">launchChrome</span>(configId)
  
  <span class="hljs-keyword">const</span> browser = <span class="hljs-keyword">await</span> chromium.<span class="hljs-title function_">connectOverCDP</span>(
    <span class="hljs-string">`http://localhost:<span class="hljs-subst">${result.port}</span>`</span>
  )
  
  <span class="hljs-keyword">return</span> browser
}
</code></pre>
<h4 data-id="heading-25">3. 定时任务</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> cron = <span class="hljs-built_in">require</span>(<span class="hljs-string">'node-cron'</span>)

<span class="hljs-comment">// 每天凌晨 2 点重启所有 Chrome 实例</span>
cron.<span class="hljs-title function_">schedule</span>(<span class="hljs-string">'0 2 * * *'</span>, <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> configs = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getAllConfigs</span>()
  
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> config <span class="hljs-keyword">of</span> configs) {
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">killChrome</span>(config.<span class="hljs-property">id</span>)
    <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">1000</span>))
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">launchChrome</span>(config.<span class="hljs-property">id</span>)
  }
})
</code></pre>
<h3 data-id="heading-26">最佳实践</h3>
<h4 data-id="heading-27">1. 端口分配</h4>
<p>建议为不同用途的配置分配不同的端口段：</p>
<ul>
<li>9222-9229：开发环境</li>
<li>9230-9239：测试环境</li>
<li>9240-9249：生产环境</li>
</ul>
<h4 data-id="heading-28">2. 目录管理</h4>
<p>使用有意义的目录名：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">await</span> <span class="hljs-title function_">createConfig</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'抖音-主账号'</span>,
  <span class="hljs-attr">config</span>: {
    <span class="hljs-attr">userDataDir</span>: <span class="hljs-string">'./chrome-profiles/douyin/main'</span>,
    <span class="hljs-attr">remoteDebuggingPort</span>: <span class="hljs-number">9222</span>
  }
})

<span class="hljs-keyword">await</span> <span class="hljs-title function_">createConfig</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'抖音-测试账号'</span>,
  <span class="hljs-attr">config</span>: {
    <span class="hljs-attr">userDataDir</span>: <span class="hljs-string">'./chrome-profiles/douyin/test'</span>,
    <span class="hljs-attr">remoteDebuggingPort</span>: <span class="hljs-number">9223</span>
  }
})
</code></pre>
<h4 data-id="heading-29">3. 定期清理</h4>
<p>定期清理不用的配置和用户数据目录：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { deleteConfig } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./chromeToolConfig'</span>)
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs-extra'</span>)

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">cleanup</span>(<span class="hljs-params">configId</span>) {
  <span class="hljs-keyword">const</span> config = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getConfig</span>(configId)
  
  <span class="hljs-comment">// 删除配置</span>
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">deleteConfig</span>(configId)
  
  <span class="hljs-comment">// 删除用户数据目录</span>
  <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">remove</span>(config.<span class="hljs-property">config</span>.<span class="hljs-property">userDataDir</span>)
}
</code></pre>
<h4 data-id="heading-30">4. 错误处理</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">safelaunchChrome</span>(<span class="hljs-params">configId</span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 检查是否已运行</span>
    <span class="hljs-keyword">const</span> isRunning = <span class="hljs-keyword">await</span> <span class="hljs-title function_">isChromRunning</span>(configId)
    
    <span class="hljs-keyword">if</span> (isRunning) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Chrome 已在运行，使用 -hard 模式重启'</span>)
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">killChrome</span>(configId)
      <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">1000</span>))
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title function_">launchChrome</span>(configId)
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'启动失败:'</span>, error.<span class="hljs-property">message</span>)
    <span class="hljs-keyword">throw</span> error
  }
}
</code></pre>
<h3 data-id="heading-31">性能优化</h3>
<h4 data-id="heading-32">1. 延迟加载</h4>
<p>只在需要时才启动 Chrome：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ChromeManager</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">instances</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()
  }
  
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getInstance</span>(<span class="hljs-params">configId</span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">instances</span>.<span class="hljs-title function_">has</span>(configId)) {
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">launchChrome</span>(configId)
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">instances</span>.<span class="hljs-title function_">set</span>(configId, result)
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">instances</span>.<span class="hljs-title function_">get</span>(configId)
  }
}
</code></pre>
<h4 data-id="heading-33">2. 连接池</h4>
<p>复用已启动的实例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ChromePool</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">maxSize = <span class="hljs-number">5</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pool</span> = []
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxSize</span> = maxSize
  }
  
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">acquire</span>(<span class="hljs-params">configId</span>) {
    <span class="hljs-comment">// 查找空闲实例</span>
    <span class="hljs-keyword">let</span> instance = <span class="hljs-variable language_">this</span>.<span class="hljs-property">pool</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> i.<span class="hljs-property">configId</span> === configId &amp;&amp; !i.<span class="hljs-property">busy</span>)
    
    <span class="hljs-keyword">if</span> (!instance) {
      <span class="hljs-comment">// 创建新实例</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">pool</span>.<span class="hljs-property">length</span> &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxSize</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Pool is full'</span>)
      }
      
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">launchChrome</span>(configId)
      instance = { ...result, <span class="hljs-attr">busy</span>: <span class="hljs-literal">false</span> }
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pool</span>.<span class="hljs-title function_">push</span>(instance)
    }
    
    instance.<span class="hljs-property">busy</span> = <span class="hljs-literal">true</span>
    <span class="hljs-keyword">return</span> instance
  }
  
  <span class="hljs-title function_">release</span>(<span class="hljs-params">instance</span>) {
    instance.<span class="hljs-property">busy</span> = <span class="hljs-literal">false</span>
  }
}
</code></pre>
<h3 data-id="heading-34">总结</h3>
<p>Chrome 多实例配置管理器通过以下特性，彻底解决了多账号管理的痛点：</p>
<p>✅ <strong>完全隔离</strong>：每个账号独立的用户数据目录<br/>
✅ <strong>持久化登录</strong>：关闭浏览器后自动恢复登录态<br/>
✅ <strong>灵活启动</strong>：三种模式满足不同场景需求<br/>
✅ <strong>脚本友好</strong>：通过调试端口轻松集成自动化工具<br/>
✅ <strong>配置管理</strong>：统一管理所有配置和账号信息<br/>
✅ <strong>跨平台</strong>：支持 macOS、Windows、Linux</p>
<p>无论是自动化测试、爬虫开发，还是日常的多账号管理，这个方案都能大幅提升效率。</p>
<h3 data-id="heading-35">参考资料</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fchromedevtools.github.io%2Fdevtools-protocol%2F" target="_blank" title="https://chromedevtools.github.io/devtools-protocol/" ref="nofollow noopener noreferrer">Chrome DevTools Protocol</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2F" target="_blank" title="https://pptr.dev/" ref="nofollow noopener noreferrer">Puppeteer Documentation</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fplaywright.dev%2F" target="_blank" title="https://playwright.dev/" ref="nofollow noopener noreferrer">Playwright Documentation</a></li>
</ul>
<hr/>
<p>如果这篇文章对你有帮助，欢迎点赞收藏！有任何问题欢迎在评论区讨论 🎉</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GitLab/Gerrit中SSH协议实现原理及公钥邮箱作用浅谈]]></title>    <link>https://juejin.cn/post/7604678037808611364</link>    <guid>https://juejin.cn/post/7604678037808611364</guid>    <pubDate>2026-02-10T01:55:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604678037808611364" data-draft-id="7604574877035741227" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GitLab/Gerrit中SSH协议实现原理及公钥邮箱作用浅谈"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-02-10T01:55:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Android童话镇"/> <meta itemprop="url" content="https://juejin.cn/user/2716247406161241"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GitLab/Gerrit中SSH协议实现原理及公钥邮箱作用浅谈
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2716247406161241/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Android童话镇
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T01:55:10.000Z" title="Tue Feb 10 2026 01:55:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🔑 SSH密钥大冒险：小明与Git城堡的故事</h2>
<h3 data-id="heading-1">故事背景：神秘的Git城堡</h3>
<p>想象一下，有一个叫做“Git城堡”（Git服务器）的地方，里面藏着很多珍贵的代码宝藏。小明（开发者）想去城堡里存放和取出宝藏，但城堡有严格的安全规则：</p>
<h4 data-id="heading-2">第一章：特殊的钥匙系统 🗝️</h4>
<p><strong>传统钥匙（密码）的问题：</strong></p>
<ul>
<li>每次进出都要报密码，侍卫（服务器）得记住所有人的密码</li>
<li>密码容易被人偷听，不够安全</li>
<li>小明很健忘，经常忘记密码</li>
</ul>
<p><strong>城堡的新发明：双生魔法钥匙</strong></p>
<pre><code class="hljs language-text" lang="text">公钥 = 魔法锁芯（可以给别人）
私钥 = 魔法钥匙（自己保管，绝不外传）
</code></pre>
<h3 data-id="heading-3">📜 代码实现：制作魔法钥匙</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 小明在本地终端施展魔法</span>
ssh-keygen -t ed25519 -C <span class="hljs-string">"xiaoming@company.com"</span>

<span class="hljs-comment"># 魔法过程详解：</span>
<span class="hljs-comment"># 1. -t ed25519：选择最先进的魔法配方（加密算法）</span>
<span class="hljs-comment"># 2. -C "邮箱"：给钥匙刻上专属标记</span>
<span class="hljs-comment"># 3. 系统会问：钥匙存放哪里？（默认~/.ssh/id_ed25519）</span>
<span class="hljs-comment"># 4. 系统会问：要不要给钥匙加咒语密码？（可选）</span>

<span class="hljs-comment"># 生成的两个文件：</span>
~/.ssh/id_ed25519      <span class="hljs-comment"># 私钥（绝密！600权限）</span>
~/.ssh/id_ed25519.pub  <span class="hljs-comment"># 公钥（可以公开）</span>
</code></pre>
<h3 data-id="heading-4">🏰 公钥内容解析：为什么要有邮箱？</h3>
<p>看看小明的公钥文件：</p>
<pre><code class="hljs language-text" lang="text">ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIML5rV... xiaoming@company.com
</code></pre>
<p><strong>为什么必须刻邮箱？故事继续...</strong></p>
<h4 data-id="heading-5">第二章：城堡的钥匙墙 🧱</h4>
<p>当小明把自己的“魔法锁芯”（公钥）交给城堡时：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 城堡管理员把公钥贴在“允许进入的钥匙墙”上</span>
<span class="hljs-comment"># 文件位置：~/.ssh/authorized_keys</span>

<span class="hljs-comment"># 钥匙墙内容：</span>
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIML5rV... xiaoming@company.com
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC8... xiaohong@company.com
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIKJ9hT... ci-bot@company.com
</code></pre>
<p><strong>📌 邮箱的三大作用：</strong></p>
<ol>
<li><strong>身份标识</strong>：城堡侍卫一看就知道“哦，这是小明来了！”</li>
<li><strong>防止混乱</strong>：如果小明有多个密钥（办公电脑、家里电脑），都能知道是同一个人</li>
<li><strong>审计追踪</strong>：城堡日志会记录“<a href="https://link.juejin.cn?target=mailto%3Axiaoming%40company.com" target="_blank" title="mailto:xiaoming@company.com" ref="nofollow noopener noreferrer">xiaoming@company.com</a> 在 14:30 提交了代码”</li>
</ol>
<h3 data-id="heading-6">🎭 生动的场景对比</h3>
<p><strong>没有邮箱的情况：</strong></p>
<pre><code class="hljs language-text" lang="text">侍卫：墙上有个没名字的锁芯转动了！
侍卫：呃...你是谁？我该叫你“用户A”还是“访客B”？
城堡日志：无名人氏访问了仓库 → 出问题没法追踪
</code></pre>
<p><strong>有邮箱的情况：</strong></p>
<pre><code class="hljs language-text" lang="text">侍卫：看到 xiaoming@company.com 的锁芯在转动！
侍卫：欢迎回来，小明！你的工位在二楼，权限是开发者
城堡日志：小明提交了登录功能 → 清晰可追溯
</code></pre>
<h3 data-id="heading-7">🔄 SSH握手时序图：完整的魔法仪式</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a421181df4446e5be6b1e74192e048a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOerpeivnemVhw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771293310&amp;x-signature=WINUxWekqGV3f5gkfg%2BWWeOu15Y%3D" alt="SSH握手时序图：完整的魔法仪式.png" loading="lazy"/></p>
<h3 data-id="heading-8">💻 代码详解：握手过程的背后</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 简化版的SSH认证逻辑（概念代码）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SSHServer</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">authenticate</span>(<span class="hljs-params">self, client_public_key, signature</span>):
        <span class="hljs-comment"># 1. 在authorized_keys中查找公钥</span>
        user_info = self.authorized_keys.get(client_public_key)
        
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> user_info:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"认证失败：未知的公钥"</span>
        
        <span class="hljs-comment"># 2. 提取邮箱标识（用于日志和权限）</span>
        email = user_info.email  <span class="hljs-comment"># 这就是-C参数设置的邮箱！</span>
        username = email.split(<span class="hljs-string">'@'</span>)[<span class="hljs-number">0</span>]
        
        <span class="hljs-comment"># 3. 验证签名</span>
        challenge = self.generate_challenge()
        <span class="hljs-keyword">if</span> self.verify_signature(client_public_key, signature, challenge):
            <span class="hljs-comment"># 4. 根据邮箱分配权限</span>
            permissions = self.get_permissions_by_email(email)
            self.log_access(email, <span class="hljs-string">"认证成功"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">f"欢迎 <span class="hljs-subst">{username}</span>！权限：<span class="hljs-subst">{permissions}</span>"</span>
        <span class="hljs-keyword">else</span>:
            self.log_access(email, <span class="hljs-string">"认证失败"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">"签名验证失败"</span>

<span class="hljs-comment"># GitLab的实际使用场景</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">GitLabSSH</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_git_push</span>(<span class="hljs-params">self, ssh_key</span>):
        <span class="hljs-comment"># 通过邮箱找到对应的GitLab用户</span>
        user = User.find_by_ssh_key_email(ssh_key.email)
        
        <span class="hljs-comment"># 记录谁在操作</span>
        AuditLog.create(
            user: user,
            action: <span class="hljs-string">'git_push'</span>,
            project: <span class="hljs-string">'android-framework'</span>
        )
        
        <span class="hljs-comment"># 执行git操作</span>
        <span class="hljs-keyword">return</span> self.git.receive_pack(user)
</code></pre>
<h3 data-id="heading-9">🎯 Gerrit的特殊情况：邮箱即用户名</h3>
<p>在Gerrit中，邮箱更加重要：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Gerrit配置示例</span>
[gerrit]
    <span class="hljs-comment"># 邮箱直接作为用户标识</span>
    userName = xiaoming
    userEmail = xiaoming@company.com

<span class="hljs-comment"># SSH连接Gerrit时</span>
ssh -p 29418 xiaoming@gerrit.company.com
<span class="hljs-comment"># Gerrit会查找：哪个公钥属于 xiaoming@company.com？</span>
</code></pre>
<h3 data-id="heading-10">🚀 实际工作中的最佳实践</h3>
<h4 data-id="heading-11">情况1：个人开发</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 一个邮箱，多个设备</span>
ssh-keygen -C <span class="hljs-string">"ming@company.com"</span> -f ~/.ssh/id_ed25519_work_mac
ssh-keygen -C <span class="hljs-string">"ming@company.com"</span> -f ~/.ssh/id_ed25519_work_pc
<span class="hljs-comment"># 虽然密钥不同，但邮箱相同，服务器知道是同一人</span>
</code></pre>
<h4 data-id="heading-12">情况2：多角色场景</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 小明在公司有两个角色</span>
ssh-keygen -C <span class="hljs-string">"xiaoming-dev@company.com"</span>   <span class="hljs-comment"># 开发权限</span>
ssh-keygen -C <span class="hljs-string">"xiaoming-admin@company.com"</span> <span class="hljs-comment"># 管理员权限</span>
<span class="hljs-comment"># 服务器根据邮箱给予不同权限</span>
</code></pre>
<h4 data-id="heading-13">情况3：CI/CD机器人</h4>
<pre><code class="hljs language-bash" lang="bash">ssh-keygen -C <span class="hljs-string">"android-ci-bot@company.com"</span>
<span class="hljs-comment"># 日志中清楚看到是机器人在操作，不是真人</span>
</code></pre>
<h3 data-id="heading-14">🔧 排错指南：当魔法失灵时</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 检查钥匙权限（私钥太公开就不安全！）</span>
<span class="hljs-built_in">chmod</span> 600 ~/.ssh/id_ed25519

<span class="hljs-comment"># 2. 查看城堡的钥匙墙</span>
<span class="hljs-built_in">cat</span> ~/.ssh/authorized_keys
<span class="hljs-comment"># 确保公钥完整复制，邮箱在末尾</span>

<span class="hljs-comment"># 3. 测试连接并查看详细过程</span>
ssh -Tv git@gitlab.com
<span class="hljs-comment"># 会看到类似输出：</span>
<span class="hljs-comment"># debug1: identity file /home/xiaoming/.ssh/id_ed25519</span>
<span class="hljs-comment"># debug1: Authentications that can continue: publickey</span>
<span class="hljs-comment"># debug1: Offering public key: /home/xiaoming/.ssh/id_ed25519 ED25519 SHA256:... xiaoming@company.com</span>
</code></pre>
<h3 data-id="heading-15">📊 总结：邮箱的重要性表格</h3>



































<table><thead><tr><th>场景</th><th>没有邮箱</th><th>有邮箱</th></tr></thead><tbody><tr><td><strong>身份识别</strong></td><td>“某个匿名用户”</td><td>“小明@公司”</td></tr><tr><td><strong>权限管理</strong></td><td>难以精细控制</td><td>按邮箱分配读写权限</td></tr><tr><td><strong>审计日志</strong></td><td>无法追溯操作者</td><td>完整操作记录</td></tr><tr><td><strong>多密钥管理</strong></td><td>混乱，不知道哪个设备</td><td>清晰，知道是小明的办公电脑</td></tr><tr><td><strong>团队协作</strong></td><td>冲突：两个人都叫“android-dev”</td><td>明确：小明、小红、CI机器人</td></tr></tbody></table>
<h3 data-id="heading-16">🎁 一键配置脚本</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># setup_ssh_for_git.sh</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"🎯 开始配置SSH密钥..."</span>
<span class="hljs-built_in">read</span> -p <span class="hljs-string">"请输入你的邮箱: "</span> user_email

<span class="hljs-comment"># 1. 生成密钥</span>
ssh-keygen -t ed25519 -C <span class="hljs-string">"<span class="hljs-variable">$user_email</span>"</span> -f ~/.ssh/id_ed25519_<span class="hljs-variable">$USER</span>

<span class="hljs-comment"># 2. 启动ssh-agent</span>
<span class="hljs-built_in">eval</span> <span class="hljs-string">"<span class="hljs-subst">$(ssh-agent -s)</span>"</span>

<span class="hljs-comment"># 3. 添加私钥</span>
ssh-add ~/.ssh/id_ed25519_<span class="hljs-variable">$USER</span>

<span class="hljs-comment"># 4. 显示公钥</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"🎉 你的公钥已生成！请复制到GitLab/Gerrit："</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"========================================"</span>
<span class="hljs-built_in">cat</span> ~/.ssh/id_ed25519_<span class="hljs-variable">$USER</span>.pub
<span class="hljs-built_in">echo</span> <span class="hljs-string">"========================================"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"🔑 密钥位置：~/.ssh/id_ed25519_<span class="hljs-variable">$USER</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"📧 密钥标识：<span class="hljs-variable">$user_email</span>"</span>
</code></pre>
<h3 data-id="heading-17">🌟 核心要点回顾</h3>
<ol>
<li><strong>公钥是锁芯，私钥是真钥匙</strong>：公钥可公开，私钥绝密</li>
<li><strong>邮箱是身份证</strong>：告诉服务器“我是谁”</li>
<li><strong>认证过程</strong>：挑战-响应，证明你有私钥</li>
<li><strong>实际价值</strong>：无需密码、安全可靠、易于管理</li>
</ol>
<p>就像古代将军的虎符，一半在君王（服务器），一半在将军（客户端），两半合一对得上，再加刻着将军的名字（邮箱），才能调兵遣将（操作代码库）。</p>
<p>现在当你在GitLab上看到 <code>xiaoming@company.com pushed to main</code>，就知道这不仅仅是技术实现，更是清晰的协作标识！🚀</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🚀 Vercel AI SDK 使用指南：工具调用 Tools]]></title>    <link>https://juejin.cn/post/7604671453453271055</link>    <guid>https://juejin.cn/post/7604671453453271055</guid>    <pubDate>2026-02-10T00:28:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604671453453271055" data-draft-id="7604522883487072290" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🚀 Vercel AI SDK 使用指南：工具调用 Tools"/> <meta itemprop="keywords" content="TypeScript"/> <meta itemprop="datePublished" content="2026-02-10T00:28:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ZaneAI"/> <meta itemprop="url" content="https://juejin.cn/user/186266444380203"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🚀 Vercel AI SDK 使用指南：工具调用 Tools
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/186266444380203/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ZaneAI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T00:28:51.000Z" title="Tue Feb 10 2026 00:28:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🤔 什么是 Tools？为什么需要它？</h2>
<p>大模型本身是静态的，它的知识截止于训练数据的时间点，并且无法直接与外部世界交互。 <strong>Tools（工具）</strong> 就是大模型的“双手”和“眼睛”。</p>
<p>简单来说，Tool 是一个<strong>可以被模型调用的函数</strong>。 当你在 AI SDK 中定义一个 Tool 时，你实际上是告诉模型：“嘿，如果你遇到这个问题，可以调用这个函数，我会给你返回结果。”</p>
<p>一个标准的 Tool 包含三个核心要素：</p>
<ol>
<li><strong>description (描述)</strong> ：告诉模型这个工具是干嘛的（这其实也是 Prompt 的一部分）。</li>
<li><strong>inputSchema (输入定义)</strong> ：定义模型需要提供什么参数（通常使用 Zod 定义）。</li>
<li><strong>execute (执行逻辑)</strong> ：当模型决定调用工具时，实际运行的异步函数。</li>
</ol>
<hr/>
<h2 data-id="heading-1">🛠️ 实战：定义你的第一个自定义工具 (Custom Tool)</h2>
<p>AI SDK 提供了一个极其优雅的 <code>tool</code> 辅助函数。我们以一个经典的“获取天气”为例。</p>
<h3 data-id="heading-2">1. 安装依赖</h3>
<p>首先确保你安装了必要的库：</p>
<p>Bash</p>
<pre><code class="hljs">npm install ai zod
</code></pre>
<h3 data-id="heading-3">2. 编写工具代码</h3>
<p>TypeScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { tool } <span class="hljs-keyword">from</span> <span class="hljs-string">'ai'</span>;
<span class="hljs-keyword">import</span> { z } <span class="hljs-keyword">from</span> <span class="hljs-string">'zod'</span>;

<span class="hljs-comment">// 定义一个名为 weatherTool 的工具</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> weatherTool = <span class="hljs-title function_">tool</span>({
  <span class="hljs-comment">// 1. 描述：非常重要，模型根据它决定是否调用</span>
  <span class="hljs-attr">description</span>: <span class="hljs-string">'获取指定地点的实时天气信息'</span>,
  
  <span class="hljs-comment">// 2. 参数结构：使用 Zod 定义，模型会严格遵守这个结构生成参数</span>
  <span class="hljs-attr">inputSchema</span>: z.<span class="hljs-title function_">object</span>({
    <span class="hljs-attr">location</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">describe</span>(<span class="hljs-string">'需要查询天气的城市或地点，例如：London, Beijing'</span>),
    <span class="hljs-attr">unit</span>: z.<span class="hljs-title function_">enum</span>([<span class="hljs-string">'celsius'</span>, <span class="hljs-string">'fahrenheit'</span>]).<span class="hljs-title function_">optional</span>().<span class="hljs-title function_">default</span>(<span class="hljs-string">'celsius'</span>).<span class="hljs-title function_">describe</span>(<span class="hljs-string">'温度单位'</span>),
  }),
  
  <span class="hljs-comment">// 3. 执行逻辑：模型调用时自动运行</span>
  <span class="hljs-attr">execute</span>: <span class="hljs-keyword">async</span> ({ location, unit }) =&gt; {
    <span class="hljs-comment">// 在真实场景中，这里会调用第三方天气 API</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`正在查询 <span class="hljs-subst">${location}</span> 的天气...`</span>);
    
    <span class="hljs-comment">// 模拟返回数据</span>
    <span class="hljs-keyword">const</span> temp = <span class="hljs-number">25</span>; 
    <span class="hljs-keyword">return</span> {
      location,
      <span class="hljs-attr">temperature</span>: temp,
      unit,
      <span class="hljs-attr">condition</span>: <span class="hljs-string">'Sunny'</span>,
      <span class="hljs-attr">note</span>: <span class="hljs-string">'这是一个模拟数据'</span>,
    };
  },
});
</code></pre>
<blockquote>
<p><strong>💡 提示</strong>：<code>inputSchema</code> 中的 <code>.describe()</code> 非常关键，它会被转换成 JSON Schema 喂给大模型，帮助模型理解参数的含义。</p>
</blockquote>
<hr/>
<h2 data-id="heading-4">🔗 连接模型：让 AI 使用工具</h2>
<p>定义好工具后，我们需要通过 <code>generateText</code> 或 <code>streamText</code> 将其绑定到模型上。</p>
<p>这里假设你已经配置好了 OpenAI 或其他 Provider。</p>
<p>TypeScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { generateText } <span class="hljs-keyword">from</span> <span class="hljs-string">'ai'</span>;
<span class="hljs-keyword">import</span> { openai } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ai-sdk/openai'</span>; <span class="hljs-comment">// 或其他 provider</span>
<span class="hljs-keyword">import</span> { weatherTool } <span class="hljs-keyword">from</span> <span class="hljs-string">'./tools'</span>; <span class="hljs-comment">// 引入上面定义的工具</span>

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">askAI</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> { text, toolResults } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">generateText</span>({
    <span class="hljs-attr">model</span>: <span class="hljs-title function_">openai</span>(<span class="hljs-string">'gpt-4o'</span>), <span class="hljs-comment">// 确保模型支持 Function Calling</span>
    
    <span class="hljs-comment">// 将工具注册到 tools 对象中</span>
    <span class="hljs-attr">tools</span>: {
      <span class="hljs-attr">weather</span>: weatherTool, 
    },
    
    <span class="hljs-comment">// 开启多步交互（关键！）</span>
    <span class="hljs-comment">// 如果不设置 maxSteps，模型只会生成工具调用参数，而不会执行并利用结果生成最终回复</span>
    <span class="hljs-attr">maxSteps</span>: <span class="hljs-number">5</span>, 
    
    <span class="hljs-attr">prompt</span>: <span class="hljs-string">'上海现在的天气怎么样？适合穿什么衣服？'</span>,
  });

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'AI 回复:'</span>, text);
}

<span class="hljs-title function_">askAI</span>();
</code></pre>
<h3 data-id="heading-5">幕后发生了什么？（Roundtrip 原理）</h3>
<p>当你设置 <code>maxSteps: 5</code> 时，AI SDK 自动处理了一个复杂的循环：</p>
<ol>
<li><strong>用户提问</strong>：“上海天气如何？”</li>
<li><strong>模型思考</strong>：发现需要天气信息，决定调用 <code>weather</code> 工具，生成参数 <code>{ location: "Shanghai", unit: "celsius" }</code>。</li>
<li><strong>AI SDK 介入</strong>：检测到模型想调用工具，自动运行 <code>weatherTool.execute</code> 函数。</li>
<li><strong>获取结果</strong>：函数返回 <code>{ temperature: 25, condition: 'Sunny' }</code>。</li>
<li><strong>回传模型</strong>：AI SDK 将工具的运行结果作为一种特殊的“消息”发回给模型。</li>
<li><strong>最终生成</strong>：模型结合查询到的天气数据，生成最终回答：“上海现在 25 度，晴天，非常舒适，建议穿T恤...”</li>
</ol>
<hr/>
<h2 data-id="heading-6">🧩 进阶：三种工具类型的区别</h2>
<p>AI SDK 文档中提到了三种工具类型，理解它们的区别对于高级开发很重要：</p>
<h3 data-id="heading-7">1. Custom Tools (自定义工具) - <strong>最常用</strong></h3>
<ul>
<li><strong>特点</strong>：你完全控制。你需要编写 <code>inputSchema</code> 和 <code>execute</code> 函数。</li>
<li><strong>适用场景</strong>：查数据库、调内部 API、执行业务逻辑。</li>
<li><strong>代码</strong>：即上面演示的 <code>tool({...})</code>。</li>
</ul>
<h3 data-id="heading-8">2. Provider-Defined Tools (提供商定义工具)</h3>
<ul>
<li><strong>特点</strong>：提供商（如 Anthropic）定义好了 schema，<strong>但代码在你本地运行</strong>。</li>
<li><strong>例子</strong>：Anthropic 的 <code>bash</code> 或 <code>text_editor</code> 工具。模型经过专门训练，能更精准地使用这些特定工具。</li>
<li><strong>适用场景</strong>：当你想利用特定模型对特定工具的强项时（例如让 Claude 帮你写代码并存文件）。</li>
</ul>
<p>TypeScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 伪代码示例</span>
<span class="hljs-keyword">import</span> { anthropic } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ai-sdk/anthropic'</span>;
<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">generateText</span>({
  <span class="hljs-attr">model</span>: <span class="hljs-title function_">anthropic</span>(<span class="hljs-string">'claude-3-5-sonnet-20240620'</span>),
  <span class="hljs-attr">tools</span>: {
    <span class="hljs-comment">// 引用 Anthropic 定义好的 bash 工具结构</span>
    <span class="hljs-attr">bash</span>: anthropic.<span class="hljs-property">tools</span>.<span class="hljs-title function_">bash_20250124</span>({
      <span class="hljs-comment">// 你仍然需要提供执行逻辑（因为这是在你服务器上跑的）</span>
      <span class="hljs-attr">execute</span>: <span class="hljs-keyword">async</span> ({ command }) =&gt; <span class="hljs-keyword">await</span> <span class="hljs-title function_">myRunCommand</span>(command), 
    }),
  },
  <span class="hljs-attr">prompt</span>: <span class="hljs-string">"列出当前目录下的文件"</span>,
});
</code></pre>
<h3 data-id="heading-9">3. Provider-Executed Tools (提供商执行工具)</h3>
<ul>
<li><strong>特点</strong>：<strong>完全在云端运行</strong>。Schema 和 执行逻辑都由提供商搞定。</li>
<li><strong>例子</strong>：OpenAI 的 <code>web_search</code> (联网搜索) 或 Code Interpreter。</li>
<li><strong>适用场景</strong>：不想自己折腾基础设施，直接用现成的强力功能。</li>
</ul>
<p>TypeScript</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// 伪代码示例</span>
import { openai } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ai-sdk/openai'</span>;
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">result</span> = await <span class="hljs-title function_ invoke__">generateText</span>({
  <span class="hljs-attr">model</span>: <span class="hljs-title function_ invoke__">openai</span>(<span class="hljs-string">'gpt-4-turbo'</span>),
  <span class="hljs-attr">tools</span>: {
    // 直接启用 OpenAI 的联网搜索，你不需要写任何代码
    <span class="hljs-attr">web_search</span>: openai.tools.<span class="hljs-title function_ invoke__">webSearch</span>(),
  },
  <span class="hljs-attr">prompt</span>: <span class="hljs-string">"今天的科技新闻头条是什么？"</span>,
});
</code></pre>
<hr/>
<h2 data-id="heading-10">📦 工具生态：不要重复造轮子</h2>
<p>AI SDK 的一大优势是工具可以被打包成 npm 包共享。你可以直接使用社区现成的工具库：</p>
<ul>
<li><strong>联网搜索</strong>：<code>@tavily/ai-sdk</code>, <code>@exalabs/ai-sdk</code> (Exa.ai)</li>
<li><strong>浏览器操作</strong>：<code>@browserbasehq/ai-sdk</code></li>
<li><strong>企业集成</strong>：<code>@composio/ai-sdk</code> (连接 GitHub, Salesforce 等)</li>
</ul>
<p><strong>使用示例 (以 Tavily 搜索为例)：</strong></p>
<p>TypeScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { tavily } <span class="hljs-keyword">from</span> <span class="hljs-string">'@tavily/core'</span>; <span class="hljs-comment">// 假设的包结构，具体看文档</span>
<span class="hljs-keyword">import</span> { tool } <span class="hljs-keyword">from</span> <span class="hljs-string">'ai'</span>;

<span class="hljs-comment">// 很多库直接导出了兼容 AI SDK 的 tool 对象</span>
<span class="hljs-comment">// const searchTool = ... </span>

<span class="hljs-comment">// 然后在 generateText 中直接用：</span>
<span class="hljs-comment">// tools: { webSearch: searchTool }</span>
</code></pre>
<hr/>
<h2 data-id="heading-11">💡 最佳实践 Tips</h2>
<ol>
<li><strong>Prompt Engineering 在描述里</strong>：<code>description</code> 字段本质上就是 Prompt。如果模型不愿意调用工具，尝试把描述写得更详细、更诱人。</li>
<li><strong>Schema 越细越好</strong>：在 Zod 中使用 <code>.describe()</code> 不仅是文档，更是给模型的指令。</li>
<li><strong>错误处理</strong>：在 <code>execute</code> 函数中即使报错，最好也 <code>try-catch</code> 并返回一个包含错误信息的字符串，而不是直接抛出异常导致程序崩溃。这样模型有机会看到错误并尝试自我修正（例如参数填错了，模型看到错误提示后可能会重试）。</li>
<li><strong>控制步骤</strong>：<code>maxSteps</code> 不要设置过大，防止模型陷入死循环；也不要设置过小，复杂的任务可能需要多次调用工具。</li>
</ol>
<hr/>
<h2 data-id="heading-12">结语</h2>
<p>Vercel AI SDK 的 Tools 抽象非常清晰，它抹平了不同模型提供商（OpenAI, Anthropic, Google 等）在 Function Calling 格式上的差异。学会了这一套，你就可以轻松切换模型，构建出真正实用的 AI Agent。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[你可能从未用过的浏览器 API：IndexedDB 实战入门]]></title>    <link>https://juejin.cn/post/7604694326518431795</link>    <guid>https://juejin.cn/post/7604694326518431795</guid>    <pubDate>2026-02-10T01:59:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604694326518431795" data-draft-id="7604694326518415411" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="你可能从未用过的浏览器 API：IndexedDB 实战入门"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-10T01:59:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员_June"/> <meta itemprop="url" content="https://juejin.cn/user/395479916219517"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            你可能从未用过的浏览器 API：IndexedDB 实战入门
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/395479916219517/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员_June
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T01:59:23.000Z" title="Tue Feb 10 2026 01:59:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>前端开发这几年，localStorage 和 sessionStorage 用得最多，cookie 偶尔也要打打交道。但说到 IndexedDB，很多人的反应是：“听说过，但没用过。”</p>
<p>今天聊聊这个被低估的浏览器内置数据库。</p>
<h2 data-id="heading-0">一、为什么需要另一个存储方案？</h2>
<p>先看个实际场景。朋友公司做电商后台，产品经理要求：“能不能在列表页缓存 5000 条商品数据，让筛选和搜索快一点？”</p>
<p>第一版用 localStorage：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 存储</span>
<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'products'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(products)) <span class="hljs-comment">// 5000条数据，页面卡了2秒</span>

<span class="hljs-comment">// 搜索</span>
<span class="hljs-keyword">const</span> keyword = <span class="hljs-string">'手机'</span>
<span class="hljs-keyword">const</span> allProducts = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'products'</span>)) <span class="hljs-comment">// 又卡1秒</span>
<span class="hljs-keyword">const</span> results = allProducts.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> p.<span class="hljs-property">name</span>.<span class="hljs-title function_">includes</span>(keyword)) <span class="hljs-comment">// 遍历5000次</span>
</code></pre>
<p>上线后用户反馈：“筛选时浏览器像卡住了一样。”</p>
<p>问题在哪？localStorage 有硬伤：</p>
<ul>
<li>同步操作，数据量大就阻塞页面</li>
<li>只能存字符串，对象要序列化</li>
<li>容量小（通常 5-10MB）</li>
<li>只能全量读取，无法高效查询</li>
</ul>
<h2 data-id="heading-1">二、IndexedDB 是什么？</h2>
<p>简单说，<strong>它是浏览器里的 NoSQL 数据库</strong>。2011 年就出现了，但很多人不知道或觉得“用不上”。</p>
<p>几个关键特点：</p>
<ol>
<li><strong>容量大</strong>：通常能占硬盘 50%，几个 GB 没问题</li>
<li><strong>异步操作</strong>：不卡页面</li>
<li><strong>支持索引</strong>：查询速度快</li>
<li><strong>能存多种类型</strong>：对象、文件、二进制数据都行</li>
</ol>
<h2 data-id="heading-2">三、一个简单示例</h2>
<p>如果你没用过，先看看基本用法：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 打开数据库</span>
<span class="hljs-keyword">const</span> request = indexedDB.<span class="hljs-title function_">open</span>(<span class="hljs-string">'myDB'</span>, <span class="hljs-number">1</span>)

<span class="hljs-comment">// 2. 创建表结构（第一次或升级时）</span>
request.<span class="hljs-property">onupgradeneeded</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-keyword">const</span> db = event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>
  
  <span class="hljs-comment">// 创建对象存储（类似表）</span>
  <span class="hljs-keyword">const</span> store = db.<span class="hljs-title function_">createObjectStore</span>(<span class="hljs-string">'products'</span>, {
    <span class="hljs-attr">keyPath</span>: <span class="hljs-string">'id'</span>,      <span class="hljs-comment">// 主键</span>
    <span class="hljs-attr">autoIncrement</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 自动生成ID</span>
  })
  
  <span class="hljs-comment">// 创建索引（加速查询的关键）</span>
  store.<span class="hljs-title function_">createIndex</span>(<span class="hljs-string">'name'</span>, <span class="hljs-string">'name'</span>)      <span class="hljs-comment">// 按名称查</span>
  store.<span class="hljs-title function_">createIndex</span>(<span class="hljs-string">'price'</span>, <span class="hljs-string">'price'</span>)    <span class="hljs-comment">// 按价格查</span>
  store.<span class="hljs-title function_">createIndex</span>(<span class="hljs-string">'category'</span>, <span class="hljs-string">'category'</span>) <span class="hljs-comment">// 按分类查</span>
}

<span class="hljs-comment">// 3. 数据库就绪</span>
request.<span class="hljs-property">onsuccess</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-keyword">const</span> db = event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'数据库已就绪'</span>)
}
</code></pre>
<h2 data-id="heading-3">四、核心优势：查询性能</h2>
<p>这是 IndexedDB 真正厉害的地方。同样的 5000 条商品数据，查询完全不同：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 用索引查，不需要遍历所有数据</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">searchProducts</span>(<span class="hljs-params">keyword</span>) {
  <span class="hljs-keyword">const</span> transaction = db.<span class="hljs-title function_">transaction</span>([<span class="hljs-string">'products'</span>], <span class="hljs-string">'readonly'</span>)
  <span class="hljs-keyword">const</span> store = transaction.<span class="hljs-title function_">objectStore</span>(<span class="hljs-string">'products'</span>)
  <span class="hljs-keyword">const</span> index = store.<span class="hljs-title function_">index</span>(<span class="hljs-string">'name'</span>) <span class="hljs-comment">// 使用索引</span>
  
  <span class="hljs-comment">// 只搜索相关范围</span>
  <span class="hljs-keyword">const</span> range = <span class="hljs-title class_">IDBKeyRange</span>.<span class="hljs-title function_">bound</span>(keyword, keyword + <span class="hljs-string">'\uffff'</span>)
  <span class="hljs-keyword">const</span> request = index.<span class="hljs-title function_">openCursor</span>(range)
  
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> results = []
    request.<span class="hljs-property">onsuccess</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
      <span class="hljs-keyword">const</span> cursor = event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>
      <span class="hljs-keyword">if</span> (cursor) {
        results.<span class="hljs-title function_">push</span>(cursor.<span class="hljs-property">value</span>)
        cursor.<span class="hljs-title function_">continue</span>() <span class="hljs-comment">// 继续下一个</span>
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-title function_">resolve</span>(results) <span class="hljs-comment">// 搜索完成</span>
      }
    }
  })
}

<span class="hljs-comment">// 毫秒级响应，不卡页面</span>
<span class="hljs-keyword">const</span> results = <span class="hljs-keyword">await</span> <span class="hljs-title function_">searchProducts</span>(<span class="hljs-string">'手机'</span>)
</code></pre>
<p>你可以创建多个索引，实现各种复杂查询：</p>
<ul>
<li>价格区间筛选</li>
<li>多条件组合查询</li>
<li>分类统计</li>
<li>模糊搜索</li>
</ul>
<h2 data-id="heading-4">五、适用场景</h2>
<p>什么情况下该考虑 IndexedDB？</p>
<h3 data-id="heading-5">1. 离线应用</h3>
<p>邮件客户端、文档编辑器、笔记应用。数据先存本地，有网再同步。</p>
<h3 data-id="heading-6">2. 大数据缓存</h3>
<p>电商商品目录、大量配置项、历史数据。替代接口频繁请求。</p>
<h3 data-id="heading-7">3. 文件管理</h3>
<p>图片、PDF、音视频的本地缓存。不用每次都下载。</p>
<h3 data-id="heading-8">4. 游戏数据</h3>
<p>存档、配置、资源文件。支持离线游戏。</p>
<h3 data-id="heading-9">5. 分析数据</h3>
<p>收集用户行为，批量上传。避免频繁网络请求。</p>
<h2 data-id="heading-10">六、实用建议</h2>
<h3 data-id="heading-11">1. 用封装库简化开发</h3>
<p>原生 API 确实有点繁琐。推荐这些库：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 用 idb 库（推荐）</span>
<span class="hljs-keyword">import</span> { openDB } <span class="hljs-keyword">from</span> <span class="hljs-string">'idb'</span>

<span class="hljs-keyword">const</span> db = <span class="hljs-keyword">await</span> <span class="hljs-title function_">openDB</span>(<span class="hljs-string">'my-db'</span>, <span class="hljs-number">1</span>, {
  <span class="hljs-title function_">upgrade</span>(<span class="hljs-params">db</span>) {
    db.<span class="hljs-title function_">createObjectStore</span>(<span class="hljs-string">'products'</span>)
  }
})

<span class="hljs-comment">// 操作简单多了</span>
<span class="hljs-keyword">await</span> db.<span class="hljs-title function_">add</span>(<span class="hljs-string">'products'</span>, { <span class="hljs-attr">name</span>: <span class="hljs-string">'商品1'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">100</span> })
<span class="hljs-keyword">const</span> products = <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">getAll</span>(<span class="hljs-string">'products'</span>)
</code></pre>
<h3 data-id="heading-12">2. 渐进增强</h3>
<p>先判断支持性，不支持就降级：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getStorage</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-string">'indexedDB'</span> <span class="hljs-keyword">in</span> <span class="hljs-variable language_">window</span>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'indexedDB'</span>,
      <span class="hljs-attr">save</span>: saveToIndexedDB,
      <span class="hljs-attr">load</span>: loadFromIndexedDB
    }
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'降级到 localStorage'</span>)
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'localStorage'</span>,
      <span class="hljs-attr">save</span>: saveToLocalStorage,
      <span class="hljs-attr">load</span>: loadFromLocalStorage
    }
  }
}
</code></pre>
<h3 data-id="heading-13">3. 注意版本迁移</h3>
<p>修改表结构需要升级版本：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> request = indexedDB.<span class="hljs-title function_">open</span>(<span class="hljs-string">'myDB'</span>, <span class="hljs-number">2</span>) <span class="hljs-comment">// 版本号+1</span>

request.<span class="hljs-property">onupgradeneeded</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-keyword">const</span> db = event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>
  <span class="hljs-keyword">const</span> oldVersion = event.<span class="hljs-property">oldVersion</span>
  
  <span class="hljs-keyword">if</span> (oldVersion &lt; <span class="hljs-number">1</span>) {
    <span class="hljs-comment">// 初始版本逻辑</span>
  }
  
  <span class="hljs-keyword">if</span> (oldVersion &lt; <span class="hljs-number">2</span>) {
    <span class="hljs-comment">// 版本2的升级逻辑</span>
    <span class="hljs-comment">// 比如添加新索引</span>
    <span class="hljs-keyword">const</span> store = event.<span class="hljs-property">currentTarget</span>.<span class="hljs-property">transaction</span>.<span class="hljs-title function_">objectStore</span>(<span class="hljs-string">'products'</span>)
    store.<span class="hljs-title function_">createIndex</span>(<span class="hljs-string">'createdAt'</span>, <span class="hljs-string">'createdAt'</span>)
  }
}
</code></pre>
<h2 data-id="heading-14">七、什么时候不用？</h2>
<p>IndexedDB 虽好，但也不是万能：</p>
<ul>
<li>存个用户 token → 用 localStorage 或 cookie</li>
<li>会话级临时数据 → 用 sessionStorage</li>
<li>简单配置项 → localStorage 更方便</li>
<li>需要服务端读取 → cookie</li>
</ul>
<p>记住：<strong>技术选型要看具体需求</strong>，不是越高级越好。</p>
<h2 data-id="heading-15">八、开始尝试</h2>
<p>如果你从没用过 IndexedDB，可以从这些开始：</p>
<ol>
<li><strong>缓存接口数据</strong>：把频繁请求的 API 结果缓存起来</li>
<li><strong>离线收藏功能</strong>：用户收藏的内容存本地</li>
<li><strong>图片懒加载缓存</strong>：看过的图片存起来</li>
<li><strong>表单草稿</strong>：复杂的表单数据实时保存</li>
</ol>
<p>不需要一开始就大动干戈。找个合适的场景，先试试水。</p>
<h2 data-id="heading-16">写在最后</h2>
<p>IndexedDB 在前端领域存在感不强，可能因为它解决的问题不是每个项目都会遇到。但当你真的需要处理大量客户端数据时，它会是个很好的选择。</p>
<p><strong>技术没有绝对的好坏，只有合适与否</strong>。知道它的存在，了解它的能力，当合适的需求出现时，你就能做出更好的选择。</p>
<hr/>
<p>看完有点兴趣了？可以在个人项目里试试 IndexedDB，遇到问题欢迎交流。如果你已经在用，有什么经验或踩坑故事？评论区聊聊。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[在Word模板中用HTML替换文本：Spire.Doc for .NET的实践指南]]></title>    <link>https://juejin.cn/post/7604671453453664271</link>    <guid>https://juejin.cn/post/7604671453453664271</guid>    <pubDate>2026-02-10T01:59:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604671453453664271" data-draft-id="7604493165329088546" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="在Word模板中用HTML替换文本：Spire.Doc for .NET的实践指南"/> <meta itemprop="keywords" content="后端,C#,.NET"/> <meta itemprop="datePublished" content="2026-02-10T01:59:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="缺点内向"/> <meta itemprop="url" content="https://juejin.cn/user/3414438228006112"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            在Word模板中用HTML替换文本：Spire.Doc for .NET的实践指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3414438228006112/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    缺点内向
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T01:59:44.000Z" title="Tue Feb 10 2026 01:59:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">在Word模板中用HTML替换文本：Spire.Doc for .NET的实践指南</h2>
<p>在日常的软件开发和企业级应用中，我们经常需要生成各种报告、合同、邮件等文档。这些文档往往基于预设的Word模板，但其内容却需要根据业务数据动态生成。你是否曾为如何在Word模板中动态插入带有复杂格式的富文本内容而感到头疼？传统的文本替换方法（例如简单的<code>Find/Replace</code>）是否已无法满足你对样式、图片、表格等丰富格式的动态生成需求？</p>
<p>本文将深入探讨这一痛点，并为你提供一种高效、灵活的解决方案——利用Spire.Doc for .NET库，将HTML内容无缝替换到Word模板中。这种方法不仅能保留HTML的丰富格式，还能极大提升文档自动化的效率和质量，让你的应用程序能够轻松生成高度定制化的专业文档。</p>
<h3 data-id="heading-1">传统Word文本替换的局限与富文本需求</h3>
<p>传统的Word文本替换，通常指的是在文档中查找特定的纯文本占位符（如<code>{{placeholder}}</code>），然后将其替换为另一个纯文本字符串。这种方法简单直接，对于替换标题、日期、姓名等纯文本信息绰绰有余。</p>
<p>然而，当我们的需求升级到需要插入包含粗体、斜体、列表、表格、图片甚至超链接等复杂格式的内容时，传统方法便显得力不从心。例如，一份自动化生成的销售报告，可能需要插入一个格式精美的产品列表，或者从Web编辑器中获取的用户评论（通常是HTML格式）。如果仅仅将这些HTML字符串作为纯文本插入，Word文档将失去原有的布局和样式，变得难以阅读。</p>
<p>在当今企业级应用中，对文档自动化、动态内容生成的需求日益增长。无论是自动化报告、合同生成、批量邮件合并，还是从数据库或Web编辑器获取的HTML片段，都迫切需要一种能够将这些富文本内容“理解”并正确渲染到Word文档中的技术方案。</p>
<h3 data-id="heading-2">Spire.Doc for .NET：Word模板HTML替换的利器</h3>
<p>Spire.Doc for .NET是一款功能强大的.NET Word文档处理库，它允许开发者在不依赖Microsoft Office的情况下，创建、读取、编辑、转换和打印Word文档。在Word模板自动化领域，Spire.Doc因其全面的功能和易用性而备受推崇。</p>
<p>其核心优势之一，便是对HTML内容的良好支持。Spire.Doc for .NET能够将HTML字符串直接插入到Word文档的指定位置，并自动解析HTML标签，将其转换为Word文档可识别的格式。这意味着你可以将包含<code>&lt;h1&gt;</code>到<code>&lt;h6&gt;</code>标题、<code>&lt;p&gt;</code>段落、<code>&lt;table&gt;</code>表格、<code>&lt;img&gt;</code>图片、<code>&lt;ul&gt;</code>/<code>&lt;ol&gt;</code>列表、<code>&lt;strong&gt;</code>/<code>&lt;em&gt;</code>强调等常用HTML标签的字符串，直接“粘贴”到Word文档中，而无需手动进行格式转换。</p>
<p>相较于自行解析HTML并手动构建Word文档元素的复杂性，Spire.Doc for .NET提供了一站式的解决方案，极大地简化了开发流程。</p>
<h3 data-id="heading-3">实战演练：使用Spire.Doc for .NET替换HTML内容</h3>
<p>下面，我们将通过一个具体的C#代码示例，演示如何使用Spire.Doc for .NET将HTML内容替换到Word模板中。</p>
<h4 data-id="heading-4">步骤分解</h4>
<ol>
<li><strong>准备Word模板</strong>：在你的Word模板（例如<code>.docx</code>文件）中，设置一个或多个占位符，用于标记HTML内容将被插入的位置。例如，你可以使用<code>{{html_content}}</code>或<code>#HTML_PLACEHOLDER#</code>。</li>
<li><strong>引入Spire.Doc for .NET</strong>：通过NuGet包管理器，在你的.NET项目中安装<code>Spire.Doc</code>。</li>
<li><strong>加载Word模板</strong>：使用<code>Document</code>类加载你的Word模板文件。</li>
<li><strong>创建HTML字符串</strong>：准备好你想要插入的HTML格式的富文本内容。</li>
<li><strong>执行替换</strong>：利用<code>FindAllString()</code>方法找到占位符，然后通过<code>TextSelection.GetAsOneRange()</code>获取占位符所在的文本范围，最后使用<code>ReplaceWithHTML()</code>方法将HTML内容插入。</li>
<li><strong>保存修改后的文档</strong>：将处理后的Word文档保存为新的文件。</li>
</ol>
<h4 data-id="heading-5">代码示例</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> Spire.Doc;
<span class="hljs-keyword">using</span> Spire.Doc.Documents;
<span class="hljs-keyword">using</span> Spire.Doc.Fields;
<span class="hljs-keyword">using</span> System.IO;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">WordTemplateHtmlReplace</span>
{
    <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
    {
        <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
        {
            <span class="hljs-comment">// 1. 准备Word模板路径和输出文件路径</span>
            <span class="hljs-built_in">string</span> templatePath = <span class="hljs-string">"TemplateWithHtmlPlaceholder.docx"</span>; <span class="hljs-comment">// 确保此文件存在且包含占位符</span>
            <span class="hljs-built_in">string</span> outputPath = <span class="hljs-string">"OutputDocumentWithHtml.docx"</span>;

            <span class="hljs-comment">// 2. 准备要插入的HTML内容</span>
            <span class="hljs-built_in">string</span> htmlContent = <span class="hljs-string">@"
                &lt;h1&gt;欢迎来到动态报告&lt;/h1&gt;
                &lt;p&gt;这是一段由HTML生成的&lt;strong&gt;富文本内容&lt;/strong&gt;。它包含了多种格式，例如：&lt;/p&gt;
                &lt;ul&gt;
                    &lt;li&gt;项目符号列表项一&lt;/li&gt;
                    &lt;li&gt;项目符号列表项二，可以有&lt;em&gt;斜体&lt;/em&gt;文字&lt;/li&gt;
                &lt;/ul&gt;
                &lt;p&gt;我们还可以插入一个简单的表格：&lt;/p&gt;
                &lt;table border='1' cellpadding='5' cellspacing='0'&gt;
                    &lt;thead&gt;
                        &lt;tr&gt;&lt;th&gt;标题1&lt;/th&gt;&lt;th&gt;标题2&lt;/th&gt;&lt;/tr&gt;
                    &lt;/thead&gt;
                    &lt;tbody&gt;
                        &lt;tr&gt;&lt;td&gt;数据A1&lt;/td&gt;&lt;td&gt;数据A2&lt;/td&gt;&lt;/tr&gt;
                        &lt;tr&gt;&lt;td&gt;数据B1&lt;/td&gt;&lt;td&gt;数据B2&lt;/td&gt;&lt;/tr&gt;
                    &lt;/tbody&gt;
                &lt;/table&gt;
                &lt;p&gt;以及一张图片（如果路径有效）：&lt;/p&gt;
                &lt;img src='https://www.e-iceblue.cn/images/logo.png' alt='Spire.Doc Logo' width='100' height='auto' /&gt;
                &lt;p&gt;感谢您的阅读！&lt;/p&gt;"</span>;

            <span class="hljs-comment">// 3. 加载Word模板</span>
            Document doc = <span class="hljs-keyword">new</span> Document();
            doc.LoadFromFile(templatePath);

            <span class="hljs-comment">// 4. 查找并替换占位符为HTML内容</span>
            <span class="hljs-comment">// 查找模板中的占位符，例如：{{html_content}}</span>
            TextSelection[] selections = doc.FindAllString(<span class="hljs-string">"{{html_content}}"</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>);

            <span class="hljs-keyword">if</span> (selections.Length &gt; <span class="hljs-number">0</span>)
            {
                <span class="hljs-comment">// 获取第一个匹配到的占位符所在的范围</span>
                TextRange range = selections[<span class="hljs-number">0</span>].GetAsOneRange();
                
                <span class="hljs-comment">// 使用ReplaceWithHTML方法替换占位符</span>
                <span class="hljs-comment">// 第一个参数是HTML字符串</span>
                <span class="hljs-comment">// 第二个参数是替换选项，true表示保留占位符的格式（通常不需要，此处为示例）</span>
                range.OwnerParagraph.ReplaceWithHTML(range.Text, htmlContent);
            }
            <span class="hljs-keyword">else</span>
            {
                Console.WriteLine(<span class="hljs-string">"模板中未找到占位符 '{{html_content}}'。"</span>);
            }

            <span class="hljs-comment">// 5. 保存修改后的文档</span>
            doc.SaveToFile(outputPath, FileFormat.Docx);
            Console.WriteLine(<span class="hljs-string">$"文档已成功生成到: <span class="hljs-subst">{outputPath}</span>"</span>);

            <span class="hljs-comment">// 6. 释放资源</span>
            doc.Dispose();
        }
    }
}
</code></pre>
<p><strong>注意</strong>：在实际应用中，<code>templatePath</code>和<code>outputPath</code>需要替换为你的实际文件路径。<code>TemplateWithHtmlPlaceholder.docx</code>文件应包含文本<code>{{html_content}}</code>作为占位符。<code>img</code>标签中的<code>src</code>属性可以是本地路径或网络URL。</p>
<h3 data-id="heading-6">进阶应用与注意事项</h3>
<ul>
<li><strong>复杂HTML与样式</strong>：Spire.Doc for .NET能够解析大部分标准的HTML标签和内联样式。然而，对于复杂的CSS样式表、JavaScript代码或高度依赖浏览器渲染的HTML结构，Spire.Doc可能无法完全还原。建议在插入前对HTML内容进行适当的清理和简化，只保留核心的结构和样式信息。</li>
<li><strong>性能优化</strong>：对于需要批量生成大量文档的场景，可以考虑使用多线程处理，或者优化HTML内容的生成逻辑，减少不必要的复杂性。Spire.Doc本身在性能方面表现优秀，但合理的使用方式将进一步提升效率。</li>
<li><strong>其他应用场景</strong>：除了报告和合同，这种HTML替换技术还可以广泛应用于：
<ul>
<li><strong>邮件合并</strong>：动态生成包含富文本内容的邮件正文。</li>
<li><strong>在线编辑器内容导出</strong>：将用户在Web编辑器中创建的内容（通常是HTML）直接导出为Word文档。</li>
<li><strong>数据可视化报告</strong>：将图表库生成的HTML片段（如包含SVG或Canvas的图表）嵌入到Word文档中。</li>
</ul>
</li>
<li><strong>错误处理</strong>：在实际项目中，应增加适当的错误处理机制，例如文件不存在、HTML解析失败等情况。</li>
</ul>
<h3 data-id="heading-7">结语</h3>
<p>Spire.Doc for .NET为Word模板自动化中的HTML内容替换提供了一个强大而灵活的解决方案，有效弥补了传统纯文本替换方法的不足。通过本文的介绍和代码示例，你应该已经掌握了如何利用这一工具，将带有丰富格式的HTML内容无缝集成到Word文档中。</p>
<p>这种方法使得开发者能够轻松实现高度定制化的、富文本内容的Word文档生成，从而极大提升工作效率和文档质量。现在，是时候将Spire.Doc for .NET加入你的工具箱，开始构建更智能、更高效的文档自动化解决方案了</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[春哥的Agent通关秘籍08：从【向量】到【句向量】]]></title>    <link>https://juejin.cn/post/7604678037808185380</link>    <guid>https://juejin.cn/post/7604678037808185380</guid>    <pubDate>2026-02-10T00:08:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604678037808185380" data-draft-id="7604853010162073663" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="春哥的Agent通关秘籍08：从【向量】到【句向量】"/> <meta itemprop="keywords" content="前端,后端,JavaScript"/> <meta itemprop="datePublished" content="2026-02-10T00:08:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="摸鱼的春哥"/> <meta itemprop="url" content="https://juejin.cn/user/1714893870865303"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            春哥的Agent通关秘籍08：从【向量】到【句向量】
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1714893870865303/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    摸鱼的春哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T00:08:52.000Z" title="Tue Feb 10 2026 00:08:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;font-weight:400;line-height:2;font-size:17px;overflow-x:hidden;color:#000}.markdown-body strong{padding:1px;color:#ee3f4d}.markdown-body em{padding:0 2px;color:#f33b1f}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{position:relative;margin-top:30px;margin-bottom:20px;line-height:1.5;font-weight:700}.markdown-body h1{text-align:center;padding-bottom:5px;font-size:32px;color:#ac1f18}.markdown-body h1:after{content:"";display:block;margin:4px auto 0;width:100px;height:2px;border-bottom:2px solid #f33b1f}.markdown-body h2{font-size:28px;border-bottom:1px solid #f33b1f}.markdown-body h2:before{content:"# "!important;color:#f33b1f}.markdown-body h3{font-size:24px;padding-left:9px;border-left:6px solid #f33b1f}.markdown-body h4{font-size:20px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #bbb;margin:16px 0}.markdown-body code{word-break:break-word;overflow-x:auto;background-color:#f9f1db;color:#ee2746;border-radius:2px;font-size:16px;padding:1px 2px}.markdown-body code,.markdown-body pre{font-family:-apple-system,-apple-system-body,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,PingFang SC,思源黑体 CN,思源黑体,JetBrains Mono,Fira Code,Menlo,Ubuntu Mono,Consolas,sans-serif}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{margin:12px 0!important;border-radius:3px;font-size:15px;padding:16px 12px;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f7f7f7}.markdown-body a{text-decoration:none;color:#1781b5;padding:0 2px;border-bottom:1px solid #1781b5}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #f33b1f;color:#ac1f18}.markdown-body blockquote{color:#3d3d3d;background-color:#fff9f9;padding:6px 16px;margin:16px 0;border-left:3px solid #f07c82}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:6px 0}.markdown-body ol,.markdown-body ul{padding-left:30px}.markdown-body ol li,.markdown-body ul li{margin-bottom:6px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:6px}.markdown-body ol li{padding-left:6px}.markdown-body ::marker{color:#f33b1f}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body .task-list-item input[type=checkbox]{position:relative}.markdown-body .task-list-item input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;background:#fff;border:1px solid #f07c82;border-radius:3px;box-sizing:border-box;z-index:1}.markdown-body .task-list-item input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-5px;left:0;right:0;bottom:0;width:0;height:0;color:#f33b1f;font-size:16px;font-weight:700;z-index:2}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border-spacing:0;border-collapse:collapse}.markdown-body table thead{background:#fff9f9;color:#000;text-align:left;font-size:15px}.markdown-body table tr:nth-child(2n){background-color:#fcfcfc}.markdown-body table tr:hover{background-color:#fff9f9}.markdown-body table td,.markdown-body table th{padding:12px 7px;line-height:24px;border:1px solid #f9f1db}.markdown-body table td{min-width:120px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="monokai">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#272822;color:#ddd}.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-strong,.hljs-tag{color:#f92672}.hljs-code{color:#66d9ef}.hljs-class .hljs-title{color:#fff}.hljs-attribute,.hljs-link,.hljs-regexp,.hljs-symbol{color:#bf79db}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-emphasis,.hljs-section,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-string,.hljs-subst,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:#a6e22e}.hljs-comment,.hljs-deletion,.hljs-meta,.hljs-quote{color:#75715e}.hljs-doctag,.hljs-keyword,.hljs-literal,.hljs-section,.hljs-selector-id,.hljs-selector-tag,.hljs-title,.hljs-type{font-weight:700}</style><p>本章我们将浅显地了解一下 <code>LLM</code> 大语言模型中几个关键术语，区分清楚【向量】，【词向量】，【句向量】这几个词的基本概念和差异。</p>
<p>这对我们后续构建RAG架构会非常有帮助。</p>
<h2 data-id="heading-0">一、什么是向量</h2>
<p>向量是 LLM 种一个重要的概念，因此我们需要先理解一下，什么是向量。</p>
<p>在数学定义里，向量是有大小和方向的量。但在 AI 领域，你只需要把它理解为：一个固定长度的数字列表。</p>
<p>打个通俗的比方，你正在游玩一款 <code>RPG</code> 游戏，每个角色都有自己的属性面板：</p>
<ul>
<li>
<p>战士：力量 99，智力 5，敏捷 30</p>
</li>
<li>
<p>法师：力量 5，智力 99，敏捷 20</p>
</li>
</ul>
<p>如果我们把这些属性写成一个数组：</p>
<p>战士 = [99, 5, 30]</p>
<p>法师 = [5, 99, 20]</p>
<p>这串数字 [99, 5, 30]，就是一个代表战士的“向量”。</p>
<ul>
<li>
<p>在这个例子里，这个向量有 3 个维度（力量、智力、敏捷）。</p>
</li>
<li>
<p>这串数字不仅代表了数值，还代表了这个角色在“属性空间”里的位置。</p>
</li>
</ul>
<p><img src="https://pic.zhangshichun.top/pic/20260207204218957.png" alt="" loading="lazy"/></p>
<p>如上图所示，任何一个该游戏中的角色，它的属性都可以在这个三维坐标系中找到属于自己的位置。</p>
<p>现在你明白了：</p>
<blockquote>
<p>向量就是计算机用来描述一个事物特征的一串数字。</p>
</blockquote>
<h2 data-id="heading-1">二、什么是向量化</h2>
<p>向量化，见文知意，就是把一个具体事物，变成计算机更容易理解的向量的过程。</p>
<p>现在，如果你想往游戏里新增一个角色【骑士】，你应该怎么做呢？</p>
<p>你会需要想明白它的特点，并把这些特点转换为力量、智力、敏捷 这三个属性。</p>
<p>这个打分的过程，就是向量化。</p>
<pre><code class="hljs language-python" lang="python">骑士_Vector = [<span class="hljs-number">85</span>, <span class="hljs-number">40</span>, <span class="hljs-number">20</span>]
</code></pre>
<p>现在，你的数据库里有了三个点：</p>
<ul>
<li>
<p>战士 [99, 5, 30]</p>
</li>
<li>
<p>法师 [5, 99, 20]</p>
</li>
<li>
<p>骑士 [85, 40, 20]</p>
</li>
</ul>
<p><img src="https://pic.zhangshichun.top/pic/20260207210551737.png" alt="" loading="lazy"/></p>
<p>计算机会惊讶地发现：“咦？比起法师，‘骑士’这串数字竟然离‘战士’更近！”（因为它们的“力量”数值都很高）。</p>
<p>现在，计算机拥有了一种最简单的思考的常识：哪些角色更相似。</p>
<p>是的，你作为一个人类能够清晰地知道骑士和战士更相似，可能是依靠知觉。</p>
<p>但计算机却可以通过坐标发现：骑士和战士更像一类人。这就是向量化让计算机理解语义的奥秘。</p>
<p>那么，这和大语言模型又有什么关系呢？</p>
<p>有的，兄弟，有的！</p>
<p>LLM 训练的过程，其实就是把各种各样的人类的“文章”、“文档”向量化的过程。</p>
<h2 data-id="heading-2">三、对人类语言的向量化评估</h2>
<p>在前面的例子里，我们可以把【向量化】这样解释：</p>
<blockquote>
<p>向量化是一个方法，输入的是RPG游戏的角色名称，输出的是一段描述该角色的向量坐标。</p>
</blockquote>
<p>是的，没问题，对于上面的例子来说这非常准确。但让我们把它扩大一下，输入的不再是RPG游戏的角色名称，而是人类世界里无处不在的各种语言文本：</p>
<ul>
<li>一句问候：“你好”</li>
<li>一首情诗，100字</li>
<li>一篇技术文档，500字</li>
<li>一段代码，1000字</li>
</ul>
<p>当我们把各种语言作为输入时，如果还能稳定输出一段描述该文本的向量坐标，那计算机是不是就能理解人类语言的本质了?</p>
<p>是的，兄弟，但三个维度太少了，人类的语言过于复杂。</p>
<p>于是，维度爆炸了，计算机开始用1024个维度、1536个维度，或者更多个维度来描述一段话的特征。</p>
<h3 data-id="heading-3">3.1 稠密向量</h3>
<p>想象一下，你把公司的一条 <strong>《严禁在生产环境直接修改数据库》</strong> 的规定扔给模型。</p>
<p>模型读到这句话时，它那 1536 个维度的探测针会疯狂跳动。虽然我们不知道每一根针具体代表什么，但通过数学分析，我们发现模型实际上是在评估以下这类 <strong>“抽象特征”</strong>：</p>
<ul>
<li>
<p>特征维度 #42（可能是关于“强制性”）：这句话语气非常强硬（“严禁”），所以这个维度的数值飙升到 0.99。</p>
</li>
<li>
<p>特征维度 #108（可能是关于“技术领域”）：这句话包含“数据库”、“生产环境”，所以这个维度的数值是 0.85。</p>
</li>
<li>
<p>特征维度 #555（可能是关于“情感色彩”）：这句话是警告性质，带有负面后果暗示，数值可能是 -0.6。</p>
</li>
<li>
<p>特征维度 #999（可能是关于“美食/烹饪”）：这句话和吃的一点关系没有，数值是 0.00。</p>
</li>
</ul>
<p>就这样，模型把这句话，压缩成了一个 <strong>“高强制性 + 纯技术领域 + 警告语气”</strong> 的数学坐标点。</p>
<p>这种富含信息量和特征评估的向量，有一个专业名词，叫：【稠密向量】。</p>
<p><img src="https://pic.zhangshichun.top/pic/20260207213642250.png" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">3.2 词与句，流派之分</h3>
<p>也就是在这个时候，对于文本的计算方法，衍生出了两个思路：</p>
<ul>
<li>思路A：先拆词，然后对每个词进行向量化。
<ul>
<li>[我] 训练一个向量</li>
<li>[喜欢] 训练一个向量</li>
<li>[你] 训练一个向量</li>
<li>然后把三个向量形成一个矩阵进行存储训练。</li>
<li>这种思路，被称为 词向量 (Word/Token Embedding)。</li>
</ul>
</li>
<li>思路B：不拆词，对一整句话进行向量化。
<ul>
<li>[我喜欢你] 四个字只训练出一个向量</li>
<li>这种思路，句向量 被称为(Sentence Embedding)。</li>
</ul>
</li>
</ul>
<p>哪个流派更厉害？
<img src="https://pic.zhangshichun.top/pic/20260207214053383.png" alt="" loading="lazy"/>
很显然【词向量】相对复杂，粒度更细。它更贴合人类说话的习惯，一个词一个词的学习理解，一个词一个词的组装输出。</p>
<p>【词向量】最终训练出了类似DeepSeek，Gemini，ChatGPT这样轰动世界的大模型，擅长思考以及和人类对话。</p>
<p>那么，【句向量】就一无是处吗？</p>
<p>不是的，兄弟，不是的。</p>
<p>【句向量】也有它发光发热的地方，它擅长一整段一整段的进行文本检索和语义理解。</p>
<p>因此，在特定领域，它更为好用。</p>
<p>没错，正是我们后面要着重要介绍的场景：</p>
<p>【私有知识库】。</p>
<h2 data-id="heading-5">四、【句向量】：天生我材必有用</h2>
<p>如果说，你现在有很多企业内部的文档，私人的文档需要形成一个知识库，你并不需要和这个文档对话，而是能快速地找到文档中相关度最高的位置。</p>
<p>此时此刻，基于一句话进行向量化的【句向量】反而具备了优势。</p>
<p>因为它的向量就是基于一段一段的话进行特征标注的。</p>
<p>在快速检索知识区域这方面，【句向量】相比于【词向量】拥有如下优点:</p>
<ul>
<li>
<p>数学上可行：它把长短不一的文本，变成了固定长度的条形码，才能算距离。</p>
</li>
<li>
<p>语义上精准：它提取的是中心思想，而不是碎片化的词。</p>
</li>
<li>
<p>工程上极速：它让百万级的检索能在毫秒级完成。</p>
</li>
</ul>
<p>所以，【句向量】就成为了一种用来作为私有材料库和知识库检索的技术。</p>
<p>只是单纯的本地检索，是不是太没想象力了？</p>
<p>是的，检索出来之后，再把检索到的准确的文本塞到和DeepSeek的对话里，将会产生更强的效果。</p>
<p><img src="https://pic.zhangshichun.top/pic/20260208095822333.png" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">下一步预告</h2>
<p>下节课，我们将基于本章我们学习的理论，来梳理RAG架构必要的模型和组件，以及需要哪些步骤。</p>
<p>敬请期待！</p>
<p><img src="https://pic.zhangshichun.top/pic/ScreenShot_2026-01-26_082327_821.png" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[比官方还便宜！Riffusion 音乐 API 对接说明]]></title>    <link>https://juejin.cn/post/7604678037808168996</link>    <guid>https://juejin.cn/post/7604678037808168996</guid>    <pubDate>2026-02-10T00:05:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604678037808168996" data-draft-id="7604678037808152612" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="比官方还便宜！Riffusion 音乐 API 对接说明"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-10T00:05:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="崔庆才丨静觅"/> <meta itemprop="url" content="https://juejin.cn/user/1521379821230269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            比官方还便宜！Riffusion 音乐 API 对接说明
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379821230269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    崔庆才丨静觅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T00:05:52.000Z" title="Tue Feb 10 2026 00:05:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读31分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文将介绍一种 Riffusion Audios Generation API 对接说明，它是可以通过输入自定义参数来生成 Riffusion 官方的音乐。</p>
<h2 data-id="heading-0">申请流程</h2>
<p>要使用 API，需要先到 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2Friffusion-audios" target="_blank" title="https://platform.acedata.cloud/documents/riffusion-audios" ref="nofollow noopener noreferrer">Riffusion Audios Generation API</a> 对应页面申请对应的服务，进入页面之后，点击「Acquire」按钮，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/q6ytrc.png" alt="" loading="lazy"/></p>
<p>如果你尚未登录或注册，会自动跳转到登录页面邀请您来注册和登录，登录注册之后会自动返回当前页面。</p>
<p>在首次申请时会有免费额度赠送，可以免费使用该 API。</p>
<h2 data-id="heading-1">基本使用</h2>
<p>想些什么歌曲，可以任意输入一段文字，比如我想生成一个关于圣诞的歌曲，就可以输入 <code>a song for Christmas</code>，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/4i4ysn.png" width="600" class="m-auto" loading="lazy"/></p>
<p>可以看到这里我们设置了 Request Headers，包括：</p>
<ul>
<li><code>accept</code>：想要接收怎样格式的响应结果，这里填写为 <code>application/json</code>，即 JSON 格式。</li>
<li><code>authorization</code>：调用 API 的密钥，申请之后可以直接下拉选择。</li>
</ul>
<p>另外 Request Body 的参数包括：</p>
<ul>
<li><code>action</code>：此次音乐生成任务的行为，生成歌曲是 <code>generate</code>。</li>
<li><code>model</code>：创建歌曲采用的模型，目前主要有：<strong>FUZZ-1.0</strong>、<strong>FUZZ-1.1</strong>、<strong>FUZZ-1.0 Pro</strong>、<strong>FUZZ-1.1 Pro</strong>。</li>
<li><code>lyric</code>：歌曲的歌词内容。</li>
<li><code>custom</code>：是否采用自定义方式生成歌曲。</li>
<li><code>prompt</code>：灵感模式下的提示词。</li>
<li><code>style</code>：歌曲风格参数。</li>
<li><code>title</code>：歌曲标题信息。</li>
<li><code>callback_url</code>：需要回调结果的 URL。</li>
<li><code>instrumental</code>：是否为无歌词模式。</li>
</ul>
<p>如上参数和官方的自定义生成的映射关系如下：</p>
<ul>
<li><code>model</code>：对应 Riffusion 账号设置页面的模型选择，如下图所示</li>
<li><code>lyric</code>：对应 Rifussion 自定义生成页面的「Lyrics」部分，如下图所示</li>
<li><code>style</code>：对应 Rifussion 自定义生成页面的「Sound」部分，实际上是指定一些风格，如下图所示</li>
<li><code>title</code>：对应 Rifussion 自定义生成页面的「Details」部分，用于指定歌曲标题，如下图所示</li>
<li><code>instrumental</code>：对应 Rifussion 自定义生成页面的「Instrumental」开关，用于设置无歌词模式，如下图所示</li>
</ul>
<p><img src="https://cdn.acedata.cloud/i68847.png" width="500" class="m-auto" loading="lazy"/></p>
<p><img src="https://cdn.acedata.cloud/eda26o.png" width="500" class="m-auto" loading="lazy"/></p>
<p>选择之后，可以发现右侧也生成了对应代码，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/0217zy.png" width="500" class="m-auto" loading="lazy"/></p>
<p>点击「Try」按钮即可进行测试，如上图所示，这里我们就得到了如下结果：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"f45388a9-4169-41d4-aec8-fb8259c48d36"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1df9f664-fd74-476b-8038-b0b5f62ddf87"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"02702b40-272d-4838-8644-675105930658"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Vibe"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/e850008a-d9a1-4c8f-acbd-a37f228946bc/image/02702b40-272d-4838-8644-675105930658.jpg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Intro]\nYeah, yeah\nKeep talking, keep talking\nI love the way you sound\n[Verse 1]\nYour voice is like a drug I can't put down\nEvery word you say just pulls me in\nI'm addicted to the way you laugh out loud\nAnd how you whisper when the room goes dim\nTell me 'bout your day, tell me 'bout your fears\nI could listen to you talk for years\n[Pre-Chorus]\nDon't stop now, don't you dare\nI need your voice filling up the air\n[Chorus]\nKeep talking, keep talking to me\nYour words are all I fucking need\nKeep talking, keep talking, I'm high\nOff every sound you make tonight\nKeep talking\n[Verse 2]\nYou could read the phone book, I don't care\nJust the rhythm of your breathing's enough\nWhen you say my name, it's like a prayer\nAnd your silence hits me twice as rough\nEvery conversation feels like home\nNever want to hear this dial tone\n[Pre-Chorus]\nDon't stop now, don't you dare\nI need your voice filling up the air\n[Chorus]\nKeep talking, keep talking to me\nYour words are all I fucking need\nKeep talking, keep talking, I'm high\nOff every sound you make tonight\nKeep talking\n[Bridge]\nWhen the world gets loud and crazy\nYour voice cuts through the noise\nYou're my favorite conversation\nYou're my drug of choice\nKeep talking, keep talking\nKeep talking, keep talking\nKeep talking, keep talking\nKeep talking, keep talking\n[Chorus]\nKeep talking, keep talking to me\nYour words are all I fucking need\nKeep talking, keep talking, I'm high\nOff every sound you make tonight\nKeep talking\n[Outro]\nYeah, yeah\nKeep talking, keep talking\nNever stop that sound"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/e850008a-d9a1-4c8f-acbd-a37f228946bc/audio/02702b40-272d-4838-8644-675105930658.m4a"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-18T15:47:54.705246Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FUZZ-1.0"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyrics_timestamped"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"words"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Intro]"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
          <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          ...
          <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sound"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">179.84</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">180.48</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">63</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Pop, upbeat tempo, modern production"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">181.12</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"be3fe757-621e-4017-9056-20aa7f01919e"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Revive"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/e850008a-d9a1-4c8f-acbd-a37f228946bc/image/be3fe757-621e-4017-9056-20aa7f01919e.jpg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse 1]\nI'm walking through the motions, moving day by day\nColors seem a little faded, nothing much to say\nFriends keep calling, asking if I'm doing fine\nBut I just smile and tell them everything's divine\n[Pre-Chorus]\nSomething's missing, can't quite name it\nFeels like I'm just going through the stages\n[Chorus]\nI'm barely breathing, barely feeling\nLike I'm floating through a life that isn't mine\nBarely breathing, barely healing\nSearching for a reason, searching for a sign\nTo feel alive again\nTo feel alive again\n[Verse 2]\nMorning coffee tastes like water, sunrise looks like rain\nEveryone around me laughs but I can't feel the same\nUsed to dance in silly moments, used to sing out loud\nNow I'm standing in the silence of a faceless crowd\n[Pre-Chorus]\nSomething's shifting, can't ignore it\nMaybe it's time to break these patterns\n[Chorus]\nI'm barely breathing, barely feeling\nLike I'm floating through a life that isn't mine\nBarely breathing, barely healing\nSearching for a reason, searching for a sign\nTo feel alive again\nTo feel alive again\n[Bridge]\nBut there's a beating in my chest\nA whisper saying \"don't give up yet\"\nMaybe tomorrow I'll remember\nHow to laugh and how to let\nMy heart wake up from this long sleep\nFind the fire I used to keep\n[Chorus]\nI'm barely breathing, barely feeling\nLike I'm floating through a life that isn't mine\nBarely breathing, barely healing\nSearching for a reason, searching for a sign\nTo feel alive again\nTo feel alive again\n[Outro]\nI'm gonna feel alive again\nI'm gonna feel alive again"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/e850008a-d9a1-4c8f-acbd-a37f228946bc/audio/be3fe757-621e-4017-9056-20aa7f01919e.m4a"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-18T15:48:01.139081Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FUZZ-1.0"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyrics_timestamped"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"words"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
          <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          ...
          <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"again"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">202.88</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">211.84</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">54</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Pop, upbeat tempo, clean production, emotional vocals"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">211.84</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>返回结果一共有多个字段，介绍如下：</p>
<ul>
<li><code>success</code>，此时音乐生成任务的状态情况。
<ul>
<li><code>data</code>，此次音乐任务的结果 - <code>id</code>，此时音乐生成任务的 ID。
<ul>
<li><code>prompt</code>，此时音乐生成任务的提示词。</li>
<li><code>audio_url</code>，此时音乐生成任务的音频链接。</li>
<li><code>image_url</code>，此时音乐生成任务的封面链接。</li>
<li><code>state</code>，此时音乐生成任务的状态。</li>
<li><code>duration</code>，此时音乐的时长信息。</li>
<li><code>style</code>，此时音乐的风格信息。</li>
<li><code>model</code>，此时音乐生成任务采用的模型信息。</li>
<li><code>lyric</code>，此时音乐生成任务的歌词信息。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>可以看到我们得到了想生成的音乐信息，我们只需要根据结果中 <code>data</code> 的音乐链接地址获取生成的 Riffusion 音乐即可。</p>
<p>另外如果想生成对应的对接代码，可以直接复制生成，例如 CURL 的代码如下：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/riffusion/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "model": "FUZZ-1.0",
  "action": "generate",
  "prompt": "A song for Christmas"
}'
</code></pre>
<h2 data-id="heading-2">自定义生成</h2>
<p>如果想自定义生成歌词，可以输入歌词：</p>
<p>这时候 <code>lyric</code> 字段可以传入类似如下内容：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">[Verse]Woke up <span class="hljs-keyword">with</span> the sun <span class="hljs-keyword">in</span> my eyesNo clouds above just blue <span class="hljs-keyword">in</span> the skiesShoes <span class="hljs-keyword">on</span> my feet I’m ready <span class="hljs-keyword">to</span> runEvery <span class="hljs-keyword">step</span> feels <span class="hljs-built_in">like</span> a loaded gun[Chorus]Happy days are rolling inLet the joy beneath my skinNo more <span class="hljs-keyword">shadows</span> no more liesJust the truth that lifts <span class="hljs-keyword">me</span> high[Verse <span class="hljs-number">2</span>]Dancing through the city streetsA rhythm pounding <span class="hljs-keyword">in</span> my heartbeatStrangers smile it’s catching onThis world’s a stage we’re all a song[Chorus]Happy days are rolling inLet the joy beneath my skinNo more <span class="hljs-keyword">shadows</span> no more liesJust the truth that lifts <span class="hljs-keyword">me</span> high[Bridge]<span class="hljs-keyword">Throw</span> your worries out the doorLet them sink <span class="hljs-keyword">to</span> the ocean floorWe’re alive <span class="hljs-built_in">and</span> it’s enoughLife <span class="hljs-built_in">is</span> messy but it’s love[Chorus]Happy days are rolling inLet the joy beneath my skinNo more <span class="hljs-keyword">shadows</span> no more liesJust the truth that lifts <span class="hljs-keyword">me</span> high
</code></pre>
<p>接下来我们要根据歌词、标题、风格自定义生成歌曲，就可以指定如下内容：</p>
<ul>
<li>lyric：歌词文本</li>
<li>custom：填写为 <code>true</code>，代表自定义生成，该参数默认为 false，代表使用 <code>prompt</code> 生成。</li>
<li>title：歌曲的标题。</li>
<li>style：歌曲的风格，选填。</li>
</ul>
<p>填写样例如下：</p>
<p><img src="https://cdn.acedata.cloud/ny4n7m.png" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://cdn.acedata.cloud/hm9gtn.png" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/riffusion/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "model": "FUZZ-1.0",
  "action": "generate",
  "lyric": "[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high",
  "custom": true
}'
</code></pre>
<p>测试允许，生成的效果是类似的。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"978c2912-6a90-4048-b4c1-43f9cf18c28d"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"08dfbb99-43ce-4f65-8fd1-74b98f2b121a"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"eac9ab69-e210-490b-9f8d-095a6f074f40"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"VibeRise"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/3f3e1354-52ad-4f5b-902c-5f83abd17def/image/eac9ab69-e210-490b-9f8d-095a6f074f40.jpg"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/3f3e1354-52ad-4f5b-902c-5f83abd17def/audio/eac9ab69-e210-490b-9f8d-095a6f074f40.m4a"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-23T01:57:33.438644Z"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FUZZ-1.0"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyrics_timestamped"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"words"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Woke"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                    ...
                <span class="hljs-punctuation">]</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"funk vibes, raspy, raw vocal texture"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">158.08</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"64fffe1f-b1aa-46dc-8012-b80ba319cf35"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Pure Dawn"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/3f3e1354-52ad-4f5b-902c-5f83abd17def/image/64fffe1f-b1aa-46dc-8012-b80ba319cf35.jpg"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/3f3e1354-52ad-4f5b-902c-5f83abd17def/audio/64fffe1f-b1aa-46dc-8012-b80ba319cf35.m4a"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-23T01:57:33.963497Z"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FUZZ-1.0"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyrics_timestamped"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"words"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Woke"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                    ...
                <span class="hljs-punctuation">]</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"contemporary country"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">175.36</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-3">翻唱歌曲</h2>
<p>如果想对已经生成的歌曲进行翻唱操作的操作，可以输入上文生成的歌曲进行翻唱，接下来我们要根据歌词、标题、风格自定义生成歌曲。</p>
<p>如果想对自己上传的歌曲进行继续翻唱的话，可以将参数 <code>action</code> 设置为 <code>upload_cover</code> ，并且输入需要继续翻唱自定义上传的歌曲 ID，歌曲 ID 的获取是使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F76d79f86-39af-4034-8c6a-51e4a819308d%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6" target="_blank" title="https://platform.acedata.cloud/documents/76d79f86-39af-4034-8c6a-51e4a819308d?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6" ref="nofollow noopener noreferrer">Riffusion Upload API</a>来获取，如下图所示：</p>
<p><img src="https://cdn.acedata.cloud/z7r5fd.png" width="500" class="m-auto" loading="lazy"/></p>
<p>就可以指定如下内容：</p>
<ul>
<li>action：此次歌曲任务的行为，目前支持：generate、cover、extend、upload_cover、upload_extend、replace_section、upload_replace_section、swap_vocals、upload_swap_vocals、swap_sound、upload_swap_sound，此次翻唱使用<code>cover</code>参数。</li>
<li>lyric：歌词文本</li>
<li>title：歌曲的标题。</li>
<li>audio_id：需要翻唱歌曲的歌曲ID。</li>
<li>style：歌曲的风格，选填。</li>
</ul>
<p>填写样例如下：</p>
<p><img src="https://cdn.acedata.cloud/e5egk2.png" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://cdn.acedata.cloud/u0ei5u.png" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/riffusion/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "action": "cover",
  "model": "FUZZ-1.0 Pro",
  "lyric": "[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high",
  "audio_id": "b7376272-3902-49b4-a83b-62f7e6ab505c"
}'
</code></pre>
<p>测试允许，生成的效果是类似的。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"fe02997d-f58e-4886-9aa3-4074c9a430eb"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"997bde4c-6063-4fc2-9b03-d837f1efc72d"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"be254182-d4b7-42b3-9ee2-b86db086cff1"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Sunny Rise"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/c2f707a9-017d-4354-8bfa-436266dadbf6/image/be254182-d4b7-42b3-9ee2-b86db086cff1.jpg"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/c2f707a9-017d-4354-8bfa-436266dadbf6/audio/be254182-d4b7-42b3-9ee2-b86db086cff1.m4a"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-23T01:59:17.666629Z"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyrics_timestamped"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"words"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                    ...
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">237.44</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">29</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">236.8</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"high"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span>
                <span class="hljs-punctuation">]</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">239.46235827664398</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"9b9d2810-eb2b-44d3-85c0-cb259afa13c3"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Uplift"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/c2f707a9-017d-4354-8bfa-436266dadbf6/image/9b9d2810-eb2b-44d3-85c0-cb259afa13c3.jpg"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/c2f707a9-017d-4354-8bfa-436266dadbf6/audio/9b9d2810-eb2b-44d3-85c0-cb259afa13c3.m4a"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-23T01:59:23.065712Z"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyrics_timestamped"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"words"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                    ...
                    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">236.16</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">29</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">225.28</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"high"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span>
                <span class="hljs-punctuation">]</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">239.5299546485261</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-4">续写歌曲</h2>
<p>如果想续写歌曲的话，我们需要传入<code>action</code>参数值为：<code>extend</code>，接下来我们要根据歌词、标题、风格自定义生成歌曲。</p>
<p>如果想对自己上传的歌曲进行继续续写的话，可以将参数 <code>action</code> 设置为 <code>upload_extend</code> ，并且输入需要继续续写自定义上传的歌曲 ID，歌曲 ID 的获取是使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F76d79f86-39af-4034-8c6a-51e4a819308d%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6" target="_blank" title="https://platform.acedata.cloud/documents/76d79f86-39af-4034-8c6a-51e4a819308d?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6" ref="nofollow noopener noreferrer">Riffusion Upload API</a>来获取，如下图所示：</p>
<p><img src="https://cdn.acedata.cloud/z7r5fd.png" width="500" class="m-auto" loading="lazy"/></p>
<p>就可以指定如下内容：</p>
<ul>
<li>action：此次歌曲任务的行为，目前支持：generate、cover、extend、upload_cover、upload_extend、replace_section、upload_replace_section、swap_vocals、upload_swap_vocals、swap_sound、upload_swap_sound，此次续写使用<code>extend</code>参数。</li>
<li>lyric：歌词文本</li>
<li>title：歌曲的标题。</li>
<li>audio_id：歌曲的ID。</li>
<li>style：歌曲的风格，选填。</li>
</ul>
<p>填写样例如下：</p>
<p><img src="https://cdn.acedata.cloud/1im68k.png" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://cdn.acedata.cloud/yctbdk.png" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/riffusion/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "action": "extend",
  "model": "FUZZ-1.0 Pro",
  "lyric": "[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high",
  "audio_id": "b7376272-3902-49b4-a83b-62f7e6ab505c",
  "continue_at": 5
}'
</code></pre>
<p>测试允许，生成的效果是类似的。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"6388a0aa-b5ab-4485-baad-f0e0b7a7848c"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"da143dbe-8263-45ac-b05a-1ed57dd4aa79"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"209e27e0-500c-44f3-9134-280690014920"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"City Rhythm"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/3a8378d5-94d4-49b7-9c0a-8432c0c4a39d/image/209e27e0-500c-44f3-9134-280690014920.jpg"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/3a8378d5-94d4-49b7-9c0a-8432c0c4a39d/audio/209e27e0-500c-44f3-9134-280690014920.m4a"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-23T02:00:53.473604Z"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyrics_timestamped"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"words"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4.48</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4.48</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                    ...
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">179.2</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">29</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">178.56</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"high"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span>
                <span class="hljs-punctuation">]</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">197.00850340136054</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ff50012e-ad1b-4b71-8d0e-6a633428a54f"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Bright"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/3a8378d5-94d4-49b7-9c0a-8432c0c4a39d/image/ff50012e-ad1b-4b71-8d0e-6a633428a54f.jpg"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/3a8378d5-94d4-49b7-9c0a-8432c0c4a39d/audio/ff50012e-ad1b-4b71-8d0e-6a633428a54f.m4a"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-23T02:00:52.795796Z"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyrics_timestamped"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"words"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                    ...
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">186.88</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">29</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">186.24</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"high"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span>
                <span class="hljs-punctuation">]</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">213.85757369614512</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-5">替换片段</h2>
<p>如果想对歌曲进行替换片段的话，我们需要传入<code>action</code>参数值为：<code>replace_section</code>，接下来我们要根据歌词、标题、风格自定义生成歌曲。</p>
<p>如果想对自己上传的歌曲进行继续替换片段的话，可以将参数 <code>action</code> 设置为 <code>upload_replace_section</code> ，并且输入需要继续替换片段自定义上传的歌曲 ID，歌曲 ID 的获取是使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F76d79f86-39af-4034-8c6a-51e4a819308d%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6" target="_blank" title="https://platform.acedata.cloud/documents/76d79f86-39af-4034-8c6a-51e4a819308d?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6" ref="nofollow noopener noreferrer">Riffusion Upload API</a>来获取，如下图所示：</p>
<p><img src="https://cdn.acedata.cloud/z7r5fd.png" width="500" class="m-auto" loading="lazy"/></p>
<p>就可以指定如下内容：</p>
<ul>
<li>action：此次歌曲任务的行为，目前支持：generate、cover、extend、upload_cover、upload_extend、replace_section、upload_replace_section、swap_vocals、upload_swap_vocals、swap_sound、upload_swap_sound，此次续写使用<code>extend</code>参数。</li>
<li>lyric：需要替换后的歌词文本</li>
<li>title：歌曲的标题。</li>
<li>audio_id：歌曲的ID。</li>
<li>style：歌曲的风格，选填。</li>
</ul>
<p>填写样例如下：</p>
<p><img src="https://cdn.acedata.cloud/gbxazr.png" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://cdn.acedata.cloud/yb4wr9.png" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/riffusion/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "action": "replace_section",
  "model": "FUZZ-1.0 Pro",
  "lyric": "[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high",
  "audio_id": "b7376272-3902-49b4-a83b-62f7e6ab505c",
  "replace_section_start": 3,
  "replace_section_end": 70
}'
</code></pre>
<p>测试允许，生成的效果是类似的。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"73defcbf-f876-4dd6-b60e-4c1c5ecd4565"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"9f639389-7218-4cdb-ade9-b34228bb0f21"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"037f5e9d-9da4-4d79-b58f-1f433b40d54d"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Sunrise Joy"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/881ad27f-39c1-4c31-a789-ecc822e13b8c/image/037f5e9d-9da4-4d79-b58f-1f433b40d54d.jpg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/881ad27f-39c1-4c31-a789-ecc822e13b8c/audio/037f5e9d-9da4-4d79-b58f-1f433b40d54d.m4a"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-23T02:18:43.031184Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyrics_timestamped"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"words"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3.84</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3.84</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
          <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          ...
          <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">159.36</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">29</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">159.36</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"high"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">199.2201133786848</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"97638295-068f-4cbc-b076-66f522449bd5"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Sunrise"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/881ad27f-39c1-4c31-a789-ecc822e13b8c/image/97638295-068f-4cbc-b076-66f522449bd5.jpg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/881ad27f-39c1-4c31-a789-ecc822e13b8c/audio/97638295-068f-4cbc-b076-66f522449bd5.m4a"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-23T02:18:56.267775Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyrics_timestamped"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"words"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3.84</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3.84</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
          <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          ...
          <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">159.36</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">29</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">159.36</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"high"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">199.2201133786848</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-6">SwapSound生成</h2>
<p>如果想使用官方的SwapSound操作，可以将<code>action</code>参数值设为：<code>swap_sound</code>，接下来我们要根据歌词、标题、风格自定义生成歌曲。</p>
<p>如果想对自己上传的歌曲进行继续SwapSound操作的话，可以将参数 <code>action</code> 设置为 <code>upload_swap_sound</code> ，并且输入需要继续SwapSound操作自定义上传的歌曲 ID，歌曲 ID 的获取是使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F76d79f86-39af-4034-8c6a-51e4a819308d%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6" target="_blank" title="https://platform.acedata.cloud/documents/76d79f86-39af-4034-8c6a-51e4a819308d?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6" ref="nofollow noopener noreferrer">Riffusion Upload API</a>来获取，如下图所示：</p>
<p><img src="https://cdn.acedata.cloud/z7r5fd.png" width="500" class="m-auto" loading="lazy"/></p>
<p>就可以指定如下内容：</p>
<p>接下来我们要根据歌词、标题、风格自定义生成歌曲，就可以指定如下内容：</p>
<ul>
<li>action：此次歌曲任务的行为，目前支持：generate、cover、extend、upload_cover、upload_extend、replace_section、upload_replace_section、swap_vocals、upload_swap_vocals、swap_sound、upload_swap_sound。</li>
<li>lyric：歌词文本</li>
<li>title：歌曲的标题。</li>
<li>audio_id：歌曲的ID。</li>
<li>style：歌曲的风格，选填。</li>
</ul>
<p>填写样例如下：</p>
<p><img src="https://cdn.acedata.cloud/psf4rm.png" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://cdn.acedata.cloud/988rlq.png" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/riffusion/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "action": "swap_sound",
  "model": "FUZZ-1.0 Pro",
  "lyric": "[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high",
  "audio_id": "b7376272-3902-49b4-a83b-62f7e6ab505c"
}'
</code></pre>
<p>测试允许，生成的效果是类似的。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"93279260-5ca1-42d8-bde1-1fa62e0f5027"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"bc4e28db-4897-4ffc-9e03-45f43da7a21c"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"242035c0-8ac2-4f0b-a19c-ac2fa49d4df3"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Brightside"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/36494e8a-eb82-4d89-bbfa-ec719e19572b/image/242035c0-8ac2-4f0b-a19c-ac2fa49d4df3.jpg"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/36494e8a-eb82-4d89-bbfa-ec719e19572b/audio/242035c0-8ac2-4f0b-a19c-ac2fa49d4df3.m4a"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-23T02:02:32.799561Z"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyrics_timestamped"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"words"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.28</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.28</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                    ...
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">195.84</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">29</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">195.84</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"high"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span>
                <span class="hljs-punctuation">]</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">197.2696371882086</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"594fe702-6c71-4b0c-abb6-21b58efc74a6"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Sunrise"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/36494e8a-eb82-4d89-bbfa-ec719e19572b/image/594fe702-6c71-4b0c-abb6-21b58efc74a6.jpg"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/36494e8a-eb82-4d89-bbfa-ec719e19572b/audio/594fe702-6c71-4b0c-abb6-21b58efc74a6.m4a"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-23T02:02:30.523279Z"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyrics_timestamped"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"words"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                    ...
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">192.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">29</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">192.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"high"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span>
                <span class="hljs-punctuation">]</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">196.7198866213152</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-7">SwapVocals 生成</h2>
<p>如果想使用官方的SwapVocals操作，可以将<code>action</code>参数值设为：<code>swap_vocals</code>，接下来我们要根据歌词、标题、风格自定义生成歌曲。</p>
<p>如果想对自己上传的歌曲进行继续SwapVocals操作的话，可以将参数 <code>action</code> 设置为 <code>upload_swap_vocals</code> ，并且输入需要继续SwapVocals操作自定义上传的歌曲 ID，歌曲 ID 的获取是使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F76d79f86-39af-4034-8c6a-51e4a819308d%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6" target="_blank" title="https://platform.acedata.cloud/documents/76d79f86-39af-4034-8c6a-51e4a819308d?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6" ref="nofollow noopener noreferrer">Riffusion Upload API</a>来获取，如下图所示：</p>
<p><img src="https://cdn.acedata.cloud/z7r5fd.png" width="500" class="m-auto" loading="lazy"/></p>
<p>就可以指定如下内容：</p>
<ul>
<li>action：此次歌曲任务的行为，目前支持：generate、cover、extend、upload_cover、upload_extend、replace_section、upload_replace_section、swap_vocals、upload_swap_vocals、swap_sound、upload_swap_sound。</li>
<li>lyric：歌词文本</li>
<li>title：歌曲的标题。</li>
<li>audio_id：歌曲的ID。</li>
<li>style：歌曲的风格，选填。</li>
</ul>
<p>填写样例如下：</p>
<p><img src="https://cdn.acedata.cloud/n6k8wk.png" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://cdn.acedata.cloud/3wg240.png" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/riffusion/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "action": "swap_vocals",
  "model": "FUZZ-1.0 Pro",
  "lyric": "[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high",
  "audio_id": "b7376272-3902-49b4-a83b-62f7e6ab505c"
}'
</code></pre>
<p>测试允许，生成的效果是类似的。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"a6e0d456-189b-4c78-9232-2fe72166ab39"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ee5769d4-ae94-4e5a-a85f-b3c0ddc2e48e"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b8b1ed14-f43c-4738-a697-60ba24b6049d"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Uplift"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/25ce4ddd-e48c-42e2-9ea3-8e03380508f2/image/b8b1ed14-f43c-4738-a697-60ba24b6049d.jpg"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/25ce4ddd-e48c-42e2-9ea3-8e03380508f2/audio/b8b1ed14-f43c-4738-a697-60ba24b6049d.m4a"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-23T02:04:18.477032Z"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyrics_timestamped"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"words"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2.56</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2.56</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                    ...
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">186.88</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">29</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">171.52</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"high"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span>
                <span class="hljs-punctuation">]</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">195.55968253968254</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dfd6eb9c-a1f3-4e1f-bbf9-e0b9625e459f"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Vivid Rise"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/25ce4ddd-e48c-42e2-9ea3-8e03380508f2/image/dfd6eb9c-a1f3-4e1f-bbf9-e0b9625e459f.jpg"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/25ce4ddd-e48c-42e2-9ea3-8e03380508f2/audio/dfd6eb9c-a1f3-4e1f-bbf9-e0b9625e459f.m4a"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-23T02:04:27.140387Z"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyrics_timestamped"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"words"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.28</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.28</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                    ...
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">188.8</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">29</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">188.16</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"high"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span>
                <span class="hljs-punctuation">]</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">196.07185941043085</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-8">异步回调</h2>
<p>由于 Riffusion Audios Generation API 生成的时间有时候会相对较长，如果 API 长时间无响应，HTTP 请求会一直保持连接，导致额外的系统资源消耗，所以本 API 也提供了异步回调的支持。</p>
<p>整体流程是：客户端发起请求的时候，额外指定一个 <code>callback_url</code> 字段，客户端发起 API 请求之后，API 会立马返回一个结果，包含一个 <code>task_id</code> 的字段信息，代表当前的任务 ID。当任务完成之后，生成任务的结果会通过 POST JSON 的形式发送到客户端指定的 <code>callback_url</code>，其中也包括了 <code>task_id</code> 字段，这样任务结果就可以通过 ID 关联起来了。</p>
<p>下面我们通过示例来了解下具体怎样操作。</p>
<p>首先，Webhook 回调是一个可以接收 HTTP 请求的服务，开发者应该替换为自己搭建的 HTTP 服务器的 URL。此处为了方便演示，使用一个公开的 Webhook 样例网站 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebhook.site%2F" target="_blank" title="https://webhook.site/" ref="nofollow noopener noreferrer">webhook.site/</a>，打开该网站即可得到一个 Webhook URL，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/tbcnai.png" alt="" loading="lazy"/></p>
<p>将此 URL 复制下来，就可以作为 Webhook 来使用，此处的样例为 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebhook.site%2F68368fc6-7f0a-425e-b63a-cc48631615fe" target="_blank" title="https://webhook.site/68368fc6-7f0a-425e-b63a-cc48631615fe" ref="nofollow noopener noreferrer">webhook.site/68368fc6-7f…</a>。</p>
<p>接下来，我们可以设置字段 <code>callback_url</code> 为上述 Webhook URL，同时填入相应的参数，具体的内容如图所示：</p>
<p><img src="https://cdn.acedata.cloud/kk7y6q.png" width="500" class="m-auto" loading="lazy"/></p>
<p>点击运行，可以发现会立即得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"9939767a-7f9c-4f43-aabf-ca68fe385f3c"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>稍等片刻，我们可以在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebhook.site%2F68368fc6-7f0a-425e-b63a-cc48631615fe" target="_blank" title="https://webhook.site/68368fc6-7f0a-425e-b63a-cc48631615fe" ref="nofollow noopener noreferrer">webhook.site/68368fc6-7f…</a> 上观察到生成任务的结果，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/bgujzg.png" alt="" loading="lazy"/></p>
<p>内容如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"9939767a-7f9c-4f43-aabf-ca68fe385f3c"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"13a86870-e705-45d0-8447-82a08701c0fa"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"72e6c476-0116-4da9-ae34-f78190020b35"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Rise"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/9b9f3281-6b47-44ac-8e4b-3b0d105e163d/image/72e6c476-0116-4da9-ae34-f78190020b35.jpg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/9b9f3281-6b47-44ac-8e4b-3b0d105e163d/audio/72e6c476-0116-4da9-ae34-f78190020b35.m4a"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-15T15:43:22.432605Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FUZZ-1.0"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"acoustic folk, finger picking"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">184.96</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"7f4f5c20-4395-4583-9dbb-735b9bb86957"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Luminance"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/9b9f3281-6b47-44ac-8e4b-3b0d105e163d/image/7f4f5c20-4395-4583-9dbb-735b9bb86957.jpg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/9b9f3281-6b47-44ac-8e4b-3b0d105e163d/audio/7f4f5c20-4395-4583-9dbb-735b9bb86957.m4a"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-15T15:43:21.574561Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FUZZ-1.0"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"deep bass, ethereal electronic"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">165.12</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>可以看到结果中有一个 <code>task_id</code> 字段，其他的字段都和上文类似，通过该字段即可实现任务的关联。</p>
<h2 data-id="heading-9">错误处理</h2>
<p>在调用 API 时，如果遇到错误，API 会返回相应的错误代码和信息。例如：</p>
<ul>
<li><code>400 token_mismatched</code>：Bad request, possibly due to missing or invalid parameters.</li>
<li><code>400 api_not_implemented</code>：Bad request, possibly due to missing or invalid parameters.</li>
<li><code>401 invalid_token</code>：Unauthorized, invalid or missing authorization token.</li>
<li><code>429 too_many_requests</code>：Too many requests, you have exceeded the rate limit.</li>
<li><code>500 api_error</code>：Internal server error, something went wrong on the server.</li>
</ul>
<h3 data-id="heading-10">错误响应示例</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"error"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api_error"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"fetch failed"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2cf86e86-22a4-46e1-ac2f-032c0f2a4e89"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-11">结论</h2>
<p>通过本文档，您已经了解了如何使用 Riffusion Audios Generation API 可通过输入提示词来生成音乐。希望本文档能帮助您更好地对接和使用该 API。如有任何问题，请随时联系我们的技术支持团队。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我的很多朋友，都消失了…]]></title>    <link>https://juejin.cn/post/7604665952320454707</link>    <guid>https://juejin.cn/post/7604665952320454707</guid>    <pubDate>2026-02-10T00:24:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604665952320454707" data-draft-id="7604697194794844170" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我的很多朋友，都消失了…"/> <meta itemprop="keywords" content="前端,后端,程序员"/> <meta itemprop="datePublished" content="2026-02-10T00:24:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CodeSheep"/> <meta itemprop="url" content="https://juejin.cn/user/4371313961738616"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我的很多朋友，都消失了…
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4371313961738616/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CodeSheep
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T00:24:33.000Z" title="Tue Feb 10 2026 00:24:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>不知道大家有没有类似的感受，自从毕业之后，身边很多当年在学校里关系非常要好，走得非常近的同学和朋友<strong>似乎开始渐渐从自己的生活中消失了</strong>。</p>
<p>而且随着年龄的逐渐增加，这种感觉也愈发明显。</p>
<p>包括上周末，我在家备份迁移微信聊天记录，我突然发现高中班级群已经安静了快一年了，这一年中居然没有任何一位同学在里面发消息，上一次有消息弹出，还是定格在过年时群主例行公事般发的祝福模板。</p>
<p>后来我又看了看大学的班级群，果不其然，也是快一年没有人说话了。</p>
<p>顺着往前翻，翻到五年前的聊天记录，那时候满屏还都是“聚会地点投票”、“谁从深圳回来了”、“能不能带家属”的热闹。</p>
<p>而现在，那种张罗同学聚会的热情，好像不知不觉就淡了。</p>
<p>这时候我不禁想起了前段时间刷职场社区所看到的一个帖子：**为什么现在不流行同学聚会了？**参与讨论的同学也不少。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61a33dbf3dbe4596bb005694c8b65f1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29kZVNoZWVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771287878&amp;x-signature=CNPCpXnULcjk0DEXBxEN55kqplY%3D" alt="" loading="lazy"/></p>
<p>这不马上也过年了嘛，这时候我才意识到，原来我们也已经有好多年没有办过同学聚会了。</p>
<hr/>
<p>回想起念书以及刚毕业那会儿，同学聚会是件大事。每逢年节，班级群里总会热闹一阵，老早就会有人开始提前张罗这事。</p>
<p>刚开始那几年，大家都有说不完的话，谁去了北京上海，谁考上了公务员、研究生，谁在单位遇见了奇葩领导。</p>
<p>酒杯碰撞的声音里，装着二十多岁的年轻人对世界的新鲜困惑与试探。所有人的眼睛都亮晶晶的，仿佛要把分开这些年错过的彼此人生都找补回来。</p>
<p>但是现在呢？</p>
<p>班级群大多沉寂着，即便偶尔有消息，要么是学校新闻转发，或是微商帖子，甚至是某个同学随手转发的互联网新闻等等。</p>
<p>那个曾经承载了我们无数青春回忆的群聊，仿佛已经成了互联网上一个被遗忘的角落。我们似乎都默契地选择了不打扰，选择了各自安好。</p>
<p><strong>于是我就在想，为什么会这样呢？</strong></p>
<p>是大家都忙于生计，真抽不出时间吗？还是通讯太发达了，让我们觉得即便不面对面，也仿佛随时能联系上？亦或是，在我们内心深处，对这种形式的聚会，已经产生了一种难以言说的倦怠和疏离？</p>
<p>这里我也来试着聊一聊我个人的一些理解吧，也欢迎大家一起来分享交流。</p>
<hr/>
<p><strong>首先聊聊心态的变化。</strong></p>
<p>年轻的时候，大家聚在一起，聊的是梦想，是八卦，是那个谁喜欢谁的小秘密，是考试成绩的起起落落。那时候，大家彼此是对方青春岁月里重要的见证者。</p>
<p>但随着年岁渐长，步入社会，大家被抛入了各自的人生轨道。几年、十几年过去，大家的境遇早已千差万别。</p>
<p>有的人在职场春风得意，有的人在创业路上摸爬滚打，有的人选择回归家庭，也有的人还在为下一份工作的去向而迷茫。</p>
<p>这时候再聚在一起，聊什么呢？聊工作？怕变成炫耀或诉苦的大会。聊家庭？没结婚的尴尬，结了婚的可能有一肚子苦水。聊孩子？那似乎更是另一个次元的话题了。</p>
<p>大家试图小心翼翼地避开那些可能引起不适的话题，最后发现能聊的，似乎只剩下一些苍白的客套和对过去的记忆。</p>
<p>这样一来，就变成尬聊了，有点像那种社交表演，演完各自散场，心里反而可能添上几分空落落的疲惫。</p>
<p><strong>再说说生活重心的变化。</strong></p>
<p>我们这一代人，现在大家也逐渐步入了上有老下有小的阶段了。</p>
<p>工作日要为 KPI、为代码、为各种突发状况焦头烂额，周末那点可怜的休息时间，恨不得全部用来补觉、陪家人、陪孩子。</p>
<p>参加一次同学聚会，意味着要提前规划时间，可能要舟车劳顿，要在饭桌上应付各种寒暄和调侃，这本身就是一件耗费巨大精力的事情。</p>
<p>而聚会带来的“收益”呢？似乎除了短暂的、甚至有些虚假的热闹，并没有太多实质性意义。</p>
<p>与其把宝贵的休息时间花在和一群可能已经陌生的人尬聊上，不如在家陪陪父母孩子，或者一个人安安静静地读会书、打会游戏来得惬意实在。</p>
<p>大家的精力和时间，越来越宝贵，也越来越“自私”吧，可能只想留给真正重要的人和事。</p>
<p><strong>当然，可能还有一种微妙的心理在作祟，虽然大家嘴上不说，但心里都明白，那就是比较和防御。</strong></p>
<p>同学聚会，某种程度上，也是一场无声的攀比大会。虽然大家明里不说，但眼睛是雪亮的。</p>
<p>谁开的车好，谁穿的衣服贵，谁的言谈举止更有社会地位，谁的孩子更优秀…这些信息会像雷达一样，自动扫描、接收、处理。</p>
<p>这种比较，往往会带来焦虑、失落，甚至是自卑。为了避免这种不必要的心理波动，很多人选择主动屏蔽掉这种可能引发比较的场景。</p>
<p>大家可能更愿意活在自己的小世界里，守护着自己那份平凡的安稳，而不是在聚会的喧嚣中，被别人的光芒刺痛眼睛。</p>
<p><strong>当然还有一点，也有可能是大家对“同学”这个身份的认同感在渐渐淡化吧。</strong></p>
<p>在学校时，大家因为共同的学习环境、共同的奋斗目标而凝聚在一起。但毕业后，大家被社会这所更大的学校重新塑造。大家的价值观、人生观、世界观，都在各自的经历和圈子中发生了变化。</p>
<p>曾经的共同语言，可能早已被现实的洪流冲刷得所剩无几。</p>
<p>曾经的同学成了社会人，身上贴满了各种标签：父亲、母亲、程序员、产品经理、销售、主管……</p>
<p>「同学」这个标签在彼此身上，或许已经褪色成了最不重要、甚至可以忽略不计的那一个。</p>
<p>大家可能更愿意和志同道合的朋友、和工作上的伙伴、和兴趣相投的圈子交往，因为那里有更直接的共鸣和更有效的连接。</p>
<p>当然，这里并不是说同学聚会就一无是处，或者应该彻底消失。</p>
<p>我坚信，对于某些人，某些特定的圈子，同学聚会依然是维系情感的重要纽带。</p>
<p>而且我也相信，总有一些真挚的情谊，能够跨越时空的阻隔，历久弥新。</p>
<p>只是，对于大多数人而言，对于这种形式的、带有某种仪式感的集体聚会可能确实已经不那么热衷了，大家觉得呢？</p>
<p>那关于这个问题，你的看法是什么呢，如果有不同的见解，也欢迎一起来分享交流~</p>
<blockquote>
<p>注：本文在GitHub开源仓库「编程之路」 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frd2coding%2FRoad2Coding" target="_blank" title="https://github.com/rd2coding/Road2Coding" ref="nofollow noopener noreferrer">github.com/rd2coding/R…</a> 中已经收录，里面有我整理的6大编程方向(岗位)的自学路线+知识点大梳理、面试考点、我的简历、几本硬核pdf笔记，以及程序员生活和感悟，欢迎star。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[追更 HelloGitHub 一整年，终于等到了这篇年度盘点]]></title>    <link>https://juejin.cn/post/7604697194794860554</link>    <guid>https://juejin.cn/post/7604697194794860554</guid>    <pubDate>2026-02-10T00:30:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604697194794860554" data-draft-id="7604433863726563382" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="追更 HelloGitHub 一整年，终于等到了这篇年度盘点"/> <meta itemprop="keywords" content="GitHub,开源"/> <meta itemprop="datePublished" content="2026-02-10T00:30:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HelloGitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1574156384091320"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            追更 HelloGitHub 一整年，终于等到了这篇年度盘点
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1574156384091320/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HelloGitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T00:30:50.000Z" title="Tue Feb 10 2026 00:30:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>转眼一年又过去了，春节将至 HelloGitHub 也迎来了一年一度的年度盘点时刻。</p>
<p>接下来，就让我们一起来看看，都有哪些开源项目入选了《2025 年 HelloGitHub 年度热门开源项目》。<strong>需要说明的是</strong>，入选并不是按照 Star 增长或“出圈”程度作为唯一标准，而是更看重来自 HelloGitHub 社区用户的真实反馈——阅读、点赞、收藏与评论等。</p>
<p>因此大家为自己喜欢的开源项目「点赞」十分重要，每一次互动都可能让你喜欢的开源项目被更多人看到。</p>
<p>同时为了满足不同读者对各类开源项目的喜好，我还整理了 40 个开源项目（每类精选 Top3），量大管饱总会有你喜欢的。所以我将文章内容分为了 <strong>年度十佳</strong> 和 <strong>分类精选</strong> 两个部分，方便大家速览和按需阅读。</p>
<ol>
<li>年度十佳：HelloGitHub 最受欢迎的 10 个开源项目</li>
<li>分类精选：根据 C/C++、C#、Go、Java、JavaScript、移动端、Python、Rust、人工智能、书籍/教程、其它等类别整理</li>
</ol>
<p>话不多说，开始沉浸式享受这份来自 HelloGitHub 的春节礼物吧～</p>
<h2 data-id="heading-0">一、年度十佳</h2>
<p>这里是 HelloGitHub 2025 年度最受欢迎的 10 个开源项目，筛选和排序是综合了用户的浏览、点赞、收藏和评论等数据，所以它们是来自 HelloGitHub 社区小伙伴们的选择！</p>
<h3 data-id="heading-1">1、跨平台可爱的互动桌宠应用</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa0695c385c0417898268e65624a4b1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=EXYIhT%2Fdf1mAwkTe8Jpu%2Bshq9ms%3D" alt="" loading="lazy"/></p>
<p>这是一款开源的跨平台桌面宠物应用，以可爱的猫咪形象陪伴你的每一次键盘与鼠标操作。它基于 Tauri 构建，支持 macOS、Windows 和 Linux，无论你使用哪种系统，都能“领养”这只可爱猫咪，让你的桌面充满乐趣。</p>
<p><strong>用户评价</strong>：好用，在养了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72459baef65743d992d019de115619ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=4ABO0sN%2Ba%2F%2B6%2BdM5PRP7cMngd4A%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>GitHub 地址→<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fayangweb%2FBongoCat" target="_blank" title="https://github.com/ayangweb/BongoCat" ref="nofollow noopener noreferrer">github.com/ayangweb/Bo…</a></p>
</blockquote>
<h3 data-id="heading-2">2、开箱即用的游戏变速器</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81a98e3e9f804066ae9d4695e6645626~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=iK2ODIMKLV%2F634XOMQwCzVou%2FVE%3D" alt="" loading="lazy"/></p>
<p>这是一款完全免费、开源的 Windows 游戏加速工具。它通过 Hook 系统时间函数，实现对游戏速度的灵活调节，并提供简单易用的界面，兼容多种单机游戏。请勿用于网络游戏，以免导致账号被封！</p>
<p><strong>用户评价</strong>：很好用，很可以。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/904c553c123d4efe843b09d4dd6e6061~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=xXRRWbaAVVJwYT2A4fNa4pY%2BaFM%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>GitHub 地址→<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgame1024%2FOpenSpeedy" target="_blank" title="https://github.com/game1024/OpenSpeedy" ref="nofollow noopener noreferrer">github.com/game1024/Op…</a></p>
</blockquote>
<h3 data-id="heading-3">3、沉浸式的电子书阅读器</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f215844af82f499d86894beeb08a9f6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=4mW8YU%2F8lyoeiEUnhju6ejqHDI4%3D" alt="" loading="lazy"/></p>
<p>这是一款为热爱阅读的用户量身打造的阅读软件，将极简设计与强大功能融合，为你带来专注、沉浸的阅读体验。它基于 Next.js 和 Tauri 开发，支持跨平台运行，现已支持 macOS、Windows、Linux、Android、iOS 和 Web 全平台覆盖。</p>
<p><strong>用户评价</strong>：好用，特别是在线版，流畅丝滑。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fcc7b9ab17bc4438ae7189f65735dc3d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=wrYwp7hNUH%2BoXiq4i09CgLw5A7Y%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>GitHub 地址→<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Freadest%2Freadest" target="_blank" title="https://github.com/readest/readest" ref="nofollow noopener noreferrer">github.com/readest/rea…</a></p>
</blockquote>
<h3 data-id="heading-4">4、每日 60 秒资讯 API 集合</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71b961066b9546e19fbc5856e9f0c639~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=aes2Z8cKzX18KSGtMyEovGCn4B0%3D" alt="" loading="lazy"/></p>
<p>该项目集合了包括每日新闻、实时票房、汇率、热搜榜、随机段子等多种数据的 API 服务。</p>
<p><strong>用户评价</strong>：好用，种类挺多的，支持。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/925ea58af2a241db9622ac39b8a47014~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=DTgfdXZSERngKxXfcq09owym2bk%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>GitHub 地址→<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvikiboss%2F60s" target="_blank" title="https://github.com/vikiboss/60s" ref="nofollow noopener noreferrer">github.com/vikiboss/60…</a></p>
</blockquote>
<h3 data-id="heading-5">5、易用的跨平台开源聊天应用</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/727318d26e854d68b78a71e373e3eff2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=NOow8zAYmiolSfMsV0wo4Oi%2B3yo%3D" alt="" loading="lazy"/></p>
<p>这是一款专为多端打造的现代化即时通讯系统，实现了从桌面到移动平台的无缝通讯体验。它基于 Tauri、Vite 6、Vue 3 和 TypeScript 构建，支持一对一私聊、群组聊天、消息撤回和@提醒等功能，适用于 Windows、macOS、Linux、iOS 和 Android 等多种操作系统。</p>
<p><strong>用户评价</strong>：只是在文章中多看了一眼，就被惊艳到了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/902671219300497f87bb7fb4af5cce5a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=7A8g8g5%2B3tWgtD1in78tnDF4hzw%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>GitHub 地址→<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FHuLaSpark%2FHuLa" target="_blank" title="https://github.com/HuLaSpark/HuLa" ref="nofollow noopener noreferrer">github.com/HuLaSpark/H…</a></p>
</blockquote>
<h3 data-id="heading-6">6、全开源的实时资讯平台</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5300dafcc7e2439ba324572b6249cb88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=4p8jquWAOBZLvkh43UF5ZtDF5yM%3D" alt="" loading="lazy"/></p>
<p>这是一款高颜值的实时新闻与热榜网站，相比传统热榜产品更加注重实时新闻。它前后端完全开源、部署简单，可轻松托管到 Cloudflare Pages 或 Vercel 等平台。</p>
<p><strong>用户评价</strong>：太棒了，一览所有新闻热榜。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/144b653ea680493d988796aa6bf01e71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=YYP5lnL0pX%2Bs3r0uDF6PqnnqfIc%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>GitHub 地址→<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fourongxing%2Fnewsnow" target="_blank" title="https://github.com/ourongxing/newsnow" ref="nofollow noopener noreferrer">github.com/ourongxing/…</a></p>
</blockquote>
<h3 data-id="heading-7">7、用 Excel 手搓各种 AI 算法</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b01f35169f2429296fd1372c43b63af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=P8QYipoMVWSKKP%2FVH0AGhnEP3Gs%3D" alt="" loading="lazy"/></p>
<p>该项目是通过 Excel 的形式实现并演示人工智能与深度学习的核心算法和概念，让初学者可以动手操作并理解 AI 的运行原理，包括矩阵乘法、MLP、RNN、Transformer、ResNet 等，以独特且浅显易懂的形式，降低了 AI 学习的门槛。</p>
<p><strong>用户评价</strong>：有中文文档就好了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9554b5d55a0b4094acedc5aded704f0e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=gvd6Bwx6C2AyWkKZqm8D9515%2Bx8%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>GitHub 地址→<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FImagineAILab%2Fai-by-hand-excel" target="_blank" title="https://github.com/ImagineAILab/ai-by-hand-excel" ref="nofollow noopener noreferrer">github.com/ImagineAILa…</a></p>
</blockquote>
<h3 data-id="heading-8">8、从零开始训练小型语言模型</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29a59fc0a0ab4ff2b60b422e868f0864~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=BfKdjJ8om7MSTV5YkQami0v%2FgaA%3D" alt="" loading="lazy"/></p>
<p>这不仅是一个微型语言模型的实现，更是一份入门 LLM 的教程，旨在降低学习和上手 LLM 的门槛 。它提供了从数据预处理到模型训练、微调和推理的全流程代码和教程。最小模型仅 0.02B 参数，可在普通 GPU 上轻松运行。</p>
<p><strong>用户评价</strong>：试了一遍不错。降低参数，连我这个入门显卡都能跑。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/232a4cbc22774c3682f67275924b2614~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=VBrh6v8GI71ZqY7YJEOzXHPSCN8%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>GitHub 地址→<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fjingyaogong%2Fminimind" target="_blank" title="https://github.com/jingyaogong/minimind" ref="nofollow noopener noreferrer">github.com/jingyaogong…</a></p>
</blockquote>
<h3 data-id="heading-9">9、开源圆角等宽字体</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4771ee95796a4ebca748dda145e326bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=rR%2Blpt%2BhFMbvwnTVB0fnOxhGFds%3D" alt="" loading="lazy"/></p>
<p>这是一款高质量的等宽字体，具备可变字体、圆角设计、智能连字、图标等特性，支持简体中文、繁体中文和日语字符集，以及通过脚本自定义构建字体，满足不同平台和个性化需求。</p>
<p><strong>用户评价</strong>：真的很好用！！很好看而且等宽太舒服了！最舒服的是连写，更贴近自然语言！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a23ba55b27545d09a22f72f610bfa8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=%2BNg873yuT7bxfv%2BJT6L8fbFscP8%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>GitHub 地址→<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsubframe7536%2Fmaple-font" target="_blank" title="https://github.com/subframe7536/maple-font" ref="nofollow noopener noreferrer">github.com/subframe753…</a></p>
</blockquote>
<h3 data-id="heading-10">10、DeepSeek 开源的混合专家模型</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2fa69d5f42dd4b30b8418c608cd57cf8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=ofqUlDYb7hW3itgWObaCjArQLuE%3D" alt="" loading="lazy"/></p>
<p>这是一个基于混合专家（MoE）和多头潜在注意力（MLA）架构的开源大语言模型，在数学推理、代码生成等复杂任务中表现优秀。该模型总规模达 671B 参数，但每个 token 只激活其中的 37B 参数。即在处理输入时，并非所有“专家”都参与计算，而是选择一部分专家进行处理。通过激活部分参数（37B）完成计算，从而降低了训练和推理的成本。</p>
<p><strong>用户评价</strong>：国产之光厉害。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a00d01fc545745dea7d6311122626221~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=2a%2BzsYcLHclpq7L3aKqYaAj4hFU%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>GitHub 地址→<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdeepseek-ai%2FDeepSeek-V3" target="_blank" title="https://github.com/deepseek-ai/DeepSeek-V3" ref="nofollow noopener noreferrer">github.com/deepseek-ai…</a></p>
</blockquote>
<h2 data-id="heading-11">二、分类精选</h2>
<p>如果上面的<strong>年度十佳</strong>，没有你喜欢的开源项目，没关系！</p>
<pre><code class="hljs language-markdown" lang="markdown">========================================
<span class="hljs-section">📊 2025年度数据概览
========================================</span>
发布项目数     : 588
总浏览量(UV)  : 1,253,290
总收藏数      : 4,462
总评论数      : 650
总投票数      : 5,936
</code></pre>
<p>下面我从其余的 500 多个项目里，按照 11 个分类整理精选出共 40 个开源项目，大部分分类只取 Top3，方便大家阅读。</p>
<h3 data-id="heading-12">C/C++ 项目</h3>
<p>1、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2Fvladelaina%2FCatime" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/vladelaina/Catime" ref="nofollow noopener noreferrer">Catime</a>：简洁小巧的 Windows 计时器。这是一款轻巧易用的 Windows 计时器，集显示时间、倒计时和番茄时钟功能于一体。它采用 C 语言编写，体积小、占用少，支持透明界面。用户可以调整界面大小和位置，设置超时动作（锁屏/通知/关机），以及自定义颜色、字体和托盘动画，满足个性化需求。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da64b1a829844e8c8bf02f490fe55735~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=oymsAOWZWuEELbA1USCGgLTM9eU%3D" alt="" loading="lazy"/></p>
<p>2、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2FHIllya51%2FLunaTranslator" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/HIllya51/LunaTranslator" ref="nofollow noopener noreferrer">LunaTranslator</a>：开源的视觉小说翻译工具。这是一款专为 Windows 平台设计的视觉小说翻译器，支持 HOOK、OCR、剪贴板等多种文本提取方式，可灵活切换，并提供在线翻译、离线翻译、语音合成等功能。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00862290105c4e5b8ced01c49a027147~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=BG57tI101zaI1n2XFzk%2BFhThyDE%3D" alt="" loading="lazy"/></p>
<p>3、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2Fzhongyang219%2FMusicPlayer2" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/zhongyang219/MusicPlayer2" ref="nofollow noopener noreferrer">MusicPlayer2</a>：多功能的 Windows 音乐播放器。该项目是一款由 C++ 编写的简约、小巧、多功能的 Windows 本地音乐播放器，支持常见音频格式，并提供歌词显示、卡拉 OK 模式、歌词编辑、专辑封面展示、频谱分析和音效调节等功能。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c061e91bad9043d6898d1da40d42fe7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=eW7FUoH5%2FhSiLh%2F%2BLIFqEUVSAsI%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-13">C# 项目</h3>
<p>4、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2FClassIsland%2FClassIsland" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/ClassIsland/ClassIsland" ref="nofollow noopener noreferrer">ClassIsland</a>：抬头即见的开源课表工具。这是一款专为大屏设备打造的桌面课表应用，可将课程表以简洁组件的形式常驻桌面，取代传统黑板课表。支持下课提醒、天气信息、倒计时、密码保护和课表导入等功能，适用于配备教室多媒体大屏、投影仪或智慧黑板的教室。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e270addef8bf4ad18cf801e3d9206a61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=t9qNgwszyv3AKYnqSoBiT8%2Bc8xk%3D" alt="" loading="lazy"/></p>
<p>5、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2Fw4po%2FExplorerTabUtility" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/w4po/ExplorerTabUtility" ref="nofollow noopener noreferrer">ExplorerTabUtility</a>：Windows 文件管理多标签扩展工具。这是一款专为 Windows 11 打造的文件资源管理器增强工具，能够自动将多个窗口合并为单窗口多标签页模式。支持路径去重、标签搜索、批量打开/关闭/还原等功能，轻松告别桌面窗口杂乱的烦恼。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/daa01c5334564ed1bffef32090f80ea3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=5c4nXpH3Htm5bTYhLNx59QFS3ds%3D" alt="" loading="lazy"/></p>
<p>6、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2Fduplicati%2Fduplicati" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/duplicati/duplicati" ref="nofollow noopener noreferrer">duplicati</a>：跨平台的多云安全备份工具。这是一款跨平台的备份客户端，支持多种主流云存储服务（如 S3、Dropbox、Google Drive 等）。它可将加密、增量、压缩的备份文件安全地存储到云端或服务器，适用于个人隐私数据的云备份。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d89b3d9c48734746bea3eea431fddc90~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=Kszqj8L9taNAyJuPQz9iPuL7JGc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-14">Go 项目</h3>
<p>7、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2Flin-snow%2FEch0" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/lin-snow/Ech0" ref="nofollow noopener noreferrer">Ech0</a>：清爽的轻量级内容分享平台。这是一款开源、自托管的轻量级内容发布平台，专注于思想流动和快速分享。它拥有简洁直观的操作界面，支持发布和分享想法、文字、图片和链接。同时，支持类似 ActivityPub 的联邦协议，实现不同实例（站点）之间的互联互通，让内容不再局限于单一孤立的网站。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cbd2448cbd2d4fc5b2f7489a5ac289e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=afW77rqdHRDRzK39hCe9SIkBVxw%3D" alt="" loading="lazy"/></p>
<p>8、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2Fmayswind%2Fezbookkeeping" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/mayswind/ezbookkeeping" ref="nofollow noopener noreferrer">ezbookkeeping</a>：轻松自托管你的个人财务数据。这是一款免费、轻量、可自托管的个人记账应用，采用 Go+Vue 构建。它界面简洁易用、功能丰富，支持二级账户（个人/家庭）、收支分类、交易图片附件、定期收支自动记账等功能。借助 PWA 技术，可一键添加到手机主屏幕，体验媲美原生 App。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59e1f3bd8af64589a4ccab9b43f889a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=gRjRvJE5qU30GnptNSBqhavYcRc%3D" alt="" loading="lazy"/></p>
<p>9、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2Ftbphp%2Fgpt-load" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/tbphp/gpt-load" ref="nofollow noopener noreferrer">gpt-load</a>：企业级的多渠道大模型 API 管理平台。这是一款用 Go 语言开发的企业级大模型接口管理平台，支持 OpenAI、Gemini、Claude 等多种服务。它开箱即用、内置 Web 管理界面、保留原生 API 格式，支持密钥自动轮询、故障切换和水平扩展，专为高并发生产环境而设计。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57f7d3359aef46849c79abd0bd5a1b82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=nz%2BQu6e1E2RUPgP1%2FArnEJJ6jQs%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-15">Java 项目</h3>
<p>10、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2Fnagisa77%2FOpenIsle" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/nagisa77/OpenIsle" ref="nofollow noopener noreferrer">OpenIsle</a>：Java 开发的轻量级开源社区系统。这是一个基于 Spring Boot 和 Vue3 构建的开源自由社区系统，定位为轻量级的 Discourse。它完全开源、可二次开发，支持白名单邀请、自定义标签、实时通知等功能。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd02051767634e09bbd0a572f77523ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=6ag3xzM7ls9LijVeiE1Tm6wLQwc%3D" alt="" loading="lazy"/></p>
<p>11、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2Fbooklore-app%2Fbooklore" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/booklore-app/booklore" ref="nofollow noopener noreferrer">booklore</a>：Java 开发的个人数字图书馆。这是一款开源、自托管的电子书管理 Web 应用，支持 PDF 和 ePub 电子书格式。它采用 Java（Spring Boot）+ Angular 开发，支持自动获取书籍信息、分享书籍、阅读进度同步、多用户管理等功能。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5224c9cecfbb4bbc964f3fbef2785045~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=VZM%2FTuf%2BgvcIY7NYQ93M9Xs4Y2k%3D" alt="" loading="lazy"/></p>
<p>12、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2Fsynthetichealth%2Fsynthea" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/synthetichealth/synthea" ref="nofollow noopener noreferrer">synthea</a>：模拟患者人群的开源工具。这是一款开源的合成患者数据和健康记录的模拟器，支持生成病历、症状、诊断、药物、疫苗接种记录等多种医疗信息数据，适用于临床研究、流行病学研究等场景。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/458941b675874aeeb4332c45c1f23597~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=IMyA53%2B7Pp%2Bab%2B7Ki2%2FoGXCnszM%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-16">JavaScript 项目</h3>
<p>13、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2Fzyronon%2FTypeWords" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/zyronon/TypeWords" ref="nofollow noopener noreferrer">TypeWords</a>：极简的打字背单词网站。这是一款基于网页的背单词软件，帮助用户通过键盘输入来记忆单词。它界面简洁、交互流畅，支持单词发音、错误统计和生词本等功能。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/539d88f07b8448cfbaac94022a4d019e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=9q2EbVvPXtCzQf5XoohJfCvlnPs%3D" alt="" loading="lazy"/></p>
<p>14、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2Fplait-board%2Fdrawnix" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/plait-board/drawnix" ref="nofollow noopener noreferrer">drawnix</a>：极简的在线白板工具。这是一款免费、开源的在线白板工具。它提供一个无限画布，支持自由绘制、思维导图、流程图、画笔、插入图片、自动保存等功能，以及移动端适配、Docker 部署和插件机制等特性。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af83046bc8be4fc8adb495c9a81a52f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=KaIRiagpUoTMKorF%2FbimepMaTpA%3D" alt="" loading="lazy"/></p>
<p>15、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2Falgerkong%2FAlgerMusicPlayer" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/algerkong/AlgerMusicPlayer" ref="nofollow noopener noreferrer">AlgerMusicPlayer</a>：简约美观的音乐播放器。这是一款基于 Electron 开发的第三方音乐播放器，拥有高颜值的界面和丰富的功能，支持本地化服务、桌面歌词显示、音乐下载等，适用于多平台使用。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc9ccab072554ec1af54335b229d52f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=Y2pdzhRsbbAEauNbB0BKKw9nmes%3D" alt="" loading="lazy"/></p>
<p>16、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2FhexianWeb%2FCubeCity" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/hexianWeb/CubeCity" ref="nofollow noopener noreferrer">CubeCity</a>：卡通风格城市建设模拟游戏。这是一款轻量级、卡通风格的 2.5D 城市模拟游戏，基于 Three.js 和 Vue3 构建。玩家可在浏览器中通过点选和拖放，实时建造、搬迁和拆除建筑。建筑会自动产出金币，可用于新建或升级设施。游戏融合了环境、社会与治理（ESG）理念，城市规划需兼顾多元需求，才能打造出可持续发展的理想城市。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d8c548d64364e6681ab68d428a8c969~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=%2F4ij9h0VUs7MWV5nel%2FeqB5YThw%3D" alt="" loading="lazy"/></p>
<p>17、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2Ffuma-nama%2Ffumadocs" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/fuma-nama/fumadocs" ref="nofollow noopener noreferrer">fumadocs</a>：用 Next.js 打造现代化的文档网站。该项目是基于 Next.js 构建的文档网站框架，专为快速创建现代化、高颜值、功能丰富的文档网站而设计。它完全采用 ESM 格式，紧跟前端技术潮流，支持内容集合、MDX、Contentlayer、TailwindCSS 等技术，适用于项目文档、API 文档、开发指南等多种文档需求。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbbf7f3ae5ce431ca34bcd075a1eeb4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=%2F1BRivd6hTiGXCnLYwnAQgZMOOM%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-17">客户端项目</h3>
<p>18、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2Fsaber-notes%2Fsaber" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/saber-notes/saber" ref="nofollow noopener noreferrer">saber</a>：更懂你的手写笔记应用。这是一款开源的手写笔记应用，支持 Android、iOS、Windows、macOS、Linux 等平台。它提供夜间模式、多行公式高亮、密码保护等功能，适用于记录课堂笔记和整理工作思路等场景。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b7a35ae640b4295a5082cf169279f1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=WTv6vhcyt15sX%2BLgJ%2FSi2H%2FNIt4%3D" alt="" loading="lazy"/></p>
<p>19、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2Fkylecorry31%2FTrail-Sense" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/kylecorry31/Trail-Sense" ref="nofollow noopener noreferrer">Trail-Sense</a>：野外生存必备 Android 应用。这是一款专为徒步、露营、野外生存等场景设计的开源 Android 应用。它利用手机的传感器，提供离线导航、日落提醒、照片地图、路径追踪等实用功能，所有功能均可在无网络环境下使用。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2f2c076830244708569771b197a5747~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=FoCJ1YMcETTGGfUoSxPF%2Fh%2BgnuI%3D" alt="" loading="lazy"/></p>
<p>20、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2FTosencen%2FXMSLEEP" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/Tosencen/XMSLEEP" ref="nofollow noopener noreferrer">XMSLEEP</a>：开源的 Android 白噪音应用。这是一个专注于白噪音播放的 Android 应用，提供雨声、篝火、雷声、猫咪呼噜、鸟鸣、夜虫等多种自然声音，帮助你放松、冥想和入睡。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/658a908bebb74c4fb0f78d4e8fbf1e72~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=O5KG%2FYIf5R8eNgtLUL3I%2FsHRNEU%3D" alt="" loading="lazy"/></p>
<p>21、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2Fapple%2Fcontainer" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/apple/container" ref="nofollow noopener noreferrer">container</a>：苹果开源的轻量级虚拟机。这是一款苹果官方开源的轻量级虚拟化容器工具，用于在 Mac 上创建和运行 Linux 容器。它采用 Swift 开发，并针对 Apple 芯片（如 M1、M2 芯片）进行了优化，旨在为 macOS 用户提供高效、原生的容器体验，支持 OCI 标准容器镜像，并可无缝对接 Docker Hub 等主流镜像仓库。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d827c16d7bb844d4b23a84d029f22e98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=gvxhnokjTJ1kbHrTsZpfZjHq8nQ%3D" alt="" loading="lazy"/></p>
<p>22、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2FLunarBar-app%2FLunarBar" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/LunarBar-app/LunarBar" ref="nofollow noopener noreferrer">LunarBar</a>：极简的 Mac 菜单栏日历。这是一款专为 macOS 设计的菜单栏日历工具，支持农历、节日、节气和提醒等功能。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9eefb0b7bfb64796bd47978e8327e256~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=6SK5BnM7%2BY5eU%2F%2BleIGJmIftHBM%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-18">Python 项目</h3>
<p>23、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2Fzauberzeug%2Fnicegui" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/zauberzeug/nicegui" ref="nofollow noopener noreferrer">nicegui</a>：简单易用的 Python UI 框架。该项目是基于 Python 的用户界面框架，支持纯 Python 开发 Web 或桌面应用。只需几行代码，即可生成按钮、图表、3D 场景等 50 多种组件，解决了传统 Python GUI 跨平台麻烦、前端开发门槛高等问题。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54285ed0273740799f49fe1b004509a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=kKtM1JzMgfZ6Cmtp5Qf3FDIn82M%3D" alt="" loading="lazy"/></p>
<p>24、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2FAstrBotDevs%2FAstrBot" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/AstrBotDevs/AstrBot" ref="nofollow noopener noreferrer">AstrBot</a>：易上手的多平台 LLM 聊天机器人。该项目是基于 Python 构建的 LLM 聊天机器人及开发框架，支持集成多种消息平台和大语言模型。它提供了可视化管理面板和灵活的插件扩展机制，支持速率限制、白名单、关键词过滤、图片理解和语音转文字等功能。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c7be02aaadd42068e9a20fb338f2a3b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=7%2F1PfneO9irgOCgmB71VA0xXaQM%3D" alt="" loading="lazy"/></p>
<p>25、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2Fdabeaz-course%2Fpython-mastery" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/dabeaz-course/python-mastery" ref="nofollow noopener noreferrer">python-mastery</a>：高级 Python 编程教程。该项目是由 Python 社区知名专家、《Python Cookbook》作者 David Beazley 编写的高级 Python 编程课程，内容完全开源，涵盖生成器、协程、元编程、模块与包等，适合有一定 Python 基础的学习者。</p>
<h3 data-id="heading-19">Rust 项目</h3>
<p>26、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2Feythaann%2FSeelen-UI" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/eythaann/Seelen-UI" ref="nofollow noopener noreferrer">Seelen-UI</a>：高度可定制的 Windows 桌面美化工具。这是一款免费开源的 Windows 桌面增强工具，专注于高度自定义和效率提升。它采用 Rust 语言开发，结合 Tauri 框架与 Web 技术，支持窗口平铺管理、应用启动器、Dock、任务栏、动态壁纸、插件扩展等功能。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9cf3c098a0de499ea460f8d3567d14a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=146TQH%2FN2m7ziVGlX0ih22cb3iQ%3D" alt="" loading="lazy"/></p>
<p>27、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2Frustfs%2Frustfs" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/rustfs/rustfs" ref="nofollow noopener noreferrer">rustfs</a>：基于 Rust 的高性能分布式存储系统。该项是用 Rust 构建的高性能分布式对象存储系统，致力于成为 MinIO 的开源替代品。它安装简单、兼容 S3 协议，采用更友好的开源协议，并内置界面清爽的 Web 管理后台。同时，支持国产保密设备和系统，适用于海量数据存储、大数据、互联网、工业和保密存储等场景。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/feedcc7777ad476a89c12f3a0ae82bb4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=6pZnSCgu0%2FMVDgVDx7piebQ6hSI%3D" alt="" loading="lazy"/></p>
<p>28、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2Fhanshuaikang%2FNping" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/hanshuaikang/Nping" ref="nofollow noopener noreferrer">Nping</a>：Rust 的多地址并发 Ping 工具。这是一个用 Rust 开发的可视化 Ping 工具，支持同时对多个目标地址并发 Ping 操作。它提供了分区折线图和表格视图等可视化展示，支持实时动态展示延迟、丢包率等性能指标，同时兼容 IPv4 和 IPv6 网络环境。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9dc50ecba1e4239bb0241fc23029a0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=1%2BMKb5Ft4Xez6N1M3ACYcTMczcY%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-20">人工智能</h3>
<p>29、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2Fcodexu%2Fnote-gen" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/codexu/note-gen" ref="nofollow noopener noreferrer">note-gen</a>：基于 AI 的 Markdown 笔记应用。这是一款跨平台的 Markdown 笔记应用，专注于用 AI 搭建“记录-写作”的桥梁。它不仅支持截图、文本、插图等多种记录方式，还能通过 AI 模型将这些碎片化内容整理成可读的笔记。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89c2ff6520654bcab5342b32ab12baa8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=HoZl7WhW2CXonQAw27O6vIx%2Fe6Q%3D" alt="" loading="lazy"/></p>
<p>30、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2FKlingTeam%2FLivePortrait" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/KlingTeam/LivePortrait" ref="nofollow noopener noreferrer">LivePortrait</a>：让静态照片“活”起来。该项目能够通过一张照片快速生成高质量、生动的视频，尤其擅长捕捉和还原面部表情，支持人类和动物肖像的动画生成。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/befef291f89241e5ac0586c6772c3d64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=JQFtkWNM8dFImphwTjM9igD4M8M%3D" alt="" loading="lazy"/></p>
<p>31、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2FSwanHubX%2FSwanLab" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/SwanHubX/SwanLab" ref="nofollow noopener noreferrer">SwanLab</a>：AI 模型训练跟踪与可观测平台。这是一款专为 AI 模型训练打造的跟踪、记录、分析与协作工具，旨在帮助研究者优化训练过程，提升团队协作效率。它通过简洁的 Python API 和直观的界面，提供了训练可视化、自动日志记录、硬件监控、实验管理和多人协同等功能。已集成 40+ 主流训练框架，适用于大模型训练、计算机视觉、音频处理、AIGC 等任务场景。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd507c9ea3734888838c6cfd6fd4c805~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=dPEDpeGYO0j3hRQ7C4ZHa9W%2BImQ%3D" alt="" loading="lazy"/></p>
<p>32、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2Flinshenkx%2Fprompt-optimizer" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/linshenkx/prompt-optimizer" ref="nofollow noopener noreferrer">prompt-optimizer</a>：优化 AI 提示词的工具。这是一款纯前端实现的提示词优化器，帮助用户快速编写更高质量的提示词。支持多种主流 AI 模型与自定义 API 地址，并可实时对比优化前后的效果。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc11b353e9cb43cf801bc62b8ed56ab1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=6CMhNN2HsmavOVZ7p7fM4aK810I%3D" alt="" loading="lazy"/></p>
<p>33、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2Fnndeploy%2Fnndeploy" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/nndeploy/nndeploy" ref="nofollow noopener noreferrer">nndeploy</a>：简单易用的多端 AI 推理部署框架。这是一款简单易用、高性能、支持多端的 AI 推理部署框架。它基于有向无环图设计，将前处理、推理和后处理抽象为图的节点，支持流水线并行、任务并行等优化方式。兼容 TensorRT、OpenVINO、MNN 等多种推理后端，适配主流文生图、大语言、检测等模型，实现一套代码多端部署。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e97b280b99e74b8da5eb0aabaf5c675a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=bxRvQMB0iNOl59qA4ai4%2BwMXD1o%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-21">书籍/教程</h3>
<p>34、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2FZJU-LLMs%2FFoundations-of-LLMs" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/ZJU-LLMs/Foundations-of-LLMs" ref="nofollow noopener noreferrer">Foundations-of-LLMs</a>：《大模型基础》。该书是由浙江大学 DAILY 实验室开源的大语言模型教材，内容涵盖传统语言模型、大语言模型架构演化、Prompt 工程、参数高效微调、模型编辑、检索增强生成等方面。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72269b71ad324abb92cb86995e422d5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=tCmjzb1KILb%2FD5LcbJU9NGlY5Cc%3D" alt="" loading="lazy"/></p>
<p>35、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2Fhzpt-inet-club%2Fenglish-note" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/hzpt-inet-club/english-note" ref="nofollow noopener noreferrer">english-note</a>：《从零开始学习英语语法》。这是一本面向英语基础薄弱同学的英语语法入门书籍，内容言简意赅、插图幽默风趣。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0254fa117c54910915ac6c424957564~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=VRw5eUmlGWgALkM%2FzuqLabZuLuk%3D" alt="" loading="lazy"/></p>
<p>36、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2Fmicrosoft%2Fai-agents-for-beginners" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/microsoft/ai-agents-for-beginners" ref="nofollow noopener noreferrer">ai-agents-for-beginners</a>：微软开源的 AI Agent 初学者教程。该项目是微软专为初学者打造的 AI 智能体（Agents）教程，内容分为 10 个课程，包含详细的教程、视频和示例代码。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d4a5691ea614e1c9d5031ac34d90bcd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=8xzB9VGSuYHac8tq1rZe1NL9O6g%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-22">其它</h3>
<p>37、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2FCircuit-Digest%2FESP-Drone" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/Circuit-Digest/ESP-Drone" ref="nofollow noopener noreferrer">ESP-Drone</a>：低成本的开源无人机。这是一个基于 ESP32 的开源无人机项目，帮你制作一款低成本、可手机控制的小型无人机。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/459f85cf2c31447aaf7bcb2799ee2247~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=hGlGN5OCBTEfynU9TTL6yY1Qlvs%3D" alt="" loading="lazy"/></p>
<p>38、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2FGar-b-age%2FCookLikeHOC" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/Gar-b-age/CookLikeHOC" ref="nofollow noopener noreferrer">CookLikeHOC</a>：老乡鸡菜谱开源版。该项目非老乡鸡官方出品，是作者基于《老乡鸡菜品溯源报告》等资料，归纳、整理了老乡鸡菜品的配方、制作流程及烹饪要点。</p>
<p>39、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2FSuperManito%2FLinuxMirrors" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/SuperManito/LinuxMirrors" ref="nofollow noopener noreferrer">LinuxMirrors</a>：一键搞定 Linux 换源问题的脚本。该项目提供了一键切换 Linux 默认软件源为国内镜像源的脚本，以及 Docker 安装脚本，支持 Debian、Ubuntu、CentOS、Raspberry Pi OS 和 Deepin 等多种主流发行版。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ca0e81585334276a102aa4eaab98b0d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=Kpo4hBmSE8t8MbgYih0uZU%2BEskM%3D" alt="" loading="lazy"/></p>
<p>40、<a href="https://link.juejin.cn?target=https%3A%2F%2Fhellogithub.com%2Fperiodical%2Fstatistics%2Fclick%3Ftarget%3Dhttps%3A%2F%2Fgithub.com%2Flucide-icons%2Flucide" target="_blank" title="https://hellogithub.com/periodical/statistics/click?target=https://github.com/lucide-icons/lucide" ref="nofollow noopener noreferrer">lucide</a>：精美的开源图标库。该项目是由社区驱动的开源图标库，提供 1000+ 高质量的 SVG 图标，支持 React、Vue、Svelte、React Native 等主流前端框架，以及 Figma 插件，方便开发者和设计师使用。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97f1bbbf18704331a8f64d5928d14836~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=RZZ0dovGGpZgu%2FmFmj0%2BD7wGQt8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-23">三、最后</h2>
<p>过去的一年，HelloGitHub 分享了 588 个开源项目，其中来自用户的分享为 160 个（占比 27.2%）。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d94ae0b4a190456cadd2e6af8c30cfd6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771288425&amp;x-signature=K4JFM9CdBM3nXt3RP%2F7JNcuLVMY%3D" alt="" loading="lazy"/></p>
<p>感谢每一位来 HelloGitHub 分享和推荐开源项目的小伙伴。<strong>你们不只是读者，更是这份月刊的共创者！</strong></p>
<p>新的一年，HelloGitHub 会努力接触更多的开源作者，分享开源项目背后的故事，并帮助真正热爱开源的小伙伴，开启他们的开源之旅。</p>
<p>最后，感谢大家过去一年的陪伴和支持。HelloGitHub 在这里提前祝大家春节快乐、马年行大运，我们年后见～</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[分布式锁详解：基于 Redis 与 MySQL 的实现方案（2026 实战指南）]]></title>    <link>https://juejin.cn/post/7604671453453320207</link>    <guid>https://juejin.cn/post/7604671453453320207</guid>    <pubDate>2026-02-10T00:42:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604671453453320207" data-draft-id="7604685644684574772" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="分布式锁详解：基于 Redis 与 MySQL 的实现方案（2026 实战指南）"/> <meta itemprop="keywords" content="分布式"/> <meta itemprop="datePublished" content="2026-02-10T00:42:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            分布式锁详解：基于 Redis 与 MySQL 的实现方案（2026 实战指南）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T00:42:21.000Z" title="Tue Feb 10 2026 00:42:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>适用读者</strong>：后端开发工程师、系统架构师<br/>
<strong>前置知识</strong>：Redis 基础、MySQL 事务、并发编程<br/>
<strong>更新日期</strong>：2026 年 2 月</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">一、什么是分布式锁？</h2>
<p>在单机应用中，我们使用 <code>synchronized</code>、<code>ReentrantLock</code> 等机制保证线程安全。但在<strong>分布式系统</strong>中，多个服务实例部署在不同机器上，JVM 锁无法跨进程生效。</p>
<p><strong>分布式锁</strong>就是为了解决这一问题而生的——它是一种<strong>跨进程、跨机器的互斥机制</strong>，确保同一时刻只有一个客户端能执行某段关键代码。</p>
<h3 data-id="heading-1">🎯 核心要求</h3>
<ol>
<li><strong>互斥性</strong>：同一时间只能有一个客户端持有锁</li>
<li><strong>高可用</strong>：锁服务不能成为单点故障</li>
<li><strong>防死锁</strong>：客户端崩溃后锁能自动释放</li>
<li><strong>可重入性</strong>（可选）：同一线程可重复获取锁</li>
<li><strong>高性能</strong>：加锁/解锁延迟低</li>
</ol>
<hr/>
<h2 data-id="heading-2">二、为什么不用数据库行锁或 Redis 单命令？</h2>
<ul>
<li><strong>MySQL 行锁</strong>：仅限于事务内，无法跨事务持有</li>
<li><strong>Redis SETNX</strong>：看似简单，但存在<strong>原子性缺失</strong>和<strong>死锁风险</strong></li>
</ul>
<blockquote>
<p>✅ 正确的分布式锁必须满足 <strong>“加锁 + 设置过期时间” 原子操作</strong>！</p>
</blockquote>
<hr/>
<h2 data-id="heading-3">三、方案一：基于 Redis 的分布式锁（推荐）</h2>
<p>Redis 因其<strong>高性能、原子操作支持</strong>，成为分布式锁的首选方案。</p>
<h3 data-id="heading-4">3.1 基础实现（SET 命令）</h3>
<p>Redis 2.6.12+ 支持 <code>SET key value [EX seconds] [PX milliseconds] [NX|XX]</code>，可<strong>原子地</strong>设置值并加过期时间。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> redis
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> uuid

<span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisDistributedLock</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, redis_client, lock_key, expire_time=<span class="hljs-number">30</span></span>):
        self.redis = redis_client
        self.lock_key = lock_key
        self.expire_time = expire_time  <span class="hljs-comment"># 锁自动过期时间（秒）</span>
        self.lock_value = <span class="hljs-built_in">str</span>(uuid.uuid4())  <span class="hljs-comment"># 唯一标识，用于防止误删</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">acquire</span>(<span class="hljs-params">self, timeout=<span class="hljs-number">10</span></span>):
        <span class="hljs-string">"""
        获取锁
        :param timeout: 尝试获取锁的最长时间（秒）
        :return: True/False
        """</span>
        start_time = time.time()
        <span class="hljs-keyword">while</span> time.time() - start_time &lt; timeout:
            <span class="hljs-comment"># 原子操作：仅当 key 不存在时设置，并设置过期时间</span>
            <span class="hljs-keyword">if</span> self.redis.<span class="hljs-built_in">set</span>(
                self.lock_key,
                self.lock_value,
                ex=self.expire_time,  <span class="hljs-comment"># 自动过期，防止死锁</span>
                nx=<span class="hljs-literal">True</span>               <span class="hljs-comment"># 仅当 key 不存在时设置</span>
            ):
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
            time.sleep(<span class="hljs-number">0.01</span>)  <span class="hljs-comment"># 避免 busy-wait</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">release</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""释放锁"""</span>
        <span class="hljs-comment"># 使用 Lua 脚本保证“判断 + 删除”原子性</span>
        lua_script = <span class="hljs-string">"""
        if redis.call("get", KEYS[1]) == ARGV[1] then
            return redis.call("del", KEYS[1])
        else
            return 0
        end
        """</span>
        self.redis.<span class="hljs-built_in">eval</span>(lua_script, <span class="hljs-number">1</span>, self.lock_key, self.lock_value)
</code></pre>
<h3 data-id="heading-5">3.2 关键设计解析</h3>
<h4 data-id="heading-6">✅ 为什么用 UUID 作为 value？</h4>
<ul>
<li>防止 A 客户端误删 B 客户端的锁</li>
<li>释放锁前必须校验 value 是否匹配</li>
</ul>
<h4 data-id="heading-7">✅ 为什么用 Lua 脚本释放锁？</h4>
<ul>
<li><code>GET + DEL</code> 不是原子操作！</li>
<li>若 GET 后发生网络延迟，其他客户端可能已获取新锁，此时 DEL 会误删</li>
</ul>
<h4 data-id="heading-8">✅ 过期时间如何设置？</h4>
<ul>
<li><strong>太短</strong>：业务未执行完锁已释放 → 失去互斥性</li>
<li><strong>太长</strong>：客户端崩溃后需等待很久 → 可用性下降</li>
<li><strong>建议</strong>：<code>expire_time = 业务最大执行时间 × 2</code></li>
</ul>
<h3 data-id="heading-9">3.3 高级优化：Redlock 算法（防 Redis 单点故障）</h3>
<p>当 Redis 是单节点时，若主节点宕机且未持久化，可能丢失锁信息。</p>
<p><strong>Redlock</strong>（Redis 官方推荐）通过多数派机制解决：</p>
<ol>
<li>向 N 个独立 Redis 节点（通常 N=5）请求加锁</li>
<li>只有<strong>超过半数</strong>（≥3）成功，且总耗时 &lt; 锁过期时间，才算获取锁</li>
<li>释放锁时向所有节点发送 DEL</li>
</ol>
<blockquote>
<p>⚠️ <strong>争议</strong>：Martin Kleppmann 认为 Redlock 在时钟漂移下仍不安全。<br/>
✅ <strong>实践建议</strong>：对一致性要求极高场景，改用 ZooKeeper；否则单 Redis + 持久化足够。</p>
</blockquote>
<hr/>
<h2 data-id="heading-10">四、方案二：基于 MySQL 的分布式锁</h2>
<p>MySQL 方案适用于<strong>已有数据库、不想引入 Redis</strong>的场景，但性能较低。</p>
<h3 data-id="heading-11">4.1 表结构设计</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> distributed_lock (
    lock_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">PRIMARY</span> KEY,
    token <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,      <span class="hljs-comment">-- 锁持有者标识</span>
    expire_time <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,      <span class="hljs-comment">-- 过期时间戳（毫秒）</span>
    update_time <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>
) ENGINE<span class="hljs-operator">=</span>InnoDB;
</code></pre>
<h3 data-id="heading-12">4.2 加锁逻辑（利用唯一索引 + INSERT）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pymysql
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> uuid

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MysqlDistributedLock</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, db_conn, lock_name, expire_time=<span class="hljs-number">30</span></span>):
        self.conn = db_conn
        self.lock_name = lock_name
        self.expire_time = expire_time
        self.token = <span class="hljs-built_in">str</span>(uuid.uuid4())

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">acquire</span>(<span class="hljs-params">self, timeout=<span class="hljs-number">10</span></span>):
        <span class="hljs-string">"""获取锁"""</span>
        start_time = time.time()
        cursor = self.conn.cursor()
        
        <span class="hljs-keyword">while</span> time.time() - start_time &lt; timeout:
            <span class="hljs-keyword">try</span>:
                <span class="hljs-comment"># 先清理过期锁</span>
                self._clean_expired_locks(cursor)
                
                <span class="hljs-comment"># 尝试插入新锁（唯一索引保证互斥）</span>
                expire_timestamp = <span class="hljs-built_in">int</span>(time.time() * <span class="hljs-number">1000</span>) + self.expire_time * <span class="hljs-number">1000</span>
                cursor.execute(
                    <span class="hljs-string">"INSERT INTO distributed_lock (lock_name, token, expire_time) VALUES (%s, %s, %s)"</span>,
                    (self.lock_name, self.token, expire_timestamp)
                )
                self.conn.commit()
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
                
            <span class="hljs-keyword">except</span> pymysql.IntegrityError:
                <span class="hljs-comment"># 唯一索引冲突，说明锁已被占用</span>
                self.conn.rollback()
                time.sleep(<span class="hljs-number">0.05</span>)
                
            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                self.conn.rollback()
                <span class="hljs-keyword">raise</span> e
                
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">release</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""释放锁"""</span>
        cursor = self.conn.cursor()
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># 仅删除自己的锁</span>
            cursor.execute(
                <span class="hljs-string">"DELETE FROM distributed_lock WHERE lock_name = %s AND token = %s"</span>,
                (self.lock_name, self.token)
            )
            self.conn.commit()
        <span class="hljs-keyword">finally</span>:
            cursor.close()

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_clean_expired_locks</span>(<span class="hljs-params">self, cursor</span>):
        <span class="hljs-string">"""清理过期锁"""</span>
        current_time = <span class="hljs-built_in">int</span>(time.time() * <span class="hljs-number">1000</span>)
        cursor.execute(
            <span class="hljs-string">"DELETE FROM distributed_lock WHERE expire_time &lt; %s"</span>,
            (current_time,)
        )
</code></pre>
<h3 data-id="heading-13">4.3 关键设计解析</h3>
<h4 data-id="heading-14">✅ 为什么用 INSERT 而不是 SELECT + UPDATE？</h4>
<ul>
<li><code>SELECT ... FOR UPDATE</code> 需要事务持有到业务结束，长时间阻塞其他事务</li>
<li><code>INSERT</code> 利用<strong>唯一索引冲突</strong>天然实现互斥，无锁竞争</li>
</ul>
<h4 data-id="heading-15">✅ 为什么需要定期清理过期锁？</h4>
<ul>
<li>客户端崩溃后不会主动释放锁</li>
<li>下次加锁前清理，避免“僵尸锁”占用资源</li>
</ul>
<h4 data-id="heading-16">⚠️ 性能瓶颈</h4>
<ul>
<li>每次加锁需 1~2 次 SQL 查询</li>
<li>高并发下数据库压力大</li>
<li><strong>建议 QPS &lt; 1000</strong> 的场景使用</li>
</ul>
<hr/>
<h2 data-id="heading-17">五、Redis vs MySQL 方案对比</h2>








































<table><thead><tr><th>特性</th><th>Redis 方案</th><th>MySQL 方案</th></tr></thead><tbody><tr><td><strong>性能</strong></td><td>极高（微秒级）</td><td>较低（毫秒级）</td></tr><tr><td><strong>可靠性</strong></td><td>依赖 Redis 持久化</td><td>依赖数据库事务</td></tr><tr><td><strong>实现复杂度</strong></td><td>中等（需 Lua 脚本）</td><td>简单</td></tr><tr><td><strong>适用场景</strong></td><td>高并发、低延迟</td><td>低频、已有 DB</td></tr><tr><td><strong>死锁防护</strong></td><td>自动过期 + 唯一 value</td><td>自动过期 + 清理任务</td></tr><tr><td><strong>扩展性</strong></td><td>支持 Redlock 集群</td><td>难以水平扩展</td></tr></tbody></table>
<blockquote>
<p>✅ <strong>选择建议</strong>：</p>
<ul>
<li>90% 场景选 <strong>Redis</strong></li>
<li>无 Redis 且并发低 → 选 <strong>MySQL</strong></li>
<li>金融级强一致 → 考虑 <strong>ZooKeeper / etcd</strong></li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-18">六、常见陷阱与解决方案</h2>
<h3 data-id="heading-19">❌ 陷阱 1：锁过期但业务未完成</h3>
<p><strong>现象</strong>：锁自动释放后，其他客户端进入临界区，导致数据错乱<br/>
<strong>解决方案</strong>：</p>
<ul>
<li>
<p>启用 <strong>锁续期机制</strong>（Watchdog 线程定期延长过期时间）</p>
</li>
<li>
<p>示例（Redisson 的看门狗）：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// Redisson 自动每 10s 续期一次（只要线程 alive）</span>
RLock <span class="hljs-keyword">lock</span> = redisson.getLock(<span class="hljs-string">"myLock"</span>);
<span class="hljs-keyword">lock</span>.<span class="hljs-keyword">lock</span>(<span class="hljs-number">30</span>, TimeUnit.SECONDS); <span class="hljs-comment">// 30s 过期，但会自动续期</span>
</code></pre>
</li>
</ul>
<h3 data-id="heading-20">❌ 陷阱 2：主从切换导致锁丢失（Redis）</h3>
<p><strong>现象</strong>：主节点加锁后未同步到从节点，主挂后从升主，锁消失<br/>
<strong>解决方案</strong>：</p>
<ul>
<li>使用 <strong>Redlock</strong>（多节点）</li>
<li>或接受<strong>最终一致性</strong>，业务层做幂等处理</li>
</ul>
<h3 data-id="heading-21">❌ 陷阱 3：MySQL 主从延迟</h3>
<p><strong>现象</strong>：写主库后立即读从库，可能读不到锁记录<br/>
<strong>解决方案</strong>：</p>
<ul>
<li><strong>强制读主库</strong></li>
<li>或使用 <strong>单库单表</strong>，避免主从架构</li>
</ul>
<hr/>
<h2 data-id="heading-22">七、生产环境最佳实践</h2>
<ol>
<li>
<p><strong>设置合理的超时时间</strong></p>
<ul>
<li>监控业务平均耗时，设置 <code>expire_time = P99 × 2</code></li>
</ul>
</li>
<li>
<p><strong>加锁必须带超时</strong></p>
<ul>
<li>避免无限等待导致线程池耗尽</li>
</ul>
</li>
<li>
<p><strong>finally 块中释放锁</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">lock</span> = RedisDistributedLock(redis, <span class="hljs-string">"order_lock"</span>)
<span class="hljs-keyword">try</span>:
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">lock</span>.acquire():
        <span class="hljs-meta"># 业务逻辑</span>
<span class="hljs-keyword">finally</span>:
    <span class="hljs-keyword">lock</span>.release()
</code></pre>
</li>
<li>
<p><strong>监控锁竞争情况</strong></p>
<ul>
<li>记录加锁失败率、持有时间</li>
<li>告警异常长时间持锁</li>
</ul>
</li>
<li>
<p><strong>避免锁粒度太粗</strong></p>
<ul>
<li>例：不要用 <code>"order_lock"</code>，改用 <code>"order_lock_{user_id}"</code></li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-23">八、总结</h2>























<table><thead><tr><th>方案</th><th>核心命令/操作</th><th>优势</th><th>劣势</th></tr></thead><tbody><tr><td><strong>Redis</strong></td><td><code>SET key value EX nx</code> + Lua 脚本</td><td>高性能、原子性好</td><td>需维护 Redis 服务</td></tr><tr><td><strong>MySQL</strong></td><td><code>INSERT</code> 唯一索引 + 过期清理</td><td>无需新组件、ACID 保证</td><td>性能低、扩展难</td></tr></tbody></table>
<blockquote>
<p>💬 <strong>最后忠告</strong>：<br/>
<strong>“分布式锁是最后的手段！优先考虑无锁设计（如 CAS、消息队列）。”</strong><br/>
当你真的需要它时，请务必理解上述细节，避免踩坑。</p>
</blockquote>
<hr/>
<p><strong>参考文献</strong>：</p>
<ul>
<li>Redis 官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fredis.io%2Ftopics%2Fdistlock" target="_blank" title="https://redis.io/topics/distlock" ref="nofollow noopener noreferrer">Distributed locks with Redis</a></li>
<li>Martin Kleppmann: <a href="https://link.juejin.cn?target=https%3A%2F%2Fmartin.kleppmann.com%2F2016%2F02%2F08%2Fhow-to-do-distributed-locking.html" target="_blank" title="https://martin.kleppmann.com/2016/02/08/how-to-do-distributed-locking.html" ref="nofollow noopener noreferrer">How to do distributed locking</a></li>
<li>《Redis 设计与实现》黄健宏</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[第15章、标准库精讲（一）——fmt、os、io、bufio]]></title>    <link>https://juejin.cn/post/7604665952320602163</link>    <guid>https://juejin.cn/post/7604665952320602163</guid>    <pubDate>2026-02-10T00:43:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604665952320602163" data-draft-id="7604665952320536627" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="第15章、标准库精讲（一）——fmt、os、io、bufio"/> <meta itemprop="keywords" content="后端,Go,编程语言"/> <meta itemprop="datePublished" content="2026-02-10T00:43:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="怕浪猫"/> <meta itemprop="url" content="https://juejin.cn/user/2832784963939438"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            第15章、标准库精讲（一）——fmt、os、io、bufio
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2832784963939438/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    怕浪猫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T00:43:01.000Z" title="Tue Feb 10 2026 00:43:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读25分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Golang的强大之处，不仅在于其简洁的语法、高效的并发模型，更在于其内置的<strong>标准库（Standard Library）</strong>——无需额外安装依赖，就能实现格式化输出、文件操作、输入输出、缓冲读写等绝大多数基础开发需求。</p>
<p>本章作为标准库精讲的第一篇，聚焦最常用、最基础的4个标准库：<strong>fmt（格式化输入输出）、os（环境与文件基础）、io（输入输出接口）、bufio（缓冲读写）</strong>。全程遵循“核心用法+极简代码示例+避坑重点+参考链接”的掘金写作逻辑，每个代码示例控制在10行以内（可直接复制运行），不堆砌冗余内容，直击实战痛点，帮你快速掌握这4个标准库的核心用法，轻松应对日常开发场景。</p>
<h2 data-id="heading-0">一、fmt格式化（fmt包）</h2>
<p>fmt包是Go开发中最基础、最常用的标准库，核心作用是<strong>格式化输入（从终端读取输入）和格式化输出（向终端打印内容）</strong>，无需额外依赖，导入即可使用。其核心优势是语法简洁、功能全面，能满足字符串、数字、结构体等各种类型的格式化需求。</p>
<p>核心逻辑：通过“格式化动词”（如%s、%d）指定输出/输入的格式，适配不同数据类型，类比Python的print格式化、C语言的printf。</p>
<h3 data-id="heading-1">1.1 核心格式化输出（高频用法）</h3>
<p>格式化输出是fmt包的核心场景，常用函数有3个：<code>fmt.Print()</code>（无换行）、<code>fmt.Println()</code>（自动换行）、<code>fmt.Printf()</code>（自定义格式化，最常用）。重点掌握<code>fmt.Printf()</code>的格式化动词。</p>
<h4 data-id="heading-2">1.1.1 常用格式化动词（表格梳理，好记好用）</h4>













































<table><thead><tr><th><strong>格式化动词</strong></th><th><strong>适用类型</strong></th><th><strong>说明+极简示例</strong></th></tr></thead><tbody><tr><td>%s</td><td>字符串、字节切片</td><td>输出字符串，示例：<code>fmt.Printf("姓名：%s\n", "张三")</code> → 姓名：张三</td></tr><tr><td>%d</td><td>整数（int、int64等）</td><td>输出十进制整数，示例：<code>fmt.Printf("年龄：%d\n", 25)</code> → 年龄：25</td></tr><tr><td>%f</td><td>浮点数（float32、float64）</td><td>输出浮点数，默认6位小数，示例：<code>fmt.Printf("分数：%f\n", 95.5)</code> → 分数：95.500000</td></tr><tr><td>%.2f</td><td>浮点数</td><td>指定保留2位小数，示例：<code>fmt.Printf("分数：%.2f\n", 95.5)</code> → 分数：95.50</td></tr><tr><td>%v</td><td>任意类型</td><td>自动适配类型，简化写法，示例：<code>fmt.Printf("任意值：%v\n", 3.14)</code> → 任意值：3.14</td></tr><tr><td>%+v</td><td>结构体</td><td>输出结构体字段名+值，示例见下方代码</td></tr><tr><td>%t</td><td>布尔值（bool）</td><td>输出true/false，示例：<code>fmt.Printf("是否成年：%t\n", true)</code> → 是否成年：true</td></tr></tbody></table>
<h4 data-id="heading-3">1.1.2 极简代码示例（覆盖高频场景）</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// 定义结构体，测试结构体格式化</span>
<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    Name <span class="hljs-type">string</span>
    Age  <span class="hljs-type">int</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. fmt.Print（无换行）</span>
    fmt.Print(<span class="hljs-string">"Hello "</span>)
    fmt.Print(<span class="hljs-string">"Go\n"</span>)

    <span class="hljs-comment">// 2. fmt.Println（自动换行）</span>
    fmt.Println(<span class="hljs-string">"fmt.Println 自动换行"</span>)

    <span class="hljs-comment">// 3. fmt.Printf（自定义格式化，最常用）</span>
    name := <span class="hljs-string">"张三"</span>
    age := <span class="hljs-number">25</span>
    score := <span class="hljs-number">98.5</span>
    user := User{Name: name, Age: age}

    fmt.Printf(<span class="hljs-string">"姓名：%s，年龄：%d\n"</span>, name, age)   <span class="hljs-comment">// 字符串+整数</span>
    fmt.Printf(<span class="hljs-string">"分数：%.1f\n"</span>, score)             <span class="hljs-comment">// 浮点数保留1位小数</span>
    fmt.Printf(<span class="hljs-string">"用户信息：%v\n"</span>, user)            <span class="hljs-comment">// 结构体简化输出</span>
    fmt.Printf(<span class="hljs-string">"用户详细信息：%+v\n"</span>, user)       <span class="hljs-comment">// 结构体带字段名输出</span>
}
</code></pre>
<p>运行结果（清晰直观，贴合实战）：</p>
<pre><code class="hljs language-bash" lang="bash">Hello Go
fmt.Println 自动换行
姓名：张三，年龄：25
分数：98.5
用户信息：{张三 25}
用户详细信息：{Name:张三 Age:25}
</code></pre>
<h3 data-id="heading-4">1.2 格式化输入（补充用法）</h3>
<p>格式化输入主要用于从终端读取用户输入，常用函数：<code>fmt.Scan()</code>（读取简单类型）、<code>fmt.Scanf()</code>（按格式读取）、<code>fmt.Scanln()</code>（读取一行，自动忽略换行）。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> name <span class="hljs-type">string</span>
    <span class="hljs-keyword">var</span> age <span class="hljs-type">int</span>

    <span class="hljs-comment">// 1. fmt.Scan：读取输入，空格分隔</span>
    fmt.Print(<span class="hljs-string">"请输入姓名和年龄（空格分隔）："</span>)
    fmt.Scan(&amp;name, &amp;age) <span class="hljs-comment">// 注意：变量需传指针</span>
    fmt.Printf(<span class="hljs-string">"你输入的是：%s，%d岁\n"</span>, name, age)

    <span class="hljs-comment">// 2. fmt.Scanf：按格式读取</span>
    <span class="hljs-keyword">var</span> score <span class="hljs-type">float64</span>
    fmt.Print(<span class="hljs-string">"请输入分数（格式：数字）："</span>)
    fmt.Scanf(<span class="hljs-string">"%.2f"</span>, &amp;score)
    fmt.Printf(<span class="hljs-string">"分数：%.2f\n"</span>, score)
}
</code></pre>
<h3 data-id="heading-5">1.3 避坑重点（掘金读者高频踩坑）</h3>
<ul>
<li>
<p>格式化动词与数据类型必须匹配：如用%s接收整数、%d接收字符串，会导致输出异常（无报错，但结果错乱）；</p>
</li>
<li>
<p>fmt.Scan系列函数需传指针：如<code>fmt.Scan(name)</code>（错误），必须写<code>fmt.Scan(&amp;name)</code>（正确），否则无法修改变量值；</p>
</li>
<li>
<p>浮点数格式化：%f默认保留6位小数，如需保留指定位数，用%.nf（n为保留小数位数），避免冗余小数。</p>
</li>
</ul>
<h3 data-id="heading-6">1.4 参考链接</h3>
<ul>
<li>Go官方文档（fmt包）：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fpkg%2Ffmt%2F" target="_blank" title="https://go.dev/pkg/fmt/" ref="nofollow noopener noreferrer">fmt package - fmt</a></li>
</ul>
<h2 data-id="heading-7">二、os环境（os包）</h2>
<p>os包提供了<strong>与操作系统交互</strong>的核心功能，涵盖环境变量操作、命令行参数读取、系统信息获取、进程控制等基础场景，是Go开发中“适配不同运行环境”的核心工具，用法简洁，无需复杂封装。</p>
<p>核心重点：环境变量（开发/测试/生产环境区分）、命令行参数（脚本开发常用），这两个是日常开发中最高频的用法，优先掌握。</p>
<h3 data-id="heading-8">2.1 环境变量操作（高频）</h3>
<p>环境变量（Environment Variable）用于存储操作系统或应用的配置信息（如数据库地址、端口号、密钥），通过os包可实现“读取、设置、列出”环境变量，适配不同运行环境（如开发环境和生产环境用不同的数据库地址）。</p>
<p>核心函数：<code>os.Getenv()</code>（读取环境变量）、<code>os.Setenv()</code>（设置环境变量）、<code>os.Environ()</code>（列出所有环境变量）。</p>
<h4 data-id="heading-9">2.1.1 极简代码示例</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"os"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 读取环境变量（最常用）</span>
    <span class="hljs-comment">// 读取系统默认环境变量（如PATH），或自定义环境变量</span>
    path := os.Getenv(<span class="hljs-string">"PATH"</span>)
    fmt.Printf(<span class="hljs-string">"系统PATH：%s\n"</span>, path[:<span class="hljs-number">50</span>]) <span class="hljs-comment">// 截取前50字符，避免输出过长</span>

    <span class="hljs-comment">// 读取自定义环境变量，不存在则返回空字符串</span>
    dbHost := os.Getenv(<span class="hljs-string">"DB_HOST"</span>)
    <span class="hljs-keyword">if</span> dbHost == <span class="hljs-string">""</span> {
        dbHost = <span class="hljs-string">"localhost"</span> <span class="hljs-comment">// 兜底默认值，避坑关键</span>
    }
    fmt.Printf(<span class="hljs-string">"数据库地址：%s\n"</span>, dbHost)

    <span class="hljs-comment">// 2. 设置环境变量（仅当前进程有效，进程结束后失效）</span>
    os.Setenv(<span class="hljs-string">"DB_PORT"</span>, <span class="hljs-string">"3306"</span>)
    fmt.Printf(<span class="hljs-string">"数据库端口：%s\n"</span>, os.Getenv(<span class="hljs-string">"DB_PORT"</span>))

    <span class="hljs-comment">// 3. 列出所有环境变量（返回切片，包含所有环境变量键值对）</span>
    envs := os.Environ()
    fmt.Printf(<span class="hljs-string">"前3个环境变量：%v\n"</span>, envs[:<span class="hljs-number">3</span>])
}
</code></pre>
<h3 data-id="heading-10">2.2 命令行参数读取（脚本开发常用）</h3>
<p>当我们开发命令行工具（如脚本、离线工具）时，常需要通过命令行传入参数（如<code>go run main.go --name 张三</code>），os包的<code>os.Args</code>切片可直接获取所有命令行参数。</p>
<p>核心逻辑：<code>os.Args</code>是一个string切片，第一个元素（os.Args[0]）是程序本身的路径，从第二个元素（os.Args[1]）开始，是传入的命令行参数。</p>
<h4 data-id="heading-11">2.2.1 极简代码示例</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"os"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// os.Args 获取所有命令行参数</span>
    fmt.Printf(<span class="hljs-string">"所有命令行参数：%v\n"</span>, os.Args)
    fmt.Printf(<span class="hljs-string">"参数个数：%d\n"</span>, <span class="hljs-built_in">len</span>(os.Args))

    <span class="hljs-comment">// 读取传入的参数（如：go run main.go 张三 25）</span>
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(os.Args) &lt; <span class="hljs-number">3</span> {
        fmt.Println(<span class="hljs-string">"请传入两个参数：姓名 年龄"</span>)
        <span class="hljs-keyword">return</span>
    }

    name := os.Args[<span class="hljs-number">1</span>] <span class="hljs-comment">// 第一个参数（姓名）</span>
    age := os.Args[<span class="hljs-number">2</span>]  <span class="hljs-comment">// 第二个参数（年龄）</span>
    fmt.Printf(<span class="hljs-string">"你传入的姓名：%s，年龄：%s\n"</span>, name, age)
}
</code></pre>
<p>运行测试（终端执行）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 传入参数运行</span>
go run main.go 张三 25

<span class="hljs-comment"># 运行结果</span>
所有命令行参数：[./main 张三 25]
参数个数：3
你传入的姓名：张三，年龄：25
</code></pre>
<h3 data-id="heading-12">2.3 其他常用功能（补充）</h3>
<p>除了环境变量和命令行参数，os包还有两个常用功能，无需深入，掌握用法即可：</p>
<ul>
<li>
<p><strong>获取当前工作目录</strong>：<code>os.Getwd()</code>，返回当前程序运行的目录路径；</p>
</li>
<li>
<p><strong>退出程序</strong>：<code>os.Exit(code)</code>，code=0表示正常退出，code≠0表示异常退出（如<code>os.Exit(1)</code>）。</p>
</li>
</ul>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 补充代码示例</span>
wd, _ := os.Getwd()
fmt.Printf(<span class="hljs-string">"当前工作目录：%s\n"</span>, wd)

<span class="hljs-comment">// 异常退出（终止程序运行）</span>
<span class="hljs-comment">// os.Exit(1)</span>
</code></pre>
<h3 data-id="heading-13">2.4 避坑重点</h3>
<ul>
<li>
<p>环境变量兜底：读取环境变量时，务必判断是否为空，设置默认值（如示例中dbHost默认值为localhost），避免因环境变量未设置导致程序报错；</p>
</li>
<li>
<p>命令行参数边界判断：读取os.Args时，需判断切片长度，避免索引越界（如用户未传入足够参数，直接读取os.Args[1]会报错）；</p>
</li>
<li>
<p>os.Setenv仅当前进程有效：设置的环境变量，只在当前程序运行的进程中有效，程序结束后自动失效，无法影响操作系统全局环境变量。</p>
</li>
</ul>
<h3 data-id="heading-14">2.5 参考链接</h3>
<ul>
<li>Go官方文档（os包）：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fpkg%2Fos%2F" target="_blank" title="https://go.dev/pkg/os/" ref="nofollow noopener noreferrer">os package - os</a></li>
</ul>
<h2 data-id="heading-15">三、文件操作（os包延伸）</h2>
<p>文件操作是开发中的核心场景（如读取配置文件、写入日志、处理文本文件），Go中文件操作主要通过<strong>os包</strong>实现，核心功能涵盖：文件创建、文件读取、文件写入、文件删除、目录操作等，用法简洁，无需额外依赖。</p>
<p>核心逻辑：先通过<code>os.Open()</code>、<code>os.Create()</code>等函数获取“文件句柄”（*os.File），再通过文件句柄执行读写操作，最后务必关闭文件句柄（用defer确保），避免资源泄露。</p>
<h3 data-id="heading-16">3.1 核心文件操作（高频场景）</h3>
<p>按“实战场景”分类讲解，每个场景配套极简代码示例，覆盖日常开发80%的需求。</p>
<h4 data-id="heading-17">3.1.1 场景1：创建文件（含写入内容）</h4>
<p>用<code>os.Create()</code>函数创建文件，若文件已存在，会清空文件内容；若文件不存在，会创建新文件。返回文件句柄和错误，需判断错误。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"os"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 创建文件（路径：test.txt），返回文件句柄和错误</span>
    file, err := os.Create(<span class="hljs-string">"test.txt"</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Printf(<span class="hljs-string">"创建文件失败：%v\n"</span>, err)
        <span class="hljs-keyword">return</span>
    }
    <span class="hljs-keyword">defer</span> file.Close() <span class="hljs-comment">// 延迟关闭文件句柄，确保资源释放（关键）</span>

    <span class="hljs-comment">// 向文件写入内容（字符串转字节切片）</span>
    content := <span class="hljs-string">"Hello Go 文件操作！"</span>
    n, err := file.Write([]<span class="hljs-type">byte</span>(content)) <span class="hljs-comment">// 写入字节切片</span>
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Printf(<span class="hljs-string">"写入文件失败：%v\n"</span>, err)
        <span class="hljs-keyword">return</span>
    }
    fmt.Printf(<span class="hljs-string">"写入成功，写入字节数：%d\n"</span>, n)
}
</code></pre>
<h4 data-id="heading-18">3.1.2 场景2：读取文件内容（完整读取）</h4>
<p>用<code>os.Open()</code>函数打开文件（只读模式），获取文件句柄后，通过<code>file.Read()</code>读取内容，或用<code>ioutil.ReadAll()</code>（Go 1.16+推荐用os.ReadFile()）快速读取完整文件。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"os"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 方式1：快速读取完整文件（推荐，简洁）</span>
    content, err := os.ReadFile(<span class="hljs-string">"test.txt"</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Printf(<span class="hljs-string">"读取文件失败：%v\n"</span>, err)
        <span class="hljs-keyword">return</span>
    }
    fmt.Printf(<span class="hljs-string">"文件内容：%s\n"</span>, content)

    <span class="hljs-comment">// 方式2：打开文件后读取（灵活，可控制读取长度）</span>
    file, err := os.Open(<span class="hljs-string">"test.txt"</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Printf(<span class="hljs-string">"打开文件失败：%v\n"</span>, err)
        <span class="hljs-keyword">return</span>
    }
    <span class="hljs-keyword">defer</span> file.Close()

    <span class="hljs-keyword">var</span> buf [<span class="hljs-number">128</span>]<span class="hljs-type">byte</span> <span class="hljs-comment">// 缓冲区，存储读取的内容</span>
    n, err := file.Read(buf[:]) <span class="hljs-comment">// 读取内容到缓冲区</span>
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Printf(<span class="hljs-string">"读取失败：%v\n"</span>, err)
        <span class="hljs-keyword">return</span>
    }
    fmt.Printf(<span class="hljs-string">"读取字节数：%d，内容：%s\n"</span>, n, buf[:n])
}
</code></pre>
<h4 data-id="heading-19">3.1.3 场景3：追加内容到文件（不覆盖）</h4>
<p>os.Create()会清空文件内容，若需追加内容，需用<code>os.OpenFile()</code>函数，指定“追加+写入”模式（os.O_APPEND|os.O_WRONLY）。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"os"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 打开文件（追加+写入模式），不存在则创建</span>
    file, err := os.OpenFile(<span class="hljs-string">"test.txt"</span>, os.O_APPEND|os.O_WRONLY|os.O_CREATE, <span class="hljs-number">0644</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Printf(<span class="hljs-string">"打开文件失败：%v\n"</span>, err)
        <span class="hljs-keyword">return</span>
    }
    <span class="hljs-keyword">defer</span> file.Close()

    <span class="hljs-comment">// 追加内容</span>
    appendContent := <span class="hljs-string">"\n追加的内容：Go yyds！"</span>
    _, err = file.WriteString(appendContent) <span class="hljs-comment">// 直接写入字符串（更便捷）</span>
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Printf(<span class="hljs-string">"追加内容失败：%v\n"</span>, err)
        <span class="hljs-keyword">return</span>
    }
    fmt.Println(<span class="hljs-string">"追加内容成功"</span>)
}
</code></pre>
<p>说明：0644是文件权限（Linux/Mac下有效），表示“所有者可读写，其他用户只读”，是常规文件的默认权限。</p>
<h4 data-id="heading-20">3.1.4 场景4：删除文件/目录</h4>
<p>删除文件用<code>os.Remove()</code>，删除目录用<code>os.RemoveAll()</code>（递归删除目录下所有内容，包括目录本身）。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"os"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 删除文件（test.txt）</span>
    err := os.Remove(<span class="hljs-string">"test.txt"</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Printf(<span class="hljs-string">"删除文件失败：%v\n"</span>, err)
        <span class="hljs-keyword">return</span>
    }
    fmt.Println(<span class="hljs-string">"文件删除成功"</span>)

    <span class="hljs-comment">// 2. 删除目录（递归删除，即使目录非空）</span>
    err = os.RemoveAll(<span class="hljs-string">"test_dir"</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Printf(<span class="hljs-string">"删除目录失败：%v\n"</span>, err)
        <span class="hljs-keyword">return</span>
    }
    fmt.Println(<span class="hljs-string">"目录删除成功"</span>)
}
</code></pre>
<h3 data-id="heading-21">3.2 目录操作（补充）</h3>
<p>日常开发中，除了文件操作，偶尔需要创建目录、读取目录内容，核心函数：<code>os.Mkdir()</code>（创建单个目录）、<code>os.MkdirAll()</code>（递归创建多级目录）、<code>os.ReadDir()</code>（读取目录内容）。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"os"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 递归创建多级目录（如：a/b/c）</span>
    err := os.MkdirAll(<span class="hljs-string">"a/b/c"</span>, <span class="hljs-number">0755</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Printf(<span class="hljs-string">"创建目录失败：%v\n"</span>, err)
        <span class="hljs-keyword">return</span>
    }
    fmt.Println(<span class="hljs-string">"多级目录创建成功"</span>)

    <span class="hljs-comment">// 2. 读取目录内容（a/b目录）</span>
    entries, err := os.ReadDir(<span class="hljs-string">"a/b"</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Printf(<span class="hljs-string">"读取目录失败：%v\n"</span>, err)
        <span class="hljs-keyword">return</span>
    }

    <span class="hljs-comment">// 遍历目录内容</span>
    <span class="hljs-keyword">for</span> _, entry := <span class="hljs-keyword">range</span> entries {
        fmt.Printf(<span class="hljs-string">"名称：%s，是否是目录：%t\n"</span>, entry.Name(), entry.IsDir())
    }
}
</code></pre>
<h3 data-id="heading-22">3.3 避坑重点（高频踩坑）</h3>
<ul>
<li>
<p>必须关闭文件句柄：打开文件（os.Open、os.Create等）后，务必用defer file.Close()关闭文件句柄，否则会导致文件资源泄露，长期运行可能导致程序异常；</p>
</li>
<li>
<p>判断错误：文件操作（创建、打开、读写、删除）都可能出错（如文件不存在、权限不足），必须判断返回的err，避免程序崩溃；</p>
</li>
<li>
<p>os.RemoveAll慎用：递归删除目录，一旦路径写错（如os.RemoveAll("/")），会导致严重后果，生产环境需严格校验删除路径；</p>
</li>
<li>
<p>文件路径：相对路径是相对于当前程序运行目录（os.Getwd()返回的路径），而非代码文件所在目录，避免路径错乱。</p>
</li>
</ul>
<h3 data-id="heading-23">3.4 参考链接</h3>
<ul>
<li>Go官方文档（os包文件操作）：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fpkg%2Fos%2F%23File" target="_blank" title="https://go.dev/pkg/os/#File" ref="nofollow noopener noreferrer">os.File - os package</a></li>
</ul>
<h2 data-id="heading-24">四、io接口（io包）</h2>
<p>io包是Go标准库中“输入输出”的核心抽象，定义了<strong>通用的I/O接口</strong>（如Reader、Writer），统一了所有输入输出场景的操作规范——无论是文件读写、网络读写、内存读写，都遵循相同的接口定义，实现了“多态”，极大提升了代码的通用性和可扩展性。</p>
<p>核心重点：理解Reader和Writer两个核心接口，这是Go I/O操作的基础，后续bufio、net等包都基于这两个接口实现。</p>
<h3 data-id="heading-25">4.1 核心接口：Reader（读取接口）</h3>
<p>Reader接口定义了“读取数据”的规范，只要某个类型实现了Reader接口（即实现了Read()方法），就可以被当作“读取源”（如文件、内存、网络连接），统一用相同的方式读取数据。</p>
<p>Reader接口源码（极简，来自Go标准库）：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> io

<span class="hljs-comment">// Reader 读取接口，核心方法是Read</span>
<span class="hljs-keyword">type</span> Reader <span class="hljs-keyword">interface</span> {
    <span class="hljs-comment">// 从读取源读取数据，写入到p（字节切片）</span>
    <span class="hljs-comment">// 返回值n：实际读取的字节数；err：错误（读取完成时返回io.EOF）</span>
    Read(p []<span class="hljs-type">byte</span>) (n <span class="hljs-type">int</span>, err <span class="hljs-type">error</span>)
}
</code></pre>
<h4 data-id="heading-26">4.1.1 常用Reader实现（实战中常见）</h4>
<p>Go标准库中，很多类型都实现了Reader接口，无需我们自己实现，直接使用即可：</p>
<ul>
<li>
<p><code>*os.File</code>：文件读取源（如前面文件操作中的file句柄，可通过Read()方法读取文件内容）；</p>
</li>
<li>
<p><code>strings.Reader</code>：字符串读取源（将字符串当作读取源，从字符串中读取数据）；</p>
</li>
<li>
<p><code>bytes.Reader</code>：字节切片读取源（从字节切片中读取数据）；</p>
</li>
<li>
<p><code>os.Stdin</code>：标准输入读取源（从终端读取输入）。</p>
</li>
</ul>
<h4 data-id="heading-27">4.1.2 极简代码示例（使用Reader接口读取）</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"bytes"</span>
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"io"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 字节切片作为读取源（bytes.Reader 实现了Reader接口）</span>
    data := []<span class="hljs-type">byte</span>(<span class="hljs-string">"Hello io.Reader!"</span>)
    reader := bytes.NewReader(data)

    <span class="hljs-comment">// 2. 用Reader接口的Read()方法读取数据</span>
    <span class="hljs-keyword">var</span> buf [<span class="hljs-number">128</span>]<span class="hljs-type">byte</span>
    n, err := reader.Read(buf[:])
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &amp;&amp; err != io.EOF { <span class="hljs-comment">// io.EOF表示读取完成，非错误</span>
        fmt.Printf(<span class="hljs-string">"读取失败：%v\n"</span>, err)
        <span class="hljs-keyword">return</span>
    }

    fmt.Printf(<span class="hljs-string">"读取字节数：%d，内容：%s\n"</span>, n, buf[:n])
}
</code></pre>
<p>说明：io.EOF是一个特殊的错误，表示“读取已完成”，并非真正的错误，无需处理（可忽略）。</p>
<h3 data-id="heading-28">4.2 核心接口：Writer（写入接口）</h3>
<p>Writer接口定义了“写入数据”的规范，只要某个类型实现了Writer接口（即实现了Write()方法），就可以被当作“写入目标”（如文件、内存、网络连接），统一用相同的方式写入数据。</p>
<p>Writer接口源码（极简，来自Go标准库）：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> io

<span class="hljs-comment">// Writer 写入接口，核心方法是Write</span>
<span class="hljs-keyword">type</span> Writer <span class="hljs-keyword">interface</span> {
    <span class="hljs-comment">// 将p（字节切片）中的数据，写入到写入目标</span>
    <span class="hljs-comment">// 返回值n：实际写入的字节数；err：错误</span>
    Write(p []<span class="hljs-type">byte</span>) (n <span class="hljs-type">int</span>, err <span class="hljs-type">error</span>)
}
</code></pre>
<h4 data-id="heading-29">4.2.1 常用Writer实现（实战中常见）</h4>
<ul>
<li>
<p><code>*os.File</code>：文件写入目标（文件句柄，可通过Write()方法写入文件）；</p>
</li>
<li>
<p><code>strings.Builder</code>：字符串写入目标（将数据写入到字符串缓冲区，最终拼接成字符串）；</p>
</li>
<li>
<p><code>bytes.Buffer</code>：字节切片写入目标（将数据写入到字节缓冲区）；</p>
</li>
<li>
<p><code>os.Stdout</code>：标准输出写入目标（将数据写入到终端，即fmt.Print的底层实现）。</p>
</li>
</ul>
<h4 data-id="heading-30">4.2.2 极简代码示例（使用Writer接口写入）</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"bytes"</span>
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"io"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 字节缓冲区作为写入目标（bytes.Buffer 实现了Writer接口）</span>
    <span class="hljs-keyword">var</span> writer bytes.Buffer

    <span class="hljs-comment">// 2. 用Writer接口的Write()方法写入数据</span>
    content := []<span class="hljs-type">byte</span>(<span class="hljs-string">"Hello io.Writer!"</span>)
    n, err := writer.Write(content)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Printf(<span class="hljs-string">"写入失败：%v\n"</span>, err)
        <span class="hljs-keyword">return</span>
    }

    fmt.Printf(<span class="hljs-string">"写入字节数：%d，缓冲区内容：%s\n"</span>, n, writer.String())
}
</code></pre>
<h3 data-id="heading-31">4.3 io包常用工具函数（实战高频）</h3>
<p>io包除了定义核心接口，还提供了一些常用工具函数，简化I/O操作，无需自己封装，重点掌握2个：</p>
<ul>
<li>
<p><code>io.Copy(dst Writer, src Reader)</code>：将读取源（src）的数据，复制到写入目标（dst），返回复制的字节数（后续“复制数据”章节详细讲）；</p>
</li>
<li>
<p><code>io.ReadAll(r Reader)</code>：读取读取源（r）的所有数据，返回字节切片（简化读取操作，无需手动循环读取）。</p>
</li>
</ul>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"bytes"</span>
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"io"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. io.ReadAll：读取所有数据</span>
    src := bytes.NewReader([]<span class="hljs-type">byte</span>(<span class="hljs-string">"Hello io.ReadAll!"</span>))
    data, err := io.ReadAll(src)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Printf(<span class="hljs-string">"读取失败：%v\n"</span>, err)
        <span class="hljs-keyword">return</span>
    }
    fmt.Printf(<span class="hljs-string">"读取所有内容：%s\n"</span>, data)

    <span class="hljs-comment">// 2. io.Copy：复制数据（后续章节详细讲）</span>
    src2 := bytes.NewReader([]<span class="hljs-type">byte</span>(<span class="hljs-string">"Hello io.Copy!"</span>))
    <span class="hljs-keyword">var</span> dst bytes.Buffer
    n, err := io.Copy(&amp;dst, src2)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Printf(<span class="hljs-string">"复制失败：%v\n"</span>, err)
        <span class="hljs-keyword">return</span>
    }
    fmt.Printf(<span class="hljs-string">"复制字节数：%d，目标内容：%s\n"</span>, n, dst.String())
}
</code></pre>
<h3 data-id="heading-32">4.4 避坑重点</h3>
<ul>
<li>
<p>io.EOF不是错误：读取数据时，返回io.EOF表示“读取完成”，无需处理，避免误判为错误导致程序异常；</p>
</li>
<li>
<p>接口的通用性：只要实现了Reader/Writer接口，就可以用相同的方式操作，比如用io.Copy()既可以复制文件内容，也可以复制网络数据，无需区分具体类型；</p>
</li>
<li>
<p>Read/Write的返回值：务必关注返回的n（实际读写的字节数），尤其是大数据量读写时，可能出现“部分读写”（n小于传入的字节切片长度），需循环读写确保完成。</p>
</li>
</ul>
<h3 data-id="heading-33">4.5 参考链接</h3>
<ul>
<li>Go官方文档（io包）：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fpkg%2Fio%2F" target="_blank" title="https://go.dev/pkg/io/" ref="nofollow noopener noreferrer">io package - io</a></li>
</ul>
<h2 data-id="heading-34">五、缓冲读写（bufio包）</h2>
<p>bufio包是基于io包的<strong>缓冲I/O工具包</strong>，核心作用是“给Reader/Writer增加缓冲区”，减少底层I/O操作的次数，提升读写效率——尤其是在高频、小数据量读写场景（如读取文本文件的每一行、终端输入），缓冲读写的效率远高于直接读写。</p>
<p>核心逻辑：缓冲区本质是一块内存，读取时先将数据读取到缓冲区，后续读取直接从缓冲区获取；写入时先将数据写入到缓冲区，缓冲区满后再一次性写入到底层目标，减少底层I/O调用（底层I/O操作开销较大）。</p>
<p>核心组件：bufio.Reader（缓冲读取）、bufio.Writer（缓冲写入），分别对应io.Reader和io.Writer接口，完全兼容io包的所有操作。</p>
<h3 data-id="heading-35">5.1 缓冲读取（bufio.Reader）</h3>
<p>bufio.Reader基于io.Reader实现，增加了缓冲区，提供了更便捷的读取方法（如读取一行、读取单词），核心用法：先通过<code>bufio.NewReader()</code>创建缓冲读取器，再调用其方法读取数据。</p>
<p>高频方法：<code>ReadLine()</code>（读取一行）、<code>ReadString()</code>（读取到指定分隔符）、<code>ReadBytes()</code>（读取到指定分隔符，返回字节切片）。</p>
<h4 data-id="heading-36">5.1.1 极简代码示例（读取文件每一行）</h4>
<p>读取文本文件的每一行，是日常开发中高频场景，用bufio.Reader的ReadLine()方法最便捷（比直接用os.ReadFile()更灵活）。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"bufio"</span>
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"os"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 打开文件（只读模式）</span>
    file, err := os.Open(<span class="hljs-string">"test.txt"</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Printf(<span class="hljs-string">"打开文件失败：%v\n"</span>, err)
        <span class="hljs-keyword">return</span>
    }
    <span class="hljs-keyword">defer</span> file.Close()

    <span class="hljs-comment">// 2. 创建缓冲读取器（缓冲区默认大小4096字节，可自定义）</span>
    reader := bufio.NewReader(file)

    <span class="hljs-comment">// 3. 循环读取每一行</span>
    <span class="hljs-keyword">for</span> {
        <span class="hljs-comment">// 读取一行（返回字节切片，不含换行符）</span>
        line, err := reader.ReadBytes(<span class="hljs-string">'\n'</span>) <span class="hljs-comment">// 按换行符分隔</span>
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">if</span> err.Error() == <span class="hljs-string">"EOF"</span> { <span class="hljs-comment">// 读取完成</span>
                <span class="hljs-keyword">break</span>
            }
            fmt.Printf(<span class="hljs-string">"读取失败：%v\n"</span>, err)
            <span class="hljs-keyword">return</span>
        }
        <span class="hljs-comment">// 去除换行符，打印内容</span>
        fmt.Printf(<span class="hljs-string">"读取一行：%s"</span>, line)
    }
    fmt.Println(<span class="hljs-string">"读取完成"</span>)
}
</code></pre>
<p>补充：ReadString('\n')与ReadBytes('\n')用法类似，区别是ReadString返回字符串，ReadBytes返回字节切片，可根据需求选择。</p>
<h3 data-id="heading-37">5.2 缓冲写入（bufio.Writer）</h3>
<p>bufio.Writer基于io.Writer实现，增加了缓冲区，写入数据时先写入缓冲区，缓冲区满后自动刷新到底层目标；也可手动调用<code>Flush()</code>方法，将缓冲区的数据立即刷新到底层。</p>
<p>核心注意：缓冲写入后，务必调用Flush()方法（用defer确保），否则缓冲区中的数据可能未写入到底层目标（导致数据丢失）。</p>
<h4 data-id="heading-38">5.2.1 极简代码示例（缓冲写入文件）</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"bufio"</span>
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"os"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 打开文件（写入模式，不存在则创建）</span>
    file, err := os.Create(<span class="hljs-string">"buf_test.txt"</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Printf(<span class="hljs-string">"创建文件失败：%v\n"</span>, err)
        <span class="hljs-keyword">return</span>
    }
    <span class="hljs-keyword">defer</span> file.Close()

    <span class="hljs-comment">// 2. 创建缓冲写入器（默认缓冲区4096字节）</span>
    writer := bufio.NewWriter(file)
    <span class="hljs-keyword">defer</span> writer.Flush() <span class="hljs-comment">// 延迟刷新缓冲区，确保数据写入文件（关键）</span>

    <span class="hljs-comment">// 3. 缓冲写入内容（多次写入，先存到缓冲区）</span>
    content1 := <span class="hljs-string">"缓冲写入第一行\n"</span>
    content2 := <span class="hljs-string">"缓冲写入第二行\n"</span>

    _, err = writer.WriteString(content1)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Printf(<span class="hljs-string">"写入失败：%v\n"</span>, err)
        <span class="hljs-keyword">return</span>
    }

    _, err = writer.WriteString(content2)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Printf(<span class="hljs-string">"写入失败：%v\n"</span>, err)
        <span class="hljs-keyword">return</span>
    }

    fmt.Println(<span class="hljs-string">"写入完成（缓冲区将自动刷新）"</span>)
}
</code></pre>
<p>说明：defer writer.Flush()必须写在writer创建之后，确保程序退出前，缓冲区的数据全部刷新到底层文件，避免数据丢失。</p>
<h3 data-id="heading-39">5.3 缓冲读写的优势（对比直接读写）</h3>
<p>用表格清晰对比“直接读写（os包）”和“缓冲读写（bufio包）”的区别，理解为什么需要用bufio：</p>






























<table><thead><tr><th><strong>对比维度</strong></th><th><strong>直接读写（os包）</strong></th><th><strong>缓冲读写（bufio包）</strong></th></tr></thead><tbody><tr><td>底层调用次数</td><td>每次读写都调用底层I/O，次数多，开销大</td><td>先写入/读取到缓冲区，批量调用底层I/O，次数少，开销小</td></tr><tr><td>效率</td><td>小数据量、高频读写时，效率极低</td><td>小数据量、高频读写时，效率提升明显（10倍+）</td></tr><tr><td>便捷性</td><td>仅提供基础读写方法，无便捷操作（如读取一行）</td><td>提供ReadLine、ReadString等便捷方法，简化开发</td></tr><tr><td>适用场景</td><td>大数据量、一次性读写（如读取整个大文件）</td><td>小数据量、高频读写（如读取配置文件每一行、日志写入）</td></tr></tbody></table>
<h3 data-id="heading-40">5.4 避坑重点</h3>
<ul>
<li>
<p>缓冲写入必须Flush()：用bufio.Writer写入后，务必调用Flush()方法（或用defer），否则缓冲区中的数据可能未写入到底层目标，导致数据丢失；</p>
</li>
<li>
<p>缓冲区大小选择：默认缓冲区大小为4096字节（4KB），若读写的单次数据量较大（如1MB），可自定义缓冲区大小（如bufio.NewReaderSize(file, 1024*1024)）；</p>
</li>
<li>
<p>兼容io包：bufio.Reader和bufio.Writer都实现了io.Reader和io.Writer接口，可与io包的函数（如io.Copy）无缝配合使用。</p>
</li>
</ul>
<h3 data-id="heading-41">5.5 参考链接</h3>
<ul>
<li>Go官方文档（bufio包）：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fpkg%2Fbufio%2F" target="_blank" title="https://go.dev/pkg/bufio/" ref="nofollow noopener noreferrer">bufio package - bufio</a></li>
</ul>
<h2 data-id="heading-42">六、复制数据（io+bufio包结合）</h2>
<p>复制数据是I/O操作中的高频场景（如文件复制、数据备份、网络数据转发），Go中复制数据的核心工具是<code>io.Copy()</code>函数（io包），结合bufio包的缓冲读写，可实现高效复制——无需手动循环读写，一行代码即可完成复制操作。</p>
<p>核心逻辑：io.Copy(dst Writer, src Reader)，将读取源（src）的数据，自动复制到写入目标（dst），返回复制的字节数和错误；底层会自动处理“部分读写”，循环读取直到src读取完成（返回io.EOF）。</p>
<h3 data-id="heading-43">6.1 核心复制场景（实战高频）</h3>
<h4 data-id="heading-44">6.1.1 场景1：文件复制（最常用）</h4>
<p>将一个文件的内容，复制到另一个文件，用io.Copy()结合os包的文件操作，一行代码即可完成，高效简洁。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"io"</span>
    <span class="hljs-string">"os"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 打开源文件（只读模式）</span>
    srcFile, err := os.Open(<span class="hljs-string">"source.txt"</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Printf(<span class="hljs-string">"打开源文件失败：%v\n"</span>, err)
        <span class="hljs-keyword">return</span>
    }
    <span class="hljs-keyword">defer</span> srcFile.Close()

    <span class="hljs-comment">// 2. 创建目标文件（写入模式，不存在则创建，存在则清空）</span>
    dstFile, err := os.Create(<span class="hljs-string">"target.txt"</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Printf(<span class="hljs-string">"创建目标文件失败：%v\n"</span>, err)
        <span class="hljs-keyword">return</span>
    }
    <span class="hljs-keyword">defer</span> dstFile.Close()

    <span class="hljs-comment">// 3. 复制数据（核心一行代码）</span>
    <span class="hljs-comment">// srcFile（Reader） → dstFile（Writer）</span>
    n, err := io.Copy(dstFile, srcFile)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Printf(<span class="hljs-string">"复制文件失败：%v\n"</span>, err)
        <span class="hljs-keyword">return</span>
    }

    fmt.Printf(<span class="hljs-string">"文件复制成功，复制字节数：%d\n"</span>, n)
}
</code></pre>
<h4 data-id="heading-45">6.1.2 场景2：高效文件复制（结合bufio缓冲）</h4>
<p>普通io.Copy()已能完成文件复制，但结合bufio包的缓冲读写，可进一步提升复制效率（尤其是小文件、高频复制场景），只需给srcFile和dstFile增加缓冲层即可。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"bufio"</span>
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"io"</span>
    <span class="hljs-string">"os"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 打开源文件和目标文件（步骤同上）</span>
    srcFile, err := os.Open(<span class="hljs-string">"source.txt"</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Printf(<span class="hljs-string">"打开源文件失败：%v\n"</span>, err)
        <span class="hljs-keyword">return</span>
    }
    <span class="hljs-keyword">defer</span> srcFile.Close()

    dstFile, err := os.Create(<span class="hljs-string">"target.txt"</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Printf(<span class="hljs-string">"创建目标文件失败：%v\n"</span>, err)
        <span class="hljs-keyword">return</span>
    }
    <span class="hljs-keyword">defer</span> dstFile.Close()

    <span class="hljs-comment">// 增加缓冲层（核心优化）</span>
    bufSrc := bufio.NewReader(srcFile)
    bufDst := bufio.NewWriter(dstFile)
    <span class="hljs-keyword">defer</span> bufDst.Flush() <span class="hljs-comment">// 缓冲写入需刷新</span>

    <span class="hljs-comment">// 缓冲复制（效率更高）</span>
    n, err := io.Copy(bufDst, bufSrc)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Printf(<span class="hljs-string">"复制失败：%v\n"</span>, err)
        <span class="hljs-keyword">return</span>
    }

    fmt.Printf(<span class="hljs-string">"缓冲复制成功，复制字节数：%d\n"</span>, n)
}
</code></pre>
<h4 data-id="heading-46">6.1.3 场景3：其他复制场景（拓展）</h4>
<p>由于io.Copy()基于Reader和Writer接口，因此可实现任意“Reader→Writer”的复制，不止于文件：</p>
<ul>
<li>
<p>内存→文件：bytes.Reader（内存） → *os.File（文件）；</p>
</li>
<li>
<p>文件→内存：*os.File（文件） → bytes.Buffer（内存）；</p>
</li>
<li>
<p>标准输入→标准输出：os.Stdin（终端输入） → os.Stdout（终端输出）。</p>
</li>
</ul>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 示例：标准输入→标准输出（终端输入什么，就打印什么）</span>
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"io"</span>
    <span class="hljs-string">"os"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 复制标准输入到标准输出</span>
    io.Copy(os.Stdout, os.Stdin)
}
</code></pre>
<h3 data-id="heading-47">6.2 避坑重点</h3>
<ul>
<li>
<p>关闭文件句柄：复制文件时，源文件和目标文件都需打开，务必用defer关闭，避免资源泄露；</p>
</li>
<li>
<p>缓冲写入需Flush()：结合bufio.Writer复制时，务必调用Flush()方法，确保缓冲区的数据写入目标文件；</p>
</li>
<li>
<p>复制大文件：io.Copy()底层会自动分块复制，无需担心内存溢出</p>
</li>
</ul>
<p>提示：io.Copy()函数本身已具备基础的高效性，底层会根据数据量自动优化读写逻辑；对于超大文件（如1GB以上），无需额外封装，直接使用io.Copy()或结合bufio缓冲即可稳定运行，无需担心内存占用问题。至此，我们已掌握io包与bufio包的核心结合用法，通过接口的通用性和缓冲的高效性，可轻松应对各类I/O复制场景，再结合前文的fmt、os包知识，四大基础标准库的核心实战用法已全部覆盖，足以支撑日常开发中的绝大多数基础场景。</p>
<h2 data-id="heading-48">七、章节总结与实战拓展（全文闭环）</h2>
<p>本章围绕Golang最基础、最常用的4个标准库（fmt、os、io、bufio），按“核心用法+极简代码+避坑重点+参考链接”的实战逻辑，完整覆盖了格式化输入输出、操作系统交互、文件操作、I/O接口、缓冲读写、数据复制六大核心场景，所有代码示例均可直接复制运行，无需额外依赖，精准匹配日常开发80%的基础需求。</p>
<h3 data-id="heading-49">7.1 核心知识点梳理（快速回顾，便于记忆）</h3>
<p>用表格清晰汇总四大标准库的核心定位和高频用法，帮你快速梳理重点，避免混淆：</p>






























<table><thead><tr><th><strong>标准库</strong></th><th><strong>核心定位</strong></th><th><strong>高频核心用法</strong></th></tr></thead><tbody><tr><td>fmt</td><td>格式化输入输出</td><td>fmt.Printf()（自定义格式化）、fmt.Scan()（读取输入）、%s/%d/%+v等格式化动词</td></tr><tr><td>os</td><td>与操作系统/文件交互</td><td>环境变量（Getenv/Setenv）、命令行参数（os.Args）、文件操作（Create/Open/ReadFile）</td></tr><tr><td>io</td><td>I/O接口抽象与工具</td><td>Reader/Writer核心接口、io.Copy()（数据复制）、io.ReadAll()（读取全部数据）</td></tr><tr><td>bufio</td><td>缓冲读写优化</td><td>bufio.Reader（读取一行）、bufio.Writer（缓冲写入）、Flush()（刷新缓冲区）</td></tr></tbody></table>
<h3 data-id="heading-50">7.2 实战避坑汇总（高频踩坑终极总结）</h3>
<p>结合前文各章节避坑重点，汇总10个日常开发中最容易踩的坑，帮你规避低级错误，提升开发效率：</p>
<ul>
<li>
<p>fmt包：格式化动词与数据类型必须匹配（如%s不能接收整数）；Scan系列函数必须传变量指针，否则无法赋值。</p>
</li>
<li>
<p>os包：读取环境变量务必设置兜底默认值，避免未配置环境变量导致程序异常；os.Setenv设置的环境变量仅当前进程有效。</p>
</li>
<li>
<p>文件操作：打开文件后必须用defer关闭句柄；os.RemoveAll递归删除需严格校验路径，避免误删重要文件；相对路径基于程序运行目录，而非代码文件目录。</p>
</li>
<li>
<p>io包：io.EOF是读取完成的标志，并非错误，无需处理；Read/Write可能出现部分读写，大数据量需循环确保读写完整。</p>
</li>
<li>
<p>bufio包：缓冲写入后必须调用Flush()，否则缓冲区数据可能丢失；可根据读写量自定义缓冲区大小，提升效率。</p>
</li>
<li>
<p>数据复制：结合bufio缓冲可提升小文件复制效率；复制完成后需确保源文件、目标文件及缓冲写入器均正常关闭/刷新。</p>
</li>
</ul>
<h3 data-id="heading-51">7.3 实战拓展提示（进阶方向）</h3>
<p>本章讲解的是四大标准库的基础核心用法，掌握后可结合以下方向进一步拓展，适配更复杂的开发场景：</p>
<ol>
<li>
<p>进阶标准库学习：后续可学习<code>ioutil</code>（文件工具，Go 1.16+部分功能整合到os包）、<code>bytes</code>（字节操作）、<code>strings</code>（字符串操作），与本章内容无缝衔接。</p>
</li>
<li>
<p>实战场景封装：可将高频文件操作、数据复制、环境变量读取等逻辑封装成工具函数（如文件复制工具、配置读取工具），提升代码复用性。</p>
</li>
<li>
<p>性能优化：针对超大文件复制、高频读写场景，可自定义bufio缓冲区大小，或结合<code>io.CopyBuffer()</code>实现更灵活的缓冲控制；小文件批量复制可引入并发，提升效率。</p>
</li>
<li>
<p>错误处理优化：实际开发中可结合<code>errors</code>包或第三方错误处理库，对I/O操作、文件操作的错误进行更详细的封装和日志记录，便于问题排查。</p>
</li>
</ol>
<h3 data-id="heading-52">7.4 学习建议</h3>
<p>学习Golang标准库的核心原则是“先会用，再深究”：先掌握本章讲解的核心用法和代码示例，能独立完成格式化输出、文件操作、数据复制等基础场景开发；后续再深入阅读标准库源码（如Reader/Writer接口实现、bufio缓冲区原理），理解底层逻辑，提升技术深度。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android 17 终于有原生应用锁了，小米用户笑了：我们用了好多年了]]></title>    <link>https://juejin.cn/post/7604694326518104115</link>    <guid>https://juejin.cn/post/7604694326518104115</guid>    <pubDate>2026-02-10T00:54:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604694326518104115" data-draft-id="7604697194794975242" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android 17 终于有原生应用锁了，小米用户笑了：我们用了好多年了"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-02-10T00:54:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="黄林晴"/> <meta itemprop="url" content="https://juejin.cn/user/3985057546510423"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android 17 终于有原生应用锁了，小米用户笑了：我们用了好多年了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3985057546510423/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    黄林晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T00:54:17.000Z" title="Tue Feb 10 2026 00:54:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>借手机给朋友看个照片，心里却在默念「千万别乱翻」——这种焦虑，Android 用户应该都体会过。</p>
<p>小米、三星等厂商早就给出了答案：<strong>应用锁</strong>。但原生 Android？一直缺席。</p>
<p>现在，Android 17 终于补上了这块短板。</p>
<p>近日，有开发者在 Android Canary 2601 系统代码中发现了两个关键字段：<code>app_locked_new_notification</code> 和 <code>app_locked_notification_message</code>，揭示了 Android 17 原生应用锁功能的更多细节。而这一次，Google 不仅仅是「锁住应用」那么简单。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f304e4336a9d49559c8015549b604649~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5p6X5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771289658&amp;x-signature=R2jSY1YC29fIWl0HgXxeM2mWc9E%3D" alt="android17_applock_cover.png" loading="lazy"/></p>
<h2 data-id="heading-0">Android 17 原生应用锁：怎么用？</h2>
<p>从目前曝光的信息来看，操作方式非常直觉：</p>
<p><strong>长按应用图标 → 选择「锁定应用」→ 完成</strong></p>
<p>解锁方式支持：</p>
<ul>
<li>• PIN 码</li>
<li>• 密码</li>
<li>• 指纹 / 面部等生物识别</li>
</ul>
<p>不需要进设置翻半天，不需要下载第三方 App，桌面上直接操作，两步搞定。</p>
<p>这对于一直使用 Pixel 等原生 Android 设备的用户来说，是期待了太久的功能。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d3aa61a613f4662a1c81518b79e3269~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buE5p6X5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771289658&amp;x-signature=m0LMcHYPwqZCQ8XHL40HqLUe0vM%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">重头戏：通知内容也会被「锁住」</h2>
<p>应用锁不稀奇，但 <strong>锁了应用之后，通知还在「泄密」</strong>——这才是真正的痛点。</p>
<p>想象一下：你锁了微信，别人打不开。但一条消息弹出来，通知栏赫然显示「老婆：今晚早点回来」……锁了个寂寞。</p>
<p>Android 17 想到了这一层。</p>
<p><strong>根据报道，系统采用了「分类屏蔽」策略：</strong></p>




















<table><thead><tr><th>应用类型</th><th>通知显示内容</th><th>隐藏内容</th></tr></thead><tbody><tr><td><strong>即时通讯类</strong>（如 Google Messages）</td><td>仅显示「新消息」</td><td>发送者、聊天内容全部隐藏</td></tr><tr><td><strong>其他应用</strong></td><td>仅显示「新通知」</td><td>具体通知内容全部隐藏</td></tr></tbody></table>
<p>这意味着：</p>
<ul>
<li>• 通知提醒<strong>依然存在</strong>，你不会错过重要消息</li>
<li>• 但任何人<strong>看不到具体内容</strong>，隐私被彻底保护</li>
</ul>
<p>至于被锁应用的名称和图标是否也会在通知中隐藏，目前尚未确定。参考其他厂商的做法，Google 极有可能采取折中方案——<strong>保留来源标识，隐藏具体内容</strong>。</p>
<h2 data-id="heading-2">和小米应用锁的正面对比</h2>
<p>说到应用锁，小米可能是做得最早、最完善的国产厂商之一。从 MIUI 时代到现在的 HyperOS，应用锁已经是一套成熟的隐私体系了。</p>
<p>那 Android 17 的原生方案和小米比，差在哪？又强在哪？</p>


















































<table><thead><tr><th>对比维度</th><th>Android 17 原生应用锁</th><th>小米 HyperOS 应用锁</th></tr></thead><tbody><tr><td><strong>启用方式</strong></td><td>长按图标 → 锁定应用</td><td>设置 → 应用设置 → 应用锁</td></tr><tr><td><strong>认证方式</strong></td><td>PIN / 密码 / 生物识别</td><td>手势密码 / PIN / 指纹 / 面部</td></tr><tr><td><strong>通知内容隐藏</strong></td><td>系统级智能屏蔽（分类策略）</td><td>支持，锁屏自动隐藏推送内容</td></tr><tr><td><strong>隐藏应用</strong></td><td>暂未确认</td><td>支持，双指滑动唤出隐藏空间</td></tr><tr><td><strong>独立密码</strong></td><td>使用设备锁屏密码</td><td>可设置独立于锁屏的应用锁密码</td></tr><tr><td><strong>生态覆盖</strong></td><td>所有 Android 17 设备通用</td><td>仅限小米 / Redmi 设备</td></tr><tr><td><strong>第三方应用依赖</strong></td><td>无需任何第三方应用</td><td>无需任何第三方应用</td></tr><tr><td><strong>可定制性</strong></td><td>较基础（目前已知信息）</td><td>高度定制，支持时间锁、位置锁等</td></tr></tbody></table>
<p><strong>小米的优势：</strong></p>
<p>小米应用锁经过多年迭代，功能远不止「锁住一个 App」那么简单：</p>
<ul>
<li>• <strong>隐藏应用</strong>：不光锁住，还能从桌面彻底隐藏，双指滑动才能唤出</li>
<li>• <strong>独立密码</strong>：应用锁密码可以和锁屏密码不同，防止「知道锁屏密码就能打开一切」</li>
<li>• <strong>细粒度控制</strong>：可以按时间段、按场景灵活配置</li>
</ul>
<p><strong>Android 17 的优势：</strong></p>
<ul>
<li>• <strong>系统级统一标准</strong>：所有搭载 Android 17 的设备都能用，Pixel、三星、一加、摩托罗拉……不再是某个品牌的专属</li>
<li>• <strong>通知屏蔽更智能</strong>：分类屏蔽策略是系统级实现，第三方 App 无法绕过</li>
<li>• <strong>生态联动潜力</strong>：作为原生功能，天然具备与 Wear OS、Android Auto 等平台联动的能力</li>
</ul>
<h2 data-id="heading-3">对用户意味着什么？</h2>
<h3 data-id="heading-4">对原生 Android 用户：久旱逢甘霖</h3>
<p>Pixel、摩托罗拉、Nokia 等品牌的用户，终于不用再忍受「裸奔」的隐私状态。一个简单的长按操作，就能锁住敏感应用，不需要安装任何第三方工具。</p>
<h3 data-id="heading-5">对小米等国产手机用户：锦上添花</h3>
<p>小米的应用锁不会消失，反而会因为 Android 17 的原生支持而<strong>变得更强</strong>。原生框架提供了通知屏蔽的底层能力，小米可以在此基础上叠加自己的「隐藏应用」「独立密码」等高级功能，形成<strong>1 + 1 &gt; 2</strong> 的效果。</p>
<h2 data-id="heading-6">什么时候能用上？</h2>
<ul>
<li>• <strong>代号：</strong> Cinnamon Bun（肉桂卷）</li>
<li>• <strong>Developer Preview：</strong> 预计 2026 年 Q1-Q2</li>
<li>• <strong>正式发布：</strong> 预计 2026 年 6 月 Google I/O 大会后</li>
<li>• <strong>首批支持：</strong> Pixel 6 及以上机型</li>
</ul>
<p>需要注意的是，目前曝光的功能来自 Canary 测试版本的代码，<strong>仅代表原型阶段</strong>，最终正式版可能会有调整。</p>
<h2 data-id="heading-7">写在最后</h2>
<p>应用锁这个功能，国产厂商做了很多年，做得很好。但问题是——<strong>它一直是碎片化的</strong>。</p>
<p>小米有小米的方案，三星有三星的方案，OPPO 有 OPPO 的方案。每家的实现逻辑不同，通知处理方式不同。</p>
<p>Android 17 把应用锁拉到系统原生层，最大的意义不在于「Pixel 用户终于能用了」，而在于：</p>
<p><strong>它为整个 Android 生态提供了一个统一的隐私保护基准线。</strong></p>
<p>在这个基准线之上，各厂商可以继续发挥，做出更丰富的定制化功能。但至少，每一台 Android 17 设备，都有了一个靠谱的底线保障。</p>
<p>这才是原生的力量。</p>
<p><strong>你觉得原生应用锁够用了，还是更喜欢小米的深度定制方案？评论区说说你的选择。</strong></p>
<p>觉得有用的话，点个「在看」转发给你身边的 Android 用户吧~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[企业级 Prompt 工程实战指南（上）：别让模糊指令浪费你的AI算力]]></title>    <link>https://juejin.cn/post/7604678037808316452</link>    <guid>https://juejin.cn/post/7604678037808316452</guid>    <pubDate>2026-02-10T00:59:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604678037808316452" data-draft-id="7604693038439055366" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="企业级 Prompt 工程实战指南（上）：别让模糊指令浪费你的AI算力"/> <meta itemprop="keywords" content="前端,Cursor,人工智能"/> <meta itemprop="datePublished" content="2026-02-10T00:59:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="乘风gg"/> <meta itemprop="url" content="https://juejin.cn/user/4248168658899741"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            企业级 Prompt 工程实战指南（上）：别让模糊指令浪费你的AI算力
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4248168658899741/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    乘风gg
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T00:59:21.000Z" title="Tue Feb 10 2026 00:59:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">企业级 Prompt 工程实战指南（上）：别让模糊指令浪费你的AI算力</h2>
<h3 data-id="heading-1">一、引言：80% 的人都踩坑！把 Prompt 当 “聊天”</h3>
<p><strong>Prompt（提示词</strong>）技术作为连接人类需求与大语言模型（LLM）能力的关键桥梁，已经是家常便饭了。但在一线实践中，我发现 <strong>80%</strong> 的使用者和开发者都陷入了一个误区：把 Prompt 简单等同于日常聊天，随意地输入指令，期待模型给出完美答案。结果呢？输出要么跑题万里，要么逻辑混乱，甚至出现重复冗余的废话。这不仅浪费了大量的算力资源，更严重制约了 AI 应用在实际业务中的落地效果。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/441e2139d29245128f3af75dc52831d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LmY6aOOZ2c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771289992&amp;x-signature=V48zXdyVxtGuU3BmKFGJKAK%2BPvE%3D" alt="" loading="lazy"/></p>
<p>举个简单例子，一家电商企业希望利用 AI 生成产品推广文案。运营人员直接在对话框输入 “<strong>给我写个手机推广文案</strong>”，得到的却是一篇毫无针对性、平淡无奇的内容，完全无法吸引目标客户。为什么会这样？因为模型没有得到明确的指令、必要的产品信息以及目标受众描述，只能在宽泛的语言空间里 “瞎猜”。</p>
<p>本文将结合我的实战经验，以<strong>工程化</strong>的视角深入剖析 Prompt 设计的<strong>底层逻辑、核心技巧与落地策略</strong>。希望帮助大家从 “<strong>凭感觉写提示词</strong>” 的初级阶段，迈向 “<strong>用工程思维构建高效 Prompt 体系</strong>” 的新阶段，充分释放大语言模型的潜力。</p>
<h3 data-id="heading-2">二、Prompt 的底层逻辑：AI 的 “岗位说明书”+“任务清单”</h3>
<h4 data-id="heading-3">2.1 核心定义：Prompt 是人类与大模型的 “交互接口”</h4>
<p>从技术本质看，Prompt 是引导大语言模型输出特定结果的结构化指令，其作用类似于给 AI 下达 “<strong>岗位说明书</strong>”（系统 Prompt）和 “<strong>具体任务清单</strong>”（用户 Prompt）。</p>
<p>大模型作为 “概率机器”，其输出质量完全取决于输入指令的清晰度与结构化程度，这也是 Prompt 工程的核心价值所在。如果把大语言模型比作一个能力超强但没有自主意识的 “<strong>超级员工</strong>”，那么 Prompt 就是我们向它传达工作要求的唯一方式。</p>
<p>这个 “<strong>员工</strong>” 虽然拥有海量的<strong>知识储备和强大的语言</strong>处理能力，<strong>但它并不知道我们想要什么</strong>，除非我们用清晰、准确的指令告诉它。</p>
<h4 data-id="heading-4">2.2 两大核心组件：System Prompt 与 User Prompt</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1838b6b1595486baa616a4f9b26b7f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LmY6aOOZ2c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771289992&amp;x-signature=xGG9tBHvaQ893yeQYhYZTn4X9hM%3D" alt="" loading="lazy"/>
<strong>System Prompt</strong> 负责定义 AI 的角色、能力边界与输出规则，是全局约束，优先级高于用户输入；<strong>User Prompt</strong> 则是具体任务需求，包含上下文、目标与格式要求。二者结合构成完整的指令集。以电商客服场景为例</p>
<ul>
<li>系统 Prompt：你是资深电商客服，仅处理售后问题；</li>
<li>用户 Prompt：我的无线耳机充不进电，如何换货”，</li>
</ul>
<p>这两个部分缺一不可。系统 Prompt 为 AI 设定了身份和职责范围，确保它不会偏离售后客服的角色去回答其他无关问题；而用户 Prompt 则明确了具体的任务内容，让 AI 能够针对性地提供解决方案。</p>
<p>如果只有用户 Prompt，AI 可能会因为缺乏角色定位而给出不专业或不相关的回答；反之，如果只有系统 Prompt，没有具体的用户需求，AI 就不知道该从何下手。</p>
<h4 data-id="heading-5">2.3 Prompt 四大核心要素：角色、背景信息、任务、约束</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae4b7925e20e4230bdef9a846b60437e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LmY6aOOZ2c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771289992&amp;x-signature=EdV6eHAK1louoxPaCY0zT8zgxwE%3D" alt="" loading="lazy"/></p>
<p>Prompt 工程的核心，本质是把模糊需求转化为模型可精准解读的“结构化指令”，而角色、背景信息、任务、约束这四大要素，就是构成指令的“四大基石”——缺少任何一个，都可能导致指令模糊、输出失控。这四大要素并非孤立存在，而是相互支撑，共同定义了“<strong>AI 该如何做、做什么、依据什么做、不能做什么</strong>”，是从“<strong>凭感觉写提示</strong>”到“<strong>工程化设计</strong>”的关键转变。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08bf55be62af4ecbac5cfb8b884ed2aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LmY6aOOZ2c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771289992&amp;x-signature=x8s9oo2zq5qKvRftL1VuCrht8cE%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-6">2.3.1 核心一：角色——给 AI 定“身份”</h5>
<p>角色是 Prompt 的“灵魂”，核心作用是明确 AI 的身份、专业度和语气风格，相当于给“超级员工”定岗位，让它知道自己该以何种视角回应需求。很多开发者忽略角色设定，导致 AI 输出“不接地气”“不专业”，本质就是角色模糊。</p>
<p><strong>实战案例</strong>：同样是“解读产品故障”，不同角色的输出天差地别。若不设定角色，Prompt 为“解读耳机充不进电的原因”，AI 可能输出晦涩的技术术语；若设定角色为“资深电商售后工程师，面向普通消费者，用通俗语言解读，避免专业术语”，AI 会输出“大概率是充电线接触不良或充电口有灰尘，你先换一根充电线试试，再用棉签清理下充电口”，更贴合业务需求。</p>
<p><strong>常见误区</strong>：角色设定过于宽泛（如“专业人士”），未明确具体领域和沟通对象，导致 AI 输出偏离预期。</p>
<h5 data-id="heading-7">2.3.2 核心二：背景信息——给 AI 补“上下文”</h5>
<p><strong>背景信息</strong>是 AI 决策的“依据”，核心是提供任务相关的上下文、前提条件和关键信息。让它知道“为什么做”“基于什么做”。缺少背景信息，AI 只能依赖预训练知识猜测，易出现“幻觉”或偏离业务场景。</p>
<p><strong>实战案例</strong>：结合前文工单分类场景，若 Prompt 仅设定角色和任务（“电商售后工单分类专家，分类工单”），未提供背景信息，AI 可能无法区分“物流延迟”和“产品故障”的边界；若补充背景信息“本电商平台主营3C产品，物流合作快递公司为中通、圆通，售后工单主要涉及物流配送、产品质量、退换货三类场景”，AI 分类准确率会大幅提升，避免将“中通快递延迟”误判为“产品故障”。</p>
<p><strong>关键原则</strong>：背景信息无需冗余，只需提炼“与任务直接相关”的核心信息，优先补充“业务场景、行业规则、前提条件”，避免无关信息占用 token。</p>
<h5 data-id="heading-8">2.3.3 核心三：任务——给 AI 下“指令”</h5>
<p><strong>任务</strong>是 Prompt 的“核心目标”，核心是明确 AI 要完成的具体工作，必须清晰、具体、不能模糊。这是四大要素中最基础、也最容易踩坑的部分，前文提到的“随便发挥”误区，本质就是任务设定模糊。</p>
<p><strong>实战对比</strong>：模糊任务 Prompt 为“优化产品描述”，AI 输出大概率杂乱无章；精准任务 Prompt 为“优化3C产品（无线耳机）的产品描述，突出‘续航20小时’‘降噪深度40dB’两大核心卖点，面向年轻消费者，语言简洁有感染力，控制在150字内”，AI 输出会更具针对性。</p>
<p><strong>核心技巧</strong>：任务设定需遵循“可量化、可落地”，避免使用“更好、更专业、更生动”等模糊表述，明确“做什么、做到什么程度、输出什么形式”。</p>
<h5 data-id="heading-9">2.3.4 核心四：约束——给 AI 划“边界”</h5>
<p><strong>约束的核心</strong>是明确 AI 的输出边界、禁止行为和格式要求，让它知道“不能做什么”。缺少约束，即使角色、背景、任务明确，AI 也可能输出冗余、偏离格式或不符合业务规则的内容。</p>
<p><strong>实战案例</strong>：仍以工单分类场景为例，若仅设定任务“生成工单摘要”，未加约束，AI 可能生成100字以上的冗余内容，不便于客服快速查看；若补充约束“摘要控制在50字内，仅包含用户核心诉求、涉及产品和关键时间，禁止冗余表述，不添加解决方案”，AI 输出会严格符合业务需求，如“用户昨日收到衣服，尺码不符，咨询换货寄回流程”。</p>
<p><strong>常见约束类型</strong>：格式约束（如“输出为JSON格式”“分点罗列”）、内容约束（如“禁止使用专业术语”“不添加无关建议”）、篇幅约束（如“控制在200字内”）、边界约束（如“仅处理售后问题，不回答售前咨询”）。</p>
<p>四大要素总结：<strong>工作角色、工作背景资料、工作任务目标、工作规矩</strong>，四大要素协同作用，才能构成一份高质量的 Prompt。</p>
<h3 data-id="heading-10">三、避坑指南：四大典型 Prompt 误区及优化方案</h3>
<h4 data-id="heading-11">3.1 误区一：“随便发挥”</h4>
<p><strong>错误示例</strong>：“写点推荐文案”。这种过于宽泛的指令，就像让一个厨师 “做点好吃的”，却不告诉他菜系、食材和用餐人数，结果必然是输出失控。由于缺少角色、场景、受众等关键约束，AI 无法准确把握需求，输出的文案可能风格混杂、主题模糊，无法满足任何实际业务需求。</p>
<p><strong>优化方案</strong>：明确 “角色 + 场景 + 目标 + 格式”。以推荐文案为例，优化后的 Prompt 可以是 “<strong>你是小红书文案策划，为注重健康的都市白领写 100 字内无糖苏打饮料推荐文案，风格活泼有生活感</strong>”。这样详细的指令，从根源上避免了 AI 的 “自由发挥”，让它能够聚焦于目标受众和具体需求，生成符合预期的内容。通过清晰的角色设定（小红书文案策划）、场景描述（面向注重健康的都市白领）、目标界定（推荐无糖苏打饮料）和格式要求（100 字内、活泼有生活感），AI 能够更好地理解任务，输出更有针对性和吸引力的文案。</p>
<h4 data-id="heading-12">3.2 误区二：多目标并行</h4>
<p><strong>错误示例</strong>：“写会议纪要 + 行动清单 + 邮件模板”。在这个指令中，单一 Prompt 包含了三个独立且复杂的任务，这对于模型来说就像同时接到三个不同客户的订单，却没有明确的优先级和处理流程，很容易导致输出结构混乱、顾此失彼。模型可能会在不同任务之间来回切换，无法深入处理每个任务，最终生成的会议纪要缺乏重点、行动清单逻辑不清晰、邮件模板格式错误。</p>
<p><strong>优化方案</strong>：拆分任务或结构化指令。一种方法是<strong>将任务分步骤进行，先让模型生成会议纪要，再基于纪要生成行动清单，最后根据前两者生成邮件模</strong>板；另一种方法是在 Prompt 中明确要求 “分别输出 3 部分内容：<strong>1. 会议纪要；2. 行动清单；3. 全员通知邮件模板</strong>”，并对每部分的内容和格式进行详细说明。这样可以降低模型的处理复杂度，使其能够专注于每个任务，提高输出的质量和准确性。通过结构化的指令，模型能够更好地组织思路，按照要求依次完成各个任务，生成逻辑连贯、结构清晰的结果。</p>
<h4 data-id="heading-13">3.3 误区三：“专业一点”</h4>
<p>“更有感觉”“更专业”“更生动” 等模糊表述是 AI 的 “死敌”。因为这些表述缺乏量化标准，模型无法判断需求边界。例如，当我们要求 “把简介写得更专业” 时，不同的人对 “专业” 的理解可能千差万别，模型也只能在模糊的概念中挣扎，无法确定具体的修改方向和程度。这种模糊指令会导致模型输出的结果要么过于平淡，没有达到预期的专业度；要么过于夸张，偏离了实际需求。</p>
<p><strong>优化方案</strong>：具象化要求。将 “把简介写得更专业” 改为 “<strong>将公司简介重写为企业官网版本，语言突出权威性与行业属性，面向制造业客户</strong>”，这样的指令明确了具体的应用场景（企业官网 ）、语言风格（突出权威性与行业属性）和目标受众（制造业客户），让模型能够有针对性地进行创作。通过具象化的描述，模型能够更好地理解用户对 “专业” 的期望，从语言表达、内容组织等方面进行优化，生成更符合专业要求的公司简介。</p>
<h4 data-id="heading-14">3.4 误区四：指代不明</h4>
<p><strong>错误示例</strong>：“把它优化一下”。这个指令中的 “它” 指代不明，模型无法确定优化的对象是一段文字、一个设计还是其他内容。同时，由于缺乏上下文，模型也不知道优化的方向和重点，是要改进语法错误、提升逻辑清晰度还是增强内容的吸引力？这种指代不明和上下文缺失的指令，会让模型陷入困惑，无法准确理解用户的意图，从而生成错误或不相关的结果。</p>
<p><strong>优化方案</strong>：补充完整信息。如果是要优化节能冰箱的产品描述，可以这样表述：“优<strong>化以下节能冰箱产品描述，突出其 24 小时耗电 0.5 度的环保优势，适用于环保类公众号，语气亲切真实”。这样的指令明确了优化对象（节能冰箱产品描述）、优化重点（突出 24 小时耗电 0.5 度的环保优势）、应用场景（环保）和语言风格（语气亲切真实）</strong>，消除了指令中的歧义，让模型能够根据具体要求进行有针对性的优化。通过补充完整的上下文信息，模型能够更好地理解用户的需求，从多个维度对产品描述进行优化，提高其在特定场景下的吸引力和有效性。</p>
<hr/>
<h3 data-id="heading-15">下篇预告</h3>
<p>掌握了 Prompt 的底层逻辑与避坑技巧，如何在实际业务中落地？下篇将带来完整实战案例（<strong>电商工单自动分类与摘要生成</strong>）、<strong>三大 Prompt 技术路径对比</strong>、<strong>工程化落地策略</strong>，以及<strong>目前趋势展望</strong>！</p>
<p>欢迎大家点赞关注，下期更精彩！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[秒杀系统如何避免账户余额扣减的竞态条件？]]></title>    <link>https://juejin.cn/post/7604672395627118619</link>    <guid>https://juejin.cn/post/7604672395627118619</guid>    <pubDate>2026-02-10T01:00:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604672395627118619" data-draft-id="7604672395626545179" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="秒杀系统如何避免账户余额扣减的竞态条件？"/> <meta itemprop="keywords" content="后端,Java,Redis"/> <meta itemprop="datePublished" content="2026-02-10T01:00:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="雨中飘荡的记忆"/> <meta itemprop="url" content="https://juejin.cn/user/694547077666606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            秒杀系统如何避免账户余额扣减的竞态条件？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547077666606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    雨中飘荡的记忆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T01:00:41.000Z" title="Tue Feb 10 2026 01:00:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">秒杀系统如何避免账户余额扣减的竞态条件？</h2>
<blockquote>
<p>从理论到实践，深入解析并发控制机制在秒杀场景中的应用</p>
</blockquote>
<h3 data-id="heading-1">一、什么是竞态条件？</h3>
<h4 data-id="heading-2">1.1 定义与场景</h4>
<p>在并发编程中，当多个线程或进程同时访问和修改共享资源时，最终的执行结果依赖于执行顺序的现象称为<strong>竞态条件（Race Condition）</strong>。</p>
<h4 data-id="heading-3">1.2 一个真实的例子</h4>
<p>想象这样的场景：用户账户余额100元，两个线程同时扣减50元。</p>
<p><strong>期望结果</strong>：100 - 50 - 50 = 0元</p>
<p><strong>实际结果</strong>：账户余额还剩50元，丢失了50元的更新！</p>
<h4 data-id="heading-4">1.3 问题分析</h4>
<p><strong>原因</strong>：</p>
<ol>
<li>线程A读取余额：100元</li>
<li>线程B读取余额：100元（此时线程A还未提交）</li>
<li>线程A计算并更新：100 - 50 = 50元</li>
<li>线程B计算并更新：100 - 50 = 50元</li>
<li>线程B的更新覆盖了线程A的更新</li>
</ol>
<p>这就是典型的**丢失更新（Lost Update）**问题。</p>
<h4 data-id="heading-5">1.4 竞态条件流程图</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b2448a1d96c4eaf838ad799e1c266ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771290044&amp;x-signature=VW7mVSLhCeRyyaqxUFJZpwQGvD4%3D" alt="" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-6">二、解决方案一：悲观锁</h3>
<h4 data-id="heading-7">2.1 什么是悲观锁？</h4>
<p>悲观锁假设会发生并发冲突，因此在访问数据前先获取锁。</p>
<p><strong>核心思想</strong>：先获取锁，再操作数据</p>
<h4 data-id="heading-8">2.2 数据库实现方式</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查询时加排他锁</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;

<span class="hljs-comment">-- 更新余额</span>
<span class="hljs-keyword">UPDATE</span> account <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">-</span> <span class="hljs-number">50</span> <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

<span class="hljs-comment">-- 提交事务释放锁</span>
<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<h4 data-id="heading-9">2.3 Java代码实现</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">deductBalancePessimistic</span><span class="hljs-params">(Long userId, Long amount)</span> {
    <span class="hljs-comment">// 1. 查询并加锁</span>
    <span class="hljs-type">Account</span> <span class="hljs-variable">account</span> <span class="hljs-operator">=</span> accountMapper.selectById(userId);

    <span class="hljs-comment">// 2. 检查余额</span>
    <span class="hljs-keyword">if</span> (account.getBalance().compareTo(amount) &lt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-comment">// 3. 扣减余额</span>
    account.setBalance(account.getBalance().subtract(amount));
    <span class="hljs-keyword">return</span> accountMapper.updateById(account) &gt; <span class="hljs-number">0</span>;
}
</code></pre>
<h4 data-id="heading-10">2.4 悲观锁的优缺点</h4>
<p><strong>优点</strong>：</p>
<ul>
<li>实现简单，逻辑直观</li>
<li>强一致性保证</li>
<li>适合高冲突场景</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>并发性能低，线程阻塞等待</li>
<li>数据库压力大</li>
<li>可能发生死锁</li>
</ul>
<p><strong>适用场景</strong>：</p>
<ul>
<li>并发量不高的场景</li>
<li>强一致性要求的场景</li>
<li>冲突率高的写操作</li>
</ul>
<h4 data-id="heading-11">2.5 生产环境最佳实践</h4>
<p><strong>缩小锁粒度</strong>：只锁定必要的数据，避免锁定整个用户对象</p>
<p><strong>控制事务时间</strong>：事务内只做数据库操作，远程调用放到事务外</p>
<p><strong>批量操作</strong>：合并多个单次更新为批量更新，减少锁竞争</p>
<hr/>
<h3 data-id="heading-12">三、解决方案二：乐观锁</h3>
<h4 data-id="heading-13">3.1 什么是乐观锁？</h4>
<p>乐观锁假设不会发生并发冲突，只在提交时检查。</p>
<p><strong>核心思想</strong>：假设无冲突，提交时检查版本号</p>
<h4 data-id="heading-14">3.2 版本号机制实现</h4>
<p><strong>数据库表设计</strong>：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> account (
    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    user_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    balance <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">20</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    version <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,  <span class="hljs-comment">-- 乐观锁版本号</span>
    update_time DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>
);
</code></pre>
<p><strong>SQL更新语句</strong>：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- CAS更新</span>
<span class="hljs-keyword">UPDATE</span> account
<span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">-</span> <span class="hljs-number">50</span>, version <span class="hljs-operator">=</span> version <span class="hljs-operator">+</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> version <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
</code></pre>
<h4 data-id="heading-15">3.3 Java代码实现（带重试）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">deductBalanceOptimistic</span><span class="hljs-params">(Long userId, Long amount)</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">maxRetries</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;
    <span class="hljs-type">int</span> <span class="hljs-variable">retryCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

    <span class="hljs-keyword">while</span> (retryCount &lt; maxRetries) {
        <span class="hljs-comment">// 1. 查询账户（获取当前版本号）</span>
        <span class="hljs-type">Account</span> <span class="hljs-variable">account</span> <span class="hljs-operator">=</span> accountMapper.selectById(userId);

        <span class="hljs-keyword">if</span> (account.getBalance().compareTo(amount) &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-comment">// 2. CAS更新（比较并交换）</span>
        <span class="hljs-type">Account</span> <span class="hljs-variable">updateAccount</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Account</span>();
        updateAccount.setId(account.getId());
        updateAccount.setBalance(account.getBalance().subtract(amount));
        updateAccount.setVersion(account.getVersion());

        <span class="hljs-type">int</span> <span class="hljs-variable">rows</span> <span class="hljs-operator">=</span> accountMapper.updateById(updateAccount);

        <span class="hljs-keyword">if</span> (rows &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// 更新成功</span>
        }

        <span class="hljs-comment">// 3. 更新失败，版本号已变化，重试</span>
        retryCount++;
        Thread.sleep(Math.min(<span class="hljs-number">100L</span> * (<span class="hljs-number">1L</span> &lt;&lt; retryCount), <span class="hljs-number">1000L</span>));
    }

    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<h4 data-id="heading-16">3.4 乐观锁的优缺点</h4>
<p><strong>优点</strong>：</p>
<ul>
<li>并发性能高，无锁操作</li>
<li>不会发生死锁</li>
<li>数据库压力小</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>高冲突下频繁重试，性能下降</li>
<li>可能ABA问题（可加版本号解决）</li>
<li>需要处理重试逻辑</li>
</ul>
<p><strong>适用场景</strong>：</p>
<ul>
<li>并发量高的场景</li>
<li>冲突率低的场景</li>
<li>读多写少的场景</li>
</ul>
<h4 data-id="heading-17">3.5 生产环境最佳实践</h4>
<p><strong>动态重试次数</strong>：根据历史冲突率动态调整重试次数（3-10次）</p>
<p><strong>快速失败策略</strong>：第一次冲突后立即返回错误，让调用方决定是否重试</p>
<p><strong>指数退避</strong>：重试等待时间按指数增长（100ms → 200ms → 400ms...）</p>
<hr/>
<h3 data-id="heading-18">四、解决方案三：Redis分布式锁</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7b7264ed4d94780ac78c2dad041ea08~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771290044&amp;x-signature=HmRZO0JY%2FfUBmy2cMXtkMBr79Eg%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-19">4.1 为什么需要分布式锁？</h4>
<p>在分布式系统中，JVM锁只能锁住当前JVM实例，无法跨服务节点。</p>
<h4 data-id="heading-20">4.2 Redis SET命令实现</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 加锁命令</span>
SET lock_key unique_value NX PX 30000

<span class="hljs-comment"># 参数说明：</span>
<span class="hljs-comment"># NX: 不存在才设置</span>
<span class="hljs-comment"># PX: 过期时间（毫秒）</span>
<span class="hljs-comment"># unique_value: 唯一标识，防止误删</span>
</code></pre>
<h4 data-id="heading-21">4.3 解锁Lua脚本（保证原子性）</h4>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-keyword">if</span> redis.call(<span class="hljs-string">"get"</span>, KEYS[<span class="hljs-number">1</span>]) == ARGV[<span class="hljs-number">1</span>] <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">return</span> redis.call(<span class="hljs-string">"del"</span>, KEYS[<span class="hljs-number">1</span>])
<span class="hljs-keyword">else</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h4 data-id="heading-22">4.4 Java代码实现（Redisson）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> RedissonClient redissonClient;

<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">deductBalanceWithDistributedLock</span><span class="hljs-params">(Long userId, Long amount)</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"account:lock:"</span> + userId;
    <span class="hljs-type">RLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> redissonClient.getLock(lockKey);

    <span class="hljs-type">boolean</span> <span class="hljs-variable">acquired</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 尝试获取锁</span>
        acquired = lock.tryLock(<span class="hljs-number">10</span>, <span class="hljs-number">30</span>, TimeUnit.SECONDS);

        <span class="hljs-keyword">if</span> (!acquired) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-comment">// 执行业务逻辑</span>
        <span class="hljs-type">Account</span> <span class="hljs-variable">account</span> <span class="hljs-operator">=</span> accountMapper.selectById(userId);
        <span class="hljs-keyword">if</span> (account.getBalance().compareTo(amount) &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        account.setBalance(account.getBalance().subtract(amount));
        <span class="hljs-keyword">return</span> accountMapper.updateById(account) &gt; <span class="hljs-number">0</span>;

    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">if</span> (acquired &amp;&amp; lock.isHeldByCurrentThread()) {
            lock.unlock();
        }
    }
}
</code></pre>
<h4 data-id="heading-23">4.5 Redis分布式锁的关键点</h4>
<ol>
<li><strong>NX参数</strong>：只有key不存在时才设置，防止覆盖</li>
<li><strong>PX参数</strong>：设置过期时间，防止死锁</li>
<li><strong>unique_value</strong>：唯一标识，防止误删其他线程的锁</li>
<li><strong>Lua脚本</strong>：保证解锁操作的原子性</li>
<li><strong>看门狗</strong>：Redisson自动续期，防止业务未执行完锁过期</li>
<li><strong>RedLock</strong>：多节点部署，提高可用性</li>
</ol>
<h4 data-id="heading-24">4.6 生产环境最佳实践</h4>
<p><strong>超时时间设置</strong>：根据业务类型设置合理的超时时间（通常为历史平均执行时间的3-5倍）</p>
<p><strong>可重入性</strong>：同一线程可多次获取同一把锁，避免死锁</p>
<p><strong>监控告警</strong>：监控锁持有时间、等待时间，设置告警阈值</p>
<hr/>
<h3 data-id="heading-25">五、三种锁的详细对比</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3423497cec804a72989043b70008d028~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771290044&amp;x-signature=CI89AwGCCvvfAEOWOEE4lKOmra8%3D" alt="" loading="lazy"/></p>

































































<table><thead><tr><th>对比维度</th><th>悲观锁</th><th>乐观锁</th><th>分布式锁</th></tr></thead><tbody><tr><td>低并发场景</td><td>性能接近</td><td>性能接近</td><td>性能接近</td></tr><tr><td>高并发场景</td><td>锁竞争严重</td><td>性能更优</td><td>性能较好</td></tr><tr><td>冲突率高</td><td>适合</td><td>频繁重试</td><td>适合</td></tr><tr><td>冲突率低</td><td>浪费锁资源</td><td>最佳选择</td><td>性能好</td></tr><tr><td>CPU消耗</td><td>低</td><td>高(CAS自旋)</td><td>中</td></tr><tr><td>实现复杂度</td><td>简单</td><td>中等</td><td>中等</td></tr><tr><td>分布式支持</td><td>不支持</td><td>需额外处理</td><td>原生支持</td></tr><tr><td>死锁风险</td><td>有</td><td>无</td><td>无（带过期时间）</td></tr><tr><td>一致性保证</td><td>强</td><td>最终一致</td><td>强</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-26">六、秒杀系统架构设计</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7796fc36dc14e4c9c4ac612b2e9da11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771290044&amp;x-signature=P2nj8WPLsyUwBNSLlUEnVi0YHJM%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-27">6.1 核心设计思路</h4>
<ol>
<li><strong>Redis预扣库存</strong>：使用DECR原子操作，内存级别响应速度</li>
<li><strong>MQ异步处理</strong>：削峰填谷，订单创建异步化</li>
<li><strong>乐观锁扣减</strong>：版本号CAS机制，保证数据一致性</li>
<li><strong>分库分表</strong>：按user_id分片，水平扩展</li>
<li><strong>读写分离</strong>：1主2从，查询压力分散</li>
<li><strong>限流降级</strong>：Sentinel保护系统稳定性</li>
</ol>
<h4 data-id="heading-28">6.2 秒杀核心流程</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> SeckillResult <span class="hljs-title function_">doSeckill</span><span class="hljs-params">(Long userId, Long activityId, Integer quantity)</span> {
    <span class="hljs-comment">// 1. 检查活动状态</span>
    <span class="hljs-type">SeckillActivity</span> <span class="hljs-variable">activity</span> <span class="hljs-operator">=</span> getActivityFromCache(activityId);

    <span class="hljs-comment">// 2. 检查用户限购</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">limitKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"seckill:limit:"</span> + activityId + <span class="hljs-string">":"</span> + userId;
    <span class="hljs-type">Integer</span> <span class="hljs-variable">userBought</span> <span class="hljs-operator">=</span> (Integer) redisTemplate.opsForValue().get(limitKey);
    <span class="hljs-keyword">if</span> (userBought != <span class="hljs-literal">null</span> &amp;&amp; userBought + quantity &gt; activity.getLimitPerUser()) {
        <span class="hljs-keyword">return</span> SeckillResult.fail(<span class="hljs-string">"超过限购数量"</span>);
    }

    <span class="hljs-comment">// 3. Redis预扣库存（原子递减）</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">stockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"seckill:stock:"</span> + activityId;
    <span class="hljs-type">Long</span> <span class="hljs-variable">remainingStock</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().decrement(stockKey, quantity);

    <span class="hljs-keyword">if</span> (remainingStock == <span class="hljs-literal">null</span> || remainingStock &lt; <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// 库存不足，回滚</span>
        redisTemplate.opsForValue().increment(stockKey, quantity);
        <span class="hljs-keyword">return</span> SeckillResult.fail(<span class="hljs-string">"库存不足"</span>);
    }

    <span class="hljs-comment">// 4. 记录用户购买数量</span>
    redisTemplate.opsForValue().set(limitKey, userBought + quantity, <span class="hljs-number">1</span>, TimeUnit.HOURS);

    <span class="hljs-comment">// 5. 发送MQ消息（异步创建订单）</span>
    sendOrderMessage(userId, activity, quantity);

    <span class="hljs-comment">// 6. 返回秒杀结果</span>
    <span class="hljs-keyword">return</span> SeckillResult.success(<span class="hljs-string">"秒杀成功，请等待支付"</span>);
}
</code></pre>
<h4 data-id="heading-29">6.3 秒杀流程时序图</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41908935e4fb4362bc59b2fca3ef72ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771290044&amp;x-signature=S%2FmcWjHjG3LDFWfbf%2Fjqq6Jc1m0%3D" alt="" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-30">七、高性能架构设计</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/660673ca31ae432aae8bf4fa5c3b6651~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771290044&amp;x-signature=kfFfPeU92dc9hFsTwwq4KYG2KMc%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-31">7.1 多级缓存架构</h4>
<ul>
<li><strong>L1本地缓存</strong>：Caffeine缓存，1秒过期，减少Redis访问</li>
<li><strong>L2分布式缓存</strong>：Redis缓存，5分钟过期，共享数据</li>
<li><strong>L3数据库</strong>：MySQL持久化存储</li>
</ul>
<h4 data-id="heading-32">7.2 库存分桶策略</h4>
<p>将总库存分到多个Redis桶中，秒杀时随机选择桶扣减，降低竞争热度：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 库存预热：分10个桶</span>
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
    <span class="hljs-type">String</span> <span class="hljs-variable">bucketKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"seckill:stock:"</span> + activityId + <span class="hljs-string">":bucket:"</span> + i;
    redisTemplate.opsForValue().set(bucketKey, totalStock / <span class="hljs-number">10</span>);
}

<span class="hljs-comment">// 秒杀扣减：随机选择桶</span>
<span class="hljs-type">int</span> <span class="hljs-variable">bucketIndex</span> <span class="hljs-operator">=</span> ThreadLocalRandom.current().nextInt(<span class="hljs-number">10</span>);
<span class="hljs-type">String</span> <span class="hljs-variable">bucketKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"seckill:stock:"</span> + activityId + <span class="hljs-string">":bucket:"</span> + bucketIndex;
redisTemplate.opsForValue().decrement(bucketKey, quantity);
</code></pre>
<h4 data-id="heading-33">7.3 限流保护</h4>
<ul>
<li><strong>QPS限流</strong>：Guava RateLimiter限制总请求量</li>
<li><strong>用户级限流</strong>：Redis + Lua实现用户维度的限流</li>
<li><strong>库存预热</strong>：提前将库存加载到Redis</li>
</ul>
<hr/>
<h3 data-id="heading-34">八、最佳实践</h3>
<h4 data-id="heading-35">8.1 高可用配置</h4>
<p><strong>数据库连接池配置</strong>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">druid:</span>
      <span class="hljs-attr">initial-size:</span> <span class="hljs-number">10</span>
      <span class="hljs-attr">min-idle:</span> <span class="hljs-number">10</span>
      <span class="hljs-attr">max-active:</span> <span class="hljs-number">100</span>
      <span class="hljs-attr">max-wait:</span> <span class="hljs-number">5000</span>
      <span class="hljs-attr">test-while-idle:</span> <span class="hljs-literal">true</span>
      <span class="hljs-attr">time-between-eviction-runs-millis:</span> <span class="hljs-number">60000</span>
</code></pre>
<p><strong>Redis连接池配置</strong>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">lettuce:</span>
      <span class="hljs-attr">pool:</span>
        <span class="hljs-attr">max-active:</span> <span class="hljs-number">50</span>
        <span class="hljs-attr">max-idle:</span> <span class="hljs-number">20</span>
        <span class="hljs-attr">min-idle:</span> <span class="hljs-number">5</span>
        <span class="hljs-attr">max-wait:</span> <span class="hljs-string">3000ms</span>
</code></pre>
<h4 data-id="heading-36">8.2 监控告警</h4>
<p><strong>关键指标</strong>：</p>
<ul>
<li>秒杀成功率</li>
<li>库存扣减P99耗时</li>
<li>Redis连接池使用率</li>
<li>数据库连接池使用率</li>
<li>MQ消息堆积量</li>
</ul>
<p><strong>告警规则</strong>：</p>
<ul>
<li>秒杀成功率 &lt; 95%</li>
<li>库存扣减P99 &gt; 100ms</li>
<li>Redis连接池使用率 &gt; 90%</li>
</ul>
<h4 data-id="heading-37">8.3 熔断降级</h4>
<p>使用Resilience4j实现熔断降级：</p>
<ul>
<li><strong>失败率阈值</strong>：50%</li>
<li><strong>慢调用阈值</strong>：3秒</li>
<li><strong>半开状态允许调用数</strong>：5次</li>
<li><strong>降级策略</strong>：保存到待处理队列，异步处理</li>
</ul>
<h5 data-id="heading-38">8.3.1 熔断器工作原理</h5>
<p>熔断器模式（Circuit Breaker Pattern）是一种保护机制，用于防止系统在某个服务出现故障时持续调用导致雪崩效应。</p>
<p><strong>三种状态</strong>：</p>
<ol>
<li>
<p><strong>关闭状态（CLOSED）</strong>：正常情况下，熔断器关闭，请求正常通过。当失败率超过阈值时，熔断器打开。</p>
</li>
<li>
<p><strong>打开状态（OPEN）</strong>：熔断器打开后，所有请求直接被拒绝，执行降级逻辑。经过一段时间后进入半开状态。</p>
</li>
<li>
<p><strong>半开状态（HALF_OPEN）</strong>：允许少量请求通过，如果这些请求成功，则关闭熔断器；如果失败，则继续打开。</p>
</li>
</ol>
<h5 data-id="heading-39">8.3.2 监控指标实现</h5>
<p><strong>核心监控指标</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MetricsService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> MeterRegistry meterRegistry;

    <span class="hljs-comment">// 秒杀成功次数计数器</span>
    <span class="hljs-keyword">private</span> Counter seckillSuccessCounter;

    <span class="hljs-comment">// 秒杀失败次数计数器</span>
    <span class="hljs-keyword">private</span> Counter seckillFailureCounter;

    <span class="hljs-comment">// 余额扣减成功次数计数器</span>
    <span class="hljs-keyword">private</span> Counter balanceDeductSuccessCounter;

    <span class="hljs-comment">// 余额扣减失败次数计数器</span>
    <span class="hljs-keyword">private</span> Counter balanceDeductFailureCounter;

    <span class="hljs-comment">/**
     * 记录秒杀成功
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recordSeckillSuccess</span><span class="hljs-params">(String activityId)</span> {
        seckillSuccessCounter.increment();
    }

    <span class="hljs-comment">/**
     * 记录余额扣减成功
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recordBalanceDeductSuccess</span><span class="hljs-params">(String lockType, Long userId)</span> {
        balanceDeductSuccessCounter.increment();
    }

    <span class="hljs-comment">/**
     * 获取监控统计数据
     */</span>
    <span class="hljs-keyword">public</span> MetricsData <span class="hljs-title function_">getMetricsData</span><span class="hljs-params">()</span> {
        <span class="hljs-type">MetricsData</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MetricsData</span>();
        data.setSeckillSuccessCount(seckillSuccessCounter.count());
        data.setSeckillFailureCount(seckillFailureCounter.count());
        data.setBalanceDeductSuccessCount(balanceDeductSuccessCounter.count());
        data.setBalanceDeductFailureCount(balanceDeductFailureCounter.count());

        <span class="hljs-comment">// 计算成功率</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> data.getSeckillSuccessCount() + data.getSeckillFailureCount();
        <span class="hljs-keyword">if</span> (total &gt; <span class="hljs-number">0</span>) {
            data.setSeckillSuccessRate((<span class="hljs-type">double</span>) data.getSeckillSuccessCount() / total * <span class="hljs-number">100</span>);
        }

        <span class="hljs-keyword">return</span> data;
    }
}
</code></pre>
<h5 data-id="heading-40">8.3.3 熔断器配置实现</h5>
<p><strong>Resilience4j熔断器配置</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CircuitBreakerConfig</span> {

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> CircuitBreakerRegistry <span class="hljs-title function_">circuitBreakerRegistry</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> CircuitBreakerRegistry.of(
            CircuitBreakerConfig.custom()
                .slidingWindowSize(<span class="hljs-number">10</span>)  <span class="hljs-comment">// 滑动窗口大小</span>
                .failureRateThreshold(<span class="hljs-number">50</span>) <span class="hljs-comment">// 失败率阈值50%</span>
                .waitDurationInOpenState(Duration.ofSeconds(<span class="hljs-number">30</span>)) <span class="hljs-comment">// 开启后等待30秒</span>
                .permittedNumberOfCallsInHalfOpenState(<span class="hljs-number">5</span>) <span class="hljs-comment">// 半开状态允许5次调用</span>
                .slowCallRateThreshold(<span class="hljs-number">50</span>) <span class="hljs-comment">// 慢调用率阈值50%</span>
                .slowCallDurationThreshold(Duration.ofSeconds(<span class="hljs-number">3</span>)) <span class="hljs-comment">// 慢调用阈值3秒</span>
                .build(),
            <span class="hljs-string">"balanceDeduct"</span>,  <span class="hljs-comment">// 余额扣减熔断器</span>
            <span class="hljs-string">"seckillService"</span>   <span class="hljs-comment">// 秒杀服务熔断器</span>
        );
    }
}
</code></pre>
<h5 data-id="heading-41">8.3.4 带熔断保护的余额扣减</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SeckillServiceWithCircuitBreaker</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> CircuitBreakerRegistry circuitBreakerRegistry;

    <span class="hljs-comment">// 待处理队列（降级时保存请求）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcurrentHashMap&lt;Long, AtomicInteger&gt; pendingRequests = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();

    <span class="hljs-comment">/**
     * 带熔断保护的余额扣减
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">deductBalanceWithCircuitBreaker</span><span class="hljs-params">(Long userId, Long amount, String lockType)</span> {
        <span class="hljs-type">CircuitBreaker</span> <span class="hljs-variable">circuitBreaker</span> <span class="hljs-operator">=</span> circuitBreakerRegistry.circuitBreaker(<span class="hljs-string">"balanceDeduct"</span>);

        <span class="hljs-keyword">return</span> Try.of(() -&gt; {
            <span class="hljs-comment">// 检查熔断器状态</span>
            <span class="hljs-keyword">if</span> (circuitBreaker.getState() == CircuitBreaker.State.OPEN) {
                log.warn(<span class="hljs-string">"熔断器已开启，执行降级策略"</span>);
                <span class="hljs-keyword">return</span> fallbackDeductBalance(userId, amount);
            }

            <span class="hljs-comment">// 正常业务逻辑</span>
            <span class="hljs-type">boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> doDeductBalance(userId, amount);

            <span class="hljs-comment">// 记录成功指标</span>
            metricsService.recordBalanceDeductSuccess(lockType, userId);

            <span class="hljs-keyword">return</span> result;

        }).recover(throwable -&gt; {
            <span class="hljs-comment">// 熔断或异常时的降级处理</span>
            log.warn(<span class="hljs-string">"执行降级处理，用户: {}"</span>, userId);
            <span class="hljs-keyword">return</span> fallbackDeductBalance(userId, amount);
        }).get();
    }

    <span class="hljs-comment">/**
     * 降级处理：保存到待处理队列
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">fallbackDeductBalance</span><span class="hljs-params">(Long userId, Long amount)</span> {
        log.info(<span class="hljs-string">"执行降级策略，保存到待处理队列，用户: {}, 金额: {}"</span>, userId, amount);
        pendingRequests.computeIfAbsent(userId, k -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>)).addAndGet(amount.intValue());
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// 返回true表示已接受请求（异步处理）</span>
    }

    <span class="hljs-comment">/**
     * 处理待处理队列中的请求
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processPendingRequests</span><span class="hljs-params">()</span> {
        log.info(<span class="hljs-string">"开始处理待处理队列，待处理用户数: {}"</span>, pendingRequests.size());

        pendingRequests.forEach((userId, amount) -&gt; {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> doDeductBalance(userId, amount.longValue());
                <span class="hljs-keyword">if</span> (success) {
                    pendingRequests.remove(userId);
                    log.info(<span class="hljs-string">"待处理请求处理成功，用户: {}"</span>, userId);
                }
            } <span class="hljs-keyword">catch</span> (Exception e) {
                log.error(<span class="hljs-string">"待处理请求处理失败，用户: {}"</span>, userId, e);
            }
        });
    }
}
</code></pre>
<h5 data-id="heading-42">8.3.5 前端监控面板实现</h5>
<p><strong>实时监控面板</strong>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c617fe602774312946e8558e97debfd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771290044&amp;x-signature=Hgc8n5bV75iqwtwhONIbf%2Bg8wOA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-43">九、总结</h3>
<h4 data-id="heading-44">9.1 三种锁的选择建议</h4>






























<table><thead><tr><th>场景</th><th>推荐方案</th><th>理由</th></tr></thead><tbody><tr><td>单机低并发</td><td>悲观锁</td><td>实现简单，数据一致性强</td></tr><tr><td>单机高并发</td><td>乐观锁</td><td>无锁竞争，性能最优</td></tr><tr><td>分布式系统</td><td>Redis分布式锁</td><td>跨节点互斥，可靠性高</td></tr><tr><td>秒杀场景</td><td>Redis + MQ + 乐观锁</td><td>结合各自优势</td></tr></tbody></table>
<h4 data-id="heading-45">9.2 性能对比数据（测试环境：8核16G，100并发线程）</h4>

































<table><thead><tr><th>锁类型</th><th>成功率</th><th>平均耗时(ms)</th><th>吞吐量(ops/s)</th><th>P99耗时(ms)</th></tr></thead><tbody><tr><td>悲观锁</td><td>100%</td><td>245.32</td><td>408</td><td>512</td></tr><tr><td>乐观锁</td><td>100%</td><td>78.21</td><td>1278</td><td>187</td></tr><tr><td>分布式锁</td><td>100%</td><td>156.45</td><td>639</td><td>321</td></tr></tbody></table>
<blockquote>
<p>本文介绍了秒杀系统中账户余额扣减的竞态条件问题，以及三种解决方案的详细对比。通过实际代码示例和架构图，帮助你理解不同锁机制的适用场景，设计出高性能高可用的秒杀系统。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[剑指offer-74、n个骰⼦的点数]]></title>    <link>https://juejin.cn/post/7604709514131128366</link>    <guid>https://juejin.cn/post/7604709514131128366</guid>    <pubDate>2026-02-09T23:10:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604709514131128366" data-draft-id="7603567912592965659" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="剑指offer-74、n个骰⼦的点数"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2026-02-09T23:10:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SevenCoding"/> <meta itemprop="url" content="https://juejin.cn/user/3261615728242467"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            剑指offer-74、n个骰⼦的点数
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3261615728242467/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SevenCoding
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T23:10:34.000Z" title="Mon Feb 09 2026 23:10:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">题目描述</h2>
<p>把 n 个骰⼦扔在地上，所有骰⼦朝上⼀⾯的点数之和为 s 。输⼊ n ，打印出 s 的所有可能的值出现的概率。</p>
<p>你需要⽤⼀个浮点数数组返回答案，其中第 i 个元素代表这 n 个骰⼦所能掷出的点数集合中第 i ⼩的那个的概率。</p>
<p>示例1：</p>
<p>输⼊: 1
输出: [0.16667,0.16667,0.16667,0.16667,0.16667,0.16667]</p>
<p>示例2</p>
<p>输⼊: 2
输出:[0.02778,0.05556,0.08333,0.11111,0.13889,0.16667,0.13889,0.11111,0.08333,0.05556,0.02778]</p>
<h2 data-id="heading-1">思路及解答</h2>
<h3 data-id="heading-2">暴力递归</h3>
<p>枚举所有骰子组合。递归计算每个骰子的点数，统计所有可能的和</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span>[] dicesProbability(<span class="hljs-type">int</span> n) {
        <span class="hljs-comment">// 骰子点数范围：n到6n，共5n+1种可能</span>
        <span class="hljs-type">int</span>[] counts = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">5</span> * n + <span class="hljs-number">1</span>];
        
        <span class="hljs-comment">// 递归统计所有可能的和</span>
        backtrack(n, <span class="hljs-number">0</span>, counts);
        
        <span class="hljs-comment">// 计算概率</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> Math.pow(<span class="hljs-number">6</span>, n);
        <span class="hljs-type">double</span>[] res = <span class="hljs-keyword">new</span> <span class="hljs-title class_">double</span>[counts.length];
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; counts.length; i++) {
            res[i] = counts[i] / total;
        }
        <span class="hljs-keyword">return</span> res;
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">backtrack</span><span class="hljs-params">(<span class="hljs-type">int</span> remain, <span class="hljs-type">int</span> sum, <span class="hljs-type">int</span>[] counts)</span> {
        <span class="hljs-keyword">if</span> (remain == <span class="hljs-number">0</span>) {
            counts[sum - remain]++; <span class="hljs-comment">// 统计和出现的次数</span>
            <span class="hljs-keyword">return</span>;
        }
        
        <span class="hljs-comment">// 当前骰子可以是1到6点</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">6</span>; i++) {
            backtrack(remain - <span class="hljs-number">1</span>, sum + i, counts);
        }
    }
}
</code></pre>
<p>如果使⽤暴⼒法，每⼀个骰⼦扔到 1 - 6 的概率都是 1/6，如果有 n 个 骰⼦，先不看重复的情况，⼀共有 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>6</mn><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">6^n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6644em;"/><span class="mord"><span class="mord">6</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span> 种情况，点数的范围是 n ~ 6n ，也就是 5n+1 种。</p>
<ul>
<li><strong>时间复杂度</strong>：O(6ⁿ)，每个骰子有6种可能，n个骰子组合数为6ⁿ</li>
<li><strong>空间复杂度</strong>：O(n)，递归调用栈的深度</li>
</ul>
<p>以上的计算复杂度实在太⾼，我们不能接受。</p>
<h3 data-id="heading-3">动态规划（推荐）</h3>
<p>其实，这道题可以⽤动态规划来处理， 1 个骰⼦的情况是已知的，⽽ 2 个骰⼦的情况呢？ 2 个骰⼦的情况，可以使⽤ 1 个骰⼦的情况推出， 3 个骰⼦的情况，可以使⽤ 2 个骰⼦的结果推出...</p>
<p><code>dp[i][j]</code>表示i个骰子和为j的出现次数</p>
<p>执行过程示例（n=2）：</p>
<pre><code class="hljs language-text" lang="text">初始化dp[1][1]=1, dp[1][2]=1, ..., dp[1][6]=1
计算dp[2][2] = dp[1][1] = 1
dp[2][3] = dp[1][2] + dp[1][1] = 2
...
dp[2][12] = dp[1][11] (不存在) + ... + dp[1][6] = 1
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span>[] dicesProbability(<span class="hljs-type">int</span> n) {
        <span class="hljs-comment">// dp[i][j]：i个骰子和为j的出现次数</span>
        <span class="hljs-type">int</span>[][] dp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[n + <span class="hljs-number">1</span>][<span class="hljs-number">6</span> * n + <span class="hljs-number">1</span>];
        
        <span class="hljs-comment">// 初始化：1个骰子的情况</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; j &lt;= <span class="hljs-number">6</span>; j++) {
            dp[<span class="hljs-number">1</span>][j] = <span class="hljs-number">1</span>;
        }
        
        <span class="hljs-comment">// 填充状态转移表</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>; i &lt;= n; i++) {            <span class="hljs-comment">// 骰子数量从2到n</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> i; j &lt;= <span class="hljs-number">6</span> * i; j++) {     <span class="hljs-comment">// 和的范围：i到6i</span>
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">k</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; k &lt;= <span class="hljs-number">6</span> &amp;&amp; k &lt; j; k++) { <span class="hljs-comment">// 最后一个骰子的点数</span>
                    dp[i][j] += dp[i - <span class="hljs-number">1</span>][j - k];
                }
            }
        }
        
        <span class="hljs-comment">// 计算概率</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> Math.pow(<span class="hljs-number">6</span>, n);
        <span class="hljs-type">double</span>[] res = <span class="hljs-keyword">new</span> <span class="hljs-title class_">double</span>[<span class="hljs-number">5</span> * n + <span class="hljs-number">1</span>];
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> n; j &lt;= <span class="hljs-number">6</span> * n; j++) {
            res[j - n] = dp[n][j] / total;
        }
        <span class="hljs-keyword">return</span> res;
    }
}
</code></pre>
<ul>
<li><strong>时间复杂度</strong>：O(n²)，外层循环n次，内层循环最多6n次</li>
<li><strong>空间复杂度</strong>：O(n²)，需要二维数组存储中间结果</li>
</ul>
<h3 data-id="heading-4">空间优化动态规划</h3>
<p>通过观察发现当前状态只依赖前一个状态，可以优化空间。通过滚动数组减少空间使用</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span>[] dicesProbability(<span class="hljs-type">int</span> n) {
        <span class="hljs-comment">// 使用两个一维数组交替更新</span>
        <span class="hljs-type">int</span>[] prev = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">6</span> * n + <span class="hljs-number">1</span>];
        <span class="hljs-type">int</span>[] curr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">6</span> * n + <span class="hljs-number">1</span>];
        
        <span class="hljs-comment">// 初始化第一个骰子</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; j &lt;= <span class="hljs-number">6</span>; j++) {
            prev[j] = <span class="hljs-number">1</span>;
        }
        
        <span class="hljs-comment">// 动态规划填充</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>; i &lt;= n; i++) {
            Arrays.fill(curr, <span class="hljs-number">0</span>); <span class="hljs-comment">// 清空当前数组</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> i; j &lt;= <span class="hljs-number">6</span> * i; j++) {
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">k</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; k &lt;= <span class="hljs-number">6</span> &amp;&amp; k &lt; j; k++) {
                    curr[j] += prev[j - k];
                }
            }
            <span class="hljs-comment">// 交换数组，准备下一轮</span>
            <span class="hljs-type">int</span>[] temp = prev;
            prev = curr;
            curr = temp;
        }
        
        <span class="hljs-comment">// 计算概率</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> Math.pow(<span class="hljs-number">6</span>, n);
        <span class="hljs-type">double</span>[] res = <span class="hljs-keyword">new</span> <span class="hljs-title class_">double</span>[<span class="hljs-number">5</span> * n + <span class="hljs-number">1</span>];
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> n; j &lt;= <span class="hljs-number">6</span> * n; j++) {
            res[j - n] = prev[j] / total;
        }
        <span class="hljs-keyword">return</span> res;
    }
}
</code></pre>
<ul>
<li><strong>时间复杂度</strong>：O(n²)，外层循环n次，内层循环最多6n次</li>
<li><strong>空间复杂度</strong>：O(n)，只保留前一轮的结果，空间从O(n²)降到O(n)</li>
</ul>
<h3 data-id="heading-5">数学公式法（多项式展开）</h3>
<p>和为s的概率对应于(x+x²+...+x⁶)ⁿ展开式中xˢ的系数</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span>[] dicesProbability(<span class="hljs-type">int</span> n) {
        <span class="hljs-comment">// 初始化多项式系数：1个骰子时各项系数为1</span>
        <span class="hljs-type">int</span>[] coeff = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">6</span> * n + <span class="hljs-number">1</span>];
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; j &lt;= <span class="hljs-number">6</span>; j++) {
            coeff[j] = <span class="hljs-number">1</span>;
        }
        
        <span class="hljs-comment">// 多项式乘法：计算(1x+1x²+...+1x⁶)^n</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>; i &lt;= n; i++) {
            <span class="hljs-type">int</span>[] newCoeff = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">6</span> * i + <span class="hljs-number">1</span>];
            <span class="hljs-comment">// 多项式乘法计算</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; j &lt;= <span class="hljs-number">6</span>; j++) {
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">k</span> <span class="hljs-operator">=</span> i - <span class="hljs-number">1</span>; k &lt;= <span class="hljs-number">6</span> * (i - <span class="hljs-number">1</span>); k++) {
                    newCoeff[k + j] += coeff[k];
                }
            }
            coeff = newCoeff;
        }
        
        <span class="hljs-comment">// 计算概率</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> Math.pow(<span class="hljs-number">6</span>, n);
        <span class="hljs-type">double</span>[] res = <span class="hljs-keyword">new</span> <span class="hljs-title class_">double</span>[<span class="hljs-number">5</span> * n + <span class="hljs-number">1</span>];
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> n; j &lt;= <span class="hljs-number">6</span> * n; j++) {
            res[j - n] = coeff[j] / total;
        }
        <span class="hljs-keyword">return</span> res;
    }
}
</code></pre>
<ul>
<li><strong>时间复杂度</strong>：O(n²)，多项式乘法计算</li>
<li><strong>空间复杂度</strong>：O(n)，存储多项式系数</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Xcode 迈入 Agent 时代 -- 肘子的 Swift 周报 #122]]></title>    <link>https://juejin.cn/post/7604694326517940275</link>    <guid>https://juejin.cn/post/7604694326517940275</guid>    <pubDate>2026-02-09T23:47:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604694326517940275" data-draft-id="7604646882014806067" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Xcode 迈入 Agent 时代  -- 肘子的 Swift 周报 #122"/> <meta itemprop="keywords" content="Swift,SwiftUI,人工智能"/> <meta itemprop="datePublished" content="2026-02-09T23:47:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="东坡肘子"/> <meta itemprop="url" content="https://juejin.cn/user/1548526032528727"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Xcode 迈入 Agent 时代  -- 肘子的 Swift 周报 #122
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1548526032528727/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    东坡肘子
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T23:47:36.000Z" title="Mon Feb 09 2026 23:47:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4a5c11e00fc47d3b11b8757d418e2f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5Z2h6IKY5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771285655&amp;x-signature=olZr9UiO5V1alT7V%2BRsCMvKRzOw%3D" alt="issue122.webp" loading="lazy"/></p>
<h2 data-id="heading-0">Xcode 迈入 Agent 时代</h2>
<p>尽管在 Xcode 26 的最初版本中，苹果就已经加入了一定的 AI 辅助编程能力，但当时的体验更像是把 ChatGPT 生硬地嵌入到 IDE 中：功能存在，却彼此割裂。与当时风头正盛的 Cursor 相比，它更像是两个时代的产物。随着 Claude Code 等 AI CLI 工具逐渐成熟，Xcode 更显得步伐迟缓，甚至让不少开发者开始怀疑：在 AI 时代，它是否还能胜任“主力 IDE”的角色。</p>
<p>26.3 版本的到来，几乎没有任何预热，却用实际行动回应了这些质疑。通过集成 Claude Code / Codex，苹果给出的答案很直接：只要策略得当，Xcode 依然是苹果生态中极具潜力的开发环境。这一次，Xcode 并没有简单地塞进一个 CLI 工具面板，而是引入了一套原生的 Xcode Tools（MCP），并配合 Swift 6、SwiftUI、SwiftData 等官方技术文档，形成了高度一致、贴合最新实践的整体体验。即便对于已经熟练使用 CLI + XcodeBuildMCP + 各类 Skills 的开发者而言，这套原生方案依然具备很强的竞争力——尤其是几乎为零的配置成本，这对绝大多数开发者来说意义重大。</p>
<p>更值得注意的是，这次提供的 Xcode Tools 并不只是服务于 Xcode 本身，它们同样可以作为标准 MCP，为其他 AI 工具提供能力支持。这种开放姿态，并不完全符合外界对苹果一贯风格的印象。</p>
<p>当然，站在今天这个时间点，我们还不能断言 Xcode 已经重新回到了第一阵营。但可以肯定的是，26.3 释放了一个非常明确的信号：苹果愿意与主流工具和服务协作，去打造真正符合时代的开发体验。也正因为如此，我对下一阶段的 Siri 抱有更高的期待——很可能在 iOS 27 中，苹果会在现有 Intent 体系之外，为系统和应用提供更多标准化接口，让 AI 更自然地融入整个生态。</p>
<p>Xcode + Agent 只是起点。</p>
<p>Apple + Agent，才是更值得关注的未来。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-122%2F" target="_blank" title="https://fatbobman.com/zh/weekly/issue-122/" ref="nofollow noopener noreferrer">本期内容</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-121%2F" target="_blank" title="https://fatbobman.com/zh/weekly/issue-121/" ref="nofollow noopener noreferrer">前一期内容</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2F" target="_blank" title="https://fatbobman.com/zh/weekly/" ref="nofollow noopener noreferrer">全部周报列表</a></p>
<blockquote>
<p>🚀 <strong>《肘子的 Swift 周报》</strong></p>
<p>每周为你精选最值得关注的 Swift、SwiftUI 技术动态</p>
<ul>
<li><strong>📮 立即订阅</strong> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fweekly.fatbobman.com%2Ffatbobman" target="_blank" title="https://weekly.fatbobman.com/fatbobman" ref="nofollow noopener noreferrer">weekly.fatbobman.com</a> 获取完整内容</li>
<li><strong>👥 加入社区</strong> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fdiscord.com%2Finvite%2F7FedN5E2QQ" target="_blank" title="https://discord.com/invite/7FedN5E2QQ" ref="nofollow noopener noreferrer">Discord</a> 与 2000+ 开发者交流</li>
<li><strong>📚 深度教程</strong> | <a href="https://link.juejin.cn?target=http%3A%2F%2Ffatbobman.com" target="_blank" title="http://fatbobman.com" ref="nofollow noopener noreferrer">fatbobman.com</a> 探索 200+ 原创文章</li>
</ul>
</blockquote>
<h2 data-id="heading-1">原创</h2>
<h3 data-id="heading-2"><a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fxcode-263-claude%2F%3Futm_source%3Dfatbobman%2520weekly%2520issue%2520122%26utm_medium%3Dweb" target="_blank" title="https://fatbobman.com/zh/posts/xcode-263-claude/?utm_source=fatbobman%20weekly%20issue%20122&amp;utm_medium=web" ref="nofollow noopener noreferrer">Xcode 26.3 + Claude Agent：模型替换、MCP、Skill 与自适应配置</a></h3>
<p>Xcode 26.3 版本中苹果直接提供了对 Claude Code/Codex 的支持。自此，开发者终于可以在 Xcode 中方便的使用原生 AI Agent 了。 这两天我针对新版本进行了一系列尝试，包括如何使用最新模型、配置 MCPs/Skill/Command、以及编写自适应的 <code>CLAUDE.md</code>。本文以 Claude Code 为例，分享一些文档之外的技巧。</p>
<h2 data-id="heading-3">近期推荐</h2>
<h3 data-id="heading-4"><a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fscreensage-from-pixel-to-meta%2F%3Futm_source%3Dfatbobman%2520weekly%2520issue%2520122%26utm_medium%3Dweb" target="_blank" title="https://fatbobman.com/zh/posts/screensage-from-pixel-to-meta/?utm_source=fatbobman%20weekly%20issue%20122&amp;utm_medium=web" ref="nofollow noopener noreferrer">macOS 录屏软件开发实录：从像素抓取到元数据重现</a></h3>
<p>视频正在取代文字成为更受欢迎的表达方式，而好工具是创作的加速器。macOS 录屏软件 <a href="https://link.juejin.cn?target=https%3A%2F%2Fscreensage.pro%2Fzh" target="_blank" title="https://screensage.pro/zh" ref="nofollow noopener noreferrer">ScreenSage Pro</a> 的开发者 <a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fs1ntone" target="_blank" title="https://x.com/s1ntone" ref="nofollow noopener noreferrer">Sintone</a> 深度复盘了如何基于 ScreenCaptureKit 和 Metal 实现“录完即剪完”。从解决 SCK -3821 诡异报错，到由 ObservableObject 迁移至 @Observable 优化时间线性能，本文毫无保留地分享了从像素抓取到高性能合成的全过程。</p>
<hr/>
<h3 data-id="heading-5"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0122-05" target="_blank" title="https://l.fatbobman.com/w0122-05" ref="nofollow noopener noreferrer">哪种方式判断字符串是否在白名单里最快：Set、Array、Enum、Dictionary 还是 switch?</a></h3>
<p>在 Swift 里，判断一个字符串是否属于某个键集合，可以写成 <code>Set.contains</code>、<code>Array.contains</code>、RawRepresentable enum 的 <code>init?(rawValue:)</code>、<code>switch</code> 多分支，甚至用 <code>Dictionary</code> 来做映射。看起来差别不大，但真要放进性能敏感路径，结果可能并不完全符合直觉。<a href="https://link.juejin.cn?target=https%3A%2F%2Fmastodon.social%2F%40helge" target="_blank" title="https://mastodon.social/@helge" ref="nofollow noopener noreferrer">Helge Heß</a> 做了一次简单的基准测试：<code>Set.contains</code> 毫无悬念地领先，其次是 <code>enum(rawValue:)</code>和 <code>Dictionary</code>（两者非常接近）；而很多人下意识会高估的 <code>switch</code>，反而排在 <code>enum</code> 之后，<code>Array.contains</code> 则垫底收场。作为一个小实验，这个结果或许正好可以拿来校准一下我们对 Swift 性能的直觉。</p>
<hr/>
<h3 data-id="heading-6"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0122-01" target="_blank" title="https://l.fatbobman.com/w0122-01" ref="nofollow noopener noreferrer">从一次性付费到 Freemium (Migrating an iOS app from Paid up Front to Freemium)</a></h3>
<p>付费下载和免费 + 应用内购买是两种截然不同的商业模式，随着应用发展，开发者可能需要在两者之间转换。<a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fdonnywals" target="_blank" title="https://x.com/donnywals" ref="nofollow noopener noreferrer">Donny Wals</a> 在本文中分享了他将 Practical Core Data 应用从 $4.99 付费下载转为 freemium 的完整经历。文章不仅涵盖了 StoreKit 2 的技术实现细节（购买流程、状态管理、家庭共享），更有价值的是他对商业决策的深入思考：付费门槛虽然能筛选出认真的用户，但也阻挡了大量潜在用户体验产品价值的机会。对于教育类或工具类独立应用，freemium 可能是用户增长和收入之间更好的平衡点。</p>
<hr/>
<h3 data-id="heading-7"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0122-02" target="_blank" title="https://l.fatbobman.com/w0122-02" ref="nofollow noopener noreferrer">iOS 应用中的按需资源 (On-demand resources in iOS app)</a></h3>
<p>应用体积一直是开发者需要关注的问题，尤其是在应用包含大量图片、音频或其他资源时。尽管苹果很早就在 iOS 中提供了 On-Demand Resources（ODR）来应对这一挑战，但这一功能的存在感并不强，常被开发者忽略。在本文中，<a href="https://link.juejin.cn?target=https%3A%2F%2Ftwitter.com%2Fmecid" target="_blank" title="https://twitter.com/mecid" ref="nofollow noopener noreferrer">Majid Jabrayilov</a> 系统性地回顾了 ODR 的工作机制与使用方式，包括资源分组、标签管理、下载生命周期，以及与系统缓存策略之间的协作关系。</p>
<p>虽然苹果在推广 Background Assets 作为更现代的方案，但 ODR 在需要即时响应的按需下载、细粒度资源控制等场景下仍有其独特价值。</p>
<hr/>
<h3 data-id="heading-8"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0122-03" target="_blank" title="https://l.fatbobman.com/w0122-03" ref="nofollow noopener noreferrer">Observation 四个常见陷阱 (Objectively Better, Observably Trickier)</a></h3>
<p>在全面拥抱 Observation 框架时，开发者需要警惕其工作机制与 Combine 的 <code>@Published</code> 并不相同，简单替换往往会引入隐蔽的问题。<a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fdbolella" target="_blank" title="https://x.com/dbolella" ref="nofollow noopener noreferrer">Danny Bolella</a> 总结了迁移过程中四个常见陷阱：<code>@State</code> 持有引用类型时的非惰性初始化、嵌套 <code>@Observable</code> 对象导致的更新丢失、数组元素绑定方式的变化，以及与其他属性包装器产生的冲突。文章通过清晰的代码示例逐一给出解决方案，并反复强调一个核心原则：只有视图当前正在访问（调用 getter）的属性发生变化时，才会触发更新。理解并顺应这种“惰性观察”的思维方式，是正确使用 Observation 框架的关键。</p>
<hr/>
<h3 data-id="heading-9"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0122-04" target="_blank" title="https://l.fatbobman.com/w0122-04" ref="nofollow noopener noreferrer">在 macOS 应用中实现 Open Recent 菜单 (Add an Open Recent Menu to a SwiftUI app)</a></h3>
<p>“Open Recent” 是 macOS 应用的标准功能，但对于 SwiftUI 开发者来说，正确实现这个功能并不直观。在本文中，<a href="https://link.juejin.cn?target=https%3A%2F%2Fmastodon.world%2F%40swiftdevjournal" target="_blank" title="https://mastodon.world/@swiftdevjournal" ref="nofollow noopener noreferrer">Mark Szymczyk</a> 通过一个简洁的示例，展示了如何利用 <code>NSDocumentController</code> 为应用接入系统级的最近文件管理能力：自动维护列表、更新菜单，以及与文档生命周期的无缝协作。对于文档型或工具类应用，这是一个低成本、却能明显提升“原生感”的细节优化。</p>
<h2 data-id="heading-10">工具</h2>
<h3 data-id="heading-11"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0122-06" target="_blank" title="https://l.fatbobman.com/w0122-06" ref="nofollow noopener noreferrer">Radioform：一个原生、开源的 macOS 音频均衡器</a></h3>
<p>macOS 一直缺少系统级的音频均衡器，由 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.linkedin.com%2Fin%2Fmatthew-porteous-23847a2b2%2F" target="_blank" title="https://www.linkedin.com/in/matthew-porteous-23847a2b2/" ref="nofollow noopener noreferrer">Matthew Porteous</a> 开发的 Radioform 填补了这个空白。该项目采用 SwiftUI 菜单栏 App + Swift Host + CoreAudio HAL Driver + C++ DSP 的分层架构，把 UI 与实时音频处理彻底解耦。DSP 部分实现了 10 段参数 EQ、参数平滑、限幅与实时安全控制；工程上也有完整 CI、签名公证与 DMG 发布流程。不是“能跑就行”的 Demo，而是接近可长期维护的生产级音频工程样板。</p>
<hr/>
<h3 data-id="heading-12"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0122-07" target="_blank" title="https://l.fatbobman.com/w0122-07" ref="nofollow noopener noreferrer">CircuitPro：macOS 原生的 PCB 设计工具</a></h3>
<p>这是一个 macOS 原生应用较少涉足的领域：PCB 设计。CircuitPro 是一款面向 macOS 的 PCB EDA 工具，目标是把原理图、布局与元件库流程做成更符合 Apple 平台习惯的体验。（项目仍处于早期开发阶段）</p>
<p>项目里最吸引我的是自研的 CanvasKit。它更像一个面向 EDA 场景的 2D 交互引擎，而不只是普通画布组件：上层是声明式 <code>CanvasView</code>，中层是状态中枢 <code>CanvasController</code>，底层是输入路由、渲染树与工具系统。更关键的是，吸附、输入处理、连线引擎都被做成了协议化插拔点，让原理图和布局共享同一基础设施，同时保留各自的路由规则。</p>
<p>即便你对 PCB 设计本身不感兴趣，CircuitPro 也很值得关注，尤其是它在 SwiftUI + AppKit 融合架构上的工程实践。</p>
<h2 data-id="heading-13">求贤</h2>
<h3 data-id="heading-14"><a href="https://link.juejin.cn?target=mailto%3Axx2bab%40gmail.com" target="_blank" title="mailto:xx2bab@gmail.com" ref="nofollow noopener noreferrer">了解二次元的 iOS 工程师</a></h3>
<p>本公司是二次元文生图头部企业（总部新加坡），招聘岗位为大陆全职 remote。求职者需要了解二次元文化，懂得二次元用语（黑话）。</p>
<h4 data-id="heading-15">岗位职责 (Responsibilities):</h4>
<ul>
<li>
<p>我们正在寻找一位经验丰富的 iOS 工程师（中高级），负责主导我们 iOS 应用的开发与优化工作。</p>
</li>
<li>
<p>理想的候选人应具备深厚的 Swift 技术功底，出色的测试与团队协作能力，并拥有现代 iOS 架构及工具链的实战经验。</p>
</li>
</ul>
<h4 data-id="heading-16">任职要求 (Requirements):</h4>
<ul>
<li>
<p><strong>3 年以上 iOS 开发经验</strong>，主要使用 Swift，同时具备一定的 Objective-C 代码维护能力。</p>
</li>
<li>
<p><strong>至少 1 年的 SwiftUI 和 SPM (Swift Package Manager) 实战经验</strong>，熟悉其生态系统及最佳实践。</p>
</li>
<li>
<p><strong>熟悉 iOS 15+ 新特性</strong>，能够针对不同的 iOS 版本和设备屏幕尺寸进行适配及性能优化。</p>
</li>
<li>
<p><strong>掌握单元测试和 UI 自动化测试</strong> (XCTest, XCUITest)，有能力编写可维护的代码，以确保项目的稳定性和可扩展性。</p>
</li>
<li>
<p><strong>精通 Git 工作流</strong>（Git Flow, 主干开发/Trunk-Based Development），并具备基本的代码审查 (Code Review) 技能。</p>
</li>
<li>
<p><strong>理解基础的 iOS 应用模块化设计、多种单页面架构模式</strong>以及性能优化方法，并具备在项目中落地的能力。</p>
</li>
</ul>
<h4 data-id="heading-17"><strong>加分项/优先考虑 (We will give priority to who):</strong></h4>
<ul>
<li>
<p><strong>拥有跨平台开发经验</strong>（满足以下任意一项即可）：</p>
</li>
<li>
<p>6 个月以上的任意前端技术栈经验 (TypeScript/JavaScript, React, React Native)。</p>
</li>
<li>
<p>6 个月以上使用 Kotlin 及相关框架的 Android 开发经验。</p>
</li>
<li>
<p>6 个月以上的任意后端开发框架经验。</p>
</li>
<li>
<p><strong>拥有至少 6 个月的 iOS 基础设施工具或框架搭建经验</strong>，包括代码质量提升（Linting, 静态分析, CI/CD）、效率优化（模块化，Gradle 组件化*）、以及性能调优（启动速度、帧率、离线模式、多线程）。</p>
</li>
<li>
<p><strong>拥有 1 年以上 SDK 开发经验</strong>，包括通用库开发，如图片加载库 (SDWebImage, Kingfisher)、富文本编辑器、网络层或持久化层 (SQLite, Realm, Core Data)。</p>
</li>
<li>
<p><strong>具备 UI/UX 相关经验</strong>：</p>
</li>
<li>
<p>熟悉 Apple 人机交互指南 (HIG)，能够在理解跨平台设计差异的同时，实现符合 Apple 设计标准的 UI。</p>
</li>
<li>
<p>拥有扎实的动画和交互动效开发经验，熟悉 Core Animation, UIKit Dynamics 等。</p>
</li>
<li>
<p>有<strong>深色模式 (Dark Mode)</strong> 及主题切换功能的开发经验。</p>
</li>
<li>
<p><strong>具备极强的审美感知力</strong>，拥有绘画、摄影或设计相关的技能或爱好（附带作品集者优先）。</p>
</li>
<li>
<p><strong>拥有完整的 App 生命周期经验</strong>：曾独立开发、发布并维护过支持多国/多语言的 iOS 应用。</p>
</li>
<li>
<p><strong>积极参与技术社区</strong>，例如：</p>
</li>
<li>
<p>具有主动学习和分享的心态，有进行技术演讲的经验。</p>
</li>
<li>
<p>有技术写作经验（博客、文章）。</p>
</li>
<li>
<p>有开源项目贡献经历。</p>
</li>
<li>
<p><strong>有使用 AI 编程工具的经验</strong>，如 Claude, ChatGPT, GitHub Copilot, Cursor 或 Windsurf。</p>
</li>
<li>
<p><strong>具备流利的英语沟通能力或持有日语 N2 证书。</strong></p>
</li>
</ul>
<h4 data-id="heading-18">联系人</h4>
<p><a href="https://link.juejin.cn?target=mailto%3Axx2bab%40gmail.com" target="_blank" title="mailto:xx2bab@gmail.com" ref="nofollow noopener noreferrer">xx2bab@gmail.com</a></p>
<h2 data-id="heading-19">往期内容</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fhttps%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-121%2F" target="_blank" title="https://https://fatbobman.com/zh/weekly/issue-121/" ref="nofollow noopener noreferrer">变幻的光影，不变的干草堆- #121</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-120%2F" target="_blank" title="https://fatbobman.com/zh/weekly/issue-120/" ref="nofollow noopener noreferrer">Skip 开源：从“卖工具”到“卖信任”的豪赌 - #120</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-119%2F" target="_blank" title="https://fatbobman.com/zh/weekly/issue-119/" ref="nofollow noopener noreferrer">从 Anthropic 封杀与苹果谷歌结盟，看 AI 护城河的构建 - #119</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-118%2F" target="_blank" title="https://fatbobman.com/zh/weekly/issue-118/" ref="nofollow noopener noreferrer">AT 的人生未必比 MT 更好- #118</a></li>
</ul>
<h2 data-id="heading-20">💝 支持与反馈</h2>
<p>如果本期周报对你有帮助，请：</p>
<ul>
<li>👍 <strong>点赞</strong> - 让更多开发者看到</li>
<li>💬 <strong>评论</strong> - 分享你的看法或问题</li>
<li>🔄 <strong>转发</strong> - 帮助同行共同成长</li>
</ul>
<hr/>
<blockquote>
<p>🚀 <strong>拓展 Swift 视野</strong></p>
<ul>
<li><strong>📮 邮件订阅</strong> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fweekly.fatbobman.com%2Fwelcome" target="_blank" title="https://weekly.fatbobman.com/welcome" ref="nofollow noopener noreferrer">weekly.fatbobman.com</a> 获取独家技术洞察</li>
<li><strong>👥 开发者社区</strong> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fdiscord.com%2Finvite%2F7FedN5E2QQ" target="_blank" title="https://discord.com/invite/7FedN5E2QQ" ref="nofollow noopener noreferrer">Discord</a> 实时交流开发经验</li>
<li><strong>📚 原创教程</strong> | <a href="https://link.juejin.cn?target=http%3A%2F%2Ffatbobman.com" target="_blank" title="http://fatbobman.com" ref="nofollow noopener noreferrer">fatbobman.com</a> 学习 Swift/SwiftUI 最佳实践</li>
</ul>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[mcp学习笔记（一）-mcp核心概念梳理]]></title>    <link>https://juejin.cn/post/7604693038439022598</link>    <guid>https://juejin.cn/post/7604693038439022598</guid>    <pubDate>2026-02-09T17:14:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604693038439022598" data-draft-id="7604693038439006214" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="mcp学习笔记（一）-mcp核心概念梳理"/> <meta itemprop="keywords" content="LLM,MCP,人工智能"/> <meta itemprop="datePublished" content="2026-02-09T17:14:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Shawn_Shawn"/> <meta itemprop="url" content="https://juejin.cn/user/1855631358965384"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            mcp学习笔记（一）-mcp核心概念梳理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1855631358965384/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Shawn_Shawn
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T17:14:40.000Z" title="Mon Feb 09 2026 17:14:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>Model Context Protocol (MCP)</strong> ，即<strong>模型上下文协议</strong>，是一个<strong>开放标准和开源框架</strong>，旨在为大型语言模型（LLMs）应用提供一个标准化的接口，使其能够<strong>无缝集成和交互</strong>外部数据源、工具和系统。</p>
<p>其主要作用为：</p>
<ol>
<li>提供标准化接口，让LLMs（或基于LLMs构建的AI代理）能够连接到各种外部资源，如数据库，文件系统，Service Api，爬虫等资源，获取到数据。</li>
<li>LLMs可以实时与mcp<strong>双向交互</strong>，及时更新LLM中的上下文信息并能够即时执行LLM发出的指令，完成任务。</li>
<li><strong>解决碎片化</strong>：统一不同LLM和服务的交互方式，能够灵活切换不同的 LLM 提供商和厂商，简化了开发人员构建AI应用或将AI功能集成到现有系统中的复杂性。</li>
<li><strong>数据安全</strong>：在你的基础设施内安全地处理数据</li>
</ol>
<h2 data-id="heading-0">mcp架构</h2>
<h3 data-id="heading-1">角色</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69c9914f39004c2b8504b4e623b49cf6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2hhd25fU2hhd24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771262081&amp;x-signature=vOaC%2Bg%2BusyutoM3xIN7lhNSAz7w%3D" alt="" loading="lazy"/></p>
<p>MCP 核心采用客户端-服务器架构</p>
<ul>
<li><strong>MCP Hosts</strong>: 如 Claude Desktop、IDE 或 AI 工具，希望通过 MCP 访问数据的程序</li>
<li><strong>MCP Clients</strong>: 维护与服务器一对一连接的协议客户端</li>
<li><strong>MCP Servers</strong>: 轻量级程序，通过标准的 Model Context Protocol 提供特定能力为 clients 提供resources、tools 和 prompts</li>
</ul>
<h3 data-id="heading-2">分层</h3>
<h4 data-id="heading-3">数据层</h4>
<p>数据层实现了一个基于 JSON-RPC 2.0 的交互协议，其主要作用是定义 MCP 客户端和 MCP 服务端之间的架构和语义。</p>
<ul>
<li><strong>生命周期管理</strong>：处理客户端和服务端之间的连接初始化、能力协商和连接终止</li>
<li><strong>核心源语</strong>：定义了客户端和服务端可以相互提供的内容。这些原语指定了可以与 AI 应用共享的上下文信息类型以及可以执行的操作范围。</li>
<li><strong>实用特性</strong>：支持额外功能，如用于实时更新的“通知”和用于长时间运行操作的“进度跟踪”</li>
</ul>
<h5 data-id="heading-4">生命周期管理</h5>
<p>MCP 是一个有状态协议需要生命周期管理。生命周期管理的目的是协商客户端和服务端都支持的能力。</p>
<h5 data-id="heading-5">核心源语</h5>
<h6 data-id="heading-6">Server层源语</h6>
<ul>
<li><strong>工具 (Tools)</strong> ：AI 应用可以调用以执行操作的可执行函数（例如：文件操作、API 调用、数据库查询）</li>
<li><strong>资源 (Resources)</strong> ：为 AI 应用提供上下文信息的数据源（例如：文件内容、数据库记录、API 响应）</li>
<li><strong>提示词 (Prompts)</strong> ：帮助构建与语言模型交互的可重用模板（例如：系统提示词、少样本示例）</li>
</ul>
<p>每种原语类型都有关联的发现 (<code> */list</code>)、获取 (<code> */get</code>) 以及在某些情况下的执行 (<code>tools/call</code>) 方法。MCP 客户端将使用 <code>*/list</code> 方法来发现可用的原语。例如，客户端可以先列出所有可用工具 (<code>tools/list</code>) 然后执行它们。这种设计允许列表是动态的。</p>
<h6 data-id="heading-7">Client层源语</h6>
<ul>
<li><strong>采样 (Sampling)</strong> ：允许服务端请求客户端 AI 应用进行语言模型补全。当服务端作者想要访问语言模型，但希望保持模型独立且不愿在 MCP 服务端中包含语言模型 SDK 时，这非常有用。他们可以使用 <code>sampling/complete</code> 方法请求客户端 AI 应用进行语言模型补全。</li>
<li><strong>引导 (Elicitation)</strong> ：允许服务端向用户请求额外信息。当服务端作者想要从用户那里获取更多信息或请求对某项操作的确认时，这非常有用。他们可以使用 <code>elicitation/request</code> 方法向用户请求额外信息。</li>
<li><strong>日志记录 (Logging)</strong> ：使服务端能够向客户端发送日志消息，用于调试和监控目的。</li>
</ul>
<h5 data-id="heading-8">实时特性</h5>
<p>该协议支持实时通知，以实现服务端和客户端之间的动态更新。例如，当服务端的可用工具发生变化时——比如新功能上线或现有工具被修改——服务端可以发送工具更新通知，以告知已连接的客户端这些变化。通知以 JSON-RPC 2.0 通知消息的形式发送（不期望响应），并使 MCP 服务端能够向已连接的客户端提供实时更新。</p>
<h4 data-id="heading-9">传输层</h4>
<p>定义使客户端和服务器之间实现数据交换的通信机制和通道，包括特定于传输的连接建立、消息框架和授权。有两个主流的transport方式：Stdio和Streamable HTTP transport</p>
<ul>
<li>Stdio transport：使用标准输入/输出流进行同一机器上本地进程之间的直接进程通信，提供最佳性能而没有网络开销。</li>
<li>Streamable HTTP transport：使用HTTP POST进行客户端与服务器之间的消息传输，并可选地使用服务器推送事件实现流媒体功能。该传输方式支持远程服务器通信，并支持包括持有者令牌、API密钥和自定义头在内的标准HTTP身份验证方法。MCP建议使用OAuth来获取身份验证令牌。</li>
</ul>
<h5 data-id="heading-10">Stdio</h5>
<ul>
<li><strong>定义</strong>：使用标准输入/输出流进行同一机器上本地进程之间的直接进程通信，提供最佳性能而没有网络开销。</li>
<li><strong>适用场景</strong>：Local Mcp Server，例如Claude Code连接localfilesystme server</li>
<li><strong>核心优势</strong>：</li>
</ul>

<ul>
<li>
<ul>
<li><strong>零网络依赖</strong>：无需配置网络环境，适合本地开发调试。</li>
<li><strong>高安全性</strong>：数据仅在本地流转，避免远程泄露风险。</li>
<li><strong>低延迟</strong>：直接通过内存或管道传输，性能高效。</li>
</ul>
</li>
</ul>

<ul>
<li><strong>局限性：</strong></li>
</ul>

<ul>
<li>
<ul>
<li><strong>单进程限制</strong>：无法同时处理多客户端请求，扩展性差。</li>
<li><strong>仅限本地</strong>：无法支持分布式或远程资源访问。</li>
</ul>
</li>
</ul>
<h5 data-id="heading-11"><strong>Streamable HTTP</strong></h5>
<ul>
<li><strong>定义</strong>：使用HTTP POST进行客户端与服务器之间的消息传输，并可选地使用服务器推送事件实现流媒体功能。该传输方式支持远程服务器通信，并支持包括持有者令牌、API密钥和自定义头在内的标准HTTP身份验证方法。。</li>
<li><strong>适用场景</strong>：Remote Mcp Server，例如连接高德地图MCP Server，获取天气的MCP Server等等</li>
<li><strong>核心优势</strong>：</li>
</ul>

<ul>
<li>
<ul>
<li><strong>无状态支持</strong>：去中心化、无强制要求持续连接，服务器可完全无状态运行，降低运维复杂度。</li>
<li><strong>基础设施兼容</strong>：与CDN、API网关、负载均衡无缝集成。</li>
<li><strong>灵活流式处理</strong>：支持按需切换为流式传输（如长文本生成进度推送）。</li>
</ul>
</li>
</ul>

<ul>
<li><strong>局限性：</strong></li>
</ul>

<ul>
<li>
<ul>
<li><strong>实现复杂度</strong>：需处理会话ID和状态管理（可选）。</li>
</ul>
</li>
</ul>
<h5 data-id="heading-12"><strong>SSE</strong></h5>
<p>实际上mcp之前还支持<strong>SSE</strong>，现在官网上已经没有说明了，但是实际还是可以使用。</p>
<ul>
<li><strong>定义</strong>：通过HTTP长连接实现远程通信。服务器需提供两个端点：</li>
</ul>

<ul>
<li>
<ul>
<li><strong>/sse</strong>（GET请求）：建立长连接，接收服务器推送的事件流。</li>
<li><strong>/messages</strong>（POST请求）：客户端发送请求至该端点。</li>
</ul>
</li>
</ul>

<ul>
<li><strong>核心优势</strong></li>
</ul>

<ul>
<li>
<ul>
<li><strong>支持远程访问</strong>：突破本地限制，适用于分布式部署。</li>
<li><strong>实时性</strong>：服务器可主动推送事件。</li>
</ul>
</li>
</ul>

<ul>
<li><strong>局限性</strong></li>
</ul>

<ul>
<li>
<ul>
<li><strong>高可用性要求</strong>：服务器必须一直保持一个稳定、不中断的 <strong>SSE</strong> 长连接，否则通信就中断，如果中断了，也没有断点续连的能力，只能重新开始新的连接，之前的上下文可能会丢失。</li>
<li><strong>单向性缺陷</strong>：客户端需通过额外HTTP请求发送数据，无法实现双向流式交互。</li>
<li><strong>即将废弃</strong>：实际上mcp之前还支持<strong>SSE</strong>，现在官网上已经没有说明了，但是实际还是可以使用。官方计划用Streamable HTTP替代SSE。</li>
</ul>
</li>
</ul>
<p><strong>SSE与Streamable的区别</strong></p>
<ul>
<li><strong>Streamable</strong>移除了 <code>/sse</code>端点，所有客户端 → 服务端的消息都通过 <code>/message</code>发送</li>
<li><strong>Streamable</strong>的所有客户端 → 服务端的请求都可以被服务器升级为 SSE，以发送通知或请求</li>
<li><strong>Streamable</strong>的服务器可以选择建立会话 ID 以维护状态</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025年终总结]]></title>    <link>https://juejin.cn/post/7604709514130866222</link>    <guid>https://juejin.cn/post/7604709514130866222</guid>    <pubDate>2026-02-09T16:09:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604709514130866222" data-draft-id="7604690250363650057" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025年终总结"/> <meta itemprop="keywords" content="程序员,前端,后端"/> <meta itemprop="datePublished" content="2026-02-09T16:09:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="leobertlan"/> <meta itemprop="url" content="https://juejin.cn/user/2066737589654327"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025年终总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2066737589654327/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    leobertlan
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T16:09:21.000Z" title="Mon Feb 09 2026 16:09:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>时光飞逝，一年转瞬即逝。时近年关，亦当适时总结，以梳理过往、展望未来。</p>
<h2 data-id="heading-0">工作</h2>
<blockquote>
<p>窃以为：最理想的工作状态当如是，既能完成工作、创造价值，又有合适的挑战与成长空间，不觉枯燥，常有收获。</p>
</blockquote>
<p>在几年前，我的工作需要聚焦于Android移动端、后端和架构，至如今，已经变成：在合适的目标平台上设计系统实现软件，解决问题创造价值。领域知识已成为支撑决策的基石，编程语言已成为搭建楼台的脚手架。</p>
<p>从仅交付商业软件，到交付商业软件&amp;科研用途软件&amp;测试工具软件&amp;研发用插件&amp;日常效率脚本，设计编写软件已不再是目标，而是达成目标的方法。</p>
<p>从主要使用kotlin&amp;java&amp;TypeScript类到不限于C++、Java、Kotlin、groovy、python...语言已为我所用，而我不再受其所限。</p>
<h3 data-id="heading-1">工作展望</h3>
<blockquote>
<p>作者按：随着AI崛起，应当拿起AI来对生产过程进行革命，致力于社会生产力变革的宏大叙事。而不是在资本家的代码编写车间内，挑起程序员与AI之间的战争。</p>
</blockquote>
<blockquote>
<p>《黄帝内经》曰：“男子八岁而肾气实，发长齿更，二八肾气盛，天癸至，精气溢泻，阴阳和，故能有子，三八肾气平均，筋骨劲强，故真牙生而长极，四八筋骨隆盛，肌肉满壮，五八肾气衰，发堕齿槁，六八阳气衰竭于上，面焦，发鬓颁白，七八肝气衰，筋不能动，天癸竭，精少，肾脏衰，形体皆极，八八则齿发去。”</p>
</blockquote>
<p>程序员的工作本质上仍属于劳动范畴。与传统体力劳动不同，程序员的劳动是智力、体力与转换能力的三重结合。随着科技进步，三者的比重和作用也在不断变化。</p>
<p>余尝观象棋特大许银川弈棋，纵有“世外高人”以算力压阵，然其筹算之精微，布局之深远，犹能凌驾于机巧之上。是故，<strong>人之智识，贵在驾驭</strong>。</p>
<p>盖AI之能，在于速算广识，然其不通权变，不达人情；人之所长，在于明理审势，持中守正。故善驭者，不废人之主位，而假AI之利器。</p>
<h2 data-id="heading-2">学习</h2>
<blockquote>
<p>世间传说，在滇西之地，有一座云雾笼罩的大阵，在阵中，有林葳蕤，曰往生林，蜉蝣国便在此处。蜉蝣国人朝生暮死，却将须臾生命尽数倾注于求知与创造。晨光中诞生，暮色里消散，每一瞬都镌刻着文明的刻度。人类同样困于百年之身，却借由学习挣脱时间的锁链。每一次对知识的探求，都是对蜉蝣之躯的超越。</p>
</blockquote>
<p>芸芸众生，有人为人类文明与宏大叙事而学习，有人为适应社会与责任贡献而学习，有人为个人成长与自我实现而学习。</p>
<p>去年，我亦在工作可辐散到的领域进行了学习，如系统工程、RTOS、嵌入式软件设计、信息论、电路分析，所求者：提升认知与思维、获取知识与技能。在26年，我计划投入时间重新学习数学，以往匮乏工程应用经验，学而不思则罔，至如今，思而不学则殆。</p>
<h2 data-id="heading-3">阅读</h2>
<p>除去技术类书籍，去年完整阅读约15本书籍，颇为繁杂，既有《资治通鉴》这类厚重的史鉴，试图从中寻找规律与洞察；也有哲学著作，于思辨中锤炼思维的框架与深度；同时，又重温步非烟笔下瑰丽的江湖世界，在文学想象中获得纯粹的愉悦。</p>
<p>阅读于我的意义，在于其非功利的核心价值：</p>
<ul>
<li>
<p><strong>它是心性的磨刀石。</strong> 在碎片信息与即时反馈充斥的时代，沉浸于长篇的、系统的阅读，是对专注力与耐心的修炼。与沉默的文字对话，在缓慢的节奏中对抗浮躁，获得一种沉静而坚实的内在定力。</p>
</li>
<li>
<p><strong>它是表达的蓄水池。</strong> 历史叙事的宏大、哲学思辨的精密、文学描绘的生动，无形中丰富着我的语言库与思维层次。在与人深度沟通时，那些阅读中汲取的养分，会自然而然地流淌出来，让思想的传递更准确，也更能抵达人心。</p>
</li>
<li>
<p><strong>它更是精神的栖息地。</strong> 阅读不同于目标明确的学习，它不直接指向技能或答案。是眼界的开阔、共情能力的提升、看待世界与人生的多维视角。让我在案牍劳形处，始终保留着一片与更广阔人类智慧相连的星空，守护内心的秩序与澄明。</p>
</li>
</ul>
<h2 data-id="heading-4">展望未来道路</h2>
<p>夫精术者，其要在三，一曰明道，二曰立制，三曰通器。</p>
<p>不明其道，不通其理，是故窥物以机，论事以法，是为格物致知；
不立其制，不成其约，是故解之循构，附之于架，是为纲举目张；
不通其器，不造其物，是故执规以圆，运斤成风，是为得心应手；</p>
<p>程序员的持续成长，应当着眼于：提升对于事物运转规律的见解，提升描述事物的准确性，提升构建系统的能力，扩展运用语言和工具的能力，籍此拥有强大的设计系统实现软件以解决问题创造价值的能力。</p>
<pre><code class="hljs"/></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Ralph Loop 让Claude无止尽干活的牛马...]]></title>    <link>https://juejin.cn/post/7604493165328629794</link>    <guid>https://juejin.cn/post/7604493165328629794</guid>    <pubDate>2026-02-09T15:04:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604493165328629794" data-draft-id="7604522883486777378" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Ralph Loop 让Claude无止尽干活的牛马..."/> <meta itemprop="keywords" content="后端,前端"/> <meta itemprop="datePublished" content="2026-02-09T15:04:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="易安说AI"/> <meta itemprop="url" content="https://juejin.cn/user/4009298287660777"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Ralph Loop 让Claude无止尽干活的牛马...
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4009298287660777/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    易安说AI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T15:04:30.000Z" title="Mon Feb 09 2026 15:04:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近在用 Claude Code 的 Ralph Loop 插件做 AI 驱动开发，遇到一个实际问题：如何让 Ralph Loop 在后台长时间运行，不占用终端窗口？研究了几种方案，从简单的 tmux 到完整的管理系统，记录一下实践过程。</p>
<p><strong>（对了说个福利：需要低成本使用ClaudeCode可以联系易安：20133213，大量原生claude max帐号，效果极佳，易安坚持自己做帐号转发，号池已经几十个号了，如果你是高T,易安非常希望给你省一些时间。）</strong></p>
<h2 data-id="heading-0">问题背景</h2>
<p>Ralph Loop 是 Claude Code 的一个插件，实现了自我迭代的 AI 开发循环。简单说就是给 AI 一个任务，它会不断尝试、测试、修复，直到完成。特别适合配合 BMAD 敏捷框架使用，一次性完成整个 Epic 的多个用户故事。</p>
<p>问题是：</p>
<ul>
<li>一个 Epic 可能包含 5-10 个故事，跑几个小时</li>
<li>占用终端窗口，无法做其他事</li>
<li>Mac 合上盖子会休眠，进程中断</li>
<li>想同时跑多个 Epic，但终端窗口不够</li>
</ul>
<h2 data-id="heading-1">安装 Ralph Loop 插件</h2>
<p>先说插件安装，官方插件名叫 <code>ralph-loop</code>（不是 ralph-wiggum）：</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># 直接安装</span>
claude plugin install ralph-loop@claude-plugins-official

<span class="hljs-comment"># 确认安装成功</span>
claude plugin list
</code></pre>
<p>安装后就可以用 <code>/ralph-loop</code> 命令了。</p>
<h3 data-id="heading-2">Ralph Loop 工作原理</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9fe0c93560b143f6a89c9486502118d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771254274&amp;x-signature=o2eQAroMtByBZ9qC8AlMpfezWJg%3D" alt="图片" loading="lazy"/></p>
<p>这个自我迭代的循环是 Ralph Loop 的核心，配合后台运行，可以让 AI 长时间自主工作。测试失败了会自我修复，任务没完成会继续迭代优化，整个过程不需要人工干预。</p>
<h2 data-id="heading-3">后台执行方案对比</h2>
<p>我试了 5 种方案，按推荐度排序：</p>
<h3 data-id="heading-4">方案对比表</h3>





















































<table><thead><tr><th>方案</th><th>适用场景</th><th>操作难度</th><th>稳定性</th><th>可交互性</th><th>推荐度</th></tr></thead><tbody><tr><td><strong>tmux</strong></td><td>日常开发</td><td>简单</td><td>极高</td><td>随时可连</td><td>强烈推荐</td></tr><tr><td><strong>tmux + caffeinate</strong></td><td>过夜运行</td><td>中等</td><td>极高</td><td>随时可连</td><td>强烈推荐</td></tr><tr><td><strong>screen</strong></td><td>轻量替代</td><td>简单</td><td>高</td><td>随时可连</td><td>推荐</td></tr><tr><td><strong>nohup</strong></td><td>完全无人值守</td><td>中等</td><td>中等</td><td>仅日志</td><td>适用特定场景</td></tr><tr><td><strong>Ralph Manager</strong></td><td>多任务管理</td><td>较复杂</td><td>极高</td><td>完整管理</td><td>强烈推荐</td></tr></tbody></table>
<h3 data-id="heading-5">方案 1: tmux（最推荐）</h3>
<p><strong>适合场景</strong>：日常开发，需要随时查看进度</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建会话</span>
tmux new -s ralph-epic1

<span class="hljs-comment"># 在会话中运行 Claude Code</span>
<span class="hljs-built_in">cd</span> /path/to/project
claude

<span class="hljs-comment"># 运行 Ralph Loop</span>
/ralph-loop <span class="hljs-string">"任务描述..."</span> --max-iterations 100

<span class="hljs-comment"># 分离会话（让它后台运行）</span>
<span class="hljs-comment"># 按 Ctrl+B 然后 D</span>

<span class="hljs-comment"># 重新连接查看进度</span>
tmux attach -t ralph-epic1

<span class="hljs-comment"># 列出所有会话</span>
tmux <span class="hljs-built_in">ls</span>

<span class="hljs-comment"># 关闭会话</span>
tmux kill-session -t ralph-epic1
</code></pre>
<p><strong>优点</strong>：</p>
<p>可以随时重连查看进度。支持多窗口、分屏。稳定，不会因为网络断开而中断。</p>
<p><strong>我的配置</strong>：</p>
<p>创建 <code>~/.tmux.conf</code>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 修改前缀键为 Ctrl+A（更好按）</span>
<span class="hljs-built_in">set</span> -g prefix C-a
unbind C-b

<span class="hljs-comment"># 启用鼠标支持</span>
<span class="hljs-built_in">set</span> -g mouse on

<span class="hljs-comment"># 增加历史缓冲区</span>
<span class="hljs-built_in">set</span> -g history-limit 10000

<span class="hljs-comment"># 分屏快捷键</span>
<span class="hljs-built_in">bind</span> | split-window -h -c <span class="hljs-string">"#{pane_current_path}"</span>
<span class="hljs-built_in">bind</span> - split-window -v -c <span class="hljs-string">"#{pane_current_path}"</span>
</code></pre>
<p>这样操作更顺手。</p>
<h3 data-id="heading-6">tmux 完整操作流程</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf49c732335145fa98bfcafc54480c4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771254274&amp;x-signature=x3XWbd6c8Mipndfk0A5dmTCsKlk%3D" alt="图片" loading="lazy"/></p>
<p>整个流程分为 4 个阶段：</p>
<ol>
<li>1. <strong>初始化</strong>：创建 tmux 会话</li>
<li>2. <strong>执行任务</strong>：运行 Claude Code 和 Ralph Loop</li>
<li>3. <strong>后台运行</strong>：分离会话，可随时重连查看进度</li>
<li>4. <strong>完成清理</strong>：查看结果并关闭会话</li>
</ol>
<p>关键操作：<code>Ctrl+B D</code>（分离）、<code>tmux attach</code>（重连）</p>
<h3 data-id="heading-7">方案 2: tmux + caffeinate（过夜运行）</h3>
<p><strong>适合场景</strong>：需要长时间运行，可能合上 Mac 盖子</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建会话并防止休眠</span>
tmux new -s overnight
<span class="hljs-built_in">cd</span> /path/to/project

<span class="hljs-comment"># 防止系统休眠</span>
caffeinate -i claude

<span class="hljs-comment"># 在 Claude 中运行 Ralph Loop</span>
/ralph-loop <span class="hljs-string">"..."</span> --max-iterations 100

<span class="hljs-comment"># 分离会话</span>
<span class="hljs-comment"># Ctrl+B D</span>
</code></pre>
<p><code>caffeinate</code> 的几个选项：</p>
<ul>
<li>• <code>-i</code>：防止系统空闲休眠</li>
<li>• <code>-d</code>：防止显示器休眠</li>
<li>• <code>-s</code>：防止系统休眠</li>
<li>• <code>-w PID</code>：防止休眠直到指定进程结束</li>
</ul>
<p><strong>实际测试</strong>：</p>
<ul>
<li>• 跑了一夜（8小时），完成了 2 个 Epic</li>
<li>• Mac 合盖状态，接电源</li>
<li>• 早上起来会话还在，进度正常</li>
</ul>
<h3 data-id="heading-8">方案 3: screen</h3>
<p><strong>适合场景</strong>：没有 tmux 或习惯用 screen</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建 screen 会话</span>
screen -S ralph-work

<span class="hljs-comment"># 运行任务</span>
<span class="hljs-built_in">cd</span> /path/to/project
claude
/ralph-loop <span class="hljs-string">"..."</span> --max-iterations 100

<span class="hljs-comment"># 分离会话</span>
<span class="hljs-comment"># Ctrl+A D</span>

<span class="hljs-comment"># 重新连接</span>
screen -r ralph-work

<span class="hljs-comment"># 如果显示 Attached，强制连接</span>
screen -d -r ralph-work
</code></pre>
<p>screen 比 tmux 老，功能少一些，但更轻量。我个人还是更喜欢 tmux。</p>
<h3 data-id="heading-9">方案 4: nohup + 后台进程</h3>
<p><strong>适合场景</strong>：完全无人值守，不需要交互</p>
<p>创建启动脚本 <code>run-ralph.sh</code>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-built_in">cd</span> /path/to/project

<span class="hljs-comment"># 创建命令文件</span>
<span class="hljs-built_in">cat</span> &gt; /tmp/ralph-cmd.txt &lt;&lt; <span class="hljs-string">'EOF'</span>
/ralph-loop <span class="hljs-string">"实现所有故事"</span> --max-iterations 100 --completion-promise <span class="hljs-string">"COMPLETE"</span>
EOF

<span class="hljs-comment"># 后台运行</span>
<span class="hljs-built_in">nohup</span> <span class="hljs-built_in">cat</span> /tmp/ralph-cmd.txt | claude &gt; ralph-output.log 2&gt;&amp;1 &amp;

<span class="hljs-built_in">echo</span> <span class="hljs-string">"任务已启动，查看日志: tail -f ralph-output.log"</span>
</code></pre>
<p>运行：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">chmod</span> +x run-ralph.sh
./run-ralph.sh

<span class="hljs-comment"># 查看实时日志</span>
<span class="hljs-built_in">tail</span> -f ralph-output.log

<span class="hljs-comment"># 停止任务</span>
pkill -f claude
</code></pre>
<p><strong>问题</strong>：</p>
<p>无法交互查看进度，只能通过日志了解状态。适合完全确定的任务。</p>
<h3 data-id="heading-10">方案 5: 生产级管理系统</h3>
<p><strong>适合场景</strong>：经常使用，需要管理多个任务</p>
<p>我写了一个完整的管理脚本 <code>ralph.sh</code>，可以启动/停止 Epic、查看状态和日志、多任务并行管理、自动归档日志。</p>
<p>核心命令：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装（创建 ~/ralph-manager/ralph.sh）</span>
<span class="hljs-comment"># ... 脚本内容见前文 ...</span>

<span class="hljs-comment"># 创建符号链接</span>
sudo <span class="hljs-built_in">ln</span> -s ~/ralph-manager/ralph.sh /usr/local/bin/ralph

<span class="hljs-comment"># 使用</span>
ralph start epic1 <span class="hljs-string">"1-*.md"</span>    <span class="hljs-comment"># 启动 Epic 1</span>
ralph status epic1             <span class="hljs-comment"># 查看状态</span>
ralph logs epic1 follow        <span class="hljs-comment"># 查看实时日志</span>
ralph attach epic1             <span class="hljs-comment"># 连接到会话</span>
ralph stop epic1               <span class="hljs-comment"># 停止任务</span>
</code></pre>
<p><strong>实际效果</strong>：</p>
<p>可以同时跑多个 Epic：</p>
<pre><code class="hljs language-sql" lang="sql">ralph <span class="hljs-keyword">start</span> epic1 "1-*.md"
ralph <span class="hljs-keyword">start</span> epic2 "2-*.md"
ralph <span class="hljs-keyword">start</span> epic3 "3-*.md"

ralph status <span class="hljs-keyword">all</span>  # 查看所有状态
</code></pre>
<h2 data-id="heading-11">结合 BMAD 框架的最佳实践</h2>
<p>BMAD 是一个 AI 驱动的敏捷开发框架，会生成详细的用户故事文件，包含 AC（验收标准）和 Tasks。</p>
<h3 data-id="heading-12">BMAD + Ralph Loop 工作流程</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba078075c0c84a3a88ad7cf56f42d4ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771254274&amp;x-signature=96lhkz9%2BjVJ3FNKZPxNHAwVTDA0%3D" alt="图片" loading="lazy"/></p>
<p>流程很清晰，分三步走。</p>
<p>BMAD 负责规划，用 AI 辅助做需求分析，生成 Epic，拆分成一个个用户故事，每个故事都有明确的验收标准（AC）和任务清单（Tasks）。这样 AI 就不用猜你想要什么了。</p>
<p>Ralph Loop 接手执行。它在后台跑，读取故事文件，实现功能，跑测试，发现问题自动修复，完成一个勾选一个，自动处理整个 Epic。这个阶段完全不需要人盯着。</p>
<p>最后是人工把关。Code Review 看代码质量，测试验收，确认没问题再合并发布。</p>
<p>实际跑下来，一个 Epic（6个故事）大概 4 小时，8个故事 6 小时左右。成功率 85% 左右，剩下 15% 需要手动调整。API 成本每个 Epic 二三十美元。</p>
<h3 data-id="heading-13">单个故事模式</h3>
<p>适合新手或复杂故事：</p>
<pre><code class="hljs language-arduino" lang="arduino">/ralph-loop <span class="hljs-string">"实现 Story 1.1: 用户认证模块

工作目录: ~/projects/my-app
故事文件: _bmad-output/implementation-artifacts/1-1-user-authentication.md

要求:
1. 严格按照故事文件中的 Acceptance Criteria 和 Tasks 执行
2. 完成所有 Tasks 并勾选完成的复选框
3. 更新 Status 为 done
4. 填写 Dev Agent Record 部分
5. 运行所有测试确保通过

完成标准:
- 所有 AC 和 Tasks 勾选完成
- 测试通过
- Story Status 更新为 done

完成后输出: &lt;promise&gt;STORY_1.1_COMPLETE&lt;/promise&gt;
"</span> --max-iterations <span class="hljs-number">30</span> --completion-promise <span class="hljs-string">"STORY_1.1_COMPLETE"</span>
</code></pre>
<h3 data-id="heading-14">Epic 批量模式</h3>
<p>适合熟练使用：</p>
<pre><code class="hljs language-arduino" lang="arduino">/ralph-loop <span class="hljs-string">"实现 Epic 1 的所有用户故事

工作目录: ~/projects/my-app
故事目录: _bmad-output/implementation-artifacts/

故事顺序:
1. Story 1.1: 用户认证模块
2. Story 1.2: 权限管理系统
3. Story 1.3: 用户个人资料
4. Story 1.4: 密码重置功能
5. Story 1.5: 登录日志记录
6. Story 1.6: 会话管理优化

工作流程:
1. 按顺序完成每个故事
2. 完成一个后再开始下一个
3. 每个故事都要完成所有 AC/Tasks、运行测试、更新状态
4. 如果某个故事失败超过3次，记录问题并继续下一个

完成后输出: &lt;promise&gt;EPIC_1_COMPLETE&lt;/promise&gt;
"</span> --max-iterations <span class="hljs-number">100</span> --completion-promise <span class="hljs-string">"EPIC_1_COMPLETE"</span>
</code></pre>
<h3 data-id="heading-15">实际运行效果</h3>
<p>使用 Ralph Manager + tmux + caffeinate 的组合：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启动</span>
ralph start epic1 <span class="hljs-string">"1-*.md"</span>

<span class="hljs-comment"># 分离会话</span>
tmux detach

<span class="hljs-comment"># 防止休眠</span>
caffeinate -i <span class="hljs-built_in">sleep</span> 28800  <span class="hljs-comment"># 8小时</span>

<span class="hljs-comment"># 第二天检查</span>
ralph status epic1

<span class="hljs-comment"># 查看完成情况</span>
<span class="hljs-built_in">cd</span> ~/projects/my-app
grep -r <span class="hljs-string">"Status: done"</span> _bmad-output/implementation-artifacts/
</code></pre>
<p><strong>真实数据</strong>：</p>
<ul>
<li>• Epic 1（6个故事）：耗时约 4 小时</li>
<li>• Epic 2（8个故事）：耗时约 6 小时</li>
<li>• 成功率：约 85%（部分故事需要手动修复）</li>
</ul>
<h2 data-id="heading-16">遇到的问题</h2>
<h3 data-id="heading-17">问题 1: tmux 会话突然消失</h3>
<p><strong>现象</strong>：重连时提示 <code>no sessions</code></p>
<p><strong>原因</strong>：系统重启或 tmux 进程被杀</p>
<p><strong>解决</strong>：</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># 检查 tmux 进程</span>
ps aux | <span class="hljs-keyword">grep</span> tmux

<span class="hljs-comment"># 如果没有，重启 tmux</span>
tmux

<span class="hljs-comment"># 恢复会话（如果有保存插件）</span>
</code></pre>
<p>我现在会定期保存日志：</p>
<pre><code class="hljs language-bash" lang="bash">claude 2&gt;&amp;1 | <span class="hljs-built_in">tee</span> ralph-$(<span class="hljs-built_in">date</span> +%Y%m%d-%H%M%S).<span class="hljs-built_in">log</span>
</code></pre>
<h3 data-id="heading-18">问题 2: Mac 还是会休眠</h3>
<p><strong>现象</strong>：即使用了 <code>caffeinate</code>，Mac 还是休眠了</p>
<p><strong>原因</strong>：<code>caffeinate</code> 参数不对，或者电池电量低</p>
<p><strong>解决</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用最强的防休眠选项</span>
caffeinate -dims tmux attach -t ralph-epic1

<span class="hljs-comment"># 或确保接电源</span>
pmset -g  <span class="hljs-comment"># 查看电源设置</span>
</code></pre>
<h3 data-id="heading-19">问题 3: Claude 进程卡住</h3>
<p><strong>现象</strong>：日志不再更新，进程还在但无响应</p>
<p><strong>原因</strong>：可能遇到了需要人工确认的问题</p>
<p><strong>解决</strong>：</p>
<pre><code class="hljs language-arduino" lang="arduino"># 连接到会话查看
tmux attach -t ralph-epic1

# 如果确实卡住，重启任务
ralph stop epic1
ralph start epic1 <span class="hljs-string">"1-*.md"</span>
</code></pre>
<h2 data-id="heading-20">我的推荐方案</h2>
<p>根据不同场景选择合适的方案：</p>
<p><strong>日常开发（1-2小时任务）</strong> ：</p>
<pre><code class="hljs">tmux + 手动查看进度
</code></pre>
<p><strong>过夜运行（4-8小时任务）</strong> ：</p>
<pre><code class="hljs">tmux + caffeinate + 日志记录
</code></pre>
<p><strong>多任务并行</strong>：</p>
<pre><code class="hljs">Ralph Manager
</code></pre>
<p><strong>完全无人值守</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">nohup</span>（但要确保任务足够稳定）
</code></pre>
<h2 data-id="heading-21">一些思考</h2>
<p>Ralph Loop 不是万能的。它适合明确的开发任务，但不适合需要设计决策的场景。如果你的任务需要架构选型或方案讨论，还是得人来做。最好配合 BMAD 这样的详细故事文件，让 AI 知道具体要做什么。</p>
<p>后台运行是把双刃剑。省时间，但也意味着失去了一定控制。我的做法是先手动跑 1-2 个故事，确认 AI 理解正确了，再开后台让它跑完整个 Epic。</p>
<p>成本方面，一个 Epic（6-8个故事）大约 $20-30 的 API 费用。相比人工开发的时间成本，这个价格还挺值的。但记得设置 <code>--max-iterations</code>，防止无限循环把钱烧光。</p>
<p>质量检查不能省。即使 AI 说完成了，也要自己 code review 一遍。我会用 <code>/sc:code-review</code> 插件再检查一遍，测试覆盖率也很重要。</p>
<h2 data-id="heading-22">资源链接</h2>
<ul>
<li>• Ralph Loop 插件文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fclaude-code%2Ftree%2Fmain%2Fplugins%2Fralph-loop" target="_blank" title="https://github.com/anthropics/claude-code/tree/main/plugins/ralph-loop" ref="nofollow noopener noreferrer">github.com/anthropics/…</a></li>
<li>• BMAD 框架：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbmad-code-org%2FBMAD-METHOD" target="_blank" title="https://github.com/bmad-code-org/BMAD-METHOD" ref="nofollow noopener noreferrer">github.com/bmad-code-o…</a></li>
<li>• tmux 入门教程：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftmux%2Ftmux%2Fwiki" target="_blank" title="https://github.com/tmux/tmux/wiki" ref="nofollow noopener noreferrer">github.com/tmux/tmux/w…</a></li>
</ul>
<hr/>
<p>这是我实际使用 Ralph Loop 的经验，不同项目可能需要调整。如果你也在用 AI 驱动开发，欢迎交流，20133213可以找到我。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Claude Opus 4.6 凌晨发布，我体验了一整晚，说说真实感受。]]></title>    <link>https://juejin.cn/post/7604685644684263476</link>    <guid>https://juejin.cn/post/7604685644684263476</guid>    <pubDate>2026-02-09T15:08:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604685644684263476" data-draft-id="7604395865336037428" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Claude Opus 4.6 凌晨发布，我体验了一整晚，说说真实感受。"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-09T15:08:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="易安说AI"/> <meta itemprop="url" content="https://juejin.cn/user/4009298287660777"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Claude Opus 4.6 凌晨发布，我体验了一整晚，说说真实感受。
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4009298287660777/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    易安说AI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T15:08:05.000Z" title="Mon Feb 09 2026 15:08:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你好，我是易安，见字如面。
2 月 5 号凌晨两点，Anthropic 放出了 Opus 4.6。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd417398be7f46499fe8133570293d5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771254485&amp;x-signature=d8P7QBTWfPZOxaXlRJfVrvIYhJA%3D" alt="图片" loading="lazy"/></p>
<p>A社还良心的送了一些增金，让付费订阅用户试用最新模型</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f54dba7a0b4243a58acb5ba92d237e61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771254485&amp;x-signature=1ge1GlKMRvBensmeP%2BAO6DZr1Ko%3D" alt="图片" loading="lazy"/></p>
<p>翻译下：试用我们最新的模型，赠送 $50 额外使用额度，即使你已达到套餐用量上限也能继续使用，我看有的帐号有70刀增金</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67c9f56bceb04f0cb881ee8f07f93f8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771254485&amp;x-signature=TLiSSFq1ehc7ygxPonX2ECTuwLI%3D" alt="图片" loading="lazy"/></p>
<p>看了一眼更新内容——1M 上下文、Agent Teams、价格不变——睡意全无，刚刚开完会就开始试。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4526149943f24239b1db2bf2c42813ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771254485&amp;x-signature=l7OfUUbagVoEEtxNA8fbYr76Gbo%3D" alt="图片" loading="lazy"/></p>
<p>我自己运营着一个 AI API 网关服务（AI编程巴士），</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/783def6ad2924bd0ba51ec44a85d07fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771254485&amp;x-signature=6YRkmJvSAtXLRqTojIc6FCZ5jro%3D" alt="图片" loading="lazy"/></p>
<p>底层是纯血 Claude Max 订阅直连转发，不搞逆向，不掺水，上游给什么就透传什么。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70c12453c33643248b0a80aa959c9986~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771254485&amp;x-signature=U9DF3kb7Z23lG3wLkf8jSfS2QYw%3D" alt="蓝1" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23016f6902494ea3bbf428deae9fc268~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771254485&amp;x-signature=ShnF7L%2FPaZJvVMajPgtGXK8O5vk%3D" alt="图片" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f799a9d22974976abb80c62449b2bcf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771254485&amp;x-signature=7kV0RRHzVo2984F88DznHMSz6JY%3D" alt="图片" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/164da1af9ea9435f99646ebc5e034e60~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771254485&amp;x-signature=HxiCsuMBoGCpg2fPMp7GT6NNUnE%3D" alt="图片" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b6294a5665a40d8ac1316d8eee2c285~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771254485&amp;x-signature=O2RkNlnBpsTDK5tQxfxdMSWqvAU%3D" alt="图片" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ac0b09d50a947b5a0f0b7076125bbab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771254485&amp;x-signature=OhvJUr2j%2Bz%2FF769KMwKd66%2F501I%3D" alt="图片" loading="lazy"/></p>
<p>&lt;&lt;&lt;截图了部分ClaudeMax帐号&gt;&gt;&gt;</p>
<p>这个架构的好处是，Anthropic 出了新模型，用户换个模型名就能直接用，我这边不需要做任何改动。所以凌晨两点我不用改代码，直接拿 Opus 4.6 开始跑。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4b27f08d39d45fbb9c02d94acdf98e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771254485&amp;x-signature=yamI4GclFP6oN%2FTAPnVK0It2dtk%3D" alt="图片" loading="lazy"/></p>
<p>一口气折腾到早上五点，记录一下实际体验。</p>
<h2 data-id="heading-0">100 万上下文，终于补上了</h2>
<p>这是 Opus 系列第一次支持 1M token 上下文。之前 Opus 4.5 只有 200K，Sonnet 4.5 倒是早就有 1M 了，但 Sonnet 的推理能力跟 Opus 差了一个量级。</p>
<p>现在 Opus 也有 1M 了。最强大脑配上最大记忆，这个组合之前一直缺。</p>
<p>我拿自己的项目试了一下。后端 Go 加前端 Vue，大概十几万行代码，全部塞进去让它做架构审查。Opus 4.5 做这个事得分批喂，每次都要重新交代上下文。Opus 4.6 一次吃完，从路由层看到 service 层再到数据库 schema，直接指出了两处我没注意到的循环依赖。</p>
<p>这个体验跟之前不是一个级别。</p>
<p>Anthropic 放了个 MRCR v2 测试结果：1M tokens 里藏 8 根针，Opus 4.6 召回率 76%，Sonnet 4.5 只有 18.5%。四倍差距。不只是"能塞进去"，而是"塞进去之后还记得住"。</p>
<p>不过 1M 目前还是 beta，需要单独申请。按 $5/MTok 的输入价算，塞满一次就是 5 美金。实际使用得有策略，不是越多越好。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c36ca21e2d640688140352ed50e4a9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771254485&amp;x-signature=JBNNTbxc65xQTi95e1cI6yExm%2BY%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-1">Adaptive Thinking：同一个模型，自动调深度</h2>
<p>这个功能我觉得被低估了。</p>
<p>以前的 extended thinking 是开关式的——要么开，要么不开。开了就慢，不开可能想不清楚。Opus 4.6 新增了四档思考深度，模型根据问题复杂度自动切换，开发者也能手动控制。</p>
<p>我在 AI编程巴士上跑了一组对比：</p>
<ul>
<li>• 简单任务（改变量名、写注释）：响应比 Opus 4.5 快了大概 30%，模型判断不需要深度推理，直接出结果</li>
<li>• 中等任务（重构函数、解释业务逻辑）：速度持平</li>
<li>• 复杂任务（分析并发 bug、设计系统架构）：稍慢，但输出质量明显好了</li>
</ul>
<p>因为是 Claude Max 直连，thinking 过程完整透传，不会被截断。跑复杂任务的时候能看到模型的思考链一步步展开，流式输出全程无断流。再加上我们做了 prompt 缓存优化，命中率在 95% 以上，重复上下文不用重新算，响应速度比直连 API 还快一截。</p>
<p>以前很多人为了省钱会手动分流——简单问题用 Haiku，复杂问题用 Opus。现在一个 Opus 4.6 就够了，模型自己决定花多少算力。同样的预算能做更多事。</p>
<h2 data-id="heading-2">Agent Teams：从串行到并行</h2>
<p>之前 Claude Code 的 subagent 是串行的——主代理分配任务，子代理做完了回来汇报，再分配下一个。</p>
<p>Agent Teams 变成了并行协作，代理之间能直接通信。</p>
<p>我试了一个场景：让它审查一个全栈 API 变更。它自动拆成三条线——后端路由校验、前端调用检查、测试覆盖分析——同时跑。后端那条线发现我改了一个字段名，直接通知前端线去定位没更新的调用点，不用回到主代理中转。</p>
<p>以前是"你去干活，干完了告诉我"。现在是"你们几个商量着来"。</p>
<p>这个功能目前主要在 Claude Code 里体现，API 层面还没完全开放。后续 Anthropic 可能会把多代理能力以 tool_use 的形式开放出来，到时候玩法会多很多。</p>
<h2 data-id="heading-3">价格不变，成本反而可能降</h2>
<p>5输入/25 输出 / MTok，和 Opus 4.5 一样。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/858d33463ea14ac3973065059325edfc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771254485&amp;x-signature=OnKklx%2F8NwZr%2Bna2rpRTcT5db4M%3D" alt="图片" loading="lazy"/></p>
<p>旗舰模型升级不涨价，这个我没想到。AI编程巴士上用户的使用成本完全不受影响，模型名换一下就行。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1d362e7add1438099137b5132ff13f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771254485&amp;x-signature=QAoj1dt11%2BuvhhX1rJt6Anp%2FxPQ%3D" alt="图片" loading="lazy"/></p>
<p>但实际开销可能还会降——Adaptive Thinking 让简单任务消耗更少的 token。如果你日常七八成是编码辅助，只有两三成需要深度推理，总成本大概率比之前低。</p>
<p>我打算跑一周数据，统计一下新老模型的实际 token 消耗差异，到时候再分享。</p>
<h2 data-id="heading-4">跑分参考</h2>
<p>Terminal-Bench 2.0（代理编码）：65.4%，历史最高。不过 20 分钟后 OpenAI 发的 GPT-5.3 Codex 拿了 77.3%，超了 12 个点。</p>
<p>GDPval-AA（综合推理）：1606 Elo，比 GPT-5.2 高 144 分，比 Opus 4.5 高 190 分。</p>
<p>Humanity's Last Exam（跨学科推理）：领先所有公开模型。</p>
<p>跑分看个大概就行。不同 benchmark 的测试框架、题目集都不一样，跨模型对比本身就不严谨。我更信自己手上跑出来的结果。</p>
<h2 data-id="heading-5">值得注意的坑</h2>
<p>Reddit 上有人反馈写作能力比 4.5 退步了——"结构工整但没有灵气"。社区猜测是 Anthropic 做了大量 RL 拉编程分数，牺牲了自然语言表达。</p>
<p>另一个 breaking change：assistant message prefilling 被禁了，直接返回 400。依赖这个功能的开发者需要改代码。</p>
<p>场景偏写作的，建议先测再迁移。编程场景可以放心切。</p>
<h2 data-id="heading-6">怎么用上 Opus 4.6</h2>
<p>直接调 Anthropic API，模型名填 <code>claude-opus-4-6</code>，接口协议和之前完全一样。</p>
<p>如果你没有 Anthropic API 的直接访问权限，或者需要在团队内按量分发配额，可以看看 AI编程巴士。纯血 Claude Max 直连，有思考、无断流、缓存命中 95%+（每天详细调用量发送你的邮箱），新模型发布即可用。Claude、GPT、Gemini 统一接口，按 token 计费，有超级便宜的包月套餐可选。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec487a6063044e91ba9223ef1e60cba8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771254485&amp;x-signature=aMfCexZ%2Bfjvy77SB4IQG7TY6B5E%3D" alt="图片" loading="lazy"/></p>
<p>体验了一整晚，Opus 4.6 在编程方向的提升是实打实的。1M 上下文让大项目不用再分批投喂，Adaptive Thinking 让日常使用更省钱，价格还没变。</p>
<p>作为日常开发的默认模型，可以切了。</p>
<p>如果你也在用 AI 编程，欢迎交流，20133213可以找到我。</p>
<p>易安致力于为高T提供稳定可靠的纯血Claude,GPT,Gemini 模型服务，节省你们的时间，平均才0.5-0.6元一刀，而且是纯血帐号，无逆向，无倍率，性价比拉满。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用 Claude Code 远程分析生产日志，追踪 Claude Max 账户被封原因]]></title>    <link>https://juejin.cn/post/7604685644684279860</link>    <guid>https://juejin.cn/post/7604685644684279860</guid>    <pubDate>2026-02-09T15:09:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604685644684279860" data-draft-id="7604671453453008911" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用 Claude Code 远程分析生产日志，追踪 Claude Max 账户被封原因"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-09T15:09:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="易安说AI"/> <meta itemprop="url" content="https://juejin.cn/user/4009298287660777"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用 Claude Code 远程分析生产日志，追踪 Claude Max 账户被封原因
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4009298287660777/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    易安说AI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T15:09:00.000Z" title="Mon Feb 09 2026 15:09:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你好，我是易安。
昨天晚上发现 AI编程巴士 的两个 Claude Max 账户挂了。一个报 400 "Organization disabled"，</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6fb04ccdd3244d50977a016fafd85fca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771254545&amp;x-signature=aZlG8GV4GQRh5G0Id6msAup1v%2FU%3D" alt="图片" loading="lazy"/></p>
<p>另一个报 403 "OAuth not allowed"。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d70cf81645684c398049fa1cf4391663~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771254545&amp;x-signature=B2CuN8rK%2FM168KCSohSQgh%2BLjcM%3D" alt="图片" loading="lazy"/></p>
<p>这种事手动查当然也能查，但我想试试直接让 Claude Code 来干——SSH 到服务器、定位日志、查数据库、出分析报告，全程不用我写一行 SQL。</p>
<p>记录下整个过程。</p>
<h2 data-id="heading-0">AI编程巴士是什么</h2>
<p>先说背景。<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkyODMwNDYzOA%3D%3D%26mid%3D2247502427%26idx%3D1%26sn%3D9a809ab5fb57517a7be80ca469080e9a%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkyODMwNDYzOA==&amp;mid=2247502427&amp;idx=1&amp;sn=9a809ab5fb57517a7be80ca469080e9a&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">AI编程巴士</a>是我做的一个 Claude Max 共享平台，底层是自研的 API 网关。用户通过标准的 OpenAI/Anthropic API 格式调用，网关负责把请求分发到后面的 Claude Max 账户上去。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04546f25bb944a318b155fc3e4467aff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771254545&amp;x-signature=M5smE8eexVZHtFJCwjdYKzEW2hc%3D" alt="图片" loading="lazy"/></p>
<p>每个 Claude Max 账户（我们叫 claudemax-001 到 claudemax-022）都是真实的 Anthropic 订阅，通过 OAuth 认证接入。用户在 Claude Code、Cursor、VS Code 里配上 API Key，实际消耗的就是这些 Max 账户的额度。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4738091ea3c49258cc0360f21b00fa0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771254545&amp;x-signature=flAHbgTZjIPRXGl9Pg4s0xZIqmM%3D" alt="图片" loading="lazy"/></p>
<p>这不是转卖 API Key，是共享 Claude Max 订阅的调用额度，区别在于——每个请求都经过网关的调度、计费、负载均衡。</p>
<h2 data-id="heading-1">问题发现</h2>
<p>晚上看了眼管理后台，claudemax-002 和 claudemax-007 状态变成了 error。错误信息分别是：</p>
<ul>
<li>• <strong>claudemax-002</strong>: <code>Organization disabled (400): This organization has been disabled.</code></li>
<li>• <strong>claudemax-007</strong>: <code>Access forbidden (403): OAuth authentication is currently not allowed for this organization.</code></li>
</ul>
<p>两个不同的错误码，意味着封禁程度不一样。我需要搞清楚是什么触发了 Anthropic 的风控。</p>
<h2 data-id="heading-2">让 Claude Code 来查</h2>
<p>打开终端，启动 Claude Code，告诉它：</p>
<blockquote>
<p>查询生产日志，分析 claudemax-002 和 claudemax-007 近2天的使用情况，分析封禁原因。</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/596dbcbde0f44eb2adc38cdb83a214d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771254545&amp;x-signature=jWla6IxNbL1KynAd6hAT9oalwpk%3D" alt="图片" loading="lazy"/></p>
<p>接下来就是它自己在折腾了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8dff07bdebf44b0685e12c30c8ffc3ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771254545&amp;x-signature=xrAbTAcOi0tpat8SivelM6sNkvw%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-3">第一步：定位日志在哪</h3>
<p>Claude Code 做的第一件事是 SSH 到服务器上找日志文件。这个过程并不顺利——它先去查了 Docker 容器（没有），又去查了 systemd 服务（没启动），然后通过 <code>ps aux</code> 找到了 <code>code80</code> 进程，再通过 <code>/proc/PID/fd/1</code> 追踪到日志被重定向到了 <code>/tmp/xxx.log</code>。</p>
<pre><code class="hljs language-bash" lang="bash">$ <span class="hljs-built_in">ls</span> -la /proc/2537306/fd/1
l-wx------ 1 root root 64 Feb  8 03:54 /proc/2537306/fd/1 -&gt; /tmp/xxx.log
</code></pre>
<p>但打开一看，日志只有 458K，2899 行——因为服务刚重启过，只有今天凌晨之后的数据。</p>
<h3 data-id="heading-4">第二步：转向数据库</h3>
<p>日志不够用，它自己决定改查数据库。从 配置文件<code> 里读到 PostgreSQL 的连接信息，然后开始写 SQL。</code></p>
<p>这里我没给它任何提示，它自己根据项目的 Ent schema 推断出了表结构，知道要查 账户表<code>和 使用日志``表。</code></p>
<p>第一条查询就把关键信息拿到了：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> id, name, status, error_message, updated_at, last_used_at
<span class="hljs-keyword">FROM</span> accounts <span class="hljs-keyword">WHERE</span> id <span class="hljs-keyword">IN</span> (<span class="hljs-number">10</span>, <span class="hljs-number">16</span>);
</code></pre>




















<table><thead><tr><th>账户</th><th>状态</th><th>错误信息</th></tr></thead><tbody><tr><td>claudemax-002</td><td>error</td><td>Organization disabled (400)</td></tr><tr><td>claudemax-007</td><td>error</td><td>OAuth forbidden (403)</td></tr></tbody></table>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac40d2dcc9f6497ab29f714db4e2825b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771254545&amp;x-signature=hexppUHtcR2%2FWgX7u%2BwnHynViFY%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-5">第三步：深度分析</h3>
<p>接下来它连续跑了 7、8 条 SQL，维度覆盖得挺全：</p>
<p><strong>每日调用统计</strong>——两个账户近2天分别有多少请求、消耗多少 token、花了多少钱。</p>
<p><strong>每小时频率分布</strong>——定位高峰时段。claudemax-002 在 2月7号下午 14 点一个小时内涌入了 472 次请求。claudemax-007 在 2月7号 16 点出现了峰值。</p>
<p><strong>每分钟峰值</strong>——最夸张的是 claudemax-007 在 16:21 那一分钟打了 32 次请求。</p>
<p><strong>模型分布</strong>——哪些请求在调 Opus，哪些在调 Sonnet，哪些在调 Haiku。</p>
<p><strong>用户分布</strong>——谁在用这两个账户。claudemax-002 被 6 个用户共享，claudemax-007 被 5 个用户共享。</p>
<p><strong>调用来源</strong>——几乎全部来自 Claude CLI 和 VS Code 插件，都是 AI编程巴士 的用户在用 Claude Code 编程。</p>
<p><strong>全生命周期统计</strong>——claudemax-002 从 1月21号创建以来，18 天累计调用 29,487 次，消耗 2070 万 tokens，费用 $1,178。</p>
<h2 data-id="heading-6">分析报告</h2>
<p>数据跑完，封禁原因就很清楚了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0261bf4fb457476ab5a8b39a7290ed0e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771254545&amp;x-signature=by%2FliNxux%2BIU4XaYlYVGJc1uEec%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-7">claudemax-002：组织被禁用（400）</h3>
<p>这是最严重的封禁。18 天花了 1,178，一个月如果不出事大概要奔着2000 去了。正常个人用 Claude Max 一个月 $200 的订阅费，这个消耗量很恐怖。</p>
<p>关键特征：</p>
<ul>
<li>• 近2天 2,025 次请求，是所有活跃账户里最高的</li>
<li>• 被 6 个不同用户使用，请求来自不同 IP 和 session</li>
<li>• 2月6号晚上 21-23 点，3 个小时内 638 次请求，高峰期同时有 3-4 个用户在用</li>
<li>• 2月7号下午 14 点，jf(化名) 一个人一小时打了 472 次</li>
</ul>
<p>Anthropic 大概率是通过消费异常 + 多用户特征识别出来的。</p>
<h3 data-id="heading-8">claudemax-007：OAuth 认证被禁止（403）</h3>
<p>这个相对轻一些——不是组织被禁用，只是 OAuth 认证方式被限制了，实际我登录已经被封了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89b19b8f55d441e78191951b0db6a184~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771254545&amp;x-signature=aNogUunkDdsCWGaf1nh%2BTyykUCY%3D" alt="图片" loading="lazy"/></p>
<p>它的总使用量（$354）没有 002 那么夸张，但请求密度高。每分钟 32 次的峰值在所有账户中最高，这种频率不像人类手动操作，更像是 API 自动调用的模式。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/afbf12fcaf974e4da8d26d22b65c4879~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771254545&amp;x-signature=DrvzMH%2BnQ%2BCFedMUKjL9%2FfAKvoQ%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-9">两种封禁的区别</h3>
<p>400 "Organization disabled" 意味着整个组织被停了，包括网页端 claude.ai 大概率也用不了。这是 Anthropic 对严重违规的处理方式。</p>
<p>403 "OAuth not allowed" 只是限制了 API 调用方式，可能网页端还能用，这更像是一个"警告"级别的限制，实际我登录上去看，也被封了，上图也说了。</p>
<h2 data-id="heading-10">整个过程花了多久</h2>
<p>从我输入那句话到拿到完整报告，大概 3 分钟。Claude Code 执行了大约 20 次工具调用——SSH 连接、文件查找、进程追踪、配置读取、SQL 查询。中间走了一些弯路（比如先去查 Docker），但最终都自己修正了方向。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6de3d7e0bba54933ba3bd6bae2388f5a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piT5a6J6K-0QUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771254545&amp;x-signature=nSN5jNpTz1N9iE2EYVllO%2FnIbqU%3D" alt="图片" loading="lazy"/></p>
<p>如果我自己来做：SSH 上去、找日志、写 SQL、汇总数据，估计要 20-30 分钟。而且我大概率不会像它那样跑 7、8 个维度的分析，可能查到错误信息就停了。</p>
<p>这就是 Claude Code 做运维分析的价值——不是说它比你聪明，而是它不嫌麻烦。你让它查，它就会把能查的维度都查一遍，最后给你一份比你自己写的更全面的报告。</p>
<h2 data-id="heading-11">AI编程巴士的用户在用 Claude Code 干什么</h2>
<p>从 user_agent 数据看，几乎所有请求都来自 <code>claude-cli</code>（Claude Code 的 CLI 工具）和 <code>claude-vscode</code>（VS Code 插件）。这些是 AI编程巴士 的核心使用场景——用户用自己的 API Key 接入 Claude Code，在本地编程。</p>
<p>模型分布也很有意思：</p>
<ul>
<li>• <code>claude-haiku-4-5</code> 请求量最大但成本最低，主要是 Claude Code 的 tool use 和上下文管理在用</li>
<li>• <code>claude-sonnet-4-5</code> 是主力编程模型，成本占比最高</li>
<li>• <code>claude-opus-4-6</code> 用来处理复杂任务，单次成本最高</li>
</ul>
<p>这个分布完全符合 Claude Code 的工作模式：用 Haiku 做快速判断和工具调用，用 Sonnet 写代码，遇到难题切 Opus。AI编程巴士 提供的就是这种真实的 Claude Max 体验——不是阉割版、不是第三方套壳，而是原汁原味的 Anthropic API 调用。</p>
<h2 data-id="heading-12">经验教训</h2>
<p>这次封号给了几个教训：</p>
<p><strong>单账户负载控制。</strong>  claudemax-002 一个账户扛了 6 个用户、日均千次请求，太集中了。后续需要更均匀地分散到各个账户上。</p>
<p><strong>请求频率限速。</strong>  每分钟 32 次对 Anthropic 来说可能不算高，但如果来自同一个 OAuth token 的不同 session，就很可疑了。网关层面需要加上 per-account 的 rate limiting。</p>
<p><strong>监控提前预警。</strong>  等账户挂了再查就晚了。应该在日消费超过阈值、或者分钟级请求数异常时就发告警。</p>
<p>AI编程巴士 现在还剩20几个活跃的 Claude Max 账户，新补的今天刚上线。接下来要做的是优化调度策略——让每个账户的使用量更均匀，避免再出现一个账户扛大头的情况。</p>
<h2 data-id="heading-13">关于 Claude Code 做运维</h2>
<p>最后说说工具本身。Claude Code 做这种"SSH 上去查问题"的事确实好用，它的优势在于：</p>
<ol>
<li>1. <strong>不需要你记命令。</strong>  <code>/proc/PID/fd</code> 这种路径我平时也不会想到去查，但它知道。</li>
<li>2. <strong>会自己调整方案。</strong>  日志不够就改查数据库，一条路走不通就换另一条。</li>
<li>3. <strong>分析维度全。</strong>  你让它查封禁原因，它会把相关的所有维度都跑一遍——时间分布、用户分布、模型分布、频率峰值，不是只给你一个数字。</li>
</ol>
<p>当然也有局限：它不能帮你做判断。数据拿到了，"这个消费水平是不是会触发风控"这种经验性的判断还是得靠你自己。它只负责把事实摆出来。</p>
<p>对于在用 AI编程巴士 的同学，放心，被封的账户已经替换掉了。如果你在使用过程中遇到偶尔的 429 或者响应变慢，那可能是调度在切换账户，等几秒重试就好，一般不会遇到这个问题。</p>
<p>最后还是说一下，刚刚上线一周，已经得到很多小伙伴积极反馈了，用过的都说好。易安致力于为高T提供稳定可靠的纯血Claude,GPT,Gemini 模型服务，节省你们的时间，平均才0.5-0.6元一刀，而且是纯血帐号，无逆向，无倍率，性价比拉满。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从零学习Kafka：数据存储]]></title>    <link>https://juejin.cn/post/7604709514130817070</link>    <guid>https://juejin.cn/post/7604709514130817070</guid>    <pubDate>2026-02-09T15:50:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604709514130817070" data-draft-id="7604665952320110643" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从零学习Kafka：数据存储"/> <meta itemprop="keywords" content="后端,Kafka"/> <meta itemprop="datePublished" content="2026-02-09T15:50:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="面向Google编程"/> <meta itemprop="url" content="https://juejin.cn/user/1063982986695374"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从零学习Kafka：数据存储
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1063982986695374/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    面向Google编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T15:50:30.000Z" title="Mon Feb 09 2026 15:50:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>不知道有没有朋友和我一样，虽然了解 Kafka 的逻辑存储，例如 Broker、Topic、Partition 这些概念，但是对于底层数据是如何存储还是比较模糊。这样聊起来 Kafka 数据存储时总有种一知半解的感觉。今天我们就一起来看一下 Kafka 底层数据到底是怎么存储的。</p>
<h3 data-id="heading-0">环境准备</h3>
<p>在开始之前，我们先搭建好单机的 Kafka 集群，并且实际写入一批数据，这样就可以直接观察写入 Kafka 的数据了。下面可以跟着我的步骤一起搭建集群并写入数据。开始之前先说明一下，操作过程中可能涉及到一些配置参数的修改和检查，如果对配置参数不熟悉的话，可以查看上一篇文章。</p>
<p>首先到 Kafka 的下载页面下载最新版本的压缩包。</p>
<pre><code class="hljs language-bash" lang="bash">https://www.apache.org/dyn/closer.cgi?path=/kafka/4.1.1/kafka_2.13-4.1.1.tgz
</code></pre>
<p>下载好之后，进行解压并进入到对应的目录。</p>
<pre><code class="hljs language-bash" lang="bash">tar -xzf kafka_2.13-4.1.1.tgz
<span class="hljs-built_in">cd</span> kafka_2.13-4.1.1
</code></pre>
<p>接着我们执行下面两条命令进行一些必要的配置。</p>
<pre><code class="hljs language-bash" lang="bash">KAFKA_CLUSTER_ID=<span class="hljs-string">"<span class="hljs-subst">$(bin/kafka-storage.sh random-uuid)</span>"</span>

bin/kafka-storage.sh format --standalone -t <span class="hljs-variable">$KAFKA_CLUSTER_ID</span> -c config/server.properties
</code></pre>
<p>为了方便观察文件切分，我把 segment 文件大小调整为了 1MB，具体修改方法为编辑 config/server.properties 文件，修改 <code>log.segment.bytes</code> 参数的数值。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d017ca94c2aa4f0bba2fbd08f896d771~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771257029&amp;x-signature=RShPM%2F9JkYG1TYFYac9LBafMbjM%3D" alt="segmentsize" loading="lazy"/></p>
<p>修改好之后，就可以启动 Kafka 集群了。</p>
<pre><code class="hljs language-bash" lang="bash">bin/kafka-server-start.sh config/server.properties
</code></pre>
<p>可以观察日志，看集群是否启动成功</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb06c61ec1f54088b3e52b124ec490f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771257029&amp;x-signature=lSDHM7IUjFgNq3n7CcskV74PLbc%3D" alt="clusterstarted" loading="lazy"/></p>
<p>集群启动之后，我们手动创建一个测试 topic。</p>
<pre><code class="hljs language-lua" lang="lua">bin/kafka-topics.sh <span class="hljs-comment">--create \</span>
    <span class="hljs-comment">--bootstrap-server localhost:9092 \</span>
    <span class="hljs-comment">--topic test-topic \</span>
    <span class="hljs-comment">--partitions 2 \</span>
    <span class="hljs-comment">--replication-factor 1</span>
</code></pre>
<p>接着可以使用 Kafka 提供的压测工具来写入一批数据。</p>
<pre><code class="hljs language-css" lang="css">bin/kafka-producer-perf-test<span class="hljs-selector-class">.sh</span> \
    <span class="hljs-attr">--topic</span> test-topic \
    <span class="hljs-attr">--num-records</span> <span class="hljs-number">50000</span> \
    <span class="hljs-attr">--record-size</span> <span class="hljs-number">100</span> \
    <span class="hljs-attr">--throughput</span> -<span class="hljs-number">1</span> \
    <span class="hljs-attr">--producer-props</span> bootstrap<span class="hljs-selector-class">.servers</span>=localhost:<span class="hljs-number">9092</span>
</code></pre>
<p>这里我分两次写入，每次写入了 50000 条数据，每条数据大小 100 字节，也就是一共写入了大约 10MB 数据。</p>
<p>现在把目光投向 <code>/tmp/kraft-combined-logs</code> 这个目录。如果没有这个目录，需要看一下集群配置的目录。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f42037e1bc6475c969ecda317ddec87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771257029&amp;x-signature=k2sbDNBGBx4Ac8AO0MTv6VHPKT8%3D" alt="category" loading="lazy"/></p>
<h3 data-id="heading-1">Broker 根目录</h3>
<p>首先来看第一级目录</p>
<pre><code class="hljs language-diff" lang="diff">drwxr-xr-x  10 wheel  320  1月 31 00:25 __cluster_metadata-0
<span class="hljs-deletion">-rw-r--r--   1 wheel  355  1月 31 00:14 bootstrap.checkpoint</span>
<span class="hljs-deletion">-rw-r--r--   1 wheel    0  1月 31 00:14 cleaner-offset-checkpoint</span>
<span class="hljs-deletion">-rw-r--r--   1 wheel    4  1月 31 00:52 log-start-offset-checkpoint</span>
<span class="hljs-deletion">-rw-r--r--   1 wheel  122  1月 31 00:14 meta.properties</span>
<span class="hljs-deletion">-rw-r--r--   1 wheel   42  1月 31 00:52 recovery-point-offset-checkpoint</span>
<span class="hljs-deletion">-rw-r--r--   1 wheel   42  1月 31 00:52 replication-offset-checkpoint</span>
drwxr-xr-x  23 wheel  736  1月 31 00:33 test-topic-0
drwxr-xr-x  27 wheel  864  1月 31 00:33 test-topic-1
</code></pre>
<p>这里一共有 9 个文件（目录），大体上可以分为三类：<strong>集群元数据、数据目录和 Checkpoint 文件</strong>。</p>
<h4 data-id="heading-2">集群元数据</h4>
<p><code>meta.properties</code> 是 Broker 的身份证，这里记录了 Cluster ID 和 Node ID。</p>
<p><code>bootstrap.checkpoint</code> 用于记录集群初始化信息。</p>
<p><code>__cluster_metadata-0</code> 是一个特殊的数据目录，它记录了集群的元数据，因此我将其归类到集群元数据中。</p>
<h4 data-id="heading-3">数据目录</h4>
<p><code>test-topic-0</code> 和 <code>test-topic-1</code> 这两个目录就是我们 test-topic 的两个 partition 存储数据的目录，待会儿再详细分析目录下的内容，现在你只需要知道 Kafka 是以 topic名 + partitionId 来命名数据目录的。</p>
<h4 data-id="heading-4">Checkpoint 文件</h4>
<p>剩下的都是 checkpoint 文件，是用于宕机重启后的快速恢复的。</p>
<p><code>cleaner-offset-checkpoint</code> 这是清理检查点文件，只有设置了 <code>cleanup.policy=compact</code> 时才有用，它记录了上一次 Log Compact 各个 partition 已清理的偏移量。</p>
<p><code>log-start-offset-checkpoint</code> 日志起始位置，记录每个分区第一个有效的 Offset。</p>
<p><code>recovery-point-offset-checkpoint</code> 记录每个 partition 已刷盘的 Offset。</p>
<p><code>replication-offset-checkpoint</code> 记录每个 partition 已同步的 Offset，这里记录的就是 High Watermark。</p>
<h3 data-id="heading-5">Partition 存储结构</h3>
<p>现在我们再来看下数据目录下的各个文件的作用是什么。</p>
<h4 data-id="heading-6">核心三兄弟</h4>
<p>首先来介绍数据存储的核心，分别是 <code>.log</code> 、<code>.index</code> 和 <code>.timeindex</code> 文件，每个 Segment 都会有这三个文件，它们的文件名都是文件内存的第一条消息的 Offset。</p>
<h5 data-id="heading-7">log 文件</h5>
<p><code>.log</code> 是消息数据文件，Kafka 接收的消息都会顺序写入到这个文件中。可以通过下面这个命令查看文件的内容：</p>
<pre><code class="hljs language-perl" lang="perl">~<span class="hljs-regexp">/workspace/</span>kafka_2.<span class="hljs-number">13</span>-<span class="hljs-number">4.1</span>.<span class="hljs-number">1</span>/bin/kafka-<span class="hljs-keyword">dump</span>-log.sh --files test-topic-<span class="hljs-number">0</span>/<span class="hljs-number">0000000000000000</span>9472.log --<span class="hljs-keyword">print</span>-data-<span class="hljs-keyword">log</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/085b06a8bd7349298991f501e5f9bfc4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771257029&amp;x-signature=717ABnlVud861mWfJnXieR%2F4%2FnI%3D" alt="logdata" loading="lazy"/></p>
<p>可以看到 log 文件中存储的主要是 Offset 和具体的序列化后的数据。</p>
<h5 data-id="heading-8">index 文件</h5>
<p><code>.index</code> 文件是偏移量索引文件，这里的索引是稀疏索引，文件内存储的是 Offset 到 log 文件位置的映射。我们使用下面这条命令来查看文件内容：</p>
<pre><code class="hljs language-lua" lang="lua">~/workspace/kafka_2<span class="hljs-number">.13</span><span class="hljs-number">-4.1</span><span class="hljs-number">.1</span>/bin/kafka-<span class="hljs-built_in">dump</span>-<span class="hljs-built_in">log</span>.sh <span class="hljs-comment">--files test-topic-0/00000000000000009472.index --deep-iteration</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/786f3ad296794a6db25af4fb5da7302e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771257029&amp;x-signature=BgoZRiWUaeJcZKE7jq0Ht1FxbRw%3D" alt="indexdata" loading="lazy"/></p>
<p>Kafka 默认每 4KB 数据写入一次索引，这个值可以通过 <code>log.index.interval.bytes</code> 参数调整。</p>
<h5 data-id="heading-9">timeindex 文件</h5>
<p><code>.timeindex</code> 是时间戳索引文件，用来支持 by_duration 按照时间回溯。查看文件内容的方法与查看 index 文件的方法类似：</p>
<pre><code class="hljs language-lua" lang="lua">~/workspace/kafka_2<span class="hljs-number">.13</span><span class="hljs-number">-4.1</span><span class="hljs-number">.1</span>/bin/kafka-<span class="hljs-built_in">dump</span>-<span class="hljs-built_in">log</span>.sh <span class="hljs-comment">--files test-topic-0/00000000000000009472.timeindex --deep-iteration</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/201e95a4a2c84748a5636892185d00d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771257029&amp;x-signature=2s4dRSOX%2FGGV%2Bv%2FJNsPhJvCX9rk%3D" alt="timeindexdata" loading="lazy"/></p>
<p>我们在定位数据时，可以通过二分法在 index 索引文件中找到对应的数据位置（或者最接近的位置），也可以先通过时间在 timeindex 文件中找到最接近的 Offset，再到 index 文件中找到数据位置。</p>
<h4 data-id="heading-10">辅助文件</h4>
<p>除了上述三个核心文件之外，在数据目录中还有三种辅助文件，我们来看下它们的作用。</p>
<ul>
<li><code>.snapshot</code> 文件是用来记录事务快照的。用于 Exactly-Once 语义，如果 Broker 宕机，可以通过加载这个文件知道 Producer 之前发送到哪里了，防止数据重复。查看文件内容的方法如下</li>
</ul>

<pre><code class="hljs language-lua" lang="lua">~/workspace/kafka_2<span class="hljs-number">.13</span><span class="hljs-number">-4.1</span><span class="hljs-number">.1</span>/bin/kafka-<span class="hljs-built_in">dump</span>-<span class="hljs-built_in">log</span>.sh <span class="hljs-comment">--files test-topic-0/00000000000000009472.snapshot</span>
</code></pre>
<ul>
<li><code>leader-epoch-checkpoint</code> 文件是一个 Leader “任期表”，它记录了每一任 Leader 开始工作时的 Offset，主要用于在选主时保证数据一致性。</li>
<li><code>partition.metadata</code> 文件是 Partition 的“身份证“，它存储了 Topic ID。</li>
</ul>
<h3 data-id="heading-11">Page Cache</h3>
<p>至此，我们已经比较细致的了解了 Kafka 底层存储结构。到这里不知道你会不会有疑问，Kafka 是写磁盘的，为什么速度还会这么快？</p>
<p>Kafka 在操作磁盘时，重度依赖操作系统的 Page Cache 功能，这个功能就是 Kafka 性能高的原因之一。简单来说，Page Cache 就是在读取磁盘时，操作系统会把读到的数据放到内存中一份，这块内存就是 Page Cache。在 Kafka 的应用场景中，Producer 写入顺序写入数据时，操作系统会先把数据写到 Page Cache，然后异步刷盘。在 Consumer 消费数据时，由于大部分情况下都是消费最新数据，因此要读的数据大概率还在 Page Cache 中， 操作系统可以直接从内存中返回。</p>
<p>题外话：Kafka 为什么不自己维护一套缓存机制呢？</p>
<p>我觉得主要有以下原因：</p>
<ol>
<li>避免 GC 开销，如果自己在 JVM 内存中维护缓存，那么会带来很大的 GC 压力。如果用操作系统的 Page Cache，就完全不用担心 GC 问题。</li>
<li>Page Cache 对内存的利用率更高，如果 Kafka 进程重启，Page Cache 也还会在内存中，数据不需要重新加载。</li>
<li>逻辑简单，Kafka 只需要负责读写操作，剩下的缓存维护逻辑全部交给操作系统。</li>
</ol>
<h3 data-id="heading-12">总结</h3>
<p>本文我们了解了 Kafka 物理层面的数据存储。在 Broker 根目录下，有集群元数据、数据目录、Checkpoint 文件三种类型的文件（目录）。在数据目录中，最核心的三种文件是 <code>.log</code>、<code>.index</code> 和 <code>.timeindex</code> 三种文件，它们分别存储了数据、稀疏 Offset 索引以及时间戳与 Offset 的映射。</p>
<p>希望你通过阅读本文，可以对 Kafka 的数据存储有一个更加清晰的认识。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Anki：让记忆更高效、更智能的开源力量]]></title>    <link>https://juejin.cn/post/7604671453453041679</link>    <guid>https://juejin.cn/post/7604671453453041679</guid>    <pubDate>2026-02-09T15:54:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604671453453041679" data-draft-id="7604685644684312628" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Anki：让记忆更高效、更智能的开源力量"/> <meta itemprop="keywords" content="开源"/> <meta itemprop="datePublished" content="2026-02-09T15:54:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="修己xj"/> <meta itemprop="url" content="https://juejin.cn/user/2641475936724142"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Anki：让记忆更高效、更智能的开源力量
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2641475936724142/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    修己xj
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T15:54:50.000Z" title="Mon Feb 09 2026 15:54:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你是否曾发现自己背过的单词、学过的知识点，几天后就模糊不清？面对繁杂的学习内容，如何高效记忆成为许多人共同面临的挑战。这不仅是时间管理的难题，更是记忆规律的挑战。</p>
<p>而一款名为Anki的开源软件正为全球数百万学习者提供了一种科学而有效的解决方案。通过独特的“间隔重复”机制，Anki 确保你将宝贵的时间花在那些即将忘记的知识点上，而对已经熟练掌握的内容则减少复习频率。这种智能化的调度，让记忆过程变得事半功倍，真正实现了“记得更多，花费更少”。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dcc3bc2974a0489d831c16fcee7110bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771257293&amp;x-signature=jyfd5iGG5YnLF%2F%2FeXRYJmQ6O1qs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">❓什么是Anki？</h2>
<p>Anki是一款抽认卡学习软件，其核心是帮助你优化时间分配：将更多精力用于攻克难点，而非重复已熟悉的内容。</p>
<p>github地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fankitects%2Fanki" target="_blank" title="https://github.com/ankitects/anki" ref="nofollow noopener noreferrer">github.com/ankitects/a…</a></p>
<p>web地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fankiweb.net" target="_blank" title="https://ankiweb.net" ref="nofollow noopener noreferrer">ankiweb.net</a></p>
<p>中文文档地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopen-spaced-repetition.github.io%2Fanki-manual-zh-CN%2F" target="_blank" title="https://open-spaced-repetition.github.io/anki-manual-zh-CN/" ref="nofollow noopener noreferrer">open-spaced-repetition.github.io/anki-manual…</a></p>
<p>该项目目前在github上已有<strong>26.3k</strong>⭐ star</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d64b2cec2414e21984efb9254c9a807~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771257293&amp;x-signature=hn6ie9OrrtR3y%2Fr8ba58v0B%2FquE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">🧠Anki为何如此强大？</h2>
<p>Anki 的强大之处就在于它<strong>自动化并优化了这个“恰当的复习时间点”</strong> 。当你创建一张卡片（Card）——比如一面是“Capital of France?”，另一面是“Paris”——Anki 的算法并不会让你每天都看到它。相反，它会根据你每次复习时的回答情况（例如，“完全忘了”、“有点困难”、“轻松想起”），精确地预测你何时最有可能忘记这张卡片上的信息，并在那个时间点（可能是几天后、几周后甚至几个月后）将它再次呈现给你。</p>
<h3 data-id="heading-2">📚Anki 的工作流程</h3>
<ul>
<li>• 创建卡片： 你可以在 Anki 中创建自己的卡片，或者从庞大的社区共享库（AnkiWeb）中下载现成的牌组（Deck）。每个牌组可以包含成百上千张卡片。</li>
<li>• 学习与复习： 打开 Anki，它会按照算法安排，依次向你展示卡片的正面（问题）。</li>
<li>• 自我测试： 在心中回忆答案，然后点击按钮翻转卡片查看背面（答案）。</li>
<li>• 诚实反馈： 根据你的记忆准确度，Anki 会要求你选择一个评级（通常为 Again/重来, Hard/困难, Good/良好, Easy/简单）。你的选择直接决定了这张卡片下次出现的时间间隔。</li>
</ul>
<p>通过这个循环，Anki 确保你把宝贵的时间都花在了那些“真正需要复习”的内容上，而不是一遍又一遍地重复已经烂熟于心的知识。</p>
<h2 data-id="heading-3">💎Anki 的核心优势：为什么值得你投入时间？</h2>
<ul>
<li>• 极致的效率： 间隔重复算法最大限度地减少了重复次数，在保证记忆效果的同时，显著缩短了学习时间。</li>
<li>• 持久的记忆： 通过科学的复习周期，帮助你将知识牢牢地钉在长期记忆里，告别考前突击、考后清零的窘境。</li>
<li>• 高度的灵活性： Anki 不局限于文字。你可以轻松地在卡片中嵌入图片、音频、视频和 LaTeX 数学公式，适用于语言学习（记单词、句子）、医学备考（记解剖结构、药理知识）、历史学习（记人名、事件）、编程（记语法、API）等多种场景。</li>
<li>• 强大的社区支持： AnkiWeb 上有数以万计由全球用户贡献的共享牌组，几乎覆盖所有主流学科和考试，你可以站在巨人的肩膀上，快速构建自己的学习资料库。</li>
<li>• 跨平台同步： 支持 Windows, macOS, Linux, Android, iOS 等多个平台。通过官方同步服务，你的学习进度和卡片数据可以在所有设备间无缝衔接，真正做到随时随地学习。</li>
</ul>
<h2 data-id="heading-4">🔥Anki 的开源精神：自由与协作的力量</h2>
<p>Anki 是一个开源项目，这意味着它的源代码是公开的，任何人都可以免费获取、研究、修改和分发。这种模式带来了诸多益处：</p>
<ul>
<li>• 免费可用： 桌面版 Anki 完全免费，这使得任何渴望高效学习的人都能接触到这项技术。</li>
<li>• 持续迭代： 全球的开发者社区共同参与 Anki 的开发和改进，使其功能不断完善，漏洞得以快速修复。</li>
<li>• 插件生态： 开源的特性催生了丰富的第三方插件（Add-ons），这些插件可以为 Anki 添加统计图表、笔记链接、特殊布局等各种高级功能，极大地扩展了其应用场景。</li>
<li>• 透明可信： 由于代码公开，用户可以确信 Anki 的算法和数据处理方式是透明、公正的，没有隐藏的数据收集或商业陷阱。</li>
</ul>
<h2 data-id="heading-5">🎖️开始你的 Anki 之旅</h2>
<ul>
<li>• 注册AnkiWeb账号</li>
</ul>
<p>注册地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fankiweb.net%2Faccount%2Fsignup" target="_blank" title="https://ankiweb.net/account/signup" ref="nofollow noopener noreferrer">ankiweb.net/account/sig…</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/24e113046d5842a29e9e806eb82ddf5a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771257293&amp;x-signature=F1MPkM8hZBlzYQAdyuxe40xBpxA%3D" alt="" loading="lazy"/></p>
<p>使用邮箱注册，需要在邮件中验证</p>
<p>注册完成后登录账号，在页面底部点击 <code>Get Shared Decks</code>,获取共享的牌组</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3a9b375dc094356bbeee2a8463c69ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771257293&amp;x-signature=h%2FNwJ2W9Cia1sTGlGzeEs31KutM%3D" alt="" loading="lazy"/></p>
<p>我们可以从这些共享牌组中找到我们想要学习的牌组</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7fa26b0a87f4f5a84753bd5cc17eecf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771257293&amp;x-signature=ehhJtKUHEXQXCIyE1C0eQycbnjg%3D" alt="" loading="lazy"/></p>
<ul>
<li>• windows下载</li>
</ul>
<p>下载地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fapps.ankiweb.net%2F" target="_blank" title="https://apps.ankiweb.net/" ref="nofollow noopener noreferrer">apps.ankiweb.net/</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a76de37412d248e39263593cceee9b11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771257293&amp;x-signature=X8fn6GZGjpRgYpqGWkkv7w2j9DE%3D" alt="" loading="lazy"/></p>
<p>下载完之后点击安装，之后会弹出一个黑窗口，选择1，按回车键下载最新版本</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9d937f39d3b426b89f8e91e1470832e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771257293&amp;x-signature=I%2FhKZINSK23MeCcTIn6gDX%2F1n94%3D" alt="" loading="lazy"/></p>
<p>下载完之后选择中文</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e99ed0f7b7854e1a8b3261197f5965e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771257293&amp;x-signature=IRmyNMqgY4s0e8Nb0e1wOgwi2rk%3D" alt="" loading="lazy"/></p>
<p>然后就可以进入anki了</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a32844f3f864dfe90af602c62581d9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771257293&amp;x-signature=AR9wwDz5pxqHwM3u9YImWV6jDz4%3D" alt="" loading="lazy"/></p>
<p>点击<code>同步</code>页签，配置<code>AnkiWeb</code> 的账号及密码，将<code>AnkiWeb</code>的信息同步到windows</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66f78f3186b54660b6abbbcf9f5a3206~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771257293&amp;x-signature=IND891q1etRiqUQf4lto%2BqGuD0M%3D" alt="" loading="lazy"/></p>
<p>然后就可以学习了</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4aee0f359654f19a4bf9f879177e0e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771257293&amp;x-signature=U%2F9ABbsAFhdjJANA%2BiRWgiy8QLs%3D" alt="" loading="lazy"/></p>
<ul>
<li>• Android 下载</li>
</ul>
<p>如果我们平时碎片化时间较多的话可以使用手机学习，下载Android安装包</p>
<p>Anki-Android github地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fankidroid%2FAnki-Android" target="_blank" title="https://github.com/ankidroid/Anki-Android" ref="nofollow noopener noreferrer">github.com/ankidroid/A…</a></p>
<p>安装包下载地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fankidroid%2FAnki-Android%2Freleases" target="_blank" title="https://github.com/ankidroid/Anki-Android/releases" ref="nofollow noopener noreferrer">github.com/ankidroid/A…</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bfd5708b1dcb46b498b0e04dc68f854a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771257293&amp;x-signature=JsZpO3HD3PURDncVi7%2BReD9VGm8%3D" alt="" loading="lazy"/></p>
<p>下载完成之后也是安装，配置AnkiWeb的信息用以同步</p>
<ul>
<li>• 自建牌组，卡片信息</li>
</ul>
<p>如果我们需要学习自定义的一些知识，可以自建牌组，卡片信息，具体参考文档，文档比较详细</p>
<p>文档地址： <a href="https://link.juejin.cn?target=https%3A%2F%2Fopen-spaced-repetition.github.io%2Fanki-manual-zh-CN%2F" target="_blank" title="https://open-spaced-repetition.github.io/anki-manual-zh-CN/" ref="nofollow noopener noreferrer">open-spaced-repetition.github.io/anki-manual…</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee638806958c4a7f839c2ea216af2141~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771257293&amp;x-signature=IH%2BhRo60EdpZi8Y79I2Wb5j%2B5QU%3D" alt="" loading="lazy"/></p>
<ul>
<li>• 学习建议</li>
</ul>
<ol>
<li>
<ol>
<li>寻找优质牌组： 优先尝试从 AnkiWeb 下载一个你感兴趣领域的现成牌组，来学习。</li>
</ol>
</li>
<li>
<ol start="2">
<li>学习制卡原则： 高质量的卡片是高效复习的前提。学习“最小信息原则”（每张卡片只问一个问题）、“主动回忆”等技巧，避免制作过于冗长或模糊的卡片。</li>
</ol>
</li>
<li>
<ol start="3">
<li>保持每日复习： Anki 的效果建立在持续使用的基础上。即使每天只复习几分钟，也比一周突击一次效果要好得多</li>
</ol>
</li>
</ol>
<h2 data-id="heading-6">📝结语</h2>
<p>总之，Anki 是一个集科学、高效、自由于一体的强大工具。它不会让学习本身变得毫不费力，但它会让你付出的每一分努力都更有价值。如果你正苦恼于记忆难题，不妨试试 Anki，让科学的方法为你的学习赋能。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenClaw架构揭秘：178k stars的个人AI助手如何用Gateway模式统一控制12+通讯频道]]></title>    <link>https://juejin.cn/post/7604574877035167787</link>    <guid>https://juejin.cn/post/7604574877035167787</guid>    <pubDate>2026-02-09T15:58:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604574877035167787" data-draft-id="7604678037807956004" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenClaw架构揭秘：178k stars的个人AI助手如何用Gateway模式统一控制12+通讯频道"/> <meta itemprop="keywords" content="前端,GitHub,JavaScript"/> <meta itemprop="datePublished" content="2026-02-09T15:58:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="iDao技术魔方"/> <meta itemprop="url" content="https://juejin.cn/user/166781496080782"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenClaw架构揭秘：178k stars的个人AI助手如何用Gateway模式统一控制12+通讯频道
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/166781496080782/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    iDao技术魔方
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T15:58:49.000Z" title="Mon Feb 09 2026 15:58:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>一句话简介</strong>：178k stars 的开源项目 OpenClaw，用一套 Gateway 架构同时接入了 WhatsApp、Telegram、Slack、Discord 等 12+ 通讯频道，还实现了 Canvas 可视化、全时语音、浏览器控制等高级功能。这篇文章将深度拆解它的架构设计，告诉你一个「个人 AI 助手」应该如何构建。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">📋 目录</h2>
<ul>
<li><a href="#%E8%83%8C%E6%99%AF%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E4%B8%AA%E4%BA%BAai%E5%8A%A9%E6%89%8B" title="#%E8%83%8C%E6%99%AF%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E4%B8%AA%E4%BA%BAai%E5%8A%A9%E6%89%8B">背景：为什么需要个人AI助手？</a></li>
<li><a href="#%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%A7%88178k-stars%E7%9A%84openclaw" title="#%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%A7%88178k-stars%E7%9A%84openclaw">项目概览：178k stars的OpenClaw</a></li>
<li><a href="#%E6%A0%B8%E5%BF%83%E6%9E%B6%E6%9E%84gateway-websocket%E6%8E%A7%E5%88%B6%E5%B9%B3%E9%9D%A2" title="#%E6%A0%B8%E5%BF%83%E6%9E%B6%E6%9E%84gateway-websocket%E6%8E%A7%E5%88%B6%E5%B9%B3%E9%9D%A2">核心架构：Gateway WebSocket控制平面</a></li>
<li><a href="#%E5%A4%9A%E9%A2%91%E9%81%93%E6%8E%A5%E5%85%A512%E9%80%9A%E8%AE%AF%E9%A2%91%E9%81%93%E7%9A%84%E7%A7%98%E5%AF%86" title="#%E5%A4%9A%E9%A2%91%E9%81%93%E6%8E%A5%E5%85%A512%E9%80%9A%E8%AE%AF%E9%A2%91%E9%81%93%E7%9A%84%E7%A7%98%E5%AF%86">多频道接入：12+通讯频道的秘密</a></li>
<li><a href="#pi-agentai%E5%A4%A7%E8%84%91%E7%9A%84rpc%E5%AE%9E%E7%8E%B0" title="#pi-agentai%E5%A4%A7%E8%84%91%E7%9A%84rpc%E5%AE%9E%E7%8E%B0">Pi Agent：AI大脑的RPC实现</a></li>
<li><a href="#canvasa2ui%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E4%BD%9C%E7%A9%BA%E9%97%B4" title="#canvasa2ui%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E4%BD%9C%E7%A9%BA%E9%97%B4">Canvas+A2UI：可视化工作空间</a></li>
<li><a href="#voice-waketalk-mode%E5%85%A8%E6%97%B6%E8%AF%AD%E9%9F%B3%E4%BA%A4%E4%BA%92" title="#voice-waketalk-mode%E5%85%A8%E6%97%B6%E8%AF%AD%E9%9F%B3%E4%BA%A4%E4%BA%92">Voice Wake+Talk Mode：全时语音交互</a></li>
<li><a href="#skills-platform%E4%B8%89%E7%BA%A7%E6%8F%92%E4%BB%B6%E7%B3%BB%E7%BB%9F" title="#skills-platform%E4%B8%89%E7%BA%A7%E6%8F%92%E4%BB%B6%E7%B3%BB%E7%BB%9F">Skills Platform：三级插件系统</a></li>
<li><a href="#%E6%8A%80%E6%9C%AF%E5%90%AF%E5%8F%91%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E7%9A%84%E9%80%9A%E7%94%A8%E6%80%A7%E6%80%9D%E8%80%83" title="#%E6%8A%80%E6%9C%AF%E5%90%AF%E5%8F%91%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E7%9A%84%E9%80%9A%E7%94%A8%E6%80%A7%E6%80%9D%E8%80%83">技术启发：架构设计的通用性思考</a></li>
<li><a href="#%E6%80%BB%E7%BB%93%E4%BB%8Eopenclaw%E5%AD%A6%E5%88%B0%E7%9A%845%E4%B8%AA%E6%9E%B6%E6%9E%84%E5%8E%9F%E5%88%99" title="#%E6%80%BB%E7%BB%93%E4%BB%8Eopenclaw%E5%AD%A6%E5%88%B0%E7%9A%845%E4%B8%AA%E6%9E%B6%E6%9E%84%E5%8E%9F%E5%88%99">总结：从OpenClaw学到的5个架构原则</a></li>
</ul>
<hr/>
<h2 data-id="heading-1">背景：为什么需要个人AI助手？</h2>
<p>你是否也遇到过这样的场景？</p>
<ul>
<li>同事在 WhatsApp 上问你问题，客户在 Slack 上催进度，老板在 Telegram 上布置任务，而你还在 Discord 上跟社区成员讨论技术问题...</li>
<li>你想让 AI 帮你处理这些消息，但每个平台都有不同的 API、不同的接入方式、不同的消息格式...</li>
<li>你试过 ChatGPT，但它只能在网页里聊天；你试过各种 AI 助手，但它们要么收费昂贵，要么不能接入你日常使用的通讯工具...</li>
</ul>
<p><strong>直到我发现了 OpenClaw。</strong></p>
<p>这个项目用一套优雅的架构解决了所有这些痛点：一个 Gateway 控制平面，统一管理 12+ 通讯频道，让你在任何平台上都能与同一个 AI 助手对话。更重要的是，它是<strong>完全开源</strong>的，你可以部署在自己的设备上，数据完全由你掌控。</p>
<hr/>
<h2 data-id="heading-2">项目概览：178k stars的OpenClaw</h2>
<p>OpenClaw 是一个<strong>个人 AI 助手</strong>，你可以在自己的设备上运行它，通过 WhatsApp、Telegram、Slack、Discord 等常用通讯工具与它交互。它的核心理念是：Gateway 只是控制平面，真正的产品是 AI 助手本身。</p>
<h3 data-id="heading-3">核心数据</h3>



































<table><thead><tr><th>指标</th><th>数据</th><th>说明</th></tr></thead><tbody><tr><td><strong>GitHub Stars</strong></td><td>178k ⭐</td><td>验证日期: 2026-02-09</td></tr><tr><td><strong>Forks</strong></td><td>29.4k</td><td>活跃的开发者社区</td></tr><tr><td><strong>Commits</strong></td><td>9,167+</td><td>持续迭代更新</td></tr><tr><td><strong>License</strong></td><td>MIT</td><td>开源可商用</td></tr><tr><td><strong>Issues</strong></td><td>2.6k</td><td>活跃的 issue 讨论</td></tr></tbody></table>
<h3 data-id="heading-4">支持的通讯频道（12+）</h3>

































































<table><thead><tr><th>频道</th><th>技术实现</th><th>状态</th></tr></thead><tbody><tr><td><strong>WhatsApp</strong></td><td>Baileys 库</td><td>✅ 稳定</td></tr><tr><td><strong>Telegram</strong></td><td>grammY 框架</td><td>✅ 稳定</td></tr><tr><td><strong>Slack</strong></td><td>Bolt SDK</td><td>✅ 稳定</td></tr><tr><td><strong>Discord</strong></td><td>discord.js</td><td>✅ 稳定</td></tr><tr><td><strong>Google Chat</strong></td><td>Chat API</td><td>✅ 稳定</td></tr><tr><td><strong>Signal</strong></td><td>signal-cli</td><td>✅ 稳定</td></tr><tr><td><strong>iMessage</strong></td><td>BlueBubbles (推荐) / 传统 imsg</td><td>✅ 稳定</td></tr><tr><td><strong>Microsoft Teams</strong></td><td>扩展实现</td><td>✅ 稳定</td></tr><tr><td><strong>Matrix</strong></td><td>扩展实现</td><td>✅ 稳定</td></tr><tr><td><strong>Zalo</strong></td><td>扩展实现</td><td>✅ 稳定</td></tr><tr><td><strong>WebChat</strong></td><td>内置 Web 界面</td><td>✅ 稳定</td></tr></tbody></table>
<h3 data-id="heading-5">支持的平台</h3>
<ul>
<li><strong>macOS</strong>：完整的菜单栏应用，支持 Voice Wake、Talk Mode、Canvas</li>
<li><strong>iOS</strong>：Node 模式，支持 Canvas、语音、相机、录屏</li>
<li><strong>Android</strong>：Node 模式，支持 Canvas、语音、相机、录屏、短信</li>
</ul>
<hr/>
<h2 data-id="heading-6">核心架构：Gateway WebSocket控制平面</h2>
<p>OpenClaw 的架构可以用一句话概括：<strong>一个 Gateway，多个客户端，统一控制</strong>。</p>
<h3 data-id="heading-7">架构图</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[WhatsApp] --&gt; G[Gateway WebSocket Control Plane]
    B[Telegram] --&gt; G
    C[Slack] --&gt; G
    D[Discord] --&gt; G
    E[Google Chat] --&gt; G
    F[Signal/iMessage/Teams/Matrix/Zalo/WebChat] --&gt; G
    
    G --&gt;|WebSocket ws://127.0.0.1:18789| P[Pi Agent Runtime]
    G --&gt;|CLI| CLI[openclaw CLI]
    G --&gt;|Web UI| WC[WebChat]
    G --&gt;|Native App| MA[macOS App]
    G --&gt;|Node Protocol| N1[iOS Node]
    G --&gt;|Node Protocol| N2[Android Node]
    
    P --&gt;|Canvas| CV[Canvas A2UI]
    P --&gt;|Browser| BR[Browser Control]
    P --&gt;|Skills| SK[Skills Platform]
    P --&gt;|Voice| VW[Voice Wake]
    P --&gt;|Talk| TM[Talk Mode]
</code></pre>
<h3 data-id="heading-8">为什么用 WebSocket 做控制平面？</h3>
<p>你可能会问：为什么要用 WebSocket 而不是 HTTP REST API？</p>
<p><strong>答案很简单：实时性 + 双向通信</strong>。</p>
<p>传统的 HTTP 请求是"一问一答"模式：客户端问，服务器答。但在 AI 助手的场景里，我们需要：</p>
<ol>
<li><strong>服务器主动推</strong>：AI 生成内容时，需要流式输出（stream）到客户端</li>
<li><strong>双向通信</strong>：Gateway 既要接收用户消息，也要发送 AI 回复，还要处理各种事件（typing indicators、presence、媒体文件等）</li>
<li><strong>长连接管理</strong>：一个用户可能同时在 WhatsApp、Telegram、Slack 上聊天，Gateway 需要同时维护多个连接</li>
</ol>
<p><strong>WebSocket 就像是给 AI 助手装了一个"神经系统"</strong>：所有感官（频道）都连接到大脑（Pi Agent），大脑的处理结果又能实时反馈到任何一个感官。</p>
<h3 data-id="heading-9">Gateway 的核心职责</h3>

































<table><thead><tr><th>职责</th><th>说明</th></tr></thead><tbody><tr><td><strong>Session Management</strong></td><td>管理用户会话，区分 main（私聊）和 group（群聊）模式</td></tr><tr><td><strong>Channel Routing</strong></td><td>根据配置将消息路由到不同的 Agent 或处理逻辑</td></tr><tr><td><strong>Multi-agent Routing</strong></td><td>支持多个隔离的 Agent，不同频道/账号可以路由到不同的 AI 助手</td></tr><tr><td><strong>Event Streaming</strong></td><td>流式传输 AI 生成内容、打字状态、在线状态等</td></tr><tr><td><strong>Tool Invocation</strong></td><td>调用浏览器、Canvas、Node 等工具</td></tr><tr><td><strong>Media Pipeline</strong></td><td>处理图片、音频、视频，支持转录、大小限制、临时文件生命周期管理</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-10">多频道接入：12+通讯频道的秘密</h2>
<p>OpenClaw 最让人惊叹的是它同时支持 12+ 个通讯频道。这是怎么做到的？</p>
<h3 data-id="heading-11">统一抽象层</h3>
<p>OpenClaw 没有为每个频道写一堆重复代码，而是设计了<strong>统一的 Channel Abstraction Layer</strong>（频道抽象层）。</p>
<p><strong>代码示例</strong>（概念性）：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 统一的频道接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Channel</span> {
  <span class="hljs-comment">// 发送消息</span>
  <span class="hljs-title function_">send</span>(<span class="hljs-attr">to</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;;
  
  <span class="hljs-comment">// 接收消息（回调）</span>
  <span class="hljs-title function_">onMessage</span>(<span class="hljs-attr">handler</span>: <span class="hljs-function">(<span class="hljs-params">msg: Message</span>) =&gt;</span> <span class="hljs-built_in">void</span>): <span class="hljs-built_in">void</span>;
  
  <span class="hljs-comment">// 发送打字状态</span>
  <span class="hljs-title function_">sendTyping</span>(<span class="hljs-attr">to</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;;
  
  <span class="hljs-comment">// 获取频道信息</span>
  <span class="hljs-title function_">getInfo</span>(): <span class="hljs-title class_">ChannelInfo</span>;
}

<span class="hljs-comment">// WhatsApp 实现</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">WhatsAppChannel</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Channel</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">baileys</span>: <span class="hljs-built_in">any</span>;
  
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">send</span>(<span class="hljs-params">to: <span class="hljs-built_in">string</span>, message: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-comment">// 使用 Baileys 库发送</span>
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">baileys</span>.<span class="hljs-title function_">sendMessage</span>(to, { <span class="hljs-attr">text</span>: message });
  }
  
  <span class="hljs-title function_">onMessage</span>(<span class="hljs-params">handler</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">baileys</span>.<span class="hljs-property">ev</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'messages.upsert'</span>, handler);
  }
  
  <span class="hljs-comment">// ... 其他实现</span>
}

<span class="hljs-comment">// Telegram 实现  </span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TelegramChannel</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Channel</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">bot</span>: <span class="hljs-title class_">Bot</span>;
  
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">send</span>(<span class="hljs-params">to: <span class="hljs-built_in">string</span>, message: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-comment">// 使用 grammY 发送</span>
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">bot</span>.<span class="hljs-property">api</span>.<span class="hljs-title function_">sendMessage</span>(to, message);
  }
  
  <span class="hljs-title function_">onMessage</span>(<span class="hljs-params">handler</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">bot</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'message'</span>, handler);
  }
  
  <span class="hljs-comment">// ... 其他实现</span>
}
</code></pre>
<p><strong>关键洞察</strong>：虽然 WhatsApp、Telegram、Slack 的底层协议完全不同（WhatsApp 用 Baileys 的 WhatsApp Web 协议，Telegram 用 Bot API，Slack 用 Bolt SDK），但在 Gateway 看来，它们都是实现了统一接口的 Channel。</p>
<h3 data-id="heading-12">群聊 vs 私聊的路由策略</h3>
<p>OpenClaw 的消息路由设计非常精细：</p>






























<table><thead><tr><th>场景</th><th>路由规则</th><th>说明</th></tr></thead><tbody><tr><td><strong>私聊 (DM)</strong></td><td>直接路由到 main session</td><td>一对一对话</td></tr><tr><td><strong>群聊 @提及</strong></td><td>当消息中提到 AI 助手时响应</td><td>mention gating</td></tr><tr><td><strong>群聊回复</strong></td><td>当有人回复 AI 助手的消息时响应</td><td>reply tags</td></tr><tr><td><strong>频道隔离</strong></td><td>不同频道可以配置不同的 Agent</td><td>工作/生活分离</td></tr></tbody></table>
<h3 data-id="heading-13">DM 安全策略</h3>
<p>OpenClaw 连接到真实的通讯表面，必须处理<strong>不受信任的输入</strong>。默认安全策略：</p>
<ul>
<li><strong>Pairing Mode</strong>（配对模式）：未知发送者会收到一个配对码，必须先通过 CLI 批准才能与 AI 助手对话</li>
<li><strong>Allowlist</strong>（白名单）：只有通过 <code>openclaw pairing approve</code> 批准的用户才能发送消息</li>
<li><strong>Open Mode</strong>（开放模式）：显式配置后允许所有人发送消息（不推荐）</li>
</ul>
<p>这就像是在你家门口装了一个<strong>智能门禁</strong>：陌生人需要按门铃（配对码），你确认后才开门（批准）。</p>
<hr/>
<h2 data-id="heading-14">Pi Agent：AI大脑的RPC实现</h2>
<p>如果说 Gateway 是神经系统，那么 <strong>Pi Agent</strong> 就是大脑。</p>
<h3 data-id="heading-15">RPC 模式 vs 直接调用</h3>
<p>OpenClaw 的 Pi Agent 运行在 <strong>RPC（Remote Procedure Call）模式</strong>，这意味着：</p>
<ul>
<li><strong>分离架构</strong>：Gateway 和 Agent 可以运行在不同的进程甚至不同的机器上</li>
<li><strong>语言无关</strong>：Agent 可以用任何语言实现（OpenClaw 用 Node.js/TypeScript）</li>
<li><strong>可替换性</strong>：你可以接入自己的 Agent 实现，只要遵循相同的 RPC 协议</li>
</ul>
<p><strong>对比传统的直接调用</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 传统方式：Gateway 直接调用 Agent</span>
<span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> agent.<span class="hljs-title function_">processMessage</span>(message);

<span class="hljs-comment">// OpenClaw 方式：RPC 调用</span>
<span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> rpc.<span class="hljs-title function_">call</span>(<span class="hljs-string">'pi.agent.processMessage'</span>, {
  <span class="hljs-attr">sessionId</span>: <span class="hljs-string">'main'</span>,
  <span class="hljs-attr">message</span>: message,
  <span class="hljs-attr">tools</span>: [<span class="hljs-string">'browser'</span>, <span class="hljs-string">'canvas'</span>, <span class="hljs-string">'node'</span>]
});
</code></pre>
<p>RPC 就像是给大脑和神经系统之间加了一个<strong>标准接口</strong>：只要接口不变，你可以换任何品牌的大脑。</p>
<h3 data-id="heading-16">Tool Streaming &amp; Block Streaming</h3>
<p>Pi Agent 支持两种流式输出：</p>
<ol>
<li><strong>Tool Streaming</strong>：AI 决定使用工具时，实时流式传输工具调用信息</li>
<li><strong>Block Streaming</strong>：AI 生成内容时，分块流式传输（类似 ChatGPT 的打字效果）</li>
</ol>
<p>这让用户体验更加<strong>实时、流畅</strong>，不用等待 AI 完全生成完才看到回复。</p>
<hr/>
<h2 data-id="heading-17">Canvas+A2UI：可视化工作空间</h2>
<p>如果说文字聊天是 1D 交互，那么 <strong>Canvas 就是 2D/3D 交互</strong>。</p>
<h3 data-id="heading-18">什么是 A2UI？</h3>
<p><strong>A2UI（Agent-to-User Interface）</strong> 是 OpenClaw 提出的概念：Agent 主动构建用户界面，而不是被动响应。</p>
<p><strong>传统 AI 助手</strong>：</p>
<ul>
<li>用户问："帮我画个架构图"</li>
<li>AI 回答："这是一个 Mermaid 代码：<code>mermaid...</code>"</li>
<li>用户：?? 还要自己复制到 Mermaid 编辑器里才能看到图</li>
</ul>
<p><strong>OpenClaw 的 Canvas</strong>：</p>
<ul>
<li>用户问："帮我画个架构图"</li>
<li>AI 直接在 Canvas 上渲染出架构图</li>
<li>用户可以看到、交互、甚至修改</li>
</ul>
<h3 data-id="heading-19">Canvas 的技术实现</h3>
<p>Canvas 是一个<strong>本地运行的 Web 视图</strong>，Agent 可以通过 RPC 调用控制它的内容：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// Agent 推送内容到 Canvas</span>
<span class="hljs-keyword">await</span> canvas.<span class="hljs-title function_">push</span>({
  <span class="hljs-attr">type</span>: <span class="hljs-string">'mermaid'</span>,
  <span class="hljs-attr">content</span>: <span class="hljs-string">`
    graph TD
      A[用户] --&gt; B[Gateway]
      B --&gt; C[Pi Agent]
  `</span>
});

<span class="hljs-comment">// Agent 重置 Canvas</span>
<span class="hljs-keyword">await</span> canvas.<span class="hljs-title function_">reset</span>();

<span class="hljs-comment">// Agent 执行 JavaScript（在 Canvas 内）</span>
<span class="hljs-keyword">await</span> canvas.<span class="hljs-built_in">eval</span>(<span class="hljs-string">`
  document.querySelector('.chart').style.background = '#f0f0f0';
`</span>);
</code></pre>
<p><strong>关键洞察</strong>：Canvas 就像是给 AI 助手提供了一个<strong>无限扩展的画布</strong>，它可以画图、展示表格、渲染图表、甚至构建简单的交互应用。</p>
<hr/>
<h2 data-id="heading-20">Voice Wake+Talk Mode：全时语音交互</h2>
<p>文字聊天很方便，但有时候你只想<strong>说</strong>而不想<strong>打字</strong>。</p>
<h3 data-id="heading-21">Voice Wake（语音唤醒）</h3>
<p>就像 Siri 或 Alexa 的 "Hey Siri"，OpenClaw 支持自定义唤醒词：</p>
<ul>
<li>你在电脑上工作，突然想查个资料</li>
<li>说出唤醒词（比如 "Hey Claw"）</li>
<li>OpenClaw 立即进入监听状态</li>
<li>你说出问题，它语音回复</li>
</ul>
<p><strong>技术实现</strong>：</p>
<ul>
<li><strong>macOS/iOS</strong>：使用系统 Speech Recognition API + ElevenLabs TTS</li>
<li><strong>Android</strong>：使用 Android Speech API</li>
<li><strong>持续监听</strong>：本地处理唤醒词检测，保护隐私</li>
</ul>
<h3 data-id="heading-22">Talk Mode（对话模式）</h3>
<p>Voice Wake 是"一问一答"，Talk Mode 则是<strong>持续对话</strong>：</p>
<ul>
<li>进入 Talk Mode 后，AI 助手保持监听状态</li>
<li>你可以像跟朋友聊天一样连续对话</li>
<li>支持打断（interrupt）：AI 说话时你也可以插话</li>
<li>支持 context 保持：对话历史不丢失</li>
</ul>
<p><strong>使用场景</strong>：</p>
<ul>
<li>头脑风暴时，边说边让 AI 记录和整理</li>
<li>编程时，语音描述需求让 AI 生成代码</li>
<li>不方便打字的场景（做饭、开车、运动）</li>
</ul>
<hr/>
<h2 data-id="heading-23">Skills Platform：三级插件系统</h2>
<p>OpenClaw 的插件系统叫 <strong>Skills</strong>，分三个层级：</p>
<h3 data-id="heading-24">1. Bundled Skills（内置技能）</h3>
<ul>
<li>随 OpenClaw 一起发布的官方技能</li>
<li>示例：browser（浏览器控制）、canvas（画布）、cron（定时任务）</li>
<li><strong>特点</strong>：开箱即用，质量有保障</li>
</ul>
<h3 data-id="heading-25">2. Managed Skills（托管技能）</h3>
<ul>
<li>社区开发，通过 OpenClaw 官方仓库分发</li>
<li>用户通过 CLI 安装：<code>openclaw skills install &lt;skill-name&gt;</code></li>
<li><strong>特点</strong>：审核过的第三方技能，安全可控</li>
</ul>
<h3 data-id="heading-26">3. Workspace Skills（工作区技能）</h3>
<ul>
<li>用户自己开发的本地技能</li>
<li>放在工作区目录下，OpenClaw 自动加载</li>
<li><strong>特点</strong>：完全自定义，适合特定业务需求</li>
</ul>
<h3 data-id="heading-27">技能开发示例</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 一个简单的 Skill</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'weather'</span>,
  <span class="hljs-attr">description</span>: <span class="hljs-string">'Get weather information'</span>,
  
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params">{ city }</span>) {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`https://api.weather.com/v1/current?city=<span class="hljs-subst">${city}</span>`</span>);
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
    
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">text</span>: <span class="hljs-string">`Current weather in <span class="hljs-subst">${city}</span>: <span class="hljs-subst">${data.temperature}</span>°C, <span class="hljs-subst">${data.condition}</span>`</span>,
      <span class="hljs-attr">temperature</span>: data.<span class="hljs-property">temperature</span>,
      <span class="hljs-attr">condition</span>: data.<span class="hljs-property">condition</span>
    };
  }
};
</code></pre>
<p><strong>关键洞察</strong>：三级技能系统就像是 <strong>App Store + 企业应用 + 个人脚本</strong> 的结合，既保证了生态丰富性，又保留了灵活度。</p>
<hr/>
<h2 data-id="heading-28">技术启发：架构设计的通用性思考</h2>
<p>OpenClaw 的架构设计给了我们很多启发，不仅适用于 AI 助手，也适用于其他类型的应用。</p>
<h3 data-id="heading-29">启发 1：控制平面与数据平面分离</h3>
<p>OpenClaw 的 Gateway 是控制平面，负责连接管理、路由、安全策略；Pi Agent 是数据平面，负责 AI 逻辑。</p>
<p><strong>通用化</strong>：</p>
<ul>
<li><strong>聊天应用</strong>：Gateway 管理连接，Chat Service 处理消息逻辑</li>
<li><strong>IoT 平台</strong>：Gateway 管理设备连接，Rule Engine 处理业务逻辑</li>
<li><strong>实时协作</strong>：Gateway 管理用户会话，Collaboration Service 处理文档协作</li>
</ul>
<p><strong>好处</strong>：</p>
<ul>
<li>控制平面可以独立扩展（加更多 Gateway 实例）</li>
<li>数据平面可以独立升级（更新 AI 模型不影响连接）</li>
<li>支持多种数据平面（可以用同样的 Gateway 接入不同的 AI 模型）</li>
</ul>
<h3 data-id="heading-30">启发 2：统一抽象层应对多样性</h3>
<p>OpenClaw 用统一的 Channel 接口接入 12+ 个不同的通讯频道。</p>
<p><strong>通用化</strong>：</p>
<ul>
<li><strong>支付系统</strong>：统一的 Payment Gateway 接口，接入支付宝、微信、Stripe、PayPal</li>
<li><strong>存储系统</strong>：统一的 Storage 接口，接入 S3、Azure Blob、本地文件</li>
<li><strong>消息队列</strong>：统一的 MQ 接口，接入 Kafka、RabbitMQ、RocketMQ</li>
</ul>
<p><strong>好处</strong>：</p>
<ul>
<li>新增渠道只需实现接口，无需改动核心逻辑</li>
<li>可以轻松切换底层实现（比如从 WhatsApp 切换到 Telegram）</li>
<li>便于测试（可以 mock Channel 接口）</li>
</ul>
<h3 data-id="heading-31">启发 3：WebSocket 作为实时系统的标配</h3>
<p>OpenClaw 用 WebSocket 实现双向实时通信。</p>
<p><strong>适用场景</strong>：</p>
<ul>
<li>实时协作（Google Docs、Figma）</li>
<li>实时游戏（多人在线游戏）</li>
<li>实时金融（股票行情、交易系统）</li>
<li>IoT 实时监控</li>
</ul>
<p><strong>注意事项</strong>：</p>
<ul>
<li>WebSocket 连接需要心跳保活</li>
<li>需要考虑断线重连机制</li>
<li>大规模部署需要负载均衡（Sticky Session）</li>
</ul>
<h3 data-id="heading-32">启发 4：渐进式权限控制</h3>
<p>OpenClaw 的 DM 安全策略从 "完全开放" 到 "完全封闭" 之间有多个层级（pairing → allowlist → open）。</p>
<p><strong>通用化</strong>：</p>
<ul>
<li><strong>API 权限</strong>：公开 API → 需要 API Key → 需要 OAuth → 需要特定 Scope</li>
<li><strong>文件访问</strong>：公开下载 → 需要登录 → 需要特定权限 → 完全私有</li>
<li><strong>功能开放</strong>：Beta 功能 → 灰度发布 → 全量发布</li>
</ul>
<p><strong>好处</strong>：</p>
<ul>
<li>可以根据安全需求灵活调整</li>
<li>便于逐步开放功能，降低风险</li>
<li>用户可以选择自己舒适的隐私级别</li>
</ul>
<h3 data-id="heading-33">启发 5：本地优先 + 云端可选</h3>
<p>OpenClaw 的设计是"本地优先"：</p>
<ul>
<li>默认 Gateway 运行在本地（ws://127.0.0.1:18789）</li>
<li>数据存储在本地</li>
<li>也可以部署到远程服务器（通过 Tailscale、SSH 隧道）</li>
</ul>
<p><strong>这种模式的优点</strong>：</p>
<ul>
<li><strong>隐私可控</strong>：敏感数据不出本机</li>
<li><strong>离线可用</strong>：即使没有网络也能用（只要 AI 模型本地运行）</li>
<li><strong>云端可选</strong>：需要远程访问时，可以通过安全隧道连接</li>
</ul>
<p><strong>适用场景</strong>：</p>
<ul>
<li>个人知识管理工具</li>
<li>隐私敏感的 AI 应用</li>
<li>边缘计算场景</li>
</ul>
<hr/>
<h2 data-id="heading-34">总结：从OpenClaw学到的5个架构原则</h2>
<ol>
<li>
<p><strong>控制平面与数据平面分离</strong>：Gateway 负责连接，Agent 负责逻辑，两者可以独立演进</p>
</li>
<li>
<p><strong>统一抽象层应对多样性</strong>：用统一接口封装底层差异，12+ 频道也能管理得井井有条</p>
</li>
<li>
<p><strong>WebSocket 实现实时双向通信</strong>：流式输出、打字状态、在线状态，都用 WebSocket 搞定</p>
</li>
<li>
<p><strong>渐进式权限控制</strong>：从 pairing 到 allowlist 到 open，给用户选择权，给开发者灵活度</p>
</li>
<li>
<p><strong>本地优先 + 云端可选</strong>：数据默认留在本地，需要时可以通过安全隧道远程访问</p>
</li>
</ol>
<hr/>
<h2 data-id="heading-35">参考链接</h2>






























<table><thead><tr><th>链接</th><th>描述</th><th>验证状态</th></tr></thead><tbody><tr><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenclaw%2Fopenclaw" target="_blank" title="https://github.com/openclaw/openclaw" ref="nofollow noopener noreferrer">openclaw/openclaw</a></td><td>GitHub 官方仓库</td><td>✅ 已验证</td></tr><tr><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fopenclaw.ai" target="_blank" title="https://openclaw.ai" ref="nofollow noopener noreferrer">openclaw.ai</a></td><td>官方网站</td><td>✅ 已验证</td></tr><tr><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.openclaw.ai" target="_blank" title="https://docs.openclaw.ai" ref="nofollow noopener noreferrer">docs.openclaw.ai</a></td><td>官方文档</td><td>✅ 已验证</td></tr><tr><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeepwiki.com%2Fopenclaw%2Fopenclaw" target="_blank" title="https://deepwiki.com/openclaw/openclaw" ref="nofollow noopener noreferrer">DeepWiki</a></td><td>深度 Wiki</td><td>✅ 已验证</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 视觉连载2：灰度图]]></title>    <link>https://juejin.cn/post/7604671453452779535</link>    <guid>https://juejin.cn/post/7604671453452779535</guid>    <pubDate>2026-02-09T13:17:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604671453452779535" data-draft-id="7604395865335889972" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 视觉连载2：灰度图"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-02-09T13:17:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="董章鱼是个攻城狮"/> <meta itemprop="url" content="https://juejin.cn/user/3644206058054766"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 视觉连载2：灰度图
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3644206058054766/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    董章鱼是个攻城狮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T13:17:14.000Z" title="Mon Feb 09 2026 13:17:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好啊，我是董章鱼。</p>
<p>上一篇文章<a href="https://link.juejin.cn?target=https%3A%2F%2Fn1y353ixh7c.feishu.cn%2Fwiki%2FJFIKwHJLbi4gXIkm20zc0e9anRO" target="_blank" title="https://n1y353ixh7c.feishu.cn/wiki/JFIKwHJLbi4gXIkm20zc0e9anRO" ref="nofollow noopener noreferrer">1、图像和像素</a>中说到：像素是计算机视觉任务中的原材料。</p>
<p>很多图像处理任务以像素的局部性为基础，在不同尺度下完成图像特征的提取。你可以这么理解这些图像的特征，小的特征可能为图像的细节，大的则为图像轮廓。</p>
<p>现在我们来了解一种十分简洁但非常高效的图像表示方法——灰度图。了解灰度图，有助于我们更好的了解图像的特征。
灰度图是一种只包含亮度信息而不包含颜色信息的图像。</p>
<p>在灰度图中，每个像素的亮度通过一个灰度级别来表示，通常用整数值表示，范围从0（黑色）到 255（白色）。
解释一下为什么是 0 - 255。</p>
<p>因为任何数据在计算机中都是以数值的形式存储的，不论是图像还是音频。</p>
<p>在计算机的基本数据类型中，一个基本的数据类型为 char 或 Byte，也就是占 1 个字节、8 个 bits 的数据类型。而无符号 char 类型可以表示的数据范围刚好就在 0 - 255 之间，因此像素的灰度级别也就采用了 0 - 255 这个范围。
这些等级的灰度基本可以很好的表示丰富的图像细节。</p>
<h2 data-id="heading-0">为什么要使用灰度图</h2>
<p>使用灰度图会有很多好处，比如：</p>
<ul>
<li>简化图像处理</li>
</ul>
<p>灰度图只包含亮度信息，相比彩色图像更加简单，因此在图像处理任务中更容易处理。</p>
<p>这对于一些基础任务，如图像的边缘检测和轮廓分析，非常有利；在后续的章节中，便会使用灰度图做图像的分割，主要看中的就是灰度图对于轮廓的表现更加友好。</p>
<ul>
<li>减小存储和传输成本</li>
</ul>
<p>灰度图像的存储空间（占用内存大小）远远小于彩色图像，因为每个像素只需要一个灰度级别的值，无论是图像传输还是存储，灰度图都具有明显的优势。</p>
<ul>
<li>强调结构和纹理</li>
</ul>
<p>灰度图突出了图像的结构和纹理，使得在一些特定的图像分析任务中更加有效。例如，在医学影像中比如拍胸片CT等，灰度图会用于强调组织的密度和结构。</p>
<p>下面来了解一下如何生成一张灰度图。</p>
<h2 data-id="heading-1">灰度图如何生成</h2>
<p>我用 AI 软件画了一张猫咪坐在公园长椅上的照片，下面是 AI 生成的彩色图片。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/158ddbd5a66d4c159874fdd19cbb9369~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JGj56ug6bG85piv5Liq5pS75Z-O54uu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771247835&amp;x-signature=WtU0aDK%2FA15860mRapZ9SuGAnAk%3D" alt="image.png" loading="lazy"/></p>
<p>你可以用以下的 python 代码完成彩色图片到灰度图片的转换：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image

<span class="hljs-comment"># 打开彩色图像</span>
color_image = Image.<span class="hljs-built_in">open</span>(<span class="hljs-string">'./cat.png'</span>)
<span class="hljs-comment"># 转换为灰度图</span>
gray_image = color_image.convert(<span class="hljs-string">'L'</span>)
<span class="hljs-comment"># 保存灰度图</span>
gray_image.save(<span class="hljs-string">'./gray_cat.jpg'</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"彩色图片格式: "</span> + color_image.mode)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"灰度图片格式: "</span> + gray_image.mode)
</code></pre>
<p>通过以上代码，便可以把上述彩色图片转换为灰度图。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/899addaa6e72420fab4a11e01b55375f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JGj56ug6bG85piv5Liq5pS75Z-O54uu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771247835&amp;x-signature=Xt5rvPAsPztb7E5czVVAWj%2FJryM%3D" alt="image.png" loading="lazy"/></p>
<p>在 Python 代码中，使用 <code>color_image.mode</code> 可以查看图像的 mode 属性，从而获得图像的格式。</p>
<p>比如那张彩色图片，获取的格式是：RGBA 格式。RGBA 代表红（Red）、绿（Green）、蓝（Blue）和透明度（Alpha）四个通道。</p>
<p>在 RGBA 格式的图像中，每个像素包含四个值，分别表示其在红、绿、蓝三个颜色通道上的强度，以及透明度通道上的值（0 表示完全透明，255 表示完全不透明）。</p>
<p>转换为灰度图之后，获取的格式是：L 格式，L 代表灰度（Luminance）模式。在 L 格式的图像中，每个像素只包含一个灰度值，表示图像中该点的亮度。例如，一个 L 像素可以表示为 150，表示该像素的亮度为中等灰度。</p>
<p>总的来说：灰度图和彩色图相比，更加简洁和高效。在很多领域比如医学影像成像，或者印刷出版，灰度图都有着它独一无二的用途。</p>
<p>后面的文章也会使用灰度图做一次图像分割的实战练习。</p>
<p>上述彩色图片转灰度图的 python 代码可以在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fiwaihou%2Fcv_learning_from_scratch%2Ftree%2Fmaster%2F0_gray%25E4%25B8%25AD%25E8%258E%25B7%25E5%258F%2596%25E3%2580%2582" target="_blank" title="https://gitee.com/iwaihou/cv_learning_from_scratch/tree/master/0_gray%E4%B8%AD%E8%8E%B7%E5%8F%96%E3%80%82" ref="nofollow noopener noreferrer">gitee.com/iwaihou/cv_…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Producer Audios Generation API 对接说明]]></title>    <link>https://juejin.cn/post/7604522883486662690</link>    <guid>https://juejin.cn/post/7604522883486662690</guid>    <pubDate>2026-02-09T13:35:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604522883486662690" data-draft-id="7604493165328449570" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Producer Audios Generation API 对接说明"/> <meta itemprop="keywords" content="人工智能,API,AIGC"/> <meta itemprop="datePublished" content="2026-02-09T13:35:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="崔庆才丨静觅"/> <meta itemprop="url" content="https://juejin.cn/user/1521379821230269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Producer Audios Generation API 对接说明
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379821230269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    崔庆才丨静觅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T13:35:31.000Z" title="Mon Feb 09 2026 13:35:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读24分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文将介绍一种 Producer Audios Generation API 对接说明，它是可以通过输入自定义参数来生成 Producer 官方的音乐。</p>
<h2 data-id="heading-0">申请流程</h2>
<p>要使用 API，需要先到 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2Fproducer-audios" target="_blank" title="https://platform.acedata.cloud/documents/producer-audios" ref="nofollow noopener noreferrer">Producer Audios Generation API</a> 对应页面申请对应的服务，进入页面之后，点击「Acquire」按钮，如图所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a87ead96515a49b494cad33122d45e9c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771248931&amp;x-signature=4ZO6gsWa88PqFK6wrCY%2BzayFPeY%3D" alt="" loading="lazy"/></p>
<p>如果你尚未登录或注册，会自动跳转到登录页面邀请您来注册和登录，登录注册之后会自动返回当前页面。</p>
<p>在首次申请时会有免费额度赠送，可以免费使用该 API。</p>
<h2 data-id="heading-1">基本使用</h2>
<p>想些什么歌曲，可以任意输入一段文字，比如我想生成一个关于圣诞的歌曲，就可以输入 <code>a song for Christmas</code>，如图所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dad7cf71fd954be39baec952a4977604~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771248931&amp;x-signature=d3ghtaKZPHMU7rYLSax0jFSUGMU%3D" width="600" class="m-auto" loading="lazy"/></p>
<p>可以看到这里我们设置了 Request Headers，包括：</p>
<ul>
<li><code>accept</code>：想要接收怎样格式的响应结果，这里填写为 <code>application/json</code>，即 JSON 格式。</li>
<li><code>authorization</code>：调用 API 的密钥，申请之后可以直接下拉选择。</li>
</ul>
<p>另外 Request Body 的参数包括：</p>
<ul>
<li><code>action</code>：此次音乐生成任务的行为，生成歌曲是 <code>generate</code>。</li>
<li><code>model</code>：创建歌曲采用的模型，目前主要有： <strong>FUZZ-2.0 Pro</strong>、<strong>FUZZ-2.0</strong>、<strong>FUZZ-2.0 Raw</strong>,<strong>FUZZ-1.1 Pro</strong>、<strong>FUZZ-1.0 Pro</strong>、<strong>FUZZ-1.0</strong>、<strong>FUZZ-1.1</strong>、<strong>FUZZ-0.8</strong>。</li>
<li><code>lyric</code>：歌曲的歌词内容。</li>
<li><code>custom</code>：是否采用自定义方式生成歌曲。</li>
<li><code>prompt</code>：灵感模式下的提示词。</li>
<li><code>title</code>：歌曲标题信息。</li>
<li><code>audio_id</code>：参考歌曲 ID，用于续写/翻版等操作。</li>
<li><code>continue_at</code>：从指定秒数开始续写歌曲。</li>
<li><code>replace_section_start</code>/<code>replace_section_end</code>：替换片段的起止时间，单位秒。</li>
<li><code>lyrics_strength</code>：歌词强度，表示歌词在音频生成中的影响程度，可选0-1之间，默认0.7。</li>
<li><code>sound_strength</code>：音频提示词强度，可选0.2-1之间，默认0.7。</li>
<li><code>cover_strength</code>：翻唱强度 0.2-1之间，默认1。</li>
<li><code>weirdness</code>：风格奇特度，可选 0-1之间，默认0.5</li>
<li><code>callback_url</code>：需要回调结果的 URL。</li>
<li><code>instrumental</code>：是否为无歌词模式。</li>
</ul>
<p>选择之后，可以发现右侧也生成了对应代码，如图所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9462ab484f004b1398de53ac18fbadd0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771248931&amp;x-signature=lTcQKBD6QBq60Dh0TB32YZjBKaw%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>点击「Try」按钮即可进行测试，如上图所示，这里我们就得到了如下结果：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"82fd443a-903a-4f18-8028-12d2f8a0a4be"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"d85839fa-0bb1-42da-a9fc-cd582c29027d"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"6c947f13-a3c5-4b9c-8609-5639c37cdc2d"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Untitled"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/a853673e-615c-42ae-bdff-16b1add94861/image/6c947f13-a3c5-4b9c-8609-5639c37cdc2d.jpg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Instrumental]"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/a853673e-615c-42ae-bdff-16b1add94861/audio/6c947f13-a3c5-4b9c-8609-5639c37cdc2d.m4a"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"6c947f13-a3c5-4b9c-8609-5639c37cdc2d"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"topic"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"seed"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2450882164"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"sound"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-12-30T17:18:23.232911Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FUZZ-2.0 Pro"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"progress"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"100%"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"181.3014058956916"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>返回结果一共有多个字段，介绍如下：</p>
<ul>
<li><code>success</code>，此时音乐生成任务的状态情况。
<ul>
<li><code>data</code>，此次音乐任务的结果
<ul>
<li><code>id</code>，此时音乐生成任务的 ID。</li>
<li><code>sound</code>，此时音乐生成任务的提示词。</li>
<li><code>seed</code>，此时音乐生成任务的种子值。</li>
<li><code>audio_url</code>，此时音乐生成任务的音频链接。</li>
<li><code>image_url</code>，此时音乐生成任务的封面链接。</li>
<li><code>image_id</code>，此时音乐生成任务的封面ID。</li>
<li><code>state</code>，此时音乐生成任务的状态。</li>
<li><code>duration</code>，此时音乐的时长信息。</li>
<li><code>progress</code>，此时音乐任务的进度值。</li>
<li><code>model</code>，此时音乐生成任务采用的模型信息。</li>
<li><code>lyric</code>，此时音乐生成任务的歌词信息。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>可以看到我们得到了想生成的音乐信息，我们只需要根据结果中 <code>data</code> 的音乐链接地址获取生成的 Producer 音乐即可。</p>
<p>另外如果想生成对应的对接代码，可以直接复制生成，例如 CURL 的代码如下：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/producer/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "action": "generate",
  "model": "FUZZ-2.0 Pro",
  "prompt": "A song for Christmas"
}'
</code></pre>
<h2 data-id="heading-2">自定义生成</h2>
<p>如果想自定义生成歌词，可以输入歌词：</p>
<p>这时候 <code>lyric</code> 字段可以传入类似如下内容：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">[Verse]Woke up <span class="hljs-keyword">with</span> the sun <span class="hljs-keyword">in</span> my eyesNo clouds above just blue <span class="hljs-keyword">in</span> the skiesShoes <span class="hljs-keyword">on</span> my feet I’m ready <span class="hljs-keyword">to</span> runEvery <span class="hljs-keyword">step</span> feels <span class="hljs-built_in">like</span> a loaded gun[Chorus]Happy days are rolling inLet the joy beneath my skinNo more <span class="hljs-keyword">shadows</span> no more liesJust the truth that lifts <span class="hljs-keyword">me</span> high[Verse <span class="hljs-number">2</span>]Dancing through the city streetsA rhythm pounding <span class="hljs-keyword">in</span> my heartbeatStrangers smile it’s catching onThis world’s a stage we’re all a song[Chorus]Happy days are rolling inLet the joy beneath my skinNo more <span class="hljs-keyword">shadows</span> no more liesJust the truth that lifts <span class="hljs-keyword">me</span> high[Bridge]<span class="hljs-keyword">Throw</span> your worries out the doorLet them sink <span class="hljs-keyword">to</span> the ocean floorWe’re alive <span class="hljs-built_in">and</span> it’s enoughLife <span class="hljs-built_in">is</span> messy but it’s love[Chorus]Happy days are rolling inLet the joy beneath my skinNo more <span class="hljs-keyword">shadows</span> no more liesJust the truth that lifts <span class="hljs-keyword">me</span> high
</code></pre>
<p>接下来我们要根据歌词、标题、风格自定义生成歌曲，就可以指定如下内容：</p>
<ul>
<li>lyric：歌词文本</li>
<li>custom：填写为 <code>true</code>，代表自定义生成，该参数默认为 false，代表使用 <code>prompt</code> 生成。</li>
<li>title：歌曲的标题。</li>
</ul>
<p>填写样例如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73e02eb0382a408a9d91e7b5f283c287~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771248931&amp;x-signature=InAoHRQZKQ%2Bz5NN3odcov4UQhWs%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b20e7460a29b4c5487c96e1c34b0f22c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771248931&amp;x-signature=mp19dmMayrL5JVTML%2FXHVaQqU58%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/producer/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "action": "generate",
  "model": "FUZZ-2.0 Pro",
  "instrumental": false,
  "lyric": "[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high",
  "custom": true
}'
</code></pre>
<p>测试允许，生成的效果是类似的。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"9f58bbd4-855a-4233-ac45-b63bf9168e02"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"145ad117-6ce7-42dd-af12-70751c5284fc"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"38d3b9e2-0dfb-4338-b2a7-15e45656ed32"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Woke up with the sun in my eyes"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/7ce2b11a-179f-4b87-b5ff-397613c62c93/image/38d3b9e2-0dfb-4338-b2a7-15e45656ed32.jpg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/7ce2b11a-179f-4b87-b5ff-397613c62c93/audio/38d3b9e2-0dfb-4338-b2a7-15e45656ed32.m4a"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"38d3b9e2-0dfb-4338-b2a7-15e45656ed32"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"topic"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"seed"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"3789209121"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"sound"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-12-30T17:26:46.357055Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FUZZ-2.0 Pro"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"progress"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"100%"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"153.80897959183673"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-3">翻唱歌曲</h2>
<p>如果想对已经生成的歌曲进行翻唱操作的操作，可以输入上文生成的歌曲进行翻唱，接下来我们要根据歌词、标题自定义生成歌曲。</p>
<p>如果想对自己上传的歌曲进行继续翻唱的话，可以将参数 <code>action</code> 设置为 <code>upload_cover</code> ，并且输入需要继续翻唱自定义上传的歌曲 ID，歌曲 ID 的获取是使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F7fd2cb52-772e-4cc4-a018-e2626ff6f447" target="_blank" title="https://platform.acedata.cloud/documents/7fd2cb52-772e-4cc4-a018-e2626ff6f447" ref="nofollow noopener noreferrer">Producer Upload API</a>来获取，如下图所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6cfda26c50e4d978d846fa878e1ae2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771248931&amp;x-signature=9E49tPIj%2B6cOv5N6vQGGQ08nYjI%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>就可以指定如下内容：</p>
<ul>
<li>action：此次歌曲任务的行为，目前支持：generate、cover、extend、upload_cover、upload_extend、replace_section、swap_vocals、swap_instrumentals、variation，此次翻唱使用<code>cover</code>参数。</li>
<li>lyric：歌词文本</li>
<li>title：歌曲的标题。</li>
<li>custom：是否采用自定义模式生成，默认是false。</li>
<li>audio_id：需要翻唱歌曲的歌曲ID。</li>
</ul>
<p>填写样例如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/490142cbcbbd47c4acdb4c48cbdfb8fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771248931&amp;x-signature=zIvytkZboqs7LwiXwR075b2rL0I%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6657a45e05004894b9bb1a8531d08429~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771248931&amp;x-signature=iPI5ncT1oh0kVwKYf5xuDb8rhyQ%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/producer/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "action": "cover",
  "model": "FUZZ-2.0 Pro",
  "lyric": "[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high",
  "audio_id": "38d3b9e2-0dfb-4338-b2a7-15e45656ed32",
  "instrumental": false,
  "custom": true,
  "title": "Cover"
}'
</code></pre>
<p>测试允许，生成的效果是类似的。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dbca350e-6fb9-46ca-9c7e-4c1a9080806f"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"a39e0fff-ced8-4b31-ae23-aef3badd90fa"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"e52dd729-38b4-4c2f-9031-59eb7953c593"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Cover"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/7ce2b11a-179f-4b87-b5ff-397613c62c93/image/e52dd729-38b4-4c2f-9031-59eb7953c593.jpg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/7ce2b11a-179f-4b87-b5ff-397613c62c93/audio/e52dd729-38b4-4c2f-9031-59eb7953c593.m4a"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"e52dd729-38b4-4c2f-9031-59eb7953c593"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"topic"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"seed"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"358803418"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"sound"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-12-30T17:32:32.951948Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FUZZ-2.0 Pro"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"progress"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"100%"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"153.0659410430839"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-4">续写歌曲</h2>
<p>如果想续写歌曲的话，我们需要传入<code>action</code>参数值为：<code>extend</code>，接下来我们要根据歌词、标题、风格自定义生成歌曲。</p>
<p>如果想对自己上传的歌曲进行继续续写的话，可以将参数 <code>action</code> 设置为 <code>upload_extend</code> ，并且输入需要继续续写自定义上传的歌曲 ID，歌曲 ID 的获取是使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F7fd2cb52-772e-4cc4-a018-e2626ff6f447" target="_blank" title="https://platform.acedata.cloud/documents/7fd2cb52-772e-4cc4-a018-e2626ff6f447" ref="nofollow noopener noreferrer">Producer Upload API</a>来获取，如下图所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6cfda26c50e4d978d846fa878e1ae2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771248931&amp;x-signature=9E49tPIj%2B6cOv5N6vQGGQ08nYjI%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写样例如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9412b1fe41d48a9a48f96119e043414~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771248931&amp;x-signature=R%2FYQDPfOoJwh9RnoDbnhxgNBh3c%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce233d4b088b4b6b80e008767b13ca22~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771248931&amp;x-signature=1BrW1aiI67Y4dQJ8%2B5SuCsglXOs%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/producer/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "action": "extend",
  "model": "FUZZ-2.0 Pro",
  "instrumental": false,
  "lyric": "[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high",
  "continue_at": 3,
  "audio_id": "38d3b9e2-0dfb-4338-b2a7-15e45656ed32",
  "custom": true,
  "title": "Extend",
  "weirdness": 0.3,
  "sound_strength": 0.3,
  "lyrics_strength": 0.6
}'
</code></pre>
<p>测试允许，生成的效果是类似的。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"834983cb-d62d-4750-b1aa-461da137e51f"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"6923eee2-7403-432c-8bd1-e471086385b0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"d9ebc609-fb65-4a23-b914-c074747af6a4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Extend"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/7ce2b11a-179f-4b87-b5ff-397613c62c93/image/d9ebc609-fb65-4a23-b914-c074747af6a4.jpg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\n[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/7ce2b11a-179f-4b87-b5ff-397613c62c93/audio/d9ebc609-fb65-4a23-b914-c074747af6a4.m4a"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"d9ebc609-fb65-4a23-b914-c074747af6a4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"topic"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"seed"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4294469624"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"sound"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-12-30T17:36:14.520928Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FUZZ-2.0 Pro"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"progress"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"100%"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"173.87102040816328"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-5">音乐变换</h2>
<p>如果想根据上一首音乐的seed值生成一首类似效果的新音乐的话，我们需要传入<code>action</code>参数值为：<code>variation</code>，接下来就可以自定义生成一首类似效果的新音乐。</p>
<p>填写样例如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4ae904986a740eaa918bb1e15d346eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771248931&amp;x-signature=07xHIKZJKxKu3bgqpZyTE9JongA%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19750aebd92544988db7cefe1c1e7dca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771248931&amp;x-signature=hVie9yiUqfPFIsxtj%2FfVZOCChEE%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/producer/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "action": "variation",
  "audio_id": "d9ebc609-fb65-4a23-b914-c074747af6a4",
  "model": "FUZZ-2.0 Pro",
  "instrumental": false,
  "lyric": "[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high",
  "custom": true
}'
</code></pre>
<p>测试允许，生成的效果是类似的。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"3a74da6d-a37d-4b5d-b116-821f455bce39"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"8e28cce0-0400-4bfd-83db-6d27f97422c7"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"c14ca458-cd5a-4700-83d4-5249e15f2707"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Woke up with the sun in my eyes"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/7ce2b11a-179f-4b87-b5ff-397613c62c93/image/c14ca458-cd5a-4700-83d4-5249e15f2707.jpg"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/7ce2b11a-179f-4b87-b5ff-397613c62c93/audio/c14ca458-cd5a-4700-83d4-5249e15f2707.m4a"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"c14ca458-cd5a-4700-83d4-5249e15f2707"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"topic"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"seed"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2082104582"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"sound"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-12-30T17:48:40.135187Z"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FUZZ-2.0"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"progress"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"100%"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"173.12798185941043"</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-6">替换片段</h2>
<p>如果想对歌曲进行替换片段的话，我们需要传入<code>action</code>参数值为：<code>replace_section</code>，接下来我们要根据歌词、标题自定义生成歌曲。</p>
<p>如果想对自己上传的歌曲进行继续替换片段的话，可以将参数 <code>action</code> 设置为 <code>upload_replace_section</code> ，并且输入需要继续续写自定义上传的歌曲 ID，歌曲 ID 的获取是使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F7fd2cb52-772e-4cc4-a018-e2626ff6f447" target="_blank" title="https://platform.acedata.cloud/documents/7fd2cb52-772e-4cc4-a018-e2626ff6f447" ref="nofollow noopener noreferrer">Producer Upload API</a>来获取，如下图所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6cfda26c50e4d978d846fa878e1ae2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771248931&amp;x-signature=9E49tPIj%2B6cOv5N6vQGGQ08nYjI%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写样例如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9347a2146ad4f5aa7b3d50c5b786458~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771248931&amp;x-signature=S5XYPw%2BK5XsysryvXdtkua2Yojk%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f40c5a1207845c8b27618098c191b37~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771248931&amp;x-signature=EwAlpk0Es6sPMxTEyCIToXTLkow%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/producer/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "action": "replace_section",
  "model": "FUZZ-2.0 Pro",
  "instrumental": false,
  "lyric": "[Verse]\\nWoke up with the sun in my eyes\\nNo clouds above just blue in the skies\\nShoes on my feet I’m ready to run\\nEvery step feels like a loaded gun\\n[Chorus]\\nHappy days are rolling in\\nLet the joy beneath my skin\\nNo more shadows no more lies\\nJust the truth that lifts me high\\n[Verse 2]\\nDancing through the city streets\\nA rhythm pounding in my heartbeat\\nStrangers smile it’s catching on\\nThis world’s a stage we’re all a song\\n[Chorus]\\nHappy days are rolling in\\nLet the joy beneath my skin\\nNo more shadows no more lies\\nJust the truth that lifts me high\\n[Bridge]\\nThrow your worries out the door\\nLet them sink to the ocean floor\\nWe’re alive and it’s enough\\nLife is messy but it’s love\\n[Chorus]\\nHappy days are rolling in\\nLet the joy beneath my skin\\nNo more shadows no more lies\\nJust the truth that lifts me high",
  "audio_id": "d9ebc609-fb65-4a23-b914-c074747af6a4",
  "replace_section_start": 3,
  "replace_section_end": 70,
  "custom": true
}'
</code></pre>
<p>测试允许，生成的效果是类似的。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"3cb5ae96-01b0-4a37-afb0-e582608af56f"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"3ebc6f63-5093-4499-bf9b-95c239e0da4f"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"a54609c6-13e2-4176-be0f-4d7eebc68e1f"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Woke up with the sun in my eyes"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/7ce2b11a-179f-4b87-b5ff-397613c62c93/image/a54609c6-13e2-4176-be0f-4d7eebc68e1f.jpg"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\\nWoke up with the sun in my eyes\\nNo clouds above just blue in the skies\\nShoes on my feet I’m ready to run\\nEvery step feels like a loaded gun\\n[Chorus]\\nHappy days are rolling in\\nLet the joy beneath my skin\\nNo more shadows no more lies\\nJust the truth that lifts me high\\n[Verse 2]\\nDancing through the city streets\\nA rhythm pounding in my heartbeat\\nStrangers smile it’s catching on\\nThis world’s a stage we’re all a song\\n[Chorus]\\nHappy days are rolling in\\nLet the joy beneath my skin\\nNo more shadows no more lies\\nJust the truth that lifts me high\\n[Bridge]\\nThrow your worries out the door\\nLet them sink to the ocean floor\\nWe’re alive and it’s enough\\nLife is messy but it’s love\\n[Chorus]\\nHappy days are rolling in\\nLet the joy beneath my skin\\nNo more shadows no more lies\\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/7ce2b11a-179f-4b87-b5ff-397613c62c93/audio/a54609c6-13e2-4176-be0f-4d7eebc68e1f.m4a"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"a54609c6-13e2-4176-be0f-4d7eebc68e1f"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"topic"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"seed"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"14887454"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"sound"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-12-30T18:01:19.907443Z"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FUZZ-2.0 Pro"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"progress"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"100%"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"174.6140589569161"</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-7">伴奏翻版</h2>
<p>如果想使用官方的伴奏翻版操作，可以将<code>action</code>参数值设为：<code>swap_instrumentals</code>，接下来我们要根据歌词、标题自定义生成歌曲。</p>
<p>填写样例如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a817d22e36e48aba29de3e46fc9127d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771248931&amp;x-signature=MvBrJGjDF2%2FaEQ7CoU8QGwLw9oc%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd914c59754d46cf84940831bae31d9c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771248931&amp;x-signature=7NMOpJlsHKwo8ICtBOTS5x20q5E%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/producer/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "action": "swap_instrumentals",
  "model": "FUZZ-2.0 Pro",
  "weirdness": 0.6,
  "prompt": "Happy",
  "audio_id": "d9ebc609-fb65-4a23-b914-c074747af6a4"
}'
</code></pre>
<p>测试允许，生成的效果是类似的。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"d17d8376-3a58-451d-a976-404719bac11d"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ab596807-910a-4e30-bae2-4647895f7d0b"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"22d7d75c-9e0a-47a8-b22b-eea55eaa0c4b"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Extend (Sound swap)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/7ce2b11a-179f-4b87-b5ff-397613c62c93/image/22d7d75c-9e0a-47a8-b22b-eea55eaa0c4b.jpg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/7ce2b11a-179f-4b87-b5ff-397613c62c93/audio/22d7d75c-9e0a-47a8-b22b-eea55eaa0c4b.m4a"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"22d7d75c-9e0a-47a8-b22b-eea55eaa0c4b"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"topic"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"seed"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2157878068"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"sound"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Happy"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-12-30T18:09:49.594800Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FUZZ-2.0 Pro"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"progress"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"100%"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"172.3849433106576"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-8">人声翻版</h2>
<p>如果想使用官方的人声翻版操作，可以将<code>action</code>参数值设为：<code>swap_vocals</code>，接下来我们要根据歌词、标题、风格自定义生成歌曲。</p>
<p>填写样例如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bafb4036a6b42c0b5844f36c96d2f45~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771248931&amp;x-signature=bdEz7oumGSXEKLGgPW6nHvRw464%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc13dde475e04b3d87ab19c746d2ceb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771248931&amp;x-signature=tTADjMiI2EBJSFCzO0kgbMW5moM%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/producer/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "action": "swap_vocals",
  "model": "FUZZ-2.0 Pro",
  "instrumental": false,
  "lyric": "[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high",
  "weirdness": 0.6,
  "lyrics_strength": 0.8,
  "audio_id": "d9ebc609-fb65-4a23-b914-c074747af6a4",
  "custom": true
}'
</code></pre>
<p>测试允许，生成的效果是类似的。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"a903ac38-f129-4f85-9181-b1dc5579bd32"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"9953af52-45e0-4808-bf13-88f0b21262c1"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"7b2d653b-aaaa-41b0-b737-aee4c4c5693b"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Woke up with the sun in my eyes"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/7ce2b11a-179f-4b87-b5ff-397613c62c93/image/7b2d653b-aaaa-41b0-b737-aee4c4c5693b.jpg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/7ce2b11a-179f-4b87-b5ff-397613c62c93/audio/7b2d653b-aaaa-41b0-b737-aee4c4c5693b.m4a"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"7b2d653b-aaaa-41b0-b737-aee4c4c5693b"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"topic"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"seed"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2484735707"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"sound"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-12-30T18:13:01.349875Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FUZZ-2.0 Pro"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"progress"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"100%"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"173.12798185941043"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-9">词曲分离</h2>
<p>如果想使用官方的词曲分离操作，可以将<code>action</code>参数值设为：<code>stems</code>，接下来我们要根据歌曲ID进行词曲分离。</p>
<p>填写样例如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54b0dcc137b5444bbd203be51d4c0b20~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771248931&amp;x-signature=bC4ms38Jt0eFtTGDZ0ZHIb3e9q4%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f73a714eb38a4cf0bfbf71a9d2031035~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771248931&amp;x-signature=m808phRGkRz5K7PFopv6THJm9Xs%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/producer/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "action": "stems",
  "audio_id": "a54609c6-13e2-4176-be0f-4d7eebc68e1f"
}'
</code></pre>
<p>测试允许，生成的效果是类似的。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"561ac695-b4aa-47cf-978d-fb7be2b9ebfc"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"66d0d397-2987-4bde-84fb-a60d0023b217"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Woke up with the sun in my eyes"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"stems_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://platform.cdn.acedata.cloud/producer/561ac695-b4aa-47cf-978d-fb7be2b9ebfc.zip"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"progress"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"100%"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-10">异步回调</h2>
<p>由于 Producer Audios Generation API 生成的时间有时候会相对较长，如果 API 长时间无响应，HTTP 请求会一直保持连接，导致额外的系统资源消耗，所以本 API 也提供了异步回调的支持。</p>
<p>整体流程是：客户端发起请求的时候，额外指定一个 <code>callback_url</code> 字段，客户端发起 API 请求之后，API 会立马返回一个结果，包含一个 <code>task_id</code> 的字段信息，代表当前的任务 ID。当任务完成之后，生成任务的结果会通过 POST JSON 的形式发送到客户端指定的 <code>callback_url</code>，其中也包括了 <code>task_id</code> 字段，这样任务结果就可以通过 ID 关联起来了。</p>
<p>下面我们通过示例来了解下具体怎样操作。</p>
<p>首先，Webhook 回调是一个可以接收 HTTP 请求的服务，开发者应该替换为自己搭建的 HTTP 服务器的 URL。此处为了方便演示，使用一个公开的 Webhook 样例网站 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebhook.site%2F" target="_blank" title="https://webhook.site/" ref="nofollow noopener noreferrer">webhook.site/</a>，打开该网站即可得到一个 Webhook URL，如图所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dbbab92a03d0447fb84b6ad96b646309~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771248931&amp;x-signature=CSG%2BIecpjgvKwAEh%2BpQ81FJbmlM%3D" alt="" loading="lazy"/></p>
<p>将此 URL 复制下来，就可以作为 Webhook 来使用，此处的样例为 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebhook.site%2F%23!%2Fview%2F0d73431d-f833-4be4-9276-b6e1690d55c1" target="_blank" title="https://webhook.site/#!/view/0d73431d-f833-4be4-9276-b6e1690d55c1" ref="nofollow noopener noreferrer">webhook.site/#!/view/0d7…</a>。</p>
<p>接下来，我们可以设置字段 <code>callback_url</code> 为上述 Webhook URL，同时填入相应的参数，具体的内容如图所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f41563af796148b6a49ddd339e4c1a3b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771248931&amp;x-signature=0ylHwAcgkvdOH%2FSEq758vGDBShA%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>点击运行，可以发现会立即得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1a6ac2ad-10f2-4e2b-b500-66ec27fe82ad"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>稍等片刻，我们可以在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebhook.site%2F%23!%2Fview%2F0d73431d-f833-4be4-9276-b6e1690d55c1" target="_blank" title="https://webhook.site/#!/view/0d73431d-f833-4be4-9276-b6e1690d55c1" ref="nofollow noopener noreferrer">webhook.site/#!/view/0d7…</a> 上观察到生成任务的结果，如图所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/132b9a3a18af46f9b55a48c2fa043e8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771248931&amp;x-signature=F4NgiZWBUG302R9g3HzLwUpzFPI%3D" alt="" loading="lazy"/></p>
<p>内容如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1a6ac2ad-10f2-4e2b-b500-66ec27fe82ad"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1da03537-4eb8-410d-b849-43f03085a3bb"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1dd08826-478e-43a6-868f-aff5ababac2c"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Woke up with the sun in my eyes"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/3bff6223-fe13-4bef-973e-2cbaef430d5d/image/1dd08826-478e-43a6-868f-aff5ababac2c.jpg"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/3bff6223-fe13-4bef-973e-2cbaef430d5d/audio/1dd08826-478e-43a6-868f-aff5ababac2c.m4a"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1dd08826-478e-43a6-868f-aff5ababac2c"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"topic"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"seed"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1490770667"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"sound"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-12-30T18:36:00.994141Z"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FUZZ-2.0 Pro"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"progress"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"100%"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"135.2330158730159"</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>可以看到结果中有一个 <code>task_id</code> 字段，其他的字段都和上文类似，通过该字段即可实现任务的关联。</p>
<h2 data-id="heading-11">错误处理</h2>
<p>在调用 API 时，如果遇到错误，API 会返回相应的错误代码和信息。例如：</p>
<ul>
<li><code>400 token_mismatched</code>：Bad request, possibly due to missing or invalid parameters.</li>
<li><code>400 api_not_implemented</code>：Bad request, possibly due to missing or invalid parameters.</li>
<li><code>401 invalid_token</code>：Unauthorized, invalid or missing authorization token.</li>
<li><code>429 too_many_requests</code>：Too many requests, you have exceeded the rate limit.</li>
<li><code>500 api_error</code>：Internal server error, something went wrong on the server.</li>
</ul>
<h3 data-id="heading-12">错误响应示例</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"error"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api_error"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"fetch failed"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2cf86e86-22a4-46e1-ac2f-032c0f2a4e89"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-13">结论</h2>
<p>通过本文档，您已经了解了如何使用 Producer Audios Generation API 可通过输入提示词来生成音乐。希望本文档能帮助您更好地对接和使用该 API。如有任何问题，请随时联系我们的技术支持团队。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🚀OpenClaw高级使用经验分享！2026年最强生产力！五分钟打造多Agent协作编程开发团队！模型容灾机制深度配置+云端Gateway操控本地macOS！]]></title>    <link>https://juejin.cn/post/7604671453452861455</link>    <guid>https://juejin.cn/post/7604671453452861455</guid>    <pubDate>2026-02-09T13:48:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604671453452861455" data-draft-id="7604493165328465954" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🚀OpenClaw高级使用经验分享！2026年最强生产力！五分钟打造多Agent协作编程开发团队！模型容灾机制深度配置+云端Gateway操控本地macOS！"/> <meta itemprop="keywords" content="AIGC,AI编程,OpenAI"/> <meta itemprop="datePublished" content="2026-02-09T13:48:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="win4r"/> <meta itemprop="url" content="https://juejin.cn/user/1739869037541555"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🚀OpenClaw高级使用经验分享！2026年最强生产力！五分钟打造多Agent协作编程开发团队！模型容灾机制深度配置+云端Gateway操控本地macOS！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1739869037541555/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    win4r
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T13:48:19.000Z" title="Mon Feb 09 2026 13:48:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>OpenClaw是一款基于开源架构的AI智能体平台，被誉为2026年最具突破性的AI Agent系统。它以强大的多模型调度能力为核心，支持Anthropic、OpenAI、Google等主流AI模型的自动容灾切换，确保服务永不中断。OpenClaw内置智能记忆检索系统，通过Embedding模型实现混合搜索，让Agent在持续使用中不断积累经验、越用越聪明。其最大亮点在于多Agent协作机制——支持线性流水线、依赖图并行、多Agent辩论三种协作模式，可组建由编码、测试、文档、审查等专职AI成员构成的虚拟开发团队，一条指令即可交付生产级代码。此外，OpenClaw还支持云端与本地设备通过SSH反向隧道配对，实现远程操控浏览器、执行命令等跨端能力。用户只需下达指令，OpenClaw便能自主完成从开发到交付的全流程工作，堪称AI Agent的终极形态。</p>
<p>🔥🔥🔥本篇笔记所对应的视频：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1pScgzXEB7%2F" target="_blank" title="https://www.bilibili.com/video/BV1pScgzXEB7/" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV1pS…</a></p>
<h2 data-id="heading-0">Team Tasks skill:</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fwin4r%2Fteam-tasks" target="_blank" title="https://github.com/win4r/team-tasks" ref="nofollow noopener noreferrer">github.com/win4r/team-…</a></p>
<h2 data-id="heading-1">模型容灾机制</h2>
<p>文件路径：/home/ubuntu/.openclaw/openclaw.json</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"agents"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"defaults"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"primary"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"anthropic/claude-opus-4-6"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"fallbacks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-string">"openai-codex/gpt-5.3-codex"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-string">"google-antigravity/claude-opus-4-6-thinking"</span>
        <span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"list"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"main"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"default"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"primary"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"anthropic/claude-opus-4-6"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"fallbacks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
            <span class="hljs-string">"openai-codex/gpt-5.3-codex"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-string">"google-antigravity/claude-opus-4-6-thinking"</span>
          <span class="hljs-punctuation">]</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>多认证 Profile + Token 轮换</p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"auth"</span>: {
    <span class="hljs-string">"profiles"</span>: {
      <span class="hljs-string">"openai-codex:default"</span>: {
        <span class="hljs-string">"provider"</span>: <span class="hljs-string">"openai-codex"</span>,
        <span class="hljs-string">"mode"</span>: <span class="hljs-string">"oauth"</span>
      },
      <span class="hljs-string">"anthropic:default"</span>: {
        <span class="hljs-string">"provider"</span>: <span class="hljs-string">"anthropic"</span>,
        <span class="hljs-string">"mode"</span>: <span class="hljs-string">"token"</span>
      },
      <span class="hljs-string">"anthropic:manual"</span>: {
        <span class="hljs-string">"provider"</span>: <span class="hljs-string">"anthropic"</span>,
        <span class="hljs-string">"mode"</span>: <span class="hljs-string">"token"</span>
      },
      <span class="hljs-string">"google-antigravity:mail1@gmail.com"</span>: {
        <span class="hljs-string">"provider"</span>: <span class="hljs-string">"google-antigravity"</span>,
        <span class="hljs-string">"mode"</span>: <span class="hljs-string">"oauth"</span>,
        <span class="hljs-string">"email"</span>: <span class="hljs-string">"mail1@gmail.com"</span>
      },
      <span class="hljs-string">"google-antigravity:mail2@gmail.com"</span>: {
        <span class="hljs-string">"provider"</span>: <span class="hljs-string">"google-antigravity"</span>,
        <span class="hljs-string">"mode"</span>: <span class="hljs-string">"oauth"</span>
      }
    },
    <span class="hljs-string">"order"</span>: {
      <span class="hljs-string">"anthropic"</span>: [
        <span class="hljs-string">"anthropic:default"</span>,
        <span class="hljs-string">"anthropic:manual"</span>
      ],
      <span class="hljs-string">"google-antigravity"</span>: [
        <span class="hljs-string">"google-antigravity:mail1@gmail.com"</span>,
        <span class="hljs-string">"google-antigravity:mail2@gmail.com"</span>
      ]
    }
  }
}
</code></pre>
<h2 data-id="heading-2">memory_search配置</h2>
<p>文件路径：/home/ubuntu/.openclaw/openclaw.json</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"agents"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"defaults"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"memorySearch"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"sources"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"memory"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"sessions"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"experimental"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"sessionMemory"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"remote"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"apiKey"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AIzaSy**************************"</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"fallback"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-embedding-001"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"query"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"hybrid"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"enabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"vectorWeight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.7</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"textWeight"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.3</span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-3">云端 OpenClaw 与本地 macOS 通过 Node 配对步骤</h2>
<h2 data-id="heading-4">架构概览</h2>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────┐       SSH 反向隧道        ┌─────────────────────────┐
│  云端 AWS (Ubuntu)       │ ◄────────────────────── │  本地 macOS (MacBook)    │
│                         │      端口 <span class="hljs-number">18790</span>           │                         │
│  OpenClaw Gateway       │                          │  OpenClaw Node          │
│  监听: <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">18789</span>  │                          │  连接: localhost:<span class="hljs-number">18790</span>   │
│  公网 IP: xx.xx.xx.xx   │                          │  NAT 内网（无公网 IP）    │
└─────────────────────────┘                          └─────────────────────────┘
</code></pre>
<p>核心思路：Mac 在 NAT 内网无公网 IP，无法被 AWS 主动连接。解决方案是 Mac 主动通过 SSH 隧道连到 AWS，在 AWS 本地开一个端口（18790），将流量转发到 Mac 上的 Node 服务。</p>
<hr/>
<h2 data-id="heading-5">前置条件</h2>

























<table><thead><tr><th>项目</th><th>要求</th></tr></thead><tbody><tr><td>AWS 服务器</td><td>OpenClaw Gateway 已安装并运行</td></tr><tr><td>macOS</td><td>Node.js ≥ 22, npm</td></tr><tr><td>SSH</td><td>Mac 能 SSH 到 AWS（公钥已添加到 ~/.ssh/authorized_keys）</td></tr><tr><td>网络</td><td>Mac 有互联网访问（不需要公网 IP）</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-6">步骤 1：Mac 安装 OpenClaw</h2>
<pre><code class="hljs">npm install -g openclaw
</code></pre>
<p>验证安装：</p>
<pre><code class="hljs language-css" lang="css">openclaw <span class="hljs-attr">--version</span>
</code></pre>
<hr/>
<h2 data-id="heading-7">步骤 2：获取 Gateway Token</h2>
<p>在 AWS 上查看配置文件中的 Gateway Token：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cat</span> ~/.openclaw/openclaw.json | grep -A2 <span class="hljs-string">'"auth"'</span>
</code></pre>
<p>找到 gateway.auth.token 的值，后续步骤需要用到。</p>
<p>也可以通过 OpenClaw 工具获取：</p>
<pre><code class="hljs language-arduino" lang="arduino">openclaw gateway config | grep token
</code></pre>
<hr/>
<h2 data-id="heading-8">步骤 3：建立 SSH 反向隧道</h2>
<p>在 Mac 终端执行：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">ssh -N -L <span class="hljs-number">18790</span>:<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">18789</span> <span class="hljs-symbol">ubuntu@</span>&lt;AWS公网IP&gt;
</code></pre>





















<table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>-N</td><td>不执行远程命令，只做端口转发</td></tr><tr><td>-L 18790:127.0.0.1:18789</td><td>Mac 本地 18790 → AWS 的 127.0.0.1:18789（Gateway）</td></tr><tr><td>ubuntu@</td><td>AWS 服务器 SSH 地址</td></tr></tbody></table>
<p>⚠️ 首次连接需要确认 SSH 指纹（输入 yes）。</p>
<p>验证隧道是否通：</p>
<pre><code class="hljs language-bash" lang="bash">curl -s &lt;http://localhost:18790/health&gt;
</code></pre>
<p>如果返回内容，说明隧道已通。</p>
<hr/>
<h2 data-id="heading-9">步骤 4：启动 Node 服务</h2>
<p>在 Mac 另一个终端执行：</p>
<pre><code class="hljs language-arduino" lang="arduino">OPENCLAW_GATEWAY_TOKEN=<span class="hljs-string">"&lt;你的Gateway Token&gt;"</span> \
  openclaw node run \
  --host <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span> \
  --port <span class="hljs-number">18790</span> \
  --display-name <span class="hljs-string">"Master-Mac"</span>
</code></pre>

























<table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>OPENCLAW_GATEWAY_TOKEN</td><td>Gateway 认证令牌</td></tr><tr><td>--host 127.0.0.1</td><td>连接到本地（通过 SSH 隧道转发）</td></tr><tr><td>--port 18790</td><td>SSH 隧道的本地端口</td></tr><tr><td>--display-name</td><td>Node 的显示名称（方便识别）</td></tr></tbody></table>
<p>启动后会看到类似输出：</p>
<pre><code class="hljs language-rust" lang="rust">🔗 Connecting to gateway at ws:<span class="hljs-comment">//127.0.0.1:18790 ...</span>
✅ Connected! Waiting <span class="hljs-keyword">for</span> <span class="hljs-title class_">pairing</span> approval...
</code></pre>
<hr/>
<h2 data-id="heading-10">步骤 5：AWS 端批准配对</h2>
<p>在 AWS 终端或通过 OpenClaw Agent 执行：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 查看待批准的 Node</span>
openclaw node pending

<span class="hljs-comment"># 批准配对（使用 Node ID 或名称）</span>
openclaw node approve &lt;node-<span class="hljs-built_in">id</span>&gt;
</code></pre>
<p>或者通过 Agent 工具：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 查看待配对</span>
nodes(<span class="hljs-attr">action</span>=<span class="hljs-string">"pending"</span>)

<span class="hljs-comment"># 批准</span>
nodes(<span class="hljs-attr">action</span>=<span class="hljs-string">"approve"</span>, node=<span class="hljs-string">"Master-Mac"</span>)
</code></pre>
<p>批准后 Mac 终端会显示：</p>
<pre><code class="hljs language-csharp" lang="csharp">✅ Paired successfully! Node <span class="hljs-keyword">is</span> now active.
</code></pre>
<hr/>
<h2 data-id="heading-11">步骤 6：配置执行权限</h2>
<p>在 Mac 上设置 Node 的执行权限：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 通过 OpenClaw 命令设置（推荐）</span>
openclaw node <span class="hljs-built_in">exec</span>-approvals <span class="hljs-built_in">set</span> defaults.security full
</code></pre>
<p>或者手动创建配置文件 ~/.openclaw/exec-approvals.json：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"defaults"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"security"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"full"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>⚠️ 关键：defaults.security 必须设为 "full"，否则即使 allowlist 配了 * 也会拒绝执行命令。</p>
<hr/>
<h2 data-id="heading-12">步骤 7：验证连接</h2>
<p>从 AWS 的 OpenClaw Agent 测试远程执行：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 查看 Node 状态</span>
nodes(<span class="hljs-attr">action</span>=<span class="hljs-string">"status"</span>)

<span class="hljs-comment"># 在 Mac 上执行命令</span>
nodes(<span class="hljs-attr">action</span>=<span class="hljs-string">"run"</span>, node=<span class="hljs-string">"Master-Mac"</span>, command=[<span class="hljs-string">"echo"</span>, <span class="hljs-string">"Hello from Mac!"</span>])

<span class="hljs-comment"># 查看 Mac 系统信息</span>
nodes(<span class="hljs-attr">action</span>=<span class="hljs-string">"run"</span>, node=<span class="hljs-string">"Master-Mac"</span>, command=[<span class="hljs-string">"sw_vers"</span>])
</code></pre>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[图结构完全解析：从基础概念到遍历实现]]></title>    <link>https://juejin.cn/post/7604671453452877839</link>    <guid>https://juejin.cn/post/7604671453452877839</guid>    <pubDate>2026-02-09T13:58:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604671453452877839" data-draft-id="7604493165328482338" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="图结构完全解析：从基础概念到遍历实现"/> <meta itemprop="keywords" content="JavaScript,后端,算法"/> <meta itemprop="datePublished" content="2026-02-09T13:58:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="颜酱"/> <meta itemprop="url" content="https://juejin.cn/user/905653309941495"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            图结构完全解析：从基础概念到遍历实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/905653309941495/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    颜酱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T13:58:11.000Z" title="Mon Feb 09 2026 13:58:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">图结构完全解析：从基础概念到遍历实现</h2>
<p>图是计算机科学中最核心的数据结构之一，它能抽象现实世界中各类复杂的关系网络——从地图导航的路径规划，到社交网络的好友推荐，再到物流网络的成本优化，都离不开图结构的应用。本文将从图的基础概念出发，逐步讲解图的存储方式、通用实现，以及核心的遍历算法（DFS/BFS），帮助你彻底掌握图结构的核心逻辑。</p>
<h3 data-id="heading-1">一、图的核心概念</h3>
<h4 data-id="heading-2">1.1 基本构成</h4>
<p>图由<strong>节点（Vertex）</strong> 和<strong>边（Edge）</strong> 组成：</p>
<ul>
<li>
<p>节点：表示实体，有唯一ID标识；</p>
</li>
<li>
<p>边：表示节点间的关系，可分为：</p>
<ul>
<li>
<p>有向/无向：有向边（如A→B）仅表示单向关系，无向边（如A-B）等价于双向有向边；</p>
</li>
<li>
<p>加权/无权：加权边附带数值（如距离、成本），无权边可视为权重为1的特殊情况。</p>
</li>
</ul>
</li>
</ul>
<h4 data-id="heading-3">1.2 关键属性</h4>
<h5 data-id="heading-4">（1）度</h5>
<ul>
<li>
<p>无向图：节点的度 = 相连边的条数；</p>
</li>
<li>
<p>有向图：入度（指向该节点的边数）+ 出度（该节点指向其他的边数）。</p>
</li>
</ul>
<h5 data-id="heading-5">（2）稀疏图 vs 稠密图</h5>
<p>简单图（无自环、无多重边）中，V个节点最多有  <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mo stretchy="false">(</mo><mi>V</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">V(V-1)/2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">1</span><span class="mclose">)</span><span class="mord">/2</span></span></span></span></span>  条边：</p>
<ul>
<li>
<p>稀疏图：边数E远小于  <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>V</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">V^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span> （如社交网络）；</p>
</li>
<li>
<p>稠密图：边数E接近  <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>V</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">V^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span> （如全连接网络）。</p>
</li>
</ul>
<h4 data-id="heading-6">1.3 子图相关</h4>
<ul>
<li>
<p>子图：节点和边均为原图的子集；</p>
</li>
<li>
<p>生成子图：包含原图所有节点，仅保留部分边（如最小生成树）；</p>
</li>
<li>
<p>导出子图：选择部分节点，且包含这些节点在原图中的所有边。</p>
</li>
</ul>
<h4 data-id="heading-7">1.4 连通性</h4>
<ul>
<li>
<p>无向图：</p>
<ul>
<li>
<p>连通图：任意两节点间有路径可达；</p>
</li>
<li>
<p>连通分量：非连通图中的最大连通子图；</p>
</li>
</ul>
</li>
<li>
<p>有向图：</p>
<ul>
<li>
<p>强连通：任意两节点间有双向有向路径；</p>
</li>
<li>
<p>弱连通：忽略边方向后为连通图。</p>
</li>
</ul>
</li>
</ul>
<h4 data-id="heading-8">1.5 图与树的关系</h4>
<p>图是多叉树的延伸：树无环、仅允许父→子指向，而图可成环、节点间可任意指向。树的遍历逻辑（DFS/BFS）完全适用于图，仅需增加「标记已访问节点」的逻辑避免环导致的死循环。</p>
<h3 data-id="heading-9">二、图的存储方式</h3>
<p>图的存储核心是「记录节点间的连接关系」，主流方式有<strong>邻接表</strong>和<strong>邻接矩阵</strong>两种，二者各有适用场景。</p>
<h4 data-id="heading-10">2.1 邻接表</h4>
<h5 data-id="heading-11">核心结构</h5>
<p>以节点ID为键，存储该节点的所有出边（包含目标节点+权重）：</p>
<ul>
<li>
<p>数组版：<code>graph[x]</code> 存储节点x的出边列表（适用于节点ID为连续整数）；</p>
</li>
<li>
<p>Map版：<code>graph.get(x)</code> 存储节点x的出边列表（适用于任意类型节点ID）。</p>
</li>
</ul>
<h5 data-id="heading-12">特点</h5>
<ul>
<li>
<p>空间复杂度： <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>V</mi><mo>+</mo><mi>E</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(V+E)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mclose">)</span></span></span></span></span> （仅存储实际存在的边，适合稀疏图）；</p>
</li>
<li>
<p>时间复杂度：增边 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span> ，删/查边 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>E</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(E)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mclose">)</span></span></span></span></span> （E为节点出边数），获取邻居 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span> 。</p>
</li>
</ul>
<h4 data-id="heading-13">2.2 邻接矩阵</h4>
<h5 data-id="heading-14">核心结构</h5>
<p>二维数组 <code>matrix[from][to]</code>：</p>
<ul>
<li>
<p>无权图：<code>true/false</code> 表示是否有边；</p>
</li>
<li>
<p>加权图：数值表示权重，<code>null</code> 表示无边（避免0权重歧义）。</p>
</li>
</ul>
<h5 data-id="heading-15">特点</h5>
<ul>
<li>
<p>空间复杂度： <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>V</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(V^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span> （需预分配所有节点组合，适合稠密图）；</p>
</li>
<li>
<p>时间复杂度：增/删/查边/获取权重均为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span> ，获取邻居 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>V</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(V)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mclose">)</span></span></span></span></span> 。</p>
</li>
</ul>
<h4 data-id="heading-16">2.3 存储方式对比</h4>






























<table><thead><tr><th>特性</th><th>邻接表</th><th>邻接矩阵</th></tr></thead><tbody><tr><td>空间效率</td><td>稀疏图更优</td><td>稠密图更优</td></tr><tr><td>增删查边</td><td>增边快、删/查边慢</td><td>所有操作均快</td></tr><tr><td>节点ID支持</td><td>支持任意类型（Map版）</td><td>仅支持连续整数</td></tr><tr><td>适用场景</td><td>大多数稀疏图场景</td><td>节点少、需快速查边</td></tr></tbody></table>
<h3 data-id="heading-17">三、图的通用实现</h3>
<p>基于邻接表/邻接矩阵，我们实现支持「增删查改」的通用加权有向图类，可灵活适配无向图（双向加边）、无权图（权重默认1）。</p>
<h4 data-id="heading-18">3.1 邻接表（数组版）：适用于连续整数节点ID</h4>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-comment">/**
 * 加权有向图（邻接表-数组版）
 * 核心：节点ID为0~n-1的连续整数，二维数组存储出边
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">WeightedDigraphArray</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">n</span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Number</span>.<span class="hljs-title function_">isInteger</span>(n) || n &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`节点数必须是正整数（当前传入：<span class="hljs-subst">${n}</span>）`</span>);
        }
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeCount</span> = n;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span> = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: n }, <span class="hljs-function">() =&gt;</span> []); <span class="hljs-comment">// 邻接表初始化</span>
    }

    <span class="hljs-comment">// 私有方法：校验节点合法性</span>
    <span class="hljs-title function_">_validateNode</span>(<span class="hljs-params">node</span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Number</span>.<span class="hljs-title function_">isInteger</span>(node) || node &lt; <span class="hljs-number">0</span> || node &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeCount</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`节点<span class="hljs-subst">${node}</span>非法！合法范围：0 ~ <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.nodeCount - <span class="hljs-number">1</span>}</span>`</span>);
        }
    }

    <span class="hljs-comment">// 添加加权有向边</span>
    <span class="hljs-title function_">addEdge</span>(<span class="hljs-params"><span class="hljs-keyword">from</span>, to, weight</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_validateNode</span>(<span class="hljs-keyword">from</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_validateNode</span>(to);
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> weight !== <span class="hljs-string">'number'</span> || <span class="hljs-built_in">isNaN</span>(weight)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`边<span class="hljs-subst">${<span class="hljs-keyword">from</span>}</span>→<span class="hljs-subst">${to}</span>的权重必须是有效数字`</span>);
        }
        <span class="hljs-comment">// 避免重复加边</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">hasEdge</span>(<span class="hljs-keyword">from</span>, to)) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">removeEdge</span>(<span class="hljs-keyword">from</span>, to);
        }
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span>[<span class="hljs-keyword">from</span>].<span class="hljs-title function_">push</span>({ to, weight });
    }

    <span class="hljs-comment">// 删除有向边</span>
    <span class="hljs-title function_">removeEdge</span>(<span class="hljs-params"><span class="hljs-keyword">from</span>, to</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_validateNode</span>(<span class="hljs-keyword">from</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_validateNode</span>(to);
        <span class="hljs-keyword">const</span> originalLength = <span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span>[<span class="hljs-keyword">from</span>].<span class="hljs-property">length</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span>[<span class="hljs-keyword">from</span>] = <span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span>[<span class="hljs-keyword">from</span>].<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">edge</span> =&gt;</span> edge.<span class="hljs-property">to</span> !== to);
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span>[<span class="hljs-keyword">from</span>].<span class="hljs-property">length</span> &lt; originalLength;
    }

    <span class="hljs-comment">// 判断边是否存在</span>
    <span class="hljs-title function_">hasEdge</span>(<span class="hljs-params"><span class="hljs-keyword">from</span>, to</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_validateNode</span>(<span class="hljs-keyword">from</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_validateNode</span>(to);
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span>[<span class="hljs-keyword">from</span>].<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">edge</span> =&gt;</span> edge.<span class="hljs-property">to</span> === to);
    }

    <span class="hljs-comment">// 获取边权重</span>
    <span class="hljs-title function_">getEdgeWeight</span>(<span class="hljs-params"><span class="hljs-keyword">from</span>, to</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_validateNode</span>(<span class="hljs-keyword">from</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_validateNode</span>(to);
        <span class="hljs-keyword">const</span> edge = <span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span>[<span class="hljs-keyword">from</span>].<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">edge</span> =&gt;</span> edge.<span class="hljs-property">to</span> === to);
        <span class="hljs-keyword">if</span> (!edge) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`不存在边<span class="hljs-subst">${<span class="hljs-keyword">from</span>}</span>→<span class="hljs-subst">${to}</span>`</span>);
        <span class="hljs-keyword">return</span> edge.<span class="hljs-property">weight</span>;
    }

    <span class="hljs-comment">// 获取节点所有出边</span>
    <span class="hljs-title function_">getNeighbors</span>(<span class="hljs-params">v</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_validateNode</span>(v);
        <span class="hljs-keyword">return</span> [...<span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span>[v]]; <span class="hljs-comment">// 返回拷贝，避免外部修改</span>
    }

    <span class="hljs-comment">// 打印邻接表（调试用）</span>
    <span class="hljs-title function_">printAdjList</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'=== 加权有向图邻接表 ==='</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeCount</span>; i++) {
            <span class="hljs-keyword">const</span> edges = <span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span>[i].<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">edge</span> =&gt;</span> <span class="hljs-string">`<span class="hljs-subst">${edge.to}</span>(<span class="hljs-subst">${edge.weight}</span>)`</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">', '</span>);
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`节点<span class="hljs-subst">${i}</span>的出边：<span class="hljs-subst">${edges || <span class="hljs-string">'无'</span>}</span>`</span>);
        }
    }
}
</code></pre>
<h4 data-id="heading-19">3.2 邻接表（Map版）：适用于任意类型节点ID</h4>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-comment">/**
 * 加权有向图（邻接表-Map版）
 * 核心：支持动态添加节点，节点ID可为任意可哈希类型（数字/字符串等）
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">WeightedDigraphMap</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(); <span class="hljs-comment">// key: 节点ID，value: 出边列表</span>
    }

    <span class="hljs-comment">// 添加加权有向边</span>
    <span class="hljs-title function_">addEdge</span>(<span class="hljs-params"><span class="hljs-keyword">from</span>, to, weight</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> weight !== <span class="hljs-string">'number'</span> || <span class="hljs-built_in">isNaN</span>(weight)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'边的权重必须是有效数字'</span>);
        }
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span>.<span class="hljs-title function_">has</span>(<span class="hljs-keyword">from</span>)) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span>.<span class="hljs-title function_">set</span>(<span class="hljs-keyword">from</span>, []);
        }
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">removeEdge</span>(<span class="hljs-keyword">from</span>, to); <span class="hljs-comment">// 去重</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span>.<span class="hljs-title function_">get</span>(<span class="hljs-keyword">from</span>).<span class="hljs-title function_">push</span>({ to, weight });
    }

    <span class="hljs-comment">// 删除有向边</span>
    <span class="hljs-title function_">removeEdge</span>(<span class="hljs-params"><span class="hljs-keyword">from</span>, to</span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span>.<span class="hljs-title function_">has</span>(<span class="hljs-keyword">from</span>)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">const</span> edges = <span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span>.<span class="hljs-title function_">get</span>(<span class="hljs-keyword">from</span>);
        <span class="hljs-keyword">const</span> filtered = edges.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">edge</span> =&gt;</span> edge.<span class="hljs-property">to</span> !== to);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span>.<span class="hljs-title function_">set</span>(<span class="hljs-keyword">from</span>, filtered);
        <span class="hljs-keyword">return</span> filtered.<span class="hljs-property">length</span> &lt; edges.<span class="hljs-property">length</span>;
    }

    <span class="hljs-comment">// 判断边是否存在</span>
    <span class="hljs-title function_">hasEdge</span>(<span class="hljs-params"><span class="hljs-keyword">from</span>, to</span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span>.<span class="hljs-title function_">has</span>(<span class="hljs-keyword">from</span>)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span>.<span class="hljs-title function_">get</span>(<span class="hljs-keyword">from</span>).<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">edge</span> =&gt;</span> edge.<span class="hljs-property">to</span> === to);
    }

    <span class="hljs-comment">// 获取边权重</span>
    <span class="hljs-title function_">getEdgeWeight</span>(<span class="hljs-params"><span class="hljs-keyword">from</span>, to</span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span>.<span class="hljs-title function_">has</span>(<span class="hljs-keyword">from</span>)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`不存在节点<span class="hljs-subst">${<span class="hljs-keyword">from</span>}</span>`</span>);
        }
        <span class="hljs-keyword">const</span> edge = <span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span>.<span class="hljs-title function_">get</span>(<span class="hljs-keyword">from</span>).<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">edge</span> =&gt;</span> edge.<span class="hljs-property">to</span> === to);
        <span class="hljs-keyword">if</span> (!edge) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`不存在边<span class="hljs-subst">${<span class="hljs-keyword">from</span>}</span>→<span class="hljs-subst">${to}</span>`</span>);
        <span class="hljs-keyword">return</span> edge.<span class="hljs-property">weight</span>;
    }

    <span class="hljs-comment">// 获取节点所有出边</span>
    <span class="hljs-title function_">getNeighbors</span>(<span class="hljs-params">v</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span>.<span class="hljs-title function_">get</span>(v) || [];
    }

    <span class="hljs-comment">// 获取所有节点</span>
    <span class="hljs-title function_">getNodes</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span>.<span class="hljs-title function_">keys</span>());
    }
}
</code></pre>
<h4 data-id="heading-20">3.3 邻接矩阵版：适用于节点数少的场景</h4>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-comment">/**
 * 加权有向图（邻接矩阵版）
 * 核心：二维数组存储边权重，null表示无边
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">WeightedDigraphMatrix</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">n</span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Number</span>.<span class="hljs-title function_">isInteger</span>(n) || n &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'节点数必须是正整数'</span>);
        }
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeCount</span> = n;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">matrix</span> = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: n }, <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Array</span>(n).<span class="hljs-title function_">fill</span>(<span class="hljs-literal">null</span>));
    }

    <span class="hljs-comment">// 校验节点合法性</span>
    <span class="hljs-title function_">_validateNode</span>(<span class="hljs-params">node</span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Number</span>.<span class="hljs-title function_">isInteger</span>(node) || node &lt; <span class="hljs-number">0</span> || node &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeCount</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`节点<span class="hljs-subst">${node}</span>非法！合法范围：0 ~ <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.nodeCount - <span class="hljs-number">1</span>}</span>`</span>);
        }
    }

    <span class="hljs-comment">// 添加加权有向边</span>
    <span class="hljs-title function_">addEdge</span>(<span class="hljs-params"><span class="hljs-keyword">from</span>, to, weight</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_validateNode</span>(<span class="hljs-keyword">from</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_validateNode</span>(to);
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> weight !== <span class="hljs-string">'number'</span> || <span class="hljs-built_in">isNaN</span>(weight)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`边<span class="hljs-subst">${<span class="hljs-keyword">from</span>}</span>→<span class="hljs-subst">${to}</span>的权重必须是有效数字`</span>);
        }
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">matrix</span>[<span class="hljs-keyword">from</span>][to] = weight;
    }

    <span class="hljs-comment">// 删除有向边</span>
    <span class="hljs-title function_">removeEdge</span>(<span class="hljs-params"><span class="hljs-keyword">from</span>, to</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_validateNode</span>(<span class="hljs-keyword">from</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_validateNode</span>(to);
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">matrix</span>[<span class="hljs-keyword">from</span>][to] === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">matrix</span>[<span class="hljs-keyword">from</span>][to] = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-comment">// 判断边是否存在</span>
    <span class="hljs-title function_">hasEdge</span>(<span class="hljs-params"><span class="hljs-keyword">from</span>, to</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_validateNode</span>(<span class="hljs-keyword">from</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_validateNode</span>(to);
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">matrix</span>[<span class="hljs-keyword">from</span>][to] !== <span class="hljs-literal">null</span>;
    }

    <span class="hljs-comment">// 获取边权重</span>
    <span class="hljs-title function_">getEdgeWeight</span>(<span class="hljs-params"><span class="hljs-keyword">from</span>, to</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_validateNode</span>(<span class="hljs-keyword">from</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_validateNode</span>(to);
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">matrix</span>[<span class="hljs-keyword">from</span>][to];
    }

    <span class="hljs-comment">// 获取节点所有出边</span>
    <span class="hljs-title function_">getNeighbors</span>(<span class="hljs-params">v</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_validateNode</span>(v);
        <span class="hljs-keyword">const</span> neighbors = [];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> to = <span class="hljs-number">0</span>; to &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeCount</span>; to++) {
            <span class="hljs-keyword">const</span> weight = <span class="hljs-variable language_">this</span>.<span class="hljs-property">matrix</span>[v][to];
            <span class="hljs-keyword">if</span> (weight !== <span class="hljs-literal">null</span>) {
                neighbors.<span class="hljs-title function_">push</span>({ to, weight });
            }
        }
        <span class="hljs-keyword">return</span> neighbors;
    }

    <span class="hljs-comment">// 打印邻接矩阵（调试用）</span>
    <span class="hljs-title function_">printMatrix</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'=== 邻接矩阵 ==='</span>);
        process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'    '</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeCount</span>; i++) process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">`<span class="hljs-subst">${i}</span>   `</span>);
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>();
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> <span class="hljs-keyword">from</span> = <span class="hljs-number">0</span>; <span class="hljs-keyword">from</span> &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeCount</span>; <span class="hljs-keyword">from</span>++) {
            process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">from</span>}</span> | `</span>);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> to = <span class="hljs-number">0</span>; to &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeCount</span>; to++) {
                <span class="hljs-keyword">const</span> val = <span class="hljs-variable language_">this</span>.<span class="hljs-property">matrix</span>[<span class="hljs-keyword">from</span>][to] === <span class="hljs-literal">null</span> ? <span class="hljs-string">'∅'</span> : <span class="hljs-variable language_">this</span>.<span class="hljs-property">matrix</span>[<span class="hljs-keyword">from</span>][to];
                process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">`<span class="hljs-subst">${val}</span>   `</span>);
            }
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>();
        }
    }
}
</code></pre>
<h4 data-id="heading-21">3.4 适配无向图/无权图</h4>
<ul>
<li>
<p>无向图：添加/删除边时，同时操作 <code>from→to</code> 和 <code>to→from</code>；</p>
</li>
<li>
<p>无权图：复用加权图类，<code>addEdge</code> 时权重默认传1。</p>
</li>
</ul>
<h3 data-id="heading-22">四、图的核心遍历算法</h3>
<p>图的遍历是所有图论算法的基础，核心为<strong>深度优先搜索（DFS）</strong> 和<strong>广度优先搜索（BFS）</strong>，二者的核心区别是「遍历顺序」：DFS先探到底再回溯，BFS逐层扩散。</p>
<h4 data-id="heading-23">4.1 深度优先搜索（DFS）</h4>
<h5 data-id="heading-24">核心思想</h5>
<p>从起点出发，沿着一条路径走到头，再回溯探索其他分支，需通过 <code>visited</code>/<code>onPath</code> 数组避免环导致的死循环。</p>
<h5 data-id="heading-25">场景1：遍历所有节点（visited数组）</h5>
<p><code>visited</code> 标记已访问的节点，确保每个节点仅遍历一次：</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-comment">/**
 * DFS遍历所有节点
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">WeightedDigraphArray</span>} <span class="hljs-variable">graph</span> - 图实例
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} <span class="hljs-variable">s</span> - 起点
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">boolean[]</span>} <span class="hljs-variable">visited</span> - 访问标记数组
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">dfsTraverseNodes</span>(<span class="hljs-params">graph, s, visited</span>) {
    <span class="hljs-keyword">if</span> (s &lt; <span class="hljs-number">0</span> || s &gt;= graph.<span class="hljs-property">nodeCount</span> || visited[s]) <span class="hljs-keyword">return</span>;
    <span class="hljs-comment">// 前序位置：标记并访问节点</span>
    visited[s] = <span class="hljs-literal">true</span>;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`访问节点 <span class="hljs-subst">${s}</span>`</span>);
    <span class="hljs-comment">// 递归遍历所有邻居</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> edge <span class="hljs-keyword">of</span> graph.<span class="hljs-title function_">getNeighbors</span>(s)) {
        <span class="hljs-title function_">dfsTraverseNodes</span>(graph, edge.<span class="hljs-property">to</span>, visited);
    }
    <span class="hljs-comment">// 后序位置：可处理节点相关逻辑（如统计、计算）</span>
}

<span class="hljs-comment">// 调用示例</span>
<span class="hljs-keyword">const</span> graph = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeightedDigraphArray</span>(<span class="hljs-number">3</span>);
graph.<span class="hljs-title function_">addEdge</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
graph.<span class="hljs-title function_">addEdge</span>(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>);
graph.<span class="hljs-title function_">addEdge</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);
<span class="hljs-title function_">dfsTraverseNodes</span>(graph, <span class="hljs-number">0</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(graph.<span class="hljs-property">nodeCount</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-literal">false</span>));
</code></pre>
<h5 data-id="heading-26">场景2：遍历所有路径（onPath数组）</h5>
<p><code>onPath</code> 标记当前路径上的节点，后序位置撤销标记（回溯），用于寻找所有路径：</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-comment">/**
 * DFS遍历所有路径（从src到dest）
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">WeightedDigraphArray</span>} <span class="hljs-variable">graph</span> - 图实例
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} <span class="hljs-variable">src</span> - 起点
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} <span class="hljs-variable">dest</span> - 终点
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">boolean[]</span>} <span class="hljs-variable">onPath</span> - 当前路径标记
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number[]</span>} <span class="hljs-variable">path</span> - 当前路径
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number[][]</span>} <span class="hljs-variable">res</span> - 所有路径结果
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">dfsTraversePaths</span>(<span class="hljs-params">graph, src, dest, onPath, path, res</span>) {
    <span class="hljs-keyword">if</span> (src &lt; <span class="hljs-number">0</span> || src &gt;= graph.<span class="hljs-property">nodeCount</span> || onPath[src]) <span class="hljs-keyword">return</span>;
    <span class="hljs-comment">// 前序位置：加入当前路径</span>
    onPath[src] = <span class="hljs-literal">true</span>;
    path.<span class="hljs-title function_">push</span>(src);
    <span class="hljs-comment">// 到达终点：记录路径</span>
    <span class="hljs-keyword">if</span> (src === dest) {
        res.<span class="hljs-title function_">push</span>([...path]); <span class="hljs-comment">// 拷贝路径，避免后续修改</span>
        path.<span class="hljs-title function_">pop</span>();
        onPath[src] = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-comment">// 递归遍历邻居</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> edge <span class="hljs-keyword">of</span> graph.<span class="hljs-title function_">getNeighbors</span>(src)) {
        <span class="hljs-title function_">dfsTraversePaths</span>(graph, edge.<span class="hljs-property">to</span>, dest, onPath, path, res);
    }
    <span class="hljs-comment">// 后序位置：回溯（移出当前路径）</span>
    path.<span class="hljs-title function_">pop</span>();
    onPath[src] = <span class="hljs-literal">false</span>;
}

<span class="hljs-comment">// 调用示例</span>
<span class="hljs-keyword">const</span> res = [];
<span class="hljs-title function_">dfsTraversePaths</span>(graph, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(graph.<span class="hljs-property">nodeCount</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-literal">false</span>), [], res);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'所有从0到2的路径：'</span>, res); <span class="hljs-comment">// [[0,1,2], [0,2]]</span>
</code></pre>
<h5 data-id="heading-27">场景3：有向无环图（DAG）遍历</h5>
<p>若图无环，可省略 <code>visited</code>/<code>onPath</code>，直接遍历（如寻找所有从0到终点的路径）：</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-keyword">var</span> allPathsSourceTarget = <span class="hljs-keyword">function</span>(<span class="hljs-params">graph</span>) {
    <span class="hljs-keyword">const</span> res = [];
    <span class="hljs-keyword">const</span> path = [];
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">traverse</span> = (<span class="hljs-params">s</span>) =&gt; {
        path.<span class="hljs-title function_">push</span>(s);
        <span class="hljs-keyword">if</span> (s === graph.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>) {
            res.<span class="hljs-title function_">push</span>([...path]);
            path.<span class="hljs-title function_">pop</span>();
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> v <span class="hljs-keyword">of</span> graph[s]) <span class="hljs-title function_">traverse</span>(v);
        path.<span class="hljs-title function_">pop</span>();
    };
    <span class="hljs-title function_">traverse</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> res;
};
</code></pre>
<h4 data-id="heading-28">4.2 广度优先搜索（BFS）</h4>
<h5 data-id="heading-29">核心思想</h5>
<p>从起点出发，逐层遍历所有节点，天然适合寻找「最短路径」（第一次到达终点的路径即为最短）。</p>
<h5 data-id="heading-30">基础版：记录遍历步数</h5>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-comment">/**
 * BFS遍历（记录步数）
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">WeightedDigraphArray</span>} <span class="hljs-variable">graph</span> - 图实例
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} <span class="hljs-variable">s</span> - 起点
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">bfsTraverse</span>(<span class="hljs-params">graph, s</span>) {
    <span class="hljs-keyword">const</span> nodeCount = graph.<span class="hljs-property">nodeCount</span>;
    <span class="hljs-keyword">const</span> visited = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(nodeCount).<span class="hljs-title function_">fill</span>(<span class="hljs-literal">false</span>);
    <span class="hljs-keyword">const</span> q = [s];
    visited[s] = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">let</span> step = -<span class="hljs-number">1</span>; <span class="hljs-comment">// 初始-1，进入循环后++为0（起点步数）</span>

    <span class="hljs-keyword">while</span> (q.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
        step++;
        <span class="hljs-keyword">const</span> sz = q.<span class="hljs-property">length</span>;
        <span class="hljs-comment">// 遍历当前层所有节点</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; sz; i++) {
            <span class="hljs-keyword">const</span> cur = q.<span class="hljs-title function_">shift</span>();
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`访问节点 <span class="hljs-subst">${cur}</span>，步数 <span class="hljs-subst">${step}</span>`</span>);
            <span class="hljs-comment">// 加入所有未访问的邻居</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> edge <span class="hljs-keyword">of</span> graph.<span class="hljs-title function_">getNeighbors</span>(cur)) {
                <span class="hljs-keyword">if</span> (!visited[edge.<span class="hljs-property">to</span>]) {
                    q.<span class="hljs-title function_">push</span>(edge.<span class="hljs-property">to</span>);
                    visited[edge.<span class="hljs-property">to</span>] = <span class="hljs-literal">true</span>;
                }
            }
        }
    }
}
</code></pre>
<h5 data-id="heading-31">进阶版：State类适配复杂场景</h5>
<p>通过State类封装节点和步数，适配不同权重、不同遍历目标的场景：</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-comment">// 封装节点状态</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">State</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">node, step</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">node</span> = node;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">step</span> = step;
    }
}

<span class="hljs-comment">/**
 * BFS遍历（State版）
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">WeightedDigraphArray</span>} <span class="hljs-variable">graph</span> - 图实例
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} <span class="hljs-variable">s</span> - 起点
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">bfsTraverseState</span>(<span class="hljs-params">graph, s</span>) {
    <span class="hljs-keyword">const</span> nodeCount = graph.<span class="hljs-property">nodeCount</span>;
    <span class="hljs-keyword">const</span> visited = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(nodeCount).<span class="hljs-title function_">fill</span>(<span class="hljs-literal">false</span>);
    <span class="hljs-keyword">const</span> q = [<span class="hljs-keyword">new</span> <span class="hljs-title class_">State</span>(s, <span class="hljs-number">0</span>)];
    visited[s] = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">while</span> (q.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">const</span> state = q.<span class="hljs-title function_">shift</span>();
        <span class="hljs-keyword">const</span> cur = state.<span class="hljs-property">node</span>;
        <span class="hljs-keyword">const</span> step = state.<span class="hljs-property">step</span>;
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`访问节点 <span class="hljs-subst">${cur}</span>，步数 <span class="hljs-subst">${step}</span>`</span>);

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> edge <span class="hljs-keyword">of</span> graph.<span class="hljs-title function_">getNeighbors</span>(cur)) {
            <span class="hljs-keyword">if</span> (!visited[edge.<span class="hljs-property">to</span>]) {
                q.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">State</span>(edge.<span class="hljs-property">to</span>, step + <span class="hljs-number">1</span>));
                visited[edge.<span class="hljs-property">to</span>] = <span class="hljs-literal">true</span>;
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-32">4.3 遍历算法总结</h4>


























<table><thead><tr><th>算法</th><th>核心数据结构</th><th>核心标记</th><th>适用场景</th><th>时间复杂度</th></tr></thead><tbody><tr><td>DFS</td><td>递归栈</td><td>visited（遍历节点）/onPath（遍历路径）</td><td>遍历所有节点、所有路径</td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>V</mi><mo>+</mo><mi>E</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(V+E)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mclose">)</span></span></span></span></span></td></tr><tr><td>BFS</td><td>队列</td><td>visited</td><td>寻找最短路径、逐层遍历</td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>V</mi><mo>+</mo><mi>E</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(V+E)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mclose">)</span></span></span></span></span></td></tr></tbody></table>
<h3 data-id="heading-33">五、总结</h3>
<p>图结构的核心是「节点+边」的关系抽象，掌握以下关键点即可应对绝大多数场景：</p>
<ol>
<li>
<p><strong>存储选择</strong>：稀疏图用邻接表（省空间），稠密图用邻接矩阵（查边快）；</p>
</li>
<li>
<p><strong>遍历逻辑</strong>：DFS适合遍历所有路径，BFS适合找最短路径，均需标记已访问节点避免环；</p>
</li>
<li>
<p><strong>扩展适配</strong>：无向图=双向有向图，无权图=权重为1的加权图，可复用通用图类；</p>
</li>
<li>
<p><strong>核心思想</strong>：图是树的延伸，遍历的本质是「穷举+剪枝」（标记已访问避免死循环）。</p>
</li>
</ol>
<p>从基础的遍历到进阶的最短路径（Dijkstra）、最小生成树（Kruskal/Prim）、拓扑排序，图论算法的核心都是「基于遍历的优化」，掌握本文的基础内容，后续学习进阶算法会事半功倍。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[别再等Sora了，字节Seedance 2.0才是AI视频的“导演时刻”]]></title>    <link>https://juejin.cn/post/7604345576177860646</link>    <guid>https://juejin.cn/post/7604345576177860646</guid>    <pubDate>2026-02-09T12:31:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604345576177860646" data-draft-id="7604690250363273225" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="别再等Sora了，字节Seedance 2.0才是AI视频的“导演时刻”"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-02-09T12:31:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            别再等Sora了，字节Seedance 2.0才是AI视频的“导演时刻”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T12:31:26.000Z" title="Mon Feb 09 2026 12:31:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>如果说2024年是AI视频的“开眼看世界”，那么2026年开春，字节跳动刚刚发布的 <strong>Seedance 2.0</strong>，可能真的要把摄影机和剪辑软件送进博物馆了。</p>
<p>这两天科技圈最炸裂的消息，莫过于字节旗下的“即梦”平台正式上线了这款新模型。在实测了一整天后，我得出一个结论：这不仅仅是画质的提升，而是AI终于听懂了什么叫“叙事”。</p>
<p>以前我们玩AI视频，像是在买彩票，“抽卡”全看运气；而Seedance 2.0给我的感觉，是我终于坐上了导演椅。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2FiShot_2026-02-09_20.18.14-1024x487.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/iShot_2026-02-09_20.18.14-1024x487.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5619678d2e3449f6a1d0960bd338fa33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771245086&amp;x-signature=%2B0hfKFuYcFa36eF9PERK9dpJHNA%3D" alt="iShot_2026-02-09_20.18.14" loading="lazy"/></a></p>
<h3 data-id="heading-0">不止是生成，而是“精准复刻”</h3>
<p>市面上大多数模型（包括Sora和可灵）的核心逻辑还是“脑补”。你给一段文字，它还你一段视频，但细节往往不可控。</p>
<p>Seedance 2.0最狠的一招叫做 <strong>“多模态参考”</strong>。</p>
<p>这东西有多夸张？它允许你一次性甩给它 <strong>12个参考文件</strong>。你可以上传9张图片定角色和画风，3段视频定运镜和动态，再加3段音频定节奏。</p>
<p>想象一下这个场景：你有一张自己设计的动漫角色图，又找了一段真人舞蹈的视频。在过去，让二次元角色跳出真人的舞步需要复杂的动作捕捉和渲染。现在？你在提示词里“@”一下图片和视频，Seedance 2.0就能直接把真人的动作“移植”到动漫角色身上，连裙摆的物理飘动都符合重力逻辑。</p>
<p>这不是“生成”，这是工业级的“复刻”。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2FiShot_2026-02-09_20.22.23-1024x261.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/iShot_2026-02-09_20.22.23-1024x261.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/230e7929d3e64f2db1772f2696a3342b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771245086&amp;x-signature=9R80uMg5DcmR7Ie%2Fgz3ARd1GS9Y%3D" alt="iShot_2026-02-09_20.22.23" loading="lazy"/></a></p>
<h3 data-id="heading-1">真正解决“声画游离”的顽疾</h3>
<p>玩过AI视频的朋友都知道，最让人出戏的往往不是画面，而是声音。以前的流程是先生成无声视频，再找AI配音，最后手动对口型，结果往往是“嘴动嘴的，声发声的”，塑料感极强。</p>
<p>Seedance 2.0底层架构换成了 <strong>双分支扩散变换器 (Dual-branch DiT)</strong>。别被技术名词吓到，简单说就是它有“两只手”，一只手画画，一只手谱曲，而且是同时进行。</p>
<p>这就实现了真正的 <strong>原生音画同步</strong>。我在测试中输入了一段对话音频，生成的人物口型竟然能做到毫秒级匹配，就连背景里的风声、脚步声都能卡在正确的画面节奏上。那种“AI配音感”大幅削弱，临场感瞬间拉满。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2FiShot_2026-02-09_20.22.45-1024x510.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/iShot_2026-02-09_20.22.45-1024x510.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3fbb8c81bcf47848d6e1f88b1556948~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771245086&amp;x-signature=Yt8tenJGVL6pcHoZ%2BWyiggOaDdk%3D" alt="iShot_2026-02-09_20.22.45" loading="lazy"/></a></p>
<h3 data-id="heading-2">告别“PPT转场”，这才是电影感</h3>
<p>很多AI视频模型只能生成单镜头，一旦涉及多镜头切换，角色长相就变了（俗称“脸崩”），场景也接不上。</p>
<p>Seedance 2.0显然是冲着影视制作去的。它能理解什么叫“全景接中景再接特写”。你只需要描述情节，它会自动拆解分镜。</p>
<p>最让我惊讶的是它的 <strong>一致性控制</strong>。在一段长达15秒的视频里，无论镜头怎么推拉摇移，角色的衣服纹理、面部特征甚至光影逻辑都保持得非常稳定。对于做短剧、做广告的人来说，这意味着以前需要几周、几十人团队磨出来的片子，现在可能只需要一个人、一下午、几块钱的算力成本。</p>
<h3 data-id="heading-3">还有局限吗？当然有</h3>
<p>吹了这么多，咱们也得客观看看它的短板。</p>
<p>虽然官方宣称生成速度提升了10倍，但在生成高质量、多参考文件的2K视频时，等待时间依然不算短，而且积分消耗确实肉疼。另外，虽然它在大的物理规律上表现出色，但在处理画面中细小的文字或极端复杂的动态元素时，偶尔还是会翻车。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2FiShot_2026-02-09_20.22.53-1024x478.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/iShot_2026-02-09_20.22.53-1024x478.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/004033502d3c4741a96788b5866498ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771245086&amp;x-signature=o7BAqJtYSI93s23AiRAXfzIqXpQ%3D" alt="iShot_2026-02-09_20.22.53" loading="lazy"/></a></p>
<p>当然，如果你想用它复活某个不可描述的知名人物，劝你趁早打消念头，字节的审核机制依然严得像铁桶一样。</p>
<h3 data-id="heading-4">写在最后</h3>
<p>如果要用一句话总结Seedance 2.0，我会说：<strong>它把AI视频从“技术炫技”拉回了“内容创作”</strong>。</p>
<p>以前我们比拼的是谁的模型生成的浪花更真实，现在竞争的维度变了——当制作门槛被无限拉低，短剧的制作成本从几千块降到几块钱时，真正值钱的不再是你会不会剪辑，而是你脑子里有没有那个绝妙的故事。</p>
<p>Sora还在模拟物理世界，可灵在死磕运动控制，而Seedance 2.0已经把导筒递到了你手里。</p>
<p>如果你是创作者，现在也许是入局的最好时刻；如果你是传统影视后期，嗯……或许该去看看“即梦”的说明书了。</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 应用工程化实战：使用 LangChain.js 编排 DeepSeek 复杂工作流]]></title>    <link>https://juejin.cn/post/7604574877034643499</link>    <guid>https://juejin.cn/post/7604574877034643499</guid>    <pubDate>2026-02-09T12:31:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604574877034643499" data-draft-id="7604485275373125695" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 应用工程化实战：使用 LangChain.js 编排 DeepSeek 复杂工作流"/> <meta itemprop="keywords" content="前端,LangChain,JavaScript"/> <meta itemprop="datePublished" content="2026-02-09T12:31:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NEXT06"/> <meta itemprop="url" content="https://juejin.cn/user/1176918763246011"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 应用工程化实战：使用 LangChain.js 编排 DeepSeek 复杂工作流
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1176918763246011/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NEXT06
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T12:31:47.000Z" title="Mon Feb 09 2026 12:31:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 2024 年至 2025 年的技术浪潮中，大语言模型（LLM）的应用开发已经从“尝鲜”阶段迈向了“工程化”阶段。对于开发者而言，仅仅调用 fetch 接口获取模型回复是远远不够的。在构建复杂的生产级应用时，我们面临着提示词管理混乱、模型切换成本高、上下文处理复杂以及任务编排困难等诸多痛点。</p>
<p>LangChain 的出现，正是为了解决这些工程化难题。它不是一个模型，而是一个框架，旨在将 LLM 的能力封装成可维护、可复用的组件。</p>
<p>本文将通过四个循序渐进的代码示例，演示如何利用 LangChain.js 结合当下热门的 DeepSeek（深度求索）模型，完成从基础调用到复杂工作流编排的进阶之路。</p>
<h2 data-id="heading-0">第一阶段：标准化的开始——适配器模式的应用</h2>
<p>在没有任何框架之前，调用 LLM 通常意味着处理各种非标准化的 HTTP 请求。OpenAI、DeepSeek、Claude 的 API 格式各不相同。LangChain 的第一个核心价值在于<strong>标准化</strong>。</p>
<p>以下是基于 main.js 的基础调用示例：</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'dotenv/config'</span>; <span class="hljs-comment">// 加载环境变量</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatDeepSeek</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@langchain/deepseek'</span>;

<span class="hljs-comment">// 1. 实例化模型</span>
<span class="hljs-keyword">const</span> model = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatDeepSeek</span>({
    <span class="hljs-attr">model</span>: <span class="hljs-string">'deepseek-reasoner'</span>, <span class="hljs-comment">// 使用 DeepSeek 的推理模型</span>
    <span class="hljs-attr">temperature</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 设定温度，0 代表最确定性的输出</span>
    <span class="hljs-comment">// apiKey 自动从 process.env.DEEPSEEK_API_KEY 读取</span>
});

<span class="hljs-comment">// 2. 执行调用</span>
<span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> model.<span class="hljs-title function_">invoke</span>(<span class="hljs-string">'用一句话解释什么是RAG?'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res.<span class="hljs-property">content</span>);
</code></pre>
<h3 data-id="heading-1">深度解析：适配器模式 (Adapter Pattern)</h3>
<p>这段代码看似简单，却蕴含了 AI 工程化的第一块基石：<strong>适配器模式</strong>。</p>
<p>在软件工程中，适配器模式用于屏蔽底层接口的差异。ChatDeepSeek 类就是一个适配器（Provider）。</p>
<ul>
<li><strong>统一接口</strong>：无论底层使用的是 DeepSeek、OpenAI 还是 Google Gemini，在 LangChain 中我们都统一调用 .invoke() 方法，invoke(英文：调用)。</li>
<li><strong>配置解耦</strong>：开发者无需关心 baseURL 配置、鉴权头部的拼接或请求体格式。</li>
<li><strong>参数控制</strong>：temperature: 0 是一个关键参数。在开发代码生成或逻辑推理（如使用 deepseek-reasoner）应用时，我们将温度设为 0 以减少随机性；而在创意写作场景，通常设为 0.7 或更高，这是决定你的大模型输出的内容严谨还是天马行空的关键因素之一。</li>
</ul>
<p>通过这种方式，我们实现了业务逻辑与模型实现的解耦。如果未来需要更换模型，只需修改实例化部分，业务代码无需变动。</p>
<h2 data-id="heading-2">第二阶段：提示词工程化——数据与逻辑分离</h2>
<p>直接在 .invoke() 中传入字符串（Hardcoding）在 Demo 阶段可行，但在实际项目中是反模式。因为提示词（Prompt）往往包含静态的指令和动态的用户输入。</p>
<p>下面这段代码展示了如何使用 PromptTemplate（对prompt设计一个模板，只需要提供关键的参数） 进行管理：</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1.js</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PromptTemplate</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@langchain/core/prompts'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatDeepSeek</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@langchain/deepseek'</span>;

<span class="hljs-comment">// 1. 定义模板：静态结构与动态变量分离</span>
<span class="hljs-keyword">const</span> prompt = <span class="hljs-title class_">PromptTemplate</span>.<span class="hljs-title function_">fromTemplate</span>(<span class="hljs-string">`
你是一个{role}。
请用不超过{limit}字回答以下问题：
{question}
`</span>);

<span class="hljs-comment">// 2. 格式化：注入数据</span>
<span class="hljs-keyword">const</span> promptStr = <span class="hljs-keyword">await</span> prompt.<span class="hljs-title function_">format</span>({
    <span class="hljs-attr">role</span>: <span class="hljs-string">'前端面试官'</span>,
    <span class="hljs-attr">limit</span>: <span class="hljs-string">'50'</span>,
    <span class="hljs-attr">question</span>: <span class="hljs-string">'什么是闭包'</span>
});

<span class="hljs-comment">// 3. 调用模型</span>
<span class="hljs-keyword">const</span> model = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatDeepSeek</span>({
    <span class="hljs-attr">model</span>: <span class="hljs-string">'deepseek-reasoner'</span>,
    <span class="hljs-attr">temperature</span>: <span class="hljs-number">0.7</span>
});

<span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> model.<span class="hljs-title function_">invoke</span>(promptStr);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res.<span class="hljs-property">content</span>);
</code></pre>
<h3 data-id="heading-3">深度解析：提示词模板的意义</h3>
<p>这里体现了关注点分离（Separation of Concerns）的设计原则。</p>
<ol>
<li><strong>复用性</strong>：同一个 prompt 对象可以生成“前端面试官”、“后端面试官”甚至“测试工程师”的问答场景，只需改变 format 的入参。</li>
<li><strong>维护性</strong>：当需要优化 Prompt（例如增加“请使用中文回答”的系统指令）时，只需修改模板定义，而不用在代码库的各个角落查找字符串拼接逻辑。</li>
<li><strong>类型安全</strong>：虽然 JavaScript 是弱类型，但在 LangChain 的 TypeScript 定义中，模板的输入变量（Variables）是可以被静态分析和校验的。</li>
</ol>
<p>然而，上述代码仍显得有些“命令式”：我们需要手动格式化，拿到字符串，再手动传给模型。这依然是两步操作。</p>
<h2 data-id="heading-4">第三阶段：链式流转——LCEL 与声明式编程</h2>
<p>LangChain 的核心精髓在于 <strong>Chain（链）</strong> 。通过 LangChain 表达式语言（LCEL），我们可以通过管道（Pipe）将组件连接起来，形成自动化的工作流。</p>
<p>下面的这段代码展示了这一范式转变：</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 2.js</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatDeepSeek</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@langchain/deepseek'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PromptTemplate</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@langchain/core/prompts'</span>;

<span class="hljs-keyword">const</span> model = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatDeepSeek</span>({
    <span class="hljs-attr">model</span>: <span class="hljs-string">'deepseek-reasoner'</span>,
    <span class="hljs-attr">temperature</span>: <span class="hljs-number">0.7</span>
});

<span class="hljs-keyword">const</span> prompt = <span class="hljs-title class_">PromptTemplate</span>.<span class="hljs-title function_">fromTemplate</span>(<span class="hljs-string">`
  你是一个前端专家，用一句话解释: {topic}  
`</span>);

<span class="hljs-comment">// 核心变化：构建 Chain</span>
<span class="hljs-comment">// prompt (模板节点) -&gt; model (LLM 节点)</span>
<span class="hljs-keyword">const</span> chain = prompt.<span class="hljs-title function_">pipe</span>(model);

<span class="hljs-comment">// 执行 Chain</span>
<span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> chain.<span class="hljs-title function_">invoke</span>({
    <span class="hljs-attr">topic</span>: <span class="hljs-string">'闭包'</span>
});
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(response.<span class="hljs-property">content</span>);
</code></pre>
<h3 data-id="heading-5">深度解析：LCEL 与声明式编程</h3>
<p>这段代码引入了 .pipe() 方法，它深受 Unix 管道思想的影响。</p>
<ol>
<li><strong>声明式编程 (Declarative)</strong> ：<br/>
我们不再编写“如何做”（先格式化，再调用），而是定义“是什么”（链条是 Prompt 流向 Model）。LangChain 运行时会自动处理数据的传递。</li>
<li><strong>Runnable 接口</strong>：<br/>
在 LangChain 中，Prompt、Model、OutputParser 甚至整个 Chain 都实现了 Runnable 接口。这意味着它们具有统一的调用方式（invoke, stream, batch）。</li>
<li><strong>自动化数据流</strong>：<br/>
当我们调用 chain.invoke({ topic: '闭包' }) 时，对象 { topic: '闭包' } 首先进入 Prompt，Prompt 将其转化为完整的提示词字符串，然后该字符串自动流入 Model，最终输出结果。</li>
</ol>
<p>这是构建 Agent（智能体）的基础单元。</p>
<h2 data-id="heading-6">第四阶段：编排复杂工作流——任务拆解与序列化</h2>
<p>在真实业务中，单一的 Prompt 往往难以完美解决复杂问题。例如，我们希望 AI 既能“详细解释原理”，又能“精简总结要点”。如果试图在一个 Prompt 中完成，模型往往会顾此失彼。</p>
<p>更好的工程化思路是<strong>任务拆解</strong>。下面的这段代码展示了如何使用 RunnableSequence 串联多个任务：</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 3.js</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatDeepSeek</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@langchain/deepseek'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PromptTemplate</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@langchain/core/prompts'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">RunnableSequence</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@langchain/core/runnables'</span>;

<span class="hljs-keyword">const</span> model = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatDeepSeek</span>({
    <span class="hljs-attr">model</span>: <span class="hljs-string">'deepseek-reasoner'</span>,
    <span class="hljs-attr">temperature</span>: <span class="hljs-number">0.7</span>
});

<span class="hljs-comment">// 任务 A：详细解释</span>
<span class="hljs-keyword">const</span> explainPrompt = <span class="hljs-title class_">PromptTemplate</span>.<span class="hljs-title function_">fromTemplate</span>(<span class="hljs-string">`
    你是一个前端专家，请详细介绍以下概念: {topic}
    要求：覆盖定义、原理、使用方式，不超过300字。
`</span>);

<span class="hljs-comment">// 任务 B：总结核心点</span>
<span class="hljs-keyword">const</span> summaryPrompt = <span class="hljs-title class_">PromptTemplate</span>.<span class="hljs-title function_">fromTemplate</span>(<span class="hljs-string">`
    请将以下前端概念总结为3个核心要点 (每点不超过20字):
    {explanation}
`</span>);

<span class="hljs-comment">// 创建两个独立的子链</span>
<span class="hljs-keyword">const</span> explainChain = explainPrompt.<span class="hljs-title function_">pipe</span>(model);
<span class="hljs-keyword">const</span> summaryChain = summaryPrompt.<span class="hljs-title function_">pipe</span>(model);

<span class="hljs-comment">// 核心逻辑：编排序列</span>
<span class="hljs-keyword">const</span> fullChain = <span class="hljs-title class_">RunnableSequence</span>.<span class="hljs-title function_">from</span>([
    <span class="hljs-comment">// 第一步：输入 topic -&gt; 获取详细解释 text</span>
    <span class="hljs-function">(<span class="hljs-params">input</span>) =&gt;</span> explainChain.<span class="hljs-title function_">invoke</span>({ <span class="hljs-attr">topic</span>: input.<span class="hljs-property">topic</span> }).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-property">content</span>),
    
    <span class="hljs-comment">// 第二步：接收 explanation -&gt; 生成总结 -&gt; 组合最终结果</span>
    <span class="hljs-function">(<span class="hljs-params">explanation</span>) =&gt;</span> summaryChain.<span class="hljs-title function_">invoke</span>({ explanation }).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> 
        <span class="hljs-string">`知识点详情:\n<span class="hljs-subst">${explanation}</span>\n\n精简总结:\n<span class="hljs-subst">${res.content}</span>`</span>
    )
]);

<span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> fullChain.<span class="hljs-title function_">invoke</span>({
    <span class="hljs-attr">topic</span>: <span class="hljs-string">'闭包'</span>
});
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(response);
</code></pre>
<h3 data-id="heading-7">深度解析：序列化工作流</h3>
<p>这是一个典型的 <strong>Sequential Chain（顺序链）</strong>  模式。</p>
<ol>
<li><strong>输入/输出对齐</strong>：<br/>
第一步的输出（详细解释）通过函数传递，直接成为了第二步的输入变量 { explanation }。这种数据流的自动衔接是复杂 AI 应用的关键。</li>
<li><strong>DeepSeek Reasoner 的优势</strong>：<br/>
在这个场景中，我们使用了 deepseek-reasoner。对于解释原理和归纳总结这类需要逻辑分析（Reasoning）的任务，DeepSeek 的 R1 系列模型表现优异。通过拆解任务，我们让模型在每个步骤都专注于单一目标，从而大幅提升了输出质量。</li>
<li><strong>可观测性与调试</strong>：<br/>
将长任务拆分为短链，使得我们在调试时可以单独检查 explainChain 的输出是否准确，而不必在一个巨大的黑盒 Prompt 中盲目尝试。</li>
</ol>
<h2 data-id="heading-8">总结</h2>
<p>到此为止我们见证了 AI 代码从“脚本”到“工程”的进化：</p>
<ol>
<li><strong>适配器模式</strong>：解决了模型接口碎片化问题。</li>
<li><strong>提示词模板</strong>：实现了数据与逻辑的分离。</li>
<li><strong>LCEL 管道</strong>：将原子能力组装成自动化流程。</li>
<li><strong>序列化编排</strong>：通过任务拆解解决复杂业务逻辑。</li>
<li>**要想拿到大模型输出的结果，别忘了配置APIKEY和环境变量</li>
</ol>
<p>LangChain.js 结合 DeepSeek，不仅仅是调用了一个 API，更是为您提供了一套构建可扩展、可维护 AI 系统的脚手架。作为前端开发者，掌握这种“搭积木”的思维方式，是在 AI 时代保持竞争力的关键。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端性能优化：图片懒加载的三种手写方案]]></title>    <link>https://juejin.cn/post/7604345576177893414</link>    <guid>https://juejin.cn/post/7604345576177893414</guid>    <pubDate>2026-02-09T13:01:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604345576177893414" data-draft-id="7604709514130456622" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端性能优化：图片懒加载的三种手写方案"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2026-02-09T13:01:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="发现一只大呆瓜"/> <meta itemprop="url" content="https://juejin.cn/user/180747382561607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端性能优化：图片懒加载的三种手写方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180747382561607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    发现一只大呆瓜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T13:01:11.000Z" title="Mon Feb 09 2026 13:01:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>在电商、社交等图片密集型应用中，一次性加载所有图片会导致首屏白屏时间（FP）过长，消耗用户大量流量。<strong>图片懒加载</strong>的核心思想就是： <strong>“按需加载”</strong> ——只有当图片进入或即将进入可视区域时，才真正发起网络请求。</p>
<h2 data-id="heading-1">一、 核心原理</h2>
<ol>
<li><strong>占位图</strong>：初始化时，图片的 <code>src</code> 属性指向一张极小的 base64 图片或 loading 占位图。</li>
<li><strong>存储地址</strong>：将真实的图片 URL 存放在自定义属性中（如 <code>data-src</code>）。</li>
<li><strong>触发判断</strong>：通过 JS 监听位置变化，当图片进入可视区，将 <code>data-src</code> 的值赋给 <code>src</code>。</li>
</ol>
<hr/>
<h2 data-id="heading-2">二、 方案对比与实现</h2>
<h3 data-id="heading-3">方案 1：传统滚动监听（Scroll + OffsetTop）</h3>
<p>这是最基础的方案，通过计算绝对位置来判断。</p>
<p><strong>公式：</strong> <code>window.innerHeight</code> (可视窗口高) + <code>document.documentElement.scrollTop</code> (滚动条高度) &gt; <code>element.offsetTop</code> (元素距离页面顶部高度)</p>
<p><strong>代码实现：</strong></p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">lazyLoad</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> images = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'img[data-src]'</span>);
  <span class="hljs-keyword">const</span> clientHeight = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>;
  <span class="hljs-keyword">const</span> scrollTop = <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">scrollTop</span> || <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">scrollTop</span>;

  images.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">img</span> =&gt;</span> {
    <span class="hljs-comment">// 判断是否进入可视区</span>
    <span class="hljs-keyword">if</span> (clientHeight + scrollTop &gt; img.<span class="hljs-property">offsetTop</span>) {
      img.<span class="hljs-property">src</span> = img.<span class="hljs-property">dataset</span>.<span class="hljs-property">src</span>;
      img.<span class="hljs-title function_">removeAttribute</span>(<span class="hljs-string">'data-src'</span>); <span class="hljs-comment">// 加载后移除属性，防止重复执行</span>
    }
  });
}

<span class="hljs-comment">// 注意：必须添加节流（Throttle），防止滚动时高频触发导致卡顿</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, <span class="hljs-title function_">throttle</span>(lazyLoad, <span class="hljs-number">200</span>));
</code></pre>
<hr/>
<h3 data-id="heading-4">方案 2：现代位置属性（getBoundingClientRect）</h3>
<p>此方法通过<code>getBoundingClientRect</code>获取元素相对于<strong>浏览器视口</strong>的位置来判断，逻辑更简洁。</p>
<p><strong>判断条件：</strong> <code>rect.top</code>（元素顶部距离视口顶部的距离） &lt; <code>window.innerHeight</code>。</p>
<p><strong>代码实现：</strong></p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleScroll</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> img = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'target-img'</span>);
  <span class="hljs-keyword">const</span> rect = img.<span class="hljs-title function_">getBoundingClientRect</span>();
  <span class="hljs-keyword">const</span> viewHeight = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> || <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">clientHeight</span>;

  <span class="hljs-comment">// 元素顶部出现在视口内，且没有超出视口底部</span>
  <span class="hljs-keyword">if</span> (rect.<span class="hljs-property">top</span> &gt;= <span class="hljs-number">0</span> &amp;&amp; rect.<span class="hljs-property">top</span> &lt; viewHeight) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'图片进入可视区，开始加载'</span>);
    img.<span class="hljs-property">src</span> = img.<span class="hljs-property">dataset</span>.<span class="hljs-property">src</span>;
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'scroll'</span>, handleScroll); <span class="hljs-comment">// 加载后卸载监听</span>
  }
}

<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, handleScroll);
</code></pre>
<hr/>
<h3 data-id="heading-5">方案 3：最优解方案（IntersectionObserver API）</h3>
<p><code>IntersectionObserver</code>这是目前最推荐的方案，它是<strong>异步</strong>的，不会阻塞主线程，且不需要手动计算位置，性能最高。</p>
<p>使用语法：<code>const observer = new IntersectionObserver(callback, options)</code></p>
<ul>
<li><code>callback</code>：是元素可见性发生变化时的回调函数，接收两个参数：
<ul>
<li><code>entries</code>：观察目标的对象数组。对象中存在<code>isIntersecting</code>属性（布尔值），代表目标元素是否与根元素交叉（即进入视口）。</li>
</ul>
</li>
<li><code>options</code>：配置对象（该参数可选）。其中 <code>roo</code>t表示指定一个根元素，默认是浏览器窗口、<code>rootMargin</code>表示控制根元素的外边距、<code>threshold</code> 为目标元素与根元素中的可见比例，可以通过设置值来触发回调函数</li>
</ul>
<p><strong>代码实现：</strong></p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">const</span> observerOptions = {
  <span class="hljs-attr">root</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// 默认为浏览器视口</span>
  <span class="hljs-attr">rootMargin</span>: <span class="hljs-string">'0px 0px 50px 0px'</span>, <span class="hljs-comment">// 提前 50px 触发加载，提升用户体验</span>
  <span class="hljs-attr">threshold</span>: <span class="hljs-number">0.1</span> <span class="hljs-comment">// 交叉比例达到 10% 时触发</span>
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleIntersection</span> = (<span class="hljs-params">entries, observer</span>) =&gt; {
  entries.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">entry</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (entry.<span class="hljs-property">isIntersecting</span>) {
      <span class="hljs-keyword">const</span> img = entry.<span class="hljs-property">target</span>;
      img.<span class="hljs-property">src</span> = img.<span class="hljs-property">dataset</span>.<span class="hljs-property">src</span>;
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'IntersectionObserver 推送：图片加载成功'</span>);
      observer.<span class="hljs-title function_">unobserve</span>(img); <span class="hljs-comment">// 停止观察该元素</span>
    }
  });
};

<span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntersectionObserver</span>(handleIntersection, observerOptions);
<span class="hljs-comment">// 观察页面中所有带 data-src 的图片</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'img[data-src]'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">img</span> =&gt;</span> observer.<span class="hljs-title function_">observe</span>(img));
</code></pre>
<blockquote>
<p>方案 1 和 2 在获取 <code>offsetTop</code> 或 <code>getBoundingClientRect</code> 时会强制浏览器重新计算布局（回流），在长列表场景下可能导致掉帧。<strong>方案 3 不受此影响</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-6">三、总结</h2>





























<table><thead><tr><th><strong>特性</strong></th><th><strong>方案 1 (OffsetTop)</strong></th><th><strong>方案 2 (Rect)</strong></th><th><strong>方案 3 (Intersection)</strong></th></tr></thead><tbody><tr><td><strong>计算复杂度</strong></td><td>较高 (需计算累计高度)</td><td>中等</td><td>极低 (引擎原生实现)</td></tr><tr><td><strong>性能消耗</strong></td><td>高 (频繁触发回流)</td><td>高 (触发回流)</td><td><strong>低 (异步非阻塞)</strong></td></tr><tr><td><strong>兼容性</strong></td><td>极好 (所有浏览器)</td><td>好 (IE9+)</td><td>一般 (现代浏览器, IE 需 Polyfill)</td></tr></tbody></table>
<h2 data-id="heading-7">四、补充</h2>
<ul>
<li>现代浏览器（Chrome 76+）已原生支持 <code>&lt;img loading="lazy"&gt;</code>，如果是简单场景，一行 HTML 属性即可搞定。</li>
<li>务必给图片设置固定的<strong>宽高比</strong>或底色占位。否则图片加载前高度为 0，加载瞬间高度撑开会引发剧烈的页面抖动。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI流式交互：SSE与WebSocket技术选型]]></title>    <link>https://juejin.cn/post/7604471065860571187</link>    <guid>https://juejin.cn/post/7604471065860571187</guid>    <pubDate>2026-02-09T11:11:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604471065860571187" data-draft-id="7604409112593481738" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI流式交互：SSE与WebSocket技术选型"/> <meta itemprop="keywords" content="前端,面试,JavaScript"/> <meta itemprop="datePublished" content="2026-02-09T11:11:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="发现一只大呆瓜"/> <meta itemprop="url" content="https://juejin.cn/user/180747382561607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI流式交互：SSE与WebSocket技术选型
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180747382561607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    发现一只大呆瓜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T11:11:18.000Z" title="Mon Feb 09 2026 11:11:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>在开发 AI 对话产品（如 ChatGPT、豆包）时，如何实现那种“一个字一个字蹦出来”的流畅打字机效果？<strong>SSE（Server-Sent Events）</strong> 凭借其轻量级、基于 HTTP 的特性，成为了目前流式输出的主流方案。本文将从基础概念到企业级实战，带你彻底掌握 SSE。</p>
<h2 data-id="heading-1">一、 核心概念：什么是 SSE？</h2>
<p><strong>SSE (Server-Sent Events)</strong> 是一种基于 HTTP 协议的服务端推送技术。它利用 HTTP 的长连接特性，在客户端与服务器之间建立一条持久化通道，服务器通过这条通道实现数据的实时单向推送。一个基于SSE的聊天返回接口如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/085cc3be1dee4c1abf6e406a2025134d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771240277&amp;x-signature=tz%2BmpXGBxusecCO%2Btt8Zh4pGvHI%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">1. 核心特点</h3>
<ul>
<li><strong>单向通信</strong>：仅支持服务器 → 客户端的数据推送。</li>
<li><strong>数据格式</strong>：原生仅支持文本（默认 UTF-8 编码）。</li>
<li><strong>自动重连</strong>：浏览器原生支持断线自动重连。</li>
<li><strong>传统限制</strong>：原生 <code>EventSource</code> 仅支持 <strong>GET</strong> 方法，无法满足 AI 场景中复杂的 POST 参数需求。</li>
</ul>
<hr/>
<h2 data-id="heading-3">二、 基础用法：原生 EventSource</h2>
<p>EventSource为浏览器提供的原生接口，适用于简单的单向推送场景。具体使用如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// 1. 创建实例连接接口</span>
const eventSource = new EventSource('http<span class="hljs-punctuation">:</span><span class="hljs-comment">//localhost:3000/sse');</span>

<span class="hljs-comment">// 2. 监听消息</span>
eventSource.onmessage = (event) =&gt; <span class="hljs-punctuation">{</span>
  console.log('收到服务器数据：'<span class="hljs-punctuation">,</span> event.data);
<span class="hljs-punctuation">}</span>;

<span class="hljs-comment">// 3. 监听自定义事件 (需与后端约定事件名)</span>
eventSource.addEventListener('custom-event'<span class="hljs-punctuation">,</span> (event) =&gt; <span class="hljs-punctuation">{</span>
  console.log('自定义事件消息：'<span class="hljs-punctuation">,</span> event.data);
<span class="hljs-punctuation">}</span>);

<span class="hljs-comment">// 4. 状态监听</span>
eventSource.onopen = () =&gt; console.log('SSE 连接已建立');
eventSource.onerror = (err) =&gt; console.error('SSE 出错：'<span class="hljs-punctuation">,</span> err);

<span class="hljs-comment">// 5. 主动关闭</span>
<span class="hljs-comment">// eventSource.close();</span>
</code></pre>
<blockquote>
<p>注意事项：原生 <code>EventSource</code> 仅支持 <strong>GET</strong> 方法，咱不能在向后端发送聊天内容时总是将参数拼在地址里面吧</p>
</blockquote>
<hr/>
<h2 data-id="heading-4">三、 企业级实战：突破限制的 Fetch 方案</h2>
<p>在 AI 场景下，用户的问题和上下文通常需要通过 <strong>POST</strong> 传输，此时原生 <code>EventSource</code> 就显得力不从心。推荐使用微软开源的 <code>@microsoft/fetch-event-source</code> 库。</p>
<h3 data-id="heading-5">1. 该方案的优势</h3>
<ul>
<li>支持 <strong>POST</strong> 及其他所有 HTTP 方法。</li>
<li>支持<strong>自定义请求头（Headers）</strong> （方便携带 Token 等鉴权信息）。</li>
<li>更好的错误重试策略和超时配置。</li>
</ul>
<h3 data-id="heading-6">2.代码封装</h3>
<p>以下是我在不同项目中调用流式接口时封装的请求函数：</p>
<pre><code class="hljs language-typeScripyt" lang="typeScripyt">import { fetchEventSource } from '@microsoft/fetch-event-source'
import { ElMessage } from 'element-plus'

let controller //用于中止请求

//请求流式接口数据
export const requestStream = (url, headers, data, handleMessage) =&gt; {
  controller = new AbortController()
  fetchEventSource(url, {
    method: 'POST',
    signal: controller.signal,
    headers: headers,
    body: JSON.stringify(data),
    openWhenHidden: true, // 允许在页面隐藏时继续发送请求
    async onopen(response) {
      //建立连接的回调
      console.log('建立连接的回调')
    },
    //接收一次数据段时回调，因为是流式返回，所以这个回调会被调用多次
    onmessage(msg) {
      handleMessage(msg)
    },
    //正常结束的回调
    onclose() {
      controller.abort() //关闭连接
    },
    //连接出现异常回调
    onerror(err) {
      ElMessage({ message: err, type: 'error' })
      // 必须抛出错误才会停止
      throw err
    },
  })
}

// 停止生成数据
export const stopRequest = () =&gt; {
  if (controller) {
    controller.abort()
    controller = new AbortController()
  }
}

</code></pre>
<blockquote>
<p>注意事项：如果想前端主动停止流式输出的话，可以通过AbortController配置（不过在AI对话场景中不建议这样使用，因为这个方案为前端主动停止接收数据，而后端实际上是无感知的，在查看历史消息时会造成数据不一致！！！建议还是让后端创造一个停止接口</p>
</blockquote>
<h3 data-id="heading-7">3、 关键排坑：Nginx 代理配置</h3>
<p>在实际场景中我们发现前端代码没问题，但输出却是“一大块一大块”地蹦，没有打字机效果。这通常是因为 <strong>Nginx 开启了响应缓冲</strong>。</p>
<p>所以在配置 Nginx 代理时，必须显式关闭 <code>proxy_buffering</code>：</p>
<pre><code class="hljs language-Nginx" lang="Nginx">location ^~/api/v1/chat/ {
      proxy_pass http://backend_server;
      proxy_set_header X-Forwarded-For $remote_addr;
      proxy_read_timeout   3600s; // 防止长连接超时断开
      
      # 核心配置：关闭代理缓冲，实现流式即时传输
      proxy_buffering off; 
      # 开启分块传输编码
      chunked_transfer_encoding on; 
}
</code></pre>
<hr/>
<h2 data-id="heading-8">四、SSE和WebSocket区别</h2>
<p>关于WebSocket的概念与具体使用事项可以看这个文章：<a href="https://juejin.cn/post/7600229327436742706" target="_blank" title="https://juejin.cn/post/7600229327436742706">深度拆解 WebSocket</a></p>






























<table><thead><tr><th><strong>特性</strong></th><th><strong>SSE</strong></th><th><strong>WebSocket</strong></th></tr></thead><tbody><tr><td><strong>通信方向</strong></td><td>单向（Server → Client）</td><td>全双工（双向互发）</td></tr><tr><td><strong>协议基础</strong></td><td>标准 HTTP/1.1</td><td>独立的 WS 协议（需握手升级）</td></tr><tr><td><strong>数据格式</strong></td><td>纯文本/JSON</td><td>二进制或文本</td></tr><tr><td><strong>复杂度</strong></td><td>轻量级，接入成本低</td><td>较重，逻辑复杂</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-9">五、 深度思考：为何 AI 对话多选择 SSE 而非 WebSocket？</h2>
<ol>
<li><strong>功能契合度</strong>：AI 场景中前端只发一次请求（问题），后端持续输出（回答）。双向通信的 WebSocket 属于“功能过剩”。</li>
<li><strong>兼容性与成本</strong>：SSE 基于标准 HTTP 协议，无需协议升级，天然支持流式输出，对 Nginx、网关的穿透性更好。</li>
</ol>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[对 AI Native 架构的一些思考]]></title>    <link>https://juejin.cn/post/7604522883486466082</link>    <guid>https://juejin.cn/post/7604522883486466082</guid>    <pubDate>2026-02-09T11:15:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604522883486466082" data-draft-id="7604395865335808052" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="对 AI Native 架构的一些思考"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-02-09T11:15:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="挖坑的张师傅"/> <meta itemprop="url" content="https://juejin.cn/user/430664257374270"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            对 AI Native 架构的一些思考
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/430664257374270/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    挖坑的张师傅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T11:15:37.000Z" title="Mon Feb 09 2026 11:15:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><em>作者：香菇🍄&amp;张师傅，排名不分先后</em></p>
</blockquote>
<p>当前的大模型计算革命中，市场存在一种普遍现象：绝大多数所谓的 "AI-Native" 应用，本质上仍是传统软件外挂了一个 LLM 对话框。业界的讨论多集中于模型能力边界，而忽视了承载智能的架构形态。</p>
<p>这种错位导致了“伪 AI 应用”的泛滥——交互看似智能，但系统内核依然是硬编码的 If-Else 逻辑，无法自主进化，也缺乏安全边界。对此，我们需要明确一个核心判断标准：</p>
<p><strong>判断一个应用是否为 AI-Native应用，只看一点：内核是逻辑控制，还是 AI 控制？</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09e3437563f3492c826eaecf2290db4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oyW5Z2R55qE5byg5biI5YKF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771240537&amp;x-signature=yj6OG15DbpLz2AqCXy3nylIH6eQ%3D" alt="" loading="lazy"/></p>
<p>若架构不改，AI 仅作为插件存在，系统必然面临维护困境。真正的 AI-Native，是将系统的控制权从硬编码移交给具备推理能力的 Agent。</p>
<h2 data-id="heading-0">1. 核心认知：Coding Agent 即通用 Agent</h2>
<p>理解架构变革，首先要更新认知：Coding Agent 不仅是编程辅助工具，更是通用 Agent 的最佳形态。人类从<strong>使用天然工具</strong>到<strong>制造工具</strong>是进化的分水岭，AI 亦然。</p>
<p>这一质变体现在三个维度：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4873ca2e65724d97b57cc3cf220ffab5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oyW5Z2R55qE5byg5biI5YKF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771240537&amp;x-signature=hkwdMyrh4RO08Bbt6jT4odLWs68%3D" alt="" loading="lazy"/></p>
<ol>
<li>**工具创造能力：**传统Agent使用预设工具集，能力边界固定。Coding Agent能动态生成代码以创建新工具，将问题求解从“选择题”转变为“应用题”。</li>
<li>**图灵完备性：**编程语言的图灵完备性，使Agent理论上具备解决任何可计算问题的能力，从而能够应对开放和未知的任务。</li>
<li>**确定性校验：**LLM的输出是概率性的，存在“幻觉”风险。代码执行结果是确定性的，为Agent的推理提供了可靠的验证和反馈闭环。</li>
</ol>
<p><strong>代码是 AI 能力的延伸。掌握编程能力的Agent，是从工具使用者向工具创造者的转变。</strong></p>
<h2 data-id="heading-1">2. 落地瓶颈：在“破坏力”与“注意力”之间走钢丝</h2>
<p>Coding Agent 的落地面临两个看似矛盾的挑战：能力的无限性（破坏力）与模型的有限性（注意力）。</p>
<h3 data-id="heading-2">2.1 如何限制“无限的破坏力”？</h3>
<p>Coding Agent 本质具备图灵完备的破坏力（如删库风险）。沙箱（Sandbox）不仅是隔离环境，更是 AI-Native 的物理安全边界，主要承担四项职能：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0825f8f1c464f9a85e284c0662485e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oyW5Z2R55qE5byg5biI5YKF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771240537&amp;x-signature=tcvt3opQN%2BtqyFU2eijSAgfMVfk%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>物理边界：</strong> 提供强隔离虚拟环境，限制逻辑自由，防止破坏力溢出至宿主系统。</li>
<li><strong>零信任原点：</strong> “一事一沙箱”机制，为每个任务提供即用即弃的独立环境，确保可重复与可审计。</li>
<li><strong>数字实验室：</strong> 将 Agent 能力延伸至沙箱内预装的工具集（浏览器、数据库等），实现从推理到行动的转化。</li>
<li><strong>反馈回路：</strong> 记录 Stdout/Stderr、网络请求等交互痕迹，作为 Agent 自我证伪和进化的事实基础。</li>
</ul>
<h3 data-id="heading-3">2.2 如何利用“有限的注意力”？</h3>
<p>业界的工程实践（如 Manus 和 TRAE）表明：<strong>上下文窗口 ≠ 有效上下文窗口</strong>。即便拥有 1M Token 窗口，有效利用率往往仅为 10-15%。超过阈值后，成本剧增且智能下降。</p>
<p>这源于 Transformer 架构的注意力机制缺陷：</p>
<ul>
<li><strong>注意力稀释（Attention Dilution）：</strong> 关键信息权重被海量无关信息稀释。</li>
<li><strong>中间迷失（Lost-in-the-Middle）：</strong> 模型对首尾信息敏感，但极易遗忘中间段落。</li>
</ul>
<p>解决之道在于<strong>上下文工程</strong>，即从“信息投喂”转向“注意力管理”：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5a6c85977544313895048551fa393fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oyW5Z2R55qE5byg5biI5YKF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771240537&amp;x-signature=P%2BvXU9e%2F8fQjrZTrJxNVtQhXDis%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>任务拆解（主动）：</strong> 引入分而治之思想，将任务拆解为独立子任务，提供精简的独立上下文。</li>
<li><strong>压缩与重启（被动）：</strong> 监测上下文阈值，主动中断任务，清洗并压缩信息后重启会话。</li>
<li><strong>记忆外化：</strong> 将记忆从 Context 移至文件系统，按需加载，对抗注意力漂移。</li>
</ul>
<h2 data-id="heading-4">3. 架构实践：Core 与 Scope 的双层解耦架构</h2>
<h3 data-id="heading-5">3.1 架构设计原则</h3>
<p>在构建垂域专家（如 Data Agent）时，我们应该遵循一个简单公式：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8bd0f80c68f04ca59a29ad2ffde318f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oyW5Z2R55qE5byg5biI5YKF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771240537&amp;x-signature=6R65WZ%2BWQdvbleCR%2Fw0xmlAl190%3D" alt="" loading="lazy"/></p>
<p>试图从零构建一个“全知全能”的Agent是低效的。正确的路径是站在巨人的肩膀上，采用“内核 (Core) - 外壳 (Scope)”的双层解耦架构。</p>
<h3 data-id="heading-6">3.2 架构层次详解</h3>
<p>这种架构将 Agent 系统解耦为两个层次：</p>
<ul>
<li>Core 层（推理内核）： 负责纯粹的推理决策。它接收精简的上下文，基于 Coding Agent 的能力生成执行计划（代码、指令）。Core 层不关心用户来源、工具如何执行，只专注于“如何解决问题”。</li>
<li>Scope 层（环境外壳）： 负责环境管理和能力扩展。它管理用户会话、动态加载领域 Skills、维护沙箱执行环境、处理上下文压缩与记忆外化。Scope 层为 Core 屏蔽了现实世界的复杂性。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5be38741bdb44020ab9219a279787262~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oyW5Z2R55qE5byg5biI5YKF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771240537&amp;x-signature=%2BBkL2soN2bvqKwN%2B5%2Fm4%2FcLRjgs%3D" alt="" loading="lazy"/></p>
<p>两层协作机制体现了前文提到的核心技术：</p>
<ul>
<li>沙箱隔离： Scope 层为每个会话分配独立沙箱，确保 Core 生成的代码在安全边界内执行。</li>
<li>上下文工程： Scope 层负责任务拆解、上下文压缩、记忆外化，为 Core 提供精简的输入。</li>
<li>Skills 扩展： 通过 Scope 层动态加载领域知识，Core 无需重新训练即可获得垂域能力。</li>
</ul>
<p>这种架构的价值在于：将 Agent 的能力边界从“模型参数”转移到了“生态丰富度”上。 我们无需重新训练模型，只需丰富 Skills 库。</p>
<h3 data-id="heading-7">3.3 实践案例：DataAgent</h3>
<p>DataAgent 是基于 Core-Scope 架构构建的数据分析领域专家，用于解决“让不懂 SQL 的用户能用自然语言查询复杂数据库”的问题。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e2c9c8e9437476290ac57bd7cfb54e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oyW5Z2R55qE5byg5biI5YKF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771240537&amp;x-signature=SVcZgzkWw8%2BnpGM9lkhrx%2BFhXDs%3D" alt="" loading="lazy"/></p>
<p>Skills 体系：DataAgent 通过 5 个领域 Skills 扩展能力。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6644150d676e410f8a72aa2e22fbab53~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oyW5Z2R55qE5byg5biI5YKF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771240537&amp;x-signature=oCNXC1Ail9NaTbP0Z%2FdYYM1lkuo%3D" alt="" loading="lazy"/></p>
<p>实际效果：相比通用 Coding Agent，DataAgent 在数据分析场景的优势显著：</p>
<ol>
<li>自适应流程： Claude 自主决定执行轮数。简单查询快速响应，复杂查询自动多轮优化。</li>
<li>领域知识内置： 内置数据库 schema 和 业务术语字典，减少 SQL 生成的幻觉。</li>
<li>安全可控： 通过MCP权限控制，保障数据安全，动态注入行级权限，防止越权访问。</li>
<li>端到端能力： 从自然语言查询到 SQL 执行、数据可视化、报告生成，一站式完成。</li>
</ol>
<p>这个案例展示了 Core-Scope 架构的核心价值：即仅通过 Scope 层的 Skills 和SubAgent扩展，通用 Coding Agent 可以快速转化为垂域专家，而无需重新训练模型和开发Agent，让我们更聚焦于我们的核心能力。</p>
<h2 data-id="heading-8">4. 从单 Agent 到多 Agent 生态</h2>
<p>上述架构解决了单个 Agent 的能力扩展和垂域适配问题。但在实际工程实践中，我们往往面临更复杂的场景：</p>
<ul>
<li>多 Agent 协作： 不同厂商的 Agent 各有优势（Claude 擅长代码理解，GPT 擅长架构规划，Gemini 擅长长上下文）。</li>
<li>动态路由： 根据任务类型选择最适合的 Agent。</li>
<li>异构集成： 每个 Agent 都是独立的二进制工具，接口各不相同。</li>
</ul>
<p>这带来了新的工程挑战：<strong>如何统一管理这些异构的 Agent？如何让应用无需关心底层 Agent 的差异？</strong></p>
<p>解决这个问题，需要构建一个统一的 Agent 运行协议层。</p>
<h2 data-id="heading-9">5. 工程实践：统一的 Agent 运行通信协议</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3fee37dc5b14fe4a71da8502821812e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oyW5Z2R55qE5byg5biI5YKF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771240537&amp;x-signature=CileNcYlHNHtH3QnbCxC2c2I%2BUc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">5.1 多 Agent 集成的挑战</h3>
<p>一年前，我们还在通过 Prompt Engineering、ReAct 循环来"手搓" Agent。今天，Claude Code、OpenAI Codex、Gemini CLI 等官方工具展现出惊人的端到端能力，<strong>手搓时代正在落幕，集成成为主流</strong>。下一代 IDE 比如 conductor、zen-flow、智谱的 ZCode 都采用了这种模式。</p>
<p>现在，"用 Agent"意味着启动一个二进制文件。以 Claude Code 为例，社区的最佳实践是集成官方 SDK（如 <code>claude-agent-sdk-python</code>），而这个 SDK 的底层直接依赖 Claude Code 的二进制可执行文件。<strong>模型厂商正在将 Agent 能力封装为黑盒</strong>。</p>
<p>这带来了新的挑战：</p>
<ol>
<li><strong>协作编排</strong>：如何让多个 Agent 协同工作？</li>
<li><strong>模型路由</strong>：如何动态选择最适合的模型？</li>
<li><strong>生命周期管理</strong>：如何保持会话状态、处理崩溃恢复？</li>
</ol>
<p>我们的角色，正在从 Agent 的<strong>创造者</strong>转变为 Agent 的<strong>编排者</strong>。</p>
<hr/>
<h3 data-id="heading-11">5.2 通信方式选择</h3>
<p>集成"二进制 Agent"的本质是跨进程通信（IPC）。常见方案各有取舍：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd9d6c42dc7d422abc27651e7b511d5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oyW5Z2R55qE5byg5biI5YKF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771240537&amp;x-signature=nh8RiPtL6YcZb5Nrd6Lg7pB6PIs%3D" alt="" loading="lazy"/></p>
<p>对于 Claude Code 这类「黑盒 CLI」，<strong>stdin/stdout + JSON 流</strong>是最务实的选择：</p>
<ul>
<li><strong>零侵入</strong>：无需修改二进制，以子进程方式启动并接管 I/O</li>
<li><strong>天然流式</strong>：模型"边想边输出"，stdout 天生就是流</li>
<li><strong>完全可观测</strong>：所有交互可记录、回放、审计</li>
</ul>
<p>架构模型如下：</p>
<pre><code class="hljs language-arduino" lang="arduino">┌──────────────────────┐            ┌──────────────────────┐
│  Your Application    │            │   Claude Code CLI    │
│  (Adapter Layer)     │            │   (binary process)   │
└──────────┬───────────┘            └──────────┬───────────┘
           │                                    │
           │  spawn process + args              │
           ├────────────────────────────────────&gt;
           │  stdin: JSON Commands              │
           ├────────────────────────────────────&gt;
           │  stdout: JSON/<span class="hljs-built_in">NDJSON</span> (stream)      │
           &lt;────────────────────────────────────┤
           │  [process exits]                   │
           &lt;────────────────────────────────────┘
</code></pre>
<p>本质上，我们要做的是 fork 一个进程执行 Agent，然后接管它的 stdin 和 stdout。例如，发送一个初始化请求（Control Request）：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"control_request"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"request_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"req_1_b6216654-1830-4e89-b088-21631681cbc9"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"request"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"subtype"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"initialize"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>会得到如下响应（Control Response）：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"control_response"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"response"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"subtype"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"success"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"request_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"req_1_b6216654-1830-4e89-b088-21631681cbc9"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"response"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"commands"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"compact"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Clear conversation history..."</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"init"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Initialize a new CLAUDE.md file..."</span> <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"models"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span> <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"opus"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"displayName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Opus"</span> <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"account"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"tokenSource"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ANTHROPIC_AUTH_TOKEN"</span> <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>OpenAI Codex app-server 也提供了类似机制（JSON-RPC 2.0 风格 over stdio）：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span> <span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"thread/start"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gpt-5.1-codex"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>

<span class="hljs-punctuation">{</span> <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"error"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">123</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Something went wrong"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-12">5.3 ACP on websocket 协议设计</h3>
<p>为了统一异构的 Agent 接口，我们需要一个标准协议。经过调研，我们选择基于 <strong>ACP（Agent Control Protocol）</strong> 作为通信协议的基础，基于 ACP 来扩展我们需要的能力：</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fagentclientprotocol.com%2F" target="_blank" title="https://agentclientprotocol.com/" ref="nofollow noopener noreferrer">agentclientprotocol.com/</a></p>
</blockquote>
<p>ACP 由 IDE 公司 Zed 出品，设计初衷是为代码编辑器服务。回想 IDE 发展史：曾经每个语言都需要为每个编辑器编写专属插件，直到 <strong>LSP</strong> 出现，彻底解耦了编辑器与语言服务。ACP 正是 Coding Agent 领域的类似尝试。</p>
<p>ACP 解决的是 Agent 与 IDE 之间的"N × M"适配问题。没有协议层，适配工作量是 O(N×M)；有了 ACP，降为 O(N+M)。</p>
<h4 data-id="heading-13">我们为什么自己重做一个 adapter 层</h4>
<p>目前 ACP 的实现较为碎片化——各家 Agent 使用不同语言构建各自的适配层：Claude Code 用 TypeScript，Codex 用 Rust，Kimi 用 Python。这种"各自为政"的现状带来了两个问题：</p>
<ol>
<li><strong>环境依赖复杂</strong>：云端沙箱和客户端都需要预装多种语言运行时</li>
<li><strong>缺乏远程支持</strong>：ACP 官方尚未提供 WebSocket/HTTP 等远程连接方式</li>
</ol>
<p>为了解决这些问题，我们需要深入 ACP 协议细节，构建统一的适配层。下面简要介绍 ACP 的核心概念。</p>
<h4 data-id="heading-14">设计原则</h4>
<ul>
<li><strong>灵活传输层</strong>：本地通过 stdio 直连，未来支持远程 HTTP/WebSocket</li>
<li><strong>精简方法集</strong>：仅保留 <code>session/new</code>、<code>session/prompt</code>、<code>session/update</code> 等 5 个核心指令</li>
</ul>
<h4 data-id="heading-15">核心流程</h4>
<p><strong>会话建立</strong>：Client 发送 <code>session/new</code>，携带 <code>cwd</code> 和 <code>mcpServers</code>；Agent 初始化环境，返回唯一的 <code>sessionId</code>。</p>
<p><strong>多轮交互</strong>：Client 发送 <code>session/prompt</code>，Agent 通过 <code>session/update</code> 持续推送 <code>message_chunk</code>、<code>tool_call</code>、<code>plan</code> 等事件，直到返回 <code>stopReason</code>。</p>
<p>完整交互示例（NDJSON）：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span><span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"req_1"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"session/new"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"cwd"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"/repo"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">{</span><span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"req_1"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"result"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"sessionId"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"sess_01"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"capabilities"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"stream"</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">{</span><span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"req_2"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"session/prompt"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"sessionId"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"sess_01"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"input"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Refactor README"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">{</span><span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"session/update"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"sessionId"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"sess_01"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"message_chunk"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Sure, I will..."</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">{</span><span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"session/update"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"sessionId"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"sess_01"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"tool_call"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"tool"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"read_file"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"README.md"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">{</span><span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"req_2"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"result"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"stopReason"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"end_turn"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span>
</code></pre>
<p>因为官方 ACP 尚未支持远程协议，我们现在做的就是将 ACP 暴露为 WebSocket，使 Agent 可以运行在本地或云端，但对外提供标准协议。</p>
<h3 data-id="heading-16">5.4 Adapter 层的价值</h3>
<h4 data-id="heading-17">生命周期管理</h4>
<p>CLI 工具是重状态的，你需要处理：进程启动与保活、会话上下文维护、崩溃检测与优雅终止、资源清理与泄漏预防。直接调用意味着这些逻辑散落在业务代码各处。</p>
<h4 data-id="heading-18">接口统一</h4>
<p>Claude、Codex、Gemini 的输入输出格式截然不同。前端直接对接多个 Agent，业务逻辑将沦为胶水代码的沼泽。</p>
<h4 data-id="heading-19">可靠性保障</h4>
<ul>
<li><strong>心跳与重连</strong>：双向 Ping/Pong 探活，应对网络波动</li>
<li><strong>状态恢复</strong>：当 Agent 进程意外崩溃时，基于持久化的 Session History 重启进程并重放上下文，实现"无感恢复"</li>
<li><strong>会话漂移</strong>：通过序列化会话状态，支持 Agent 会话在不同容器或服务器间迁移</li>
</ul>
<h4 data-id="heading-20">可观测性</h4>
<ul>
<li><strong>分布式追踪</strong>：Agent 的行为往往跨越多个进程和服务（Client → Server → Adapter → CLI Process），没有 Trace ID，排查问题无异于大海捞针</li>
</ul>
<h4 data-id="heading-21">兼容性扩展</h4>
<ul>
<li><strong>历史格式转换</strong>：支持不同 Agent 间的历史会话格式互转，例如用 Codex 接手 Claude Code 的会话</li>
<li><strong>API 协议桥接</strong>：很多 Coding Agent 原生绑定 Anthropic API，但企业大概率是使用基于 OpenAI 接口的按量付费。Adapter 可充当中间层，将 OpenAI 请求实时转换为 Agent 指令，对外暴露 <strong>OpenAI Compatible</strong> 接口</li>
</ul>
<h4 data-id="heading-22">部署便捷性</h4>
<ul>
<li><strong>Portable Packaging</strong>：
<ul>
<li>比如使用 <code>bun compile</code> 将 TS 编写的 Adapter 打包为单文件，去掉 node 环境依赖</li>
<li>目标：<strong>零依赖部署</strong>，无需预装 Node.js 或 Python 运行时</li>
</ul>
</li>
</ul>
<h3 data-id="heading-23">展望</h3>
<p>回看编程工具发展史，IDE 曾深陷语言插件碎片化的泥潭，直到 LSP 一统江湖。Coding Agent 正处于"前 LSP 时代"的混沌期。</p>
<p><strong>ACP 的愿景是打破孤岛。</strong> 未来的 Agent 应该是遵循 ACP 标准的通用服务，无论 Claude、Codex 还是开源模型，即使不是编程的 Agent，只要实现了 ACP，就能即插即用地接入我们的产品中来。</p>
<p>这才是 Agent 真正的"LSP 时刻"。为 Agent 打造舒适的运行时，可能是接下来最重要的事情。</p>
<h2 data-id="heading-24">6. 结语</h2>
<p><strong>AI-Native 架构的艺术，在于在不确定性的LLM之上，构建确定性的业务价值。</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/addaa605b8344859935dd30637e010b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oyW5Z2R55qE5byg5biI5YKF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771240537&amp;x-signature=NaIOe1dUsRfCoFg%2FBZSEh68ssHg%3D" alt="" loading="lazy"/></p>
<p>这不仅是技术的升级，更是思维的跃迁。未来的软件工程师，将不再是<strong>代码的搬运工</strong>，而是<strong>智能的编排者、系统的教育者和概率的牧羊人</strong>。</p>
<p><em>(致敬每一个在 AGI 路上探索的同伴，Respect🫡)</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于Notion自媒体内容生产发布系统-2026]]></title>    <link>https://juejin.cn/post/7604471065860620339</link>    <guid>https://juejin.cn/post/7604471065860620339</guid>    <pubDate>2026-02-09T11:23:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604471065860620339" data-draft-id="7604409112593530890" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于Notion自媒体内容生产发布系统-2026"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2026-02-09T11:23:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="可夫小子"/> <meta itemprop="url" content="https://juejin.cn/user/1878415577453223"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于Notion自媒体内容生产发布系统-2026
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1878415577453223/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    可夫小子
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T11:23:16.000Z" title="Mon Feb 09 2026 11:23:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://ob-1253382987.cos.ap-guangzhou.myqcloud.com/notion/a87f9b2ca6d96338645d3f42bee6e514.png" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">选题库</h2>
<p>通过Notion插件，把各个社交媒体的内容源汇总</p>
<ul>
<li>微信公众号 ➡️Notion Web Cliper</li>
<li>X➡️Notion Web Cliper</li>
<li>Telegram➡️save to Notion</li>
<li>B站➡️Notion Web Cliper</li>
</ul>
<h2 data-id="heading-1">创作</h2>
<h3 data-id="heading-2">自己写作</h3>
<p>在<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.notion.so%2Fe49aa6bf5cc34342a8ef30f868b76184" target="_blank" title="https://www.notion.so/e49aa6bf5cc34342a8ef30f868b76184" ref="nofollow noopener noreferrer">可夫知识库工作台</a> 里面不同的项目，添加选项。这个工作台显示非Done文章。</p>
<h3 data-id="heading-3">AI驱动</h3>
<ul>
<li>由主题生成文章：现在可以通过Claude Code的Weixin Skill，但还没完成内容上传到Notion备份 📌</li>
<li>生成封面：现在是脚本调用豆包生图API，期望做成chrome插件，实现到Notion备份 📌</li>
</ul>
<h2 data-id="heading-4">发布</h2>
<h3 data-id="heading-5">首发</h3>
<ul>
<li>《AI编程与自动化》付费知识库=》Notion文章状态设置为Done，即马上发布</li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.koffuxu.com%2F" target="_blank" title="http://www.koffuxu.com/" ref="nofollow noopener noreferrer">可夫小子</a>个人Blog ➡️ Notion自动化，完成文章复制</li>
<li>公众号：通过CC技能下载发布</li>
</ul>
<h3 data-id="heading-6">各平台同步</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmd.doocs.org%2F" target="_blank" title="https://md.doocs.org/" ref="nofollow noopener noreferrer">COSE</a> ：还需要有一个Notion-to-Markdown插件，才能跑通📌</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fchromewebstore.google.com%2Fdetail%2Fhchobocdmclopcbnibdnoafilagadion%3Futm_source%3Ditem-share-cb" target="_blank" title="https://chromewebstore.google.com/detail/hchobocdmclopcbnibdnoafilagadion?utm_source=item-share-cb" ref="nofollow noopener noreferrer">文章同步助手插件</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>