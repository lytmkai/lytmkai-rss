<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Windows 下 VS Code 配置 MCP 服务避坑指南：解决spawn *** ENOENT 报错]]></title>    <link>https://juejin.cn/post/7600326291553255430</link>    <guid>https://juejin.cn/post/7600326291553255430</guid>    <pubDate>2026-01-29T02:48:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600326291553255430" data-draft-id="7600298554872512518" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Windows 下 VS Code 配置 MCP 服务避坑指南：解决spawn *** ENOENT 报错"/> <meta itemprop="keywords" content="MCP"/> <meta itemprop="datePublished" content="2026-01-29T02:48:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿虎儿"/> <meta itemprop="url" content="https://juejin.cn/user/3394908210857901"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Windows 下 VS Code 配置 MCP 服务避坑指南：解决spawn *** ENOENT 报错
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3394908210857901/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿虎儿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T02:48:13.000Z" title="Thu Jan 29 2026 02:48:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Windows 系统中配置 MCP 服务器的完整指南</h2>
<blockquote>
<p>解决 VSCode 启动 MCP 服务器时出现 <code>spawn xxx ENOENT</code> 错误的终极方案</p>
</blockquote>
<h3 data-id="heading-1">前言</h3>
<p>随着 AI 编程助手的发展，MCP（Model Context Protocol）服务器成为了扩展 AI 能力的重要方式。然而，许多 Windows 用户在 VSCode 中配置 MCP 服务器时，经常会遇到一个令人困惑的问题：</p>
<p><strong>命令行中可以正常运行的命令，在 VSCode 的 MCP 配置中却报错 <code>ENOENT</code>。</strong></p>
<p>本文将深入分析这个问题的原因，并提供多种解决方案。</p>
<hr/>
<h3 data-id="heading-2">问题现象</h3>
<h4 data-id="heading-3">典型场景</h4>
<p>使用 fnm、nvm-windows 等 Node.js 版本管理工具安装 Node.js 后，全局安装一个 MCP 服务包：</p>
<pre><code class="hljs language-bash" lang="bash">npm install -g chrome-devtools-mcp@latest
</code></pre>
<p>在 VSCode 的 MCP 配置文件中添加：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"chrome-devtools"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chrome-devtools-mcp"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"--autoConnect"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"--channel=beta"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-4">错误信息</h4>
<p>启动 MCP 服务器时，出现以下错误：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">连接状态: 错误 spawn chrome-devtools-mcp ENOENT</span>
</code></pre>
<h4 data-id="heading-5">矛盾点</h4>
<p>在命令行（CMD 或 PowerShell）中直接执行同样的命令，却能正常运行：</p>
<pre><code class="hljs language-bash" lang="bash">chrome-devtools-mcp --autoConnect --channel=beta
<span class="hljs-comment"># ✅ 正常启动</span>
</code></pre>
<hr/>
<h3 data-id="heading-6">问题根因分析</h3>
<h4 data-id="heading-7">ENOENT 的含义</h4>
<p><code>ENOENT</code> 是 Node.js 中的错误码，表示 <strong>"Error NO ENTry"</strong>，即找不到指定的文件或目录。</p>
<h4 data-id="heading-8">为什么命令行可以，VSCode 却不行？</h4>
<p>这涉及到 Windows 系统中 <strong>PATH 环境变量的加载机制</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">┌─────────────────────────────────────────────────────────────────┐
│                    环境变量加载流程对比                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  【命令行启动】                                                  │
│  ┌──────────┐    ┌──────────┐    ┌─────────────────────┐       │
│  │ 打开 CMD │───▶│ 加载配置 │───▶│ fnm/nvm 注入 PATH   │       │
│  └──────────┘    │ (profile)│    │ 包含 node/npm 路径  │       │
│                  └──────────┘    └─────────────────────┘       │
│                                            │                    │
│                                            ▼                    │
│                               ┌─────────────────────┐          │
│                               │ ✅ 可找到全局包命令  │          │
│                               └─────────────────────┘          │
│                                                                 │
│  【VSCode 启动 MCP】                                            │
│  ┌──────────┐    ┌──────────────────┐                          │
│  │  VSCode  │───▶│ 使用系统原始 PATH │                          │
│  │  进程    │    │ (无 fnm/nvm 注入) │                          │
│  └──────────┘    └──────────────────┘                          │
│                           │                                     │
│                           ▼                                     │
│                 ┌─────────────────────┐                        │
│                 │ ❌ 找不到全局包命令  │                        │
│                 └─────────────────────┘                        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
</code></pre>
<p><strong>核心原因</strong>：</p>
<ol>
<li><strong>fnm/nvm 是动态注入 PATH 的</strong>：它们通过 shell 配置文件（如 <code>.bashrc</code>、PowerShell profile）在每次打开终端时动态设置 PATH</li>
<li><strong>VSCode 不加载这些配置</strong>：VSCode 启动子进程时，直接使用系统级 PATH，不会执行 shell 配置文件</li>
<li><strong>全局包路径不在系统 PATH 中</strong>：npm 全局包的可执行文件路径没有被 VSCode 识别</li>
</ol>
<hr/>
<h3 data-id="heading-9">解决方案</h3>
<h4 data-id="heading-10">方案一：使用完整路径（推荐 ⭐⭐⭐）</h4>
<p>这是最直接、最可靠的方案。</p>
<p><strong>步骤 1：查找可执行文件的完整路径</strong></p>
<pre><code class="hljs language-cmd" lang="cmd">where chrome-devtools-mcp
</code></pre>
<p>输出示例：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">C:\Users\YourName\AppData\Roaming\fnm\node-versions\v24.0.0\installation\chrome-devtools-mcp.cmd</span>
</code></pre>
<p><strong>步骤 2：修改 MCP 配置</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"chrome-devtools"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"C:\\Users\\YourName\\AppData\\Roaming\\fnm\\node-versions\\v24.0.0\\installation\\chrome-devtools-mcp.cmd"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"--autoConnect"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"--channel=beta"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<blockquote>
<p>⚠️ <strong>注意</strong>：JSON 中的反斜杠需要转义，使用 <code>\\</code></p>
</blockquote>
<p><strong>优点</strong>：</p>
<ul>
<li>100% 可靠</li>
<li>不依赖任何环境变量</li>
<li>明确指定版本</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>路径较长</li>
<li>更换 Node.js 版本后需要更新路径</li>
</ul>
<hr/>
<h4 data-id="heading-11">方案二：通过 CMD 中转</h4>
<p>利用 <code>cmd /c</code> 让 Windows 的命令处理器来解析 PATH。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"chrome-devtools"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cmd"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"/c"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"chrome-devtools-mcp"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"--autoConnect"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"--channel=beta"</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>工作原理</strong>：</p>
<pre><code class="hljs">VSCode ──▶ cmd.exe ──▶ 解析系统 PATH ──▶ 找到并执行命令
</code></pre>
<p><strong>适用场景</strong>：</p>
<ul>
<li>可执行文件路径已在系统级 PATH 中</li>
<li>不想写完整路径</li>
</ul>
<hr/>
<h4 data-id="heading-12">方案三：通过 PowerShell 中转</h4>
<p>与 CMD 类似，但使用 PowerShell：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"chrome-devtools"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"powershell"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"-Command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"chrome-devtools-mcp --autoConnect --channel=beta"</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>如果需要加载 PowerShell 配置文件（包含 fnm 初始化）：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"chrome-devtools"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"powershell"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"-NoLogo"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"-NoExit"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"-Command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">". $PROFILE; chrome-devtools-mcp --autoConnect --channel=beta"</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h4 data-id="heading-13">方案四：使用 npx 运行</h4>
<p>npx 可以自动查找并运行 npm 包：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"chrome-devtools"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"chrome-devtools-mcp"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"--autoConnect"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"--channel=beta"</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>如果 npx 本身也找不到，使用完整路径：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"chrome-devtools"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"C:\\Users\\YourName\\AppData\\Roaming\\fnm\\node-versions\\v24.0.0\\installation\\npx.cmd"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"chrome-devtools-mcp"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"--autoConnect"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"--channel=beta"</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h4 data-id="heading-14">方案五：在配置中指定环境变量</h4>
<p>MCP 配置支持 <code>env</code> 字段，可以手动注入 PATH：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"chrome-devtools"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chrome-devtools-mcp"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"--autoConnect"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"--channel=beta"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"PATH"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"C:\\Users\\YourName\\AppData\\Roaming\\fnm\\node-versions\\v24.0.0\\installation;${env:PATH}"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<blockquote>
<p>⚠️ <strong>注意</strong>：<code>${env:PATH}</code> 语法可能因 MCP 客户端实现而异，部分客户端可能不支持</p>
</blockquote>
<hr/>
<h4 data-id="heading-15">方案六：将 Node 路径添加到系统 PATH</h4>
<p>一劳永逸的方案，将 npm 全局包路径添加到系统环境变量。</p>
<p><strong>步骤 1：获取 npm 全局包路径</strong></p>
<pre><code class="hljs language-bash" lang="bash">npm config get prefix
</code></pre>
<p>输出示例：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">C:\Users\YourName\AppData\Roaming\fnm\node-versions\v24.0.0\installation</span>
</code></pre>
<p><strong>步骤 2：添加到系统 PATH</strong></p>
<ol>
<li>按 <code>Win + R</code>，输入 <code>sysdm.cpl</code>，回车</li>
<li>点击「高级」→「环境变量」</li>
<li>在「系统变量」中找到 <code>Path</code>，点击「编辑」</li>
<li>点击「新建」，粘贴上面获取的路径</li>
<li>确定保存，<strong>重启 VSCode</strong></li>
</ol>
<p><strong>优点</strong>：</p>
<ul>
<li>一次配置，永久生效</li>
<li>配置文件保持简洁</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>切换 Node 版本后需要更新系统 PATH</li>
<li>与版本管理工具的理念冲突</li>
</ul>
<hr/>
<h3 data-id="heading-16">方案对比</h3>






















































<table><thead><tr><th>方案</th><th>可靠性</th><th>配置复杂度</th><th>版本切换适应性</th><th>推荐场景</th></tr></thead><tbody><tr><td>完整路径</td><td>⭐⭐⭐⭐⭐</td><td>中</td><td>❌ 需更新</td><td>生产环境、固定版本</td></tr><tr><td>CMD 中转</td><td>⭐⭐⭐⭐</td><td>低</td><td>✅</td><td>快速配置</td></tr><tr><td>PowerShell 中转</td><td>⭐⭐⭐⭐</td><td>中</td><td>✅</td><td>需要 PS 特性</td></tr><tr><td>npx</td><td>⭐⭐⭐</td><td>低</td><td>✅</td><td>简单场景</td></tr><tr><td>指定 env</td><td>⭐⭐⭐</td><td>高</td><td>❌ 需更新</td><td>特殊需求</td></tr><tr><td>修改系统 PATH</td><td>⭐⭐⭐⭐</td><td>高</td><td>❌ 需更新</td><td>单一 Node 版本</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-17">常见问题排查</h3>
<h4 data-id="heading-18">Q1：如何确认是 PATH 问题？</h4>
<p>在 VSCode 终端中执行：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看 VSCode 终端的 PATH</span>
<span class="hljs-built_in">echo</span> %PATH%

<span class="hljs-comment"># 检查命令是否可用</span>
<span class="hljs-built_in">where</span> chrome-devtools-mcp
</code></pre>
<p>如果 <code>where</code> 命令显示「找不到」，则确认是 PATH 问题。</p>
<h4 data-id="heading-19">Q2：使用 nvm-windows 也有同样问题吗？</h4>
<p>是的。nvm-windows 同样通过动态切换 PATH 来管理 Node 版本。解决方案相同，只是路径不同：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">C:\Users\YourName\AppData\Roaming\nvm\v24.0.0\chrome-devtools-mcp.cmd</span>
</code></pre>
<h4 data-id="heading-20">Q3：配置修改后不生效？</h4>
<ol>
<li>确保配置文件语法正确（可用 JSON 校验工具检查）</li>
<li><strong>完全重启 VSCode</strong>（不是仅重新加载窗口）</li>
<li>检查配置文件位置是否正确</li>
</ol>
<h4 data-id="heading-21">Q4：如何找到 MCP 配置文件位置？</h4>
<p>不同的 MCP 客户端/扩展，配置文件位置可能不同：</p>
<ul>
<li><strong>Cline 扩展</strong>：VSCode 设置 → 扩展设置</li>
<li><strong>Claude Desktop</strong>：<code>%APPDATA%\Claude\claude_desktop_config.json</code></li>
<li><strong>其他扩展</strong>：查阅对应扩展文档</li>
</ul>
<hr/>
<h3 data-id="heading-22">最佳实践建议</h3>
<h4 data-id="heading-23">1. 开发环境：使用完整路径</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"my-mcp-server"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"C:\\full\\path\\to\\executable.cmd"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"--arg1"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"--arg2"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-24">2. 团队协作：使用项目本地安装 + npx</h4>
<p>将 MCP 服务器作为项目开发依赖：</p>
<pre><code class="hljs language-bash" lang="bash">npm install --save-dev chrome-devtools-mcp
</code></pre>
<p>配置使用 npx：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"chrome-devtools"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"chrome-devtools-mcp"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"--autoConnect"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-25">3. 创建启动脚本</h4>
<p>在项目根目录创建 <code>start-mcp.cmd</code>：</p>
<pre><code class="hljs language-cmd" lang="cmd">@echo off
call C:\Users\YourName\AppData\Roaming\fnm\fnm.exe env --use-on-cd | call
call chrome-devtools-mcp %*
</code></pre>
<p>配置引用脚本：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"chrome-devtools"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"${workspaceFolder}\\start-mcp.cmd"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"--autoConnect"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"--channel=beta"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h3 data-id="heading-26">总结</h3>
<p>Windows 系统中 MCP 服务器的 <code>ENOENT</code> 错误，本质上是<strong>环境变量作用域问题</strong>。VSCode 启动子进程时不会加载 shell 配置文件，导致版本管理工具（fnm/nvm）注入的 PATH 无法被识别。</p>
<p><strong>解决核心思路</strong>：</p>
<ol>
<li>让 VSCode 能找到可执行文件（完整路径 / 修改系统 PATH）</li>
<li>或者通过 shell 中转来解析 PATH（cmd /c / powershell）</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从“人治”到“机治”：得物离线数仓发布流水线质量门禁实践]]></title>    <link>https://juejin.cn/post/7600341731047555107</link>    <guid>https://juejin.cn/post/7600341731047555107</guid>    <pubDate>2026-01-29T06:52:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600341731047555107" data-draft-id="7600491179499159606" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从“人治”到“机治”：得物离线数仓发布流水线质量门禁实践"/> <meta itemprop="keywords" content="大数据"/> <meta itemprop="datePublished" content="2026-01-29T06:52:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="得物技术"/> <meta itemprop="url" content="https://juejin.cn/user/2392954206960247"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从“人治”到“机治”：得物离线数仓发布流水线质量门禁实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2392954206960247/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    得物技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T06:52:20.000Z" title="Thu Jan 29 2026 06:52:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、前言</h2>
<p>随着企业数字化转型加速推进，大数据业务规模呈现指数级增长，迭代变更越发频繁。此背景下，呈现"高频变更"与"超大规模"并存的特征，这种双重特性给大数据任务的发布变更带来了严峻挑战。</p>
<h2 data-id="heading-1">二、项目目标</h2>
<p><strong>离线数仓任务资产管理</strong></p>
<p>增量：通过大数据变更发布流水线进行卡点，确保末端任务发布前，消费场景&amp;风险等级完成绑定。增量任务发布消费场景绑定率100%覆盖。</p>
<p>存量：盘点存量资产任务，人工梳理打标，完成初始化消费场景绑定。</p>
<p><strong>大数据变更发布流水线</strong></p>
<p>数仓任务发布流水线管控100%覆盖，任务发布效率提升60%。</p>
<h2 data-id="heading-2">三、项目方案</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dcbbcbdf03ae4c869a91b4799f8179fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770274403&amp;x-signature=QZE13mEVp5cv6Tsx6rr6em2WzPM%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h3 data-id="heading-3">数仓任务资产管理</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d6954c35f584787b99df00ed967578b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770274403&amp;x-signature=0jv6VAoQYcAFbrplwcLprBM8Bww%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>消费场景定义</strong></p>
<p>根据业务用途梳理消费端内容，根据风险高低定义风险等级P0、P1、P2，从末节点自动倒推追溯上游全链路，并全部打上风险等级P0、P1、P2标识，以相同的生产规范标准要求上下游各方协同保障。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba6a1b928c3c4763afc4868e6ea87c0e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770274403&amp;x-signature=c%2BYgadRA44Mj3ohKsnzatoBevSU%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>风险等级定义</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5eb42fe993c14ff0a996420bd470633f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770274403&amp;x-signature=FKQ%2B9CuEQsB9NkMs20RLfQY7mk4%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>消费场景注册&amp;绑定</strong></p>
<ul>
<li><strong>消费场景注册</strong></li>
</ul>
<p>当前数仓任务消费场景已经完成初步盘点和梳理，并且将盘点的消费场景数据初始化到平台中。随着迭代场景的新增，需要注册新的场景，从而应业务所需。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a44db55d88a747288596b986ae51adad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770274403&amp;x-signature=Z6di80hvl2Zqe4JZzlXp2jaaApc%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<ul>
<li><strong>存量资产任务绑定</strong></li>
</ul>
<p>针对当前数仓存量资产任务进行盘点，将adm、ads层表进行梳理、打标，最终初始化到平台中，完成存量资产绑定消费场景。</p>
<ul>
<li><strong>任务消费场景应用</strong></li>
</ul>
<p>任务和消费场景完成绑定后，从而决定任务的应用场景、风险等级，P0、P1任务将在变更管控、线上稳定性保障等得到重保。</p>
<h3 data-id="heading-4">数仓变更管控流水线</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd3ec25b6c174764bbefe31ef8f678c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770274403&amp;x-signature=d%2BQ3NXjO3p3RJAzM6SFQySKci5g%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>质量定义(DQC)</strong></p>
<p>在离线数据仓库（数仓）中，数据质量检查（DQC，Data Quality Check）是确保数据准确性、一致性、完整性的重要环节。数仓ETL任务在加工完成后，会执行DQC检查，从而有效、及时发现数据质量问题，便于研发人员及时修复，避免问题数据对业务造成损失。</p>
<ul>
<li><strong>DQC强规则</strong></li>
</ul>
<p>当强规则执行不通过后，直接失败任务，及时通知任务Owner，并拦截下游任务执行，待修复后下游链路再继续执行。（拦截任务，需要值班人员及时修复。）</p>
<ul>
<li><strong>DQC弱规则</strong></li>
</ul>
<p>当弱规则执行不通过后，及时通知任务Owner。任务正常执行成功，下游任务也正在运行。（不拦截任务，会通知到任务Owner。）</p>
<p><strong>质量定义配置</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/974a23fb07ba43d98f01b66c0cecb206~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770274403&amp;x-signature=puuYyBdSDog231%2B8%2BeWtjjVbbIY%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<ul>
<li><strong>通用型DQC规则</strong></li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3512b3f1aab4648b9ba778cdfb4c63e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770274403&amp;x-signature=1UkUpg7fLuZGXTSivlugXMYoAyM%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d98c1542c8154560927cf261bd0ff6e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770274403&amp;x-signature=uLhY%2F6i5BBrqr4FmeAmcBgUuaNw%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79a2fa1812f748bcbb90081b3a5a25ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770274403&amp;x-signature=vWv8spTY%2F7flnSngyhgL3v8Ni0M%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>质量定义通过可视化界面操作，让用户可以直接通过简单的勾选方式，即可生成对应的DQC规则，大大提高研发人员配置DQC的效率。</p>
<ul>
<li><strong>自定义DQC规则</strong></li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d810c6bbd9e14324826a623e71239657~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770274403&amp;x-signature=gLG73ppalBoRWLZ8umEQIg9d3BM%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>用户可以按照规则SQL补充规则逻辑，从而实现自定义验证SQL融入DQC-SQL中，达到自定义DQC规则的效果。</p>
<p><strong>强弱规则配置</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5962e1b7c45242d9bf90bfc4b3c2e965~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770274403&amp;x-signature=XldHabsNTfOMJ6sPXO6znTkJFfw%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>DQC强规则和弱规则的配置方式完全一致，通过Tab的切换，可以完成强弱规则的配置。</p>
<p><strong>质量DQC试运行</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63209616aa5c4f23a6585636ea201e16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770274403&amp;x-signature=VwH6bLAI7qETWL86u9mqJsg1hZY%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>所有DQC配置完成后，需要通过试运行之后才能保存上线，确保DQC配置的合理性、有效性。</p>
<p><strong>告警策略</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/924be0c0232847fb985fff63432c9d40~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770274403&amp;x-signature=u064XJgH0xNHpZMB15dZK2lysiA%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>支持飞书、电话、短信、邮箱等方式告警通知。其中强规则一旦触发，必定电话告警（采取15分钟无响应即逐级上升原则）。</p>
<p><strong>发布流水线管控</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce8d58bbb15b4e5aa6bd4d3963452cc2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770274403&amp;x-signature=qcRcaLfzKFjoU3s1IRryc12MpeE%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9feb9ce26724d57aa8ca88768e0a6a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770274403&amp;x-signature=IK4SX69%2FGUyIHEnNW%2B5Q%2FTRsntk%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>静态扫描</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32ad381e710944d2b45b515c01af2f0d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770274403&amp;x-signature=zOpY7suZOCLsCUZgMzDyZZcX0TM%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b192059f63b44e3a4bfc774e33a628b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770274403&amp;x-signature=%2B8iTU3GXC8epX8Vlh%2FPuIKmonmY%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>检测规则：任务依赖、建表规范、编码规范、集成规范、DQC规范等。</p>
<p><strong>冒烟测试</strong></p>
<p>在数仓测试环境下，完成任务冒烟测试执行，执行内容包含：ETL任务、DQC规则。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6eeb933954cb4c3e83e8255b003d02ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770274403&amp;x-signature=8lcZK1qNQ1RISk1MXWUupsqFHPs%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>CodeReview</strong></p>
<p>描述：根据业务熟悉对，由数据域数仓PM 或者 业务数仓技术负责人进行评审，给出评审结论。</p>
<p>内容：ETL代码、调度配置、质量定义配置、DQC-SQL等。</p>
<p>注意：审批人飞书会接收到来自“xx稳定中心”机器人推送的消息，点击进入审批详情完成审批即可。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b1ecd73992434cb79c77b75eab7164c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770274403&amp;x-signature=7uX7O1vN6ZbbD7DDZttpIzF%2BAL4%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>数据探查</strong></p>
<p>描述：针对表内所有字段进行探查和校验，主要场景：数字探查、字符探查、主键验证、无效字段验证、异常字段验证</p>
<p>PS：数字探查和字符探查会给出明显问题红色高亮标识。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd1305690b6d44dbb26c20f6057358f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770274403&amp;x-signature=FrYlzF6QEGxUgVHxHaNfyPvgjGg%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79697b5c131b432bac3440ceb2ec194e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770274403&amp;x-signature=8o6JPjaV8O9lg%2F0iPBIC5e1Oep0%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>数据比对</strong></p>
<p>描述：针对生产表和测试表进行数据比对，比对场景：数据量对比、聚合指标对比、明细对比。</p>
<p>注意信息：对比的两张表用户无法输入，用户需要输入执行分区、主键字段、去噪字段、风险阈值（针对明细对比生效）。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fda58c471ee46108b5e520e644ecf4e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770274403&amp;x-signature=AwYFo9VTNy6Gw3%2BPoC%2F%2FxwV4Hy0%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>发布审批</strong></p>
<p>描述：发布审批节点，用户输入本次发布的基础信息，提交审批即可。</p>
<p>所有需求都需要数据域PM和对应数据域的责任QA进行审批。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee84a4e7a23743dcbf98092ab8e909e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770274403&amp;x-signature=iyZwVJ%2Fl3uvhqnWpTmGfNxQpEQw%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-5">四、总结&amp;未来规划</h2>
<h3 data-id="heading-6">实践总结</h3>
<p>得物离线数仓发布流水线过去1年有着从0到1的建设，以及后期从1到10的优化和改进。当前流水线能力已经足以支撑数仓内部日常迭代变更需求的发布管控，为发布准出规则执行提供了巨大帮助。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c5761a470744a7e8d0d9fe86f1c8815~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770274403&amp;x-signature=mDN6ddVP0IZQze8m%2F1EMU3jFu%2Bg%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>发布管控对于QA来说是最重要的一个环节，所有发布都能够达到准出标准的要求，从而才能守住发布的最后一道线。</p>
<h3 data-id="heading-7">未来规划</h3>
<p><strong>节点能力优化</strong></p>
<p>当前数仓表单分区大于3TB（十亿、百亿、千亿级别）存储数据后，数据探查、数据比对将不提供验证服务，主要源于数据量、存储过大、字段过多，对计算资源、计算存储带来巨大的消耗，严重影响其他任务的执行进度。后续通过数据抽样验证的方式从而降低资源的消耗，从而提升场景覆盖度。</p>
<p><strong>流水线能力补充</strong></p>
<p>数据探查未来考虑通过和历史探查结果比对参考的方式，给出诊断结果，进一步提升工具卡点能力。</p>
<h3 data-id="heading-8">往期回顾</h3>
<p>1.AI编程实践：从Claude Code实践到团队协作的优化思考｜得物技术</p>
<p>2.入选AAAI-PerFM｜得物社区推荐之基于大语言模型的新颖性推荐算法 </p>
<p>3.Galaxy比数平台功能介绍及实现原理｜得物技术</p>
<p>4.得物App智能巡检技术的探索与实践</p>
<p>5.深度实践：得物算法域全景可观测性从 0 到 1 的演进之路</p>
<h3 data-id="heading-9">文 /家森</h3>
<p>关注得物技术，每周更新技术干货</p>
<p>要是觉得文章对你有帮助的话，欢迎评论转发点赞～</p>
<p>未经得物技术许可严禁转载，否则依法追究法律责任。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端向架构突围系列 - 编译原理 [6 - 2]：Babel 插件开发与访问者模式]]></title>    <link>https://juejin.cn/post/7600581247019679753</link>    <guid>https://juejin.cn/post/7600581247019679753</guid>    <pubDate>2026-01-29T07:37:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600581247019679753" data-draft-id="7600489282838986762" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端向架构突围系列 - 编译原理 [6 - 2]：Babel 插件开发与访问者模式"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-29T07:37:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端王壮壮"/> <meta itemprop="url" content="https://juejin.cn/user/4473272506789485"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端向架构突围系列 - 编译原理 [6 - 2]：Babel 插件开发与访问者模式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4473272506789485/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端王壮壮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T07:37:12.000Z" title="Thu Jan 29 2026 07:37:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><blockquote>
<p><strong>写在前面</strong></p>
<p>很多高级的前端库都在用 Babel 插件做“魔法”。</p>
<ul>
<li><strong>React:</strong> JSX 语法根本不是 JS，是 Babel 把它变成了 <code>React.createElement</code>。</li>
<li><strong>Vue:</strong> <code>v-model</code> 的语法糖，是在编译阶段展开的。</li>
<li><strong>babel-plugin-import:</strong> 为什么 Ant Design 可以按需加载？因为它悄悄把 <code>import { Button } from 'antd'</code> 改写成了引用具体文件的路径。</li>
</ul>
<p>学会写 Babel 插件，意味着你拥有了<strong>改写语言规则</strong>的能力。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce72ee99ca0b4093bef22a0b910de43f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv546L5aOu5aOu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770277039&amp;x-signature=tMfRBdJK%2BNTJmTOTVk6YpqixTE8%3D" alt="unnamed.jpg" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-0">一、 核心设计模式：访问者模式 (Visitor Pattern)</h2>
<p>AST 是一棵深度极深、结构复杂的树。如果让你手动写递归函数去遍历每一个节点，还得判断“这是不是函数”、“这是不是变量”，你会疯掉的。</p>
<p>Babel 采用 <strong>访问者模式</strong> 来解决这个问题。</p>
<h3 data-id="heading-1">1.1 什么是 Visitor？</h3>
<p>想象 AST 是一个巨大的<strong>迷宫</strong>。</p>
<ul>
<li><strong>Babel (Traverser):</strong> 是一个不知疲倦的导游，他负责走遍迷宫的每一个角落（深度优先遍历）。</li>
<li><strong>你 (Visitor):</strong> 是游客。你不需要自己走，你只需要在特定的“景点”等着。</li>
<li><strong>工作流：</strong> 导游走到一个节点（比如“函数声明节点”），就会大喊：“这里有个函数声明！”如果你对这个节点感兴趣，你就处理它；不感兴趣，导游就继续走。</li>
</ul>
<h3 data-id="heading-2">1.2 代码中的 Visitor</h3>
<p>在 Babel 插件中，Visitor 就是一个对象，对象的<strong>Key</strong> 是你感兴趣的 AST 节点类型。</p>
<pre><code class="hljs language-scss" lang="scss">const visitor = {
  <span class="hljs-comment">// 当遍历到 Identifier（标识符/变量名）节点时，执行这个函数</span>
  <span class="hljs-built_in">Identifier</span>(path) {
    console<span class="hljs-selector-class">.log</span>("我发现了一个变量:", path.node.name);
  },
  
  <span class="hljs-comment">// 当遍历到 BinaryExpression（二元表达式，如 a + b）节点时...</span>
  <span class="hljs-built_in">BinaryExpression</span>(path) {
    console<span class="hljs-selector-class">.log</span>("我发现了一个运算");
  }
};
</code></pre>
<hr/>
<h2 data-id="heading-3">二、 手术刀的核心：Path 与 Types</h2>
<p>在编写插件时，有两个最重要的概念：<code>path</code> 和 <code>@babel/types</code>。</p>
<h3 data-id="heading-4">2.1 Path：节点之间的桥梁</h3>
<p>注意，Visitor 函数接收的参数不是 <code>node</code>，而是 <code>path</code>。</p>
<ul>
<li>
<p><strong>Node (节点):</strong> 只是静态的数据（JSON 对象），比如 <code>{ type: "Identifier", name: "a" }</code>。它没有灵魂。</p>
</li>
<li>
<p><strong>Path (路径):</strong> 是一个<strong>响应式对象</strong>。它不仅包含当前节点的信息，还包含<strong>父节点</strong>、<strong>作用域</strong>以及<strong>增删改查的方法</strong>。</p>
<ul>
<li><code>path.node</code>: 获取当前节点数据。</li>
<li><code>path.parent</code>: 获取父节点。</li>
<li><code>path.remove()</code>: 自杀（把自己从树中移除）。</li>
<li><code>path.replaceWith(newNode)</code>: 变身（把自己替换成新节点）。</li>
<li><code>path.stop()</code>: 告诉导游（Babel），停止遍历，不要往下走了。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-5">2.2 @babel/types：节点的生成器与验证器</h3>
<p>如果你想把 <code>a</code> 替换成 <code>b</code>，你不能直接写 <code>path.node.name = 'b'</code>（虽然有时候也能跑，但不规范）。你需要创建一个标准的 AST 节点。 <code>@babel/types</code> (通常简写为 <code>t</code>) 就是干这个的。</p>
<ul>
<li><code>t.isIdentifier(node)</code>: 判断是不是标识符。</li>
<li><code>t.stringLiteral("hello")</code>: 创建一个字符串字面量节点。</li>
</ul>
<hr/>
<h2 data-id="heading-6">三、 实战演练：编写一个“去除 console.log”的插件</h2>
<p>这是 Babel 插件开发的 "Hello World"。 <strong>需求：</strong> 生产环境构建时，自动删除代码里所有的 <code>console.log</code>，但保留 <code>console.error</code>。</p>
<h3 data-id="heading-7">3.1 第一步：在 AST Explorer 中观察</h3>
<p>输入源码：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'hello'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'oops'</span>);
</code></pre>
<p>观察 AST 结构，发现 <code>console.log('hello')</code> 是一个 <strong>CallExpression</strong> (调用表达式)。</p>
<ul>
<li>
<p><code>callee</code> 是一个 <strong>MemberExpression</strong> (成员表达式 <code>console.log</code>)。</p>
<ul>
<li><code>object</code>: <code>console</code> (Identifier)</li>
<li><code>property</code>: <code>log</code> (Identifier)</li>
</ul>
</li>
</ul>
<h3 data-id="heading-8">3.2 第二步：编写插件代码</h3>
<p>一个 Babel 插件就是一个函数，返回一个包含 <code>visitor</code> 的对象。</p>
<pre><code class="hljs language-lua" lang="lua">// my-babel-plugin.js
<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">({ types: t })</span></span> {
  <span class="hljs-keyword">return</span> {
    name: <span class="hljs-string">"remove-console-log"</span>,
    visitor: {
      // 监听 CallExpression 节点
      CallExpression(<span class="hljs-built_in">path</span>) {
        // <span class="hljs-number">1.</span> 获取 callee (被调用的函数，比如 console.<span class="hljs-built_in">log</span>)
        const { callee } = <span class="hljs-built_in">path</span>.node;

        // <span class="hljs-number">2.</span> 判断是否是成员表达式 (MemberExpression)，且不是计算属性 (a[<span class="hljs-string">'b'</span>])
        <span class="hljs-keyword">if</span> (t.isMemberExpression(callee) &amp;&amp; !callee.computed) {
          
          // <span class="hljs-number">3.</span> 检查 object 是不是 <span class="hljs-string">'console'</span>，property 是不是 <span class="hljs-string">'log'</span>
          <span class="hljs-keyword">if</span> (t.isIdentifier(callee.object, { name: <span class="hljs-string">'console'</span> }) &amp;&amp;
              t.isIdentifier(callee.property, { name: <span class="hljs-string">'log'</span> })) {
            
            // <span class="hljs-number">4.</span> 这里的 <span class="hljs-built_in">path</span> 就是 console.<span class="hljs-built_in">log</span>(<span class="hljs-string">'...'</span>) 这一整行
            // 直接由手术刀切除！
            <span class="hljs-built_in">path</span>.<span class="hljs-built_in">remove</span>();
          }
        }
      }
    }
  };
};
</code></pre>
<h3 data-id="heading-9">3.3 第三步：测试效果</h3>
<p><strong>输入：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'debug:'</span>, a);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'fatal error'</span>);
  <span class="hljs-keyword">return</span> a + b;
}
</code></pre>
<p><strong>输出：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'fatal error'</span>);
  <span class="hljs-keyword">return</span> a + b;
}
</code></pre>
<p><em>Bingo！</em> 你刚刚成功完成了一次代码外科手术。</p>
<hr/>
<h2 data-id="heading-10">四、 进阶：作用域 (Scope) 的魔咒</h2>
<p>架构师和普通开发者的区别在于对<strong>副作用</strong>的考虑。 上面的插件有个 Bug：如果用户自己定义了一个叫 <code>console</code> 的变量怎么办？</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">test</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> <span class="hljs-variable language_">console</span> = { <span class="hljs-attr">log</span>: <span class="hljs-function">() =&gt;</span> {} };
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'这不应该被删除'</span>); <span class="hljs-comment">// 我们的插件会错误地删除这一行！</span>
}
</code></pre>
<h3 data-id="heading-11">4.1 作用域检查</h3>
<p>Babel 的 <code>path.scope</code> 提供了强大的作用域分析能力。 我们需要检查：<code>console</code> 这个引用，是否<strong>绑定(Binding)</strong> 到了全局？还是被局部变量覆盖了？</p>
<p><strong>优化后的代码：</strong></p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">CallExpression</span>(path) {
  <span class="hljs-selector-tag">const</span> { <span class="hljs-selector-tag">callee</span> } = <span class="hljs-selector-tag">path</span><span class="hljs-selector-class">.node</span>;
  <span class="hljs-selector-tag">if</span> (t.<span class="hljs-built_in">isMemberExpression</span>(callee) &amp;&amp; 
      t.<span class="hljs-built_in">isIdentifier</span>(callee.object, { <span class="hljs-attribute">name</span>: <span class="hljs-string">'console'</span> }) &amp;&amp;
      t.<span class="hljs-built_in">isIdentifier</span>(callee.property, { <span class="hljs-attribute">name</span>: <span class="hljs-string">'log'</span> })) {

    <span class="hljs-comment">// 【新增】核心检查：获取 'console' 这个标识符的绑定信息</span>
    <span class="hljs-selector-tag">const</span> <span class="hljs-selector-tag">binding</span> = <span class="hljs-selector-tag">path</span><span class="hljs-selector-class">.scope</span><span class="hljs-selector-class">.getBinding</span>(<span class="hljs-string">'console'</span>);
    
    <span class="hljs-comment">// 如果没有绑定（说明是全局变量），才删除</span>
    <span class="hljs-selector-tag">if</span> (!binding) {
      <span class="hljs-selector-tag">path</span><span class="hljs-selector-class">.remove</span>();
    }
  }
}
</code></pre>
<p>现在，Babel 能够识别出局部变量 <code>console</code>，从而放过它。</p>
<hr/>
<h2 data-id="heading-12">五、 总结与脑洞：Babel 还能干什么？</h2>
<p>通过这个简单的例子，你掌握了 Babel 插件的精髓：<strong>Find (Visitor) -&gt; Check (Path/Types) -&gt; Modify (Remove/Replace)</strong> 。</p>
<p>在架构设计中，Babel 插件有无限的潜力：</p>
<ol>
<li><strong>自动埋点：</strong> 找到所有的 Click 事件函数，在函数体第一行自动插入 <code>track('click')</code> 代码。</li>
<li><strong>国际化 (i18n) 提取：</strong> 扫描所有中文字符串，自动提取到 JSON 文件中，并替换为 <code>t('key')</code>。</li>
<li><strong>代码卫士：</strong> 禁止使用某些落后的 API，一旦发现直接构建报错（比 ESLint 更暴力）。</li>
</ol>
<hr/>
<h2 data-id="heading-13">结语：从手术刀到守门员</h2>
<p>我们现在已经拥有了修改代码的手术刀（Babel Plugin）。 但是，手术刀太锋利了，容易伤人。在日常开发中，我们更多时候不需要“修改”代码，而是需要“检查”代码，或者进行大规模的、安全的“自动化重构”。</p>
<p>这时候，我们需要另一套基于 AST 的工具体系。</p>
<blockquote>
<p><strong>Next Step:</strong> 既然我们能分析代码结构，那是不是可以制定一套“代码法律”？ 下一节，我们将探讨**《第三篇：工具——代码质量的守门员：ESLint 原理、自定义规则与 Codemod 自动化重构》**。我们将学习如何编写自定义的 ESLint 规则，以及如何用 Codemod 瞬间修改 1000 个文件。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[为什么 InnoDB 中的反向索引扫描更慢？]]></title>    <link>https://juejin.cn/post/7600260767687622682</link>    <guid>https://juejin.cn/post/7600260767687622682</guid>    <pubDate>2026-01-29T02:13:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600260767687622682" data-draft-id="7600303087874998310" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么 InnoDB 中的反向索引扫描更慢？"/> <meta itemprop="keywords" content="数据库,MySQL"/> <meta itemprop="datePublished" content="2026-01-29T02:13:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="爱可生开源社区"/> <meta itemprop="url" content="https://juejin.cn/user/1480387593251847"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么 InnoDB 中的反向索引扫描更慢？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1480387593251847/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    爱可生开源社区
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T02:13:05.000Z" title="Thu Jan 29 2026 02:13:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>作者：马金友， 一名给 MySQL 找 bug 的初级 DBA。</p>
<p>爱可生开源社区出品，原创内容未经授权不得随意使用，转载请联系小编并注明来源。</p>
<p>本文约 1500 字，预计阅读需要 5 分钟。</p>
</blockquote>
<p>如果你注意到在 MySQL 中 <code>ORDER BY DESC</code> 查询比 <code>ORDER BY ASC</code> 稍微慢一些，不用担心 —— 这是已知且符合预期的行为。</p>
<p>这是因为 <strong>InnoDB 的设计和优化是为了进行正向扫描</strong>，它使用单向链表结构来组织页面上的记录。</p>
<p>因此，向前移动（<code>ASC</code>）的时间复杂度是 <code>O(1)</code>，而向后移动（<code>DESC</code>）的时间复杂度是 <code>O(n)</code>。</p>
<p>这篇博客将从存储层面的角度演示这两种算法。</p>
<h2 data-id="heading-0">1. InnoDB 页面结构</h2>
<h3 data-id="heading-1">1.1 单向链表</h3>
<p>InnoDB 使用单向链表来组织record。 每个页面有两个虚拟record：<code>infimum</code> 和 <code>supremum</code>，它们分别作为链表的<code>头部</code>和<code>尾部</code>。
一旦数据页面包含用户记录，链表就会按逻辑顺序显示。</p>
<pre><code class="hljs language-rust" lang="rust">infimum <span class="hljs-punctuation">-&gt;</span> rec1 <span class="hljs-punctuation">-&gt;</span> rec2 <span class="hljs-punctuation">-&gt;</span> rec3 <span class="hljs-punctuation">-&gt;</span> rec4 <span class="hljs-punctuation">-&gt;</span> ... <span class="hljs-punctuation">-&gt;</span> supremum
</code></pre>
<h3 data-id="heading-2">1.2 REC_NEXT</h3>
<p>每条记录在记录头中额外占用 <code>2</code> 个字节(byte)来存储指向下一条记录的偏移量。</p>
<pre><code class="hljs language-ini" lang="ini">constexpr uint32_t <span class="hljs-attr">REC_NEXT</span> = <span class="hljs-number">2</span><span class="hljs-comment">;</span>
constexpr uint32_t <span class="hljs-attr">REC_NEXT_MASK</span> = <span class="hljs-number">0</span>xFFFFUL<span class="hljs-comment">;</span>
</code></pre>
<p>例如，<code>infimum</code> 记录的 <code>REC_NEXT</code> 值是 <code>0x00, 0x0d</code>。</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">/** The page infimum and supremum of an empty page in ROW_FORMAT=COMPACT */</span>
<span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">byte</span> infimum_supremum_compact[] = {
    <span class="hljs-comment">/* the infimum record */</span>
    <span class="hljs-number">0x01</span> <span class="hljs-comment">/*n_owned=1*/</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x02</span> <span class="hljs-comment">/* heap_no=0, REC_STATUS_INFIMUM */</span>, <span class="hljs-number">0x00</span>,
    <span class="hljs-number">0x0d</span> <span class="hljs-comment">/* pointer to supremum */</span>, <span class="hljs-string">'i'</span>, <span class="hljs-string">'n'</span>, <span class="hljs-string">'f'</span>, <span class="hljs-string">'i'</span>, <span class="hljs-string">'m'</span>, <span class="hljs-string">'u'</span>, <span class="hljs-string">'m'</span>, <span class="hljs-number">0</span>,
    <span class="hljs-comment">/* the supremum record */</span>
    <span class="hljs-number">0x01</span> <span class="hljs-comment">/*n_owned=1*/</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x0b</span> <span class="hljs-comment">/* heap_no=1, REC_STATUS_SUPREMUM */</span>, <span class="hljs-number">0x00</span>,
    <span class="hljs-number">0x00</span> <span class="hljs-comment">/* end of record list */</span>, <span class="hljs-string">'s'</span>, <span class="hljs-string">'u'</span>, <span class="hljs-string">'p'</span>, <span class="hljs-string">'r'</span>, <span class="hljs-string">'e'</span>, <span class="hljs-string">'m'</span>, <span class="hljs-string">'u'</span>, <span class="hljs-string">'m'</span>};
</code></pre>
<p>通过 <code>infimum</code> 记录偏移 <code>0x000d</code>，可以得到 <code>supremum</code> 记录。</p>
<pre><code class="hljs language-ini" lang="ini">In <span class="hljs-section">[1]</span>: <span class="hljs-attr">infimum_supremum_compact</span> = [
   ...:     <span class="hljs-number">0</span>x01 , <span class="hljs-number">0</span>x00, <span class="hljs-number">0</span>x02 , <span class="hljs-number">0</span>x00,
   ...:     <span class="hljs-number">0</span>x0d , <span class="hljs-string">'i'</span>, <span class="hljs-string">'n'</span>, <span class="hljs-string">'f'</span>, <span class="hljs-string">'i'</span>, <span class="hljs-string">'m'</span>, <span class="hljs-string">'u'</span>, <span class="hljs-string">'m'</span>, <span class="hljs-number">0</span>,
   ...:     <span class="hljs-number">0</span>x01 , <span class="hljs-number">0</span>x00, <span class="hljs-number">0</span>x0b, <span class="hljs-number">0</span>x00,
   ...:     <span class="hljs-number">0</span>x00, <span class="hljs-string">'s'</span>, <span class="hljs-string">'u'</span>, <span class="hljs-string">'p'</span>, <span class="hljs-string">'r'</span>, <span class="hljs-string">'e'</span>, <span class="hljs-string">'m'</span>, <span class="hljs-string">'u'</span>, <span class="hljs-string">'m'</span>
   ...: ]
   ...:

In <span class="hljs-section">[2]</span>: infimum_supremum_compact<span class="hljs-section">[5]</span>
Out<span class="hljs-section">[2]</span>: 'i'

In <span class="hljs-section">[3]</span>: infimum_supremum_compact<span class="hljs-section">[5+0x000d]</span>
Out<span class="hljs-section">[3]</span>: 's'
</code></pre>
<h3 data-id="heading-3">1.3 页面目录 (Page Directory)</h3>
<p>由于单向链表的数据结构，InnoDB 必须扫描整个链表才能找到一条 record，这效率很低。</p>
<p>InnoDB 在每个数据页的末尾维护一个动态数组（page directory），数组中的每个元素（槽/slot）存储一条record的位置。</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">/* We define a slot in the page directory as two bytes */</span>
<span class="hljs-keyword">constexpr</span> <span class="hljs-type">uint32_t</span> PAGE_DIR_SLOT_SIZE = <span class="hljs-number">2</span>;
</code></pre>
<p>它不是存储每条记录的地址，而是每个槽指向该槽所管理记录中的最后一条记录。一个槽通常管理 4 到 8 条记录。</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">/* The maximum and minimum number of records owned by a directory slot. The
number may drop below the minimum in the first and the last slot in the
directory. */</span>
<span class="hljs-keyword">constexpr</span> <span class="hljs-type">uint32_t</span> PAGE_DIR_SLOT_MAX_N_OWNED = <span class="hljs-number">8</span>;
<span class="hljs-keyword">constexpr</span> <span class="hljs-type">uint32_t</span> PAGE_DIR_SLOT_MIN_N_OWNED = <span class="hljs-number">4</span>;
</code></pre>
<p>第一个槽总是指向 <code>infimum</code>，最后一个槽总是指向 <code>supremum</code>。</p>
<h3 data-id="heading-4">1.4 N_OWNED</h3>
<p>每条记录在记录头中占用 4 个位（bit）来存储 <code>N_OWNED</code>。</p>
<pre><code class="hljs language-ini" lang="ini">constexpr uint32_t <span class="hljs-attr">REC_NEW_N_OWNED</span> = <span class="hljs-number">5</span><span class="hljs-comment">; /* This is single byte bit-field */</span>
constexpr uint32_t <span class="hljs-attr">REC_N_OWNED_MASK</span> = <span class="hljs-number">0</span>xFUL<span class="hljs-comment">;</span>
</code></pre>
<p>如果记录是槽中的最后一条记录，它的值就是该槽拥有的记录数。否则，值为 <code>0</code>。</p>
<h2 data-id="heading-5">2. 示例</h2>
<p>下图展示了数据页面的布局</p>
<p><img src="http://openwrite.cn/uploads/16955/59082/58dd74c4-d31d-409e-bf02-ea61f3f3b475.jpg" alt="微信图片_20260120101037_46_176.jpg" loading="lazy"/></p>
<ul>
<li>橙色箭头连接了从 <code>rec0</code> 到 <code>rec23</code> 的 24 条用户记录。</li>
<li>灰色箭头指向槽所管理的最后一条记录。
槽 <code>0</code> 指向 <code>infimum</code>，它包含 1 条记录。
槽 <code>n</code> 指向 <code>supremum</code>，它包含 5 条记录。
槽 <code>1</code> 指向 <code>rec3</code>，它包含 4 条记录。</li>
</ul>
<h2 data-id="heading-6">3. 算法</h2>
<p>我们将使用以下逻辑 InnoDB 页面布局来理解这两种扫描算法。</p>
<p><img src="http://openwrite.cn/uploads/16955/59082/929d9aa6-51d4-49b9-ba57-20605ac39206.jpg" alt="微信图片_20260120101032_45_176.jpg" loading="lazy"/></p>
<h3 data-id="heading-7">3.1 正向扫描 (Forward Scan)</h3>
<p>从 <code>rec10</code> 找到页面上的下一条记录很容易。</p>
<ol>
<li>读取 <code>REC_NEXT</code> 偏移量</li>
</ol>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">field_value</span> = mach_read_from_2(rec - REC_NEXT)<span class="hljs-comment">;</span>
</code></pre>
<ol start="2">
<li>获取下一条记录的位置</li>
</ol>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">return</span> (ut_align_offset(rec + field_value, UNIV_PAGE_SIZE));
</code></pre>
<h3 data-id="heading-8">3.2 反向扫描 (Backward Scan)</h3>
<p>从<code>rec10</code>找到页面上的前一条记录会更困难。</p>
<h4 data-id="heading-9">3.2.1 查找哪个槽管理了当前记录 (page_dir_find_owner_slot)</h4>
<p>① 扫描从当前记录开始的所有记录，直到 <code>n_owned</code> 不为 <code>0</code>。</p>
<pre><code class="hljs language-ini" lang="ini">while (rec_get_n_owned_new(r) == 0) {
      <span class="hljs-attr">r</span> = rec_get_next_ptr_const(r, <span class="hljs-literal">true</span>)<span class="hljs-comment">;</span>
      ...
    }
</code></pre>
<p>它会检查 rec10，然后是 rec11。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[rec10]</span> --&gt; <span class="hljs-selector-attr">[rec11]</span>
  ^

  
<span class="hljs-selector-attr">[rec10]</span> --&gt; <span class="hljs-selector-attr">[rec11]</span>
              ^
</code></pre>
<p>因为 rec11 的 n_owned 是 4，所以会跳转到步骤 1.2。</p>
<p>② 检查所有槽，直到找到指向步骤 1.1 中记录 r 的槽。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">rec_offs_bytes</span> = mach_encode_2(r - page)<span class="hljs-comment">;</span>

  while (UNIV_LIKELY(*(uint16 *)slot != rec_offs_bytes)) {
  ....
    slot += PAGE_DIR_SLOT_SIZE<span class="hljs-comment">;</span>
  }
  
  return (((ulint)(first_slot - slot)) / PAGE_DIR_SLOT_SIZE)<span class="hljs-comment">;</span>
</code></pre>
<p>它会从最后一个槽（slot n）开始扫描到 slot 0。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[n]</span>...<span class="hljs-selector-attr">[4]</span><span class="hljs-selector-attr">[3]</span><span class="hljs-selector-attr">[2]</span><span class="hljs-selector-attr">[1]</span><span class="hljs-selector-attr">[0]</span>
 ^
</code></pre>
<p>因为 slot n 指向 supremum（不是 rec11），所以会检查下一个槽（slot 4）。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[n]</span>...<span class="hljs-selector-attr">[4]</span><span class="hljs-selector-attr">[3]</span><span class="hljs-selector-attr">[2]</span><span class="hljs-selector-attr">[1]</span><span class="hljs-selector-attr">[0]</span>
       ^
</code></pre>
<p>因为 slot 4 指向 rec15（不是 rec11），所以会检查下一个槽（slot 3）。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[n]</span>...<span class="hljs-selector-attr">[4]</span><span class="hljs-selector-attr">[3]</span><span class="hljs-selector-attr">[2]</span><span class="hljs-selector-attr">[1]</span><span class="hljs-selector-attr">[0]</span>
          ^
</code></pre>
<p>因为 slot 3 指向 rec11，所以会返回 3。</p>
<h4 data-id="heading-10">3.2.2 扫描当前slot group 以查找前一条记录</h4>
<p>① 跳转到前一个槽。 因为 slot 3 只持有slot group的最后一条记录，它无法扫描 slot 3 中的所有记录。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">slot</span> = page_dir_get_nth_slot(page, slot_<span class="hljs-literal">no</span> - <span class="hljs-number">1</span>)<span class="hljs-comment">;</span>

  <span class="hljs-attr">rec2</span> = page_dir_slot_get_rec(slt)<span class="hljs-comment">;</span>
</code></pre>
<p>幸运的是，它可以利用<code>前</code>一个槽组的最后一条记录来扫描当前槽组中的所有record。</p>
<p>通过检查 slot 2，它会找到 rec7。</p>
<p>② 扫描槽组中的所有记录所有 record 匹配当前 record。</p>
<pre><code class="hljs language-ini" lang="ini">while (rec != rec2) {
      <span class="hljs-attr">prev_rec</span> = rec2<span class="hljs-comment">;</span>
      <span class="hljs-attr">rec2</span> = page_rec_get_next_low(rec2, <span class="hljs-literal">true</span>)<span class="hljs-comment">;</span>
    }
    
    return (prev_rec)<span class="hljs-comment">;</span>
</code></pre>
<p>它会检查 rec7、rec8、rec9，然后是 rec10，直到找到 rec10 的前一条 record，即 rec9。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[rec7]</span> --&gt; <span class="hljs-selector-attr">[rec8]</span> --&gt; <span class="hljs-selector-attr">[rec9]</span> --&gt; <span class="hljs-selector-attr">[rec10]</span> --&gt; <span class="hljs-selector-attr">[rec11]</span>
  ^
</code></pre>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[rec7]</span> --&gt; <span class="hljs-selector-attr">[rec8]</span> --&gt; <span class="hljs-selector-attr">[rec9]</span> --&gt; <span class="hljs-selector-attr">[rec10]</span> --&gt; <span class="hljs-selector-attr">[rec11]</span>
             ^
</code></pre>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[rec7]</span> --&gt; <span class="hljs-selector-attr">[rec8]</span> --&gt; <span class="hljs-selector-attr">[rec9]</span> --&gt; <span class="hljs-selector-attr">[rec10]</span> --&gt; <span class="hljs-selector-attr">[rec11]</span>
                        ^
</code></pre>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[rec7]</span> --&gt; <span class="hljs-selector-attr">[rec8]</span> --&gt; <span class="hljs-selector-attr">[rec9]</span> --&gt; <span class="hljs-selector-attr">[rec10]</span> --&gt; <span class="hljs-selector-attr">[rec11]</span>
                                   ^
</code></pre>
<h2 data-id="heading-11">4. 时间复杂度</h2>
<p>正向扫描是 <code>O(1)</code>，但反向扫描是 <code>O(n)</code>，其中 <code>n</code> 是页面目录中的槽数。</p>
<h2 data-id="heading-12">5. 基准测试</h2>
<h3 data-id="heading-13">5.1 正向扫描 (Forward scan)</h3>
<pre><code class="hljs language-sql" lang="sql">mysql <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> k <span class="hljs-keyword">from</span> sbtest1 <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> k <span class="hljs-keyword">asc</span> limit <span class="hljs-number">9999999</span>, <span class="hljs-number">1</span>;
<span class="hljs-operator">+</span><span class="hljs-comment">---------+</span>
<span class="hljs-operator">|</span> k       <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">---------+</span>
<span class="hljs-operator">|</span> <span class="hljs-number">8670945</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">---------+</span>
<span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">1.41</span> sec)

mysql <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">desc</span> <span class="hljs-keyword">select</span> k <span class="hljs-keyword">from</span> sbtest1 <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> k <span class="hljs-keyword">asc</span> limit <span class="hljs-number">9999999</span>, <span class="hljs-number">1</span>\G
<span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-number">1.</span> <span class="hljs-type">row</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span>
           id: <span class="hljs-number">1</span>
  select_type: SIMPLE
        <span class="hljs-keyword">table</span>: sbtest1
   partitions: <span class="hljs-keyword">NULL</span>
         type: index
possible_keys: <span class="hljs-keyword">NULL</span>
          key: k_1
      key_len: <span class="hljs-number">4</span>
          <span class="hljs-keyword">ref</span>: <span class="hljs-keyword">NULL</span>
         <span class="hljs-keyword">rows</span>: <span class="hljs-number">9864216</span>
     filtered: <span class="hljs-number">100.00</span>
        Extra: <span class="hljs-keyword">Using</span> index
<span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)
</code></pre>
<h3 data-id="heading-14">5.2 反向扫描 (Backward scan)</h3>
<pre><code class="hljs language-sql" lang="sql">mysql <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> k <span class="hljs-keyword">from</span> sbtest1 <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> k <span class="hljs-keyword">desc</span> limit <span class="hljs-number">9999999</span>, <span class="hljs-number">1</span>;
<span class="hljs-operator">+</span><span class="hljs-comment">---------+</span>
<span class="hljs-operator">|</span> k       <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">---------+</span>
<span class="hljs-operator">|</span> <span class="hljs-number">1184614</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">---------+</span>
<span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">2.01</span> sec)

mysql <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">desc</span> <span class="hljs-keyword">select</span> k <span class="hljs-keyword">from</span> sbtest1 <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> k <span class="hljs-keyword">desc</span> limit <span class="hljs-number">9999999</span>, <span class="hljs-number">1</span>\G
<span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-number">1.</span> <span class="hljs-type">row</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span>
           id: <span class="hljs-number">1</span>
  select_type: SIMPLE
        <span class="hljs-keyword">table</span>: sbtest1
   partitions: <span class="hljs-keyword">NULL</span>
         type: index
possible_keys: <span class="hljs-keyword">NULL</span>
          key: k_1
      key_len: <span class="hljs-number">4</span>
          <span class="hljs-keyword">ref</span>: <span class="hljs-keyword">NULL</span>
         <span class="hljs-keyword">rows</span>: <span class="hljs-number">9864216</span>
     filtered: <span class="hljs-number">100.00</span>
        Extra: Backward index scan; <span class="hljs-keyword">Using</span> index
<span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)
</code></pre>
<h2 data-id="heading-15">References</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmysql%2Fmysql-server%2Fblob%2Fmysql-8.4.6%2Fstorage%2Finnobase%2Finclude%2Fbtr0pcur.h%23L860" target="_blank" title="https://github.com/mysql/mysql-server/blob/mysql-8.4.6/storage/innobase/include/btr0pcur.h#L860" ref="nofollow noopener noreferrer">btr_pcur_t::move_to_next</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmysql%2Fmysql-server%2Fblob%2Fmysql-8.4.6%2Fstorage%2Finnobase%2Fbtr%2Fbtr0pcur.cc%23L418" target="_blank" title="https://github.com/mysql/mysql-server/blob/mysql-8.4.6/storage/innobase/btr/btr0pcur.cc#L418" ref="nofollow noopener noreferrer">btr_pcur_t::move_to_prev</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用 NanUI 快速创建具有现代用户界面的 WinForm 应用程序]]></title>    <link>https://juejin.cn/post/7600601482690723886</link>    <guid>https://juejin.cn/post/7600601482690723886</guid>    <pubDate>2026-01-29T13:03:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600601482690723886" data-draft-id="7600414546190286858" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用 NanUI 快速创建具有现代用户界面的 WinForm 应用程序"/> <meta itemprop="keywords" content="后端,.NET"/> <meta itemprop="datePublished" content="2026-01-29T13:03:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="追逐时光者"/> <meta itemprop="url" content="https://juejin.cn/user/2770425031690333"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用 NanUI 快速创建具有现代用户界面的 WinForm 应用程序
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2770425031690333/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    追逐时光者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T13:03:43.000Z" title="Thu Jan 29 2026 13:03:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>今天大姚给大家分享一个强大的 .NET 开源框架，它利用 Web 技术（HTML5、CSS3、JavaScript）为 WinForm 应用程序构建现代化的用户界面：NanUI。</p>
<p>如果你正在寻找一个用于创建具有现代用户界面的 WinForm 应用程序的框架，NanUI 是一个不错的选择。</p>
<h2 data-id="heading-1">项目介绍</h2>
<p>NanUI 是一个基于 .NET 平台的开源（MIT License）框架，旨在帮助开发者使用 HTML5、CSS3 和 JavaScript 构建具有现代感的 WinForm 应用程序用户界面。它底层依托于 Xilium.CefGlue 这是 Chromium Embedded Framework（CEF）在 .NET 环境下的官方绑定实现，通过嵌入完整的 Chromium 渲染引擎，使 WinForm 应用能够呈现 Web 技术驱动的富交互界面。</p>
<h2 data-id="heading-2">基本原理</h2>
<p><strong>官方介绍：</strong> <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/936bb8c441a9473cbdebb9fffe0a14e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770296623&amp;x-signature=PpObB%2FqRcdRVwLVoN%2Fs41lpHWtY%3D" alt="" loading="lazy"/></p>
<p><strong>基本原理概括：</strong></p>
<ul>
<li><strong>Chromium Embedded Framework (CEF)</strong> 是一个开源项目，一个用于将基于 Chromium 的浏览器嵌入其他应用程序的简单框架。</li>
<li>它提供稳定的 C/C++ API，支持多进程架构（Browser 进程 + Renderer/GPU 等子进程），具备完整的 HTML5 渲染、JavaScript 执行、网络请求、安全沙箱等能力。</li>
<li>NanUI 并未直接调用 CEF 的 C 接口，而是基于 <strong>Xilium.CefGlue</strong> 这是一个高质量的 .NET 封装库，将 CEF 的 C++ API 转换为 C# 可调用的托管接口。</li>
</ul>
<h2 data-id="heading-3">环境要求</h2>
<h3 data-id="heading-4">开发环境</h3>
<ul>
<li>Visual Studio 2019 或更高版本。</li>
<li>NET Framework 4.6.2 或更高版本 / .NET 6.0 或更高版本。</li>
</ul>
<h3 data-id="heading-5">部署环境</h3>
<ul>
<li>.NET Framework 4.6.2 或更高版本。</li>
<li>.NET 6.0 需要 Windows 7 Service Pack 1 或更高版本。</li>
<li>.NET 7.0/8.0/9.0 需要 Windows 10 或 Windows 11。</li>
<li>Microsoft Windows 7 Service Pack 1 或更高版本。</li>
</ul>
<h2 data-id="heading-6">项目源代码</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/547e942f350b42e1aecb767505252310~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770296623&amp;x-signature=e%2Be48s1%2BXuAR9pI%2B6rVh1yeWvWE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">快速使用</h2>
<h3 data-id="heading-8">创建一个 WinForm 应用程序</h3>
<p>首先我们快速创建一个名为<code>NanUIExercise</code> Windows 窗体应用程序：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2884a370369f4be4b222c02fd6ddeba4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770296623&amp;x-signature=0XcDslTRTewdtYbDOj274ZVFWlo%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f031758a598848afa62c620084fa137d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770296623&amp;x-signature=Z7JTOrYoS5Xba0NhFs0qtgar%2FG4%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61eec09e8e6d443fb6c0be956b31e425~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770296623&amp;x-signature=cxsqJzURS5O2%2Fe%2F77c18SkScBjc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-9">安装 NanUI NuGet 包</h3>
<p>安装 <code>NanUI</code> 包 <code>NetDimension.NanUI</code> ：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f922b7ffd26486597b27e346e846444~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770296623&amp;x-signature=BDPFMhbkWDIePrWeDoYHCSNOuOk%3D" alt="" loading="lazy"/></p>
<p>安装 <code>NanUI</code> 所依赖的 <code>Chromium Embedded Framework</code> 依赖包 <code>NetDimension.NanUI.Runtime</code>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad6d3aace26d47e18a2560bbefbf033d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770296623&amp;x-signature=prduxXfdRolkd7y%2Fc20U75UCa8g%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">创建一个基本的 NanUI 应用程序</h3>
<p><strong>Program.cs：</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> NetDimension.NanUI;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">NanUIExercise</span>
{
    <span class="hljs-keyword">internal</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
    {
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span>  The main entry point for the application.</span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
        [<span class="hljs-meta">STAThread</span>]
        <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>()</span>
        {
            <span class="hljs-keyword">var</span> builder = NanUIApp.CreateBuilder();

            builder.UseNanUIApp&lt;MyFirstAPP&gt;();

            <span class="hljs-keyword">var</span> app = builder.Build();

            app.Run();
        }
    }
}
</code></pre>
<p><strong>创建一个类继承 AppStartup 来配置应用程序：</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> Microsoft.Extensions.DependencyInjection;
<span class="hljs-keyword">using</span> NetDimension.NanUI;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">NanUIExercise</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MyFirstAPP</span> : <span class="hljs-title">AppStartup</span>
    {
        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> MainWindowCreationAction? UseMainWindow(MainWindowOptions opts)
        {
            <span class="hljs-comment">// 设置应用程序的主窗体</span>
            <span class="hljs-keyword">return</span> opts.UseMainFormium&lt;MyWindow&gt;();
        }

        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ProgramMain</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
        {
            <span class="hljs-comment">// Main函数中的代码应该在这里，该函数只在主进程中运行。这样可以防止子进程运行一些不正确的初始化代码。</span>
            ApplicationConfiguration.Initialize();
        }

        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigurationChromiumEmbedded</span>(<span class="hljs-params">ChromiumEnvironmentBuiler cef</span>)</span>
        {
            <span class="hljs-comment">// 在此处配置 Chromium Embedded Framwork</span>
        }

        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)</span>
        {
            <span class="hljs-comment">// 在这里配置该应用程序的服务</span>
        }
    }
}
</code></pre>
<p><strong>创建一个类实现 Formium，用于配置应用程序的主窗口：</strong></p>
<pre><code class="hljs language-ini" lang="ini">using NetDimension.NanUI<span class="hljs-comment">;</span>
using NetDimension.NanUI.Forms<span class="hljs-comment">;</span>

namespace NanUIExercise
{
    public class MyWindow : Formium
    {
        public MyWindow()
        {
            <span class="hljs-attr">Url</span> = <span class="hljs-string">"https://juejin.cn/"</span><span class="hljs-comment">;</span>
        }

        protected override FormStyle ConfigureWindowStyle(WindowStyleBuilder builder)
        {
            // 此处配置窗口的样式和属性，或留空以使用默认样式

            var <span class="hljs-attr">style</span> = builder.UseSystemForm()<span class="hljs-comment">;</span>

            <span class="hljs-attr">style.TitleBar</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>

            <span class="hljs-attr">style.DefaultAppTitle</span> = <span class="hljs-string">"My First NanUI App"</span><span class="hljs-comment">;</span>

            return style<span class="hljs-comment">;</span>
        }
    }
}
</code></pre>
<p><strong>运行效果查看：</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36bffd063d3a49aaa51c94636f8de74c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770296623&amp;x-signature=zN3tOH%2FNXodw96cXkzDtU0sNxeg%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2414c969cc764693927583dba165f224~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770296623&amp;x-signature=UYvqRypd9ntuYyvcB%2Bs%2Fgljaexg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-11">项目源码地址</h2>
<p>更多项目实用功能和特性欢迎前往项目开源地址查看👀，别忘了给项目一个Star支持💖。</p>
<ul>
<li><strong>Gitee开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fdotnetchina%2FNanUI" target="_blank" title="https://gitee.com/dotnetchina/NanUI" ref="nofollow noopener noreferrer">gitee.com/dotnetchina…</a></li>
<li><strong>项目文档地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fdotnetchina%2FNanUI%2Fblob%2Fmaster%2Fdocs%2FREADME.md" target="_blank" title="https://gitee.com/dotnetchina/NanUI/blob/master/docs/README.md" ref="nofollow noopener noreferrer">gitee.com/dotnetchina…</a></li>
</ul>
<h2 data-id="heading-12">优秀项目和框架精选</h2>
<p>该项目已收录到C#/.NET/.NET Core优秀项目和框架精选中，关注优秀项目和框架精选能让你及时了解C#、.NET和.NET Core领域的最新动态和最佳实践，提高开发工作效率和质量。坑已挖，欢迎大家踊跃提交PR推荐或自荐（<strong>让优秀的项目和框架不被埋没🤞</strong>）。</p>
<ul>
<li><strong>GitHub开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYSGStudyHards%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectPicks.md" target="_blank" title="https://github.com/YSGStudyHards/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md" ref="nofollow noopener noreferrer">github.com/YSGStudyHar…</a></li>
<li><strong>Gitee开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fysgdaydayup%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectPicks.md" target="_blank" title="https://gitee.com/ysgdaydayup/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md" ref="nofollow noopener noreferrer">gitee.com/ysgdaydayup…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AOT编译详解与应用实战]]></title>    <link>https://juejin.cn/post/7600333405978656809</link>    <guid>https://juejin.cn/post/7600333405978656809</guid>    <pubDate>2026-01-29T03:10:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600333405978656809" data-draft-id="7600430748780281899" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AOT编译详解与应用实战"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-29T03:10:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT橘子皮"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AOT编译详解与应用实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT橘子皮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T03:10:58.000Z" title="Thu Jan 29 2026 03:10:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    15
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、AOT编译基础概念与核心原理</h2>
<p>AOT（Ahead-of-Time，预先编译）是一种<strong>在程序运行前将代码编译为机器码</strong>的技术，与JIT（Just-in-Time，即时编译）的“运行时编译”形成鲜明对比。其核心目标是<strong>消除运行时的编译开销</strong>，提升应用启动速度和运行性能，同时降低内存占用。</p>
<h3 data-id="heading-1">1. AOT与JIT的关键差异</h3>



































<table><thead><tr><th><strong>特性</strong>​</th><th><strong>AOT编译</strong>​</th><th><strong>JIT编译</strong>​</th></tr></thead><tbody><tr><td>编译时机</td><td>构建阶段（开发/打包时）</td><td>运行时（应用启动时）</td></tr><tr><td>启动性能</td><td>快（直接执行预编译代码）</td><td>慢（需下载/初始化JVM+编译代码）</td></tr><tr><td>应用体积</td><td>小（不包含JVM/编译器）</td><td>大（包含JVM/编译器）</td></tr><tr><td>错误检测</td><td>构建时发现（语法/类型错误）</td><td>运行时发现（可能导致崩溃）</td></tr><tr><td>适用场景</td><td>生产环境（微服务/Serverless）</td><td>开发环境（动态调试）</td></tr></tbody></table>
<h3 data-id="heading-2">2. AOT编译的核心原理</h3>
<p>Java中的AOT编译依赖<strong>GraalVM Native Image</strong>技术，将Java字节码转换为操作系统原生镜像（如Linux的ELF文件、Windows的PE文件）。其核心流程分为三步：</p>
<h4 data-id="heading-3">（1）静态分析与优化（构建时）</h4>
<p>Spring Boot 3.x的<strong>AOT处理器</strong>会扫描应用上下文，提前解析<code>@Component</code>、<code>@Bean</code>等注解，生成<strong>静态Bean定义</strong>（替代运行时的组件扫描）；同时，移除动态特性依赖（如反射、动态代理），若无法避免，需手动配置<code>reflect-config.json</code>声明。</p>
<h4 data-id="heading-4">（2）字节码增强（构建时）</h4>
<p>通过<code>spring-aot-maven-plugin</code>插件，生成适配原生编译的代码：</p>
<ul>
<li>替换Spring的动态组件扫描为<strong>静态Bean注册</strong>；</li>
<li>将<code>ApplicationContext</code>的初始化逻辑固化，避免运行时反射调用；</li>
<li>优化自动配置，只保留应用实际依赖的配置类。</li>
</ul>
<h4 data-id="heading-5">（3）原生镜像构建（构建时）</h4>
<p>借助<strong>GraalVM</strong>，将增强后的字节码编译为原生镜像：</p>
<ul>
<li>支持跨平台编译（Linux、Windows、macOS）；</li>
<li>镜像包含应用代码、依赖库和<strong>最小化的JVM运行时</strong>（仅保留必要模块）；</li>
<li>编译时进行<strong>逃逸分析</strong>、<strong>死码消除</strong>，进一步减小镜像体积。</li>
</ul>
<h2 data-id="heading-6">二、AOT编译的应用场景与优势</h2>
<p>AOT编译是<strong>Java生产环境的关键优化手段</strong>，尤其适合以下场景：</p>
<h3 data-id="heading-7">1. 生产环境部署（微服务/Serverless）</h3>
<ul>
<li><strong>更快的启动速度</strong>：原生镜像无需初始化JVM，启动时间从秒级降至毫秒级（如Spring Boot应用启动时间从30秒缩短至300毫秒）；</li>
<li><strong>更小的内存占用</strong>：移除JVM开销后，内存占用可减少50%以上（如2GB内存占用降至1GB以下）；</li>
<li><strong>更简单的部署</strong>：原生镜像包含所有依赖，无需在目标环境安装JDK，简化容器化部署（如Docker镜像体积减小30%）。</li>
</ul>
<h3 data-id="heading-8">2. 大型应用优化（Spring Boot 大型项目）</h3>
<p>对于大型Spring Boot应用，AOT编译的<strong>提前错误检测</strong>能避免运行时崩溃（如模板中的语法错误、类型不匹配）；同时，<strong>静态Bean定义</strong>减少了运行时的组件扫描开销，提升应用稳定性。</p>
<h3 data-id="heading-9">3. 云原生与边缘计算</h3>
<p>在云原生（如Kubernetes）或边缘计算场景中，AOT编译的<strong>快速启动</strong>和<strong>低内存占用</strong>能更好地适应弹性伸缩（如Serverless函数的冷启动优化），以及资源受限的边缘设备（如物联网网关）。</p>
<h2 data-id="heading-10">三、AOT编译的应用实战（Spring Boot 3.x 为例）</h2>
<p>以下结合<strong>Spring Boot 3.x</strong>（依赖Spring Framework 6+），详细说明AOT编译的配置与实践。</p>
<h3 data-id="heading-11">1. 环境准备</h3>
<ul>
<li><strong>JDK</strong>：OpenJDK 17+（Spring Boot 3.x最低要求）；</li>
<li><strong>构建工具</strong>：Maven 3.8+ 或 Gradle 7.5+；</li>
<li><strong>原生编译工具</strong>：GraalVM CE 21+（需配置<code>GRAALVM_HOME</code>环境变量）。</li>
</ul>
<h3 data-id="heading-12">2. 项目配置（Maven 示例）</h3>
<h4 data-id="heading-13">（1）引入Spring Boot 3.x依赖</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.2.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Web依赖 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- AOT测试依赖 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h4 data-id="heading-14">（2）配置AOT插件</h4>
<p>在<code>pom.xml</code>中添加<code>spring-boot-maven-plugin</code>，启用AOT编译：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.2.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                <span class="hljs-comment">&lt;!-- 启用AOT编译 --&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">aot</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">aot</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
</code></pre>
<h3 data-id="heading-15">3. 编写核心代码（REST 接口示例）</h3>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@SpringBootApplication</span>
<span class="hljs-variable">@RestController</span>
public class AotDemoApplication {
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">static</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">main</span>(String[] args) {
        <span class="hljs-selector-tag">SpringApplication</span><span class="hljs-selector-class">.run</span>(AotDemoApplication.class, args);
    }

    <span class="hljs-comment">// 简单REST接口</span>
    @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/hello"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">hello</span>(<span class="hljs-variable">@RequestParam</span> String name) {
        <span class="hljs-selector-tag">return</span> "<span class="hljs-selector-tag">Hello</span>, " + <span class="hljs-selector-tag">name</span> + "! <span class="hljs-selector-tag">This</span> <span class="hljs-selector-tag">is</span> <span class="hljs-selector-tag">Spring</span> <span class="hljs-selector-tag">Boot</span> <span class="hljs-number">3</span> <span class="hljs-selector-tag">AOT</span> <span class="hljs-selector-tag">Demo</span>.";
    }
}
</code></pre>
<h3 data-id="heading-16">4. 构建原生镜像</h3>
<p>执行Maven命令，自动完成AOT处理和原生镜像构建：</p>
<pre><code class="hljs language-go" lang="go">mvn clean <span class="hljs-keyword">package</span> -Pnative
</code></pre>
<p>构建成功后，在<code>target</code>目录下生成原生镜像文件（如<code>aot-demo</code>），直接运行（无需JVM）：</p>
<pre><code class="hljs language-bash" lang="bash">./target/aot-demo
</code></pre>
<h3 data-id="heading-17">5. 关键优化点</h3>
<h4 data-id="heading-18">（1）处理反射（必选）</h4>
<p>GraalVM默认不支持动态反射，需通过<code>RuntimeHints</code>（Spring 6+）配置：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomRuntimeHints</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RuntimeHintsRegistrar</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">registerHints</span>(<span class="hljs-params">RuntimeHints hints, ClassLoader classLoader</span>) {
        <span class="hljs-comment">// 注册反射类</span>
        hints.<span class="hljs-title function_">reflection</span>().<span class="hljs-title function_">registerType</span>(<span class="hljs-title class_">User</span>.<span class="hljs-property">class</span>, builder -&gt; 
            builder.<span class="hljs-title function_">withMembers</span>(<span class="hljs-title class_">MemberCategory</span>.<span class="hljs-property">INVOKE_DECLARED_CONSTRUCTORS</span>)
        );
        <span class="hljs-comment">// 注册代理接口</span>
        hints.<span class="hljs-title function_">proxies</span>().<span class="hljs-title function_">registerJdkProxy</span>(<span class="hljs-title class_">UserInterface</span>.<span class="hljs-property">class</span>);
    }
}
</code></pre>
<h4 data-id="heading-19">（2）避免动态代理（可选）</h4>
<p>尽量使用静态代理，或在<code>RuntimeHints</code>中注册代理接口（如上例）。</p>
<h4 data-id="heading-20">（3）优化镜像体积（可选）</h4>
<p>通过<code>GraalVM</code>的<code>--gc=G1</code>、<code>--compact</code>等参数减小镜像体积：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.graalvm.buildtools<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>native-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">buildArgs</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">buildArg</span>&gt;</span>--gc=G1<span class="hljs-tag">&lt;/<span class="hljs-name">buildArg</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">buildArg</span>&gt;</span>--compact<span class="hljs-tag">&lt;/<span class="hljs-name">buildArg</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">buildArgs</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
</code></pre>
<h2 data-id="heading-21">四、AOT编译的常见问题与解决方案</h2>
<p>尽管AOT编译优势显著，但仍有一些<strong>常见限制</strong>需解决：</p>
<h3 data-id="heading-22">1. 反射兼容性问题</h3>
<p><strong>问题</strong>：反射调用未配置的类/方法，导致<code>MissingMetadataException</code>。</p>
<p><strong>解决方案</strong>：</p>
<ul>
<li>使用<code>RuntimeHints</code>（Spring 6+）配置反射元数据；</li>
<li>避免在AOT中使用动态反射（如<code>Class.forName()</code>），改用静态类型。</li>
</ul>
<h3 data-id="heading-23">2. 动态代理与代码生成</h3>
<p><strong>问题</strong>：<code>System.Reflection.Emit</code>（动态生成代码）不支持。</p>
<p><strong>解决方案</strong>：</p>
<ul>
<li>改用<strong>源码生成器</strong>（Source Generators）或预生成代码；</li>
<li>使用静态代理替代动态代理。</li>
</ul>
<h3 data-id="heading-24">3. 第三方库兼容性</h3>
<p><strong>问题</strong>：部分第三方库（如<code>Microsoft.Extensions.AI</code>预览版）依赖JIT编译。</p>
<p><strong>解决方案</strong>：</p>
<ul>
<li>检查库的AOT兼容性（参考Spring Native Hints）；</li>
<li>在<code>rd.xml</code>中添加配置保留必要元数据。</li>
</ul>
<h3 data-id="heading-25">4. 调试困难</h3>
<p><strong>问题</strong>：AOT编译后的代码是机器码，调试困难。</p>
<p><strong>解决方案</strong>：</p>
<ul>
<li>通过<code>-H:GenerateDebugInfo=1</code>生成带调试信息的镜像；</li>
<li>使用<code>jstack</code>（Java）或<code>dotnet trace</code>（.NET）进行性能分析。</li>
</ul>
<h2 data-id="heading-26">五、总结</h2>
<p>AOT编译是<strong>Java生产环境的关键优化手段</strong>，通过“提前编译”消除运行时开销，提升应用启动速度和稳定性。其核心价值在于：</p>
<ul>
<li><strong>更快的启动速度</strong>：直接执行预编译代码，无需运行时编译；</li>
<li><strong>更小的应用体积</strong>：移除JVM/编译器，减少带宽消耗；</li>
<li><strong>更好的安全性</strong>：避免将未编译的代码暴露给用户。</li>
</ul>
<p>在实际应用中，需根据Spring Boot 3.x的特性配置AOT编译，解决反射、动态代理等兼容性问题，确保应用稳定运行。对于<strong>大型应用</strong>或<strong>云原生项目</strong>，AOT编译是实现“高性能、轻量级”的关键技术。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入解析 Vercel Skill：跨 Agent 的技能包管理器]]></title>    <link>https://juejin.cn/post/7600628279215669274</link>    <guid>https://juejin.cn/post/7600628279215669274</guid>    <pubDate>2026-01-29T14:49:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600628279215669274" data-draft-id="7600597995768791049" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入解析 Vercel Skill：跨 Agent 的技能包管理器"/> <meta itemprop="keywords" content="前端,后端,程序员"/> <meta itemprop="datePublished" content="2026-01-29T14:49:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="candyTong"/> <meta itemprop="url" content="https://juejin.cn/user/2242659449576952"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入解析 Vercel Skill：跨 Agent 的技能包管理器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2242659449576952/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    candyTong
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T14:49:37.000Z" title="Thu Jan 29 2026 14:49:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>1. 背景：技能检索与部署的挑战</strong></h2>
<p>在利用 AI Agent（如 Claude Code, Cursor, Trae）进行开发时，开发者面临的核心挑战在于技能（Skill）的 <strong>检索效率</strong> 与 <strong>安装成本</strong>：</p>
<ul>
<li><strong>发现困难</strong>：优质的 Prompt 和指令集散落在 GitHub、博客或社区中，缺乏标准化的中心化检索入口。</li>
<li><strong>安装繁琐</strong>：手动将指令内容配置到不同 Agent 的特定目录中，操作路径长且低效。</li>
<li><strong>配置不统一</strong>：不同 Agent 的配置标准不统一，难以实现跨平台的技能同步与管理。</li>
</ul>
<p><strong>Vercel Skill</strong> 定位于 <strong>跨 Agent 的技能包管理器</strong>。它通过 <code>find</code> 命令建立标准化的检索机制，通过 <code>add</code> 命令实现自动化部署，将 Agent 的能力扩展过程标准化。</p>
<hr/>
<h2 data-id="heading-1"><strong>2. 核心功能：<code>find</code> 与 <code>add</code></strong></h2>
<h3 data-id="heading-2"><strong><code>find</code>：检索与发现</strong></h3>
<pre><code class="hljs language-bash" lang="bash">npx skills find react
</code></pre>
<p>用于在官方资源库中交互式搜索技能。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34c14f3c36ab4357bcc2fa5f103ecc16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2FuZHlUb25n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770302977&amp;x-signature=qDTS%2Bni9A1iSFbFj%2FS49rWEr7x8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3"><strong><code>add</code>：安装与同步</strong></h3>
<pre><code class="hljs language-bash" lang="bash">npx skills add https://github.com/vercel-labs/skills --skill find-skills
</code></pre>
<p>用于从远程仓库、URL 或本地路径安装技能。它能自动识别本地已安装的 Agent（如 Claude Code, Cursor, Trae）并实现一键同步配置。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c92e79fb4238453e85243104c466e0ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2FuZHlUb25n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770302977&amp;x-signature=DDjtHYzyJqkLkYoSVTVUCoOwmLw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4"><strong>find-skills：赋予 Agent 搜索 skill 能力</strong></h2>
<p>除了 CLI 工具，官方还提供了一个名为 <code>find-skills</code> 的内置技能，专门用于辅助 Agent 发现新能力。</p>
<ul>
<li><strong>核心功能</strong>：让 Agent 能够根据用户的模糊需求（如“帮我找个写测试的工具”），自主调用检索逻辑。</li>
<li><strong>多轮检索机制</strong>：Agent 会根据初始反馈，自动尝试多轮查找，并生成更精准的关键词进行二次搜索，直到找到最匹配的技能。</li>
<li><strong>决策辅助</strong>：Agent 会对比搜索结果，向用户解释每个技能的用途，并给出安装建议，从而降低用户的决策成本。</li>
<li><strong>安装方式</strong>：
<pre><code class="hljs language-bash" lang="bash">npx skills add vercel-labs/skills@find-skills
</code></pre>
</li>
</ul>
<p>使用效果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29adece6e2024acd92f396c75ea4539a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2FuZHlUb25n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770302977&amp;x-signature=CfPodfcDVb8fkkxvN%2FcWM3dDbk4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5"><strong>3. 实现原理</strong></h2>
<p>Vercel Skill 采用“协调者”架构。<code>find</code> 与 <code>add</code> 既可以独立运行，也可以在交互模式下链式调用。</p>
<h3 data-id="heading-6"><strong><code>find</code> 检索流程时序图</strong></h3>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant User as 用户
    participant CLI as Vercel Skill CLI (find.ts)
    participant Registry as skills.sh API

    User-&gt;&gt;CLI: npx skills find "react"
    loop 交互式输入
        CLI-&gt;&gt;Registry: GET /api/search (携带 query)
        Registry--&gt;&gt;CLI: 返回技能元数据列表 (包含名称、仓库源、安装量等)
        CLI-&gt;&gt;User: 动态渲染交互界面 (显示名称与 Source)
    end
    User-&gt;&gt;CLI: 确认选择项 (提取 Source 标识符)
    Note over CLI: 内部调用 runAdd(source)
</code></pre>
<h3 data-id="heading-7"><strong><code>add</code> 部署流程时序图</strong></h3>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant User as 用户
    participant CLI as Vercel Skill CLI (add.ts)
    participant Source as 源码托管 (GitHub/Local)
    participant Agent as AI Agent (如 Claude Code)

    User-&gt;&gt;CLI: npx skills add &lt;source&gt;
    CLI-&gt;&gt;CLI: 解析 Source (标准 URL 或 简写)

    alt 远程源 (GitHub/GitLab)
        CLI-&gt;&gt;Source: 克隆仓库至临时目录
    else 本地源
        CLI-&gt;&gt;Source: 读取本地路径
    end

    CLI-&gt;&gt;CLI: 发现并解析 SKILL.md
    CLI-&gt;&gt;Agent: 自动探测已安装的 Agent 环境
    User-&gt;&gt;CLI: 确认安装范围与方式 (Symlink/Copy)

    loop 遍历目标 Agent
        CLI-&gt;&gt;Agent: 写入配置或创建软链接
    end
    Agent--&gt;&gt;User: 部署完成并打印路径
</code></pre>
<ol>
<li><strong>源解析</strong>：将用户输入的简写（如 <code>owner/repo</code>）或标准 URL 解析为统一的结构。</li>
<li><strong>资源获取</strong>：针对远程仓库，CLI 自动克隆源码至临时目录；针对本地路径则直接读取。</li>
<li><strong>环境探测</strong>：扫描系统预定义的 Agent 配置路径（如 Claude Code、Cursor、Trae 等），识别当前活跃环境。</li>
<li><strong>自动化部署</strong>：根据用户选择的范围（全局/项目）和方式（软链接/复制），CLI 批量在目标 Agent 的技能目录下建立关联。</li>
</ol>
<hr/>
<h2 data-id="heading-8"><strong>4. 企业内部 skill 平台的接入方式</strong></h2>
<h3 data-id="heading-9"><strong>Search 功能接入</strong></h3>
<p>对于企业内部环境，Vercel Skill 提供了 <code>SKILLS_API_URL</code> 环境变量，用于修改请求的域名；只要域名提供对应的接口，并保持入参出参一致即可。</p>
<pre><code class="hljs language-bash" lang="bash">SKILLS_API_URL=https://your-internal-api.com npx skills find react
</code></pre>
<p><strong>企业内部搜索接入时序图：</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant CLI as Skills CLI
    participant IntAPI as 企业内部 API (SKILLS_API_URL)
    participant Registry as 内部 Skill 注册表
    participant ExtAPI as 外部公开 API (skills.sh)

    CLI-&gt;&gt;IntAPI: GET /api/search?q=...
    activate IntAPI
    IntAPI-&gt;&gt;Registry: 检索企业私有 Skill
    Registry--&gt;&gt;IntAPI: 返回私有 Skill 列表

    rect rgb(240, 240, 240)
    Note over IntAPI, ExtAPI: 可选：聚合外部搜索
    IntAPI-&gt;&gt;ExtAPI: GET /api/search?q=...
    ExtAPI--&gt;&gt;IntAPI: 返回公开 Skill 列表
    end

    IntAPI-&gt;&gt;IntAPI: 合并并转换格式
    IntAPI--&gt;&gt;CLI: 返回统一格式的技能列表
    deactivate IntAPI
</code></pre>
<p><strong>接口伪代码示例（同时支持搜索企业内和企业外部的 skill）：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 企业内部 Skill 搜索接口示例 (Next.js / Vercel Route Handler)</span>
<span class="hljs-comment">// GET /api/search?q=...</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">GET</span>(<span class="hljs-params">request: Request</span>) {
  <span class="hljs-keyword">const</span> { searchParams } = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(request.<span class="hljs-property">url</span>);
  <span class="hljs-keyword">const</span> query = searchParams.<span class="hljs-title function_">get</span>(<span class="hljs-string">'q'</span>);

  <span class="hljs-comment">// 1. 搜索企业内部私有 Skill 仓库</span>
  <span class="hljs-keyword">const</span> internalSkills = <span class="hljs-keyword">await</span> <span class="hljs-title function_">searchInternalRegistry</span>(query);

  <span class="hljs-comment">// 2. 搜索企业外部公开 Skill (可选，实现聚合搜索)</span>
  <span class="hljs-keyword">const</span> publicSkills = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`https://skills.sh/api/search?q=<span class="hljs-subst">${query}</span>`</span>)
    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> res.<span class="hljs-title function_">json</span>())
    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> data.<span class="hljs-property">skills</span>)
    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> []);

  <span class="hljs-comment">// 3. 统一转换格式并合并结果</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Response</span>.<span class="hljs-title function_">json</span>({
    <span class="hljs-attr">skills</span>: [
      ...internalSkills.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> ({
        <span class="hljs-attr">id</span>: s.<span class="hljs-property">id</span>,
        <span class="hljs-attr">name</span>: s.<span class="hljs-property">name</span>,
        <span class="hljs-attr">installs</span>: s.<span class="hljs-property">downloads</span>,
        <span class="hljs-attr">topSource</span>: s.<span class="hljs-property">gitUrl</span>, <span class="hljs-comment">// 内部 Git 地址</span>
      })),
      ...publicSkills,
    ],
  });
}
</code></pre>
<h3 data-id="heading-10"><strong>Add 功能接入与权限处理</strong></h3>
<p>针对企业内部 <code>add</code> 功能，主要有以下两种接入方案：</p>
<h4 data-id="heading-11"><strong>方案一：无改造直接接入 (Direct Clone)</strong></h4>
<p>不需要任何改造，直接传入 Git 仓库进行下载。</p>
<ul>
<li><strong>原理</strong>：直接利用本地 Git 环境进行 <code>Clone</code> 内部仓库。</li>
<li><strong>优点</strong>：实现成本低，完全复用现有逻辑。</li>
<li><strong>缺点</strong>：受限于用户本地权限，对于没有仓库访问权限的用户会安装失败。</li>
</ul>
<h4 data-id="heading-12"><strong>方案二：平台中间层接入 (Well-known Proxy)</strong></h4>
<p>如果要做到通用且安全，可以通过引入一个<strong>平台中间层 (Proxy Layer)</strong>。此时 <code>add</code> 命令传入不再是内部 Git 地址，而是中间层的 HTTP 域名。</p>
<ul>
<li>
<p><strong>原理</strong>：</p>
<ol>
<li><strong>屏蔽权限复杂性</strong>：服务端统一持有 Git Token/SSH Key，负责克隆内部私有仓库。终端用户无需配置 Git 权限。</li>
<li><strong>协议转换</strong>：将复杂的 Git 结构转换为标准的 <strong>Well-known (RFC 8615)</strong> 静态文件接口。</li>
<li><strong>按需发现</strong>：支持通过子路径（如 <code>middleware.com/org-name</code>）实现多团队的技能发现。</li>
</ol>
</li>
<li>
<p><strong>实现细节</strong>：</p>
<ul>
<li><strong>接口规范</strong>：需实现 <code>GET /.well-known/skills/index.json</code> 索引接口。</li>
<li><strong>单个文件下载</strong>：CLI 在解析 <code>index.json</code> 后，会根据 <code>files</code> 数组中的路径，拼接完整的 URL 逐个下载文件（例如：<code>GET /.well-known/skills/db-helper/SKILL.md</code>）。</li>
<li><strong>数据结构示例</strong>：
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"skills"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"internal-db-helper"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"企业内部数据库查询助手"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"files"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"SKILL.md"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"handler.ts"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong>工作流时序图</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant User as 用户 (CLI)
    participant Proxy as 中间层 (Well-known Server)
    participant Git as 内部 Git (GitLab/Bitbucket)

    User-&gt;&gt;Proxy: npx skills add https://proxy.com/skills
    Proxy-&gt;&gt;Proxy: 鉴权并解析目标技能
    Proxy-&gt;&gt;Git: 服务端 Clone (使用预设 Token)
    Proxy-&gt;&gt;Proxy: 提取 SKILL.md 并生成 index.json
    Proxy--&gt;&gt;User: 返回 index.json 索引
    User-&gt;&gt;Proxy: GET /.well-known/skills/db-helper/SKILL.md
    Proxy--&gt;&gt;User: 返回文件流
    Note over User: CLI 完成本地安装
</code></pre>
</li>
</ul>
<p>这种方案将“仓库访问控制”转化为了“Web API 访问控制”，极大地降低了企业内部推广技能包的门槛。</p>
<hr/>
<h2 data-id="heading-13"><strong>总结</strong></h2>
<p><strong>Vercel Skill</strong> 通过标准化的 CLI 工具，打破了 AI Agent 技能发现与部署的壁垒：</p>
<ol>
<li><strong>用户侧</strong>：提供了类似 <code>npm</code> 的丝滑体验，实现了一次安装、多 Agent 同步。</li>
<li><strong>开发者侧</strong>：通过简单的 <code>SKILL.md</code> 规范即可发布技能，支持 Git、本地路径及 Web URL 等多种源。</li>
<li><strong>企业侧</strong>：通过灵活的 API 环境变量及 <strong>Well-known 代理模式</strong>，在确保安全与权限受控的前提下，实现了企业内部私有技能的高效分发。</li>
</ol>
<p>随着 AI Agent 生态的爆发，这种<strong>跨平台、标准化的技能包管理方案</strong>将成为提升开发者生产力的关键基础设施。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（72）如何在NoSQL数据库中使用Hibernate？]]></title>    <link>https://juejin.cn/post/7600616270002864166</link>    <guid>https://juejin.cn/post/7600616270002864166</guid>    <pubDate>2026-01-29T11:54:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600616270002864166" data-draft-id="7600616270002847782" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（72）如何在NoSQL数据库中使用Hibernate？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-29T11:54:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（72）如何在NoSQL数据库中使用Hibernate？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T11:54:11.000Z" title="Thu Jan 29 2026 11:54:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    15
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在NoSQL数据库中使用Hibernate，可以使用Hibernate OGM（Object/Grid Mapper）。Hibernate OGM是Hibernate ORM的扩展，旨在为NoSQL数据库提供对象映射和持久化功能。它支持多种NoSQL数据库，包括MongoDB、CouchDB、Neo4j等。</p>
<p>下面是详细步骤和代码示例，展示如何在MongoDB（一种常见的NoSQL数据库）中使用Hibernate OGM。</p>
<h3 data-id="heading-0">1. 项目依赖</h3>
<p>在<code>pom.xml</code>中添加必要的依赖：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Spring Boot Starter Data JPA --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- MongoDB Driver --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mongodb<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mongodb-driver-sync<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.4.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Hibernate OGM Core --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.hibernate.ogm<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hibernate-ogm-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.4.1.Final<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Hibernate OGM MongoDB --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.hibernate.ogm<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hibernate-ogm-mongodb<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.4.1.Final<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h3 data-id="heading-1">2. 配置Hibernate OGM</h3>
<p>创建一个配置类来配置Hibernate OGM。</p>
<h4 data-id="heading-2"><code>OgmConfig.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Value;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Primary;
<span class="hljs-keyword">import</span> org.springframework.orm.jpa.JpaTransactionManager;
<span class="hljs-keyword">import</span> org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean;
<span class="hljs-keyword">import</span> org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter;

<span class="hljs-keyword">import</span> javax.persistence.EntityManagerFactory;
<span class="hljs-keyword">import</span> javax.sql.DataSource;
<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OgmConfig</span> {

    <span class="hljs-meta">@Value("${spring.data.mongodb.host}")</span>
    <span class="hljs-keyword">private</span> String mongoHost;

    <span class="hljs-meta">@Value("${spring.data.mongodb.port}")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> mongoPort;

    <span class="hljs-meta">@Value("${spring.data.mongodb.database}")</span>
    <span class="hljs-keyword">private</span> String mongoDatabase;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> LocalContainerEntityManagerFactoryBean <span class="hljs-title function_">entityManagerFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-type">LocalContainerEntityManagerFactoryBean</span> <span class="hljs-variable">em</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalContainerEntityManagerFactoryBean</span>();
        em.setJpaVendorAdapter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HibernateJpaVendorAdapter</span>());
        
        Map&lt;String, Object&gt; properties = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        properties.put(<span class="hljs-string">"hibernate.ogm.datastore.provider"</span>, <span class="hljs-string">"mongodb"</span>);
        properties.put(<span class="hljs-string">"hibernate.ogm.datastore.create_database"</span>, <span class="hljs-literal">true</span>);
        properties.put(<span class="hljs-string">"hibernate.ogm.datastore.database"</span>, mongoDatabase);
        properties.put(<span class="hljs-string">"hibernate.ogm.datastore.host"</span>, mongoHost);
        properties.put(<span class="hljs-string">"hibernate.ogm.datastore.port"</span>, mongoPort);
        
        em.setJpaPropertyMap(properties);
        
        <span class="hljs-keyword">return</span> em;
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@Primary</span>
    <span class="hljs-keyword">public</span> JpaTransactionManager <span class="hljs-title function_">transactionManager</span><span class="hljs-params">(EntityManagerFactory emf)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JpaTransactionManager</span>(emf);
    }
}
</code></pre>
<p>在<code>application.properties</code>中配置MongoDB参数：</p>
<pre><code class="hljs language-properties" lang="properties">spring.data.mongodb.host=localhost
spring.data.mongodb.port=27017
spring.data.mongodb.database=mydatabase
</code></pre>
<h3 data-id="heading-3">3. 定义实体类和DAO层</h3>
<h4 data-id="heading-4"><code>Person.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.annotations.GenericGenerator;

<span class="hljs-keyword">import</span> javax.persistence.Entity;
<span class="hljs-keyword">import</span> javax.persistence.GeneratedValue;
<span class="hljs-keyword">import</span> javax.persistence.Id;
<span class="hljs-keyword">import</span> javax.persistence.Table;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "person")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(generator = "UUID")</span>
    <span class="hljs-meta">@GenericGenerator(
        name = "UUID",
        strategy = "org.hibernate.id.UUIDGenerator"
    )</span>
    <span class="hljs-keyword">private</span> String id;

    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-comment">// Getters and Setters</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(String id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h4 data-id="heading-5"><code>PersonRepository.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">PersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JpaRepository</span>&lt;Person, String&gt; {
}
</code></pre>
<h3 data-id="heading-6">4. 创建服务层</h3>
<h4 data-id="heading-7"><code>PersonService.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PersonService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> PersonRepository personRepository;

    <span class="hljs-keyword">public</span> Person <span class="hljs-title function_">createPerson</span><span class="hljs-params">(Person person)</span> {
        <span class="hljs-keyword">return</span> personRepository.save(person);
    }

    <span class="hljs-keyword">public</span> Person <span class="hljs-title function_">getPersonById</span><span class="hljs-params">(String id)</span> {
        <span class="hljs-keyword">return</span> personRepository.findById(id).orElse(<span class="hljs-literal">null</span>);
    }

    <span class="hljs-keyword">public</span> List&lt;Person&gt; <span class="hljs-title function_">getAllPersons</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> personRepository.findAll();
    }

    <span class="hljs-keyword">public</span> Person <span class="hljs-title function_">updatePerson</span><span class="hljs-params">(Person person)</span> {
        <span class="hljs-keyword">return</span> personRepository.save(person);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deletePerson</span><span class="hljs-params">(String id)</span> {
        personRepository.deleteById(id);
    }
}
</code></pre>
<h3 data-id="heading-8">5. 创建控制器</h3>
<h4 data-id="heading-9"><code>PersonController.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.http.ResponseEntity;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/persons")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PersonController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> PersonService personService;

    <span class="hljs-meta">@PostMapping</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Person&gt; <span class="hljs-title function_">createPerson</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Person person)</span> {
        <span class="hljs-type">Person</span> <span class="hljs-variable">createdPerson</span> <span class="hljs-operator">=</span> personService.createPerson(person);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(createdPerson);
    }

    <span class="hljs-meta">@GetMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Person&gt; <span class="hljs-title function_">getPersonById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String id)</span> {
        <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> personService.getPersonById(id);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(person);
    }

    <span class="hljs-meta">@GetMapping</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;List&lt;Person&gt;&gt; <span class="hljs-title function_">getAllPersons</span><span class="hljs-params">()</span> {
        List&lt;Person&gt; persons = personService.getAllPersons();
        <span class="hljs-keyword">return</span> ResponseEntity.ok(persons);
    }

    <span class="hljs-meta">@PutMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Person&gt; <span class="hljs-title function_">updatePerson</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String id, <span class="hljs-meta">@RequestBody</span> Person person)</span> {
        person.setId(id); <span class="hljs-comment">// Ensure the person ID is set correctly</span>
        <span class="hljs-type">Person</span> <span class="hljs-variable">updatedPerson</span> <span class="hljs-operator">=</span> personService.updatePerson(person);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(updatedPerson);
    }

    <span class="hljs-meta">@DeleteMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Void&gt; <span class="hljs-title function_">deletePerson</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String id)</span> {
        personService.deletePerson(id);
        <span class="hljs-keyword">return</span> ResponseEntity.noContent().build();
    }
}
</code></pre>
<h3 data-id="heading-10">6. 运行应用</h3>
<ol>
<li><strong>启动MongoDB</strong>：确保你的MongoDB数据库运行在<code>localhost:27017</code>。</li>
<li><strong>启动Spring Boot应用</strong>：运行Spring Boot应用程序。</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">mvn spring-boot:run
</code></pre>
<h3 data-id="heading-11">7. 访问API</h3>
<p>通过以下API访问<code>Person</code>数据：</p>
<ul>
<li><code>POST /persons</code>：创建Person。</li>
<li><code>GET /persons/{id}</code>：按ID获取Person。</li>
<li><code>GET /persons</code>：获取所有Persons。</li>
<li><code>PUT /persons/{id}</code>：更新Person。</li>
<li><code>DELETE /persons/{id}</code>：删除Person。</li>
</ul>
<h3 data-id="heading-12">总结</h3>
<p>通过上述步骤，我们展示了如何在NoSQL数据库（如MongoDB）中使用Hibernate OGM，包括配置Hibernate OGM、定义实体和DAO层、创建服务层和控制器以及如何运行和访问API。在大数据和NoSQL环境中，Hibernate OGM提供了一种基于对象的方式来处理复杂的数据持久化需求，使得开发人员可以更方便地进行数据操作。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一文详解 Kotlin 中的流- flow、channel]]></title>    <link>https://juejin.cn/post/7600953198745812998</link>    <guid>https://juejin.cn/post/7600953198745812998</guid>    <pubDate>2026-01-30T07:15:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600953198745812998" data-draft-id="7599166436683972654" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一文详解 Kotlin 中的流- flow、channel"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-30T07:15:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Jony_"/> <meta itemprop="url" content="https://juejin.cn/user/3403743732709767"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一文详解 Kotlin 中的流- flow、channel
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3403743732709767/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Jony_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T07:15:54.000Z" title="Fri Jan 30 2026 07:15:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="androidstudio">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#a9b7c6;background:#282b2e}.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#6897bb}.hljs-deletion,.hljs-keyword,.hljs-selector-tag{color:#cc7832}.hljs-link,.hljs-template-variable,.hljs-variable{color:#629755}.hljs-comment,.hljs-quote{color:grey}.hljs-meta{color:#bbb529}.hljs-addition,.hljs-attribute,.hljs-string{color:#6a8759}.hljs-section,.hljs-title,.hljs-type{color:#ffc66d}.hljs-name,.hljs-selector-class,.hljs-selector-id{color:#e8bf6a}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、前言</h2>
<p>当下 Android 比较流行的架构是 MVI + Kotlin 协程 + Compose，在 MVI 的架构中。为了减少 LiveData 在复杂页面过多的问题，我们推荐使用 State 进行统一管理。</p>
<p>LiveData 是 UI Layer 所观察的对象，在页面销毁的时候，能够自动取消所有的观察者，避免内存泄漏。和 LiveData 相比， Flow具有如下优势：</p>
<ol>
<li>支持背压</li>
<li>支持数据变换</li>
<li>支持线程切换</li>
</ol>
<p>总之一句话，Flow 天生为协程而生。</p>
<h2 data-id="heading-1">二、流的分类</h2>
<p>Kotlin 的流可以分为两类，冷流和热流。冷流和热流的区别如下：</p>
<p><strong>冷流</strong>：没有消费者，生产者就不会生产数据。</p>
<p><strong>热流</strong>：是否生产数据，和消费者没有关系</p>
<p>在 Kotlin 协程中，Flow 是冷流，StateFlow、SharedFlow、Channel 等是热流。StateFlow 用于页面状态，SharedFlow 用于事件，Channel 主要用于协程间进行通信。</p>
<h2 data-id="heading-2">三、flow、channel 的用法</h2>
<p>flow 的用法如下：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ViewModel</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getData</span><span class="hljs-params">()</span></span>: Flow&lt;String&gt; = flow {
    emit(<span class="hljs-string">""</span>)
}.flowOn(Dispatchers.IO).<span class="hljs-keyword">catch</span> {
    println(it.message)
}

<span class="hljs-comment">// Activity</span>
lifecycleScope.launch {
    lifecycle.repeatOnLifecycle(Lifecycle.State.STARTED) {
        vm.getData().collect {}
    }
}
</code></pre>
<p>StateFlow 和 SharedFlow用法如下：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _stateFlow = MutableStateFlow(<span class="hljs-number">1</span>)
<span class="hljs-keyword">val</span> stateFlow: StateFlow&lt;<span class="hljs-built_in">Int</span>&gt; = _stateFlow

<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _shareFlow = MutableSharedFlow&lt;<span class="hljs-built_in">Int</span>&gt;()
<span class="hljs-keyword">val</span> shareFlow : SharedFlow&lt;<span class="hljs-built_in">Int</span>&gt; = _shareFlow

viewModelScope.launch {
    _stateFlow.value = <span class="hljs-number">2</span>
    _shareFlow.emit(<span class="hljs-number">1</span>)
}
</code></pre>
<p>Channel 主要是用在协程之间进行通信，代码示例如下：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking {
    GlobalScope.launch {
        <span class="hljs-keyword">val</span> channel = Channel&lt;<span class="hljs-built_in">Int</span>&gt;()
        <span class="hljs-keyword">val</span> scope = CoroutineScope(Job())
        scope.launch {
            launch {
                channel.send(<span class="hljs-number">1</span>)
            }
            launch {
                println(channel.receive())
            }
        }.join()
    }.join()
}
</code></pre>
<p>Flow 还有其他的一些操作变换符，例如 map、tranform 等，不在这里一一详述。另外，Channel 是线程安全的。</p>
<h2 data-id="heading-3">四、需要注意什么</h2>
<p><strong>LiveData</strong> 和 <strong>StateFlow</strong> 在 Android 架构中，都是用于状态更新的，他们区别如下：</p>
<ol>
<li>LiveData 具有生命周期感知的能力，StateFlow 不具备，因此 StateFlow监听数据的时候，需要在生命周期里</li>
<li>LiveData 不具备防抖的能力，StateFlow 具有防抖的能力</li>
</ol>
<p><strong>SharedFlow</strong> 和 <strong>StateFlow</strong> 都是热流，StateFlow 是特殊 SharedFlow，他们的区别如下：</p>
<ol>
<li>从作用场景来看，SharedFlow 用于事件更新，StateFlow 用于状态更新</li>
<li>collect() 和 emit() 都是挂起函数，需要确保在协程内部进行调用</li>
<li>SharedFlow emit() 和collect() 都是挂起函数，可能会阻塞当前的协程。<strong>因此生产者和消费者需要需要在不同的协程。</strong></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（71）如何在大数据环境中使用Hibernate？]]></title>    <link>https://juejin.cn/post/7600628279215046682</link>    <guid>https://juejin.cn/post/7600628279215046682</guid>    <pubDate>2026-01-29T11:53:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600628279215046682" data-draft-id="7600601482690543662" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（71）如何在大数据环境中使用Hibernate？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-29T11:53:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（71）如何在大数据环境中使用Hibernate？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T11:53:09.000Z" title="Thu Jan 29 2026 11:53:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在大数据环境中使用Hibernate时，需要处理大量数据和复杂查询，确保性能和可扩展性。尽管Hibernate是一个功能强大的ORM框架，但在处理大规模数据时，可能需要采取一些策略，如批量处理、分页、缓存和分布式处理等。</p>
<p>下面是详细步骤和代码示例，展示如何在大数据环境中使用Hibernate。</p>
<h3 data-id="heading-0">1. 项目依赖</h3>
<p>在<code>pom.xml</code>中添加必要的依赖：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Spring Boot Starter Data JPA --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- MySQL Connector --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.0.26<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- HikariCP for Connection Pooling --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.zaxxer<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>HikariCP<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- EHCache for Second Level Cache --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.hibernate<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hibernate-ehcache<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.4.32.Final<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h3 data-id="heading-1">2. 配置数据源和Hibernate属性</h3>
<p>在<code>application.properties</code>中配置数据源和Hibernate属性：</p>
<pre><code class="hljs language-properties" lang="properties">spring.datasource.url=jdbc:mysql://localhost:3306/mydatabase
spring.datasource.username=root
spring.datasource.password=rootpassword
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect

# Enable Second Level Cache
spring.jpa.properties.hibernate.cache.use_second_level_cache=true
spring.jpa.properties.hibernate.cache.region.factory_class=org.hibernate.cache.ehcache.EhCacheRegionFactory
</code></pre>
<h3 data-id="heading-2">3. 配置EhCache</h3>
<p>在类路径下创建一个<code>ehcache.xml</code>文件来配置缓存。</p>
<h4 data-id="heading-3"><code>ehcache.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ehcache</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">defaultCache</span>
        <span class="hljs-attr">maxEntriesLocalHeap</span>=<span class="hljs-string">"10000"</span>
        <span class="hljs-attr">eternal</span>=<span class="hljs-string">"false"</span>
        <span class="hljs-attr">timeToIdleSeconds</span>=<span class="hljs-string">"120"</span>
        <span class="hljs-attr">timeToLiveSeconds</span>=<span class="hljs-string">"120"</span>
        <span class="hljs-attr">overflowToDisk</span>=<span class="hljs-string">"false"</span>
        <span class="hljs-attr">statistics</span>=<span class="hljs-string">"true"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">cache</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"com.example.entity.BigDataEntity"</span>
        <span class="hljs-attr">maxEntriesLocalHeap</span>=<span class="hljs-string">"10000"</span>
        <span class="hljs-attr">eternal</span>=<span class="hljs-string">"false"</span>
        <span class="hljs-attr">timeToIdleSeconds</span>=<span class="hljs-string">"120"</span>
        <span class="hljs-attr">timeToLiveSeconds</span>=<span class="hljs-string">"120"</span>
        <span class="hljs-attr">overflowToDisk</span>=<span class="hljs-string">"false"</span>
        <span class="hljs-attr">statistics</span>=<span class="hljs-string">"true"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ehcache</span>&gt;</span>
</code></pre>
<h3 data-id="heading-4">4. 定义实体类和DAO层</h3>
<h4 data-id="heading-5"><code>BigDataEntity.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> javax.persistence.Entity;
<span class="hljs-keyword">import</span> javax.persistence.GeneratedValue;
<span class="hljs-keyword">import</span> javax.persistence.GenerationType;
<span class="hljs-keyword">import</span> javax.persistence.Id;
<span class="hljs-keyword">import</span> javax.persistence.Table;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "big_data")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BigDataEntity</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String dataField;

    <span class="hljs-comment">// Getters and Setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDataField</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> dataField;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDataField</span><span class="hljs-params">(String dataField)</span> {
        <span class="hljs-built_in">this</span>.dataField = dataField;
    }
}
</code></pre>
<h4 data-id="heading-6"><code>BigDataRepository.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">BigDataRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JpaRepository</span>&lt;BigDataEntity, Long&gt; {
}
</code></pre>
<h3 data-id="heading-7">5. 批量处理和分页</h3>
<h4 data-id="heading-8"><code>BigDataService.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.data.domain.Page;
<span class="hljs-keyword">import</span> org.springframework.data.domain.PageRequest;
<span class="hljs-keyword">import</span> org.springframework.data.domain.Pageable;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BigDataService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> BigDataRepository bigDataRepository;

    <span class="hljs-comment">// 批量插入数据</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveAll</span><span class="hljs-params">(List&lt;BigDataEntity&gt; entities)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">batchSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">50</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; entities.size(); i += batchSize) {
            List&lt;BigDataEntity&gt; batchList = entities.subList(i, Math.min(i + batchSize, entities.size()));
            bigDataRepository.saveAll(batchList);
            bigDataRepository.flush();
        }
    }

    <span class="hljs-comment">// 分页查询大数据</span>
    <span class="hljs-keyword">public</span> Page&lt;BigDataEntity&gt; <span class="hljs-title function_">findPaginated</span><span class="hljs-params">(<span class="hljs-type">int</span> page, <span class="hljs-type">int</span> size)</span> {
        <span class="hljs-type">Pageable</span> <span class="hljs-variable">pageable</span> <span class="hljs-operator">=</span> PageRequest.of(page, size);
        <span class="hljs-keyword">return</span> bigDataRepository.findAll(pageable);
    }
}
</code></pre>
<h3 data-id="heading-9">6. 使用缓存</h3>
<h4 data-id="heading-10">在实体类上启用缓存</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.annotations.Cache;
<span class="hljs-keyword">import</span> org.hibernate.annotations.CacheConcurrencyStrategy;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "big_data")</span>
<span class="hljs-meta">@Cache(usage = CacheConcurrencyStrategy.READ_WRITE)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BigDataEntity</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String dataField;

    <span class="hljs-comment">// Getters and Setters</span>
}
</code></pre>
<h3 data-id="heading-11">7. 使用服务层</h3>
<p>编写控制器来使用服务层进行批量处理和分页查询。</p>
<h4 data-id="heading-12"><code>BigDataController.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.data.domain.Page;
<span class="hljs-keyword">import</span> org.springframework.http.ResponseEntity;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/bigdata")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BigDataController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> BigDataService bigDataService;

    <span class="hljs-meta">@PostMapping("/saveall")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Void&gt; <span class="hljs-title function_">saveAll</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> List&lt;BigDataEntity&gt; entities)</span> {
        bigDataService.saveAll(entities);
        <span class="hljs-keyword">return</span> ResponseEntity.ok().build();
    }

    <span class="hljs-meta">@GetMapping("/page/{page}/{size}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Page&lt;BigDataEntity&gt;&gt; <span class="hljs-title function_">findPaginated</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> <span class="hljs-type">int</span> page, <span class="hljs-meta">@PathVariable</span> <span class="hljs-type">int</span> size)</span> {
        Page&lt;BigDataEntity&gt; result = bigDataService.findPaginated(page, size);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(result);
    }
}
</code></pre>
<h3 data-id="heading-13">8. 批量处理</h3>
<h4 data-id="heading-14">批量插入数据示例</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.boot.CommandLineRunner;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataLoader</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CommandLineRunner</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> BigDataService bigDataService;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DataLoader</span><span class="hljs-params">(BigDataService bigDataService)</span> {
        <span class="hljs-built_in">this</span>.bigDataService = bigDataService;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(String... args)</span> <span class="hljs-keyword">throws</span> Exception {
        List&lt;BigDataEntity&gt; entities = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
            <span class="hljs-type">BigDataEntity</span> <span class="hljs-variable">entity</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDataEntity</span>();
            entity.setDataField(<span class="hljs-string">"Data "</span> + i);
            entities.add(entity);
        }
        bigDataService.saveAll(entities);
    }
}
</code></pre>
<h3 data-id="heading-15">9. 分页查询</h3>
<h4 data-id="heading-16">分页查询数据示例</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.boot.CommandLineRunner;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataLoader</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CommandLineRunner</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> BigDataService bigDataService;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DataLoader</span><span class="hljs-params">(BigDataService bigDataService)</span> {
        <span class="hljs-built_in">this</span>.bigDataService = bigDataService;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(String... args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">int</span> <span class="hljs-variable">page</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            Page&lt;BigDataEntity&gt; result = bigDataService.findPaginated(page, size);
            <span class="hljs-keyword">if</span> (result.isEmpty()) {
                <span class="hljs-keyword">break</span>;
            }
            result.forEach(entity -&gt; System.out.println(entity.getDataField()));
            page++;
        }
    }
}
</code></pre>
<h3 data-id="heading-17">总结</h3>
<p>通过上述步骤，我们展示了如何在大数据环境中使用Hibernate，包括配置数据源和Hibernate属性、配置缓存、定义实体和DAO层、批量处理、分页查询以及使用缓存。在大数据环境中，采用批量处理、分页、缓存等策略可以有效提高性能和可扩展性。这样，应用程序可以在处理大规模数据时高效运行，并利用Hibernate进行数据库操作。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[mysql中的union关键字详解]]></title>    <link>https://juejin.cn/post/7600588379106181172</link>    <guid>https://juejin.cn/post/7600588379106181172</guid>    <pubDate>2026-01-29T14:58:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600588379106181172" data-draft-id="7600622813457006607" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="mysql中的union关键字详解"/> <meta itemprop="keywords" content="MySQL"/> <meta itemprop="datePublished" content="2026-01-29T14:58:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            mysql中的union关键字详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T14:58:23.000Z" title="Thu Jan 29 2026 14:58:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    33
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>MySQL 的 <code>UNION</code> 用于<strong>合并两个或多个 <code>SELECT</code> 语句的结果集</strong>，并自动去除重复行（相当于对结果集执行 <code>DISTINCT</code>）。</p>
<h2 data-id="heading-0">1. 基本语法与核心规则</h2>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> column1, column2 <span class="hljs-keyword">FROM</span> table1
<span class="hljs-keyword">UNION</span> [<span class="hljs-keyword">ALL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">DISTINCT</span>]
<span class="hljs-keyword">SELECT</span> column1, column2 <span class="hljs-keyword">FROM</span> table2;
</code></pre>
<p><strong>强制性规则</strong>：</p>
<ul>
<li><strong>列数必须相同</strong>：两个 SELECT 返回的列数必须一致</li>
<li><strong>数据类型兼容</strong>：对应位置的列类型不必完全相同，但必须可隐式转换（如 INT 和 DECIMAL）</li>
<li><strong>列名继承</strong>：结果集的列名取自<strong>第一个</strong> SELECT 语句</li>
<li><strong>ORDER BY 位置</strong>：只能放在最后一个 SELECT 之后，且排序依据必须是第一个 SELECT 的列名或别名</li>
</ul>
<h2 data-id="heading-1">2. UNION vs UNION ALL</h2>

























<table><thead><tr><th>特性</th><th><code>UNION</code> (DISTINCT)</th><th><code>UNION ALL</code></th></tr></thead><tbody><tr><td><strong>去重</strong></td><td>自动去重，行唯一</td><td>保留所有行，包括重复</td></tr><tr><td><strong>性能</strong></td><td>需要临时表+哈希排序去重，较慢</td><td>直接追加结果，极快</td></tr><tr><td><strong>使用场景</strong></td><td>必须确保唯一性时</td><td>确定无重复或需要保留重复时</td></tr></tbody></table>
<p><strong>性能建议</strong>：除非业务需要去重，否则<strong>优先使用 <code>UNION ALL</code></strong>。去重操作需要创建临时表、哈希比较和额外排序，大数据量时性能差距巨大。</p>
<h2 data-id="heading-2">3. 实际应用场景</h2>
<h3 data-id="heading-3">场景 A：合并相似结构表（如分表）</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查询 2023 和 2024 年的订单（假设按年分表）</span>
<span class="hljs-keyword">SELECT</span> order_id, amount, created_at <span class="hljs-keyword">FROM</span> orders_2023
<span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>
<span class="hljs-keyword">SELECT</span> order_id, amount, created_at <span class="hljs-keyword">FROM</span> orders_2024
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> created_at <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">20</span>;
</code></pre>
<h3 data-id="heading-4">场景 B：多维度统计报表</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-string">'VIP用户'</span> <span class="hljs-keyword">as</span> user_type, <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">as</span> cnt <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> level <span class="hljs-operator">&gt;=</span> <span class="hljs-number">8</span>
<span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-string">'普通用户'</span>, <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> level <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">7</span>
<span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-string">'访客'</span>, <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> level <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
</code></pre>
<h3 data-id="heading-5">场景 C：数据补全与兜底查询</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 先查缓存表，若无结果再查主表（常见于配置表）</span>
<span class="hljs-keyword">SELECT</span> config_value <span class="hljs-keyword">FROM</span> config_cache <span class="hljs-keyword">WHERE</span> config_key <span class="hljs-operator">=</span> <span class="hljs-string">'site_name'</span>
<span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>
<span class="hljs-keyword">SELECT</span> config_value <span class="hljs-keyword">FROM</span> config <span class="hljs-keyword">WHERE</span> config_key <span class="hljs-operator">=</span> <span class="hljs-string">'site_name'</span>
LIMIT <span class="hljs-number">1</span>;
</code></pre>
<h2 data-id="heading-6">4. 进阶用法</h2>
<h3 data-id="heading-7">带排序和分页</h3>
<pre><code class="hljs language-sql" lang="sql">(<span class="hljs-keyword">SELECT</span> id, name <span class="hljs-keyword">FROM</span> products <span class="hljs-keyword">WHERE</span> category <span class="hljs-operator">=</span> <span class="hljs-string">'A'</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> price <span class="hljs-keyword">DESC</span> LIMIT <span class="hljs-number">10</span>)
<span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>
(<span class="hljs-keyword">SELECT</span> id, name <span class="hljs-keyword">FROM</span> products <span class="hljs-keyword">WHERE</span> category <span class="hljs-operator">=</span> <span class="hljs-string">'B'</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> price <span class="hljs-keyword">DESC</span> LIMIT <span class="hljs-number">10</span>)
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> price <span class="hljs-keyword">DESC</span> LIMIT <span class="hljs-number">10</span>;
</code></pre>
<p><strong>注意</strong>：子查询中的 <code>ORDER BY</code> 必须配合 <code>LIMIT</code> 才生效，否则会被优化器忽略。</p>
<h3 data-id="heading-8">混合聚合与明细</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> city, sales_amount, <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">as</span> detail <span class="hljs-keyword">FROM</span> sales_summary
<span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>
<span class="hljs-keyword">SELECT</span> city, amount, CONCAT(product_name, <span class="hljs-string">':'</span>, quantity) <span class="hljs-keyword">FROM</span> sales_detail;
</code></pre>
<h2 data-id="heading-9">5. 性能优化要点</h2>
<ol>
<li><strong>索引利用</strong>：每个 SELECT 独立使用索引，UNION 本身不走索引</li>
<li><strong>减少数据集</strong>：在子查询中先 <code>WHERE</code> 过滤，避免传递大量数据到 UNION 层</li>
<li><strong>避免临时表写入</strong>：<code>UNION DISTINCT</code> 会创建内存临时表（或磁盘临时表，若过大），可通过 <code>SET tmp_table_size</code> 调优</li>
<li><strong>并行执行</strong>：MySQL 8.0.19+ 对非相关子查询的 UNION 可能启用并行查询</li>
</ol>
<h2 data-id="heading-10">6. 常见陷阱</h2>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ❌ 错误：列数不匹配</span>
<span class="hljs-keyword">SELECT</span> id, name <span class="hljs-keyword">FROM</span> t1
<span class="hljs-keyword">UNION</span>
<span class="hljs-keyword">SELECT</span> id <span class="hljs-keyword">FROM</span> t2;  <span class="hljs-comment">-- ERROR 1222</span>

<span class="hljs-comment">-- ❌ 错误：ORDER BY 位置错误</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t1 <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id
<span class="hljs-keyword">UNION</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t2;  <span class="hljs-comment">-- ERROR 1221</span>

<span class="hljs-comment">-- ✅ 正确写法</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t1
<span class="hljs-keyword">UNION</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t2
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id;  <span class="hljs-comment">-- 使用第一个 SELECT 的列名排序</span>
</code></pre>
<h2 data-id="heading-11">7. Django ORM 中的 UNION</h2>
<p>如果你在使用 Django（看你之前关注过 Django 源码），可以这样使用：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.db.models <span class="hljs-keyword">import</span> Q

<span class="hljs-comment"># QuerySet.union() 默认使用 UNION ALL</span>
qs1 = User.objects.<span class="hljs-built_in">filter</span>(status=<span class="hljs-string">'active'</span>).values(<span class="hljs-string">'name'</span>, <span class="hljs-string">'email'</span>)
qs2 = User.objects.<span class="hljs-built_in">filter</span>(is_staff=<span class="hljs-literal">True</span>).values(<span class="hljs-string">'name'</span>, <span class="hljs-string">'email'</span>)

<span class="hljs-comment"># UNION ALL</span>
combined = qs1.union(qs2, <span class="hljs-built_in">all</span>=<span class="hljs-literal">True</span>)

<span class="hljs-comment"># UNION (去重)</span>
combined_distinct = qs1.union(qs2)  <span class="hljs-comment"># 或 all=False</span>
</code></pre>
<p><strong>注意</strong>：Django 的 <code>union()</code> 会强制转换为 SQL 的 <code>UNION</code>，且 QuerySet 被求值后返回的是列表而非 QuerySet，无法继续链式过滤。</p>
<hr/>
<p><strong>总结</strong>：<code>UNION ALL</code> 是合并结果集的高性能首选，<code>UNION</code> (DISTINCT) 仅在需要去重时使用。始终确保子查询列数一致，并在应用层处理复杂的排序逻辑。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[告别 90% 误报率：基于算子级血缘实现精准数据治理与变更影响分析]]></title>    <link>https://juejin.cn/post/7600704706551955496</link>    <guid>https://juejin.cn/post/7600704706551955496</guid>    <pubDate>2026-01-30T07:07:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600704706551955496" data-draft-id="7600704706551758888" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="告别 90% 误报率：基于算子级血缘实现精准数据治理与变更影响分析"/> <meta itemprop="keywords" content="大数据"/> <meta itemprop="datePublished" content="2026-01-30T07:07:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Aloudata大应科技"/> <meta itemprop="url" content="https://juejin.cn/user/1579340474099927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            告别 90% 误报率：基于算子级血缘实现精准数据治理与变更影响分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1579340474099927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Aloudata大应科技
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T07:07:03.000Z" title="Fri Jan 30 2026 07:07:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文首发于 Aloudata 官方技术博客：<a href="https://link.juejin.cn?target=https%3A%2F%2Fai.noetl.cn%2Fknowledge-base%2Fimpact-analysis-false-analysis-90-percent-false-alarm" target="_blank" title="https://ai.noetl.cn/knowledge-base/impact-analysis-false-analysis-90-percent-false-alarm" ref="nofollow noopener noreferrer">《变更影响分析误报率 90%？因为你还在用表级血缘做「假分析」》</a>转载请注明出处。</p>
</blockquote>
<p><strong>摘要</strong>：传统表级或列级血缘进行变更影响分析，因解析粒度粗糙、逻辑缺失，误报率常高达 90% 以上，本质是“假分析”。本文深入对比了表级血缘与算子级血缘的技术代差，解析了算子级血缘如何通过 AST 解析、行级裁剪、白盒口径提取等核心能力，实现 &gt;99% 的解析准确率，将影响评估范围降低 80% 以上，并结合招商银行、兴业银行等头部金融机构的实践，为数据治理、DataOps 协同及自动化资产盘点提供清晰路径。</p>
<p>在数据驱动的企业中，一次看似微小的上游变更——例如修改一个字段的数据类型——常常会引发一场波及下游的“数据海啸”。数据工程师收到警报：“下游 30 张表、15 个任务可能受影响”。然而，当他们耗费数天时间逐一排查后，往往发现真正需要修改的只有寥寥几张报表。这种高噪声、低信度的影响分析，误报率普遍高达 90% 以上，其本质并非真正的分析，而是一种基于粗糙信息的“假分析”。</p>
<p>“假分析”的根源，在于企业依赖了过时的技术工具——传统表级或列级血缘。它们提供的是一张“破损的地图”，无法看清数据加工的真实逻辑，最终导致数据团队陷入被动“救火”的恶性循环。</p>
<h2 data-id="heading-0">演进背景：从“黑盒考古”到“精准导航”的数据治理困局</h2>
<p>随着企业数据链路日益复杂，传统的血缘工具已力不从心。正如行业观察所指出的，数据治理团队常陷入尴尬境地：报表出错第一个被问责，指标异常需要“跨越几十个系统的考古”，面对海量僵尸表却无人敢删，因为“天知道它连着什么”。</p>
<p>传统血缘工具的三大原罪，使其无法支撑精准的变更影响分析：</p>
<ol>
<li>地图是错的：解析器在遇到存储过程、动态 SQL、临时表、嵌套视图等复杂逻辑时频繁断链或错配，产出的血缘图谱本身准确率不足 80%，基于错误地图的导航必然导致错误结论。</li>
<li>技术天书，业务看不懂：血缘图节点是 <code>rpt_fact_001_daily</code> 这类物理表名，业务人员无法理解，导致技术业务协同脱节。</li>
<li>静态快照，路早改了：血缘信息更新滞后，无法反映实时变化的链路，拿着“上个月的地图”指挥“今天的战争”。</li>
</ol>
<p>数据治理迫切需要从依赖人工的“黑盒考古”，升级为基于精准、实时、可读元数据的“精准导航”。</p>
<h2 data-id="heading-1">核心代差对比：表级/列级血缘 vs 算子级血缘</h2>
<p>表级/列级血缘与算子级血缘在技术原理和应用效果上存在代际差距，这是影响分析精度天壤之别的根本原因。</p>
<h3 data-id="heading-2">精度与能力对比表</h3>









































<table><thead><tr><th>对比维度</th><th>传统表级/列级血缘</th><th>Aloudata BIG 算子级血缘</th><th>对影响分析的意义</th></tr></thead><tbody><tr><td>解析粒度</td><td>表名或字段名</td><td>SQL 内部算子 (Filter, Join, Agg 等)</td><td>看清数据是如何被“加工”的，而非仅仅从哪里来</td></tr><tr><td>解析准确率</td><td>通常 &lt;80%，复杂 SQL 断链</td><td>&gt;99%，覆盖存储过程、动态 SQL</td><td>分析结论可信，避免因血缘错误导致误判</td></tr><tr><td>核心能力</td><td>简单的依赖关系连线</td><td>行级裁剪、白盒口径提取、复杂逻辑覆盖</td><td>精准识别“谁真的受影响”，剔除无关噪声</td></tr><tr><td>变更影响评估</td><td>报告“下游 30 张表可能崩”</td><td>报告“下游 5 张报表的 3 个核心指标因特定过滤条件受影响”</td><td>从泛化告警到精准定位，评估范围降低 80%+</td></tr><tr><td>业务可读性</td><td>技术天书 (rpt_fact_001_daily)</td><td>可读的加工口径与业务指标映射</td><td>业务与技术能基于同一份“地图”高效协同</td></tr></tbody></table>
<p>技术原理纠错：算子级血缘并非通过简单的正则表达式匹配，而是基于 AST（抽象语法树） 对 SQL 进行完整解析，从而能精准捕获过滤、连接、聚合等内部逻辑，这是实现“行级裁剪”等技术的基础。</p>
<h2 data-id="heading-3">场景拆解：为什么表级血缘在做“假分析”？</h2>
<p>通过具体场景，可以清晰看到表级血缘的缺陷如何直接导致高误报率。</p>
<h3 data-id="heading-4">缺陷一：有“表”无“逻辑”，误报泛滥</h3>
<ul>
<li>场景：需要修改源表 <code>user_info</code> 中的 <code>age</code> 字段类型。</li>
<li>表级分析：所有引用 <code>user_info</code> 的下游表（如 <code>rpt_user_analysis</code>, <code>dm_user_tag</code>）均被标记为“受影响”。</li>
<li>现实：<code>dm_user_tag</code> 表仅使用 <code>user_info</code> 的 <code>gender</code> 字段生成标签，与 <code>age</code> 变更完全无关。这就是典型的误报。</li>
<li>算子级解法：通过解析 <code>WHERE gender='F'</code> 等过滤算子，行级裁剪技术能识别出 <code>dm_user_tag</code> 并未使用 <code>age</code>字段，从而将其从影响列表中直接排除，只告警真正使用 <code>age</code> 的下游。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/13ae99a6b4e941eaa07121e8c901dac6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQWxvdWRhdGHlpKflupTnp5HmioA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770361653&amp;x-signature=szeZaro4reyBxomYs1lQUb7Dma0%3D" alt="3-1.png" loading="lazy"/></p>
<h3 data-id="heading-5">缺陷二：静态快照，无法应对动态逻辑</h3>
<ul>
<li>场景：链路中存在通过临时表、嵌套子查询或 DBLINK 进行的动态数据加工。</li>
<li>表级分析：解析器无法穿透这些动态逻辑，导致血缘断链，关键下游被漏报。直到该下游报表因数据缺失而崩溃时，问题才暴露。</li>
<li>算子级解法：支持对临时表、嵌套子查询的穿透式解析，确保复杂链路的血缘完整性，避免因漏报导致的线上事故。</li>
</ul>
<h3 data-id="heading-6">缺陷三：脱离业务口径，归因困难</h3>
<ul>
<li>场景：监管报表中“贷款不良率”指标突增，需紧急溯源定位原因。</li>
<li>表级分析：只能提供一串物理表名，业务方无法理解。数据工程师需人工“扒代码”，耗时数周甚至数月。</li>
<li>算子级解法：通过白盒化口径提取，自动将多层复杂的 SQL 加工逻辑，压缩成一段业务可读的“加工口径”描述。实现“一键溯源”，将溯源时间从数月级缩短至小时级。浙江农商联合银行的实践表明，监管指标溯源人效因此提升 20 倍。</li>
</ul>
<h2 data-id="heading-7">决策指南：如何选择真正的“影响分析”工具？</h2>
<p>为避免陷入“假分析”陷阱，企业在选型影响分析工具时，应聚焦以下关键评估维度：</p>
<ol>
<li>解析准确率是基石：工具是否敢于承诺并实际实现 &gt;99% 的解析准确率？能否覆盖企业真实环境中的存储过程（如 DB2、GaussDB 的 PL/SQL）、动态 SQL 等复杂场景？</li>
<li>影响分析精度是核心：是否支持字段级影响评估？更进一步，能否支持基于过滤条件（WHERE）的行级裁剪，从而大幅降低评估范围？</li>
<li>业务协同能力是关键：能否输出业务人员可理解的数据加工口径和指标映射，而不仅仅是技术名词，打破技术业务鸿沟？</li>
<li>保鲜能力是保障：能否自动发现链路中的代码变更，并实时更新血缘图谱，确保“地图”与“实际路况”同步？</li>
</ol>
<p>选型建议：</p>
<ul>
<li>如果你正面临：监管报送指标自动化盘点、大型数仓重构迁移、或高频业务变更下的资损风险防控等挑战。</li>
<li>你应该选择：像 Aloudata BIG 这样，以算子级血缘为技术基石、以主动元数据为核心理念的平台。它不仅能提供精准的分析，更能将分析结果主动应用于防控、治理与协同场景。</li>
<li>参考标杆：招商银行利用其进行 DataOps 协同，代码上线前评估时间缩短 50%，整改时间缩短 70%；兴业银行实现变更影响分析扩散度降低 80%；民生银行构建了事前事中的变更协作机制。这些实践已验证了其价值。</li>
</ul>
<h2 data-id="heading-8">从“假分析”到“真防控”：Aloudata BIG 的实践路径</h2>
<p>高精度的算子级血缘本身不是终点，将其应用于核心业务场景，实现主动价值闭环，才是“真防控”的意义所在。</p>
<p>场景一：自动化资产盘点与监管溯源</p>
<p>浙江农商联合银行面对海量监管报送指标（如 EAST），利用 Aloudata BIG 的“一键溯源”和口径提取能力，将原本耗时数月的指标盘点与口径梳理工作，缩短至 8 小时 内完成，人效提升 20 倍。</p>
<p>场景二：全链路主动风险防控</p>
<p>兴业银行将敏感数据标签与算子级血缘结合，实现标签沿精准链路自动扩散，打标效率提升 95%。同时，在数据任务上线前自动评估变更影响，有效避免了核心报表因上游改动而“暴雷”。</p>
<p>场景三：DataOps 协同，提升研发效能</p>
<p>招商银行在数仓重构迁移中，以算子级血缘为基础构建自动化迁移工具，节省了 500+ 人月 的工作量。在日常研发中，建立了元数据驱动的协同流程，显著提升了数据交付的质量与效率。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1915003d40a140e1aed5d74dd881a967~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQWxvdWRhdGHlpKflupTnp5HmioA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770361653&amp;x-signature=tQUA9fT3VMdkXneFPP44pYUdGEg%3D" alt="3-2.png" loading="lazy"/></p>
<h2 data-id="heading-9">常见问题 (FAQ)</h2>
<h3 data-id="heading-10">Q1: 表级血缘、列级血缘和算子级血缘到底有什么区别？</h3>
<p>表级血缘只看到“表”之间的依赖，如同只看到城市间有公路；列级血缘看到“字段”对应，如同知道货物在车厢，但不知如何装卸加工；算子级血缘深入 SQL 内部，看清每一个“过滤(WHERE)”、“连接(JOIN)”、“聚合(GROUP BY)”操作，如同看清了整个物流分拣、加工、打包的全过程，这是实现精准影响分析的前提。</p>
<h3 data-id="heading-11">Q2: 影响分析误报率高，除了换工具，还有什么临时解决办法？</h3>
<p>临时办法只能是投入大量人力进行“人工复核”：数据工程师在接到泛化的告警后，需要逐一排查下游代码，判断是否真的受影响。这种方法效率极低，不可持续，且高度依赖个人经验，容易出错。这本质上是用人力成本去弥补工具能力的缺陷，并非长久之计。</p>
<h3 data-id="heading-12">Q3: 引入算子级血缘平台（如 Aloudata BIG）的实施周期和难度如何？</h3>
<p>实施关键在于与现有数据平台的集成。Aloudata BIG 支持主流数据库和调度系统，通常可在数周内完成核心数据链路的接入和解析。难度取决于企业数据环境的复杂度。标杆客户的经验表明，一旦上线，在监管溯源、变更防控等场景能立即见效，快速体现 ROI。</p>
<h3 data-id="heading-13">Q4: 算子级血缘能处理存储过程和复杂的ETL脚本吗？</h3>
<p>可以，这正是其核心技术壁垒之一。例如，Aloudata BIG 针对 DB2、GaussDB 等数据库的 PL/SQL 存储过程，解析准确率可达 99%。同时，它能解析复杂的嵌套查询、临时表和动态 SQL，确保在真实企业环境中血缘图谱的完整性和准确性，避免漏报。</p>
<h3 data-id="heading-14">Q5: 对于中小型企业，也需要这么精细的影响分析吗？</h3>
<p>需要，但切入点可能不同。中小型企业可能更关注“成本治理”和“敏捷协同”。通过算子级血缘，可以快速识别僵尸模型、重复计算，优化计算存储成本；同时，在小型团队内建立清晰的数据加工口径，避免知识壁垒，提升数据交付效率与质量。精准的影响分析是数据管理成熟度提升的基石。</p>
<h2 data-id="heading-15">核心要点</h2>
<ol>
<li>误报根源在于粒度：传统表/列级血缘因无法解析 SQL 内部加工逻辑（算子），导致影响分析充满噪声，误报率极高，实为“假分析”。</li>
<li>代差决定精度：算子级血缘（解析准确率 &gt;99%）与传统血缘是代际技术差距，其“行级裁剪”等能力能将影响评估范围降低 80% 以上。</li>
<li>场景驱动价值：精准血缘的价值在于应用，如在自动化监管盘点中提效 20 倍，在主动变更防控中降低扩散度 80%，在 DataOps 协同中节省数百人月。</li>
<li>选型聚焦能力：评估工具应聚焦解析准确率、影响分析精度（是否支持行级裁剪）、业务可读性及血缘保鲜能力四大维度。</li>
<li>主动元数据是方向：未来的数据治理将从被动、静态的目录管理，转向基于算子级血缘的主动感知、分析与行动，实现真正的“真防控”。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Docker 部署 PicGo：一次配置,随处使用]]></title>    <link>https://juejin.cn/post/7600622206268964874</link>    <guid>https://juejin.cn/post/7600622206268964874</guid>    <pubDate>2026-01-29T15:35:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600622206268964874" data-draft-id="7600628279215751194" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Docker 部署 PicGo：一次配置,随处使用"/> <meta itemprop="keywords" content="开源"/> <meta itemprop="datePublished" content="2026-01-29T15:35:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="修己xj"/> <meta itemprop="url" content="https://juejin.cn/user/2641475936724142"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Docker 部署 PicGo：一次配置,随处使用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2641475936724142/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    修己xj
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T15:35:20.000Z" title="Thu Jan 29 2026 15:35:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>简介：通过Docker部署PicGo Server版，实现一次配置、随处可用的高效图片管理方案。本文详细介绍了从构建自定义镜像到启动容器的完整流程，涵盖插件安装、图床配置等关键步骤，并特别提醒了安全注意事项。这一部署方式解决了多设备间配置不同步的痛点，让用户在公司、家庭等多场景下都能使用统一的图床服务，真正做到上传记录集中管理、配置云端同步。无论是个人创作者还是团队协作，都能通过Docker化部署获得更灵活、稳定的图片上传体验。</p>
</blockquote>
<p>在前面的文章中，我们详细介绍了 PicGo 的各种强大功能。不过，许多用户在实际使用中会遇到一个共同的痛点：每台电脑都需要单独配置，对于经常在多台设备间切换的用户来说，确实不够方便。</p>
<p>今天，我将分享如何通过 Docker 在服务器上部署 PicGo 的 Server 版本，实现“一次配置，随处上传”，彻底解决多设备同步难题。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3755ed52d03c4adab6e9cd9af40ab70b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770305722&amp;x-signature=PIiFWJK40NAwWKnz0hX6Cnm4B6M%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">🐳 Docker 部署实战</h2>
<h3 data-id="heading-1">🛠️ 构建自定义镜像</h3>
<p>我选择 <code>node:22.11.0-alpine</code> 作为基础镜像进行构建，以下为完整的 Dockerfile 内容：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用轻量级 Node.js 镜像</span>
FROM node:22.11.0-alpine
<span class="hljs-comment"># 维护者信息</span>
LABEL maintainer=<span class="hljs-string">"xj"</span>
<span class="hljs-comment"># 全局安装 PicGo</span>
RUN npm install picgo -g
<span class="hljs-comment"># 暴露容器 HTTP 端口</span>
EXPOSE 36677
<span class="hljs-comment"># 设置容器启动命令</span>
CMD [<span class="hljs-string">"picgo"</span>, <span class="hljs-string">"server"</span>, <span class="hljs-string">"--host"</span>, <span class="hljs-string">"0.0.0.0"</span>, <span class="hljs-string">"--port"</span>, <span class="hljs-string">"36677"</span>]
</code></pre>
<p>构建镜像：</p>
<pre><code class="hljs language-bash" lang="bash">docker build -t xj/picgo:2.0.0 .
</code></pre>
<p>镜像构建完成后，我已将其上传至阿里云镜像仓库。你也可以直接使用该镜像：<br/>
<code>registry.cn-hangzhou.aliyuncs.com/xjpublic/picgo:2.0.0</code></p>
<h3 data-id="heading-2">⚙️ 启动容器</h3>
<p>创建 <code>docker-compose.yml</code> 文件，内容如下：</p>
<pre><code class="hljs language-bash" lang="bash">services:
  picgo:
    <span class="hljs-comment"># 可替换为阿里云镜像：registry.cn-hangzhou.aliyuncs.com/xjpublic/picgo:2.0.0</span>
    image: xj/picgo:2.0.0
    container_name: picgo
    restart: unless-stopped
    ports:
      - <span class="hljs-string">"36677:36677"</span>
    volumes:
      - ./data:/root/.picgo  <span class="hljs-comment"># 挂载配置文件、插件等数据</span>
</code></pre>
<p>在 <code>docker-compose.yml</code> 同级目录下执行以下命令启动容器：</p>
<pre><code class="hljs">docker-compose up -d
</code></pre>
<p>至此，PicGo 服务已成功启动。</p>
<h3 data-id="heading-3">🧩 插件下载与配置</h3>
<p>服务启动后，我们需要进入容器内部下载并配置插件。执行以下命令进入容器：</p>
<pre><code class="hljs language-bash" lang="bash">docker <span class="hljs-built_in">exec</span> -it &lt;container_id&gt; /bin/sh
</code></pre>
<p>使用 <code>picgo -v</code> 查看 PicGo 版本，也可通过 <code>picgo help</code> 查看更多命令用法。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b7490b504cd4ead8417698ccdcf238f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770305722&amp;x-signature=hisEgl79bKrrmhKkXUFIQOMDF6g%3D" alt="" loading="lazy"/></p>
<p>以我使用的 Chevereto 图床为例，我下载了两个插件：Chevereto 上传插件和文件重命名插件 <code>hashname</code>。具体操作如下：</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># 下载 Chevereto 插件</span>
picgo install chevereto
<span class="hljs-comment"># 选择插件</span>
picgo <span class="hljs-keyword">use</span> plugins
<span class="hljs-comment"># 设置上传器为 Chevereto</span>
picgo set uploader chevereto
<span class="hljs-comment"># 将 Chevereto 设为主图床</span>
picgo <span class="hljs-keyword">use</span> uploader chevereto
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67b212e7fba34815a3f21c1dcb6f5b4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770305722&amp;x-signature=XidqP0HMRg6uUdv83Ye9y%2FPUci0%3D" alt="" loading="lazy"/></p>
<p>配置完成后，重启容器以使配置生效：</p>
<pre><code class="hljs">docker-compose restart
</code></pre>
<p>现在，你就可以在 Postman 或其他第三方工具中，通过配置 PicGo 服务地址来使用图床功能了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1588e8db61384b9398ca8bbd47c3ef71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770305722&amp;x-signature=yDcSzjg2%2FYkNAILd3RzEqi2qj6o%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53fa6a63e7144babbd8a746ec7ae1dea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770305722&amp;x-signature=Wf%2Foo4Iy4MJZ%2BQYsjj6cPuuQnDs%3D" alt="" loading="lazy"/></p>
<p>若需启用文件重命名功能，可配置 <code>hashname</code> 插件：</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># 下载 Hashname 插件</span>
picgo install hashname
<span class="hljs-comment"># 启用插件作为 Transformer</span>
picgo <span class="hljs-keyword">use</span> transformer hashname
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de6c235e297948e3a7b2f12328072ad2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770305722&amp;x-signature=Uv2TF64MCkdMVBYEpl9TVzLWIbY%3D" alt="" loading="lazy"/></p>
<p>至此，基于 Docker 的 PicGo 服务部署与基础配置已全部完成。</p>
<h2 data-id="heading-4">🚨 安全注意事项</h2>
<ol>
<li>1. <strong>请勿在公网直接暴露服务</strong>：除非仅用于临时测试，否则务必配置身份验证。</li>
<li>2. <strong>定期更新镜像</strong>：确保获得最新的安全修复与功能优化。</li>
<li>3. <strong>限制访问 IP</strong>：若仅在内部网络使用，建议设置 IP 白名单。</li>
<li>4. <strong>定期备份配置</strong>：避免因意外导致配置丢失。</li>
</ol>
<h2 data-id="heading-5">🎉 总结</h2>
<p>通过 Docker 部署 PicGo Server 版，我们彻底解决了多设备配置同步的痛点。现在，无论是在公司的办公电脑，还是家里的个人笔记本，只需访问统一的 PicGo 服务地址，即可实现：</p>
<ul>
<li>• <strong>统一配置</strong>：所有设备共用一套图床与插件设置。</li>
<li>• <strong>集中管理</strong>：上传历史与图片库集中存储，便于查找与管理。</li>
</ul>
<p>无论是个人创作还是团队协作，Docker 化部署让 PicGo 的使用变得更加灵活、稳定与高效。现在就动手部署属于你自己的 PicGo 服务吧！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[远程Ubuntu部署deb包]]></title>    <link>https://juejin.cn/post/7600607462584664099</link>    <guid>https://juejin.cn/post/7600607462584664099</guid>    <pubDate>2026-01-29T15:39:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600607462584664099" data-draft-id="7600607462584631331" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="远程Ubuntu部署deb包"/> <meta itemprop="keywords" content="Ubuntu"/> <meta itemprop="datePublished" content="2026-01-29T15:39:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="字节逆旅"/> <meta itemprop="url" content="https://juejin.cn/user/2471357871561214"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            远程Ubuntu部署deb包
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2471357871561214/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    字节逆旅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T15:39:19.000Z" title="Thu Jan 29 2026 15:39:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>如果你的前端应用deb包部署在远程Ubuntu环境， 掌握如何远程部署及监控状态在特殊情况下还是很必要的。</p>
<hr/>
<h2 data-id="heading-0">一、 软件包的安装：从报错到成功</h2>
<h3 data-id="heading-1">1. 基础安装命令</h3>
<p>在远程终端，推荐使用 <code>apt</code> 而非 <code>dpkg</code>，因为 <code>apt</code> 会自动处理依赖。</p>
<pre><code class="hljs language-bash" lang="bash">sudo apt update &amp;&amp; sudo apt install ./your_package.deb

</code></pre>
<h3 data-id="heading-2">2. 常见坑点：404 错误</h3>
<p>按上面的指令执行一般没啥问题，不过由于有的包在安装过程中会下载相关依赖，可能会报错。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/adb8afe167ac49029d6c6eb6d457fed4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2X6IqC6YCG5peF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770305958&amp;x-signature=jymWjgkYiuayB0XfvDaNqZR9zGw%3D" alt="" loading="lazy"/></p>
<p>比如： 这里提示 <code>Failed to fetch... 404 Not Found</code>。
<strong>原因：</strong> 你的本地包索引太旧，系统找不到对应的远程依赖文件。</p>
<p><strong>解决方法：</strong></p>
<ul>
<li>先执行 <code>sudo apt update</code> 更新索引。</li>
<li>再执行 <code>sudo apt --fix-broken install</code> 修复缺失的依赖。</li>
</ul>
<hr/>
<p>修复后再执行上面安装包的命令就可以正常安装了。</p>
<h2 data-id="heading-3">二、 桌面图标：如何保证安装后能被“发现”</h2>
<p>安装完包不代表桌面就一定会有图标。Linux 的桌面图标依赖于 <code>.desktop</code> 文件。</p>
<h3 data-id="heading-4">1. 自动发现</h3>
<p>标准的 <code>.deb</code> 包会将快捷方式存放在 <code>/usr/share/applications/</code>。你可以通过命令检查：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">ls</span> /usr/share/applications/ | grep -i linuxApp

</code></pre>
<p>如果能搜到类似 <code>linuxApp.desktop</code>的结果，那恭喜你，在 Ubuntu 桌面按下 <code>Super</code> 键（Windows键）搜索即可找到。</p>
<h3 data-id="heading-5">2. 将应用图标发送到桌面</h3>
<p>如果你想把这个应用的快捷启动图标放到桌面也是可以的。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cp</span> /usr/share/applications/linuxApp.desktop ~/Desktop/
<span class="hljs-built_in">chmod</span> +x ~/Desktop/linuxApp.desktop
</code></pre>
<p>不过不要忘记你现在是用xshell在远程操作，所以继续往下走，看怎么实现"盲开应用"。</p>
<h3 data-id="heading-6">2. 获取启动“真名”</h3>
<p>如果你要在命令行启动它，必须查出它背后的执行命令要用到的“真名”，执行这条命令：</p>
<pre><code class="hljs language-bash" lang="bash">grep <span class="hljs-string">"Exec"</span> /usr/share/applications/linuxApp.desktop

</code></pre>
<p>你会得到类似 <code>Exec=linux-myApp</code> 的结果，这才是你要用的“启动真名”，后面的操作都会用到这个名字。</p>
<hr/>
<h2 data-id="heading-7">三、 远程启动：如何实现“永不挂断”</h2>
<p>既然已经找到了应用真名，可以用Xshell启动吗？答案是可以的。可如果你直接在 Xshell 里输入命令启动，当前这个窗口关掉后，程序就挂了。所以得用远程持久开启的方案。</p>
<h3 data-id="heading-8">持久化启动</h3>
<p>使用 <code>nohup</code> 命令，让程序脱离 Xshell 会话运行：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">nohup</span> linux-myApp --no-sandbox &gt; /dev/null 2&gt;&amp;1 &amp;

</code></pre>
<p>我来解释一下这些命令的含义：</p>
<ul>
<li><strong><code>nohup</code></strong>：关掉 Xshell，程序不挂断。</li>
<li><strong><code>--no-sandbox</code></strong>：解决远程环境下 Electron 程序的权限报错。</li>
<li><strong><code>&gt; /dev/null 2&gt;&amp;1</code></strong>：丢弃日志，保持终端整洁。</li>
<li><strong><code>&amp;</code></strong>：让程序在后台飞一会儿。</li>
</ul>
<p>也就是说，执行这条命令后，你可以放心地把xshell关闭了，应用不会关闭。</p>
<hr/>
<h2 data-id="heading-9">四、 状态监控：如何知道它是正常的还是“白屏”状态？</h2>
<p>到这一步还没有结束！由于是远程状态，在看不到屏幕的情况下，我如何知道应用程序是否活得好好的呢？你得找到应用进程然后再查它的状态，也可以查它的后台日志，linux都为你准备好了。</p>
<h3 data-id="heading-10">1. 确认进程状态</h3>
<pre><code class="hljs language-bash" lang="bash">ps -ef | grep linux-myApp

</code></pre>
<p>这个命令会输出应用的进程ID、应用名称、PPID等信息；注意看进程信息中的 PPID（第二列数字）是 1。这代表该程序的父进程是系统守护进程，而不是你的 Xshell 会话。</p>
<h3 data-id="heading-11">2. 确认是否卡死</h3>
<p>使用 <code>top</code> 命令监控实时占用：</p>
<pre><code class="hljs language-bash" lang="bash">top -p [进程PID]

</code></pre>
<p>这一步会输出多条数据，可以录个屏确认一下当时的状态。可以根据以下状态分类来判断应用的运行状态：</p>
<ul>
<li><strong>正常</strong>：CPU 有小幅跳动，内存（RES）稳定。</li>
<li><strong>异常（白屏或卡死）</strong>：CPU 长期 0% 或持续 100%。</li>
<li><strong>退出小贴士</strong>：在 <code>top</code> 界面按 <strong><code>q</code></strong> 即可退出。</li>
</ul>
<h3 data-id="heading-12">3. 查看后台日志</h3>
<p>如果还是不放心，直接看软件的“心跳”记录：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">tail</span> -f ~/.config/linux-myApp/logs/main.log

</code></pre>
<p>到这里，基本上你的这次远程盲操部署算是圆满成功了，晚上可以给自己加鸡腿了！</p>
<hr/>
<h2 data-id="heading-13">💡 总结建议</h2>
<p>想成为 Ubuntu 玩家，都得记住这套公式：<strong><code>apt install</code> 安装 -&gt; <code>grep Exec</code> 找应用真名 -&gt; <code>nohup</code> 启动 -&gt; <code>top</code> 找到进程ID后看状态。</strong></p>
<p>希望对你有用！</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[货拉拉待办中心架构设计：打造高效可靠的任务中枢]]></title>    <link>https://juejin.cn/post/7600868443831599123</link>    <guid>https://juejin.cn/post/7600868443831599123</guid>    <pubDate>2026-01-30T07:16:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600868443831599123" data-draft-id="7599964577899773952" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="货拉拉待办中心架构设计：打造高效可靠的任务中枢"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-30T07:16:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="货拉拉技术"/> <meta itemprop="url" content="https://juejin.cn/user/1768489241815070"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            货拉拉待办中心架构设计：打造高效可靠的任务中枢
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1768489241815070/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    货拉拉技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T07:16:28.000Z" title="Fri Jan 30 2026 07:16:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    49
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>"待办"通常指未来需要完成的任务事项。在货拉拉业务体系中，"待办"已不限于传统任务管理范畴，在业务中发挥重要的驱动作用。<strong>本文将阐述如何通过平台化的待办系统设计，满足多样化业务场景<strong><strong>需求</strong></strong>，同时实现亿级流量规模的稳定支撑</strong>。</p>
</blockquote>
<h2 data-id="heading-0">一、待办在货拉拉中的业务意义</h2>
<p>从司机入驻认证、做单履约到退出平台的全生命周期，平台会通过不同的待办事项引导司机完成特定操作，以此保障司机权益及平台合规运营。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/913bdd8314eb48e18cbf702ca4701675~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770364145&amp;x-signature=b5XmuDk5apBi04LwVdMnc5XsqFk%3D" alt="" loading="lazy"/></p>
<p>待办事项按业务特性与要求划分为常规、限时、阻塞三级策略：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0de92c0ac5a448e68ebe4205308a140c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770364145&amp;x-signature=LlybxSfrOyU%2BPEyrstEKO1Zire4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">二、为什么我们要建待办中心</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5df20ea0513542198455292a85507952~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770364145&amp;x-signature=WmPFufU7RIuuzVRyyJ7F3F1H0aA%3D" alt="" loading="lazy"/></p>
<p>随着货拉拉业务规模持续扩张，待办场景复杂度显著提升。原有待办方案依赖实时调用多个服务接口，导致查询链路冗长且脆弱，初期架构难以支撑业务增长，主要面临两大核心挑战：</p>
<p><strong>挑战一：接口稳定性与低延迟要求</strong></p>
<ul>
<li>
<p><strong>核心要求：</strong> 待办会根据其待办等级集成至报价、抢单等核心链路，必须保障高可用性，P99延迟需严格控制在100ms内。</p>
</li>
<li>
<p><strong>原有架构痛点：</strong></p>
<ul>
<li>
<p><strong>响应延迟高：</strong> 单次请求需调用超<strong>12个依赖服务</strong>的多个接口，导致P99响应时间恶化至<strong>2秒以上</strong>，且随业务增长持续攀升。</p>
</li>
<li>
<p><strong>依赖压力大 &amp; 雪崩<strong><strong>风险</strong></strong>：</strong> 接口峰值QPS<strong>超5k</strong>，依赖服务压力过载，高峰期存在服务雪崩隐患。</p>
</li>
<li>
<p><strong>监控与降级<strong><strong>能力不足</strong></strong>：</strong> 分散调用链路缺乏统一监控视图与有效的应急降级能力。</p>
</li>
</ul>
</li>
</ul>
<p><strong>挑战二：<strong><strong>业务</strong></strong>灵活性与扩展性不足</strong></p>
<ul>
<li>
<p><strong>核心要求：</strong> 待办系统对扩展性要求高，要能快速响应多样化待办业务诉求，降低产研接入成本。</p>
</li>
<li>
<p><strong>原有架构痛点：</strong></p>
</li>
<li>
<p><strong>重复建设：</strong> 基于相同业务节点的延伸需求，无法复用，需重复开发建设。</p>
</li>
<li>
<p><strong>扩展受限：</strong> 新待办场景接入受制于资源瓶颈（性能、依赖服务能力等），难以快速上线。</p>
</li>
</ul>
<h2 data-id="heading-2">三、我们的设计思路</h2>
<p><strong>核心思路</strong>**：**待办中心设计的核心思路围绕"<strong>标准化、性能优化、<strong><strong>解耦</strong></strong>扩展</strong>"三大目标展开：</p>
<ul>
<li>
<p>首先通过领域驱动设计方法，提炼待办业务的共性，抽象出标准待办模型及完整的生命周期。提供注册、更新、核销、关闭等能力管理待办的生命周期</p>
</li>
<li>
<p>其次采用本地数据库结合缓存的查询机制，消除跨服务调用延迟，**实现毫秒级响应，**针对存量业务实施标准化改造，<strong>将依赖服务压力降低90%以上</strong></p>
</li>
<li>
<p>最后设计领域事件，如注册成功、核销成功等事件，通过异步事件通知机制实现业务逻辑解耦，使各业务方能<strong>快速响应多样化****需求</strong>而无需重复建设</p>
</li>
</ul>
<p>从而系统性地<strong>解决了接口稳定性、低延迟要求和<strong><strong>业务</strong></strong>扩展性等核心挑战</strong>，既保证了现有业务的高效运行，又为未来业务扩展提供了灵活支撑。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4e2bfdc7fe94b7683d7c4fd4930a087~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770364145&amp;x-signature=4l85tE8C%2FWiyEQ08ZqqRVOUQbTQ%3D" alt="" loading="lazy"/></p>
<p><strong>待办管理</strong></p>
<ul>
<li>
<p>**定义待办模型：**根据待办业务提炼待办的共性属性，如业务类型、待办等级、待办状态、有效时间等。</p>
</li>
<li>
<p><strong>定义待办生命周期</strong>：分析待办从展示到消失的各个状态，如未完成、已过期、已关闭、已完成，构建完整的生命周期。</p>
</li>
<li>
<p><strong>提供核心能力</strong>：提供查询、注册、核销、关闭等待办管理能力，将原本分散在多个服务接口的待办处理逻辑进行整合，减少不必要的实时调用，从而降低下游依赖服务的压力和资源浪费。</p>
</li>
<li>
<p><strong>查询优化</strong>：采用本地数据库查询接口与缓存机制，优化待办信息获取流程，实现待办信息毫秒级响应，彻底规避跨服务调用延迟。</p>
</li>
</ul>
<p><strong>领域事件</strong></p>
<ul>
<li>
<p><strong>事件设计</strong>：通过设计注册成功、核销成功等核心领域事件，实现待办状态变更自动通知。支持服务订阅，灵活支持基于待办流转的多样化需求。</p>
</li>
<li>
<p><strong>待办过期策略</strong>：基于待办过期事件监听，执行预设流转策略，灵活满足各类过期处理场景需求。</p>
</li>
</ul>
<h2 data-id="heading-3">四、关键设计</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/817a65a5ac904fc2a9c565c8fd1256dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770364145&amp;x-signature=MNfnh8jhDuox0hgy7TAuewqBe4w%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">4.1、待办生命周期管理</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f66857ee67047f69e0ded4eceabe541~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770364145&amp;x-signature=LL6Y%2FcmPW1jm%2B87AywDogekgPnA%3D" alt="" loading="lazy"/></p>
<p>  在实现待办数据全场景的统一管理的过程中，我们重点解决了两大难题：首先，针对多系统源数据依赖场景中的无法标准化接入和同步性能瓶颈，采用异步化处理机制实现待办数据的维护；其次，为解决存量业务迁移存在历史数据缺失的问题，结合标准化与异步化处理方案实现了存量待办业务平滑接入。最终形成<strong>标准化管理、异步化管理、协同管理</strong>三种待办生命周期管理模式，全面覆盖从待办展示到消失的全生命周期管理需求。下面将介绍这三种模式。</p>
<h4 data-id="heading-5">4.1.1、标准化管理</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9666e4ef04f04e6196863f8c79d5673a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770364145&amp;x-signature=xgcaJo5sg0iQHblKrMnxXKfiWpM%3D" alt="" loading="lazy"/></p>
<p>标准化管理即由业务服务方通过调用待办中心提供的标准接口，实现对待办事项的全生命周期管理，包括<strong>注册、更新、核销、关闭</strong>等核心操作。</p>
<h4 data-id="heading-6">4.1.2、异步化管理</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26be3d604e5b49a0b4bccc65a0a6605e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770364145&amp;x-signature=J96eQIdwBwhLk5wZLnPWcZohi78%3D" alt="" loading="lazy"/></p>
<p>针对依赖多系统源数据的待办场景，异步化管理通过将同步调用改造为异步处理实现，关键步骤如下：</p>
<ul>
<li>
<p><strong>获取<strong><strong>业务</strong></strong>依赖数据：</strong> 调用相关服务，获取所需业务数据。</p>
</li>
<li>
<p><strong>构建<strong><strong>目标</strong></strong>待办数据集：</strong> 基于获取的业务数据，生成目标待办事项集合。</p>
</li>
<li>
<p><strong>数据比对与待办操作：</strong></p>
</li>
</ul>
<ol>
<li>
<p>注册：若数据库无记录且存在目标待办数据，则构建模型并注册新待办。</p>
</li>
<li>
<p>核销：若数据库有记录且不存在目标待办数据，则执行待办核销。</p>
</li>
<li>
<p>更新：若数据库与目标待办均存在数据但不一致，则更新现有待办。</p>
</li>
</ol>
<h4 data-id="heading-7">4.1.3、协同管理</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91071a2f6b204fcdbbe463f84843ce6c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770364145&amp;x-signature=0SZK6nmqgx8kUoZSgJX6HsVBtfk%3D" alt="" loading="lazy"/></p>
<p>协同管理即通过<strong>标准化与异步能力的动态组合</strong>，如：异步注册待办 + 标准化核销/关闭待办，**典型场景：**存量待办业务接入，异步化管理待办的注册解决存量数据缺失的问题，同时业务服务方也通过标准化管理待办的生命周期，增量、存量双通道完全隔离，迁移过程不影响用户操作，完成后可关闭异步管理通道。</p>
<h4 data-id="heading-8">4.1.4、数据一致性保障</h4>
<p>针对待办存储数据与实际业务数据状态不一致的风险，我们基于系统资源与业务敏感度的平衡考量，设计了<strong>强一致性保障、最终一致性保障</strong>两种一致性保障机制。具体方案选择将综合评估<strong>司机敏感度、待办场景的特性、系统资源</strong>等因素。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a75185f166ad43e6a0f6ca4e29a3f3ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770364145&amp;x-signature=E4AO%2BX7x4zFQ24aQVyK8pbPU%2Brg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-9">4.2、三层流量控制策略</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1afaf8518fea4c2eac8543e3f1ed1e1e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770364145&amp;x-signature=KWLzvjDqKgcDcT8CzXdgDK4nnCY%3D" alt="" loading="lazy"/></p>
<p>为应对接口QPS超阈值引发的系统稳定性风险，在待办异步化管理实施中通过 <strong>场景控流→节点过滤→静默期控制</strong> 三层流量削减，降低峰值压力，实现资源消耗与实时性的最优平衡。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d356fc9e09a44169ed4d9e97a48ea4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770364145&amp;x-signature=dwVZFLs9NBaJBNu%2BOgjO15KWJKc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">4.3、场景弹性扩展设计</h3>
<p>通过工厂模式 + 模版模式，将不同待办业务逻辑的实现类动态绑定到对应场景，实现“按场景分发”，接入的业务场景只需实现抽象类，即可快速且灵活的支持多样化的需求</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df1d8bcf03fc40528cbc70e8c32b3029~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770364145&amp;x-signature=7TwA%2BpDNvc%2BEQNBvy6sUVtsdqHs%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-11">4.3.1、动态注册机制</h4>
<p>场景实现策略类实现<code>InitializingBean</code>接口，在Bean初始化时自动注册到待办策略工厂Map中：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 伪代码逻辑 </span>
场景类初始化 → 实现<span class="hljs-built_in">afterPropertiesSet</span>() → 将当前实例注入策略工厂Map&lt;场景类型, 处理器&gt;
</code></pre>
<h4 data-id="heading-12">4.3.2、模板方法扩展点设计</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/651f9012ebb04dc69d6ab26081dfbb73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770364145&amp;x-signature=G%2F41%2BxKvf4UTbgOf%2Fh4%2FkLRn5Y8%3D" alt="" loading="lazy"/></p>
<ul>
<li>**主干流程固化：**基于模板方法模式实现核心业务流程固化，确保主干逻辑不可变更。以管理注册为例，流程为：</li>
</ul>
<p>1. 流程启动 → 2. 获取本地待办数据 → 3. 判断是否需要尝试注册 → 构建待办数据模型(必选扩展点) → 4. 存储初始化待办数据 → 5. 注册成功后处理(可选扩展点) → 6. 发布 **“**待办注册成功” Kafka事件 → 7. 流程结束</p>
<ul>
<li>
<p>**扩展点开放：**标准流程中预置业务扩展点，支持不同场景的个性化实现</p>
<p>// 伪代码
protected abstract void validate();  // 必选扩展点（如校验）
protected void todoExpireHandle() {{ /* 可选钩子方法（默认空实现）*/ }}</p>
</li>
</ul>
<h3 data-id="heading-13">4.4、稳定性设计</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c20c9207398a44598ef1aa5c7715d485~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770364145&amp;x-signature=DIYX0OTPB48n36R7D7qxxmpd1bE%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-14">4.4.1、实时监控与告警体系建设</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7da2c53111f34f179e0b66c24e2db48f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770364145&amp;x-signature=OvfqaN%2BleFKjnQUZRU5ysEMmKXY%3D" alt="" loading="lazy"/></p>
<p>通过<strong>业务<strong><strong>指标</strong></strong>埋点</strong>（如接口成功率、响应时间）和<strong>全链路节点追踪</strong>（包括异步任务、事件处理等关键路径），构建实时可视化监控大盘。基于多维监控数据动态配置多级告警（P0-P3），实现：</p>
<ul>
<li>
<p>故障分钟级发现：异常指标自动触发对应级别告警</p>
</li>
<li>
<p>根因快速定位：通过链路追踪快速定位故障节点</p>
</li>
<li>
<p>容错自愈：自动触发预设容错策略</p>
</li>
<li>
<p>故障应急：基于实时系统状态评估，决策执行服务降级或分级应急预案，确保核心业务持续可用</p>
</li>
</ul>
<h4 data-id="heading-15">4.4.2、容错机制</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87a178cf14204cc59d906e1388627f7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770364145&amp;x-signature=lAKA4kp1M72pj75riVUNLPyPUX8%3D" alt="" loading="lazy"/></p>
<p>设计容错机制的核心是通过熔断保护（实时监控+自动切断故障）、服务降级（全局/场景化兜底策略）和应急预案构建系统韧性，需配合监控告警与自动化工具落地实施，实现故障快速隔离与核心业务保障。</p>
<h2 data-id="heading-16">五、落地实践</h2>
<p>该方案已全面落地集成报价、抢单等核心链路，目前已接入<strong>50+待办场景</strong>，稳定支撑<strong>日均200万</strong>以上待办生成及<strong>2亿</strong>以上查询请求。新待办业务场景可通过标准化、异步化两种方式快速接入待办中心，支持业务节点灵活扩展，具备敏捷响应业务变化能力</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fa0a4295e094fff984aa914b762e63a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770364145&amp;x-signature=YBpGr%2FpRvrAzcD3OsQzHZwroxBg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-17">六、总结</h2>
<p>司机待办经过不断地迭代升级，逐步从“能力单一的功能模块”升级为“能力全面的待办中心”，能很好的支撑日千万级流量及复杂多变的业务场景，同时也完成了从“被动响应需求”到“主动赋能业务”的转变，帮助更多业务方用更高效的方式引导司机完成各类线上线下操作，提高业务指标的转化。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RBAC 权限系统实战（二）：权限信息管理的设计]]></title>    <link>https://juejin.cn/post/7600837236619935796</link>    <guid>https://juejin.cn/post/7600837236619935796</guid>    <pubDate>2026-01-30T07:33:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600837236619935796" data-draft-id="7600728866757460020" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RBAC 权限系统实战（二）：权限信息管理的设计"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-30T07:33:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="十五丶"/> <meta itemprop="url" content="https://juejin.cn/user/343495027727229"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RBAC 权限系统实战（二）：权限信息管理的设计
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/343495027727229/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    十五丶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T07:33:34.000Z" title="Fri Jan 30 2026 07:33:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>本篇文章主要讲解 RBAC 权限后台系统下，控制菜单、角色、用户信息与操作</p>
<blockquote>
<p>本文也是<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2FBlog%3Ftab%3Dreadme-ov-file%23%25E9%2580%259A%25E4%25BF%2597%25E6%2598%2593%25E6%2587%2582%25E7%259A%2584%25E4%25B8%25AD%25E5%2590%258E%25E5%258F%25B0%25E7%25B3%25BB%25E7%25BB%259F%25E5%25BB%25BA%25E8%25AE%25BE%25E6%258C%2587%25E5%258D%2597%25E4%25B8%2593%25E6%25A0%258F" target="_blank" title="https://github.com/bryqiu/Blog?tab=readme-ov-file#%E9%80%9A%E4%BF%97%E6%98%93%E6%87%82%E7%9A%84%E4%B8%AD%E5%90%8E%E5%8F%B0%E7%B3%BB%E7%BB%9F%E5%BB%BA%E8%AE%BE%E6%8C%87%E5%8D%97%E4%B8%93%E6%A0%8F" ref="nofollow noopener noreferrer">《通俗易懂的中后台系统建设指南》</a>系列的第十篇文章，该系列旨在告诉你如何来构建一个优秀的中后台管理系统</p>
</blockquote>
<h2 data-id="heading-1">RBAC 三要素与模块管理</h2>
<p>在上篇文章，我们讲 RBAC 权限模型的三要素是用户、角色、权限，那这三要素的信息在后台系统管理中，分别体现在：</p>
<ol>
<li>菜单管理：管理系统中全部的菜单权限信息，供角色绑定和侧边栏渲染</li>
<li>角色管理：对角色信息的展示，给角色绑定权限</li>
<li>用户管理：对系统用户列表的展示，给用户分配角色</li>
</ol>
<p>我们写这三个管理模块，主要就是把权限交给系统用户来自定义控制：一个完整的流程是：配置权限信息 =&gt; 角色绑定权限 =&gt; 用户分配角色 =&gt; 用户登录后，只渲染用户角色所拥有的权限路由</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/355a286f69a8462698ccd29a4c176457~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770363214&amp;x-signature=CoKHCs1ZM5FqxdE7dKNSvlltlMU%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">ApiFox 与数据 Mock</h2>
<p>下文中全部数据均由 ApiFox 云端 Mock 生成，我也将这个文档在线分享，你可以访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fclean-admin.apifox.cn%2F" target="_blank" title="https://clean-admin.apifox.cn/" ref="nofollow noopener noreferrer">vue-clean-admin ApiFox 文档</a></p>
<h2 data-id="heading-3">菜单管理</h2>
<p>菜单即权限路由数据，这些菜单数据主要提供给角色绑定和侧边栏菜单的渲染，没有这里的菜单数据，角色权限、用户绑定角色的操作都没有意义</p>
<p>列表的字段定义参考上篇文章<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2FBlog%2Fissues%2F17" target="_blank" title="https://github.com/bryqiu/Blog/issues/17" ref="nofollow noopener noreferrer">RBAC 权限系统实战（一）：页面级访问控制全解析</a>的 <code>PermissionRoute</code> 类型定义</p>
<blockquote>
<p>菜单模块的代码在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2Fvue-clean-admin%2Ftree%2Fmain%2Fsrc%2Fviews%2Fmanages%2Fmenu" target="_blank" title="https://github.com/bryqiu/vue-clean-admin/tree/main/src/views/manages/menu" ref="nofollow noopener noreferrer">views/manages/menu</a> 文件夹下找到</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d939dc639a89406da73489b0ed1a4f64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770363214&amp;x-signature=N4DnCzJors5W52FaMakYBKHqyW0%3D" alt="image.png" loading="lazy"/></p>
<p>这里我们主要讲菜单模块填写表单的一些情况：</p>
<ol>
<li>允许为菜单选择菜单图标 <code>meta.icon</code>，在侧边栏菜单中展示，这里封装了一个图标选择器组件 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2Fvue-clean-admin%2Fblob%2Fmain%2Fsrc%2Fviews%2Fmanages%2Fmenu%2Fwidgets%2Ficon-picker.vue" target="_blank" title="https://github.com/bryqiu/vue-clean-admin/blob/main/src/views/manages/menu/widgets/icon-picker.vue" ref="nofollow noopener noreferrer">icon-pick.vue</a>，后面有机会可以写篇文章聊一下</li>
<li>根据菜单类型动态必填字段，比如“目录”类型的菜单，不需要填写 <code>component</code> 字段等</li>
<li><code>meta</code> 配置，按需配置是否隐藏菜单、菜单排序等</li>
</ol>
<p>菜单管理的操作接口说明，写在了 <a href="https://link.juejin.cn?target=https%3A%2F%2Fclean-admin.apifox.cn%2F397975710e0" target="_blank" title="https://clean-admin.apifox.cn/397975710e0" ref="nofollow noopener noreferrer">ApiFox - 菜单管理</a> 中</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f12eab0e2978473a8fdb52aec0d9f938~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770363214&amp;x-signature=oWF3LdWjH%2B%2F%2B%2F1rEU8MoKBMDZvc%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-4">角色管理</h2>
<p>角色管理，对于角色信息的 CRUD 操作这里不讲，那在这个模块，我们最主要做一件事：给角色分配权限</p>
<blockquote>
<p>角色模块的代码在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2Fvue-clean-admin%2Ftree%2Fmain%2Fsrc%2Fviews%2Fmanages%2Frole" target="_blank" title="https://github.com/bryqiu/vue-clean-admin/tree/main/src/views/manages/role" ref="nofollow noopener noreferrer">views/manages/role</a> 文件夹下找到</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c049a1aecf748d486ebbb2022979ec0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770363214&amp;x-signature=j5yIdhFw%2FT6u%2FWgnQoZWImWnUnM%3D" alt="image.png" loading="lazy"/></p>
<p>在一个分配权限的弹窗表单中，先拉取全部的菜单数据并渲染，供角色绑定，注意这里选中的是菜单 ID，也就是说，角色分配权限的接口设计中，传回角色 ID、选中的权限 ID 集这两个参数，来更新角色的权限</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eaef3f3ce998498dba771d314cf4d064~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770363214&amp;x-signature=6yimUT7f2HY%2F4tEqm%2F9uV%2Fg2eII%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-5">用户管理</h2>
<p>用户管理这个模块，我们还是比较熟悉的，基本的后台系统都有，在实现用户基本的 CRUD 操作后，我们要做的就是给用户分配角色</p>
<p>在分配角色的弹窗表单中，先拉取到全部的<a href="https://link.juejin.cn?target=https%3A%2F%2Fclean-admin.apifox.cn%2F408224595e0" target="_blank" title="https://clean-admin.apifox.cn/408224595e0" ref="nofollow noopener noreferrer">角色列表</a>，回显在下拉框，然后根据用户 ID 查询当前用户已拥有的角色也回显到选中项</p>
<p>注意，用户与角色是一对多的关系，一个用户可以拥有多个角色</p>
<p>接口设计中，传回用户 ID、角色 ID 集两个参数，分配成功后，刷新页面即可拿到最新权限</p>
<blockquote>
<p>角色模块的代码在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2Fvue-clean-admin%2Ftree%2Fmain%2Fsrc%2Fviews%2Fmanages%2Fuser" target="_blank" title="https://github.com/bryqiu/vue-clean-admin/tree/main/src/views/manages/user" ref="nofollow noopener noreferrer">views/manages/user</a> 文件夹下找到</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c132f6f6e61e4e12bc4a6555df4a5bf8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770363214&amp;x-signature=T8HZMPKfszc53wfrEvWzawQdRlE%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-6">最后</h2>
<p>这一套操作下来，我们就实现了系统权限的控制，下一篇文章讲细粒度的权限设计时，还会对菜单管理、角色管理有进一步的处理</p>
<h2 data-id="heading-7">了解更多</h2>
<p>系列专栏地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2FBlog" target="_blank" title="https://github.com/bryqiu/Blog" ref="nofollow noopener noreferrer">GitHub 博客</a> | <a href="https://juejin.cn/column/7437267529330901026" target="_blank" title="https://juejin.cn/column/7437267529330901026">掘金专栏</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fsegmentfault.com%2Fblog%2Fadmin_guide" target="_blank" title="https://segmentfault.com/blog/admin_guide" ref="nofollow noopener noreferrer">思否专栏</a></p>
<p>实战项目：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2Fvue-clean-admin" target="_blank" title="https://github.com/bryqiu/vue-clean-admin" ref="nofollow noopener noreferrer">vue-clean-admin</a></p>
<h2 data-id="heading-8">交流讨论</h2>
<p>文章如有错误或需要改进之处，欢迎指正</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[数据工程实践：智能制造企业如何通过NoETL指标平台为数据资产“瘦身”，实现TCO最优？]]></title>    <link>https://juejin.cn/post/7600957412127866895</link>    <guid>https://juejin.cn/post/7600957412127866895</guid>    <pubDate>2026-01-30T07:37:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600957412127866895" data-draft-id="7600755567486386228" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="数据工程实践：智能制造企业如何通过NoETL指标平台为数据资产“瘦身”，实现TCO最优？"/> <meta itemprop="keywords" content="数据分析"/> <meta itemprop="datePublished" content="2026-01-30T07:37:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Aloudata大应科技"/> <meta itemprop="url" content="https://juejin.cn/user/1579340474099927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            数据工程实践：智能制造企业如何通过NoETL指标平台为数据资产“瘦身”，实现TCO最优？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1579340474099927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Aloudata大应科技
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T07:37:59.000Z" title="Fri Jan 30 2026 07:37:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文首发于 Aloudata 官方技术博客：<a href="https://link.juejin.cn?target=https%3A%2F%2Fai.noetl.cn%2Fknowledge-base%2Fsmart-manufacturing-cost-tco-optimization" target="_blank" title="https://ai.noetl.cn/knowledge-base/smart-manufacturing-cost-tco-optimization" ref="nofollow noopener noreferrer">《智能制造数据资产瘦身指南：三步实现 TCO 最优，释放 50% 成本》</a>转载请注明出处。</p>
</blockquote>
<p><strong>摘要</strong>：本文针对智能制造企业面临的数据存储成本高昂、分析效率低下问题，提出一套基于 NoETL 语义编织技术的现代化数据资产瘦身方法论。该方法论通过架构重构、智能治理、敏捷服务三个核心步骤，系统性解决数据冗余、指标口径混乱和需求响应迟缓三大痛点，旨在帮助企业实现总体拥有成本（TCO）降低 30%-50%，并显著提升数据服务效率。</p>
<p>面对海量质检数据与严苛的长期保存合规要求，智能制造企业正陷入数据存储成本高昂、分析效率低下的困境。本文提出一套融合“湖仓一体”与“AI 自动化数据管理”趋势的现代化数据资产瘦身方法论，通过引入 NoETL 语义编织技术，从架构重构、智能治理到敏捷服务三个步骤，系统性解决数据冗余、口径混乱与响应迟缓三大痛点，帮助企业实现总体拥有成本（TCO）降低 30%-50%，并释放超过 1/3 的服务器资源。本文面向制造业的数据架构师、CDO 及 IT 主管，提供一套可量化、可执行的实践指南。</p>
<h2 data-id="heading-0">前置条件：诊断你的“数据肥胖症”</h2>
<p>在采取任何“瘦身”行动前，必须清晰量化当前数据资产的“肥胖”程度。对于智能制造企业，尤其是涉及精密制造（如半导体、汽车零部件）的领域，数据成本困局通常表现为三大核心症状，其根源在于传统的“烟囱式”宽表开发模式。</p>
<ol>
<li>量化冗余：存储空间的“隐形浪费” 行业观察普遍指出，企业数据湖仓中的数据冗余平均在 5 倍以上。这并非危言耸听。以碳化硅衬底龙头天岳先进的实践为例，其单个厂区年增质检图片文件数量达 数亿至 10亿+级别，按《IATF16949 汽车行业质量管理体系标准》要求保存 15 年以上，数据总量将达 数百亿文件、数十 PB 的惊人规模。传统模式下，为满足不同报表需求，同一份DWD明细数据被反复加工成多个物理宽表（ADS 层），导致存储成本呈几何级数增长。</li>
<li>识别混乱：指标口径的“诸侯割据” 业务部门抱怨数据“不准”，根源在于指标逻辑被分散定义在物理表、ETL 脚本、BI 报表等各处。例如，“生产线 OEE（设备综合效率）”在 MES 系统、质量分析平台和总经理驾驶舱中可能存在三种不同的计算逻辑（停机时间定义、计划时间范围等），形成“同名不同义”的口径之困。这不仅影响决策质量，更在数据回溯和审计时带来巨大风险。</li>
<li>评估迟缓：需求响应的“周级排期” 当业务人员提出一个新的分析维度（如“按新供应商批次分析缺陷率”）时，传统流程需要数据团队重新设计宽表、编写 ETL 任务、进行数据验证，整个周期往往长达 数周。这种响应速度在快节奏的制造业竞争中，意味着错失质量改进和成本优化的黄金窗口期。</li>
</ol>
<h2 data-id="heading-1">第一步：架构重构——从“物理宽表”到“虚拟业务事实网络”</h2>
<p>要根治“数据肥胖症”，必须从源头改变数据生产和消费的架构模式。核心是摒弃为每个报表独立建物理宽表的“烟囱式”开发，转而构建一个基于明细数据的、逻辑统一的虚拟业务事实网络。</p>
<ul>
<li>
<p>技术原理：声明式语义编织 这一转变依赖于 语义引擎（Semantic Engine） 的核心能力。它直接在未打宽的 DWD 明细数据层上，通过 声明式策略，由用户在界面配置业务实体间的逻辑关联（Join）。系统据此在逻辑层面构建一个“虚拟明细大宽表”或“虚拟业务事实网络”，而非物理上复制和拼接数据。当查询请求到来时，引擎自动将基于指标和维度的逻辑查询，翻译并优化为对底层明细表的高效 SQL 执行。</p>
</li>
<li>
<p>对比优势：从“固化”到“灵动”</p>






























<table><thead><tr><th>维度</th><th>传统物理宽表模式</th><th>虚拟业务事实网络模式</th></tr></thead><tbody><tr><td>开发方式</td><td>为特定报表预先开发物理表，固化维度和粒度。</td><td>基于明细数据声明逻辑关联，按需动态组合。</td></tr><tr><td>冗余度</td><td>高。多个宽表存储大量重复数据。</td><td>极低。一份明细数据支撑所有逻辑视图。</td></tr><tr><td>灵活性</td><td>差。新增维度需重建宽表，周期长。</td><td>极强。业务人员可拖拽任意已有维度进行分析。</td></tr><tr><td>维护成本</td><td>高。宽表逻辑变更需回刷数据，影响下游。</td><td>低。逻辑变更集中管理，系统提示影响范围。</td></tr></tbody></table>
</li>
<li>
<p>湖仓一体适配：发挥底层架构优势 这种架构与现代化的 湖仓一体 平台天然契合。语义引擎直接对接湖仓中的 DWD 层明细数据（通常存储于低成本的 Parquet/ORC 格式文件中），充分利用其 存储与计算分离、弹性扩展的特性。企业无需推翻现有数据底座，即可在其上构建轻量、敏捷的语义层，实现“做轻数仓”。</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd185c0f693d49809990c3f8f1318586~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQWxvdWRhdGHlpKflupTnp5HmioA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770363478&amp;x-signature=wlprU4QeU6qxhWtZ6KyNgN%2BU3SI%3D" alt="传统烟囱.png" loading="lazy"/></p>
<h2 data-id="heading-2">第二步：智能治理——嵌入生产流程的自动化“瘦身”机制</h2>
<p>架构重构解决了数据冗余的“存量”问题，而智能治理则通过自动化机制，从“增量”和“使用”环节持续优化，将治理动作从“事后稽核”变为“事中内嵌”。</p>
<p>1、定义即治理：从源头统一口径 在语义引擎中定义指标时，系统会基于指标的逻辑表达式（基础度量、业务限定、统计周期、衍生计算）进行 自动判重校验。如果发现逻辑完全一致的指标，会提示复用，从源头上杜绝“同名不同义”或“同义不同名”的问题，确保企业指标口径 100% 一致。这改变了以往靠文档和人工评审的低效治理模式。</p>
<p>2、智能物化加速：以空间换时间，复用降成本 为了平衡灵活性与查询性能，平台采用 声明式驱动的智能物化加速引擎。用户可以根据业务场景，声明对特定指标组合（如“日粒度-产品线-缺陷数量”）进行物化加速的需求和时效。系统据此自动编排物化任务，并具备关键能力：</p>
<ul>
<li>自动判重与合并：当多个查询或物化声明逻辑相似时，系统自动识别并合并计算任务，生成共享的物化表，避免重复计算与存储。</li>
<li>三级物化机制：支持明细加速、汇总加速和结果加速，智能路由查询至最优的物化结果，实现亿级数据秒级响应（P90&lt;1s）。</li>
<li>透明运维：物化表的创建、更新、生命周期管理均由系统自动完成，极大减轻运维负担。</li>
</ul>
<p>3、TCO 直接优化：来自实践的量化成效 这种“架构+治理”的组合拳，直接作用于企业的总体拥有成本（TCO）。例如，某头部券商在引入Aloudata CAN 后，实现了 基础设施成本节约 50%，并 释放了超过 1/3 的服务器资源。其本质是通过消除冗余的物理宽表开发与存储，以及智能复用计算资源，将存算成本从线性增长转变为可控的平缓增长。</p>
<h2 data-id="heading-3">第三步：敏捷服务——以统一指标API驱动业务价值变现</h2>
<p>“瘦身”的最终目的不是节流，而是为了更好地赋能业务、创造价值。第三步是将治理后的、高质量的数据资产，通过标准、开放的方式，高效、安全地交付给各消费端。</p>
<p>1、统一服务出口：企业指标的“计算中心” 语义引擎平台成为企业指标资产的唯一“注册中心”和“计算中心”。它对外提供标准的 JDBC 接口 和 RESTful API，使得任何需要数据消费的工具或系统，都能通过统一的协议和口径获取数据。这彻底解决了数据出口分散、口径不一的历史难题。</p>
<p>2、赋能业务自助：激活“数据民主化” 业务人员和分析师无需编写 SQL，即可通过简单的拖拽操作，将已定义的“指标”与“维度”进行灵活组合，完成自助分析。例如，质量工程师可以快速分析“近一周各生产线、针对某新物料供应商的缺陷类型分布”。这种模式将大量常规分析需求从 IT 部门释放，显著提升业务响应速度，某央国企实践表明，业务自助可完成 80% 的数据查询和分析需求。</p>
<p>3、原生 AI 适配：根治幻觉的智能问数 面对AI浪潮，传统的“NL2SQL”方式因直接面对杂乱物理表而幻觉风险高。基于语义引擎的 “NL2MQL2SQL” 架构提供了更优解：</p>
<ul>
<li>流程：用户自然语言提问 → LLM 进行意图理解，生成结构化的指标查询语言（MQL，包含 Metric， Filter， Dimensions） → 语义引擎将 MQL 翻译为 100% 准确的优化 SQL 并执行。</li>
<li>优势：将开放性的“写代码”问题，收敛为在已治理的指标库中“做选择”的问题，从根本上 根治幻觉。同时，结合行列级权限管控，确保AI问数的 安全性 与 合规性。某央国企的智能问数准确率已达 92%。</li>
</ul>
<h2 data-id="heading-4">避坑指南：实施“数据瘦身”计划的三大关键决策</h2>
<p>成功实施不仅关乎技术选型，更在于正确的组织策略与实施路径。</p>
<p>1、策略选择“三步走”：平滑演进，规避风险 参考 Aloudata CAN 的落地指南，推荐采用资产演进的“三步走”法则：</p>
<ul>
<li>存量挂载：将逻辑成熟、性能尚可的现有物理宽表直接挂载到新平台，确保历史报表业务 零中断。</li>
<li>增量原生：所有新产生的分析需求，必须通过平台的语义层原生定义和响应，从源头 遏制宽表继续膨胀。</li>
<li>存量替旧：逐步将维护成本高、逻辑混乱的“包袱型”旧宽表迁移下线，用更优的逻辑模型替代。</li>
</ul>
<p>2、组织能力建设：“136”协作模式 改变传统IT包揽一切的模式，建立新的协作范式。例如平安证券实践的 “136”模式：10% 的科技人员负责定义原子指标和底层模型；30% 的业务分析师负责配置复杂的派生指标和业务场景；60% 的终端业务用户进行灵活的指标组装和自助分析。这培养了企业的数据民主化文化。</p>
<p>3、规避“重工具轻架构”：选择动态计算引擎 避免仅仅采购一个静态的指标目录或元数据管理工具。这类工具只能“管”不能“算”，依然依赖底层物理宽表。应选择具备 动态计算能力 和 智能物化引擎 的语义平台，真正实现逻辑与物理解耦，从架构上达成瘦身目标。</p>
<h2 data-id="heading-5">成功标准：如何衡量你的 TCO 优化成效？</h2>
<p>设定可量化的关键绩效指标（KPI），从三个维度评估“数据瘦身”项目的成功。</p>








































<table><thead><tr><th>维度</th><th>关键指标 (KPI)</th><th>目标参考值</th></tr></thead><tbody><tr><td>成本维度</td><td>存储与计算资源消耗降低百分比</td><td>30% - 50%</td></tr><tr><td>物理宽表/汇总表数量减少率</td><td>&gt; 50%</td><td/></tr><tr><td>效率维度</td><td>指标开发效率提升倍数</td><td>10 倍 (如从 1 天 3 个到 1 天 40 个)</td></tr><tr><td>业务自助分析需求占比</td><td>&gt; 60%</td><td/></tr><tr><td>质量维度</td><td>核心业务指标口径一致率</td><td>100%</td></tr><tr><td>智能问数（NL2SQL）准确率</td><td>&gt; 90%</td><td/></tr></tbody></table>
<h2 data-id="heading-6">常见问题（FAQ）</h2>
<h4 data-id="heading-7">Q1: 我们已经在使用数据湖/数据仓库，引入“语义引擎”会不会增加架构复杂度和成本？</h4>
<p>不会。语义引擎（如 Aloudata CAN）旨在简化架构。它直接对接您现有的 DWD 层或湖仓，无需新建大量物理宽表（ADS 层），通过逻辑关联和智能物化复用计算，反而能减少数据冗余和重复开发，是降低总体拥有成本（TCO）的关键。</p>
<h4 data-id="heading-8">Q2: “数据瘦身”过程中，如何保证历史报表和业务分析的连续性？</h4>
<p>推荐采用“三步走”策略。首先，将逻辑稳定、性能尚可的现有宽表直接挂载到新平台，确保历史报表无缝运行。然后，所有新需求通过平台原生定义，遏制宽表膨胀。最后，逐步将维护成本高的旧宽表迁移下线，实现平滑过渡。</p>
<h4 data-id="heading-9">Q3: 对于缺乏高级数据人才的制造企业，如何落地这种现代化的数据管理方法？</h4>
<p>NoETL 模式的核心价值之一就是降低技术门槛。通过“定义即开发”的零代码配置和“NL2MQL2SQL”的智能问数，业务人员和分析师能承担大量分析工作。企业可以从一个核心业务场景（如生产质量追溯）切入，快速验证价值，再逐步推广，实现“弯道超车”。</p>
<h2 data-id="heading-10">核心要点</h2>
<ol>
<li>架构解耦是根本：通过构建基于 DWD 明细层的 虚拟业务事实网络，取代烟囱式物理宽表，从源头上消除数据冗余，这是实现 TCO 优化的架构基础。</li>
<li>治理必须自动化内嵌：将 定义即治理 与 智能物化加速 融入数据生产流程，通过系统自动判重、合并计算任务，在保障口径一致与查询性能的同时，持续优化存算成本。</li>
<li>服务化与 AI 原生是价值放大器：以统一、标准的指标 API 驱动业务自助与AI应用，特别是通过 NL2MQL2SQL 架构实现安全、准确的智能问数，将“瘦身”后的数据资产高效转化为业务决策力与创新力。</li>
</ol>
<p>**本文详细内容及高清交互图表，请访问 Aloudata 官方技术博客原文：<a href="https://link.juejin.cn?target=https%3A%2F%2Fai.noetl.cn%2Fknowledge-base%2Fsmart-manufacturing-cost-tco-optimization" target="_blank" title="https://ai.noetl.cn/knowledge-base/smart-manufacturing-cost-tco-optimization" ref="nofollow noopener noreferrer">ai.noetl.cn/knowledge-b…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java学习第35天 - 分布式系统深入与大数据处理]]></title>    <link>https://juejin.cn/post/7600868443831779347</link>    <guid>https://juejin.cn/post/7600868443831779347</guid>    <pubDate>2026-01-30T07:41:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600868443831779347" data-draft-id="7600863478928998419" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java学习第35天 - 分布式系统深入与大数据处理"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2026-01-30T07:41:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="浮游本尊"/> <meta itemprop="url" content="https://juejin.cn/user/2533726710668696"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java学习第35天 - 分布式系统深入与大数据处理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2533726710668696/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    浮游本尊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T07:41:58.000Z" title="Fri Jan 30 2026 07:41:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">学习目标</h2>
<p>深入理解分布式系统原理，掌握消息队列技术，学习搜索引擎使用，了解大数据处理框架，完成完整项目实战，提升分布式系统开发能力。</p>
<hr/>
<h2 data-id="heading-1">1. 分布式系统深入</h2>
<h3 data-id="heading-2">1.1 分布式锁</h3>
<p><strong>Redis分布式锁：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Redis分布式锁工具类</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisDistributedLock</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> StringRedisTemplate redisTemplate;
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">LOCK_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"lock:"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">UNLOCK_SCRIPT</span> <span class="hljs-operator">=</span> 
        <span class="hljs-string">"if redis.call('get', KEYS[1]) == ARGV[1] then "</span> +
        <span class="hljs-string">"  return redis.call('del', KEYS[1]) "</span> +
        <span class="hljs-string">"else return 0 end"</span>;
    
    <span class="hljs-comment">// 获取锁</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">(String key, String value, <span class="hljs-type">long</span> expireTime, TimeUnit timeUnit)</span> {
        <span class="hljs-type">Boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue()
            .setIfAbsent(LOCK_PREFIX + key, value, expireTime, timeUnit);
        <span class="hljs-keyword">return</span> Boolean.TRUE.equals(result);
    }
    
    <span class="hljs-comment">// 释放锁</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">releaseLock</span><span class="hljs-params">(String key, String value)</span> {
        DefaultRedisScript&lt;Long&gt; script = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRedisScript</span>&lt;&gt;();
        script.setScriptText(UNLOCK_SCRIPT);
        script.setResultType(Long.class);
        
        <span class="hljs-type">Long</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> redisTemplate.execute(script, 
            Collections.singletonList(LOCK_PREFIX + key), value);
        <span class="hljs-keyword">return</span> result != <span class="hljs-literal">null</span> &amp;&amp; result &gt; <span class="hljs-number">0</span>;
    }
    
    <span class="hljs-comment">// 可重入锁</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryReentrantLock</span><span class="hljs-params">(String key, String value, <span class="hljs-type">long</span> expireTime, TimeUnit timeUnit)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> LOCK_PREFIX + key;
        <span class="hljs-type">String</span> <span class="hljs-variable">lockValue</span> <span class="hljs-operator">=</span> value + <span class="hljs-string">":"</span> + Thread.currentThread().getId();
        
        <span class="hljs-comment">// 检查是否已持有锁</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">existingValue</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().get(lockKey);
        <span class="hljs-keyword">if</span> (lockValue.equals(existingValue)) {
            <span class="hljs-comment">// 重入，增加计数</span>
            redisTemplate.opsForValue().increment(lockKey + <span class="hljs-string">":count"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        
        <span class="hljs-comment">// 尝试获取锁</span>
        <span class="hljs-type">Boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue()
            .setIfAbsent(lockKey, lockValue, expireTime, timeUnit);
        
        <span class="hljs-keyword">if</span> (Boolean.TRUE.equals(result)) {
            redisTemplate.opsForValue().set(lockKey + <span class="hljs-string">":count"</span>, <span class="hljs-string">"1"</span>, expireTime, timeUnit);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-comment">// 自动续期锁</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLockWithRenewal</span><span class="hljs-params">(String key, String value, <span class="hljs-type">long</span> expireTime, TimeUnit timeUnit)</span> {
        <span class="hljs-keyword">if</span> (tryLock(key, value, expireTime, timeUnit)) {
            <span class="hljs-comment">// 启动续期任务</span>
            scheduleRenewal(key, value, expireTime, timeUnit);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">scheduleRenewal</span><span class="hljs-params">(String key, String value, <span class="hljs-type">long</span> expireTime, TimeUnit timeUnit)</span> {
        <span class="hljs-type">ScheduledExecutorService</span> <span class="hljs-variable">scheduler</span> <span class="hljs-operator">=</span> Executors.newScheduledThreadPool(<span class="hljs-number">1</span>);
        <span class="hljs-type">long</span> <span class="hljs-variable">renewalInterval</span> <span class="hljs-operator">=</span> expireTime / <span class="hljs-number">3</span>; <span class="hljs-comment">// 每1/3过期时间续期一次</span>
        
        scheduler.scheduleAtFixedRate(() -&gt; {
            <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> LOCK_PREFIX + key;
            <span class="hljs-type">String</span> <span class="hljs-variable">existingValue</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().get(lockKey);
            <span class="hljs-keyword">if</span> (value.equals(existingValue)) {
                redisTemplate.expire(lockKey, expireTime, timeUnit);
                log.debug(<span class="hljs-string">"锁续期成功: {}"</span>, key);
            } <span class="hljs-keyword">else</span> {
                scheduler.shutdown();
            }
        }, renewalInterval, renewalInterval, timeUnit);
    }
}

<span class="hljs-comment">// 分布式锁注解</span>
<span class="hljs-meta">@Target(ElementType.METHOD)</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> DistributedLock {
    String <span class="hljs-title function_">key</span><span class="hljs-params">()</span>;
    <span class="hljs-type">long</span> <span class="hljs-title function_">expireTime</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-number">30</span>;
    TimeUnit <span class="hljs-title function_">timeUnit</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> TimeUnit.SECONDS;
    String <span class="hljs-title function_">errorMessage</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">"获取锁失败，请稍后重试"</span>;
}

<span class="hljs-comment">// 分布式锁切面</span>
<span class="hljs-meta">@Aspect</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DistributedLockAspect</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RedisDistributedLock distributedLock;
    
    <span class="hljs-meta">@Around("@annotation(distributedLock)")</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">around</span><span class="hljs-params">(ProceedingJoinPoint joinPoint, DistributedLock distributedLock)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> distributedLock.key();
        <span class="hljs-type">String</span> <span class="hljs-variable">lockValue</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">boolean</span> <span class="hljs-variable">acquired</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.distributedLock.tryLock(
                lockKey, 
                lockValue, 
                distributedLock.expireTime(), 
                distributedLock.timeUnit()
            );
            
            <span class="hljs-keyword">if</span> (!acquired) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(distributedLock.errorMessage());
            }
            
            <span class="hljs-keyword">return</span> joinPoint.proceed();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-built_in">this</span>.distributedLock.releaseLock(lockKey, lockValue);
        }
    }
}

<span class="hljs-comment">// 使用分布式锁</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RedisDistributedLock distributedLock;
    
    <span class="hljs-meta">@DistributedLock(key = "order:#{#request.userId}", expireTime = 10)</span>
    <span class="hljs-keyword">public</span> OrderDTO <span class="hljs-title function_">createOrder</span><span class="hljs-params">(CreateOrderRequest request)</span> {
        <span class="hljs-comment">// 创建订单逻辑</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderDTO</span>();
    }
    
    <span class="hljs-comment">// 手动使用分布式锁</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processOrder</span><span class="hljs-params">(Long orderId)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"order:process:"</span> + orderId;
        <span class="hljs-type">String</span> <span class="hljs-variable">lockValue</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (distributedLock.tryLock(lockKey, lockValue, <span class="hljs-number">30</span>, TimeUnit.SECONDS)) {
                <span class="hljs-comment">// 处理订单逻辑</span>
                log.info(<span class="hljs-string">"处理订单: {}"</span>, orderId);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"订单正在处理中，请稍后重试"</span>);
            }
        } <span class="hljs-keyword">finally</span> {
            distributedLock.releaseLock(lockKey, lockValue);
        }
    }
}
</code></pre>
<p><strong>Zookeeper分布式锁：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Zookeeper分布式锁</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ZookeeperDistributedLock</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CuratorFramework client;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">lockPath</span> <span class="hljs-operator">=</span> <span class="hljs-string">"/locks"</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ZookeeperDistributedLock</span><span class="hljs-params">(CuratorFramework client)</span> {
        <span class="hljs-built_in">this</span>.client = client;
    }
    
    <span class="hljs-comment">// 获取锁</span>
    <span class="hljs-keyword">public</span> InterProcessMutex <span class="hljs-title function_">acquireLock</span><span class="hljs-params">(String lockName)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> lockPath + <span class="hljs-string">"/"</span> + lockName;
        <span class="hljs-type">InterProcessMutex</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InterProcessMutex</span>(client, path);
        
        <span class="hljs-keyword">try</span> {
            lock.acquire();
            log.info(<span class="hljs-string">"获取锁成功: {}"</span>, lockName);
            <span class="hljs-keyword">return</span> lock;
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"获取锁失败: {}"</span>, lockName, e);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"获取锁失败"</span>, e);
        }
    }
    
    <span class="hljs-comment">// 释放锁</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">releaseLock</span><span class="hljs-params">(InterProcessMutex lock)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (lock != <span class="hljs-literal">null</span> &amp;&amp; lock.isAcquiredInThisProcess()) {
                lock.release();
                log.info(<span class="hljs-string">"释放锁成功"</span>);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"释放锁失败"</span>, e);
        }
    }
    
    <span class="hljs-comment">// 可重入读写锁</span>
    <span class="hljs-keyword">public</span> InterProcessReadWriteLock <span class="hljs-title function_">getReadWriteLock</span><span class="hljs-params">(String lockName)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> lockPath + <span class="hljs-string">"/"</span> + lockName;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InterProcessReadWriteLock</span>(client, path);
    }
}
</code></pre>
<h3 data-id="heading-3">1.2 分布式ID生成</h3>
<p><strong>雪花算法分布式ID：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 雪花算法ID生成器</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SnowflakeIdGenerator</span> {
    
    <span class="hljs-comment">// 起始时间戳（2024-01-01）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">START_TIMESTAMP</span> <span class="hljs-operator">=</span> <span class="hljs-number">1704067200000L</span>;
    
    <span class="hljs-comment">// 机器ID占用的位数</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">WORKER_ID_BITS</span> <span class="hljs-operator">=</span> <span class="hljs-number">5L</span>;
    
    <span class="hljs-comment">// 数据中心ID占用的位数</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">DATACENTER_ID_BITS</span> <span class="hljs-operator">=</span> <span class="hljs-number">5L</span>;
    
    <span class="hljs-comment">// 序列号占用的位数</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">SEQUENCE_BITS</span> <span class="hljs-operator">=</span> <span class="hljs-number">12L</span>;
    
    <span class="hljs-comment">// 机器ID最大值</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">MAX_WORKER_ID</span> <span class="hljs-operator">=</span> ~(-<span class="hljs-number">1L</span> &lt;&lt; WORKER_ID_BITS);
    
    <span class="hljs-comment">// 数据中心ID最大值</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">MAX_DATACENTER_ID</span> <span class="hljs-operator">=</span> ~(-<span class="hljs-number">1L</span> &lt;&lt; DATACENTER_ID_BITS);
    
    <span class="hljs-comment">// 机器ID向左移12位</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">WORKER_ID_SHIFT</span> <span class="hljs-operator">=</span> SEQUENCE_BITS;
    
    <span class="hljs-comment">// 数据中心ID向左移17位（12+5）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">DATACENTER_ID_SHIFT</span> <span class="hljs-operator">=</span> SEQUENCE_BITS + WORKER_ID_BITS;
    
    <span class="hljs-comment">// 时间戳向左移22位（5+5+12）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">TIMESTAMP_LEFT_SHIFT</span> <span class="hljs-operator">=</span> SEQUENCE_BITS + WORKER_ID_BITS + DATACENTER_ID_BITS;
    
    <span class="hljs-comment">// 生成序列的掩码，这里为4095（0b111111111111=0xfff=4095）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">SEQUENCE_MASK</span> <span class="hljs-operator">=</span> ~(-<span class="hljs-number">1L</span> &lt;&lt; SEQUENCE_BITS);
    
    <span class="hljs-comment">// 工作机器ID（0~31）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> workerId;
    
    <span class="hljs-comment">// 数据中心ID（0~31）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> datacenterId;
    
    <span class="hljs-comment">// 毫秒内序列（0~4095）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-variable">sequence</span> <span class="hljs-operator">=</span> <span class="hljs-number">0L</span>;
    
    <span class="hljs-comment">// 上次生成ID的时间戳</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-variable">lastTimestamp</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1L</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SnowflakeIdGenerator</span><span class="hljs-params">(<span class="hljs-meta">@Value("${snowflake.worker-id:1}")</span> <span class="hljs-type">long</span> workerId,
                               <span class="hljs-meta">@Value("${snowflake.datacenter-id:1}")</span> <span class="hljs-type">long</span> datacenterId)</span> {
        <span class="hljs-keyword">if</span> (workerId &gt; MAX_WORKER_ID || workerId &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(
                String.format(<span class="hljs-string">"worker Id can't be greater than %d or less than 0"</span>, MAX_WORKER_ID));
        }
        <span class="hljs-keyword">if</span> (datacenterId &gt; MAX_DATACENTER_ID || datacenterId &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(
                String.format(<span class="hljs-string">"datacenter Id can't be greater than %d or less than 0"</span>, MAX_DATACENTER_ID));
        }
        <span class="hljs-built_in">this</span>.workerId = workerId;
        <span class="hljs-built_in">this</span>.datacenterId = datacenterId;
    }
    
    <span class="hljs-comment">// 获得下一个ID（该方法是线程安全的）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-type">long</span> <span class="hljs-title function_">nextId</span><span class="hljs-params">()</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">timestamp</span> <span class="hljs-operator">=</span> timeGen();
        
        <span class="hljs-comment">// 如果当前时间小于上一次ID生成的时间戳，说明系统时钟回退过，这个时候应当抛出异常</span>
        <span class="hljs-keyword">if</span> (timestamp &lt; lastTimestamp) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(
                String.format(<span class="hljs-string">"Clock moved backwards. Refusing to generate id for %d milliseconds"</span>,
                    lastTimestamp - timestamp));
        }
        
        <span class="hljs-comment">// 如果是同一时间生成的，则进行毫秒内序列</span>
        <span class="hljs-keyword">if</span> (lastTimestamp == timestamp) {
            sequence = (sequence + <span class="hljs-number">1</span>) &amp; SEQUENCE_MASK;
            <span class="hljs-comment">// 毫秒内序列溢出</span>
            <span class="hljs-keyword">if</span> (sequence == <span class="hljs-number">0</span>) {
                <span class="hljs-comment">// 阻塞到下一个毫秒，获得新的时间戳</span>
                timestamp = tilNextMillis(lastTimestamp);
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 时间戳改变，毫秒内序列重置</span>
            sequence = <span class="hljs-number">0L</span>;
        }
        
        <span class="hljs-comment">// 上次生成ID的时间戳</span>
        lastTimestamp = timestamp;
        
        <span class="hljs-comment">// 移位并通过或运算拼到一起组成64位的ID</span>
        <span class="hljs-keyword">return</span> ((timestamp - START_TIMESTAMP) &lt;&lt; TIMESTAMP_LEFT_SHIFT)
            | (datacenterId &lt;&lt; DATACENTER_ID_SHIFT)
            | (workerId &lt;&lt; WORKER_ID_SHIFT)
            | sequence;
    }
    
    <span class="hljs-comment">// 阻塞到下一个毫秒，直到获得新的时间戳</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-title function_">tilNextMillis</span><span class="hljs-params">(<span class="hljs-type">long</span> lastTimestamp)</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">timestamp</span> <span class="hljs-operator">=</span> timeGen();
        <span class="hljs-keyword">while</span> (timestamp &lt;= lastTimestamp) {
            timestamp = timeGen();
        }
        <span class="hljs-keyword">return</span> timestamp;
    }
    
    <span class="hljs-comment">// 返回以毫秒为单位的当前时间</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-title function_">timeGen</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> System.currentTimeMillis();
    }
}

<span class="hljs-comment">// Redis分布式ID生成器</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisIdGenerator</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> StringRedisTemplate redisTemplate;
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ID_KEY_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"id:generator:"</span>;
    
    <span class="hljs-comment">// 基于Redis的分布式ID生成</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">generateId</span><span class="hljs-params">(String businessType)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> ID_KEY_PREFIX + businessType;
        <span class="hljs-type">Long</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().increment(key);
        
        <span class="hljs-comment">// 设置过期时间，防止key无限增长</span>
        redisTemplate.expire(key, <span class="hljs-number">1</span>, TimeUnit.DAYS);
        
        <span class="hljs-keyword">return</span> id;
    }
    
    <span class="hljs-comment">// 批量生成ID</span>
    <span class="hljs-keyword">public</span> List&lt;Long&gt; <span class="hljs-title function_">generateBatchIds</span><span class="hljs-params">(String businessType, <span class="hljs-type">int</span> count)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> ID_KEY_PREFIX + businessType;
        List&lt;Long&gt; ids = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; count; i++) {
            <span class="hljs-type">Long</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().increment(key);
            ids.add(id);
        }
        
        redisTemplate.expire(key, <span class="hljs-number">1</span>, TimeUnit.DAYS);
        <span class="hljs-keyword">return</span> ids;
    }
    
    <span class="hljs-comment">// 带时间戳的ID生成</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">generateIdWithTimestamp</span><span class="hljs-params">(String businessType)</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">timestamp</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        <span class="hljs-type">long</span> <span class="hljs-variable">sequence</span> <span class="hljs-operator">=</span> generateId(businessType);
        <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"%d%06d"</span>, timestamp, sequence);
    }
}

<span class="hljs-comment">// 数据库序列ID生成器</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseIdGenerator</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> JdbcTemplate jdbcTemplate;
    
    <span class="hljs-comment">// 创建序列</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createSequence</span><span class="hljs-params">(String sequenceName)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"CREATE SEQUENCE IF NOT EXISTS "</span> + sequenceName + <span class="hljs-string">" START WITH 1 INCREMENT BY 1"</span>;
        jdbcTemplate.execute(sql);
    }
    
    <span class="hljs-comment">// 获取下一个ID</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">nextId</span><span class="hljs-params">(String sequenceName)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"SELECT NEXTVAL('"</span> + sequenceName + <span class="hljs-string">"')"</span>;
        <span class="hljs-keyword">return</span> jdbcTemplate.queryForObject(sql, Long.class);
    }
    
    <span class="hljs-comment">// 批量获取ID</span>
    <span class="hljs-keyword">public</span> List&lt;Long&gt; <span class="hljs-title function_">nextIds</span><span class="hljs-params">(String sequenceName, <span class="hljs-type">int</span> count)</span> {
        List&lt;Long&gt; ids = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; count; i++) {
            ids.add(nextId(sequenceName));
        }
        <span class="hljs-keyword">return</span> ids;
    }
}
</code></pre>
<h3 data-id="heading-4">1.3 分布式事务</h3>
<p><strong>Seata分布式事务：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Seata配置</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SeataConfig</span> {
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> DataSourceProxy <span class="hljs-title function_">dataSourceProxy</span><span class="hljs-params">(DataSource dataSource)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataSourceProxy</span>(dataSource);
    }
}

<span class="hljs-comment">// 分布式事务服务</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DistributedTransactionService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderService orderService;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> InventoryService inventoryService;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> AccountService accountService;
    
    <span class="hljs-comment">// AT模式（自动补偿）</span>
    <span class="hljs-meta">@GlobalTransactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrderWithTransaction</span><span class="hljs-params">(CreateOrderRequest request)</span> {
        <span class="hljs-comment">// 1. 创建订单</span>
        <span class="hljs-type">OrderDTO</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderService.createOrder(request);
        
        <span class="hljs-comment">// 2. 扣减库存</span>
        inventoryService.deductInventory(request.getProductId(), request.getQuantity());
        
        <span class="hljs-comment">// 3. 扣减账户余额</span>
        accountService.deductBalance(request.getUserId(), order.getAmount());
        
        <span class="hljs-comment">// 如果任何一步失败，所有操作都会回滚</span>
    }
    
    <span class="hljs-comment">// TCC模式（手动补偿）</span>
    <span class="hljs-meta">@GlobalTransactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrderWithTCC</span><span class="hljs-params">(CreateOrderRequest request)</span> {
        <span class="hljs-comment">// Try阶段</span>
        <span class="hljs-keyword">try</span> {
            orderService.tryCreateOrder(request);
            inventoryService.tryDeductInventory(request.getProductId(), request.getQuantity());
            accountService.tryDeductBalance(request.getUserId(), request.getAmount());
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-comment">// Cancel阶段</span>
            orderService.cancelCreateOrder(request);
            inventoryService.cancelDeductInventory(request.getProductId(), request.getQuantity());
            accountService.cancelDeductBalance(request.getUserId(), request.getAmount());
            <span class="hljs-keyword">throw</span> e;
        }
        
        <span class="hljs-comment">// Confirm阶段</span>
        orderService.confirmCreateOrder(request);
        inventoryService.confirmDeductInventory(request.getProductId(), request.getQuantity());
        accountService.confirmDeductBalance(request.getUserId(), request.getAmount());
    }
}

<span class="hljs-comment">// TCC服务接口</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">TccOrderService</span> {
    
    <span class="hljs-meta">@TwoPhaseBusinessAction(
        name = "createOrder",
        commitMethod = "confirm",
        rollbackMethod = "cancel"
    )</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryCreateOrder</span><span class="hljs-params">(<span class="hljs-meta">@BusinessActionContextParameter("orderId")</span> Long orderId,
                          <span class="hljs-meta">@BusinessActionContextParameter("userId")</span> Long userId,
                          <span class="hljs-meta">@BusinessActionContextParameter("amount")</span> BigDecimal amount)</span>;
    
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">confirm</span><span class="hljs-params">(BusinessActionContext context)</span>;
    
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">cancel</span><span class="hljs-params">(BusinessActionContext context)</span>;
}

<span class="hljs-comment">// Saga模式（长事务）</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SagaOrderService</span> {
    
    <span class="hljs-meta">@SagaOrchestrationStart</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrderSaga</span><span class="hljs-params">(CreateOrderRequest request)</span> {
        <span class="hljs-type">SagaTransactionContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SagaTransactionContext</span>();
        context.put(<span class="hljs-string">"orderId"</span>, request.getOrderId());
        context.put(<span class="hljs-string">"userId"</span>, request.getUserId());
        context.put(<span class="hljs-string">"amount"</span>, request.getAmount());
        
        <span class="hljs-comment">// 定义Saga事务步骤</span>
        SagaTransactionManager.start(context, () -&gt; {
            <span class="hljs-comment">// 步骤1：创建订单</span>
            orderService.createOrder(request);
            
            <span class="hljs-comment">// 步骤2：扣减库存</span>
            inventoryService.deductInventory(request.getProductId(), request.getQuantity());
            
            <span class="hljs-comment">// 步骤3：扣减余额</span>
            accountService.deductBalance(request.getUserId(), request.getAmount());
        }, (context) -&gt; {
            <span class="hljs-comment">// 补偿逻辑</span>
            <span class="hljs-type">Long</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> (Long) context.get(<span class="hljs-string">"orderId"</span>);
            orderService.cancelOrder(orderId);
            inventoryService.restoreInventory(request.getProductId(), request.getQuantity());
            accountService.restoreBalance(request.getUserId(), request.getAmount());
        });
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-5">2. 消息队列深入</h2>
<h3 data-id="heading-6">2.1 RabbitMQ</h3>
<p><strong>RabbitMQ配置与使用：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// RabbitMQ配置</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RabbitMQConfig</span> {
    
    <span class="hljs-comment">// 订单队列</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ORDER_QUEUE</span> <span class="hljs-operator">=</span> <span class="hljs-string">"order.queue"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ORDER_EXCHANGE</span> <span class="hljs-operator">=</span> <span class="hljs-string">"order.exchange"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ORDER_ROUTING_KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">"order.create"</span>;
    
    <span class="hljs-comment">// 死信队列</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DLX_QUEUE</span> <span class="hljs-operator">=</span> <span class="hljs-string">"order.dlx.queue"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DLX_EXCHANGE</span> <span class="hljs-operator">=</span> <span class="hljs-string">"order.dlx.exchange"</span>;
    
    <span class="hljs-comment">// 订单队列配置</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">orderQueue</span><span class="hljs-params">()</span> {
        Map&lt;String, Object&gt; args = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        args.put(<span class="hljs-string">"x-dead-letter-exchange"</span>, DLX_EXCHANGE);
        args.put(<span class="hljs-string">"x-dead-letter-routing-key"</span>, <span class="hljs-string">"order.dlx"</span>);
        args.put(<span class="hljs-string">"x-message-ttl"</span>, <span class="hljs-number">60000</span>); <span class="hljs-comment">// 消息TTL 60秒</span>
        <span class="hljs-keyword">return</span> QueueBuilder.durable(ORDER_QUEUE).withArguments(args).build();
    }
    
    <span class="hljs-comment">// 订单交换机</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> TopicExchange <span class="hljs-title function_">orderExchange</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TopicExchange</span>(ORDER_EXCHANGE);
    }
    
    <span class="hljs-comment">// 绑定</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">orderBinding</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> BindingBuilder.bind(orderQueue())
            .to(orderExchange())
            .with(ORDER_ROUTING_KEY);
    }
    
    <span class="hljs-comment">// 死信队列</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">dlxQueue</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> QueueBuilder.durable(DLX_QUEUE).build();
    }
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> DirectExchange <span class="hljs-title function_">dlxExchange</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DirectExchange</span>(DLX_EXCHANGE);
    }
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">dlxBinding</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> BindingBuilder.bind(dlxQueue())
            .to(dlxExchange())
            .with(<span class="hljs-string">"order.dlx"</span>);
    }
    
    <span class="hljs-comment">// 消息转换器</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> MessageConverter <span class="hljs-title function_">messageConverter</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jackson2JsonMessageConverter</span>();
    }
    
    <span class="hljs-comment">// RabbitTemplate配置</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> RabbitTemplate <span class="hljs-title function_">rabbitTemplate</span><span class="hljs-params">(ConnectionFactory connectionFactory)</span> {
        <span class="hljs-type">RabbitTemplate</span> <span class="hljs-variable">template</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RabbitTemplate</span>(connectionFactory);
        template.setMessageConverter(messageConverter());
        
        <span class="hljs-comment">// 确认回调</span>
        template.setConfirmCallback((correlationData, ack, cause) -&gt; {
            <span class="hljs-keyword">if</span> (ack) {
                log.info(<span class="hljs-string">"消息发送成功: {}"</span>, correlationData);
            } <span class="hljs-keyword">else</span> {
                log.error(<span class="hljs-string">"消息发送失败: {}, 原因: {}"</span>, correlationData, cause);
            }
        });
        
        <span class="hljs-comment">// 返回回调</span>
        template.setReturnsCallback(returned -&gt; {
            log.error(<span class="hljs-string">"消息返回: {}"</span>, returned);
        });
        
        <span class="hljs-keyword">return</span> template;
    }
}

<span class="hljs-comment">// RabbitMQ生产者</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RabbitMQProducer</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RabbitTemplate rabbitTemplate;
    
    <span class="hljs-comment">// 发送消息</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendOrderMessage</span><span class="hljs-params">(OrderMessage message)</span> {
        rabbitTemplate.convertAndSend(
            RabbitMQConfig.ORDER_EXCHANGE,
            RabbitMQConfig.ORDER_ROUTING_KEY,
            message,
            messagePostProcessor -&gt; {
                messagePostProcessor.getMessageProperties().setExpiration(<span class="hljs-string">"60000"</span>);
                <span class="hljs-keyword">return</span> messagePostProcessor;
            }
        );
        log.info(<span class="hljs-string">"发送订单消息: {}"</span>, message);
    }
    
    <span class="hljs-comment">// 延迟消息</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendDelayedMessage</span><span class="hljs-params">(OrderMessage message, <span class="hljs-type">long</span> delayMillis)</span> {
        rabbitTemplate.convertAndSend(
            RabbitMQConfig.ORDER_EXCHANGE,
            RabbitMQConfig.ORDER_ROUTING_KEY,
            message,
            messagePostProcessor -&gt; {
                messagePostProcessor.getMessageProperties().setDelay((<span class="hljs-type">int</span>) delayMillis);
                <span class="hljs-keyword">return</span> messagePostProcessor;
            }
        );
    }
    
    <span class="hljs-comment">// 批量发送</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendBatchMessages</span><span class="hljs-params">(List&lt;OrderMessage&gt; messages)</span> {
        <span class="hljs-keyword">for</span> (OrderMessage message : messages) {
            sendOrderMessage(message);
        }
    }
}

<span class="hljs-comment">// RabbitMQ消费者</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RabbitMQConsumer</span> {
    
    <span class="hljs-meta">@RabbitListener(queues = RabbitMQConfig.ORDER_QUEUE)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleOrderMessage</span><span class="hljs-params">(OrderMessage message, Channel channel, 
                                  <span class="hljs-meta">@Header(AmqpHeaders.DELIVERY_TAG)</span> <span class="hljs-type">long</span> deliveryTag)</span> {
        <span class="hljs-keyword">try</span> {
            log.info(<span class="hljs-string">"收到订单消息: {}"</span>, message);
            
            <span class="hljs-comment">// 处理订单逻辑</span>
            processOrder(message);
            
            <span class="hljs-comment">// 手动确认</span>
            channel.basicAck(deliveryTag, <span class="hljs-literal">false</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"处理订单消息失败"</span>, e);
            
            <span class="hljs-comment">// 拒绝消息，重新入队</span>
            <span class="hljs-keyword">try</span> {
                channel.basicNack(deliveryTag, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);
            } <span class="hljs-keyword">catch</span> (IOException ex) {
                log.error(<span class="hljs-string">"拒绝消息失败"</span>, ex);
            }
        }
    }
    
    <span class="hljs-comment">// 死信队列处理</span>
    <span class="hljs-meta">@RabbitListener(queues = RabbitMQConfig.DLX_QUEUE)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleDlxMessage</span><span class="hljs-params">(OrderMessage message)</span> {
        log.error(<span class="hljs-string">"收到死信消息: {}"</span>, message);
        <span class="hljs-comment">// 处理死信消息，如记录日志、发送告警等</span>
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processOrder</span><span class="hljs-params">(OrderMessage message)</span> {
        <span class="hljs-comment">// 订单处理逻辑</span>
    }
}
</code></pre>
<h3 data-id="heading-7">2.2 Kafka</h3>
<p><strong>Kafka配置与使用：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Kafka配置</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KafkaConfig</span> {
    
    <span class="hljs-comment">// 生产者配置</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> ProducerFactory&lt;String, Object&gt; <span class="hljs-title function_">producerFactory</span><span class="hljs-params">()</span> {
        Map&lt;String, Object&gt; configProps = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        configProps.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, <span class="hljs-string">"localhost:9092"</span>);
        configProps.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class);
        configProps.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, JsonSerializer.class);
        configProps.put(ProducerConfig.ACKS_CONFIG, <span class="hljs-string">"all"</span>);
        configProps.put(ProducerConfig.RETRIES_CONFIG, <span class="hljs-number">3</span>);
        configProps.put(ProducerConfig.BATCH_SIZE_CONFIG, <span class="hljs-number">16384</span>);
        configProps.put(ProducerConfig.LINGER_MS_CONFIG, <span class="hljs-number">1</span>);
        configProps.put(ProducerConfig.BUFFER_MEMORY_CONFIG, <span class="hljs-number">33554432</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultKafkaProducerFactory</span>&lt;&gt;(configProps);
    }
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> KafkaTemplate&lt;String, Object&gt; <span class="hljs-title function_">kafkaTemplate</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">KafkaTemplate</span>&lt;&gt;(producerFactory());
    }
    
    <span class="hljs-comment">// 消费者配置</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> ConsumerFactory&lt;String, Object&gt; <span class="hljs-title function_">consumerFactory</span><span class="hljs-params">()</span> {
        Map&lt;String, Object&gt; configProps = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        configProps.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, <span class="hljs-string">"localhost:9092"</span>);
        configProps.put(ConsumerConfig.GROUP_ID_CONFIG, <span class="hljs-string">"order-group"</span>);
        configProps.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);
        configProps.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, JsonDeserializer.class);
        configProps.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, <span class="hljs-string">"earliest"</span>);
        configProps.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, <span class="hljs-literal">false</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultKafkaConsumerFactory</span>&lt;&gt;(configProps);
    }
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> ConcurrentKafkaListenerContainerFactory&lt;String, Object&gt; <span class="hljs-title function_">kafkaListenerContainerFactory</span><span class="hljs-params">()</span> {
        ConcurrentKafkaListenerContainerFactory&lt;String, Object&gt; factory = 
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentKafkaListenerContainerFactory</span>&lt;&gt;();
        factory.setConsumerFactory(consumerFactory());
        factory.setConcurrency(<span class="hljs-number">3</span>); <span class="hljs-comment">// 并发消费者数量</span>
        factory.getContainerProperties().setAckMode(ContainerProperties.AckMode.MANUAL);
        <span class="hljs-keyword">return</span> factory;
    }
}

<span class="hljs-comment">// Kafka生产者</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KafkaProducer</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> KafkaTemplate&lt;String, Object&gt; kafkaTemplate;
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ORDER_TOPIC</span> <span class="hljs-operator">=</span> <span class="hljs-string">"order-topic"</span>;
    
    <span class="hljs-comment">// 发送消息</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendOrderMessage</span><span class="hljs-params">(OrderMessage message)</span> {
        kafkaTemplate.send(ORDER_TOPIC, message.getOrderId().toString(), message)
            .addCallback(
                result -&gt; log.info(<span class="hljs-string">"消息发送成功: {}"</span>, message),
                failure -&gt; log.error(<span class="hljs-string">"消息发送失败: {}"</span>, message, failure)
            );
    }
    
    <span class="hljs-comment">// 批量发送</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendBatchMessages</span><span class="hljs-params">(List&lt;OrderMessage&gt; messages)</span> {
        List&lt;ProducerRecord&lt;String, Object&gt;&gt; records = messages.stream()
            .map(msg -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProducerRecord</span>&lt;&gt;(ORDER_TOPIC, msg.getOrderId().toString(), msg))
            .collect(Collectors.toList());
        
        kafkaTemplate.send(records);
    }
    
    <span class="hljs-comment">// 发送到指定分区</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendToPartition</span><span class="hljs-params">(OrderMessage message, <span class="hljs-type">int</span> partition)</span> {
        kafkaTemplate.send(ORDER_TOPIC, partition, message.getOrderId().toString(), message);
    }
}

<span class="hljs-comment">// Kafka消费者</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KafkaConsumer</span> {
    
    <span class="hljs-meta">@KafkaListener(topics = "order-topic", groupId = "order-group")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">consumeOrderMessage</span><span class="hljs-params">(OrderMessage message,
                                   <span class="hljs-meta">@Header(KafkaHeaders.RECEIVED_PARTITION_ID)</span> <span class="hljs-type">int</span> partition,
                                   <span class="hljs-meta">@Header(KafkaHeaders.OFFSET)</span> <span class="hljs-type">long</span> offset,
                                   Acknowledgment acknowledgment)</span> {
        <span class="hljs-keyword">try</span> {
            log.info(<span class="hljs-string">"收到订单消息: partition={}, offset={}, message={}"</span>, 
                partition, offset, message);
            
            <span class="hljs-comment">// 处理订单逻辑</span>
            processOrder(message);
            
            <span class="hljs-comment">// 手动提交偏移量</span>
            acknowledgment.acknowledge();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"处理订单消息失败"</span>, e);
            <span class="hljs-comment">// 不确认，消息会重新消费</span>
        }
    }
    
    <span class="hljs-comment">// 批量消费</span>
    <span class="hljs-meta">@KafkaListener(topics = "order-topic", groupId = "order-group", 
                   containerFactory = "kafkaListenerContainerFactory")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">consumeBatchMessages</span><span class="hljs-params">(List&lt;OrderMessage&gt; messages,
                                    Acknowledgment acknowledgment)</span> {
        <span class="hljs-keyword">try</span> {
            log.info(<span class="hljs-string">"批量收到 {} 条消息"</span>, messages.size());
            
            <span class="hljs-keyword">for</span> (OrderMessage message : messages) {
                processOrder(message);
            }
            
            acknowledgment.acknowledge();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"批量处理消息失败"</span>, e);
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processOrder</span><span class="hljs-params">(OrderMessage message)</span> {
        <span class="hljs-comment">// 订单处理逻辑</span>
    }
}
</code></pre>
<h3 data-id="heading-8">2.3 RocketMQ</h3>
<p><strong>RocketMQ配置与使用：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// RocketMQ配置</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RocketMQConfig</span> {
    
    <span class="hljs-meta">@Value("${rocketmq.name-server:localhost:9876}")</span>
    <span class="hljs-keyword">private</span> String nameServer;
    
    <span class="hljs-meta">@Value("${rocketmq.producer.group:order-producer-group}")</span>
    <span class="hljs-keyword">private</span> String producerGroup;
    
    <span class="hljs-meta">@Value("${rocketmq.consumer.group:order-consumer-group}")</span>
    <span class="hljs-keyword">private</span> String consumerGroup;
    
    <span class="hljs-comment">// 生产者配置</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> DefaultMQProducer <span class="hljs-title function_">defaultMQProducer</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> MQClientException {
        <span class="hljs-type">DefaultMQProducer</span> <span class="hljs-variable">producer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultMQProducer</span>(producerGroup);
        producer.setNamesrvAddr(nameServer);
        producer.setRetryTimesWhenSendFailed(<span class="hljs-number">3</span>);
        producer.setSendMsgTimeout(<span class="hljs-number">3000</span>);
        producer.start();
        <span class="hljs-keyword">return</span> producer;
    }
    
    <span class="hljs-comment">// 消费者配置</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> DefaultMQPushConsumer <span class="hljs-title function_">defaultMQPushConsumer</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> MQClientException {
        <span class="hljs-type">DefaultMQPushConsumer</span> <span class="hljs-variable">consumer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultMQPushConsumer</span>(consumerGroup);
        consumer.setNamesrvAddr(nameServer);
        consumer.subscribe(<span class="hljs-string">"order-topic"</span>, <span class="hljs-string">"*"</span>);
        consumer.setConsumeThreadMin(<span class="hljs-number">5</span>);
        consumer.setConsumeThreadMax(<span class="hljs-number">20</span>);
        consumer.setConsumeMessageBatchMaxSize(<span class="hljs-number">10</span>);
        <span class="hljs-keyword">return</span> consumer;
    }
}

<span class="hljs-comment">// RocketMQ生产者</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RocketMQProducer</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> DefaultMQProducer producer;
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ORDER_TOPIC</span> <span class="hljs-operator">=</span> <span class="hljs-string">"order-topic"</span>;
    
    <span class="hljs-comment">// 发送同步消息</span>
    <span class="hljs-keyword">public</span> SendResult <span class="hljs-title function_">sendSyncMessage</span><span class="hljs-params">(OrderMessage message)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(ORDER_TOPIC, message.getOrderId().toString(), 
            JSON.toJSONBytes(message));
        <span class="hljs-type">SendResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> producer.send(msg);
        log.info(<span class="hljs-string">"发送同步消息成功: {}"</span>, result);
        <span class="hljs-keyword">return</span> result;
    }
    
    <span class="hljs-comment">// 发送异步消息</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendAsyncMessage</span><span class="hljs-params">(OrderMessage message)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(ORDER_TOPIC, message.getOrderId().toString(), 
            JSON.toJSONBytes(message));
        
        producer.send(msg, <span class="hljs-keyword">new</span> <span class="hljs-title class_">SendCallback</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSuccess</span><span class="hljs-params">(SendResult sendResult)</span> {
                log.info(<span class="hljs-string">"发送异步消息成功: {}"</span>, sendResult);
            }
            
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onException</span><span class="hljs-params">(Throwable e)</span> {
                log.error(<span class="hljs-string">"发送异步消息失败"</span>, e);
            }
        });
    }
    
    <span class="hljs-comment">// 发送单向消息</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendOneWayMessage</span><span class="hljs-params">(OrderMessage message)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(ORDER_TOPIC, message.getOrderId().toString(), 
            JSON.toJSONBytes(message));
        producer.sendOneway(msg);
        log.info(<span class="hljs-string">"发送单向消息: {}"</span>, message);
    }
    
    <span class="hljs-comment">// 发送延迟消息</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendDelayedMessage</span><span class="hljs-params">(OrderMessage message, <span class="hljs-type">int</span> delayLevel)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(ORDER_TOPIC, message.getOrderId().toString(), 
            JSON.toJSONBytes(message));
        msg.setDelayTimeLevel(delayLevel); <span class="hljs-comment">// 1-18级延迟</span>
        producer.send(msg);
        log.info(<span class="hljs-string">"发送延迟消息: {}"</span>, message);
    }
    
    <span class="hljs-comment">// 发送事务消息</span>
    <span class="hljs-keyword">public</span> TransactionSendResult <span class="hljs-title function_">sendTransactionMessage</span><span class="hljs-params">(OrderMessage message)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(ORDER_TOPIC, message.getOrderId().toString(), 
            JSON.toJSONBytes(message));
        <span class="hljs-type">TransactionSendResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> producer.sendMessageInTransaction(msg, 
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderTransactionListener</span>(), message);
        log.info(<span class="hljs-string">"发送事务消息: {}"</span>, result);
        <span class="hljs-keyword">return</span> result;
    }
}

<span class="hljs-comment">// 事务消息监听器</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderTransactionListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TransactionListener</span> {
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> LocalTransactionState <span class="hljs-title function_">executeLocalTransaction</span><span class="hljs-params">(Message msg, Object arg)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">OrderMessage</span> <span class="hljs-variable">orderMessage</span> <span class="hljs-operator">=</span> (OrderMessage) arg;
            <span class="hljs-comment">// 执行本地事务</span>
            processOrder(orderMessage);
            <span class="hljs-keyword">return</span> LocalTransactionState.COMMIT_MESSAGE;
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"执行本地事务失败"</span>, e);
            <span class="hljs-keyword">return</span> LocalTransactionState.ROLLBACK_MESSAGE;
        }
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> LocalTransactionState <span class="hljs-title function_">checkLocalTransaction</span><span class="hljs-params">(MessageExt msg)</span> {
        <span class="hljs-comment">// 检查本地事务状态</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> msg.getKeys();
        <span class="hljs-comment">// 查询订单状态</span>
        <span class="hljs-comment">// 如果订单已创建，返回COMMIT_MESSAGE</span>
        <span class="hljs-comment">// 如果订单创建失败，返回ROLLBACK_MESSAGE</span>
        <span class="hljs-keyword">return</span> LocalTransactionState.COMMIT_MESSAGE;
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processOrder</span><span class="hljs-params">(OrderMessage message)</span> {
        <span class="hljs-comment">// 订单处理逻辑</span>
    }
}

<span class="hljs-comment">// RocketMQ消费者</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RocketMQConsumer</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> DefaultMQPushConsumer consumer;
    
    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> MQClientException {
        consumer.registerMessageListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageListenerConcurrently</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> ConsumeConcurrentlyStatus <span class="hljs-title function_">consumeMessage</span><span class="hljs-params">(
                List&lt;MessageExt&gt; messages,
                ConsumeConcurrentlyContext context)</span> {
                
                <span class="hljs-keyword">for</span> (MessageExt message : messages) {
                    <span class="hljs-keyword">try</span> {
                        <span class="hljs-type">OrderMessage</span> <span class="hljs-variable">orderMessage</span> <span class="hljs-operator">=</span> JSON.parseObject(
                            message.getBody(), OrderMessage.class);
                        log.info(<span class="hljs-string">"收到订单消息: {}"</span>, orderMessage);
                        
                        <span class="hljs-comment">// 处理订单逻辑</span>
                        processOrder(orderMessage);
                        
                        <span class="hljs-keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;
                    } <span class="hljs-keyword">catch</span> (Exception e) {
                        log.error(<span class="hljs-string">"处理订单消息失败"</span>, e);
                        <span class="hljs-keyword">return</span> ConsumeConcurrentlyStatus.RECONSUME_LATER;
                    }
                }
                <span class="hljs-keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;
            }
        });
        
        consumer.start();
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processOrder</span><span class="hljs-params">(OrderMessage message)</span> {
        <span class="hljs-comment">// 订单处理逻辑</span>
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-9">3. 搜索引擎</h2>
<h3 data-id="heading-10">3.1 Elasticsearch</h3>
<p><strong>Elasticsearch配置与使用：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Elasticsearch配置</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ElasticsearchConfig</span> {
    
    <span class="hljs-meta">@Value("${elasticsearch.host:localhost:9200}")</span>
    <span class="hljs-keyword">private</span> String host;
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> RestHighLevelClient <span class="hljs-title function_">restHighLevelClient</span><span class="hljs-params">()</span> {
        String[] hosts = host.split(<span class="hljs-string">","</span>);
        HttpHost[] httpHosts = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHost</span>[hosts.length];
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; hosts.length; i++) {
            String[] hostPort = hosts[i].split(<span class="hljs-string">":"</span>);
            httpHosts[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHost</span>(hostPort[<span class="hljs-number">0</span>], 
                Integer.parseInt(hostPort[<span class="hljs-number">1</span>]), <span class="hljs-string">"http"</span>);
        }
        
        <span class="hljs-type">RestClientBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> RestClient.builder(httpHosts);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestHighLevelClient</span>(builder);
    }
}

<span class="hljs-comment">// Elasticsearch实体</span>
<span class="hljs-meta">@Document(indexName = "orders", type = "_doc")</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderDocument</span> {
    
    <span class="hljs-meta">@Id</span>
    <span class="hljs-keyword">private</span> Long id;
    
    <span class="hljs-meta">@Field(type = FieldType.Keyword)</span>
    <span class="hljs-keyword">private</span> String orderId;
    
    <span class="hljs-meta">@Field(type = FieldType.Long)</span>
    <span class="hljs-keyword">private</span> Long userId;
    
    <span class="hljs-meta">@Field(type = FieldType.Text, analyzer = "ik_max_word")</span>
    <span class="hljs-keyword">private</span> String productName;
    
    <span class="hljs-meta">@Field(type = FieldType.Double)</span>
    <span class="hljs-keyword">private</span> BigDecimal amount;
    
    <span class="hljs-meta">@Field(type = FieldType.Date, pattern = "yyyy-MM-dd HH:mm:ss")</span>
    <span class="hljs-keyword">private</span> Date createTime;
    
    <span class="hljs-meta">@Field(type = FieldType.Keyword)</span>
    <span class="hljs-keyword">private</span> String status;
}

<span class="hljs-comment">// Elasticsearch服务</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ElasticsearchService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RestHighLevelClient client;
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">INDEX_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"orders"</span>;
    
    <span class="hljs-comment">// 创建索引</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createIndex</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-type">CreateIndexRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CreateIndexRequest</span>(INDEX_NAME);
        
        <span class="hljs-comment">// 索引设置</span>
        request.settings(Settings.builder()
            .put(<span class="hljs-string">"index.number_of_shards"</span>, <span class="hljs-number">3</span>)
            .put(<span class="hljs-string">"index.number_of_replicas"</span>, <span class="hljs-number">1</span>)
        );
        
        <span class="hljs-comment">// 映射定义</span>
        <span class="hljs-type">XContentBuilder</span> <span class="hljs-variable">mapping</span> <span class="hljs-operator">=</span> XContentFactory.jsonBuilder()
            .startObject()
                .startObject(<span class="hljs-string">"properties"</span>)
                    .startObject(<span class="hljs-string">"orderId"</span>)
                        .field(<span class="hljs-string">"type"</span>, <span class="hljs-string">"keyword"</span>)
                    .endObject()
                    .startObject(<span class="hljs-string">"userId"</span>)
                        .field(<span class="hljs-string">"type"</span>, <span class="hljs-string">"long"</span>)
                    .endObject()
                    .startObject(<span class="hljs-string">"productName"</span>)
                        .field(<span class="hljs-string">"type"</span>, <span class="hljs-string">"text"</span>)
                        .field(<span class="hljs-string">"analyzer"</span>, <span class="hljs-string">"ik_max_word"</span>)
                    .endObject()
                    .startObject(<span class="hljs-string">"amount"</span>)
                        .field(<span class="hljs-string">"type"</span>, <span class="hljs-string">"double"</span>)
                    .endObject()
                    .startObject(<span class="hljs-string">"createTime"</span>)
                        .field(<span class="hljs-string">"type"</span>, <span class="hljs-string">"date"</span>)
                        .field(<span class="hljs-string">"format"</span>, <span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>)
                    .endObject()
                    .startObject(<span class="hljs-string">"status"</span>)
                        .field(<span class="hljs-string">"type"</span>, <span class="hljs-string">"keyword"</span>)
                    .endObject()
                .endObject()
            .endObject();
        
        request.mapping(mapping);
        
        <span class="hljs-type">CreateIndexResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> client.indices().create(request, 
            RequestOptions.DEFAULT);
        log.info(<span class="hljs-string">"创建索引成功: {}"</span>, response.isAcknowledged());
    }
    
    <span class="hljs-comment">// 添加文档</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addDocument</span><span class="hljs-params">(OrderDocument document)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-type">IndexRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IndexRequest</span>(INDEX_NAME)
            .id(document.getId().toString())
            .source(JSON.toJSONString(document), XContentType.JSON);
        
        <span class="hljs-type">IndexResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> client.index(request, RequestOptions.DEFAULT);
        log.info(<span class="hljs-string">"添加文档成功: {}"</span>, response.getId());
    }
    
    <span class="hljs-comment">// 批量添加文档</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bulkAddDocuments</span><span class="hljs-params">(List&lt;OrderDocument&gt; documents)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-type">BulkRequest</span> <span class="hljs-variable">bulkRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BulkRequest</span>();
        
        <span class="hljs-keyword">for</span> (OrderDocument document : documents) {
            <span class="hljs-type">IndexRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IndexRequest</span>(INDEX_NAME)
                .id(document.getId().toString())
                .source(JSON.toJSONString(document), XContentType.JSON);
            bulkRequest.add(request);
        }
        
        <span class="hljs-type">BulkResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> client.bulk(bulkRequest, RequestOptions.DEFAULT);
        log.info(<span class="hljs-string">"批量添加文档: 成功={}, 失败={}"</span>, 
            response.getItems().length - response.getItems().length, 
            response.getItems().length);
    }
    
    <span class="hljs-comment">// 搜索文档</span>
    <span class="hljs-keyword">public</span> List&lt;OrderDocument&gt; <span class="hljs-title function_">search</span><span class="hljs-params">(String keyword, <span class="hljs-type">int</span> page, <span class="hljs-type">int</span> size)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-type">SearchRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchRequest</span>(INDEX_NAME);
        
        <span class="hljs-comment">// 构建查询</span>
        <span class="hljs-type">BoolQueryBuilder</span> <span class="hljs-variable">boolQuery</span> <span class="hljs-operator">=</span> QueryBuilders.boolQuery();
        
        <span class="hljs-comment">// 多字段搜索</span>
        <span class="hljs-keyword">if</span> (keyword != <span class="hljs-literal">null</span> &amp;&amp; !keyword.isEmpty()) {
            boolQuery.should(QueryBuilders.matchQuery(<span class="hljs-string">"productName"</span>, keyword))
                .should(QueryBuilders.matchQuery(<span class="hljs-string">"orderId"</span>, keyword));
        }
        
        <span class="hljs-comment">// 分页</span>
        request.source(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchSourceBuilder</span>()
            .query(boolQuery)
            .from((page - <span class="hljs-number">1</span>) * size)
            .size(size)
            .sort(<span class="hljs-string">"createTime"</span>, SortOrder.DESC)
        );
        
        <span class="hljs-type">SearchResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> client.search(request, RequestOptions.DEFAULT);
        
        List&lt;OrderDocument&gt; documents = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-keyword">for</span> (SearchHit hit : response.getHits().getHits()) {
            <span class="hljs-type">OrderDocument</span> <span class="hljs-variable">document</span> <span class="hljs-operator">=</span> JSON.parseObject(
                hit.getSourceAsString(), OrderDocument.class);
            documents.add(document);
        }
        
        <span class="hljs-keyword">return</span> documents;
    }
    
    <span class="hljs-comment">// 聚合查询</span>
    <span class="hljs-keyword">public</span> Map&lt;String, Long&gt; <span class="hljs-title function_">aggregateByStatus</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-type">SearchRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchRequest</span>(INDEX_NAME);
        
        <span class="hljs-type">SearchSourceBuilder</span> <span class="hljs-variable">sourceBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchSourceBuilder</span>();
        sourceBuilder.aggregation(
            AggregationBuilders.terms(<span class="hljs-string">"status_agg"</span>).field(<span class="hljs-string">"status"</span>)
        );
        request.source(sourceBuilder);
        
        <span class="hljs-type">SearchResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> client.search(request, RequestOptions.DEFAULT);
        
        <span class="hljs-type">Terms</span> <span class="hljs-variable">terms</span> <span class="hljs-operator">=</span> response.getAggregations().get(<span class="hljs-string">"status_agg"</span>);
        Map&lt;String, Long&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        <span class="hljs-keyword">for</span> (Terms.Bucket bucket : terms.getBuckets()) {
            result.put(bucket.getKeyAsString(), bucket.getDocCount());
        }
        
        <span class="hljs-keyword">return</span> result;
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-11">4. 大数据处理</h2>
<h3 data-id="heading-12">4.1 Spark</h3>
<p><strong>Spark配置与使用：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Spark配置</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SparkConfig</span> {
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> SparkSession <span class="hljs-title function_">sparkSession</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> SparkSession.builder()
            .appName(<span class="hljs-string">"OrderProcessing"</span>)
            .master(<span class="hljs-string">"local[*]"</span>)
            .config(<span class="hljs-string">"spark.sql.warehouse.dir"</span>, <span class="hljs-string">"file:///tmp/spark-warehouse"</span>)
            .getOrCreate();
    }
}

<span class="hljs-comment">// Spark数据处理服务</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SparkDataProcessingService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> SparkSession sparkSession;
    
    <span class="hljs-comment">// 读取数据</span>
    <span class="hljs-keyword">public</span> Dataset&lt;Row&gt; <span class="hljs-title function_">readData</span><span class="hljs-params">(String path)</span> {
        <span class="hljs-keyword">return</span> sparkSession.read()
            .option(<span class="hljs-string">"header"</span>, <span class="hljs-string">"true"</span>)
            .option(<span class="hljs-string">"inferSchema"</span>, <span class="hljs-string">"true"</span>)
            .csv(path);
    }
    
    <span class="hljs-comment">// 数据处理</span>
    <span class="hljs-keyword">public</span> Dataset&lt;Row&gt; <span class="hljs-title function_">processOrders</span><span class="hljs-params">(Dataset&lt;Row&gt; orders)</span> {
        <span class="hljs-keyword">return</span> orders
            .filter(col(<span class="hljs-string">"amount"</span>).gt(<span class="hljs-number">100</span>))
            .groupBy(<span class="hljs-string">"userId"</span>)
            .agg(
                sum(<span class="hljs-string">"amount"</span>).alias(<span class="hljs-string">"totalAmount"</span>),
                count(<span class="hljs-string">"*"</span>).alias(<span class="hljs-string">"orderCount"</span>)
            )
            .orderBy(desc(<span class="hljs-string">"totalAmount"</span>));
    }
    
    <span class="hljs-comment">// 写入数据</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writeData</span><span class="hljs-params">(Dataset&lt;Row&gt; data, String path)</span> {
        data.write()
            .mode(SaveMode.Overwrite)
            .option(<span class="hljs-string">"header"</span>, <span class="hljs-string">"true"</span>)
            .csv(path);
    }
    
    <span class="hljs-comment">// 流式处理</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processStreamingData</span><span class="hljs-params">(String kafkaBootstrapServers, String topic)</span> {
        Dataset&lt;Row&gt; stream = sparkSession
            .readStream()
            .format(<span class="hljs-string">"kafka"</span>)
            .option(<span class="hljs-string">"kafka.bootstrap.servers"</span>, kafkaBootstrapServers)
            .option(<span class="hljs-string">"subscribe"</span>, topic)
            .load();
        
        Dataset&lt;Row&gt; processed = stream
            .selectExpr(<span class="hljs-string">"CAST(value AS STRING)"</span>)
            .select(from_json(col(<span class="hljs-string">"value"</span>), getOrderSchema()).alias(<span class="hljs-string">"order"</span>))
            .select(<span class="hljs-string">"order.*"</span>)
            .filter(col(<span class="hljs-string">"amount"</span>).gt(<span class="hljs-number">100</span>));
        
        processed.writeStream()
            .format(<span class="hljs-string">"console"</span>)
            .outputMode(<span class="hljs-string">"append"</span>)
            .start()
            .awaitTermination();
    }
    
    <span class="hljs-keyword">private</span> StructType <span class="hljs-title function_">getOrderSchema</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StructType</span>()
            .add(<span class="hljs-string">"orderId"</span>, DataTypes.StringType)
            .add(<span class="hljs-string">"userId"</span>, DataTypes.LongType)
            .add(<span class="hljs-string">"amount"</span>, DataTypes.DoubleType)
            .add(<span class="hljs-string">"createTime"</span>, DataTypes.TimestampType);
    }
}
</code></pre>
<h3 data-id="heading-13">4.2 Flink</h3>
<p><strong>Flink配置与使用：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Flink配置</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FlinkConfig</span> {
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> StreamExecutionEnvironment <span class="hljs-title function_">streamExecutionEnvironment</span><span class="hljs-params">()</span> {
        <span class="hljs-type">StreamExecutionEnvironment</span> <span class="hljs-variable">env</span> <span class="hljs-operator">=</span> StreamExecutionEnvironment.getExecutionEnvironment();
        env.setParallelism(<span class="hljs-number">4</span>);
        env.enableCheckpointing(<span class="hljs-number">60000</span>); <span class="hljs-comment">// 1分钟checkpoint</span>
        <span class="hljs-keyword">return</span> env;
    }
}

<span class="hljs-comment">// Flink流处理服务</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FlinkStreamProcessingService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> StreamExecutionEnvironment env;
    
    <span class="hljs-comment">// 处理Kafka流</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processKafkaStream</span><span class="hljs-params">(String kafkaBootstrapServers, String topic)</span> <span class="hljs-keyword">throws</span> Exception {
        FlinkKafkaConsumer&lt;String&gt; consumer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FlinkKafkaConsumer</span>&lt;&gt;(
            topic,
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleStringSchema</span>(),
            getKafkaProperties(kafkaBootstrapServers)
        );
        
        DataStream&lt;String&gt; stream = env.addSource(consumer);
        
        DataStream&lt;OrderEvent&gt; orderStream = stream
            .map(json -&gt; JSON.parseObject(json, OrderEvent.class))
            .filter(order -&gt; order.getAmount() &gt; <span class="hljs-number">100</span>);
        
        <span class="hljs-comment">// 窗口聚合</span>
        DataStream&lt;OrderSummary&gt; summary = orderStream
            .keyBy(OrderEvent::getUserId)
            .window(TumblingEventTimeWindows.of(Time.minutes(<span class="hljs-number">5</span>)))
            .aggregate(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderAggregateFunction</span>());
        
        summary.print();
        
        env.execute(<span class="hljs-string">"Order Processing Job"</span>);
    }
    
    <span class="hljs-comment">// 状态处理</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processWithState</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        DataStream&lt;OrderEvent&gt; stream = getOrderStream();
        
        stream.keyBy(OrderEvent::getUserId)
            .flatMap(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RichFlatMapFunction</span>&lt;OrderEvent, OrderSummary&gt;() {
                <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> ValueState&lt;OrderSummary&gt; state;
                
                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">open</span><span class="hljs-params">(Configuration parameters)</span> {
                    ValueStateDescriptor&lt;OrderSummary&gt; descriptor = 
                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ValueStateDescriptor</span>&lt;&gt;(<span class="hljs-string">"order-summary"</span>, OrderSummary.class);
                    state = getRuntimeContext().getState(descriptor);
                }
                
                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">flatMap</span><span class="hljs-params">(OrderEvent event, Collector&lt;OrderSummary&gt; out)</span> <span class="hljs-keyword">throws</span> Exception {
                    <span class="hljs-type">OrderSummary</span> <span class="hljs-variable">summary</span> <span class="hljs-operator">=</span> state.value();
                    <span class="hljs-keyword">if</span> (summary == <span class="hljs-literal">null</span>) {
                        summary = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderSummary</span>();
                        summary.setUserId(event.getUserId());
                    }
                    
                    summary.setTotalAmount(summary.getTotalAmount() + event.getAmount());
                    summary.setOrderCount(summary.getOrderCount() + <span class="hljs-number">1</span>);
                    
                    state.update(summary);
                    out.collect(summary);
                }
            })
            .print();
        
        env.execute(<span class="hljs-string">"State Processing Job"</span>);
    }
    
    <span class="hljs-keyword">private</span> Properties <span class="hljs-title function_">getKafkaProperties</span><span class="hljs-params">(String bootstrapServers)</span> {
        <span class="hljs-type">Properties</span> <span class="hljs-variable">props</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();
        props.setProperty(<span class="hljs-string">"bootstrap.servers"</span>, bootstrapServers);
        props.setProperty(<span class="hljs-string">"group.id"</span>, <span class="hljs-string">"flink-consumer-group"</span>);
        <span class="hljs-keyword">return</span> props;
    }
    
    <span class="hljs-keyword">private</span> DataStream&lt;OrderEvent&gt; <span class="hljs-title function_">getOrderStream</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 获取订单流</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-14">5. 项目实战</h2>
<h3 data-id="heading-15">5.1 完整项目架构</h3>
<p><strong>微服务项目结构：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 项目结构</span>
<span class="hljs-comment">/*
microservices-project/
├── common/                    # 公共模块
│   ├── common-core/          # 核心工具类
│   ├── common-config/        # 配置类
│   └── common-exception/     # 异常处理
├── gateway/                   # API网关
├── eureka-server/            # 服务注册中心
├── config-server/             # 配置中心
├── order-service/             # 订单服务
│   ├── controller/          # 控制器
│   ├── service/              # 服务层
│   ├── repository/           # 数据访问层
│   └── model/                # 实体类
├── user-service/              # 用户服务
├── product-service/           # 商品服务
└── inventory-service/         # 库存服务
*/</span>

<span class="hljs-comment">// 公共响应类</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiResponse</span>&lt;T&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> code;
    <span class="hljs-keyword">private</span> String message;
    <span class="hljs-keyword">private</span> T data;
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> timestamp;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; ApiResponse&lt;T&gt; <span class="hljs-title function_">success</span><span class="hljs-params">(T data)</span> {
        ApiResponse&lt;T&gt; response = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiResponse</span>&lt;&gt;();
        response.setCode(<span class="hljs-number">200</span>);
        response.setMessage(<span class="hljs-string">"成功"</span>);
        response.setData(data);
        response.setTimestamp(System.currentTimeMillis());
        <span class="hljs-keyword">return</span> response;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; ApiResponse&lt;T&gt; <span class="hljs-title function_">error</span><span class="hljs-params">(<span class="hljs-type">int</span> code, String message)</span> {
        ApiResponse&lt;T&gt; response = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiResponse</span>&lt;&gt;();
        response.setCode(code);
        response.setMessage(message);
        response.setTimestamp(System.currentTimeMillis());
        <span class="hljs-keyword">return</span> response;
    }
}

<span class="hljs-comment">// 全局异常处理</span>
<span class="hljs-meta">@RestControllerAdvice</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalExceptionHandler</span> {
    
    <span class="hljs-meta">@ExceptionHandler(BusinessException.class)</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;ApiResponse&lt;Object&gt;&gt; <span class="hljs-title function_">handleBusinessException</span><span class="hljs-params">(BusinessException e)</span> {
        log.error(<span class="hljs-string">"业务异常"</span>, e);
        <span class="hljs-keyword">return</span> ResponseEntity.status(HttpStatus.BAD_REQUEST)
            .body(ApiResponse.error(e.getCode(), e.getMessage()));
    }
    
    <span class="hljs-meta">@ExceptionHandler(Exception.class)</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;ApiResponse&lt;Object&gt;&gt; <span class="hljs-title function_">handleException</span><span class="hljs-params">(Exception e)</span> {
        log.error(<span class="hljs-string">"系统异常"</span>, e);
        <span class="hljs-keyword">return</span> ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
            .body(ApiResponse.error(<span class="hljs-number">500</span>, <span class="hljs-string">"系统异常，请稍后重试"</span>));
    }
}
</code></pre>
<h3 data-id="heading-16">5.2 项目部署</h3>
<p><strong>Docker Compose部署：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">'3.8'</span>

<span class="hljs-attr">services:</span>
  <span class="hljs-comment"># 服务注册中心</span>
  <span class="hljs-attr">eureka-server:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">eureka-server:latest</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"8761:8761"</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">microservices-network</span>

  <span class="hljs-comment"># API网关</span>
  <span class="hljs-attr">gateway:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">gateway:latest</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"8080:8080"</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">eureka-server</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE=http://eureka-server:8761/eureka/</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">microservices-network</span>

  <span class="hljs-comment"># 订单服务</span>
  <span class="hljs-attr">order-service:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">order-service:latest</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"8081:8080"</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">eureka-server</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">mysql</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE=http://eureka-server:8761/eureka/</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">SPRING_DATASOURCE_URL=jdbc:mysql://mysql:3306/order_db</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">SPRING_REDIS_HOST=redis</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">microservices-network</span>

  <span class="hljs-comment"># MySQL</span>
  <span class="hljs-attr">mysql:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:8.0</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">MYSQL_ROOT_PASSWORD=root123</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">MYSQL_DATABASE=order_db</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">mysql-data:/var/lib/mysql</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">microservices-network</span>

  <span class="hljs-comment"># Redis</span>
  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">redis:7-alpine</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis-data:/data</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">microservices-network</span>

<span class="hljs-attr">volumes:</span>
  <span class="hljs-attr">mysql-data:</span>
  <span class="hljs-attr">redis-data:</span>

<span class="hljs-attr">networks:</span>
  <span class="hljs-attr">microservices-network:</span>
    <span class="hljs-attr">driver:</span> <span class="hljs-string">bridge</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenSpec的核心创新-Artifact Graph剖析]]></title>    <link>https://juejin.cn/post/7600681071715106816</link>    <guid>https://juejin.cn/post/7600681071715106816</guid>    <pubDate>2026-01-30T05:49:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600681071715106816" data-draft-id="7600704706551398440" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenSpec的核心创新-Artifact Graph剖析"/> <meta itemprop="keywords" content="算法"/> <meta itemprop="datePublished" content="2026-01-30T05:49:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鱼疯而行"/> <meta itemprop="url" content="https://juejin.cn/user/4425979920129392"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenSpec的核心创新-Artifact Graph剖析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4425979920129392/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鱼疯而行
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T05:49:07.000Z" title="Fri Jan 30 2026 05:49:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    19
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">2. Artifact Graph 系统</h2>
<h3 data-id="heading-1">概述</h3>
<p>Artifact Graph 是 OpenSpec 的核心创新，它将文档创建过程建模为<strong>有向无环图（DAG）</strong>，自动管理工件之间的依赖关系。</p>
<h3 data-id="heading-2">核心概念</h3>
<h4 data-id="heading-3">什么是 Artifact？</h4>
<p><strong>Artifact（工件）</strong> 是工作流中需要创建的一个文档或文件。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Artifact</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;              <span class="hljs-comment">// 唯一标识，如 "proposal"</span>
  <span class="hljs-attr">generates</span>: <span class="hljs-built_in">string</span>;       <span class="hljs-comment">// 生成的文件路径，如 "proposal.md"</span>
  <span class="hljs-attr">description</span>: <span class="hljs-built_in">string</span>;     <span class="hljs-comment">// 描述</span>
  <span class="hljs-attr">template</span>: <span class="hljs-built_in">string</span>;        <span class="hljs-comment">// 模板文件名</span>
  instruction?: <span class="hljs-built_in">string</span>;    <span class="hljs-comment">// AI 生成指令</span>
  <span class="hljs-attr">requires</span>: <span class="hljs-built_in">string</span>[];      <span class="hljs-comment">// 依赖的其他工件 ID</span>
}
</code></pre>
<p><strong>示例：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">proposal</span>
  <span class="hljs-attr">generates:</span> <span class="hljs-string">proposal.md</span>
  <span class="hljs-attr">description:</span> <span class="hljs-string">Initial</span> <span class="hljs-string">proposal</span> <span class="hljs-string">document</span>
  <span class="hljs-attr">template:</span> <span class="hljs-string">proposal.md</span>
  <span class="hljs-attr">requires:</span> []  <span class="hljs-comment"># 无依赖，可以直接开始</span>

<span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">specs</span>
  <span class="hljs-attr">generates:</span> <span class="hljs-string">"specs/**/*.md"</span>  <span class="hljs-comment"># 支持 glob 模式</span>
  <span class="hljs-attr">description:</span> <span class="hljs-string">Detailed</span> <span class="hljs-string">specifications</span>
  <span class="hljs-attr">template:</span> <span class="hljs-string">spec.md</span>
  <span class="hljs-attr">requires:</span> [<span class="hljs-string">proposal</span>]  <span class="hljs-comment"># 依赖 proposal</span>

<span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">tasks</span>
  <span class="hljs-attr">generates:</span> <span class="hljs-string">tasks.md</span>
  <span class="hljs-attr">description:</span> <span class="hljs-string">Implementation</span> <span class="hljs-string">checklist</span>
  <span class="hljs-attr">template:</span> <span class="hljs-string">tasks.md</span>
  <span class="hljs-attr">requires:</span> [<span class="hljs-string">specs</span>, <span class="hljs-string">design</span>]  <span class="hljs-comment"># 依赖多个工件</span>
</code></pre>
<h4 data-id="heading-4">依赖图可视化</h4>
<pre><code class="hljs language-scss" lang="scss">    proposal (无依赖)
    /      \
specs    design (并行，都依赖 proposal)
    \      /
     tasks (依赖 specs 和 design)
</code></pre>
<h3 data-id="heading-5">核心类：ArtifactGraph</h3>
<h4 data-id="heading-6">类结构</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArtifactGraph</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">artifacts</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Artifact</span>&gt;;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">schema</span>: <span class="hljs-title class_">SchemaYaml</span>;

  <span class="hljs-comment">// 构造函数（私有）</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">constructor</span>(<span class="hljs-params">schema: SchemaYaml</span>);

  <span class="hljs-comment">// 工厂方法</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">fromYaml</span>(<span class="hljs-attr">filePath</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">ArtifactGraph</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">fromYamlContent</span>(<span class="hljs-attr">yamlContent</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">ArtifactGraph</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">fromSchema</span>(<span class="hljs-attr">schema</span>: <span class="hljs-title class_">SchemaYaml</span>): <span class="hljs-title class_">ArtifactGraph</span>;

  <span class="hljs-comment">// 查询方法</span>
  <span class="hljs-title function_">getArtifact</span>(<span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Artifact</span> | <span class="hljs-literal">undefined</span>;
  <span class="hljs-title function_">getAllArtifacts</span>(): <span class="hljs-title class_">Artifact</span>[];
  <span class="hljs-title function_">getName</span>(): <span class="hljs-built_in">string</span>;
  <span class="hljs-title function_">getVersion</span>(): <span class="hljs-built_in">number</span>;

  <span class="hljs-comment">// 核心算法</span>
  <span class="hljs-title function_">getBuildOrder</span>(): <span class="hljs-built_in">string</span>[];
  <span class="hljs-title function_">getNextArtifacts</span>(<span class="hljs-attr">completed</span>: <span class="hljs-title class_">CompletedSet</span>): <span class="hljs-built_in">string</span>[];
  <span class="hljs-title function_">isComplete</span>(<span class="hljs-attr">completed</span>: <span class="hljs-title class_">CompletedSet</span>): <span class="hljs-built_in">boolean</span>;
  <span class="hljs-title function_">getBlocked</span>(<span class="hljs-attr">completed</span>: <span class="hljs-title class_">CompletedSet</span>): <span class="hljs-title class_">BlockedArtifacts</span>;
}
</code></pre>
<h4 data-id="heading-7">核心算法详解</h4>
<h5 data-id="heading-8">1. 拓扑排序 (Kahn's Algorithm)</h5>
<p><strong>目的：</strong> 计算工件的构建顺序</p>
<p><strong>算法实现：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">getBuildOrder</span>(): <span class="hljs-built_in">string</span>[] {
  <span class="hljs-comment">// 步骤 1: 初始化入度表和依赖表</span>
  <span class="hljs-keyword">const</span> inDegree = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">number</span>&gt;();
  <span class="hljs-keyword">const</span> dependents = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>[]&gt;();

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> artifact <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">artifacts</span>.<span class="hljs-title function_">values</span>()) {
    <span class="hljs-comment">// 入度 = 依赖的数量</span>
    inDegree.<span class="hljs-title function_">set</span>(artifact.<span class="hljs-property">id</span>, artifact.<span class="hljs-property">requires</span>.<span class="hljs-property">length</span>);
    dependents.<span class="hljs-title function_">set</span>(artifact.<span class="hljs-property">id</span>, []);
  }

  <span class="hljs-comment">// 步骤 2: 构建反向依赖图（谁依赖我）</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> artifact <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">artifacts</span>.<span class="hljs-title function_">values</span>()) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> req <span class="hljs-keyword">of</span> artifact.<span class="hljs-property">requires</span>) {
      dependents.<span class="hljs-title function_">get</span>(req)!.<span class="hljs-title function_">push</span>(artifact.<span class="hljs-property">id</span>);
    }
  }

  <span class="hljs-comment">// 步骤 3: 找到所有入度为 0 的节点（无依赖）</span>
  <span class="hljs-keyword">const</span> queue = [...<span class="hljs-variable language_">this</span>.<span class="hljs-property">artifacts</span>.<span class="hljs-title function_">keys</span>()]
    .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">id</span> =&gt;</span> inDegree.<span class="hljs-title function_">get</span>(id) === <span class="hljs-number">0</span>)
    .<span class="hljs-title function_">sort</span>();  <span class="hljs-comment">// 排序保证确定性</span>

  <span class="hljs-keyword">const</span> <span class="hljs-attr">result</span>: <span class="hljs-built_in">string</span>[] = [];

  <span class="hljs-comment">// 步骤 4: BFS 遍历</span>
  <span class="hljs-keyword">while</span> (queue.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">const</span> current = queue.<span class="hljs-title function_">shift</span>()!;
    result.<span class="hljs-title function_">push</span>(current);

    <span class="hljs-comment">// 减少依赖者的入度</span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">newlyReady</span>: <span class="hljs-built_in">string</span>[] = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> dep <span class="hljs-keyword">of</span> dependents.<span class="hljs-title function_">get</span>(current)!) {
      <span class="hljs-keyword">const</span> newDegree = inDegree.<span class="hljs-title function_">get</span>(dep)! - <span class="hljs-number">1</span>;
      inDegree.<span class="hljs-title function_">set</span>(dep, newDegree);
      
      <span class="hljs-comment">// 入度变为 0，加入队列</span>
      <span class="hljs-keyword">if</span> (newDegree === <span class="hljs-number">0</span>) {
        newlyReady.<span class="hljs-title function_">push</span>(dep);
      }
    }
    
    queue.<span class="hljs-title function_">push</span>(...newlyReady.<span class="hljs-title function_">sort</span>());
  }

  <span class="hljs-keyword">return</span> result;
}
</code></pre>
<p><strong>示例执行：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">初始状态:</span>
  <span class="hljs-attr">inDegree:</span> { <span class="hljs-attr">proposal:</span> <span class="hljs-number">0</span>, <span class="hljs-attr">specs:</span> <span class="hljs-number">1</span>, <span class="hljs-attr">design:</span> <span class="hljs-number">1</span>, <span class="hljs-attr">tasks:</span> <span class="hljs-number">2</span> }
  <span class="hljs-attr">queue:</span> [<span class="hljs-string">proposal</span>]

<span class="hljs-string">迭代</span> <span class="hljs-attr">1:</span>
  <span class="hljs-string">处理:</span> <span class="hljs-string">proposal</span>
  <span class="hljs-string">更新:</span> <span class="hljs-string">specs</span> <span class="hljs-string">(1→0),</span> <span class="hljs-string">design</span> <span class="hljs-string">(1→0)</span>
  <span class="hljs-attr">queue:</span> [<span class="hljs-string">design</span>, <span class="hljs-string">specs</span>]  <span class="hljs-comment"># 排序后</span>
  <span class="hljs-attr">result:</span> [<span class="hljs-string">proposal</span>]

<span class="hljs-string">迭代</span> <span class="hljs-attr">2:</span>
  <span class="hljs-string">处理:</span> <span class="hljs-string">design</span>
  <span class="hljs-string">更新:</span> <span class="hljs-string">tasks</span> <span class="hljs-string">(2→1)</span>
  <span class="hljs-attr">queue:</span> [<span class="hljs-string">specs</span>]
  <span class="hljs-attr">result:</span> [<span class="hljs-string">proposal</span>, <span class="hljs-string">design</span>]

<span class="hljs-string">迭代</span> <span class="hljs-attr">3:</span>
  <span class="hljs-string">处理:</span> <span class="hljs-string">specs</span>
  <span class="hljs-string">更新:</span> <span class="hljs-string">tasks</span> <span class="hljs-string">(1→0)</span>
  <span class="hljs-attr">queue:</span> [<span class="hljs-string">tasks</span>]
  <span class="hljs-attr">result:</span> [<span class="hljs-string">proposal</span>, <span class="hljs-string">design</span>, <span class="hljs-string">specs</span>]

<span class="hljs-string">迭代</span> <span class="hljs-attr">4:</span>
  <span class="hljs-string">处理:</span> <span class="hljs-string">tasks</span>
  <span class="hljs-attr">queue:</span> []
  <span class="hljs-attr">result:</span> [<span class="hljs-string">proposal</span>, <span class="hljs-string">design</span>, <span class="hljs-string">specs</span>, <span class="hljs-string">tasks</span>]
</code></pre>
<p><strong>时间复杂度：</strong> O(V + E)，其中 V 是工件数，E 是依赖边数</p>
<h5 data-id="heading-9">2. 查找可执行工件</h5>
<p><strong>目的：</strong> 找出所有依赖已满足的工件</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">getNextArtifacts</span>(<span class="hljs-attr">completed</span>: <span class="hljs-title class_">CompletedSet</span>): <span class="hljs-built_in">string</span>[] {
  <span class="hljs-keyword">const</span> <span class="hljs-attr">ready</span>: <span class="hljs-built_in">string</span>[] = [];

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> artifact <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">artifacts</span>.<span class="hljs-title function_">values</span>()) {
    <span class="hljs-comment">// 跳过已完成的</span>
    <span class="hljs-keyword">if</span> (completed.<span class="hljs-title function_">has</span>(artifact.<span class="hljs-property">id</span>)) {
      <span class="hljs-keyword">continue</span>;
    }

    <span class="hljs-comment">// 检查所有依赖是否都已完成</span>
    <span class="hljs-keyword">const</span> allDepsCompleted = artifact.<span class="hljs-property">requires</span>.<span class="hljs-title function_">every</span>(
      <span class="hljs-function"><span class="hljs-params">req</span> =&gt;</span> completed.<span class="hljs-title function_">has</span>(req)
    );

    <span class="hljs-keyword">if</span> (allDepsCompleted) {
      ready.<span class="hljs-title function_">push</span>(artifact.<span class="hljs-property">id</span>);
    }
  }

  <span class="hljs-keyword">return</span> ready.<span class="hljs-title function_">sort</span>();  <span class="hljs-comment">// 排序保证确定性</span>
}
</code></pre>
<p><strong>示例：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 假设 completed = { proposal }</span>
<span class="hljs-title function_">getNextArtifacts</span>(completed)
<span class="hljs-comment">// 返回: [design, specs]  // 两者都只依赖 proposal</span>

<span class="hljs-comment">// 假设 completed = { proposal, specs, design }</span>
<span class="hljs-title function_">getNextArtifacts</span>(completed)
<span class="hljs-comment">// 返回: [tasks]  // tasks 依赖 specs 和 design</span>
</code></pre>
<h5 data-id="heading-10">3. 检查完成状态</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">isComplete</span>(<span class="hljs-attr">completed</span>: <span class="hljs-title class_">CompletedSet</span>): <span class="hljs-built_in">boolean</span> {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> artifact <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">artifacts</span>.<span class="hljs-title function_">values</span>()) {
    <span class="hljs-keyword">if</span> (!completed.<span class="hljs-title function_">has</span>(artifact.<span class="hljs-property">id</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
  }
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
</code></pre>
<h5 data-id="heading-11">4. 查找阻塞工件</h5>
<p><strong>目的：</strong> 找出被阻塞的工件及其未满足的依赖</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">getBlocked</span>(<span class="hljs-attr">completed</span>: <span class="hljs-title class_">CompletedSet</span>): <span class="hljs-title class_">BlockedArtifacts</span> {
  <span class="hljs-keyword">const</span> <span class="hljs-attr">blocked</span>: <span class="hljs-title class_">BlockedArtifacts</span> = {};

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> artifact <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">artifacts</span>.<span class="hljs-title function_">values</span>()) {
    <span class="hljs-comment">// 跳过已完成的</span>
    <span class="hljs-keyword">if</span> (completed.<span class="hljs-title function_">has</span>(artifact.<span class="hljs-property">id</span>)) {
      <span class="hljs-keyword">continue</span>;
    }

    <span class="hljs-comment">// 找出未满足的依赖</span>
    <span class="hljs-keyword">const</span> unmetDeps = artifact.<span class="hljs-property">requires</span>.<span class="hljs-title function_">filter</span>(
      <span class="hljs-function"><span class="hljs-params">req</span> =&gt;</span> !completed.<span class="hljs-title function_">has</span>(req)
    );

    <span class="hljs-keyword">if</span> (unmetDeps.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
      blocked[artifact.<span class="hljs-property">id</span>] = unmetDeps.<span class="hljs-title function_">sort</span>();
    }
  }

  <span class="hljs-keyword">return</span> blocked;
}
</code></pre>
<p><strong>示例：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 假设 completed = { proposal }</span>
<span class="hljs-title function_">getBlocked</span>(completed)
<span class="hljs-comment">// 返回: { tasks: ['design', 'specs'] }</span>
<span class="hljs-comment">// tasks 被 design 和 specs 阻塞</span>
</code></pre>
<h3 data-id="heading-12">Schema 解析</h3>
<h4 data-id="heading-13">Schema 文件格式</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">spec-driven</span>
<span class="hljs-attr">version:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">description:</span> <span class="hljs-string">Default</span> <span class="hljs-string">OpenSpec</span> <span class="hljs-string">workflow</span>
<span class="hljs-attr">artifacts:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">proposal</span>
    <span class="hljs-attr">generates:</span> <span class="hljs-string">proposal.md</span>
    <span class="hljs-attr">description:</span> <span class="hljs-string">Initial</span> <span class="hljs-string">proposal</span>
    <span class="hljs-attr">template:</span> <span class="hljs-string">proposal.md</span>
    <span class="hljs-attr">instruction:</span> <span class="hljs-string">|
      Create the proposal document...
</span>    <span class="hljs-attr">requires:</span> []

  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">specs</span>
    <span class="hljs-attr">generates:</span> <span class="hljs-string">"specs/**/*.md"</span>
    <span class="hljs-attr">description:</span> <span class="hljs-string">Detailed</span> <span class="hljs-string">specifications</span>
    <span class="hljs-attr">template:</span> <span class="hljs-string">spec.md</span>
    <span class="hljs-attr">requires:</span> [<span class="hljs-string">proposal</span>]

<span class="hljs-attr">apply:</span>
  <span class="hljs-attr">requires:</span> [<span class="hljs-string">tasks</span>]
  <span class="hljs-attr">tracks:</span> <span class="hljs-string">tasks.md</span>
  <span class="hljs-attr">instruction:</span> <span class="hljs-string">|
    Implement tasks...
</span></code></pre>
<h4 data-id="heading-14">解析流程</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">parseSchema</span>(<span class="hljs-params">yamlContent: <span class="hljs-built_in">string</span></span>): <span class="hljs-title class_">SchemaYaml</span> {
  <span class="hljs-comment">// 1. 解析 YAML</span>
  <span class="hljs-keyword">const</span> parsed = <span class="hljs-title function_">parseYaml</span>(yamlContent);

  <span class="hljs-comment">// 2. Zod 验证</span>
  <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">SchemaYamlSchema</span>.<span class="hljs-title function_">safeParse</span>(parsed);
  <span class="hljs-keyword">if</span> (!result.<span class="hljs-property">success</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SchemaValidationError</span>(<span class="hljs-title function_">formatErrors</span>(result.<span class="hljs-property">error</span>));
  }

  <span class="hljs-keyword">const</span> schema = result.<span class="hljs-property">data</span>;

  <span class="hljs-comment">// 3. 业务规则验证</span>
  <span class="hljs-title function_">validateNoDuplicateIds</span>(schema.<span class="hljs-property">artifacts</span>);
  <span class="hljs-title function_">validateRequiresReferences</span>(schema.<span class="hljs-property">artifacts</span>);
  <span class="hljs-title function_">validateNoCycles</span>(schema.<span class="hljs-property">artifacts</span>);

  <span class="hljs-keyword">return</span> schema;
}
</code></pre>
<h4 data-id="heading-15">循环依赖检测</h4>
<p><strong>使用 DFS 检测环：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">validateNoCycles</span>(<span class="hljs-params">artifacts: Artifact[]</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-keyword">const</span> artifactMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(artifacts.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">a</span> =&gt;</span> [a.<span class="hljs-property">id</span>, a]));
  <span class="hljs-keyword">const</span> visited = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">string</span>&gt;();
  <span class="hljs-keyword">const</span> inStack = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">string</span>&gt;();  <span class="hljs-comment">// 当前 DFS 路径</span>
  <span class="hljs-keyword">const</span> parent = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;();

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">dfs</span>(<span class="hljs-params">id: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span> {
    visited.<span class="hljs-title function_">add</span>(id);
    inStack.<span class="hljs-title function_">add</span>(id);

    <span class="hljs-keyword">const</span> artifact = artifactMap.<span class="hljs-title function_">get</span>(id);
    <span class="hljs-keyword">if</span> (!artifact) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> dep <span class="hljs-keyword">of</span> artifact.<span class="hljs-property">requires</span>) {
      <span class="hljs-keyword">if</span> (!visited.<span class="hljs-title function_">has</span>(dep)) {
        parent.<span class="hljs-title function_">set</span>(dep, id);
        <span class="hljs-keyword">const</span> cycle = <span class="hljs-title function_">dfs</span>(dep);
        <span class="hljs-keyword">if</span> (cycle) <span class="hljs-keyword">return</span> cycle;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (inStack.<span class="hljs-title function_">has</span>(dep)) {
        <span class="hljs-comment">// 发现环！重建路径</span>
        <span class="hljs-keyword">const</span> cyclePath = [dep];
        <span class="hljs-keyword">let</span> current = id;
        <span class="hljs-keyword">while</span> (current !== dep) {
          cyclePath.<span class="hljs-title function_">unshift</span>(current);
          current = parent.<span class="hljs-title function_">get</span>(current)!;
        }
        cyclePath.<span class="hljs-title function_">unshift</span>(dep);
        <span class="hljs-keyword">return</span> cyclePath.<span class="hljs-title function_">join</span>(<span class="hljs-string">' → '</span>);
      }
    }

    inStack.<span class="hljs-title function_">delete</span>(id);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }

  <span class="hljs-comment">// 检查所有连通分量</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> artifact <span class="hljs-keyword">of</span> artifacts) {
    <span class="hljs-keyword">if</span> (!visited.<span class="hljs-title function_">has</span>(artifact.<span class="hljs-property">id</span>)) {
      <span class="hljs-keyword">const</span> cycle = <span class="hljs-title function_">dfs</span>(artifact.<span class="hljs-property">id</span>);
      <span class="hljs-keyword">if</span> (cycle) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SchemaValidationError</span>(
          <span class="hljs-string">`Cyclic dependency detected: <span class="hljs-subst">${cycle}</span>`</span>
        );
      }
    }
  }
}
</code></pre>
<p><strong>示例：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 错误的 Schema（有环）</span>
<span class="hljs-attr">artifacts:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">a</span>
    <span class="hljs-attr">requires:</span> [<span class="hljs-string">b</span>]
  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">b</span>
    <span class="hljs-attr">requires:</span> [<span class="hljs-string">c</span>]
  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">c</span>
    <span class="hljs-attr">requires:</span> [<span class="hljs-string">a</span>]  <span class="hljs-comment"># 环！</span>

<span class="hljs-comment"># 错误信息：</span>
<span class="hljs-comment"># Cyclic dependency detected: a → b → c → a</span>
</code></pre>
<h3 data-id="heading-16">状态检测</h3>
<h4 data-id="heading-17">基于文件系统的状态</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">detectCompleted</span>(<span class="hljs-params">
  graph: ArtifactGraph,
  changeDir: <span class="hljs-built_in">string</span>
</span>): <span class="hljs-title class_">CompletedSet</span> {
  <span class="hljs-keyword">const</span> completed = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">string</span>&gt;();

  <span class="hljs-comment">// 检查目录是否存在</span>
  <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(changeDir)) {
    <span class="hljs-keyword">return</span> completed;
  }

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> artifact <span class="hljs-keyword">of</span> graph.<span class="hljs-title function_">getAllArtifacts</span>()) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isArtifactComplete</span>(artifact.<span class="hljs-property">generates</span>, changeDir)) {
      completed.<span class="hljs-title function_">add</span>(artifact.<span class="hljs-property">id</span>);
    }
  }

  <span class="hljs-keyword">return</span> completed;
}
</code></pre>
<h4 data-id="heading-18">Glob 模式支持</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">isArtifactComplete</span>(<span class="hljs-params">
  generates: <span class="hljs-built_in">string</span>,
  changeDir: <span class="hljs-built_in">string</span>
</span>): <span class="hljs-built_in">boolean</span> {
  <span class="hljs-keyword">const</span> fullPattern = path.<span class="hljs-title function_">join</span>(changeDir, generates);

  <span class="hljs-comment">// 检查是否是 glob 模式</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isGlobPattern</span>(generates)) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">hasGlobMatches</span>(fullPattern);
  }

  <span class="hljs-comment">// 简单文件路径</span>
  <span class="hljs-keyword">return</span> fs.<span class="hljs-title function_">existsSync</span>(fullPattern);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">isGlobPattern</span>(<span class="hljs-params">pattern: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">boolean</span> {
  <span class="hljs-keyword">return</span> pattern.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'*'</span>) || 
         pattern.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'?'</span>) || 
         pattern.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'['</span>);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">hasGlobMatches</span>(<span class="hljs-params">pattern: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">boolean</span> {
  <span class="hljs-keyword">const</span> normalizedPattern = <span class="hljs-title class_">FileSystemUtils</span>.<span class="hljs-title function_">toPosixPath</span>(pattern);
  <span class="hljs-keyword">const</span> matches = fg.<span class="hljs-title function_">sync</span>(normalizedPattern, { <span class="hljs-attr">onlyFiles</span>: <span class="hljs-literal">true</span> });
  <span class="hljs-keyword">return</span> matches.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>示例：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 简单文件</span>
<span class="hljs-attr">generates</span>: <span class="hljs-string">"proposal.md"</span>
<span class="hljs-comment">// 检查: openspec/changes/add-auth/proposal.md 是否存在</span>

<span class="hljs-comment">// Glob 模式</span>
<span class="hljs-attr">generates</span>: <span class="hljs-string">"specs/**/*.md"</span>
<span class="hljs-comment">// 检查: openspec/changes/add-auth/specs/ 下是否有 .md 文件</span>
</code></pre>
<h3 data-id="heading-19">使用示例</h3>
<h4 data-id="heading-20">创建依赖图</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 从文件加载</span>
<span class="hljs-keyword">const</span> graph = <span class="hljs-title class_">ArtifactGraph</span>.<span class="hljs-title function_">fromYaml</span>(<span class="hljs-string">'schemas/spec-driven/schema.yaml'</span>);

<span class="hljs-comment">// 从内容加载</span>
<span class="hljs-keyword">const</span> yamlContent = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">'schema.yaml'</span>, <span class="hljs-string">'utf-8'</span>);
<span class="hljs-keyword">const</span> graph = <span class="hljs-title class_">ArtifactGraph</span>.<span class="hljs-title function_">fromYamlContent</span>(yamlContent);

<span class="hljs-comment">// 从已解析的 Schema</span>
<span class="hljs-keyword">const</span> schema = <span class="hljs-title function_">parseSchema</span>(yamlContent);
<span class="hljs-keyword">const</span> graph = <span class="hljs-title class_">ArtifactGraph</span>.<span class="hljs-title function_">fromSchema</span>(schema);
</code></pre>
<h4 data-id="heading-21">查询工件信息</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 获取单个工件</span>
<span class="hljs-keyword">const</span> proposal = graph.<span class="hljs-title function_">getArtifact</span>(<span class="hljs-string">'proposal'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(proposal.<span class="hljs-property">description</span>);

<span class="hljs-comment">// 获取所有工件</span>
<span class="hljs-keyword">const</span> allArtifacts = graph.<span class="hljs-title function_">getAllArtifacts</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Total artifacts: <span class="hljs-subst">${allArtifacts.length}</span>`</span>);

<span class="hljs-comment">// 获取构建顺序</span>
<span class="hljs-keyword">const</span> buildOrder = graph.<span class="hljs-title function_">getBuildOrder</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Build order:'</span>, buildOrder);
<span class="hljs-comment">// 输出: ['proposal', 'design', 'specs', 'tasks']</span>
</code></pre>
<h4 data-id="heading-22">工作流控制</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 检测已完成的工件</span>
<span class="hljs-keyword">const</span> completed = <span class="hljs-title function_">detectCompleted</span>(graph, changeDir);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Completed:'</span>, <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(completed));

<span class="hljs-comment">// 查找下一步可执行的工件</span>
<span class="hljs-keyword">const</span> next = graph.<span class="hljs-title function_">getNextArtifacts</span>(completed);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Ready to create:'</span>, next);

<span class="hljs-comment">// 检查是否全部完成</span>
<span class="hljs-keyword">if</span> (graph.<span class="hljs-title function_">isComplete</span>(completed)) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'All artifacts complete!'</span>);
}

<span class="hljs-comment">// 查看阻塞状态</span>
<span class="hljs-keyword">const</span> blocked = graph.<span class="hljs-title function_">getBlocked</span>(completed);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [id, deps] <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(blocked)) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${id}</span> is blocked by: <span class="hljs-subst">${deps.join(<span class="hljs-string">', '</span>)}</span>`</span>);
}
</code></pre>
<h3 data-id="heading-23">设计优势</h3>
<h4 data-id="heading-24">1. 声明式依赖管理</h4>
<p><strong>传统方式（硬编码）：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 硬编码的顺序</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createArtifacts</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">createProposal</span>();
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">createSpecs</span>();
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">createDesign</span>();
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">createTasks</span>();
}
</code></pre>
<p><strong>Artifact Graph 方式：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 声明依赖关系</span>
<span class="hljs-attr">artifacts:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">specs</span>
    <span class="hljs-attr">requires:</span> [<span class="hljs-string">proposal</span>]
  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">design</span>
    <span class="hljs-attr">requires:</span> [<span class="hljs-string">proposal</span>]
  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">tasks</span>
    <span class="hljs-attr">requires:</span> [<span class="hljs-string">specs</span>, <span class="hljs-string">design</span>]
</code></pre>
<p><strong>优势：</strong></p>
<ul>
<li>依赖关系清晰可见</li>
<li>自动计算执行顺序</li>
<li>支持并行执行（specs 和 design）</li>
</ul>
<h4 data-id="heading-25">2. 灵活的工作流</h4>
<p><strong>支持多种工作流模式：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 线性工作流</span>
<span class="hljs-string">proposal</span> <span class="hljs-string">→</span> <span class="hljs-string">specs</span> <span class="hljs-string">→</span> <span class="hljs-string">design</span> <span class="hljs-string">→</span> <span class="hljs-string">tasks</span>

<span class="hljs-comment"># 并行工作流</span>
<span class="hljs-string">proposal</span> <span class="hljs-string">→</span> <span class="hljs-string">(specs</span> <span class="hljs-string">+</span> <span class="hljs-string">design)</span> <span class="hljs-string">→</span> <span class="hljs-string">tasks</span>

<span class="hljs-comment"># 复杂工作流</span>
<span class="hljs-string">proposal</span> <span class="hljs-string">→</span> <span class="hljs-string">specs</span> <span class="hljs-string">→</span> <span class="hljs-string">(design</span> <span class="hljs-string">+</span> <span class="hljs-string">tests)</span> <span class="hljs-string">→</span> <span class="hljs-string">implementation</span> <span class="hljs-string">→</span> <span class="hljs-string">docs</span>
</code></pre>
<h4 data-id="heading-26">3. 可扩展性</h4>
<p><strong>添加新工件无需修改代码：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 添加新的工件类型</span>
<span class="hljs-attr">artifacts:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">security-review</span>
    <span class="hljs-attr">generates:</span> <span class="hljs-string">security-review.md</span>
    <span class="hljs-attr">requires:</span> [<span class="hljs-string">design</span>]
  
  <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">tasks</span>
    <span class="hljs-attr">requires:</span> [<span class="hljs-string">specs</span>, <span class="hljs-string">design</span>, <span class="hljs-string">security-review</span>]  <span class="hljs-comment"># 更新依赖</span>
</code></pre>
<h3 data-id="heading-27">性能考虑</h3>
<h4 data-id="heading-28">时间复杂度</h4>






























<table><thead><tr><th>操作</th><th>复杂度</th><th>说明</th></tr></thead><tbody><tr><td>getBuildOrder</td><td>O(V + E)</td><td>V=工件数, E=依赖边数</td></tr><tr><td>getNextArtifacts</td><td>O(V × D)</td><td>D=平均依赖数</td></tr><tr><td>isComplete</td><td>O(V)</td><td>遍历所有工件</td></tr><tr><td>getBlocked</td><td>O(V × D)</td><td>遍历并检查依赖</td></tr></tbody></table>
<h4 data-id="heading-29">空间复杂度</h4>
<ul>
<li>依赖图存储：O(V + E)</li>
<li>完成状态：O(V)</li>
</ul>
<h4 data-id="heading-30">优化策略</h4>
<ol>
<li><strong>缓存构建顺序</strong> - 构建顺序不变，可以缓存</li>
<li><strong>增量更新</strong> - 只检查状态变化的工件</li>
<li><strong>并行检测</strong> - 文件存在性检查可以并行</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[1秒处理1亿行，这8个Python库彻底让Excel消失]]></title>    <link>https://juejin.cn/post/7600705962248781833</link>    <guid>https://juejin.cn/post/7600705962248781833</guid>    <pubDate>2026-01-30T05:53:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600705962248781833" data-draft-id="7600764857769361458" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="1秒处理1亿行，这8个Python库彻底让Excel消失"/> <meta itemprop="keywords" content="后端,Python"/> <meta itemprop="datePublished" content="2026-01-30T05:53:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="该用户已不存在"/> <meta itemprop="url" content="https://juejin.cn/user/64217584778579"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            1秒处理1亿行，这8个Python库彻底让Excel消失
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/64217584778579/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    该用户已不存在
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T05:53:59.000Z" title="Fri Jan 30 2026 05:53:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>处理数据的时候，我发现 Excel 有时候不好用，不是说它的功能不好用，而是它的隐形转换和不可复现输在起跑线上了。日期格式错乱、大文件卡死、逻辑难以追踪，这些问题在工程化项目中是致命的。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2068b236b3014946bfda1c71a8d862af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770357239&amp;x-signature=kW7UYN855hrntvZiz%2FvsvBhMc1U%3D" alt="" loading="lazy"/></p>
<p>所以，我整理了一套 Python 工具栈。它们不搞花哨的噱头，只解决具体的问题。</p>
<h3 data-id="heading-0">DuckDB：轻松搞定亿级数据</h3>
<p>如果在单机上处理几百兆到几 GB 的数据，Pandas 的内存占用简直让我抓狂。DuckDB 的出现填补了 SQLite 和分布式数据库之间的空白。它是一个进程内的 OLAP 数据库，最大的特点是零配置和向量化计算。</p>
<p>DuckDB 可以直接对 CSV、Parquet 或 JSON 文件执行 SQL 查询，无需将数据全部加载到内存。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> duckdb

<span class="hljs-comment"># 直接对 Parquet 文件执行 SQL，无需建库建表</span>
<span class="hljs-comment"># 这里的 query 类似于 Pandas 的 dataframe，但计算是在 DuckDB 引擎中完成的</span>
result = duckdb.sql(<span class="hljs-string">"""
    SELECT 
        department, 
        AVG(salary) as avg_salary 
    FROM 'employees.parquet' 
    WHERE join_date &gt; '2022-01-01'
    GROUP BY department
    ORDER BY avg_salary DESC
"""</span>).df()

<span class="hljs-built_in">print</span>(result)
</code></pre>
<h3 data-id="heading-1">Ibis：写一次代码，到处运行</h3>
<p>Ibis 和 DuckDB 是目前数据工程领域的黄金搭档。</p>
<p>Ibis 将业务逻辑与执行引擎分离，这也是它的核心。可以使用类似 Pandas 的 Python API 来编写查询逻辑，后端可以无缝切换为 DuckDB、ClickHouse、BigQuery 甚至是 PySpark。</p>
<p>使用 Ibis 驱动 DuckDB 时，既享受了 Python 代码的优雅和类型检查，又利用了 DuckDB 极速的执行引擎。一举两得，棒棒哒。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> ibis

<span class="hljs-comment"># 连接到 DuckDB 后端（也可以是 SQLite, Postgres 等）</span>
con = ibis.duckdb.connect()

<span class="hljs-comment"># 惰性读取数据，此时并未真正加载</span>
table = con.read_csv(<span class="hljs-string">"sales_data.csv"</span>)

<span class="hljs-comment"># 构建查询表达式</span>
expr = (
    table.<span class="hljs-built_in">filter</span>(table[<span class="hljs-string">"status"</span>] == <span class="hljs-string">"completed"</span>)
         .group_by(<span class="hljs-string">"region"</span>)
         .aggregate(total_revenue=table[<span class="hljs-string">"amount"</span>].<span class="hljs-built_in">sum</span>())
         .order_by(ibis.desc(<span class="hljs-string">"total_revenue"</span>))
)

<span class="hljs-comment"># 只有调用 execute() 时才会生成 SQL 并执行</span>
<span class="hljs-built_in">print</span>(expr.execute())
</code></pre>
<h3 data-id="heading-2">Polars：多线程时代的 DataFrame</h3>
<p>Pandas 是单线程的，而 Polars 是用 Rust 编写的，天生支持并行计算。在处理大规模数据集时，Polars 的速度通常比 Pandas 快数倍。</p>
<p>它的设计理念采用了“惰性求值”（Lazy Evaluation），先构建查询计划，经优化器优化后再执行，这能极大减少内存开销。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> polars <span class="hljs-keyword">as</span> pl

<span class="hljs-comment"># 扫描文件而非读取，启用 Lazy 模式</span>
q = (
    pl.scan_csv(<span class="hljs-string">"large_dataset.csv"</span>)
    .<span class="hljs-built_in">filter</span>(pl.col(<span class="hljs-string">"age"</span>) &gt; <span class="hljs-number">30</span>)
    .select([<span class="hljs-string">"name"</span>, <span class="hljs-string">"salary"</span>, <span class="hljs-string">"department"</span>])
    .group_by(<span class="hljs-string">"department"</span>)
    .agg(pl.col(<span class="hljs-string">"salary"</span>).mean().alias(<span class="hljs-string">"avg_salary"</span>))
)

<span class="hljs-comment"># collect() 触发实际计算</span>
df = q.collect()
<span class="hljs-built_in">print</span>(df)
</code></pre>
<h3 data-id="heading-3">PyArrow Compute：底层的计算基石</h3>
<p>PyArrow 不仅仅是数据格式标准，其 compute 模块提供了一套高性能的向量化计算函数。很多现代数据工具（包括 Pandas 2.0+）底层都在使用它。</p>
<p>如果需要对数组进行极速的数学运算或字符串处理，且不想引入 DataFrame 的额外开销，可以考虑一下 PyArrow Compute。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pyarrow <span class="hljs-keyword">as</span> pa
<span class="hljs-keyword">import</span> pyarrow.compute <span class="hljs-keyword">as</span> pc

<span class="hljs-comment"># 创建 Arrow 数组</span>
arr_a = pa.array([<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>, <span class="hljs-literal">None</span>])
arr_b = pa.array([<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">8</span>, <span class="hljs-number">1</span>])

<span class="hljs-comment"># 使用计算内核进行向量化乘法，自动处理 None 值</span>
result = pc.multiply(arr_a, arr_b)

<span class="hljs-comment"># 过滤数据</span>
mask = pc.greater(result, <span class="hljs-number">50</span>)
filtered = pc.<span class="hljs-built_in">filter</span>(result, mask)

<span class="hljs-built_in">print</span>(filtered)
</code></pre>
<h3 data-id="heading-4">TinyDB：面向文档的轻量级存储</h3>
<p>并非所有项目都需要 PostgreSQL。对于配置文件管理、小型爬虫数据存储或单机小工具，TinyDB 非常合适。它是一个纯 Python 编写的文档型数据库，数据存储在 JSON 文件中，API 像操作 Python 列表一样自然。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> tinydb <span class="hljs-keyword">import</span> TinyDB, Query

db = TinyDB(<span class="hljs-string">'local_storage.json'</span>)
User = Query()

<span class="hljs-comment"># 插入数据</span>
db.insert({<span class="hljs-string">'name'</span>: <span class="hljs-string">'Alice'</span>, <span class="hljs-string">'role'</span>: <span class="hljs-string">'admin'</span>, <span class="hljs-string">'points'</span>: <span class="hljs-number">85</span>})
db.insert({<span class="hljs-string">'name'</span>: <span class="hljs-string">'Bob'</span>, <span class="hljs-string">'role'</span>: <span class="hljs-string">'user'</span>, <span class="hljs-string">'points'</span>: <span class="hljs-number">60</span>})

<span class="hljs-comment"># 查询数据</span>
results = db.search(User.role == <span class="hljs-string">'admin'</span>)
<span class="hljs-built_in">print</span>(results)
</code></pre>
<h3 data-id="heading-5">Rill：开发者的 BI 工具</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/24de2b175bf6402b941ff383962e9a57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770357239&amp;x-signature=MG6qZx6RBX8ZEu5abEpIzk2CaLo%3D" alt="" loading="lazy"/></p>
<p>虽然 Rill 更像是一个工具而非传统的 Python 库，但它在现代 Python 数据栈中地位独特。Rill 基于 DuckDB，能够快速读取本地数据（CSV, Parquet），并瞬间生成交互式的 BI 仪表盘。它解决了“为了看个图表还要搭一套 Superset”的痛点，非常适合快速探索数据分布。</p>
<h3 data-id="heading-6">Numba：让 Python 跑出 C 的速度</h3>
<p>当代码中包含大量原生 <code>for</code> 循环（如科学计算、复杂算法）时，Python 的解释器性能往往成为瓶颈。Numba 是一个 JIT（即时）编译器，通过加一行装饰器，就能将 Python 函数编译成机器码运行。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> numba <span class="hljs-keyword">import</span> jit
<span class="hljs-keyword">import</span> time

<span class="hljs-comment"># 不使用 @jit 时，Python 循环较慢</span>
<span class="hljs-comment"># 使用 nopython=True 强制生成机器码</span>
<span class="hljs-meta">@jit(<span class="hljs-params">nopython=<span class="hljs-literal">True</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">heavy_computation</span>(<span class="hljs-params">n</span>):
    total = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):
        total += i * <span class="hljs-number">2</span>
    <span class="hljs-keyword">return</span> total

start = time.time()
<span class="hljs-built_in">print</span>(heavy_computation(<span class="hljs-number">100_000_000</span>))
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"耗时: <span class="hljs-subst">{time.time() - start:<span class="hljs-number">.4</span>f}</span> 秒"</span>)
</code></pre>
<h3 data-id="heading-7">Bonobo：轻量级 ETL 框架</h3>
<p>对于不需要 Airflow 这种重型调度系统的数据迁移任务，Bonobo 提供了一种基于图（Graph）的轻量级 ETL 方案。它使用纯 Python 代码定义数据流向，逻辑清晰，非常适合处理中小规模的数据清洗和转换任务。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> bonobo

<span class="hljs-keyword">def</span> <span class="hljs-title function_">extract</span>():
    <span class="hljs-keyword">yield</span> {<span class="hljs-string">'id'</span>: <span class="hljs-number">1</span>, <span class="hljs-string">'name'</span>: <span class="hljs-string">' Item A '</span>}
    <span class="hljs-keyword">yield</span> {<span class="hljs-string">'id'</span>: <span class="hljs-number">2</span>, <span class="hljs-string">'name'</span>: <span class="hljs-string">' Item B '</span>}

<span class="hljs-keyword">def</span> <span class="hljs-title function_">transform</span>(<span class="hljs-params">row</span>):
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">'id'</span>: row[<span class="hljs-string">'id'</span>], 
        <span class="hljs-string">'name_clean'</span>: row[<span class="hljs-string">'name'</span>].strip().upper()
    }

<span class="hljs-keyword">def</span> <span class="hljs-title function_">load</span>(<span class="hljs-params">row</span>):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Loading: <span class="hljs-subst">{row}</span>"</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_graph</span>(<span class="hljs-params">**options</span>):
    graph = bonobo.Graph()
    graph.add_chain(extract, transform, load)
    <span class="hljs-keyword">return</span> graph

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    <span class="hljs-comment"># 实际运行时使用 bonobo run</span>
    parser = bonobo.get_argument_parser()
    <span class="hljs-keyword">with</span> bonobo.parse_args(parser) <span class="hljs-keyword">as</span> options:
        bonobo.run(get_graph(**options))
</code></pre>
<hr/>
<p>上述库涵盖了从数据存储、计算引擎到 ETL 流程的各个环节，Python的库，需要的肯定是 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.servbay.com%2Ffeatures%2Fpython" target="_blank" title="https://www.servbay.com/features/python" ref="nofollow noopener noreferrer">Python 环境</a>。</p>
<p>而且码农怎么可能只有一个项目需要维护呢？肯定是有的依赖最新的 Python 3.14，有的则必须跑在 Python 3.8 甚至古老的 Python 2.7 上维护遗留系统。系统自带的 Python 环境一旦弄乱，修复起来就头大了。</p>
<p>那这时候我们就要请上 ServBay 了。</p>
<p>ServBay 为开发者提供了一个隔离且纯净的开发环境。它最大的优势是<strong>一键部署</strong>和<strong>多版本共存</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c01ee8593e424667bc1932f56e3aaaba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770357239&amp;x-signature=efBZ8RjRAzIJnExsnB%2BtcDG9IK8%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>极速安装</strong>：还在用命令行就out了。ServBay 点击即可安装好包含常用组件的开发环境。</li>
<li><strong>全版本支持</strong>：它支持从最新的 Python 3.x 到早期的 Python 2.x 版本。</li>
<li><strong>环境隔离</strong>：ServBay 的环境独立于系统，不会污染系统自带的 Python，保证了系统的稳定性。</li>
</ul>
<p>对于追求效率的开发者而言，将环境管理交给 ServBay，把精力集中在代码和数据逻辑上，才是更明智的选择。</p>
<p>数据处理的边界正在被这些新兴的工具不断拓展。对于开发者而言，保持对新技术的敏感度，同时拥有一个随时能推倒重来且互不干扰的好工具，也是提高效率的关键。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端开发环境搭建全教程｜Node.js+npm+Vite（一步到位，附报错解决）]]></title>    <link>https://juejin.cn/post/7600791597169819691</link>    <guid>https://juejin.cn/post/7600791597169819691</guid>    <pubDate>2026-01-30T06:01:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600791597169819691" data-draft-id="7600710943250939946" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端开发环境搭建全教程｜Node.js+npm+Vite（一步到位，附报错解决）"/> <meta itemprop="keywords" content="Node.js,Vue.js"/> <meta itemprop="datePublished" content="2026-01-30T06:01:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="代码煮茶"/> <meta itemprop="url" content="https://juejin.cn/user/4197279069639178"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端开发环境搭建全教程｜Node.js+npm+Vite（一步到位，附报错解决）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4197279069639178/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    代码煮茶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T06:01:16.000Z" title="Fri Jan 30 2026 06:01:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    23
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>对于前端初学者而言，第一步往往不是学习 HTML/CSS 语法，而是搭建一个稳定、可用的前端开发环境 —— 一个配置完善的环境能避免后续开发中出现各种 “莫名其妙” 的问题，大幅提升开发效率。本文将以<strong>Node.js+npm+Vite</strong>为核心，从搭建目的到具体步骤，再到常见报错解决，手把手带大家完成前端开发环境的一站式搭建，全程干货无冗余，新手也能轻松上手。</p>
<h2 data-id="heading-0">一、搭建目的：为什么需要这些工具？</h2>
<p>在开始搭建之前，我们先搞懂 “为什么要装这些东西”，避免盲目操作。</p>
<ol>
<li><strong>Node.js</strong>：前端开发的 “基础设施”简单来说，Node.js 是一个让 JavaScript 能够运行在<strong>服务器端 / 本地电脑</strong>（而非仅在浏览器中）的运行环境。它提供了大量内置模块和生态工具，是后续 npm、Vite 等工具运行的基础 —— 没有 Node.js，后面的工具都无法启动。</li>
<li><strong>npm</strong>：前端包管理工具（随 Node.js 自带）npm（Node Package Manager）是 Node.js 自带的包管理工具，相当于前端的 “应用商店”。我们在开发中需要用到的 Vue、React、Element UI 等第三方框架 / 插件，都可以通过 npm 一键安装、管理版本、卸载，无需手动下载文件包，极大简化了依赖管理流程。</li>
<li><strong>Vite</strong>：新一代前端构建工具传统前端开发中常用 Webpack，而 Vite 是近年来大火的新一代构建工具，主打 “快”—— 启动速度、热更新速度远超 Webpack，尤其在大型项目中优势明显。它支持 Vue、React、Vanilla JS 等多种项目模板，能快速初始化项目结构，还内置了开发服务器、打包构建等功能，是目前前端开发的首选构建工具。</li>
</ol>
<p>总结：<strong>Node.js（运行环境）→ npm（包管理）→ Vite（项目构建 / 开发）</strong> ，三者形成前端开发的基础链路，缺一不可。</p>
<h2 data-id="heading-1">二、各工具安装步骤（Windows/macOS 通用）</h2>
<h3 data-id="heading-2">第一步：安装 Node.js（附带 npm）</h3>
<p>Node.js 的安装包已经内置了 npm，安装 Node.js 后会自动获得 npm，无需单独安装。</p>
<h4 data-id="heading-3">1. 下载安装包</h4>
<p>访问 Node.js 官方下载地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fzh-cn%2F" target="_blank" title="https://nodejs.org/zh-cn/" ref="nofollow noopener noreferrer">nodejs.org/zh-cn/</a>官网提供两个版本：</p>
<ul>
<li><strong>LTS 版本</strong>（长期支持版）：标注 “推荐用于大多数用户”，版本号通常为偶数（如 20.x、18.x），稳定性高，<strong>优先选择此版本</strong>（本文以 v20.x LTS 为例）。</li>
<li>Current 版本（最新版）：包含最新功能，但可能存在兼容性问题，适合开发者测试新特性，不推荐新手使用。</li>
</ul>
<p>根据你的操作系统（Windows/macOS）选择对应的安装包：</p>
<ul>
<li>Windows：选择 “Windows 安装程序 (.msi)”（64 位，目前主流电脑均为 64 位）。</li>
<li>macOS：选择 “macOS 安装程序 (.pkg)”。</li>
</ul>
<h4 data-id="heading-4">2. 执行安装（分步图解，以 Windows 为例）</h4>
<ol>
<li>双击下载完成的.msi 文件，弹出安装向导，点击 “Next”。</li>
<li>勾选 “我接受许可协议中的条款”，点击 “Next”。</li>
<li>选择安装路径（默认路径即可，无需修改；若要修改，建议放在非 C 盘根目录，如<code>D:\Program Files\nodejs</code>），点击 “Next”。</li>
<li>保持默认安装组件（无需勾选额外选项，npm 已包含在内），点击 “Next”。</li>
<li>无需勾选 “Tools for Native Modules”（新手用不到），直接点击 “Next”。</li>
<li>点击 “Install” 开始安装，等待进度条完成（约 1-2 分钟）。</li>
<li>安装完成后，点击 “Finish” 关闭向导。</li>
</ol>
<h4 data-id="heading-5">3. macOS 额外说明</h4>
<ol>
<li>
<p>双击下载的.pkg 文件，跟随安装向导一步步操作，默认选项即可。</p>
</li>
<li>
<p>若安装过程中提示 “无法验证开发者”，可右键安装包→“打开”，或在 “系统设置→隐私与安全性” 中允许此安装包运行。</p>
</li>
<li>
<p>也可通过 Homebrew 安装（适合有一定终端基础的用户）：</p>
<pre><code class="hljs language-less" lang="less"># 先安装<span class="hljs-selector-tag">Homebrew</span>（若未安装）
/<span class="hljs-selector-tag">bin</span>/<span class="hljs-selector-tag">bash</span> <span class="hljs-selector-tag">-c</span> "$(curl -fsSL <span class="hljs-attribute">https</span>:<span class="hljs-comment">//raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"</span>
# 安装Node.js LTS版本
brew install node<span class="hljs-variable">@20</span>
</code></pre>
</li>
</ol>
<h3 data-id="heading-6">第二步：安装 Vite（全局安装，推荐）</h3>
<p>Vite 支持两种安装方式：全局安装（可在任意目录创建项目）、局部安装（仅在当前项目可用），新手推荐<strong>全局安装</strong>，操作更便捷。</p>
<ol>
<li>
<p>打开终端 / 命令提示符：</p>
<ul>
<li>Windows：按下<code>Win+R</code>，输入<code>cmd</code>回车，打开命令提示符（CMD）；或输入<code>powershell</code>回车，打开 PowerShell。</li>
<li>macOS：打开 “启动台→其他→终端”。</li>
</ul>
</li>
<li>
<p>输入以下命令全局安装 Vite：</p>
<pre><code class="hljs">npm install -g vite
</code></pre>
<p>解释：</p>
<ul>
<li><code>npm install</code>：npm 的安装命令，简写为<code>npm i</code>。</li>
<li><code>-g</code>：全局安装标识（global），表示将 Vite 安装到系统全局，后续在任意目录下都能使用<code>vite</code>命令。</li>
<li><code>vite</code>：要安装的包名。</li>
</ul>
</li>
<li>
<p>等待安装完成：终端会显示安装进度和依赖信息，最后出现 “added xxx packages in xxxs” 即表示安装成功（无需关注警告信息，只要没有红色报错即可）。</p>
</li>
</ol>
<h2 data-id="heading-7">三、版本验证：确认所有工具安装成功</h2>
<p>安装完成后，务必验证各工具的版本，确保环境搭建成功，避免后续开发出现问题。</p>
<h3 data-id="heading-8">1. 验证 Node.js 版本</h3>
<p>在终端 / CMD 中输入以下命令，回车执行：</p>
<pre><code class="hljs">node -v
</code></pre>
<p>若输出类似<code>v20.10.0</code>（版本号与你安装的 LTS 版本一致），说明 Node.js 安装成功。</p>
<h3 data-id="heading-9">2. 验证 npm 版本</h3>
<p>同样在终端 / CMD 中输入以下命令：</p>
<pre><code class="hljs">npm -v
</code></pre>
<p>若输出类似<code>10.2.3</code>（npm 版本与 Node.js 配套，无需刻意追求最新），说明 npm 安装成功。</p>
<h3 data-id="heading-10">3. 验证 Vite 版本</h3>
<p>在终端 / CMD 中输入以下命令：</p>
<pre><code class="hljs">vite -v
</code></pre>
<p>若输出类似<code>v5.0.10</code>（Vite 版本会持续更新，只要能输出版本号即表示安装成功），说明 Vite 全局安装成功。</p>
<blockquote>
<p>注意：若输入命令后提示 “不是内部或外部命令，也不是可运行的程序或批处理文件”（Windows）或 “command not found”（macOS），说明环境变量未配置成功，可参考本文 “四、常见报错及解决” 中的对应方案。</p>
</blockquote>
<h2 data-id="heading-11">四、全局配置：更换 npm 镜像源（解决下载缓慢问题）</h2>
<p>npm 的默认镜像源位于国外服务器（<a href="https://link.juejin.cn?target=https%3A%2F%2Fregistry.npmjs.org%2F" target="_blank" title="https://registry.npmjs.org/" ref="nofollow noopener noreferrer">registry.npmjs.org/</a>），国内用户直接使用会出现<strong>下载速度慢、安装超时</strong>等问题，因此需要将镜像源更换为国内镜像（如淘宝镜像）。</p>
<h3 data-id="heading-12">1. 临时更换（仅当前终端有效）</h3>
<p>在安装包时，通过<code>--registry</code>参数指定镜像源，仅对当前命令有效：</p>
<pre><code class="hljs language-ini" lang="ini">npm install -g vite <span class="hljs-attr">--registry</span>=https://registry.npmmirror.com/
</code></pre>
<h3 data-id="heading-13">2. 永久更换（推荐，一劳永逸）</h3>
<h4 data-id="heading-14">方法 1：使用 npm 命令配置</h4>
<p>在终端 / CMD 中输入以下命令，将默认镜像源设置为淘宝镜像（目前淘宝镜像已升级为 npmmirror）：</p>
<pre><code class="hljs language-arduino" lang="arduino"># 配置淘宝镜像源（永久生效）
npm config set registry https:<span class="hljs-comment">//registry.npmmirror.com/</span>
</code></pre>
<h4 data-id="heading-15">方法 2：验证镜像源是否配置成功</h4>
<p>输入以下命令，查看当前 npm 的镜像源配置：</p>
<pre><code class="hljs language-arduino" lang="arduino">npm config get registry
</code></pre>
<p>若输出<code>https://registry.npmmirror.com/</code>，说明配置成功。</p>
<h4 data-id="heading-16">方法 3：恢复默认镜像源</h4>
<p>若后续需要切换回 npm 官方镜像源，输入以下命令即可：</p>
<pre><code class="hljs language-arduino" lang="arduino">npm config set registry https:<span class="hljs-comment">//registry.npmjs.org/</span>
</code></pre>
<h3 data-id="heading-17">3. 额外推荐：使用 nrm 管理镜像源（可选）</h3>
<p>nrm 是一个 npm 镜像源管理工具，可快速切换多个镜像源，适合需要频繁切换镜像的用户。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 全局安装nrm</span>
npm install -g nrm

<span class="hljs-comment"># 查看所有可用镜像源</span>
nrm <span class="hljs-built_in">ls</span>

<span class="hljs-comment"># 切换到淘宝镜像源</span>
nrm use taobao

<span class="hljs-comment"># 验证当前镜像源</span>
nrm current
</code></pre>
<h2 data-id="heading-18">五、常见报错及解决（新手必看，避坑指南）</h2>
<p>搭建环境或后续使用过程中，难免会遇到各种报错，以下整理了最常见的几种报错及对应的解决方案，一步到位解决问题。</p>
<h3 data-id="heading-19">报错 1：命令未找到（node/npm/vite: command not found / 不是内部或外部命令）</h3>
<h4 data-id="heading-20">现象</h4>
<p>输入<code>node -v</code>、<code>npm -v</code>或<code>vite -v</code>时，终端提示命令不存在，无法识别工具。</p>
<h4 data-id="heading-21">原因</h4>
<p>Node.js 安装后，<strong>环境变量未自动配置成功</strong>，系统无法找到对应的可执行文件路径。</p>
<h4 data-id="heading-22">解决方案（Windows 为例）</h4>
<ol>
<li>找到你的 Node.js 安装路径（如<code>D:\Program Files\nodejs</code>），复制该路径。</li>
<li>右键 “此电脑”→“属性”→“高级系统设置”→“环境变量”。</li>
<li>在 “系统变量” 中，找到名为<code>Path</code>的变量，双击打开。</li>
<li>点击 “新建”，粘贴刚才复制的 Node.js 安装路径，点击 “上移” 将其移到顶部。</li>
<li>再点击 “新建”，粘贴<code>%USERPROFILE%\AppData\Roaming\npm</code>（npm 全局包的安装路径），点击 “确定” 保存所有配置。</li>
<li><strong>关键步骤</strong>：关闭当前所有终端 / CMD，重新打开一个新的终端，再次输入版本验证命令，即可正常识别。</li>
</ol>
<h4 data-id="heading-23">解决方案（macOS 为例）</h4>
<ol>
<li>
<p>打开终端，输入以下命令，编辑环境变量配置文件（以 zsh 为例，macOS 默认终端为 zsh）：</p>
<pre><code class="hljs language-arduino" lang="arduino">open ~/.zshrc
</code></pre>
<p>若使用 bash 终端，输入：<code>open ~/.bash_profile</code>。</p>
</li>
<li>
<p>在配置文件末尾，添加一行代码（替换为你的 Node.js 安装路径，默认路径为<code>/usr/local/bin/node</code>）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> PATH=<span class="hljs-string">"/usr/local/bin:<span class="hljs-variable">$PATH</span>"</span>
</code></pre>
</li>
<li>
<p>保存文件并关闭，回到终端，输入以下命令使配置生效：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">source</span> ~/.zshrc
</code></pre>
</li>
<li>
<p>重新输入版本验证命令，即可正常识别。</p>
</li>
</ol>
<h3 data-id="heading-24">报错 2：npm 安装失败（超时、报错 code ECONNRESET / ETIMEDOUT）</h3>
<h4 data-id="heading-25">现象</h4>
<p>执行<code>npm install -g vite</code>时，终端出现红色报错，提示 “timeout”、“ECONNRESET”，安装进度卡住或中断。</p>
<h4 data-id="heading-26">原因</h4>
<ol>
<li>默认镜像源在国外，网络连接不稳定或速度过慢。</li>
<li>本地网络防火墙、代理软件拦截了 npm 的下载请求。</li>
</ol>
<h4 data-id="heading-27">解决方案</h4>
<ol>
<li>
<p><strong>优先更换国内镜像源</strong>：按照本文 “四、全局配置” 中的方法，永久更换为淘宝镜像源，重新执行安装命令。</p>
</li>
<li>
<p><strong>关闭代理 / 防火墙</strong>：若开启了 VPN、梯子、电脑防火墙，暂时关闭后再尝试安装。</p>
</li>
<li>
<p><strong>清理 npm 缓存</strong>：缓存损坏也可能导致安装失败，输入以下命令清理缓存后重新安装：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 清理npm缓存</span>
npm cache clean --force
<span class="hljs-comment"># 重新全局安装Vite</span>
npm install -g vite
</code></pre>
</li>
</ol>
<h3 data-id="heading-28">报错 3：Vite 启动项目提示 “端口占用”（Port xxx is already in use）</h3>
<h4 data-id="heading-29">现象</h4>
<p>使用<code>vite</code>启动项目时，终端报错 “Port 5173 is already in use”（Vite 默认端口为 5173），无法启动开发服务器。</p>
<h4 data-id="heading-30">原因</h4>
<p>5173 端口已被其他程序（如另一一个 Vite 项目、其他开发工具、杀毒软件等）占用。</p>
<h4 data-id="heading-31">解决方案</h4>
<h4 data-id="heading-32">方法 1：让 Vite 自动切换端口</h4>
<p>在启动项目时，添加<code>--port</code>参数的同时，使用<code>--open</code>，或直接输入以下命令，Vite 会自动寻找可用端口并启动：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启动项目，自动切换未被占用的端口</span>
vite --port 0
</code></pre>
<h4 data-id="heading-33">方法 2：手动指定其他端口</h4>
<p>选择一个未被占用的端口（如 5174、3000 等），启动项目时手动指定：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 手动指定端口5174启动项目</span>
<span class="hljs-string">vite</span> <span class="hljs-string">--port</span> <span class="hljs-number">5174</span>
</code></pre>
<h4 data-id="heading-34">方法 3：查找并关闭占用端口的程序（Windows）</h4>
<ol>
<li>
<p>打开 CMD，输入以下命令，查找占用 5173 端口的进程 PID：</p>
<pre><code class="hljs language-arduino" lang="arduino">netstat -ano | findstr <span class="hljs-string">"5173"</span>
</code></pre>
</li>
<li>
<p>终端会输出类似<code>TCP 0.0.0.0:5173 0.0.0.0:0 LISTENING 12345</code>的信息，其中<code>12345</code>即为进程 PID。</p>
</li>
<li>
<p>输入以下命令，结束该进程（替换为实际查到的 PID）：</p>
<pre><code class="hljs language-r" lang="r">taskkill <span class="hljs-operator">/</span><span class="hljs-built_in">F</span> <span class="hljs-operator">/</span>PID <span class="hljs-number">12345</span>
</code></pre>
</li>
<li>
<p>重新启动 Vite 项目，即可正常使用 5173 端口。</p>
</li>
</ol>
<h4 data-id="heading-35">方法 3：查找并关闭占用端口的程序（macOS）</h4>
<ol>
<li>
<p>打开终端，输入以下命令，查找占用 5173 端口的进程 PID：</p>
<pre><code class="hljs language-css" lang="css">lsof -<span class="hljs-selector-tag">i</span>:<span class="hljs-number">5173</span>
</code></pre>
</li>
<li>
<p>终端会输出进程信息，其中<code>PID</code>列即为进程 PID。</p>
</li>
<li>
<p>输入以下命令，结束该进程（替换为实际查到的 PID）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">kill</span> -9 12345
</code></pre>
</li>
<li>
<p>重新启动 Vite 项目，即可正常使用 5173 端口。</p>
</li>
</ol>
<h3 data-id="heading-36">报错 4：Vite 创建项目时，模板选择后提示 “npm install failed”</h3>
<h4 data-id="heading-37">现象</h4>
<p>执行<code>npm create vite@latest</code>创建项目，选择框架（如 Vue）和语言（如 JavaScript）后，终端提示 “npm install failed”，项目创建不完整。</p>
<h4 data-id="heading-38">原因</h4>
<ol>
<li>项目目录中包含中文、空格或特殊字符（如<code>我的项目</code>、<code>project name</code>），npm 不支持此类目录名。</li>
<li>本地 npm 版本过低，与 Vite 不兼容。</li>
</ol>
<h4 data-id="heading-39">解决方案</h4>
<ol>
<li>
<p><strong>创建无特殊字符的项目目录</strong>：项目路径和项目名仅使用英文、数字、下划线（如<code>vite-vue-demo</code>），避免中文和空格。</p>
</li>
<li>
<p><strong>升级 npm 版本</strong>：输入以下命令，将 npm 升级到最新版本，重新创建项目：</p>
<pre><code class="hljs">npm install -g npm
</code></pre>
</li>
<li>
<p><strong>手动安装项目依赖</strong>：若项目已创建，仅依赖安装失败，进入项目目录后手动执行安装命令：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 进入项目目录（替换为你的项目名）</span>
<span class="hljs-built_in">cd</span> vite-vue-demo
<span class="hljs-comment"># 手动安装依赖</span>
npm install
</code></pre>
</li>
</ol>
<h2 data-id="heading-40">六、收尾：快速创建第一个 Vite 项目（验证环境可用性）</h2>
<p>所有配置完成后，我们来创建一个简单的 Vite 项目，验证整个环境是否可用。</p>
<ol>
<li>
<p>打开终端 / CMD，输入以下命令，创建 Vite 项目：</p>
<pre><code class="hljs language-sql" lang="sql">npm <span class="hljs-keyword">create</span> vite<span class="hljs-variable">@latest</span>
</code></pre>
</li>
<li>
<p>按照终端提示操作：</p>
<ul>
<li>输入项目名（如<code>vite-first-demo</code>，无特殊字符），回车。</li>
<li>选择项目框架（如<code>Vue</code>，用上下箭头切换，回车确认）。</li>
<li>选择语言（如<code>JavaScript</code>，回车确认）。</li>
</ul>
</li>
<li>
<p>项目创建完成后，按照终端提示，执行以下命令进入项目并安装依赖：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 进入项目目录</span>
<span class="hljs-built_in">cd</span> vite-first-demo
<span class="hljs-comment"># 安装项目依赖</span>
npm install
</code></pre>
</li>
<li>
<p>启动开发服务器：</p>
<pre><code class="hljs language-arduino" lang="arduino">npm run dev
</code></pre>
</li>
<li>
<p>启动成功后，终端会显示项目访问地址（如<code>http://localhost:5173/</code>），复制该地址在浏览器中打开，若能看到 Vite+Vue 的默认页面，说明整个前端开发环境搭建成功！</p>
</li>
</ol>
<h3 data-id="heading-41">总结</h3>
<ol>
<li>前端开发基础环境的核心是<strong>Node.js（运行环境）+ npm（包管理）+ Vite（项目构建）</strong> ，其中 npm 随 Node.js 自带，无需单独安装。</li>
<li>安装时优先选择 Node.js 的 LTS 版本，Vite 推荐全局安装，npm 镜像源建议更换为国内淘宝镜像以提升下载速度。</li>
<li>常见问题集中在<strong>环境变量未配置、端口占用、镜像源下载超时</strong>，按照文中对应方案可快速解决，搭建完成后可通过创建测试项目验证环境可用性。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[记录qiankun的demo]]></title>    <link>https://juejin.cn/post/7600706866785878059</link>    <guid>https://juejin.cn/post/7600706866785878059</guid>    <pubDate>2026-01-30T06:08:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600706866785878059" data-draft-id="7600674821308104740" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="记录qiankun的demo"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-30T06:08:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="MQliferecord"/> <meta itemprop="url" content="https://juejin.cn/user/1139543665814600"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            记录qiankun的demo
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1139543665814600/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    MQliferecord
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T06:08:57.000Z" title="Fri Jan 30 2026 06:08:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">主应用</h3>
<ul>
<li>修改主应用路由</li>
</ul>
<p>主应用使用 <code>history</code> 路由（微应用推荐），添加子应用容器页面：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { createRouter, createWebHistory, <span class="hljs-title class_">RouteRecordRaw</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>; 
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Home</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../views/Home.vue'</span>; 

<span class="hljs-keyword">const</span> <span class="hljs-attr">routes</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">RouteRecordRaw</span>&gt; = [ 
    { 
        <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>, 
        <span class="hljs-attr">name</span>: <span class="hljs-string">'Home'</span>, 
        <span class="hljs-attr">component</span>: <span class="hljs-title class_">Home</span> 
    }, <span class="hljs-comment">// 子应用挂载的路由（激活规则） </span>
    { 
        <span class="hljs-attr">path</span>: <span class="hljs-string">'/sub-app'</span>, 
        <span class="hljs-attr">name</span>: <span class="hljs-string">'SubApp'</span>, <span class="hljs-comment">// 空组件，仅作为子应用的挂载容器 </span>
        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../views/SubAppContainer.vue'</span>) 
    } 
]; 
<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>({ 
    <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHistory</span>(), <span class="hljs-comment">// 注意：用 history 路由 </span>
    routes 
}); 

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router;
</code></pre>
<ul>
<li>创建子应用容器组件（src/views/SubAppContainer.vue）</li>
</ul>
<pre><code class="hljs language-js" lang="js">&lt;template&gt; 
    &lt;!-- 子应用挂载的 <span class="hljs-variable constant_">DOM</span> 容器 --&gt; 
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"sub-app-container"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span> 
&lt;/template&gt; 
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript"> 
<span class="hljs-comment">// 空组件，仅提供挂载容器 </span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span> 
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css"> 
<span class="hljs-selector-id">#sub-app-container</span> { <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>; <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>; } 
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<ul>
<li>修改主应用入口（src/main.ts）</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>; 
<span class="hljs-keyword">import</span> { registerMicroApps, start } <span class="hljs-keyword">from</span> <span class="hljs-string">'qiankun'</span>; 
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>; 
<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'./router'</span>; 
<span class="hljs-keyword">import</span> eventBus <span class="hljs-keyword">from</span> <span class="hljs-string">'./bus'</span>; <span class="hljs-comment">// 新增</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'./style.css'</span>; 

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>); 
app.<span class="hljs-title function_">use</span>(router); 
app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>); <span class="hljs-comment">// 1. 注册子应用</span>

<span class="hljs-comment">// 通信方法1：props注入相关信息 </span>
<span class="hljs-keyword">const</span> globalData = { 
    <span class="hljs-attr">userInfo</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> }, 
    <span class="hljs-comment">// 新增：传递回调函数（实现子→主通信） </span>
    <span class="hljs-attr">onSubAppMsg</span>: <span class="hljs-function">(<span class="hljs-params">msg: string</span>) =&gt;</span> { 
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'主应用收到子应用消息：'</span>, msg); 
        <span class="hljs-title function_">alert</span>(<span class="hljs-string">`主应用收到：<span class="hljs-subst">${msg}</span>`</span>); 
    } 
};

<span class="hljs-comment">// 通信方法2：主应用仓库挂载在全局window上</span>
<span class="hljs-keyword">const</span> globalStore = <span class="hljs-title function_">useGlobalStore</span>();
<span class="hljs-variable language_">window</span>.<span class="hljs-property">globalStore</span> = globalStore; <span class="hljs-comment">// 子应用可直接访问</span>

<span class="hljs-comment">// 通信方法3：事件总线</span>
eventBus.<span class="hljs-title function_">on</span>(<span class="hljs-string">'sub-app-msg'</span>, <span class="hljs-function">(<span class="hljs-params">msg: string</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'主应用通过事件总线收到：'</span>, msg);
  <span class="hljs-title function_">alert</span>(<span class="hljs-string">`事件总线：<span class="hljs-subst">${msg}</span>`</span>);
});
<span class="hljs-comment">// 主应用主动发送事件给子应用（示例）</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  eventBus.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'main-app-msg'</span>, <span class="hljs-string">'主应用主动发送的实时消息'</span>);
}, <span class="hljs-number">3000</span>);

<span class="hljs-comment">// 通信方法4：QIANKUN自身的initGlobalState方法</span>
<span class="hljs-keyword">const</span> globalState = <span class="hljs-title function_">initGlobalState</span>({
  <span class="hljs-attr">userInfo</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> },
  <span class="hljs-attr">appMsg</span>: <span class="hljs-string">''</span> <span class="hljs-comment">// 存储主/子应用交互的消息</span>
});
<span class="hljs-comment">// 2. 主应用监听全局状态变更（实时响应）</span>
globalState.<span class="hljs-title function_">onGlobalStateChange</span>(<span class="hljs-function">(<span class="hljs-params">newState, prevState</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'主应用状态变更：'</span>, <span class="hljs-string">'旧值'</span>, prevState, <span class="hljs-string">'新值'</span>, newState);
}, <span class="hljs-literal">true</span>); <span class="hljs-comment">// 第二个参数为 true，初始化时立即执行一次</span>

<span class="hljs-comment">// 3. 主应用主动修改全局状态</span>
globalState.<span class="hljs-title function_">setGlobalState</span>({ <span class="hljs-attr">appMsg</span>: <span class="hljs-string">'主应用修改的全局消息'</span> });

<span class="hljs-title function_">registerMicroApps</span>([ 
    { 
        <span class="hljs-attr">name</span>: <span class="hljs-string">'sub-app'</span>, <span class="hljs-comment">// 子应用唯一标识（需和子应用 package.json 中的 name 一致） </span>
        <span class="hljs-attr">entry</span>: <span class="hljs-string">'//localhost:3001'</span>, <span class="hljs-comment">// 子应用的访问地址（端口和子应用一致） </span>
        <span class="hljs-attr">container</span>: <span class="hljs-string">'#sub-app-container'</span>, <span class="hljs-comment">// 子应用挂载的 DOM 容器 </span>
        <span class="hljs-attr">activeRule</span>: <span class="hljs-string">'/sub-app'</span>, <span class="hljs-comment">// 子应用的激活路由（匹配主应用的 /sub-app 路由） </span>
        <span class="hljs-comment">// 可选：传递给子应用的参数 </span>
        <span class="hljs-attr">props</span>: { 
            ...globalData,
            <span class="hljs-attr">msg</span>: <span class="hljs-string">'来自主应用的消息'</span> 
        }，
        <span class="hljs-comment">//通信方案6：postmessage</span>
        <span class="hljs-attr">afterMount</span>: <span class="hljs-function">(<span class="hljs-params">app</span>) =&gt;</span> {
          <span class="hljs-keyword">const</span> subWindow = app?.<span class="hljs-property">window</span>;
          <span class="hljs-comment">// 发送消息（指定接收域名，提升安全性）</span>
          subWindow.<span class="hljs-title function_">postMessage</span>(
            { <span class="hljs-attr">type</span>: <span class="hljs-string">'MAIN_MSG'</span>, <span class="hljs-attr">data</span>: <span class="hljs-string">'来自主应用的跨域消息'</span> },
            <span class="hljs-string">'//sub.example.com'</span>
          );
        }
    } 
]); 

<span class="hljs-comment">// 主应用监听子应用的跨域消息</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'message'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-comment">// 严格验证消息来源，防止恶意攻击</span>
  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">origin</span> !== <span class="hljs-string">'//sub.example.com'</span>) <span class="hljs-keyword">return</span>;
  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">data</span>.<span class="hljs-property">type</span> === <span class="hljs-string">'SUB_MSG'</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'主应用收到跨域消息：'</span>, e.<span class="hljs-property">data</span>.<span class="hljs-property">data</span>);
  }
});


    
<span class="hljs-comment">// 2. 启动 qiankun（默认立即启动，也可配置延迟启动） </span>
<span class="hljs-title function_">start</span>({ 
    <span class="hljs-attr">sandbox</span>: { 
        <span class="hljs-comment">// CSS 隔离：优先用严格隔离（现代浏览器），兼容场景用前缀隔离</span>
        <span class="hljs-attr">strictStyleIsolation</span>: <span class="hljs-literal">true</span>, 
        <span class="hljs-comment">// experimentalStyleIsolation: true, // 兼容模式选这个 </span>
    },
    <span class="hljs-comment">// 路由隔离：单实例模式（默认），避免多个子应用路由冲突</span>
    <span class="hljs-attr">singular</span>: <span class="hljs-literal">true</span>
});
</code></pre>
<ul>
<li>修改主应用首页（src/views/Home.vue）</li>
</ul>
<p>添加跳转到子应用的按钮：</p>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"home"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>主应用（main-app）<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>全局用户信息：{{ globalStore.userInfo.name }}，{{ globalStore.userInfo.age }}岁<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>子应用发送的消息：{{ globalStore.appMsg }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 主应用修改全局状态 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"updateUser"</span>&gt;</span>修改用户信息<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"$router.push('/sub-app')"</span>&gt;</span>打开子应用<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { useGlobalStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'../store'</span>;

<span class="hljs-keyword">const</span> globalStore = <span class="hljs-title function_">useGlobalStore</span>();

<span class="hljs-comment">// 主应用修改全局状态（子应用会同步看到）</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">updateUser</span> = (<span class="hljs-params"/>) =&gt; {
  globalStore.<span class="hljs-title function_">updateUserInfo</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'李四'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> });
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<ul>
<li>主应用创建 Pinia 状态库（src/store/index.ts）</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>;

<span class="hljs-comment">// 定义全局共享状态</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useGlobalStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'global'</span>, {
  <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({
    <span class="hljs-attr">userInfo</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> },
    <span class="hljs-attr">appMsg</span>: <span class="hljs-string">''</span> <span class="hljs-comment">// 存储子应用发送的消息</span>
  }),
  <span class="hljs-attr">actions</span>: {
    <span class="hljs-comment">// 修改用户信息（主/子应用均可调用）</span>
    <span class="hljs-title function_">updateUserInfo</span>(<span class="hljs-params">newInfo: { name: string; age: number }</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">userInfo</span> = newInfo;
    },
    <span class="hljs-comment">// 接收子应用消息</span>
    <span class="hljs-title function_">setSubAppMsg</span>(<span class="hljs-params">msg: string</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">appMsg</span> = msg;
    }
  }
});
</code></pre>
<ul>
<li>主应用创建事件总线（src/bus/index.ts）</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> mitt <span class="hljs-keyword">from</span> <span class="hljs-string">'mitt'</span>;

<span class="hljs-comment">// 创建事件总线实例</span>
<span class="hljs-keyword">const</span> eventBus = <span class="hljs-title function_">mitt</span>();
<span class="hljs-comment">// 挂载到 window，供子应用访问</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">eventBus</span> = eventBus;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> eventBus;
</code></pre>
<ul>
<li>修改主应用 Vite 配置（vite.config.ts）</li>
</ul>
<p>配置端口（避免和子应用冲突），允许跨域</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>; 
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({ 
    <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">vue</span>()], 
    <span class="hljs-attr">server</span>: { 
        <span class="hljs-attr">port</span>: <span class="hljs-number">3000</span>, <span class="hljs-comment">// 主应用端口 </span>
        <span class="hljs-attr">cors</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 允许跨域（子应用加载主应用资源需要） </span>
        <span class="hljs-attr">open</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 启动时自动打开浏览器 </span>
    } 
});
</code></pre>
<h3 data-id="heading-1">创建子应用</h3>
<ul>
<li>修改子应用 Vite 配置（vite.config.ts）</li>
</ul>
<p>配置基础路径、跨域、端口，适配 qiankun：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>; 
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span>; <span class="hljs-comment">// 判断是否在 qiankun 环境中 </span>

<span class="hljs-keyword">const</span> isQiankun = process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'development'</span> || <span class="hljs-variable language_">window</span>.<span class="hljs-property">__POWERED_BY_QIANKUN__</span>; 

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({ 
    <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">vue</span>()], 
    <span class="hljs-comment">// 基础路径：qiankun 环境下为 /sub-app（和主应用激活规则一致），否则为 / </span>
    <span class="hljs-attr">base</span>: isQiankun ? <span class="hljs-string">'/sub-app'</span> : <span class="hljs-string">'/'</span>, 
    <span class="hljs-attr">server</span>: { 
        <span class="hljs-attr">port</span>: <span class="hljs-number">3001</span>, <span class="hljs-comment">// 子应用端口 </span>
        <span class="hljs-attr">cors</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 允许跨域（主应用加载子应用资源需要） </span>
        <span class="hljs-attr">headers</span>: { 
            <span class="hljs-comment">// 允许主应用访问子应用的资源（CORS 配置） </span>
            <span class="hljs-string">'Access-Control-Allow-Origin'</span>: <span class="hljs-string">'*'</span> 
        } 
    } 
});
</code></pre>
<ul>
<li>修改子应用入口文件（src/main.ts）</li>
</ul>
<p>导出 qiankun 要求的生命周期函数（<code>bootstrap/mount/unmount</code>）：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>; 
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>; 
<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'./router'</span>; 
<span class="hljs-keyword">import</span> <span class="hljs-string">'./style.css'</span>; 

<span class="hljs-keyword">let</span> <span class="hljs-attr">app</span>: <span class="hljs-title class_">ReturnType</span>&lt;<span class="hljs-keyword">typeof</span> createApp&gt;; <span class="hljs-comment">// 1. 生命周期：启动（只会执行一次） </span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">bootstrap</span>(<span class="hljs-params">props: any</span>) { 
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'子应用启动'</span>, props); <span class="hljs-comment">// 接收主应用传递的参数 </span>
} 

<span class="hljs-comment">// 主应用监听子应用的跨域消息</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'message'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-comment">// 严格验证消息来源，防止恶意攻击</span>
  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">origin</span> !== <span class="hljs-string">'//sub.example.com'</span>) <span class="hljs-keyword">return</span>;
  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">data</span>.<span class="hljs-property">type</span> === <span class="hljs-string">'SUB_MSG'</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'主应用收到跨域消息：'</span>, e.<span class="hljs-property">data</span>.<span class="hljs-property">data</span>);
  }
});

<span class="hljs-comment">// 2. 生命周期：挂载（每次激活子应用时执行） </span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">mount</span>(<span class="hljs-params">props: any</span>) { 
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'子应用挂载'</span>, props); 
    
    qiankunProps = props; 
    <span class="hljs-comment">// 保存 props 到全局 </span>
    <span class="hljs-comment">// 新增：将 props 挂载到 window，方便子应用任意组件访问 </span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">qiankunProps</span> = props;
    
    <span class="hljs-keyword">const</span> { onGlobalStateChange, setGlobalState } = props;

  <span class="hljs-comment">// 1. 子应用监听全局状态变更</span>
  <span class="hljs-title function_">onGlobalStateChange</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'子应用收到全局状态：'</span>, state);
    <span class="hljs-comment">// 可将状态挂载到子应用全局，供组件使用</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">globalState</span> = state;
  }, <span class="hljs-literal">true</span>);

  <span class="hljs-comment">// 2. 子应用修改全局状态（主应用会同步收到）</span>
  <span class="hljs-title function_">setGlobalState</span>({ <span class="hljs-attr">appMsg</span>: <span class="hljs-string">'子应用修改的全局消息'</span> });
    
    <span class="hljs-comment">// 挂载到主应用指定的容器，或子应用自己的容器（独立运行时） </span>
    <span class="hljs-keyword">const</span> container = props?.<span class="hljs-property">container</span>?.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#app'</span>) || <span class="hljs-string">'#app'</span>; 
    app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>); app.<span class="hljs-title function_">use</span>(router); 
    app.<span class="hljs-title function_">mount</span>(container); 
} 
    
<span class="hljs-comment">// 3. 生命周期：卸载（每次离开子应用时执行） </span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">unmount</span>(<span class="hljs-params"/>) { 
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'子应用卸载'</span>); 
    app.<span class="hljs-title function_">unmount</span>(); <span class="hljs-comment">// 销毁应用实例 </span>
} 

<span class="hljs-comment">// 4. 独立运行时（不嵌入主应用） </span>
<span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">window</span>.<span class="hljs-property">__POWERED_BY_QIANKUN__</span>) { 
    <span class="hljs-title function_">mount</span>({}); 
} 

<span class="hljs-comment">// 导出生命周期函数（供 qiankun 调用） </span>
<span class="hljs-keyword">export</span> { bootstrap, mount, unmount };
</code></pre>
<ul>
<li>子应用组件使用（Home.vue）：</li>
</ul>
<p>调用主应用回调</p>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"home"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>子应用（sub-app）<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>主应用传递的用户信息：{{ userInfo.name }}，{{ userInfo.age }}岁<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>主应用初始消息：{{ msg }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 新增：子应用向主应用发消息 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"subMsg"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"输入要发送给主应用的消息"</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"sendToMain"</span>&gt;</span>发送给主应用<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"goBack"</span>&gt;</span>返回主应用<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> { useRouter } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>;

<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>();
<span class="hljs-keyword">const</span> msg = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>);
<span class="hljs-keyword">const</span> userInfo = <span class="hljs-title function_">ref</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">0</span> });
<span class="hljs-keyword">const</span> subMsg = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>); <span class="hljs-comment">// 子应用要发送的消息</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">eventBus</span>: any = <span class="hljs-literal">null</span>;

<span class="hljs-comment">// 新增：获取主应用挂载的全局状态</span>
<span class="hljs-keyword">const</span> globalStore = <span class="hljs-variable language_">window</span>.<span class="hljs-property">__POWERED_BY_QIANKUN__</span> ? <span class="hljs-variable language_">window</span>.<span class="hljs-property">globalStore</span> : <span class="hljs-literal">null</span>;

<span class="hljs-comment">// 子应用发送消息到主应用（修改全局状态）</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">sendToMain</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (globalStore) {
    globalStore.<span class="hljs-title function_">setSubAppMsg</span>(subMsg.<span class="hljs-property">value</span>);
    subMsg.<span class="hljs-property">value</span> = <span class="hljs-string">''</span>;
  }
};

<span class="hljs-comment">// 子应用修改全局用户信息（主应用会同步看到）</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">updateUserFromSub</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (globalStore) {
    globalStore.<span class="hljs-title function_">updateUserInfo</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'王五'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">28</span> });
  }
};

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">__POWERED_BY_QIANKUN__</span>) {
    <span class="hljs-comment">// 获取主应用的事件总线</span>
    eventBus = <span class="hljs-variable language_">window</span>.<span class="hljs-property">eventBus</span>;
    <span class="hljs-comment">// 监听主应用发送的事件</span>
    eventBus.<span class="hljs-title function_">on</span>(<span class="hljs-string">'main-app-msg'</span>, <span class="hljs-function">(<span class="hljs-params">msg: string</span>) =&gt;</span> {
      mainMsg.<span class="hljs-property">value</span> = msg;
    });
    <span class="hljs-comment">// 读取主应用传递的 props</span>
    msg.<span class="hljs-property">value</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">qiankunProps</span>.<span class="hljs-property">msg</span>;
    userInfo.<span class="hljs-property">value</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">qiankunProps</span>.<span class="hljs-property">userInfo</span>;
  } <span class="hljs-keyword">else</span> {
    msg.<span class="hljs-property">value</span> = <span class="hljs-string">'独立运行'</span>;
    userInfo.<span class="hljs-property">value</span> = { <span class="hljs-attr">name</span>: <span class="hljs-string">'测试用户'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">18</span> };
  }
});

<span class="hljs-comment">// 子应用发送事件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">sendByBus</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (eventBus) {
    eventBus.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'sub-app-msg'</span>, subMsg.<span class="hljs-property">value</span>);
    subMsg.<span class="hljs-property">value</span> = <span class="hljs-string">''</span>;
  }
};

<span class="hljs-comment">// 卸载时移除事件监听（避免内存泄漏）</span>
<span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (eventBus) {
    eventBus.<span class="hljs-title function_">off</span>(<span class="hljs-string">'main-app-msg'</span>);
  }
});


<span class="hljs-comment">// 新增：子应用向主应用发消息（调用主应用传递的回调）</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">sendToMain</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">__POWERED_BY_QIANKUN__</span> &amp;&amp; <span class="hljs-variable language_">window</span>.<span class="hljs-property">qiankunProps</span>.<span class="hljs-property">onSubAppMsg</span>) {
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">qiankunProps</span>.<span class="hljs-title function_">onSubAppMsg</span>(subMsg.<span class="hljs-property">value</span>);
    subMsg.<span class="hljs-property">value</span> = <span class="hljs-string">''</span>; <span class="hljs-comment">// 清空输入框</span>
  }
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">goBack</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">__POWERED_BY_QIANKUN__</span>) {
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">back</span>();
  } <span class="hljs-keyword">else</span> {
    router.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/'</span>);
  }
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<ul>
<li>修改子应用路由（src/router/index.ts）</li>
</ul>
<p>适配主应用的路由前缀（<code>/sub-app</code>）：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { createRouter, createWebHistory, <span class="hljs-title class_">RouteRecordRaw</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>; 
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Home</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../views/Home.vue'</span>; 

<span class="hljs-comment">// 路由基础路径：qiankun 环境下为 /sub-app </span>
<span class="hljs-keyword">const</span> base = <span class="hljs-variable language_">window</span>.<span class="hljs-property">__POWERED_BY_QIANKUN__</span> ? <span class="hljs-string">'/sub-app'</span> : <span class="hljs-string">'/'</span>; 
<span class="hljs-keyword">const</span> <span class="hljs-attr">routes</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">RouteRecordRaw</span>&gt; = [ { 
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>, 
    <span class="hljs-attr">name</span>: <span class="hljs-string">'Home'</span>, 
    <span class="hljs-attr">component</span>: <span class="hljs-title class_">Home</span> 
} ]; 

<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>({ 
    <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHistory</span>(base), 
    routes 
}); 

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router;
</code></pre>
<ul>
<li>修改子应用首页（src/views/Home.vue）</li>
</ul>
<p>展示主应用传递的参数，添加返回主应用的按钮：</p>
<pre><code class="hljs language-js" lang="js">&lt;template&gt; 
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"home"</span>&gt;</span> 
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>子应用（sub-app）<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span> 
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>主应用传递的消息：{{ msg }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span> 
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"goBack"</span>&gt;</span>返回主应用<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span> 
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span> 
&lt;/template&gt; 
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript"> 
<span class="hljs-keyword">import</span> { ref, onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>; 
<span class="hljs-keyword">import</span> { useRouter } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>; 
<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>(); 
<span class="hljs-keyword">const</span> msg = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>); <span class="hljs-comment">// 获取主应用传递的参数 </span>

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> { 
    <span class="hljs-comment">// @ts-ignore 忽略类型提示（新手友好） </span>
    msg.<span class="hljs-property">value</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">__POWERED_BY_QIANKUN__</span> ? <span class="hljs-variable language_">window</span>.<span class="hljs-property">qiankunProps</span>?.<span class="hljs-property">msg</span> : <span class="hljs-string">'独立运行'</span>; 
}); 
<span class="hljs-comment">// 返回主应用 </span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">goBack</span> = (<span class="hljs-params"/>) =&gt; { 
<span class="hljs-comment">// 嵌入主应用时，使用主应用路由；独立运行时，直接跳转 </span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">__POWERED_BY_QIANKUN__</span>) { 
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">back</span>(); 
    } <span class="hljs-keyword">else</span> { 
        router.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/'</span>); 
    } 
}; 
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span> 
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css"> 
<span class="hljs-selector-class">.home</span> { <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>; } 
<span class="hljs-selector-tag">button</span> { <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span> <span class="hljs-number">16px</span>; <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>; <span class="hljs-attribute">cursor</span>: pointer; } 
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<h3 data-id="heading-2">总结</h3>
<ul>
<li>整体架构</li>
</ul>
<ol>
<li>端口冲突：主应用 3000，子应用 3001，确保启动时端口不重复；</li>
<li>跨域配置：主 / 子应用都开启 <code>cors: true</code>，子应用添加 <code>Access-Control-Allow-Origin</code> 头，避免加载资源跨域；</li>
<li>生命周期：子应用必须导出 <code>bootstrap/mount/unmount</code> 三个函数，qiankun 会根据路由匹配自动调用；</li>
<li>样式隔离：主应用启动时配置 <code>strictStyleIsolation: true</code>，避免子应用样式污染主应用；</li>
<li>路由适配：子应用路由的 <code>base</code> 需和主应用的 <code>activeRule</code> 一致（<code>/sub-app</code>），否则路由会失效。</li>
</ol>
<ul>
<li>通信机制</li>
</ul>
<ol>
<li>Props 传参：适合主→子单向简单数据传递，可通过回调实现子→主通信，上手成本最低；</li>
<li>全局状态共享（Pinia/Vuex/Redux） ：推荐用于复杂场景，支持主↔子双向数据同步，符合前端状态管理最佳实践；</li>
<li>事件总线（mitt） ：适合实时触发式交互（如通知、弹窗），轻量灵活，适配所有技术栈。</li>
<li>Url通信：单向传递，参数暴露在 URL 中（不适合敏感数据），参数长度有限制</li>
<li>postmessage通信：跨域名通信，不受 qiankun 沙箱限制，通用所有前端应用；缺点：需要手动验证消息来源（防 XSS），代码冗余，仅适合跨域场景</li>
<li>QIANKUN自带的initGlobalState，qiankun 原生支持，无需第三方库，状态变更自动同步，沙箱兼容好； 缺点是仅支持<strong>浅层次状态更新</strong>（复杂嵌套对象需整体替换），功能比 Pinia/Vuex 简单（无模块化、异步 action 等）</li>
<li>Localstorage等外部存储空间，qiankun 的沙箱默认<strong>不隔离</strong> LocalStorage/SessionStorage（所有子应用共享）：无实时通知，暴露在客户端有安全风险，不适合高频更新的状态</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[github stra 加星和 极易忽略的 4 个 Nginx 关键知识点，避坑指南 + 实战配置]]></title>    <link>https://juejin.cn/post/7600670417859149858</link>    <guid>https://juejin.cn/post/7600670417859149858</guid>    <pubDate>2026-01-30T05:54:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600670417859149858" data-draft-id="7600681071715123200" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="github stra 加星和 极易忽略的 4 个 Nginx 关键知识点，避坑指南 + 实战配置"/> <meta itemprop="keywords" content="面试,GitHub"/> <meta itemprop="datePublished" content="2026-01-30T05:54:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="开源之眼"/> <meta itemprop="url" content="https://juejin.cn/user/55438993800919"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            github stra 加星和 极易忽略的 4 个 Nginx 关键知识点，避坑指南 + 实战配置
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/55438993800919/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    开源之眼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T05:54:59.000Z" title="Fri Jan 30 2026 05:54:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在日常 Nginx 使用中，很多看似细微的配置差异却可能导致服务异常，本文整理了 4 个高频踩坑点，结合实战案例详细解析，帮你快速掌握核心用法～</p>
<h4 data-id="heading-0">Taimili 艾米莉 ( 一款专业的 GitHub star 管理和github 加星涨星工具<a href="https://link.juejin.cn?target=taimili.com" title="https://link.juejin.cn?target=taimili.com" target="_blank">taimili.com</a> )</h4>
<p>艾米莉 是一款优雅便捷的 GitHub star 管理和github 加星涨星工具，基于 PHP &amp; javascript 构建， 能对github star fork follow watch 刷星管理和提升，最适合github 的深度用户</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b95d4a3fca14402782a7bb0fbc0b403b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5rqQ5LmL55y8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770357303&amp;x-signature=UtJU%2F1rVy1hCTY7c4O%2BjiLVKJoo%3D" alt="WX20251021-210346@2x.png" loading="lazy"/></p>
<h2 data-id="heading-1">一、proxy_pass 与 location 末尾斜杠的 "生死劫"</h2>
<p>Nginx 反向代理中，<code>proxy_pass</code>和<code>location</code>指令后的斜杠 <code>/</code> 堪称 "细节杀手"，一个字符的差异会导致完全不同的转发结果。</p>
<h3 data-id="heading-2">1. proxy_pass 末尾的斜杠：控制路径前缀是否保留</h3>
<p>先看两组经典配置对比：</p>
<p>nginx</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 配置一：proxy_pass无末尾斜杠</span>
location /test {
  proxy_pass <span class="hljs-string">'http://192.186.0.1:8080'</span>;
}

<span class="hljs-comment"># 配置二：proxy_pass有末尾斜杠</span>
location /test {
  proxy_pass <span class="hljs-string">'http://192.186.0.1:8080/'</span>;
}
</code></pre>
<p>当请求接口 <code>http://domain/test/file/getList</code> 时：</p>
<ul>
<li>配置一转发结果：<code>http://192.186.0.1:8080/test/file/getList</code>（保留 <code>/test</code> 前缀）</li>
<li>配置二转发结果：<code>http://192.186.0.1:8080/file/getList</code>（去除 <code>/test</code> 前缀）</li>
</ul>
<p><strong>核心逻辑</strong>：<code>proxy_pass</code> 后的斜杠表示 "去除 location 匹配的路径前缀"。</p>
<ul>
<li>若后端接口本身包含 <code>/test</code> 路径，无需加斜杠；</li>
<li>若 <code>/test</code> 仅为前端反向代理拦截标识（后端无此路径），必须加斜杠。</li>
</ul>
<p><strong>推荐写法</strong>（可读性更强，避免歧义）：</p>
<p>nginx</p>
<pre><code class="hljs language-bash" lang="bash">location /test {
  rewrite ^/test/(.*)$ /<span class="hljs-variable">$1</span> <span class="hljs-built_in">break</span>;  <span class="hljs-comment"># 显式去除/test前缀</span>
  proxy_pass <span class="hljs-string">'http://192.186.0.1:8080'</span>;
}
</code></pre>
<h3 data-id="heading-3">2. location 末尾的斜杠：控制匹配精度</h3>
<p>再看另一组配置差异：</p>
<p>nginx</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 配置一：location无末尾斜杠</span>
location /test {
  proxy_pass <span class="hljs-string">'http://192.186.0.1:8080'</span>;
}

<span class="hljs-comment"># 配置二：location有末尾斜杠</span>
location /test/ {
  proxy_pass <span class="hljs-string">'http://192.186.0.1:8080'</span>;
}
</code></pre>
<p>两者的匹配规则天差地别，具体对比如下：</p>









































<table><thead><tr><th>请求路径</th><th>location /test</th><th>location /test/</th><th>最终匹配结果</th></tr></thead><tbody><tr><td>/test</td><td>✅</td><td>❌</td><td>location /test</td></tr><tr><td>/test/</td><td>✅</td><td>✅</td><td>location /test/</td></tr><tr><td>/test/abc</td><td>✅</td><td>✅</td><td>location /test/</td></tr><tr><td>/test123</td><td>✅</td><td>❌</td><td>location /test</td></tr><tr><td>/test-123</td><td>✅</td><td>❌</td><td>location /test</td></tr></tbody></table>
<p><strong>关键结论</strong>：</p>
<ul>
<li><code>location /test</code>（无斜杠）：模糊匹配，包含 <code>/test</code> 开头的所有路径（包括 <code>/test123</code> 这类 "伪前缀" 路径）；</li>
<li><code>location /test/</code>（有斜杠）：精确匹配，仅匹配以 <code>/test/</code> 为前缀的路径（避免误匹配相似路径）；</li>
<li>当两个配置同时存在时，Nginx 会优先选择更精确的 <code>location /test/</code>（涉及匹配优先级规则）。</li>
</ul>
<h3 data-id="heading-4">延伸：Nginx location 匹配优先级完整版</h3>
<p>记住核心口诀（从高到低）：</p>
<p>plaintext</p>
<pre><code class="hljs">等号精确第一名
波浪前缀挡正则
正则排队按顺序
普通前缀取最长
</code></pre>
<p>详细解释：</p>
<ol>
<li><strong>等号精确匹配（=）</strong> ：优先级最高，完全匹配目标路径（如 <code>location = /</code> 仅匹配根路径）；</li>
<li><strong>前缀优先匹配（^~）</strong> ：匹配路径前缀，且会阻止后续正则匹配（适用于静态资源目录，提升性能）；</li>
<li>*<em>正则匹配（~ 区分大小写 / ~</em> 不区分大小写）**：按配置文件顺序匹配，一旦命中立即返回；</li>
<li><strong>普通前缀匹配（无符号）</strong> ：按最长路径匹配原则（如 <code>/api/v2/</code> 比 <code>/api/</code> 优先级高）；</li>
<li><strong>通用匹配（/）</strong> ：兜底规则，匹配所有未被前面规则命中的请求。</li>
</ol>
<p><strong>电商实战配置示例</strong>（覆盖所有优先级场景）：</p>
<p>nginx</p>
<pre><code class="hljs language-ini" lang="ini">server {
    listen 80<span class="hljs-comment">;</span>
    server_name shop.example.com<span class="hljs-comment">;</span>
    root /var/www/shop<span class="hljs-comment">;</span>

    <span class="hljs-comment"># 1. 精确匹配（=）- 最高优先级</span>
    <span class="hljs-attr">location</span> = / {
        return 200 "首页 <span class="hljs-section">[精确匹配 =]</span>"<span class="hljs-comment">;</span>
        add_header Content-Type text/plain<span class="hljs-comment">;</span>
    }
    <span class="hljs-attr">location</span> = /robots.txt {
        return 200 "User-agent: *\nDisallow: /admin/"<span class="hljs-comment">;</span>
        add_header Content-Type text/plain<span class="hljs-comment">;</span>
    }

    <span class="hljs-comment"># 2. 前缀优先匹配（^~）- 阻止正则</span>
    location ^~ /static/ {
        alias /var/www/shop/static/<span class="hljs-comment">;</span>
        expires 30d<span class="hljs-comment">;</span>
        return 200 "静态资源 <span class="hljs-section">[前缀优先 ^~]</span>"<span class="hljs-comment">;</span>
    }

    <span class="hljs-comment"># 3. 正则匹配（~ / ~*）- 按顺序</span>
    location ~ .(jpg|png|gif)$ {  <span class="hljs-comment"># 区分大小写</span>
        expires 30d<span class="hljs-comment">;</span>
        return 200 "图片文件 <span class="hljs-section">[正则 ~]</span>"<span class="hljs-comment">;</span>
    }
    location ~* .(css|js)$ {  <span class="hljs-comment"># 不区分大小写</span>
        expires 7d<span class="hljs-comment">;</span>
        return 200 "CSS/JS <span class="hljs-section">[正则 ~*]</span>"<span class="hljs-comment">;</span>
    }

    <span class="hljs-comment"># 4. 普通前缀匹配 - 最长优先</span>
    location /api/v2/ {  <span class="hljs-comment"># 最长前缀</span>
        proxy_pass http://backend_v2<span class="hljs-comment">;</span>
        return 200 "API v2 <span class="hljs-section">[普通前缀-最长]</span>"<span class="hljs-comment">;</span>
    }
    location /api/ {  <span class="hljs-comment"># 较短前缀</span>
        proxy_pass http://backend<span class="hljs-comment">;</span>
        return 200 "API 通用 <span class="hljs-section">[普通前缀-较短]</span>"<span class="hljs-comment">;</span>
    }

    <span class="hljs-comment"># 5. 兜底匹配</span>
    location / {
        try_files $uri $uri/ /index.html<span class="hljs-comment">;</span>
        return 200 "通用兜底 <span class="hljs-section">[/]</span>"<span class="hljs-comment">;</span>
    }
}
</code></pre>
<h2 data-id="heading-5">二、Nginx 重启命令：reload vs systemctl reload，该用哪个？</h2>
<p>日常运维中，重启 Nginx 有两种常用命令，但适用场景和执行逻辑差异明显：</p>























<table><thead><tr><th>命令形式</th><th>执行原理</th><th>适用场景</th><th>核心特点</th></tr></thead><tbody><tr><td><code>nginx -s reload</code></td><td>直接向 Nginx 主进程发送 reload 信号</td><td>本地开发环境、无 systemd 的系统</td><td>原生方式，需确保 nginx 在 PATH 中</td></tr><tr><td><code>systemctl reload nginx</code></td><td>通过 systemd 管理服务发送重载信号</td><td>CentOS7+/Ubuntu16.04 + 等现代 Linux</td><td>系统标准方式，推荐生产环境使用</td></tr></tbody></table>
<h3 data-id="heading-6">关键补充：</h3>
<ol>
<li>
<p>两者均为<strong>优雅重启</strong>：不中断现有连接，平滑加载新配置；</p>
</li>
<li>
<p>相关命令对应关系：</p>
<ul>
<li><code>nginx -s stop</code> ≈ <code>systemctl stop nginx</code>（强制停止）</li>
<li><code>nginx -s quit</code> ≈ <code>systemctl stop nginx</code>（优雅停止）</li>
<li><code>nginx -t</code>：单独测试配置文件语法（无 systemctl 对应命令）；</li>
</ul>
</li>
<li>
<p>生产环境推荐操作流程（安全无风险）：</p>
</li>
</ol>
<p>bash</p>
<p>运行</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 先测试配置文件语法是否正确</span>
nginx -t

<span class="hljs-comment"># 2. 语法正确则平滑重载（不中断服务）</span>
systemctl reload nginx

<span class="hljs-comment"># 3. 检查服务状态</span>
systemctl status nginx

<span class="hljs-comment"># 4. 备用方案（若systemctl不可用）</span>
sudo /usr/sbin/nginx -s reload
</code></pre>
<p><strong>总结</strong>：生产环境优先使用 <code>systemctl</code> 系列命令（现代 Linux 标准），本地开发或无 systemd 环境可使用 <code>nginx -s</code> 原生命令。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android Studio中Gradle版本修改与兼容性管理指南]]></title>    <link>https://juejin.cn/post/7600681071715287040</link>    <guid>https://juejin.cn/post/7600681071715287040</guid>    <pubDate>2026-01-30T06:12:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600681071715287040" data-draft-id="7600681071715254272" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android Studio中Gradle版本修改与兼容性管理指南"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-30T06:12:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="城西往事"/> <meta itemprop="url" content="https://juejin.cn/user/1392401215657757"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android Studio中Gradle版本修改与兼容性管理指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1392401215657757/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    城西往事
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T06:12:36.000Z" title="Fri Jan 30 2026 06:12:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d0890e56fc241168bf053f51623dd39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Z-O6KW_5b6A5LqL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770358355&amp;x-signature=dBbeoW3kUqB5PxfFiVeCGxmepc0%3D" alt="avatar" loading="lazy"/>2025-12-10 13:17:42</p>
<p>在Android开发中，Gradle版本与Android Gradle Plugin（AGP）的兼容性直接影响项目构建效率。本文详细介绍如何安全修改Gradle版本，并处理常见兼容性问题。</p>
<h2 data-id="heading-0">核心操作步骤<a href="https://link.juejin.cn?target=https%3A%2F%2Fcomate.baidu.com%2Fzh%2Fpage%2Fxat32bn4gmz%230" target="_blank" title="https://comate.baidu.com/zh/page/xat32bn4gmz#0" ref="nofollow noopener noreferrer"/></h2>
<h3 data-id="heading-1">修改Gradle插件版本（AGP）<a href="https://link.juejin.cn?target=https%3A%2F%2Fcomate.baidu.com%2Fzh%2Fpage%2Fxat32bn4gmz%231" target="_blank" title="https://comate.baidu.com/zh/page/xat32bn4gmz#1" ref="nofollow noopener noreferrer"/></h3>
<p>在项目根目录的<code>build.gradle</code>文件中，调整<code>classpath</code>依赖的AGP版本。例如将版本升级至8.13.2：</p>
<pre><code class="hljs language-groovy" lang="groovy">buildscript {
    dependencies {
        classpath "com.android.tools.build:gradle:8.13.2"
    }
}
</code></pre>
<p>或使用Kotlin DSL格式：</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin">
plugins {
    id(<span class="hljs-string">"com.android.application"</span>) version <span class="hljs-string">"8.13.2"</span> apply <span class="hljs-literal">false</span>
}
</code></pre>
<h3 data-id="heading-2">修改Gradle发行版版本<a href="https://link.juejin.cn?target=https%3A%2F%2Fcomate.baidu.com%2Fzh%2Fpage%2Fxat32bn4gmz%232" target="_blank" title="https://comate.baidu.com/zh/page/xat32bn4gmz#2" ref="nofollow noopener noreferrer"/></h3>
<p>通过<code>gradle-wrapper.properties</code>文件指定Gradle版本。例如使用Gradle 8.13：</p>
<pre><code class="hljs language-properties" lang="properties">
distributionUrl=https://services.gradle.org/distributions/gradle-8.13-bin.zip
</code></pre>
<p><strong>图形界面操作</strong>：通过 <strong>File &gt; Project Structure &gt; Project</strong> 菜单，直接选择Gradle和AGP版本。</p>
<h3 data-id="heading-3">同步与清理<a href="https://link.juejin.cn?target=https%3A%2F%2Fcomate.baidu.com%2Fzh%2Fpage%2Fxat32bn4gmz%233" target="_blank" title="https://comate.baidu.com/zh/page/xat32bn4gmz#3" ref="nofollow noopener noreferrer"/></h3>
<p>修改后执行以下命令确保环境干净：</p>
<pre><code class="hljs language-bash" lang="bash">
./gradlew --stop  <span class="hljs-comment"># 停止旧版Gradle守护进程</span>
./gradlew clean   <span class="hljs-comment"># 清理构建缓存</span>
</code></pre>
<h2 data-id="heading-4">版本兼容性规则<a href="https://link.juejin.cn?target=https%3A%2F%2Fcomate.baidu.com%2Fzh%2Fpage%2Fxat32bn4gmz%234" target="_blank" title="https://comate.baidu.com/zh/page/xat32bn4gmz#4" ref="nofollow noopener noreferrer"/></h2>
<h3 data-id="heading-5">AGP与Gradle兼容关系<a href="https://link.juejin.cn?target=https%3A%2F%2Fcomate.baidu.com%2Fzh%2Fpage%2Fxat32bn4gmz%235" target="_blank" title="https://comate.baidu.com/zh/page/xat32bn4gmz#5" ref="nofollow noopener noreferrer"/></h3>

























<table><thead><tr><th>AGP版本</th><th>最低Gradle版本</th><th>推荐Gradle版本</th></tr></thead><tbody><tr><td>8.x</td><td>8.0</td><td>8.13</td></tr><tr><td>7.x</td><td>7.0</td><td>7.6</td></tr><tr><td>完整兼容表参考<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.google.cn%2Fstudio%2Freleases%2Fgradle-plugin.html%23updating-gradle" target="_blank" title="https://developer.android.google.cn/studio/releases/gradle-plugin.html#updating-gradle" ref="nofollow noopener noreferrer">官方文档</a>。</td><td/><td/></tr></tbody></table>
<h3 data-id="heading-6">常见错误处理<a href="https://link.juejin.cn?target=https%3A%2F%2Fcomate.baidu.com%2Fzh%2Fpage%2Fxat32bn4gmz%236" target="_blank" title="https://comate.baidu.com/zh/page/xat32bn4gmz#6" ref="nofollow noopener noreferrer"/></h3>
<ul>
<li><strong>错误1</strong>：<code>Minimum supported Gradle version is X.X.X</code><br/>
<strong>原因</strong>：AGP版本高于Gradle版本。<br/>
<strong>解决</strong>：升级Gradle或降级AGP。</li>
<li><strong>错误2</strong>：<code>Could not find com.android.tools.build:gradle:X.X.X</code><br/>
<strong>原因</strong>：插件版本不存在或网络问题。<br/>
<strong>解决</strong>：检查版本号或更换镜像源。</li>
</ul>
<h2 data-id="heading-7">最佳实践建议<a href="https://link.juejin.cn?target=https%3A%2F%2Fcomate.baidu.com%2Fzh%2Fpage%2Fxat32bn4gmz%237" target="_blank" title="https://comate.baidu.com/zh/page/xat32bn4gmz#7" ref="nofollow noopener noreferrer"/></h2>
<h3 data-id="heading-8">稳定版组合推荐<a href="https://link.juejin.cn?target=https%3A%2F%2Fcomate.baidu.com%2Fzh%2Fpage%2Fxat32bn4gmz%238" target="_blank" title="https://comate.baidu.com/zh/page/xat32bn4gmz#8" ref="nofollow noopener noreferrer"/></h3>
<ul>
<li>AGP 8.13 + Gradle 8.13（2025年最新稳定版）</li>
<li>避免使用动态版本（如<code>8.13.+</code>），防止意外更新。</li>
</ul>
<h3 data-id="heading-9">多模块项目配置<a href="https://link.juejin.cn?target=https%3A%2F%2Fcomate.baidu.com%2Fzh%2Fpage%2Fxat32bn4gmz%239" target="_blank" title="https://comate.baidu.com/zh/page/xat32bn4gmz#9" ref="nofollow noopener noreferrer"/></h3>
<p>确保所有模块的<code>build.gradle</code>中AGP版本一致。例如：</p>
<pre><code class="hljs language-groovy" lang="groovy">plugins {
    id("com.android.library") version "8.13.2"
}
</code></pre>
<h3 data-id="heading-10">离线模式优化<a href="https://link.juejin.cn?target=https%3A%2F%2Fcomate.baidu.com%2Fzh%2Fpage%2Fxat32bn4gmz%2310" target="_blank" title="https://comate.baidu.com/zh/page/xat32bn4gmz#10" ref="nofollow noopener noreferrer"/></h3>
<p>在<code>File &gt; Settings &gt; Build, Execution, Deployment &gt; Gradle</code>中启用 <strong>Offline work</strong>，可加速同步（需提前下载依赖）。</p>
<h2 data-id="heading-11">完整配置示例<a href="https://link.juejin.cn?target=https%3A%2F%2Fcomate.baidu.com%2Fzh%2Fpage%2Fxat32bn4gmz%2311" target="_blank" title="https://comate.baidu.com/zh/page/xat32bn4gmz#11" ref="nofollow noopener noreferrer"/></h2>
<h3 data-id="heading-12">项目级<a href="https://link.juejin.cn?target=https%3A%2F%2Fcomate.baidu.com%2Fzh%2Fpage%2Fxat32bn4gmz%2312" target="_blank" title="https://comate.baidu.com/zh/page/xat32bn4gmz#12" ref="nofollow noopener noreferrer"> </a><code>build.gradle</code></h3>
<pre><code class="hljs language-groovy" lang="groovy">
buildscript {
    repositories {
        google()
        mavenCentral()
    }
    dependencies {
        classpath "com.android.tools.build:gradle:8.13.2"
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:1.9.22"
    }
}

allprojects {
    repositories {
        google()
        mavenCentral()
    }
}
</code></pre>
<h3 data-id="heading-13"><a href="https://link.juejin.cn?target=https%3A%2F%2Fcomate.baidu.com%2Fzh%2Fpage%2Fxat32bn4gmz%2313" target="_blank" title="https://comate.baidu.com/zh/page/xat32bn4gmz#13" ref="nofollow noopener noreferrer"/><code>gradle-wrapper.properties</code></h3>
<pre><code class="hljs language-properties" lang="properties">
distributionBase=GRADLE_USER_HOME
distributionPath=wrapper/dists
distributionUrl=https://services.gradle.org/distributions/gradle-8.13-bin.zip
zipStoreBase=GRADLE_USER_HOME
zipStorePath=wrapper/dists
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[PPIO 上线 PaddleOCR-VL-1.5 ：小参数高性能 | 一键部署]]></title>    <link>https://juejin.cn/post/7600764857769279538</link>    <guid>https://juejin.cn/post/7600764857769279538</guid>    <pubDate>2026-01-30T05:41:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600764857769279538" data-draft-id="7600764857769263154" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="PPIO 上线 PaddleOCR-VL-1.5 ：小参数高性能 | 一键部署"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-30T05:41:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="PPIO派欧云"/> <meta itemprop="url" content="https://juejin.cn/user/2922958914073696"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            PPIO 上线 PaddleOCR-VL-1.5 ：小参数高性能 | 一键部署
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2922958914073696/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    PPIO派欧云
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T05:41:20.000Z" title="Fri Jan 30 2026 05:41:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2c9314356754ab295b55e25fd7182e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUFBJT-a0vuasp-S6kQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770358120&amp;x-signature=S11AfwzIQRxgv5bihHeDMl4EZYw%3D" alt="" loading="lazy"/></p>
<p>PPIO 算力市场首发上线了 PaddleOCR-VL-1.5 模型模板。</p>
<p>作为 PaddleOCR-VL 系列的全新迭代版本，PaddleOCR-VL-1.5 在保持 0.9B 轻量级参数的同时，性能实现了显著提升 。在权威评测集 OmniDocBench v1.5 上，该模型取得了 94.5% 的精度，优于当前主流的通用大模型及文档解析专用模型。</p>
<p>该模型创新性地支持了文档元素的异形框定位，在扫描、倾斜、弯折、屏幕拍摄及复杂光照等真实落地场景中表现出色，能够精准返回多边形检测框。此外，模型还新增了印章识别与文本行定位功能，并优化了生僻字、古籍及多语种表格的解析效果。</p>
<p>现在，您可以通过 PPIO 算力市场的 PaddleOCR-VL-1.5 模板，将该模型一键部署在 GPU 云服务器上。只需简单几步，即可快速体验模型高效的文档解析能力。</p>
<p>一键部署地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fppio.com%2Fgpu-instance%2Fconsole%2Fexplore" target="_blank" title="https://ppio.com/gpu-instance/console/explore" ref="nofollow noopener noreferrer">ppio.com/gpu-instanc…</a></p>
<h2 data-id="heading-0"><strong>01</strong> <strong>GPU</strong> <strong>实例+模板，一键部署 PaddleOCR-VL-1.5</strong></h2>
<p>step 1: 子模版市场选择对应模板，并使用此模板。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd03f508d2b74e8693cab4e39f2429cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUFBJT-a0vuasp-S6kQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770358120&amp;x-signature=9mtbC2dRv0WK4IPNXZtpN%2BqKNUs%3D" alt="" loading="lazy"/></p>
<p>step 2: 按照所需配置点击部署。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0e87bd7cd2a488985c4b039964c0587~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUFBJT-a0vuasp-S6kQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770358120&amp;x-signature=raP%2FxbmDjzNb7%2FgAZaV%2F9dABTU8%3D" alt="" loading="lazy"/></p>
<p>step 3: 检查磁盘大小等信息，确认无误后点击下一步。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb32914fe2f34809a0fe5f61c597f01c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUFBJT-a0vuasp-S6kQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770358120&amp;x-signature=Iu8%2FhQOdS%2FUQEGxWMM9NtlbLYrs%3D" alt="" loading="lazy"/></p>
<p>step 4: 稍等一会，实例创建需要一些时间。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eabf9ae3cb2841c591a53014221558fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUFBJT-a0vuasp-S6kQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770358120&amp;x-signature=0avppuVWfZXbFNSYIx6iJZyqy7I%3D" alt="" loading="lazy"/></p>
<p>step 5: 在实例管理里可以查看到所创建的实例。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a82015b09a6453b85784c17ce4e05ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUFBJT-a0vuasp-S6kQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770358120&amp;x-signature=I2wyCv%2FtCZEslTJRRM%2FTw5%2B2FXQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1"><strong>02 使用示例</strong></h2>
<h4 data-id="heading-2">第一步</h4>
<p>测试用例如下，后续将被命名为 test.py。</p>
<pre><code class="hljs language-ini" lang="ini">import base64
import requests
import pathlib

<span class="hljs-attr">API_URL</span> = <span class="hljs-string">"http://localhost:8080/layout-parsing"</span>  <span class="hljs-comment"># Service URL</span>

<span class="hljs-attr">image_path</span> = <span class="hljs-string">"./demo.jpg"</span>

<span class="hljs-comment"># Encode local image to Base64</span>
with open(image_path, "rb") as file:
    <span class="hljs-attr">image_bytes</span> = file.read()
    <span class="hljs-attr">image_data</span> = base64.b64encode(image_bytes).decode(<span class="hljs-string">"ascii"</span>)

<span class="hljs-attr">payload</span> = {
    "file": image_data,  <span class="hljs-comment"># Base64 encoded file content or file URL</span>
    "fileType": 1,  <span class="hljs-comment"># File type, 1 means image file</span>
}

<span class="hljs-comment"># Call the API</span>
<span class="hljs-attr">response</span> = requests.post(API_URL, json=payload)

<span class="hljs-comment"># Process the API response data</span>
assert <span class="hljs-attr">response.status_code</span> == <span class="hljs-number">200</span>
<span class="hljs-attr">result</span> = response.json()[<span class="hljs-string">"result"</span>]
for i, res in enumerate(result<span class="hljs-section">["layoutParsingResults"]</span>):
    print(res<span class="hljs-section">["prunedResult"]</span>)
    <span class="hljs-attr">md_dir</span> = pathlib.Path(f<span class="hljs-string">"markdown_{i}"</span>)
    md_dir.mkdir(<span class="hljs-attr">exist_ok</span>=<span class="hljs-literal">True</span>)
    (md_dir / "doc.md").write_text(res<span class="hljs-section">["markdown"]</span><span class="hljs-section">["text"]</span>)
    for img_path, img in res<span class="hljs-section">["markdown"]</span><span class="hljs-section">["images"]</span>.items():
        <span class="hljs-attr">img_path</span> = md_dir / img_path
        img_path.parent.mkdir(<span class="hljs-attr">parents</span>=<span class="hljs-literal">True</span>, exist_ok=<span class="hljs-literal">True</span>)
        img_path.write_bytes(base64.b64decode(img))
    print(f"Markdown document saved at {md_dir / 'doc.md'}")
    for img_name, img in res<span class="hljs-section">["outputImages"]</span>.items():
        <span class="hljs-attr">img_path</span> = f<span class="hljs-string">"{img_name}_{i}.jpg"</span>
        pathlib.Path(img_path).parent.mkdir(<span class="hljs-attr">exist_ok</span>=<span class="hljs-literal">True</span>)
        with open(img_path, "wb") as f:
            f.write(base64.b64decode(img))
        print(f"Output image saved at {img_path}")
</code></pre>
<h4 data-id="heading-3">第二步</h4>
<p>准备OCR所需的图片 这里使用的是官方案例</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FPaddlePaddle%2FPaddleOCR%2Fblob%2Fmain%2Ftests%2Ftest_files%2Fbook.jpg" target="_blank" title="https://github.com/PaddlePaddle/PaddleOCR/blob/main/tests/test_files/book.jpg" ref="nofollow noopener noreferrer">github.com/PaddlePaddl…</a></p>
<pre><code class="hljs language-bash" lang="bash">curl https://raw.githubusercontent.com/PaddlePaddle/PaddleOCR/main/tests/test_files/book.jpg -o demo.jpg 
复制端口映射地址并在 test.py 文件中替换 API URL
</code></pre>
<h4 data-id="heading-4">第三步</h4>
<p>运行 python test.py 检查输出结果</p>
<pre><code class="hljs language-lua" lang="lua">$ python test.py 
{<span class="hljs-string">'page_count'</span>: None, <span class="hljs-string">'width'</span>: <span class="hljs-number">1100</span>, <span class="hljs-string">'height'</span>: <span class="hljs-number">708</span>, <span class="hljs-string">'model_settings'</span>: {<span class="hljs-string">'use_doc_preprocessor'</span>: False, <span class="hljs-string">'use_layout_detection'</span>: True, <span class="hljs-string">'use_chart_recognition'</span>: False, <span class="hljs-string">'use_seal_recognition'</span>: False, <span class="hljs-string">'use_ocr_for_image_block'</span>: False, <span class="hljs-string">'format_block_content'</span>: False, <span class="hljs-string">'merge_layout_blocks'</span>: True, <span class="hljs-string">'markdown_ignore_labels'</span>: [<span class="hljs-string">'number'</span>, <span class="hljs-string">'footnote'</span>, <span class="hljs-string">'header'</span>, <span class="hljs-string">'header_image'</span>, <span class="hljs-string">'footer'</span>, <span class="hljs-string">'footer_image'</span>, <span class="hljs-string">'aside_text'</span>], <span class="hljs-string">'return_layout_polygon_points'</span>: True}, <span class="hljs-string">'parsing_res_list'</span>: [{<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">"chances of the lottery jachts are also use combination formulas to work out the chances of the other prizes, but it all starts to get a bit fiddly so we'll move on to something else. (How to work out the other lottery chances is just one of the amazing features you'll find at: www.murderousmaths.co.uk)"</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">180</span>, <span class="hljs-number">0</span>, <span class="hljs-number">512</span>, <span class="hljs-number">109</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">0</span>, <span class="hljs-string">'block_order'</span>: <span class="hljs-number">1</span>, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">0</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[180.0, 0.0], [512.0, 0.0], [512.0, 109.0], [180.0, 109.0]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'paragraph_title'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">'The disappearing sum'</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">180</span>, <span class="hljs-number">113</span>, <span class="hljs-number">310</span>, <span class="hljs-number">137</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">1</span>, <span class="hljs-string">'block_order'</span>: <span class="hljs-number">2</span>, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">1</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[179.04934692382812, 119.45269012451172], [308.8138122558594, 110.3464126586914], [310.1516418457031, 129.41043090820312], [180.38717651367188, 138.51669311523438]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">"It's Friday evening. The lovely Veronica Gumfloss has been out with the football team who have all escorted her safely back to her doorstep. It's that tender moment when each hopeful player closes his eyes and leans forward with quivering lips. Unfortunately Veronica's parents heard them clumping down the road and Veronica knows she only has time to kiss four out of the eleven of them if she's going to do it properly."</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">175</span>, <span class="hljs-number">126</span>, <span class="hljs-number">505</span>, <span class="hljs-number">289</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">2</span>, <span class="hljs-string">'block_order'</span>: <span class="hljs-number">3</span>, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">2</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[175, 137], [175, 281], [499, 285], [504, 134], [455, 126], [302, 126]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'image'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">''</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">179</span>, <span class="hljs-number">282</span>, <span class="hljs-number">491</span>, <span class="hljs-number">471</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">3</span>, <span class="hljs-string">'block_order'</span>: None, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">3</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[179.0, 282.0], [491.0, 282.0], [491.0, 471.0], [179.0, 471.0]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'vision_footnote'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">"How many choices has she got? It's  $ ^{11}C_{4} $ which is  $ ^{111}4l \times 7 $ but for goodness sake DON'T reach for the calculator! The most brilliant thing about perms and"</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">164</span>, <span class="hljs-number">455</span>, <span class="hljs-number">493</span>, <span class="hljs-number">531</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">4</span>, <span class="hljs-string">'block_order'</span>: None, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">4</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[164, 459], [164, 505], [345, 527], [492, 527], [492, 474], [377, 470], [323, 466], [246, 459], [207, 455], [170, 455]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'number'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">'94'</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">301</span>, <span class="hljs-number">546</span>, <span class="hljs-number">326</span>, <span class="hljs-number">563</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">5</span>, <span class="hljs-string">'block_order'</span>: None, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">5</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[301.0, 546.0], [325.0, 546.0], [325.0, 562.0], [301.0, 562.0]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">"means that EVERYTHING ON THE BOTTOM ALWAYS CANCELS OUT! It's probably the best fun you'll ever have with a pencil so here we go..."</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">552</span>, <span class="hljs-number">0</span>, <span class="hljs-number">892</span>, <span class="hljs-number">85</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">6</span>, <span class="hljs-string">'block_order'</span>: <span class="hljs-number">4</span>, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">6</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[552.6058349609375, -9.254895210266113], [895.4388427734375, 13.18508529663086], [890.72705078125, 85.17122650146484], [547.89404296875, 62.73124313354492]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'display_formula'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">' $$ \frac{11!}{4!\times7!}=\quad\frac{11\times10\times9\times8\times7\times6\times5\times4\times3\times2\times1}{4\times3\times2\times1\times7\times6\times5\times4\times3\times2\times1} $$ '</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">573</span>, <span class="hljs-number">74</span>, <span class="hljs-number">880</span>, <span class="hljs-number">128</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">7</span>, <span class="hljs-string">'block_order'</span>: <span class="hljs-number">5</span>, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">7</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[573, 89], [573, 109], [650, 113], [700, 117], [879, 127], [879, 96], [869, 92], [770, 85], [688, 78], [644, 74], [579, 74]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">"(Before we continue, grab this book and show somebody this sum. Rub their face on it if you need to and tell them that this is the sort of thing you do for fun without a calculator these days because you're so brilliant.)"</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">550</span>, <span class="hljs-number">123</span>, <span class="hljs-number">889</span>, <span class="hljs-number">219</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">8</span>, <span class="hljs-string">'block_order'</span>: <span class="hljs-number">6</span>, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">8</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[550, 123], [550, 204], [660, 208], [883, 218], [888, 141], [697, 127], [648, 123]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">"Off we go then. For starters we'll get rid of the 7! bit from top and bottom and get:"</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">549</span>, <span class="hljs-number">203</span>, <span class="hljs-number">887</span>, <span class="hljs-number">253</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">9</span>, <span class="hljs-string">'block_order'</span>: <span class="hljs-number">7</span>, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">9</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[549, 203], [549, 238], [886, 252], [886, 218], [792, 214], [676, 207]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'display_formula'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">' $$ \frac{11\times10\times9\times8}{4\times3\times2\times1} $$ '</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">677</span>, <span class="hljs-number">255</span>, <span class="hljs-number">769</span>, <span class="hljs-number">292</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">10</span>, <span class="hljs-string">'block_order'</span>: <span class="hljs-number">8</span>, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">10</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[677.0, 255.0], [769.0, 255.0], [769.0, 292.0], [677.0, 292.0]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">"Pow! That's already got rid of more than half the numbers. Next we'll see that the  $ 4 \times 2 $ on the bottom cancels out the 8 on top (and we don't need that “×1” on the bottom either). We're left with..."</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">547</span>, <span class="hljs-number">300</span>, <span class="hljs-number">886</span>, <span class="hljs-number">376</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">11</span>, <span class="hljs-string">'block_order'</span>: <span class="hljs-number">9</span>, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">11</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[547.0, 299.99993896484375], [886.40771484375, 307.02911376953125], [885.0, 375.0], [545.59228515625, 367.9708251953125]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'display_formula'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">' $$ \frac{11\times10\times9}{3} $$ '</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">685</span>, <span class="hljs-number">384</span>, <span class="hljs-number">756</span>, <span class="hljs-number">417</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">12</span>, <span class="hljs-string">'block_order'</span>: <span class="hljs-number">10</span>, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">12</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[685.0, 384.0], [756.0, 384.0], [756.0, 417.0], [685.0, 417.0]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">"Then the 3 on the bottom divides into the 9 on top leaving it as a 3 so all we've got now is:"</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">545</span>, <span class="hljs-number">429</span>, <span class="hljs-number">884</span>, <span class="hljs-number">468</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">13</span>, <span class="hljs-string">'block_order'</span>: <span class="hljs-number">11</span>, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">13</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[545.0, 429.0], [884.0, 429.0], [884.0, 468.0], [545.0, 468.0]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">"Veronica's choices = 11 × 10 × 3"</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">618</span>, <span class="hljs-number">477</span>, <span class="hljs-number">817</span>, <span class="hljs-number">496</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">14</span>, <span class="hljs-string">'block_order'</span>: <span class="hljs-number">12</span>, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">14</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[618.0, 477.0], [816.0, 477.0], [816.0, 495.0], [618.0, 495.0]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">'Look! No bottom.'</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">543</span>, <span class="hljs-number">508</span>, <span class="hljs-number">666</span>, <span class="hljs-number">529</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">15</span>, <span class="hljs-string">'block_order'</span>: <span class="hljs-number">13</span>, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">15</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[542.9999389648438, 508.0], [664.9999389648438, 508.0], [664.9999389648438, 528.0], [542.9999389648438, 528.0]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'number'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">'95'</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">705</span>, <span class="hljs-number">555</span>, <span class="hljs-number">729</span>, <span class="hljs-number">571</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">16</span>, <span class="hljs-string">'block_order'</span>: None, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">16</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[705.0, 555.0], [728.0, 555.0], [728.0, 570.0], [705.0, 570.0]]</span>}, {<span class="hljs-string">'block_label'</span>: <span class="hljs-string">'image'</span>, <span class="hljs-string">'block_content'</span>: <span class="hljs-string">''</span>, <span class="hljs-string">'block_bbox'</span>: [<span class="hljs-number">938</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1099</span>, <span class="hljs-number">647</span>], <span class="hljs-string">'block_id'</span>: <span class="hljs-number">17</span>, <span class="hljs-string">'block_order'</span>: None, <span class="hljs-string">'group_id'</span>: <span class="hljs-number">17</span>, <span class="hljs-string">'block_polygon_points'</span>: <span class="hljs-string">[[938.0, -2.0], [1099.0, -2.0], [1099.0, 647.0], [938.0, 647.0]]</span>}], <span class="hljs-string">'layout_det_res'</span>: {<span class="hljs-string">'boxes'</span>: [{<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">22</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.9220595955848694</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">180</span>, <span class="hljs-number">0</span>, <span class="hljs-number">512</span>, <span class="hljs-number">109</span>], <span class="hljs-string">'order'</span>: <span class="hljs-number">1</span>, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[180.0, 0.0], [512.0, 0.0], [512.0, 109.0], [180.0, 109.0]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">17</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'paragraph_title'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.8456085920333862</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">180</span>, <span class="hljs-number">113</span>, <span class="hljs-number">310</span>, <span class="hljs-number">137</span>], <span class="hljs-string">'order'</span>: <span class="hljs-number">2</span>, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[179.04934692382812, 119.45269012451172], [308.8138122558594, 110.3464126586914], [310.1516418457031, 129.41043090820312], [180.38717651367188, 138.51669311523438]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">22</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.9213816523551941</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">175</span>, <span class="hljs-number">126</span>, <span class="hljs-number">505</span>, <span class="hljs-number">289</span>], <span class="hljs-string">'order'</span>: <span class="hljs-number">3</span>, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[175, 137], [175, 281], [499, 285], [504, 134], [455, 126], [302, 126]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">14</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'image'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.9448813199996948</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">179</span>, <span class="hljs-number">282</span>, <span class="hljs-number">491</span>, <span class="hljs-number">471</span>], <span class="hljs-string">'order'</span>: None, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[179.0, 282.0], [491.0, 282.0], [491.0, 471.0], [179.0, 471.0]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">24</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'vision_footnote'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.8173566460609436</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">164</span>, <span class="hljs-number">455</span>, <span class="hljs-number">493</span>, <span class="hljs-number">531</span>], <span class="hljs-string">'order'</span>: None, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[164, 459], [164, 505], [345, 527], [492, 527], [492, 474], [377, 470], [323, 466], [246, 459], [207, 455], [170, 455]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">16</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'number'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.7621420621871948</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">301</span>, <span class="hljs-number">546</span>, <span class="hljs-number">326</span>, <span class="hljs-number">563</span>], <span class="hljs-string">'order'</span>: <span class="hljs-number">4</span>, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[301.0, 546.0], [325.0, 546.0], [325.0, 562.0], [301.0, 562.0]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">22</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.913713276386261</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">552</span>, <span class="hljs-number">0</span>, <span class="hljs-number">892</span>, <span class="hljs-number">85</span>], <span class="hljs-string">'order'</span>: <span class="hljs-number">5</span>, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[552.6058349609375, -9.254895210266113], [895.4388427734375, 13.18508529663086], [890.72705078125, 85.17122650146484], [547.89404296875, 62.73124313354492]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">5</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'display_formula'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.8774852156639099</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">573</span>, <span class="hljs-number">74</span>, <span class="hljs-number">880</span>, <span class="hljs-number">128</span>], <span class="hljs-string">'order'</span>: <span class="hljs-number">6</span>, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[573, 89], [573, 109], [650, 113], [700, 117], [879, 127], [879, 96], [869, 92], [770, 85], [688, 78], [644, 74], [579, 74]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">22</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.9250841736793518</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">550</span>, <span class="hljs-number">123</span>, <span class="hljs-number">889</span>, <span class="hljs-number">219</span>], <span class="hljs-string">'order'</span>: <span class="hljs-number">7</span>, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[550, 123], [550, 204], [660, 208], [883, 218], [888, 141], [697, 127], [648, 123]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">22</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.8921533823013306</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">549</span>, <span class="hljs-number">203</span>, <span class="hljs-number">887</span>, <span class="hljs-number">253</span>], <span class="hljs-string">'order'</span>: <span class="hljs-number">8</span>, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[549, 203], [549, 238], [886, 252], [886, 218], [792, 214], [676, 207]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">5</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'display_formula'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.7999240159988403</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">677</span>, <span class="hljs-number">255</span>, <span class="hljs-number">769</span>, <span class="hljs-number">292</span>], <span class="hljs-string">'order'</span>: <span class="hljs-number">9</span>, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[677.0, 255.0], [769.0, 255.0], [769.0, 292.0], [677.0, 292.0]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">22</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.9141753315925598</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">547</span>, <span class="hljs-number">300</span>, <span class="hljs-number">886</span>, <span class="hljs-number">376</span>], <span class="hljs-string">'order'</span>: <span class="hljs-number">10</span>, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[547.0, 299.99993896484375], [886.40771484375, 307.02911376953125], [885.0, 375.0], [545.59228515625, 367.9708251953125]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">5</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'display_formula'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.849932074546814</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">685</span>, <span class="hljs-number">384</span>, <span class="hljs-number">756</span>, <span class="hljs-number">417</span>], <span class="hljs-string">'order'</span>: <span class="hljs-number">11</span>, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[685.0, 384.0], [756.0, 384.0], [756.0, 417.0], [685.0, 417.0]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">22</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.8802617192268372</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">545</span>, <span class="hljs-number">429</span>, <span class="hljs-number">884</span>, <span class="hljs-number">468</span>], <span class="hljs-string">'order'</span>: <span class="hljs-number">12</span>, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[545.0, 429.0], [884.0, 429.0], [884.0, 468.0], [545.0, 468.0]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">22</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.7239603400230408</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">618</span>, <span class="hljs-number">477</span>, <span class="hljs-number">817</span>, <span class="hljs-number">496</span>], <span class="hljs-string">'order'</span>: <span class="hljs-number">13</span>, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[618.0, 477.0], [816.0, 477.0], [816.0, 495.0], [618.0, 495.0]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">22</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'text'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.8236865997314453</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">543</span>, <span class="hljs-number">508</span>, <span class="hljs-number">666</span>, <span class="hljs-number">529</span>], <span class="hljs-string">'order'</span>: <span class="hljs-number">14</span>, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[542.9999389648438, 508.0], [664.9999389648438, 508.0], [664.9999389648438, 528.0], [542.9999389648438, 528.0]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">16</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'number'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.552054762840271</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">705</span>, <span class="hljs-number">555</span>, <span class="hljs-number">729</span>, <span class="hljs-number">571</span>], <span class="hljs-string">'order'</span>: <span class="hljs-number">15</span>, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[705.0, 555.0], [728.0, 555.0], [728.0, 570.0], [705.0, 570.0]]</span>}, {<span class="hljs-string">'cls_id'</span>: <span class="hljs-number">14</span>, <span class="hljs-string">'label'</span>: <span class="hljs-string">'image'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0.8069510459899902</span>, <span class="hljs-string">'coordinate'</span>: [<span class="hljs-number">938</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1099</span>, <span class="hljs-number">647</span>], <span class="hljs-string">'order'</span>: None, <span class="hljs-string">'polygon_points'</span>: <span class="hljs-string">[[938.0, -2.0], [1099.0, -2.0], [1099.0, 647.0], [938.0, 647.0]]</span>}]}}
Markdown document saved at markdown_0/doc.md
Output image saved at layout_det_res_0.jpg
</code></pre>
<p>PPIO 的算力市场模板致力于帮助企业及个人开发者降低大模型私有化部署的门槛，无需繁琐的环境配置，即可实现高效、安全的模型落地。</p>
<p>目前，PPIO算力市场已上线几十个私有化部署模板，除了 PaddleOCR-VL-1.5，你也可以将DeepSeek-OCR-2、AutoGLM-Phone-9B、 GLM-Image、PaddleOCR-VL 等模型快速进行私有化部署。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何基于瑞芯微芯片的Linux Sdk开发应用]]></title>    <link>https://juejin.cn/post/7600709805469351979</link>    <guid>https://juejin.cn/post/7600709805469351979</guid>    <pubDate>2026-01-30T05:50:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600709805469351979" data-draft-id="7600760073007382582" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何基于瑞芯微芯片的Linux Sdk开发应用"/> <meta itemprop="keywords" content="嵌入式"/> <meta itemprop="datePublished" content="2026-01-30T05:50:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="YF0211"/> <meta itemprop="url" content="https://juejin.cn/user/2576910988619064"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何基于瑞芯微芯片的Linux Sdk开发应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2576910988619064/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    YF0211
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T05:50:35.000Z" title="Fri Jan 30 2026 05:50:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h5 data-id="heading-0">RV1126B 系列</h5>
<h2 data-id="heading-1">1、创建工程</h2>
<pre><code class="hljs language-bash" lang="bash">   <span class="hljs-built_in">cd</span> project/app
   <span class="hljs-built_in">mkdir</span> demo/
   <span class="hljs-built_in">cd</span> demo/
   <span class="hljs-built_in">mkdir</span> src
   <span class="hljs-built_in">cd</span>  /src
   <span class="hljs-built_in">touch</span> xxx.h
   <span class="hljs-built_in">touch</span> xxx.c
</code></pre>
<h2 data-id="heading-2">2、创建配置文件</h2>
<pre><code class="hljs language-bash" lang="bash">   <span class="hljs-built_in">cd</span> project/buildroot/package
   <span class="hljs-built_in">mkdir</span> demo
   <span class="hljs-built_in">touch</span> Config.<span class="hljs-keyword">in</span>
   <span class="hljs-built_in">touch</span> demo.mk
</code></pre>
<p>Config.in参照规则写，如</p>
<pre><code class="hljs language-arduino" lang="arduino">   config BR2_PACKAGE_DEMO
    <span class="hljs-type">bool</span> <span class="hljs-string">"demo"</span>
    <span class="hljs-keyword">default</span> y
    help
      JT/T <span class="hljs-number">808</span> position report demo <span class="hljs-keyword">for</span> RV1126B
</code></pre>
<p>demo.mk参照规则写，如</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">DEMO_VERSION</span> = <span class="hljs-number">1.0</span>
<span class="hljs-selector-tag">DEMO_SITE</span> = $(TOPDIR)/../<span class="hljs-selector-tag">app</span>/<span class="hljs-selector-tag">demo</span>
<span class="hljs-selector-tag">DEMO_SITE_METHOD</span> = <span class="hljs-selector-tag">local</span>

<span class="hljs-selector-tag">define</span> <span class="hljs-selector-tag">DEMO_BUILD_CMDS</span>
    $(TARGET_CC) $(TARGET_CFLAGS) $(TARGET_LDFLAGS) <span class="hljs-selector-tag">-o</span> $(<span class="hljs-variable">@D</span>)/<span class="hljs-selector-tag">demo</span> \
        $(<span class="hljs-variable">@D</span>)/<span class="hljs-selector-tag">src</span>/<span class="hljs-selector-tag">xxx</span><span class="hljs-selector-class">.c</span>  \
        <span class="hljs-selector-tag">-lpthread</span> <span class="hljs-selector-tag">-lm</span>
<span class="hljs-selector-tag">endef</span>

<span class="hljs-selector-tag">define</span> <span class="hljs-selector-tag">DEMO_INSTALL_TARGET_CMDS</span>
    $(INSTALL) <span class="hljs-selector-tag">-D</span> <span class="hljs-selector-tag">-m</span> <span class="hljs-number">0755</span> $(<span class="hljs-variable">@D</span>)/<span class="hljs-selector-tag">demo</span> $(TARGET_DIR)/<span class="hljs-selector-tag">usr</span>/<span class="hljs-selector-tag">bin</span>/<span class="hljs-selector-tag">demo</span>
    $(INSTALL) <span class="hljs-selector-tag">-d</span> <span class="hljs-selector-tag">-m</span> <span class="hljs-number">0755</span> $(TARGET_DIR)/<span class="hljs-selector-tag">data</span>/<span class="hljs-selector-tag">demo_cache</span>
<span class="hljs-selector-tag">endef</span>

$(eval $(generic-package))
</code></pre>
<h2 data-id="heading-3">3、编译</h2>
<pre><code class="hljs language-go" lang="go">cd buildroot
<span class="hljs-built_in">make</span> demo
<span class="hljs-built_in">make</span> demo-dirclean
</code></pre>
<p>也可以手动编译:</p>
<pre><code class="hljs language-css" lang="css">aarch64-<span class="hljs-attribute">none</span>-linux-gnu-gcc -O2 -Wall xxx<span class="hljs-selector-class">.c</span>  -o demo -lpthread -lm
</code></pre>
<p>验证产物：</p>
<pre><code class="hljs">file demo
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Kotlin Flow 的协程边界突破：channelFlow 与 callbackFlow 的实战解析]]></title>    <link>https://juejin.cn/post/7600704706551726120</link>    <guid>https://juejin.cn/post/7600704706551726120</guid>    <pubDate>2026-01-30T06:37:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600704706551726120" data-draft-id="7600681071715368960" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Kotlin Flow 的协程边界突破：channelFlow 与 callbackFlow 的实战解析"/> <meta itemprop="keywords" content="Kotlin,Android Jetpack,Android"/> <meta itemprop="datePublished" content="2026-01-30T06:37:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="QING618"/> <meta itemprop="url" content="https://juejin.cn/user/339115460529117"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Kotlin Flow 的协程边界突破：channelFlow 与 callbackFlow 的实战解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/339115460529117/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    QING618
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T06:37:25.000Z" title="Fri Jan 30 2026 06:37:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、为什么在普通 Flow 中从另一个协程发射会失败？</h2>
<h4 data-id="heading-1">1. 普通 Flow 是顺序的、同步的</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">simpleFlow</span><span class="hljs-params">()</span></span>: Flow&lt;<span class="hljs-built_in">Int</span>&gt; = flow {
    <span class="hljs-comment">// 正确：在同一个协程中发射</span>
    emit(<span class="hljs-number">1</span>)
    
    <span class="hljs-comment">// 错误：不能在另一个协程中发射</span>
    launch(Dispatchers.IO) {
        <span class="hljs-comment">// emit(2) // 编译错误：emit 只能在 flow builder 的协程中调用</span>
    }
}
</code></pre>
<p>原因：普通 Flow 的 <code>emit()</code> 函数不是线程安全的，且必须在同一个协程上下文中调用。</p>
<h4 data-id="heading-2">2. 结构化并发约束</h4>
<p>普通 Flow 遵守结构化并发原则：当收集器取消时，整个 flow 构建器块都会被取消。如果允许在外部协程发射，难以追踪和管理所有发射源的取消。</p>
<h2 data-id="heading-3">二、ChannelFlow 解决了什么问题？</h2>
<h4 data-id="heading-4">ChannelFlow 的核心价值：跨协程发射</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">channelFlowExample</span><span class="hljs-params">()</span></span>: Flow&lt;<span class="hljs-built_in">Int</span>&gt; = channelFlow {
    <span class="hljs-comment">// 可以在多个协程中并发发射</span>
    launch {
        <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.5</span>) {
            send(i) <span class="hljs-comment">// 使用 send 而不是 emit</span>
            delay(<span class="hljs-number">100</span>)
        }
    }
    
    launch {
        <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">6.</span><span class="hljs-number">.10</span>) {
            send(i)
            delay(<span class="hljs-number">150</span>)
        }
    }
    
    <span class="hljs-comment">// 等待所有发射完成</span>
    awaitClose()
}
</code></pre>
<h4 data-id="heading-5">解决的问题：</h4>
<h4 data-id="heading-6">1.  并发数据源整合</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">mergeMultipleSources</span><span class="hljs-params">()</span></span>: Flow&lt;String&gt; = channelFlow {
    <span class="hljs-comment">// 多个异步数据源</span>
    <span class="hljs-keyword">val</span> sources = listOf(
        async { fetchFromNetwork() },
        async { readFromDatabase() },
        async { getFromCache() }
    )
    
    sources.forEach { deferred -&gt;
        launch {
            <span class="hljs-keyword">val</span> result = deferred.await()
            result.forEach { item -&gt;
                send(item)
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-7">2.  生产者-消费者模式</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">producerConsumer</span><span class="hljs-params">()</span></span>: Flow&lt;Data&gt; = channelFlow {
    <span class="hljs-keyword">val</span> channel = <span class="hljs-keyword">this</span>.channel <span class="hljs-comment">// 获取底层的 Channel</span>
    
    <span class="hljs-comment">// 生产者协程</span>
    launch(Dispatchers.IO) {
        <span class="hljs-keyword">while</span> (isActive) {
            <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span> = produceData()
            send(<span class="hljs-keyword">data</span>)
        }
    }
    
    <span class="hljs-comment">// 另一个生产者</span>
    launch(Dispatchers.Default) {
        processAndSendResults()
    }
}
</code></pre>
<h2 data-id="heading-8">三、CallbackFlow 解决了什么问题？</h2>
<h4 data-id="heading-9">CallbackFlow 的特殊用途：桥接回调API</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">listenToLocationUpdates</span><span class="hljs-params">()</span></span>: Flow&lt;Location&gt; = callbackFlow {
    <span class="hljs-keyword">val</span> callback = <span class="hljs-keyword">object</span> : LocationCallback() {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onLocationResult</span><span class="hljs-params">(result: <span class="hljs-type">LocationResult</span>)</span></span> {
            result.locations.forEach { location -&gt;
                trySend(location) <span class="hljs-comment">// 非阻塞式发送</span>
            }
        }
    }
    
    <span class="hljs-comment">// 注册回调</span>
    locationClient.requestLocationUpdates(
        request,
        callback,
        Looper.getMainLooper()
    )
    
    <span class="hljs-comment">// 关键：当流被取消时，自动清理资源</span>
    awaitClose {
        locationClient.removeLocationUpdates(callback)
    }
}
</code></pre>
<h4 data-id="heading-10">解决的问题：</h4>
<h4 data-id="heading-11">1. 回调API的Flow化</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 传统回调 → Flow 转换</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">EventListener</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onEvent</span><span class="hljs-params">(event: <span class="hljs-type">Event</span>)</span></span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(error: <span class="hljs-type">Throwable</span>)</span></span>
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">listenToEvents</span><span class="hljs-params">()</span></span>: Flow&lt;Event&gt; = callbackFlow {
    <span class="hljs-keyword">val</span> listener = <span class="hljs-keyword">object</span> : EventListener {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onEvent</span><span class="hljs-params">(event: <span class="hljs-type">Event</span>)</span></span> {
            trySend(event)
        }
        
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(error: <span class="hljs-type">Throwable</span>)</span></span> {
            close(error)
        }
    }
    
    registerListener(listener)
    
    awaitClose {
        unregisterListener(listener)
    }
}
</code></pre>
<h4 data-id="heading-12">2. 生命周期管理</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">observeAndroidLifecycle</span><span class="hljs-params">()</span></span>: Flow&lt;Lifecycle.State&gt; = callbackFlow {
    <span class="hljs-keyword">val</span> observer = LifecycleEventObserver { _, event -&gt;
        <span class="hljs-keyword">when</span> (event) {
            Lifecycle.Event.ON_RESUME -&gt; trySend(Lifecycle.State.RESUMED)
            Lifecycle.Event.ON_PAUSE -&gt; trySend(Lifecycle.State.STARTED)
            <span class="hljs-comment">// ... 其他状态</span>
        }
    }
    
    lifecycle.addObserver(observer)
    
    awaitClose {
        lifecycle.removeObserver(observer)
    }
}
</code></pre>
<h2 data-id="heading-13">四、底层原理对比</h2>









































<table><thead><tr><th>特性</th><th>普通 Flow</th><th>ChannelFlow</th><th>CallbackFlow</th></tr></thead><tbody><tr><td>发射上下文</td><td>必须相同协程</td><td>可跨协程</td><td>可跨协程</td></tr><tr><td>线程安全</td><td>否</td><td>是</td><td>是</td></tr><tr><td>缓冲区</td><td>无</td><td>可配置缓冲区</td><td>可配置缓冲区</td></tr><tr><td>适用场景</td><td>同步/简单异步</td><td>并发数据源</td><td>回调API集成</td></tr><tr><td>取消传播</td><td>自动</td><td>手动管理</td><td>自动清理</td></tr></tbody></table>
<h2 data-id="heading-14">五、实际应用示例</h2>
<h4 data-id="heading-15">示例1：WebSocket 连接</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">connectWebSocket</span><span class="hljs-params">(url: <span class="hljs-type">String</span>)</span></span>: Flow&lt;Message&gt; = callbackFlow {
    <span class="hljs-keyword">val</span> webSocket = WebSocketClient(url, <span class="hljs-keyword">object</span> : WebSocketListener() {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onMessage</span><span class="hljs-params">(message: <span class="hljs-type">String</span>)</span></span> {
            trySend(Message.Text(message))
        }
        
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onClose</span><span class="hljs-params">(code: <span class="hljs-type">Int</span>, reason: <span class="hljs-type">String</span>?)</span></span> {
            close(ClosedException(code, reason))
        }
    })
    
    webSocket.connect()
    
    awaitClose {
        webSocket.disconnect()
    }
}
</code></pre>
<h4 data-id="heading-16">示例2：传感器数据流</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">sensorDataFlow</span><span class="hljs-params">(sensor: <span class="hljs-type">Sensor</span>)</span></span>: Flow&lt;SensorData&gt; = channelFlow {
    <span class="hljs-keyword">val</span> sensorManager = getSensorManager()
    
    <span class="hljs-comment">// 在主线程注册监听器</span>
    launch(Dispatchers.Main) {
        sensorManager.registerListener(
            { event -&gt;
                launch(Dispatchers.Default) {
                    <span class="hljs-comment">// 在后台线程处理并发送</span>
                    <span class="hljs-keyword">val</span> processed = processSensorEvent(event)
                    send(processed)
                }
            },
            sensor,
            SensorManager.SENSOR_DELAY_NORMAL
        )
    }
    
    awaitClose {
        sensorManager.unregisterListener()
    }
}
</code></pre>
<h2 data-id="heading-17">六、关键要点</h2>
<h4 data-id="heading-18">1.  ChannelFlow：</h4>
<ul>
<li>用于需要从多个协程并发发射数据的场景</li>
<li>提供了底层的 Channel 作为缓冲区</li>
<li>需要手动处理并发和完成信号</li>
</ul>
<h4 data-id="heading-19">2.  CallbackFlow：</h4>
<ul>
<li>专门用于包装回调式 API</li>
<li>自动处理资源清理（通过 <code>awaitClose</code>）</li>
<li>使用 <code>trySend</code> 避免阻塞</li>
</ul>
<h4 data-id="heading-20">3.  为什么需要它们：</h4>
<ul>
<li>打破普通 Flow 的"单协程发射"限制</li>
<li>支持与现有的异步 API（回调、监听器）集成</li>
<li>提供更灵活的生产者-消费者模式</li>
<li>更好的资源管理和生命周期控制</li>
</ul>
<p>选择哪个取决于具体需求：如果是处理并发数据源，用 <code>channelFlow</code>；如果是包装回调 API，用 <code>callbackFlow</code>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Moltbot(Clawdbot)对接本地大模型完整配置指南]]></title>    <link>https://juejin.cn/post/7600562816458784810</link>    <guid>https://juejin.cn/post/7600562816458784810</guid>    <pubDate>2026-01-29T10:31:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600562816458784810" data-draft-id="7600469605477007402" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Moltbot(Clawdbot)对接本地大模型完整配置指南"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-29T10:31:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="赵刚在掘金"/> <meta itemprop="url" content="https://juejin.cn/user/3034307823410862"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Moltbot(Clawdbot)对接本地大模型完整配置指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3034307823410862/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    赵刚在掘金
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T10:31:13.000Z" title="Thu Jan 29 2026 10:31:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a09bf65f21504390bbb7acac6131a255~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=Ra6kce0jQNrJbx%2BSGWCUhuTAHFA%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">Moltbot(Clawdbot)对接本地大模型完整配置指南</h2>
<p>近期，开源AI智能体Moltbot（原名Clawdbot）凭借“可执行、可扩展、本地化”的特性爆火开源圈，GitHub星标快速飙升至95k+，被不少开发者称为“个人开源贾维斯”。不同于传统只能聊天的AI助手，Moltbot具备完整的“手、脚、脑”能力，既能对接云端API，更能适配本地大模型部署，完美解决数据隐私保护与离线使用需求。本文将从Moltbot核心能力、演示效果入手，一步步带你完成从环境搭建到本地大模型对接的全流程配置，新手也能轻松上手。</p>
<h3 data-id="heading-1">一、Moltbot(Clawdbot)核心能力与演示效果</h3>
<h4 data-id="heading-2">1.1 核心能力解析</h4>
<p>Moltbot（原Clawdbot）是一款开源个人AI助手框架，核心定位是“连接AI大模型与本地系统的桥梁”，通过Gateway网关架构，实现从自然语言指令到实际任务执行的完整闭环。其核心能力可概括为“手、脚、脑”三大模块，兼顾实用性与扩展性：</p>
<p>“手”——本地执行能力：可直接读写电脑本地文件、执行终端代码、操控命令行，支持批量处理文件、自动化脚本运行等场景，无需手动操作即可完成复杂本地任务。</p>
<p>“脚”——联网交互能力：可自主联网搜索、访问网页并分析内容，支持提取网页关键信息、同步网络数据，打破本地资源限制，实现“在线获取+本地执行”的联动。</p>
<p>“脑”——灵活适配能力：支持对接OpenAI、Qwen、MiniMax、GLM等主流云端API，更能适配本地大模型（如Llama 3、Qwen本地版、GLM4.7等），数据全程在本地流转，兼顾隐私安全与离线使用需求。</p>
<p>除此之外，Moltbot还具备可扩展的技能系统、多渠道交互（Telegram、Slack等）、本地记忆存储等特性，支持自定义Agent和插件开发，面向技术极客、隐私敏感用户和开发者群体，可根据需求灵活定制。</p>
<h4 data-id="heading-3">1.2 演示效果展示</h4>
<p>本文作为Molbot的入门教程，重点在基于“Moltbot + 本地qwen3-30b-a3b大模型”部署完整运行程序。以下是简单的让Molbot写一篇日记。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30e768ea29f1478fad0ab2b689dc8f80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=jaSbVY52uxax6uhhitRLW8QjMtE%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-4">二、前置说明与环境准备</h3>
<h4 data-id="heading-5">2.1 前置说明</h4>
<ol>
<li>
<p>系统兼容：本文以ubuntu系统为例（macOS、windows流程类似参考官方文档）；</p>
</li>
<li>
<p>硬件要求：对接本地大模型需满足基础硬件条件——CPU≥8核、内存≥16GB（推荐32GB），大模型是Nvidia 4090 8卡机器单独部署的；</p>
</li>
<li>
<p>核心依赖：Moltbot运行依赖Node.js环境（版本≥v22.0.0，推荐v22.x或v24.x稳定版），本地大模型需提前部署完成（本文以qwen3-30b-a3b本地版为例）；</p>
</li>
</ol>
<h4 data-id="heading-6">2.2 环境准备（必做）</h4>
<h5 data-id="heading-7">2.2.1 部署本地大模型（以qwen3-30b-a3b为例）</h5>
<ol>
<li>
<p>下载模型：从阿里云ModelScope、Hugging Face等平台下载qwen3-30b-a3b本地模型；</p>
</li>
<li>
<p>部署模型：本文使用gpustack完成本地大模型部署，确保模型可正常运行，并记录模型部署后的本地接口地址（如<a href="https://link.juejin.cn?target=http%3A%2F%2F127.0.0.1%3A8080%2Fv1%25EF%25BC%258C%25E5%2590%258E%25E7%25BB%25AD%25E5%25AF%25B9%25E6%258E%25A5%25E9%259C%2580%25E7%2594%25A8%25E5%2588%25B0%25EF%25BC%2589%25E5%2592%258Capikey%25EF%25BC%2588gpustack__xxxxx%25EF%25BC%2589%25EF%25BC%259B" target="_blank" title="http://127.0.0.1:8080/v1%EF%BC%8C%E5%90%8E%E7%BB%AD%E5%AF%B9%E6%8E%A5%E9%9C%80%E7%94%A8%E5%88%B0%EF%BC%89%E5%92%8Capikey%EF%BC%88gpustack__xxxxx%EF%BC%89%EF%BC%9B" ref="nofollow noopener noreferrer">http://127.0.0.1:8080/v1，后续对接需用到）和apikey（gpustack__xxxxx）；</a></p>
</li>
<li>
<p>测试模型：打开浏览器或终端，访问本地模型接口，发送简单对话指令（如“你好”），若能正常接收响应，说明本地大模型部署成功。</p>
</li>
</ol>
<h5 data-id="heading-8">2.2.2 安装Moltbot</h5>
<p>从github下载最新源码<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmoltbot%2Fmoltbot%25E3%2580%2582%25E4%25B8%258B%25E8%25BD%25BD%25E5%2588%25B0ubuntu%25E6%259C%258D%25E5%258A%25A1%25E5%2599%25A8%25E5%2590%258E%25E8%25A7%25A3%25E5%258E%258B%25E7%25BC%25A9%25E3%2580%2582%25E7%2584%25B6%25E5%2590%258E%25E6%2589%25A7%25E8%25A1%258C%25E4%25B8%258B%25E9%259D%25A2%25E7%259A%2584%25E5%25AE%2589%25E8%25A3%2585%25E5%2591%25BD%25E4%25BB%25A4%25E3%2580%2582" target="_blank" title="https://github.com/moltbot/moltbot%E3%80%82%E4%B8%8B%E8%BD%BD%E5%88%B0ubuntu%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%8E%E8%A7%A3%E5%8E%8B%E7%BC%A9%E3%80%82%E7%84%B6%E5%90%8E%E6%89%A7%E8%A1%8C%E4%B8%8B%E9%9D%A2%E7%9A%84%E5%AE%89%E8%A3%85%E5%91%BD%E4%BB%A4%E3%80%82" ref="nofollow noopener noreferrer">github.com/moltbot/mol…</a>
<span href="https://code.juejin.cn/pen/7600715127625383986" class="code-editor-container"><iframe class="code-editor-frame" data-code="code-editor-element" data-code-id="7600715127625383986" data-src="https://code.juejin.cn/pen/7600715127625383986" style="display:none;" loading="lazy"/><span class="loading-placeholder" style="display:none"><img class="placeholder-image" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAJElEQVRoge3BMQEAAADCoPVP7WkJoAAAAAAAAAAAAAAAAAAAbjh8AAFte11jAAAAAElFTkSuQmCC" loading="lazy"/><span class="loading-logo"/></span></span></p>
<p>执行安装命令时候会弹出下面截图：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/571add5b9a894deea2cda6ba7bfbb3dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=vvQpBDXyycm3o3i0oAS8PJiYHgo%3D" alt="image.png" loading="lazy"/>
按n或其他键则安装结束，按y表示同意继续安装；选择安装模式，</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c679b479889643849908d39d23105e95~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=KEKDD9Jom63YSXqsfVDyJGUppoU%3D" alt="image.png" loading="lazy"/>
第一个是快速开始，第二个是手动配置，选择第一个回车；然后让你配置一个模型。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62ea173b31c94eaa86fccc1302481352~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=OdWPr7cAguksycu4%2BmeSPVHZtAw%3D" alt="image.png" loading="lazy"/></p>
<p>列的国内外模型都需要收费的key和认证，本文对接本地大模型，选择最后一个Skip for now。接下来选择channel，</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b2400cc258f4f0d98449855c9660bc7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=Fek1v4f3Q7K%2BQxYx31xstkVTfcw%3D" alt="image.png" loading="lazy"/></p>
<p>都是国外的app用不了，选择Skip for now；</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44866c2a239549f9a60208128918078c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=L0Xa07kMsoApvQRfT2NfCdyBDPU%3D" alt="image.png" loading="lazy"/></p>
<p>然后选择技能安装配置都是yes，最后选择安装技能用npm。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46fbaf5059854b19896f3bf33d20b851~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=AEvONj3vzXHLhoj5y%2FBnG3V6AwU%3D" alt="image.png" loading="lazy"/></p>
<p>然后让你安装 skill，这些技能也可以选择先不安装，后面用到的时候，会自行安装，所以也可以选择 Skip for now 跳过。空格选中复选框，回车下一步。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22268ebcabd2420ba5a197e0abe89903~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=LZtr1mjfa3octud%2F2ZF1II1nRAw%3D" alt="image.png" loading="lazy"/></p>
<p>google和sag的配置都需要外网，选择no，不设置。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bec79f34300444849e0dc4003a6c343b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=TLL0Hz3FL2nwC26Az2gl9VIBFr0%3D" alt="image.png" loading="lazy"/></p>
<p>然后会看到是否启动 hooks，这里可以把这 3 个都选上，启动下。
至此，初步安装就完成了，会看到屏幕出现访问地址。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd4799b425214ab58b07540d58ddc397~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=9JudD7erjM3d2L1uQViKb5jIBiA%3D" alt="image.png" loading="lazy"/></p>
<p>在本机curl命令curl <a href="https://link.juejin.cn?target=http%3A%2F%2F127.0.0.1%3A18789%2Fchat" target="_blank" title="http://127.0.0.1:18789/chat" ref="nofollow noopener noreferrer">http://127.0.0.1:18789/chat</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b50e1dcc0ad4e6da7e6052575994511~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=jjlZyEKG5hyQ89ODDbvijYs%2FGZk%3D" alt="image.png" loading="lazy"/>
可以看到有结果返回。表示启动正常。但是通过外网ip端口发下无法访问。经过查询官方文档需要打开配置gateway.bind为lan局域网。配置文件的默认位置在~/.clawdbot/clawdbot.json。在配置文件中添加配置。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b09ce60fb79b4d6aa3b0edd91a8a0418~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=izcYSf8EcrnyxDI75%2BqRjA9DaTg%3D" alt="image.png" loading="lazy"/></p>
<p>再次通过服务器ip和端口发下可以访问页面。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6995f1d2dbb344e79f905e0ed92087e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=0n7ExPbepIcVy8ZSxgRDRYbLLKA%3D" alt="image.png" loading="lazy"/>
接下来在chat页面对话时候发现连接失败报错。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/603a3f080b504a599af93d3a01aa2a78~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=94RFkk%2BuIGMkxiFXeyi0tEK9pXM%3D" alt="image.png" loading="lazy"/>
打开Overview测试连接发现右侧提示连接失败，Gateway Token需要填写和配置文件中的gateway.auth.token保持一致，并且设置gateway.controlUi.allowInsecureAuth设置为ture允许http连接。注意此处只是测试环境，生产环境建议开启https安全认证。</p>
<p>到这一步发现能够连接成功，但是对话无返回结果。</p>
<h5 data-id="heading-9">2.2.3 修改源码和配置支持本地大模型</h5>
<p>找到安装路径下的model.js文件，我服务器的路径为/xxx/moltbot-2026.1.24/dist/agents/pi-embedded-runner。
注释掉原有的if判断添加改造后的代码。
<span href="https://code.juejin.cn/pen/7600726274134589481" class="code-editor-container"><iframe class="code-editor-frame" data-code="code-editor-element" data-code-id="7600726274134589481" data-src="https://code.juejin.cn/pen/7600726274134589481" style="display:none;" loading="lazy"/><span class="loading-placeholder" style="display:none"><img class="placeholder-image" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAJElEQVRoge3BMQEAAADCoPVP7WkJoAAAAAAAAAAAAAAAAAAAbjh8AAFte11jAAAAAElFTkSuQmCC" loading="lazy"/><span class="loading-logo"/></span></span></p>
<p>修改~/.clawdbot/clawdbot.json，指定本地大模型。
<span href="https://code.juejin.cn/pen/7600726708367179786" class="code-editor-container"><iframe class="code-editor-frame" data-code="code-editor-element" data-code-id="7600726708367179786" data-src="https://code.juejin.cn/pen/7600726708367179786" style="display:none;" loading="lazy"/><span class="loading-placeholder" style="display:none"><img class="placeholder-image" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAJElEQVRoge3BMQEAAADCoPVP7WkJoAAAAAAAAAAAAAAAAAAAbjh8AAFte11jAAAAAElFTkSuQmCC" loading="lazy"/><span class="loading-logo"/></span></span></p>
<p>到此，在对话页面可以进行正常问答。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b730fe4b1834435fbd42f72613998b97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LW15Yia5Zyo5o6Y6YeR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770287472&amp;x-signature=Re9CZWuoBAhHgWGCevD5CNh9j3Q%3D" alt="image.png" loading="lazy"/></p>
<p>附属参考的帖子</p>
<ul>
<li>官网（<a href="https://link.juejin.cn?target=https%3A%2F%2Fclawd.bot%2F%25EF%25BC%2589" target="_blank" title="https://clawd.bot/%EF%BC%89" ref="nofollow noopener noreferrer">clawd.bot/）</a></li>
<li>github（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmoltbot%2Fmoltbot%25EF%25BC%2589" target="_blank" title="https://github.com/moltbot/moltbot%EF%BC%89" ref="nofollow noopener noreferrer">github.com/moltbot/mol…</a></li>
<li>官方文档（<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.molt.bot%2F%25EF%25BC%2589" target="_blank" title="https://docs.molt.bot/%EF%BC%89" ref="nofollow noopener noreferrer">docs.molt.bot/）</a></li>
<li>对接deepseek（<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nodeseek.com%2Fpost-599173-1%25EF%25BC%2589" target="_blank" title="https://www.nodeseek.com/post-599173-1%EF%BC%89" ref="nofollow noopener noreferrer">www.nodeseek.com/post-599173…</a></li>
</ul>
<p>看别的帖子还有对接飞书的能力，后面研究跑通了再发帖。
如果有问题可以留言咨询，共同进步。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JuiceFS 企业版 5.3 特性详解：单文件系统支持超 5,000 亿文件，首次引入 RDMA]]></title>    <link>https://juejin.cn/post/7600760073007923254</link>    <guid>https://juejin.cn/post/7600760073007923254</guid>    <pubDate>2026-01-30T06:53:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600760073007923254" data-draft-id="7600953198745337862" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JuiceFS 企业版 5.3 特性详解：单文件系统支持超 5,000 亿文件，首次引入 RDMA"/> <meta itemprop="keywords" content="后端,运维"/> <meta itemprop="datePublished" content="2026-01-30T06:53:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JuiceFS"/> <meta itemprop="url" content="https://juejin.cn/user/2665636828032446"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JuiceFS 企业版 5.3 特性详解：单文件系统支持超 5,000 亿文件，首次引入 RDMA
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2665636828032446/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JuiceFS
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T06:53:53.000Z" title="Fri Jan 30 2026 06:53:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>JuiceFS 企业版 5.3 近日发布，单文件系统支持超 5,000 亿文件，实现里程碑式突破。此次升级针对元数据多分区架构进行了多项关键优化，并首次引入 RDMA 技术，以提升分布式缓存效率；此外，5.3 版本还增强了可写镜像，为跨桶导入的对象提供数据缓存等多项功能，旨在支持高性能要求及多云应用场景。</p>
<p>JuiceFS 企业版专为高性能场景设计。自 2019 年起开始应用于机器学习领域，现已成为 AI 行业核心基础设施之一。商业客户涵盖大模型公司：MiniMax、智谱 AI、阶跃星辰；AI 基础设施及应用如 Fal.ai、HeyGen 等；自动驾驶领域的 Momenta、地平线等，以及众多应用 AI 技术的各行业领先科技企业。</p>
<h2 data-id="heading-0">01 单文件系统支持超 5,000 亿文件</h2>
<p>多分区架构是 JuiceFS 应对千亿文件规模的关键技术之一，保证了系统的高扩展性和高并发处理能力。<strong>为了继续满足如自动驾驶场景业务增长的需求，5.3 版本对多分区架构进行了深入优化，将分区数量限制提高到 1,024 个，单文件系统能够存储和访问至少 5,000 亿个文件</strong>。（每个分区可存储 5 亿个文件，最大支持 20 亿）。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d5d7e11e022441583248fab927c86d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770360832&amp;x-signature=9pG2ngLDexCUnZPguGL6YzgiULI%3D" alt="" loading="lazy"/></p>
<p>这一突破对系统性能、数据一致性、稳定性要求提出了几何级的难度，背后是一系列繁杂的底层优化与研发工作。</p>
<h3 data-id="heading-1">关键优化 1 - 分区间热点均衡：自动监测和热点迁移；提供手动运维工具</h3>
<p>在分布式系统中，热点问题是常见的挑战，特别是当数据被分布到多个分区时，某些分区的负载可能比其他分区更高，这种不均衡会引发热点问题，影响系统的性能。</p>
<p>当分区数量达到数百时，热点问题变得更加普遍。尤其是在数据集较小、涉及的文件数量较多的情况下，读写热点问题会加剧，进一步增加延迟波动。</p>
<p>我们引入了自动化的热点迁移机制，将访问频繁的文件迁移到其他分区，从而分担负载并降低特定分区的压力。然而在实际环境中，我们发现仅依赖自动迁移并不能完全解决所有问题。特别是在某些特殊场景或极端情况下，自动迁移工具可能无法及时应对。<strong>因此，我们在自动监测和迁移的基础上，增加了手动运维工具，允许运维人员在遇到复杂场景时介入，进行人工分析并实施优化方案</strong>。</p>
<h3 data-id="heading-2">关键优化 2 - 大规模迁移：提升迁移速度，少量多次并发迁移</h3>
<p>面对热点过高的分区，早期的迁移操作比较简单，但随着系统规模扩大，迁移效率逐渐降低。为此，<strong>我们引入了“少量多次并发迁移”的策略，将高访问量的目录分解成多个小块，并行迁移到多个负载较低的分区</strong>，从而迅速分散热点，恢复业务的正常访问体验。</p>
<h3 data-id="heading-3">关键优化 3 - 强化可靠性自检：自动修复与清理迁移中间态文件</h3>
<p>在大规模集群中，分布式事务的失败概率显著上升，特别是在大量迁移过程中。为应对这一问题，<strong>我们增强了可靠性检测机制，增加了后台周期性的检查功能，定期扫描跨分区文件的状态，特别关注中间状态问题，并自动进行修复和清理</strong>。</p>
<p>此前，系统曾遇到过中间状态数据残留的问题，虽然短期内未影响系统运行，但随着时间推移，这些残留数据可能导致错误。通过增强的自检机制，我们确保了后台能够定期扫描并及时处理中间状态问题，从而提升了系统的稳定性和可靠性。</p>
<p>除了上述三项关键优化外，我们还在控制台进行了多项改进，以更好地适应更多分区的管理需求。我们优化了并发处理、运维操作和查询展示，提升了整体性能和用户体验。特别是，在 UI 设计方面，我们做了优化，以便更好地展示大规模分区环境下的系统状态。</p>
<h3 data-id="heading-4">千亿文件性能压测：稳定性与资源利用良好</h3>
<p>我们在谷歌云上使用自定义的 mdtest 测试工具进行了大规模测试，部署了 60 个节点，每个节点的内存超过 1 TB。在软件配置方面，我们将分区数增加至 1,024 个。部署方式与之前类似，为了降低内存消耗，我们选择仅部署一个服务进程，另两个作为冷备。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c661d1cdc3a41feac3fdfe29a7d8f42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770360832&amp;x-signature=ARwxuC2TRFuVuLIaClvxtldZnd4%3D" alt="" loading="lazy"/></p>
<ul>
<li>测试持续时间：大约 20 小时</li>
<li>写入的文件总数：约 4,000 亿个文件</li>
<li>每秒写入速度：500 万个文件</li>
<li>内存占用：约 35% 到 40%</li>
<li>硬盘使用： 40% 到 50%，主要用于元数据的持久化，使用情况良好</li>
</ul>
<p>根据我们的经验，如果采用一个服务进程、一个热备进程和一个冷备进程的配置，内存占用会增加 20% 到 30%。</p>
<p>由于云端资源有限，本次测试只写到 4,000 亿文件。在压测过程中，系统表现稳定，且硬件资源尚有富余。后续，我们会继续尝试更大规模的测试。</p>
<h2 data-id="heading-5"><strong>02 首次支持 RDMA：带宽上限提升，CPU 占用降低</strong></h2>
<p>在此次新版本中首次支持了 RDMA（Remote Direct Memory Access）技术，它的基本原理架构如下图所示。RDMA 通过允许直接访问远程节点的内存，绕过操作系统的网络协议栈，显著提高了数据传输效率。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d040b160665d4f5e93d87e16f742c16f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770360832&amp;x-signature=F97FSVGa2QFPQOgOkCzC%2FJmWZ8U%3D" alt="" loading="lazy"/></p>
<p>RDMA 的主要优点包括：</p>
<ol>
<li>低延迟：通过直接从内存到内存的传输，绕过操作系统的网络协议层，减少 CPU 的中断和上下文切换，从而降低延迟。</li>
<li>高吞吐量：RDMA 通过硬件直接传输数据，能够更好地发挥网卡（NIC）的带宽。</li>
<li>减少 CPU 占用：在 RDMA 中，数据的拷贝几乎全部由网卡完成，CPU 仅用于处理控制消息。这样，网卡负责硬件传输，释放了 CPU 的资源。</li>
</ol>
<p>在 JuiceFS 中，客户端与元数据服务之间的网络请求消息都较小，现有的 TCP 配置已能满足需求。而在分布式缓存中，客户端与缓存节点之间传输的是文件数据，使用 RDMA 可以有效提升传输效率，降低 CPU 消耗。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a610a13de6348fd96258bab8a08ebfa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770360832&amp;x-signature=pqVmqI%2Fkb7xpJ%2BIYf6v8ATYPhwY%3D" alt="" loading="lazy"/></p>
<p>我们使用了 160 Gbps 网卡进行 1MB 随机读测试，比较了 5.1、 5.2（使用 TCP 网络） 和 5.3 版本（RDMA），并观察了 CPU 占用情况。测试表明，RDMA 有效降低了 CPU 占用。在 5.2 版本中，CPU 占用了近 50%；<strong>而在 5.3 版本中，通过 RDMA 优化，CPU 占用降至约 1/3。客户端和缓存节点的 CPU 占用分别降至 8 核和 5 核，带宽达到了 20 GiB/s</strong>。</p>
<p>在以往的测试中，我们发现 TCP 在 200G 网卡下虽然稳定运行，但要完全拉满带宽仍有困难，通常只能达到 85-90% 的带宽利用率。<strong>对于需要更高带宽（如 400G 网卡）的客户，TCP 无法满足需求，而 RDMA 能够更容易地发挥硬件带宽上限，提供更优的传输效率</strong>。</p>
<p>如果用户的硬件支持 RDMA 且存在高带宽需求（如网卡大于 100G），同时希望降低 CPU 占用，那么 RDMA 是值得尝试的技术。目前，我们的 RDMA 功能处于公测阶段，尚未在生产环境中广泛部署。</p>
<h2 data-id="heading-6">03 可写镜像增强</h2>
<p>最初，镜像集群主要用于企业产品中的只读镜像。随着用户提出在镜像中写入临时文件（如训练数据）等需求，我们为此提供了可写镜像功能。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/177faea59ce147b8b017eecc456329dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770360832&amp;x-signature=2z1YzXzcTif75nks6e8M%2FWEy0nE%3D" alt="" loading="lazy"/></p>
<p>镜像客户端在实现时采用了读写分离机制。客户端在读取数据时优先从镜像集群获取，以降低延迟；而写入数据时，仍然需要写入源集群，以确保数据一致性。通过元数据版本号的记录与对比，我们确保了镜像客户端和源集群客户端看到的数据保持强一致性。</p>
<p><strong>为了提升可用性，我们在 5.3 版本引入了回退机制，即当镜像不可用时，客户端的读请求能自动回退到源集群</strong>，从而保证业务连续性，避免镜像集群故障导致的业务中断。我们还优化了多镜像环境的部署。原先，镜像端需要部署两个热备节点以确保高可用性。现在，通过改进的回退功能，部署一个镜像节点也能实现类似的效果，确保业务连续性并降低成本，尤其适用于需要多个镜像的用户。</p>
<p>通过这一改进，我们不仅降低了硬件成本，还在高可用性和低成本之间找到了平衡。对于那些在多个地点部署镜像的用户，减少元数据副本的同时进一步降低了总体成本。</p>
<h2 data-id="heading-7">04 简化运维管理，提升灵活性：为导入对象提供跨桶数据缓存</h2>
<p>在 JuiceFS 中，用户可以使用 import 命令将对象存储中的现有文件导入并统一管理。这对于已经存储大量数据（如几十 PB）的用户来说十分便捷。但在之前版本中，这一功能仅支持为同一数据桶中的对象提供缓存，意味着导入的对象必须与现有文件系统数据处于同一个桶内。这一限制在实际使用中带来了一定局限性。</p>
<p>在 5.3 版本中，我们对该功能进行了改进。现在，<strong>用户可以为任何导入的对象提供缓存能力，无论这些对象是否来自同一数据桶</strong>。这样，用户可以更加灵活地管理不同数据桶中的对象，避免了对数据桶的严格限制，从而提升了数据管理的自由度。</p>
<p>此外，以前如果用户将数据分布在多个桶中，想要为这些桶中的数据提供缓存能力，需要为每个桶新建一个文件系统。而在 5.3 版本中，用户只需创建一个文件系统（volume），便可统一管理多个桶的数据，并为所有桶提供缓存能力。</p>
<h2 data-id="heading-8">05 其他重要优化</h2>
<p><strong>Trace 功能</strong></p>
<p>我们新增了 trace 功能，这是 Go 语言本身提供的一个特性。通过这个功能，资深用户可以进行追踪和性能分析，获得更多信息，帮助我们快速定位问题。</p>
<p><strong>回收站恢复</strong></p>
<p>在之前的版本中，特别是在多分区的情况下，有时回收站记录的路径不完整，导致恢复时出现异常，未能恢复到预期位置。为了解决这个问题，在 5.3 版本中，在删除文件时，我们会记录文件的原始路径，确保恢复时能够提供更可靠的恢复能力。</p>
<p><strong>Python SDK 改进</strong></p>
<p>在前几个版本中，我们发布了 Python SDK，它提供了基础的读写功能，方便 Python 用户与我们的系统对接。在 5.3 版本中，我们不仅加强了基础读写功能，还增加了对运维子命令的支持。例如，用户可以直接通过 SDK 调用 juicefs info 或 warmup 等命令，而不需要依赖外部系统命令。这不仅简化了编码工作，并且避免了频繁调用外部命令时可能产生的性能瓶颈。</p>
<p><strong>Windows 客户端</strong></p>
<p>我们在之前版本中推出了 Windows 客户端 Beta 版本，并已获得不少用户反馈。经过改进，当前版本在挂载的可靠性、性能以及与 Linux 系统的兼容性上都有了显著提升。未来，我们计划进一步完善 Windows 客户端，为依赖 Windows 的用户提供更接近 Linux 的体验。</p>
<h2 data-id="heading-9">06 小结</h2>
<p>相较于昂贵的专用硬件，JuiceFS 通过灵活地利用云上或客户现有的存储资源，帮助用户在应对数据增长时平衡性能与成本。在 5.3 版本中，通过优化元数据分区架构，单文件系统可支持超过 5,000 亿个文件。首次引入的 RDMA 技术显著提升了分布式缓存带宽和数据访问效率，减少了 CPU 占用，进一步优化了系统性能。此外，我们还优化了可写镜像、缓存等多项功能，提升了大规模集群的性能和运维效率，优化用户体验。</p>
<p>云服务用户现已可以直接在线体验 JuiceFS 企业版 5.3，私有部署用户可通过官方渠道获得升级支持。我们将继续专注于高性能存储解决方案，和企业一起应对数据量的持续增长所带来的挑战。</p>
<p>如果你在存储架构设计、成本控制或性能优化中遇到过问题，或有相关实践心得，欢迎在评论区留言。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Claude Code安装和GLM4.7替代]]></title>    <link>https://juejin.cn/post/7600260767687065626</link>    <guid>https://juejin.cn/post/7600260767687065626</guid>    <pubDate>2026-01-28T17:02:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600260767687065626" data-draft-id="7600260767687032858" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Claude Code安装和GLM4.7替代"/> <meta itemprop="keywords" content="Claude,ChatGLM (智谱)"/> <meta itemprop="datePublished" content="2026-01-28T17:02:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Persistent_cwb"/> <meta itemprop="url" content="https://juejin.cn/user/3122268756249485"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Claude Code安装和GLM4.7替代
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3122268756249485/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Persistent_cwb
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-28T17:02:36.000Z" title="Wed Jan 28 2026 17:02:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、安装 Claude Code</h2>
<p>考虑到有人可能没有使用过 Claude Code（CC），我们先从安装说起。</p>
<h3 data-id="heading-1">前置条件</h3>
<ul>
<li>Node.js 18+</li>
<li>Git for Windows</li>
</ul>
<h3 data-id="heading-2">安装步骤</h3>
<p>打开 CMD 终端，输入以下命令：</p>
<pre><code class="hljs language-bash" lang="bash">npm install -g @anthropic-ai/claude-code
</code></pre>
<p>命令执行完成之后，检查版本：</p>
<pre><code class="hljs language-bash" lang="bash">claude --version
</code></pre>
<p>能正常输出版本号，就表示安装成功了。</p>
<p><img src="https://tonyisstark.oss-cn-hangzhou.aliyuncs.com/2026/01/20260102181204201.png@!full" alt="Claude Code 安装和验证过程" loading="lazy"/>
<em>Claude Code 安装和验证过程</em></p>
<blockquote>
<p>💡 <strong>提示：</strong> 这一步不需要科学上网，可以正常安装。</p>
</blockquote>
<hr/>
<h2 data-id="heading-3">二、配置 GLM Coding</h2>
<p>官方提供了三种配置方式：</p>
<ol>
<li><strong>自动化助手</strong>（推荐）</li>
<li>自动化脚本</li>
<li>手动配置</li>
</ol>
<p>下面详细介绍<strong>自动化助手</strong>配置方式：</p>
<h3 data-id="heading-4">1. 安装自动化助手</h3>
<pre><code class="hljs language-bash" lang="bash">npx @z_ai/coding-helper
</code></pre>
<p><img src="https://tonyisstark.oss-cn-hangzhou.aliyuncs.com/2026/01/20260102164100348.png@!full" alt="语言选择界面（默认英文，可切换中文）" loading="lazy"/>
<em>语言选择界面（默认英文，可切换中文）</em></p>
<h3 data-id="heading-5">2. 套餐选择</h3>
<p><img src="https://tonyisstark.oss-cn-hangzhou.aliyuncs.com/2026/01/20260102164244801.png@!full" alt="选择中国版本或国际版" loading="lazy"/>
<em>选择中国版本或国际版</em></p>
<p>我购买的是中国版，所以选择中国版本。</p>
<h3 data-id="heading-6">3. 输入 API Key</h3>
<p><img src="https://tonyisstark.oss-cn-hangzhou.aliyuncs.com/2026/01/20260102164351333.png@!full" alt="输入 API Key" loading="lazy"/>
<em>输入 API Key</em></p>
<p>根据界面提供的链接，打开智谱官网获取 API Key。</p>
<p><img src="https://tonyisstark.oss-cn-hangzhou.aliyuncs.com/2026/01/20260102164450469.jpg@!full" alt="智谱官网 API Key 获取（有两个默认 key）" loading="lazy"/>
<em>智谱官网 API Key 获取（有两个默认 key）</em></p>
<p><img src="https://tonyisstark.oss-cn-hangzhou.aliyuncs.com/2026/01/20260102164609950.png@!full" alt="粘贴 API Key 到配置界面" loading="lazy"/>
<em>粘贴 API Key 到配置界面</em></p>
<h3 data-id="heading-7">4. 选择编码工具</h3>
<p><img src="https://tonyisstark.oss-cn-hangzhou.aliyuncs.com/2026/01/20260102164625421.png@!full" alt="选择 Claude Code（智谱有专门针对 CC 优化）" loading="lazy"/>
<em>选择 Claude Code（智谱有专门针对 CC 优化）</em></p>
<h3 data-id="heading-8">5. 刷新配置</h3>
<p><img src="https://tonyisstark.oss-cn-hangzhou.aliyuncs.com/2026/01/20260102164734735.png@!full" alt="检测 CC 配置情况" loading="lazy"/>
<em>检测 CC 配置情况</em></p>
<p>这一步会检测 Claude Code 的配置情况，选择<strong>配置刷新</strong>。</p>
<h3 data-id="heading-9">6. 启动 Claude Code</h3>
<p><img src="https://tonyisstark.oss-cn-hangzhou.aliyuncs.com/2026/01/20260102164827604.png@!full" alt="用 GLM 编码套餐替换 CC 配置" loading="lazy"/>
<em>用 GLM 编码套餐替换 CC 配置</em></p>
<hr/>
<h2 data-id="heading-10">三、手动调整配置（如果需要）</h2>
<p>替换完成后，如果启动时显示的模型不是预期的，可能需要手动调整配置文件。</p>
<p><img src="https://tonyisstark.oss-cn-hangzhou.aliyuncs.com/2026/01/20260102165105948.png@!full" alt="Claude Code 启动界面" loading="lazy"/>
<em>Claude Code 启动界面</em></p>
<h3 data-id="heading-11">配置文件路径</h3>
<pre><code class="hljs language-text" lang="text">C:\Users\你的用户名\.claude\settings.json
</code></pre>
<p><img src="https://tonyisstark.oss-cn-hangzhou.aliyuncs.com/2026/01/20260102165157211.jpg@!full" alt="配置文件内容（红色框中是其他模型配置，需要删除）" loading="lazy"/>
<em>配置文件内容（红色框中是其他模型配置，需要删除）</em></p>
<h3 data-id="heading-12">最终配置内容</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"ANTHROPIC_AUTH_TOKEN"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your_zhipu_api_key"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"ANTHROPIC_BASE_URL"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://open.bigmodel.cn/api/anthropic"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"API_TIMEOUT_MS"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"3000000"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>GLM 会自动按如下规则做模型适配：</p>
<ul>
<li><code>ANTHROPIC_DEFAULT_OPUS_MODEL</code>：<code>GLM-4.7</code></li>
<li><code>ANTHROPIC_DEFAULT_SONNET_MODEL</code>：<code>GLM-4.7</code></li>
<li><code>ANTHROPIC_DEFAULT_HAIKU_MODEL</code>：<code>GLM-4.5-Air</code></li>
</ul>
<p>修改完成后，退出程序重新输入 <code>claude</code> 启动 Claude Code。</p>
<p><img src="https://tonyisstark.oss-cn-hangzhou.aliyuncs.com/2026/01/20260102165627674.jpg@!full" alt="配置完成，显示 Sonnet 4.5（对应 GLM 4.7）" loading="lazy"/>
<em>配置完成，显示 Sonnet 4.5（对应 GLM 4.7）</em></p>
<hr/>
<h2 data-id="heading-13">四、实际测试</h2>
<p>换心完成后，我尝试让 GLM 帮我创建一个 React 项目：</p>
<ol>
<li>输入 <code>/init</code> 命令</li>
<li>系统提示项目为空，询问是否创建项目</li>
<li>通过引导一步步创建 React 项目</li>
<li>生成 CLAUDE.md 配置文件</li>
</ol>
<p><img src="https://tonyisstark.oss-cn-hangzhou.aliyuncs.com/2026/01/20260102173956590.png@!full" alt="GLM 帮助创建 React 项目" loading="lazy"/>
<em>GLM 帮助创建 React 项目</em></p>
<p><img src="https://tonyisstark.oss-cn-hangzhou.aliyuncs.com/2026/01/20260102174759311.png@!full" alt="生成的 CLAUDE.md 配置文件" loading="lazy"/>
<em>生成的 CLAUDE.md 配置文件</em></p>
<p><img src="https://tonyisstark.oss-cn-hangzhou.aliyuncs.com/2026/01/20260102174921439.png@!full" alt="CLAUDE.md 文件详细内容" loading="lazy"/>
<em>CLAUDE.md 文件详细内容</em></p>
<p>整个过程中，GLM 4.7 的表现相比之前使用的小米模型（mimo）有显著提升：</p>
<ul>
<li>✅ 命令执行更加准确</li>
<li>✅ 无需多次重试</li>
<li>✅ 代码生成质量更高</li>
</ul>
<hr/>
<h2 data-id="heading-14">五 总结</h2>
<p>目前配置已完成，GLM 4.7 已成功替换为 Claude Code 的"国产心"。</p>
<p>🎯 <strong>优势：</strong></p>
<ul>
<li>价格约为 Claude Pro 的 1/8</li>
<li>用量是 Claude Pro 的 3 倍</li>
<li>无需科学上网，国内使用更方便</li>
<li>实际测试表现良好</li>
</ul>
<p>📌 <strong>待验证：</strong></p>
<ul>
<li>在复杂任务中是否能真正替代 Claude 本尊</li>
<li>代码质量和准确性对比</li>
<li>长上下文处理能力</li>
</ul>
<p>至于 GLM 4.7 是否真的能完全替代 Claude 本尊，还需要更多实际测试来验证。接下来我将通过更多实际案例进行对比，一切以实测为准。</p>
<hr/>
<h2 data-id="heading-15">七、相关链接</h2>
<ul>
<li>🔗 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bigmodel.cn%2Fglm-coding" target="_blank" title="https://www.bigmodel.cn/glm-coding" ref="nofollow noopener noreferrer">GLM 4.7 注册地址</a></li>
<li>📖 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.bigmodel.cn%2Fcn%2Fcoding-plan%2Ftool%2Fclaude" target="_blank" title="https://docs.bigmodel.cn/cn/coding-plan/tool/claude" ref="nofollow noopener noreferrer">GLM 4.7 配置文档</a></li>
</ul>
<p>本文基于 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.tonyisstark.com%2F4810.html" target="_blank" title="https://www.tonyisstark.com/4810.html" ref="nofollow noopener noreferrer">www.tonyisstark.com/4810.html</a> 整理
发布日期：2026年1月</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MoltBot(原ClawdBot)安装指南，接入企微、飞书、钉钉、QQ四大主流社交软件]]></title>    <link>https://juejin.cn/post/7600292312217370676</link>    <guid>https://juejin.cn/post/7600292312217370676</guid>    <pubDate>2026-01-29T02:33:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600292312217370676" data-draft-id="7600296037543428096" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MoltBot(原ClawdBot)安装指南，接入企微、飞书、钉钉、QQ四大主流社交软件"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2026-01-29T02:33:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="润雨的AI开源日记"/> <meta itemprop="url" content="https://juejin.cn/user/295098467493901"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MoltBot(原ClawdBot)安装指南，接入企微、飞书、钉钉、QQ四大主流社交软件
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/295098467493901/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    润雨的AI开源日记
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T02:33:21.000Z" title="Thu Jan 29 2026 02:33:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    13
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、安装MoltBot</h2>
<p>执行安装命令</p>
<pre><code class="hljs language-plain" lang="plain">npm install -g moltbot@latest
</code></pre>
<p>执行初始化命令</p>
<pre><code class="hljs language-plain" lang="plain">moltbot onboard --install-daemon
</code></pre>
<h2 data-id="heading-1">二、初始化过程</h2>













































<table><thead><tr><th>示意图</th><th>说明</th></tr></thead><tbody><tr><td><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=N2NkYTMwNTcwNGU4ZjY3ZjNlNzIwZTQ3M2M2MzVhYjNfZFQ5R0ZBNEc3QndWSk9FWGI4b1BCd1VnQ25vcEJtWkhfVG9rZW46RHhDeWJpWUNrb3Iyd2t4YVpubWNrU0E5bmJnXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></td><td>选择：Yes<br/></td></tr><tr><td><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=M2FkZjIyN2RhOTQ4N2U0NDBmOGIyN2M1NzEyMzM3OTNfNVFDYlJacTJXaXh1WTk3U2ppSlM3dEtJMGVGNlNQdDdfVG9rZW46Um5VRmJZY25vb0xsZlZ4U0Fuc2NJZWk3bmhkXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></td><td>选择：QuickStart</td></tr><tr><td><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=ZGEzMmJlNDYzNTZlZmUzMzk0ZDM2MzVkYzkxYTM1NWJfaEJJSWRPUTREUG9yYWFHeHlreVFoRUFtS3hFZElCUEhfVG9rZW46SUVJMWJVRFRtb0I0NHZ4UzhUdGNFb3phbmloXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></td><td>选择：OpenAI<br/>根据自己的需要选择，如果后期要使用其他AI的话，这里请选择 OpenAI<br/></td></tr><tr><td><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=MjMwZjIyYTljOTkxNDQ2MWEzODllZDc3NjAyNGM4NjJfcEkxa1VRMHV2QU95VEhpdnp1Zm9icXBTUEJieDhpSEZfVG9rZW46SGVTV2I1bzZGb1JTTzh4djlvVWNLelZNblliXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></td><td>选择：OpenAI API key</td></tr><tr><td><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=NjkxZjE5ZThkNWFiZTZiNGYxYWYyNzZjZjc0NmY3MmJfSmVyYldkczhKNUIxU0xzb1hSc2Z6N1VLSUk1Tm5Jd2tfVG9rZW46Sk1kbWJhUFBYb0NMOEp4M0NpcWNCNnFUbnVjXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></td><td>输入大模型 API Key</td></tr><tr><td><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=MGEzYzkzYjgzM2NlZTliMTU5OWJjNTY5ZDAwMzM1MzZfTEpzOW1NUkV4S3dzZGp2aURrYm9iMWtJZGN3UWdNTWdfVG9rZW46Q0VsbmJPcEQ5b0w3eWJ4WEdZVmNhd01WbkZwXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></td><td>选择：Skip for now<br/>* 新版中，支持直接配置国内主流社交平台，请查看第四部分</td></tr><tr><td><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=OTNlYjAyZjkyN2M5NTQxMmVlOTQ3OTQ0MGViMGUzNWRfTmtiWGc2a0lHd2xrdEloZmtVZWFmRFYwNWQwZXluOWZfVG9rZW46QU9oZmJLWGtDb3pPMTR4R3BCOWN3UGh1bmxmXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></td><td>选yes，现在配置skill<br/>选no，之后再配置</td></tr><tr><td><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=ZTZlZDgwZGU2NjI0M2JhNDM2MTJiYjViM2E0YzFhMTRfbzNDMHZXbXRDVlR1N09ZTlA2RXh4Vkt6Z3hWdFluV1BfVG9rZW46VG9NRWJPemlOb2tKdXl4VjhWZGN3RmsybmRjXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></td><td>按“空格键”选中左图选项，“回车键”下一步<br/></td></tr><tr><td><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=MmZlMGQ4YWZjODUyOTM3NDZiODVhZTVkNTBhMzg0NjZfZ3gwWTBaNkd6ZmFZMEhpaG84TWRHcGxyYUVaZ1lSTWlfVG9rZW46R2FuaGJSSkxhb3dqMHp4cWN1OWNjZGE0bkNmXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></td><td>选择：Hatch in TUI (recommended)<br/></td></tr></tbody></table>
<h2 data-id="heading-2">三、接入大模型（可选）</h2>
<p>如果初始化中，没有你想用的模型，可以按照此步骤单独接入</p>
<p>这里以豆包的coding计划为案例。</p>
<h3 data-id="heading-3">1.修改使用模型</h3>
<p>打开 MoltBot 页面</p>
<p>在 Web UI 中，选择 <strong>Settings-Config-Authentication</strong>，在底部选择 <strong>Raw</strong> 方式查看配置信息。</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=ODkzMmE0MjYwZTNiOTVkZjI3N2E5ZGRhODI2NDEzNjZfMDU0aTV0OW1yVWlGdHhmU0tLOUtMS0RpbnRDczhCcFZfVG9rZW46WjFYbWJaSGgxb1dLNnV4UUhWbmNSTnRtbjNmXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>在 agents 参数下，找到 model 和 models，改为您要接入的模型名称</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
<span class="hljs-attr">"primary"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"doubao/doubao-seed-1-8-251228"</span>
<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"models"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
<span class="hljs-attr">"doubao/doubao-seed-1-8-251228"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"doubao"</span> <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>其中，<code>doubao</code>为平台名称，<code>doubao-seed-1-8-251228</code>为模型名称</p>
<h3 data-id="heading-4">2.配置模型平台</h3>
<p>在 models 参数下，修改您要接入的 base_url 以及 API KEY。（可在平台后台获取）</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=YWIzM2U4NTA2YjVhNTU5Y2M3ODY4ZTQxZjFiZjJmNTZfNFlmSHpiaUR2RFN2emRGUFNWeGE5bVE3MUxlcEd6QTBfVG9rZW46VE4yRGIyVmdib0NueFN4SE4xcWN4bHFqbmlmXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"models"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"providers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"doubao"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"baseUrl"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://ark.cn-beijing.volces.com/api/v3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"apiKey"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"YOUR_API_KEY"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"api"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"openai-completions"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><code>baseUrl</code> 为模型的请求地址</p>
<p><code>apiKey</code> 为你自己的密钥</p>
<p><code>api</code> 固定为 <code>openai-completions</code></p>
<h3 data-id="heading-5">3.修改认证配置</h3>
<p>在 auth 参数下，修改认证配置</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjdhYWI1Y2FiMzAxMzk2NzIyY2ZhMjc2N2Q1NzgxMmFfd1VWRVRxcWl5ZWprYW93ZnJlTEFwenRBdU1kcG1pc1NfVG9rZW46U2h5c2IydFVFb3dSbTR4RkZza2NKY0hHbkRmXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"auth"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"profiles"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"doubao:default"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"doubao"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"mode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api_key"</span> <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-6">4.保存配置并重启服务</h3>
<p>在 MoltBot 配置界面完成修改后，先单击 <strong>Save</strong>，保存完成后单击 <strong>Update</strong>。</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=OTQyNjczZTIyYWZhODRiMTRlZTYzMGQ2Yzk1YWQ0YjNfbEowc0NCQ0hzY3dINWRGZ0ZPaE9EeldZaVFZM1VmYllfVG9rZW46V1U3YWJFSmlFb05EMEF4dWF5T2NGV05pbm5pXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">四、接入主流社交平台</h2>
<h3 data-id="heading-8">企业微信</h3>
<h4 data-id="heading-9">1.创建机器人</h4>
<p>前往<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fdeveloper%2Ftools%2Fblog-entry%3Ftarget%3Dhttps%253A%252F%252Fwork.weixin.qq.com%252F%26objectId%3D2625147%26objectType%3D1%26contentType%3Drich" target="_blank" title="https://cloud.tencent.com/developer/tools/blog-entry?target=https%3A%2F%2Fwork.weixin.qq.com%2F&amp;objectId=2625147&amp;objectType=1&amp;contentType=rich" ref="nofollow noopener noreferrer"><span>企业微信官网</span></a>，使用有企业管理员权限的账号登录。如尚未拥有满足条件的企业，可以参考<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fdeveloper%2Ftools%2Fblog-entry%3Ftarget%3Dhttps%253A%252F%252Fopen.work.weixin.qq.com%252Fwwopen%252Fmanual%252Fdetail%253Ft%253Dregister%26objectId%3D2625147%26objectType%3D1%26contentType%3Drich" target="_blank" title="https://cloud.tencent.com/developer/tools/blog-entry?target=https%3A%2F%2Fopen.work.weixin.qq.com%2Fwwopen%2Fmanual%2Fdetail%3Ft%3Dregister&amp;objectId=2625147&amp;objectType=1&amp;contentType=rich" ref="nofollow noopener noreferrer"><span>创建&amp;注册企业</span></a>来创建一个新企业，以此来体验Moltbot（Clawdbot）的能力。</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=OWQ1MDk0N2FhM2FmOTc1NGM5NGZmMTgzNmQ2MzQ5NzNfYko3b3ZZSUlHSHNNM0JqSkE4bXhzUEtYYXh6RW1BOWtfVG9rZW46TkVDemJlVDRqb3dzbFB4VFREMmNzZUlVbjljXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>在企业微信管理后台左侧导航依次找到并进入<strong>安全与管理 &gt; 管理工具</strong>，并且在页面内点击<strong>创建机器人</strong>。</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=YTQ4NGM2NWY2MTBhOGUxMTg3Y2MzYTAyZGEwNWE0ODJfNHNhcVI5V01mUnBYeXM1NHBrdGFkZm0yV0VaNFNzSmNfVG9rZW46Q3VJT2JPSEdob0dtQTJ4SGJGT2Nqc2hpbnloXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>滑到页面最底端点击API模式创建按钮：</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=NDk3MzhiYWU3ZmUwNWRlNmQ2ODMxNTMzMDMwY2FhYjlfQUF4VnRjNU0wM1ZvcjNzMDN4d2haRU5zS3FaTk5QZnZfVG9rZW46T0Nwa2J1N1I3b3ByQTF4ekhpaWNES0tHbklPXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>在切换后的页面，依次填写名称、简介、可见范围、<strong>URL</strong>，并且点击<strong>随机获取</strong>按钮生成<strong>Token</strong>和<strong>Encoding-AESKey</strong>（这是企业微信与Moltbot进行加密通信的密钥）。</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjI2YTk3MzJmZDNlYmRmZjA2OWM4NDE4MjA1ZmQ2N2Ffc0d1YUN1SnVmT2JXa2daMVhzT0xiS0MzQjBmTVZybzlfVG9rZW46QVk4N2JoR084b3BYTFd4dmdWbWNVTDZqbnZoXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>此处需要关注，URL处提及的“实例IP地址”为你的公网IP地址。一般家用电脑是没有公网IP的，建议购买服务器部署。</p>
<pre><code class="hljs language-plain" lang="plain">http://公网IP地址:18789/wecom
</code></pre>
<p>示例：
比如我的公网IP地址是12.12.12.12，那么你就应该在企业微信机器人的URL处填入：<code>http://12.12.12.12:18789/wecom</code></p>
<p>填写完成后，先不要点创建，而是需要回到登录服务器的页面准备进行接下来的配置。</p>
<h4 data-id="heading-10">2.连接机器人</h4>
<p>此处我们首先假设你现在处于如图所示的步骤：</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=NmVhNmY4YzFmY2Y5ZmY3YTIyNjdmZGJhZWJjNTVlZjhfZmczNU5BUVR3cW9EbTBRNEx1UDhPTmpwQVhhNDMzMEtfVG9rZW46SGY3dmJJUnlZb2w4SlJ4SExJeWNVbGRpbndkXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>如果你没有，最简单的方法是：</p>
<p>重新执行<code>clawdbot onboard</code>，重新走一遍，直到你回到如上步骤。</p>
<p>接下来，我们直接选择WeCom（Plugin），回车确认：</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=NmUxYjhiNzdlMWUxNzg0OGJlMjRkYmRjZjZjOWVhNmVfeU9keGVuWE9vdnh6aVhHbHp2MVVFd2JjTHFEZlZleDFfVG9rZW46QXNRRmI5aW9Pb291blZ4Tm0wY2M1WEl6bmtjXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>接下来我们需要修改Moltbot的配置文件。</p>
<p>在 Web UI 中，选择 <strong>Settings-Config-Authentication</strong>，在底部选择 <strong>Raw</strong> 方式查看配置信息。</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=NTBmNmQ5OWE5YTQxMjE5ZTU4MmVkY2I5YTA1OTM4NDJfRmp0VDA2dFdxODFPYzBYQzU1MDRrWFIzZE1ubHhOeDVfVG9rZW46UTdnd2JjbGhkb0g3eTR4R2d0ZWNwcEx6bndmXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<pre><code class="hljs language-json" lang="json">  <span class="hljs-attr">"wecom"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"enabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"webhookPath"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/wecom"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"token"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"填入创建企业微信机器人的页面，生成的Token"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"encodingAESKey"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"填入创建企业微信机器人的页面，生成的encodingAESKey"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"receiveId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"dm"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"policy"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pairing"</span> <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
</code></pre>
<p>输入完成后，保存并更新，重新启动网关。</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=NDQ2MzUzMmYxNWQwMGZmYTI5ZjEwOGE4NDk3YWViZWVfSGlya0syQ2NJREVMZVFlRkhWSTBwc1d2N09PWW1pb1lfVG9rZW46SzNGOGJ0eUZqb3BackJ4QWo2MGN2anR1bnljXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>如果没有外层的<code>"channels":{}</code>，那么参考上图手动拼一下就好了。</p>
<h4 data-id="heading-11">3.继续创建机器人</h4>
<p>此时我们再回到企业微信机器人创建页，点击创建按钮</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=NzRkNjg3MTE4MWRlZGI5OGI3YTdlNWFiNWVmZDJiNmZfWXVaY1RyczhWbzh3dWhicVpKbE1qOEZBWnl5bzRCTG1fVG9rZW46T2tMYmJWWVRnb1NnU2h4TWxJaGNCamFGbktiXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>创建成功后，在接下来的页面中找到企业微信机器人的二维码，用手机扫码后添加。</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=Y2E1NzU1N2JmZmM2OWI5Nzc0MmIzZjYzOWFlMzE5ZmZfSVlwaGh3VVFBaUx5ck5oVE0yWWdTQWtZdld3OXBBNFJfVG9rZW46RU1QN2JrVnRob1JDZWF4RE5ZbWMySjVOblRjXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>添加完成后，即可在聊天窗中与它进行对话：</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=ZGMzZTc5NzdjYjY0NjhlZDFlOWRiMjczOWM3ODNkNWZfdmhONUhUUjZ3eXJZU3kyR1BvTG5jc21DczJBdVF0NlBfVG9rZW46UGl5OGJpb1ptb2ZRd1F4cXZKSWN4RlNabnpkXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<h3 data-id="heading-12">飞书</h3>
<p>此处我们首先假设你现在处于如图所示的步骤：</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=NTkxOGZmYTNjMjY5M2YzOWM3MzhmOWRiZWFkNjIwZWNfODZOTjRWa2pGb2trWENtY29HMmZGUTJ3VGw3MVdKUWxfVG9rZW46SGtVNWJLVEdEb1pUSU54ZEZIemNuQkFsbkFjXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<h4 data-id="heading-13">1.创建机器人</h4>
<ol>
<li>
<p>访问飞书开发者平台（<a href="https://link.juejin.cn?target=https%3A%2F%2Fopen.feishu.cn%2Fapp%3Flang%3Dzh-CN%25EF%25BC%2589%25EF%25BC%259B" target="_blank" title="https://open.feishu.cn/app?lang=zh-CN%EF%BC%89%EF%BC%9B" ref="nofollow noopener noreferrer">open.feishu.cn/app?lang=zh…</a></p>
</li>
<li>
<p>登录后，点击 “创建企业自建应用”；</p>
</li>
<li>
<p>填写应用基础信息：应用名称（如 “Moltbot 助手”），选择应用图标，点击 “创建” 按钮，进入<span>应用管理</span>页面。</p>
</li>
</ol>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=NzY2NjNiOTMzNDYxZTI0ZmJmNzA4ODdlYmMwNWFiZmNfQjlseDZRbW80OWRtNDJVMEU2TkhSV3dIRkFUTlJQa21fVG9rZW46TmVFMWJ1Skhjb2FzcEF4bWlQWGNXaUxDbnFnXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>4.添加机器人能力：在应用管理页左侧导航栏，找到并点击 “添加应用能力”，在弹出的列表中选择 “机器人”，点击 “添加”。</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=OGU3ZTU2ZjFiNzEwMzIxODM0MGM5MmExZTI5YTNkM2VfSzg4YWVkS2RBVjVjR0VlbEJaUGJGTGZnYkNRUWlNc3RfVG9rZW46WG1PSWJKSHZDbzd6Uk54cURhU2NuN1Q5bjdmXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>5.点击上方的创建版本并发布。</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=ZGYxNmEzY2Q0MzNlYzQ0ZWJjMDUxMjBjMmY2YTgwNzFfckxxSlFoTVJnMzhwYmdxMkFCemdIVEN2Q21vaXNKRExfVG9rZW46VFVteWJDSzIzb0VrZ3d4bDM2ZWM0NXIwbm5oXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p><strong>获取飞书应用凭证</strong></p>
<ol>
<li>
<p>在飞书应用管理页，左侧导航栏找到 “凭据与基础信息” 栏目，点击进入；</p>
</li>
<li>
<p>在页面中找到 “App ID” 和 “App Secret” 两个参数，分别点击右侧 “复制” 按钮，将其保存到记事本或备忘录中；</p>
</li>
</ol>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=NmU1YzFhNWE4NzFhMTk2ZTgyZjQ4YTZkM2M5ZDY4MjVfQ1l4QXoyZHpRTVFxeXlZWDc4R2VHcVJNRHhISWRVRzdfVG9rZW46UVBsVGJEM2ZMb2U5NVB4bEJFVWNpZldQbmNlXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>3.保存完成后，不要关闭飞书开发者平台页面，后续配置权限还需使用。</p>
<h4 data-id="heading-14">2.连接机器人</h4>
<p><strong>输入APP id 与 APP Secret</strong></p>
<p>输入上一步获取到的id与secret，回车确认；</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=MGUwMzM4YWViNDA5NDVlMmJhMDM3YjExOWJiMDgyMTlfSm5vdjU3VUc5a284bnlVcE9MbmNKN2R1Rjd4U21vT2RfVG9rZW46SWdrNWJmY01Zb0xwaGh4RnM0NWNLazhQbkllXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>后续按正常流程运行即可~</p>
<h4 data-id="heading-15">3.配置机器人</h4>
<h5 data-id="heading-16"><strong>飞书应用权限与事件配置</strong></h5>
<p>此步骤分为「事件配置」「权限配置」「应用发布」三部分，全程在飞书开发者平台操作，按顺序执行：</p>
<h6 data-id="heading-17"><strong>（1）事件配置</strong></h6>
<ol>
<li>
<p>在飞书应用管理页，左侧导航栏找到 “事件与回调” 栏目，点击进入；</p>
</li>
<li>
<p>事件配置：在页面中选择 “长连接”，点击 “保存”；</p>
</li>
</ol>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=MGYxNTkyMjEwYzY5NzI3NjA2MDZhMDhkYjM3Nzg5NmVfeThrU0JNNTR5Y3g5cDlRMUh4WEtwZktjYThaMkRBR1VfVG9rZW46WVRwdmJlZldtb1VkN1R4TmxyQWNhSXk4bkVkXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p><span>descript</span></p>
<p>3.添加事件：点击页面中的 “添加事件”，在弹出的事件列表中，选择 “消息与群组” 分类，勾选 “接收消息”，点击 “确定”，完成事件订阅。</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=MjkwMTRjZWI2OWExYjA2ZDIyNDRjZWYxOWNkNGRhNWFfaHFKbURjUGxXZ1lPVkpzaWFUMkRmaXd6QkNrTDJsVnFfVG9rZW46T3JhVWJBRkM4b1J1UjF4Vnd3M2NJeTNNbmFkXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p><span>descript</span></p>
<p>4.回调配置：订阅方式选择 “使用长连接”，无需填写其他地址，配置自动生效。</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=YTgxNzM1NjRkYzM4MzFlNTVhMWU5NWY1MGI2ODY4NzJfMXBpWDl3ZWJuNUV2dVdsMFhFWnMwVWRBSGNaVE9pdkJfVG9rZW46WG15UmJtMElJb0RUd3d4Sld0TGM1TVVFbk9mXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p><span>descript</span></p>
<h6 data-id="heading-18"><strong>（2）权限配置</strong></h6>
<ol>
<li>
<p>在飞书应用管理页，左侧导航栏找到 “权限管理” 栏目，点击进入；</p>
</li>
<li>
<p>点击页面中的 “批量导入权限” 按钮，弹出权限导入窗口；</p>
</li>
</ol>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=Y2UxM2I5NWFmOGQ3NDI3NTBlYzZiOTFkNWM2ZjVlZjdfbHFZdUVrS241RFg1NnpicWI2TFJ5OEw2c0UyUHUyaGxfVG9rZW46VXYwMGJZWjZhb2RGSWx4c0NHZGN2cW4ybmdmXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p><span>descript</span></p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=MmU1NDMwYjQ1MmQ5ZDBmYzA1MzZlMmJjNmQxYTE3YTFfakxocEx3dUQ5dHR3OG5mSzZUZ3hBMUNsUThzWno2MjNfVG9rZW46UUplMWJzY1ZUb2RrZ2R4ZEpqVWNYNGtsbjllXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p><span>descript</span></p>
<p>3.复制以下 <span>JSON</span> 代码，粘贴到导入窗口的输入框中，点击 “导入” 按钮，等待权限导入完成：</p>
<p>代码语言：txt</p>
<p>AI代码解释</p>
<pre><code class="hljs language-plain" lang="plain">{
  "scopes": {
    "tenant": [
      "contact:user.base:readonly",
      "im:chat",
      "im:chat:read",
      "im:chat:update",
      "im:message",
      "im:message.group_at_msg:readonly",
      "im:message.p2p_msg:readonly",
      "im:message:send_as_bot",
      "im:resource"
    ],
    "user": []
  }
}
</code></pre>
<p>4.导入验证：页面显示 “导入成功”，且权限列表中出现上述导入的权限，即为配置完成。</p>
<h6 data-id="heading-19"><strong>（3）发布应用</strong></h6>
<ol>
<li>
<p>在飞书应用管理页，左侧导航栏找到 “版本管理与发布” 栏目，点击进入；</p>
</li>
<li>
<p>点击右上角的新建版本；</p>
</li>
</ol>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=MzYwNTJiZTAzMTc5YjYwZGNlN2ExODgxYjMxMjkyMDJfMkxVN2lBamdXSjllZE5NTjZMa0FsMmlFYXZ0TW01UFBfVG9rZW46QktRc2JYQ1IzbzNyakp4TUZOVWN2QUNybm9oXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p><span>descript</span></p>
<p>填写版本号与描述后，保存并发布；</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=M2Y5NzEyNTYwNWRkOTkzZDVkMDQ1NzRhMTc5ZmUzYmFfNU5QQXlUV1RkZ1cxVjZWQjgyUFVERFFYb0gyNElmYzdfVG9rZW46Rzg4MmJsU1l2bzJ4ZWl4bWNMbGNweENUbkxnXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<h4 data-id="heading-20">4.启动服务</h4>
<p>回到命令行界面，输入以下命令，启动后不要关闭命令行窗口：</p>
<pre><code class="hljs language-plain" lang="plain">clawdbot gateway
</code></pre>
<h4 data-id="heading-21">5.验证服务</h4>
<ol>
<li>
<p>打开手机或电脑端飞书 APP，登录与飞书开发者平台相同的账号；</p>
</li>
<li>
<p>在飞书首页，找到 “工作台” 入口，点击进入，在工作台列表中找到已发布的 Moltbot 应用（如 “Moltbot 助手”），点击进入；</p>
</li>
<li>
<p>系统将自动启动私聊窗口，发送任意消息（如 “你好”“查询今日日程”）；</p>
</li>
<li>
<p>验证结果：如果收到 Moltbot 的回复，即为飞书接入成功</p>
</li>
</ol>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=MjgyMmIyZGU1ODQwNGI0YzkyYjA2MzIxNjViN2Y5OGRfbFJVTHBnb3c1S0Z3d2p3OHh2a0xoenVxRlE5VjhqNnZfVG9rZW46UGZ2YmJZY3Zxb2JBTmh4SEs5TmNHUUJrbmhmXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<h3 data-id="heading-22">钉钉</h3>
<p>首先完成初始化，启动MoltBot</p>
<h4 data-id="heading-23">1.安装钉钉插件</h4>
<p>执行命令 <code>clawdbot plugins install clawdbot-dingtalk </code>安装插件</p>
<p>执行命令 <code>clawdbot onboard</code> 开始初始化</p>
<h4 data-id="heading-24">2.初始化</h4>
<p>选择钉钉作为频道</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjNmMTQ1OTM5ODhmN2RmYWJjNzJmNjMyM2VkYmU3MzhfTGRVeHZrOVVxQUxaZEphYkpOanFiUE1JUnM3RU1QaTdfVG9rZW46UzdkMGJobFd2bzRNSjh4dEp1UGNhWGJhbjdlXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<h4 data-id="heading-25">3.创建机器人</h4>
<p>前往钉钉开发者平台（需有管理员权限）：<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fdeveloper%2Ftools%2Fblog-entry%3Ftarget%3Dhttps%253A%252F%252Fopen-dev.dingtalk.com%252Ffe%252Fapp%253Fhash%253D%2525252523%252525252Fcorp%252525252Fapp%2523%252Fcorp%252Fapp%26objectId%3D2625121%26objectType%3D1%26contentType%3Dundefined" target="_blank" title="https://cloud.tencent.com/developer/tools/blog-entry?target=https%3A%2F%2Fopen-dev.dingtalk.com%2Ffe%2Fapp%3Fhash%3D%25252523%2525252Fcorp%2525252Fapp%23%2Fcorp%2Fapp&amp;objectId=2625121&amp;objectType=1&amp;contentType=undefined" ref="nofollow noopener noreferrer"><span>https://open-dev.dingtalk.com/fe/app?hash=%23%2Fcorp%2Fapp#/corp/app</span></a></p>
<p>点击<strong>创建应用</strong></p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=ZmRiNjI3ZGIwODI1YjE5ZDg2OTE3ZGVhNzA0NTZlMGZfRzg4MmNnYVNtbDdxczY5RU4yN3BnMUZiZGtNMFRPS1pfVG9rZW46SmJuR2JLTjZ1b1dCSkV4YkRwR2NMUk1mbnhkXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>选<strong>机器人</strong></p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=M2Q1NTc4ZTZlZjE3YTllMTI1MmUwYzFkMWEyMjI5Y2FfUDlVNXk3QUJpQlFaTlNYaGgzRG54NFJ3UzJ2UUNlSWtfVG9rZW46SE56a2Jqbk1GbzFZS2Z4ZGVTR2NjZ245bmljXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>完成所有必填项（其他默认）</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=NjBjZWZkNzdlZDQxNjcxYjYwNzZkYjk3OWI4ODViMmZfUFM5a1VoUTByVTNyMXRFREFSeUNSM1FOVHozdWlOQmFfVG9rZW46SEh3d2I0bFZibzVMRjl4Nk9JaGNuMlI1bjVjXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>点击 凭证与基础信息 保存好<strong>Client ID与Client Secret</strong>，后面会用到</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=NzkzYmY0YzMxNDEzMmM1NzllNWE2ZmRhMjRmYTk1YTRfTmd6OXFNZXM2T0gwVXFnT3ZlWUp6UmFVeUZicXBBNUNfVG9rZW46RTZMNGJyNmFsbzhtaDl4OWgwYmM4QnVHbktlXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>点击 <strong>查看版本详情</strong> &gt;&gt; <strong>编辑</strong></p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=M2U4NDg2ZTUxNThiMTk3YTQ5OTc0MzFkYzUyMDQwODFfTXREZldNeG1uMjlpM0xwbktOV2c4YzNta0dBSEhDV1RfVG9rZW46WjRiV2JqMVFxb1U4Y0N4YTNzMWN2eGg4bldlXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>完成所有必填项后点击<strong>保存</strong>，在弹出的窗口点击 <strong>确认发布</strong></p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=OTYxZDdlNWIyNjJkMDM2OGFiNDU3YmU0N2I4ZDFiZjFfRE44cUQ4Tzg1eldOMlUyejRGOFpuYk10YVhyWmhVdzdfVG9rZW46VnppU2JiRHZUb0NVOXd4QmFFQWNURWRpblFtXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=ZGZkNDA2ZDIyMDBkMTIwMzNmMjhhZDM0ZThhMjY1YTVfUDZ1bG9LbDVIZjlMbVYzM3NQNHBSS1BHMjZJbWk3dDhfVG9rZW46QklqTmJtNWNab2NEU1N4Vlh3QmNuWk5Ybm9qXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<h4 data-id="heading-26">4.连接机器人</h4>
<p>接下来我们需要修改Moltbot的配置文件。</p>
<p>在 Web UI 中，选择 <strong>Settings-Config-Authentication</strong>，在底部选择 <strong>Raw</strong> 方式查看配置信息。</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=MDYzYzY4YjUzZDA5OTkwZDRhZjNhNWQxNDQ2YTE0OTVfVkFraTNZRXA3Q01PMUs2V1JEc1RzM0l3eHVuaHJPSzBfVG9rZW46QWxnMWJlcDlxb2E3ZjJ4OHhSUmNaekFmbldlXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>在meta后面增加下列内容，记得把clientId和clientSecret替换为自己的实际值</p>
<pre><code class="hljs language-json" lang="json">   <span class="hljs-attr">"channels"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
     <span class="hljs-attr">"dingtalk"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
       <span class="hljs-attr">"enabled"</span> <span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span> <span class="hljs-punctuation">,</span>
       <span class="hljs-attr">"clientId"</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">"your-dingtalk-client-id"</span> <span class="hljs-punctuation">,</span>
       <span class="hljs-attr">"clientSecret"</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">"your-dingtalk-client-secret"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
</code></pre>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=NTE0ZDhjNjhiMTcyODY4YTEwZGU4ZjEwNDlmZGJlZDRfQzl5YmpNbksyZE9QY05mUzBVeFRPQ21hSzZJam9PRXZfVG9rZW46TkU3eGJlMVZhbzBqWlR4dENvRWM5N3lvbmloXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>保存后重新启动</p>
<h4 data-id="heading-27">5.验证机器人</h4>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=MWQ1MmU3MDQ2NGQxOGU1OGU0YWI5ZWJiN2E4ZTZkNDhfR0FKdmhRZDZJOFZ1b1kzYnVyUlRyYTBPYXdnWUlJOENfVG9rZW46TkNjcmJzWm1Mb0N1V3Z4bXVsSmNiRzQxbmllXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=MjQ4ZGNiZWNlNmJmYzBlODM4MjRmNzhiMjdhOGY2YTFfYmswUTBoR2swVm1ubWhKOHU0STZVNVNyQU9OTnZFZGxfVG9rZW46T2lYM2JXMUdHb3AxQ1R4cG40RWNBeGZabmtjXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<h3 data-id="heading-28">QQ Bot</h3>
<h4 data-id="heading-29">1.安装插件</h4>
<p>执行命令 <code>git clone https://github.com/sliverp/qqbot.git &amp;&amp; clawdbot plugins install ./qqbot</code> 安装QQ机器人插件</p>
<h4 data-id="heading-30">2.创建机器人</h4>
<p>在QQ开放平台创建机器人，自己使用无需企业资质，指定用户，指定群聊可访问即可 </p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fq.qq.com%2F%23%2Fapps" target="_blank" title="https://q.qq.com/#/apps" ref="nofollow noopener noreferrer">q.qq.com/#/apps</a></p>
<p>如果是新用户的话，注册流程会有点繁琐，但是没有什么难点，按照要求填写自己的个人信息就行</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=YTc1N2JkZDdlMjEyNGU2OWViOGJlYTQ2NGM1ZTVkNzJfNkh6QnNNOVJZU3JndVQ1OWFCOHpzbnprT05yODREaFZfVG9rZW46THZGMWJ5NTVib0FDOXh4eElMRmNlVThibjFkXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>注册完整之后就可以创建属于自己的机器人了：</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=OGRjMTQ4M2U1ZjQ5MjRiMzA4ZDlmNTNiNjA1ZjBhMDdfNHJkQ2xOMm5FRFdzUEJJYWVLaExOTEJIaHVJVWN0dkxfVG9rZW46REx2emJQSGUxb0RHaEx4cVdlSGNmWmRmblFmXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>点击你的机器人头像进入到机器人管理员界面</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=MWMxODU4NGVkM2ZhZjM1YjllYWQ5MDkzZjk2ZWI3NTBfdW1UOERqSGVZUU1ydnBFd1d2NUIzdEVqYVlmMnNGcTZfVG9rZW46QWZOamJ0bVJsb2xqbEJ4YkMxYWN1eE9DbkpnXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>在管理页面获取到当前机器人的AppID, 和AppSecret，这两个很重要</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=MWFmMWEwNTc2NmVjZWNkZTAxYTlmYmI2YWI3YjhiNGJfQWoxdnhaSkVFMFFLRkpBV2RNSWVqS0M3VVRJaXNlS2lfVG9rZW46TjFqOWJNUk8yb2RWZm94MDBvU2MwbHh1bmtiXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>启用QQ连接插件,填写你的AppID和AppSecret</p>
<pre><code class="hljs language-plain" lang="plain">clawdbot channels add --channel qqbot --token "&lt;AppID&gt;:&lt;AppSecret&gt;"
</code></pre>
<p>别忘了在IP白名单哪里，填上自己的服务器的公网IP哦~</p>
<p>重启gateway</p>
<pre><code class="hljs language-plain" lang="plain">clawdbot gateway restart
</code></pre>
<p>到这里就全部结束拉，在手机QQ和电脑版上均可以使用。</p>
<p><em>记得把他拉进群聊，大家一起调戏才更有意思哦~</em></p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=YTAzNzRhYjk4NjBlMGY3MzYyYTQ3YjJjYTM5MmM3NDVfRm1yc1d5amdIQ0ZlOGd6aEFEeUoxUGZCN2lNbUVVQ3ZfVG9rZW46VHNJZmJDMk5MbzVIcmF4MlAxTGN3eDJHbkViXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=MmVlYWVhNDMxZjI5ZDNkYTNmYjU0NWE1NjAxMGRjODdfMWFjQndNU1hDN3Nmem5sWE5MVnZHanR3bjh2TkpGSllfVG9rZW46TzVkVWJzS1Bkb2Z3MWJ4c1VRRmNWamNMbnlnXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<p>由于QQ开放平台的限制，在正式上线之前只能在特定范围内使用，但是已经可以愉快的跟自己的“贾维斯”聊天了，群里的小伙伴都可以使用哦，快来试试吧~<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fdeveloper%2Ftools%2Fblog-entry%3Ftarget%3Dhttps%253A%252F%252Fq.qq.com%252Fqqbot%252F%2523%252Fdeveloper%252Fsandbox%26objectId%3D2625097%26objectType%3D1%26contentType%3Drich" target="_blank" title="https://cloud.tencent.com/developer/tools/blog-entry?target=https%3A%2F%2Fq.qq.com%2Fqqbot%2F%23%2Fdeveloper%2Fsandbox&amp;objectId=2625097&amp;objectType=1&amp;contentType=rich" ref="nofollow noopener noreferrer"><span>https://q.qq.com/qqbot/#/developer/sandbox</span></a></p>
<p>找不到自己的机器人的话，可以扫描“添加成员”旁边的二维码，扫码添加机器人到自己的聊天界面</p>
<p><img src="https://my.feishu.cn/space/api/box/stream/download/asynccode/?code=ZWFlMjQyMWQ1YTBmYTJiMjBmNDBmNmVlNTRiMmRjYWZfd2NnR1NSZkRyNjZ6TzFqNmtKODVZREdNbThxVGpIOW1fVG9rZW46WTFTN2JzTHB4b3UzRmJ4QzZDeWNyS3VFbmRoXzE3Njk2NTM0ODI6MTc2OTY1NzA4Ml9WNA" alt="" loading="lazy"/></p>
<h2 data-id="heading-31"> 五、交流群</h2>
<p>添加润雨：<span> runyut </span> 拉你进MoltBot交流群哦~，记得备注哪里来的。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[花5分钟、50块体验 ClawdBot （MoltBot），值不值？]]></title>    <link>https://juejin.cn/post/7600953198745452550</link>    <guid>https://juejin.cn/post/7600953198745452550</guid>    <pubDate>2026-01-30T06:57:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600953198745452550" data-draft-id="7600953198744600582" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="花5分钟、50块体验 ClawdBot （MoltBot），值不值？"/> <meta itemprop="keywords" content="前端,人工智能"/> <meta itemprop="datePublished" content="2026-01-30T06:57:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="掘金安东尼"/> <meta itemprop="url" content="https://juejin.cn/user/1521379823340792"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            花5分钟、50块体验 ClawdBot （MoltBot），值不值？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379823340792/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    掘金安东尼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T06:57:34.000Z" title="Fri Jan 30 2026 06:57:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>普通人，能不能用极低成本，把一个能用的 ClawdBot（moltbot） 跑起来。</strong></p>
<p>花费 50 元、官方平台、尽量少折腾，最好 5 分钟内能看到效果。</p>
<p>阿里云的轻量应用服务器 + clawdbot，实测，它来了～～</p>
<h3 data-id="heading-0">阿里云 + clawdbot</h3>
<p>整个过程比预期要直给很多。</p>
<p>先是在活动页直接购买 clawdbot 套餐，配套的是一台<strong>轻量应用服务器</strong>，不需要额外选型，也不用自己拉镜像。</p>
<p>实例创建完成后，控制台里已经能看到完整的运行环境，省掉了最容易劝退新人的那一段“环境准备期”。</p>
<p>传送门：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aliyun.com%2Factivity%2Fecs%2Fclawdbot%23J_003" target="_blank" title="https://www.aliyun.com/activity/ecs/clawdbot#J_003" ref="nofollow noopener noreferrer">购买</a>
｜<a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fsimple-application-server%2Fuse-cases%2Fquickly-deploy-and-use-moltbot%3Fspm%3D5176.45303171.J_prbLYvsEQKDdDmwSsbh3D.2.2a4258acqO5uJV" target="_blank" title="https://help.aliyun.com/zh/simple-application-server/use-cases/quickly-deploy-and-use-moltbot?spm=5176.45303171.J_prbLYvsEQKDdDmwSsbh3D.2.2a4258acqO5uJV" ref="nofollow noopener noreferrer">指南</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dda86fe4d70f4b4dbd8117d0221f84b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770361054&amp;x-signature=3t9STVDX9H%2Bi5wwYBz3oGe2cLII%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-1">轻量应用服务器详情</h3>
<p>详情概览：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76e84b32be8a4f5785c80fe05539b2df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770361054&amp;x-signature=TeZjAFdm0Bu11XxdoALGIBvB2%2Bg%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">阿里云百炼平台</h3>
<p>接着按照官方指南走 2 步流程：</p>
<p>放行端口、在百炼平台生成 API Key、复制到服务器里执行初始化命令。</p>
<p>没有出现隐晦参数，基本属于复制—执行—确认状态。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf3080c901a844f098bf41651534991c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770361054&amp;x-signature=ettLuxll%2F8cu%2F1UwVllJK%2F5eDy4%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-3">放行端口</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d8dc81e58c1483897315532917f3234~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770361054&amp;x-signature=GfSiKHeLsAS3BnzfO5GkumLdXwo%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-4">复制 API Key</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf552c17b6f64856992f2eac82ccf121~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770361054&amp;x-signature=1%2B2xr%2FvMP5toAI1cZMhyDS8kQWs%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-5">执行命令</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c9627d7c0fde4eb99bcaeea480359f36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770361054&amp;x-signature=eMSJ5FEBKM%2Bv9HFDrr0Cv%2BHvWiM%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-6">开启 respond</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be8eb8e772e44f308930d6f2acd8331f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770361054&amp;x-signature=KgyGBbrG5ZfFQZKjeAEClaI9C5c%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">访问</h3>
<p>服务端口可访问的那一刻，本质上这个 Bot 已经活了。</p>
<p>不需要额外写代码，也不需要接数据库，直接通过浏览器就能看到交互界面。</p>
<p>确实，很轻便的体验～</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce3bef2918c4460f8664ad2d7b24f7f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770361054&amp;x-signature=8Lz9y3EOBRdT7%2BHOMhyO%2BX30ovU%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-8">命令</h3>
<p>本瓜随意发了一条命令：先跑着，用一段时间，再回头看值不值。</p>
<p>看看——稳定性、上下文能力、实际使用频率，以及它是否真的能嵌进日常工作流。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1267e80621f4c96898d830fdab49913~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770361054&amp;x-signature=CgXICktmqMC8pCu8KgDN%2B%2Byceeo%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-9">集成到钉钉</h3>
<p>如果继续往下走，还可以很自然地把它接进钉钉，对话入口直接落到熟悉的办公工具里，<a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fsimple-application-server%2Fuse-cases%2Fquickly-deploy-and-use-moltbot" target="_blank" title="https://help.aliyun.com/zh/simple-application-server/use-cases/quickly-deploy-and-use-moltbot" ref="nofollow noopener noreferrer">“配置”</a>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[月之暗面 Kimi Code 发布，如何上手体验？]]></title>    <link>https://juejin.cn/post/7600414546189434890</link>    <guid>https://juejin.cn/post/7600414546189434890</guid>    <pubDate>2026-01-29T08:40:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600414546189434890" data-draft-id="7600344784946446382" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="月之暗面 Kimi Code 发布，如何上手体验？"/> <meta itemprop="keywords" content="后端,AI编程"/> <meta itemprop="datePublished" content="2026-01-29T08:40:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ServBay"/> <meta itemprop="url" content="https://juejin.cn/user/3828929445244761"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            月之暗面 Kimi Code 发布，如何上手体验？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3828929445244761/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ServBay
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T08:40:27.000Z" title="Thu Jan 29 2026 08:40:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>月之暗面正式发布了 Kimi 的官方编程工具 Kimi Code。这不仅仅是一个代码生成器，而是一个可以直接在终端运行、具备自主规划能力的 AI Agent。它基于 K2.5 模型，支持多模态输入（图片和视频），并能通过 ACP（Agent Client Protocol）协议无缝集成到 VSCode、Cursor、JetBrains 和 Zed 等主流编辑器中。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa447d0a05da4cf0aaff56d6e2b94d02~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VydkJheQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770284596&amp;x-signature=1%2BpZPl%2B205Flfebz1XggvZ5mG%2BA%3D" alt="" loading="lazy"/></p>
<p>对于开发者而言，Kimi Code 实现了“阅读代码”到“执行命令”的闭环，覆盖了从构建、调试、重构到测试的端到端任务。</p>
<p>以下是关于 Kimi Code CLI 的核心功能、安装配置及高阶使用技巧。</p>
<h3 data-id="heading-0">Kimi Code CLI 是什么</h3>
<p>Kimi Code CLI 是一个运行在终端中的智能代理。与传统的对话机器人不同，它具备操作系统的执行权限。它可以：</p>
<ul>
<li>
<p><strong>阅读和编辑代码</strong>：直接修改源文件，而非仅仅给出建议。</p>
</li>
<li>
<p><strong>执行 Shell 命令</strong>：运行构建、测试脚本。</p>
</li>
<li>
<p><strong>自主规划</strong>：在遇到错误时，自动分析日志并尝试修复，形成“执行-反馈-修正”的循环。</p>
</li>
</ul>
<p>它既是一个独立的终端工具，也可以作为后端服务接入 IDE。</p>
<h3 data-id="heading-1">安装与环境配置</h3>
<p>Kimi Code CLI 依赖 Python 环境（建议版本 3.12-3.14）。</p>
<p><strong>第一步：使用 ServBay 准备 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.servbay.com%2Ffeatures%2Fpython" target="_blank" title="https://www.servbay.com/features/python" ref="nofollow noopener noreferrer">Python 环境</a></strong></p>
<p>打开 ServBay，在「软件包」中，找到并安装 <strong>Python 3.13</strong>（这是 Kimi Code 推荐的最佳兼容版本）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37620a99caa74a6a88443c6901f76fe0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VydkJheQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770284596&amp;x-signature=T1sSm5n5fxWueZoR%2FgktdRSvoMo%3D" alt="" loading="lazy"/></p>
<p>ServBay 会自动配置好环境，确保终端调用的是这个独立的 Python 版本，拥有完整的 <code>pip</code> 包管理能力。</p>
<p><strong>第二步：安装 uv 包管理器</strong></p>
<p>有了 ServBay 提供的 Python 环境后，需要先安装 <code>uv</code>。<code>uv</code> 是一个极速的 Python 包管理器，也是 Kimi Code 官方推荐的底层工具。在终端执行：</p>
<pre><code class="hljs language-bash" lang="bash">pip install uv
</code></pre>
<p><strong>第三步：安装 Kimi Code CLI</strong></p>
<p>现在 <code>uv</code> 命令已经可用了，直接使用它来安装 Kimi Code：</p>
<pre><code class="hljs language-bash" lang="bash">uv tool install --python 3.13 kimi-cli
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92c8c0b3054c451e84280fce67a117d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VydkJheQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770284596&amp;x-signature=ECmMBQU2Eg2jzTobtNCoRbSyesQ%3D" alt="" loading="lazy"/></p>
<p>安装完成后，验证是否成功：</p>
<pre><code class="hljs language-bash" lang="bash">kimi --version
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e101980cde849f39bc110979b3c4fb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VydkJheQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770284596&amp;x-signature=r1FMLxUAzlMmev%2FWJzeRNBv3BEg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">初始化与配置</h3>
<p>在项目目录下输入 <code>kimi</code> 即可启动交互界面。</p>
<p>首次使用推荐通过 <code>/login</code> 命令登录 Kimi 账号，系统会自动同步可用的模型配置。如果需要使用特定的 API Key，也可以通过 <code>/setup</code> 手动配置端点和密钥。</p>
<p><strong>项目索引</strong></p>
<p>进入一个新项目时，建议先运行 <code>/init</code>。这会让 Kimi 分析项目结构并生成 <code>AGENTS.md</code> 文件。这个文件相当于给 AI 看的“项目说明书”，能显著提升后续任务的准确率。</p>
<h3 data-id="heading-3">核心工作流</h3>
<p>Kimi Code CLI 的交互采用了类似 Shell 的混合模式，按 <code>Ctrl-X</code> 可在 <strong>Agent 模式</strong>（对话）和 <strong>Shell 模式</strong>（执行原生命令）之间切换。</p>
<h4 data-id="heading-4">1. 功能开发与重构</h4>
<p>在 Agent 模式下，直接用自然语言描述需求。Kimi 会遵循“阅读 → 修改 → 验证”的流程。</p>
<p>例如：</p>
<blockquote>
<p>“给用户列表页面添加分页功能，每页显示 20 条记录，样式参考现有的 Button 组件。”</p>
</blockquote>
<p>它会自动搜索相关文件，理解上下文，进行代码修改，并保持代码风格的一致性。</p>
<h4 data-id="heading-5">2. 排查与修复</h4>
<p>遇到报错时，可以直接粘贴错误日志，或者让 Kimi 运行测试命令。</p>
<blockquote>
<p>“运行 npm test，如果有失败的用例，请帮我分析原因并修复。”</p>
</blockquote>
<p>在处理复杂逻辑时，可以通过 <code>/model</code> 切换到支持 <strong>Thinking 模式</strong>的模型（如 k2-thinking），让 AI 在输出方案前进行更深度的逻辑推演。</p>
<h4 data-id="heading-6">3. 自动化任务</h4>
<p>对于繁琐的批量操作，CLI 优势其实挺多的，比如：</p>
<ul>
<li>
<p>把 src 目录下所有 .js 文件的 var 声明改成 const 或 let。</p>
</li>
<li>
<p>分析 logs 目录下的日志，统计接口平均响应时间。</p>
</li>
<li>
<p>把 images 目录下的 PNG 转换为 JPEG。</p>
</li>
</ul>
<h3 data-id="heading-7">高阶技巧</h3>
<ul>
<li>
<p><strong>@路径补全</strong>：在对话中输入 <code>@</code> 可以快速引用项目中的文件，例如 <code>帮我解释 @src/core/scheduler.py 的逻辑</code>。</p>
</li>
<li>
<p><strong>多模态输入</strong>：支持直接粘贴剪贴板中的图片。如果是 UI 调整任务，截图给 AI 往往比文字描述更高效。</p>
</li>
<li>
<p><strong>YOLO 模式</strong>：默认情况下，AI 的每一个文件修改和命令执行都需要用户确认。如果你在 Docker 容器或测试环境中运行，可以使用 <code>/yolo</code> 命令开启“大胆模式”，跳过所有确认步骤，实现全自动执行（生产环境慎用）。</p>
</li>
</ul>
<h3 data-id="heading-8">集成到编辑器</h3>
<p>Kimi Code 支持 ACP 协议，这意味着它不仅活在终端里，也能集成到 JetBrains 系列 IDE（IntelliJ IDEA、PyCharm、WebStorm 等）中。</p>
<p>首先需要在终端获取 Kimi 的安装路径：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">which</span> kimi
</code></pre>
<p>复制输出的路径（例如 <code>/Users/username/.local/bin/kimi</code>）。</p>
<p><strong>配置 AI 助手</strong></p>
<p>打开 IDE 的 AI 聊天面板（通常需要安装 AI Assistant 插件），在菜单中点击 <strong>"Configure ACP agents"</strong> ，添加如下配置：</p>
<pre><code class="hljs language-bash" lang="bash">{
  <span class="hljs-string">"agent_servers"</span>: {
    <span class="hljs-string">"Kimi Code CLI"</span>: {
      <span class="hljs-string">"command"</span>: <span class="hljs-string">"/Users/你的用户名/.local/bin/kimi"</span>, 
      <span class="hljs-string">"args"</span>: [<span class="hljs-string">"acp"</span>],
      <span class="hljs-string">"env"</span>: {}
    }
  }
}
</code></pre>
<p><em>注意：</em> <em><code>command</code></em> <em>必须填入第一步获取的完整绝对路径。</em></p>
<p><strong>开始使用</strong></p>
<p>保存后，在 AI 聊天的 Agent 选择器中即可看到 Kimi Code CLI。</p>
<h3 data-id="heading-9">总结</h3>
<p>Kimi Code 并没有花里胡哨的功能，但是它解决了开发者的问题，开发者不需要离开终端，就能让 AI 动手写代码。配合 ServBay 提供的稳定 Python 环境，不仅安装过程更顺畅，也能让 AI 工具在隔离的沙盒中高效运行，避免对系统造成干扰。</p>
<p>目前该工具处于技术预览阶段，建议在非生产关键路径上先行试用。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Kafka简介：了解现代分布式消息队列的基石]]></title>    <link>https://juejin.cn/post/7600260767688114202</link>    <guid>https://juejin.cn/post/7600260767688114202</guid>    <pubDate>2026-01-29T03:27:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600260767688114202" data-draft-id="7492648484967202831" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Kafka简介：了解现代分布式消息队列的基石"/> <meta itemprop="keywords" content="Kafka,消息队列,性能优化"/> <meta itemprop="datePublished" content="2026-01-29T03:27:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Go高并发架构_王工"/> <meta itemprop="url" content="https://juejin.cn/user/446863555701561"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Kafka简介：了解现代分布式消息队列的基石
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/446863555701561/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Go高并发架构_王工
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T03:27:26.000Z" title="Thu Jan 29 2026 03:27:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    28
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 引言</h2>
<p>在微服务、实时分析和云原生架构盛行的今天，<strong>分布式消息队列</strong>就像现代系统的神经网络，负责在复杂环境中高效、可靠地传递数据。而在众多消息队列技术中，Apache Kafka无疑是一颗耀眼的明星。它不仅是一个高性能的消息队列，更是一个功能强大的分布式流处理平台。想象Kafka是一条数据高速公路：它能以极高的速度和可靠性运输海量消息，支撑从实时监控到事件驱动架构的各种场景。</p>
<p>为什么选择Kafka？Kafka诞生于LinkedIn，最初用于处理每天数百万的用户事件，如今已成为Apache顶级项目，被Netflix、Uber、Airbnb等公司广泛采用。它每天能处理<strong>数万亿条消息</strong>，以低延迟和高可用性著称。相比传统消息队列（如RabbitMQ），Kafka集消息传递、数据存储和流处理于一体，提供了无与伦比的灵活性。</p>
<p>本文的目标是帮助开发者深入理解Kafka的核心优势，并通过实战经验提升应用能力。我们将从基础概念入手，剖析Kafka的特色功能，分享生产环境中的优化技巧，并揭示常见问题及解决方案。读完后，你将能更自信地在项目中驾驭Kafka。</p>
<p><strong>目标读者</strong>：如果你有1-2年的Kafka开发经验，想从基础迈向精通，这篇文章为你量身定制。让我们一起开启Kafka的探索之旅！</p>
<hr/>
<h3 data-id="heading-1">过渡</h3>
<p>在动手写代码之前，我们先打好基础，了解Kafka的核心概念和架构。这些知识就像地图，指引我们在Kafka的世界中游刃有余。</p>
<hr/>
<h2 data-id="heading-2">2. Kafka核心概念与架构</h2>
<h3 data-id="heading-3">Kafka简介</h3>
<p>Kafka于2010年诞生于LinkedIn，旨在解决海量事件流（如用户点击、页面访问）的实时处理难题。你可以把Kafka想象成一个<strong>分布式日志</strong>：消息按时间顺序追加存储，多个系统可以并行读写。它从一个简单的消息队列，逐步演变为Apache顶级项目，如今被定位为<strong>高吞吐、可扩展的流处理平台</strong>。</p>
<p><strong>核心定位</strong>：Kafka不仅仅是消息队列（像ActiveMQ），它还是一个集发布、存储和处理数据流于一体的分布式系统，适合日志聚合、实时分析等场景。</p>
<h3 data-id="heading-4">核心组件</h3>
<p>Kafka的架构由几个关键组件构成，每个组件各司其职，共同构建高效的系统：</p>
<ul>
<li><strong>Topic（主题）</strong>：消息的分类或通道，类似收件箱的标签（例如<code>user-clicks</code>）。</li>
<li><strong>Partition（分区）</strong>：主题被拆分为多个分区，用于并行处理和负载均衡，每个分区是一个有序日志。</li>
<li><strong>Producer（生产者）</strong>：向主题发送消息的客户端。</li>
<li><strong>Consumer（消费者）</strong>：从主题读取消息的客户端，通常以组的形式并行消费。</li>
<li><strong>Broker（代理）</strong>：Kafka集群中的服务器，负责存储和管理消息。</li>
<li><strong>Offset（偏移量）</strong>：分区中每条消息的唯一标识，用于追踪消费进度。</li>
<li><strong>Consumer Group（消费者组）</strong>：一组消费者，共同分担主题分区的消费任务。</li>
</ul>
<p><strong>示意图</strong>：Kafka架构概览</p>
<pre><code class="hljs language-lua" lang="lua">+<span class="hljs-comment">-----------------+        +-----------------+        +-----------------+</span>
|  生产者 <span class="hljs-number">1</span>       | <span class="hljs-comment">-----&gt; |   主题 A        | &lt;----- |  消费者 1       |</span>
|  生产者 <span class="hljs-number">2</span>       | <span class="hljs-comment">-----&gt; | (分区 0,1)      | &lt;----- |  消费者 2       |</span>
+<span class="hljs-comment">-----------------+        |   Broker 1      |        | (消费者组)      |</span>
                           +<span class="hljs-comment">-----------------+        +-----------------+</span>
                           |   Broker <span class="hljs-number">2</span>      |
                           +<span class="hljs-comment">-----------------+</span>
                           |   Broker <span class="hljs-number">3</span>      |
                           +<span class="hljs-comment">-----------------+</span>
</code></pre>
<h3 data-id="heading-5">架构优势</h3>
<p>Kafka的设计在<strong>性能</strong>、<strong>扩展性</strong>和<strong>可靠性</strong>之间取得了巧妙平衡：</p>
<ul>
<li><strong>高吞吐量</strong>：通过顺序写磁盘和<strong>零拷贝</strong>技术，Kafka每秒可处理数百万条消息，极大降低CPU开销。</li>
<li><strong>分布式设计</strong>：Broker组成集群，支持水平扩展，分区分散负载，副本保证容错。</li>
<li><strong>数据持久化</strong>：消息可存储数天甚至更久（可配置保留周期，如7天），为消费者提供可靠的缓冲。</li>
</ul>
<p><strong>表格</strong>：Kafka与传统消息队列对比</p>


































<table><thead><tr><th>特性</th><th>Kafka</th><th>传统消息队列（如RabbitMQ）</th></tr></thead><tbody><tr><td><strong>吞吐量</strong></td><td>每秒百万级</td><td>每秒千级</td></tr><tr><td>**持久"`</td><td/></tr><tr><td><strong>持久化</strong></td><td>长期存储</td><td>短期排队</td></tr><tr><td><strong>扩展性</strong></td><td>水平扩展（分区）</td><td>垂直扩展（单节点）</td></tr><tr><td><strong>适用场景</strong></td><td>流处理、日志</td><td>任务队列、RPC</td></tr></tbody></table>
<h3 data-id="heading-6">示例代码：基础生产者和消费者</h3>
<p>让我们通过一个简单的Java/Spring Boot示例，看看Kafka如何工作。以下代码实现了一个生产者发送消息到主题，以及一个消费者读取消息。</p>
<p><strong>生产者代码</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.apache.kafka.clients.producer.KafkaProducer;
<span class="hljs-keyword">import</span> org.apache.kafka.clients.producer.ProducerRecord;
<span class="hljs-keyword">import</span> java.util.Properties;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleProducer</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 配置生产者属性</span>
        <span class="hljs-type">Properties</span> <span class="hljs-variable">props</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();
        props.put(<span class="hljs-string">"bootstrap.servers"</span>, <span class="hljs-string">"localhost:9092"</span>);
        props.put(<span class="hljs-string">"key.serializer"</span>, <span class="hljs-string">"org.apache.kafka.common.serialization.StringSerializer"</span>);
        props.put(<span class="hljs-string">"value.serializer"</span>, <span class="hljs-string">"org.apache.kafka.common.serialization.StringSerializer"</span>);

        <span class="hljs-comment">// 创建生产者实例</span>
        <span class="hljs-keyword">try</span> (KafkaProducer&lt;String, String&gt; producer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">KafkaProducer</span>&lt;&gt;(props)) {
            <span class="hljs-comment">// 向test-topic发送10条消息</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
                ProducerRecord&lt;String, String&gt; record = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProducerRecord</span>&lt;&gt;(<span class="hljs-string">"test-topic"</span>, <span class="hljs-string">"key-"</span> + i, <span class="hljs-string">"Message-"</span> + i);
                producer.send(record, (metadata, exception) -&gt; {
                    <span class="hljs-keyword">if</span> (exception == <span class="hljs-literal">null</span>) {
                        System.out.println(<span class="hljs-string">"发送至分区: "</span> + metadata.partition());
                    } <span class="hljs-keyword">else</span> {
                        exception.printStackTrace();
                    }
                });
            }
        }
    }
}
</code></pre>
<p><strong>消费者代码</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.apache.kafka.clients.consumer.ConsumerRecords;
<span class="hljs-keyword">import</span> org.apache.kafka.clients.consumer.KafkaConsumer;
<span class="hljs-keyword">import</span> java.time.Duration;
<span class="hljs-keyword">import</span> java.util.Collections;
<span class="hljs-keyword">import</span> java.util.Properties;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleConsumer</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 配置消费者属性</span>
        <span class="hljs-type">Properties</span> <span class="hljs-variable">props</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();
        props.put(<span class="hljs-string">"bootstrap.servers"</span>, <span class="hljs-string">"localhost:9092"</span>);
        props.put(<span class="hljs-string">"group.id"</span>, <span class="hljs-string">"test-group"</span>);
        props.put(<span class="hljs-string">"key.deserializer"</span>, <span class="hljs-string">"org.apache.kafka.common.serialization.StringDeserializer"</span>);
        props.put(<span class="hljs-string">"value.deserializer"</span>, <span class="hljs-string">"org.apache.kafka.common.serialization.StringDeserializer"</span>);
        props.put(<span class="hljs-string">"auto.offset.reset"</span>, <span class="hljs-string">"earliest"</span>);

        <span class="hljs-comment">// 创建消费者实例</span>
        <span class="hljs-keyword">try</span> (KafkaConsumer&lt;String, String&gt; consumer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">KafkaConsumer</span>&lt;&gt;(props)) {
            <span class="hljs-comment">// 订阅主题</span>
            consumer.subscribe(Collections.singletonList(<span class="hljs-string">"test-topic"</span>));

            <span class="hljs-comment">// 循环拉取消息</span>
            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
                ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(<span class="hljs-number">100</span>));
                records.forEach(record -&gt; {
                    System.out.printf(<span class="hljs-string">"消费消息: key=%s, value=%s, 分区=%d, 偏移量=%d%n"</span>,
                            record.key(), record.value(), record.partition(), record.offset());
                });
            }
        }
    }
}
</code></pre>
<p><strong>代码说明</strong>：</p>
<ul>
<li>生产者异步发送消息，并通过回调处理成功或失败。</li>
<li>消费者通过轮询（poll）获取消息，使用组ID实现负载均衡。</li>
<li>配置项如<code>auto.offset.reset</code>决定消费者从哪里开始读取（<code>earliest</code>表示从头开始）。</li>
</ul>
<hr/>
<h3 data-id="heading-7">过渡</h3>
<p>掌握了Kafka的基础后，我们来探索它的独特功能——从极致的性能到强大的流处理能力，这些特性让Kafka在生产环境中大放异彩。</p>
<hr/>
<h2 data-id="heading-8">3. Kafka的特色功能</h2>
<h3 data-id="heading-9">高性能与低延迟</h3>
<p>Kafka的性能令人叹服，每秒可处理<strong>数百万条消息</strong>，延迟通常在毫秒级。以下是关键技术：</p>
<ul>
<li><strong>批量处理与压缩</strong>：生产者将消息打包发送，减少网络开销；压缩算法（如GZIP、Snappy）显著降低消息体积，提升吞吐量。</li>
<li><strong>零拷贝技术</strong>：Kafka直接从磁盘映射到网络缓冲区，跳过传统的数据拷贝流程，就像直接把书交给读者，而非逐页复印。</li>
</ul>
<p><strong>示意图</strong>：零拷贝与传统I/O对比</p>
<pre><code class="hljs language-rust" lang="rust">传统I/O: 磁盘 <span class="hljs-punctuation">-&gt;</span> 内核缓冲区 <span class="hljs-punctuation">-&gt;</span> 用户缓冲区 <span class="hljs-punctuation">-&gt;</span> 套接字缓冲区 <span class="hljs-punctuation">-&gt;</span> 网络
零拷贝:   磁盘 --------------------------<span class="hljs-punctuation">-&gt;</span> 套接字缓冲区 <span class="hljs-punctuation">-&gt;</span> 网络
</code></pre>
<h3 data-id="heading-10">强大的扩展性</h3>
<p>Kafka的扩展能力让它轻松应对业务增长：</p>
<ul>
<li><strong>分区扩展与重平衡</strong>：增加分区可提升吞吐量；消费者组动态加入或退出时，Kafka自动重新分配分区。</li>
<li><strong>动态Broker管理</strong>：新Broker可无缝加入集群，分区会自动重新分布。</li>
</ul>
<h3 data-id="heading-11">数据可靠性与一致性</h3>
<p>Kafka确保消息不丢失且一致性强：</p>
<ul>
<li><strong>副本与ISR</strong>：每个分区有多个副本，**同步副本（ISR）**与Leader保持一致。Broker故障时，副本可接管。</li>
<li><strong>ACK机制</strong>：生产者可选择确认级别（<code>acks=0</code>、<code>1</code>或<code>all</code>），在速度与可靠性间取舍。</li>
</ul>
<p><strong>表格</strong>：ACK模式对比</p>





























<table><thead><tr><th>模式</th><th>描述</th><th>可靠性</th><th>延迟</th></tr></thead><tbody><tr><td><code>acks=0</code></td><td>无确认</td><td>低</td><td>最快</td></tr><tr><td><code>acks=1</code></td><td>Leader确认</td><td>中</td><td>较快</td></tr><tr><td><code>acks=all</code></td><td>所有ISR确认</td><td>高</td><td>稍慢</td></tr></tbody></table>
<h3 data-id="heading-12">流处理能力</h3>
<p>Kafka不仅是消息系统，还是流处理平台。<strong>Kafka Streams</strong>是一个轻量级库，适合实时处理，如事件聚合或异常检测。</p>
<p><strong>对比</strong>：Kafka Streams与Flink/Spark</p>






























<table><thead><tr><th>特性</th><th>Kafka Streams</th><th>Flink/Spark</th></tr></thead><tbody><tr><td><strong>部署方式</strong></td><td>库（嵌入应用）</td><td>集群部署</td></tr><tr><td><strong>延迟</strong></td><td>亚秒级</td><td>秒级</td></tr><tr><td><strong>复杂度</strong></td><td>API简单</td><td>学习曲线陡</td></tr><tr><td><strong>适用场景</strong></td><td>流连接、聚合</td><td>复杂ETL、机器学习</td></tr></tbody></table>
<h3 data-id="heading-13">示例场景</h3>
<ul>
<li><strong>日志收集</strong>：Kafka的高吞吐量轻松处理每日TB级的日志数据，输送至Elasticsearch进行分析。例如，某媒体公司用Kafka实时收集用户点击日志，优化内容推荐。</li>
<li><strong>实时数据管道</strong>：在ETL流程中，Kafka作为数据源（如数据库）与目标（如数据仓库）间的缓冲，确保数据流畅可靠。</li>
</ul>
<hr/>
<h3 data-id="heading-14">过渡</h3>
<p>理论固然重要，但在生产环境中，Kafka的真正价值通过实战展现。接下来，我将分享在电商和分析项目中积累的经验，带你优化生产者、消费者和集群。</p>
<hr/>
<h2 data-id="heading-15">4. 项目实战经验与最佳实践</h2>
<p>基于我在电商订单系统和实时分析平台中使用Kafka的经验，以下是如何在实际项目中优化Kafka的技巧。</p>
<h3 data-id="heading-16">生产者优化</h3>
<p>生产者是数据的入口，优化它们对性能至关重要：</p>
<ul>
<li><strong>批量与异步发送</strong>：批量发送减少网络请求，异步模式提升应用响应速度。</li>
<li><strong>ACK与重试调优</strong>：设置<code>acks=1</code>平衡可靠性和性能，合理配置重试次数应对短暂故障。</li>
</ul>
<p><strong>示例代码</strong>：优化生产者</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.apache.kafka.clients.producer.KafkaProducer;
<span class="hljs-keyword">import</span> org.apache.kafka.clients.producer.ProducerRecord;
<span class="hljs-keyword">import</span> java.util.Properties;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OptimizedProducer</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Properties</span> <span class="hljs-variable">props</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();
        props.put(<span class="hljs-string">"bootstrap.servers"</span>, <span class="hljs-string">"localhost:9092"</span>);
        props.put(<span class="hljs-string">"key.serializer"</span>, <span class="hljs-string">"org.apache.kafka.common.serialization.StringSerializer"</span>);
        props.put(<span class="hljs-string">"value.serializer"</span>, <span class="hljs-string">"org.apache.kafka.common.serialization.StringSerializer"</span>);
        <span class="hljs-comment">// 优化配置</span>
        props.put(<span class="hljs-string">"acks"</span>, <span class="hljs-string">"1"</span>); <span class="hljs-comment">// 仅Leader确认</span>
        props.put(<span class="hljs-string">"retries"</span>, <span class="hljs-number">3</span>); <span class="hljs-comment">// 重试3次</span>
        props.put(<span class="hljs-string">"batch.size"</span>, <span class="hljs-number">16384</span>); <span class="hljs-comment">// 16KB批次</span>
        props.put(<span class="hljs-string">"linger.ms"</span>, <span class="hljs-number">5</span>); <span class="hljs-comment">// 等待5ms凑批次</span>
        props.put(<span class="hljs-string">"buffer.memory"</span>, <span class="hljs-number">33554432</span>); <span class="hljs-comment">// 32MB缓冲区</span>

        <span class="hljs-keyword">try</span> (KafkaProducer&lt;String, String&gt; producer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">KafkaProducer</span>&lt;&gt;(props)) {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
                producer.send(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ProducerRecord</span>&lt;&gt;(<span class="hljs-string">"orders"</span>, <span class="hljs-string">"order-"</span> + i, <span class="hljs-string">"Details-"</span> + i));
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-17">消费者优化</h3>
<p>消费者需要精心调优以避免瓶颈：</p>
<ul>
<li><strong>消费者组管理</strong>：利用消费者组实现水平扩展，监控重平衡以减少延迟。</li>
<li><strong>手动提交偏移量</strong>：在消息处理后再提交偏移量，避免故障导致重复消费。</li>
</ul>
<p><strong>示例代码</strong>：可靠消费者</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.apache.kafka.clients.consumer.ConsumerRecords;
<span class="hljs-keyword">import</span> org.apache.kafka.clients.consumer.KafkaConsumer;
<span class="hljs-keyword">import</span> java.time.Duration;
<span class="hljs-keyword">import</span> java.util.Collections;
<span class="hljs-keyword">import</span> java.util.Properties;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReliableConsumer</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Properties</span> <span class="hljs-variable">props</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();
        props.put(<span class="hljs-string">"bootstrap.servers"</span>, <span class="hljs-string">"localhost:9092"</span>);
        props.put(<span class="hljs-string">"group.id"</span>, <span class="hljs-string">"order-group"</span>);
        props.put(<span class="hljs-string">"enable.auto.commit"</span>, <span class="hljs-string">"false"</span>); <span class="hljs-comment">// 手动提交</span>
        props.put(<span class="hljs-string">"key.deserializer"</span>, <span class="hljs-string">"org.apache.kafka.common.serialization.StringDeserializer"</span>);
        props.put(<span class="hljs-string">"value.deserializer"</span>, <span class="hljs-string">"org.apache.kafka.common.serialization.StringDeserializer"</span>);

        <span class="hljs-keyword">try</span> (KafkaConsumer&lt;String, String&gt; consumer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">KafkaConsumer</span>&lt;&gt;(props)) {
            consumer.subscribe(Collections.singletonList(<span class="hljs-string">"orders"</span>));
            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
                ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(<span class="hljs-number">100</span>));
                records.forEach(record -&gt; {
                    <span class="hljs-keyword">try</span> {
                        <span class="hljs-comment">// 模拟业务处理</span>
                        System.out.println(<span class="hljs-string">"处理: "</span> + record.value());
                        <span class="hljs-comment">// 手动提交偏移量</span>
                        consumer.commitSync();
                    } <span class="hljs-keyword">catch</span> (Exception e) {
                        System.err.println(<span class="hljs-string">"处理错误: "</span> + e.getMessage());
                    }
                });
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-18">集群管理</h3>
<p>生产环境的Kafka需要持续监控和规划：</p>
<ul>
<li><strong>监控运维</strong>：跟踪<strong>消费者滞后（Lag）</strong>、吞吐量和Broker健康状况，使用工具如<strong>Kafka Manager</strong>或<strong>Burrow</strong>。</li>
<li><strong>容量规划</strong>：根据吞吐量（例如每分区1MB/s）和保留策略估算Broker和分区需求。</li>
</ul>
<h3 data-id="heading-19">最佳实践</h3>
<ul>
<li><strong>主题设计</strong>：根据吞吐量需求选择分区数（例如10MB/s用10个分区），副本数至少设为3以确保高可用。</li>
<li><strong>消息格式</strong>：推荐使用<strong>Avro</strong>结合Schema Registry（如Confluent提供），确保类型安全和 schema 演化。</li>
<li><strong>性能调优</strong>：调整<code>num.io.threads</code>和<code>compression.type</code>（如<code>snappy</code>）优化CPU和带宽使用。</li>
</ul>
<h3 data-id="heading-20">实际应用场景</h3>
<ul>
<li><strong>案例1：电商订单系统</strong>：Kafka传输订单事件（如<code>place-order</code>、<code>update-inventory</code>），通过<code>acks=all</code>确保低延迟和高可靠。</li>
<li><strong>案例2：实时推荐系统</strong>：用户行为数据（如点击）通过Kafka收集，Kafka Streams处理后送至机器学习模型，生成个性化推荐。</li>
</ul>
<hr/>
<h3 data-id="heading-21">过渡</h3>
<p>即使有最佳实践，Kafka部署仍可能遇到问题。接下来，我将分享常见坑点和解决方案，帮助你打造稳健的系统。</p>
<hr/>
<h2 data-id="heading-22">5. 踩坑经验与问题解决</h2>
<h3 data-id="heading-23">常见问题</h3>
<p>Kafka功能强大，但复杂性也带来挑战。以下是常见问题及应对：</p>
<ul>
<li><strong>消费者滞后堆积</strong>：原因可能是消费者处理慢或分区不足。<strong>解决</strong>：增加分区、扩展消费者或优化处理逻辑。</li>
<li><strong>消息丢失/重复消费</strong>：<code>acks=0</code>或过早提交偏移量可能导致丢失；重试或错误提交引发重复。<strong>解决</strong>：用<code>acks=all</code>和手动提交。</li>
<li><strong>集群故障</strong>：Broker宕机或网络问题触发重平衡风暴。<strong>解决</strong>：确保副本同步，监控ISR健康。</li>
</ul>
<h3 data-id="heading-24">踩坑案例</h3>
<ul>
<li><strong>案例1：热点分区</strong>：键设计不当（例如用时间戳）导致消息集中到一个分区，造成负载不均。<strong>修复</strong>：使用均衡键（如用户ID），监控分区分布。</li>
<li><strong>案例2：重复消费</strong>：自动提交偏移量在处理前完成，故障时导致重复。<strong>修复</strong>：改为处理后手动提交。</li>
<li><strong>案例3：网络抖动</strong>：间歇性延迟导致消息延迟。<strong>修复</strong>：增加<code>request.timeout.ms</code>，调优<code>replication.factor</code>。</li>
</ul>
<h3 data-id="heading-25">解决方案</h3>
<ul>
<li><strong>日志与监控</strong>：使用<strong>Prometheus</strong>和<strong>Grafana</strong>可视化滞后和吞吐量，启用调试日志快速定位问题。</li>
<li><strong>配置优化</strong>：设置<code>min.insync.replicas=2</code>提升可靠性，调整<code>max.poll.records</code>控制消费者负载。</li>
</ul>
<p><strong>示例代码</strong>：健壮消费者带重试</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.apache.kafka.clients.consumer.ConsumerRecords;
<span class="hljs-keyword">import</span> org.apache.kafka.clients.consumer.KafkaConsumer;
<span class="hljs-keyword">import</span> java.time.Duration;
<span class="hljs-keyword">import</span> java.util.Collections;
<span class="hljs-keyword">import</span> java.util.Properties;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RobustConsumer</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Properties</span> <span class="hljs-variable">props</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();
        props.put(<span class="hljs-string">"bootstrap.servers"</span>, <span class="hljs-string">"localhost:9092"</span>);
        props.put(<span class="hljs-string">"group.id"</span>, <span class="hljs-string">"robust-group"</span>);
        props.put(<span class="hljs-string">"enable.auto.commit"</span>, <span class="hljs-string">"false"</span>);
        props.put(<span class="hljs-string">"key.deserializer"</span>, <span class="hljs-string">"org.apache.kafka.common.serialization.StringDeserializer"</span>);
        props.put(<span class="hljs-string">"value.deserializer"</span>, <span class="hljs-string">"org.apache.kafka.common.serialization.StringDeserializer"</span>);

        <span class="hljs-keyword">try</span> (KafkaConsumer&lt;String, String&gt; consumer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">KafkaConsumer</span>&lt;&gt;(props)) {
            consumer.subscribe(Collections.singletonList(<span class="hljs-string">"events"</span>));
            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
                ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(<span class="hljs-number">100</span>));
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> record : records) {
                    <span class="hljs-type">int</span> <span class="hljs-variable">retries</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;
                    <span class="hljs-keyword">while</span> (retries &gt; <span class="hljs-number">0</span>) {
                        <span class="hljs-keyword">try</span> {
                            <span class="hljs-comment">// 模拟业务处理</span>
                            processRecord(record.value());
                            consumer.commitSync();
                            <span class="hljs-keyword">break</span>;
                        } <span class="hljs-keyword">catch</span> (Exception e) {
                            retries--;
                            <span class="hljs-keyword">if</span> (retries == <span class="hljs-number">0</span>) {
                                System.err.println(<span class="hljs-string">"重试失败: "</span> + e.getMessage());
                            }
                            Thread.sleep(<span class="hljs-number">1000</span>); <span class="hljs-comment">// 退避重试</span>
                        }
                    }
                }
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processRecord</span><span class="hljs-params">(String value)</span> {
        <span class="hljs-comment">// 模拟业务逻辑</span>
        System.out.println(<span class="hljs-string">"已处理: "</span> + value);
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-26">过渡</h3>
<p>了解了Kafka的优势和坑点后，让我们总结它的核心价值，展望未来趋势，并给出学习建议。</p>
<hr/>
<h2 data-id="heading-27">6. 总结与展望</h2>
<p>Kafka是现代数据管道的支柱，助力系统轻松应对海量实时数据流。它在<strong>高吞吐量</strong>、<strong>持久化</strong>和<strong>流处理</strong>上的出色表现，使其成为电商、物联网等领域的核心组件。</p>
<p><strong>未来趋势</strong>：</p>
<ul>
<li><strong>云原生融合</strong>：Kafka与Kubernetes、Serverless结合更紧密，Strimzi等工具简化部署。</li>
<li><strong>生态扩展</strong>：<strong>Kafka Connect</strong>（数据集成）和<strong>KSQL</strong>（流查询）日益流行，减少自定义开发。</li>
<li><strong>AI与分析</strong>：Kafka在向机器学习管道提供实时数据方面作用凸显，连接事件流与预测模型。</li>
</ul>
<p><strong>个人心得</strong>：用了几年的Kafka，我依然为它在压力下的稳定性惊叹。建议从简单场景入手，熟悉基础后尝试Kafka Streams，逐步解锁更多可能。</p>
<p><strong>实践建议</strong>：</p>
<ol>
<li><strong>优先监控</strong>：用Grafana等工具尽早发现问题。</li>
<li><strong>测试故障</strong>：模拟Broker宕机，验证系统健壮性。</li>
<li><strong>探索生态</strong>：尝试Kafka Connect实现开箱即用的集成。</li>
</ol>
<p>Kafka是一场旅程——大胆尝试，持续学习，构建可扩展的分布式系统！</p>
<hr/>
<h2 data-id="heading-28">附录</h2>
<h3 data-id="heading-29">推荐资源</h3>
<ul>
<li><strong>官方文档</strong>：kafka.apache.org</li>
<li><strong>Confluent社区</strong>：confluent.io（教程、Schema Registry）</li>
<li><strong>书籍</strong>：《Kafka权威指南》（Neha Narkhede等）</li>
</ul>
<h3 data-id="heading-30">常见问题FAQ</h3>
<ul>
<li><strong>问：分区数该设多少？</strong><br/>
答：低吞吐量用1-2个分区/Broker，高负载用10-20个，避免过多分区增加开销。</li>
<li><strong>问：消费者为什么滞后？</strong><br/>
答：检查处理速度，增加消费者或分区。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[执行计划跑偏，你了解背后的根因吗？]]></title>    <link>https://juejin.cn/post/7600340964084596742</link>    <guid>https://juejin.cn/post/7600340964084596742</guid>    <pubDate>2026-01-29T07:19:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600340964084596742" data-draft-id="7600430748781641771" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="执行计划跑偏，你了解背后的根因吗？"/> <meta itemprop="keywords" content="PostgreSQL,开源,数据库"/> <meta itemprop="datePublished" content="2026-01-29T07:19:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IvorySQL"/> <meta itemprop="url" content="https://juejin.cn/user/761327331579511"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            执行计划跑偏，你了解背后的根因吗？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/761327331579511/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IvorySQL
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T07:19:00.000Z" title="Thu Jan 29 2026 07:19:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>关于作者：</p>
<p>Nickyoung，数据库领域从业者。PostgreSQL ACE，IvorySQL 专家顾问委员会成员。</p>
<p>公众号“👉PostgreSQL 运维之道”。</p>
</blockquote>
<p>还在以最终 cost 来判断计划是否最优？那就大错特错了！！！本篇老杨和大家一起抽丝剥茧，从源码入手分析计划跑偏的原因。</p>
<h2 data-id="heading-0">问题现象</h2>
<p>一个简单查询运行 240s，从执行计划看耗时主要在 nestloop join，Outter 扫描了 2293 行，inner loop 扫描了 2293 次，耗时 103.1 * 2293 = 236408ms</p>
<pre><code class="hljs language-sql" lang="sql">test<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> explain analyze <span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>),zone_id <span class="hljs-keyword">from</span> instance_info <span class="hljs-keyword">where</span> instanceid <span class="hljs-keyword">in</span> (<span class="hljs-keyword">SELECT</span> instanceid
<span class="hljs-keyword">FROM</span>
    instance_info
wherevisible <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
GROUPBY
    instanceid
<span class="hljs-keyword">HAVING</span>
    <span class="hljs-built_in">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> zone_id) <span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span>) andvisible <span class="hljs-operator">=</span> <span class="hljs-number">1</span>groupby zone_id;
                                                                   QUERY PLAN                                                                    
<span class="hljs-comment">-------------------------------------------------------------------------------------------------------------------------------------------------</span>
 GroupAggregate  (cost<span class="hljs-operator">=</span><span class="hljs-number">232.45</span>.<span class="hljs-number">.232</span><span class="hljs-number">.47</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">1</span> width<span class="hljs-operator">=</span><span class="hljs-number">12</span>) (actual <span class="hljs-type">time</span><span class="hljs-operator">=</span><span class="hljs-number">244941.317</span>.<span class="hljs-number">.244942</span><span class="hljs-number">.725</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">4.00</span> loops<span class="hljs-operator">=</span><span class="hljs-number">1</span>)
   <span class="hljs-keyword">Group</span> Key: instance_info.zone_id
   Buffers: shared hit<span class="hljs-operator">=</span><span class="hljs-number">3</span>
   <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>  Sort  (cost<span class="hljs-operator">=</span><span class="hljs-number">232.45</span>.<span class="hljs-number">.232</span><span class="hljs-number">.45</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">1</span> width<span class="hljs-operator">=</span><span class="hljs-number">4</span>) (actual <span class="hljs-type">time</span><span class="hljs-operator">=</span><span class="hljs-number">244940.890</span>.<span class="hljs-number">.244941</span><span class="hljs-number">.590</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">4588.00</span> loops<span class="hljs-operator">=</span><span class="hljs-number">1</span>)
         Sort Key: instance_info.zone_id
         Sort <span class="hljs-keyword">Method</span>: quicksort  Memory: <span class="hljs-number">193</span>kB
         Buffers: shared hit<span class="hljs-operator">=</span><span class="hljs-number">3</span>
         <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>  Nested Loop  (cost<span class="hljs-operator">=</span><span class="hljs-number">200.01</span>.<span class="hljs-number">.232</span><span class="hljs-number">.44</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">1</span> width<span class="hljs-operator">=</span><span class="hljs-number">4</span>) (actual <span class="hljs-type">time</span><span class="hljs-operator">=</span><span class="hljs-number">124.292</span>.<span class="hljs-number">.244935</span><span class="hljs-number">.769</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">4588.00</span> loops<span class="hljs-operator">=</span><span class="hljs-number">1</span>)
               <span class="hljs-keyword">Join</span> <span class="hljs-keyword">Filter</span>: ((instance_info.instanceid)::text <span class="hljs-operator">=</span> (instance_info_1.instanceid)::text)
               <span class="hljs-keyword">Rows</span> Removed <span class="hljs-keyword">by</span> <span class="hljs-keyword">Join</span> <span class="hljs-keyword">Filter</span>: <span class="hljs-number">20185277</span>
               <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>  <span class="hljs-keyword">Foreign</span> Scan  (cost<span class="hljs-operator">=</span><span class="hljs-number">100.01</span>.<span class="hljs-number">.116</span><span class="hljs-number">.12</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">1</span> width<span class="hljs-operator">=</span><span class="hljs-number">146</span>) (actual <span class="hljs-type">time</span><span class="hljs-operator">=</span><span class="hljs-number">25.421</span>.<span class="hljs-number">.137</span><span class="hljs-number">.939</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">2293.00</span> loops<span class="hljs-operator">=</span><span class="hljs-number">1</span>)
                     Relations: Aggregate <span class="hljs-keyword">on</span> (instance_info instance_info_1)
               <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>  <span class="hljs-keyword">Foreign</span> Scan <span class="hljs-keyword">on</span> instance_info  (cost<span class="hljs-operator">=</span><span class="hljs-number">100.00</span>.<span class="hljs-number">.116</span><span class="hljs-number">.30</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> width<span class="hljs-operator">=</span><span class="hljs-number">150</span>) (actual <span class="hljs-type">time</span><span class="hljs-operator">=</span><span class="hljs-number">1.290</span>.<span class="hljs-number">.103</span><span class="hljs-number">.183</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">8805.00</span> loops<span class="hljs-operator">=</span><span class="hljs-number">2293</span>)
 Planning:
   Buffers: shared hit<span class="hljs-operator">=</span><span class="hljs-number">173</span>
 Planning <span class="hljs-type">Time</span>: <span class="hljs-number">1.516</span> ms
 Execution <span class="hljs-type">Time</span>: <span class="hljs-number">244953.762</span> ms
(<span class="hljs-number">17</span> <span class="hljs-keyword">rows</span>)

test<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span>
</code></pre>
<p>一般遇到这种情况，肯定是尝试“关闭”nestloop 试试看，走了 Hashjoin 后执行耗时仅 287ms，性能提升快 1000 倍。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">test</span>=&gt; set enable_nestloop to<span class="hljs-literal">off</span><span class="hljs-comment">;</span>
SET
<span class="hljs-attr">test</span>=&gt; explain analyze select count(*),zone_id from instance_info where instanceid in (SELECT instanceid
FROM
    instance_info
<span class="hljs-attr">wherevisible</span> = <span class="hljs-number">1</span>
GROUPBY
    instanceid
HAVING
    COUNT(DISTINCT zone_id) &gt; 1) <span class="hljs-attr">andvisible</span> = <span class="hljs-number">1</span>groupby zone_id<span class="hljs-comment">;</span>
                                                                  QUERY PLAN                                                                  
----------------------------------------------------------------------------------------------------------------------------------------------
 GroupAggregate  (<span class="hljs-attr">cost</span>=<span class="hljs-number">232.44</span>..<span class="hljs-number">232.46</span> rows=<span class="hljs-number">1</span> width=<span class="hljs-number">12</span>) (actual time=<span class="hljs-number">273.475</span>..<span class="hljs-number">274.907</span> rows=<span class="hljs-number">4.00</span> loops=<span class="hljs-number">1</span>)
   Group Key: instance_info.zone_id
   Buffers: shared <span class="hljs-attr">hit</span>=<span class="hljs-number">3</span>
   -&gt;  Sort  (<span class="hljs-attr">cost</span>=<span class="hljs-number">232.44</span>..<span class="hljs-number">232.45</span> rows=<span class="hljs-number">1</span> width=<span class="hljs-number">4</span>) (actual time=<span class="hljs-number">273.006</span>..<span class="hljs-number">273.722</span> rows=<span class="hljs-number">4588.00</span> loops=<span class="hljs-number">1</span>)
         Sort Key: instance_info.zone_id
         Sort Method: quicksort  Memory: 193kB
         Buffers: shared <span class="hljs-attr">hit</span>=<span class="hljs-number">3</span>
         -&gt;  Hash Join  (<span class="hljs-attr">cost</span>=<span class="hljs-number">216.13</span>..<span class="hljs-number">232.43</span> rows=<span class="hljs-number">1</span> width=<span class="hljs-number">4</span>) (actual time=<span class="hljs-number">160.901</span>..<span class="hljs-number">271.843</span> rows=<span class="hljs-number">4588.00</span> loops=<span class="hljs-number">1</span>)
               Hash Cond: ((instance_info.instanceid)::<span class="hljs-attr">text</span> = (instance_info_1.instanceid)::text)
               -&gt;  Foreign Scan on instance_info  (<span class="hljs-attr">cost</span>=<span class="hljs-number">100.00</span>..<span class="hljs-number">116.30</span> rows=<span class="hljs-number">2</span> width=<span class="hljs-number">150</span>) (actual time=<span class="hljs-number">4.691</span>..<span class="hljs-number">109.722</span> rows=<span class="hljs-number">8805.00</span> loops=<span class="hljs-number">1</span>)
               -&gt;  Hash  (<span class="hljs-attr">cost</span>=<span class="hljs-number">116.12</span>..<span class="hljs-number">116.12</span> rows=<span class="hljs-number">1</span> width=<span class="hljs-number">146</span>) (actual time=<span class="hljs-number">156.185</span>..<span class="hljs-number">156.186</span> rows=<span class="hljs-number">2293.00</span> loops=<span class="hljs-number">1</span>)
                     Buckets: 4096 (originally 1024)  Batches: 1 (originally 1)  Memory Usage: 144kB
                     -&gt;  Foreign Scan  (<span class="hljs-attr">cost</span>=<span class="hljs-number">100.01</span>..<span class="hljs-number">116.12</span> rows=<span class="hljs-number">1</span> width=<span class="hljs-number">146</span>) (actual time=<span class="hljs-number">21.939</span>..<span class="hljs-number">155.037</span> rows=<span class="hljs-number">2293.00</span> loops=<span class="hljs-number">1</span>)
                           Relations: Aggregate on (instance_info instance_info_1)
 Planning Time: 0.242 ms
 Execution Time: 287.414 ms
(16 rows)

<span class="hljs-attr">test</span>=&gt; 
</code></pre>
<p>为什么优化器走了效率更差的 nested loop？</p>
<p>统计信息不准？优化器代价计算偏差？</p>
<h2 data-id="heading-1">问题分析</h2>
<p>从 nestloop 和 Hashjoin 对应 path 的最终 cost 来看</p>
<p>GroupAggregate  (cost=232.45..232.47）</p>
<p>GroupAggregate  (cost=232.44..232.46)</p>
<p>后者对应 path 最终的 startup_cost 和 total_cost 都要小，为什么优化器没有选择 Hashjoin 这条路径？</p>
<p>所以这里会有一个误区：老杨也曾以为优化器选择最优执行计划，肯定是生成每种路径后，比较最终的 cost，最终 cost 最小的为最优计划。</p>
<p>事实上在 add_path 生成路径的过程中，每个节点都会进行 cost 比较，可能采用 new_path，或者保留 old_path，或者都保留。比如说在生成 Joinpath 时，可能只保留了一种 JoinMethod 进入下一计划节点，生成最终执行计划。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4728c512ba0a4b749093f7e654bbd4ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZvcnlTUUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770275940&amp;x-signature=j32UdIfzHmtVp1jlu9dQWctHw2I%3D" alt="01.png" loading="lazy"/></p>
<p>那么这个案例中有没有可能是 Hashjoin 在 Joinpath 环节被“淘汰了”？</p>
<p>Nested Loop  (cost=200.01..232.44 rows=1 width=4)</p>
<p>Hash Join  (cost=216.13..232.43 rows=1 width=4)</p>
<p>从 cost 来看，两种路径的 cost 比较接近，由于之前研究过这里，我已经大概猜到问题的原因了。</p>
<p>在 add_path 生成路径时，首先使用模糊 cost 比较来决定路径的去留。</p>
<p>cost 模糊比较函数为<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpostgres%2Fpostgres%2Fblob%2FREL_18_0%2Fsrc%2Fbackend%2Foptimizer%2Futil%2Fpathnode.c%23L185" title="https://github.com/postgres/postgres/blob/REL_18_0/src/backend/optimizer/util/pathnode.c#L185" target="_blank" ref="nofollow noopener noreferrer">compare_path_costs_fuzzily</a>
[1]
：</p>
<p>path1 即 new_path 为 HashPath，path2 即 old_path 为 NestPath。</p>
<ul>
<li><strong>首先比较两条路径的 disabled_nodes</strong>。</li>
</ul>
<p>enable_nestloop 和 enable_hashjoin 均为 on，所以 disabled_nodes 均为 0。</p>
<ul>
<li>
<p><strong>若未果，再比较 total_cost，并通过模糊系数将路径 cost 提升 1%，和另外一条路径比较</strong>。</p>
<p>232.43 &gt; 232.44 _ 1.01 和 232.44 &gt; 232.43 _ 1.01 均不成立，total_cost 模糊近似。</p>
</li>
<li>
<p><strong>若未果，再比较 startup_cost，并通过模糊系数将路径 cost 提升 1%，和另外一条路径比较</strong>。</p>
<p>216.13 &gt; 200.01 * 1.01 所以返回 COSTS_BETTER2。</p>
</li>
</ul>
<p>经过比较确定两条路径中更优路径为 NestPath。 那么 HashPath 就被淘汰了，然后进行后续 SORT 和 AGG 节点的 path 生成。</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">static</span> PathCostComparison
<span class="hljs-title function_ invoke__">compare_path_costs_fuzzily</span>(Path *path1, Path *path2, double fuzz_factor)
{
#define <span class="hljs-title function_ invoke__">CONSIDER_PATH_STARTUP_COST</span>(p)  \
 ((p)<span class="hljs-punctuation">-&gt;</span>param_info == NULL ? (p)<span class="hljs-punctuation">-&gt;</span>parent<span class="hljs-punctuation">-&gt;</span>consider_startup : (p)<span class="hljs-punctuation">-&gt;</span>parent<span class="hljs-punctuation">-&gt;</span>consider_param_startup)

<span class="hljs-comment">/* Number of disabled nodes, if different, trumps all else. */</span>
<span class="hljs-title function_ invoke__">if</span> (<span class="hljs-title function_ invoke__">unlikely</span>(path1<span class="hljs-punctuation">-&gt;</span>disabled_nodes != path2<span class="hljs-punctuation">-&gt;</span>disabled_nodes))
 {
<span class="hljs-title function_ invoke__">if</span> (path1<span class="hljs-punctuation">-&gt;</span>disabled_nodes &lt; path2<span class="hljs-punctuation">-&gt;</span>disabled_nodes)
   <span class="hljs-keyword">return</span> COSTS_BETTER1;
<span class="hljs-keyword">else</span>
   <span class="hljs-keyword">return</span> COSTS_BETTER2;
 }

<span class="hljs-comment">/*
  * Check total cost first since it's more likely to be different; many
  * paths have zero startup cost.
  */</span>
<span class="hljs-title function_ invoke__">if</span> (path1<span class="hljs-punctuation">-&gt;</span>total_cost &gt; path2<span class="hljs-punctuation">-&gt;</span>total_cost * fuzz_factor)
 {
<span class="hljs-comment">/* path1 fuzzily worse on total cost */</span>
<span class="hljs-title function_ invoke__">if</span> (<span class="hljs-title function_ invoke__">CONSIDER_PATH_STARTUP_COST</span>(path1) &amp;&amp;
   path2<span class="hljs-punctuation">-&gt;</span>startup_cost &gt; path1<span class="hljs-punctuation">-&gt;</span>startup_cost * fuzz_factor)
  {
   <span class="hljs-comment">/* ... but path2 fuzzily worse on startup, so DIFFERENT */</span>
   <span class="hljs-keyword">return</span> COSTS_DIFFERENT;
  }
<span class="hljs-comment">/* else path2 dominates */</span>
<span class="hljs-keyword">return</span> COSTS_BETTER2;
 }
<span class="hljs-title function_ invoke__">if</span> (path2<span class="hljs-punctuation">-&gt;</span>total_cost &gt; path1<span class="hljs-punctuation">-&gt;</span>total_cost * fuzz_factor)
 {
<span class="hljs-comment">/* path2 fuzzily worse on total cost */</span>
<span class="hljs-title function_ invoke__">if</span> (<span class="hljs-title function_ invoke__">CONSIDER_PATH_STARTUP_COST</span>(path2) &amp;&amp;
   path1<span class="hljs-punctuation">-&gt;</span>startup_cost &gt; path2<span class="hljs-punctuation">-&gt;</span>startup_cost * fuzz_factor)
  {
   <span class="hljs-comment">/* ... but path1 fuzzily worse on startup, so DIFFERENT */</span>
   <span class="hljs-keyword">return</span> COSTS_DIFFERENT;
  }
<span class="hljs-comment">/* else path1 dominates */</span>
<span class="hljs-keyword">return</span> COSTS_BETTER1;
 }
<span class="hljs-comment">/* fuzzily the same on total cost ... */</span>
<span class="hljs-title function_ invoke__">if</span> (path1<span class="hljs-punctuation">-&gt;</span>startup_cost &gt; path2<span class="hljs-punctuation">-&gt;</span>startup_cost * fuzz_factor)
 {
<span class="hljs-comment">/* ... but path1 fuzzily worse on startup, so path2 wins */</span>
<span class="hljs-keyword">return</span> COSTS_BETTER2;
 }
<span class="hljs-title function_ invoke__">if</span> (path2<span class="hljs-punctuation">-&gt;</span>startup_cost &gt; path1<span class="hljs-punctuation">-&gt;</span>startup_cost * fuzz_factor)
 {
<span class="hljs-comment">/* ... but path2 fuzzily worse on startup, so path1 wins */</span>
<span class="hljs-keyword">return</span> COSTS_BETTER1;
 }
<span class="hljs-comment">/* fuzzily the same on both costs */</span>
<span class="hljs-keyword">return</span> COSTS_EQUAL;

#undef CONSIDER_PATH_STARTUP_COST
}
</code></pre>
<p><strong>debug 做下验证：</strong></p>
<p>在生成 Joinpath 时，依次生成 MergePath、NestPath、HashPath 并进行 cost 模糊比较。</p>
<p>这里省去 MergePath 和 NestPath 的比较过程，NestPath 胜出。</p>
<p>当生成 HashPath 后，和 NestPath 比较 Total_cost 差异并未达到 1%。而进一步比较 startup_cost，明显差异大于 1%所以返回 COSTS_BETTER2，即 NestPath 胜出。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7443200633b4a21be0d517f218be3c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZvcnlTUUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770275940&amp;x-signature=hJVzPv3TJfGQOVq%2Bm7PIs2kKmSE%3D" alt="02.png" loading="lazy"/></p>
<p>case COSTS_BETTER2：当前满足 outercmp == BMS_EQUAL 等条件，将 accept_new 置为 false.</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a256a3c5c414b4880d03201ca35b280~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZvcnlTUUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770275940&amp;x-signature=GaT4cc9FswIrHqh4hVpdS%2BFHDRA%3D" alt="03.png" loading="lazy"/></p>
<p>accept_new 为 false，所以拒绝并且回收了 new_path，也就是 HashPath 被淘汰了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3751ee09745f4e909d442f330bafe277~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZvcnlTUUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770275940&amp;x-signature=OM3pS9wlkwU3Fun9jZjyiJt2E9I%3D" alt="04.png" loading="lazy"/></p>
<p>经过 cost 精确比较，角逐出 cheapest_total_cost 和 cheapest_startup_cost 都为 NestPath。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d57cfd17a19e4e9386a014cf4930d7e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZvcnlTUUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770275940&amp;x-signature=zLSLKyW0ll%2F1pSdGNtD0Fd0PpUU%3D" alt="05.png" loading="lazy"/></p>
<p>最终，使用 best_path 去生成执行计划。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d201c3a08d38450e852cfac3cd57ff1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZvcnlTUUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770275940&amp;x-signature=2bgIDJ4U%2BzAPDg57mFX9aKtLERg%3D" alt="06.png" loading="lazy"/></p>
<p>到这里，<strong>大家已经感觉到这个 cost 模糊比较有坑了吧，特别当两条路径的 cost 差别比较小，total_cost 或者 startup_cost 差别小于 1%时，可能会导致选错路径，最终生成了一个次优计划。</strong></p>
<p>STD_FUZZ_FACTOR 默认就是 1.01，是不是可以把它调整得更小，这样就能更精准？但得慎重，这里也是优化器最核心的部分，弄不好真是牵一发则动全身。我觉得这个模糊比较目前看起来不太优雅，甚至后续版本有可能去除这里的逻辑，当然各位有想法的话可以发到社区和 Tom Lane 一众大佬 solo 下。</p>
<p>当然不能指望优化器一直都是最正确的，这是违背现实的，我之前也写了很多篇文章，多次分享相关的内容。</p>
<p>ok，那么为什么这个 case 走了不优计划，大家应该都清楚了。可能已经有朋友看出来还有点小问题，Foreign table 预估扫描 1 行，实际扫描了 2000+行，肯定是统计信息不准啊？</p>
<p>大家思考下 Foreign table 有统计信息吗？</p>
<p>sure，篇幅问题，我简述下原理：Foreign table 只是表映射，没有物理元组，它的统计信息，是通过 fdw 访问目的端表进行采集的。 但是只能手动挡，因为 Foreign table 没法进行 vacuum/autovacuum，需要手动 analyze 触发。</p>
<p>示例的表我做了下 analyze，更新了下统计信息，各种 path 的 cost 差异比较大，默认走了 Hashjoin。</p>
<p>因此，一定要定时收集外表统计信息，不然可能会拖垮整个实例。</p>
<h2 data-id="heading-2">小结</h2>
<p>本篇我们分析了一例执行计划跑偏的根本原因，从中看得到当路径间的 cost 接近时（1%以下），可能在 add_path 时 cost 模糊比较中会选择次优路径，生成不优计划。</p>
<p>当然遇到这样的场景可以尝试各种 hint 手段去干预，不过可以考虑利用强化学习来实现自动化的 hint 干预，让数据库自动管理执行计划。我在之前的文章《AI4DB 试玩-Bao/Balsa 适配 PG18》中研究过类似的模型，并在 PCC2025 大会中做了分享。</p>
<p>当然专业的事要专业的人来做，我们的好友崔鹏博士已有相关的 AI4DB 课题研究和落地，将会在 HOW2026 大会中与大家见面，敬请期待。</p>
<hr/>
<h2 data-id="heading-3"><a href="https://link.juejin.cn?target=https%3A%2F%2Fjsj.top%2Ff%2FuebqBc" target="_blank" title="https://jsj.top/f/uebqBc" ref="nofollow noopener noreferrer">HOW 2026 议题招募中</a></h2>
<p>2026 年 4 月 27-28 日，由 IvorySQL 社区联合 PGEU（欧洲 PG 社区）、PGAsia（亚洲 PG 社区）共同打造的 HOW 2026（IvorySQL &amp; PostgreSQL 技术峰会） 将再度落地济南。届时，PostgreSQL 联合创始人 Bruce Momjian 等顶级大师将亲临现场。</p>
<p>自开启征集以来，HOW 2026 筹备组已感受到来自全球 PostgreSQL 爱好者的澎湃热情。为了确保大会议题的深度与广度，我们诚邀您在 2026 年 2 月 27 日截止日期前，提交您的技术见解。</p>
<p>投递链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fjsj.top%2Ff%2FuebqBc" target="_blank" title="https://jsj.top/f/uebqBc" ref="nofollow noopener noreferrer">jsj.top/f/uebqBc</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[什么是 Java 反射机制？为什么反射慢？]]></title>    <link>https://juejin.cn/post/7600681071714811904</link>    <guid>https://juejin.cn/post/7600681071714811904</guid>    <pubDate>2026-01-30T03:59:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600681071714811904" data-draft-id="7600681071714795520" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="什么是 Java 反射机制？为什么反射慢？"/> <meta itemprop="keywords" content="面试"/> <meta itemprop="datePublished" content="2026-01-30T03:59:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Vin_evail"/> <meta itemprop="url" content="https://juejin.cn/user/3974048659038618"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            什么是 Java 反射机制？为什么反射慢？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3974048659038618/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Vin_evail
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T03:59:13.000Z" title="Fri Jan 30 2026 03:59:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">什么是 Java 反射机制？为什么反射慢？</h2>
<p>2026年01月30日</p>
<h3 data-id="heading-1">面试考察点</h3>
<p>当面试官询问 “什么是 Java 反射机制？为什么反射慢？” 时，他不仅仅是在考察一个简单的概念，其核心意图通常包括以下几点：</p>
<ol>
<li><strong>对 Java 语言核心机制的理解深度</strong>：面试官想确认你是否理解 Java 运行时类型信息（RTTI）的实现方式之一，能否清晰阐述反射的基本概念和作用。</li>
<li><strong>探究技术原理的洞察力</strong>：面试官不仅仅是想知道反射“慢”，更是想知道<strong>你为什么知道它慢</strong>，即你是否了解其性能开销的具体来源和 JVM 层面的底层原因。</li>
<li><strong>工程实践中的权衡能力</strong>：通过询问“为什么慢”，间接考察你是否在实际开发中具备性能意识，能否在 “灵活性” 和 “性能” 之间做出合理取舍。</li>
<li><strong>对框架原理的理解基础</strong>：反射是众多主流框架（如 Spring、MyBatis）的基石。理解反射有助于理解这些框架是如何工作的。</li>
</ol>
<h3 data-id="heading-2">核心答案</h3>
<p>Java 反射机制是指在程序<strong>运行状态</strong>中，对于任意一个类，都能够动态地获取其属性和方法等信息（即 <code>Class</code> 对象），并能够动态地调用其方法、操作其属性。这种 “动态性” 使得我们可以在编译期未知具体类的情况下，运行期进行探索和操作。</p>
<p>反射之所以 “慢”，主要原因在于：</p>
<ol>
<li><strong>JVM 无法优化</strong>：反射调用阻碍了 JVM 的许多编译时和运行时优化，如方法内联。</li>
<li><strong>安全检查开销</strong>：每次反射操作都需要进行严格的权限和安全检查（如 <code>AccessibleObject.setAccessible(true)</code> 可以绕过，但需谨慎）。</li>
<li><strong>动态解析</strong>：方法名、参数类型等信息需要在运行时解析，而非编译时确定。</li>
<li><strong>参数装箱与拆箱</strong>：反射调用方法时，参数需要以 <code>Object</code> 数组传递，涉及频繁的装箱/拆箱和数组创建。</li>
</ol>
<h3 data-id="heading-3">深度解析</h3>
<h4 data-id="heading-4">原理/机制</h4>
<p>每个被 JVM 加载的类，在堆中都会有一个唯一的 <code>java.lang.Class</code> 对象。这个 <code>Class</code> 对象就像这个类的“蓝图”，包含了该类的所有结构信息：字段（<code>Field</code>）、方法（<code>Method</code>）、构造器（<code>Constructor</code>）、父类、接口等。反射 API（位于 <code>java.lang.reflect</code> 包）就是通过操作这个 <code>Class</code> 对象来“反推出”类的原始结构并与之交互。这是 Java 实现动态性的核心支持。</p>
<h4 data-id="heading-5"><strong>代码示例：反射 vs 正常调用</strong></h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">import</span> java.lang.reflect.Method;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReflectionDemo</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">normalCall</span><span class="hljs-params">(<span class="hljs-type">String</span> msg)</span> </span>{
        <span class="hljs-comment">// 编译时即可确定方法调用，JVM 可充分优化</span>
        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">"Normal: "</span> + msg);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">reflectionCall</span><span class="hljs-params">(<span class="hljs-type">String</span> msg)</span> throws Exception </span>{
        <span class="hljs-comment">// 运行时动态查找并调用方法</span>
        Class&lt;?&gt; clazz = ReflectionDemo.<span class="hljs-keyword">class</span>;
        Method method = clazz.<span class="hljs-built_in">getDeclaredMethod</span>(<span class="hljs-string">"normalCall"</span>, <span class="hljs-type">String</span>.<span class="hljs-keyword">class</span>);
        method.<span class="hljs-built_in">invoke</span>(null, msg); <span class="hljs-comment">//  invoke 是可变参数，内部会封装成 Object[]</span>
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> throws Exception </span>{
        <span class="hljs-type">long</span> start, end;
        <span class="hljs-type">int</span> times = <span class="hljs-number">1000000</span>;

        <span class="hljs-comment">// 1. 正常调用</span>
        start = System.<span class="hljs-built_in">currentTimeMillis</span>();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; times; i++) {
            <span class="hljs-built_in">normalCall</span>(<span class="hljs-string">"Hello"</span>);
        }
        end = System.<span class="hljs-built_in">currentTimeMillis</span>();
        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">"正常调用耗时："</span> + (end - start) + <span class="hljs-string">" ms"</span>);

        <span class="hljs-comment">// 2. 反射调用（无缓存）</span>
        start = System.<span class="hljs-built_in">currentTimeMillis</span>();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; times; i++) {
            <span class="hljs-built_in">reflectionCall</span>(<span class="hljs-string">"Hello"</span>);
        }
        end = System.<span class="hljs-built_in">currentTimeMillis</span>();
        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">"反射调用耗时："</span> + (end - start) + <span class="hljs-string">" ms"</span>);
    }
}
</code></pre>
<p>运行上述代码，你可以直观地看到性能差距（通常反射会慢一个数量级以上）。</p>
<h4 data-id="heading-6"><strong>为什么反射慢？深度拆解</strong></h4>
<ol>
<li>
<p><strong>方法内联失效</strong>：JIT 编译器的一个重要优化是<strong>方法内联</strong>。对于直接调用，JIT 可以判断热点方法并将其代码“内联”到调用处，消除调用开销。但 <code>Method.invoke</code> 是一个由本地方法实现的、通用且复杂的分发器，JIT 无法看到其背后的具体目标方法，因此无法进行内联。</p>
</li>
<li>
<p><strong>运行时解析与查找</strong>：每次 <code>getMethod</code> 和 <code>invoke</code> 都需要 JVM 在类的元数据中进行字符串匹配和查找，这是一个相对耗时的过程。尽管可以缓存 <code>Method</code> 对象来避免重复查找，但 <code>invoke</code> 本身的调用开销依然存在。</p>
</li>
<li>
<p><strong>本地方法调用与安全检查</strong>：<code>Method.invoke()</code> 的最终实现在本地代码（Native Code）中。每次调用都需要从 Java 层切换到本地层，这本身就有上下文切换开销。此外，默认情况下，它需要调用 <code>AccessibleObject.checkAccess</code> 方法进行可见性检查。</p>
</li>
<li>
<p><strong>参数处理的抽象成本</strong>：</p>
<ul>
<li><code>invoke</code> 接受一个 <code>Object...</code> 参数数组。这意味着所有基本类型参数都需要被<strong>装箱</strong>成 <code>Integer</code>、<code>Double</code> 等对象。</li>
<li>JVM 需要将传入的数组解包，并检查参数类型是否与方法签名匹配，然后将它们传递给真正的本地方法。</li>
<li>调用完成后，如果返回基本类型，还需要<strong>拆箱</strong>。</li>
</ul>
</li>
</ol>
<h4 data-id="heading-7"><strong>最佳实践与常见误区</strong></h4>
<ul>
<li>
<p><strong>最佳实践</strong>：</p>
<ol>
<li><strong>缓存</strong>：这是最重要的优化手段。一旦通过反射获取到 <code>Class</code>、<code>Method</code>、<code>Field</code> 等对象，就应该将它们缓存起来，避免在循环或高频调用中重复查找。</li>
<li><strong>谨慎使用 <code>setAccessible(true)</code></strong> ：这可以关闭安全检查，带来显著的性能提升（在 JDK 8 及之前尤其明显）。但会破坏封装性，并可能带来安全隐患，仅在对性能有极致要求且明确知道后果的场景下使用。</li>
<li><strong>权衡使用</strong>：明确反射的使用场景，如框架开发、动态代理、注解处理器等。在普通的业务代码中，应优先使用直接的 API 调用。</li>
<li><strong>考虑替代方案</strong>：在 JDK 9+ 中，可以考虑 <code>java.lang.invoke</code> 包下的 <code>MethodHandle</code>，它在某些场景下性能优于反射，并得到了 JVM 更多的优化支持。</li>
</ol>
</li>
<li>
<p><strong>常见误区</strong>：</p>
<ul>
<li><strong>“反射一定不能用”</strong> ：不对。反射是强大的工具，许多基础框架离不开它。关键在于“正确使用”。</li>
<li><strong>“只要缓存了 <code>Method</code> 就不慢了”</strong> ：不准确。缓存只能消除查找开销，但 <code>invoke</code> 的调用开销、参数处理开销和优化阻碍依然存在，相比直接调用仍有显著差距。</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-8"><strong>【总结】</strong></h3>
<p>Java 反射机制提供了强大的运行时动态能力，是许多框架的基石，但其性能代价主要源于 <strong>JVM 优化受阻、运行时的安全检查与解析、以及繁琐的参数处理过程</strong>；在实际开发中，应通过缓存 <code>Method</code> 等对象来优化，并严格限定其使用边界，在灵活性与性能之间做出明智权衡。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[智能巡检部署]]></title>    <link>https://juejin.cn/post/7600603245396082728</link>    <guid>https://juejin.cn/post/7600603245396082728</guid>    <pubDate>2026-01-29T10:11:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600603245396082728" data-draft-id="7600342201794560015" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="智能巡检部署"/> <meta itemprop="keywords" content="Linux,Python"/> <meta itemprop="datePublished" content="2026-01-29T10:11:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="恰饭小男孩"/> <meta itemprop="url" content="https://juejin.cn/user/1007625803672606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            智能巡检部署
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1007625803672606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    恰饭小男孩
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T10:11:54.000Z" title="Thu Jan 29 2026 10:11:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、背景介绍</h2>
<p>    哈喽啊，小饼好久没发文章了，个人原因最近工作比较繁忙，这段时间也换了新岗位。慢慢腾出一点时间去做巡检工作。</p>
<p>我突然发现一个个去巡检设备好麻烦，突然想到自己弄一个脚本去代替我人工，如果也有想和我一样偷懒的小伙伴，就去和我一样实践起来吧</p>
<h3 data-id="heading-1">1、环境准备</h3>
<blockquote>
<p>三台虚拟机，ansible服务器端+客户端+客户端。我们大部分操作都在服务端去执行</p>
</blockquote>
<h4 data-id="heading-2">1.1、安装ansible</h4>
<p>1、<code>yum install -y http://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</code>  ##添加ansible的yum源</p>
<p>2<code> yum install -y ansible</code> ##安装ansible</p>
<blockquote>
<p>这里给大家温习一下ansible的配置文件</p>
</blockquote>
<blockquote>
<p>1、默认配置文件:/etc/ansible/ansible.cfg，一般不用它</p>
<p>2，./ansible.cfg，当前工作路径下的配置文件，推荐。</p>
<p>3，~/.ansible.cfg，当前用户家目录下的配置文件(隐藏的）</p>
<p>4，/etc/ansible/ansible.cfg，默认配置文件</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e56f4d7070c48a9b1af9614a5c9fe93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGw6aWt5bCP55S35a2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770350119&amp;x-signature=Auxcstsd40EdKm3LC76xVwJewXY%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db6f4e14a498479b8414eaccd3eabed6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGw6aWt5bCP55S35a2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770350119&amp;x-signature=do6%2Bn4yvJydL2RnqAON7r51jS4o%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-3">1.2、配置无密钥认证</h4>
<p><code>mkdir ./ansible</code>   ##此时我是在/root/ansible/
<code>ssh-keygen</code>    ##获取加密密钥</p>
<p><code>ssh-copy-id root@serverb</code>   ##分发给服务器</p>
<p><code>ssh-copy-id root@serverc</code>    ##分发给服务器</p>
<p><code>ssh-copy-id root@serverd</code>   ##分发给服务器</p>
<h4 data-id="heading-4">1.3、自定义配置文件</h4>
<blockquote>
<p>这里我建议大家配置ansible使用一个专用的ansible用户去配置。我是懒得不行，就用超级管理员去做了。大家用普通用户提权去做</p>
</blockquote>
<blockquote>
<p>#在工作路径，自定义配置文件
vi ./ansible.cfg</p>
</blockquote>
<p>[defaults]</p>
<p>inventory = ./inventory</p>
<p>[privilege_escalation]
become = true</p>
<p>become method =sudo</p>
<p>become user = root</p>
<p>become ask pass = true</p>
<h4 data-id="heading-5">1.4、自定义主机清单</h4>
<p><code>vim ./inventory</code></p>
<p><code>[work]</code></p>
<p><code>serverb</code></p>
<p><code>serverc</code></p>
<p><code>serverd</code></p>
<h5 data-id="heading-6">验证一下 ansible work --list-hosts</h5>
<blockquote>
<p>ansible work  -m ping</p>
</blockquote>
<h3 data-id="heading-7">2、在服务端配置巡检脚本 *****很重要！！！</h3>
<blockquote>
<p>将文件存放在/root/ansible中</p>
</blockquote>
<pre><code class="hljs language-#!/bin/bash" lang="#!/bin/bash"># ================ SysCheck 2.0 服务器运维巡检脚本 ================
#  作者：yy
# ===============================================================

# --- 基础配置 ---
# 自动检测终端颜色
if [ -t 1 ]; then
    RED="\033[91m"
    GREEN="\033[92m"
    YELLOW="\033[93m"
    BLUE="\033[94m"
    BOLD="\033[1m"
    NC="\033[0m"
else
    RED=""; GREEN=""; YELLOW=""; BLUE=""; BOLD=""; NC=""
fi

print_title() {
    echo -e "\n${BLUE}${BOLD}════════════════════════════════════════════════════════════${NC}"
    echo -e "${BOLD}                    $1${NC}"
    echo -e "${BLUE}${BOLD}════════════════════════════════════════════════════════════${NC}"
}

print_status() {
    case "$1" in
        ok) echo -e "${GREEN}  [OK] $2${NC}" ;;
        warn) echo -e "${YELLOW}  [WARN] $2${NC}" ;;
        error) echo -e "${RED}  [ERROR] $2${NC}" ;;
        info) echo -e "${BLUE}  [INFO] $2${NC}" ;;
        *) echo -e "  [$1] $2" ;;
    esac
}

# --- 生成报告文件 ---
generate_report() {
    local report_file="/tmp/syscheck_report_$(date +%Y%m%d_%H%M%S).txt"
    echo "=== SysCheck 巡检报告 ===" &gt; "$report_file"
    echo "生成时间: $(date '+%Y-%m-%d %H:%M:%S')" &gt;&gt; "$report_file"
    echo "主机名: $(hostname)" &gt;&gt; "$report_file"
    echo "IP地址: $(hostname -I 2&gt;/dev/null | awk '{print $1}')" &gt;&gt; "$report_file"
    echo "==================================" &gt;&gt; "$report_file"
}

# --- 1. 系统基础信息 ---
clear
print_title "Linux 服务器深度巡检 (SysCheck 2.0)"
echo -e "巡检时间：$(date '+%Y-%m-%d %H:%M:%S')"

[ -f /etc/os-release ] &amp;&amp; . /etc/os-release
OS_NAME="${PRETTY_NAME:-未知}"
HOSTNAME=$(hostname)
KERNEL=$(uname -r)
UPTIME=$(uptime)
LOAD_AVG=$(uptime | awk -F'load average:' '{print $2}' | sed 's/^[      ]*//')

print_status info "系统版本 : $OS_NAME"
print_status info "主机名称 : $HOSTNAME"
print_status info "内核版本 : $KERNEL"
print_status info "运行时间 : $(uptime -p)"
print_status info "平均负载 : $LOAD_AVG"

# --- 2. 资源使用情况 ---
print_title "资源使用情况"

# CPU使用率
CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)
if [ $(echo "$CPU_USAGE &gt; 80" | bc 2&gt;/dev/null || echo "0") = "1" ]; then
    print_status error "CPU使用率: ${CPU_USAGE}% - 过高！"
elif [ $(echo "$CPU_USAGE &gt; 60" | bc 2&gt;/dev/null || echo "0") = "1" ]; then
    print_status warn "CPU使用率: ${CPU_USAGE}% - 偏高"
else
    print_status ok "CPU使用率: ${CPU_USAGE}%"
fi

# 内存
mem_info=$(free -m)
mem_total=$(echo "$mem_info" | awk '/Mem:/ {print $2}')
mem_used=$(echo "$mem_info" | awk '/Mem:/ {print $3}')
mem_free=$(echo "$mem_info" | awk '/Mem:/ {print $4}')
mem_usage=$(echo "scale=2; $mem_used*100/$mem_total" | bc 2&gt;/dev/null || echo "0")

if [ $(echo "$mem_usage &gt; 90" | bc 2&gt;/dev/null || echo "0") = "1" ]; then
    print_status error "内存使用: ${mem_usage}% (${mem_used}M/${mem_total}M) - 严重不足！"
elif [ $(echo "$mem_usage &gt; 80" | bc 2&gt;/dev/null || echo "0") = "1" ]; then
    print_status warn "内存使用: ${mem_usage}% (${mem_used}M/${mem_total}M) - 偏高"
else
    print_status ok "内存使用: ${mem_usage}% (${mem_used}M/${mem_total}M)"
fi

# 交换空间
swap_info=$(free -m | awk '/Swap:/')
if [ -n "$swap_info" ]; then
    swap_total=$(echo "$swap_info" | awk '{print $2}')
    swap_used=$(echo "$swap_info" | awk '{print $3}')
    if [ "$swap_total" -gt 0 ]; then
        swap_usage=$(echo "scale=2; $swap_used*100/$swap_total" | bc 2&gt;/dev/null || echo "0")
        if [ "$swap_used" -gt 0 ]; then
            print_status warn "交换空间使用: ${swap_usage}% (${swap_used}M/${swap_total}M)"
        fi
    fi
fi

# 磁盘检查
print_status info "磁盘使用情况:"
df -hT | grep -vE 'tmpfs|cdrom|loop|overlay|squashfs|udev|devtmpfs' | while read fs type size used avail use mount; do
    if [ -n "$use" ]; then
        usage_num=$(echo "$use" | tr -d '%')
        if [ "$usage_num" -ge 95 ]; then
            print_status error "  $mount ($use) - ${size}已用${used} - 空间严重不足！"
        elif [ "$usage_num" -ge 85 ]; then
            print_status warn "  $mount ($use) - ${size}已用${used} - 空间不足"
        elif [ "$usage_num" -ge 70 ]; then
            print_status info "  $mount ($use) - ${size}已用${used}"
        else
            print_status ok "  $mount ($use) - ${size}已用${used}"
        fi
    fi
done

# Inode检查
print_status info "Inode使用情况:"
df -i | grep -vE 'tmpfs|cdrom|loop|overlay|squashfs|udev|devtmpfs' | while read fs inodes iused ifree iuse mount; do
    if [ -n "$iuse" ] &amp;&amp; [ "$iuse" != "IUse%" ]; then
        iuse_num=$(echo "$iuse" | tr -d '%')
        if [ "$iuse_num" -ge 90 ]; then
            print_status error "  $mount ($iuse) - Inode接近耗尽！"
        elif [ "$iuse_num" -ge 80 ]; then
            print_status warn "  $mount ($iuse) - Inode使用较高"
        fi
    fi
done

# --- 3. 安全补丁检查 (修复增强版) ---
print_title "安全补丁与漏洞检查"

check_updates() {
    if command -v apt &gt;/dev/null 2&gt;&amp;1; then
        # Debian/Ubuntu 逻辑
        if updates=$(apt list --upgradable 2&gt;/dev/null | grep -v "Listing..."); then
            cnt=$(echo "$updates" | wc -l)
            if [ "$cnt" -gt 0 ]; then
                print_status warn "发现 $cnt 个可升级包"
                echo "$updates" | head -n 5 | while read line; do
                    echo "    $line"
                done
                [ "$cnt" -gt 5 ] &amp;&amp; echo "    ... (还有 $((cnt-5)) 个未显示)"
            else
                print_status ok "系统软件包已是最新"
            fi
        fi
    elif command -v dnf &gt;/dev/null 2&gt;&amp;1 || command -v yum &gt;/dev/null 2&gt;&amp;1; then
        # RHEL/CentOS/Rocky 逻辑
        PKG_MGR=$(command -v dnf || command -v yum)

        # 检查安全更新
        if $PKG_MGR check-update --security &gt;/dev/null 2&gt;&amp;1; then
            sec_count=$($PKG_MGR check-update --security 2&gt;/dev/null | grep -c "\.\.")
            if [ "$sec_count" -gt 0 ]; then
                print_status warn "发现 $sec_count 个安全补丁待安装！"
                $PKG_MGR check-update --security 2&gt;/dev/null | head -n 5
                [ "$sec_count" -gt 5 ] &amp;&amp; echo "    ... (还有 $((sec_count-5)) 个未显示)"
            else
                print_status ok "未发现严重安全补丁"
            fi
        else
            # 尝试其他方法
            if sec_info=$($PKG_MGR updateinfo list security 2&gt;/dev/null); then
                sec_count=$(echo "$sec_info" | grep -c "security" || echo 0)
                if [ "$sec_count" -gt 0 ]; then
                    print_status warn "发现 $sec_count 个安全补丁待安装！"
                    echo "$sec_info" | head -n 5
                else
                    print_status ok "未发现严重安全补丁"
                fi
            else
                print_status info "跳过安全检查：当前源不支持元数据查询或缺少插件"
            fi
        fi
    else
        print_status info "未知包管理器，跳过补丁检查"
    fi
}

check_updates

# --- 4. 服务状态检查 ---
print_title "关键服务状态检查"

check_service() {
    local service=$1
    local name=$2

    if systemctl list-unit-files | grep -q "^${service}.service"; then
        if systemctl is-active --quiet "$service"; then
            print_status ok "$name: 运行中"
        else
            print_status error "$name: 未运行"
        fi
    fi
}

# 检查常见服务
check_service "sshd" "SSH服务"
check_service "crond" "计划任务"
check_service "nginx" "Nginx"
check_service "httpd" "Apache"
check_service "mysqld" "MySQL"
check_service "postgresql" "PostgreSQL"
check_service "docker" "Docker"
check_service "firewalld" "防火墙"
check_service "iptables" "iptables"
check_service "fail2ban" "Fail2ban"

# --- 5. 异常检测 ---
print_title "异常进程检测"

# 高负载进程
echo -e "${BOLD}CPU 占用前五:${NC}"
ps -eo pid,user,%cpu,cmd --sort=-%cpu | head -n 6 | tail -n 5 | awk '{printf "  %-6s %-10s %-6s %s\n", $1, $2, $3, $4}'

echo -e "\n${BOLD}内存 占用前五:${NC}"
ps -eo pid,user,%mem,cmd --sort=-%mem | head -n 6 | tail -n 5 | awk '{printf "  %-6s %-10s %-6s %s\n", $1, $2, $3, $4}'

# 僵尸进程
zombies=$(ps aux | grep -E "[Zz]" | grep -v grep | wc -l)
if [ "$zombies" -gt 0 ]; then
    print_status error "发现 $zombies 个僵尸进程！"
    ps aux | grep -E "[Zz]" | grep -v grep
else
    print_status ok "无僵尸进程"
fi

# 检查异常连接
echo -e "\n${BOLD}异常网络连接检查:${NC}"
if command -v netstat &gt;/dev/null 2&gt;&amp;1; then
    suspicious=$(netstat -antp 2&gt;/dev/null | grep -E "LISTEN|ESTABLISHED" | grep -vE "127.0.0.1|::1|0.0.0.0" | head -n 10)
    if [ -n "$suspicious" ]; then
        print_status warn "发现异常网络连接:"
        echo "$suspicious" | head -n 5
    fi
fi

# --- 6. 登录和用户检查 ---
print_title "登录与用户检查"

# 当前登录用户
echo -e "${BOLD}当前登录用户:${NC}"
who | head -n 5

# 检查空密码用户
if [ -f /etc/shadow ]; then
    empty_pass=$(sudo awk -F: '($2 == "" || $2 == "!") {print $1}' /etc/shadow 2&gt;/dev/null || echo "")
    if [ -n "$empty_pass" ]; then
        print_status error "发现空密码用户: $empty_pass"
    fi
fi

# 检查root用户远程登录
if grep -q "^PermitRootLogin yes" /etc/ssh/sshd_config 2&gt;/dev/null; then
    print_status warn "SSH配置允许root远程登录"
fi

# --- 7. 系统日志检查 ---
print_title "系统日志检查"

# 检查最近错误日志
if [ -f /var/log/messages ]; then
    recent_errors=$(tail -n 20 /var/log/messages | grep -i "error\|fail\|critical" | head -n 5)
elif [ -f /var/log/syslog ]; then
    recent_errors=$(tail -n 20 /var/log/syslog | grep -i "error\|fail\|critical" | head -n 5)
fi

if [ -n "$recent_errors" ]; then
    print_status warn "最近系统日志错误:"
    echo "$recent_errors" | while read line; do
        echo "  $line"
    done
fi

# --- 8. 结束与建议 ---
print_title "巡检完成"
echo -e "${BOLD}巡检摘要:${NC}"
echo -e "  1. 系统资源使用情况已检查"
echo -e "  2. 安全补丁状态已评估"
echo -e "  3. 关键服务状态已验证"
echo -e "  4. 异常进程和连接已扫描"
echo -e "  5. 系统日志已检查"

echo -e "\n${BOLD}建议:${NC}"
echo -e "  • 定期清理 /var/log 目录日志"
echo -e "  • 监控磁盘使用率，及时清理无用文件"
echo -e "  • 及时安装安全补丁"
echo -e "  • 定期备份重要数据"
echo -e "  • 检查防火墙规则和SSH配置"

echo -e "\n${GREEN}巡检完成于: $(date '+%Y-%m-%d %H:%M:%S')${NC}"
echo -e "${BLUE}脚本版本: SysCheck 2.0${NC}"

</code></pre>
<h4 data-id="heading-8">效果图</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44f08002dff341dfab7c517bd5f37f70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGw6aWt5bCP55S35a2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770350119&amp;x-signature=fTB1P%2BbRPRQoMHhx0UoYszhMVqk%3D" alt="微信图片_20260129184245.jpg" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/326177077f9747e79a02d8cb4cdcb401~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGw6aWt5bCP55S35a2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770350119&amp;x-signature=ql9FAqWWnpjKynQakGZr1WM4sMY%3D" alt="微信图片_20260129184236.jpg" loading="lazy"/></p>
<h3 data-id="heading-9">3、使用python脚本去把生成巡检记录为excel文件</h3>
<blockquote>
<p>一般到了月巡检的时候，领导都会让我们形成一个文件去统计查看。我们运维人员肯定是可以去系统上看，但是把数据统计出来再放进表格还是有点麻烦。</p>
</blockquote>
<blockquote>
<p>现在不用担心了，小饼帮大家把这一步也节省了。现在来看看我下面的处理步骤吧</p>
</blockquote>
<h4 data-id="heading-10">3.1 安装python3环境</h4>
<p>1、<code>yum install epel</code>
2、<code>yum install  -y phthon3</code></p>
<h4 data-id="heading-11">3.2、编写python脚本</h4>
<p><code>vim syscheck-excel.py</code></p>
<pre><code class="hljs language-#!/usr/bin/env" lang="#!/usr/bin/env"># -*- coding: utf-8 -*-
# ==============================================================================
# 脚本名称: syscheck-excel.py (Pro版)
# 功能描述: 采集Linux系统信息、磁盘、Top进程，生成带样式的美观Excel报表
# 运行方式: chmod +x syscheck-excel.py &amp;&amp; ./syscheck-excel.py
# 依赖库  : pip3 install psutil pandas openpyxl
# 作者    :yy
# ==============================================================================

import os
import sys
import socket
import datetime
import platform
import subprocess

# 依赖库检查
try:
    import psutil
    import pandas as pd
    from openpyxl import Workbook
    from openpyxl.styles import Font, PatternFill, Border, Side, Alignment
    from openpyxl.utils import get_column_letter
except ImportError as e:
    print("[Error] 缺少必要模块:", e)
    print("请先执行安装: pip3 install psutil pandas openpyxl")
    sys.exit(1)

def get_size(bytes_num, suffix="B"):
    """人性化显示文件大小"""
    factor = 1024
    for unit in ["", "K", "M", "G", "T", "P"]:
        if bytes_num &lt; factor:
            return f"{bytes_num:.2f}{unit}{suffix}"
        bytes_num /= factor
    return f"{bytes_num:.2f}EB"

def get_process_info():
    """获取CPU和内存占用最高的Top 10进程"""
    procs = []
    for p in psutil.process_iter(['pid', 'name', 'username', 'cpu_percent', 'memory_percent']):
        try:
            procs.append(p.info)
        except (psutil.NoSuchProcess, psutil.AccessDenied, psutil.ZombieProcess):
            pass
    
    # 转为DataFrame
    if procs:
        df_proc = pd.DataFrame(procs)
        if not df_proc.empty:
            # 按内存使用率排序取Top 10
            df_proc = df_proc.sort_values(by='memory_percent', ascending=False).head(10)
            df_proc['cpu_percent'] = df_proc['cpu_percent'].apply(lambda x: f"{x:.1f}%" if x else "0.0%")
            df_proc['memory_percent'] = df_proc['memory_percent'].apply(lambda x: f"{x:.1f}%" if x else "0.0%")
            df_proc.columns = ['PID', 'Process', 'User', 'CPU%', 'Memory%']
            return df_proc
    return pd.DataFrame()

def get_system_info():
    """获取详细的系统信息"""
    info = {}
    
    # 基本系统信息
    uname = platform.uname()
    info['System'] = uname.system
    info['Hostname'] = uname.node
    info['Release'] = uname.release
    info['Version'] = uname.version
    info['Machine'] = uname.machine
    info['Processor'] = uname.processor
    
    # 获取发行版详细信息
    if os.path.exists('/etc/os-release'):
        with open('/etc/os-release', 'r') as f:
            for line in f:
                if 'PRETTY_NAME' in line:
                    info['OS Name'] = line.split('=', 1)[1].strip().strip('"')
                    break
    
    # CPU信息
    info['CPU Cores (Logical)'] = psutil.cpu_count(logical=True)
    info['CPU Cores (Physical)'] = psutil.cpu_count(logical=False)
    
    # 内存信息
    mem = psutil.virtual_memory()
    info['Total Memory'] = get_size(mem.total)
    info['Available Memory'] = get_size(mem.available)
    info['Memory Usage %'] = f"{mem.percent}%"
    
    # 启动时间
    boot_time = datetime.datetime.fromtimestamp(psutil.boot_time())
    info['Boot Time'] = boot_time.strftime("%Y-%m-%d %H:%M:%S")
    
    # 运行时间
    uptime = datetime.datetime.now() - boot_time
    days = uptime.days
    hours, remainder = divmod(uptime.seconds, 3600)
    minutes, seconds = divmod(remainder, 60)
    info['Uptime'] = f"{days}d {hours}h {minutes}m {seconds}s"
    
    # 负载
    if hasattr(os, 'getloadavg'):
        load = os.getloadavg()
        info['Load 1min'] = f"{load[0]:.2f}"
        info['Load 5min'] = f"{load[1]:.2f}"
        info['Load 15min'] = f"{load[2]:.2f}"
    
    # CPU使用率
    cpu_percent = psutil.cpu_percent(interval=1)
    info['CPU Usage %'] = f"{cpu_percent}%"
    
    return info

def get_network_info():
    """获取网络信息"""
    network_info = {}
    
    try:
        # 获取IP地址
        hostname = socket.gethostname()
        try:
            ip_address = socket.gethostbyname(hostname)
        except:
            ip_address = "Unknown"
        
        network_info['Hostname'] = hostname
        network_info['IP Address'] = ip_address
        
        # 网络接口信息
        interfaces = []
        for interface, addrs in psutil.net_if_addrs().items():
            for addr in addrs:
                if addr.family == socket.AF_INET:  # IPv4
                    interfaces.append({
                        'Interface': interface,
                        'Address': addr.address,
                        'Netmask': addr.netmask
                    })
        
        network_info['Interfaces'] = interfaces
        
        # IO统计
        net_io = psutil.net_io_counters()
        network_info['Bytes Sent'] = get_size(net_io.bytes_sent)
        network_info['Bytes Received'] = get_size(net_io.bytes_recv)
        
    except Exception as e:
        network_info['Error'] = f"获取网络信息失败: {str(e)}"
    
    return network_info

def get_disk_info():
    """获取磁盘信息"""
    disk_list = []
    
    try:
        for partition in psutil.disk_partitions():
            # 跳过特殊文件系统
            skip = False
            for skip_str in ['loop', 'snap', 'docker', 'overlay', 'tmpfs']:
                if skip_str in partition.device.lower() or skip_str in partition.mountpoint.lower():
                    skip = True
                    break
            
            if skip:
                continue
            
            try:
                usage = psutil.disk_usage(partition.mountpoint)
                disk_list.append({
                    'Device': partition.device,
                    'Mount Point': partition.mountpoint,
                    'File System': partition.fstype,
                    'Total Size': get_size(usage.total),
                    'Used': get_size(usage.used),
                    'Free': get_size(usage.free),
                    'Usage %': f"{usage.percent}%",
                    'Percent': usage.percent
                })
            except (PermissionError, OSError):
                continue
        
        # 按使用率排序
        if disk_list:
            disk_list.sort(key=lambda x: x['Percent'], reverse=True)
            
    except Exception as e:
        print(f"获取磁盘信息失败: {e}")
    
    return disk_list

def get_service_status():
    """获取服务状态"""
    services = []
    
    # 常见服务列表
    common_services = [
        'sshd', 'crond', 'rsyslog', 'network', 'firewalld',
        'nginx', 'httpd', 'mysql', 'postgresql', 'docker'
    ]
    
    for service in common_services:
        status = 'Unknown'
        try:
            # 尝试systemctl
            result = subprocess.run(['systemctl', 'is-active', service], 
                                  capture_output=True, text=True, timeout=2)
            if result.returncode == 0:
                status = result.stdout.strip()
            else:
                # 尝试service命令
                result = subprocess.run(['service', service, 'status'], 
                                      capture_output=True, text=True, timeout=2)
                status = 'active' if result.returncode == 0 else 'inactive'
        except subprocess.TimeoutExpired:
            status = 'timeout'
        except FileNotFoundError:
            status = 'not installed'
        except:
            status = 'error'
        
        services.append({'Service': service, 'Status': status})
    
    return services

def create_summary_sheet(workbook, system_info, network_info):
    """创建汇总sheet"""
    ws = workbook.create_sheet("System Summary")
    
    # 标题
    ws.merge_cells('A1:B1')
    ws['A1'] = "System Inspection Report"
    ws['A1'].font = Font(size=14, bold=True, color="366092")
    ws['A1'].alignment = Alignment(horizontal='center')
    
    ws['A2'] = f"Report Time: {datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S')}"
    ws['A3'] = f"Hostname: {network_info.get('Hostname', 'Unknown')}"
    ws['A4'] = f"IP Address: {network_info.get('IP Address', 'Unknown')}"
    
    # 系统信息表格
    row = 6
    ws[f'A{row}'] = "System Information"
    ws[f'A{row}'].font = Font(bold=True)
    row += 1
    
    sys_keys = ['OS Name', 'System', 'Release', 'Version', 'Machine', 
                'Processor', 'CPU Cores (Logical)', 'CPU Cores (Physical)', 
                'Total Memory', 'Memory Usage %', 'CPU Usage %', 
                'Boot Time', 'Uptime']
    
    for key in sys_keys:
        if key in system_info:
            ws[f'A{row}'] = key
            ws[f'B{row}'] = system_info[key]
            row += 1
    
    # 负载信息
    if 'Load 1min' in system_info:
        row += 1
        ws[f'A{row}'] = "System Load"
        ws[f'A{row}'].font = Font(bold=True)
        row += 1
        ws[f'A{row}'] = "1 Minute"
        ws[f'B{row}'] = system_info['Load 1min']
        row += 1
        ws[f'A{row}'] = "5 Minutes"
        ws[f'B{row}'] = system_info['Load 5min']
        row += 1
        ws[f'A{row}'] = "15 Minutes"
        ws[f'B{row}'] = system_info['Load 15min']
    
    # 调整列宽
    ws.column_dimensions['A'].width = 25
    ws.column_dimensions['B'].width = 40

def create_disk_sheet(workbook, disk_info):
    """创建磁盘信息sheet"""
    if not disk_info:
        return
    
    # 转换为DataFrame
    df_disk = pd.DataFrame(disk_info)
    
    # 移除Percent列（仅用于排序）
    if 'Percent' in df_disk.columns:
        df_disk = df_disk.drop('Percent', axis=1)
    
    # 创建sheet
    ws = workbook.create_sheet("Disk Usage")
    ws.title = "Disk Usage"
    
    # 写入数据
    for r_idx, row in enumerate(df_disk.iterrows(), start=1):
        for c_idx, value in enumerate(row[1], start=1):
            cell = ws.cell(row=r_idx+1, column=c_idx, value=value)
    
    # 写入表头
    for c_idx, col_name in enumerate(df_disk.columns, start=1):
        cell = ws.cell(row=1, column=c_idx, value=col_name)
    
    # 应用样式
    header_fill = PatternFill(start_color="4F81BD", end_color="4F81BD", fill_type="solid")
    header_font = Font(color="FFFFFF", bold=True)
    thin_border = Border(left=Side(style='thin'), right=Side(style='thin'), 
                       top=Side(style='thin'), bottom=Side(style='thin'))
    align_center = Alignment(horizontal='center', vertical='center')
    
    # 设置表头样式
    for cell in ws[1]:
        cell.fill = header_fill
        cell.font = header_font
        cell.alignment = align_center
        cell.border = thin_border
    
    # 设置数据样式和高亮
    for row in ws.iter_rows(min_row=2, max_row=ws.max_row):
        for cell in row:
            cell.border = thin_border
            cell.alignment = align_center
            
            # 高亮使用率
            if cell.column == 7 and cell.value:  # 第7列是Usage %
                try:
                    val_str = str(cell.value).strip('%')
                    val = float(val_str)
                    if val &gt;= 90:
                        cell.font = Font(color="FF0000", bold=True)
                    elif val &gt;= 80:
                        cell.font = Font(color="FFA500", bold=True)
                except ValueError:
                    pass
    
    # 调整列宽
    for col in ws.columns:
        max_length = 0
        col_letter = get_column_letter(col[0].column)
        for cell in col:
            if cell.value and len(str(cell.value)) &gt; max_length:
                max_length = len(str(cell.value))
        adjusted_width = min(max_length + 2, 30)
        ws.column_dimensions[col_letter].width = adjusted_width

def create_service_sheet(workbook, services):
    """创建服务状态sheet"""
    if not services:
        return
    
    df_services = pd.DataFrame(services)
    
    # 创建sheet
    ws = workbook.create_sheet("Service Status")
    
    # 写入数据
    for r_idx, row in enumerate(df_services.iterrows(), start=1):
        for c_idx, value in enumerate(row[1], start=1):
            cell = ws.cell(row=r_idx+1, column=c_idx, value=value)
    
    # 写入表头
    for c_idx, col_name in enumerate(df_services.columns, start=1):
        cell = ws.cell(row=1, column=c_idx, value=col_name)
    
    # 应用样式
    header_fill = PatternFill(start_color="4F81BD", end_color="4F81BD", fill_type="solid")
    header_font = Font(color="FFFFFF", bold=True)
    thin_border = Border(left=Side(style='thin'), right=Side(style='thin'), 
                       top=Side(style='thin'), bottom=Side(style='thin'))
    align_center = Alignment(horizontal='center', vertical='center')
    
    # 设置表头样式
    for cell in ws[1]:
        cell.fill = header_fill
        cell.font = header_font
        cell.alignment = align_center
        cell.border = thin_border
    
    # 设置数据样式和高亮
    for row in ws.iter_rows(min_row=2, max_row=ws.max_row):
        for cell in row:
            cell.border = thin_border
            cell.alignment = align_center
            
            # 高亮状态
            if cell.column == 2 and cell.value:  # 第2列是状态
                status = str(cell.value).lower()
                if status == 'active':
                    cell.fill = PatternFill(start_color="C6EFCE", end_color="C6EFCE", fill_type="solid")
                elif status in ['inactive', 'failed', 'error']:
                    cell.fill = PatternFill(start_color="FFC7CE", end_color="FFC7CE", fill_type="solid")
                    cell.font = Font(color="FF0000", bold=True)
    
    # 调整列宽
    ws.column_dimensions['A'].width = 20
    ws.column_dimensions['B'].width = 15

def create_process_sheet(workbook, process_info):
    """创建进程信息sheet"""
    if process_info.empty:
        return
    
    # 创建sheet
    ws = workbook.create_sheet("Top Processes")
    
    # 写入数据
    for r_idx, row in enumerate(process_info.iterrows(), start=1):
        for c_idx, value in enumerate(row[1], start=1):
            cell = ws.cell(row=r_idx+1, column=c_idx, value=value)
    
    # 写入表头
    for c_idx, col_name in enumerate(process_info.columns, start=1):
        cell = ws.cell(row=1, column=c_idx, value=col_name)
    
    # 应用样式
    header_fill = PatternFill(start_color="4F81BD", end_color="4F81BD", fill_type="solid")
    header_font = Font(color="FFFFFF", bold=True)
    thin_border = Border(left=Side(style='thin'), right=Side(style='thin'), 
                       top=Side(style='thin'), bottom=Side(style='thin'))
    align_center = Alignment(horizontal='center', vertical='center')
    
    # 设置表头样式
    for cell in ws[1]:
        cell.fill = header_fill
        cell.font = header_font
        cell.alignment = align_center
        cell.border = thin_border
    
    # 设置数据样式
    for row in ws.iter_rows(min_row=2, max_row=ws.max_row):
        for cell in row:
            cell.border = thin_border
            cell.alignment = align_center
    
    # 调整列宽
    for col in ws.columns:
        max_length = 0
        col_letter = get_column_letter(col[0].column)
        for cell in col:
            if cell.value and len(str(cell.value)) &gt; max_length:
                max_length = len(str(cell.value))
        adjusted_width = min(max_length + 2, 30)
        ws.column_dimensions[col_letter].width = adjusted_width

def create_network_sheet(workbook, network_info):
    """创建网络信息sheet"""
    ws = workbook.create_sheet("Network Info")
    
    # 标题
    ws['A1'] = "Network Information"
    ws['A1'].font = Font(size=12, bold=True)
    
    row = 3
    ws[f'A{row}'] = "Hostname"
    ws[f'B{row}'] = network_info.get('Hostname', 'Unknown')
    row += 1
    
    ws[f'A{row}'] = "IP Address"
    ws[f'B{row}'] = network_info.get('IP Address', 'Unknown')
    row += 1
    
    # 网络统计
    ws[f'A{row}'] = "Bytes Sent"
    ws[f'B{row}'] = network_info.get('Bytes Sent', 'Unknown')
    row += 1
    
    ws[f'A{row}'] = "Bytes Received"
    ws[f'B{row}'] = network_info.get('Bytes Received', 'Unknown')
    
    # 网络接口
    if 'Interfaces' in network_info and network_info['Interfaces']:
        row += 2
        ws[f'A{row}'] = "Network Interfaces"
        ws[f'A{row}'].font = Font(bold=True)
        row += 1
        
        # 表头
        headers = ['Interface', 'IP Address', 'Netmask']
        for col, header in enumerate(headers, 1):
            cell = ws.cell(row=row, column=col, value=header)
            cell.fill = PatternFill(start_color="4F81BD", end_color="4F81BD", fill_type="solid")
            cell.font = Font(color="FFFFFF", bold=True)
        
        row += 1
        
        # 数据
        for interface in network_info['Interfaces'][:10]:  # 限制显示数量
            ws.cell(row=row, column=1, value=interface.get('Interface', ''))
            ws.cell(row=row, column=2, value=interface.get('Address', ''))
            ws.cell(row=row, column=3, value=interface.get('Netmask', ''))
            row += 1
    
    # 设置边框和样式
    thin_border = Border(left=Side(style='thin'), right=Side(style='thin'), 
                       top=Side(style='thin'), bottom=Side(style='thin'))
    
    for row_cells in ws.iter_rows(min_row=1, max_row=ws.max_row, max_col=4):
        for cell in row_cells:
            cell.border = thin_border
            if cell.row &gt; 1:
                cell.alignment = Alignment(horizontal='left', vertical='center')
    
    # 调整列宽
    ws.column_dimensions['A'].width = 20
    ws.column_dimensions['B'].width = 25
    ws.column_dimensions['C'].width = 20

def sys_check_excel():
    """主函数"""
    print(f"[{datetime.datetime.now().strftime('%H:%M:%S')}] Starting system inspection...")
    
    # 收集信息
    print("Collecting system information...")
    system_info = get_system_info()
    
    print("Collecting network information...")
    network_info = get_network_info()
    
    print("Checking disk usage...")
    disk_info = get_disk_info()
    
    print("Checking service status...")
    services = get_service_status()
    
    print("Analyzing processes...")
    process_info = get_process_info()
    
    # 生成Excel文件名
    hostname = system_info.get('Hostname', 'unknown')
    timestamp = datetime.datetime.now().strftime('%Y%m%d_%H%M%S')
    filename = f"system_inspection_{hostname}_{timestamp}.xlsx"
    
    print(f"Generating Excel report: {filename}")
    
    try:
        # 创建Excel工作簿
        wb = Workbook()
        
        # 移除默认的sheet
        if 'Sheet' in wb.sheetnames:
            default_ws = wb['Sheet']
            wb.remove(default_ws)
        
        # 创建各个sheet
        create_summary_sheet(wb, system_info, network_info)
        create_disk_sheet(wb, disk_info)
        create_service_sheet(wb, services)
        create_network_sheet(wb, network_info)
        create_process_sheet(wb, process_info)
        
        # 保存文件
        wb.save(filename)
        
        print(f"\n[SUCCESS] Inspection completed!")
        print(f"Report generated: {os.path.abspath(filename)}")
        
        if os.path.exists(filename):
            print(f"File size: {get_size(os.path.getsize(filename))}")
        
        # 显示摘要信息
        print("\n=== Report Summary ===")
        print(f"System: {system_info.get('OS Name', system_info.get('System', 'Unknown'))}")
        print(f"Hostname: {hostname}")
        print(f"CPU Cores: {system_info.get('CPU Cores (Logical)', 'Unknown')}")
        print(f"Memory: {system_info.get('Total Memory', 'Unknown')} (Usage: {system_info.get('Memory Usage %', 'Unknown')})")
        print(f"CPU Usage: {system_info.get('CPU Usage %', 'Unknown')}")
        
        # 磁盘警告
        if disk_info:
            critical_disks = [d for d in disk_info if d['Percent'] &gt;= 90]
            warning_disks = [d for d in disk_info if 80 &lt;= d['Percent'] &lt; 90]
            
            if critical_disks:
                print(f"[CRITICAL] {len(critical_disks)} disk(s) usage &gt; 90%")
                for disk in critical_disks[:3]:
                    print(f"  - {disk['Mount Point']}: {disk['Usage %']}")
            
            if warning_disks:
                print(f"[WARNING] {len(warning_disks)} disk(s) usage &gt; 80%")
        
        # 服务警告
        if services:
            failed_services = [s for s in services if s['Status'] in ['inactive', 'failed', 'error']]
            if failed_services:
                print(f"[WARNING] {len(failed_services)} service(s) not running")
        
        print("\n=== Excel Sheet Contents ===")
        print("1. System Summary - Basic system information")
        print("2. Disk Usage - Disk partitions with usage highlighting")
        print("3. Service Status - Service status with color coding")
        print("4. Network Info - Network interfaces and statistics")
        print("5. Top Processes - Top 10 processes by memory usage")
        
        print("\n=== Color Legend ===")
        print("Disk Usage: &gt;90% = RED, &gt;80% = ORANGE")
        print("Services: Running = GREEN, Stopped = RED")
        
    except Exception as e:
        print(f"\n[ERROR] Failed to generate report: {e}")
        import traceback
        traceback.print_exc()

def main():
    """主入口函数"""
    print("=" * 70)
    print("           Linux System Inspection Tool (Excel Version)")
    print("              Author: Linux Operations Team")
    print("=" * 70)
    print()
    
    try:
        # 检查是否以root运行（某些信息需要root权限）
        if os.geteuid() != 0:
            print("[WARNING] Running without root privileges")
            print("Some information (services, detailed disk info) may not be available")
            print("Consider running with: sudo python3 syscheck-excel.py")
            response = input("Continue anyway? (y/N): ")
            if response.lower() != 'y':
                print("Exiting...")
                return
        
        # 执行巡检
        sys_check_excel()
        
    except KeyboardInterrupt:
        print("\n\n[INFO] Inspection interrupted by user.")
    except Exception as e:
        print(f"\n[ERROR] Unexpected error: {e}")
        import traceback
        traceback.print_exc()

if __name__ == "__main__":
    main()
</code></pre>
<h4 data-id="heading-12">3.3、使用python脚本</h4>
<p><code>python3 syscheck-excel.py </code></p>
<h4 data-id="heading-13">3.4、效果</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0cfc2fdedf0487085474161f559e5ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGw6aWt5bCP55S35a2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770350119&amp;x-signature=C%2Bz0WvauSrVj1WwRJ52a3HTCk4s%3D" alt="微信图片_20260129184304.jpg" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e6a935859f14e8b9f6f714cab7175ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGw6aWt5bCP55S35a2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770350119&amp;x-signature=Xw%2BppRDN%2BvMUb2dZw7LdIiuE0J8%3D" alt="微信图片_20260129184316.jpg" loading="lazy"/></p>
<h3 data-id="heading-14">4、使用ansible批量巡检</h3>
<blockquote>
<p>同志们，现在迎来了一个问题，如果我们要巡检的服务器特别多几百台怎么办。这时候就用到我们上面配置好的ansibLe了，我只用三台做了一个例子。</p>
</blockquote>
<h4 data-id="heading-15">4.1、剧本编写</h4>
<p>1、<code>vim  check_all.yml</code></p>
<pre><code class="hljs language----" lang="---">- name: 全网服务器批量巡检
  hosts: all
  become: yes
  gather_facts: yes

  vars:
    # 配置变量
    check_script: "syscheck.sh"
    report_dir: "./reports"
    remote_report_dir: "/tmp"

  tasks:
    # 任务1: 创建本地报告目录
    - name: 创建本地报告目录
      delegate_to: localhost
      run_once: yes
      file:
        path: "{{ report_dir }}"
        state: directory
        mode: '0755'

    # 任务2: 分发巡检脚本
    - name: 分发巡检脚本到目标服务器
      copy:
        src: /root/ansible/syscheck.sh
        dest: /usr/local/bin/syscheck.sh
        owner: root
        group: root
        mode: '0755'

    # 任务3: 执行巡检并保存结果
    - name: 执行系统巡检
      shell: |
        # 设置环境变量，禁用终端颜色
        export TERM=dumb
        /usr/local/bin/syscheck.sh
      register: check_result
      args:
        executable: /bin/bash
      environment:
        TERM: dumb  # 禁用颜色输出，避免ANSI转义字符

    # 任务4: 保存巡检结果到临时文件
    - name: 保存巡检结果
      copy:
        content: |
          ==========================================
          服务器巡检报告
          主机名: {{ ansible_hostname }}
          IP地址: {{ ansible_default_ipv4.address | default('未知') }}
          检查时间: {{ ansible_date_time.iso8601 }}
          ==========================================

          {{ check_result.stdout }}
        dest: "{{ remote_report_dir }}/check_{{ ansible_hostname }}.txt"
        owner: root
        group: root
        mode: '0644'

    # 任务5: 拉取巡检报告到本地
    - name: 拉取巡检报告到本地
      fetch:
        src: "{{ remote_report_dir }}/check_{{ ansible_hostname }}.txt"
        dest: "{{ report_dir }}/"
        flat: no  # 按主机名创建目录结构

    # 任务6: 清理远程临时文件
    - name: 清理远程临时文件
      file:
        path: "{{ remote_report_dir }}/check_{{ ansible_hostname }}.txt"
        state: absent

    # 任务7: 显示执行摘要
    - name: 显示巡检摘要
      debug:
        msg: |
          巡检完成: {{ ansible_hostname }}
          报告已保存到: {{ report_dir }}/{{ ansible_hostname }}/check_{{ ansible_hostname }}.txt
</code></pre>
<h4 data-id="heading-16">4.2、使用剧本</h4>
<p>1、<code>ansible-playbook     check_all.yml</code></p>
<h4 data-id="heading-17">4.3 结果</h4>
<blockquote>
<p>目录都存在在/root/ansible/reports/服务器名称</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69ee24bf96684ed1a944d676eae772da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGw6aWt5bCP55S35a2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770350119&amp;x-signature=losaPrH0%2BJJ%2BfvTxXWz85LsMK1I%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-18">四、总结&amp;优化</h2>
<h2 data-id="heading-19">最后，马上要过年了，小饼预祝大家马年发大财，万事如意。下课！</h2></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[别再被VO、BO、PO、DTO、DO绕晕！今天用一篇文章把它们讲透]]></title>    <link>https://juejin.cn/post/7600709805469171755</link>    <guid>https://juejin.cn/post/7600709805469171755</guid>    <pubDate>2026-01-30T05:23:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600709805469171755" data-draft-id="7600706866785681451" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="别再被VO、BO、PO、DTO、DO绕晕！今天用一篇文章把它们讲透"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-30T05:23:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="我爱娃哈哈"/> <meta itemprop="url" content="https://juejin.cn/user/1398234522335383"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            别再被VO、BO、PO、DTO、DO绕晕！今天用一篇文章把它们讲透
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1398234522335383/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    我爱娃哈哈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T05:23:39.000Z" title="Fri Jan 30 2026 05:23:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>团队里新来的小伙伴在代码里各种对象传来传去，VO、BO、PO、DTO、DO满天飞，你问他为什么要这样设计，他支支吾吾说不清楚，最后你也被绕得云里雾里...</p>
<p>今天就来聊聊这些让人头疼的对象概念，用一篇文章把它们彻底讲透，让你再也不会被这些缩写绕晕！</p>
<h2 data-id="heading-0">一、为什么要区分这些对象？</h2>
<p>在开始详细介绍之前，我们先来理解为什么要区分这些对象。很多新手开发者可能会问："不就是个对象吗？为什么还要分这么细？直接用一个对象不就完事了？"</p>
<h3 data-id="heading-1">1.1 分层架构的需要</h3>
<p>现代Web应用通常采用分层架构设计：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 典型的分层架构</span>
<span class="hljs-comment">// Controller层 -&gt; Service层 -&gt; Repository层 -&gt; Database</span>
</code></pre>
<p>每一层都有不同的职责，需要处理不同的数据：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Controller层需要的数据</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserVO</span> {
    <span class="hljs-keyword">private</span> String username;
    <span class="hljs-keyword">private</span> String email;
    <span class="hljs-keyword">private</span> String avatar;  <span class="hljs-comment">// 头像URL</span>
    <span class="hljs-keyword">private</span> String lastLoginTime;  <span class="hljs-comment">// 格式化的时间显示</span>
}

<span class="hljs-comment">// Service层需要的数据</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserBO</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String username;
    <span class="hljs-keyword">private</span> String email;
    <span class="hljs-keyword">private</span> String password;  <span class="hljs-comment">// 密码需要在Service层处理</span>
    <span class="hljs-keyword">private</span> Integer status;   <span class="hljs-comment">// 用户状态</span>
    <span class="hljs-keyword">private</span> Date lastLoginTime;
}

<span class="hljs-comment">// Repository层需要的数据</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDO</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String username;
    <span class="hljs-keyword">private</span> String email;
    <span class="hljs-keyword">private</span> String passwordHash;  <span class="hljs-comment">// 加密后的密码</span>
    <span class="hljs-keyword">private</span> Integer status;
    <span class="hljs-keyword">private</span> Date lastLoginTime;
    <span class="hljs-keyword">private</span> Date createdAt;
    <span class="hljs-keyword">private</span> Date updatedAt;
}
</code></pre>
<h3 data-id="heading-2">1.2 数据安全和隐私保护</h3>
<p>不同层面对数据的访问权限不同：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 错误的做法 - 直接暴露数据库对象</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService;
    
    <span class="hljs-meta">@GetMapping("/users/{id}")</span>
    <span class="hljs-keyword">public</span> UserDO <span class="hljs-title function_">getUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> {
        <span class="hljs-comment">// 直接返回数据库对象，可能包含敏感信息</span>
        <span class="hljs-keyword">return</span> userService.getUserById(id);
    }
}

<span class="hljs-comment">// 正确的做法 - 使用专门的VO对象</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService;
    
    <span class="hljs-meta">@GetMapping("/users/{id}")</span>
    <span class="hljs-keyword">public</span> UserVO <span class="hljs-title function_">getUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> {
        <span class="hljs-type">UserBO</span> <span class="hljs-variable">userBO</span> <span class="hljs-operator">=</span> userService.getUserById(id);
        <span class="hljs-comment">// 转换为VO对象，过滤敏感信息</span>
        <span class="hljs-keyword">return</span> convertToVO(userBO);
    }
    
    <span class="hljs-keyword">private</span> UserVO <span class="hljs-title function_">convertToVO</span><span class="hljs-params">(UserBO userBO)</span> {
        <span class="hljs-type">UserVO</span> <span class="hljs-variable">vo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserVO</span>();
        vo.setUsername(userBO.getUsername());
        vo.setEmail(userBO.getEmail());
        vo.setAvatar(buildAvatarUrl(userBO.getId()));
        vo.setLastLoginTime(formatTime(userBO.getLastLoginTime()));
        <span class="hljs-comment">// 注意：不包含密码等敏感信息</span>
        <span class="hljs-keyword">return</span> vo;
    }
}
</code></pre>
<h3 data-id="heading-3">1.3 代码可维护性</h3>
<p>合理的对象分层能提高代码的可维护性：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 清晰的职责分离</span>
<span class="hljs-comment">// Controller层：处理HTTP请求，参数校验，返回响应</span>
<span class="hljs-comment">// Service层：业务逻辑处理</span>
<span class="hljs-comment">// Repository层：数据访问</span>
<span class="hljs-comment">// 各层使用不同的对象，职责明确</span>
</code></pre>
<h2 data-id="heading-4">二、各种对象详解</h2>
<h3 data-id="heading-5">2.1 PO (Persistent Object) - 持久化对象</h3>
<p>PO是与数据库表结构一一对应的对象，通常与ORM框架（如MyBatis、Hibernate）配合使用。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// PO对象 - 与数据库表结构对应</span>
<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "users")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserPO</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    
    <span class="hljs-meta">@Column(name = "username")</span>
    <span class="hljs-keyword">private</span> String username;
    
    <span class="hljs-meta">@Column(name = "email")</span>
    <span class="hljs-keyword">private</span> String email;
    
    <span class="hljs-meta">@Column(name = "password_hash")</span>
    <span class="hljs-keyword">private</span> String passwordHash;
    
    <span class="hljs-meta">@Column(name = "status")</span>
    <span class="hljs-keyword">private</span> Integer status;
    
    <span class="hljs-meta">@Column(name = "created_at")</span>
    <span class="hljs-keyword">private</span> Date createdAt;
    
    <span class="hljs-meta">@Column(name = "updated_at")</span>
    <span class="hljs-keyword">private</span> Date updatedAt;
    
    <span class="hljs-meta">@Column(name = "last_login_time")</span>
    <span class="hljs-keyword">private</span> Date lastLoginTime;
    
    <span class="hljs-comment">// getters and setters</span>
}
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li>与数据库表结构一一对应</li>
<li>包含数据库字段的所有信息</li>
<li>通常由ORM框架管理生命周期</li>
<li>不包含业务逻辑</li>
</ul>
<h3 data-id="heading-6">2.2 DO (Data Object) - 数据对象</h3>
<p>DO与PO非常相似，也是与数据库表结构对应的对象，但在某些团队中会有一些细微差别。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// DO对象 - 数据访问层使用的对象</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDO</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String username;
    <span class="hljs-keyword">private</span> String email;
    <span class="hljs-keyword">private</span> String passwordHash;
    <span class="hljs-keyword">private</span> Integer status;
    <span class="hljs-keyword">private</span> Date createdAt;
    <span class="hljs-keyword">private</span> Date updatedAt;
    <span class="hljs-keyword">private</span> Date lastLoginTime;
    
    <span class="hljs-comment">// 可能包含一些数据访问层的辅助方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isActive</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.status == <span class="hljs-number">1</span>;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isLocked</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.status == <span class="hljs-number">2</span>;
    }
    
    <span class="hljs-comment">// getters and setters</span>
}
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li>与数据库表结构对应</li>
<li>在Repository层使用</li>
<li>可能包含一些简单的数据处理方法</li>
<li>不包含复杂业务逻辑</li>
</ul>
<h3 data-id="heading-7">2.3 DTO (Data Transfer Object) - 数据传输对象</h3>
<p>DTO用于在不同层之间传输数据，特别是在远程调用时使用。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// DTO对象 - 用于服务间数据传输</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDTO</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String username;
    <span class="hljs-keyword">private</span> String email;
    <span class="hljs-keyword">private</span> String statusDesc;  <span class="hljs-comment">// 状态描述，便于前端显示</span>
    <span class="hljs-keyword">private</span> String createTime;  <span class="hljs-comment">// 格式化的时间字符串</span>
    
    <span class="hljs-comment">// 用于创建用户的DTO</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CreateUserRequest</span> {
        <span class="hljs-keyword">private</span> String username;
        <span class="hljs-keyword">private</span> String email;
        <span class="hljs-keyword">private</span> String password;
        
        <span class="hljs-comment">// getters and setters</span>
    }
    
    <span class="hljs-comment">// 用于更新用户的DTO</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UpdateUserRequest</span> {
        <span class="hljs-keyword">private</span> String username;
        <span class="hljs-keyword">private</span> String email;
        
        <span class="hljs-comment">// getters and setters</span>
    }
    
    <span class="hljs-comment">// 用于用户列表的DTO</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserListItem</span> {
        <span class="hljs-keyword">private</span> Long id;
        <span class="hljs-keyword">private</span> String username;
        <span class="hljs-keyword">private</span> String email;
        <span class="hljs-keyword">private</span> String statusDesc;
        
        <span class="hljs-comment">// getters and setters</span>
    }
    
    <span class="hljs-comment">// getters and setters</span>
}
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li>用于层间数据传输</li>
<li>可以包含多个业务对象的数据</li>
<li>通常用于远程调用</li>
<li>可以进行数据格式转换</li>
</ul>
<h3 data-id="heading-8">2.4 BO (Business Object) - 业务对象</h3>
<p>BO包含业务逻辑的对象，通常在Service层使用。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// BO对象 - 包含业务逻辑的对象</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserBO</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String username;
    <span class="hljs-keyword">private</span> String email;
    <span class="hljs-keyword">private</span> String password;
    <span class="hljs-keyword">private</span> Integer status;
    <span class="hljs-keyword">private</span> Date lastLoginTime;
    <span class="hljs-keyword">private</span> List&lt;RoleBO&gt; roles;  <span class="hljs-comment">// 用户角色</span>
    
    <span class="hljs-comment">// 业务方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">canLogin</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.status == <span class="hljs-number">1</span>;  <span class="hljs-comment">// 只有激活状态的用户才能登录</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isAdmin</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.roles.stream()
                .anyMatch(role -&gt; <span class="hljs-string">"ADMIN"</span>.equals(role.getRoleName()));
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateLastLoginTime</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">this</span>.lastLoginTime = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkPassword</span><span class="hljs-params">(String inputPassword)</span> {
        <span class="hljs-keyword">return</span> BCrypt.checkpw(inputPassword, <span class="hljs-built_in">this</span>.password);
    }
    
    <span class="hljs-comment">// getters and setters</span>
}

<span class="hljs-comment">// 角色业务对象</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RoleBO</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String roleName;
    <span class="hljs-keyword">private</span> String roleDesc;
    
    <span class="hljs-comment">// getters and setters</span>
}
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li>包含业务逻辑</li>
<li>在Service层使用</li>
<li>可能聚合多个DO/PO对象</li>
<li>是业务的核心抽象</li>
</ul>
<h3 data-id="heading-9">2.5 VO (Value Object) - 视图对象</h3>
<p>VO是展示层使用的对象，通常用于向前端返回数据。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// VO对象 - 用于前端展示</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserVO</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String username;
    <span class="hljs-keyword">private</span> String email;
    <span class="hljs-keyword">private</span> String avatar;      <span class="hljs-comment">// 头像URL</span>
    <span class="hljs-keyword">private</span> String statusDesc;  <span class="hljs-comment">// 状态描述</span>
    <span class="hljs-keyword">private</span> String lastLoginTime;  <span class="hljs-comment">// 格式化的时间显示</span>
    <span class="hljs-keyword">private</span> List&lt;String&gt; roleNames;  <span class="hljs-comment">// 角色名称列表</span>
    
    <span class="hljs-comment">// 嵌套的VO对象</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDetailVO</span> {
        <span class="hljs-keyword">private</span> Long id;
        <span class="hljs-keyword">private</span> String username;
        <span class="hljs-keyword">private</span> String email;
        <span class="hljs-keyword">private</span> String avatar;
        <span class="hljs-keyword">private</span> String statusDesc;
        <span class="hljs-keyword">private</span> String lastLoginTime;
        <span class="hljs-keyword">private</span> List&lt;RoleVO&gt; roles;
        <span class="hljs-keyword">private</span> String registerTime;
        
        <span class="hljs-comment">// getters and setters</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RoleVO</span> {
        <span class="hljs-keyword">private</span> String roleName;
        <span class="hljs-keyword">private</span> String roleDesc;
        
        <span class="hljs-comment">// getters and setters</span>
    }
    
    <span class="hljs-comment">// getters and setters</span>
}
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li>用于前端展示</li>
<li>数据格式友好</li>
<li>可能包含格式化后的数据</li>
<li>不包含敏感信息</li>
</ul>
<h2 data-id="heading-10">三、对象转换实践</h2>
<p>在实际开发中，我们需要在不同对象之间进行转换。</p>
<h3 data-id="heading-11">3.1 手动转换</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 手动转换示例</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserRepository userRepository;
    
    <span class="hljs-keyword">public</span> UserVO <span class="hljs-title function_">getUserById</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-comment">// 1. 从数据库获取DO对象</span>
        <span class="hljs-type">UserDO</span> <span class="hljs-variable">userDO</span> <span class="hljs-operator">=</span> userRepository.findById(id);
        
        <span class="hljs-comment">// 2. 转换为BO对象</span>
        <span class="hljs-type">UserBO</span> <span class="hljs-variable">userBO</span> <span class="hljs-operator">=</span> convertToBO(userDO);
        
        <span class="hljs-comment">// 3. 转换为VO对象</span>
        <span class="hljs-type">UserVO</span> <span class="hljs-variable">userVO</span> <span class="hljs-operator">=</span> convertToVO(userBO);
        
        <span class="hljs-keyword">return</span> userVO;
    }
    
    <span class="hljs-keyword">private</span> UserBO <span class="hljs-title function_">convertToBO</span><span class="hljs-params">(UserDO userDO)</span> {
        <span class="hljs-keyword">if</span> (userDO == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        
        <span class="hljs-type">UserBO</span> <span class="hljs-variable">userBO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserBO</span>();
        userBO.setId(userDO.getId());
        userBO.setUsername(userDO.getUsername());
        userBO.setEmail(userDO.getEmail());
        userBO.setPassword(userDO.getPasswordHash());
        userBO.setStatus(userDO.getStatus());
        userBO.setLastLoginTime(userDO.getLastLoginTime());
        
        <span class="hljs-keyword">return</span> userBO;
    }
    
    <span class="hljs-keyword">private</span> UserVO <span class="hljs-title function_">convertToVO</span><span class="hljs-params">(UserBO userBO)</span> {
        <span class="hljs-keyword">if</span> (userBO == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        
        <span class="hljs-type">UserVO</span> <span class="hljs-variable">userVO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserVO</span>();
        userVO.setId(userBO.getId());
        userVO.setUsername(userBO.getUsername());
        userVO.setEmail(userBO.getEmail());
        userVO.setAvatar(buildAvatarUrl(userBO.getId()));
        userVO.setStatusDesc(getStatusDesc(userBO.getStatus()));
        userVO.setLastLoginTime(formatTime(userBO.getLastLoginTime()));
        
        <span class="hljs-keyword">return</span> userVO;
    }
    
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">buildAvatarUrl</span><span class="hljs-params">(Long userId)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"https://cdn.example.com/avatar/"</span> + userId + <span class="hljs-string">".jpg"</span>;
    }
    
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getStatusDesc</span><span class="hljs-params">(Integer status)</span> {
        <span class="hljs-keyword">switch</span> (status) {
            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"激活"</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"锁定"</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"注销"</span>;
            <span class="hljs-keyword">default</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"未知"</span>;
        }
    }
    
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">formatTime</span><span class="hljs-params">(Date date)</span> {
        <span class="hljs-keyword">if</span> (date == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
        }
        <span class="hljs-type">SimpleDateFormat</span> <span class="hljs-variable">sdf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>);
        <span class="hljs-keyword">return</span> sdf.format(date);
    }
}
</code></pre>
<h3 data-id="heading-12">3.2 使用MapStruct自动转换</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 使用MapStruct简化对象转换</span>
<span class="hljs-comment">// 1. 添加依赖</span>
<span class="hljs-comment">/*
&lt;dependency&gt;
    &lt;groupId&gt;org.mapstruct&lt;/groupId&gt;
    &lt;artifactId&gt;mapstruct&lt;/artifactId&gt;
    &lt;version&gt;1.5.2.Final&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.mapstruct&lt;/groupId&gt;
    &lt;artifactId&gt;mapstruct-processor&lt;/artifactId&gt;
    &lt;version&gt;1.5.2.Final&lt;/version&gt;
    &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;
*/</span>

<span class="hljs-comment">// 2. 定义转换接口</span>
<span class="hljs-meta">@Mapper</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserConverter</span> {
    
    <span class="hljs-type">UserConverter</span> <span class="hljs-variable">INSTANCE</span> <span class="hljs-operator">=</span> Mappers.getMapper(UserConverter.class);
    
    <span class="hljs-comment">// DO转BO</span>
    UserBO <span class="hljs-title function_">toBO</span><span class="hljs-params">(UserDO userDO)</span>;
    
    <span class="hljs-comment">// BO转VO</span>
    UserVO <span class="hljs-title function_">toVO</span><span class="hljs-params">(UserBO userBO)</span>;
    
    <span class="hljs-comment">// 自定义转换规则</span>
    <span class="hljs-meta">@Mapping(target = "statusDesc", expression = "java(getStatusDesc(userBO.getStatus()))")</span>
    <span class="hljs-meta">@Mapping(target = "lastLoginTime", expression = "java(formatTime(userBO.getLastLoginTime()))")</span>
    UserVO <span class="hljs-title function_">toVOWithCustom</span><span class="hljs-params">(UserBO userBO)</span>;
    
    <span class="hljs-keyword">default</span> String <span class="hljs-title function_">getStatusDesc</span><span class="hljs-params">(Integer status)</span> {
        <span class="hljs-keyword">switch</span> (status) {
            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"激活"</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"锁定"</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"注销"</span>;
            <span class="hljs-keyword">default</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"未知"</span>;
        }
    }
    
    <span class="hljs-keyword">default</span> String <span class="hljs-title function_">formatTime</span><span class="hljs-params">(Date date)</span> {
        <span class="hljs-keyword">if</span> (date == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
        }
        <span class="hljs-type">SimpleDateFormat</span> <span class="hljs-variable">sdf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>);
        <span class="hljs-keyword">return</span> sdf.format(date);
    }
}

<span class="hljs-comment">// 3. 使用转换器</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserRepository userRepository;
    
    <span class="hljs-keyword">public</span> UserVO <span class="hljs-title function_">getUserById</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-comment">// 1. 从数据库获取DO对象</span>
        <span class="hljs-type">UserDO</span> <span class="hljs-variable">userDO</span> <span class="hljs-operator">=</span> userRepository.findById(id);
        
        <span class="hljs-comment">// 2. 转换为BO对象</span>
        <span class="hljs-type">UserBO</span> <span class="hljs-variable">userBO</span> <span class="hljs-operator">=</span> UserConverter.INSTANCE.toBO(userDO);
        
        <span class="hljs-comment">// 3. 转换为VO对象</span>
        <span class="hljs-type">UserVO</span> <span class="hljs-variable">userVO</span> <span class="hljs-operator">=</span> UserConverter.INSTANCE.toVOWithCustom(userBO);
        
        <span class="hljs-keyword">return</span> userVO;
    }
}
</code></pre>
<h2 data-id="heading-13">四、实际应用场景</h2>
<h3 data-id="heading-14">4.1 用户管理系统的完整示例</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 完整的用户管理系统示例</span>

<span class="hljs-comment">// 1. 数据库实体 (PO/DO)</span>
<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "users")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserPO</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    
    <span class="hljs-meta">@Column(name = "username")</span>
    <span class="hljs-keyword">private</span> String username;
    
    <span class="hljs-meta">@Column(name = "email")</span>
    <span class="hljs-keyword">private</span> String email;
    
    <span class="hljs-meta">@Column(name = "password_hash")</span>
    <span class="hljs-keyword">private</span> String passwordHash;
    
    <span class="hljs-meta">@Column(name = "status")</span>
    <span class="hljs-keyword">private</span> Integer status;
    
    <span class="hljs-meta">@Column(name = "created_at")</span>
    <span class="hljs-keyword">private</span> Date createdAt;
    
    <span class="hljs-meta">@Column(name = "updated_at")</span>
    <span class="hljs-keyword">private</span> Date updatedAt;
    
    <span class="hljs-comment">// getters and setters</span>
}

<span class="hljs-comment">// 2. 数据访问层</span>
<span class="hljs-meta">@Repository</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRepository</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> JdbcTemplate jdbcTemplate;
    
    <span class="hljs-keyword">public</span> UserDO <span class="hljs-title function_">findById</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"SELECT * FROM users WHERE id = ?"</span>;
        <span class="hljs-keyword">return</span> jdbcTemplate.queryForObject(sql, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]{id}, <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserRowMapper</span>());
    }
    
    <span class="hljs-keyword">public</span> List&lt;UserDO&gt; <span class="hljs-title function_">findAll</span><span class="hljs-params">()</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"SELECT * FROM users"</span>;
        <span class="hljs-keyword">return</span> jdbcTemplate.query(sql, <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserRowMapper</span>());
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(UserDO userDO)</span> {
        <span class="hljs-keyword">if</span> (userDO.getId() == <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// 插入新用户</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"INSERT INTO users (username, email, password_hash, status, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?)"</span>;
            jdbcTemplate.update(sql, userDO.getUsername(), userDO.getEmail(), userDO.getPasswordHash(), 
                              userDO.getStatus(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 更新用户</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"UPDATE users SET username = ?, email = ?, password_hash = ?, status = ?, updated_at = ? WHERE id = ?"</span>;
            jdbcTemplate.update(sql, userDO.getUsername(), userDO.getEmail(), userDO.getPasswordHash(), 
                              userDO.getStatus(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(), userDO.getId());
        }
    }
}

<span class="hljs-comment">// 3. 业务逻辑层</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserRepository userRepository;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> PasswordEncoder passwordEncoder;
    
    <span class="hljs-keyword">public</span> UserVO <span class="hljs-title function_">createUser</span><span class="hljs-params">(CreateUserDTO createUserDTO)</span> {
        <span class="hljs-comment">// 1. DTO转BO</span>
        <span class="hljs-type">UserBO</span> <span class="hljs-variable">userBO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserBO</span>();
        userBO.setUsername(createUserDTO.getUsername());
        userBO.setEmail(createUserDTO.getEmail());
        userBO.setPassword(passwordEncoder.encode(createUserDTO.getPassword()));
        userBO.setStatus(<span class="hljs-number">1</span>); <span class="hljs-comment">// 默认激活状态</span>
        
        <span class="hljs-comment">// 2. 业务逻辑处理</span>
        <span class="hljs-keyword">if</span> (userRepository.existsByUsername(userBO.getUsername())) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"用户名已存在"</span>);
        }
        
        <span class="hljs-keyword">if</span> (userRepository.existsByEmail(userBO.getEmail())) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"邮箱已存在"</span>);
        }
        
        <span class="hljs-comment">// 3. BO转DO并保存</span>
        <span class="hljs-type">UserDO</span> <span class="hljs-variable">userDO</span> <span class="hljs-operator">=</span> convertToDO(userBO);
        userRepository.save(userDO);
        
        <span class="hljs-comment">// 4. DO转BO再转VO</span>
        userBO.setId(userDO.getId());
        <span class="hljs-type">UserVO</span> <span class="hljs-variable">userVO</span> <span class="hljs-operator">=</span> convertToVO(userBO);
        
        <span class="hljs-keyword">return</span> userVO;
    }
    
    <span class="hljs-keyword">public</span> UserVO <span class="hljs-title function_">getUserById</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-type">UserDO</span> <span class="hljs-variable">userDO</span> <span class="hljs-operator">=</span> userRepository.findById(id);
        <span class="hljs-keyword">if</span> (userDO == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"用户不存在"</span>);
        }
        
        <span class="hljs-type">UserBO</span> <span class="hljs-variable">userBO</span> <span class="hljs-operator">=</span> convertToBO(userDO);
        <span class="hljs-keyword">return</span> convertToVO(userBO);
    }
    
    <span class="hljs-keyword">public</span> List&lt;UserListItemVO&gt; <span class="hljs-title function_">getAllUsers</span><span class="hljs-params">()</span> {
        List&lt;UserDO&gt; userDOs = userRepository.findAll();
        <span class="hljs-keyword">return</span> userDOs.stream()
                .map(<span class="hljs-built_in">this</span>::convertToBO)
                .map(<span class="hljs-built_in">this</span>::convertToListItemVO)
                .collect(Collectors.toList());
    }
    
    <span class="hljs-keyword">private</span> UserDO <span class="hljs-title function_">convertToDO</span><span class="hljs-params">(UserBO userBO)</span> {
        <span class="hljs-type">UserDO</span> <span class="hljs-variable">userDO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserDO</span>();
        userDO.setId(userBO.getId());
        userDO.setUsername(userBO.getUsername());
        userDO.setEmail(userBO.getEmail());
        userDO.setPasswordHash(userBO.getPassword());
        userDO.setStatus(userBO.getStatus());
        userDO.setCreatedAt(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
        userDO.setUpdatedAt(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
        <span class="hljs-keyword">return</span> userDO;
    }
    
    <span class="hljs-keyword">private</span> UserBO <span class="hljs-title function_">convertToBO</span><span class="hljs-params">(UserDO userDO)</span> {
        <span class="hljs-type">UserBO</span> <span class="hljs-variable">userBO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserBO</span>();
        userBO.setId(userDO.getId());
        userBO.setUsername(userDO.getUsername());
        userBO.setEmail(userDO.getEmail());
        userBO.setPassword(userDO.getPasswordHash());
        userBO.setStatus(userDO.getStatus());
        userBO.setLastLoginTime(userDO.getUpdatedAt());
        <span class="hljs-keyword">return</span> userBO;
    }
    
    <span class="hljs-keyword">private</span> UserVO <span class="hljs-title function_">convertToVO</span><span class="hljs-params">(UserBO userBO)</span> {
        <span class="hljs-type">UserVO</span> <span class="hljs-variable">userVO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserVO</span>();
        userVO.setId(userBO.getId());
        userVO.setUsername(userBO.getUsername());
        userVO.setEmail(userBO.getEmail());
        userVO.setAvatar(<span class="hljs-string">"https://cdn.example.com/avatar/"</span> + userBO.getId() + <span class="hljs-string">".jpg"</span>);
        userVO.setStatusDesc(getStatusDesc(userBO.getStatus()));
        userVO.setLastLoginTime(formatTime(userBO.getLastLoginTime()));
        <span class="hljs-keyword">return</span> userVO;
    }
    
    <span class="hljs-keyword">private</span> UserListItemVO <span class="hljs-title function_">convertToListItemVO</span><span class="hljs-params">(UserBO userBO)</span> {
        <span class="hljs-type">UserListItemVO</span> <span class="hljs-variable">listItemVO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserListItemVO</span>();
        listItemVO.setId(userBO.getId());
        listItemVO.setUsername(userBO.getUsername());
        listItemVO.setEmail(userBO.getEmail());
        listItemVO.setStatusDesc(getStatusDesc(userBO.getStatus()));
        <span class="hljs-keyword">return</span> listItemVO;
    }
    
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getStatusDesc</span><span class="hljs-params">(Integer status)</span> {
        <span class="hljs-keyword">switch</span> (status) {
            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"激活"</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"锁定"</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"注销"</span>;
            <span class="hljs-keyword">default</span>: <span class="hljs-keyword">return</span> <span class="hljs-string">"未知"</span>;
        }
    }
    
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">formatTime</span><span class="hljs-params">(Date date)</span> {
        <span class="hljs-keyword">if</span> (date == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
        }
        <span class="hljs-type">SimpleDateFormat</span> <span class="hljs-variable">sdf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>);
        <span class="hljs-keyword">return</span> sdf.format(date);
    }
}

<span class="hljs-comment">// 4. 控制器层</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api/users")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService;
    
    <span class="hljs-meta">@PostMapping</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;UserVO&gt; <span class="hljs-title function_">createUser</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> <span class="hljs-meta">@Valid</span> CreateUserDTO createUserDTO)</span> {
        <span class="hljs-type">UserVO</span> <span class="hljs-variable">userVO</span> <span class="hljs-operator">=</span> userService.createUser(createUserDTO);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(userVO);
    }
    
    <span class="hljs-meta">@GetMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;UserVO&gt; <span class="hljs-title function_">getUserById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> {
        <span class="hljs-type">UserVO</span> <span class="hljs-variable">userVO</span> <span class="hljs-operator">=</span> userService.getUserById(id);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(userVO);
    }
    
    <span class="hljs-meta">@GetMapping</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;List&lt;UserListItemVO&gt;&gt; <span class="hljs-title function_">getAllUsers</span><span class="hljs-params">()</span> {
        List&lt;UserListItemVO&gt; users = userService.getAllUsers();
        <span class="hljs-keyword">return</span> ResponseEntity.ok(users);
    }
}
</code></pre>
<h3 data-id="heading-15">4.2 DTO对象定义</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// DTO对象定义</span>

<span class="hljs-comment">// 创建用户请求DTO</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CreateUserDTO</span> {
    <span class="hljs-meta">@NotBlank(message = "用户名不能为空")</span>
    <span class="hljs-meta">@Size(min = 3, max = 20, message = "用户名长度必须在3-20之间")</span>
    <span class="hljs-keyword">private</span> String username;
    
    <span class="hljs-meta">@NotBlank(message = "邮箱不能为空")</span>
    <span class="hljs-meta">@Email(message = "邮箱格式不正确")</span>
    <span class="hljs-keyword">private</span> String email;
    
    <span class="hljs-meta">@NotBlank(message = "密码不能为空")</span>
    <span class="hljs-meta">@Size(min = 6, max = 20, message = "密码长度必须在6-20之间")</span>
    <span class="hljs-keyword">private</span> String password;
    
    <span class="hljs-comment">// getters and setters</span>
}

<span class="hljs-comment">// 用户列表项VO</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserListItemVO</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String username;
    <span class="hljs-keyword">private</span> String email;
    <span class="hljs-keyword">private</span> String statusDesc;
    
    <span class="hljs-comment">// getters and setters</span>
}

<span class="hljs-comment">// 用户详情VO</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserVO</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String username;
    <span class="hljs-keyword">private</span> String email;
    <span class="hljs-keyword">private</span> String avatar;
    <span class="hljs-keyword">private</span> String statusDesc;
    <span class="hljs-keyword">private</span> String lastLoginTime;
    
    <span class="hljs-comment">// getters and setters</span>
}
</code></pre>
<h2 data-id="heading-16">五、最佳实践建议</h2>
<h3 data-id="heading-17">5.1 命名规范</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 推荐的命名规范</span>
<span class="hljs-comment">// PO: UserPO, OrderPO</span>
<span class="hljs-comment">// DO: UserDO, OrderDO  </span>
<span class="hljs-comment">// DTO: UserDTO, CreateUserRequest, UpdateUserRequest</span>
<span class="hljs-comment">// BO: UserBO, OrderBO</span>
<span class="hljs-comment">// VO: UserVO, UserDetailVO, UserListItemVO</span>
</code></pre>
<h3 data-id="heading-18">5.2 转换工具选择</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. 简单场景：手动转换</span>
<span class="hljs-comment">// 2. 复杂场景：MapStruct</span>
<span class="hljs-comment">// 3. 特殊场景：自定义转换器</span>

<span class="hljs-comment">// MapStruct配置示例</span>
<span class="hljs-meta">@Mapper(componentModel = "spring")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> {
    <span class="hljs-type">UserMapper</span> <span class="hljs-variable">INSTANCE</span> <span class="hljs-operator">=</span> Mappers.getMapper(UserMapper.class);
    
    UserBO <span class="hljs-title function_">toBO</span><span class="hljs-params">(UserDO userDO)</span>;
    UserVO <span class="hljs-title function_">toVO</span><span class="hljs-params">(UserBO userBO)</span>;
    
    <span class="hljs-meta">@Mapping(target = "password", ignore = true)</span>  <span class="hljs-comment">// 忽略密码字段</span>
    UserVO <span class="hljs-title function_">toSafeVO</span><span class="hljs-params">(UserBO userBO)</span>;
}
</code></pre>
<h3 data-id="heading-19">5.3 分层使用建议</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 各层对象使用建议</span>
<span class="hljs-comment">// Controller层：主要使用VO和DTO</span>
<span class="hljs-comment">// Service层：主要使用BO</span>
<span class="hljs-comment">// Repository层：主要使用DO/PO</span>
<span class="hljs-comment">// 外部接口：主要使用DTO</span>
</code></pre>
<h3 data-id="heading-20">5.4 性能考虑</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 避免不必要的转换</span>
<span class="hljs-comment">// 1. 只转换需要的字段</span>
<span class="hljs-comment">// 2. 批量操作时考虑批量转换</span>
<span class="hljs-comment">// 3. 缓存转换结果（如果适用）</span>

<span class="hljs-comment">// 批量转换示例</span>
<span class="hljs-keyword">public</span> List&lt;UserVO&gt; <span class="hljs-title function_">batchConvertToVO</span><span class="hljs-params">(List&lt;UserBO&gt; userBOs)</span> {
    <span class="hljs-keyword">return</span> userBOs.stream()
            .map(<span class="hljs-built_in">this</span>::convertToVO)
            .collect(Collectors.toList());
}
</code></pre>
<h2 data-id="heading-21">六、常见误区</h2>
<h3 data-id="heading-22">6.1 误区一：所有层都用同一个对象</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 错误的做法</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
    <span class="hljs-meta">@GetMapping("/users/{id}")</span>
    <span class="hljs-keyword">public</span> UserDO <span class="hljs-title function_">getUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> {
        <span class="hljs-comment">// 直接返回数据库对象，可能暴露敏感信息</span>
        <span class="hljs-keyword">return</span> userService.getUserById(id);
    }
}

<span class="hljs-comment">// 正确的做法</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
    <span class="hljs-meta">@GetMapping("/users/{id}")</span>
    <span class="hljs-keyword">public</span> UserVO <span class="hljs-title function_">getUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> {
        <span class="hljs-comment">// 返回专门的VO对象，过滤敏感信息</span>
        <span class="hljs-keyword">return</span> userService.getUserVOById(id);
    }
}
</code></pre>
<h3 data-id="heading-23">6.2 误区二：对象之间随意转换</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 错误的做法</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-keyword">public</span> UserVO <span class="hljs-title function_">processUser</span><span class="hljs-params">(UserVO userVO)</span> {
        <span class="hljs-comment">// 在Service层直接操作VO对象</span>
        <span class="hljs-comment">// 违反了分层原则</span>
        <span class="hljs-keyword">return</span> userVO;
    }
}

<span class="hljs-comment">// 正确的做法</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-keyword">public</span> UserVO <span class="hljs-title function_">processUser</span><span class="hljs-params">(UserDTO userDTO)</span> {
        <span class="hljs-comment">// 1. DTO转BO</span>
        <span class="hljs-type">UserBO</span> <span class="hljs-variable">userBO</span> <span class="hljs-operator">=</span> convertToBO(userDTO);
        
        <span class="hljs-comment">// 2. 在BO上执行业务逻辑</span>
        processBusinessLogic(userBO);
        
        <span class="hljs-comment">// 3. BO转VO</span>
        <span class="hljs-keyword">return</span> convertToVO(userBO);
    }
}
</code></pre>
<h3 data-id="heading-24">6.3 误区三：过度设计</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 错误的做法 - 过度分层</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-keyword">public</span> SimpleUserVO <span class="hljs-title function_">getSimpleUser</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-type">UserDO</span> <span class="hljs-variable">userDO</span> <span class="hljs-operator">=</span> userRepository.findById(id);
        <span class="hljs-type">UserBO</span> <span class="hljs-variable">userBO</span> <span class="hljs-operator">=</span> userConverter.toBO(userDO);
        <span class="hljs-type">UserDTO</span> <span class="hljs-variable">userDTO</span> <span class="hljs-operator">=</span> userConverter.toDTO(userBO);
        <span class="hljs-type">UserVO</span> <span class="hljs-variable">userVO</span> <span class="hljs-operator">=</span> userConverter.toVO(userDTO);
        <span class="hljs-type">SimpleUserVO</span> <span class="hljs-variable">simpleUserVO</span> <span class="hljs-operator">=</span> userConverter.toSimpleVO(userVO);
        <span class="hljs-keyword">return</span> simpleUserVO;
    }
}

<span class="hljs-comment">// 正确的做法 - 合理分层</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-keyword">public</span> UserVO <span class="hljs-title function_">getUser</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-type">UserDO</span> <span class="hljs-variable">userDO</span> <span class="hljs-operator">=</span> userRepository.findById(id);
        <span class="hljs-type">UserBO</span> <span class="hljs-variable">userBO</span> <span class="hljs-operator">=</span> userConverter.toBO(userDO);
        <span class="hljs-keyword">return</span> userConverter.toVO(userBO);
    }
}
</code></pre>
<h2 data-id="heading-25">七、总结</h2>
<p>通过今天的详细讲解，我们了解了各种对象的概念和使用场景：</p>
<ol>
<li><strong>PO (Persistent Object)</strong>：与数据库表结构对应的持久化对象</li>
<li><strong>DO (Data Object)</strong>：数据访问层使用的数据对象</li>
<li><strong>DTO (Data Transfer Object)</strong>：用于层间数据传输的对象</li>
<li><strong>BO (Business Object)</strong>：包含业务逻辑的业务对象</li>
<li><strong>VO (Value Object)</strong>：用于前端展示的视图对象</li>
</ol>
<p><strong>核心要点</strong>：</p>
<ul>
<li>不同对象有不同的职责和使用场景</li>
<li>合理分层能提高代码的可维护性和安全性</li>
<li>对象转换是必要的，但要避免过度设计</li>
<li>选择合适的转换工具能提高开发效率</li>
</ul>
<p>掌握了这些概念，相信你在项目开发中再也不会被这些缩写绕晕了！</p>
<p><strong>今日思考</strong>：你们团队在项目中是如何使用这些对象的？有没有什么好的实践经验？欢迎在评论区分享你的看法！</p>
<hr/>
<p><em>如果你觉得这篇文章对你有帮助，欢迎分享给更多的朋友。关注"服务端技术精选"，获取更多技术干货！</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring事务嵌套异常处理深度解析]]></title>    <link>https://juejin.cn/post/7600692485946556425</link>    <guid>https://juejin.cn/post/7600692485946556425</guid>    <pubDate>2026-01-30T05:23:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600692485946556425" data-draft-id="7600675515151368219" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring事务嵌套异常处理深度解析"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-30T05:23:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="马卡巴卡"/> <meta itemprop="url" content="https://juejin.cn/user/1892677617451163"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring事务嵌套异常处理深度解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1892677617451163/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    马卡巴卡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T05:23:43.000Z" title="Fri Jan 30 2026 05:23:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Spring事务嵌套异常处理深度解析</h2>
<h2 data-id="heading-1">问题分析</h2>
<p>您遇到的问题是<strong>Spring 事务嵌套使用时的经典陷阱</strong>：当外层方法和内层方法都标注了<code>@Transactional</code>注解，内层方法抛出异常并被外层<code>try-catch</code>捕获，但外层事务提交时仍然报错。</p>
<h3 data-id="heading-2">错误原因</h3>
<p><strong>根本原因在于 Spring 事务的传播机制和事务状态传播</strong>：</p>
<pre><code class="hljs language-sql" lang="sql">org.springframework.transaction.UnexpectedRollbackException: 
Transaction rolled back because it has been marked <span class="hljs-keyword">as</span> <span class="hljs-keyword">rollback</span><span class="hljs-operator">-</span><span class="hljs-keyword">only</span>
</code></pre>
<p>这个错误表明<strong>事务已经被标记为 rollback-only 状态</strong>，即使异常被捕获，这个状态仍然会传播到外层事务。</p>
<h2 data-id="heading-3">事务传播机制详解</h2>
<h3 data-id="heading-4">1. 默认传播行为：REQUIRED</h3>
<p>Spring 默认的事务传播行为是<code>Propagation.REQUIRED</code>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional(propagation = Propagation.REQUIRED)</span> <span class="hljs-comment">// 默认</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">outerMethod</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">try</span> {
        innerService.innerMethod();
    } <span class="hljs-keyword">catch</span> (Exception e) {
        <span class="hljs-comment">// 异常处理</span>
    }
}
</code></pre>
<p><strong>关键特性</strong>：</p>
<ul>
<li>
<p>如果当前已经在一个事务中，则加入当前事务</p>
</li>
<li>
<p>内外层方法<strong>共用同一个事务</strong></p>
</li>
<li>
<p>只要内层方法抛出<code>RuntimeException</code>，<strong>整个事务就会被设置成 rollback-only</strong></p>
</li>
<li>
<p>即使外层<code>try-catch</code>内层异常，<strong>该事务仍然会回滚</strong></p>
</li>
</ul>
<h3 data-id="heading-5">2. 问题演示代码</h3>
<h3 data-id="heading-6">外层方法</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OuterService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">InnerService</span> innerService;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">UserMapper</span> userMapper;
    
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">outerMethod</span>(<span class="hljs-params">User user</span>) {
        <span class="hljs-comment">// 业务操作</span>
        userMapper.<span class="hljs-title function_">insert</span>(user);
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 调用内层事务方法</span>
            innerService.<span class="hljs-title function_">innerMethod</span>();
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
            <span class="hljs-comment">// 捕获异常，但事务已经被标记为rollback-only</span>
            log.<span class="hljs-title function_">error</span>(<span class="hljs-string">"内层方法执行异常"</span>, e);
        }
        
        <span class="hljs-comment">// 这里会报错：Transaction rolled back because it has been marked as rollback-only</span>
    }
}
</code></pre>
<h3 data-id="heading-7">内层方法</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InnerService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">OrderMapper</span> orderMapper;
    
    <span class="hljs-meta">@Transactional</span> <span class="hljs-comment">// 默认Propagation.REQUIRED</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">innerMethod</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 业务操作</span>
        orderMapper.<span class="hljs-title function_">insert</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>());
        
        <span class="hljs-comment">// 抛出运行时异常</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"内层方法异常"</span>);
    }
}
</code></pre>
<h2 data-id="heading-8">解决方案</h2>
<h3 data-id="heading-9">方案一：使用 NESTED 传播行为</h3>
<p><strong>NESTED 传播行为</strong>允许内层事务作为子事务嵌套在外层事务中：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InnerService</span> {
    
    <span class="hljs-meta">@Transactional(propagation = Propagation.NESTED)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">innerMethod</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 业务逻辑</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"内层方法异常"</span>);
    }
}
</code></pre>
<p><strong>关键特性</strong>：</p>
<ul>
<li>
<p>内层事务嵌套在外层事务中作为子事务</p>
</li>
<li>
<p>内层事务失败可以单独回滚，<strong>不影响外层事务</strong></p>
</li>
<li>
<p><strong>需要外层 try-catch 内层异常</strong></p>
</li>
<li>
<p>基于数据库的 Savepoint 实现</p>
</li>
</ul>
<p><strong>使用前提</strong>：</p>
<ol>
<li>
<p>JDK 版本 1.4+（支持 java.sql.Savepoint）</p>
</li>
<li>
<p>事务管理器的<code>nestedTransactionAllowed</code>属性为 true</p>
</li>
<li>
<p><strong>外层必须 try-catch 内层异常</strong></p>
</li>
</ol>
<h3 data-id="heading-10">方案二：使用 REQUIRES_NEW 传播行为</h3>
<p><strong>REQUIRES_NEW 传播行为</strong>会创建一个全新的独立事务：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InnerService</span> {
    
    <span class="hljs-meta">@Transactional(propagation = Propagation.REQUIRES_NEW)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">innerMethod</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 业务逻辑</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"内层方法异常"</span>);
    }
}
</code></pre>
<p><strong>关键特性</strong>：</p>
<ul>
<li>
<p>每次调用都会创建新事务</p>
</li>
<li>
<p>如果当前已有事务，会挂起当前事务</p>
</li>
<li>
<p>内层事务独立提交或回滚，<strong>不影响外层事务</strong></p>
</li>
<li>
<p>内层事务结束后立即提交，不等外层事务</p>
</li>
</ul>
<p><strong>注意事项</strong>：</p>
<ul>
<li>
<p>内层事务回滚后仍然会抛出异常</p>
</li>
<li>
<p>外层需要捕获这个异常，否则外层事务仍然会回滚</p>
</li>
</ul>
<h3 data-id="heading-11">方案三：手动控制事务状态</h3>
<p>如果必须使用默认的 REQUIRED 传播行为，可以通过<strong>编程式事务管理</strong>手动控制事务状态：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OuterService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">TransactionTemplate</span> transactionTemplate;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">InnerService</span> innerService;
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">outerMethod</span>(<span class="hljs-params">User user</span>) {
        transactionTemplate.<span class="hljs-title function_">execute</span>(status -&gt; {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// 外层事务操作</span>
                userMapper.<span class="hljs-title function_">insert</span>(user);
                
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// 调用内层方法</span>
                    innerService.<span class="hljs-title function_">innerMethod</span>();
                } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
                    <span class="hljs-comment">// 内层异常处理</span>
                    log.<span class="hljs-title function_">error</span>(<span class="hljs-string">"内层方法执行异常"</span>, e);
                    <span class="hljs-comment">// 不设置rollback-only</span>
                }
                
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
                status.<span class="hljs-title function_">setRollbackOnly</span>();
                <span class="hljs-keyword">throw</span> e;
            }
        });
    }
}
</code></pre>
<h3 data-id="heading-12">方案四：异常重新抛出</h3>
<p>如果确实需要捕获异常并希望事务回滚，可以在捕获后<strong>重新抛出异常</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">outerMethod</span>(<span class="hljs-params">User user</span>) {
    userMapper.<span class="hljs-title function_">insert</span>(user);
    
    <span class="hljs-keyword">try</span> {
        innerService.<span class="hljs-title function_">innerMethod</span>();
    } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
        <span class="hljs-comment">// 异常处理逻辑</span>
        log.<span class="hljs-title function_">error</span>(<span class="hljs-string">"内层方法执行异常"</span>, e);
        <span class="hljs-comment">// 重新抛出异常，触发事务回滚</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"业务异常"</span>, e);
    }
}
</code></pre>
<h2 data-id="heading-13">最佳实践建议</h2>
<h3 data-id="heading-14">1. 事务传播策略选择</h3>





























<table><thead><tr><th>传播行为</th><th>使用场景</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>REQUIRED</td><td>内外层事务需要完全一致的结果</td><td>简单易用，事务一致性好</td><td>异常传播难以控制</td></tr><tr><td>NESTED</td><td>内层事务失败不影响外层事务</td><td>事务粒度更细，灵活性好</td><td>依赖数据库 Savepoint 支持</td></tr><tr><td>REQUIRES_NEW</td><td>内层事务需要独立提交</td><td>完全独立，互不影响</td><td>事务资源消耗较大</td></tr></tbody></table>
<h3 data-id="heading-15">2. 异常处理最佳实践</h3>
<ol>
<li>
<p><strong>避免在事务方法中捕获 RuntimeException</strong>：<br/>
// 错误示例 @Transactional public void method() { try { // 可能抛出RuntimeException的操作 } catch (RuntimeException e) { // 事务不会回滚 } }</p>
</li>
<li>
<p><strong>使用 checked 异常进行业务异常处理</strong>：<br/>
// 正确示例 @Transactional public void method() throws BusinessException { try { // 业务操作 } catch (RuntimeException e) { throw new BusinessException("业务异常", e); } }</p>
</li>
<li>
<p><strong>明确指定 rollbackFor 属性</strong>：<br/>
@Transactional(rollbackFor = {BusinessException.class, RuntimeException.class}) public void method() throws BusinessException { // 业务逻辑 }</p>
</li>
</ol>
<h3 data-id="heading-16">3. 事务设计原则</h3>
<ol>
<li>
<p><strong>保持事务方法的单一职责</strong>：<br/>
// 好的设计 @Transactional public void createUser(User user) { // 只包含用户创建相关操作 } @Transactional public void createOrder(Order order) { // 只包含订单创建相关操作 }</p>
</li>
<li>
<p><strong>避免过长的事务</strong>：<br/>
// 避免在事务中执行耗时操作 @Transactional public void method() { // 数据库操作 // 避免：远程调用、文件IO、复杂计算等耗时操作 }</p>
</li>
<li>
<p><strong>事务边界明确</strong>：<br/>
// 事务方法应该是业务逻辑的完整单元 @Service public class BusinessService { @Transactional public void completeBusinessProcess(BusinessData data) { // 完整的业务流程 validateData(data); createEntity(data); updateRelatedData(data); sendNotification(data); } }</p>
</li>
</ol>
<h2 data-id="heading-17">总结</h2>
<p>Spring 事务嵌套异常处理的核心在于<strong>理解事务传播机制和异常传播行为</strong>：</p>
<ol>
<li>
<p><strong>默认的 REQUIRED 传播行为</strong>会导致内外层事务共用同一个事务上下文</p>
</li>
<li>
<p><strong>RuntimeException 会自动标记事务为 rollback-only</strong>，即使被捕获</p>
</li>
<li>
<p><strong>合理选择事务传播行为</strong>（NESTED 或 REQUIRES_NEW）可以解决大部分问题</p>
</li>
<li>
<p><strong>编程式事务管理</strong>提供了最灵活的事务控制方式</p>
</li>
</ol>
<p>在实际开发中，应该根据<strong>业务需求的事务一致性要求</strong>选择合适的事务传播策略，并遵循异常处理的最佳实践，以避免类似的事务陷阱。</p>
<p><strong>记住：事务管理的目标是保证数据一致性，而不是简单地捕获异常。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3侦听器实战：组件与Pinia状态监听如何高效应用？]]></title>    <link>https://juejin.cn/post/7600670487410180148</link>    <guid>https://juejin.cn/post/7600670487410180148</guid>    <pubDate>2026-01-30T03:59:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600670487410180148" data-draft-id="7600692485946343433" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3侦听器实战：组件与Pinia状态监听如何高效应用？   "/> <meta itemprop="keywords" content="前端,Vue.js,Trae"/> <meta itemprop="datePublished" content="2026-01-30T03:59:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="kknone"/> <meta itemprop="url" content="https://juejin.cn/user/1366025597879930"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3侦听器实战：组件与Pinia状态监听如何高效应用？   
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1366025597879930/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    kknone
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T03:59:54.000Z" title="Fri Jan 30 2026 03:59:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue3 侦听器实战案例——在组件与Pinia中的应用</h2>
<h3 data-id="heading-1">一、组件内的侦听器基础</h3>
<h4 data-id="heading-2">1.1 基本概念与使用场景</h4>
<p>侦听器是Vue3中用于响应数据变化的核心工具，当你需要在数据变化时执行异步或复杂的操作时，侦听器就派上用场了。比如：</p>
<ul>
<li>数据变化时发送API请求</li>
<li>表单验证</li>
<li>复杂的状态联动</li>
</ul>
<h5 data-id="heading-3">Options API 写法</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">question</span>: <span class="hljs-string">''</span>,
      <span class="hljs-attr">answer</span>: <span class="hljs-string">'Questions usually contain a question mark. ;-)'</span>,
      <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span>
    }
  },
  <span class="hljs-attr">watch</span>: {
    <span class="hljs-comment">// 当question变化时触发</span>
    <span class="hljs-title function_">question</span>(<span class="hljs-params">newQuestion, oldQuestion</span>) {
      <span class="hljs-keyword">if</span> (newQuestion.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'?'</span>)) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getAnswer</span>()
      }
    }
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">getAnswer</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">true</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">answer</span> = <span class="hljs-string">'Thinking...'</span>
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://yesno.wtf/api'</span>)
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">answer</span> = (<span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>()).<span class="hljs-property">answer</span>
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">answer</span> = <span class="hljs-string">'Error! Could not reach the API. '</span> + error
      } <span class="hljs-keyword">finally</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span>
      }
    }
  }
}
</code></pre>
<h5 data-id="heading-4">Composition API 写法</h5>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { ref, watch } from 'vue'

const question = ref('')
const answer = ref('Questions usually contain a question mark. ;-)')
const loading = ref(false)

// 直接监听ref
watch(question, async (newQuestion, oldQuestion) =&gt; {
  if (newQuestion.includes('?')) {
    loading.value = true
    answer.value = 'Thinking...'
    try {
      const res = await fetch('https://yesno.wtf/api')
      answer.value = (await res.json()).answer
    } catch (error) {
      answer.value = 'Error! Could not reach the API. ' + error
    } finally {
      loading.value = false
    }
  }
})
&lt;/script&gt;

&lt;template&gt;
  &lt;p&gt;
    Ask a yes/no question:
    &lt;input v-model="question" :disabled="loading" /&gt;
  &lt;/p&gt;
  &lt;p&gt;{{ answer }}&lt;/p&gt;
&lt;/template&gt;
</code></pre>
<h4 data-id="heading-5">1.2 深度侦听器</h4>
<p>默认情况下，侦听器是浅层的，只会监听引用类型的引用变化，不会监听内部属性变化。如果需要监听嵌套对象的变化，需要使用深度侦听器。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { reactive, watch } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> user = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span>,
  <span class="hljs-attr">address</span>: {
    <span class="hljs-attr">city</span>: <span class="hljs-string">'New York'</span>
  }
})

<span class="hljs-comment">// 深度侦听整个对象</span>
<span class="hljs-title function_">watch</span>(user, <span class="hljs-function">(<span class="hljs-params">newUser, oldUser</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'User changed:'</span>, newUser)
}, { <span class="hljs-attr">deep</span>: <span class="hljs-literal">true</span> })

<span class="hljs-comment">// 或者只侦听嵌套属性</span>
<span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> user.<span class="hljs-property">address</span>.<span class="hljs-property">city</span>, <span class="hljs-function">(<span class="hljs-params">newCity</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'City changed to:'</span>, newCity)
})
</code></pre>
<h4 data-id="heading-6">1.3 立即执行侦听器</h4>
<p>默认情况下，侦听器是懒加载的，只有当数据变化时才会触发。如果需要在组件创建时立即执行一次，可以使用<code>immediate: true</code>选项。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">watch</span>(question, <span class="hljs-function">(<span class="hljs-params">newQuestion</span>) =&gt;</span> {
  <span class="hljs-comment">// 这个回调会在组件创建时立即执行一次</span>
}, { <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span> })
</code></pre>
<h4 data-id="heading-7">1.4 watchEffect 的使用</h4>
<p><code>watchEffect</code>是Vue3提供的另一种侦听器，它会自动追踪回调函数中的响应式依赖，当依赖变化时自动触发。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { ref, watchEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> todoId = <span class="hljs-title function_">ref</span>(<span class="hljs-number">1</span>)
<span class="hljs-keyword">const</span> data = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)

<span class="hljs-comment">// 自动追踪todoId的变化</span>
<span class="hljs-title function_">watchEffect</span>(<span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(
    <span class="hljs-string">`https://jsonplaceholder.typicode.com/todos/<span class="hljs-subst">${todoId.value}</span>`</span>
  )
  data.<span class="hljs-property">value</span> = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>()
})
</code></pre>
<p><code>watch</code> vs <code>watchEffect</code> 对比流程图：</p>
<pre><code class="hljs">┌─────────────────┐     ┌─────────────────┐
│   watch         │     │   watchEffect   │
├─────────────────┤     ├─────────────────┤
│ 显式指定依赖    │     │ 自动追踪依赖    │
│ 懒加载（默认）  │     │ 立即执行        │
│ 可获取新旧值    │     │ 无法获取旧值    │
│ 更精确控制      │     │ 更简洁语法      │
└─────────────────┘     └─────────────────┘
</code></pre>
<h3 data-id="heading-8">二、Pinia中的侦听器应用</h3>
<h4 data-id="heading-9">2.1 监听Pinia Store中的状态</h4>
<p>在Pinia中，</p>
<details>
<summary>往期文章归档</summary>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fcdbbb1837f8c093252e61f46dbf0a2e7%2F" target="_blank" title="https://blog.cmdragon.cn/posts/cdbbb1837f8c093252e61f46dbf0a2e7/" ref="nofollow noopener noreferrer">Vue 3中何时用watch，何时用watchEffect？核心区别及性能优化策略是什么？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F09551ab614c463a6d6ca69818e8c2d52%2F" target="_blank" title="https://blog.cmdragon.cn/posts/09551ab614c463a6d6ca69818e8c2d52/" ref="nofollow noopener noreferrer">Vue 3中如何有效管理侦听器的暂停、恢复与副作用清理？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb7bca5d20f628ac09f7192ad935ef664%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b7bca5d20f628ac09f7192ad935ef664/" ref="nofollow noopener noreferrer">Vue 3 watchEffect：如何实现响应式依赖的自动追踪与副作用管理？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F2c6cdb100a20f10c7e7d4413617c7ea9%2F" target="_blank" title="https://blog.cmdragon.cn/posts/2c6cdb100a20f10c7e7d4413617c7ea9/" ref="nofollow noopener noreferrer">Vue 3 watch如何利用immediate、once、deep选项实现初始化、一次性与深度监听？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F757a1728bc1b9c0c8b317b0354d85568%2F" target="_blank" title="https://blog.cmdragon.cn/posts/757a1728bc1b9c0c8b317b0354d85568/" ref="nofollow noopener noreferrer">Vue 3中watch如何高效监听多数据源、计算结果与数组变化？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F8e70552f0f61e0dc8c7f567a2d272345%2F" target="_blank" title="https://blog.cmdragon.cn/posts/8e70552f0f61e0dc8c7f567a2d272345/" ref="nofollow noopener noreferrer">Vue 3中watch监听ref和reactive的核心差异与注意事项是什么？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fdde70ab90dc5062c435e0501f5a6e7cb%2F" target="_blank" title="https://blog.cmdragon.cn/posts/dde70ab90dc5062c435e0501f5a6e7cb/" ref="nofollow noopener noreferrer">Vue3中Watch与watchEffect的核心差异及适用场景是什么？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F1f5ed5047850ed52c0fd0386f76bd4ae%2F" target="_blank" title="https://blog.cmdragon.cn/posts/1f5ed5047850ed52c0fd0386f76bd4ae/" ref="nofollow noopener noreferrer">Vue 3自定义指令如何赋能表单自动聚焦与防抖输入的高效实现？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fe3d4e128815ad731611b8ef29e37616b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/e3d4e128815ad731611b8ef29e37616b/" ref="nofollow noopener noreferrer">Vue3中如何优雅实现支持多绑定变量和修饰符的双向绑定组件？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F7d1caedd822f70542aa0eed67e30963b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/7d1caedd822f70542aa0eed67e30963b/" ref="nofollow noopener noreferrer">Vue 3表单验证如何从基础规则到异步交互构建完整验证体系？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F3687a5437ab56cb082b5b813d5577a40%2F" target="_blank" title="https://blog.cmdragon.cn/posts/3687a5437ab56cb082b5b813d5577a40/" ref="nofollow noopener noreferrer">Vue3响应式系统如何支撑表单数据的集中管理、动态扩展与实时计算？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fad67c4eb6d76cf7707bdfe6a8146c34f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ad67c4eb6d76cf7707bdfe6a8146c34f/" ref="nofollow noopener noreferrer">Vue3跨组件通信中，全局事件总线与provide/inject该如何正确选择？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F1c1e80d697cca0923f29ec70ebb8ccd1%2F" target="_blank" title="https://blog.cmdragon.cn/posts/1c1e80d697cca0923f29ec70ebb8ccd1/" ref="nofollow noopener noreferrer">Vue3表单事件处理：v-model如何实现数据绑定、验证与提交？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb990828143d70aa87f9aa52e16692e48%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b990828143d70aa87f9aa52e16692e48/" ref="nofollow noopener noreferrer">Vue应用如何基于DOM事件传播机制与事件修饰符实现高效事件处理？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb44316e0866e9f2e6aef927dbcf5152b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b44316e0866e9f2e6aef927dbcf5152b/" ref="nofollow noopener noreferrer">Vue3中如何在调用事件处理函数时同时传递自定义参数和原生DOM事件？参数顺序有哪些注意事项？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F021636c2a06f5e2d3d01977a12ddf559%2F" target="_blank" title="https://blog.cmdragon.cn/posts/021636c2a06f5e2d3d01977a12ddf559/" ref="nofollow noopener noreferrer">从捕获到冒泡：Vue事件修饰符如何重塑事件执行顺序？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb3cddf7023ab537e623a61bc01dab6bb%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b3cddf7023ab537e623a61bc01dab6bb/" ref="nofollow noopener noreferrer">Vue事件处理：内联还是方法事件处理器，该如何抉择？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbd4d9607ce1bc34cc3bda0a1a46c40f6%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bd4d9607ce1bc34cc3bda0a1a46c40f6/" ref="nofollow noopener noreferrer">Vue事件绑定中v-on与@语法如何取舍？参数传递与原生事件处理有哪些实战技巧？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fa5f2bacb74476fd7f5e02bb3f1ba6b2b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/a5f2bacb74476fd7f5e02bb3f1ba6b2b/" ref="nofollow noopener noreferrer">Vue 3中列表排序时为何必须复制数组而非直接修改原始数据？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd3b06b57fb7f126787e6ed22dce1e341%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d3b06b57fb7f126787e6ed22dce1e341/" ref="nofollow noopener noreferrer">Vue虚拟滚动如何将列表DOM数量从万级降至十位数？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F3100cc5a2e16f8dac36f722594e6af32%2F" target="_blank" title="https://blog.cmdragon.cn/posts/3100cc5a2e16f8dac36f722594e6af32/" ref="nofollow noopener noreferrer">Vue3中v-if与v-for直接混用为何会报错？计算属性如何解决优先级冲突？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F455dc2d47c38d12c1cf350e490041e8b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/455dc2d47c38d12c1cf350e490041e8b/" ref="nofollow noopener noreferrer">为何在Vue3递归组件中必须用v-if判断子项存在？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F3f842bbd7ba0f9c91151b983bf784c8b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/3f842bbd7ba0f9c91151b983bf784c8b/" ref="nofollow noopener noreferrer">Vue3列表渲染中，如何用数组方法与计算属性优化v-for的数据处理？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F1eb3ffac668a743843b5ea1738301d40%2F" target="_blank" title="https://blog.cmdragon.cn/posts/1eb3ffac668a743843b5ea1738301d40/" ref="nofollow noopener noreferrer">Vue v-for的key：为什么它能解决列表渲染中的“玄学错误”？选错会有哪些后果？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F138b13c5341f6a1fa9015400433a3611%2F" target="_blank" title="https://blog.cmdragon.cn/posts/138b13c5341f6a1fa9015400433a3611/" ref="nofollow noopener noreferrer">Vue3中v-for与v-if为何不能直接共存于同一元素？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F0242a94dc552b93a1bc335ac4fc33db5%2F" target="_blank" title="https://blog.cmdragon.cn/posts/0242a94dc552b93a1bc335ac4fc33db5/" ref="nofollow noopener noreferrer">Vue3中v-if与v-show的本质区别及动态组件状态保持的关键策略是什么？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F97c66a18ae0e9b57c6a69b8b3a41ddf6%2F" target="_blank" title="https://blog.cmdragon.cn/posts/97c66a18ae0e9b57c6a69b8b3a41ddf6/" ref="nofollow noopener noreferrer">Vue3中v-show如何通过CSS修改display属性控制条件显示？与v-if的应用场景该如何区分？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F8a1ddfac64b25062ac56403e4c1201d2%2F" target="_blank" title="https://blog.cmdragon.cn/posts/8a1ddfac64b25062ac56403e4c1201d2/" ref="nofollow noopener noreferrer">Vue3条件渲染中v-if系列指令如何合理使用与规避错误？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F218c3a59282c3b757447ee08a01937bb%2F" target="_blank" title="https://blog.cmdragon.cn/posts/218c3a59282c3b757447ee08a01937bb/" ref="nofollow noopener noreferrer">Vue3动态样式控制：ref、reactive、watch与computed的应用场景与区别是什么？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F1bab953e41f66ac53de099fa9fe76483%2F" target="_blank" title="https://blog.cmdragon.cn/posts/1bab953e41f66ac53de099fa9fe76483/" ref="nofollow noopener noreferrer">Vue3中动态样式数组的后项覆盖规则如何与计算属性结合实现复杂状态样式管理？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc85e1fe16a7ae45e965b4e2df4d9d2f4%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c85e1fe16a7ae45e965b4e2df4d9d2f4/" ref="nofollow noopener noreferrer">Vue浅响应式如何解决深层响应式的性能问题？适用场景有哪些？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbe04b02d2723994632de0d4ca22a3391%2F" target="_blank" title="https://blog.cmdragon.cn/posts/be04b02d2723994632de0d4ca22a3391/" ref="nofollow noopener noreferrer">Vue 3组合式API中ref与reactive的核心响应式差异及使用最佳实践是什么？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbe04b02d2723994632de0d4ca22a3391%2F" target="_blank" title="https://blog.cmdragon.cn/posts/be04b02d2723994632de0d4ca22a3391/" ref="nofollow noopener noreferrer">Vue 3组合式API中ref与reactive的核心响应式差异及使用最佳实践是什么？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fa0af08dd60a37b9a890a9957f2cbfc9f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/a0af08dd60a37b9a890a9957f2cbfc9f/" ref="nofollow noopener noreferrer">Vue3响应式系统中，对象新增属性、数组改索引、原始值代理的问题如何解决？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbc287e1e36287afd90750fd907eca85e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bc287e1e36287afd90750fd907eca85e/" ref="nofollow noopener noreferrer">Vue 3中watch侦听器的正确使用姿势你掌握了吗？深度监听、与watchEffect的差异及常见报错解析 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F654b9447ef1ba7ec1126a1bc26a4726d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/654b9447ef1ba7ec1126a1bc26a4726d/" ref="nofollow noopener noreferrer">Vue响应式声明的API差异、底层原理与常见陷阱你都搞懂了吗 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F654b9447ef1ba7ec1126a1bc26a4726d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/654b9447ef1ba7ec1126a1bc26a4726d/" ref="nofollow noopener noreferrer">Vue响应式声明的API差异、底层原理与常见陷阱你都搞懂了吗 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc405a8d9950af5b7c63b56c348ac36b6%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c405a8d9950af5b7c63b56c348ac36b6/" ref="nofollow noopener noreferrer">为什么Vue 3需要ref函数？它的响应式原理与正确用法是什么？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fa7e9abb9691a81e4404d9facabe0f7c3%2F" target="_blank" title="https://blog.cmdragon.cn/posts/a7e9abb9691a81e4404d9facabe0f7c3/" ref="nofollow noopener noreferrer">Vue 3中reactive函数如何通过Proxy实现响应式？使用时要避开哪些误区？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbd995ea45161727597fb85b62566c43d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bd995ea45161727597fb85b62566c43d/" ref="nofollow noopener noreferrer">Vue3响应式系统的底层原理与实践要点你真的懂吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F53e3f270a80675df662c6857a3332c0f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/53e3f270a80675df662c6857a3332c0f/" ref="nofollow noopener noreferrer">Vue 3模板如何通过编译三阶段实现从声明式语法到高效渲染的跨越 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fddbce4f2a23aa72c96b1c0473900321e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ddbce4f2a23aa72c96b1c0473900321e/" ref="nofollow noopener noreferrer">快速入门Vue模板引用：从收DOM“快递”到调子组件方法，你玩明白了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F23a2d5a334e15575277814c16e45df50%2F" target="_blank" title="https://blog.cmdragon.cn/posts/23a2d5a334e15575277814c16e45df50/" ref="nofollow noopener noreferrer">快速入门Vue模板里的JS表达式有啥不能碰？计算属性为啥比方法更能打？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F6be38de6382e31d282659b689c5b17f0%2F" target="_blank" title="https://blog.cmdragon.cn/posts/6be38de6382e31d282659b689c5b17f0/" ref="nofollow noopener noreferrer">快速入门Vue的v-model表单绑定：语法糖、动态值、修饰符的小技巧你都掌握了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F60ce517684f4a418f453d66aa805606c%2F" target="_blank" title="https://blog.cmdragon.cn/posts/60ce517684f4a418f453d66aa805606c/" ref="nofollow noopener noreferrer">快速入门Vue3事件处理的挑战题：v-on、修饰符、自定义事件你能通关吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fe4ae7d5e4a9205bb11b2baccb230c637%2F" target="_blank" title="https://blog.cmdragon.cn/posts/e4ae7d5e4a9205bb11b2baccb230c637/" ref="nofollow noopener noreferrer">快速入门Vue3的v-指令：数据和DOM的“翻译官”到底有多少本事？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F999ce4fb32259ff4fbf4bf7bcb851654%2F" target="_blank" title="https://blog.cmdragon.cn/posts/999ce4fb32259ff4fbf4bf7bcb851654/" ref="nofollow noopener noreferrer">快速入门Vue3，插值、动态绑定和避坑技巧你都搞懂了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fa6997d81b49cd232b87e1cf603888ad1%2F" target="_blank" title="https://blog.cmdragon.cn/posts/a6997d81b49cd232b87e1cf603888ad1/" ref="nofollow noopener noreferrer">想让PostgreSQL快到飞起？先找健康密码还是先换引擎？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F1fee7afbb9abd4540b8aa9c141d6845d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/1fee7afbb9abd4540b8aa9c141d6845d/" ref="nofollow noopener noreferrer">想让PostgreSQL查询快到飞起？分区表、物化视图、并行查询这三招灵不灵？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F79c590fbd87ece535b11a71c9667884f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/79c590fbd87ece535b11a71c9667884f/" ref="nofollow noopener noreferrer">子查询总拖慢查询？把它变成连接就能解决？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F748cdac2536008199abf8a8a2cd0ec85%2F" target="_blank" title="https://blog.cmdragon.cn/posts/748cdac2536008199abf8a8a2cd0ec85/" ref="nofollow noopener noreferrer">PostgreSQL全表扫描慢到崩溃？建索引+改查询+更统计信息三招能破？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F32ca943703226d317d4276a8fb53b0dd%2F" target="_blank" title="https://blog.cmdragon.cn/posts/32ca943703226d317d4276a8fb53b0dd/" ref="nofollow noopener noreferrer">复杂查询总拖后腿？PostgreSQL多列索引+覆盖索引的神仙技巧你get没？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fca93f1d53aa910e7ba5ffd8df611c12b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ca93f1d53aa910e7ba5ffd8df611c12b/" ref="nofollow noopener noreferrer">只给表子集建索引？用函数结果建索引？PostgreSQL这俩操作凭啥能省空间又加速？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Ff507856ebfddd592448813c510a53669%2F" target="_blank" title="https://blog.cmdragon.cn/posts/f507856ebfddd592448813c510a53669/" ref="nofollow noopener noreferrer">B-tree索引像字典查词一样工作？那哪些数据库查询它能加速，哪些不能？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb2213bfcb5b88a862f2138404c03d596%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b2213bfcb5b88a862f2138404c03d596/" ref="nofollow noopener noreferrer">想抓PostgreSQL里的慢SQL？pg_stat_statements基础黑匣子和pg_stat_monitor时间窗，谁能帮你更准揪出性能小偷？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F26614eb7da6c476dde41d367ad888d2f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/26614eb7da6c476dde41d367ad888d2f/" ref="nofollow noopener noreferrer">PostgreSQL的“时光机”MVCC和锁机制是怎么搞定高并发的？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F69f99bc6972a860d559c74aad7280da4%2F" target="_blank" title="https://blog.cmdragon.cn/posts/69f99bc6972a860d559c74aad7280da4/" ref="nofollow noopener noreferrer">PostgreSQL性能暴涨的关键？内存IO并发参数居然要这么设置？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F7b7053f392147a8b3b1a16bebeb08d0a%2F" target="_blank" title="https://blog.cmdragon.cn/posts/7b7053f392147a8b3b1a16bebeb08d0a/" ref="nofollow noopener noreferrer">大表查询慢到翻遍整个书架？PostgreSQL分区表教你怎么“分类”才高效</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc856e3cb073822349f3bf2d29995dcfc%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c856e3cb073822349f3bf2d29995dcfc/" ref="nofollow noopener noreferrer">PostgreSQL 查询慢？是不是忘了优化 GROUP BY、ORDER BY 和窗口函数？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc096347d18e67b7431faacd2c4757093%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c096347d18e67b7431faacd2c4757093/" ref="nofollow noopener noreferrer">PostgreSQL里的子查询和CTE居然在性能上“掐架”？到底该站哪边？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F2eca89463454fd4250d7b66243b9fe5a%2F" target="_blank" title="https://blog.cmdragon.cn/posts/2eca89463454fd4250d7b66243b9fe5a/" ref="nofollow noopener noreferrer">PostgreSQL选Join策略有啥小九九？Nested Loop/Merge/Hash谁是它的菜？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F068ecb772a87d7df20a8c9fb4b233f8e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/068ecb772a87d7df20a8c9fb4b233f8e/" ref="nofollow noopener noreferrer">PostgreSQL新手SQL总翻车？这7个性能陷阱你踩过没？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd498f63cd0a2d5a77e445c688a8b88db%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d498f63cd0a2d5a77e445c688a8b88db/" ref="nofollow noopener noreferrer">PostgreSQL索引选B-Tree还是GiST？“瑞士军刀”和“多面手”的差别你居然还不知道？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F9101b75bdec6faea9b35d54f14e37f36%2F" target="_blank" title="https://blog.cmdragon.cn/posts/9101b75bdec6faea9b35d54f14e37f36/" ref="nofollow noopener noreferrer">想知道数据库怎么给查询“算成本选路线”？EXPLAIN能帮你看明白？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd527f8ebb6e3dae2c7dfe4c8d8979444%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d527f8ebb6e3dae2c7dfe4c8d8979444/" ref="nofollow noopener noreferrer">PostgreSQL处理SQL居然像做蛋糕？解析到执行的4步里藏着多少查询优化的小心机？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F6bfdae84f313cf7ad0bb7045c4392347%2F" target="_blank" title="https://blog.cmdragon.cn/posts/6bfdae84f313cf7ad0bb7045c4392347/" ref="nofollow noopener noreferrer">PostgreSQL备份不是复制文件？物理vs逻辑咋选？误删还能精准恢复到1分钟前？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fde3672803de34dbad244d0a8d48b0eb5%2F" target="_blank" title="https://blog.cmdragon.cn/posts/de3672803de34dbad244d0a8d48b0eb5/" ref="nofollow noopener noreferrer">转账不翻车、并发不干扰，PostgreSQL的ACID特性到底有啥魔法？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fe463e8a2668abdf00a228c9b79324ded%2F" target="_blank" title="https://blog.cmdragon.cn/posts/e463e8a2668abdf00a228c9b79324ded/" ref="nofollow noopener noreferrer">银行转账不白扣钱、电商下单不超卖，PostgreSQL事务的诀窍是啥？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F5c967e595058c4a1fc4474a68e64031d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/5c967e595058c4a1fc4474a68e64031d/" ref="nofollow noopener noreferrer">PostgreSQL里的PL/pgSQL到底是啥？能让SQL从“说目标”变“讲步骤”？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F325047855e3e23b5ef82f7d2db134fbd%2F" target="_blank" title="https://blog.cmdragon.cn/posts/325047855e3e23b5ef82f7d2db134fbd/" ref="nofollow noopener noreferrer">PostgreSQL视图不存数据？那它怎么简化查询还能递归生成序列和控制权限？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd2dba50bb6e4df7b27e735245a06a2a2%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d2dba50bb6e4df7b27e735245a06a2a2/" ref="nofollow noopener noreferrer">PostgreSQL索引这么玩，才能让你的查询真的“飞”起来？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F849ae5bab0f8c66e94c2f6ad1bb798e3%2F" target="_blank" title="https://blog.cmdragon.cn/posts/849ae5bab0f8c66e94c2f6ad1bb798e3/" ref="nofollow noopener noreferrer">PostgreSQL的表关系和约束，咋帮你搞定用户订单不混乱、学生选课不重复？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fef4800975ffa84f1ca51976a70a1585b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ef4800975ffa84f1ca51976a70a1585b/" ref="nofollow noopener noreferrer">PostgreSQL查询的筛子、排序、聚合、分组？你会用它们搞定数据吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbf54711525c507c5eacfa7b0151c39d2%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bf54711525c507c5eacfa7b0151c39d2/" ref="nofollow noopener noreferrer">PostgreSQL数据类型怎么选才高效不踩坑？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F887809b3e0375f5956873cd442f516d8%2F" target="_blank" title="https://blog.cmdragon.cn/posts/887809b3e0375f5956873cd442f516d8/" ref="nofollow noopener noreferrer">想解锁PostgreSQL查询从基础到进阶的核心知识点？你都get了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F934be1203725e8be9d6f6e9104e5abcc%2F" target="_blank" title="https://blog.cmdragon.cn/posts/934be1203725e8be9d6f6e9104e5abcc/" ref="nofollow noopener noreferrer">PostgreSQL DELETE居然有这些操作？返回数据、连表删你试过没？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F0f0622e9b7402b599e618150d0596ffe%2F" target="_blank" title="https://blog.cmdragon.cn/posts/0f0622e9b7402b599e618150d0596ffe/" ref="nofollow noopener noreferrer">PostgreSQL UPDATE语句怎么玩？从改邮箱到批量更新的避坑技巧你都会吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F0e3bf7efc030b024ea67ee855a00f2de%2F" target="_blank" title="https://blog.cmdragon.cn/posts/0e3bf7efc030b024ea67ee855a00f2de/" ref="nofollow noopener noreferrer">PostgreSQL插入数据还在逐条敲？批量、冲突处理、返回自增ID的技巧你会吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb6cd3c86da6aac26ed829e472d34078e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b6cd3c86da6aac26ed829e472d34078e/" ref="nofollow noopener noreferrer">PostgreSQL的“仓库-房间-货架”游戏，你能建出电商数据库和表吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fba1f545a3410144552fbdbfcf31b5265%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ba1f545a3410144552fbdbfcf31b5265/" ref="nofollow noopener noreferrer">PostgreSQL 17安装总翻车？Windows/macOS/Linux避坑指南帮你搞定？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb5474d1480509c5072085abc80b3dd9f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b5474d1480509c5072085abc80b3dd9f/" ref="nofollow noopener noreferrer">能当关系型数据库还能玩对象特性，能拆复杂查询还能自动管库存，PostgreSQL凭什么这么香？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fcc098d8836e787baa8a4d92e4d56d5c5%2F" target="_blank" title="https://blog.cmdragon.cn/posts/cc098d8836e787baa8a4d92e4d56d5c5/" ref="nofollow noopener noreferrer">给接口加新字段又不搞崩老客户端？FastAPI的多版本API靠哪三招实现？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F46d05151c5bd31cf37a7bcf0b8f5b0b8%2F" target="_blank" title="https://blog.cmdragon.cn/posts/46d05151c5bd31cf37a7bcf0b8f5b0b8/" ref="nofollow noopener noreferrer">流量突增要搞崩FastAPI？熔断测试是怎么防系统雪崩的？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F65ce343cc5df9faf3a8e2eeaab42ae45%2F" target="_blank" title="https://blog.cmdragon.cn/posts/65ce343cc5df9faf3a8e2eeaab42ae45/" ref="nofollow noopener noreferrer">FastAPI秒杀库存总变负数？Redis分布式锁能帮你守住底线吗 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Feed6cd8985d9be0a4b092a7da38b3e0c%2F" target="_blank" title="https://blog.cmdragon.cn/posts/eed6cd8985d9be0a4b092a7da38b3e0c/" ref="nofollow noopener noreferrer">FastAPI的CI流水线怎么自动测端点，还能让Allure报告美到犯规？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F6157d87338ce894d18c013c3c4777abb%2F" target="_blank" title="https://blog.cmdragon.cn/posts/6157d87338ce894d18c013c3c4777abb/" ref="nofollow noopener noreferrer">如何用GitHub Actions为FastAPI项目打造自动化测试流水线？ - cmdragon's Blog</a></li>
</ul>
</details>
<details>
<summary>免费好用的热门在线工具</summary>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ffile-converter" target="_blank" title="https://tools.cmdragon.cn/zh/apps/file-converter" ref="nofollow noopener noreferrer">文件格式转换器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fm3u8-player" target="_blank" title="https://tools.cmdragon.cn/zh/apps/m3u8-player" ref="nofollow noopener noreferrer">M3U8在线播放器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fquick-image-design" target="_blank" title="https://tools.cmdragon.cn/zh/apps/quick-image-design" ref="nofollow noopener noreferrer">快图设计 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-to-image-advanced" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-to-image-advanced" ref="nofollow noopener noreferrer">高级文字转图片转换器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fraid-calculator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/raid-calculator" ref="nofollow noopener noreferrer">RAID 计算器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fphotoshop-online" target="_blank" title="https://tools.cmdragon.cn/zh/apps/photoshop-online" ref="nofollow noopener noreferrer">在线PS - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fmermaid-live-editor" target="_blank" title="https://tools.cmdragon.cn/zh/apps/mermaid-live-editor" ref="nofollow noopener noreferrer">Mermaid 在线编辑器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fmath-solver-calculator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/math-solver-calculator" ref="nofollow noopener noreferrer">数学求解计算器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsmart-teleprompter" target="_blank" title="https://tools.cmdragon.cn/zh/apps/smart-teleprompter" ref="nofollow noopener noreferrer">智能提词器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fmagic-resume" target="_blank" title="https://tools.cmdragon.cn/zh/apps/magic-resume" ref="nofollow noopener noreferrer">魔法简历 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-puzzle-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-puzzle-tool" ref="nofollow noopener noreferrer">Image Puzzle Tool - 图片拼图工具 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsubtitle-downloader" target="_blank" title="https://tools.cmdragon.cn/zh/apps/subtitle-downloader" ref="nofollow noopener noreferrer">字幕下载工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Flyrics-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/lyrics-generator" ref="nofollow noopener noreferrer">歌词生成工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcloud-drive-search" target="_blank" title="https://tools.cmdragon.cn/zh/apps/cloud-drive-search" ref="nofollow noopener noreferrer">网盘资源聚合搜索 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fascii-art-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ascii-art-generator" ref="nofollow noopener noreferrer">ASCII字符画生成器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fjwt-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/jwt-tool" ref="nofollow noopener noreferrer">JSON Web Tokens 工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fbcrypt-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/bcrypt-tool" ref="nofollow noopener noreferrer">Bcrypt 密码工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fgif-composer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/gif-composer" ref="nofollow noopener noreferrer">GIF 合成器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fgif-decomposer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/gif-decomposer" ref="nofollow noopener noreferrer">GIF 分解器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-steganography" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-steganography" ref="nofollow noopener noreferrer">文本隐写术 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh" target="_blank" title="https://tools.cmdragon.cn/zh" ref="nofollow noopener noreferrer">CMDragon 在线工具 - 高级AI工具箱与开发者套件 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%3Fcategory%3Dtrending" target="_blank" title="https://tools.cmdragon.cn/zh/apps?category=trending" ref="nofollow noopener noreferrer">应用商店 - 发现1000+提升效率与开发的AI工具和实用程序 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fchangelog" target="_blank" title="https://tools.cmdragon.cn/zh/changelog" ref="nofollow noopener noreferrer">CMDragon 更新日志 - 最新更新、功能与改进 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fsponsor" target="_blank" title="https://tools.cmdragon.cn/zh/sponsor" ref="nofollow noopener noreferrer">支持我们 - 成为赞助者 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-to-image-ai" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-to-image-ai" ref="nofollow noopener noreferrer">AI文本生成图像 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftemp-email" target="_blank" title="https://tools.cmdragon.cn/zh/apps/temp-email" ref="nofollow noopener noreferrer">临时邮箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fqrcode-parser" target="_blank" title="https://tools.cmdragon.cn/zh/apps/qrcode-parser" ref="nofollow noopener noreferrer">二维码解析器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-to-mindmap" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-to-mindmap" ref="nofollow noopener noreferrer">文本转思维导图 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fregex-visualizer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/regex-visualizer" ref="nofollow noopener noreferrer">正则表达式可视化工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsteganography-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/steganography-tool" ref="nofollow noopener noreferrer">文件隐写工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fiptv-explorer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/iptv-explorer" ref="nofollow noopener noreferrer">IPTV 频道探索器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsnapdrop" target="_blank" title="https://tools.cmdragon.cn/zh/apps/snapdrop" ref="nofollow noopener noreferrer">快传 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Flucky-draw" target="_blank" title="https://tools.cmdragon.cn/zh/apps/lucky-draw" ref="nofollow noopener noreferrer">随机抽奖工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fanime-scene-finder" target="_blank" title="https://tools.cmdragon.cn/zh/apps/anime-scene-finder" ref="nofollow noopener noreferrer">动漫场景查找器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftime-toolkit" target="_blank" title="https://tools.cmdragon.cn/zh/apps/time-toolkit" ref="nofollow noopener noreferrer">时间工具箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fspeed-test" target="_blank" title="https://tools.cmdragon.cn/zh/apps/speed-test" ref="nofollow noopener noreferrer">网速测试 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fbackground-remover" target="_blank" title="https://tools.cmdragon.cn/zh/apps/background-remover" ref="nofollow noopener noreferrer">AI 智能抠图工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fbackground-replacer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/background-replacer" ref="nofollow noopener noreferrer">背景替换工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fartistic-qrcode" target="_blank" title="https://tools.cmdragon.cn/zh/apps/artistic-qrcode" ref="nofollow noopener noreferrer">艺术二维码生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fopen-graph-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/open-graph-generator" ref="nofollow noopener noreferrer">Open Graph 元标签生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-comparison" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-comparison" ref="nofollow noopener noreferrer">图像对比工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-compressor" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-compressor" ref="nofollow noopener noreferrer">图片压缩专业版 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fpassword-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/password-generator" ref="nofollow noopener noreferrer">密码生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsvg-optimizer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/svg-optimizer" ref="nofollow noopener noreferrer">SVG优化器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcolor-palette" target="_blank" title="https://tools.cmdragon.cn/zh/apps/color-palette" ref="nofollow noopener noreferrer">调色板生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fonline-metronome" target="_blank" title="https://tools.cmdragon.cn/zh/apps/online-metronome" ref="nofollow noopener noreferrer">在线节拍器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fip-geolocation" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ip-geolocation" ref="nofollow noopener noreferrer">IP归属地查询 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcss-grid-layout" target="_blank" title="https://tools.cmdragon.cn/zh/apps/css-grid-layout" ref="nofollow noopener noreferrer">CSS网格布局生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Femail-validator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/email-validator" ref="nofollow noopener noreferrer">邮箱验证工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcalligraphy-practice" target="_blank" title="https://tools.cmdragon.cn/zh/apps/calligraphy-practice" ref="nofollow noopener noreferrer">书法练习字帖 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ffinance-calculator-suite" target="_blank" title="https://tools.cmdragon.cn/zh/apps/finance-calculator-suite" ref="nofollow noopener noreferrer">金融计算器套件 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fchinese-kinship-calculator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/chinese-kinship-calculator" ref="nofollow noopener noreferrer">中国亲戚关系计算器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fprotobuf-toolkit" target="_blank" title="https://tools.cmdragon.cn/zh/apps/protobuf-toolkit" ref="nofollow noopener noreferrer">Protocol Buffer 工具箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fip-geolocation" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ip-geolocation" ref="nofollow noopener noreferrer">IP归属地查询 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-upscaler" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-upscaler" ref="nofollow noopener noreferrer">图片无损放大 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-compare" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-compare" ref="nofollow noopener noreferrer">文本比较工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fip-batch-lookup" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ip-batch-lookup" ref="nofollow noopener noreferrer">IP批量查询工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fdomain-finder" target="_blank" title="https://tools.cmdragon.cn/zh/apps/domain-finder" ref="nofollow noopener noreferrer">域名查询工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fdns-toolkit" target="_blank" title="https://tools.cmdragon.cn/zh/apps/dns-toolkit" ref="nofollow noopener noreferrer">DNS工具箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ffavicon-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/favicon-generator" ref="nofollow noopener noreferrer">网站图标生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fsitemap_index.xml" target="_blank" title="https://tools.cmdragon.cn/sitemap_index.xml" ref="nofollow noopener noreferrer">XML Sitemap</a></li>
</ul>
</details>
我们可以使用Vue的`watch`函数来监听store中的状态变化。
<p>首先创建一个Pinia store：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// stores/counter.js</span>
<span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCounterStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'counter'</span>, {
  <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({
    <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-string">'Hello Pinia'</span>
  }),
  <span class="hljs-attr">actions</span>: {
    <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++
    }
  }
})
</code></pre>
<p>然后在组件中监听store状态：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { watch } from 'vue'
import { useCounterStore } from '@/stores/counter'

const counterStore = useCounterStore()

// 监听单个状态
watch(() =&gt; counterStore.count, (newCount, oldCount) =&gt; {
  console.log(`Count changed from ${oldCount} to ${newCount}`)
})

// 监听多个状态
watch([() =&gt; counterStore.count, () =&gt; counterStore.message], 
  ([newCount, newMessage], [oldCount, oldMessage]) =&gt; {
    console.log(`Count: ${oldCount} -&gt; ${newCount}`)
    console.log(`Message: ${oldMessage} -&gt; ${newMessage}`)
  }
)

// 深度监听整个store
watch(counterStore, (newStore, oldStore) =&gt; {
  console.log('Store changed:', newStore)
}, { deep: true })
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-10">2.2 实战案例：表单状态同步</h4>
<p>假设我们有一个表单组件，需要将表单数据同步到Pinia store中，同时当store中的数据变化时，表单也需要更新。</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { ref, watch } from 'vue'
import { useFormStore } from '@/stores/form'

const formStore = useFormStore()

// 本地表单数据
const localForm = ref({
  name: '',
  email: ''
})

// 组件创建时同步store数据到本地
localForm.value = { ...formStore.formData }

// 监听本地表单变化，同步到store
watch(localForm, (newForm) =&gt; {
  formStore.updateFormData(newForm)
}, { deep: true })

// 监听store数据变化，同步到本地
watch(() =&gt; formStore.formData, (newForm) =&gt; {
  localForm.value = { ...newForm }
}, { deep: true })
&lt;/script&gt;

&lt;template&gt;
  &lt;form&gt;
    &lt;input v-model="localForm.name" placeholder="Name" /&gt;
    &lt;input v-model="localForm.email" placeholder="Email" type="email" /&gt;
  &lt;/form&gt;
&lt;/template&gt;
</code></pre>
<p>Pinia store代码：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// stores/form.js</span>
<span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useFormStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'form'</span>, {
  <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({
    <span class="hljs-attr">formData</span>: {
      <span class="hljs-attr">name</span>: <span class="hljs-string">''</span>,
      <span class="hljs-attr">email</span>: <span class="hljs-string">''</span>
    }
  }),
  <span class="hljs-attr">actions</span>: {
    <span class="hljs-title function_">updateFormData</span>(<span class="hljs-params">newData</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">formData</span> = { ...newData }
    }
  }
})
</code></pre>
<h3 data-id="heading-11">三、课后Quiz</h3>
<h4 data-id="heading-12">问题1：watch和watchEffect的主要区别是什么？</h4>
<p><strong>答案解析：</strong></p>
<ol>
<li><strong>依赖追踪方式</strong>：watch需要显式指定依赖，而watchEffect会自动追踪回调中的响应式依赖。</li>
<li><strong>执行时机</strong>：watch默认是懒加载的，只有当依赖变化时才会触发；watchEffect会在组件创建时立即执行一次。</li>
<li><strong>参数获取</strong>：watch可以获取新旧值，而watchEffect无法获取旧值。</li>
<li><strong>使用场景</strong>：watch适合需要精确控制依赖和获取新旧值的场景；watchEffect适合简单的副作用处理，语法更简洁。</li>
</ol>
<h4 data-id="heading-13">问题2：如何在Pinia中监听整个store的变化？</h4>
<p><strong>答案解析：</strong>
可以直接将store实例作为watch的第一个参数，并设置<code>deep: true</code>选项：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">watch</span>(counterStore, <span class="hljs-function">(<span class="hljs-params">newStore, oldStore</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Store changed:'</span>, newStore)
}, { <span class="hljs-attr">deep</span>: <span class="hljs-literal">true</span> })
</code></pre>
<p>或者使用getter函数：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> ({ ...counterStore }), <span class="hljs-function">(<span class="hljs-params">newStore</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Store changed:'</span>, newStore)
})
</code></pre>
<h3 data-id="heading-14">四、常见报错解决方案</h3>
<h4 data-id="heading-15">1. 报错："watch() expects a source value as the first argument"</h4>
<p><strong>原因</strong>：传递给watch的第一个参数不是有效的响应式源。比如直接传递了一个非响应式的对象或值。
<strong>解决方法</strong>：</p>
<ul>
<li>确保监听的是ref、reactive对象，或者返回响应式值的getter函数。</li>
<li>如果要监听对象的某个属性，使用getter函数：<code>watch(() =&gt; obj.property, callback)</code></li>
</ul>
<h4 data-id="heading-16">2. 报错："deep option is ignored when watching a getter"</h4>
<p><strong>原因</strong>：当使用getter函数作为watch源时，deep选项会被忽略，因为getter函数返回的是一个值，而不是引用类型。
<strong>解决方法</strong>：</p>
<ul>
<li>如果需要深度监听，直接监听整个reactive对象，或者在getter函数中返回对象的副本：<code>watch(() =&gt; ({ ...obj }), callback, { deep: true })</code></li>
</ul>
<h4 data-id="heading-17">3. 报错："Maximum call stack size exceeded"</h4>
<p><strong>原因</strong>：在watch回调中修改了被监听的数据，导致无限循环。
<strong>解决方法</strong>：</p>
<ul>
<li>确保在watch回调中不会修改被监听的同一个数据。</li>
<li>如果需要修改，可以使用条件判断或者使用<code>watchEffect</code>代替。</li>
</ul>
<h4 data-id="heading-18">4. Pinia中watch不触发</h4>
<p><strong>原因</strong>：可能是因为没有正确使用getter函数来监听store中的状态。
<strong>解决方法</strong>：</p>
<ul>
<li>使用getter函数来监听store中的状态：<code>watch(() =&gt; store.count, callback)</code></li>
<li>确保store中的状态是响应式的，使用Pinia的state定义方式。</li>
</ul>
<h3 data-id="heading-19">五、参考链接</h3>
<ul>
<li>Vue3 侦听器官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2Fguide%2Fessentials%2Fwatchers.html" target="_blank" title="https://vuejs.org/guide/essentials/watchers.html" ref="nofollow noopener noreferrer">vuejs.org/guide/essen…</a></li>
<li>Pinia 官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpinia.vuejs.org%2F" target="_blank" title="https://pinia.vuejs.org/" ref="nofollow noopener noreferrer">pinia.vuejs.org/</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3逻辑写法]]></title>    <link>https://juejin.cn/post/7600704706551152680</link>    <guid>https://juejin.cn/post/7600704706551152680</guid>    <pubDate>2026-01-30T04:12:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600704706551152680" data-draft-id="7599483314160762899" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3逻辑写法"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2026-01-30T04:12:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Aniugel"/> <meta itemprop="url" content="https://juejin.cn/user/3034307824198407"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3逻辑写法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3034307824198407/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Aniugel
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T04:12:40.000Z" title="Fri Jan 30 2026 04:12:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h3 data-id="heading-0">test.vue</h3>
<pre><code class="hljs language-js" lang="js">&lt;!-- 图片展示 --&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">el-main</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"cateList1"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-row</span> <span class="hljs-attr">:gutter</span>=<span class="hljs-string">"20"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-col</span> <span class="hljs-attr">:span</span>=<span class="hljs-string">"6"</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(item, i) in dataList"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"i"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-card</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"margin-top: 15px; position: relative"</span> <span class="hljs-attr">shadow</span>=<span class="hljs-string">"hover"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">el-image</span>
              <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 100%; height: 150px"</span>
              <span class="hljs-attr">:src</span>=<span class="hljs-string">"item.url"</span>
              <span class="hljs-attr">fit</span>=<span class="hljs-string">"cover"</span>
            /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"pic_title"</span>&gt;</span>{{ item.name }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"pic_edit"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">el-checkbox</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"item.checked"</span> @<span class="hljs-attr">change</span>=<span class="hljs-string">"selectImg(item)"</span> /&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">span</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"openDialog(item)"</span>&gt;</span>重命名<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">span</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"delPic(item.id)"</span>&gt;</span>删除<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">el-card</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">el-col</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-row</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page1"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-pagination</span>
        <span class="hljs-attr">v-model:current-page</span>=<span class="hljs-string">"querData.page"</span>
        <span class="hljs-attr">v-model:page-size</span>=<span class="hljs-string">"querData.limit"</span>
        <span class="hljs-attr">:page-sizes</span>=<span class="hljs-string">"[2, 8, 15, 20]"</span>
        <span class="hljs-attr">small</span>=<span class="hljs-string">"small"</span>
        <span class="hljs-attr">background</span>=<span class="hljs-string">"background"</span>
        <span class="hljs-attr">layout</span>=<span class="hljs-string">"total, sizes, prev, pager, next, jumper"</span>
        <span class="hljs-attr">:total</span>=<span class="hljs-string">"total"</span>
        @<span class="hljs-attr">size-change</span>=<span class="hljs-string">"handleSizeChange"</span>
        @<span class="hljs-attr">current-change</span>=<span class="hljs-string">"handleCurrentChange"</span>
      /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 重命名 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">el-dialog</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"dialogVisible"</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"重命名"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"40%"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-form</span> <span class="hljs-attr">:model</span>=<span class="hljs-string">"formDate"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"图片名称"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"formDate.name"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-form</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">footer</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dialog-footer"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"dialogVisible = false"</span>&gt;</span>取消<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"submitOk"</span>&gt;</span> 确定 <span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">el-dialog</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 上传图片 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">el-dialog</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"dialogVisibleUpload"</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"上传图片"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"40%"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">UploadImg</span>
        <span class="hljs-attr">:data</span>=<span class="hljs-string">"{ image_class_id: querData.id }"</span>
        @<span class="hljs-attr">success</span>=<span class="hljs-string">"uploadSuccess"</span>
      &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">UploadImg</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">footer</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dialog-footer"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"dialogVisible = false"</span>&gt;</span>取消<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"dialogVisible = false"</span>&gt;</span>
            确定
          <span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">el-dialog</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">el-main</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { reactive, ref, computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { getPicListByIdFn, editPicNameFn, delPicFn } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/api/pic.js'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ElMessage</span>, <span class="hljs-title class_">ElMessageBox</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'element-plus'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">UploadImg</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/UploadImg.vue'</span>

<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">num</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-number">1</span>,
  },
})

<span class="hljs-keyword">const</span> checkedImg = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> dataList.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> item.<span class="hljs-property">checked</span>)
})

<span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>(<span class="hljs-string">'selectImgData'</span>)

<span class="hljs-comment">//选择图片事件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">selectImg</span> = (<span class="hljs-params">item</span>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(item)
  <span class="hljs-keyword">if</span> (item.<span class="hljs-property">checked</span> &amp;&amp; checkedImg.<span class="hljs-property">value</span>.<span class="hljs-property">length</span> &gt; props.<span class="hljs-property">num</span>) {
    item.<span class="hljs-property">checked</span> = <span class="hljs-literal">false</span>
    <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`只能选择<span class="hljs-subst">${props.num}</span>张图片`</span>)
    <span class="hljs-keyword">return</span>
  }
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'selectImgData'</span>, checkedImg.<span class="hljs-property">value</span>)
}

<span class="hljs-comment">//上传图片对话框显示和隐藏</span>
<span class="hljs-keyword">const</span> dialogVisibleUpload = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)

<span class="hljs-keyword">const</span> <span class="hljs-title function_">openDialogUpload</span> = (<span class="hljs-params"/>) =&gt; {
  dialogVisibleUpload.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">uploadSuccess</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">getPicList</span>()
}

<span class="hljs-comment">//删除</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">delPic</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">id</span>) =&gt; {
  <span class="hljs-keyword">const</span> isdel = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ElMessageBox</span>.<span class="hljs-title function_">confirm</span>(<span class="hljs-string">'是否删除?'</span>, <span class="hljs-string">'删除'</span>, {
    <span class="hljs-attr">confirmButtonText</span>: <span class="hljs-string">'确定'</span>,
    <span class="hljs-attr">cancelButtonText</span>: <span class="hljs-string">'取消'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'warning'</span>,
  }).<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> err)

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(isdel)

  <span class="hljs-keyword">if</span> (isdel !== <span class="hljs-string">'confirm'</span>) {
    <span class="hljs-keyword">return</span>
  }

  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">delPicFn</span>([id])
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)
  <span class="hljs-title function_">getPicList</span>()
}

<span class="hljs-keyword">const</span> dialogVisible = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)
<span class="hljs-comment">//打开对话框</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">openDialog</span> = (<span class="hljs-params">item</span>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(item)
  formDate.<span class="hljs-property">id</span> = item.<span class="hljs-property">id</span>
  formDate.<span class="hljs-property">name</span> = item.<span class="hljs-property">name</span>
  dialogVisible.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
}

<span class="hljs-keyword">const</span> formDate = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">''</span>,
})

<span class="hljs-comment">//确定修改图片名称</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">submitOk</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">editPicNameFn</span>(formDate.<span class="hljs-property">id</span>, formDate.<span class="hljs-property">name</span>)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)
  <span class="hljs-keyword">if</span> (res.<span class="hljs-property">msg</span> &amp;&amp; res.<span class="hljs-property">msg</span> !== <span class="hljs-string">'ok'</span>) {
    <span class="hljs-keyword">return</span>
  }
  dialogVisible.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
  <span class="hljs-title function_">getPicList</span>()
}

<span class="hljs-keyword">const</span> querData = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-comment">//图库分类ID</span>
  <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">page</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">limit</span>: <span class="hljs-number">8</span>,
})

<span class="hljs-comment">//分页</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSizeChange</span> = (<span class="hljs-params">val</span>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(val)
  querData.<span class="hljs-property">limit</span> = val
  <span class="hljs-title function_">getPicList</span>()
}
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleCurrentChange</span> = (<span class="hljs-params">val</span>) =&gt; {
  querData.<span class="hljs-property">page</span> = val
  <span class="hljs-title function_">getPicList</span>()
}

<span class="hljs-keyword">const</span> dataList = <span class="hljs-title function_">ref</span>([])
<span class="hljs-keyword">const</span> total = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)

<span class="hljs-keyword">const</span> <span class="hljs-title function_">getPicList</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getPicListByIdFn</span>(querData.<span class="hljs-property">id</span>, querData.<span class="hljs-property">page</span>, querData.<span class="hljs-property">limit</span>)

  <span class="hljs-keyword">if</span> (res.<span class="hljs-property">msg</span> &amp;&amp; res.<span class="hljs-property">msg</span> !== <span class="hljs-string">'ok'</span>) {
    <span class="hljs-keyword">return</span>
  }
  dataList.<span class="hljs-property">value</span> = res.<span class="hljs-property">data</span>.<span class="hljs-property">list</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {
    item.<span class="hljs-property">checked</span> = <span class="hljs-literal">false</span>
    <span class="hljs-keyword">return</span> item
  })
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dataList.<span class="hljs-property">value</span>)
  total.<span class="hljs-property">value</span> = res.<span class="hljs-property">data</span>.<span class="hljs-property">totalCount</span>
}
<span class="hljs-comment">//getPicList()</span>

<span class="hljs-comment">//获取父组件分类id</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getDataById</span> = (<span class="hljs-params">id</span>) =&gt; {
  <span class="hljs-comment">//id 分类id</span>
  querData.<span class="hljs-property">id</span> = id
  <span class="hljs-title function_">getPicList</span>()
}
<span class="hljs-comment">// 还需要通过defineExpose暴露据和方法让子组件许可和确认,接下来在父组件中就可以查看子组件中暴露的数据与方法</span>
<span class="hljs-title function_">defineExpose</span>({
  getDataById,
  openDialogUpload,
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"less"</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
:<span class="hljs-built_in">deep</span>(.el-card__body) {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0px</span> <span class="hljs-meta">!important</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>

</code></pre>
<h3 data-id="heading-1">api.js</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> request <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/request.js'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getPicCateFn</span>=(<span class="hljs-params">page,limit=<span class="hljs-number">10</span></span>)=&gt;{
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>({
        <span class="hljs-attr">url</span>:<span class="hljs-string">`admin/getPicsCateList/<span class="hljs-subst">${page}</span>`</span>,
        <span class="hljs-attr">method</span>:<span class="hljs-string">'GET'</span>,
        <span class="hljs-attr">params</span>:{
            limit
        }
    })
}

<span class="hljs-comment">//修改图库分类</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">editPicCateFn</span>=(<span class="hljs-params">id,data</span>)=&gt;{
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>({
        <span class="hljs-attr">url</span>:<span class="hljs-string">`admin/editPicsList/<span class="hljs-subst">${id}</span>`</span>,
        <span class="hljs-attr">method</span>:<span class="hljs-string">'POST'</span>,
        data
    })
}

<span class="hljs-comment">//删除图库分类</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">delCateFn</span>=(<span class="hljs-params">id</span>)=&gt;{
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>({
        <span class="hljs-attr">url</span>:<span class="hljs-string">`admin/delPicsCateList/<span class="hljs-subst">${id}</span>/delete`</span>,
        <span class="hljs-attr">method</span>:<span class="hljs-string">'POST'</span>
    })
}

<span class="hljs-comment">//获取图库分类</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getPicListByIdFn</span>=(<span class="hljs-params">id,page,limit</span>)=&gt;{
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>({
        <span class="hljs-attr">url</span>:<span class="hljs-string">`admin/getPicList/<span class="hljs-subst">${id}</span>/image/<span class="hljs-subst">${page}</span>`</span>,
        <span class="hljs-attr">method</span>:<span class="hljs-string">'GET'</span>,
        <span class="hljs-attr">params</span>:{
            limit
        }
    })
}

<span class="hljs-comment">//删除图片</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">delPicFn</span>=(<span class="hljs-params">ids</span>)=&gt;{
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>({
        <span class="hljs-attr">url</span>:<span class="hljs-string">"admin/delPic/delete_all"</span>,
        <span class="hljs-attr">method</span>:<span class="hljs-string">'POST'</span>,
        <span class="hljs-attr">data</span>:{
            ids
        }
    })
}
</code></pre>
<h3 data-id="heading-2">until/js</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 修改密码</span>
<span class="hljs-keyword">import</span> { editPasswordFn } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/api/login.js'</span>
<span class="hljs-keyword">import</span> { ref, reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ElMessage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'element-plus'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useEditPassword</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">//修改对话是否显示</span>
    <span class="hljs-keyword">const</span> dialogVisible = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)
    <span class="hljs-comment">//form表单dom元素</span>
    <span class="hljs-keyword">const</span> ruleFormRef = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)
    <span class="hljs-comment">//修改数据源</span>
    <span class="hljs-keyword">const</span> ruleForm = <span class="hljs-title function_">reactive</span>({
        <span class="hljs-attr">oldpassword</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">password</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">repassword</span>: <span class="hljs-string">''</span>
    })
    <span class="hljs-comment">//验证规则</span>
    <span class="hljs-keyword">const</span> rules = <span class="hljs-title function_">reactive</span>({
        <span class="hljs-attr">oldpassword</span>: [
            { <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'请输入旧密码'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span> },
            { <span class="hljs-attr">min</span>: <span class="hljs-number">5</span>, <span class="hljs-attr">max</span>: <span class="hljs-number">15</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'请输入5到15个字符'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span> },
        ],
        <span class="hljs-attr">password</span>: [
            { <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'请输入新密码'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span> },
            { <span class="hljs-attr">min</span>: <span class="hljs-number">5</span>, <span class="hljs-attr">max</span>: <span class="hljs-number">15</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'请输入5到15个字符'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span> },
        ],
    })
    <span class="hljs-comment">//关闭对话框的回调</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">closeHandle</span> = (<span class="hljs-params"/>) =&gt; {
        ruleFormRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">resetFields</span>()
    }

    <span class="hljs-comment">//确定修改密码</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">submitOk</span> = (<span class="hljs-params"/>) =&gt; {
        ruleFormRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">validate</span>(<span class="hljs-keyword">async</span> isValid =&gt; {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(isValid)
            <span class="hljs-keyword">if</span> (!isValid) {
                <span class="hljs-keyword">return</span>
            }
            <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">editPasswordFn</span>(ruleForm)
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)
            <span class="hljs-keyword">if</span> (res.<span class="hljs-property">msg</span> &amp;&amp; res.<span class="hljs-property">msg</span> !== <span class="hljs-string">'ok'</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(res.<span class="hljs-property">msg</span>)
            }
            <span class="hljs-title class_">ElMessage</span>({
                <span class="hljs-attr">message</span>: <span class="hljs-string">'密码修改成功'</span>,
                <span class="hljs-attr">type</span>: <span class="hljs-string">'success'</span>,
            })

            dialogVisible.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>

        })
    }

    <span class="hljs-keyword">return</span> {
        dialogVisible,
        ruleFormRef,
        ruleForm,
        rules,
        closeHandle,
        submitOk
    }
}
</code></pre>
<h3 data-id="heading-3">router.js</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> {createRouter,createWebHashHistory} <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>
<span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">'@/store/index.js'</span>
<span class="hljs-keyword">import</span> np <span class="hljs-keyword">from</span> <span class="hljs-string">'nprogress'</span>

<span class="hljs-comment">//路由匹配规则</span>
<span class="hljs-keyword">const</span> routes=[
    {
        <span class="hljs-attr">path</span>:<span class="hljs-string">'/'</span>,
        <span class="hljs-attr">redirect</span>: <span class="hljs-string">'/home'</span>
    },
    {
        <span class="hljs-attr">path</span>:<span class="hljs-string">'/home'</span>,
        <span class="hljs-attr">component</span>:<span class="hljs-function">()=&gt;</span><span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/Home.vue'</span>),
        <span class="hljs-attr">children</span>:[
            {
                <span class="hljs-attr">path</span>:<span class="hljs-string">'/home'</span>,
                <span class="hljs-attr">name</span>:<span class="hljs-string">'/home'</span>,
                <span class="hljs-attr">component</span>:<span class="hljs-function">()=&gt;</span><span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/HomeIndex.vue'</span>),
                <span class="hljs-attr">meta</span>:{
                    <span class="hljs-attr">title</span>:<span class="hljs-string">'后台首页'</span>
                }
            },
            {
                <span class="hljs-attr">path</span>:<span class="hljs-string">'/notice/list'</span>,
                <span class="hljs-attr">name</span>:<span class="hljs-string">'/notice/list'</span>,
                <span class="hljs-attr">component</span>:<span class="hljs-function">()=&gt;</span><span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/test.vue'</span>),
                <span class="hljs-attr">meta</span>:{
                    <span class="hljs-attr">title</span>:<span class="hljs-string">'公告管理'</span>
                }
            }
        ]
    },
    {
        <span class="hljs-attr">path</span>:<span class="hljs-string">'/login'</span>,
        <span class="hljs-attr">component</span>:<span class="hljs-function">()=&gt;</span><span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/Login.vue'</span>)

    },
    <span class="hljs-comment">//捕获404</span>
    {
        <span class="hljs-attr">path</span>:<span class="hljs-string">'/:pathMatch(.*)*'</span>,
        <span class="hljs-attr">name</span>:<span class="hljs-string">'NotFound'</span>,
        <span class="hljs-attr">component</span>:<span class="hljs-function">()=&gt;</span><span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/404.vue'</span>)

    }
]

<span class="hljs-keyword">const</span> router=<span class="hljs-title function_">createRouter</span>({
    <span class="hljs-attr">history</span>:<span class="hljs-title function_">createWebHashHistory</span>(),
    routes
})

<span class="hljs-comment">//全局路由守卫</span>
router.<span class="hljs-title function_">beforeEach</span>(<span class="hljs-keyword">async</span> (to,<span class="hljs-keyword">from</span>,next)=&gt;{
    np.<span class="hljs-title function_">start</span>()
    <span class="hljs-comment">//获取token</span>
    <span class="hljs-keyword">const</span> tokenStr=<span class="hljs-variable language_">window</span>.<span class="hljs-property">sessionStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'token'</span>)
    <span class="hljs-keyword">if</span>(tokenStr){
        <span class="hljs-keyword">await</span> store.<span class="hljs-title function_">dispatch</span>(<span class="hljs-string">'getUserInfo'</span>)
    }
    <span class="hljs-comment">//如果没有登录</span>
    <span class="hljs-keyword">if</span>(!tokenStr&amp;&amp;to.<span class="hljs-property">path</span>!==<span class="hljs-string">'/login'</span>) <span class="hljs-keyword">return</span> <span class="hljs-title function_">next</span>(<span class="hljs-string">'/login'</span>)
    <span class="hljs-comment">//如果已经登录路</span>
    <span class="hljs-keyword">if</span>(tokenStr&amp;&amp;to.<span class="hljs-property">path</span>==<span class="hljs-string">'/login'</span>){
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">next</span>({<span class="hljs-attr">path</span>:<span class="hljs-keyword">from</span>.<span class="hljs-property">path</span>?<span class="hljs-keyword">from</span>.<span class="hljs-property">path</span>:<span class="hljs-string">'/'</span>})
    }   
    <span class="hljs-title function_">next</span>()
})

<span class="hljs-comment">//后置全局路由守卫</span>
router.<span class="hljs-title function_">afterEach</span>(<span class="hljs-function">(<span class="hljs-params">to,<span class="hljs-keyword">from</span>,next</span>)=&gt;</span>{
    np.<span class="hljs-title function_">done</span>()

})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router

</code></pre>
<h3 data-id="heading-4">store.js</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { createStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'vuex'</span>
<span class="hljs-keyword">import</span> { getUserInfoFn } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/api/login'</span>

<span class="hljs-keyword">const</span> store = <span class="hljs-title function_">createStore</span>({
    <span class="hljs-title function_">state</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> {
            <span class="hljs-comment">//管理员信息</span>
            <span class="hljs-attr">userInfo</span>: {
            },
            <span class="hljs-comment">//导航菜单</span>
            <span class="hljs-attr">menu</span>:[],
            <span class="hljs-comment">//控制导航是否隐藏</span>
            <span class="hljs-attr">isShow</span>:<span class="hljs-literal">false</span>
        }
    },
    <span class="hljs-attr">mutations</span>: {
        <span class="hljs-title function_">setUserInfo</span>(<span class="hljs-params">state, userInfo</span>) {
            state.<span class="hljs-property">userInfo</span> = userInfo
            state.<span class="hljs-property">menu</span>=userInfo.<span class="hljs-property">menus</span>
        },
        <span class="hljs-comment">//修改isShow</span>
        <span class="hljs-title function_">setShow</span>(<span class="hljs-params">state</span>){
            state.<span class="hljs-property">isShow</span>=!state.<span class="hljs-property">isShow</span>
        }
    },
    <span class="hljs-attr">actions</span>: {
        <span class="hljs-title function_">getUserInfo</span>(<span class="hljs-params">context</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
                <span class="hljs-title function_">getUserInfoFn</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {  
                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)                  
                    context.<span class="hljs-title function_">commit</span>(<span class="hljs-string">'setUserInfo'</span>, res.<span class="hljs-property">data</span>)
                    <span class="hljs-title function_">resolve</span>(res)
                }).<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-title function_">reject</span>(err))
            })
        }
    }
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> store

</code></pre>
<h3 data-id="heading-5">App.vue</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'./router/index.js'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'./style.css'</span>
<span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">'@/store/index.js'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'nprogress/nprogress.css'</span>

<span class="hljs-keyword">import</span> <span class="hljs-title class_">ElementPlus</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'element-plus'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'element-plus/dist/index.css'</span>

<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">ElementPlusIconsVue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@element-plus/icons-vue'</span>

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [key, component] <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(<span class="hljs-title class_">ElementPlusIconsVue</span>)) {
    app.<span class="hljs-title function_">component</span>(key, component)
}

app.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">ElementPlus</span>)

app.<span class="hljs-title function_">use</span>(router)

app.<span class="hljs-title function_">use</span>(store)

app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)
</code></pre>
<h3 data-id="heading-6">Header.vue</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"header"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 左列 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"logo"</span>&gt;</span> 商城后台管理系统 <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">el-icon</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"icon"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"setIsShow"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Fold</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">el-icon</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 右列 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"f_right"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-tooltip</span>
        <span class="hljs-attr">effect</span>=<span class="hljs-string">"dark"</span>
        <span class="hljs-attr">content</span>=<span class="hljs-string">"刷新"</span>
        <span class="hljs-attr">:enterable</span>=<span class="hljs-string">"false"</span>
        <span class="hljs-attr">placement</span>=<span class="hljs-string">"bottom"</span>
      &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-icon</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"icon"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"refHandle"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Refresh</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">el-icon</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-tooltip</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">el-tooltip</span>
        <span class="hljs-attr">v-if</span>=<span class="hljs-string">"!isFullscreen"</span>
        <span class="hljs-attr">effect</span>=<span class="hljs-string">"dark"</span>
        <span class="hljs-attr">content</span>=<span class="hljs-string">"全屏"</span>
        <span class="hljs-attr">:enterable</span>=<span class="hljs-string">"false"</span>
        <span class="hljs-attr">placement</span>=<span class="hljs-string">"bottom"</span>
      &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-icon</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"icon"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"toggle"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">FullScreen</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">el-icon</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-tooltip</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">el-tooltip</span>
        <span class="hljs-attr">v-else</span>
        <span class="hljs-attr">effect</span>=<span class="hljs-string">"dark"</span>
        <span class="hljs-attr">content</span>=<span class="hljs-string">"退出全屏"</span>
        <span class="hljs-attr">:enterable</span>=<span class="hljs-string">"false"</span>
        <span class="hljs-attr">placement</span>=<span class="hljs-string">"bottom"</span>
      &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-icon</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"icon"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"toggle"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">FullScreen</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">el-icon</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-tooltip</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">el-dropdown</span> @<span class="hljs-attr">command</span>=<span class="hljs-string">"commandHandle"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-avatar</span> <span class="hljs-attr">:size</span>=<span class="hljs-string">"30"</span> <span class="hljs-attr">:src</span>=<span class="hljs-string">"$store.state.userInfo.avatar"</span> /&gt;</span>
          {{ $store.state.userInfo.username }}
          <span class="hljs-tag">&lt;<span class="hljs-name">el-icon</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"el-icon--right"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"margin-left: 10px"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">arrow-down</span> /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">el-icon</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">dropdown</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-dropdown-menu</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">el-dropdown-item</span> <span class="hljs-attr">command</span>=<span class="hljs-string">"editPassword"</span>&gt;</span>修改密码<span class="hljs-tag">&lt;/<span class="hljs-name">el-dropdown-item</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">el-dropdown-item</span> <span class="hljs-attr">command</span>=<span class="hljs-string">"logout"</span>&gt;</span>退出登录<span class="hljs-tag">&lt;/<span class="hljs-name">el-dropdown-item</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">el-dropdown-menu</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-dropdown</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 修改密码对话框 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">el-dialog</span>
      <span class="hljs-attr">v-model</span>=<span class="hljs-string">"dialogVisible"</span>
      <span class="hljs-attr">title</span>=<span class="hljs-string">"修改密码"</span>
      <span class="hljs-attr">width</span>=<span class="hljs-string">"40%"</span>
      @<span class="hljs-attr">close</span>=<span class="hljs-string">"closeHandle"</span>
    &gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-form</span>
        <span class="hljs-attr">ref</span>=<span class="hljs-string">"ruleFormRef"</span>
        <span class="hljs-attr">:model</span>=<span class="hljs-string">"ruleForm"</span>
        <span class="hljs-attr">:rules</span>=<span class="hljs-string">"rules"</span>
        <span class="hljs-attr">label-width</span>=<span class="hljs-string">"100px"</span>
      &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"原密码"</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"oldpassword"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"ruleForm.oldpassword"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"新密码"</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"password"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"ruleForm.password"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"确认密码"</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"repassword"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"ruleForm.repassword"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-form</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">footer</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dialog-footer"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"dialogVisible = false"</span>&gt;</span>取消<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"submitOk"</span>&gt;</span> 确定 <span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">el-dialog</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { useEditPassword } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/useEditPWP.js'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Fold</span>, <span class="hljs-title class_">Refresh</span>, <span class="hljs-title class_">FullScreen</span>, <span class="hljs-title class_">ArrowDown</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@element-plus/icons-vue'</span>
<span class="hljs-keyword">import</span> { useFullscreen } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vueuse/core'</span>

<span class="hljs-keyword">import</span> { useStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'vuex'</span>
<span class="hljs-keyword">import</span> { useRouter } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ElMessageBox</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'element-plus'</span>

<span class="hljs-keyword">const</span> store = <span class="hljs-title function_">useStore</span>()
<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>()

<span class="hljs-keyword">const</span> { toggle, isFullscreen } = <span class="hljs-title function_">useFullscreen</span>()
<span class="hljs-keyword">const</span> { dialogVisible, ruleFormRef, ruleForm, rules, closeHandle, submitOk } =
  <span class="hljs-title function_">useEditPassword</span>()

<span class="hljs-comment">//刷新</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">refHandle</span> = (<span class="hljs-params"/>) =&gt; {
  location.<span class="hljs-title function_">reload</span>()
}

<span class="hljs-comment">//退出</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">logout</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> isLogout = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ElMessageBox</span>.<span class="hljs-title function_">confirm</span>(<span class="hljs-string">'是否退出?'</span>, <span class="hljs-string">'提示'</span>, {
    <span class="hljs-attr">confirmButtonText</span>: <span class="hljs-string">'确定'</span>,
    <span class="hljs-attr">cancelButtonText</span>: <span class="hljs-string">'取消'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'warning'</span>,
  }).<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> err)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(isLogout)
  <span class="hljs-keyword">if</span> (isLogout !== <span class="hljs-string">'confirm'</span>) {
    <span class="hljs-keyword">return</span>
  }
  <span class="hljs-comment">//清空本地存储</span>
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">sessionStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">'token'</span>)
  <span class="hljs-comment">//清空vuex数据</span>
  store.<span class="hljs-title function_">commit</span>(<span class="hljs-string">'setUserInfo'</span>, {})
  router.<span class="hljs-title function_">push</span>({ <span class="hljs-attr">path</span>: <span class="hljs-string">'/login'</span> })
}

<span class="hljs-comment">//监听下拉菜单事件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">commandHandle</span> = (<span class="hljs-params">res</span>) =&gt; {
  <span class="hljs-keyword">if</span> (res == <span class="hljs-string">'editPassword'</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'修改密码'</span>)
    dialogVisible.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (res == <span class="hljs-string">'logout'</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'退出'</span>)
    <span class="hljs-title function_">logout</span>()
  }
}

<span class="hljs-comment">//控制导航菜单的显示和隐藏</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">setIsShow</span> = (<span class="hljs-params"/>) =&gt; {
  store.<span class="hljs-title function_">commit</span>(<span class="hljs-string">'setShow'</span>)
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-7">echarts.vue</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-card</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"e_title"</span>&gt;</span>
                订单统计
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">el-check-tag</span> @<span class="hljs-attr">change</span>=<span class="hljs-string">"selectOp(item.value)"</span> <span class="hljs-attr">:checked</span>=<span class="hljs-string">"ops == item.value"</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(item, i) in option"</span>
                        <span class="hljs-attr">:key</span>=<span class="hljs-string">"i"</span>&gt;</span>
                        {{ item.text }}
                    <span class="hljs-tag">&lt;/<span class="hljs-name">el-check-tag</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"e_main"</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">el-card</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> echarts <span class="hljs-keyword">from</span> <span class="hljs-string">'echarts'</span>;
<span class="hljs-keyword">import</span> { getEchartsFn } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/api/home.js'</span>
<span class="hljs-keyword">import</span> { ref, onMounted,onBeforeUnmount } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>


<span class="hljs-keyword">var</span> myChart
<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">var</span> chartDom = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'e_main'</span>);
    myChart = echarts.<span class="hljs-title function_">init</span>(chartDom);
    <span class="hljs-title function_">getEchartsData</span>()    
})

<span class="hljs-keyword">const</span> <span class="hljs-title function_">getEchartsData</span>=<span class="hljs-keyword">async</span> (<span class="hljs-params"/>)=&gt;{

    <span class="hljs-keyword">var</span> option;
    option = {
        <span class="hljs-attr">xAxis</span>: {
            <span class="hljs-attr">type</span>: <span class="hljs-string">'category'</span>,
            <span class="hljs-attr">data</span>: []
        },
        <span class="hljs-attr">yAxis</span>: {
            <span class="hljs-attr">type</span>: <span class="hljs-string">'value'</span>
        },
        <span class="hljs-attr">series</span>: [
            {
                <span class="hljs-attr">data</span>: [],
                <span class="hljs-attr">type</span>: <span class="hljs-string">'bar'</span>,
                <span class="hljs-attr">showBackground</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">backgroundStyle</span>: {
                    <span class="hljs-attr">color</span>: <span class="hljs-string">'rgba(180, 180, 180, 0.2)'</span>
                }
            }
        ]
    };
    
    myChart.<span class="hljs-title function_">showLoading</span>()
    <span class="hljs-keyword">const</span> res=<span class="hljs-keyword">await</span> <span class="hljs-title function_">getEchartsFn</span>(ops.<span class="hljs-property">value</span>)
    myChart.<span class="hljs-title function_">hideLoading</span>()
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)
    <span class="hljs-keyword">if</span>(res.<span class="hljs-property">msg</span>&amp;&amp;res.<span class="hljs-property">msg</span>!==<span class="hljs-string">'ok'</span>){
        <span class="hljs-keyword">return</span>
    }
    option.<span class="hljs-property">xAxis</span>.<span class="hljs-property">data</span>=res.<span class="hljs-property">data</span>.<span class="hljs-property">x</span>
    option.<span class="hljs-property">series</span>[<span class="hljs-number">0</span>].<span class="hljs-property">data</span>=res.<span class="hljs-property">data</span>.<span class="hljs-property">y</span>

    option &amp;&amp; myChart.<span class="hljs-title function_">setOption</span>(option);

}

<span class="hljs-keyword">const</span> ops = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'week'</span>)
<span class="hljs-keyword">const</span> option = [
    {
        <span class="hljs-attr">text</span>: <span class="hljs-string">'月'</span>,
        <span class="hljs-attr">value</span>: <span class="hljs-string">'month'</span>
    },
    {
        <span class="hljs-attr">text</span>: <span class="hljs-string">'周'</span>,
        <span class="hljs-attr">value</span>: <span class="hljs-string">'week'</span>
    },
    {
        <span class="hljs-attr">text</span>: <span class="hljs-string">'天'</span>,
        <span class="hljs-attr">value</span>: <span class="hljs-string">'hour'</span>
    }
]

<span class="hljs-comment">//选择时间事件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">selectOp</span> = (<span class="hljs-params">op</span>) =&gt; {
    ops.<span class="hljs-property">value</span> = op
    <span class="hljs-title function_">getEchartsData</span>()
}

<span class="hljs-comment">//销毁期间生命周期</span>
<span class="hljs-title function_">onBeforeUnmount</span>(<span class="hljs-function">()=&gt;</span>{
    <span class="hljs-keyword">if</span>(myChart){
        echarts.<span class="hljs-title function_">dispose</span>(myChart)
    }
})

<span class="hljs-keyword">const</span> props=<span class="hljs-title function_">defineProps</span>({
    <span class="hljs-attr">value</span>:{
        <span class="hljs-attr">type</span>:<span class="hljs-title class_">Number</span>,
        <span class="hljs-attr">default</span>:<span class="hljs-number">0</span>
    }
})
<span class="hljs-keyword">const</span> data=<span class="hljs-title function_">reactive</span>({
    <span class="hljs-attr">num</span>:<span class="hljs-number">0</span>
})

<span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params"/>){
    gsap.<span class="hljs-title function_">to</span>(data,{
        <span class="hljs-comment">//0.5毫秒之后 将初始数据 动画替换成父组件传递过来的数据</span>
        <span class="hljs-attr">duration</span>:<span class="hljs-number">0.5</span>,
        <span class="hljs-attr">num</span>:props.<span class="hljs-property">value</span>
    })
}

<span class="hljs-title function_">fn</span>()

<span class="hljs-title function_">watch</span>(<span class="hljs-function">()=&gt;</span>props.<span class="hljs-property">value</span>,<span class="hljs-function">()=&gt;</span><span class="hljs-title function_">fn</span>())

&lt;el-form-item label=<span class="hljs-string">"菜单图标"</span> v-<span class="hljs-keyword">if</span>=<span class="hljs-string">"formData.menu == 1"</span>&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">IconSelect</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"formData.icon"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">IconSelect</span>&gt;</span></span>
&lt;/el-form-item&gt;

<span class="hljs-comment">//接收v-model的值</span>
<span class="hljs-title function_">defineProps</span>({
    <span class="hljs-attr">modelValue</span>: <span class="hljs-title class_">String</span>
})

<span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'update:modelValue'</span>])

<span class="hljs-comment">//选择图标事件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">changeHandle</span> = (<span class="hljs-params">e</span>) =&gt; {

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e)
    <span class="hljs-title function_">emit</span>(<span class="hljs-string">"update:modelValue"</span>, e)
}

<span class="hljs-keyword">const</span> dialogVisible = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)
<span class="hljs-keyword">const</span> titleVal = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'新增'</span>)
<span class="hljs-keyword">const</span> skusId = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)
<span class="hljs-comment">//新增参数</span>
<span class="hljs-keyword">const</span> formData = <span class="hljs-title function_">reactive</span>({
    <span class="hljs-attr">name</span>: <span class="hljs-string">''</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-string">''</span>,
    <span class="hljs-attr">order</span>: <span class="hljs-number">50</span>,
    <span class="hljs-attr">status</span>: <span class="hljs-number">1</span>

})

<span class="hljs-keyword">const</span> <span class="hljs-title function_">openDialog</span> = (<span class="hljs-params"/>) =&gt; {
    titleVal.<span class="hljs-property">value</span> = <span class="hljs-string">'新增'</span>
    formData.<span class="hljs-property">name</span> = <span class="hljs-string">''</span>
    formData.<span class="hljs-property">default</span> = <span class="hljs-string">''</span>
    formData.<span class="hljs-property">order</span> = <span class="hljs-number">50</span>
    formData.<span class="hljs-property">status</span> = <span class="hljs-number">1</span>
    dialogVisibl
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>


</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[# 🌟 JavaScript 字符串反转全攻略｜7 种方法手把手教学（小白也能懂！）]]></title>    <link>https://juejin.cn/post/7600764857768853554</link>    <guid>https://juejin.cn/post/7600764857768853554</guid>    <pubDate>2026-01-30T03:27:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600764857768853554" data-draft-id="7600990891205427227" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="# 🌟 JavaScript 字符串反转全攻略｜7 种方法手把手教学（小白也能懂！）"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2026-01-30T03:27:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="不会敲代码1"/> <meta itemprop="url" content="https://juejin.cn/user/1927884034804425"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            # 🌟 JavaScript 字符串反转全攻略｜7 种方法手把手教学（小白也能懂！）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1927884034804425/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    不会敲代码1
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T03:27:53.000Z" title="Fri Jan 30 2026 03:27:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🌟 JavaScript 字符串反转全攻略｜7 种方法手把手教学（小白也能懂！）</h2>
<blockquote>
<p>适合刚学 JS 的你｜代码逐行注释｜原理图解｜避坑指南｜掘金首发</p>
</blockquote>
<p>大家好，我是正在努力学前端的「小码农」。最近在练习字符串操作时，被一道看似简单的题卡住了： <strong>“怎么把 'hello' 变成 'olleh'？”</strong><br/>
网上一搜，发现居然有 <strong>7 种写法</strong>！有的短短一行，有的要写十几行；有的快如闪电，有的可能让浏览器卡住…<br/>
别慌！今天我就用 <strong>最直白的大白话 + 最详细的注释 + 最真实的踩坑记录</strong>，带你从零搞懂所有方法——<strong>不讲概念，只讲人话；不堆代码，只讲为什么。</strong><br/>
（文末附可直接复制粘贴的完整代码 ✅）</p>
<hr/>
<h3 data-id="heading-1">🔍 一、先搞明白：什么是“反转字符串”？</h3>
<p>✅ 简单说：就是把字符串里的字符顺序<strong>完全倒过来</strong>。<br/>
比如：</p>
<ul>
<li><code>'abc'</code> → <code>'cba'</code></li>
<li><code>'JavaScript'</code> → <code>'tpircSavaJ'</code></li>
<li><code>'12345'</code> → <code>'54321'</code></li>
</ul>
<p>⚠️ 注意：字符串在 JS 中是<strong>不可变的</strong>（不能直接改），所以每次反转都必须<strong>创建一个新字符串</strong>。</p>
<hr/>
<h3 data-id="heading-2">🧩 二、7 种方法详解（附完整可运行代码）</h3>
<blockquote>
<p>💡 每种方法都包含：<br/>
✅ <strong>一句话原理</strong>｜✅ <strong>带中文注释的代码</strong>｜✅ <strong>小白友好图解</strong>｜✅ <strong>什么时候用 / 什么时候避开</strong></p>
</blockquote>
<hr/>
<h4 data-id="heading-3">方法 1️⃣：三步走大法（最常用！推荐新手首选）</h4>
<p><code>split()</code> → <code>reverse()</code> → <code>join()</code></p>
<pre><code class="hljs language-perl" lang="perl">function reverseStr(str) {
  <span class="hljs-regexp">//</span> 第一步：把字符串 <span class="hljs-string">'abc'</span> 拆成数组 [<span class="hljs-string">'a'</span>,<span class="hljs-string">'b'</span>,<span class="hljs-string">'c'</span>]
  // <span class="hljs-keyword">split</span>(<span class="hljs-string">''</span>) 中的 <span class="hljs-string">''</span> 表示“按每个字符拆开”
  const arr = str.<span class="hljs-keyword">split</span>(<span class="hljs-string">''</span>);

  <span class="hljs-regexp">//</span> 第二步：把数组 [<span class="hljs-string">'a'</span>,<span class="hljs-string">'b'</span>,<span class="hljs-string">'c'</span>] 反转成 [<span class="hljs-string">'c'</span>,<span class="hljs-string">'b'</span>,<span class="hljs-string">'a'</span>]
  // <span class="hljs-keyword">reverse</span>() 是数组的内置方法，会直接修改原数组！
  const reversedArr = arr.<span class="hljs-keyword">reverse</span>();

  <span class="hljs-regexp">//</span> 第三步：把数组 [<span class="hljs-string">'c'</span>,<span class="hljs-string">'b'</span>,<span class="hljs-string">'a'</span>] 合并成字符串 <span class="hljs-string">'cba'</span>
  // <span class="hljs-keyword">join</span>(<span class="hljs-string">''</span>) 中的 <span class="hljs-string">''</span> 表示“中间不加任何符号”
  const result = reversedArr.join(<span class="hljs-string">''</span>);

  <span class="hljs-keyword">return</span> result;
}

console.log(reverseStr(<span class="hljs-string">'abc'</span>)); <span class="hljs-regexp">//</span> 输出：<span class="hljs-string">'cba'</span>
</code></pre>
<p>🧠 <strong>小白理解图</strong>：<br/>
<code>'abc'</code><br/>
→ 拆开：<code>['a', 'b', 'c']</code><br/>
→ 翻个身：<code>['c', 'b', 'a']</code><br/>
→ 粘起来：<code>'cba'</code></p>
<p>✅ <strong>优点</strong>：代码短、好记、适合绝大多数场景<br/>
⚠️ <strong>注意</strong>：对 emoji（如 <code>'👨‍💻'</code>）或带音标的字（如 <code>'café'</code>）在老版本浏览器中可能出错（后面会教怎么安全处理）</p>
<hr/>
<h4 data-id="heading-4">方法 2️⃣：传统 for 循环（最稳！兼容性无敌）</h4>
<pre><code class="hljs language-ini" lang="ini">function reverseStr(str) {
  let <span class="hljs-attr">result</span> = <span class="hljs-string">''</span><span class="hljs-comment">; // 准备一个空盒子，用来装反转后的字符</span>

  // 从最后一个字符开始，往前数：<span class="hljs-attr">i</span> = <span class="hljs-number">2</span> → <span class="hljs-number">1</span> → <span class="hljs-number">0</span>（因为 <span class="hljs-string">'abc'</span> 长度是<span class="hljs-number">3</span>，索引是<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>）
  for (let <span class="hljs-attr">i</span> = str.length - <span class="hljs-number">1</span><span class="hljs-comment">; i &gt;= 0; i--) {</span>
    <span class="hljs-attr">result</span> = result + str[i]<span class="hljs-comment">; // 把当前字符 str[i] 加到 result 后面</span>
  }

  return result<span class="hljs-comment">;</span>
}

console.log(reverseStr('abc'))<span class="hljs-comment">; // 输出：'cba'</span>
</code></pre>
<p>🧠 <strong>小白理解图</strong>（以 <code>'abc'</code> 为例）：</p>





























<table><thead><tr><th>循环次数</th><th>i 的值</th><th>str[i]</th><th>result 变化</th></tr></thead><tbody><tr><td>第1次</td><td>2</td><td><code>'c'</code></td><td><code>'' + 'c'</code> → <code>'c'</code></td></tr><tr><td>第2次</td><td>1</td><td><code>'b'</code></td><td><code>'c' + 'b'</code> → <code>'cb'</code></td></tr><tr><td>第3次</td><td>0</td><td><code>'a'</code></td><td><code>'cb' + 'a'</code> → <code>'cba'</code></td></tr></tbody></table>
<p>✅ <strong>优点</strong>：兼容所有浏览器（IE6 都能跑！）、逻辑清晰、性能好<br/>
💡 <strong>小技巧</strong>：<code>str.length - 1</code> 是最后一个字符的下标（JS 数组/字符串下标从 0 开始）</p>
<hr/>
<h4 data-id="heading-5">方法 3️⃣：for...of 循环（更现代、更优雅）</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function">function <span class="hljs-title">reverseStr</span>(<span class="hljs-params">str</span>)</span> {
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">''</span>; <span class="hljs-comment">// 还是那个空盒子</span>

  <span class="hljs-comment">// for...of 会自动一个一个拿出字符串里的字符</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> <span class="hljs-built_in">char</span> of str) {
    result = <span class="hljs-built_in">char</span> + result; <span class="hljs-comment">// 关键！不是加在后面，而是加在前面！</span>
  }

  <span class="hljs-keyword">return</span> result;
}

console.log(reverseStr(<span class="hljs-string">'abc'</span>)); <span class="hljs-comment">// 输出：'cba'</span>
</code></pre>
<p>🧠 <strong>小白理解图</strong>（以 <code>'abc'</code> 为例）：</p>

























<table><thead><tr><th>循环次数</th><th>char</th><th>result 变化</th></tr></thead><tbody><tr><td>第1次</td><td><code>'a'</code></td><td><code>'' + 'a'</code> → <code>'a'</code></td></tr><tr><td>第2次</td><td><code>'b'</code></td><td><code>'b' + 'a'</code> → <code>'ba'</code></td></tr><tr><td>第3次</td><td><code>'c'</code></td><td><code>'c' + 'ba'</code> → <code>'cba'</code></td></tr></tbody></table>
<p>✅ <strong>优点</strong>：代码更简洁、天然支持 emoji 和中文等复杂字符（Unicode 安全）<br/>
💡 <strong>记住口诀</strong>：“for...of 遍历字符，<code>char + result</code> 就是反转”</p>
<hr/>
<h4 data-id="heading-6">方法 4️⃣：展开运算符法（ES6 新写法，强烈推荐！）</h4>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">reverseStr</span><span class="hljs-params">(str)</span></span> {
  // [...str] 就像魔法：把 <span class="hljs-string">'abc'</span> 变成 [<span class="hljs-string">'a'</span>,<span class="hljs-string">'b'</span>,<span class="hljs-string">'c'</span>]
  // 然后照旧反转 + 合并
  <span class="hljs-keyword">return</span> [...str].<span class="hljs-built_in">reverse</span>().join(<span class="hljs-string">''</span>);
}

console.<span class="hljs-built_in">log</span>(reverseStr(<span class="hljs-string">'abc'</span>)); // 输出：<span class="hljs-string">'cba'</span>
</code></pre>
<p>✅ <strong>为什么比方法1更好？</strong></p>
<ul>
<li><code>split('')</code> 在老浏览器中对 <code>'👨‍💻'</code> 可能拆成乱码；</li>
<li><code>[...str]</code> 是 ES6 标准，<strong>完美支持所有 emoji、中文、带音标文字</strong>！<br/>
✅ <strong>一句话总结</strong>：这是方法1的升级版，<strong>兼顾简洁 + 安全</strong>，现在写代码就用它！</li>
</ul>
<hr/>
<h4 data-id="heading-7">方法 5️⃣：递归法（理解“自己调自己”，锻炼思维）</h4>
<pre><code class="hljs language-python" lang="python">function reverseStr(<span class="hljs-built_in">str</span>) {
  // 🚨 退出条件（非常重要！没有它会无限循环直到崩溃）
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">str</span> === <span class="hljs-string">''</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>; // 空字符串反转还是空字符串
  }

  // 🧩 递归核心：把第一个字符放到“剩下部分的反转结果”后面
  // <span class="hljs-built_in">str</span>.substring(<span class="hljs-number">1</span>) → 去掉第一个字符（如 <span class="hljs-string">'abc'</span> → <span class="hljs-string">'bc'</span>）
  // <span class="hljs-built_in">str</span>.charAt(<span class="hljs-number">0</span>) → 拿到第一个字符（如 <span class="hljs-string">'abc'</span> → <span class="hljs-string">'a'</span>）
  <span class="hljs-keyword">return</span> reverseStr(<span class="hljs-built_in">str</span>.substring(<span class="hljs-number">1</span>)) + <span class="hljs-built_in">str</span>.charAt(<span class="hljs-number">0</span>);
}

console.log(reverseStr(<span class="hljs-string">'abc'</span>)); // 输出：<span class="hljs-string">'cba'</span>
</code></pre>
<p>🧠 <strong>小白理解图</strong>（递归调用过程）：</p>
<pre><code class="hljs language-bash" lang="bash">reverseStr(<span class="hljs-string">'abc'</span>)
├─ reverseStr(<span class="hljs-string">'bc'</span>) + <span class="hljs-string">'a'</span>
   ├─ reverseStr(<span class="hljs-string">'c'</span>) + <span class="hljs-string">'b'</span>
      └─ reverseStr(<span class="hljs-string">''</span>) + <span class="hljs-string">'c'</span> → <span class="hljs-string">''</span> + <span class="hljs-string">'c'</span> = <span class="hljs-string">'c'</span>
   → <span class="hljs-string">'c'</span> + <span class="hljs-string">'b'</span> = <span class="hljs-string">'cb'</span>
→ <span class="hljs-string">'cb'</span> + <span class="hljs-string">'a'</span> = <span class="hljs-string">'cba'</span>
</code></pre>
<p>⚠️ <strong>重要警告</strong>：</p>
<ul>
<li>✅ 适合学习算法思想、理解分治（Divide &amp; Conquer）</li>
<li>❌ <strong>不要在项目里用！</strong> 字符串太长（比如 10000 字符）会爆栈（Stack Overflow），浏览器直接卡死！<br/>
💡 <strong>类比</strong>：就像俄罗斯套娃，一层层打开，最后一层是最小的（空字符串），然后一层层合上。</li>
</ul>
<hr/>
<h4 data-id="heading-8">方法 6️⃣：reduce 法（函数式编程风，酷炫但需理解）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">reverseStr</span>(<span class="hljs-params">str</span>) {
  <span class="hljs-keyword">return</span> [...str].<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">reversed, char</span>) =&gt;</span> {
    <span class="hljs-comment">// reversed：之前累积的结果（初始为空字符串 ''）</span>
    <span class="hljs-comment">// char：当前正在处理的字符</span>
    <span class="hljs-keyword">return</span> char + reversed; <span class="hljs-comment">// 把新字符加到前面，实现反转</span>
  }, <span class="hljs-string">''</span>); <span class="hljs-comment">// '' 是初始值（reversed 的起点）</span>
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">reverseStr</span>(<span class="hljs-string">'abc'</span>)); <span class="hljs-comment">// 输出：'cba'</span>
</code></pre>
<p>🧠 <strong>小白理解图</strong>（以 <code>'abc'</code> 为例）：</p>



































<table><thead><tr><th>步骤</th><th>reversed（之前结果）</th><th>char</th><th>返回值（新 reversed）</th></tr></thead><tbody><tr><td>初始</td><td><code>''</code></td><td>—</td><td>—</td></tr><tr><td>第1次</td><td><code>''</code></td><td><code>'a'</code></td><td><code>'a' + ''</code> → <code>'a'</code></td></tr><tr><td>第2次</td><td><code>'a'</code></td><td><code>'b'</code></td><td><code>'b' + 'a'</code> → <code>'ba'</code></td></tr><tr><td>第3次</td><td><code>'ba'</code></td><td><code>'c'</code></td><td><code>'c' + 'ba'</code> → <code>'cba'</code></td></tr></tbody></table>
<p>✅ <strong>优点</strong>：代码非常“函数式”，没有变量赋值，适合喜欢数学思维的同学<br/>
⚠️ <strong>注意</strong>：<code>reduce</code> 本质也是循环，性能和 for...of 差不多，但初学者可能觉得绕。</p>
<hr/>
<h4 data-id="heading-9">方法 7️⃣：Array.from() 法（方法4的“双胞胎”，同样安全）</h4>
<pre><code class="hljs language-python" lang="python">function reverseStr(<span class="hljs-built_in">str</span>) {
  // Array.<span class="hljs-keyword">from</span>(<span class="hljs-built_in">str</span>) 和 [...<span class="hljs-built_in">str</span>] 功能完全一样，都是把字符串变成数组
  <span class="hljs-keyword">return</span> Array.<span class="hljs-keyword">from</span>(<span class="hljs-built_in">str</span>).reverse().join(<span class="hljs-string">''</span>);
}

console.log(reverseStr(<span class="hljs-string">'abc'</span>)); // 输出：<span class="hljs-string">'cba'</span>
</code></pre>
<p>✅ <strong>小知识</strong>：<code>Array.from(str)</code> 和 <code>[...str]</code> 是等价的，你可以任选其一。<br/>
📚 <strong>为什么多一种写法？</strong></p>
<ul>
<li><code>Array.from()</code> 还可以做更多事（比如转换类数组对象），是更通用的 API；</li>
<li><code>[...str]</code> 更简短，是日常开发中的“快捷写法”。</li>
</ul>
<hr/>
<h3 data-id="heading-10">🚨 三、新手必看！3 个真实踩坑记录（血泪教训）</h3>
<h4 data-id="heading-11">❌ 坑1：<code>split('')</code> 对 emoji 处理错误（老浏览器）</h4>
<pre><code class="hljs language-perl" lang="perl">// 在 Chrome <span class="hljs-number">80</span> 以下或某些手机浏览器中：
<span class="hljs-string">'👨‍💻'</span>.<span class="hljs-keyword">split</span>(<span class="hljs-string">''</span>); <span class="hljs-regexp">//</span> 可能返回 [<span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>]（乱码！）
[...<span class="hljs-string">'👨‍💻'</span>];        <span class="hljs-regexp">//</span> 正确返回 [<span class="hljs-string">'👨‍💻'</span>]（一个完整的 emoji）
</code></pre>
<p>✅ <strong>解决方案</strong>：统一用 <code>[...str]</code> 或 <code>Array.from(str)</code></p>
<h4 data-id="heading-12">❌ 坑2：递归调用忘记写“退出条件”</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 错误示范！没有 if 判断，会一直调用自己直到崩溃</span>
function <span class="hljs-built_in">badReverse</span>(str) {
  return <span class="hljs-built_in">badReverse</span>(str.substring(<span class="hljs-number">1</span>)) + str<span class="hljs-selector-class">.charAt</span>(<span class="hljs-number">0</span>);
}
<span class="hljs-built_in">badReverse</span>('abc'); <span class="hljs-comment">// ❌ 页面卡死！</span>
</code></pre>
<p>✅ <strong>解决方案</strong>：递归函数第一行必须写清楚“什么时候停止”</p>
<h4 data-id="heading-13">❌ 坑3：<code>reverse()</code> 修改了原数组（副作用！）</h4>
<pre><code class="hljs language-css" lang="css">const arr = <span class="hljs-selector-attr">[<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>]</span>;
arr<span class="hljs-selector-class">.reverse</span>(); // 直接把 arr 改成了 <span class="hljs-selector-attr">[<span class="hljs-string">'c'</span>,<span class="hljs-string">'b'</span>,<span class="hljs-string">'a'</span>]</span>！
console<span class="hljs-selector-class">.log</span>(arr); // 输出：<span class="hljs-selector-attr">[<span class="hljs-string">'c'</span>,<span class="hljs-string">'b'</span>,<span class="hljs-string">'a'</span>]</span>（原数组被改了！）
</code></pre>
<p>✅ <strong>解决方案</strong>：如果不想改原数组，先用 <code>slice()</code> 复制一份：</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">newArr</span> = arr.slice().reverse()<span class="hljs-comment">; // slice() 创建副本</span>
</code></pre>
<hr/>
<h3 data-id="heading-14">📊 四、终极对比表（选哪个？看这里！）</h3>













































































<table><thead><tr><th>方法</th><th>代码长度</th><th>学习难度</th><th>运行速度</th><th>Unicode 安全</th><th>推荐指数</th><th>适合谁</th></tr></thead><tbody><tr><td><code>split+reverse+join</code></td><td>⭐⭐⭐⭐</td><td>⭐⭐</td><td>⭐⭐⭐⭐</td><td>❌（老环境）</td><td>⭐⭐⭐</td><td>快速验证想法</td></tr><tr><td><strong>传统 for 循环</strong></td><td>⭐⭐⭐</td><td>⭐⭐</td><td>⭐⭐⭐⭐⭐</td><td>✅</td><td>⭐⭐⭐⭐⭐</td><td><strong>新手入门首选！</strong> 兼容性最强</td></tr><tr><td><strong>for...of 循环</strong></td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>✅</td><td>⭐⭐⭐⭐⭐</td><td><strong>现代项目首选！</strong> 简洁安全</td></tr><tr><td><strong>展开运算符 <code>[...str]</code></strong></td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>✅</td><td>⭐⭐⭐⭐⭐</td><td><strong>2024 年推荐写法！</strong> 简洁+安全</td></tr><tr><td>递归</td><td>⭐⭐</td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐</td><td>✅</td><td>⭐⭐</td><td>学算法/面试准备</td></tr><tr><td>reduce</td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐</td><td>✅</td><td>⭐⭐⭐</td><td>喜欢函数式编程者</td></tr><tr><td>Array.from</td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>✅</td><td>⭐⭐⭐⭐</td><td>作为 <code>[...str]</code> 的替代</td></tr></tbody></table>
<blockquote>
<p>✅ <strong>给你的明确建议</strong>：</p>
<ul>
<li><strong>刚学 JS？</strong> 从 <strong>方法2（for 循环）</strong> 开始，彻底搞懂每一步！</li>
<li><strong>想写现代代码？</strong> 主力用 <strong>方法4（展开运算符）</strong> ，又短又安全！</li>
<li><strong>面试被问“还有别的方法吗？”</strong> 把方法1、2、4、5 能说清楚就够了！</li>
</ul>
</blockquote>
<hr/>
<h3 data-id="heading-15">💡 五、课后小练习（动手才记得牢！）</h3>
<p>请尝试用 <strong>至少2种方法</strong> 实现以下功能，并在控制台验证：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 1. 反转一个句子（注意空格位置）</span>
<span class="hljs-built_in">reverseStr</span>('hello world'); <span class="hljs-comment">// 应该输出 'dlrow olleh'</span>

<span class="hljs-comment">// 2. 反转带 emoji 的字符串</span>
<span class="hljs-built_in">reverseStr</span>('I ❤️ JS 🌟'); <span class="hljs-comment">// 应该保持 ❤️ 和 🌟 完整</span>

<span class="hljs-comment">// 3. 写一个“安全版”函数：对非字符串输入也友好</span>
<span class="hljs-built_in">reverseStr</span>(null);    <span class="hljs-comment">// 应该输出 ''</span>
<span class="hljs-built_in">reverseStr</span>(<span class="hljs-number">123</span>);     <span class="hljs-comment">// 应该输出 '321'</span>
</code></pre>
<blockquote>
<p>✅ <strong>答案提示</strong>：用 <code>String(input)</code> 可以把任意值转成字符串！</p>
</blockquote>
<hr/>
<h3 data-id="heading-16">🌈 六、写在最后：编程不是背代码，而是理解“为什么”</h3>
<p>这7种方法，没有绝对的“最好”，只有“最适合当前场景”。</p>
<ul>
<li>你可能会发现：<strong>方法2（for循环）虽然代码长，但每一步都清晰可见；</strong></li>
<li><strong>方法4（展开运算符）虽然只有一行，但背后是整个 ES6 的设计哲学。</strong></li>
</ul>
<blockquote>
<p>🌟 <strong>送你一句我学到的话</strong>：<br/>
<strong>“优秀的程序员，不是知道最多方法的人，而是知道在什么情况下选择最合适方法的人。”</strong></p>
</blockquote>
<p>如果你觉得这篇笔记帮到了你，欢迎 👍 点赞、💬 评论、🔄 转发！<br/>
关注我，一起把前端学得明明白白、踏踏实实 💪<br/>
（代码已全部测试通过，复制即用！）</p>
<hr/>
<p>📌 <strong>附：7种方法完整可运行代码（一键复制）</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 方法1：split+reverse+join（基础版）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reverse1</span>(<span class="hljs-params">str</span>) { <span class="hljs-keyword">return</span> str.<span class="hljs-title function_">split</span>(<span class="hljs-string">''</span>).<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>); }

<span class="hljs-comment">// 方法2：传统for循环（最稳）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reverse2</span>(<span class="hljs-params">str</span>) { <span class="hljs-keyword">let</span> r=<span class="hljs-string">''</span>; <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i=str.<span class="hljs-property">length</span>-<span class="hljs-number">1</span>;i&gt;=<span class="hljs-number">0</span>;i--) r+=str[i]; <span class="hljs-keyword">return</span> r; }

<span class="hljs-comment">// 方法3：for...of循环（现代简洁）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reverse3</span>(<span class="hljs-params">str</span>) { <span class="hljs-keyword">let</span> r=<span class="hljs-string">''</span>; <span class="hljs-keyword">for</span>(<span class="hljs-keyword">const</span> c <span class="hljs-keyword">of</span> str) r=c+r; <span class="hljs-keyword">return</span> r; }

<span class="hljs-comment">// 方法4：展开运算符（2024推荐！）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reverse4</span>(<span class="hljs-params">str</span>) { <span class="hljs-keyword">return</span> [...str].<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>); }

<span class="hljs-comment">// 方法5：递归（理解思想）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reverse5</span>(<span class="hljs-params">str</span>) { <span class="hljs-keyword">return</span> str===<span class="hljs-string">''</span>? <span class="hljs-string">''</span>: <span class="hljs-title function_">reverse5</span>(str.<span class="hljs-title function_">substring</span>(<span class="hljs-number">1</span>)) + str.<span class="hljs-title function_">charAt</span>(<span class="hljs-number">0</span>); }

<span class="hljs-comment">// 方法6：reduce（函数式）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reverse6</span>(<span class="hljs-params">str</span>) { <span class="hljs-keyword">return</span> [...str].<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">r,c</span>)=&gt;</span>c+r, <span class="hljs-string">''</span>); }

<span class="hljs-comment">// 方法7：Array.from（方法4的兄弟）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reverse7</span>(<span class="hljs-params">str</span>) { <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(str).<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>); }

<span class="hljs-comment">// 测试</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'方法1:'</span>, <span class="hljs-title function_">reverse1</span>(<span class="hljs-string">'abc'</span>));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'方法2:'</span>, <span class="hljs-title function_">reverse2</span>(<span class="hljs-string">'abc'</span>));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'方法3:'</span>, <span class="hljs-title function_">reverse3</span>(<span class="hljs-string">'abc'</span>));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'方法4:'</span>, <span class="hljs-title function_">reverse4</span>(<span class="hljs-string">'abc'</span>));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'方法5:'</span>, <span class="hljs-title function_">reverse5</span>(<span class="hljs-string">'abc'</span>));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'方法6:'</span>, <span class="hljs-title function_">reverse6</span>(<span class="hljs-string">'abc'</span>));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'方法7:'</span>, <span class="hljs-title function_">reverse7</span>(<span class="hljs-string">'abc'</span>));
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[😭 还没爽完就欠费？我写了个自动“偷”额度的脚本，Gemini 都被我榨干了]]></title>    <link>https://juejin.cn/post/7600705962248568841</link>    <guid>https://juejin.cn/post/7600705962248568841</guid>    <pubDate>2026-01-30T04:31:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600705962248568841" data-draft-id="7600764857769099314" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="😭 还没爽完就欠费？我写了个自动“偷”额度的脚本，Gemini 都被我榨干了"/> <meta itemprop="keywords" content="Gemini,AI编程,AIGC"/> <meta itemprop="datePublished" content="2026-01-30T04:31:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="webkubor"/> <meta itemprop="url" content="https://juejin.cn/user/2119514149631870"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            😭 还没爽完就欠费？我写了个自动“偷”额度的脚本，Gemini 都被我榨干了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2119514149631870/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    webkubor
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T04:31:05.000Z" title="Fri Jan 30 2026 04:31:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    18
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"❝";top:8px;left:5px}.markdown-body blockquote:after{content:"❞";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf53175f7c9e4f408b9ca06ae89f4f95~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2Via3Vib3I=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770357140&amp;x-signature=zNAN9Rw%2BKGjvbGffSK7PWH6Qw9M%3D" alt="截屏2026-01-30 13.49.45.png" loading="lazy"/></p>
<blockquote>
<p><strong>⚠️ 警告</strong>：本文含“高危”操作，阅读前请确保你的 Gemini CLI 已经装好，并且你拥有至少两个 Google 账号（大号和小号）。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">😫 崩溃瞬间：当灵感撞上 429</h2>
<p>作为一个被 AI 惯坏的工程师，我现在写代码基本是这样的：
<strong>“Gemini，帮我重构这个函数”</strong> -&gt; <strong>“Gemini，写个单元测试”</strong> -&gt; <strong>“Gemini，这行报错是什么鬼？”</strong></p>
<p>正当我代码写得起飞，多巴胺疯狂分泌的时候，终端突然冷冰冰地甩给我一行字：</p>
<pre><code class="hljs language-bash" lang="bash">Error: 429 Quota exceeded <span class="hljs-keyword">for</span> the current user.
</code></pre>
<p>那一刻，我感觉像是刚要冲刺百米终点，裤衩突然松了。<strong>绝望，太绝望了。</strong></p>
<p>为了继续写代码，我不得不：</p>
<ol>
<li><code>gemini auth logout</code> （含泪登出）</li>
<li><code>gemini auth login</code> （打开浏览器，扫码，切小号，授权...）</li>
<li>回来重新输入刚才断掉的命令。</li>
</ol>
<p>这哪里是写代码？这简直是在做**“账号切换耐力测试”<strong>！这种</strong>“断流”**感，对于心流状态简直是毁灭性打击。</p>
<p>于是我怒了。<strong>DeepSeek 都在教我们怎么榨干算力，我居然还在手动切号？</strong> 必须搞个自动化的！</p>
<hr/>
<h2 data-id="heading-1">🧠 思路：给 CLI 装个“备胎”系统</h2>
<p>只要稍微扒一下 Gemini CLI 的底裤（<code>~/.gemini/</code> 目录），你就会发现它的鉴权机制单纯得可爱：</p>
<ul>
<li><strong>凭证文件</strong>：<code>~/.gemini/oauth_creds.json</code></li>
<li><strong>账号信息</strong>：<code>~/.gemini/google_accounts.json</code></li>
</ul>
<p>这不就简单了吗？
我只要提前把“大号”和“小号”的这两个文件<strong>偷</strong>出来存好，等到大号欠费时，用脚本<strong>毫秒级</strong>把小号的文件覆盖回去，CLI 不就以为我是尊贵的满血会员了吗？</p>
<p>说干就干。我设计了一套 <strong>“主备容灾系统 (Active-Passive Failover)”</strong>。</p>
<hr/>
<h2 data-id="heading-2">🛠️ 第一步：造一个“身份管理器”</h2>
<p>我们需要一个脚本来负责“物理换卡”。这相当于给你的 CLI 装了一个双卡双待的卡槽。</p>
<p>在 <code>~/Documents/AI_Common/docs/scripts/</code> 下创建一个 <code>gemini_manager.sh</code>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># gemini_manager.sh - 你的身份管家</span>

<span class="hljs-comment"># 你的配置文件仓库（建议放在 dotfiles 或文档里）</span>
PROFILE_STORE=<span class="hljs-string">"<span class="hljs-variable">$HOME</span>/Documents/AI_Common/docs/secrets/gemini_profiles"</span>
GEMINI_DIR=<span class="hljs-string">"<span class="hljs-variable">$HOME</span>/.gemini"</span>

<span class="hljs-built_in">mkdir</span> -p <span class="hljs-string">"<span class="hljs-variable">$PROFILE_STORE</span>"</span>

<span class="hljs-comment"># 💾 存档技能：把当前账号存起来</span>
<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">save_profile</span></span>() {
    NAME=<span class="hljs-variable">$1</span>
    TARGET=<span class="hljs-string">"<span class="hljs-variable">$PROFILE_STORE</span>/<span class="hljs-variable">$NAME</span>"</span>
    <span class="hljs-built_in">mkdir</span> -p <span class="hljs-string">"<span class="hljs-variable">$TARGET</span>"</span>
    
    <span class="hljs-comment"># 核心动作：把凭证“偷”走备份</span>
    <span class="hljs-built_in">cp</span> <span class="hljs-string">"<span class="hljs-variable">$GEMINI_DIR</span>/oauth_creds.json"</span> <span class="hljs-string">"<span class="hljs-variable">$TARGET</span>/"</span> 2&gt;/dev/null
    <span class="hljs-built_in">cp</span> <span class="hljs-string">"<span class="hljs-variable">$GEMINI_DIR</span>/google_accounts.json"</span> <span class="hljs-string">"<span class="hljs-variable">$TARGET</span>/"</span> 2&gt;/dev/null
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"✅ 账号已存档为: '<span class="hljs-variable">$NAME</span>'"</span>
}

<span class="hljs-comment"># 🔄 读档技能：切换到指定账号</span>
<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">switch_profile</span></span>() {
    NAME=<span class="hljs-variable">$1</span>
    TARGET=<span class="hljs-string">"<span class="hljs-variable">$PROFILE_STORE</span>/<span class="hljs-variable">$NAME</span>"</span>
    
    <span class="hljs-keyword">if</span> [ ! -d <span class="hljs-string">"<span class="hljs-variable">$TARGET</span>"</span> ]; <span class="hljs-keyword">then</span> 
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"❌ 找不到账号存档 '<span class="hljs-variable">$NAME</span>'，你是不是没存过？"</span>
        <span class="hljs-built_in">return</span> 1
    <span class="hljs-keyword">fi</span>
    
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"🔄 正在切换身份到: '<span class="hljs-variable">$NAME</span>'..."</span>
    <span class="hljs-comment"># 核心动作：覆盖回去</span>
    <span class="hljs-built_in">cp</span> <span class="hljs-string">"<span class="hljs-variable">$TARGET</span>/oauth_creds.json"</span> <span class="hljs-string">"<span class="hljs-variable">$GEMINI_DIR</span>/"</span> 2&gt;/dev/null
    <span class="hljs-built_in">cp</span> <span class="hljs-string">"<span class="hljs-variable">$TARGET</span>/google_accounts.json"</span> <span class="hljs-string">"<span class="hljs-variable">$GEMINI_DIR</span>/"</span> 2&gt;/dev/null
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"🎉 切换成功！现在你是 '<span class="hljs-variable">$NAME</span>' 了。"</span>
}

<span class="hljs-comment"># 🧐 鉴定技能：我现在到底是谁？</span>
<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">check_status</span></span>() {
    <span class="hljs-comment"># 通过对比文件哈希值来确认身份</span>
    CURRENT_SUM=$(shasum <span class="hljs-string">"<span class="hljs-variable">$GEMINI_DIR</span>/oauth_creds.json"</span> 2&gt;/dev/null | awk <span class="hljs-string">'{print $1}'</span>)
    FOUND=0
    <span class="hljs-keyword">for</span> profile <span class="hljs-keyword">in</span> <span class="hljs-string">"<span class="hljs-variable">$PROFILE_STORE</span>"</span>/*; <span class="hljs-keyword">do</span>
        <span class="hljs-keyword">if</span> [ -d <span class="hljs-string">"<span class="hljs-variable">$profile</span>"</span> ]; <span class="hljs-keyword">then</span>
            P_NAME=$(<span class="hljs-built_in">basename</span> <span class="hljs-string">"<span class="hljs-variable">$profile</span>"</span>)
            P_SUM=$(shasum <span class="hljs-string">"<span class="hljs-variable">$profile</span>/oauth_creds.json"</span> 2&gt;/dev/null | awk <span class="hljs-string">'{print $1}'</span>)
            <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$CURRENT_SUM</span>"</span> == <span class="hljs-string">"<span class="hljs-variable">$P_SUM</span>"</span> ]; <span class="hljs-keyword">then</span>
                <span class="hljs-built_in">echo</span> <span class="hljs-string">"✅ 当前身份: <span class="hljs-variable">$P_NAME</span>"</span>
                FOUND=1
                <span class="hljs-built_in">break</span>
            <span class="hljs-keyword">fi</span>
        <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">done</span>
    <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$FOUND</span>"</span> -eq 0 ]; <span class="hljs-keyword">then</span> <span class="hljs-built_in">echo</span> <span class="hljs-string">"⚠️  未知身份 (未存档)"</span>; <span class="hljs-keyword">fi</span>
}

<span class="hljs-comment"># 简单的路由</span>
<span class="hljs-keyword">case</span> <span class="hljs-variable">$1</span> <span class="hljs-keyword">in</span>
    save) save_profile <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> ;; 
    switch) switch_profile <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span> ;; 
    status) check_status ;; 
    *) <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage: <span class="hljs-variable">$0</span> {save|switch|status} [name]"</span> ;; 
<span class="hljs-keyword">esac</span>
</code></pre>
<hr/>
<h2 data-id="heading-3">🚀 第二步：终极黑科技 "Auto-Failover Wrapper"</h2>
<p>我要封装一个 <code>g</code> 命令。它平时就是普通的 Gemini，但在检测到报错时，它会<strong>光速切号</strong>并<strong>自动重试</strong>。</p>
<p>创建 <code>g.sh</code>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># g.sh - 永不欠费的 Gemini 包装器</span>

MANAGER=<span class="hljs-string">"<span class="hljs-variable">$HOME</span>/Documents/AI_Common/docs/scripts/gemini_manager.sh"</span>

<span class="hljs-comment"># 1. 显性化：告诉自己现在在用哪个号</span>
CURRENT_PROFILE=$(<span class="hljs-variable">$MANAGER</span> status | grep <span class="hljs-string">"当前身份"</span> | awk <span class="hljs-string">'{print $NF}'</span>)
<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\033[1;34m[Gemini CLI]\033[0m Account: \033[1;32m<span class="hljs-variable">${CURRENT_PROFILE:-UNKNOWN}</span>\033[0m"</span>

<span class="hljs-comment"># 2. 核心逻辑：拦截报错</span>
<span class="hljs-keyword">if</span> [[ <span class="hljs-string">"$*"</span> == *<span class="hljs-string">"-p"</span>* ]] || [[ <span class="hljs-string">"$*"</span> == *<span class="hljs-string">"--prompt"</span>* ]]; <span class="hljs-keyword">then</span>
    TMP_LOG=$(<span class="hljs-built_in">mktemp</span>)
    gemini <span class="hljs-string">"<span class="hljs-variable">$@</span>"</span> 2&gt;&amp;1 | <span class="hljs-built_in">tee</span> <span class="hljs-string">"<span class="hljs-variable">$TMP_LOG</span>"</span>
    
    <span class="hljs-keyword">if</span> grep -iqE <span class="hljs-string">"Quota exceeded|429|Too Many Requests"</span> <span class="hljs-string">"<span class="hljs-variable">$TMP_LOG</span>"</span>; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n\033[1;33m⚠️  检测到额度耗尽！启动自动故障转移...\033[0m"</span>
        
        <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$CURRENT_PROFILE</span>"</span> == <span class="hljs-string">"primary"</span> ]; <span class="hljs-keyword">then</span>
            <span class="hljs-variable">$MANAGER</span> switch secondary
        <span class="hljs-keyword">else</span>
            <span class="hljs-variable">$MANAGER</span> switch primary
        <span class="hljs-keyword">fi</span>
        
        <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\033[1;32m🔄 已重试...\033[0m\n"</span>
        gemini <span class="hljs-string">"<span class="hljs-variable">$@</span>"</span>
    <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">rm</span> <span class="hljs-string">"<span class="hljs-variable">$TMP_LOG</span>"</span>
<span class="hljs-keyword">else</span>
    gemini <span class="hljs-string">"<span class="hljs-variable">$@</span>"</span>
<span class="hljs-keyword">fi</span>
</code></pre>
<hr/>
<h2 data-id="heading-4">🎉 最终效果：爽到飞起</h2>
<p>把这个脚本 <code>alias g='.../g.sh'</code> 后，我的开发体验发生了质变。</p>
<p><strong>全程无人工干预！</strong> 我甚至不用把手从键盘上拿开。</p>
<p>这才是 AI 时代该有的工作流啊兄弟们！<strong>把重复的劳动交给脚本，把脑子留给架构。</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9e560aeee9e44e09e316c5d8da26e11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2Via3Vib3I=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770357140&amp;x-signature=Gq4wwrkCgnIiNcpqzbIqCnBT0z8%3D" alt="截屏2026-01-30 12.00.58.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe21352fac884919b553ab38c3026386~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2Via3Vib3I=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770357140&amp;x-signature=1Z8C7nouwpRhsP6l455FKZ8dnX8%3D" alt="截屏2026-01-30 13.51.18.png" loading="lazy"/></p>
<hr/>
<blockquote>
<p><strong>写在最后</strong>：
觉得有用的话，<strong>点赞、收藏、转发</strong>三连，别让你的 Gemini 饿着！🚀</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【翻译】将CSS裁剪功能引入React Native]]></title>    <link>https://juejin.cn/post/7600678255042002953</link>    <guid>https://juejin.cn/post/7600678255042002953</guid>    <pubDate>2026-01-30T04:15:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600678255042002953" data-draft-id="7600370554069123098" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【翻译】将CSS裁剪功能引入React Native"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-30T04:15:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户60007181910"/> <meta itemprop="url" content="https://juejin.cn/user/3555196688934128"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【翻译】将CSS裁剪功能引入React Native
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3555196688934128/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户60007181910
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T04:15:04.000Z" title="Fri Jan 30 2026 04:15:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>原文链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.callstack.com%2Fblog%2Fbringing-css-clipping-to-react-native" target="_blank" title="https://www.callstack.com/blog/bringing-css-clipping-to-react-native" ref="nofollow noopener noreferrer">www.callstack.com/blog/bringi…</a></p>
<p>作者：Kamil Paradowski</p>
<p>如果你曾在 React Native 中尝试创建倾斜标题或其他非矩形分隔区，你可能深有体会——总觉得缺少了什么。而在网页端，CSS 的 clip-path 特性让这些形状变得轻而易举。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.star-badge</span> { 
  <span class="hljs-attribute">clip-path</span>: <span class="hljs-built_in">polygon</span>(<span class="hljs-number">50%</span> <span class="hljs-number">0%</span>, <span class="hljs-number">61%</span> <span class="hljs-number">35%</span>, <span class="hljs-number">98%</span> <span class="hljs-number">35%</span>, <span class="hljs-number">68%</span> <span class="hljs-number">57%</span>, <span class="hljs-number">79%</span> <span class="hljs-number">91%</span>, <span class="hljs-number">50%</span> <span class="hljs-number">70%</span>, <span class="hljs-number">21%</span> <span class="hljs-number">91%</span>, <span class="hljs-number">32%</span> <span class="hljs-number">57%</span>, <span class="hljs-number">2%</span> <span class="hljs-number">35%</span>, <span class="hljs-number">39%</span> <span class="hljs-number">35%</span>); 
}
</code></pre>
<p>但遗憾的是，该功能不适用于 React Native 应用，因此我们需要导入第三方库：</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">MaskedView</span>} <span class="hljs-keyword">from</span> ...

&lt;<span class="hljs-title class_">MaskedView</span> path=<span class="hljs-string">"..."</span> /&gt;
</code></pre>
<p>这段代码的效果就是这个漂亮的形状：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4db672f8b311470d90ad519c82f1b29a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NjAwMDcxODE5MTA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770351304&amp;x-signature=MyT%2Fkkm2N9exTxIv15EHRDKa0VE%3D" alt="" loading="lazy"/>
最终我们实现了跨平台的星形遮罩效果。然而，网页和移动平台的代码差异显著。本文将探讨React Native如何通过类似CSS的StyleSheet API原生支持clip-path遮罩功能，并提出解决方案。</p>
<h2 data-id="heading-0">什么是CSS <code>clip-path</code>？</h2>
<p>CSS的clip-path属性定义了一个类似遮罩的裁剪区域：仅元素位于该区域内的部分可见，区域外内容均被隐藏。该区域由两部分构成：形状本身及其几何边框——后者决定了形状的定位与尺寸。</p>
<h3 data-id="heading-1">形状函数</h3>
<p>此参数定义裁剪的几何形状。可使用辅助形状函数(<code>circle()</code>、<code>polygon()</code>、<code>inset()</code>等)，或指向本地/远程资源(<code>url(image.png)</code>)。</p>
<blockquote>
<p>React Native的首个版本中不支持SVG图像的<code>clip-path</code>实现；<code>path()</code>形状无法正常工作。</p>
</blockquote>
<h3 data-id="heading-2">几何框</h3>
<p>此为参考帧。它告知渲染器应以元素"框"的哪个部分作为形状坐标系的原点<code>(0,0)</code>。默认值为<code>border-box</code>，也可使用<code>padding-box</code>、<code>content-box</code>或<code>margin-box</code>。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f7cbe89e02e410593c6a12f282ca5f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NjAwMDcxODE5MTA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770351304&amp;x-signature=Uj0I6IjVmy0%2BRGny%2FlHbsHU8hOM%3D" alt="几何框 - 边距框参考框" loading="lazy"/></p>
<h2 data-id="heading-3"><code>clip-path</code> 实战应用</h2>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.avatar</span> { 
  <span class="hljs-attribute">clip-path</span>: <span class="hljs-built_in">circle</span>(<span class="hljs-number">50%</span>); 
}
<span class="hljs-selector-class">.star-badge</span> { 
  <span class="hljs-attribute">clip-path</span>: <span class="hljs-built_in">polygon</span>(<span class="hljs-number">50%</span> <span class="hljs-number">0%</span>, <span class="hljs-number">61%</span> <span class="hljs-number">35%</span>, <span class="hljs-number">98%</span> <span class="hljs-number">35%</span>, <span class="hljs-number">68%</span> <span class="hljs-number">57%</span>, <span class="hljs-number">79%</span> <span class="hljs-number">91%</span>, <span class="hljs-number">50%</span> <span class="hljs-number">70%</span>, <span class="hljs-number">21%</span> <span class="hljs-number">91%</span>, <span class="hljs-number">32%</span> <span class="hljs-number">57%</span>, <span class="hljs-number">2%</span> <span class="hljs-number">35%</span>, <span class="hljs-number">39%</span> <span class="hljs-number">35%</span>); 
}
</code></pre>
<h2 data-id="heading-4">React Native 的独特之处</h2>
<p>在网页端，渲染栈由单一引擎（如 Blink）统一管理。它解析 CSS 并计算布局，随后借助 Skia 等图形引擎绘制屏幕上的每个像素。</p>
<p>相比之下，React Native 默认不自行绘制 UI。它更像一个协调者： 它将样式转换为布局指令，由宿主操作系统（iOS或Android）通过原生UI组件进行绘制。</p>
<p>本质上，网页在浏览器窗口内模拟UI，而React Native则利用手机原生构建块组装UI。</p>
<p>同时，React Native提供部分CSS功能供使用，但并非全部。让我们通过<code>clip-path</code>示例来观察实际运作机制。</p>
<p>如上所示的样式应呈现如下视图。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2704748e6a3a402f8205a061160815d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NjAwMDcxODE5MTA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770351304&amp;x-signature=yvX%2F1huF6m2cXnxVWGryYOU2wHo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">从样式到屏幕</h2>
<p>React Native 架构可视为分布式系统，它协调各组件间的协作。这意味着要为新属性添加支持，我们需要触及并修改其众多不同部分。</p>
<p>让我们逐一攻克这些环节。</p>
<p>当你在样式中写下示例定义 <code>clipPath: 'circle(50% at 25% 25%)'</code> 时，这场旅程便拉开了序幕。</p>
<h3 data-id="heading-6">从JS层开始</h3>
<p>React文件必须识别新属性的存在，因此我们需要确保TypeScript或Flow能检测到它。该属性的参数仅是文本，所以只需进行如下修改即可，对吧？</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">export</span> type ____ViewStyle_InternalBase = $ReadOnly&lt;{ <span class="hljs-comment">// ... isolation?: 'auto' | 'isolate', + clipPath?: string, }&gt;;</span>
</code></pre>
<p>‍‍其实不然。JS层还负责解析参数值并将其转换为对象结构，该结构随后由原生代码处理。这意味着我们还需添加解析功能及描述新<code>clipPath</code>输入模式的类型定义。</p>
<p>这必然需要配套测试及其他细微调整。为保持本文简洁明了，我将略过这些环节。让我们观察当新的CSS属性值（无论是解析后的对象还是原始字符串）传递至React Native C++核心层时会发生什么。</p>
<blockquote>
<p>近期 React Native 核心团队新增了<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact-native%2Ftree%2Fmain%2Fpackages%2Freact-native%2FReactCommon%2Freact%2Frenderer%2Fcss" target="_blank" title="https://github.com/facebook/react-native/tree/main/packages/react-native/ReactCommon/react/renderer/css" ref="nofollow noopener noreferrer">原生 CSS 解析器</a>。这意味着属性文本值可直接由 C++ 代码完成解析、分词及原生类型转换！此方案不仅略微提升性能，更是技术上更严谨的实现方式。不过该功能目前仍处于开发阶段，需通过内部功能开关启用。期待它能尽快成为默认配置。</p>
</blockquote>
<h3 data-id="heading-7">C++作为核心基础</h3>
<p>React Native的新架构渲染器（又称Fabric）采用C++作为跨平台共享核心。正是这一层实现了真正的跨平台兼容性。接收到的剪切路径数据需要以C++形式呈现，才能被iOS和Android（<a href="https://link.juejin.cn?target=https%3A%2F%2Fdevblogs.microsoft.com%2Freact-native%2F%25F0%259F%259A%2580react-native-windows-v0-81-is-here%2F" target="_blank" title="https://devblogs.microsoft.com/react-native/%F0%9F%9A%80react-native-windows-v0-81-is-here/" ref="nofollow noopener noreferrer">以及其他平台，如v0.81版本中默认采用新架构的Windows</a>）所使用。</p>
<p>让我们从头开始。要理解CSS属性变更如何触发应用重渲染，需完整解析React Native的渲染管道。</p>
<p>让我们逐步剖析：在添加新CSS属性功能时，各环节需要进行哪些具体变更。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a0cdd7ce07745c996782863fbd248f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NjAwMDcxODE5MTA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770351304&amp;x-signature=u7%2BxrfqdoFtWmuGScAYhA3Jmtjs%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>若想深入了解 React Native 的全新渲染管道，<a href="https://link.juejin.cn?target=https%3A%2F%2Freactnative.dev%2Farchitecture%2Foverview" target="_blank" title="https://reactnative.dev/architecture/overview" ref="nofollow noopener noreferrer">新架构的官方文档</a>对此有详尽阐述，尤其建议查阅<a href="https://link.juejin.cn?target=https%3A%2F%2Freactnative.dev%2Farchitecture%2Frender-pipeline" target="_blank" title="https://reactnative.dev/architecture/render-pipeline" ref="nofollow noopener noreferrer">渲染、提交与挂载</a>章节。</p>
</blockquote>
<p>一切始于名为<strong>协调</strong>的流程。在此阶段（即<strong>渲染阶段</strong>），React 的协调器会计算新旧 props 之间的差异，检测 props 变更，并安排重新渲染。上段已阐述此步骤的变更机制。</p>
<p>当 props 变更时，React 会克隆带有新 props 的 <em>Shadow Node</em>。不同于旧架构中通过异步消息传递至独立线程的低效方式，现在改用直接的 JSI 调用实现。</p>
<p>为何克隆在此处有效？</p>
<p>出于线程安全考虑，<em>Shadow Tree Nodes</em> 具有不可变性。要修改 CSS 属性时，渲染器无法直接修改现有节点。必须克隆受影响的Shadow Node并赋予新属性。通过结构共享机制回指未变更的旧节点，最大限度降低内存开销。</p>
<p>这正是我们需要介入的环节。</p>
<p><em>Shadow Node</em>是React阴影树元素的表示形式，包含源自JavaScript的属性及布局信息。我们需要扩展属性列表并新增一项。</p>
<pre><code class="hljs language-C++" lang="C++"><span class="hljs-keyword">namespace</span> facebook::react {

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseViewProps</span> : <span class="hljs-keyword">public</span> YogaStylableProps, <span class="hljs-keyword">public</span> AccessibilityProps {
	 <span class="hljs-comment">// ...</span>
	 
   <span class="hljs-comment">// Color</span>
   Float opacity{<span class="hljs-number">1.0</span>};
   SharedColor backgroundColor{};

   <span class="hljs-comment">// Borders</span>
   CascadedBorderRadii borderRadii{};
   CascadedBorderColors borderColors{};
   
 	 <span class="hljs-comment">// ...</span>
+  std::optional&lt;ClipPath&gt; clipPath{};
}

} <span class="hljs-comment">// namespace facebook::react</span>
</code></pre>
<p>将<code>clipPath</code>集成到<code>BaseViewProps</code>类定义中</p>
<p>在C++世界中，<code>std::optional&lt;T&gt;</code>表示该属性可为空，而<code>ClipPath</code>是我们用来表示此属性的新类型。其通常呈现如下形式：</p>
<pre><code class="hljs language-C++" lang="C++"><span class="hljs-keyword">namespace</span> facebook::react {

<span class="hljs-comment">// Define individual geometric primitives used for clipping</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">CircleShape</span> {
  std::optional&lt;ValueUnit&gt; r{};
  std::optional&lt;ValueUnit&gt; cx{};
  std::optional&lt;ValueUnit&gt; cy{};
    <span class="hljs-comment">// ...</span>
};

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">EllipseShape</span> {
  std::optional&lt;ValueUnit&gt; rx{};
  std::optional&lt;ValueUnit&gt; ry{};
  std::optional&lt;ValueUnit&gt; cx{};
  std::optional&lt;ValueUnit&gt; cy{};
  <span class="hljs-comment">// ...</span>
}
...
<span class="hljs-comment">// A type-safe union representing any possible basic shape</span>
<span class="hljs-keyword">using</span> BasicShape = std::variant&lt;
    CircleShape,
    EllipseShape,
    InsetShape,
    PolygonShape,
    RectShape,
    XywhShape&gt;;

<span class="hljs-comment">// Standard box model enumerations for the clip reference box</span>
<span class="hljs-keyword">enum class</span> <span class="hljs-title class_">GeometryBox</span> : <span class="hljs-type">uint8_t</span> {
  MarginBox,
  BorderBox,
  ContentBox,
  PaddingBox
};

<span class="hljs-comment">// Main structure representing a full clip-path value</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">ClipPath</span> {
  std::optional&lt;BasicShape&gt; shape;
  std::optional&lt;GeometryBox&gt; geometryBox;

  <span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span>==(<span class="hljs-type">const</span> ClipPath &amp;other) <span class="hljs-type">const</span>;

<span class="hljs-comment">// Debugging and serialization helpers</span>
<span class="hljs-meta">#<span class="hljs-keyword">if</span> RN_DEBUG_STRING_CONVERTIBLE</span>
  <span class="hljs-function">std::string <span class="hljs-title">toString</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> RN_SERIALIZABLE_STATE</span>
  <span class="hljs-function">folly::dynamic <span class="hljs-title">toDynamic</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
};

} <span class="hljs-comment">// namespace facebook::react</span>
</code></pre>
<p><code>clipPath</code>属性实现的数据结构</p>
<p>我们需要确保，正如CSS规范所述，<code>clipPath</code>属性应导致<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FCSS%2FGuides%2FPositioned_layout%2FStacking_context" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/CSS/Guides/Positioned_layout/Stacking_context" ref="nofollow noopener noreferrer">堆叠上下文</a>的创建。</p>
<p>这需要对<code>ViewShadowNode</code>类进行微调——该类是待挂载<code>&lt;View&gt;</code>组件的阴影节点表示形式。若未进行此调整，将导致意外结果，例如组件的子元素无法被剪切。</p>
<pre><code class="hljs language-C++" lang="C++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ViewShadowNode::initialize</span><span class="hljs-params">()</span> <span class="hljs-keyword">noexcept</span> </span>{
  <span class="hljs-comment">// ...</span>
  <span class="hljs-type">bool</span> formsStackingContext = !viewProps.collapsable ||
      viewProps.pointerEvents == PointerEventsMode::None ||
      !viewProps.nativeId.<span class="hljs-built_in">empty</span>() || viewProps.accessible ||
      viewProps.opacity != <span class="hljs-number">1.0</span> || viewProps.transform != Transform{} ||
      (viewProps.zIndex.<span class="hljs-built_in">has_value</span>() &amp;&amp;
       viewProps.yogaStyle.<span class="hljs-built_in">positionType</span>() != yoga::PositionType::Static) ||
      viewProps.yogaStyle.<span class="hljs-built_in">display</span>() == yoga::Display::None ||
      viewProps.<span class="hljs-built_in">getClipsContentToBounds</span>() || viewProps.events.bits.<span class="hljs-built_in">any</span>() ||
      <span class="hljs-built_in">isColorMeaningful</span>(viewProps.shadowColor) ||
      viewProps.accessibilityElementsHidden ||
      viewProps.accessibilityViewIsModal ||
      viewProps.importantForAccessibility != ImportantForAccessibility::Auto ||
      viewProps.removeClippedSubviews || viewProps.cursor != Cursor::Auto ||
      !viewProps.filter.<span class="hljs-built_in">empty</span>() ||
      viewProps.mixBlendMode != BlendMode::Normal ||
      viewProps.isolation == Isolation::Isolate ||
      HostPlatformViewTraitsInitializer::formsStackingContext(viewProps) ||
      !viewProps.accessibilityOrder.<span class="hljs-built_in">empty</span>() ||
+     viewProps.clipPath.<span class="hljs-built_in">has_value</span>();
  <span class="hljs-comment">// ...</span>
  <span class="hljs-keyword">if</span> (formsStackingContext) {
    traits_.<span class="hljs-built_in">set</span>(ShadowNodeTraits::Trait::FormsStackingContext);
  } <span class="hljs-keyword">else</span> {
    traits_.<span class="hljs-built_in">unset</span>(ShadowNodeTraits::Trait::FormsStackingContext);
  }
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>更新堆叠上下文逻辑以包含剪裁路径</p>
<p><strong>渲染</strong>完成后，将触发阴影树的提交操作。该操作将新树提升为待挂载的"下一棵树"，并安排布局计算（Yoga）。</p>
<p>接下来的最后阶段是<strong>挂载</strong>：将React阴影树转换为主视图树。</p>
<p>该过程包含三个步骤：</p>
<ul>
<li><strong>Tree Diff</strong>：计算当前树与后续树之间的差异。</li>
<li><strong>Tree Promotion</strong>：确保后续挂载阶段基于正确树进行差异计算。</li>
<li><strong>View Mounting</strong>：执行实际渲染变更。</li>
</ul>
<p>至此我们已了解属性变更信息如何从JavaScript层级传播至宿主平台层级。接下来让我们探究iOS与Android平台中<code>clip-path</code>的具体实现方式。</p>
<h3 data-id="heading-8">iOS 中的剪切功能</h3>
<p>React Native 使用 UIKit 来处理和构建 UI 元素，其最基础的构建块是 <code>UIView</code>。在 <code>UIKit</code> 中，每个 <code>UIView</code> 都由一个 <code>CALayer</code>（核心动画层）支撑。当视图处理触摸等用户交互时，该层实际负责在屏幕上渲染内容，并充当画布。每个图层都拥有一个作为透明度遮罩的mask属性——它决定了哪些内容可见、哪些内容隐藏。掌握这些知识后，让我们开始实现吧！</p>
<p>值得庆幸的是，React Native iOS 提供了一个自定义类（<code>RCTViewComponentView</code>），它继承自 <code>UIView</code>。所有创建的视图类型（无论是 <code>&lt;View&gt;</code> 还是 <code>&lt;Image&gt;</code>）都继承自该类。这意味着我们只需在此处添加剪切路径逻辑，即可适配所有 React Native 组件！关键实现点在于 <code>invalidateLayer</code> 函数，需通过下方代码块进行扩展：</p>
<pre><code class="hljs language-C" lang="C">- (<span class="hljs-type">void</span>)invalidateLayer
{
  <span class="hljs-comment">// ...</span>
  <span class="hljs-comment">// Handle clip-path property</span>
  <span class="hljs-keyword">if</span> (_props-&gt;clipPath.has_value()) {
    CALayer *maskLayer = [RCTClipPathUtils createClipPathLayer:_props-&gt;clipPath.value()
                                                 layoutMetrics:_layoutMetrics
                                                     yogaStyle:_props-&gt;yogaStyle
                                                        bounds:layer.bounds
                                                   cornerRadii:RCTCornerRadiiFromBorderRadii(borderMetrics.borderRadii)];
    <span class="hljs-keyword">if</span> (maskLayer != nil) {
      self.currentContainerView.layer.mask = maskLayer;
    }
  }
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>对 <code>invalidateLayer</code> 函数的修改</p>
<p>其中 <code>createClipPathLayer</code> 是一个辅助函数，负责计算几何边界框并创建形状路径。让我们来看看它的具体实现。</p>
<pre><code class="hljs language-C" lang="C">+ (CALayer *)createClipPathLayer:(<span class="hljs-type">const</span> ClipPath &amp;)clipPath
                   layoutMetrics:(<span class="hljs-type">const</span> LayoutMetrics &amp;)layoutMetrics
                       yogaStyle:(<span class="hljs-type">const</span> facebook::yoga::Style &amp;)yogaStyle
                          bounds:(CGRect)bounds
                     cornerRadii:(RCTCornerRadii)cornerRadii
{
  CGRect box = [self getGeometryBoxRect:clipPath.geometryBox
                          layoutMetrics:layoutMetrics
                              yogaStyle:yogaStyle
                                 bounds:bounds];
</code></pre>
<ol>
<li>首先，我们需要确定正确的几何框边界。我们需要使用正确的参考框并调整其角半径。</li>
</ol>
<pre><code class="hljs language-C" lang="C">  UIBezierPath *path = nil;
  <span class="hljs-keyword">if</span> (clipPath.shape.has_value()) {
    <span class="hljs-comment">// clipPath: circle(50%) content-box</span>
    path = [RCTBasicShapeUtils createPathFromBasicShape:clipPath.shape.value() bounds:box];
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (clipPath.geometryBox.has_value()) {
    <span class="hljs-comment">// clipPath: content-box</span>
    path = [UIBezierPath bezierPathWithCGPath:RCTPathCreateWithRoundedRect(box, cornerInsets, nil, NO)];
  }
</code></pre>
<ol start="2">
<li>UIKit 提供了一个辅助类 <code>UIBezierPath</code> 用于路径操作。对于每个支持的形状，我们需要使用新辅助函数 <code>createPathFromBasicShape</code> 创建描述该形状的路径。若形状已定义，则创建对应路径；否则，若提供了几何框路径，则使用该路径。</li>
</ol>
<pre><code class="hljs language-C" lang="C">  <span class="hljs-comment">// Skip invalid or empty path</span>
  <span class="hljs-keyword">if</span> (path == nil) {
    <span class="hljs-keyword">return</span> nil;
  }
  
  CAShapeLayer *maskLayer = [CAShapeLayer layer];
  maskLayer.path = path.CGPath;
  <span class="hljs-keyword">return</span> maskLayer;
}
</code></pre>
<ol start="3">
<li>若结果路径正确，可通过 <code>CAShapeLayer</code> 类创建遮罩图层。该遮罩图层将在 <code>invalidateLayer</code> 函数中作为 <code>UIView</code> 的遮罩使用。</li>
</ol>
<p><code>createPathFromBasicShape</code> 的实现方式如下？下面给出矩形形状的示例：</p>
<pre><code class="hljs language-C" lang="C">+ (UIBezierPath *)createRectPath:(<span class="hljs-type">const</span> RectShape &amp;)rect bounds:(CGRect)bounds
{
  <span class="hljs-comment">// Define corners</span>
  CGFloat top = bounds.origin.y + RCTResolveValueUnit(rect.top, bounds.size.height);
  CGFloat right = bounds.origin.x + RCTResolveValueUnit(rect.right, bounds.size.width);
  CGFloat bottom = bounds.origin.y + RCTResolveValueUnit(rect.bottom, bounds.size.height);
  CGFloat left = bounds.origin.x + RCTResolveValueUnit(rect.left, bounds.size.width);

  <span class="hljs-comment">// Create a rect</span>
  CGRect clipRect = CGRectMake(left, top, right - left, bottom - top);

  <span class="hljs-comment">// Catch for invalid dimensions</span>
  <span class="hljs-keyword">if</span> (clipRect.size.width &lt; <span class="hljs-number">0</span> || clipRect.size.height &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> nil;
  }

  <span class="hljs-comment">// Adjust radius</span>
  CGFloat borderRadius = rect.borderRadius.has_value() ? RCTResolveValueUnit(rect.borderRadius.value(), MIN(clipRect.size.width, clipRect.size.height)) : <span class="hljs-number">0.0f</span>;
  
  <span class="hljs-comment">// Use bezierPathWithRoundedRect to create rounder rect bezier path</span>
  <span class="hljs-keyword">return</span> [UIBezierPath bezierPathWithRoundedRect:clipRect cornerRadius:borderRadius];
}
</code></pre>
<p>综合所有内容，我们终于在React Native中实现了适用于iOS的<code>clipPath</code>功能！</p>
<p>当然，我略去了部分实现细节，包括检测属性变更、标记需要无效化的图层、原生解析属性文本值、将CSS类型转换为图形类型等。但这仍能让你掌握整个流程的核心要义。若感兴趣，可在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact-native%2Fpulls%3Fq%3Dis%253Apr%2Bis%253Aopen%2B%2522add%2Bclip-path%2522" target="_blank" title="https://github.com/facebook/react-native/pulls?q=is%3Apr+is%3Aopen+%22add+clip-path%22" ref="nofollow noopener noreferrer">此处</a>查看所有变更的链接。</p>
<h2 data-id="heading-9">Android 平台的裁剪实现</h2>
<p>Android 设计略有不同，这并不令人意外。</p>
<p>每个Android端的React Native组件都以<code>View</code>类实现。虽然存在<code>ViewOutlineProvider</code>等替代方案处理简单圆角，但它们往往难以应对复杂形状。</p>
<p>针对Android视图裁剪需求，最流行且适用的解决方案是重写<code>draw</code>方法，直接在画布上应用裁剪操作。Android的<code>Canvas</code>类为此提供了专属函数<code>clipPath</code>和<code>clipRect</code>——这正是我们所需的功能！</p>
<p>Android 与 iOS 的区别在于：Android 没有适用于所有组件类型的基础 <code>View</code> 类（存在某些例外情况会破坏通用解决方案）。但 React Native 提供了一个特殊的辅助类 <code>BackgroundStyleApplicator</code>，该类可用于并适用于所有 <code>View</code>。</p>
<p>我们可以在该类中添加<code>clipPath</code>逻辑，并从其他所有位置调用它。对于代表 <code>&lt;Image&gt;</code> 组件的 <code>ReactImageView </code>类，代码实现如下：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> override fun <span class="hljs-title function_">draw</span><span class="hljs-params">(canvas: Canvas)</span> {
  BackgroundStyleApplicator.applyClipPathIfPresent(<span class="hljs-built_in">this</span>, canvas) {
    <span class="hljs-built_in">super</span>.draw(canvas)
  }
}
</code></pre>
<p>其中 <code>applyClipPathIfPresent</code> 是一个函数，其简化版本可表示为：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> fun <span class="hljs-title function_">applyClipPathIfPresent</span><span class="hljs-params">(view: View, canvas: Canvas, drawContent: (()</span> -&gt; Unit?)?) {
    <span class="hljs-comment">// ...</span>
    canvas.withSave {
      <span class="hljs-comment">// ...</span>
      <span class="hljs-comment">// Calculation of geometry-box</span>
      <span class="hljs-type">val</span> <span class="hljs-variable">bounds</span> <span class="hljs-operator">=</span> getGeometryBoxBounds(...)
      
      <span class="hljs-comment">// Path creation</span>
      val path: Path? = <span class="hljs-keyword">if</span> (clipPath.shape != <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// clipPath: circle(50%) content-box</span>
        ClipPathUtils.createPathFromBasicShape(clipPath.shape, bounds)
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (clipPath.geometryBox != <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// clipPath: content-box</span>
        ClipPathUtils.createRoundedRectPath(bounds,
          GeometryBoxUtil.adjustBorderRadiusForGeometryBox(view, clipPath.geometryBox, ...)
        )
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-literal">null</span>
      }

      <span class="hljs-comment">// Clipping logic</span>
      <span class="hljs-keyword">if</span> (path != <span class="hljs-literal">null</span>) {
        clipPath(path)
      }

      <span class="hljs-comment">// Draw actual content to be clipped</span>
      drawContent?.invoke()
    }
  }
</code></pre>
<p>该逻辑与iOS非常相似：</p>
<ol>
<li>首先，我们使用新辅助函数<code>getGeometryBoxBounds</code>计算<code>geometry-box</code>。</li>
<li>然后创建描述形状的路径并传递给<code>clip-path</code>。</li>
<li>最后调用相应的<code>Canvas</code>方法来剪切绘图区域。</li>
</ol>
<p>以下是Android平台创建矩形形状的方法：</p>
<pre><code class="hljs language-Java" lang="Java"> <span class="hljs-keyword">private</span> fun <span class="hljs-title function_">createRectPath</span><span class="hljs-params">(rect: RectShape, bounds: RectF)</span>: Path? {
    <span class="hljs-comment">// Define corners</span>
    <span class="hljs-type">val</span> <span class="hljs-variable">top</span> <span class="hljs-operator">=</span> bounds.top + resolveLengthPercentage(rect.top, bounds.height())
    <span class="hljs-type">val</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> bounds.left + resolveLengthPercentage(rect.right, bounds.width())
    <span class="hljs-type">val</span> <span class="hljs-variable">bottom</span> <span class="hljs-operator">=</span> bounds.top + resolveLengthPercentage(rect.bottom, bounds.height())
    <span class="hljs-type">val</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> bounds.left + resolveLengthPercentage(rect.left, bounds.width())

    <span class="hljs-comment">// ...</span>
    <span class="hljs-comment">// Create path</span>
    <span class="hljs-type">val</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> Path()
    <span class="hljs-keyword">if</span> (rect.borderRadius != <span class="hljs-literal">null</span>) {
      <span class="hljs-comment">// Rounded corners case</span>
      <span class="hljs-type">val</span> <span class="hljs-variable">referenceDimension</span> <span class="hljs-operator">=</span> minOf(rect.width(), rect.height())
      <span class="hljs-type">val</span> <span class="hljs-variable">radius</span> <span class="hljs-operator">=</span> resolveLengthPercentage(borderRadius, referenceDimension)
      path.addRoundRect(rect, radius, radius, Path.Direction.CW)
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// Sharp edges case</span>
      path.addRect(rect, Path.Direction.CW)
    }

    <span class="hljs-keyword">return</span> path
  }
</code></pre>
<p>所有操作都包裹在<code>withSave</code>块中。这样做是为了确保我们对画布的修改不会影响其他绘制调用，否则可能导致意外行为。</p>
<p>那么裁剪视图背景、子视图或其效果会怎样？我们需要快速分析Android图形管道，并检查<code>draw(Canvas)</code>方法的实际作用。通过查看<code>View</code>类的源代码即可轻松验证：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// Step 1, draw the background, if needed</span>
drawBackground(canvas)
<span class="hljs-comment">// Step 2, save the canvas' layers</span>
<span class="hljs-comment">// ...</span>
<span class="hljs-comment">// Step 3, draw the content</span>
onDraw(canvas)
<span class="hljs-comment">// Step 4, draw the children</span>
dispatchDraw(canvas)
<span class="hljs-comment">// Step 5, draw the fade effect and restore layers</span>
<span class="hljs-comment">// ...</span>
<span class="hljs-comment">// Step 6, draw decorations (foreground, scrollbars)</span>
onDrawForeground(canvas)
<span class="hljs-comment">// Step 7, draw the default focus highlight</span>
drawDefaultFocusHighlight(canvas)
</code></pre>
<p>在调用 <code>super.draw(canvas)</code> 之前对画布应用裁剪操作，可确保组件的所有可绘制部分均被我们的代码裁剪。只需将此操作添加到所有 <code>View</code> 类中，任务就完成了！很简单吧？</p>
<p>正如你所料，我又把过程简化了。最初还需额外处理：进行类型转换、在多处添加对新属性的支持调整，以及最关键的一步——在挂载过程中计算并缓存布局信息，以确保<code>geometry-box</code>计算准确。</p>
<p>不过这些内容可以另写一篇文章详述，希望本文能为你提供基础思路。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73791a004772436fa86adb8d4a7968eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NjAwMDcxODE5MTA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770351304&amp;x-signature=g4LWEPVAAdDan3vCOc1dzSsLCLE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-10">总结</h2>
<p>和许多移动开发者一样，我喜欢用React Native构建应用。它让我能复用网页开发技能，为iOS、Android等平台打造应用。</p>
<p>但过程并非一帆风顺。某些在网页端用CSS就能轻松实现的功能，在这里需要借助封装原生视图的第三方库——这又是一项新技能。</p>
<p>通过增强React Native对CSS的支持，我期待我们能更接近这样一个世界：在移动应用中充分运用所有网页样式设计知识。</p>
<p>希望您喜欢这次关于CSS与React Native新架构底层运作机制的小探索，并从中获得新知。</p>
<p>目前有三份为React Native引入<code>clip-path</code>支持的PR<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact-native%2Fpulls%3Fq%3Dis%253Apr%2Bis%253Aopen%2B%2522add%2Bclip-path%2522" target="_blank" title="https://github.com/facebook/react-native/pulls?q=is%3Apr+is%3Aopen+%22add+clip-path%22" ref="nofollow noopener noreferrer">正在审核</a>中。待它们合并发布后，期待您用它打造出精彩的作品！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Retrofit框架原理分析]]></title>    <link>https://juejin.cn/post/7600670417858773026</link>    <guid>https://juejin.cn/post/7600670417858773026</guid>    <pubDate>2026-01-30T03:51:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600670417858773026" data-draft-id="7600665529113477120" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Retrofit框架原理分析"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-30T03:51:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Asmewill"/> <meta itemprop="url" content="https://juejin.cn/user/3139860938370557"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Retrofit框架原理分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3139860938370557/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Asmewill
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T03:51:17.000Z" title="Fri Jan 30 2026 03:51:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一.基本用法</h3>
<h5 data-id="heading-1">1.创建Retrofit对象</h5>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">HttpRetrofit</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Retrofit mRetrofit;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Retrofit <span class="hljs-title">getService</span>()</span>{
        <span class="hljs-keyword">if</span> (mRetrofit == <span class="hljs-literal">null</span>) {
            synchronized (HttpRetrofit.<span class="hljs-keyword">class</span>) {
                <span class="hljs-keyword">if</span> (mRetrofit == <span class="hljs-literal">null</span>) {
                    mRetrofit = <span class="hljs-keyword">new</span> Retrofit.Builder()
                            .baseUrl(ApiUrl.BASE_URL)
                            .client(WBHttpClient.getHttpClient())
                            .addConverterFactory(GsonConverterFactory.create())
                            .addCallAdapterFactory(RxJava2CallAdapterFactory.create())
                            .build();
                }
            }
        }
        <span class="hljs-keyword">return</span> mRetrofit;
    }
}
</code></pre>
<h5 data-id="heading-2">2.retrofit各种网络请求的用法</h5>
<pre><code class="hljs language-sql" lang="sql">  <span class="hljs-comment">/************************************GET网络请求方式******************************************************/</span>
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span>作用：<span class="hljs-keyword">GET</span>请求最简单的写法,无Path参数和Query参数 <span class="hljs-operator">*</span><span class="hljs-operator">/</span>
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-variable">@GET</span>("article/list/latest?page=1") <span class="hljs-keyword">Call</span><span class="hljs-operator">&lt;</span>ResponseBody<span class="hljs-operator">&gt;</span> getLatestString();
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span>作用：<span class="hljs-keyword">GET</span>请求，指定Path参数和Query参数
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-variable">@GET</span>("article/list/{type}?") <span class="hljs-keyword">Call</span><span class="hljs-operator">&lt;</span>QiushiModel<span class="hljs-operator">&gt;</span> getInfoList(<span class="hljs-variable">@Path</span>("type") String type, <span class="hljs-variable">@Query</span>("page") <span class="hljs-type">int</span> page);
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span>作用：<span class="hljs-keyword">GET</span>请求提交数据
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-variable">@GET</span>("MyWeb/RegServlet") <span class="hljs-keyword">Call</span><span class="hljs-operator">&lt;</span>ResponseBody<span class="hljs-operator">&gt;</span> getRegInfo(<span class="hljs-variable">@QueryMap</span> Map<span class="hljs-operator">&lt;</span>String, String<span class="hljs-operator">&gt;</span> map);
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span>作用：<span class="hljs-keyword">GET</span>请求,指定URL参数
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-variable">@GET</span> <span class="hljs-keyword">Call</span><span class="hljs-operator">&lt;</span>QiushiModel<span class="hljs-operator">&gt;</span> getInfoList(<span class="hljs-variable">@Url</span> String urlString);
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span>访问网络，下载大文件。 <span class="hljs-operator">*</span> 默认情况下，Retrofit在处理结果前会将服务器端的Response全部读进内存
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-variable">@Streaming</span> <span class="hljs-variable">@GET</span> <span class="hljs-keyword">Call</span><span class="hljs-operator">&lt;</span>ResponseBody<span class="hljs-operator">&gt;</span> getNetworkDataAsync(<span class="hljs-variable">@Url</span> String urlString);
    <span class="hljs-comment">/************************************POST网络请求方式******************************************************/</span>
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span>作用:post网络请求，向服务器提交表单域数据
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-variable">@FormUrlEncoded</span> <span class="hljs-variable">@POST</span>("MyWeb/RegServlet") <span class="hljs-keyword">Call</span><span class="hljs-operator">&lt;</span>ResponseBody<span class="hljs-operator">&gt;</span> postFormFields(<span class="hljs-variable">@Field</span>("username") String username, <span class="hljs-variable">@Field</span>("password") String password, <span class="hljs-variable">@Field</span>("age") String age);
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-variable">@FormUrlEncoded</span> <span class="hljs-variable">@POST</span>("MyWeb/RegServlet") <span class="hljs-keyword">Call</span><span class="hljs-operator">&lt;</span>ResponseBody<span class="hljs-operator">&gt;</span> postFormFieldMap(<span class="hljs-variable">@FieldMap</span> Map<span class="hljs-operator">&lt;</span>String , String<span class="hljs-operator">&gt;</span> map);
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span>作用：POST网络请求，上传单个文件，上传后的文件名称已经被指定
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-variable">@Multipart</span> <span class="hljs-variable">@POST</span>("MyWeb/UploadServlet") <span class="hljs-keyword">Call</span><span class="hljs-operator">&lt;</span>ResponseBody<span class="hljs-operator">&gt;</span> postUploadFile(<span class="hljs-variable">@Part</span>("uploadfile\";filename<span class="hljs-operator">=</span>\"myuploadimg.png") RequestBody requestBody);
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span>作用：POST网络请求，上传多个文件，同时上传表单域数据
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-variable">@POST</span>("MyWeb/UPloadServlet") <span class="hljs-keyword">Call</span><span class="hljs-operator">&lt;</span>ResponseBody<span class="hljs-operator">&gt;</span> postUploadFilesMultipartBody(<span class="hljs-variable">@Body</span> MultipartBody multipartBody);}
<span class="hljs-operator">/</span><span class="hljs-operator">/</span>和Rxjava一起连用
  <span class="hljs-variable">@GET</span>(ApiUrl.GET_MARKET)
    Observable<span class="hljs-operator">&lt;</span>BaseResult<span class="hljs-operator">&lt;</span>List<span class="hljs-operator">&lt;</span>MarketBean<span class="hljs-operator">&gt;&gt;</span><span class="hljs-operator">&gt;</span> getMarket(<span class="hljs-variable">@QueryMap</span> Map<span class="hljs-operator">&lt;</span>String ,Object<span class="hljs-operator">&gt;</span> map);

 mRetrofit.create(WebService.class).getMarket(map).
                subscribeOn(Schedulers.io()).observeOn(AndroidSchedulers.mainThread()).
                subscribe(<span class="hljs-keyword">new</span> ObserverCallBack<span class="hljs-operator">&lt;</span>BaseResult<span class="hljs-operator">&lt;</span>List<span class="hljs-operator">&lt;</span>MarketBean<span class="hljs-operator">&gt;&gt;</span><span class="hljs-operator">&gt;</span>(<span class="hljs-keyword">new</span> ApiCallBack<span class="hljs-operator">&lt;</span>BaseResult<span class="hljs-operator">&lt;</span>List<span class="hljs-operator">&lt;</span>MarketBean<span class="hljs-operator">&gt;&gt;</span><span class="hljs-operator">&gt;</span>() {
                    <span class="hljs-variable">@Override</span>
                    public void onSuccess(BaseResult<span class="hljs-operator">&lt;</span>List<span class="hljs-operator">&lt;</span>MarketBean<span class="hljs-operator">&gt;&gt;</span> baseResult) {

                    }
                    <span class="hljs-variable">@Override</span>
                    public void onFailture(Throwable e,<span class="hljs-type">int</span> errorCode) {

                    }
                }));
</code></pre>
<h5 data-id="heading-3">3.动态代理示例【<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fgonjan-blog%2Fp%2F6685611.html%25E3%2580%2591" target="_blank" title="https://www.cnblogs.com/gonjan-blog/p/6685611.html%E3%80%91" ref="nofollow noopener noreferrer">www.cnblogs.com/gonjan-blog…</a></h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a84082a625794b3fa0b1012d10c509bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349877&amp;x-signature=ItJjt5Xy4uzFx5wu94L%2F1EHewZY%3D" alt="image.png" loading="lazy"/></p>
<p>动态代理(代理类在运行前不存在，运行时由程序生成的代理方式叫动态代理)
实现方式：创建一个实现了InvocationHandler 接口的类，然后实现其invoke方法,然后使用Proxy.newProxyInstance（）方法创建代理对象，通过代理对象，调用接口中的方法，实际上是调用的InvocationHandler 中的invoke方法</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">/**
 * 创建Person接口
 * @author Gonjan
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">Person</span> {
    <span class="hljs-comment">//上交班费</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">giveMoney</span>()</span>;
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> <span class="hljs-title">implements</span> <span class="hljs-title">Person</span> {
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Student</span>(<span class="hljs-params">String name</span>)</span> {
        <span class="hljs-keyword">this</span>.name = name;
    }
    
    @Override
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">giveMoney</span>()</span> {
        <span class="hljs-keyword">try</span> {
          <span class="hljs-comment">//假设数钱花了一秒时间</span>
            Thread.sleep(<span class="hljs-number">1000</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
       System.<span class="hljs-keyword">out</span>.println(name + <span class="hljs-string">"上交班费50元"</span>);
    }
}

</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StuInvocationHandler</span>&lt;T&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> {
   <span class="hljs-comment">//invocationHandler持有的被代理对象</span>
    T target;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">StuInvocationHandler</span><span class="hljs-params">(T target)</span> {
       <span class="hljs-built_in">this</span>.target = target;
    }
    
    <span class="hljs-comment">/**
     * proxy:代表动态代理对象
     * method：代表正在执行的方法
     * args：代表调用目标方法时传入的实参
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable {
        System.out.println(<span class="hljs-string">"代理执行"</span> +method.getName() + <span class="hljs-string">"方法"</span>);
     */   
        <span class="hljs-comment">//代理过程中插入监测方法,计算该方法耗时</span>
        MonitorUtil.start();
        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> method.invoke(target, args);
        MonitorUtil.finish(method.getName());
        <span class="hljs-keyword">return</span> result;
    }
}
</code></pre>
<p>测试代理类：</p>
<pre><code class="hljs language-arduino" lang="arduino">
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProxyTest</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> </span>{
        
        <span class="hljs-comment">//创建一个实例对象，这个对象是被代理的对象</span>
        Person zhangsan = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Student</span>(<span class="hljs-string">"张三"</span>);
        
        <span class="hljs-comment">//创建一个与代理对象相关联的InvocationHandler</span>
        InvocationHandler stuHandler = <span class="hljs-keyword">new</span> <span class="hljs-built_in">StuInvocationHandler</span>&lt;Person&gt;(zhangsan);
        
        <span class="hljs-comment">//创建一个代理对象stuProxy来代理zhangsan，代理对象的每个执行方法都会替换执行Invocation中的invoke方法</span>
        Person stuProxy = (Person) Proxy.<span class="hljs-built_in">newProxyInstance</span>(Person.<span class="hljs-keyword">class</span>.<span class="hljs-built_in">getClassLoader</span>(), <span class="hljs-keyword">new</span> Class&lt;?&gt;[]{Person.<span class="hljs-keyword">class</span>}, stuHandler)；

       <span class="hljs-comment">//代理执行上交班费的方法</span>
        stuProxy.<span class="hljs-built_in">giveMoney</span>();
    }
}
</code></pre>
<p>打印结果：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa81d8f790684a23833d46f6c2c6b331~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770349877&amp;x-signature=cjM1wJac6hu0dA%2BYGTdRc3m1Fq0%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-4">二.原理解析</h3>
<p>(1)通过构造者模式创建一个retrofit实例，配置baseUrl，OkHttpClient，CallAdapterFactory(Rxjava2CallAdapterFactory将代理返回的call对象转化为Observable对象), ConvertFactory（GsonConvertFactory将代理返回的请求的结果转化为javabean）</p>
<p>(2).通过retrofit对象的create（Class service）返回一个Service的动态代理对象，在调用Service的方法的时候，就是动态调用invoke方法,在Invoke方法中，调用loadServiceMethod(method)，在这个方法中会通过给method进行反射，解析注解，得到参数，请求头，请求地址，等等，构建Request请求所有需要的参数等，并提供toRequest()方法得到Request实例，然后构建OkHttpCall(servicMethod,args),通过
serviceMethod.callAdapter.adat(okHttpCall)，返回一个Observable或者是Call。</p>
<pre><code class="hljs language-scss" lang="scss">如果是Call&lt;T&gt; call；
call<span class="hljs-selector-class">.enqueue</span>( Callback&lt;T&gt; callback){
    Request request = serviceMethod<span class="hljs-selector-class">.toRequest</span>(args);
    okhttp3<span class="hljs-selector-class">.Call</span> call = serviceMethod<span class="hljs-selector-class">.callFactory</span><span class="hljs-selector-class">.newCall</span>(request);
}
如果是Observable&lt;T&gt; ,会调用subcribe添加观察者，实际会调用<span class="hljs-built_in">subscribeActual</span>(),在此方法中
observable<span class="hljs-selector-class">.subcribe</span>(new Observer(){}) <span class="hljs-comment">//添加观察者</span>
 <span class="hljs-comment">//Observable接口中的订阅方法</span>
  public final void <span class="hljs-built_in">subscribe</span>(Observer&lt;? super T&gt; observer) {
        ObjectHelper<span class="hljs-selector-class">.requireNonNull</span>(observer, "observer is null");
        try {
            observer = RxJavaPlugins<span class="hljs-selector-class">.onSubscribe</span>(this, observer);
            ObjectHelper<span class="hljs-selector-class">.requireNonNull</span>(observer, "Plugin returned null Observer");
            <span class="hljs-built_in">subscribeActual</span>(observer); <span class="hljs-comment">//调用该方法</span>
        } catch (NullPointerException e) { <span class="hljs-comment">// NOPMD</span>
            throw e;
        } catch (Throwable e) {  
        }
    }
<span class="hljs-comment">//CallEnqueueObservable中</span>
 protected void <span class="hljs-built_in">subscribeActual</span>(Observer&lt;? super Response&lt;T&gt;&gt; observer) {
    <span class="hljs-comment">// Since Call is a one-shot type, clone it for each new observer.</span>
    Call&lt;T&gt; call = originalCall<span class="hljs-selector-class">.clone</span>();
    CallCallback&lt;T&gt; callback = new CallCallback&lt;&gt;(call, observer);
    observer<span class="hljs-selector-class">.onSubscribe</span>(callback);
    call<span class="hljs-selector-class">.enqueue</span>(callback);<span class="hljs-comment">//执行OKHttpCall中的enqueue方法</span>
  }

</code></pre>
<p>(3).create()方法源码</p>
<pre><code class="hljs language-scss" lang="scss"> public &lt;T&gt; T <span class="hljs-built_in">create</span>(final Class&lt;T&gt; service) {
    Utils<span class="hljs-selector-class">.validateServiceInterface</span>(service);
    if (validateEagerly) {
      <span class="hljs-built_in">eagerlyValidateMethods</span>(service);
    }
    return (T) Proxy<span class="hljs-selector-class">.newProxyInstance</span>(service.getClassLoader(), new Class&lt;?&gt;<span class="hljs-selector-attr">[]</span> { service },
        new <span class="hljs-built_in">InvocationHandler</span>() {
          private final Platform platform = Platform<span class="hljs-selector-class">.get</span>();

          <span class="hljs-keyword">@Override</span> public Object invoke(Object proxy, Method method, <span class="hljs-keyword">@Nullable</span> Object[] args)
              throws Throwable {
            <span class="hljs-comment">// If the method is a method from Object then defer to normal invocation.</span>
            if (method.getDeclaringClass() == <span class="hljs-selector-tag">Object</span><span class="hljs-selector-class">.class</span>) {
              return method<span class="hljs-selector-class">.invoke</span>(this, args);
            }
            if (platform.isDefaultMethod(method)) {
              return platform<span class="hljs-selector-class">.invokeDefaultMethod</span>(method, service, proxy, args);
            }
            ServiceMethod&lt;<span class="hljs-selector-tag">Object</span>, <span class="hljs-selector-tag">Object</span>&gt; serviceMethod =
                (ServiceMethod&lt;Object, Object&gt;) <span class="hljs-built_in">loadServiceMethod</span>(method);
            OkHttpCall&lt;<span class="hljs-selector-tag">Object</span>&gt; okHttpCall = new OkHttpCall&lt;&gt;(serviceMethod, args);
            <span class="hljs-comment">/*   adapt方法中根据addCallAdapterFactory类型，如果是RxJava2CallAdapterFactory就返回 
                  Observable&lt;T&gt;, 如果不传，则返回Call&lt;T&gt;   */</span>
              return serviceMethod<span class="hljs-selector-class">.callAdapter</span><span class="hljs-selector-class">.adapt</span>(okHttpCall); 
          }
        });
  }

<span class="hljs-comment">//Retrofit中构造模式创建一个ServiceMethod对象</span>
  ServiceMethod&lt;?, ?&gt; <span class="hljs-built_in">loadServiceMethod</span>(Method method) {
    ServiceMethod&lt;?, ?&gt; result = serviceMethodCache<span class="hljs-selector-class">.get</span>(method);
    if (result != null) return result;
    synchronized (serviceMethodCache) {
      result = serviceMethodCache<span class="hljs-selector-class">.get</span>(method);
      if (result == null) {
 <span class="hljs-comment">// this表示Retrofit，retrofit里面持有baseUrl,okHttpClient,convertFactory,callAdapterFactory</span>
<span class="hljs-comment">//method通过反射，解析注解，得到参数，header,isMulpart,isbody,isFormUrlEncode等构建Request的</span>
<span class="hljs-comment">//必要参数，并提供toRequest()返回Reqeust对象.</span>
        result = new ServiceMethod<span class="hljs-selector-class">.Builder</span>&lt;&gt;(this, method)<span class="hljs-selector-class">.build</span>();
        serviceMethodCache<span class="hljs-selector-class">.put</span>(method, result);
      }
    }
    return result;
  }

  public ServiceMethod <span class="hljs-built_in">build</span>() {
      callAdapter = <span class="hljs-built_in">createCallAdapter</span>();
      responseType = callAdapter<span class="hljs-selector-class">.responseType</span>();
      if (responseType == Response.class || responseType == okhttp3.Response.class) {
        throw <span class="hljs-built_in">methodError</span>("'"
            + Utils.getRawType(responseType)<span class="hljs-selector-class">.getName</span>()
            + "' is not <span class="hljs-selector-tag">a</span> valid response <span class="hljs-selector-tag">body</span> type. Did you mean ResponseBody?");
      }
      responseConverter = <span class="hljs-built_in">createResponseConverter</span>();

      for (Annotation annotation : methodAnnotations) {
        <span class="hljs-built_in">parseMethodAnnotation</span>(annotation); <span class="hljs-comment">//</span>
      }

      if (httpMethod == null) {
        throw <span class="hljs-built_in">methodError</span>("HTTP method annotation is required (e.g., @GET, @POST, etc.).");
      }

      if (!hasBody) {
        if (isMultipart) {
          throw <span class="hljs-built_in">methodError</span>(
              "Multipart can only be specified on HTTP methods with request body (e.g., @POST).");
        }
        if (isFormEncoded) {
          throw <span class="hljs-built_in">methodError</span>("FormUrlEncoded can only be specified on HTTP methods with "
              + "request body (e.g., @POST).");
        }
      }

      int parameterCount = parameterAnnotationsArray<span class="hljs-selector-class">.length</span>;
      parameterHandlers = new ParameterHandler&lt;?&gt;<span class="hljs-selector-attr">[parameterCount]</span>;
      for (int p = <span class="hljs-number">0</span>; p &lt; parameterCount; p++) {
        Type parameterType = parameterTypes<span class="hljs-selector-attr">[p]</span>;
        if (Utils.hasUnresolvableType(parameterType)) {
          throw <span class="hljs-built_in">parameterError</span>(p, "Parameter type must not include a type variable or wildcard: %s",
              parameterType);
        }

        Annotation<span class="hljs-selector-attr">[]</span> parameterAnnotations = parameterAnnotationsArray<span class="hljs-selector-attr">[p]</span>;
        if (parameterAnnotations == null) {
          throw <span class="hljs-built_in">parameterError</span>(p, "No Retrofit annotation found.");
        }

        parameterHandlers<span class="hljs-selector-attr">[p]</span> = <span class="hljs-built_in">parseParameter</span>(p, parameterType, parameterAnnotations);
      }

      if (relativeUrl == null &amp;&amp; !gotUrl) {
        throw <span class="hljs-built_in">methodError</span>("Missing either @%s URL or @Url parameter.", httpMethod);
      }
      if (!isFormEncoded &amp;&amp; !isMultipart &amp;&amp; !hasBody &amp;&amp; gotBody) {
        throw <span class="hljs-built_in">methodError</span>("Non-body HTTP method cannot contain @Body.");
      }
      if (isFormEncoded &amp;&amp; !gotField) {
        throw <span class="hljs-built_in">methodError</span>("Form-encoded method must contain at least one @Field.");
      }
      if (isMultipart &amp;&amp; !gotPart) {
        throw <span class="hljs-built_in">methodError</span>("Multipart method must contain at least one @Part.");
      }

      return new ServiceMethod&lt;&gt;(this);
    }
 <span class="hljs-comment">/*解析注解得到构建RequestBuilder的核心参数httpMethod，baseUrl，relativeUrl, headers,
        contentType, hasBody, isFormEncoded, isMultipart */</span>

 private void <span class="hljs-built_in">parseMethodAnnotation</span>(Annotation annotation) {
      if (annotation instanceof DELETE) {
        <span class="hljs-built_in">parseHttpMethodAndPath</span>("DELETE", ((DELETE) annotation)<span class="hljs-selector-class">.value</span>(), false);
      } else if (annotation instanceof GET) {
        <span class="hljs-built_in">parseHttpMethodAndPath</span>("GET", ((GET) annotation)<span class="hljs-selector-class">.value</span>(), false);
      } else if (annotation instanceof HEAD) {
        <span class="hljs-built_in">parseHttpMethodAndPath</span>("HEAD", ((HEAD) annotation)<span class="hljs-selector-class">.value</span>(), false);
        if (!Void.class.equals(responseType)) {
          throw <span class="hljs-built_in">methodError</span>("HEAD method must use Void as response type.");
        }
      } else if (annotation instanceof PATCH) {
        <span class="hljs-built_in">parseHttpMethodAndPath</span>("PATCH", ((PATCH) annotation)<span class="hljs-selector-class">.value</span>(), true);
      } else if (annotation instanceof POST) {
        <span class="hljs-built_in">parseHttpMethodAndPath</span>("POST", ((POST) annotation)<span class="hljs-selector-class">.value</span>(), true);
      } else if (annotation instanceof PUT) {
        <span class="hljs-built_in">parseHttpMethodAndPath</span>("PUT", ((PUT) annotation)<span class="hljs-selector-class">.value</span>(), true);
      } else if (annotation instanceof OPTIONS) {
        <span class="hljs-built_in">parseHttpMethodAndPath</span>("OPTIONS", ((OPTIONS) annotation)<span class="hljs-selector-class">.value</span>(), false);
      } else if (annotation instanceof HTTP) {
        HTTP http = (HTTP) annotation;
        <span class="hljs-built_in">parseHttpMethodAndPath</span>(http.method(), http<span class="hljs-selector-class">.path</span>(), http<span class="hljs-selector-class">.hasBody</span>());
      } else if (annotation instanceof retrofit2.http.Headers) {
        String<span class="hljs-selector-attr">[]</span> headersToParse = ((retrofit2.http.Headers) annotation)<span class="hljs-selector-class">.value</span>();
        if (headersToParse.length == <span class="hljs-number">0</span>) {
          throw <span class="hljs-built_in">methodError</span>("@Headers annotation is empty.");
        }
        headers = <span class="hljs-built_in">parseHeaders</span>(headersToParse);
      } else if (annotation instanceof Multipart) {
        if (isFormEncoded) {
          throw <span class="hljs-built_in">methodError</span>("Only one encoding annotation is allowed.");
        }
        isMultipart = true;
      } else if (annotation instanceof FormUrlEncoded) {
        if (isMultipart) {
          throw <span class="hljs-built_in">methodError</span>("Only one encoding annotation is allowed.");
        }
        isFormEncoded = true;
      }
    }
</code></pre>
<p>(4).ServiceMethod中提供toRequest()生成Request.</p>
<pre><code class="hljs language-less" lang="less"> <span class="hljs-selector-tag">Request</span> <span class="hljs-selector-tag">toRequest</span>(<span class="hljs-variable">@Nullable</span> Object... args) <span class="hljs-selector-tag">throws</span> <span class="hljs-selector-tag">IOException</span> {
    <span class="hljs-selector-tag">RequestBuilder</span> <span class="hljs-selector-tag">requestBuilder</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">RequestBuilder</span>(httpMethod, baseUrl, relativeUrl, headers,
        contentType, hasBody, isFormEncoded, isMultipart);

    @<span class="hljs-selector-tag">SuppressWarnings</span>(<span class="hljs-string">"unchecked"</span>) <span class="hljs-comment">// It is an error to invoke a method with the wrong arg types.</span>
    <span class="hljs-selector-tag">ParameterHandler</span>&lt;<span class="hljs-selector-tag">Object</span>&gt;<span class="hljs-selector-attr">[]</span> <span class="hljs-selector-tag">handlers</span> = (ParameterHandler&lt;Object&gt;[]) <span class="hljs-selector-tag">parameterHandlers</span>;

    <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">argumentCount</span> = <span class="hljs-selector-tag">args</span> != <span class="hljs-selector-tag">null</span> ? <span class="hljs-selector-tag">args</span><span class="hljs-selector-class">.length</span> : <span class="hljs-number">0</span>;
    <span class="hljs-selector-tag">if</span> (argumentCount != handlers.length) {
      <span class="hljs-selector-tag">throw</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">IllegalArgumentException</span>(<span class="hljs-string">"Argument count ("</span> + argumentCount
          + <span class="hljs-string">") doesn't match expected count ("</span> + handlers.length + <span class="hljs-string">")"</span>);
    }

    <span class="hljs-selector-tag">for</span> (int p = <span class="hljs-number">0</span>; p &lt; argumentCount; p++) {
      <span class="hljs-selector-tag">handlers</span><span class="hljs-selector-attr">[p]</span><span class="hljs-selector-class">.apply</span>(requestBuilder, args[p]);
    }

    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">requestBuilder</span><span class="hljs-selector-class">.build</span>();
  }
</code></pre>
<p>(5).当我们获取到一个Observable，是如何触发OkHttpCall执行的呢？</p>
<pre><code class="hljs language-java" lang="java"> <span class="hljs-comment">//Observable接口中的订阅方法</span>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">subscribe</span><span class="hljs-params">(Observer&lt;? <span class="hljs-built_in">super</span> T&gt; observer)</span> {
        ObjectHelper.requireNonNull(observer, <span class="hljs-string">"observer is null"</span>);
        <span class="hljs-keyword">try</span> {
            observer = RxJavaPlugins.onSubscribe(<span class="hljs-built_in">this</span>, observer);
            ObjectHelper.requireNonNull(observer, <span class="hljs-string">"Plugin returned null Observer"</span>);
            subscribeActual(observer); <span class="hljs-comment">//调用该方法</span>
        } <span class="hljs-keyword">catch</span> (NullPointerException e) { <span class="hljs-comment">// NOPMD</span>
            <span class="hljs-keyword">throw</span> e;
        } <span class="hljs-keyword">catch</span> (Throwable e) {  
        }
    }
<span class="hljs-comment">//CallEnqueueObservable中</span>
 <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">subscribeActual</span><span class="hljs-params">(Observer&lt;? <span class="hljs-built_in">super</span> Response&lt;T&gt;&gt; observer)</span> {
    <span class="hljs-comment">// Since Call is a one-shot type, clone it for each new observer.</span>
    Call&lt;T&gt; call = originalCall.clone();
    CallCallback&lt;T&gt; callback = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CallCallback</span>&lt;&gt;(call, observer);
    observer.onSubscribe(callback);
    call.enqueue(callback);<span class="hljs-comment">//执行OKHttpCall中的enqueue方法</span>
  }

 <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">enqueue</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Callback&lt;T&gt; callback)</span> {
        okhttp3.Call call;
     <span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> serviceMethod.toRequest(args);
    <span class="hljs-comment">//执行Request请求.</span>
    okhttp3.<span class="hljs-type">Call</span>   <span class="hljs-variable">call</span> <span class="hljs-operator">=</span> serviceMethod.callFactory.newCall(request); <span class="hljs-comment">//callFactory就是OkHttpClient实例</span>
  }
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Handler消息传递机制]]></title>    <link>https://juejin.cn/post/7600681071714779136</link>    <guid>https://juejin.cn/post/7600681071714779136</guid>    <pubDate>2026-01-30T03:53:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600681071714779136" data-draft-id="7600728866756526132" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Handler消息传递机制"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-30T03:53:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Asmewill"/> <meta itemprop="url" content="https://juejin.cn/user/3139860938370557"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Handler消息传递机制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3139860938370557/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Asmewill
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T03:53:44.000Z" title="Fri Jan 30 2026 03:53:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.jianshu.com%2Fp%2Ff10cff5b4c25" target="_blank" title="https://www.jianshu.com/p/f10cff5b4c25" ref="nofollow noopener noreferrer">Android消息机制的原理及源码解析 - 简书 (jianshu.com)</a></p>
<p><a href="https://juejin.cn/post/6844903446571663374" target="_blank" title="https://juejin.cn/post/6844903446571663374">Android Handler 消息机制（解惑篇）</a></p>
<p><a href="https://juejin.cn/post/6844903783139393550" target="_blank" title="https://juejin.cn/post/6844903783139393550">Handler 都没搞懂，拿什么去跳槽啊？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fguolin_blog%2Farticle%2Fdetails%2F9991569" target="_blank" title="https://blog.csdn.net/guolin_blog/article/details/9991569" ref="nofollow noopener noreferrer">郭霖 android异步消息处理机制完全解</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c24abdb3f3c64601afed561a7eace259~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770350024&amp;x-signature=vVMJsx8j5D1F2%2BkOy0gRwA2xZso%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-0">1.ActivityThread.main</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        Looper.prepareMainLooper(); 
        <span class="hljs-type">ActivityThread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ActivityThread</span>();
        thread.attach(<span class="hljs-literal">false</span>, startSeq);<span class="hljs-comment">//把ApplicationThread对象给到AMS</span>
        Looper.loop(); 
  }

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">prepareMainLooper</span><span class="hljs-params">()</span> {
        prepare(<span class="hljs-literal">false</span>);
        <span class="hljs-keyword">synchronized</span> (Looper.class) {
            <span class="hljs-keyword">if</span> (sMainLooper != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"The main Looper has already been prepared."</span>);
            }
            sMainLooper = myLooper();
        }
 }
<span class="hljs-comment">//新建Looper对象，并在构造方法中新建MessageQueue对象，把Looper对象放到存放到ThreadLocal类所在的ThreadMap中，以当前线程为key，Looper对象为值进行存储。</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">prepare</span><span class="hljs-params">(<span class="hljs-type">boolean</span> quitAllowed)</span> {
        <span class="hljs-keyword">if</span> (sThreadLocal.get() != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Only one Looper may be created per thread"</span>);
        }
        sThreadLocal.set(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Looper</span>(quitAllowed));
 }
<span class="hljs-keyword">private</span> <span class="hljs-title function_">Looper</span><span class="hljs-params">(<span class="hljs-type">boolean</span> quitAllowed)</span> {
      mQueue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageQueue</span>(quitAllowed);
      mThread = Thread.currentThread();
}
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(T value)</span> {
        <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();
        <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);
        <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>)
            map.set(<span class="hljs-built_in">this</span>, value);
        <span class="hljs-keyword">else</span>
            createMap(t, value);
 }
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-meta">@Nullable</span> Looper <span class="hljs-title function_">myLooper</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sThreadLocal.get();
}
<span class="hljs-keyword">public</span> T <span class="hljs-title function_">get</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();
        <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);
        <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>) {
            ThreadLocalMap.<span class="hljs-type">Entry</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> map.getEntry(<span class="hljs-built_in">this</span>);
            <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span>) {
                <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
                <span class="hljs-type">T</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> (T)e.value;
                <span class="hljs-keyword">return</span> result;
            }
        }
        <span class="hljs-keyword">return</span> setInitialValue();
}

</code></pre>
<h3 data-id="heading-1">2.Handler的基本用法</h3>
<pre><code class="hljs language-scss" lang="scss">Handler handler=new <span class="hljs-built_in">Handler</span>(){  
    public  void <span class="hljs-built_in">handleMessage</span>(Message msg){
           <span class="hljs-comment">//接收并处理消息</span>
   }
}
handler<span class="hljs-selector-class">.post</span>(runnable)；
handler<span class="hljs-selector-class">.sendMessage</span>(msg)；
</code></pre>
<h3 data-id="heading-2">3.Hanlder和Looper进行关联</h3>
<p>Handler构造方法，通过myLooper方法从ThreadLocal所在的ThreadMap中，根据当前的线程（作为key值）从ThreadMap中Looper对象，根据Looper对象得到MessageQueue对象，便于Handler发送消息时，可以把消息添加到MessageQueue对象中.</p>
<pre><code class="hljs language-ini" lang="ini">public Handler(Callback callback,boolean async){
         <span class="hljs-attr">mLooper</span>=Looper.myLooper()<span class="hljs-comment">;</span>
         <span class="hljs-attr">mQueue</span>=mLooper.mQueue<span class="hljs-comment">;</span>
}
</code></pre>
<h3 data-id="heading-3">4.Handler.sendMessage或者Handler.post(runable)解析</h3>
<p>(1).Hanlder.post也是runnable封装成Message对象</p>
<pre><code class="hljs language-java" lang="java"> <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">post</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Runnable r)</span> {
       <span class="hljs-keyword">return</span>  sendMessageDelayed(getPostMessage(r), <span class="hljs-number">0</span>);
 }
 <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Message <span class="hljs-title function_">getPostMessage</span><span class="hljs-params">(Runnable r)</span> {
        <span class="hljs-type">Message</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> Message.obtain();
        m.callback = r;
        <span class="hljs-keyword">return</span> m;
}
</code></pre>
<p>(2).Handler.sendMessage最终会把消息添加到消息队列</p>
<pre><code class="hljs language-less" lang="less"> <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">boolean</span> <span class="hljs-selector-tag">sendMessage</span>(<span class="hljs-variable">@NonNull</span> Message msg) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">sendMessageDelayed</span>(msg, <span class="hljs-number">0</span>);
}
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">boolean</span> <span class="hljs-selector-tag">sendMessageDelayed</span>(<span class="hljs-variable">@NonNull</span> Message msg, long delayMillis) {
        <span class="hljs-selector-tag">if</span> (delayMillis &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-selector-tag">delayMillis</span> = <span class="hljs-number">0</span>;
        }
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">sendMessageAtTime</span>(msg, SystemClock.<span class="hljs-built_in">uptimeMillis</span>() + delayMillis);
 }
 <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">boolean</span> <span class="hljs-selector-tag">sendMessageAtTime</span>(<span class="hljs-variable">@NonNull</span> Message msg, long uptimeMillis) {
        <span class="hljs-selector-tag">MessageQueue</span> <span class="hljs-selector-tag">queue</span> = <span class="hljs-selector-tag">mQueue</span>;
        <span class="hljs-selector-tag">if</span> (queue == null) {
            <span class="hljs-selector-tag">RuntimeException</span> <span class="hljs-selector-tag">e</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">RuntimeException</span>(
                    this + <span class="hljs-string">" sendMessageAtTime() called with no mQueue"</span>);
            <span class="hljs-selector-tag">Log</span><span class="hljs-selector-class">.w</span>(<span class="hljs-string">"Looper"</span>, e.<span class="hljs-built_in">getMessage</span>(), e);
            <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">false</span>;
        }
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">enqueueMessage</span>(queue, msg, uptimeMillis);
    }
 <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">boolean</span> <span class="hljs-selector-tag">enqueueMessage</span>(<span class="hljs-variable">@NonNull</span> MessageQueue queue, <span class="hljs-variable">@NonNull</span> Message msg,
            long uptimeMillis) {
        <span class="hljs-selector-tag">msg</span><span class="hljs-selector-class">.target</span> = <span class="hljs-selector-tag">this</span>;
        <span class="hljs-selector-tag">msg</span><span class="hljs-selector-class">.workSourceUid</span> = <span class="hljs-selector-tag">ThreadLocalWorkSource</span><span class="hljs-selector-class">.getUid</span>();

        <span class="hljs-selector-tag">if</span> (mAsynchronous) {
            <span class="hljs-selector-tag">msg</span><span class="hljs-selector-class">.setAsynchronous</span>(true);
        }
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">queue</span><span class="hljs-selector-class">.enqueueMessage</span>(msg, uptimeMillis);
    }
</code></pre>
<h3 data-id="heading-4">5.Looper.loop开启死循环</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//Looper</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loop</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">final</span> <span class="hljs-type">Looper</span> <span class="hljs-variable">me</span> <span class="hljs-operator">=</span> myLooper();
    <span class="hljs-keyword">if</span> (me == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"No Looper; Looper.prepare() wasn't called on this thread."</span>);
    }
    <span class="hljs-keyword">final</span> <span class="hljs-type">MessageQueue</span> <span class="hljs-variable">queue</span> <span class="hljs-operator">=</span> me.mQueue;
    <span class="hljs-keyword">for</span> (;;) {
       <span class="hljs-comment">// 不断从 MessageQueue 获取 消息</span>
        <span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> queue.next(); <span class="hljs-comment">// might block</span>
        <span class="hljs-comment">//退出 Looper </span>
        <span class="hljs-keyword">if</span> (msg == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">try</span> {
            msg.target.dispatchMessage(msg);<span class="hljs-comment">// msg.target就是Handler</span>
            end = (slowDispatchThresholdMs == <span class="hljs-number">0</span>) ? <span class="hljs-number">0</span> : SystemClock.uptimeMillis();
        } <span class="hljs-keyword">finally</span> {
        }
    }
}
</code></pre>
<h3 data-id="heading-5">6.Handler.dispatchMessage</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">//Handler</span>
public void <span class="hljs-built_in">dispatchMessage</span>(Message msg) {
  <span class="hljs-comment">//msg.callback 是 Runnable ，如果是 post方法则会走这个 if</span>
  if (msg.callback != null) {
    <span class="hljs-built_in">handleCallback</span>(msg);
  } else {
    <span class="hljs-comment">//callback 见【3.4】</span>
    if (mCallback != null) {
      if (mCallback.handleMessage(msg)) {
        return;
      }
    }
    <span class="hljs-comment">//回调到 Handler 的 handleMessage 方法</span>
    <span class="hljs-built_in">handleMessage</span>(msg);
  }
}
</code></pre>
<h3 data-id="heading-6">7.Handler延伸</h3>
<p>(1).为什么主线程不会因为Looper.loop()里面的死循环卡死？
handler机制是使用Linux管道来实现的，主线程没有消息处理时，也就是当queue.next获取消息时，
nativePollOnce，底层阻塞在管道读取端，主线程进入休眠状态，释放CPU资源，而不会一直去执行for循环，直到，MsgQueue里面有消息被添加进来，调用nativeWake()，底层管道写端写入数据，唤醒主线线程.
(2).Hanlder引起的内存泄漏原因以及最佳解决方案。
Handler允许我们发送延迟消息，如果在延时期间，用户关闭了Activity,那么Activity会泄露。
原因：Message（target）持有Handler,Handler作为内部类，持有外部类Activity,最终导致Activity内存泄漏。
解决该问题最有效的方法是：将Handler定义为静态内部类，在内部持有Activity的弱引用，并及时移除所有消息。</p>
<pre><code class="hljs language-scala" lang="scala">public static <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SafeHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Handler</span></span>{
        <span class="hljs-keyword">private</span> <span class="hljs-type">WeakReference</span>&lt;<span class="hljs-type">HandleActivity</span>&gt; ref;
        public <span class="hljs-type">SafeHandler</span>(<span class="hljs-type">HandlerActivity</span> activity){
                ref=<span class="hljs-keyword">new</span> <span class="hljs-type">WeakReference</span>&lt;<span class="hljs-type">HandleActivity</span>&gt;(activity);
        }
       public void handleMessage(<span class="hljs-keyword">final</span> <span class="hljs-type">Message</span> mes){
              <span class="hljs-type">HandleActivity</span> activity=ref.get();
              <span class="hljs-keyword">if</span>(activity!=<span class="hljs-literal">null</span>){
                   activity.handleMessage(msg);
              }
      }
}
</code></pre>
<p>(3).子线程里面如何使用Handler</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">new</span> Thread(<span class="hljs-keyword">new</span> Runnable(){
      <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span>()</span>{
           <span class="hljs-comment">//新建一个Looper对象，把当期线程作为key值，存储到ThreadLocal类中的ThreadLocalMap中.</span>
          Looper.prepare();
       <span class="hljs-comment">//构造方法中根据当期线程，得到Looper对象,然后从Looper对象得到MsgQueue</span>
          Handler handler=<span class="hljs-keyword">new</span> Handler();
          handler.post(<span class="hljs-keyword">new</span> Runable(){ 
                <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span>()</span> {
                    <span class="hljs-comment">// 在这里执行你需要在子线程中完成的任务</span>
                }
          });
        <span class="hljs-comment">//启动消息循环</span>
        Looper.loop();
      }
}).start();
</code></pre>
<p>(4).在子线程中进行UI操作的方式.
Handler.post(runnable)
View.post
Activity.runOnUiThread</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Runloop的无限循环]]></title>    <link>https://juejin.cn/post/7600791597169180715</link>    <guid>https://juejin.cn/post/7600791597169180715</guid>    <pubDate>2026-01-30T04:20:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600791597169180715" data-draft-id="7600728866756706356" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Runloop的无限循环"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-30T04:20:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="betcha0724"/> <meta itemprop="url" content="https://juejin.cn/user/1757471366985452"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Runloop的无限循环
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1757471366985452/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    betcha0724
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T04:20:22.000Z" title="Fri Jan 30 2026 04:20:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>不是说runloop是无限循环吗，为啥主线程还会休眠？</p>
</blockquote>
<p><strong>Runloop 的 “无限循环” 和 “休眠” 并不矛盾</strong>，反而这两个特性是 Runloop 设计的核心精髓 ——<strong>Runloop 的无限循环是 “带休眠的循环”，不是空转的死循环</strong>，休眠正是为了让无限循环不消耗多余资源。</p>
<p>简单说结论：<strong>主线程 Runloop 的 while (1) 是 “逻辑上的无限循环”，但循环内部会主动触发线程休眠，直到有事件唤醒才继续执行循环体，而非一直空转执行代码</strong>。</p>
<h3 data-id="heading-0">一、先破误区：“无限循环”≠“一直执行代码”</h3>
<p>普通的空转死循环是这样的（会把 CPU 占满）：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 纯空转死循环：CPU 100%占用，线程一直跑</span>
<span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) {
    <span class="hljs-comment">// 什么都不做，持续循环</span>
}
</code></pre>
<p>而<strong>Runloop 的无限循环是 “智能循环”</strong> ，伪代码更接近这样：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// Runloop的无限循环：有任务就执行，无任务就休眠</span>
<span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) {
    <span class="hljs-comment">// 1. 检查是否有待处理的事件/任务</span>
    <span class="hljs-keyword">if</span> (有任务) {
        处理任务（事件、渲染、回调等）;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 2. 无任务时，让线程进入「休眠状态」，释放CPU资源</span>
        内核层面让线程休眠，等待唤醒信号;
    }
}
</code></pre>
<p>Runloop 的 “无限” 体现在<strong>这个 while (1) 的逻辑永远不退出</strong>（主线程 Runloop 默认永不停止），但 ** 循环体的执行是 “按需触发”** 的 —— 无任务时根本不执行循环体的核心逻辑，而是让线程休眠。</p>
<h3 data-id="heading-1">二、关键原理：Runloop 如何实现 “休眠 - 唤醒”（内核层面）</h3>
<p>Runloop 的休眠不是自己实现的，而是基于<strong>操作系统内核的 IO 多路复用机制</strong>（iOS/macOS 下是<code>mach_msg</code>，底层封装了 select/poll/kqueue），这是跨平台事件驱动的通用方案，核心流程分 3 步：</p>
<ol>
<li><strong>无任务时，Runloop 调用<code>mach_msg</code>向内核发送 “休眠请求”</strong> ：主线程会从<strong>运行态</strong>切换为<strong>休眠态</strong>（也叫等待态），此时线程不会占用 CPU 的任何时间片，CPU 可以去处理其他线程 / 进程的任务，资源消耗几乎为 0；</li>
<li><strong>有事件时，内核主动唤醒线程</strong>：当有能唤醒 Runloop 的事件出现时（如 CADisplayLink 刷新、触摸事件、网络回调、定时器），<strong>内核会向该线程发送唤醒信号</strong>，触发<code>mach_msg</code>返回，线程从休眠态切回运行态；</li>
<li><strong>唤醒后继续执行循环体</strong>：Runloop 接收到唤醒信号后，继续执行 while (1) 的循环体，处理对应的任务，完成后再次检查是否有新任务，无任务则再次休眠。</li>
</ol>
<p><strong>对主线程来说</strong>：CADisplayLink（屏幕刷新定时器）是<strong>最常见的唤醒源</strong>（60Hz 下 16.67ms 唤醒一次），其次是用户的触摸、滑动等 UI 事件。</p>
<h3 data-id="heading-2">三、结合帧渲染理解：休眠 - 唤醒 - 渲染的完整循环（60Hz）</h3>
<p>把 Runloop 的休眠、唤醒和帧渲染结合，<strong>主线程的完整工作流程</strong>就非常清晰了（无其他 UI 事件时）：</p>
<ol>
<li>
<p><strong>休眠阶段</strong>：主线程 Runloop 无任务，调用<code>mach_msg</code>进入休眠，CPU 释放；</p>
</li>
<li>
<p><strong>定时唤醒</strong>：16.67ms 后，CADisplayLink 触发，内核唤醒主线程，Runloop 的 while (1) 继续执行；</p>
</li>
<li>
<p><strong>任务检查</strong>：Runloop 检查是否有 UI 更新标记（CATransaction）；</p>
<ul>
<li>✅<strong>有更新</strong>：执行布局→绘制→合成→显示的一帧渲染流程，完成后再次检查无新任务，进入休眠；</li>
<li>❌<strong>无更新</strong>：直接跳过渲染阶段，再次调用<code>mach_msg</code>进入休眠；</li>
</ul>
</li>
<li>
<p><strong>重复循环</strong>：每 16.67ms 被 CADisplayLink 唤醒一次，重复上述步骤。</p>
</li>
</ol>
<h3 data-id="heading-3">四、额外补充：为什么 Runloop 要设计 “休眠” 机制？</h3>
<p>如果主线程 Runloop 的无限循环<strong>没有休眠</strong>，而是一直空转检查任务，会导致两个严重问题：</p>
<ol>
<li><strong>CPU 占用率飙升</strong>：一个空转的 while (1) 会把单个 CPU 核心占满（100%），主线程是核心线程，会直接导致设备发热、耗电、卡顿；</li>
<li><strong>系统资源浪费</strong>：CPU 一直被 Runloop 的空转占用，无法分配给其他线程 / 进程（如后台网络、音频播放），整个 APP 的运行效率会大幅降低。</li>
</ol>
<p>而<strong>休眠机制</strong>完美解决了这两个问题：无任务时线程不占 CPU，有任务时及时唤醒，实现了 <strong>“按需执行，资源最优”</strong>，这也是 Runloop 能成为 iOS 事件驱动核心的关键原因。</p>
<h3 data-id="heading-4">最终一句话总结</h3>
<p>主线程 Runloop 是<strong>逻辑上的无限循环</strong>（while (1) 永不退出），但<strong>物理上的执行是按需的</strong>—— 无任务时通过内核让线程休眠，有事件（如屏幕刷新、UI 触摸）时被唤醒继续执行循环体，休眠和无限循环是 Runloop 的两个核心特性，而非矛盾点。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[主线程Runloop]]></title>    <link>https://juejin.cn/post/7600710943250579498</link>    <guid>https://juejin.cn/post/7600710943250579498</guid>    <pubDate>2026-01-30T04:23:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600710943250579498" data-draft-id="7600704706551185448" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="主线程Runloop"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-30T04:23:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="betcha0724"/> <meta itemprop="url" content="https://juejin.cn/user/1757471366985452"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            主线程Runloop
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1757471366985452/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    betcha0724
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T04:23:55.000Z" title="Fri Jan 30 2026 04:23:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>Runloop循环的代码，不是在主线程上运行的吗</p>
</blockquote>
<p><strong>Runloop 的这个无限循环代码，就是直接运行在主线程上的</strong>，这是核心关键 ——<strong>主线程的本质，就是执行 Runloop 无限循环的线程</strong>，二者是完全绑定的，不存在 “Runloop 循环在其他线程，主线程做别的事” 的情况。</p>
<h3 data-id="heading-0">一、先明确核心对应关系</h3>
<p>iOS 中<strong>主线程的入口函数</strong>，最终就是启动 Runloop 的无限循环，伪代码的对应关系是：</p>
<pre><code class="hljs language-plaintext" lang="plaintext">// 主线程的入口（UIApplicationMain函数底层）
int main(int argc, char * argv[]) {
    @autoreleasepool {
        // 1. 初始化UIApplication、AppDelegate等核心对象
        // 2. 启动「主线程的Runloop」，执行无限循环
        CFRunLoopRunMain(); // 这个函数内部，就是Runloop的while(1)无限循环
        return UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class]));
    }
}
</code></pre>
<p>简单说：<strong>主线程启动后，唯一的核心工作就是执行 Runloop 的无限循环</strong>，主线程的所有任务（UI 事件、渲染、定时器、网络回调等），都<strong>必须在这个循环体内部执行</strong>。</p>
<h3 data-id="heading-1">二、关键：“主线程执行 Runloop 循环” 的具体含义</h3>
<p>你可以把<strong>主线程</strong>理解为<strong>一个 “执行代码的容器”</strong> ，把<strong>Runloop 的 while (1)<strong>理解为</strong>这个容器里永远在运行的 “主程序”</strong> ——</p>
<ol>
<li>主线程被创建后，立刻加载并执行 Runloop 的无限循环代码；</li>
<li>这个循环代码<strong>霸占了主线程的执行权</strong>，主线程后续所有的操作，都是<strong>在这个循环体的内部</strong>被触发和执行的（比如处理触摸事件、执行帧渲染、调用你的业务代码）；</li>
<li>只要 Runloop 的循环不退出，主线程就会一直存活（APP 前台运行时，主线程 Runloop 永不退出）；如果循环退出，主线程就会执行完毕并销毁（APP 退出时才会发生）。</li>
</ol>
<h3 data-id="heading-2">三、结合 “休眠” 再理解：主线程休眠 = Runloop 循环暂停</h3>
<p>之前说的<strong>Runloop 让线程休眠</strong>，本质就是<strong>让主线程本身进入休眠态</strong>：</p>
<ul>
<li>当 Runloop 执行到<code>mach_msg</code>（内核休眠接口）时，<strong>主线程</strong>会从<strong>运行态</strong>切换为<strong>休眠态</strong>，此时主线程不再执行任何代码（包括 Runloop 的循环体），CPU 也会释放；</li>
<li>当内核收到唤醒信号（如 CADisplayLink、触摸事件），会把<strong>主线程</strong>切回<strong>运行态</strong>，Runloop 的 while (1) 循环会继续执行后续的任务处理、渲染等逻辑。</li>
</ul>
<p><strong>一句话讲清</strong>：Runloop 的循环代码是主线程的 “核心程序”，主线程的生命周期和 Runloop 的循环绑定，Runloop 的休眠 / 唤醒就是主线程的休眠 / 唤醒。</p>
<h3 data-id="heading-3">四、再补一个易混点：主线程的任务，都在 Runloop 循环体内执行</h3>
<p>你在主线程写的所有代码（比如<code>viewDidLoad</code>、按钮点击事件、<code>dispatch_async(dispatch_get_main_queue(), ^{...})</code>），<strong>都不是直接 “塞” 到主线程</strong>，而是<strong>被加入到 Runloop 的任务队列中</strong>，等待 Runloop 的循环体执行到对应阶段时，再被主线程执行。</p>
<p>举个例子，按钮点击的执行流程：</p>
<ol>
<li>点击按钮，系统将 “点击事件” 加入<strong>主线程 Runloop 的事件队列</strong>；</li>
<li>内核唤醒主线程，Runloop 的 while (1) 循环继续执行；</li>
<li>Runloop 从事件队列中取出 “点击事件”，<strong>让主线程执行</strong>你写的点击回调代码；</li>
<li>回调执行完毕，Runloop 检查是否有 UI 更新 / 其他任务，无则让主线程再次休眠。</li>
</ol>
<h3 data-id="heading-4">最终总结</h3>
<ol>
<li>Runloop 的无限循环<strong>直接运行在主线程</strong>，是主线程的核心执行代码；</li>
<li>主线程的生命周期与 Runloop 循环绑定，循环不退出，主线程就一直存活；</li>
<li>Runloop 的 “休眠 / 唤醒” 就是<strong>主线程</strong>的休眠 / 唤醒，无任务时主线程休眠，有任务时被唤醒执行循环体；</li>
<li>主线程的所有任务（包括你的业务代码、UI 渲染、事件处理），都<strong>在 Runloop 循环体内部</strong>被执行。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Clawdbot 8万Star的背后：AI 助理真的来了么（附macOS本地尝鲜教程-有手就行版）]]></title>    <link>https://juejin.cn/post/7600665529112821760</link>    <guid>https://juejin.cn/post/7600665529112821760</guid>    <pubDate>2026-01-30T02:51:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600665529112821760" data-draft-id="7600670417858265122" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Clawdbot 8万Star的背后：AI 助理真的来了么（附macOS本地尝鲜教程-有手就行版）"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2026-01-30T02:51:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="灵臂Lybic"/> <meta itemprop="url" content="https://juejin.cn/user/1417690301865552"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Clawdbot 8万Star的背后：AI 助理真的来了么（附macOS本地尝鲜教程-有手就行版）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1417690301865552/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    灵臂Lybic
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-30T02:51:56.000Z" title="Fri Jan 30 2026 02:51:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<p>从 Chat 到 Action，AI 正在接管我们的屏幕。但在一周 8 万 Star 的狂欢背后，爆火的应用与脆弱的安全性之间，正横亘着一道待解的基础设施鸿沟。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15998162f6c34964b703a4fb49f635ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54G16IeCTHliaWM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346320&amp;x-signature=noBtFuJJ9rr3%2F6QJwSRl6GOyDq0%3D" alt="图片" loading="lazy"/>​</p>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h2 data-id="heading-0"><strong><strong>流量高地与范式转移：</strong> <strong>从“对话”到“实战”</strong></strong></h2>
<p>这几天 Clawdbot 的出圈速度很夸张。社区里最直观的信号是 GitHub star 曲线在短时间内冲到数万量级，很多讨论甚至直接把它当作“2026 开源增长最快的现象级项目之一”。 更戏剧化的是，它还带出了一个“周边行情”：大量开发者开始用 Mac mini 这类小主机来常驻运行，从而实现一个 7×24h 永不下班的“核动力牛马”，甚至出现“下单截图刷屏”“卖断货”的情况。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d94f94fd53b40efa069f818148bd9c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54G16IeCTHliaWM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346320&amp;x-signature=PEEck9K8aBf3q%2FZeFNik6GA93hU%3D" alt="图片" loading="lazy"/>​</p>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>Clawdbot 现在官方名字是 Moltbot，比较有意思的是，改名的原因是因为 Anthropic 认为 Clawdbot 这个名字太容易被市场误解为Claude Code的延展产品，所以提出了抗议，创始人“被迫”宣布改名。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a02a40ea8b8466b82a0e0852672df01~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54G16IeCTHliaWM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346320&amp;x-signature=RyMiNtpMnKlgolDQOTFq53Q%2FnaI%3D" alt="图片" loading="lazy"/>​</p>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>它的定位非常清晰：一个你自己运行的个人 AI 助手，驻扎在你已经在用的聊天渠道里，比如 WhatsApp、 Telegram、 Slack、 Discord、 Google Chat、 Signal、 iMessage、 Microsoft Teams、 WebChat 等，同时支持在 macOS、iOS、Android 上交互，并提供一个可控的 Canvas 界面。 这套“入口在聊天里，执行在你自己的环境里”的组合，就这样魔幻而又切切实实的爆火了。</p>
<p>为什么这类东西会一波接一波地爆火？从最近一段时间的产品形态看，确实有个明显的风向在强化：大众的注意力正在从“对话型”迁移到“实操型”。对话给的是答案，实操给的是结果。对绝大多数人来说，后者更像他们心里对“AI 助理”的默认想象，这一点在 Clawdbot 的传播中被放大得很充分。</p>
<p><strong><strong>沸腾后的冷思考</strong></strong></p>
<p><strong><strong>是技术奇点，还是“时势英雄”？</strong></strong></p>
<p>不过这里也值得降降温。爆火当然意味着能力点戳中了人心，但它同样蕴含着几件事叠加：创作者本身的影响力与信用积累，以及社交平台的流量机制、AI时代的掉队焦虑，共同把某个叙事推到最大音量。你不需要把每一次“现象级”都理解成行业天翻地覆。更像是时势推着一个正确方向的样品突然被看见了，然后所有人的情绪一起涌上来。</p>
<p>再说体验层面的“落差”。很多人上手后会发现，它没有想象中那么万能，这其实并不意外。因为这类个人 Agent 往往把“连接器很多”“能动手”放在第一优先级，工程细节与产品打磨会滞后，早期 UI 小问题、流程不顺手、边界场景翻车都很常见。更关键的一点在成本。只要你把它当作“经常在线的执行型助理”，模型调用和工具链路的成本就会从偶发费用变成持续开销，近几天已经陆续看到网上有人晒图仅仅使用十几个小时，就已经消耗了上百美金的token。很多用户会自然滑向一种状态：好玩大于好用，体验大于实用。</p>
<p>真正值得认真讨论的，是它爆火后暴露出来的“安全现实”。Clawdbot 的卖点之一就是更本地化，更可控，更接近你的真实环境，它也确实会涉及对本地 shell、文件系统、浏览器等能力的调用与编排。 这让它强大，也让它变得危险。由于它拥有极高的系统权限。大部分用户担心 AI 误操作导致主力机数据受损，或是隐私信息泄露，被迫选择了“物理隔离”——用一台专门的硬件来承载这个不确定的“执行者”。</p>
<p>这也解释了另一个看似荒诞的现象：Clawdbot 带动了 Mac mini 等小主机被抢购。很多人把它解读为“性能需求”，但更底层的心理动因往往是“把东西放在自己手里更安心”。 你会发现，这里面其实同时包含了信任与不信任。信任的是我愿意让它替我做事，不信任的是我不想把自己的数据和权限直接丢进不可控的黑盒里。</p>
<h2 data-id="heading-1"><strong><strong>数据安全是“执行权”的护城河</strong></strong></h2>
<p>同样，GUI Agent（具备图形界面操作能力的智能体）作为一个实操型的技术路线，也具备巨大的想象和成长空间。</p>
<p>例如前段时间爆火出圈的豆包手机、Open-AutoGLM 等，它可以完成跨 App 的复杂长链路任务，但其权限的边界与数据安全的保障，将决定它是“神助攻”还是“定时炸弹”。这正是灵臂 Lybic 的出发点之一。</p>
<p>GUI Agent 之所以想象空间更大，因为它天然能覆盖那些没有标准 API 的存量软件和复杂流程。可它也天然更危险，因为它同样处在高权限的边缘，出错时的破坏半径更接近真实世界。把这一类能力推向大众之前，一个更稳妥的路径是先把“执行空间”变成默认护栏。</p>
<p>这也是 Lybic 想做的事之一。我们把“能不能做”之外的三件事放在同等重要的位置：隔离、可见、可止损。让模型或 Agent 在云端沙盒里执行 GUI 任务，你可以实时看到它在做什么，发现不对可以随时人工接管，任务结束可以销毁环境。这样一来，创新速度可以继续加快，试错成本被关在可控范围里，真实设备和真实数据少承担一些不必要的风险。</p>
<h2 data-id="heading-2"><strong>写在最后</strong></h2>
<p>Clawdbot 的爆火更像一个信号：实操型 AI 正在成为默认的大众期待。然而技术的热度终会回归工程的理性，接下来决定它们能不能长期留下来的，往往不是演示有多酷，而是执行边界有没有被认真设计。我们更愿意把这当作一个行业共同要补的基础课。让 AI 去做事之前，先给它一个合适的“房间”，再谈把它放进真实世界。</p>
<p><strong>附macOS部署教程</strong></p>
<p>首先打开终端运行一串神秘小代码（前提是确保node.js版本大于22）</p>
<pre><code class="hljs language-arduino" lang="arduino">curl -fsSL https:<span class="hljs-comment">//molt.bot/install.sh | bash -s -- --install-method git</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>静待下载安装完毕后，继续运行</p>
<pre><code class="hljs language-css" lang="css">moltbot onboard <span class="hljs-attr">--install-daemon</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>然后就会看到如下界面，那么恭喜你已经成功部署了Moltbot！教程到此结束（bushi）</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1097b27237242dcafe8377043e3555e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54G16IeCTHliaWM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346320&amp;x-signature=XGwxZVKciWwzW0pb%2F1%2BK%2BhQn02M%3D" alt="图片" loading="lazy"/>​</p>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>言归正传，官方在这里也是做出了风险提示。正如上文中所说，moltbot拥有着极大的系统权限，（同时也意味着极大的风险，强烈建议使用备用机安装），所以这里选 yes，因为不选 yes 没法进行下一步，没错官方就是这么霸道。</p>
<p>接下来根据界面提示，选择自己中意的大模型接入，我们这里选择了智谱的GLM 4.7。API key可以到对应的官网去购买/申请。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/421a4080362a4aa78496e2fe0a855c6f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54G16IeCTHliaWM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346320&amp;x-signature=4%2FZky44kLBm6XBqFyAmeB6Qs11I%3D" alt="图片" loading="lazy"/>​</p>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>鉴于我们是本地尝鲜版，为了简化流程，这里选择跳过。后续我们也会尝试去适配飞书或QQ。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d2654c43a034793b65af6396148635d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54G16IeCTHliaWM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346320&amp;x-signature=knMeNBxNzVs1OY1gb8U479kLB9U%3D" alt="图片" loading="lazy"/>​</p>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>选择想装的skill，空格进行选中，回车确认后会自动安装</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ceb53744214446388db853a9b71a606f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54G16IeCTHliaWM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346320&amp;x-signature=hOEEfDyqULzBBeSPZlw1YqU1JBs%3D" alt="图片" loading="lazy"/>​</p>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>再之后是各种接口设置，偷懒可以都跳过</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1106722b50e947cfb0aee1d56a84149c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54G16IeCTHliaWM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346320&amp;x-signature=e6fa0aJMCffrCdHi6SMZTXiWTiQ%3D" alt="图片" loading="lazy"/>​</p>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>接下来是hooks设置，可以按需选择，三个选项对应的分别是：</p>
<ul>
<li><code>boot-md</code></li>
</ul>
<p>每次程序启动时，自动读取并执行一个叫 <code>BOOT.md</code> 的文件。</p>
<p><strong>用途</strong>：如果你有一些每次都要 AI 记住的规则、或者每次都要运行的初始化环境命令，可以写在 <code>BOOT.md</code> 里。</p>
<ul>
<li><code>command-logger</code></li>
</ul>
<p>命令日志记录器。</p>
<p><strong>用途</strong>：它会把你输入的所有指令和 AI 的反馈记录下来。建议勾选，万一 AI 乱改了代码，你可以翻日志找回记录。</p>
<ul>
<li><code>session-memory</code></li>
</ul>
<p>会话记忆。</p>
<p><strong>用途</strong>：让 AI 记住你上一次聊了什么。如果不选，它可能每次运行都是“断片”状态，不记得之前的上下文。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d22da4e1a5346cdaa29ecc054e39ae1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54G16IeCTHliaWM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346320&amp;x-signature=mQAwhuNNaZ93%2BaJWdHWE6zLHycg%3D" alt="图片" loading="lazy"/>​</p>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>最后选择在哪里运行</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0db2b0c225fe4978a050e05c6d5558ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54G16IeCTHliaWM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346320&amp;x-signature=Hl%2BG02uL89BkGBH47oXSdVuXJ6g%3D" alt="图片" loading="lazy"/>​</p>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<ul>
<li><strong>Hatch in TUI (recommended)</strong></li>
</ul>
<p><strong>什么是 TUI？</strong> 它的全称是 Terminal User Interface。</p>
<p><strong>效果</strong>：就在你现在的这个黑色窗口里直接跳出一个比较漂亮的对话框。</p>
<p><strong>优点</strong>：速度最快，不用切换窗口，很有极客感觉。</p>
<ul>
<li><strong>Open the Web UI</strong></li>
</ul>
<p><strong>效果</strong>：它会启动一个本地服务器，并在你的浏览器（如 Chrome 或 Safari）里打开一个网页版界面。</p>
<p><strong>优点</strong>：界面更像 ChatGPT，推荐选这个。</p>
<ul>
<li><strong>Do this later</strong></li>
</ul>
<p><strong>效果</strong>：结束配置，回到命令行。</p>
<p><strong>用途</strong>：如果你现在只想装好，还没打算立刻开始聊天，选这个。</p>
<p>选择 Open the Web UI 后，会自动跳转网页如下</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95735f066b694408986d429b7e4e76a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54G16IeCTHliaWM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770346320&amp;x-signature=9f0BCK9b1KaL0VZqEHirNrEMQCc%3D" alt="图片" loading="lazy"/>​</p>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>现在恭喜你真正完成配置并可以开始使用了！</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>